<article class="ltx_document">
 <h1 class="ltx_title ltx_title_document">
  Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models
 </h1>
 <div class="ltx_authors">
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    <span class="ltx_text ltx_font_bold" id="id1.1.id1">
     Tianyi Men
     <sup class="ltx_sup" id="id1.1.id1.1">
      1,2
     </sup>
    </span>
    ,
    <span class="ltx_text ltx_font_bold" id="id2.2.id2">
     Pengfei Cao
     <sup class="ltx_sup" id="id2.2.id2.1">
      1,2
     </sup>
    </span>
    ,
    <span class="ltx_text ltx_font_bold" id="id3.3.id3">
     Zhuoran Jin
     <sup class="ltx_sup" id="id3.3.id3.1">
      1,2
     </sup>
    </span>
    ,
    <span class="ltx_text ltx_font_bold" id="id4.4.id4">
     Yubo Chen
     <sup class="ltx_sup" id="id4.4.id4.1">
      1,2
     </sup>
    </span>
    ,
    <span class="ltx_text ltx_font_bold" id="id5.5.id5">
     Kang Liu
     <sup class="ltx_sup" id="id5.5.id5.1">
      1,2
     </sup>
    </span>
    ,
    <span class="ltx_text ltx_font_bold" id="id6.6.id6">
     Jun Zhao
     <sup class="ltx_sup" id="id6.6.id6.1">
      1,2
     </sup>
    </span>
    <br class="ltx_break"/>
    <sup class="ltx_sup" id="id7.7.id7">
     1
    </sup>
    The Laboratory of Cognition and Decision Intelligence for Complex Systems,
    <br class="ltx_break"/>
    Institute of Automation, Chinese Academy of Sciences, Beijing, China
    <br class="ltx_break"/>
    <sup class="ltx_sup" id="id8.8.id8">
     2
    </sup>
    School of Artificial Intelligence, University of Chinese Academy of Sciences, Beijing, China
    <br class="ltx_break"/>
    {tianyi.men, pengfei.cao, zhuoran.jin, yubo.chen, kliu, jzhao}@nlpr.ia.ac.cn
   </span>
  </span>
 </div>
 <div class="ltx_abstract">
  <h6 class="ltx_title ltx_title_abstract">
   Abstract
  </h6>
  <p class="ltx_p" id="id9.id1">
   Planning, as the core module of agents, is crucial in various fields such as embodied agents, web navigation, and tool using. With the development of large language models (LLMs), some researchers treat large language models as intelligent agents to stimulate and evaluate their planning capabilities. However, the planning mechanism is still unclear. In this work, we focus on exploring the look-ahead planning mechanism in large language models from the perspectives of information flow and internal representations. First, we study how planning is done internally by analyzing the multi-layer perception (MLP) and multi-head self-attention (MHSA) components at the last token. We find that the output of MHSA in the middle layers at the last token can directly decode the decision to some extent. Based on this discovery, we further trace the source of MHSA by information flow, and we reveal that MHSA mainly extracts information from spans of the goal states and recent steps. According to information flow, we continue to study what information is encoded within it. Specifically, we explore whether future decisions have been encoded in advance in the representation of flow. We demonstrate that the middle and upper layers encode a few short-term future decisions to some extent when planning is successful. Overall, our research analyzes the look-ahead planning mechanisms of LLMs, facilitating future research on LLMs performing planning tasks.
  </p>
 </div>
 <div class="ltx_para ltx_noindent" id="p1">
  <div class="ltx_block ltx_align_bottom" id="p1.1">
   <p class="ltx_p" id="p1.1.1">
    <span class="ltx_text ltx_font_bold" id="p1.1.1.1">
     Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models
    </span>
   </p>
   <br class="ltx_break ltx_centering"/>
   <p class="ltx_p ltx_align_center" id="p1.1.2" style="width:433.6pt;">
    <span class="ltx_text ltx_inline-block" id="p1.1.2.1" style="width:0.0pt;">
     <span class="ltx_tabular ltx_align_top" id="p1.1.2.1.1">
      <span class="ltx_tbody">
       <span class="ltx_tr" id="p1.1.2.1.1.1.1">
        <span class="ltx_td ltx_align_center" id="p1.1.2.1.1.1.1.1">
         <span class="ltx_text ltx_font_bold" id="p1.1.2.1.1.1.1.1.1">
          Tianyi Men
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.1">
           1,2
          </sup>
          ,
Pengfei Cao
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.2">
           1,2
          </sup>
          ,
Zhuoran Jin
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.3">
           1,2
          </sup>
          ,
Yubo Chen
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.4">
           1,2
          </sup>
          ,
Kang Liu
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.5">
           1,2
          </sup>
          ,
Jun Zhao
          <sup class="ltx_sup" id="p1.1.2.1.1.1.1.1.1.6">
           1,2
          </sup>
         </span>
        </span>
       </span>
       <span class="ltx_tr" id="p1.1.2.1.1.2.2">
        <span class="ltx_td ltx_align_center" id="p1.1.2.1.1.2.2.1">
         <sup class="ltx_sup" id="p1.1.2.1.1.2.2.1.1">
          1
         </sup>
         The Laboratory of Cognition and Decision Intelligence for Complex Systems,
        </span>
       </span>
       <span class="ltx_tr" id="p1.1.2.1.1.3.3">
        <span class="ltx_td ltx_align_center" id="p1.1.2.1.1.3.3.1">
         Institute of Automation, Chinese Academy of Sciences, Beijing, China
        </span>
       </span>
       <span class="ltx_tr" id="p1.1.2.1.1.4.4">
        <span class="ltx_td ltx_align_center" id="p1.1.2.1.1.4.4.1">
         <sup class="ltx_sup" id="p1.1.2.1.1.4.4.1.1">
          2
         </sup>
         School of Artificial Intelligence, University of Chinese Academy of Sciences, Beijing, China
        </span>
       </span>
       <span class="ltx_tr" id="p1.1.2.1.1.5.5">
        <span class="ltx_td ltx_align_center" id="p1.1.2.1.1.5.5.1">
         {tianyi.men, pengfei.cao, zhuoran.jin, yubo.chen, kliu, jzhao}@nlpr.ia.ac.cn
        </span>
       </span>
      </span>
     </span>
    </span>
   </p>
   <br class="ltx_break ltx_centering"/>
  </div>
 </div>
 <section class="ltx_section" id="S1">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    1
   </span>
   Introduction
  </h2>
  <figure class="ltx_figure" id="S1.F1">
   <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="242" id="S1.F1.g1" src="/html/2406.16033/assets/x1.png" width="461"/>
   <figcaption class="ltx_caption">
    <span class="ltx_tag ltx_tag_figure">
     Figure 1:
    </span>
    An example of greedy and look-ahead planning.
   </figcaption>
  </figure>
  <div class="ltx_para" id="S1.p1">
   <p class="ltx_p" id="S1.p1.1">
    Planning is the process of formulating a series of actions to transform a given initial state into a desired goal state
    <cite class="ltx_cite ltx_citemacro_cite">
     Valmeekam et al. (
     <a class="ltx_ref" href="#bib.bib17" title="">
      2024
     </a>
     ); Zhang et al. (
     <a class="ltx_ref" href="#bib.bib33" title="">
      2024
     </a>
     )
    </cite>
    . As the core module of agents
    <cite class="ltx_cite ltx_citemacro_cite">
     Xi et al. (
     <a class="ltx_ref" href="#bib.bib26" title="">
      2023
     </a>
     ); Wang et al. (
     <a class="ltx_ref" href="#bib.bib21" title="">
      2024a
     </a>
     )
    </cite>
    , planning has been widely applied in many fields such as embodied agents
    <cite class="ltx_cite ltx_citemacro_cite">
     Shridhar et al. (
     <a class="ltx_ref" href="#bib.bib14" title="">
      2020
     </a>
     ); Wang et al. (
     <a class="ltx_ref" href="#bib.bib22" title="">
      2022
     </a>
     )
    </cite>
    , web navigation
    <cite class="ltx_cite ltx_citemacro_cite">
     Zhou et al. (
     <a class="ltx_ref" href="#bib.bib35" title="">
      2023
     </a>
     ); Deng et al. (
     <a class="ltx_ref" href="#bib.bib3" title="">
      2024
     </a>
     )
    </cite>
    and tool using
    <cite class="ltx_cite ltx_citemacro_cite">
     Xu et al. (
     <a class="ltx_ref" href="#bib.bib28" title="">
      2023
     </a>
     ); Qin et al. (
     <a class="ltx_ref" href="#bib.bib13" title="">
      2023
     </a>
     )
    </cite>
    . With the development of large language models, some researchers treat large language models as intelligent agents to solve complex tasks. This is because large language models may possess some preliminary planning capabilities
    <cite class="ltx_cite ltx_citemacro_cite">
     Huang et al. (
     <a class="ltx_ref" href="#bib.bib6" title="">
      2022
     </a>
     )
    </cite>
    . Recently, researchers have made efforts to stimulate and evaluate the planning capabilities of large language models. They propose prompt engineering
    <cite class="ltx_cite ltx_citemacro_cite">
     Zheng et al. (
     <a class="ltx_ref" href="#bib.bib34" title="">
      2023
     </a>
     )
    </cite>
    and instruction fine-tuning
    <cite class="ltx_cite ltx_citemacro_cite">
     Zeng et al. (
     <a class="ltx_ref" href="#bib.bib32" title="">
      2023
     </a>
     )
    </cite>
    to boost the planning abilities of large language models. Additionally, some researchers construct benchmarks such as AgentBench
    <cite class="ltx_cite ltx_citemacro_cite">
     Liu et al. (
     <a class="ltx_ref" href="#bib.bib10" title="">
      2023
     </a>
     )
    </cite>
    and AgentGym
    <cite class="ltx_cite ltx_citemacro_cite">
     Xi et al. (
     <a class="ltx_ref" href="#bib.bib27" title="">
      2024
     </a>
     )
    </cite>
    to evaluate the planning capabilities of large models. Although they have made some progress, the underlying mechanisms in planning capabilities of large language models remain a largely unexplored frontier. Revealing the planning mechanisms of large language models helps to better understand and improve their planning capabilities. Therefore, we focus on exploring the underlying mechanisms behind the planning abilities of large language models.
   </p>
  </div>
  <div class="ltx_para" id="S1.p2">
   <p class="ltx_p" id="S1.p2.3">
    In this work, we focus on exploring look-ahead planning mechanisms in large language models. We study the classical planning task Blocksworld, which is a fully-observed setting. All entity states are known from the init state and goal state, so exploration is not needed
    <cite class="ltx_cite ltx_citemacro_cite">
     Zhang et al. (
     <a class="ltx_ref" href="#bib.bib33" title="">
      2024
     </a>
     )
    </cite>
    . As illustrated in Figure
    <a class="ltx_ref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      1
     </span>
    </a>
    , given an initial state and a goal state of Blocksworld, the model can only pick up or put down one block. The model must generate a sequence of actions to transform the initial state into the goal state, as shown by the green path. However, it is still unclear whether the model, at step
    <math alttext="t" class="ltx_Math" display="inline" id="S1.p2.1.m1.1">
     <semantics id="S1.p2.1.m1.1a">
      <mi id="S1.p2.1.m1.1.1" xref="S1.p2.1.m1.1.1.cmml">
       t
      </mi>
      <annotation-xml encoding="MathML-Content" id="S1.p2.1.m1.1b">
       <ci id="S1.p2.1.m1.1.1.cmml" xref="S1.p2.1.m1.1.1">
        𝑡
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S1.p2.1.m1.1c">
       t
      </annotation>
     </semantics>
    </math>
    , greedily considers only the action at
    <math alttext="t+1" class="ltx_Math" display="inline" id="S1.p2.2.m2.1">
     <semantics id="S1.p2.2.m2.1a">
      <mrow id="S1.p2.2.m2.1.1" xref="S1.p2.2.m2.1.1.cmml">
       <mi id="S1.p2.2.m2.1.1.2" xref="S1.p2.2.m2.1.1.2.cmml">
        t
       </mi>
       <mo id="S1.p2.2.m2.1.1.1" xref="S1.p2.2.m2.1.1.1.cmml">
        +
       </mo>
       <mn id="S1.p2.2.m2.1.1.3" xref="S1.p2.2.m2.1.1.3.cmml">
        1
       </mn>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S1.p2.2.m2.1b">
       <apply id="S1.p2.2.m2.1.1.cmml" xref="S1.p2.2.m2.1.1">
        <plus id="S1.p2.2.m2.1.1.1.cmml" xref="S1.p2.2.m2.1.1.1">
        </plus>
        <ci id="S1.p2.2.m2.1.1.2.cmml" xref="S1.p2.2.m2.1.1.2">
         𝑡
        </ci>
        <cn id="S1.p2.2.m2.1.1.3.cmml" type="integer" xref="S1.p2.2.m2.1.1.3">
         1
        </cn>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S1.p2.2.m2.1c">
       t+1
      </annotation>
     </semantics>
    </math>
    or look-ahead considers the actions at
    <math alttext="t+2" class="ltx_Math" display="inline" id="S1.p2.3.m3.1">
     <semantics id="S1.p2.3.m3.1a">
      <mrow id="S1.p2.3.m3.1.1" xref="S1.p2.3.m3.1.1.cmml">
       <mi id="S1.p2.3.m3.1.1.2" xref="S1.p2.3.m3.1.1.2.cmml">
        t
       </mi>
       <mo id="S1.p2.3.m3.1.1.1" xref="S1.p2.3.m3.1.1.1.cmml">
        +
       </mo>
       <mn id="S1.p2.3.m3.1.1.3" xref="S1.p2.3.m3.1.1.3.cmml">
        2
       </mn>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S1.p2.3.m3.1b">
       <apply id="S1.p2.3.m3.1.1.cmml" xref="S1.p2.3.m3.1.1">
        <plus id="S1.p2.3.m3.1.1.1.cmml" xref="S1.p2.3.m3.1.1.1">
        </plus>
        <ci id="S1.p2.3.m3.1.1.2.cmml" xref="S1.p2.3.m3.1.1.2">
         𝑡
        </ci>
        <cn id="S1.p2.3.m3.1.1.3.cmml" type="integer" xref="S1.p2.3.m3.1.1.3">
         2
        </cn>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S1.p2.3.m3.1c">
       t+2
      </annotation>
     </semantics>
    </math>
    and beyond. Inspired by psychology, humans engage in look-ahead thinking when making plans
    <cite class="ltx_cite ltx_citemacro_cite">
     Baumeister et al. (
     <a class="ltx_ref" href="#bib.bib1" title="">
      2016
     </a>
     )
    </cite>
    . Based on this, we further propose the hypothesis of model look-ahead planning, which is as follows:
   </p>
  </div>
  <div class="ltx_para" id="S1.p3">
   <ul class="ltx_itemize" id="S1.I1">
    <li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i1.p1">
      <p class="ltx_p" id="S1.I1.i1.p1.1">
       <span class="ltx_text ltx_font_bold" id="S1.I1.i1.p1.1.1">
        Look-Ahead Planning Decisions Existence Hypothesis
       </span>
       : In the task of planning with large language models, given a rule, an initial state, a goal state, and task description prompts. At the current step, the model needs to predict the next action, the probe can detect decisions to some extent for future steps in the internal representations in the short term within a fully-observed setting when planning is successful.
      </p>
     </div>
    </li>
   </ul>
  </div>
  <div class="ltx_para" id="S1.p4">
   <p class="ltx_p" id="S1.p4.1">
    We design a two-stage paradigm to verify this hypothesis. It can be divided into the finding information flow stage and the probing internal representations stage. The first stage is to analyze the information flow and component functions during planning (§
    <a class="ltx_ref" href="#S5" title="5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5
    </a>
    ). The second stage is examining whether the model stores future information in internal representations (§
    <a class="ltx_ref" href="#S6" title="6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6
    </a>
    ). The specifics are as follows:
   </p>
  </div>
  <div class="ltx_para" id="S1.p5">
   <p class="ltx_p" id="S1.p5.1">
    (1) In the first stage, we study how planning is done internally by analyzing the MLP and MHSA components at the last token. Inspired by methods of calculating extraction rates methods
    <cite class="ltx_cite ltx_citemacro_cite">
     Geva et al. (
     <a class="ltx_ref" href="#bib.bib4" title="">
      2023
     </a>
     )
    </cite>
    , we find the output of MHSA in the middle layers at the last token can directly decode the correct colors to some extent (§
    <a class="ltx_ref" href="#S5.SS1" title="5.1 Attention Extract the Answers ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5.1
    </a>
    ). Based on this discovery, we further investigate the sources of information on MHSA. We trace the source of the decisions. And find that planning mainly depends on spans of the goal states and recent steps (§
    <a class="ltx_ref" href="#S5.SS2" title="5.2 Attention Extract from Goal and History ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5.2
    </a>
    ).
   </p>
  </div>
  <div class="ltx_para" id="S1.p6">
   <p class="ltx_p" id="S1.p6.1">
    (2) In the second stage, we study what information is encoded in the information flow and whether this information has been considered in advance for future decisions. For future decisions existence, we use the probing method to probe future decisions and reveal that the middle and upper layers encode a few short-term future decisions when planning is successful (§
    <a class="ltx_ref" href="#S6.SS1" title="6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6.1
    </a>
    ). For history step causality, we prevent the information flow from history steps and explore the impact of different history steps on the final decision (§
    <a class="ltx_ref" href="#S6.SS2" title="6.2 Internal Representations Facilitate Future Decision-making ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6.2
    </a>
    ).
   </p>
  </div>
  <div class="ltx_para" id="S1.p7">
   <p class="ltx_p" id="S1.p7.1">
    In summary, our contributions are as follows:
   </p>
   <ul class="ltx_itemize" id="S1.I2">
    <li class="ltx_item" id="S1.I2.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I2.i1.p1">
      <p class="ltx_p" id="S1.I2.i1.p1.1">
       To the best of our knowledge, this work is the first to investigate the planning interpretability mechanisms in large language models. We demonstrate the
       <span class="ltx_text ltx_font_bold" id="S1.I2.i1.p1.1.1">
        Look-Ahead Planning Decisions Existence Hypothesis
       </span>
       .
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I2.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I2.i2.p1">
      <p class="ltx_p" id="S1.I2.i2.p1.1">
       We reveal that the internal representations of LLMs encode a few short-term future decisions to some extent when planning is successful. These look-ahead decisions are enriched in the early layers, with accuracy decreasing as planning steps increase.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I2.i3" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I2.i3.p1">
      <p class="ltx_p" id="S1.I2.i3.p1.1">
       We prove that MHSA mainly extracts information from spans of the goal states and recent steps. The output of MHSA in the middle layers at the last token can directly decode the correct decisions partially in planning tasks.
      </p>
     </div>
    </li>
   </ul>
  </div>
 </section>
 <section class="ltx_section" id="S2">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    2
   </span>
   Experimental Setup
  </h2>
  <div class="ltx_para" id="S2.p1">
   <p class="ltx_p" id="S2.p1.8">
    In this paper, we study the Blocksworld task in a fully-observed setting where all entity states are known from the init state and goal state, so exploration is not needed
    <cite class="ltx_cite ltx_citemacro_cite">
     Zhang et al. (
     <a class="ltx_ref" href="#bib.bib33" title="">
      2024
     </a>
     )
    </cite>
    . Given a rule
    <math alttext="R" class="ltx_Math" display="inline" id="S2.p1.1.m1.1">
     <semantics id="S2.p1.1.m1.1a">
      <mi id="S2.p1.1.m1.1.1" xref="S2.p1.1.m1.1.1.cmml">
       R
      </mi>
      <annotation-xml encoding="MathML-Content" id="S2.p1.1.m1.1b">
       <ci id="S2.p1.1.m1.1.1.cmml" xref="S2.p1.1.m1.1.1">
        𝑅
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.1.m1.1c">
       R
      </annotation>
     </semantics>
    </math>
    , an initial state
    <math alttext="S_{\text{init}}" class="ltx_Math" display="inline" id="S2.p1.2.m2.1">
     <semantics id="S2.p1.2.m2.1a">
      <msub id="S2.p1.2.m2.1.1" xref="S2.p1.2.m2.1.1.cmml">
       <mi id="S2.p1.2.m2.1.1.2" xref="S2.p1.2.m2.1.1.2.cmml">
        S
       </mi>
       <mtext id="S2.p1.2.m2.1.1.3" xref="S2.p1.2.m2.1.1.3a.cmml">
        init
       </mtext>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S2.p1.2.m2.1b">
       <apply id="S2.p1.2.m2.1.1.cmml" xref="S2.p1.2.m2.1.1">
        <csymbol cd="ambiguous" id="S2.p1.2.m2.1.1.1.cmml" xref="S2.p1.2.m2.1.1">
         subscript
        </csymbol>
        <ci id="S2.p1.2.m2.1.1.2.cmml" xref="S2.p1.2.m2.1.1.2">
         𝑆
        </ci>
        <ci id="S2.p1.2.m2.1.1.3a.cmml" xref="S2.p1.2.m2.1.1.3">
         <mtext id="S2.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S2.p1.2.m2.1.1.3">
          init
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.2.m2.1c">
       S_{\text{init}}
      </annotation>
     </semantics>
    </math>
    , a goal state
    <math alttext="S_{\text{goal}}" class="ltx_Math" display="inline" id="S2.p1.3.m3.1">
     <semantics id="S2.p1.3.m3.1a">
      <msub id="S2.p1.3.m3.1.1" xref="S2.p1.3.m3.1.1.cmml">
       <mi id="S2.p1.3.m3.1.1.2" xref="S2.p1.3.m3.1.1.2.cmml">
        S
       </mi>
       <mtext id="S2.p1.3.m3.1.1.3" xref="S2.p1.3.m3.1.1.3a.cmml">
        goal
       </mtext>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S2.p1.3.m3.1b">
       <apply id="S2.p1.3.m3.1.1.cmml" xref="S2.p1.3.m3.1.1">
        <csymbol cd="ambiguous" id="S2.p1.3.m3.1.1.1.cmml" xref="S2.p1.3.m3.1.1">
         subscript
        </csymbol>
        <ci id="S2.p1.3.m3.1.1.2.cmml" xref="S2.p1.3.m3.1.1.2">
         𝑆
        </ci>
        <ci id="S2.p1.3.m3.1.1.3a.cmml" xref="S2.p1.3.m3.1.1.3">
         <mtext id="S2.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S2.p1.3.m3.1.1.3">
          goal
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.3.m3.1c">
       S_{\text{goal}}
      </annotation>
     </semantics>
    </math>
    , task description prompts
    <math alttext="C" class="ltx_Math" display="inline" id="S2.p1.4.m4.1">
     <semantics id="S2.p1.4.m4.1a">
      <mi id="S2.p1.4.m4.1.1" xref="S2.p1.4.m4.1.1.cmml">
       C
      </mi>
      <annotation-xml encoding="MathML-Content" id="S2.p1.4.m4.1b">
       <ci id="S2.p1.4.m4.1.1.cmml" xref="S2.p1.4.m4.1.1">
        𝐶
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.4.m4.1c">
       C
      </annotation>
     </semantics>
    </math>
    , the current step
    <math alttext="t" class="ltx_Math" display="inline" id="S2.p1.5.m5.1">
     <semantics id="S2.p1.5.m5.1a">
      <mi id="S2.p1.5.m5.1.1" xref="S2.p1.5.m5.1.1.cmml">
       t
      </mi>
      <annotation-xml encoding="MathML-Content" id="S2.p1.5.m5.1b">
       <ci id="S2.p1.5.m5.1.1.cmml" xref="S2.p1.5.m5.1.1">
        𝑡
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.5.m5.1c">
       t
      </annotation>
     </semantics>
    </math>
    , history
    <math alttext="a_{1}\ldots a_{t}" class="ltx_Math" display="inline" id="S2.p1.6.m6.1">
     <semantics id="S2.p1.6.m6.1a">
      <mrow id="S2.p1.6.m6.1.1" xref="S2.p1.6.m6.1.1.cmml">
       <msub id="S2.p1.6.m6.1.1.2" xref="S2.p1.6.m6.1.1.2.cmml">
        <mi id="S2.p1.6.m6.1.1.2.2" xref="S2.p1.6.m6.1.1.2.2.cmml">
         a
        </mi>
        <mn id="S2.p1.6.m6.1.1.2.3" xref="S2.p1.6.m6.1.1.2.3.cmml">
         1
        </mn>
       </msub>
       <mo id="S2.p1.6.m6.1.1.1" lspace="0em" rspace="0em" xref="S2.p1.6.m6.1.1.1.cmml">
        ​
       </mo>
       <mi id="S2.p1.6.m6.1.1.3" mathvariant="normal" xref="S2.p1.6.m6.1.1.3.cmml">
        …
       </mi>
       <mo id="S2.p1.6.m6.1.1.1a" lspace="0em" rspace="0em" xref="S2.p1.6.m6.1.1.1.cmml">
        ​
       </mo>
       <msub id="S2.p1.6.m6.1.1.4" xref="S2.p1.6.m6.1.1.4.cmml">
        <mi id="S2.p1.6.m6.1.1.4.2" xref="S2.p1.6.m6.1.1.4.2.cmml">
         a
        </mi>
        <mi id="S2.p1.6.m6.1.1.4.3" xref="S2.p1.6.m6.1.1.4.3.cmml">
         t
        </mi>
       </msub>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S2.p1.6.m6.1b">
       <apply id="S2.p1.6.m6.1.1.cmml" xref="S2.p1.6.m6.1.1">
        <times id="S2.p1.6.m6.1.1.1.cmml" xref="S2.p1.6.m6.1.1.1">
        </times>
        <apply id="S2.p1.6.m6.1.1.2.cmml" xref="S2.p1.6.m6.1.1.2">
         <csymbol cd="ambiguous" id="S2.p1.6.m6.1.1.2.1.cmml" xref="S2.p1.6.m6.1.1.2">
          subscript
         </csymbol>
         <ci id="S2.p1.6.m6.1.1.2.2.cmml" xref="S2.p1.6.m6.1.1.2.2">
          𝑎
         </ci>
         <cn id="S2.p1.6.m6.1.1.2.3.cmml" type="integer" xref="S2.p1.6.m6.1.1.2.3">
          1
         </cn>
        </apply>
        <ci id="S2.p1.6.m6.1.1.3.cmml" xref="S2.p1.6.m6.1.1.3">
         …
        </ci>
        <apply id="S2.p1.6.m6.1.1.4.cmml" xref="S2.p1.6.m6.1.1.4">
         <csymbol cd="ambiguous" id="S2.p1.6.m6.1.1.4.1.cmml" xref="S2.p1.6.m6.1.1.4">
          subscript
         </csymbol>
         <ci id="S2.p1.6.m6.1.1.4.2.cmml" xref="S2.p1.6.m6.1.1.4.2">
          𝑎
         </ci>
         <ci id="S2.p1.6.m6.1.1.4.3.cmml" xref="S2.p1.6.m6.1.1.4.3">
          𝑡
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.6.m6.1c">
       a_{1}\ldots a_{t}
      </annotation>
     </semantics>
    </math>
    , model needs to predict the next action
    <math alttext="a_{t+1}" class="ltx_Math" display="inline" id="S2.p1.7.m7.1">
     <semantics id="S2.p1.7.m7.1a">
      <msub id="S2.p1.7.m7.1.1" xref="S2.p1.7.m7.1.1.cmml">
       <mi id="S2.p1.7.m7.1.1.2" xref="S2.p1.7.m7.1.1.2.cmml">
        a
       </mi>
       <mrow id="S2.p1.7.m7.1.1.3" xref="S2.p1.7.m7.1.1.3.cmml">
        <mi id="S2.p1.7.m7.1.1.3.2" xref="S2.p1.7.m7.1.1.3.2.cmml">
         t
        </mi>
        <mo id="S2.p1.7.m7.1.1.3.1" xref="S2.p1.7.m7.1.1.3.1.cmml">
         +
        </mo>
        <mn id="S2.p1.7.m7.1.1.3.3" xref="S2.p1.7.m7.1.1.3.3.cmml">
         1
        </mn>
       </mrow>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S2.p1.7.m7.1b">
       <apply id="S2.p1.7.m7.1.1.cmml" xref="S2.p1.7.m7.1.1">
        <csymbol cd="ambiguous" id="S2.p1.7.m7.1.1.1.cmml" xref="S2.p1.7.m7.1.1">
         subscript
        </csymbol>
        <ci id="S2.p1.7.m7.1.1.2.cmml" xref="S2.p1.7.m7.1.1.2">
         𝑎
        </ci>
        <apply id="S2.p1.7.m7.1.1.3.cmml" xref="S2.p1.7.m7.1.1.3">
         <plus id="S2.p1.7.m7.1.1.3.1.cmml" xref="S2.p1.7.m7.1.1.3.1">
         </plus>
         <ci id="S2.p1.7.m7.1.1.3.2.cmml" xref="S2.p1.7.m7.1.1.3.2">
          𝑡
         </ci>
         <cn id="S2.p1.7.m7.1.1.3.3.cmml" type="integer" xref="S2.p1.7.m7.1.1.3.3">
          1
         </cn>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.7.m7.1c">
       a_{t+1}
      </annotation>
     </semantics>
    </math>
    in accordance with its generative distribution
    <math alttext="p(a_{t+1}\mid R,S_{\text{init}},S_{\text{goal}},C,a_{1}\ldots a_{t})" class="ltx_Math" display="inline" id="S2.p1.8.m8.3">
     <semantics id="S2.p1.8.m8.3a">
      <mrow id="S2.p1.8.m8.3.3" xref="S2.p1.8.m8.3.3.cmml">
       <mi id="S2.p1.8.m8.3.3.3" xref="S2.p1.8.m8.3.3.3.cmml">
        p
       </mi>
       <mo id="S2.p1.8.m8.3.3.2" lspace="0em" rspace="0em" xref="S2.p1.8.m8.3.3.2.cmml">
        ​
       </mo>
       <mrow id="S2.p1.8.m8.3.3.1.1" xref="S2.p1.8.m8.3.3.1.1.1.cmml">
        <mo id="S2.p1.8.m8.3.3.1.1.2" stretchy="false" xref="S2.p1.8.m8.3.3.1.1.1.cmml">
         (
        </mo>
        <mrow id="S2.p1.8.m8.3.3.1.1.1" xref="S2.p1.8.m8.3.3.1.1.1.cmml">
         <msub id="S2.p1.8.m8.3.3.1.1.1.5" xref="S2.p1.8.m8.3.3.1.1.1.5.cmml">
          <mi id="S2.p1.8.m8.3.3.1.1.1.5.2" xref="S2.p1.8.m8.3.3.1.1.1.5.2.cmml">
           a
          </mi>
          <mrow id="S2.p1.8.m8.3.3.1.1.1.5.3" xref="S2.p1.8.m8.3.3.1.1.1.5.3.cmml">
           <mi id="S2.p1.8.m8.3.3.1.1.1.5.3.2" xref="S2.p1.8.m8.3.3.1.1.1.5.3.2.cmml">
            t
           </mi>
           <mo id="S2.p1.8.m8.3.3.1.1.1.5.3.1" xref="S2.p1.8.m8.3.3.1.1.1.5.3.1.cmml">
            +
           </mo>
           <mn id="S2.p1.8.m8.3.3.1.1.1.5.3.3" xref="S2.p1.8.m8.3.3.1.1.1.5.3.3.cmml">
            1
           </mn>
          </mrow>
         </msub>
         <mo id="S2.p1.8.m8.3.3.1.1.1.4" xref="S2.p1.8.m8.3.3.1.1.1.4.cmml">
          ∣
         </mo>
         <mrow id="S2.p1.8.m8.3.3.1.1.1.3.3" xref="S2.p1.8.m8.3.3.1.1.1.3.4.cmml">
          <mi id="S2.p1.8.m8.1.1" xref="S2.p1.8.m8.1.1.cmml">
           R
          </mi>
          <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.4" xref="S2.p1.8.m8.3.3.1.1.1.3.4.cmml">
           ,
          </mo>
          <msub id="S2.p1.8.m8.3.3.1.1.1.1.1.1" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.cmml">
           <mi id="S2.p1.8.m8.3.3.1.1.1.1.1.1.2" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.2.cmml">
            S
           </mi>
           <mtext id="S2.p1.8.m8.3.3.1.1.1.1.1.1.3" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.3a.cmml">
            init
           </mtext>
          </msub>
          <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.5" xref="S2.p1.8.m8.3.3.1.1.1.3.4.cmml">
           ,
          </mo>
          <msub id="S2.p1.8.m8.3.3.1.1.1.2.2.2" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.cmml">
           <mi id="S2.p1.8.m8.3.3.1.1.1.2.2.2.2" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.2.cmml">
            S
           </mi>
           <mtext id="S2.p1.8.m8.3.3.1.1.1.2.2.2.3" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.3a.cmml">
            goal
           </mtext>
          </msub>
          <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.6" xref="S2.p1.8.m8.3.3.1.1.1.3.4.cmml">
           ,
          </mo>
          <mi id="S2.p1.8.m8.2.2" xref="S2.p1.8.m8.2.2.cmml">
           C
          </mi>
          <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.7" xref="S2.p1.8.m8.3.3.1.1.1.3.4.cmml">
           ,
          </mo>
          <mrow id="S2.p1.8.m8.3.3.1.1.1.3.3.3" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.cmml">
           <msub id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.cmml">
            <mi id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.2" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.2.cmml">
             a
            </mi>
            <mn id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.3" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.3.cmml">
             1
            </mn>
           </msub>
           <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.3.1" lspace="0em" rspace="0em" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.1.cmml">
            ​
           </mo>
           <mi id="S2.p1.8.m8.3.3.1.1.1.3.3.3.3" mathvariant="normal" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.3.cmml">
            …
           </mi>
           <mo id="S2.p1.8.m8.3.3.1.1.1.3.3.3.1a" lspace="0em" rspace="0em" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.1.cmml">
            ​
           </mo>
           <msub id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.cmml">
            <mi id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.2" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.2.cmml">
             a
            </mi>
            <mi id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.3" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.3.cmml">
             t
            </mi>
           </msub>
          </mrow>
         </mrow>
        </mrow>
        <mo id="S2.p1.8.m8.3.3.1.1.3" stretchy="false" xref="S2.p1.8.m8.3.3.1.1.1.cmml">
         )
        </mo>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S2.p1.8.m8.3b">
       <apply id="S2.p1.8.m8.3.3.cmml" xref="S2.p1.8.m8.3.3">
        <times id="S2.p1.8.m8.3.3.2.cmml" xref="S2.p1.8.m8.3.3.2">
        </times>
        <ci id="S2.p1.8.m8.3.3.3.cmml" xref="S2.p1.8.m8.3.3.3">
         𝑝
        </ci>
        <apply id="S2.p1.8.m8.3.3.1.1.1.cmml" xref="S2.p1.8.m8.3.3.1.1">
         <csymbol cd="latexml" id="S2.p1.8.m8.3.3.1.1.1.4.cmml" xref="S2.p1.8.m8.3.3.1.1.1.4">
          conditional
         </csymbol>
         <apply id="S2.p1.8.m8.3.3.1.1.1.5.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5">
          <csymbol cd="ambiguous" id="S2.p1.8.m8.3.3.1.1.1.5.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5">
           subscript
          </csymbol>
          <ci id="S2.p1.8.m8.3.3.1.1.1.5.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5.2">
           𝑎
          </ci>
          <apply id="S2.p1.8.m8.3.3.1.1.1.5.3.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5.3">
           <plus id="S2.p1.8.m8.3.3.1.1.1.5.3.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5.3.1">
           </plus>
           <ci id="S2.p1.8.m8.3.3.1.1.1.5.3.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.5.3.2">
            𝑡
           </ci>
           <cn id="S2.p1.8.m8.3.3.1.1.1.5.3.3.cmml" type="integer" xref="S2.p1.8.m8.3.3.1.1.1.5.3.3">
            1
           </cn>
          </apply>
         </apply>
         <list id="S2.p1.8.m8.3.3.1.1.1.3.4.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3">
          <ci id="S2.p1.8.m8.1.1.cmml" xref="S2.p1.8.m8.1.1">
           𝑅
          </ci>
          <apply id="S2.p1.8.m8.3.3.1.1.1.1.1.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1">
           <csymbol cd="ambiguous" id="S2.p1.8.m8.3.3.1.1.1.1.1.1.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1">
            subscript
           </csymbol>
           <ci id="S2.p1.8.m8.3.3.1.1.1.1.1.1.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.2">
            𝑆
           </ci>
           <ci id="S2.p1.8.m8.3.3.1.1.1.1.1.1.3a.cmml" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.3">
            <mtext id="S2.p1.8.m8.3.3.1.1.1.1.1.1.3.cmml" mathsize="70%" xref="S2.p1.8.m8.3.3.1.1.1.1.1.1.3">
             init
            </mtext>
           </ci>
          </apply>
          <apply id="S2.p1.8.m8.3.3.1.1.1.2.2.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2">
           <csymbol cd="ambiguous" id="S2.p1.8.m8.3.3.1.1.1.2.2.2.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2">
            subscript
           </csymbol>
           <ci id="S2.p1.8.m8.3.3.1.1.1.2.2.2.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.2">
            𝑆
           </ci>
           <ci id="S2.p1.8.m8.3.3.1.1.1.2.2.2.3a.cmml" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.3">
            <mtext id="S2.p1.8.m8.3.3.1.1.1.2.2.2.3.cmml" mathsize="70%" xref="S2.p1.8.m8.3.3.1.1.1.2.2.2.3">
             goal
            </mtext>
           </ci>
          </apply>
          <ci id="S2.p1.8.m8.2.2.cmml" xref="S2.p1.8.m8.2.2">
           𝐶
          </ci>
          <apply id="S2.p1.8.m8.3.3.1.1.1.3.3.3.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3">
           <times id="S2.p1.8.m8.3.3.1.1.1.3.3.3.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.1">
           </times>
           <apply id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2">
            <csymbol cd="ambiguous" id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2">
             subscript
            </csymbol>
            <ci id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.2">
             𝑎
            </ci>
            <cn id="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.3.cmml" type="integer" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.2.3">
             1
            </cn>
           </apply>
           <ci id="S2.p1.8.m8.3.3.1.1.1.3.3.3.3.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.3">
            …
           </ci>
           <apply id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4">
            <csymbol cd="ambiguous" id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.1.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4">
             subscript
            </csymbol>
            <ci id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.2.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.2">
             𝑎
            </ci>
            <ci id="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.3.cmml" xref="S2.p1.8.m8.3.3.1.1.1.3.3.3.4.3">
             𝑡
            </ci>
           </apply>
          </apply>
         </list>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S2.p1.8.m8.3c">
       p(a_{t+1}\mid R,S_{\text{init}},S_{\text{goal}},C,a_{1}\ldots a_{t})
      </annotation>
     </semantics>
    </math>
    <cite class="ltx_cite ltx_citemacro_cite">
     Hao et al. (
     <a class="ltx_ref" href="#bib.bib5" title="">
      2023
     </a>
     )
    </cite>
    . In this paper, all inputs are in text form. All inferences are performed using the teacher-forcing method. Previous evaluation works
    <cite class="ltx_cite ltx_citemacro_cite">
     Valmeekam et al. (
     <a class="ltx_ref" href="#bib.bib18" title="">
      2023
     </a>
     )
    </cite>
    mainly involved generating a complete plan and then placing it into the environment for assessment. However, since our primary focus is on open-source models, we have reduced the difficulty by using a fill-in-the-blank format for evaluating the models.
An example is shown in Figure
    <a class="ltx_ref" href="#S2.F2" title="Figure 2 ‣ Model ‣ 2 Experimental Setup ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      2
     </span>
    </a>
    . The input mainly consists of four parts: rule, initial state, goal state, and plan.
   </p>
  </div>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px1">
   <h4 class="ltx_title ltx_title_paragraph">
    Data
   </h4>
   <div class="ltx_para" id="S2.SS0.SSS0.Px1.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.1">
     Previous Blocksworld evaluation benchmarks
     <cite class="ltx_cite ltx_citemacro_cite">
      Valmeekam et al. (
      <a class="ltx_ref" href="#bib.bib18" title="">
       2023
      </a>
      )
     </cite>
     put the plans generated by models into an environment to verify the correctness. However, existing interpretability methods, such as information flow
     <cite class="ltx_cite ltx_citemacro_cite">
      Wang et al. (
      <a class="ltx_ref" href="#bib.bib20" title="">
       2023
      </a>
      )
     </cite>
     , require gold labels. Therefore, we synthesize a dataset containing optimal plans, with specific data statistics shown in Table
     <a class="ltx_ref" href="#A1.T1" title="Table 1 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
      <span class="ltx_text ltx_ref_tag">
       1
      </span>
     </a>
     . We generate data with 4, 5, and 6 color varieties, 4 piles, and a maximum of 6 steps, where pick-up and stack are considered as two different steps. There are three levels: LEVEL1 (L1) with two steps, LEVEL2 (L2) with four steps, and LEVEL3 (L3) with six steps. We choose the optimal path from the initial step to the final step. For samples with multiple optimal paths, we select one to include in the training set, ensuring that samples in the test set have unique optimal paths. We split the dataset into training and test sets with a ratio of 1:3.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px2">
   <h4 class="ltx_title ltx_title_paragraph">
    Metric
   </h4>
   <div class="ltx_para" id="S2.SS0.SSS0.Px2.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.7">
     In the Blocksworld task, we use two metrics: single-step success rate and complete plan success rate. The single-step success rate evaluates whether each individual action is correct, defined as:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S2.E1">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="S_{\text{step}}=\frac{1}{N}\sum_{i=1}^{N}r_{i}\\
" class="ltx_Math" display="block" id="S2.E1.m1.1">
         <semantics id="S2.E1.m1.1a">
          <mrow id="S2.E1.m1.1.1" xref="S2.E1.m1.1.1.cmml">
           <msub id="S2.E1.m1.1.1.2" xref="S2.E1.m1.1.1.2.cmml">
            <mi id="S2.E1.m1.1.1.2.2" xref="S2.E1.m1.1.1.2.2.cmml">
             S
            </mi>
            <mtext id="S2.E1.m1.1.1.2.3" xref="S2.E1.m1.1.1.2.3a.cmml">
             step
            </mtext>
           </msub>
           <mo id="S2.E1.m1.1.1.1" xref="S2.E1.m1.1.1.1.cmml">
            =
           </mo>
           <mrow id="S2.E1.m1.1.1.3" xref="S2.E1.m1.1.1.3.cmml">
            <mfrac id="S2.E1.m1.1.1.3.2" xref="S2.E1.m1.1.1.3.2.cmml">
             <mn id="S2.E1.m1.1.1.3.2.2" xref="S2.E1.m1.1.1.3.2.2.cmml">
              1
             </mn>
             <mi id="S2.E1.m1.1.1.3.2.3" xref="S2.E1.m1.1.1.3.2.3.cmml">
              N
             </mi>
            </mfrac>
            <mo id="S2.E1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S2.E1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mrow id="S2.E1.m1.1.1.3.3" xref="S2.E1.m1.1.1.3.3.cmml">
             <munderover id="S2.E1.m1.1.1.3.3.1" xref="S2.E1.m1.1.1.3.3.1.cmml">
              <mo id="S2.E1.m1.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E1.m1.1.1.3.3.1.2.2.cmml">
               ∑
              </mo>
              <mrow id="S2.E1.m1.1.1.3.3.1.2.3" xref="S2.E1.m1.1.1.3.3.1.2.3.cmml">
               <mi id="S2.E1.m1.1.1.3.3.1.2.3.2" xref="S2.E1.m1.1.1.3.3.1.2.3.2.cmml">
                i
               </mi>
               <mo id="S2.E1.m1.1.1.3.3.1.2.3.1" xref="S2.E1.m1.1.1.3.3.1.2.3.1.cmml">
                =
               </mo>
               <mn id="S2.E1.m1.1.1.3.3.1.2.3.3" xref="S2.E1.m1.1.1.3.3.1.2.3.3.cmml">
                1
               </mn>
              </mrow>
              <mi id="S2.E1.m1.1.1.3.3.1.3" xref="S2.E1.m1.1.1.3.3.1.3.cmml">
               N
              </mi>
             </munderover>
             <msub id="S2.E1.m1.1.1.3.3.2" xref="S2.E1.m1.1.1.3.3.2.cmml">
              <mi id="S2.E1.m1.1.1.3.3.2.2" xref="S2.E1.m1.1.1.3.3.2.2.cmml">
               r
              </mi>
              <mi id="S2.E1.m1.1.1.3.3.2.3" xref="S2.E1.m1.1.1.3.3.2.3.cmml">
               i
              </mi>
             </msub>
            </mrow>
           </mrow>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S2.E1.m1.1b">
           <apply id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1">
            <eq id="S2.E1.m1.1.1.1.cmml" xref="S2.E1.m1.1.1.1">
            </eq>
            <apply id="S2.E1.m1.1.1.2.cmml" xref="S2.E1.m1.1.1.2">
             <csymbol cd="ambiguous" id="S2.E1.m1.1.1.2.1.cmml" xref="S2.E1.m1.1.1.2">
              subscript
             </csymbol>
             <ci id="S2.E1.m1.1.1.2.2.cmml" xref="S2.E1.m1.1.1.2.2">
              𝑆
             </ci>
             <ci id="S2.E1.m1.1.1.2.3a.cmml" xref="S2.E1.m1.1.1.2.3">
              <mtext id="S2.E1.m1.1.1.2.3.cmml" mathsize="70%" xref="S2.E1.m1.1.1.2.3">
               step
              </mtext>
             </ci>
            </apply>
            <apply id="S2.E1.m1.1.1.3.cmml" xref="S2.E1.m1.1.1.3">
             <times id="S2.E1.m1.1.1.3.1.cmml" xref="S2.E1.m1.1.1.3.1">
             </times>
             <apply id="S2.E1.m1.1.1.3.2.cmml" xref="S2.E1.m1.1.1.3.2">
              <divide id="S2.E1.m1.1.1.3.2.1.cmml" xref="S2.E1.m1.1.1.3.2">
              </divide>
              <cn id="S2.E1.m1.1.1.3.2.2.cmml" type="integer" xref="S2.E1.m1.1.1.3.2.2">
               1
              </cn>
              <ci id="S2.E1.m1.1.1.3.2.3.cmml" xref="S2.E1.m1.1.1.3.2.3">
               𝑁
              </ci>
             </apply>
             <apply id="S2.E1.m1.1.1.3.3.cmml" xref="S2.E1.m1.1.1.3.3">
              <apply id="S2.E1.m1.1.1.3.3.1.cmml" xref="S2.E1.m1.1.1.3.3.1">
               <csymbol cd="ambiguous" id="S2.E1.m1.1.1.3.3.1.1.cmml" xref="S2.E1.m1.1.1.3.3.1">
                superscript
               </csymbol>
               <apply id="S2.E1.m1.1.1.3.3.1.2.cmml" xref="S2.E1.m1.1.1.3.3.1">
                <csymbol cd="ambiguous" id="S2.E1.m1.1.1.3.3.1.2.1.cmml" xref="S2.E1.m1.1.1.3.3.1">
                 subscript
                </csymbol>
                <sum id="S2.E1.m1.1.1.3.3.1.2.2.cmml" xref="S2.E1.m1.1.1.3.3.1.2.2">
                </sum>
                <apply id="S2.E1.m1.1.1.3.3.1.2.3.cmml" xref="S2.E1.m1.1.1.3.3.1.2.3">
                 <eq id="S2.E1.m1.1.1.3.3.1.2.3.1.cmml" xref="S2.E1.m1.1.1.3.3.1.2.3.1">
                 </eq>
                 <ci id="S2.E1.m1.1.1.3.3.1.2.3.2.cmml" xref="S2.E1.m1.1.1.3.3.1.2.3.2">
                  𝑖
                 </ci>
                 <cn id="S2.E1.m1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E1.m1.1.1.3.3.1.2.3.3">
                  1
                 </cn>
                </apply>
               </apply>
               <ci id="S2.E1.m1.1.1.3.3.1.3.cmml" xref="S2.E1.m1.1.1.3.3.1.3">
                𝑁
               </ci>
              </apply>
              <apply id="S2.E1.m1.1.1.3.3.2.cmml" xref="S2.E1.m1.1.1.3.3.2">
               <csymbol cd="ambiguous" id="S2.E1.m1.1.1.3.3.2.1.cmml" xref="S2.E1.m1.1.1.3.3.2">
                subscript
               </csymbol>
               <ci id="S2.E1.m1.1.1.3.3.2.2.cmml" xref="S2.E1.m1.1.1.3.3.2.2">
                𝑟
               </ci>
               <ci id="S2.E1.m1.1.1.3.3.2.3.cmml" xref="S2.E1.m1.1.1.3.3.2.3">
                𝑖
               </ci>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S2.E1.m1.1c">
           S_{\text{step}}=\frac{1}{N}\sum_{i=1}^{N}r_{i}\\
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (1)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.3">
     where
     <math alttext="N" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.1.m1.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.1.m1.1a">
       <mi id="S2.SS0.SSS0.Px2.p1.1.m1.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml">
        N
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.1.m1.1b">
        <ci id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1">
         𝑁
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.1.m1.1c">
        N
       </annotation>
      </semantics>
     </math>
     is the total number of steps and
     <math alttext="r_{i}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.2.m2.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.2.m2.1a">
       <msub id="S2.SS0.SSS0.Px2.p1.2.m2.1.1" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml">
        <mi id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml">
         i
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.2.m2.1b">
        <apply id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1">
         <csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3">
          𝑖
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.2.m2.1c">
        r_{i}
       </annotation>
      </semantics>
     </math>
     indicates the success of the
     <math alttext="i" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.3.m3.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.3.m3.1a">
       <mi id="S2.SS0.SSS0.Px2.p1.3.m3.1.1" xref="S2.SS0.SSS0.Px2.p1.3.m3.1.1.cmml">
        i
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.3.m3.1b">
        <ci id="S2.SS0.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.3.m3.1.1">
         𝑖
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.3.m3.1c">
        i
       </annotation>
      </semantics>
     </math>
     -th step (1 for success, 0 otherwise). The complete plan success rate evaluates whether the entire planning process is correct, defined as:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S2.E2">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="S_{\text{plan}}=\frac{1}{M}\sum_{j=1}^{M}R_{j}\\
" class="ltx_Math" display="block" id="S2.E2.m1.1">
         <semantics id="S2.E2.m1.1a">
          <mrow id="S2.E2.m1.1.1" xref="S2.E2.m1.1.1.cmml">
           <msub id="S2.E2.m1.1.1.2" xref="S2.E2.m1.1.1.2.cmml">
            <mi id="S2.E2.m1.1.1.2.2" xref="S2.E2.m1.1.1.2.2.cmml">
             S
            </mi>
            <mtext id="S2.E2.m1.1.1.2.3" xref="S2.E2.m1.1.1.2.3a.cmml">
             plan
            </mtext>
           </msub>
           <mo id="S2.E2.m1.1.1.1" xref="S2.E2.m1.1.1.1.cmml">
            =
           </mo>
           <mrow id="S2.E2.m1.1.1.3" xref="S2.E2.m1.1.1.3.cmml">
            <mfrac id="S2.E2.m1.1.1.3.2" xref="S2.E2.m1.1.1.3.2.cmml">
             <mn id="S2.E2.m1.1.1.3.2.2" xref="S2.E2.m1.1.1.3.2.2.cmml">
              1
             </mn>
             <mi id="S2.E2.m1.1.1.3.2.3" xref="S2.E2.m1.1.1.3.2.3.cmml">
              M
             </mi>
            </mfrac>
            <mo id="S2.E2.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mrow id="S2.E2.m1.1.1.3.3" xref="S2.E2.m1.1.1.3.3.cmml">
             <munderover id="S2.E2.m1.1.1.3.3.1" xref="S2.E2.m1.1.1.3.3.1.cmml">
              <mo id="S2.E2.m1.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E2.m1.1.1.3.3.1.2.2.cmml">
               ∑
              </mo>
              <mrow id="S2.E2.m1.1.1.3.3.1.2.3" xref="S2.E2.m1.1.1.3.3.1.2.3.cmml">
               <mi id="S2.E2.m1.1.1.3.3.1.2.3.2" xref="S2.E2.m1.1.1.3.3.1.2.3.2.cmml">
                j
               </mi>
               <mo id="S2.E2.m1.1.1.3.3.1.2.3.1" xref="S2.E2.m1.1.1.3.3.1.2.3.1.cmml">
                =
               </mo>
               <mn id="S2.E2.m1.1.1.3.3.1.2.3.3" xref="S2.E2.m1.1.1.3.3.1.2.3.3.cmml">
                1
               </mn>
              </mrow>
              <mi id="S2.E2.m1.1.1.3.3.1.3" xref="S2.E2.m1.1.1.3.3.1.3.cmml">
               M
              </mi>
             </munderover>
             <msub id="S2.E2.m1.1.1.3.3.2" xref="S2.E2.m1.1.1.3.3.2.cmml">
              <mi id="S2.E2.m1.1.1.3.3.2.2" xref="S2.E2.m1.1.1.3.3.2.2.cmml">
               R
              </mi>
              <mi id="S2.E2.m1.1.1.3.3.2.3" xref="S2.E2.m1.1.1.3.3.2.3.cmml">
               j
              </mi>
             </msub>
            </mrow>
           </mrow>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S2.E2.m1.1b">
           <apply id="S2.E2.m1.1.1.cmml" xref="S2.E2.m1.1.1">
            <eq id="S2.E2.m1.1.1.1.cmml" xref="S2.E2.m1.1.1.1">
            </eq>
            <apply id="S2.E2.m1.1.1.2.cmml" xref="S2.E2.m1.1.1.2">
             <csymbol cd="ambiguous" id="S2.E2.m1.1.1.2.1.cmml" xref="S2.E2.m1.1.1.2">
              subscript
             </csymbol>
             <ci id="S2.E2.m1.1.1.2.2.cmml" xref="S2.E2.m1.1.1.2.2">
              𝑆
             </ci>
             <ci id="S2.E2.m1.1.1.2.3a.cmml" xref="S2.E2.m1.1.1.2.3">
              <mtext id="S2.E2.m1.1.1.2.3.cmml" mathsize="70%" xref="S2.E2.m1.1.1.2.3">
               plan
              </mtext>
             </ci>
            </apply>
            <apply id="S2.E2.m1.1.1.3.cmml" xref="S2.E2.m1.1.1.3">
             <times id="S2.E2.m1.1.1.3.1.cmml" xref="S2.E2.m1.1.1.3.1">
             </times>
             <apply id="S2.E2.m1.1.1.3.2.cmml" xref="S2.E2.m1.1.1.3.2">
              <divide id="S2.E2.m1.1.1.3.2.1.cmml" xref="S2.E2.m1.1.1.3.2">
              </divide>
              <cn id="S2.E2.m1.1.1.3.2.2.cmml" type="integer" xref="S2.E2.m1.1.1.3.2.2">
               1
              </cn>
              <ci id="S2.E2.m1.1.1.3.2.3.cmml" xref="S2.E2.m1.1.1.3.2.3">
               𝑀
              </ci>
             </apply>
             <apply id="S2.E2.m1.1.1.3.3.cmml" xref="S2.E2.m1.1.1.3.3">
              <apply id="S2.E2.m1.1.1.3.3.1.cmml" xref="S2.E2.m1.1.1.3.3.1">
               <csymbol cd="ambiguous" id="S2.E2.m1.1.1.3.3.1.1.cmml" xref="S2.E2.m1.1.1.3.3.1">
                superscript
               </csymbol>
               <apply id="S2.E2.m1.1.1.3.3.1.2.cmml" xref="S2.E2.m1.1.1.3.3.1">
                <csymbol cd="ambiguous" id="S2.E2.m1.1.1.3.3.1.2.1.cmml" xref="S2.E2.m1.1.1.3.3.1">
                 subscript
                </csymbol>
                <sum id="S2.E2.m1.1.1.3.3.1.2.2.cmml" xref="S2.E2.m1.1.1.3.3.1.2.2">
                </sum>
                <apply id="S2.E2.m1.1.1.3.3.1.2.3.cmml" xref="S2.E2.m1.1.1.3.3.1.2.3">
                 <eq id="S2.E2.m1.1.1.3.3.1.2.3.1.cmml" xref="S2.E2.m1.1.1.3.3.1.2.3.1">
                 </eq>
                 <ci id="S2.E2.m1.1.1.3.3.1.2.3.2.cmml" xref="S2.E2.m1.1.1.3.3.1.2.3.2">
                  𝑗
                 </ci>
                 <cn id="S2.E2.m1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E2.m1.1.1.3.3.1.2.3.3">
                  1
                 </cn>
                </apply>
               </apply>
               <ci id="S2.E2.m1.1.1.3.3.1.3.cmml" xref="S2.E2.m1.1.1.3.3.1.3">
                𝑀
               </ci>
              </apply>
              <apply id="S2.E2.m1.1.1.3.3.2.cmml" xref="S2.E2.m1.1.1.3.3.2">
               <csymbol cd="ambiguous" id="S2.E2.m1.1.1.3.3.2.1.cmml" xref="S2.E2.m1.1.1.3.3.2">
                subscript
               </csymbol>
               <ci id="S2.E2.m1.1.1.3.3.2.2.cmml" xref="S2.E2.m1.1.1.3.3.2.2">
                𝑅
               </ci>
               <ci id="S2.E2.m1.1.1.3.3.2.3.cmml" xref="S2.E2.m1.1.1.3.3.2.3">
                𝑗
               </ci>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S2.E2.m1.1c">
           S_{\text{plan}}=\frac{1}{M}\sum_{j=1}^{M}R_{j}\\
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (2)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.6">
     where
     <math alttext="M" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.4.m1.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.4.m1.1a">
       <mi id="S2.SS0.SSS0.Px2.p1.4.m1.1.1" xref="S2.SS0.SSS0.Px2.p1.4.m1.1.1.cmml">
        M
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.4.m1.1b">
        <ci id="S2.SS0.SSS0.Px2.p1.4.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.4.m1.1.1">
         𝑀
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.4.m1.1c">
        M
       </annotation>
      </semantics>
     </math>
     is the total number of tested plans and
     <math alttext="R_{j}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.5.m2.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.5.m2.1a">
       <msub id="S2.SS0.SSS0.Px2.p1.5.m2.1.1" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1.cmml">
        <mi id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.2" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1.2.cmml">
         R
        </mi>
        <mi id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.3" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.5.m2.1b">
        <apply id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1">
         <csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1.2">
          𝑅
         </ci>
         <ci id="S2.SS0.SSS0.Px2.p1.5.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p1.5.m2.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.5.m2.1c">
        R_{j}
       </annotation>
      </semantics>
     </math>
     indicates the success of the
     <math alttext="j" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.6.m3.1">
      <semantics id="S2.SS0.SSS0.Px2.p1.6.m3.1a">
       <mi id="S2.SS0.SSS0.Px2.p1.6.m3.1.1" xref="S2.SS0.SSS0.Px2.p1.6.m3.1.1.cmml">
        j
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.6.m3.1b">
        <ci id="S2.SS0.SSS0.Px2.p1.6.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.6.m3.1.1">
         𝑗
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.6.m3.1c">
        j
       </annotation>
      </semantics>
     </math>
     -th plan (1 for complete success, 0 otherwise).
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px3">
   <h4 class="ltx_title ltx_title_paragraph">
    Model
   </h4>
   <div class="ltx_para" id="S2.SS0.SSS0.Px3.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px3.p1.1">
     We evaluate two large language models: Llama-2-7b-chat
     <cite class="ltx_cite ltx_citemacro_cite">
      Touvron et al. (
      <a class="ltx_ref" href="#bib.bib16" title="">
       2023
      </a>
      )
     </cite>
     and Vicuna-7B
     <cite class="ltx_cite ltx_citemacro_cite">
      Chiang et al. (
      <a class="ltx_ref" href="#bib.bib2" title="">
       2023
      </a>
      )
     </cite>
     . Since open-source models have preliminary planning capabilities, we enhance the ability of large language models to complete planning tasks through training.
    </p>
   </div>
   <figure class="ltx_figure" id="S2.F2">
    <img alt="Refer to caption" class="ltx_graphics ltx_missing ltx_missing_image" id="S2.F2.g1" src=""/>
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_figure">
      Figure 2:
     </span>
     An example of Blocksworld.
    </figcaption>
   </figure>
  </section>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px4">
   <h4 class="ltx_title ltx_title_paragraph">
    Experiment Setting
   </h4>
   <div class="ltx_para" id="S2.SS0.SSS0.Px4.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px4.p1.1">
     We conduct full parameter fine-tuning on Llama-2-7b-chat-hf and Vicuna-7B for 3 epochs. The training process involves a global batch size of 20, using the Adam optimizer with a learning rate of 5e-5. Llama-2-7b-chat-hf and Vicuna-7B achieve complete plan success rates of 61% and 63%, respectively, at LEVEL 3 with 6 blocks. We sample 400 correct data points from LEVEL 3 with 6 blocks for our analysis. We conduct experiment based on HuggingFace’s Transformers
     <span class="ltx_note ltx_role_footnote" id="footnote1">
      <sup class="ltx_note_mark">
       1
      </sup>
      <span class="ltx_note_outer">
       <span class="ltx_note_content">
        <sup class="ltx_note_mark">
         1
        </sup>
        <span class="ltx_tag ltx_tag_note">
         1
        </span>
        <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/huggingface/transformers/" target="_blank" title="">
         https://github.com/huggingface/transformers/
        </a>
       </span>
      </span>
     </span>
     , PyTorch
     <span class="ltx_note ltx_role_footnote" id="footnote2">
      <sup class="ltx_note_mark">
       2
      </sup>
      <span class="ltx_note_outer">
       <span class="ltx_note_content">
        <sup class="ltx_note_mark">
         2
        </sup>
        <span class="ltx_tag ltx_tag_note">
         2
        </span>
        <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/pytorch/pytorch/" target="_blank" title="">
         https://github.com/pytorch/pytorch/
        </a>
       </span>
      </span>
     </span>
     , baukit
     <span class="ltx_note ltx_role_footnote" id="footnote3">
      <sup class="ltx_note_mark">
       3
      </sup>
      <span class="ltx_note_outer">
       <span class="ltx_note_content">
        <sup class="ltx_note_mark">
         3
        </sup>
        <span class="ltx_tag ltx_tag_note">
         3
        </span>
        <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/davidbau/baukit/" target="_blank" title="">
         https://github.com/davidbau/baukit/
        </a>
       </span>
      </span>
     </span>
     and pyvene
     <span class="ltx_note ltx_role_footnote" id="footnote4">
      <sup class="ltx_note_mark">
       4
      </sup>
      <span class="ltx_note_outer">
       <span class="ltx_note_content">
        <sup class="ltx_note_mark">
         4
        </sup>
        <span class="ltx_tag ltx_tag_note">
         4
        </span>
        <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/stanfordnlp/pyvene" target="_blank" title="">
         https://github.com/stanfordnlp/pyvene
        </a>
       </span>
      </span>
     </span>
     <cite class="ltx_cite ltx_citemacro_cite">
      Wu et al. (
      <a class="ltx_ref" href="#bib.bib25" title="">
       2024b
      </a>
      )
     </cite>
     .
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S3">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    3
   </span>
   Background
  </h2>
  <div class="ltx_para" id="S3.p1">
   <p class="ltx_p" id="S3.p1.10">
    A transformer-based language model begins by converting an input text into a sequence of
    <math alttext="N" class="ltx_Math" display="inline" id="S3.p1.1.m1.1">
     <semantics id="S3.p1.1.m1.1a">
      <mi id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml">
       N
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b">
       <ci id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1">
        𝑁
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">
       N
      </annotation>
     </semantics>
    </math>
    tokens, denoted as
    <math alttext="s_{1},\ldots,s_{N}" class="ltx_Math" display="inline" id="S3.p1.2.m2.3">
     <semantics id="S3.p1.2.m2.3a">
      <mrow id="S3.p1.2.m2.3.3.2" xref="S3.p1.2.m2.3.3.3.cmml">
       <msub id="S3.p1.2.m2.2.2.1.1" xref="S3.p1.2.m2.2.2.1.1.cmml">
        <mi id="S3.p1.2.m2.2.2.1.1.2" xref="S3.p1.2.m2.2.2.1.1.2.cmml">
         s
        </mi>
        <mn id="S3.p1.2.m2.2.2.1.1.3" xref="S3.p1.2.m2.2.2.1.1.3.cmml">
         1
        </mn>
       </msub>
       <mo id="S3.p1.2.m2.3.3.2.3" xref="S3.p1.2.m2.3.3.3.cmml">
        ,
       </mo>
       <mi id="S3.p1.2.m2.1.1" mathvariant="normal" xref="S3.p1.2.m2.1.1.cmml">
        …
       </mi>
       <mo id="S3.p1.2.m2.3.3.2.4" xref="S3.p1.2.m2.3.3.3.cmml">
        ,
       </mo>
       <msub id="S3.p1.2.m2.3.3.2.2" xref="S3.p1.2.m2.3.3.2.2.cmml">
        <mi id="S3.p1.2.m2.3.3.2.2.2" xref="S3.p1.2.m2.3.3.2.2.2.cmml">
         s
        </mi>
        <mi id="S3.p1.2.m2.3.3.2.2.3" xref="S3.p1.2.m2.3.3.2.2.3.cmml">
         N
        </mi>
       </msub>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S3.p1.2.m2.3b">
       <list id="S3.p1.2.m2.3.3.3.cmml" xref="S3.p1.2.m2.3.3.2">
        <apply id="S3.p1.2.m2.2.2.1.1.cmml" xref="S3.p1.2.m2.2.2.1.1">
         <csymbol cd="ambiguous" id="S3.p1.2.m2.2.2.1.1.1.cmml" xref="S3.p1.2.m2.2.2.1.1">
          subscript
         </csymbol>
         <ci id="S3.p1.2.m2.2.2.1.1.2.cmml" xref="S3.p1.2.m2.2.2.1.1.2">
          𝑠
         </ci>
         <cn id="S3.p1.2.m2.2.2.1.1.3.cmml" type="integer" xref="S3.p1.2.m2.2.2.1.1.3">
          1
         </cn>
        </apply>
        <ci id="S3.p1.2.m2.1.1.cmml" xref="S3.p1.2.m2.1.1">
         …
        </ci>
        <apply id="S3.p1.2.m2.3.3.2.2.cmml" xref="S3.p1.2.m2.3.3.2.2">
         <csymbol cd="ambiguous" id="S3.p1.2.m2.3.3.2.2.1.cmml" xref="S3.p1.2.m2.3.3.2.2">
          subscript
         </csymbol>
         <ci id="S3.p1.2.m2.3.3.2.2.2.cmml" xref="S3.p1.2.m2.3.3.2.2.2">
          𝑠
         </ci>
         <ci id="S3.p1.2.m2.3.3.2.2.3.cmml" xref="S3.p1.2.m2.3.3.2.2.3">
          𝑁
         </ci>
        </apply>
       </list>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.2.m2.3c">
       s_{1},\ldots,s_{N}
      </annotation>
     </semantics>
    </math>
    . Each token
    <math alttext="s_{i}" class="ltx_Math" display="inline" id="S3.p1.3.m3.1">
     <semantics id="S3.p1.3.m3.1a">
      <msub id="S3.p1.3.m3.1.1" xref="S3.p1.3.m3.1.1.cmml">
       <mi id="S3.p1.3.m3.1.1.2" xref="S3.p1.3.m3.1.1.2.cmml">
        s
       </mi>
       <mi id="S3.p1.3.m3.1.1.3" xref="S3.p1.3.m3.1.1.3.cmml">
        i
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S3.p1.3.m3.1b">
       <apply id="S3.p1.3.m3.1.1.cmml" xref="S3.p1.3.m3.1.1">
        <csymbol cd="ambiguous" id="S3.p1.3.m3.1.1.1.cmml" xref="S3.p1.3.m3.1.1">
         subscript
        </csymbol>
        <ci id="S3.p1.3.m3.1.1.2.cmml" xref="S3.p1.3.m3.1.1.2">
         𝑠
        </ci>
        <ci id="S3.p1.3.m3.1.1.3.cmml" xref="S3.p1.3.m3.1.1.3">
         𝑖
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.3.m3.1c">
       s_{i}
      </annotation>
     </semantics>
    </math>
    is mapped to a vector
    <math alttext="x_{i}^{0}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.p1.4.m4.1">
     <semantics id="S3.p1.4.m4.1a">
      <mrow id="S3.p1.4.m4.1.1" xref="S3.p1.4.m4.1.1.cmml">
       <msubsup id="S3.p1.4.m4.1.1.2" xref="S3.p1.4.m4.1.1.2.cmml">
        <mi id="S3.p1.4.m4.1.1.2.2.2" xref="S3.p1.4.m4.1.1.2.2.2.cmml">
         x
        </mi>
        <mi id="S3.p1.4.m4.1.1.2.2.3" xref="S3.p1.4.m4.1.1.2.2.3.cmml">
         i
        </mi>
        <mn id="S3.p1.4.m4.1.1.2.3" xref="S3.p1.4.m4.1.1.2.3.cmml">
         0
        </mn>
       </msubsup>
       <mo id="S3.p1.4.m4.1.1.1" xref="S3.p1.4.m4.1.1.1.cmml">
        ∈
       </mo>
       <msup id="S3.p1.4.m4.1.1.3" xref="S3.p1.4.m4.1.1.3.cmml">
        <mi id="S3.p1.4.m4.1.1.3.2" xref="S3.p1.4.m4.1.1.3.2.cmml">
         ℝ
        </mi>
        <mi id="S3.p1.4.m4.1.1.3.3" xref="S3.p1.4.m4.1.1.3.3.cmml">
         d
        </mi>
       </msup>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S3.p1.4.m4.1b">
       <apply id="S3.p1.4.m4.1.1.cmml" xref="S3.p1.4.m4.1.1">
        <in id="S3.p1.4.m4.1.1.1.cmml" xref="S3.p1.4.m4.1.1.1">
        </in>
        <apply id="S3.p1.4.m4.1.1.2.cmml" xref="S3.p1.4.m4.1.1.2">
         <csymbol cd="ambiguous" id="S3.p1.4.m4.1.1.2.1.cmml" xref="S3.p1.4.m4.1.1.2">
          superscript
         </csymbol>
         <apply id="S3.p1.4.m4.1.1.2.2.cmml" xref="S3.p1.4.m4.1.1.2">
          <csymbol cd="ambiguous" id="S3.p1.4.m4.1.1.2.2.1.cmml" xref="S3.p1.4.m4.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.p1.4.m4.1.1.2.2.2.cmml" xref="S3.p1.4.m4.1.1.2.2.2">
           𝑥
          </ci>
          <ci id="S3.p1.4.m4.1.1.2.2.3.cmml" xref="S3.p1.4.m4.1.1.2.2.3">
           𝑖
          </ci>
         </apply>
         <cn id="S3.p1.4.m4.1.1.2.3.cmml" type="integer" xref="S3.p1.4.m4.1.1.2.3">
          0
         </cn>
        </apply>
        <apply id="S3.p1.4.m4.1.1.3.cmml" xref="S3.p1.4.m4.1.1.3">
         <csymbol cd="ambiguous" id="S3.p1.4.m4.1.1.3.1.cmml" xref="S3.p1.4.m4.1.1.3">
          superscript
         </csymbol>
         <ci id="S3.p1.4.m4.1.1.3.2.cmml" xref="S3.p1.4.m4.1.1.3.2">
          ℝ
         </ci>
         <ci id="S3.p1.4.m4.1.1.3.3.cmml" xref="S3.p1.4.m4.1.1.3.3">
          𝑑
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.4.m4.1c">
       x_{i}^{0}\in\mathbb{R}^{d}
      </annotation>
     </semantics>
    </math>
    .
    <math alttext="E\in\mathbb{R}^{|V|\times d}" class="ltx_Math" display="inline" id="S3.p1.5.m5.1">
     <semantics id="S3.p1.5.m5.1a">
      <mrow id="S3.p1.5.m5.1.2" xref="S3.p1.5.m5.1.2.cmml">
       <mi id="S3.p1.5.m5.1.2.2" xref="S3.p1.5.m5.1.2.2.cmml">
        E
       </mi>
       <mo id="S3.p1.5.m5.1.2.1" xref="S3.p1.5.m5.1.2.1.cmml">
        ∈
       </mo>
       <msup id="S3.p1.5.m5.1.2.3" xref="S3.p1.5.m5.1.2.3.cmml">
        <mi id="S3.p1.5.m5.1.2.3.2" xref="S3.p1.5.m5.1.2.3.2.cmml">
         ℝ
        </mi>
        <mrow id="S3.p1.5.m5.1.1.1" xref="S3.p1.5.m5.1.1.1.cmml">
         <mrow id="S3.p1.5.m5.1.1.1.3.2" xref="S3.p1.5.m5.1.1.1.3.1.cmml">
          <mo id="S3.p1.5.m5.1.1.1.3.2.1" stretchy="false" xref="S3.p1.5.m5.1.1.1.3.1.1.cmml">
           |
          </mo>
          <mi id="S3.p1.5.m5.1.1.1.1" xref="S3.p1.5.m5.1.1.1.1.cmml">
           V
          </mi>
          <mo id="S3.p1.5.m5.1.1.1.3.2.2" rspace="0.055em" stretchy="false" xref="S3.p1.5.m5.1.1.1.3.1.1.cmml">
           |
          </mo>
         </mrow>
         <mo id="S3.p1.5.m5.1.1.1.2" rspace="0.222em" xref="S3.p1.5.m5.1.1.1.2.cmml">
          ×
         </mo>
         <mi id="S3.p1.5.m5.1.1.1.4" xref="S3.p1.5.m5.1.1.1.4.cmml">
          d
         </mi>
        </mrow>
       </msup>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S3.p1.5.m5.1b">
       <apply id="S3.p1.5.m5.1.2.cmml" xref="S3.p1.5.m5.1.2">
        <in id="S3.p1.5.m5.1.2.1.cmml" xref="S3.p1.5.m5.1.2.1">
        </in>
        <ci id="S3.p1.5.m5.1.2.2.cmml" xref="S3.p1.5.m5.1.2.2">
         𝐸
        </ci>
        <apply id="S3.p1.5.m5.1.2.3.cmml" xref="S3.p1.5.m5.1.2.3">
         <csymbol cd="ambiguous" id="S3.p1.5.m5.1.2.3.1.cmml" xref="S3.p1.5.m5.1.2.3">
          superscript
         </csymbol>
         <ci id="S3.p1.5.m5.1.2.3.2.cmml" xref="S3.p1.5.m5.1.2.3.2">
          ℝ
         </ci>
         <apply id="S3.p1.5.m5.1.1.1.cmml" xref="S3.p1.5.m5.1.1.1">
          <times id="S3.p1.5.m5.1.1.1.2.cmml" xref="S3.p1.5.m5.1.1.1.2">
          </times>
          <apply id="S3.p1.5.m5.1.1.1.3.1.cmml" xref="S3.p1.5.m5.1.1.1.3.2">
           <abs id="S3.p1.5.m5.1.1.1.3.1.1.cmml" xref="S3.p1.5.m5.1.1.1.3.2.1">
           </abs>
           <ci id="S3.p1.5.m5.1.1.1.1.cmml" xref="S3.p1.5.m5.1.1.1.1">
            𝑉
           </ci>
          </apply>
          <ci id="S3.p1.5.m5.1.1.1.4.cmml" xref="S3.p1.5.m5.1.1.1.4">
           𝑑
          </ci>
         </apply>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.5.m5.1c">
       E\in\mathbb{R}^{|V|\times d}
      </annotation>
     </semantics>
    </math>
    is the decoder matrix in the last layer, where
    <math alttext="V" class="ltx_Math" display="inline" id="S3.p1.6.m6.1">
     <semantics id="S3.p1.6.m6.1a">
      <mi id="S3.p1.6.m6.1.1" xref="S3.p1.6.m6.1.1.cmml">
       V
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p1.6.m6.1b">
       <ci id="S3.p1.6.m6.1.1.cmml" xref="S3.p1.6.m6.1.1">
        𝑉
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.6.m6.1c">
       V
      </annotation>
     </semantics>
    </math>
    is the vocabulary,
    <math alttext="d" class="ltx_Math" display="inline" id="S3.p1.7.m7.1">
     <semantics id="S3.p1.7.m7.1a">
      <mi id="S3.p1.7.m7.1.1" xref="S3.p1.7.m7.1.1.cmml">
       d
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p1.7.m7.1b">
       <ci id="S3.p1.7.m7.1.1.cmml" xref="S3.p1.7.m7.1.1">
        𝑑
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.7.m7.1c">
       d
      </annotation>
     </semantics>
    </math>
    is embedding dimension. Each layer comprises a multi-head self-attention (MHSA) sublayer followed by a multi-layer perception (MLP) sublayer
    <cite class="ltx_cite ltx_citemacro_cite">
     Vaswani et al. (
     <a class="ltx_ref" href="#bib.bib19" title="">
      2017
     </a>
     )
    </cite>
    . Formally, the representation
    <math alttext="x_{i}^{\ell}" class="ltx_Math" display="inline" id="S3.p1.8.m8.1">
     <semantics id="S3.p1.8.m8.1a">
      <msubsup id="S3.p1.8.m8.1.1" xref="S3.p1.8.m8.1.1.cmml">
       <mi id="S3.p1.8.m8.1.1.2.2" xref="S3.p1.8.m8.1.1.2.2.cmml">
        x
       </mi>
       <mi id="S3.p1.8.m8.1.1.2.3" xref="S3.p1.8.m8.1.1.2.3.cmml">
        i
       </mi>
       <mi id="S3.p1.8.m8.1.1.3" mathvariant="normal" xref="S3.p1.8.m8.1.1.3.cmml">
        ℓ
       </mi>
      </msubsup>
      <annotation-xml encoding="MathML-Content" id="S3.p1.8.m8.1b">
       <apply id="S3.p1.8.m8.1.1.cmml" xref="S3.p1.8.m8.1.1">
        <csymbol cd="ambiguous" id="S3.p1.8.m8.1.1.1.cmml" xref="S3.p1.8.m8.1.1">
         superscript
        </csymbol>
        <apply id="S3.p1.8.m8.1.1.2.cmml" xref="S3.p1.8.m8.1.1">
         <csymbol cd="ambiguous" id="S3.p1.8.m8.1.1.2.1.cmml" xref="S3.p1.8.m8.1.1">
          subscript
         </csymbol>
         <ci id="S3.p1.8.m8.1.1.2.2.cmml" xref="S3.p1.8.m8.1.1.2.2">
          𝑥
         </ci>
         <ci id="S3.p1.8.m8.1.1.2.3.cmml" xref="S3.p1.8.m8.1.1.2.3">
          𝑖
         </ci>
        </apply>
        <ci id="S3.p1.8.m8.1.1.3.cmml" xref="S3.p1.8.m8.1.1.3">
         ℓ
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.8.m8.1c">
       x_{i}^{\ell}
      </annotation>
     </semantics>
    </math>
    of token
    <math alttext="i" class="ltx_Math" display="inline" id="S3.p1.9.m9.1">
     <semantics id="S3.p1.9.m9.1a">
      <mi id="S3.p1.9.m9.1.1" xref="S3.p1.9.m9.1.1.cmml">
       i
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p1.9.m9.1b">
       <ci id="S3.p1.9.m9.1.1.cmml" xref="S3.p1.9.m9.1.1">
        𝑖
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.9.m9.1c">
       i
      </annotation>
     </semantics>
    </math>
    at layer
    <math alttext="\ell" class="ltx_Math" display="inline" id="S3.p1.10.m10.1">
     <semantics id="S3.p1.10.m10.1a">
      <mi id="S3.p1.10.m10.1.1" mathvariant="normal" xref="S3.p1.10.m10.1.1.cmml">
       ℓ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p1.10.m10.1b">
       <ci id="S3.p1.10.m10.1.1.cmml" xref="S3.p1.10.m10.1.1">
        ℓ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p1.10.m10.1c">
       \ell
      </annotation>
     </semantics>
    </math>
    can be obtained as follows:
   </p>
  </div>
  <div class="ltx_para" id="S3.p2">
   <table class="ltx_equation ltx_eqn_table" id="S3.E3">
    <tbody>
     <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
      <td class="ltx_eqn_cell ltx_eqn_center_padleft">
      </td>
      <td class="ltx_eqn_cell ltx_align_center">
       <math alttext="\mathbf{x}_{i}^{\ell}=\mathbf{x}_{i}^{\ell-1}+\mathbf{attn}_{i}^{\ell}+\mathbf{m}_{i}^{\ell}" class="ltx_Math" display="block" id="S3.E3.m1.1">
        <semantics id="S3.E3.m1.1a">
         <mrow id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml">
          <msubsup id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml">
           <mi id="S3.E3.m1.1.1.2.2.2" xref="S3.E3.m1.1.1.2.2.2.cmml">
            𝐱
           </mi>
           <mi id="S3.E3.m1.1.1.2.2.3" xref="S3.E3.m1.1.1.2.2.3.cmml">
            i
           </mi>
           <mi id="S3.E3.m1.1.1.2.3" mathvariant="normal" xref="S3.E3.m1.1.1.2.3.cmml">
            ℓ
           </mi>
          </msubsup>
          <mo id="S3.E3.m1.1.1.1" xref="S3.E3.m1.1.1.1.cmml">
           =
          </mo>
          <mrow id="S3.E3.m1.1.1.3" xref="S3.E3.m1.1.1.3.cmml">
           <msubsup id="S3.E3.m1.1.1.3.2" xref="S3.E3.m1.1.1.3.2.cmml">
            <mi id="S3.E3.m1.1.1.3.2.2.2" xref="S3.E3.m1.1.1.3.2.2.2.cmml">
             𝐱
            </mi>
            <mi id="S3.E3.m1.1.1.3.2.2.3" xref="S3.E3.m1.1.1.3.2.2.3.cmml">
             i
            </mi>
            <mrow id="S3.E3.m1.1.1.3.2.3" xref="S3.E3.m1.1.1.3.2.3.cmml">
             <mi id="S3.E3.m1.1.1.3.2.3.2" mathvariant="normal" xref="S3.E3.m1.1.1.3.2.3.2.cmml">
              ℓ
             </mi>
             <mo id="S3.E3.m1.1.1.3.2.3.1" xref="S3.E3.m1.1.1.3.2.3.1.cmml">
              −
             </mo>
             <mn id="S3.E3.m1.1.1.3.2.3.3" xref="S3.E3.m1.1.1.3.2.3.3.cmml">
              1
             </mn>
            </mrow>
           </msubsup>
           <mo id="S3.E3.m1.1.1.3.1" xref="S3.E3.m1.1.1.3.1.cmml">
            +
           </mo>
           <msubsup id="S3.E3.m1.1.1.3.3" xref="S3.E3.m1.1.1.3.3.cmml">
            <mi id="S3.E3.m1.1.1.3.3.2.2" xref="S3.E3.m1.1.1.3.3.2.2.cmml">
             𝐚𝐭𝐭𝐧
            </mi>
            <mi id="S3.E3.m1.1.1.3.3.2.3" xref="S3.E3.m1.1.1.3.3.2.3.cmml">
             i
            </mi>
            <mi id="S3.E3.m1.1.1.3.3.3" mathvariant="normal" xref="S3.E3.m1.1.1.3.3.3.cmml">
             ℓ
            </mi>
           </msubsup>
           <mo id="S3.E3.m1.1.1.3.1a" xref="S3.E3.m1.1.1.3.1.cmml">
            +
           </mo>
           <msubsup id="S3.E3.m1.1.1.3.4" xref="S3.E3.m1.1.1.3.4.cmml">
            <mi id="S3.E3.m1.1.1.3.4.2.2" xref="S3.E3.m1.1.1.3.4.2.2.cmml">
             𝐦
            </mi>
            <mi id="S3.E3.m1.1.1.3.4.2.3" xref="S3.E3.m1.1.1.3.4.2.3.cmml">
             i
            </mi>
            <mi id="S3.E3.m1.1.1.3.4.3" mathvariant="normal" xref="S3.E3.m1.1.1.3.4.3.cmml">
             ℓ
            </mi>
           </msubsup>
          </mrow>
         </mrow>
         <annotation-xml encoding="MathML-Content" id="S3.E3.m1.1b">
          <apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.1.1">
           <eq id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1">
           </eq>
           <apply id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2">
            <csymbol cd="ambiguous" id="S3.E3.m1.1.1.2.1.cmml" xref="S3.E3.m1.1.1.2">
             superscript
            </csymbol>
            <apply id="S3.E3.m1.1.1.2.2.cmml" xref="S3.E3.m1.1.1.2">
             <csymbol cd="ambiguous" id="S3.E3.m1.1.1.2.2.1.cmml" xref="S3.E3.m1.1.1.2">
              subscript
             </csymbol>
             <ci id="S3.E3.m1.1.1.2.2.2.cmml" xref="S3.E3.m1.1.1.2.2.2">
              𝐱
             </ci>
             <ci id="S3.E3.m1.1.1.2.2.3.cmml" xref="S3.E3.m1.1.1.2.2.3">
              𝑖
             </ci>
            </apply>
            <ci id="S3.E3.m1.1.1.2.3.cmml" xref="S3.E3.m1.1.1.2.3">
             ℓ
            </ci>
           </apply>
           <apply id="S3.E3.m1.1.1.3.cmml" xref="S3.E3.m1.1.1.3">
            <plus id="S3.E3.m1.1.1.3.1.cmml" xref="S3.E3.m1.1.1.3.1">
            </plus>
            <apply id="S3.E3.m1.1.1.3.2.cmml" xref="S3.E3.m1.1.1.3.2">
             <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.2.1.cmml" xref="S3.E3.m1.1.1.3.2">
              superscript
             </csymbol>
             <apply id="S3.E3.m1.1.1.3.2.2.cmml" xref="S3.E3.m1.1.1.3.2">
              <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.2.2.1.cmml" xref="S3.E3.m1.1.1.3.2">
               subscript
              </csymbol>
              <ci id="S3.E3.m1.1.1.3.2.2.2.cmml" xref="S3.E3.m1.1.1.3.2.2.2">
               𝐱
              </ci>
              <ci id="S3.E3.m1.1.1.3.2.2.3.cmml" xref="S3.E3.m1.1.1.3.2.2.3">
               𝑖
              </ci>
             </apply>
             <apply id="S3.E3.m1.1.1.3.2.3.cmml" xref="S3.E3.m1.1.1.3.2.3">
              <minus id="S3.E3.m1.1.1.3.2.3.1.cmml" xref="S3.E3.m1.1.1.3.2.3.1">
              </minus>
              <ci id="S3.E3.m1.1.1.3.2.3.2.cmml" xref="S3.E3.m1.1.1.3.2.3.2">
               ℓ
              </ci>
              <cn id="S3.E3.m1.1.1.3.2.3.3.cmml" type="integer" xref="S3.E3.m1.1.1.3.2.3.3">
               1
              </cn>
             </apply>
            </apply>
            <apply id="S3.E3.m1.1.1.3.3.cmml" xref="S3.E3.m1.1.1.3.3">
             <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.1.cmml" xref="S3.E3.m1.1.1.3.3">
              superscript
             </csymbol>
             <apply id="S3.E3.m1.1.1.3.3.2.cmml" xref="S3.E3.m1.1.1.3.3">
              <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.2.1.cmml" xref="S3.E3.m1.1.1.3.3">
               subscript
              </csymbol>
              <ci id="S3.E3.m1.1.1.3.3.2.2.cmml" xref="S3.E3.m1.1.1.3.3.2.2">
               𝐚𝐭𝐭𝐧
              </ci>
              <ci id="S3.E3.m1.1.1.3.3.2.3.cmml" xref="S3.E3.m1.1.1.3.3.2.3">
               𝑖
              </ci>
             </apply>
             <ci id="S3.E3.m1.1.1.3.3.3.cmml" xref="S3.E3.m1.1.1.3.3.3">
              ℓ
             </ci>
            </apply>
            <apply id="S3.E3.m1.1.1.3.4.cmml" xref="S3.E3.m1.1.1.3.4">
             <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.4.1.cmml" xref="S3.E3.m1.1.1.3.4">
              superscript
             </csymbol>
             <apply id="S3.E3.m1.1.1.3.4.2.cmml" xref="S3.E3.m1.1.1.3.4">
              <csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.4.2.1.cmml" xref="S3.E3.m1.1.1.3.4">
               subscript
              </csymbol>
              <ci id="S3.E3.m1.1.1.3.4.2.2.cmml" xref="S3.E3.m1.1.1.3.4.2.2">
               𝐦
              </ci>
              <ci id="S3.E3.m1.1.1.3.4.2.3.cmml" xref="S3.E3.m1.1.1.3.4.2.3">
               𝑖
              </ci>
             </apply>
             <ci id="S3.E3.m1.1.1.3.4.3.cmml" xref="S3.E3.m1.1.1.3.4.3">
              ℓ
             </ci>
            </apply>
           </apply>
          </apply>
         </annotation-xml>
         <annotation encoding="application/x-tex" id="S3.E3.m1.1c">
          \mathbf{x}_{i}^{\ell}=\mathbf{x}_{i}^{\ell-1}+\mathbf{attn}_{i}^{\ell}+\mathbf{m}_{i}^{\ell}
         </annotation>
        </semantics>
       </math>
      </td>
      <td class="ltx_eqn_cell ltx_eqn_center_padright">
      </td>
      <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
       <span class="ltx_tag ltx_tag_equation ltx_align_right">
        (3)
       </span>
      </td>
     </tr>
    </tbody>
   </table>
  </div>
  <div class="ltx_para" id="S3.p3">
   <p class="ltx_p" id="S3.p3.4">
    <math alttext="a_{i}^{\ell}" class="ltx_Math" display="inline" id="S3.p3.1.m1.1">
     <semantics id="S3.p3.1.m1.1a">
      <msubsup id="S3.p3.1.m1.1.1" xref="S3.p3.1.m1.1.1.cmml">
       <mi id="S3.p3.1.m1.1.1.2.2" xref="S3.p3.1.m1.1.1.2.2.cmml">
        a
       </mi>
       <mi id="S3.p3.1.m1.1.1.2.3" xref="S3.p3.1.m1.1.1.2.3.cmml">
        i
       </mi>
       <mi id="S3.p3.1.m1.1.1.3" mathvariant="normal" xref="S3.p3.1.m1.1.1.3.cmml">
        ℓ
       </mi>
      </msubsup>
      <annotation-xml encoding="MathML-Content" id="S3.p3.1.m1.1b">
       <apply id="S3.p3.1.m1.1.1.cmml" xref="S3.p3.1.m1.1.1">
        <csymbol cd="ambiguous" id="S3.p3.1.m1.1.1.1.cmml" xref="S3.p3.1.m1.1.1">
         superscript
        </csymbol>
        <apply id="S3.p3.1.m1.1.1.2.cmml" xref="S3.p3.1.m1.1.1">
         <csymbol cd="ambiguous" id="S3.p3.1.m1.1.1.2.1.cmml" xref="S3.p3.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="S3.p3.1.m1.1.1.2.2.cmml" xref="S3.p3.1.m1.1.1.2.2">
          𝑎
         </ci>
         <ci id="S3.p3.1.m1.1.1.2.3.cmml" xref="S3.p3.1.m1.1.1.2.3">
          𝑖
         </ci>
        </apply>
        <ci id="S3.p3.1.m1.1.1.3.cmml" xref="S3.p3.1.m1.1.1.3">
         ℓ
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p3.1.m1.1c">
       a_{i}^{\ell}
      </annotation>
     </semantics>
    </math>
    and
    <math alttext="m_{i}^{\ell}" class="ltx_Math" display="inline" id="S3.p3.2.m2.1">
     <semantics id="S3.p3.2.m2.1a">
      <msubsup id="S3.p3.2.m2.1.1" xref="S3.p3.2.m2.1.1.cmml">
       <mi id="S3.p3.2.m2.1.1.2.2" xref="S3.p3.2.m2.1.1.2.2.cmml">
        m
       </mi>
       <mi id="S3.p3.2.m2.1.1.2.3" xref="S3.p3.2.m2.1.1.2.3.cmml">
        i
       </mi>
       <mi id="S3.p3.2.m2.1.1.3" mathvariant="normal" xref="S3.p3.2.m2.1.1.3.cmml">
        ℓ
       </mi>
      </msubsup>
      <annotation-xml encoding="MathML-Content" id="S3.p3.2.m2.1b">
       <apply id="S3.p3.2.m2.1.1.cmml" xref="S3.p3.2.m2.1.1">
        <csymbol cd="ambiguous" id="S3.p3.2.m2.1.1.1.cmml" xref="S3.p3.2.m2.1.1">
         superscript
        </csymbol>
        <apply id="S3.p3.2.m2.1.1.2.cmml" xref="S3.p3.2.m2.1.1">
         <csymbol cd="ambiguous" id="S3.p3.2.m2.1.1.2.1.cmml" xref="S3.p3.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S3.p3.2.m2.1.1.2.2.cmml" xref="S3.p3.2.m2.1.1.2.2">
          𝑚
         </ci>
         <ci id="S3.p3.2.m2.1.1.2.3.cmml" xref="S3.p3.2.m2.1.1.2.3">
          𝑖
         </ci>
        </apply>
        <ci id="S3.p3.2.m2.1.1.3.cmml" xref="S3.p3.2.m2.1.1.3">
         ℓ
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p3.2.m2.1c">
       m_{i}^{\ell}
      </annotation>
     </semantics>
    </math>
    represent the outputs of the MHSA and MLP sub-layers of the
    <math alttext="\ell" class="ltx_Math" display="inline" id="S3.p3.3.m3.1">
     <semantics id="S3.p3.3.m3.1a">
      <mi id="S3.p3.3.m3.1.1" mathvariant="normal" xref="S3.p3.3.m3.1.1.cmml">
       ℓ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p3.3.m3.1b">
       <ci id="S3.p3.3.m3.1.1.cmml" xref="S3.p3.3.m3.1.1">
        ℓ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p3.3.m3.1c">
       \ell
      </annotation>
     </semantics>
    </math>
    -th layer, respectively. By using
    <math alttext="E" class="ltx_Math" display="inline" id="S3.p3.4.m4.1">
     <semantics id="S3.p3.4.m4.1a">
      <mi id="S3.p3.4.m4.1.1" xref="S3.p3.4.m4.1.1.cmml">
       E
      </mi>
      <annotation-xml encoding="MathML-Content" id="S3.p3.4.m4.1b">
       <ci id="S3.p3.4.m4.1.1.cmml" xref="S3.p3.4.m4.1.1">
        𝐸
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S3.p3.4.m4.1c">
       E
      </annotation>
     </semantics>
    </math>
    , an output probability distribution can be obtained from the final layer representation:
   </p>
   <table class="ltx_equation ltx_eqn_table" id="S3.E4">
    <tbody>
     <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
      <td class="ltx_eqn_cell ltx_eqn_center_padleft">
      </td>
      <td class="ltx_eqn_cell ltx_align_center">
       <math alttext="p_{i}^{L}=\text{softmax}\,(Ex_{i}^{L})" class="ltx_Math" display="block" id="S3.E4.m1.1">
        <semantics id="S3.E4.m1.1a">
         <mrow id="S3.E4.m1.1.1" xref="S3.E4.m1.1.1.cmml">
          <msubsup id="S3.E4.m1.1.1.3" xref="S3.E4.m1.1.1.3.cmml">
           <mi id="S3.E4.m1.1.1.3.2.2" xref="S3.E4.m1.1.1.3.2.2.cmml">
            p
           </mi>
           <mi id="S3.E4.m1.1.1.3.2.3" xref="S3.E4.m1.1.1.3.2.3.cmml">
            i
           </mi>
           <mi id="S3.E4.m1.1.1.3.3" xref="S3.E4.m1.1.1.3.3.cmml">
            L
           </mi>
          </msubsup>
          <mo id="S3.E4.m1.1.1.2" xref="S3.E4.m1.1.1.2.cmml">
           =
          </mo>
          <mrow id="S3.E4.m1.1.1.1" xref="S3.E4.m1.1.1.1.cmml">
           <mtext id="S3.E4.m1.1.1.1.3" xref="S3.E4.m1.1.1.1.3a.cmml">
            softmax
           </mtext>
           <mo id="S3.E4.m1.1.1.1.2" lspace="0.170em" rspace="0em" xref="S3.E4.m1.1.1.1.2.cmml">
            ​
           </mo>
           <mrow id="S3.E4.m1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.cmml">
            <mo id="S3.E4.m1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.1.1.1.1.1.1.cmml">
             (
            </mo>
            <mrow id="S3.E4.m1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.cmml">
             <mi id="S3.E4.m1.1.1.1.1.1.1.2" xref="S3.E4.m1.1.1.1.1.1.1.2.cmml">
              E
             </mi>
             <mo id="S3.E4.m1.1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S3.E4.m1.1.1.1.1.1.1.1.cmml">
              ​
             </mo>
             <msubsup id="S3.E4.m1.1.1.1.1.1.1.3" xref="S3.E4.m1.1.1.1.1.1.1.3.cmml">
              <mi id="S3.E4.m1.1.1.1.1.1.1.3.2.2" xref="S3.E4.m1.1.1.1.1.1.1.3.2.2.cmml">
               x
              </mi>
              <mi id="S3.E4.m1.1.1.1.1.1.1.3.2.3" xref="S3.E4.m1.1.1.1.1.1.1.3.2.3.cmml">
               i
              </mi>
              <mi id="S3.E4.m1.1.1.1.1.1.1.3.3" xref="S3.E4.m1.1.1.1.1.1.1.3.3.cmml">
               L
              </mi>
             </msubsup>
            </mrow>
            <mo id="S3.E4.m1.1.1.1.1.1.3" stretchy="false" xref="S3.E4.m1.1.1.1.1.1.1.cmml">
             )
            </mo>
           </mrow>
          </mrow>
         </mrow>
         <annotation-xml encoding="MathML-Content" id="S3.E4.m1.1b">
          <apply id="S3.E4.m1.1.1.cmml" xref="S3.E4.m1.1.1">
           <eq id="S3.E4.m1.1.1.2.cmml" xref="S3.E4.m1.1.1.2">
           </eq>
           <apply id="S3.E4.m1.1.1.3.cmml" xref="S3.E4.m1.1.1.3">
            <csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.1.cmml" xref="S3.E4.m1.1.1.3">
             superscript
            </csymbol>
            <apply id="S3.E4.m1.1.1.3.2.cmml" xref="S3.E4.m1.1.1.3">
             <csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.2.1.cmml" xref="S3.E4.m1.1.1.3">
              subscript
             </csymbol>
             <ci id="S3.E4.m1.1.1.3.2.2.cmml" xref="S3.E4.m1.1.1.3.2.2">
              𝑝
             </ci>
             <ci id="S3.E4.m1.1.1.3.2.3.cmml" xref="S3.E4.m1.1.1.3.2.3">
              𝑖
             </ci>
            </apply>
            <ci id="S3.E4.m1.1.1.3.3.cmml" xref="S3.E4.m1.1.1.3.3">
             𝐿
            </ci>
           </apply>
           <apply id="S3.E4.m1.1.1.1.cmml" xref="S3.E4.m1.1.1.1">
            <times id="S3.E4.m1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.2">
            </times>
            <ci id="S3.E4.m1.1.1.1.3a.cmml" xref="S3.E4.m1.1.1.1.3">
             <mtext id="S3.E4.m1.1.1.1.3.cmml" xref="S3.E4.m1.1.1.1.3">
              softmax
             </mtext>
            </ci>
            <apply id="S3.E4.m1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1">
             <times id="S3.E4.m1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.1">
             </times>
             <ci id="S3.E4.m1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.2">
              𝐸
             </ci>
             <apply id="S3.E4.m1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3">
              <csymbol cd="ambiguous" id="S3.E4.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3">
               superscript
              </csymbol>
              <apply id="S3.E4.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3">
               <csymbol cd="ambiguous" id="S3.E4.m1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3">
                subscript
               </csymbol>
               <ci id="S3.E4.m1.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3.2.2">
                𝑥
               </ci>
               <ci id="S3.E4.m1.1.1.1.1.1.1.3.2.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3.2.3">
                𝑖
               </ci>
              </apply>
              <ci id="S3.E4.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3.3">
               𝐿
              </ci>
             </apply>
            </apply>
           </apply>
          </apply>
         </annotation-xml>
         <annotation encoding="application/x-tex" id="S3.E4.m1.1c">
          p_{i}^{L}=\text{softmax}\,(Ex_{i}^{L})
         </annotation>
        </semantics>
       </math>
      </td>
      <td class="ltx_eqn_cell ltx_eqn_center_padright">
      </td>
      <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
       <span class="ltx_tag ltx_tag_equation ltx_align_right">
        (4)
       </span>
      </td>
     </tr>
    </tbody>
   </table>
  </div>
 </section>
 <section class="ltx_section" id="S4">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    4
   </span>
   Overview of Analysis
  </h2>
  <div class="ltx_para" id="S4.p1">
   <p class="ltx_p" id="S4.p1.1">
    We analyze the look-ahead planning mechanisms of the models from two stages. (1) In the first stage, we explore the internal mechanisms of this process in planning tasks from the perspectives of information flow and component functions. We demonstrate that the middle layer MHSA can directly decode the answers to a certain extent, and we prove that MHSA mainly extracts information from spans of the goal states and recent steps (§
    <a class="ltx_ref" href="#S5" title="5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5
    </a>
    ). (2) In the second stage, to determine the presence of future decisions, we employ the probing method to examine future decisions, uncovering that the intermediate and upper layers encode these decisions. Regarding the causality of historical steps, we inhibit the information flow from past steps and analyze the effects of different historical steps on the ultimate decision (§
    <a class="ltx_ref" href="#S6" title="6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6
    </a>
    ).
   </p>
  </div>
 </section>
 <section class="ltx_section" id="S5">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    5
   </span>
   Information Flow in Planning Tasks
  </h2>
  <div class="ltx_para" id="S5.p1">
   <p class="ltx_p" id="S5.p1.1">
    To trace the source of the correct answer, we begin with the last token. For example, in the first step "pick up", the last token is "up". The model should process the initial state, target state, and history of steps to decide which color to pick up, such as "blue". We analyze this process from two perspectives. (1) First, we study MLP and MHSA functions at the last token by extraction rates
    <cite class="ltx_cite ltx_citemacro_cite">
     Geva et al. (
     <a class="ltx_ref" href="#bib.bib4" title="">
      2023
     </a>
     )
    </cite>
    . We find that the output of MHSA in the middle layers can directly decode the correct colors to a certain extent (§
    <a class="ltx_ref" href="#S5.SS1" title="5.1 Attention Extract the Answers ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5.1
    </a>
    ). (2) Based on this, we further trace the source of the correct colors by information flow
    <cite class="ltx_cite ltx_citemacro_cite">
     Wang et al. (
     <a class="ltx_ref" href="#bib.bib20" title="">
      2023
     </a>
     )
    </cite>
    . From the perspective of early and late planning stages, we prove that MHSA mainly extracts information from spans of the goal states and recent steps (§
    <a class="ltx_ref" href="#S5.SS2" title="5.2 Attention Extract from Goal and History ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     5.2
    </a>
    ).
   </p>
  </div>
  <figure class="ltx_figure" id="S5.F3">
   <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="151" id="S5.F3.g1" src="/html/2406.16033/assets/x3.png" width="461"/>
   <figcaption class="ltx_caption">
    <span class="ltx_tag ltx_tag_figure">
     Figure 3:
    </span>
    Extraction rate of different components in Llama-2-7b-chat-hf.
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="S5.F4">
   <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="151" id="S5.F4.g1" src="/html/2406.16033/assets/x4.png" width="461"/>
   <figcaption class="ltx_caption">
    <span class="ltx_tag ltx_tag_figure">
     Figure 4:
    </span>
    Extraction rate of different components in Vicuna-7b.
   </figcaption>
  </figure>
  <section class="ltx_subsection" id="S5.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.1
    </span>
    Attention Extract the Answers
   </h3>
   <div class="ltx_para" id="S5.SS1.p1">
    <p class="ltx_p" id="S5.SS1.p1.1">
     From the perspective of the model’s internal components, we analyze the functions of different components of the models. The first question is how the model extracts answers from history. We start from the position of the last token and study the roles of the MLP and MHSA components in the answer generation process. Specifically, we investigate whether different components at different layers can directly decode the final answer.
    </p>
   </div>
   <figure class="ltx_figure" id="S5.F5">
    <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="242" id="S5.F5.g1" src="/html/2406.16033/assets/x5.png" width="461"/>
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_figure">
      Figure 5:
     </span>
     Information flow of last token in Llama-2-7b-chat-hf.
    </figcaption>
   </figure>
   <section class="ltx_paragraph" id="S5.SS1.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Experiments
    </h4>
    <div class="ltx_para" id="S5.SS1.SSS0.Px1.p1">
     <p class="ltx_p" id="S5.SS1.SSS0.Px1.p1.7">
      We use the extraction rate
      <cite class="ltx_cite ltx_citemacro_cite">
       Geva et al. (
       <a class="ltx_ref" href="#bib.bib4" title="">
        2023
       </a>
       )
      </cite>
      to analyze the functions of different components. Specifically, we calculate the extraction rate:
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S5.E5">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="e^{\ast}:=argmax\left(p_{N}^{L}\right)\\
" class="ltx_Math" display="block" id="S5.E5.m1.1">
          <semantics id="S5.E5.m1.1a">
           <mrow id="S5.E5.m1.1.1" xref="S5.E5.m1.1.1.cmml">
            <msup id="S5.E5.m1.1.1.3" xref="S5.E5.m1.1.1.3.cmml">
             <mi id="S5.E5.m1.1.1.3.2" xref="S5.E5.m1.1.1.3.2.cmml">
              e
             </mi>
             <mo id="S5.E5.m1.1.1.3.3" xref="S5.E5.m1.1.1.3.3.cmml">
              ∗
             </mo>
            </msup>
            <mo id="S5.E5.m1.1.1.2" lspace="0.278em" rspace="0.278em" xref="S5.E5.m1.1.1.2.cmml">
             :=
            </mo>
            <mrow id="S5.E5.m1.1.1.1" xref="S5.E5.m1.1.1.1.cmml">
             <mi id="S5.E5.m1.1.1.1.3" xref="S5.E5.m1.1.1.1.3.cmml">
              a
             </mi>
             <mo id="S5.E5.m1.1.1.1.2" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E5.m1.1.1.1.4" xref="S5.E5.m1.1.1.1.4.cmml">
              r
             </mi>
             <mo id="S5.E5.m1.1.1.1.2a" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E5.m1.1.1.1.5" xref="S5.E5.m1.1.1.1.5.cmml">
              g
             </mi>
             <mo id="S5.E5.m1.1.1.1.2b" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E5.m1.1.1.1.6" xref="S5.E5.m1.1.1.1.6.cmml">
              m
             </mi>
             <mo id="S5.E5.m1.1.1.1.2c" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E5.m1.1.1.1.7" xref="S5.E5.m1.1.1.1.7.cmml">
              a
             </mi>
             <mo id="S5.E5.m1.1.1.1.2d" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E5.m1.1.1.1.8" xref="S5.E5.m1.1.1.1.8.cmml">
              x
             </mi>
             <mo id="S5.E5.m1.1.1.1.2e" lspace="0em" rspace="0em" xref="S5.E5.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mrow id="S5.E5.m1.1.1.1.1.1" xref="S5.E5.m1.1.1.1.1.1.1.cmml">
              <mo id="S5.E5.m1.1.1.1.1.1.2" xref="S5.E5.m1.1.1.1.1.1.1.cmml">
               (
              </mo>
              <msubsup id="S5.E5.m1.1.1.1.1.1.1" xref="S5.E5.m1.1.1.1.1.1.1.cmml">
               <mi id="S5.E5.m1.1.1.1.1.1.1.2.2" xref="S5.E5.m1.1.1.1.1.1.1.2.2.cmml">
                p
               </mi>
               <mi id="S5.E5.m1.1.1.1.1.1.1.2.3" xref="S5.E5.m1.1.1.1.1.1.1.2.3.cmml">
                N
               </mi>
               <mi id="S5.E5.m1.1.1.1.1.1.1.3" xref="S5.E5.m1.1.1.1.1.1.1.3.cmml">
                L
               </mi>
              </msubsup>
              <mo id="S5.E5.m1.1.1.1.1.1.3" xref="S5.E5.m1.1.1.1.1.1.1.cmml">
               )
              </mo>
             </mrow>
            </mrow>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S5.E5.m1.1b">
            <apply id="S5.E5.m1.1.1.cmml" xref="S5.E5.m1.1.1">
             <csymbol cd="latexml" id="S5.E5.m1.1.1.2.cmml" xref="S5.E5.m1.1.1.2">
              assign
             </csymbol>
             <apply id="S5.E5.m1.1.1.3.cmml" xref="S5.E5.m1.1.1.3">
              <csymbol cd="ambiguous" id="S5.E5.m1.1.1.3.1.cmml" xref="S5.E5.m1.1.1.3">
               superscript
              </csymbol>
              <ci id="S5.E5.m1.1.1.3.2.cmml" xref="S5.E5.m1.1.1.3.2">
               𝑒
              </ci>
              <ci id="S5.E5.m1.1.1.3.3.cmml" xref="S5.E5.m1.1.1.3.3">
               ∗
              </ci>
             </apply>
             <apply id="S5.E5.m1.1.1.1.cmml" xref="S5.E5.m1.1.1.1">
              <times id="S5.E5.m1.1.1.1.2.cmml" xref="S5.E5.m1.1.1.1.2">
              </times>
              <ci id="S5.E5.m1.1.1.1.3.cmml" xref="S5.E5.m1.1.1.1.3">
               𝑎
              </ci>
              <ci id="S5.E5.m1.1.1.1.4.cmml" xref="S5.E5.m1.1.1.1.4">
               𝑟
              </ci>
              <ci id="S5.E5.m1.1.1.1.5.cmml" xref="S5.E5.m1.1.1.1.5">
               𝑔
              </ci>
              <ci id="S5.E5.m1.1.1.1.6.cmml" xref="S5.E5.m1.1.1.1.6">
               𝑚
              </ci>
              <ci id="S5.E5.m1.1.1.1.7.cmml" xref="S5.E5.m1.1.1.1.7">
               𝑎
              </ci>
              <ci id="S5.E5.m1.1.1.1.8.cmml" xref="S5.E5.m1.1.1.1.8">
               𝑥
              </ci>
              <apply id="S5.E5.m1.1.1.1.1.1.1.cmml" xref="S5.E5.m1.1.1.1.1.1">
               <csymbol cd="ambiguous" id="S5.E5.m1.1.1.1.1.1.1.1.cmml" xref="S5.E5.m1.1.1.1.1.1">
                superscript
               </csymbol>
               <apply id="S5.E5.m1.1.1.1.1.1.1.2.cmml" xref="S5.E5.m1.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S5.E5.m1.1.1.1.1.1.1.2.1.cmml" xref="S5.E5.m1.1.1.1.1.1">
                 subscript
                </csymbol>
                <ci id="S5.E5.m1.1.1.1.1.1.1.2.2.cmml" xref="S5.E5.m1.1.1.1.1.1.1.2.2">
                 𝑝
                </ci>
                <ci id="S5.E5.m1.1.1.1.1.1.1.2.3.cmml" xref="S5.E5.m1.1.1.1.1.1.1.2.3">
                 𝑁
                </ci>
               </apply>
               <ci id="S5.E5.m1.1.1.1.1.1.1.3.cmml" xref="S5.E5.m1.1.1.1.1.1.1.3">
                𝐿
               </ci>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S5.E5.m1.1c">
            e^{\ast}:=argmax\left(p_{N}^{L}\right)\\
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (5)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
     <table class="ltx_equation ltx_eqn_table" id="S5.E6">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="\widehat{e}:=argmax\left(Eh_{N}^{\ell}\right)\\
" class="ltx_Math" display="block" id="S5.E6.m1.1">
          <semantics id="S5.E6.m1.1a">
           <mrow id="S5.E6.m1.1.1" xref="S5.E6.m1.1.1.cmml">
            <mover accent="true" id="S5.E6.m1.1.1.3" xref="S5.E6.m1.1.1.3.cmml">
             <mi id="S5.E6.m1.1.1.3.2" xref="S5.E6.m1.1.1.3.2.cmml">
              e
             </mi>
             <mo id="S5.E6.m1.1.1.3.1" xref="S5.E6.m1.1.1.3.1.cmml">
              ^
             </mo>
            </mover>
            <mo id="S5.E6.m1.1.1.2" lspace="0.278em" rspace="0.278em" xref="S5.E6.m1.1.1.2.cmml">
             :=
            </mo>
            <mrow id="S5.E6.m1.1.1.1" xref="S5.E6.m1.1.1.1.cmml">
             <mi id="S5.E6.m1.1.1.1.3" xref="S5.E6.m1.1.1.1.3.cmml">
              a
             </mi>
             <mo id="S5.E6.m1.1.1.1.2" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E6.m1.1.1.1.4" xref="S5.E6.m1.1.1.1.4.cmml">
              r
             </mi>
             <mo id="S5.E6.m1.1.1.1.2a" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E6.m1.1.1.1.5" xref="S5.E6.m1.1.1.1.5.cmml">
              g
             </mi>
             <mo id="S5.E6.m1.1.1.1.2b" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E6.m1.1.1.1.6" xref="S5.E6.m1.1.1.1.6.cmml">
              m
             </mi>
             <mo id="S5.E6.m1.1.1.1.2c" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E6.m1.1.1.1.7" xref="S5.E6.m1.1.1.1.7.cmml">
              a
             </mi>
             <mo id="S5.E6.m1.1.1.1.2d" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S5.E6.m1.1.1.1.8" xref="S5.E6.m1.1.1.1.8.cmml">
              x
             </mi>
             <mo id="S5.E6.m1.1.1.1.2e" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.2.cmml">
              ​
             </mo>
             <mrow id="S5.E6.m1.1.1.1.1.1" xref="S5.E6.m1.1.1.1.1.1.1.cmml">
              <mo id="S5.E6.m1.1.1.1.1.1.2" xref="S5.E6.m1.1.1.1.1.1.1.cmml">
               (
              </mo>
              <mrow id="S5.E6.m1.1.1.1.1.1.1" xref="S5.E6.m1.1.1.1.1.1.1.cmml">
               <mi id="S5.E6.m1.1.1.1.1.1.1.2" xref="S5.E6.m1.1.1.1.1.1.1.2.cmml">
                E
               </mi>
               <mo id="S5.E6.m1.1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S5.E6.m1.1.1.1.1.1.1.1.cmml">
                ​
               </mo>
               <msubsup id="S5.E6.m1.1.1.1.1.1.1.3" xref="S5.E6.m1.1.1.1.1.1.1.3.cmml">
                <mi id="S5.E6.m1.1.1.1.1.1.1.3.2.2" xref="S5.E6.m1.1.1.1.1.1.1.3.2.2.cmml">
                 h
                </mi>
                <mi id="S5.E6.m1.1.1.1.1.1.1.3.2.3" xref="S5.E6.m1.1.1.1.1.1.1.3.2.3.cmml">
                 N
                </mi>
                <mi id="S5.E6.m1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S5.E6.m1.1.1.1.1.1.1.3.3.cmml">
                 ℓ
                </mi>
               </msubsup>
              </mrow>
              <mo id="S5.E6.m1.1.1.1.1.1.3" xref="S5.E6.m1.1.1.1.1.1.1.cmml">
               )
              </mo>
             </mrow>
            </mrow>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S5.E6.m1.1b">
            <apply id="S5.E6.m1.1.1.cmml" xref="S5.E6.m1.1.1">
             <csymbol cd="latexml" id="S5.E6.m1.1.1.2.cmml" xref="S5.E6.m1.1.1.2">
              assign
             </csymbol>
             <apply id="S5.E6.m1.1.1.3.cmml" xref="S5.E6.m1.1.1.3">
              <ci id="S5.E6.m1.1.1.3.1.cmml" xref="S5.E6.m1.1.1.3.1">
               ^
              </ci>
              <ci id="S5.E6.m1.1.1.3.2.cmml" xref="S5.E6.m1.1.1.3.2">
               𝑒
              </ci>
             </apply>
             <apply id="S5.E6.m1.1.1.1.cmml" xref="S5.E6.m1.1.1.1">
              <times id="S5.E6.m1.1.1.1.2.cmml" xref="S5.E6.m1.1.1.1.2">
              </times>
              <ci id="S5.E6.m1.1.1.1.3.cmml" xref="S5.E6.m1.1.1.1.3">
               𝑎
              </ci>
              <ci id="S5.E6.m1.1.1.1.4.cmml" xref="S5.E6.m1.1.1.1.4">
               𝑟
              </ci>
              <ci id="S5.E6.m1.1.1.1.5.cmml" xref="S5.E6.m1.1.1.1.5">
               𝑔
              </ci>
              <ci id="S5.E6.m1.1.1.1.6.cmml" xref="S5.E6.m1.1.1.1.6">
               𝑚
              </ci>
              <ci id="S5.E6.m1.1.1.1.7.cmml" xref="S5.E6.m1.1.1.1.7">
               𝑎
              </ci>
              <ci id="S5.E6.m1.1.1.1.8.cmml" xref="S5.E6.m1.1.1.1.8">
               𝑥
              </ci>
              <apply id="S5.E6.m1.1.1.1.1.1.1.cmml" xref="S5.E6.m1.1.1.1.1.1">
               <times id="S5.E6.m1.1.1.1.1.1.1.1.cmml" xref="S5.E6.m1.1.1.1.1.1.1.1">
               </times>
               <ci id="S5.E6.m1.1.1.1.1.1.1.2.cmml" xref="S5.E6.m1.1.1.1.1.1.1.2">
                𝐸
               </ci>
               <apply id="S5.E6.m1.1.1.1.1.1.1.3.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3">
                <csymbol cd="ambiguous" id="S5.E6.m1.1.1.1.1.1.1.3.1.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3">
                 superscript
                </csymbol>
                <apply id="S5.E6.m1.1.1.1.1.1.1.3.2.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3">
                 <csymbol cd="ambiguous" id="S5.E6.m1.1.1.1.1.1.1.3.2.1.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3">
                  subscript
                 </csymbol>
                 <ci id="S5.E6.m1.1.1.1.1.1.1.3.2.2.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3.2.2">
                  ℎ
                 </ci>
                 <ci id="S5.E6.m1.1.1.1.1.1.1.3.2.3.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3.2.3">
                  𝑁
                 </ci>
                </apply>
                <ci id="S5.E6.m1.1.1.1.1.1.1.3.3.cmml" xref="S5.E6.m1.1.1.1.1.1.1.3.3">
                 ℓ
                </ci>
               </apply>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S5.E6.m1.1c">
            \widehat{e}:=argmax\left(Eh_{N}^{\ell}\right)\\
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (6)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="ltx_p" id="S5.SS1.SSS0.Px1.p1.6">
      In this equation,
      <math alttext="h" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.1.m1.1">
       <semantics id="S5.SS1.SSS0.Px1.p1.1.m1.1a">
        <mi id="S5.SS1.SSS0.Px1.p1.1.m1.1.1" xref="S5.SS1.SSS0.Px1.p1.1.m1.1.1.cmml">
         h
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.1.m1.1b">
         <ci id="S5.SS1.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.1.m1.1.1">
          ℎ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.1.m1.1c">
         h
        </annotation>
       </semantics>
      </math>
      represents the internal representation of the MLP, MHSA and layer output,
      <math alttext="N" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.2.m2.1">
       <semantics id="S5.SS1.SSS0.Px1.p1.2.m2.1a">
        <mi id="S5.SS1.SSS0.Px1.p1.2.m2.1.1" xref="S5.SS1.SSS0.Px1.p1.2.m2.1.1.cmml">
         N
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.2.m2.1b">
         <ci id="S5.SS1.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.2.m2.1.1">
          𝑁
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.2.m2.1c">
         N
        </annotation>
       </semantics>
      </math>
      is the position of the last token,
      <math alttext="\ell" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.3.m3.1">
       <semantics id="S5.SS1.SSS0.Px1.p1.3.m3.1a">
        <mi id="S5.SS1.SSS0.Px1.p1.3.m3.1.1" mathvariant="normal" xref="S5.SS1.SSS0.Px1.p1.3.m3.1.1.cmml">
         ℓ
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.3.m3.1b">
         <ci id="S5.SS1.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.3.m3.1.1">
          ℓ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.3.m3.1c">
         \ell
        </annotation>
       </semantics>
      </math>
      is the layer of models,
      <math alttext="\ell\in\left[1,L\right]" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.4.m4.2">
       <semantics id="S5.SS1.SSS0.Px1.p1.4.m4.2a">
        <mrow id="S5.SS1.SSS0.Px1.p1.4.m4.2.3" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.cmml">
         <mi id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.2" mathvariant="normal" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.2.cmml">
          ℓ
         </mi>
         <mo id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.1" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.1.cmml">
          ∈
         </mo>
         <mrow id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.2" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.1.cmml">
          <mo id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.2.1" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.1.cmml">
           [
          </mo>
          <mn id="S5.SS1.SSS0.Px1.p1.4.m4.1.1" xref="S5.SS1.SSS0.Px1.p1.4.m4.1.1.cmml">
           1
          </mn>
          <mo id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.2.2" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.1.cmml">
           ,
          </mo>
          <mi id="S5.SS1.SSS0.Px1.p1.4.m4.2.2" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.2.cmml">
           L
          </mi>
          <mo id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.2.3" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.1.cmml">
           ]
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.4.m4.2b">
         <apply id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.cmml" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3">
          <in id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.1.cmml" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.1">
          </in>
          <ci id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.2.cmml" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.2">
           ℓ
          </ci>
          <interval closure="closed" id="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.1.cmml" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.3.3.2">
           <cn id="S5.SS1.SSS0.Px1.p1.4.m4.1.1.cmml" type="integer" xref="S5.SS1.SSS0.Px1.p1.4.m4.1.1">
            1
           </cn>
           <ci id="S5.SS1.SSS0.Px1.p1.4.m4.2.2.cmml" xref="S5.SS1.SSS0.Px1.p1.4.m4.2.2">
            𝐿
           </ci>
          </interval>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.4.m4.2c">
         \ell\in\left[1,L\right]
        </annotation>
       </semantics>
      </math>
      . When
      <math alttext="e^{\ast}" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.5.m5.1">
       <semantics id="S5.SS1.SSS0.Px1.p1.5.m5.1a">
        <msup id="S5.SS1.SSS0.Px1.p1.5.m5.1.1" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1.cmml">
         <mi id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.2" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1.2.cmml">
          e
         </mi>
         <mo id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.3" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1.3.cmml">
          ∗
         </mo>
        </msup>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.5.m5.1b">
         <apply id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1">
          <csymbol cd="ambiguous" id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1">
           superscript
          </csymbol>
          <ci id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1.2">
           𝑒
          </ci>
          <ci id="S5.SS1.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="S5.SS1.SSS0.Px1.p1.5.m5.1.1.3">
           ∗
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.5.m5.1c">
         e^{\ast}
        </annotation>
       </semantics>
      </math>
      =
      <math alttext="\widehat{e}" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px1.p1.6.m6.1">
       <semantics id="S5.SS1.SSS0.Px1.p1.6.m6.1a">
        <mover accent="true" id="S5.SS1.SSS0.Px1.p1.6.m6.1.1" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1.cmml">
         <mi id="S5.SS1.SSS0.Px1.p1.6.m6.1.1.2" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1.2.cmml">
          e
         </mi>
         <mo id="S5.SS1.SSS0.Px1.p1.6.m6.1.1.1" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1.1.cmml">
          ^
         </mo>
        </mover>
        <annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px1.p1.6.m6.1b">
         <apply id="S5.SS1.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1">
          <ci id="S5.SS1.SSS0.Px1.p1.6.m6.1.1.1.cmml" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1.1">
           ^
          </ci>
          <ci id="S5.SS1.SSS0.Px1.p1.6.m6.1.1.2.cmml" xref="S5.SS1.SSS0.Px1.p1.6.m6.1.1.2">
           𝑒
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px1.p1.6.m6.1c">
         \widehat{e}
        </annotation>
       </semantics>
      </math>
      , it is considered as an extraction event. We calculate the extraction rate of the last token for each layer for each step in the Blocksworld. We then compute the mean and variance of these rates.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S5.SS1.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Results and Analysis
    </h4>
    <div class="ltx_para" id="S5.SS1.SSS0.Px2.p1">
     <p class="ltx_p" id="S5.SS1.SSS0.Px2.p1.1">
      As shown in Figure
      <a class="ltx_ref" href="#S5.F3" title="Figure 3 ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        3
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#S5.F4" title="Figure 4 ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        4
       </span>
      </a>
      , we observe that (1) MHSA has a higher extraction rate compared to MLP, indicating that attention is primarily responsible for answer extraction. (2) Layer output gradually forms a stable answer in the middle to upper layers (from the 15th layer to the 20th layer). In these layers, the extraction rate of MHSA is significantly higher than MLP, suggesting that MHSA plays a major role during the decision-making period. (3) The variance in extraction rates across different steps is smaller for MHSA compared to MLP, indicating that MHSA layers show higher consistency across different steps.
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S5.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.2
    </span>
    Attention Extract from Goal and History
   </h3>
   <div class="ltx_para" id="S5.SS2.p1">
    <p class="ltx_p" id="S5.SS2.p1.1">
     In the previous section, we discover that MHSA is responsible for extracting answers from the context, but which chunk to extract the answer from is still unclear. In this section, we decompose the input into several chunks to identify which chunk MHSA primarily relies on. We use the information flow method
     <cite class="ltx_cite ltx_citemacro_cite">
      Wang et al. (
      <a class="ltx_ref" href="#bib.bib20" title="">
       2023
      </a>
      )
     </cite>
     , first calculating the information flow at the token granularity, and then taking the average of different tokens within the same chunk to represent the information flow at the chunk granularity. This will help us locate the influence of different chunks on the last token.
    </p>
   </div>
   <section class="ltx_paragraph" id="S5.SS2.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Experiments
    </h4>
    <div class="ltx_para" id="S5.SS2.SSS0.Px1.p1">
     <p class="ltx_p" id="S5.SS2.SSS0.Px1.p1.2">
      We calculate the information flow between layers. Specifically, for the input, we divide it into different chunks, including init token (which is "Init:"), init state (which is "&lt;blue on red&gt;"), target token, target state, six history steps (For step 1, which is "step 1: pick-up white"), action prompt (pick-up or stack on-top-of) and last token. We calculate the information flow
      <math alttext="I_{token,\ell}" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p1.1.m1.2">
       <semantics id="S5.SS2.SSS0.Px1.p1.1.m1.2a">
        <msub id="S5.SS2.SSS0.Px1.p1.1.m1.2.3" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.3.cmml">
         <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.3.2" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.3.2.cmml">
          I
         </mi>
         <mrow id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.3.cmml">
          <mrow id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.cmml">
           <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.2" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.2.cmml">
            t
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.3" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.3.cmml">
            o
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1a" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.4" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.4.cmml">
            k
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1b" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.5" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.5.cmml">
            e
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1c" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.6" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.6.cmml">
            n
           </mi>
          </mrow>
          <mo id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.2" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p1.1.m1.1.1.1.1" mathvariant="normal" xref="S5.SS2.SSS0.Px1.p1.1.m1.1.1.1.1.cmml">
           ℓ
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p1.1.m1.2b">
         <apply id="S5.SS2.SSS0.Px1.p1.1.m1.2.3.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.3">
          <csymbol cd="ambiguous" id="S5.SS2.SSS0.Px1.p1.1.m1.2.3.1.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.3">
           subscript
          </csymbol>
          <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.3.2.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.3.2">
           𝐼
          </ci>
          <list id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.3.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2">
           <apply id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1">
            <times id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.1">
            </times>
            <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.2.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.2">
             𝑡
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.3.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.3">
             𝑜
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.4.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.4">
             𝑘
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.5.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.5">
             𝑒
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.6.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.2.2.2.2.1.6">
             𝑛
            </ci>
           </apply>
           <ci id="S5.SS2.SSS0.Px1.p1.1.m1.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p1.1.m1.1.1.1.1">
            ℓ
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p1.1.m1.2c">
         I_{token,\ell}
        </annotation>
       </semantics>
      </math>
      for each token at the
      <math alttext="\ell-th" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p1.2.m2.1">
       <semantics id="S5.SS2.SSS0.Px1.p1.2.m2.1a">
        <mrow id="S5.SS2.SSS0.Px1.p1.2.m2.1.1" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.cmml">
         <mi id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.2" mathvariant="normal" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml">
          ℓ
         </mi>
         <mo id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.1" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.1.cmml">
          −
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml">
          <mi id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.2" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.2.cmml">
           t
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.3" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.3.cmml">
           h
          </mi>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p1.2.m2.1b">
         <apply id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1">
          <minus id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.1">
          </minus>
          <ci id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.2">
           ℓ
          </ci>
          <apply id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3">
           <times id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.1.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.1">
           </times>
           <ci id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.2.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.2">
            𝑡
           </ci>
           <ci id="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.3.cmml" xref="S5.SS2.SSS0.Px1.p1.2.m2.1.1.3.3">
            ℎ
           </ci>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p1.2.m2.1c">
         \ell-th
        </annotation>
       </semantics>
      </math>
      layer. The specific calculation method is as follows:
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S5.E7">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="I_{token,\ell}=\left|\sum_{hd}A_{hd,l}\odot\frac{\partial L(x)}{\partial A_{h,\ell}}\right|" class="ltx_Math" display="block" id="S5.E7.m1.8">
          <semantics id="S5.E7.m1.8a">
           <mrow id="S5.E7.m1.8.8" xref="S5.E7.m1.8.8.cmml">
            <msub id="S5.E7.m1.8.8.3" xref="S5.E7.m1.8.8.3.cmml">
             <mi id="S5.E7.m1.8.8.3.2" xref="S5.E7.m1.8.8.3.2.cmml">
              I
             </mi>
             <mrow id="S5.E7.m1.2.2.2.2" xref="S5.E7.m1.2.2.2.3.cmml">
              <mrow id="S5.E7.m1.2.2.2.2.1" xref="S5.E7.m1.2.2.2.2.1.cmml">
               <mi id="S5.E7.m1.2.2.2.2.1.2" xref="S5.E7.m1.2.2.2.2.1.2.cmml">
                t
               </mi>
               <mo id="S5.E7.m1.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.E7.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E7.m1.2.2.2.2.1.3" xref="S5.E7.m1.2.2.2.2.1.3.cmml">
                o
               </mi>
               <mo id="S5.E7.m1.2.2.2.2.1.1a" lspace="0em" rspace="0em" xref="S5.E7.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E7.m1.2.2.2.2.1.4" xref="S5.E7.m1.2.2.2.2.1.4.cmml">
                k
               </mi>
               <mo id="S5.E7.m1.2.2.2.2.1.1b" lspace="0em" rspace="0em" xref="S5.E7.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E7.m1.2.2.2.2.1.5" xref="S5.E7.m1.2.2.2.2.1.5.cmml">
                e
               </mi>
               <mo id="S5.E7.m1.2.2.2.2.1.1c" lspace="0em" rspace="0em" xref="S5.E7.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E7.m1.2.2.2.2.1.6" xref="S5.E7.m1.2.2.2.2.1.6.cmml">
                n
               </mi>
              </mrow>
              <mo id="S5.E7.m1.2.2.2.2.2" xref="S5.E7.m1.2.2.2.3.cmml">
               ,
              </mo>
              <mi id="S5.E7.m1.1.1.1.1" mathvariant="normal" xref="S5.E7.m1.1.1.1.1.cmml">
               ℓ
              </mi>
             </mrow>
            </msub>
            <mo id="S5.E7.m1.8.8.2" xref="S5.E7.m1.8.8.2.cmml">
             =
            </mo>
            <mrow id="S5.E7.m1.8.8.1.1" xref="S5.E7.m1.8.8.1.2.cmml">
             <mo id="S5.E7.m1.8.8.1.1.2" xref="S5.E7.m1.8.8.1.2.1.cmml">
              |
             </mo>
             <mrow id="S5.E7.m1.8.8.1.1.1" xref="S5.E7.m1.8.8.1.1.1.cmml">
              <munder id="S5.E7.m1.8.8.1.1.1.1" xref="S5.E7.m1.8.8.1.1.1.1.cmml">
               <mo id="S5.E7.m1.8.8.1.1.1.1.2" lspace="0em" movablelimits="false" xref="S5.E7.m1.8.8.1.1.1.1.2.cmml">
                ∑
               </mo>
               <mrow id="S5.E7.m1.8.8.1.1.1.1.3" xref="S5.E7.m1.8.8.1.1.1.1.3.cmml">
                <mi id="S5.E7.m1.8.8.1.1.1.1.3.2" xref="S5.E7.m1.8.8.1.1.1.1.3.2.cmml">
                 h
                </mi>
                <mo id="S5.E7.m1.8.8.1.1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.E7.m1.8.8.1.1.1.1.3.1.cmml">
                 ​
                </mo>
                <mi id="S5.E7.m1.8.8.1.1.1.1.3.3" xref="S5.E7.m1.8.8.1.1.1.1.3.3.cmml">
                 d
                </mi>
               </mrow>
              </munder>
              <mrow id="S5.E7.m1.8.8.1.1.1.2" xref="S5.E7.m1.8.8.1.1.1.2.cmml">
               <msub id="S5.E7.m1.8.8.1.1.1.2.2" xref="S5.E7.m1.8.8.1.1.1.2.2.cmml">
                <mi id="S5.E7.m1.8.8.1.1.1.2.2.2" xref="S5.E7.m1.8.8.1.1.1.2.2.2.cmml">
                 A
                </mi>
                <mrow id="S5.E7.m1.4.4.2.2" xref="S5.E7.m1.4.4.2.3.cmml">
                 <mrow id="S5.E7.m1.4.4.2.2.1" xref="S5.E7.m1.4.4.2.2.1.cmml">
                  <mi id="S5.E7.m1.4.4.2.2.1.2" xref="S5.E7.m1.4.4.2.2.1.2.cmml">
                   h
                  </mi>
                  <mo id="S5.E7.m1.4.4.2.2.1.1" lspace="0em" rspace="0em" xref="S5.E7.m1.4.4.2.2.1.1.cmml">
                   ​
                  </mo>
                  <mi id="S5.E7.m1.4.4.2.2.1.3" xref="S5.E7.m1.4.4.2.2.1.3.cmml">
                   d
                  </mi>
                 </mrow>
                 <mo id="S5.E7.m1.4.4.2.2.2" xref="S5.E7.m1.4.4.2.3.cmml">
                  ,
                 </mo>
                 <mi id="S5.E7.m1.3.3.1.1" xref="S5.E7.m1.3.3.1.1.cmml">
                  l
                 </mi>
                </mrow>
               </msub>
               <mo id="S5.E7.m1.8.8.1.1.1.2.1" lspace="0.222em" rspace="0.222em" xref="S5.E7.m1.8.8.1.1.1.2.1.cmml">
                ⊙
               </mo>
               <mfrac id="S5.E7.m1.7.7" xref="S5.E7.m1.7.7.cmml">
                <mrow id="S5.E7.m1.5.5.1" xref="S5.E7.m1.5.5.1.cmml">
                 <mo id="S5.E7.m1.5.5.1.2" rspace="0em" xref="S5.E7.m1.5.5.1.2.cmml">
                  ∂
                 </mo>
                 <mrow id="S5.E7.m1.5.5.1.3" xref="S5.E7.m1.5.5.1.3.cmml">
                  <mi id="S5.E7.m1.5.5.1.3.2" xref="S5.E7.m1.5.5.1.3.2.cmml">
                   L
                  </mi>
                  <mo id="S5.E7.m1.5.5.1.3.1" lspace="0em" rspace="0em" xref="S5.E7.m1.5.5.1.3.1.cmml">
                   ​
                  </mo>
                  <mrow id="S5.E7.m1.5.5.1.3.3.2" xref="S5.E7.m1.5.5.1.3.cmml">
                   <mo id="S5.E7.m1.5.5.1.3.3.2.1" stretchy="false" xref="S5.E7.m1.5.5.1.3.cmml">
                    (
                   </mo>
                   <mi id="S5.E7.m1.5.5.1.1" xref="S5.E7.m1.5.5.1.1.cmml">
                    x
                   </mi>
                   <mo id="S5.E7.m1.5.5.1.3.3.2.2" stretchy="false" xref="S5.E7.m1.5.5.1.3.cmml">
                    )
                   </mo>
                  </mrow>
                 </mrow>
                </mrow>
                <mrow id="S5.E7.m1.7.7.3" xref="S5.E7.m1.7.7.3.cmml">
                 <mo id="S5.E7.m1.7.7.3.3" rspace="0em" xref="S5.E7.m1.7.7.3.3.cmml">
                  ∂
                 </mo>
                 <msub id="S5.E7.m1.7.7.3.4" xref="S5.E7.m1.7.7.3.4.cmml">
                  <mi id="S5.E7.m1.7.7.3.4.2" xref="S5.E7.m1.7.7.3.4.2.cmml">
                   A
                  </mi>
                  <mrow id="S5.E7.m1.7.7.3.2.2.4" xref="S5.E7.m1.7.7.3.2.2.3.cmml">
                   <mi id="S5.E7.m1.6.6.2.1.1.1" xref="S5.E7.m1.6.6.2.1.1.1.cmml">
                    h
                   </mi>
                   <mo id="S5.E7.m1.7.7.3.2.2.4.1" xref="S5.E7.m1.7.7.3.2.2.3.cmml">
                    ,
                   </mo>
                   <mi id="S5.E7.m1.7.7.3.2.2.2" mathvariant="normal" xref="S5.E7.m1.7.7.3.2.2.2.cmml">
                    ℓ
                   </mi>
                  </mrow>
                 </msub>
                </mrow>
               </mfrac>
              </mrow>
             </mrow>
             <mo id="S5.E7.m1.8.8.1.1.3" xref="S5.E7.m1.8.8.1.2.1.cmml">
              |
             </mo>
            </mrow>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S5.E7.m1.8b">
            <apply id="S5.E7.m1.8.8.cmml" xref="S5.E7.m1.8.8">
             <eq id="S5.E7.m1.8.8.2.cmml" xref="S5.E7.m1.8.8.2">
             </eq>
             <apply id="S5.E7.m1.8.8.3.cmml" xref="S5.E7.m1.8.8.3">
              <csymbol cd="ambiguous" id="S5.E7.m1.8.8.3.1.cmml" xref="S5.E7.m1.8.8.3">
               subscript
              </csymbol>
              <ci id="S5.E7.m1.8.8.3.2.cmml" xref="S5.E7.m1.8.8.3.2">
               𝐼
              </ci>
              <list id="S5.E7.m1.2.2.2.3.cmml" xref="S5.E7.m1.2.2.2.2">
               <apply id="S5.E7.m1.2.2.2.2.1.cmml" xref="S5.E7.m1.2.2.2.2.1">
                <times id="S5.E7.m1.2.2.2.2.1.1.cmml" xref="S5.E7.m1.2.2.2.2.1.1">
                </times>
                <ci id="S5.E7.m1.2.2.2.2.1.2.cmml" xref="S5.E7.m1.2.2.2.2.1.2">
                 𝑡
                </ci>
                <ci id="S5.E7.m1.2.2.2.2.1.3.cmml" xref="S5.E7.m1.2.2.2.2.1.3">
                 𝑜
                </ci>
                <ci id="S5.E7.m1.2.2.2.2.1.4.cmml" xref="S5.E7.m1.2.2.2.2.1.4">
                 𝑘
                </ci>
                <ci id="S5.E7.m1.2.2.2.2.1.5.cmml" xref="S5.E7.m1.2.2.2.2.1.5">
                 𝑒
                </ci>
                <ci id="S5.E7.m1.2.2.2.2.1.6.cmml" xref="S5.E7.m1.2.2.2.2.1.6">
                 𝑛
                </ci>
               </apply>
               <ci id="S5.E7.m1.1.1.1.1.cmml" xref="S5.E7.m1.1.1.1.1">
                ℓ
               </ci>
              </list>
             </apply>
             <apply id="S5.E7.m1.8.8.1.2.cmml" xref="S5.E7.m1.8.8.1.1">
              <abs id="S5.E7.m1.8.8.1.2.1.cmml" xref="S5.E7.m1.8.8.1.1.2">
              </abs>
              <apply id="S5.E7.m1.8.8.1.1.1.cmml" xref="S5.E7.m1.8.8.1.1.1">
               <apply id="S5.E7.m1.8.8.1.1.1.1.cmml" xref="S5.E7.m1.8.8.1.1.1.1">
                <csymbol cd="ambiguous" id="S5.E7.m1.8.8.1.1.1.1.1.cmml" xref="S5.E7.m1.8.8.1.1.1.1">
                 subscript
                </csymbol>
                <sum id="S5.E7.m1.8.8.1.1.1.1.2.cmml" xref="S5.E7.m1.8.8.1.1.1.1.2">
                </sum>
                <apply id="S5.E7.m1.8.8.1.1.1.1.3.cmml" xref="S5.E7.m1.8.8.1.1.1.1.3">
                 <times id="S5.E7.m1.8.8.1.1.1.1.3.1.cmml" xref="S5.E7.m1.8.8.1.1.1.1.3.1">
                 </times>
                 <ci id="S5.E7.m1.8.8.1.1.1.1.3.2.cmml" xref="S5.E7.m1.8.8.1.1.1.1.3.2">
                  ℎ
                 </ci>
                 <ci id="S5.E7.m1.8.8.1.1.1.1.3.3.cmml" xref="S5.E7.m1.8.8.1.1.1.1.3.3">
                  𝑑
                 </ci>
                </apply>
               </apply>
               <apply id="S5.E7.m1.8.8.1.1.1.2.cmml" xref="S5.E7.m1.8.8.1.1.1.2">
                <csymbol cd="latexml" id="S5.E7.m1.8.8.1.1.1.2.1.cmml" xref="S5.E7.m1.8.8.1.1.1.2.1">
                 direct-product
                </csymbol>
                <apply id="S5.E7.m1.8.8.1.1.1.2.2.cmml" xref="S5.E7.m1.8.8.1.1.1.2.2">
                 <csymbol cd="ambiguous" id="S5.E7.m1.8.8.1.1.1.2.2.1.cmml" xref="S5.E7.m1.8.8.1.1.1.2.2">
                  subscript
                 </csymbol>
                 <ci id="S5.E7.m1.8.8.1.1.1.2.2.2.cmml" xref="S5.E7.m1.8.8.1.1.1.2.2.2">
                  𝐴
                 </ci>
                 <list id="S5.E7.m1.4.4.2.3.cmml" xref="S5.E7.m1.4.4.2.2">
                  <apply id="S5.E7.m1.4.4.2.2.1.cmml" xref="S5.E7.m1.4.4.2.2.1">
                   <times id="S5.E7.m1.4.4.2.2.1.1.cmml" xref="S5.E7.m1.4.4.2.2.1.1">
                   </times>
                   <ci id="S5.E7.m1.4.4.2.2.1.2.cmml" xref="S5.E7.m1.4.4.2.2.1.2">
                    ℎ
                   </ci>
                   <ci id="S5.E7.m1.4.4.2.2.1.3.cmml" xref="S5.E7.m1.4.4.2.2.1.3">
                    𝑑
                   </ci>
                  </apply>
                  <ci id="S5.E7.m1.3.3.1.1.cmml" xref="S5.E7.m1.3.3.1.1">
                   𝑙
                  </ci>
                 </list>
                </apply>
                <apply id="S5.E7.m1.7.7.cmml" xref="S5.E7.m1.7.7">
                 <divide id="S5.E7.m1.7.7.4.cmml" xref="S5.E7.m1.7.7">
                 </divide>
                 <apply id="S5.E7.m1.5.5.1.cmml" xref="S5.E7.m1.5.5.1">
                  <partialdiff id="S5.E7.m1.5.5.1.2.cmml" xref="S5.E7.m1.5.5.1.2">
                  </partialdiff>
                  <apply id="S5.E7.m1.5.5.1.3.cmml" xref="S5.E7.m1.5.5.1.3">
                   <times id="S5.E7.m1.5.5.1.3.1.cmml" xref="S5.E7.m1.5.5.1.3.1">
                   </times>
                   <ci id="S5.E7.m1.5.5.1.3.2.cmml" xref="S5.E7.m1.5.5.1.3.2">
                    𝐿
                   </ci>
                   <ci id="S5.E7.m1.5.5.1.1.cmml" xref="S5.E7.m1.5.5.1.1">
                    𝑥
                   </ci>
                  </apply>
                 </apply>
                 <apply id="S5.E7.m1.7.7.3.cmml" xref="S5.E7.m1.7.7.3">
                  <partialdiff id="S5.E7.m1.7.7.3.3.cmml" xref="S5.E7.m1.7.7.3.3">
                  </partialdiff>
                  <apply id="S5.E7.m1.7.7.3.4.cmml" xref="S5.E7.m1.7.7.3.4">
                   <csymbol cd="ambiguous" id="S5.E7.m1.7.7.3.4.1.cmml" xref="S5.E7.m1.7.7.3.4">
                    subscript
                   </csymbol>
                   <ci id="S5.E7.m1.7.7.3.4.2.cmml" xref="S5.E7.m1.7.7.3.4.2">
                    𝐴
                   </ci>
                   <list id="S5.E7.m1.7.7.3.2.2.3.cmml" xref="S5.E7.m1.7.7.3.2.2.4">
                    <ci id="S5.E7.m1.6.6.2.1.1.1.cmml" xref="S5.E7.m1.6.6.2.1.1.1">
                     ℎ
                    </ci>
                    <ci id="S5.E7.m1.7.7.3.2.2.2.cmml" xref="S5.E7.m1.7.7.3.2.2.2">
                     ℓ
                    </ci>
                   </list>
                  </apply>
                 </apply>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S5.E7.m1.8c">
            I_{token,\ell}=\left|\sum_{hd}A_{hd,l}\odot\frac{\partial L(x)}{\partial A_{h,\ell}}\right|
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (7)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="ltx_para" id="S5.SS2.SSS0.Px1.p2">
     <p class="ltx_p" id="S5.SS2.SSS0.Px1.p2.7">
      Where
      <math alttext="A_{hd,l}" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.1.m1.2">
       <semantics id="S5.SS2.SSS0.Px1.p2.1.m1.2a">
        <msub id="S5.SS2.SSS0.Px1.p2.1.m1.2.3" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.3.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.1.m1.2.3.2" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.3.2.cmml">
          A
         </mi>
         <mrow id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.3.cmml">
          <mrow id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.cmml">
           <mi id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.2" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.2.cmml">
            h
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.3" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.3.cmml">
            d
           </mi>
          </mrow>
          <mo id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p2.1.m1.1.1.1.1" xref="S5.SS2.SSS0.Px1.p2.1.m1.1.1.1.1.cmml">
           l
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.1.m1.2b">
         <apply id="S5.SS2.SSS0.Px1.p2.1.m1.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.3">
          <csymbol cd="ambiguous" id="S5.SS2.SSS0.Px1.p2.1.m1.2.3.1.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.3">
           subscript
          </csymbol>
          <ci id="S5.SS2.SSS0.Px1.p2.1.m1.2.3.2.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.3.2">
           𝐴
          </ci>
          <list id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2">
           <apply id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1">
            <times id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.1">
            </times>
            <ci id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.2">
             ℎ
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.3.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.2.2.2.2.1.3">
             𝑑
            </ci>
           </apply>
           <ci id="S5.SS2.SSS0.Px1.p2.1.m1.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.1.m1.1.1.1.1">
            𝑙
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.1.m1.2c">
         A_{hd,l}
        </annotation>
       </semantics>
      </math>
      is the attention score of the
      <math alttext="\ell" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.2.m2.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.2.m2.1a">
        <mi id="S5.SS2.SSS0.Px1.p2.2.m2.1.1" mathvariant="normal" xref="S5.SS2.SSS0.Px1.p2.2.m2.1.1.cmml">
         ℓ
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.2.m2.1b">
         <ci id="S5.SS2.SSS0.Px1.p2.2.m2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.2.m2.1.1">
          ℓ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.2.m2.1c">
         \ell
        </annotation>
       </semantics>
      </math>
      -th layer,
      <math alttext="hd" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.3.m3.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.3.m3.1a">
        <mrow id="S5.SS2.SSS0.Px1.p2.3.m3.1.1" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.2" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.2.cmml">
          h
         </mi>
         <mo id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.1.cmml">
          ​
         </mo>
         <mi id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.3" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.3.cmml">
          d
         </mi>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.3.m3.1b">
         <apply id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1">
          <times id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.1">
          </times>
          <ci id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.2">
           ℎ
          </ci>
          <ci id="S5.SS2.SSS0.Px1.p2.3.m3.1.1.3.cmml" xref="S5.SS2.SSS0.Px1.p2.3.m3.1.1.3">
           𝑑
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.3.m3.1c">
         hd
        </annotation>
       </semantics>
      </math>
      is the
      <math alttext="hd" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.4.m4.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.4.m4.1a">
        <mrow id="S5.SS2.SSS0.Px1.p2.4.m4.1.1" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.2" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.2.cmml">
          h
         </mi>
         <mo id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.1.cmml">
          ​
         </mo>
         <mi id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.3" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.3.cmml">
          d
         </mi>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.4.m4.1b">
         <apply id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1">
          <times id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.1">
          </times>
          <ci id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.2">
           ℎ
          </ci>
          <ci id="S5.SS2.SSS0.Px1.p2.4.m4.1.1.3.cmml" xref="S5.SS2.SSS0.Px1.p2.4.m4.1.1.3">
           𝑑
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.4.m4.1c">
         hd
        </annotation>
       </semantics>
      </math>
      -th head, and
      <math alttext="L(x)" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.5.m5.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.5.m5.1a">
        <mrow id="S5.SS2.SSS0.Px1.p2.5.m5.1.2" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.2" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.2.cmml">
          L
         </mi>
         <mo id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.1.cmml">
          ​
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.3.2" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.cmml">
          <mo id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.3.2.1" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.cmml">
           (
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p2.5.m5.1.1" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.1.cmml">
           x
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.3.2.2" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.cmml">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.5.m5.1b">
         <apply id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2">
          <times id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.1.cmml" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.1">
          </times>
          <ci id="S5.SS2.SSS0.Px1.p2.5.m5.1.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.2.2">
           𝐿
          </ci>
          <ci id="S5.SS2.SSS0.Px1.p2.5.m5.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.5.m5.1.1">
           𝑥
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.5.m5.1c">
         L(x)
        </annotation>
       </semantics>
      </math>
      is the loss function. Here, we use
      <math alttext="I(i,j)" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.6.m6.2">
       <semantics id="S5.SS2.SSS0.Px1.p2.6.m6.2a">
        <mrow id="S5.SS2.SSS0.Px1.p2.6.m6.2.3" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.2" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.2.cmml">
          I
         </mi>
         <mo id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.1.cmml">
          ​
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.2" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.1.cmml">
          <mo id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.2.1" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.1.cmml">
           (
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p2.6.m6.1.1" xref="S5.SS2.SSS0.Px1.p2.6.m6.1.1.cmml">
           i
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.2.2" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.1.cmml">
           ,
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p2.6.m6.2.2" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.2.cmml">
           j
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.2.3" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.1.cmml">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.6.m6.2b">
         <apply id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3">
          <times id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.1.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.1">
          </times>
          <ci id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.2.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.2">
           𝐼
          </ci>
          <interval closure="open" id="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.1.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.3.3.2">
           <ci id="S5.SS2.SSS0.Px1.p2.6.m6.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.1.1">
            𝑖
           </ci>
           <ci id="S5.SS2.SSS0.Px1.p2.6.m6.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.6.m6.2.2">
            𝑗
           </ci>
          </interval>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.6.m6.2c">
         I(i,j)
        </annotation>
       </semantics>
      </math>
      to represent the score flowing from token j to token i. Based on the token information flow, we calculate the chunk information flow, denoted as
      <math alttext="I_{chunk,\ell}" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.7.m7.2">
       <semantics id="S5.SS2.SSS0.Px1.p2.7.m7.2a">
        <msub id="S5.SS2.SSS0.Px1.p2.7.m7.2.3" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.3.cmml">
         <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.3.2" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.3.2.cmml">
          I
         </mi>
         <mrow id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.3.cmml">
          <mrow id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.cmml">
           <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.2" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.2.cmml">
            c
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.3" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.3.cmml">
            h
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1a" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.4" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.4.cmml">
            u
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1b" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.5" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.5.cmml">
            n
           </mi>
           <mo id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1c" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1.cmml">
            ​
           </mo>
           <mi id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.6" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.6.cmml">
            k
           </mi>
          </mrow>
          <mo id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S5.SS2.SSS0.Px1.p2.7.m7.1.1.1.1" mathvariant="normal" xref="S5.SS2.SSS0.Px1.p2.7.m7.1.1.1.1.cmml">
           ℓ
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.7.m7.2b">
         <apply id="S5.SS2.SSS0.Px1.p2.7.m7.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.3">
          <csymbol cd="ambiguous" id="S5.SS2.SSS0.Px1.p2.7.m7.2.3.1.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.3">
           subscript
          </csymbol>
          <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.3.2.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.3.2">
           𝐼
          </ci>
          <list id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2">
           <apply id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1">
            <times id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.1">
            </times>
            <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.2">
             𝑐
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.3.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.3">
             ℎ
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.4.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.4">
             𝑢
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.5.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.5">
             𝑛
            </ci>
            <ci id="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.6.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.2.2.2.2.1.6">
             𝑘
            </ci>
           </apply>
           <ci id="S5.SS2.SSS0.Px1.p2.7.m7.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.7.m7.1.1.1.1">
            ℓ
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.7.m7.2c">
         I_{chunk,\ell}
        </annotation>
       </semantics>
      </math>
      :
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S5.E8">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="I_{chunk,\ell}=\frac{\sum_{i=k_{1}}^{k_{2}}\sum_{j=t_{1}}^{t_{2}}I_{token,\ell}(i,j)}{(k_{2}-k_{1}+1)(t_{2}-t_{1}+1)}" class="ltx_Math" display="block" id="S5.E8.m1.8">
          <semantics id="S5.E8.m1.8a">
           <mrow id="S5.E8.m1.8.9" xref="S5.E8.m1.8.9.cmml">
            <msub id="S5.E8.m1.8.9.2" xref="S5.E8.m1.8.9.2.cmml">
             <mi id="S5.E8.m1.8.9.2.2" xref="S5.E8.m1.8.9.2.2.cmml">
              I
             </mi>
             <mrow id="S5.E8.m1.2.2.2.2" xref="S5.E8.m1.2.2.2.3.cmml">
              <mrow id="S5.E8.m1.2.2.2.2.1" xref="S5.E8.m1.2.2.2.2.1.cmml">
               <mi id="S5.E8.m1.2.2.2.2.1.2" xref="S5.E8.m1.2.2.2.2.1.2.cmml">
                c
               </mi>
               <mo id="S5.E8.m1.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.E8.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E8.m1.2.2.2.2.1.3" xref="S5.E8.m1.2.2.2.2.1.3.cmml">
                h
               </mi>
               <mo id="S5.E8.m1.2.2.2.2.1.1a" lspace="0em" rspace="0em" xref="S5.E8.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E8.m1.2.2.2.2.1.4" xref="S5.E8.m1.2.2.2.2.1.4.cmml">
                u
               </mi>
               <mo id="S5.E8.m1.2.2.2.2.1.1b" lspace="0em" rspace="0em" xref="S5.E8.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E8.m1.2.2.2.2.1.5" xref="S5.E8.m1.2.2.2.2.1.5.cmml">
                n
               </mi>
               <mo id="S5.E8.m1.2.2.2.2.1.1c" lspace="0em" rspace="0em" xref="S5.E8.m1.2.2.2.2.1.1.cmml">
                ​
               </mo>
               <mi id="S5.E8.m1.2.2.2.2.1.6" xref="S5.E8.m1.2.2.2.2.1.6.cmml">
                k
               </mi>
              </mrow>
              <mo id="S5.E8.m1.2.2.2.2.2" xref="S5.E8.m1.2.2.2.3.cmml">
               ,
              </mo>
              <mi id="S5.E8.m1.1.1.1.1" mathvariant="normal" xref="S5.E8.m1.1.1.1.1.cmml">
               ℓ
              </mi>
             </mrow>
            </msub>
            <mo id="S5.E8.m1.8.9.1" xref="S5.E8.m1.8.9.1.cmml">
             =
            </mo>
            <mfrac id="S5.E8.m1.8.8" xref="S5.E8.m1.8.8.cmml">
             <mrow id="S5.E8.m1.6.6.4" xref="S5.E8.m1.6.6.4.cmml">
              <msubsup id="S5.E8.m1.6.6.4.5" xref="S5.E8.m1.6.6.4.5.cmml">
               <mo id="S5.E8.m1.6.6.4.5.2.2" xref="S5.E8.m1.6.6.4.5.2.2.cmml">
                ∑
               </mo>
               <mrow id="S5.E8.m1.6.6.4.5.2.3" xref="S5.E8.m1.6.6.4.5.2.3.cmml">
                <mi id="S5.E8.m1.6.6.4.5.2.3.2" xref="S5.E8.m1.6.6.4.5.2.3.2.cmml">
                 i
                </mi>
                <mo id="S5.E8.m1.6.6.4.5.2.3.1" xref="S5.E8.m1.6.6.4.5.2.3.1.cmml">
                 =
                </mo>
                <msub id="S5.E8.m1.6.6.4.5.2.3.3" xref="S5.E8.m1.6.6.4.5.2.3.3.cmml">
                 <mi id="S5.E8.m1.6.6.4.5.2.3.3.2" xref="S5.E8.m1.6.6.4.5.2.3.3.2.cmml">
                  k
                 </mi>
                 <mn id="S5.E8.m1.6.6.4.5.2.3.3.3" xref="S5.E8.m1.6.6.4.5.2.3.3.3.cmml">
                  1
                 </mn>
                </msub>
               </mrow>
               <msub id="S5.E8.m1.6.6.4.5.3" xref="S5.E8.m1.6.6.4.5.3.cmml">
                <mi id="S5.E8.m1.6.6.4.5.3.2" xref="S5.E8.m1.6.6.4.5.3.2.cmml">
                 k
                </mi>
                <mn id="S5.E8.m1.6.6.4.5.3.3" xref="S5.E8.m1.6.6.4.5.3.3.cmml">
                 2
                </mn>
               </msub>
              </msubsup>
              <mrow id="S5.E8.m1.6.6.4.6" xref="S5.E8.m1.6.6.4.6.cmml">
               <msubsup id="S5.E8.m1.6.6.4.6.1" xref="S5.E8.m1.6.6.4.6.1.cmml">
                <mo id="S5.E8.m1.6.6.4.6.1.2.2" lspace="0.167em" xref="S5.E8.m1.6.6.4.6.1.2.2.cmml">
                 ∑
                </mo>
                <mrow id="S5.E8.m1.6.6.4.6.1.2.3" xref="S5.E8.m1.6.6.4.6.1.2.3.cmml">
                 <mi id="S5.E8.m1.6.6.4.6.1.2.3.2" xref="S5.E8.m1.6.6.4.6.1.2.3.2.cmml">
                  j
                 </mi>
                 <mo id="S5.E8.m1.6.6.4.6.1.2.3.1" xref="S5.E8.m1.6.6.4.6.1.2.3.1.cmml">
                  =
                 </mo>
                 <msub id="S5.E8.m1.6.6.4.6.1.2.3.3" xref="S5.E8.m1.6.6.4.6.1.2.3.3.cmml">
                  <mi id="S5.E8.m1.6.6.4.6.1.2.3.3.2" xref="S5.E8.m1.6.6.4.6.1.2.3.3.2.cmml">
                   t
                  </mi>
                  <mn id="S5.E8.m1.6.6.4.6.1.2.3.3.3" xref="S5.E8.m1.6.6.4.6.1.2.3.3.3.cmml">
                   1
                  </mn>
                 </msub>
                </mrow>
                <msub id="S5.E8.m1.6.6.4.6.1.3" xref="S5.E8.m1.6.6.4.6.1.3.cmml">
                 <mi id="S5.E8.m1.6.6.4.6.1.3.2" xref="S5.E8.m1.6.6.4.6.1.3.2.cmml">
                  t
                 </mi>
                 <mn id="S5.E8.m1.6.6.4.6.1.3.3" xref="S5.E8.m1.6.6.4.6.1.3.3.cmml">
                  2
                 </mn>
                </msub>
               </msubsup>
               <mrow id="S5.E8.m1.6.6.4.6.2" xref="S5.E8.m1.6.6.4.6.2.cmml">
                <msub id="S5.E8.m1.6.6.4.6.2.2" xref="S5.E8.m1.6.6.4.6.2.2.cmml">
                 <mi id="S5.E8.m1.6.6.4.6.2.2.2" xref="S5.E8.m1.6.6.4.6.2.2.2.cmml">
                  I
                 </mi>
                 <mrow id="S5.E8.m1.4.4.2.2.2.2" xref="S5.E8.m1.4.4.2.2.2.3.cmml">
                  <mrow id="S5.E8.m1.4.4.2.2.2.2.1" xref="S5.E8.m1.4.4.2.2.2.2.1.cmml">
                   <mi id="S5.E8.m1.4.4.2.2.2.2.1.2" xref="S5.E8.m1.4.4.2.2.2.2.1.2.cmml">
                    t
                   </mi>
                   <mo id="S5.E8.m1.4.4.2.2.2.2.1.1" lspace="0em" rspace="0em" xref="S5.E8.m1.4.4.2.2.2.2.1.1.cmml">
                    ​
                   </mo>
                   <mi id="S5.E8.m1.4.4.2.2.2.2.1.3" xref="S5.E8.m1.4.4.2.2.2.2.1.3.cmml">
                    o
                   </mi>
                   <mo id="S5.E8.m1.4.4.2.2.2.2.1.1a" lspace="0em" rspace="0em" xref="S5.E8.m1.4.4.2.2.2.2.1.1.cmml">
                    ​
                   </mo>
                   <mi id="S5.E8.m1.4.4.2.2.2.2.1.4" xref="S5.E8.m1.4.4.2.2.2.2.1.4.cmml">
                    k
                   </mi>
                   <mo id="S5.E8.m1.4.4.2.2.2.2.1.1b" lspace="0em" rspace="0em" xref="S5.E8.m1.4.4.2.2.2.2.1.1.cmml">
                    ​
                   </mo>
                   <mi id="S5.E8.m1.4.4.2.2.2.2.1.5" xref="S5.E8.m1.4.4.2.2.2.2.1.5.cmml">
                    e
                   </mi>
                   <mo id="S5.E8.m1.4.4.2.2.2.2.1.1c" lspace="0em" rspace="0em" xref="S5.E8.m1.4.4.2.2.2.2.1.1.cmml">
                    ​
                   </mo>
                   <mi id="S5.E8.m1.4.4.2.2.2.2.1.6" xref="S5.E8.m1.4.4.2.2.2.2.1.6.cmml">
                    n
                   </mi>
                  </mrow>
                  <mo id="S5.E8.m1.4.4.2.2.2.2.2" xref="S5.E8.m1.4.4.2.2.2.3.cmml">
                   ,
                  </mo>
                  <mi id="S5.E8.m1.3.3.1.1.1.1" mathvariant="normal" xref="S5.E8.m1.3.3.1.1.1.1.cmml">
                   ℓ
                  </mi>
                 </mrow>
                </msub>
                <mo id="S5.E8.m1.6.6.4.6.2.1" lspace="0em" rspace="0em" xref="S5.E8.m1.6.6.4.6.2.1.cmml">
                 ​
                </mo>
                <mrow id="S5.E8.m1.6.6.4.6.2.3.2" xref="S5.E8.m1.6.6.4.6.2.3.1.cmml">
                 <mo id="S5.E8.m1.6.6.4.6.2.3.2.1" stretchy="false" xref="S5.E8.m1.6.6.4.6.2.3.1.cmml">
                  (
                 </mo>
                 <mi id="S5.E8.m1.5.5.3.3" xref="S5.E8.m1.5.5.3.3.cmml">
                  i
                 </mi>
                 <mo id="S5.E8.m1.6.6.4.6.2.3.2.2" xref="S5.E8.m1.6.6.4.6.2.3.1.cmml">
                  ,
                 </mo>
                 <mi id="S5.E8.m1.6.6.4.4" xref="S5.E8.m1.6.6.4.4.cmml">
                  j
                 </mi>
                 <mo id="S5.E8.m1.6.6.4.6.2.3.2.3" stretchy="false" xref="S5.E8.m1.6.6.4.6.2.3.1.cmml">
                  )
                 </mo>
                </mrow>
               </mrow>
              </mrow>
             </mrow>
             <mrow id="S5.E8.m1.8.8.6" xref="S5.E8.m1.8.8.6.cmml">
              <mrow id="S5.E8.m1.7.7.5.1.1" xref="S5.E8.m1.7.7.5.1.1.1.cmml">
               <mo id="S5.E8.m1.7.7.5.1.1.2" stretchy="false" xref="S5.E8.m1.7.7.5.1.1.1.cmml">
                (
               </mo>
               <mrow id="S5.E8.m1.7.7.5.1.1.1" xref="S5.E8.m1.7.7.5.1.1.1.cmml">
                <mrow id="S5.E8.m1.7.7.5.1.1.1.2" xref="S5.E8.m1.7.7.5.1.1.1.2.cmml">
                 <msub id="S5.E8.m1.7.7.5.1.1.1.2.2" xref="S5.E8.m1.7.7.5.1.1.1.2.2.cmml">
                  <mi id="S5.E8.m1.7.7.5.1.1.1.2.2.2" xref="S5.E8.m1.7.7.5.1.1.1.2.2.2.cmml">
                   k
                  </mi>
                  <mn id="S5.E8.m1.7.7.5.1.1.1.2.2.3" xref="S5.E8.m1.7.7.5.1.1.1.2.2.3.cmml">
                   2
                  </mn>
                 </msub>
                 <mo id="S5.E8.m1.7.7.5.1.1.1.2.1" xref="S5.E8.m1.7.7.5.1.1.1.2.1.cmml">
                  −
                 </mo>
                 <msub id="S5.E8.m1.7.7.5.1.1.1.2.3" xref="S5.E8.m1.7.7.5.1.1.1.2.3.cmml">
                  <mi id="S5.E8.m1.7.7.5.1.1.1.2.3.2" xref="S5.E8.m1.7.7.5.1.1.1.2.3.2.cmml">
                   k
                  </mi>
                  <mn id="S5.E8.m1.7.7.5.1.1.1.2.3.3" xref="S5.E8.m1.7.7.5.1.1.1.2.3.3.cmml">
                   1
                  </mn>
                 </msub>
                </mrow>
                <mo id="S5.E8.m1.7.7.5.1.1.1.1" xref="S5.E8.m1.7.7.5.1.1.1.1.cmml">
                 +
                </mo>
                <mn id="S5.E8.m1.7.7.5.1.1.1.3" xref="S5.E8.m1.7.7.5.1.1.1.3.cmml">
                 1
                </mn>
               </mrow>
               <mo id="S5.E8.m1.7.7.5.1.1.3" stretchy="false" xref="S5.E8.m1.7.7.5.1.1.1.cmml">
                )
               </mo>
              </mrow>
              <mo id="S5.E8.m1.8.8.6.3" lspace="0em" rspace="0em" xref="S5.E8.m1.8.8.6.3.cmml">
               ​
              </mo>
              <mrow id="S5.E8.m1.8.8.6.2.1" xref="S5.E8.m1.8.8.6.2.1.1.cmml">
               <mo id="S5.E8.m1.8.8.6.2.1.2" stretchy="false" xref="S5.E8.m1.8.8.6.2.1.1.cmml">
                (
               </mo>
               <mrow id="S5.E8.m1.8.8.6.2.1.1" xref="S5.E8.m1.8.8.6.2.1.1.cmml">
                <mrow id="S5.E8.m1.8.8.6.2.1.1.2" xref="S5.E8.m1.8.8.6.2.1.1.2.cmml">
                 <msub id="S5.E8.m1.8.8.6.2.1.1.2.2" xref="S5.E8.m1.8.8.6.2.1.1.2.2.cmml">
                  <mi id="S5.E8.m1.8.8.6.2.1.1.2.2.2" xref="S5.E8.m1.8.8.6.2.1.1.2.2.2.cmml">
                   t
                  </mi>
                  <mn id="S5.E8.m1.8.8.6.2.1.1.2.2.3" xref="S5.E8.m1.8.8.6.2.1.1.2.2.3.cmml">
                   2
                  </mn>
                 </msub>
                 <mo id="S5.E8.m1.8.8.6.2.1.1.2.1" xref="S5.E8.m1.8.8.6.2.1.1.2.1.cmml">
                  −
                 </mo>
                 <msub id="S5.E8.m1.8.8.6.2.1.1.2.3" xref="S5.E8.m1.8.8.6.2.1.1.2.3.cmml">
                  <mi id="S5.E8.m1.8.8.6.2.1.1.2.3.2" xref="S5.E8.m1.8.8.6.2.1.1.2.3.2.cmml">
                   t
                  </mi>
                  <mn id="S5.E8.m1.8.8.6.2.1.1.2.3.3" xref="S5.E8.m1.8.8.6.2.1.1.2.3.3.cmml">
                   1
                  </mn>
                 </msub>
                </mrow>
                <mo id="S5.E8.m1.8.8.6.2.1.1.1" xref="S5.E8.m1.8.8.6.2.1.1.1.cmml">
                 +
                </mo>
                <mn id="S5.E8.m1.8.8.6.2.1.1.3" xref="S5.E8.m1.8.8.6.2.1.1.3.cmml">
                 1
                </mn>
               </mrow>
               <mo id="S5.E8.m1.8.8.6.2.1.3" stretchy="false" xref="S5.E8.m1.8.8.6.2.1.1.cmml">
                )
               </mo>
              </mrow>
             </mrow>
            </mfrac>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S5.E8.m1.8b">
            <apply id="S5.E8.m1.8.9.cmml" xref="S5.E8.m1.8.9">
             <eq id="S5.E8.m1.8.9.1.cmml" xref="S5.E8.m1.8.9.1">
             </eq>
             <apply id="S5.E8.m1.8.9.2.cmml" xref="S5.E8.m1.8.9.2">
              <csymbol cd="ambiguous" id="S5.E8.m1.8.9.2.1.cmml" xref="S5.E8.m1.8.9.2">
               subscript
              </csymbol>
              <ci id="S5.E8.m1.8.9.2.2.cmml" xref="S5.E8.m1.8.9.2.2">
               𝐼
              </ci>
              <list id="S5.E8.m1.2.2.2.3.cmml" xref="S5.E8.m1.2.2.2.2">
               <apply id="S5.E8.m1.2.2.2.2.1.cmml" xref="S5.E8.m1.2.2.2.2.1">
                <times id="S5.E8.m1.2.2.2.2.1.1.cmml" xref="S5.E8.m1.2.2.2.2.1.1">
                </times>
                <ci id="S5.E8.m1.2.2.2.2.1.2.cmml" xref="S5.E8.m1.2.2.2.2.1.2">
                 𝑐
                </ci>
                <ci id="S5.E8.m1.2.2.2.2.1.3.cmml" xref="S5.E8.m1.2.2.2.2.1.3">
                 ℎ
                </ci>
                <ci id="S5.E8.m1.2.2.2.2.1.4.cmml" xref="S5.E8.m1.2.2.2.2.1.4">
                 𝑢
                </ci>
                <ci id="S5.E8.m1.2.2.2.2.1.5.cmml" xref="S5.E8.m1.2.2.2.2.1.5">
                 𝑛
                </ci>
                <ci id="S5.E8.m1.2.2.2.2.1.6.cmml" xref="S5.E8.m1.2.2.2.2.1.6">
                 𝑘
                </ci>
               </apply>
               <ci id="S5.E8.m1.1.1.1.1.cmml" xref="S5.E8.m1.1.1.1.1">
                ℓ
               </ci>
              </list>
             </apply>
             <apply id="S5.E8.m1.8.8.cmml" xref="S5.E8.m1.8.8">
              <divide id="S5.E8.m1.8.8.7.cmml" xref="S5.E8.m1.8.8">
              </divide>
              <apply id="S5.E8.m1.6.6.4.cmml" xref="S5.E8.m1.6.6.4">
               <apply id="S5.E8.m1.6.6.4.5.cmml" xref="S5.E8.m1.6.6.4.5">
                <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.5.1.cmml" xref="S5.E8.m1.6.6.4.5">
                 superscript
                </csymbol>
                <apply id="S5.E8.m1.6.6.4.5.2.cmml" xref="S5.E8.m1.6.6.4.5">
                 <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.5.2.1.cmml" xref="S5.E8.m1.6.6.4.5">
                  subscript
                 </csymbol>
                 <sum id="S5.E8.m1.6.6.4.5.2.2.cmml" xref="S5.E8.m1.6.6.4.5.2.2">
                 </sum>
                 <apply id="S5.E8.m1.6.6.4.5.2.3.cmml" xref="S5.E8.m1.6.6.4.5.2.3">
                  <eq id="S5.E8.m1.6.6.4.5.2.3.1.cmml" xref="S5.E8.m1.6.6.4.5.2.3.1">
                  </eq>
                  <ci id="S5.E8.m1.6.6.4.5.2.3.2.cmml" xref="S5.E8.m1.6.6.4.5.2.3.2">
                   𝑖
                  </ci>
                  <apply id="S5.E8.m1.6.6.4.5.2.3.3.cmml" xref="S5.E8.m1.6.6.4.5.2.3.3">
                   <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.5.2.3.3.1.cmml" xref="S5.E8.m1.6.6.4.5.2.3.3">
                    subscript
                   </csymbol>
                   <ci id="S5.E8.m1.6.6.4.5.2.3.3.2.cmml" xref="S5.E8.m1.6.6.4.5.2.3.3.2">
                    𝑘
                   </ci>
                   <cn id="S5.E8.m1.6.6.4.5.2.3.3.3.cmml" type="integer" xref="S5.E8.m1.6.6.4.5.2.3.3.3">
                    1
                   </cn>
                  </apply>
                 </apply>
                </apply>
                <apply id="S5.E8.m1.6.6.4.5.3.cmml" xref="S5.E8.m1.6.6.4.5.3">
                 <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.5.3.1.cmml" xref="S5.E8.m1.6.6.4.5.3">
                  subscript
                 </csymbol>
                 <ci id="S5.E8.m1.6.6.4.5.3.2.cmml" xref="S5.E8.m1.6.6.4.5.3.2">
                  𝑘
                 </ci>
                 <cn id="S5.E8.m1.6.6.4.5.3.3.cmml" type="integer" xref="S5.E8.m1.6.6.4.5.3.3">
                  2
                 </cn>
                </apply>
               </apply>
               <apply id="S5.E8.m1.6.6.4.6.cmml" xref="S5.E8.m1.6.6.4.6">
                <apply id="S5.E8.m1.6.6.4.6.1.cmml" xref="S5.E8.m1.6.6.4.6.1">
                 <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.6.1.1.cmml" xref="S5.E8.m1.6.6.4.6.1">
                  superscript
                 </csymbol>
                 <apply id="S5.E8.m1.6.6.4.6.1.2.cmml" xref="S5.E8.m1.6.6.4.6.1">
                  <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.6.1.2.1.cmml" xref="S5.E8.m1.6.6.4.6.1">
                   subscript
                  </csymbol>
                  <sum id="S5.E8.m1.6.6.4.6.1.2.2.cmml" xref="S5.E8.m1.6.6.4.6.1.2.2">
                  </sum>
                  <apply id="S5.E8.m1.6.6.4.6.1.2.3.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3">
                   <eq id="S5.E8.m1.6.6.4.6.1.2.3.1.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3.1">
                   </eq>
                   <ci id="S5.E8.m1.6.6.4.6.1.2.3.2.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3.2">
                    𝑗
                   </ci>
                   <apply id="S5.E8.m1.6.6.4.6.1.2.3.3.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3.3">
                    <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.6.1.2.3.3.1.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3.3">
                     subscript
                    </csymbol>
                    <ci id="S5.E8.m1.6.6.4.6.1.2.3.3.2.cmml" xref="S5.E8.m1.6.6.4.6.1.2.3.3.2">
                     𝑡
                    </ci>
                    <cn id="S5.E8.m1.6.6.4.6.1.2.3.3.3.cmml" type="integer" xref="S5.E8.m1.6.6.4.6.1.2.3.3.3">
                     1
                    </cn>
                   </apply>
                  </apply>
                 </apply>
                 <apply id="S5.E8.m1.6.6.4.6.1.3.cmml" xref="S5.E8.m1.6.6.4.6.1.3">
                  <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.6.1.3.1.cmml" xref="S5.E8.m1.6.6.4.6.1.3">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.6.6.4.6.1.3.2.cmml" xref="S5.E8.m1.6.6.4.6.1.3.2">
                   𝑡
                  </ci>
                  <cn id="S5.E8.m1.6.6.4.6.1.3.3.cmml" type="integer" xref="S5.E8.m1.6.6.4.6.1.3.3">
                   2
                  </cn>
                 </apply>
                </apply>
                <apply id="S5.E8.m1.6.6.4.6.2.cmml" xref="S5.E8.m1.6.6.4.6.2">
                 <times id="S5.E8.m1.6.6.4.6.2.1.cmml" xref="S5.E8.m1.6.6.4.6.2.1">
                 </times>
                 <apply id="S5.E8.m1.6.6.4.6.2.2.cmml" xref="S5.E8.m1.6.6.4.6.2.2">
                  <csymbol cd="ambiguous" id="S5.E8.m1.6.6.4.6.2.2.1.cmml" xref="S5.E8.m1.6.6.4.6.2.2">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.6.6.4.6.2.2.2.cmml" xref="S5.E8.m1.6.6.4.6.2.2.2">
                   𝐼
                  </ci>
                  <list id="S5.E8.m1.4.4.2.2.2.3.cmml" xref="S5.E8.m1.4.4.2.2.2.2">
                   <apply id="S5.E8.m1.4.4.2.2.2.2.1.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1">
                    <times id="S5.E8.m1.4.4.2.2.2.2.1.1.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.1">
                    </times>
                    <ci id="S5.E8.m1.4.4.2.2.2.2.1.2.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.2">
                     𝑡
                    </ci>
                    <ci id="S5.E8.m1.4.4.2.2.2.2.1.3.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.3">
                     𝑜
                    </ci>
                    <ci id="S5.E8.m1.4.4.2.2.2.2.1.4.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.4">
                     𝑘
                    </ci>
                    <ci id="S5.E8.m1.4.4.2.2.2.2.1.5.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.5">
                     𝑒
                    </ci>
                    <ci id="S5.E8.m1.4.4.2.2.2.2.1.6.cmml" xref="S5.E8.m1.4.4.2.2.2.2.1.6">
                     𝑛
                    </ci>
                   </apply>
                   <ci id="S5.E8.m1.3.3.1.1.1.1.cmml" xref="S5.E8.m1.3.3.1.1.1.1">
                    ℓ
                   </ci>
                  </list>
                 </apply>
                 <interval closure="open" id="S5.E8.m1.6.6.4.6.2.3.1.cmml" xref="S5.E8.m1.6.6.4.6.2.3.2">
                  <ci id="S5.E8.m1.5.5.3.3.cmml" xref="S5.E8.m1.5.5.3.3">
                   𝑖
                  </ci>
                  <ci id="S5.E8.m1.6.6.4.4.cmml" xref="S5.E8.m1.6.6.4.4">
                   𝑗
                  </ci>
                 </interval>
                </apply>
               </apply>
              </apply>
              <apply id="S5.E8.m1.8.8.6.cmml" xref="S5.E8.m1.8.8.6">
               <times id="S5.E8.m1.8.8.6.3.cmml" xref="S5.E8.m1.8.8.6.3">
               </times>
               <apply id="S5.E8.m1.7.7.5.1.1.1.cmml" xref="S5.E8.m1.7.7.5.1.1">
                <plus id="S5.E8.m1.7.7.5.1.1.1.1.cmml" xref="S5.E8.m1.7.7.5.1.1.1.1">
                </plus>
                <apply id="S5.E8.m1.7.7.5.1.1.1.2.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2">
                 <minus id="S5.E8.m1.7.7.5.1.1.1.2.1.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.1">
                 </minus>
                 <apply id="S5.E8.m1.7.7.5.1.1.1.2.2.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.2">
                  <csymbol cd="ambiguous" id="S5.E8.m1.7.7.5.1.1.1.2.2.1.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.2">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.7.7.5.1.1.1.2.2.2.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.2.2">
                   𝑘
                  </ci>
                  <cn id="S5.E8.m1.7.7.5.1.1.1.2.2.3.cmml" type="integer" xref="S5.E8.m1.7.7.5.1.1.1.2.2.3">
                   2
                  </cn>
                 </apply>
                 <apply id="S5.E8.m1.7.7.5.1.1.1.2.3.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.3">
                  <csymbol cd="ambiguous" id="S5.E8.m1.7.7.5.1.1.1.2.3.1.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.3">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.7.7.5.1.1.1.2.3.2.cmml" xref="S5.E8.m1.7.7.5.1.1.1.2.3.2">
                   𝑘
                  </ci>
                  <cn id="S5.E8.m1.7.7.5.1.1.1.2.3.3.cmml" type="integer" xref="S5.E8.m1.7.7.5.1.1.1.2.3.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <cn id="S5.E8.m1.7.7.5.1.1.1.3.cmml" type="integer" xref="S5.E8.m1.7.7.5.1.1.1.3">
                 1
                </cn>
               </apply>
               <apply id="S5.E8.m1.8.8.6.2.1.1.cmml" xref="S5.E8.m1.8.8.6.2.1">
                <plus id="S5.E8.m1.8.8.6.2.1.1.1.cmml" xref="S5.E8.m1.8.8.6.2.1.1.1">
                </plus>
                <apply id="S5.E8.m1.8.8.6.2.1.1.2.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2">
                 <minus id="S5.E8.m1.8.8.6.2.1.1.2.1.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.1">
                 </minus>
                 <apply id="S5.E8.m1.8.8.6.2.1.1.2.2.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.2">
                  <csymbol cd="ambiguous" id="S5.E8.m1.8.8.6.2.1.1.2.2.1.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.2">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.8.8.6.2.1.1.2.2.2.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.2.2">
                   𝑡
                  </ci>
                  <cn id="S5.E8.m1.8.8.6.2.1.1.2.2.3.cmml" type="integer" xref="S5.E8.m1.8.8.6.2.1.1.2.2.3">
                   2
                  </cn>
                 </apply>
                 <apply id="S5.E8.m1.8.8.6.2.1.1.2.3.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.3">
                  <csymbol cd="ambiguous" id="S5.E8.m1.8.8.6.2.1.1.2.3.1.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.3">
                   subscript
                  </csymbol>
                  <ci id="S5.E8.m1.8.8.6.2.1.1.2.3.2.cmml" xref="S5.E8.m1.8.8.6.2.1.1.2.3.2">
                   𝑡
                  </ci>
                  <cn id="S5.E8.m1.8.8.6.2.1.1.2.3.3.cmml" type="integer" xref="S5.E8.m1.8.8.6.2.1.1.2.3.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <cn id="S5.E8.m1.8.8.6.2.1.1.3.cmml" type="integer" xref="S5.E8.m1.8.8.6.2.1.1.3">
                 1
                </cn>
               </apply>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S5.E8.m1.8c">
            I_{chunk,\ell}=\frac{\sum_{i=k_{1}}^{k_{2}}\sum_{j=t_{1}}^{t_{2}}I_{token,\ell}(i,j)}{(k_{2}-k_{1}+1)(t_{2}-t_{1}+1)}
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (8)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="ltx_p" id="S5.SS2.SSS0.Px1.p2.13">
      Specifically, we consider the information flow from the span
      <math alttext="[k1,k2]" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.8.m1.2">
       <semantics id="S5.SS2.SSS0.Px1.p2.8.m1.2a">
        <mrow id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.3.cmml">
         <mo id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.3" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.3.cmml">
          [
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.cmml">
          <mi id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.2" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.2.cmml">
           k
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mn id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.3" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.3.cmml">
           1
          </mn>
         </mrow>
         <mo id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.4" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.3.cmml">
          ,
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.cmml">
          <mi id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.2.cmml">
           k
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.1.cmml">
           ​
          </mo>
          <mn id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.3" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.3.cmml">
           2
          </mn>
         </mrow>
         <mo id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.5" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.3.cmml">
          ]
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.8.m1.2b">
         <interval closure="closed" id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2">
          <apply id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1">
           <times id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.1">
           </times>
           <ci id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.2">
            𝑘
           </ci>
           <cn id="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.SSS0.Px1.p2.8.m1.1.1.1.1.3">
            1
           </cn>
          </apply>
          <apply id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2">
           <times id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.1.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.1">
           </times>
           <ci id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.2">
            𝑘
           </ci>
           <cn id="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.SSS0.Px1.p2.8.m1.2.2.2.2.3">
            2
           </cn>
          </apply>
         </interval>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.8.m1.2c">
         [k1,k2]
        </annotation>
       </semantics>
      </math>
      of a chunk
      <math alttext="k" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.9.m2.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.9.m2.1a">
        <mi id="S5.SS2.SSS0.Px1.p2.9.m2.1.1" xref="S5.SS2.SSS0.Px1.p2.9.m2.1.1.cmml">
         k
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.9.m2.1b">
         <ci id="S5.SS2.SSS0.Px1.p2.9.m2.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.9.m2.1.1">
          𝑘
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.9.m2.1c">
         k
        </annotation>
       </semantics>
      </math>
      to the span
      <math alttext="[t1,t2]" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.10.m3.2">
       <semantics id="S5.SS2.SSS0.Px1.p2.10.m3.2a">
        <mrow id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.3.cmml">
         <mo id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.3" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.3.cmml">
          [
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.cmml">
          <mi id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.2" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.2.cmml">
           t
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.1.cmml">
           ​
          </mo>
          <mn id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.3" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.3.cmml">
           1
          </mn>
         </mrow>
         <mo id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.4" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.3.cmml">
          ,
         </mo>
         <mrow id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.cmml">
          <mi id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.2" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.2.cmml">
           t
          </mi>
          <mo id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.1" lspace="0em" rspace="0em" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.1.cmml">
           ​
          </mo>
          <mn id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.3" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.3.cmml">
           2
          </mn>
         </mrow>
         <mo id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.5" stretchy="false" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.3.cmml">
          ]
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.10.m3.2b">
         <interval closure="closed" id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.3.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2">
          <apply id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1">
           <times id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.1">
           </times>
           <ci id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.2.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.2">
            𝑡
           </ci>
           <cn id="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.SSS0.Px1.p2.10.m3.1.1.1.1.3">
            1
           </cn>
          </apply>
          <apply id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2">
           <times id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.1.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.1">
           </times>
           <ci id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.2.cmml" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.2">
            𝑡
           </ci>
           <cn id="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.SSS0.Px1.p2.10.m3.2.2.2.2.3">
            2
           </cn>
          </apply>
         </interval>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.10.m3.2c">
         [t1,t2]
        </annotation>
       </semantics>
      </math>
      of another chunk
      <math alttext="t" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.11.m4.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.11.m4.1a">
        <mi id="S5.SS2.SSS0.Px1.p2.11.m4.1.1" xref="S5.SS2.SSS0.Px1.p2.11.m4.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.11.m4.1b">
         <ci id="S5.SS2.SSS0.Px1.p2.11.m4.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.11.m4.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.11.m4.1c">
         t
        </annotation>
       </semantics>
      </math>
      . We calculate the average of information flow from chunk
      <math alttext="k" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.12.m5.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.12.m5.1a">
        <mi id="S5.SS2.SSS0.Px1.p2.12.m5.1.1" xref="S5.SS2.SSS0.Px1.p2.12.m5.1.1.cmml">
         k
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.12.m5.1b">
         <ci id="S5.SS2.SSS0.Px1.p2.12.m5.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.12.m5.1.1">
          𝑘
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.12.m5.1c">
         k
        </annotation>
       </semantics>
      </math>
      to
      <math alttext="t" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px1.p2.13.m6.1">
       <semantics id="S5.SS2.SSS0.Px1.p2.13.m6.1a">
        <mi id="S5.SS2.SSS0.Px1.p2.13.m6.1.1" xref="S5.SS2.SSS0.Px1.p2.13.m6.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px1.p2.13.m6.1b">
         <ci id="S5.SS2.SSS0.Px1.p2.13.m6.1.1.cmml" xref="S5.SS2.SSS0.Px1.p2.13.m6.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px1.p2.13.m6.1c">
         t
        </annotation>
       </semantics>
      </math>
      . Due to the causal attention, we only compute the information flow for the lower triangular matrix. We calculate the chunk information flow for each prediction step.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S5.SS2.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Results and Analysis
    </h4>
    <div class="ltx_para" id="S5.SS2.SSS0.Px2.p1">
     <p class="ltx_p" id="S5.SS2.SSS0.Px2.p1.1">
      The results are shown in Figure
      <a class="ltx_ref" href="#S5.F5" title="Figure 5 ‣ 5.1 Attention Extract the Answers ‣ 5 Information Flow in Planning Tasks ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        5
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#A1.F12" title="Figure 12 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        12
       </span>
      </a>
      . The vertical axis represents the information flow from the chunk to the last token. The horizontal axis represents the information flow at layer
      <math alttext="\ell" class="ltx_Math" display="inline" id="S5.SS2.SSS0.Px2.p1.1.m1.1">
       <semantics id="S5.SS2.SSS0.Px2.p1.1.m1.1a">
        <mi id="S5.SS2.SSS0.Px2.p1.1.m1.1.1" mathvariant="normal" xref="S5.SS2.SSS0.Px2.p1.1.m1.1.1.cmml">
         ℓ
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS2.SSS0.Px2.p1.1.m1.1b">
         <ci id="S5.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S5.SS2.SSS0.Px2.p1.1.m1.1.1">
          ℓ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS2.SSS0.Px2.p1.1.m1.1c">
         \ell
        </annotation>
       </semantics>
      </math>
      . The values inside represent the scores of information flow. We calculate the information flow for six decision steps. It shows that: (1) In steps 1 to 6, the goal states are highlighted at each step. This indicates that MHSA extracts information from the goal state at each stage, demonstrating that it mainly relies on goal states. (2) Taking the step 5 as an example, history 3 and history 4 are more prominent compared to history 1 and history 2. It reveals that MHSA also mainly relies on recent history rather than earlier spans of steps.
     </p>
    </div>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S6">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    6
   </span>
   Internal Representations Encode Planning Information
  </h2>
  <div class="ltx_para" id="S6.p1">
   <p class="ltx_p" id="S6.p1.1">
    Based on the previous sections, we discover that MHSA directly extracts answers from the context, but it is still unclear what information is encoded in internal representations. In this section, we demonstrate the look-ahead capability of models from both future decisions existence and history step causality perspectives. (1) For future decisions existence, we use the probing method to probe each layer of the main positions in the context. We find that the accuracy of the current state information gradually decreases as the steps progress. We also find that the middle and upper layers encode future decisions with accuracy decreasing as planning steps increase, proving the look-ahead planning hypothesis (§
    <a class="ltx_ref" href="#S6.SS1" title="6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6.1
    </a>
    ). (2) For history step causality, we employ a method that involves setting certain information keys of MHSA to zero. We find there is still a probability of generating the correct answer by relying solely on a single step, but it’s difficult to support plan for the long-term (§
    <a class="ltx_ref" href="#S6.SS2" title="6.2 Internal Representations Facilitate Future Decision-making ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     6.2
    </a>
    ).
   </p>
  </div>
  <section class="ltx_subsection" id="S6.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.1
    </span>
    Internal Representations Encode Block States and Future Decisions
   </h3>
   <div class="ltx_para" id="S6.SS1.p1">
    <p class="ltx_p" id="S6.SS1.p1.5">
     In this section, we analyze what information is encoded in the internal representations within the information flow and how this information evolves layer by layer. We examine whether the internal representations encode two types of information
     <cite class="ltx_cite ltx_citemacro_cite">
      Li et al. (
      <a class="ltx_ref" href="#bib.bib9" title="">
       2022
      </a>
      ); Pal et al. (
      <a class="ltx_ref" href="#bib.bib12" title="">
       2023
      </a>
      )
     </cite>
     :
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.1">
      Current Block States
     </span>
     and
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.2">
      Future Decisions
     </span>
     .
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.3">
      Current Block States
     </span>
     refer to the state of the blocks at step
     <math alttext="t" class="ltx_Math" display="inline" id="S6.SS1.p1.1.m1.1">
      <semantics id="S6.SS1.p1.1.m1.1a">
       <mi id="S6.SS1.p1.1.m1.1.1" xref="S6.SS1.p1.1.m1.1.1.cmml">
        t
       </mi>
       <annotation-xml encoding="MathML-Content" id="S6.SS1.p1.1.m1.1b">
        <ci id="S6.SS1.p1.1.m1.1.1.cmml" xref="S6.SS1.p1.1.m1.1.1">
         𝑡
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS1.p1.1.m1.1c">
        t
       </annotation>
      </semantics>
     </math>
     . For example, in Figure
     <a class="ltx_ref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
      <span class="ltx_text ltx_ref_tag">
       1
      </span>
     </a>
     , when following the green path, the
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.4">
      Current Block State
     </span>
     initially starts in the
     <math alttext="S_{\text{init}}" class="ltx_Math" display="inline" id="S6.SS1.p1.2.m2.1">
      <semantics id="S6.SS1.p1.2.m2.1a">
       <msub id="S6.SS1.p1.2.m2.1.1" xref="S6.SS1.p1.2.m2.1.1.cmml">
        <mi id="S6.SS1.p1.2.m2.1.1.2" xref="S6.SS1.p1.2.m2.1.1.2.cmml">
         S
        </mi>
        <mtext id="S6.SS1.p1.2.m2.1.1.3" xref="S6.SS1.p1.2.m2.1.1.3a.cmml">
         init
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS1.p1.2.m2.1b">
        <apply id="S6.SS1.p1.2.m2.1.1.cmml" xref="S6.SS1.p1.2.m2.1.1">
         <csymbol cd="ambiguous" id="S6.SS1.p1.2.m2.1.1.1.cmml" xref="S6.SS1.p1.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS1.p1.2.m2.1.1.2.cmml" xref="S6.SS1.p1.2.m2.1.1.2">
          𝑆
         </ci>
         <ci id="S6.SS1.p1.2.m2.1.1.3a.cmml" xref="S6.SS1.p1.2.m2.1.1.3">
          <mtext id="S6.SS1.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S6.SS1.p1.2.m2.1.1.3">
           init
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS1.p1.2.m2.1c">
        S_{\text{init}}
       </annotation>
      </semantics>
     </math>
     . After executing the first and second steps, the internal representation of the
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.5">
      Current Block State
     </span>
     transitions from the
     <math alttext="S_{\text{init}}" class="ltx_Math" display="inline" id="S6.SS1.p1.3.m3.1">
      <semantics id="S6.SS1.p1.3.m3.1a">
       <msub id="S6.SS1.p1.3.m3.1.1" xref="S6.SS1.p1.3.m3.1.1.cmml">
        <mi id="S6.SS1.p1.3.m3.1.1.2" xref="S6.SS1.p1.3.m3.1.1.2.cmml">
         S
        </mi>
        <mtext id="S6.SS1.p1.3.m3.1.1.3" xref="S6.SS1.p1.3.m3.1.1.3a.cmml">
         init
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS1.p1.3.m3.1b">
        <apply id="S6.SS1.p1.3.m3.1.1.cmml" xref="S6.SS1.p1.3.m3.1.1">
         <csymbol cd="ambiguous" id="S6.SS1.p1.3.m3.1.1.1.cmml" xref="S6.SS1.p1.3.m3.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS1.p1.3.m3.1.1.2.cmml" xref="S6.SS1.p1.3.m3.1.1.2">
          𝑆
         </ci>
         <ci id="S6.SS1.p1.3.m3.1.1.3a.cmml" xref="S6.SS1.p1.3.m3.1.1.3">
          <mtext id="S6.SS1.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S6.SS1.p1.3.m3.1.1.3">
           init
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS1.p1.3.m3.1c">
        S_{\text{init}}
       </annotation>
      </semantics>
     </math>
     to
     <math alttext="S_{12}" class="ltx_Math" display="inline" id="S6.SS1.p1.4.m4.1">
      <semantics id="S6.SS1.p1.4.m4.1a">
       <msub id="S6.SS1.p1.4.m4.1.1" xref="S6.SS1.p1.4.m4.1.1.cmml">
        <mi id="S6.SS1.p1.4.m4.1.1.2" xref="S6.SS1.p1.4.m4.1.1.2.cmml">
         S
        </mi>
        <mn id="S6.SS1.p1.4.m4.1.1.3" xref="S6.SS1.p1.4.m4.1.1.3.cmml">
         12
        </mn>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS1.p1.4.m4.1b">
        <apply id="S6.SS1.p1.4.m4.1.1.cmml" xref="S6.SS1.p1.4.m4.1.1">
         <csymbol cd="ambiguous" id="S6.SS1.p1.4.m4.1.1.1.cmml" xref="S6.SS1.p1.4.m4.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS1.p1.4.m4.1.1.2.cmml" xref="S6.SS1.p1.4.m4.1.1.2">
          𝑆
         </ci>
         <cn id="S6.SS1.p1.4.m4.1.1.3.cmml" type="integer" xref="S6.SS1.p1.4.m4.1.1.3">
          12
         </cn>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS1.p1.4.m4.1c">
        S_{12}
       </annotation>
      </semantics>
     </math>
     .
     <span class="ltx_text ltx_font_italic" id="S6.SS1.p1.5.6">
      Future Decisions
     </span>
     refer to the information about future decisions at step
     <math alttext="t" class="ltx_Math" display="inline" id="S6.SS1.p1.5.m5.1">
      <semantics id="S6.SS1.p1.5.m5.1a">
       <mi id="S6.SS1.p1.5.m5.1.1" xref="S6.SS1.p1.5.m5.1.1.cmml">
        t
       </mi>
       <annotation-xml encoding="MathML-Content" id="S6.SS1.p1.5.m5.1b">
        <ci id="S6.SS1.p1.5.m5.1.1.cmml" xref="S6.SS1.p1.5.m5.1.1">
         𝑡
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS1.p1.5.m5.1c">
        t
       </annotation>
      </semantics>
     </math>
     . For example, in Figure
     <a class="ltx_ref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
      <span class="ltx_text ltx_ref_tag">
       1
      </span>
     </a>
     , when following the green path and executing the first step (blue), the question is whether the model’s internal representation already stores information about future decisions (red, yellow, blue).
    </p>
   </div>
   <figure class="ltx_figure" id="S6.F6">
    <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="269" id="S6.F6.g1" src="/html/2406.16033/assets/x6.png" width="461"/>
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_figure">
      Figure 6:
     </span>
     State probe in Llama-2-7b-chat-hf.
    </figcaption>
   </figure>
   <figure class="ltx_figure" id="S6.F7">
    <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="269" id="S6.F7.g1" src="/html/2406.16033/assets/x7.png" width="461"/>
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_figure">
      Figure 7:
     </span>
     State probe in Vicuna-7b.
    </figcaption>
   </figure>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Experiments
    </h4>
    <div class="ltx_para" id="S6.SS1.SSS0.Px1.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px1.p1.5">
      We probe internal representations of the initial state, goal state, and steps with layer
      <math alttext="\ell\in\left[1,L\right]" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.1.m1.2">
       <semantics id="S6.SS1.SSS0.Px1.p1.1.m1.2a">
        <mrow id="S6.SS1.SSS0.Px1.p1.1.m1.2.3" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.cmml">
         <mi id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.2" mathvariant="normal" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.2.cmml">
          ℓ
         </mi>
         <mo id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.1" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.1.cmml">
          ∈
         </mo>
         <mrow id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.2" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.1.cmml">
          <mo id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.2.1" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.1.cmml">
           [
          </mo>
          <mn id="S6.SS1.SSS0.Px1.p1.1.m1.1.1" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.cmml">
           1
          </mn>
          <mo id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.2.2" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.1.cmml">
           ,
          </mo>
          <mi id="S6.SS1.SSS0.Px1.p1.1.m1.2.2" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.2.cmml">
           L
          </mi>
          <mo id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.2.3" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.1.cmml">
           ]
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.1.m1.2b">
         <apply id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3">
          <in id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.1">
          </in>
          <ci id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.2">
           ℓ
          </ci>
          <interval closure="closed" id="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.3.3.2">
           <cn id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.cmml" type="integer" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1">
            1
           </cn>
           <ci id="S6.SS1.SSS0.Px1.p1.1.m1.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.2.2">
            𝐿
           </ci>
          </interval>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.1.m1.2c">
         \ell\in\left[1,L\right]
        </annotation>
       </semantics>
      </math>
      . We train linear probes and nonlinear probes for each chunk and each layer. A linear probe can be represented as
      <math alttext="p_{\theta}(x_{n}^{\ell})=\text{softmax}(Wx_{n}^{\ell})" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.2.m2.2">
       <semantics id="S6.SS1.SSS0.Px1.p1.2.m2.2a">
        <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.2.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.cmml">
         <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.cmml">
          <msub id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.cmml">
           <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.2.cmml">
            p
           </mi>
           <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.3.cmml">
            θ
           </mi>
          </msub>
          <mo id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.2" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.2.cmml">
           ​
          </mo>
          <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.cmml">
           <mo id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.2" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.cmml">
            (
           </mo>
           <msubsup id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.cmml">
            <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.2.cmml">
             x
            </mi>
            <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.3.cmml">
             n
            </mi>
            <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.3" mathvariant="normal" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.3.cmml">
             ℓ
            </mi>
           </msubsup>
           <mo id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.3" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
         <mo id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.3.cmml">
          =
         </mo>
         <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.cmml">
          <mtext id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3a.cmml">
           softmax
          </mtext>
          <mo id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.2" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.2.cmml">
           ​
          </mo>
          <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.cmml">
           <mo id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.2" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.cmml">
            (
           </mo>
           <mrow id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.cmml">
            <mi id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.2.cmml">
             W
            </mi>
            <mo id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.1" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <msubsup id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.cmml">
             <mi id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.2.cmml">
              x
             </mi>
             <mi id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.3.cmml">
              n
             </mi>
             <mi id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.3" mathvariant="normal" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.3.cmml">
              ℓ
             </mi>
            </msubsup>
           </mrow>
           <mo id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.3" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.2.m2.2b">
         <apply id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2">
          <eq id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.3">
          </eq>
          <apply id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1">
           <times id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.2">
           </times>
           <apply id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3">
            <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3">
             subscript
            </csymbol>
            <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.2">
             𝑝
            </ci>
            <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.3.3">
             𝜃
            </ci>
           </apply>
           <apply id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1">
            <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1">
             superscript
            </csymbol>
            <apply id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1">
             <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1">
              subscript
             </csymbol>
             <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.2">
              𝑥
             </ci>
             <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.2.3">
              𝑛
             </ci>
            </apply>
            <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.1.1.1.3">
             ℓ
            </ci>
           </apply>
          </apply>
          <apply id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2">
           <times id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.2">
           </times>
           <ci id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3a.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3">
            <mtext id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.3">
             softmax
            </mtext>
           </ci>
           <apply id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1">
            <times id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.1">
            </times>
            <ci id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.2">
             𝑊
            </ci>
            <apply id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3">
             <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3">
              superscript
             </csymbol>
             <apply id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3">
              <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3">
               subscript
              </csymbol>
              <ci id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.2">
               𝑥
              </ci>
              <ci id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.2.3">
               𝑛
              </ci>
             </apply>
             <ci id="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.2.2.2.1.1.1.3.3">
              ℓ
             </ci>
            </apply>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.2.m2.2c">
         p_{\theta}(x_{n}^{\ell})=\text{softmax}(Wx_{n}^{\ell})
        </annotation>
       </semantics>
      </math>
      . And a nonlinear probe can be described as
      <math alttext="p_{\theta}(x_{n}^{\ell})=\text{softmax}(W_{1}\,\text{ReLU}(W_{2}x_{n}^{\ell}))" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.3.m3.2">
       <semantics id="S6.SS1.SSS0.Px1.p1.3.m3.2a">
        <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.cmml">
         <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.cmml">
          <msub id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.cmml">
           <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.2.cmml">
            p
           </mi>
           <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.3.cmml">
            θ
           </mi>
          </msub>
          <mo id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.2" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.2.cmml">
           ​
          </mo>
          <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.cmml">
           <mo id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.2" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.cmml">
            (
           </mo>
           <msubsup id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.cmml">
            <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.2.cmml">
             x
            </mi>
            <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.3.cmml">
             n
            </mi>
            <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.3" mathvariant="normal" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.3.cmml">
             ℓ
            </mi>
           </msubsup>
           <mo id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.3" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
         <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.3.cmml">
          =
         </mo>
         <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.cmml">
          <mtext id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3a.cmml">
           softmax
          </mtext>
          <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.2" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.2.cmml">
           ​
          </mo>
          <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.cmml">
           <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.2" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.cmml">
            (
           </mo>
           <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.cmml">
            <msub id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.cmml">
             <mi id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.2.cmml">
              W
             </mi>
             <mn id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.3.cmml">
              1
             </mn>
            </msub>
            <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2.cmml">
             ​
            </mo>
            <mtext id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4a.cmml">
             ReLU
            </mtext>
            <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2a" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2.cmml">
             ​
            </mo>
            <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.cmml">
             <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.2" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.cmml">
              (
             </mo>
             <mrow id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.cmml">
              <msub id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.cmml">
               <mi id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.2.cmml">
                W
               </mi>
               <mn id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.3.cmml">
                2
               </mn>
              </msub>
              <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.1.cmml">
               ​
              </mo>
              <msubsup id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.cmml">
               <mi id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.2" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.2.cmml">
                x
               </mi>
               <mi id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.3" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.3.cmml">
                n
               </mi>
               <mi id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.3.cmml">
                ℓ
               </mi>
              </msubsup>
             </mrow>
             <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.3" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.cmml">
              )
             </mo>
            </mrow>
           </mrow>
           <mo id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.3" stretchy="false" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.3.m3.2b">
         <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2">
          <eq id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.3">
          </eq>
          <apply id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1">
           <times id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.2">
           </times>
           <apply id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3">
            <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3">
             subscript
            </csymbol>
            <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.2">
             𝑝
            </ci>
            <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.3.3">
             𝜃
            </ci>
           </apply>
           <apply id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1">
            <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1">
             superscript
            </csymbol>
            <apply id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1">
             <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1">
              subscript
             </csymbol>
             <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.2">
              𝑥
             </ci>
             <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.2.3">
              𝑛
             </ci>
            </apply>
            <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.1.1.1.1.3">
             ℓ
            </ci>
           </apply>
          </apply>
          <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2">
           <times id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.2">
           </times>
           <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3a.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3">
            <mtext id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.3">
             softmax
            </mtext>
           </ci>
           <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1">
            <times id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.2">
            </times>
            <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3">
             <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3">
              subscript
             </csymbol>
             <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.2">
              𝑊
             </ci>
             <cn id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.3.cmml" type="integer" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.3.3">
              1
             </cn>
            </apply>
            <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4a.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4">
             <mtext id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.4">
              ReLU
             </mtext>
            </ci>
            <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1">
             <times id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.1">
             </times>
             <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2">
              <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2">
               subscript
              </csymbol>
              <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.2">
               𝑊
              </ci>
              <cn id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.3.cmml" type="integer" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.2.3">
               2
              </cn>
             </apply>
             <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3">
              <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3">
               superscript
              </csymbol>
              <apply id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3">
               <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3">
                subscript
               </csymbol>
               <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.2.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.2">
                𝑥
               </ci>
               <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.2.3">
                𝑛
               </ci>
              </apply>
              <ci id="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.2.2.2.1.1.1.1.1.1.3.3">
               ℓ
              </ci>
             </apply>
            </apply>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.3.m3.2c">
         p_{\theta}(x_{n}^{\ell})=\text{softmax}(W_{1}\,\text{ReLU}(W_{2}x_{n}^{\ell}))
        </annotation>
       </semantics>
      </math>
      . Using the linear probe as an example, we consider six steps and six colors of blocks. For
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px1.p1.5.1">
       Current Block States
      </span>
      , the input to the probe is a hidden layer representation
      <math alttext="h" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.4.m4.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.4.m4.1a">
        <mi id="S6.SS1.SSS0.Px1.p1.4.m4.1.1" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.cmml">
         h
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.4.m4.1b">
         <ci id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1">
          ℎ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.4.m4.1c">
         h
        </annotation>
       </semantics>
      </math>
      of the model. The output is a 12x8 matrix representing probabilities, where 12 denotes the colors of the blocks above and below each color block, and 8 represents 6 colors plus sky and table. For
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px1.p1.5.2">
       Future Decisions
      </span>
      , the input to the probe is
      <math alttext="h" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.5.m5.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.5.m5.1a">
        <mi id="S6.SS1.SSS0.Px1.p1.5.m5.1.1" xref="S6.SS1.SSS0.Px1.p1.5.m5.1.1.cmml">
         h
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.5.m5.1b">
         <ci id="S6.SS1.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.5.m5.1.1">
          ℎ
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.5.m5.1c">
         h
        </annotation>
       </semantics>
      </math>
      . The output is six predicted colors from steps 1 to 6, we only consider future steps in our evaluation. We split the training and test sets in a 4:1 ratio for 400 samples. For the evaluation, we calculate the weighted F1 accuracy for
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px1.p1.5.3">
       Current Block States
      </span>
      and accuracy for
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px1.p1.5.4">
       Future Decisions
      </span>
      .
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Results and Analysis
    </h4>
    <div class="ltx_para" id="S6.SS1.SSS0.Px2.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px2.p1.1">
      As shown in Figure
      <a class="ltx_ref" href="#S6.F6" title="Figure 6 ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        6
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#S6.F7" title="Figure 7 ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        7
       </span>
      </a>
      , the horizontal axis represents the layers probed, while the vertical axis represents the mean accuracy of the probe test. Different colored lines represent the probed spans of states and steps. (1) We observe that as the number of layers increases, the accuracy of the probe gradually improves. This indicates that the early layers of the model are enriching the representation of the current state. (2) The black line (step 6) in the figure has a lower accuracy compared to the light blue line (step 2), demonstrating that as the planning steps progress, the models are difficult to maintain the representations of the current placement of the blocks. (3) By comparing the linear probe in Figure
      <a class="ltx_ref" href="#S6.F6" title="Figure 6 ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        6
       </span>
      </a>
      and the nonlinear probe in Figure
      <a class="ltx_ref" href="#S6.F7" title="Figure 7 ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        7
       </span>
      </a>
      , we find that both have the same trend, indicating that the model internally stores the current state in a linear manner. A similar trend in
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px2.p1.1.1">
       Future Decisions
      </span>
      is shown in Figure
      <a class="ltx_ref" href="#S6.F8" title="Figure 8 ‣ Results and Analysis ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        8
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#S6.F9" title="Figure 9 ‣ Results and Analysis ‣ 6.1 Internal Representations Encode Block States and Future Decisions ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        9
       </span>
      </a>
      for actions. It reveals that look-ahead decisions are enriched in the early layers.
     </p>
    </div>
    <figure class="ltx_figure" id="S6.F8">
     <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="269" id="S6.F8.g1" src="/html/2406.16033/assets/x8.png" width="461"/>
     <figcaption class="ltx_caption">
      <span class="ltx_tag ltx_tag_figure">
       Figure 8:
      </span>
      Action probe in Llama-2-7b-chat-hf.
     </figcaption>
    </figure>
    <figure class="ltx_figure" id="S6.F9">
     <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="269" id="S6.F9.g1" src="/html/2406.16033/assets/x9.png" width="461"/>
     <figcaption class="ltx_caption">
      <span class="ltx_tag ltx_tag_figure">
       Figure 9:
      </span>
      Action probe in Vicuna-7b.
     </figcaption>
    </figure>
   </section>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px3">
    <h4 class="ltx_title ltx_title_paragraph">
     Supplementary Analysis
    </h4>
    <div class="ltx_para" id="S6.SS1.SSS0.Px3.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px3.p1.1">
      As shown in Figure
      <a class="ltx_ref" href="#S6.F10" title="Figure 10 ‣ Experiments ‣ 6.2 Internal Representations Facilitate Future Decision-making ‣ 6 Internal Representations Encode Planning Information ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        10
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#A1.F13" title="Figure 13 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        13
       </span>
      </a>
      . They illustrate the accuracy of future decisions based on the current step. Each column represents the current step, while the rows represent the max accuracy of the probe in predicting future answers. We observe the following : (1) For the sixth row and first column, the probe can predict the future sixth step with an accuracy of 0.51 at the first step. This indicates that the model stores information about future decisions in advance, supporting the hypothesis of forward planning. (2) For each row, the values increase from left to right. For example, the accuracy in the fifth column of the sixth row is higher than that in the first column. This means the model is more certain about the output of the sixth step at the fifth step compared to the first step, demonstrating that the model has difficulty in planning over long distances. (3) The accuracy for the first column, representing the prediction accuracy for the next five steps after the initial step, shows a declining trend, indicating that the model stores future decision information in advance, supporting the hypothesis of look-ahead planning decisions existence hypothesis.
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S6.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.2
    </span>
    Internal Representations Facilitate Future Decision-making
   </h3>
   <div class="ltx_para" id="S6.SS2.p1">
    <p class="ltx_p" id="S6.SS2.p1.8">
     In this section, we further verify the causal effect of planning information at different steps. We test the causality between planning information in the previous history
     <math alttext="t_{a}" class="ltx_Math" display="inline" id="S6.SS2.p1.1.m1.1">
      <semantics id="S6.SS2.p1.1.m1.1a">
       <msub id="S6.SS2.p1.1.m1.1.1" xref="S6.SS2.p1.1.m1.1.1.cmml">
        <mi id="S6.SS2.p1.1.m1.1.1.2" xref="S6.SS2.p1.1.m1.1.1.2.cmml">
         t
        </mi>
        <mi id="S6.SS2.p1.1.m1.1.1.3" xref="S6.SS2.p1.1.m1.1.1.3.cmml">
         a
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.1.m1.1b">
        <apply id="S6.SS2.p1.1.m1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.1.m1.1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.1.m1.1.1.2.cmml" xref="S6.SS2.p1.1.m1.1.1.2">
          𝑡
         </ci>
         <ci id="S6.SS2.p1.1.m1.1.1.3.cmml" xref="S6.SS2.p1.1.m1.1.1.3">
          𝑎
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.1.m1.1c">
        t_{a}
       </annotation>
      </semantics>
     </math>
     and decisions in step
     <math alttext="t_{b}" class="ltx_Math" display="inline" id="S6.SS2.p1.2.m2.1">
      <semantics id="S6.SS2.p1.2.m2.1a">
       <msub id="S6.SS2.p1.2.m2.1.1" xref="S6.SS2.p1.2.m2.1.1.cmml">
        <mi id="S6.SS2.p1.2.m2.1.1.2" xref="S6.SS2.p1.2.m2.1.1.2.cmml">
         t
        </mi>
        <mi id="S6.SS2.p1.2.m2.1.1.3" xref="S6.SS2.p1.2.m2.1.1.3.cmml">
         b
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.2.m2.1b">
        <apply id="S6.SS2.p1.2.m2.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.2.m2.1.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.2.m2.1.1.2.cmml" xref="S6.SS2.p1.2.m2.1.1.2">
          𝑡
         </ci>
         <ci id="S6.SS2.p1.2.m2.1.1.3.cmml" xref="S6.SS2.p1.2.m2.1.1.3">
          𝑏
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.2.m2.1c">
        t_{b}
       </annotation>
      </semantics>
     </math>
     , where
     <math alttext="t_{a}&lt;t_{b}" class="ltx_Math" display="inline" id="S6.SS2.p1.3.m3.1">
      <semantics id="S6.SS2.p1.3.m3.1a">
       <mrow id="S6.SS2.p1.3.m3.1.1" xref="S6.SS2.p1.3.m3.1.1.cmml">
        <msub id="S6.SS2.p1.3.m3.1.1.2" xref="S6.SS2.p1.3.m3.1.1.2.cmml">
         <mi id="S6.SS2.p1.3.m3.1.1.2.2" xref="S6.SS2.p1.3.m3.1.1.2.2.cmml">
          t
         </mi>
         <mi id="S6.SS2.p1.3.m3.1.1.2.3" xref="S6.SS2.p1.3.m3.1.1.2.3.cmml">
          a
         </mi>
        </msub>
        <mo id="S6.SS2.p1.3.m3.1.1.1" xref="S6.SS2.p1.3.m3.1.1.1.cmml">
         &lt;
        </mo>
        <msub id="S6.SS2.p1.3.m3.1.1.3" xref="S6.SS2.p1.3.m3.1.1.3.cmml">
         <mi id="S6.SS2.p1.3.m3.1.1.3.2" xref="S6.SS2.p1.3.m3.1.1.3.2.cmml">
          t
         </mi>
         <mi id="S6.SS2.p1.3.m3.1.1.3.3" xref="S6.SS2.p1.3.m3.1.1.3.3.cmml">
          b
         </mi>
        </msub>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.3.m3.1b">
        <apply id="S6.SS2.p1.3.m3.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1">
         <lt id="S6.SS2.p1.3.m3.1.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1.1">
         </lt>
         <apply id="S6.SS2.p1.3.m3.1.1.2.cmml" xref="S6.SS2.p1.3.m3.1.1.2">
          <csymbol cd="ambiguous" id="S6.SS2.p1.3.m3.1.1.2.1.cmml" xref="S6.SS2.p1.3.m3.1.1.2">
           subscript
          </csymbol>
          <ci id="S6.SS2.p1.3.m3.1.1.2.2.cmml" xref="S6.SS2.p1.3.m3.1.1.2.2">
           𝑡
          </ci>
          <ci id="S6.SS2.p1.3.m3.1.1.2.3.cmml" xref="S6.SS2.p1.3.m3.1.1.2.3">
           𝑎
          </ci>
         </apply>
         <apply id="S6.SS2.p1.3.m3.1.1.3.cmml" xref="S6.SS2.p1.3.m3.1.1.3">
          <csymbol cd="ambiguous" id="S6.SS2.p1.3.m3.1.1.3.1.cmml" xref="S6.SS2.p1.3.m3.1.1.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.p1.3.m3.1.1.3.2.cmml" xref="S6.SS2.p1.3.m3.1.1.3.2">
           𝑡
          </ci>
          <ci id="S6.SS2.p1.3.m3.1.1.3.3.cmml" xref="S6.SS2.p1.3.m3.1.1.3.3">
           𝑏
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.3.m3.1c">
        t_{a}&lt;t_{b}
       </annotation>
      </semantics>
     </math>
     . Specifically, we compare whether the information from step
     <math alttext="t_{1}" class="ltx_Math" display="inline" id="S6.SS2.p1.4.m4.1">
      <semantics id="S6.SS2.p1.4.m4.1a">
       <msub id="S6.SS2.p1.4.m4.1.1" xref="S6.SS2.p1.4.m4.1.1.cmml">
        <mi id="S6.SS2.p1.4.m4.1.1.2" xref="S6.SS2.p1.4.m4.1.1.2.cmml">
         t
        </mi>
        <mn id="S6.SS2.p1.4.m4.1.1.3" xref="S6.SS2.p1.4.m4.1.1.3.cmml">
         1
        </mn>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.4.m4.1b">
        <apply id="S6.SS2.p1.4.m4.1.1.cmml" xref="S6.SS2.p1.4.m4.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.4.m4.1.1.1.cmml" xref="S6.SS2.p1.4.m4.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.4.m4.1.1.2.cmml" xref="S6.SS2.p1.4.m4.1.1.2">
          𝑡
         </ci>
         <cn id="S6.SS2.p1.4.m4.1.1.3.cmml" type="integer" xref="S6.SS2.p1.4.m4.1.1.3">
          1
         </cn>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.4.m4.1c">
        t_{1}
       </annotation>
      </semantics>
     </math>
     contributes to the planning in step
     <math alttext="t_{2}" class="ltx_Math" display="inline" id="S6.SS2.p1.5.m5.1">
      <semantics id="S6.SS2.p1.5.m5.1a">
       <msub id="S6.SS2.p1.5.m5.1.1" xref="S6.SS2.p1.5.m5.1.1.cmml">
        <mi id="S6.SS2.p1.5.m5.1.1.2" xref="S6.SS2.p1.5.m5.1.1.2.cmml">
         t
        </mi>
        <mn id="S6.SS2.p1.5.m5.1.1.3" xref="S6.SS2.p1.5.m5.1.1.3.cmml">
         2
        </mn>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.5.m5.1b">
        <apply id="S6.SS2.p1.5.m5.1.1.cmml" xref="S6.SS2.p1.5.m5.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.5.m5.1.1.1.cmml" xref="S6.SS2.p1.5.m5.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.5.m5.1.1.2.cmml" xref="S6.SS2.p1.5.m5.1.1.2">
          𝑡
         </ci>
         <cn id="S6.SS2.p1.5.m5.1.1.3.cmml" type="integer" xref="S6.SS2.p1.5.m5.1.1.3">
          2
         </cn>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.5.m5.1c">
        t_{2}
       </annotation>
      </semantics>
     </math>
     . If the model is greedy in its planning, there should be no decision information in
     <math alttext="t_{a}" class="ltx_Math" display="inline" id="S6.SS2.p1.6.m6.1">
      <semantics id="S6.SS2.p1.6.m6.1a">
       <msub id="S6.SS2.p1.6.m6.1.1" xref="S6.SS2.p1.6.m6.1.1.cmml">
        <mi id="S6.SS2.p1.6.m6.1.1.2" xref="S6.SS2.p1.6.m6.1.1.2.cmml">
         t
        </mi>
        <mi id="S6.SS2.p1.6.m6.1.1.3" xref="S6.SS2.p1.6.m6.1.1.3.cmml">
         a
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.6.m6.1b">
        <apply id="S6.SS2.p1.6.m6.1.1.cmml" xref="S6.SS2.p1.6.m6.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.6.m6.1.1.1.cmml" xref="S6.SS2.p1.6.m6.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.6.m6.1.1.2.cmml" xref="S6.SS2.p1.6.m6.1.1.2">
          𝑡
         </ci>
         <ci id="S6.SS2.p1.6.m6.1.1.3.cmml" xref="S6.SS2.p1.6.m6.1.1.3">
          𝑎
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.6.m6.1c">
        t_{a}
       </annotation>
      </semantics>
     </math>
     that can help make better decisions in
     <math alttext="t_{b}" class="ltx_Math" display="inline" id="S6.SS2.p1.7.m7.1">
      <semantics id="S6.SS2.p1.7.m7.1a">
       <msub id="S6.SS2.p1.7.m7.1.1" xref="S6.SS2.p1.7.m7.1.1.cmml">
        <mi id="S6.SS2.p1.7.m7.1.1.2" xref="S6.SS2.p1.7.m7.1.1.2.cmml">
         t
        </mi>
        <mi id="S6.SS2.p1.7.m7.1.1.3" xref="S6.SS2.p1.7.m7.1.1.3.cmml">
         b
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.7.m7.1b">
        <apply id="S6.SS2.p1.7.m7.1.1.cmml" xref="S6.SS2.p1.7.m7.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.7.m7.1.1.1.cmml" xref="S6.SS2.p1.7.m7.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.7.m7.1.1.2.cmml" xref="S6.SS2.p1.7.m7.1.1.2">
          𝑡
         </ci>
         <ci id="S6.SS2.p1.7.m7.1.1.3.cmml" xref="S6.SS2.p1.7.m7.1.1.3">
          𝑏
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.7.m7.1c">
        t_{b}
       </annotation>
      </semantics>
     </math>
     . Therefore, we set the key of MHSA in historical decision
     <math alttext="t" class="ltx_Math" display="inline" id="S6.SS2.p1.8.m8.1">
      <semantics id="S6.SS2.p1.8.m8.1a">
       <mi id="S6.SS2.p1.8.m8.1.1" xref="S6.SS2.p1.8.m8.1.1.cmml">
        t
       </mi>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.8.m8.1b">
        <ci id="S6.SS2.p1.8.m8.1.1.cmml" xref="S6.SS2.p1.8.m8.1.1">
         𝑡
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.8.m8.1c">
        t
       </annotation>
      </semantics>
     </math>
     to 0 to study the causal effect of historical information on future predictions.
    </p>
   </div>
   <section class="ltx_paragraph" id="S6.SS2.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Experiments
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS0.Px1.p1">
     <p class="ltx_p" id="S6.SS2.SSS0.Px1.p1.3">
      For each step
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.1.m1.1a">
        <mi id="S6.SS2.SSS0.Px1.p1.1.m1.1.1" xref="S6.SS2.SSS0.Px1.p1.1.m1.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.1.m1.1b">
         <ci id="S6.SS2.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.1.m1.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.1.m1.1c">
         t
        </annotation>
       </semantics>
      </math>
      , we have a history
      <math alttext="H_{t}=[a_{1},a_{2},...,a_{t-1}]" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.2.m2.4">
       <semantics id="S6.SS2.SSS0.Px1.p1.2.m2.4a">
        <mrow id="S6.SS2.SSS0.Px1.p1.2.m2.4.4" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.cmml">
         <msub id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.2.cmml">
           H
          </mi>
          <mi id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.3.cmml">
           t
          </mi>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.4" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.4.cmml">
          =
         </mo>
         <mrow id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
          <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.4" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
           [
          </mo>
          <msub id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml">
            a
           </mi>
           <mn id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml">
            1
           </mn>
          </msub>
          <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.5" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
           ,
          </mo>
          <msub id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml">
            a
           </mi>
           <mn id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml">
            2
           </mn>
          </msub>
          <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.6" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p1.2.m2.1.1" mathvariant="normal" xref="S6.SS2.SSS0.Px1.p1.2.m2.1.1.cmml">
           …
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.7" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
           ,
          </mo>
          <msub id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml">
            a
           </mi>
           <mrow id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml">
            <mi id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2.cmml">
             t
            </mi>
            <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1.cmml">
             −
            </mo>
            <mn id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3.cmml">
             1
            </mn>
           </mrow>
          </msub>
          <mo id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.8" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">
           ]
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.2.m2.4b">
         <apply id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4">
          <eq id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.4.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.4">
          </eq>
          <apply id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.3.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.5.3">
            𝑡
           </ci>
          </apply>
          <list id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.4.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3">
           <apply id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.2">
             𝑎
            </ci>
            <cn id="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml" type="integer" xref="S6.SS2.SSS0.Px1.p1.2.m2.2.2.1.1.1.3">
             1
            </cn>
           </apply>
           <apply id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.2">
             𝑎
            </ci>
            <cn id="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml" type="integer" xref="S6.SS2.SSS0.Px1.p1.2.m2.3.3.2.2.2.3">
             2
            </cn>
           </apply>
           <ci id="S6.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.1.1">
            …
           </ci>
           <apply id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.2">
             𝑎
            </ci>
            <apply id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3">
             <minus id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1">
             </minus>
             <ci id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2">
              𝑡
             </ci>
             <cn id="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3.cmml" type="integer" xref="S6.SS2.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3">
              1
             </cn>
            </apply>
           </apply>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.2.m2.4c">
         H_{t}=[a_{1},a_{2},...,a_{t-1}]
        </annotation>
       </semantics>
      </math>
      , where each step span
      <math alttext="a_{i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.3.m3.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.3.m3.1.1" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.2" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml">
          a
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.3" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml">
          i
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.3.m3.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.2">
           𝑎
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.3">
           𝑖
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.3.m3.1c">
         a_{i}
        </annotation>
       </semantics>
      </math>
      contains color tokens.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS0.Px1.p2">
     <p class="ltx_p" id="S6.SS2.SSS0.Px1.p2.5">
      (1) Mask all steps: First, identify all color tokens in
      <math alttext="H_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p2.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px1.p2.1.m1.1a">
        <msub id="S6.SS2.SSS0.Px1.p2.1.m1.1.1" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.2" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1.2.cmml">
          H
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.3" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1.3.cmml">
          t
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p2.1.m1.1b">
         <apply id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1.2">
           𝐻
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p2.1.m1.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p2.1.m1.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p2.1.m1.1c">
         H_{t}
        </annotation>
       </semantics>
      </math>
      , and set the keys to 0 for these colors in each layer of MHSA, resulting in the masked historical information
      <math alttext="H^{\prime}_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p2.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px1.p2.2.m2.1a">
        <msubsup id="S6.SS2.SSS0.Px1.p2.2.m2.1.1" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.2" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.2.cmml">
          H
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.3" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.3.cmml">
          t
         </mi>
         <mo id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.3" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.3.cmml">
          ′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p2.2.m2.1b">
         <apply id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.1.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.2.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.3.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.2.3">
            ′
           </ci>
          </apply>
          <ci id="S6.SS2.SSS0.Px1.p2.2.m2.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p2.2.m2.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p2.2.m2.1c">
         H^{\prime}_{t}
        </annotation>
       </semantics>
      </math>
      . The main goal is to stop past decision information from affecting the current decision of the last token. Obtain the decision probability
      <math alttext="y^{\prime}_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p2.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px1.p2.3.m3.1a">
        <msubsup id="S6.SS2.SSS0.Px1.p2.3.m3.1.1" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.2" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.2.cmml">
          y
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.3" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.3.cmml">
          t
         </mi>
         <mo id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.3" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.3.cmml">
          ′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p2.3.m3.1b">
         <apply id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.1.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.2.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.2">
            𝑦
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.3.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.2.3">
            ′
           </ci>
          </apply>
          <ci id="S6.SS2.SSS0.Px1.p2.3.m3.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p2.3.m3.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p2.3.m3.1c">
         y^{\prime}_{t}
        </annotation>
       </semantics>
      </math>
      based on
      <math alttext="H^{\prime}_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p2.4.m4.1">
       <semantics id="S6.SS2.SSS0.Px1.p2.4.m4.1a">
        <msubsup id="S6.SS2.SSS0.Px1.p2.4.m4.1.1" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.2" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.2.cmml">
          H
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.3" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.3.cmml">
          t
         </mi>
         <mo id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.3" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.3.cmml">
          ′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p2.4.m4.1b">
         <apply id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.1.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.2.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.3.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.2.3">
            ′
           </ci>
          </apply>
          <ci id="S6.SS2.SSS0.Px1.p2.4.m4.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p2.4.m4.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p2.4.m4.1c">
         H^{\prime}_{t}
        </annotation>
       </semantics>
      </math>
      in
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p2.5.m5.1">
       <semantics id="S6.SS2.SSS0.Px1.p2.5.m5.1a">
        <mi id="S6.SS2.SSS0.Px1.p2.5.m5.1.1" xref="S6.SS2.SSS0.Px1.p2.5.m5.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p2.5.m5.1b">
         <ci id="S6.SS2.SSS0.Px1.p2.5.m5.1.1.cmml" xref="S6.SS2.SSS0.Px1.p2.5.m5.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p2.5.m5.1c">
         t
        </annotation>
       </semantics>
      </math>
      step.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS0.Px1.p3">
     <p class="ltx_p" id="S6.SS2.SSS0.Px1.p3.5">
      (2) Make one step visible: Based on
      <math alttext="H^{\prime}_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p3.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px1.p3.1.m1.1a">
        <msubsup id="S6.SS2.SSS0.Px1.p3.1.m1.1.1" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.2" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.2.cmml">
          H
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.3" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.3.cmml">
          t
         </mi>
         <mo id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.3" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.3.cmml">
          ′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p3.1.m1.1b">
         <apply id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.1.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.2.3">
            ′
           </ci>
          </apply>
          <ci id="S6.SS2.SSS0.Px1.p3.1.m1.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p3.1.m1.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p3.1.m1.1c">
         H^{\prime}_{t}
        </annotation>
       </semantics>
      </math>
      , make only the color at position
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p3.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px1.p3.2.m2.1a">
        <mi id="S6.SS2.SSS0.Px1.p3.2.m2.1.1" xref="S6.SS2.SSS0.Px1.p3.2.m2.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p3.2.m2.1b">
         <ci id="S6.SS2.SSS0.Px1.p3.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.2.m2.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p3.2.m2.1c">
         i
        </annotation>
       </semantics>
      </math>
      visible, while masking the other positions, resulting in
      <math alttext="H^{\prime\prime}_{t,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p3.3.m3.2">
       <semantics id="S6.SS2.SSS0.Px1.p3.3.m3.2a">
        <msubsup id="S6.SS2.SSS0.Px1.p3.3.m3.2.3" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.2" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.2.cmml">
          H
         </mi>
         <mrow id="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.4" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p3.3.m3.1.1.1.1" xref="S6.SS2.SSS0.Px1.p3.3.m3.1.1.1.1.cmml">
           t
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.2" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
         <mo id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.3" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.3.cmml">
          ′′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p3.3.m3.2b">
         <apply id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.1.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.1.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.3.2.3">
            ′′
           </ci>
          </apply>
          <list id="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px1.p3.3.m3.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.1.1.1.1">
            𝑡
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.3.m3.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p3.3.m3.2c">
         H^{\prime\prime}_{t,i}
        </annotation>
       </semantics>
      </math>
      . Use
      <math alttext="H^{\prime\prime}_{t,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p3.4.m4.2">
       <semantics id="S6.SS2.SSS0.Px1.p3.4.m4.2a">
        <msubsup id="S6.SS2.SSS0.Px1.p3.4.m4.2.3" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.2" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.2.cmml">
          H
         </mi>
         <mrow id="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.4" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p3.4.m4.1.1.1.1" xref="S6.SS2.SSS0.Px1.p3.4.m4.1.1.1.1.cmml">
           t
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.2" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
         <mo id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.3" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.3.cmml">
          ′′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p3.4.m4.2b">
         <apply id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.1.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.1.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.2">
            𝐻
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.3.2.3">
            ′′
           </ci>
          </apply>
          <list id="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px1.p3.4.m4.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.1.1.1.1">
            𝑡
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.4.m4.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p3.4.m4.2c">
         H^{\prime\prime}_{t,i}
        </annotation>
       </semantics>
      </math>
      for prediction, Obtain the decision probability
      <math alttext="y^{\prime\prime}_{t,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p3.5.m5.2">
       <semantics id="S6.SS2.SSS0.Px1.p3.5.m5.2a">
        <msubsup id="S6.SS2.SSS0.Px1.p3.5.m5.2.3" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.2" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.2.cmml">
          y
         </mi>
         <mrow id="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.4" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p3.5.m5.1.1.1.1" xref="S6.SS2.SSS0.Px1.p3.5.m5.1.1.1.1.cmml">
           t
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.2" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
         <mo id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.3" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.3.cmml">
          ′′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p3.5.m5.2b">
         <apply id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.1.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3">
           subscript
          </csymbol>
          <apply id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.1.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3">
            superscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.2">
            𝑦
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.3.2.3">
            ′′
           </ci>
          </apply>
          <list id="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px1.p3.5.m5.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.1.1.1.1">
            𝑡
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p3.5.m5.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p3.5.m5.2c">
         y^{\prime\prime}_{t,i}
        </annotation>
       </semantics>
      </math>
      .
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS0.Px1.p4">
     <p class="ltx_p" id="S6.SS2.SSS0.Px1.p4.2">
      (3) Calculate one step effect: Compare the decision probabilities obtained from masking all steps and from making one step visible to calculate the effect of a single step. The larger this value, the greater the impact of step
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p4.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px1.p4.1.m1.1a">
        <mi id="S6.SS2.SSS0.Px1.p4.1.m1.1.1" xref="S6.SS2.SSS0.Px1.p4.1.m1.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p4.1.m1.1b">
         <ci id="S6.SS2.SSS0.Px1.p4.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p4.1.m1.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p4.1.m1.1c">
         i
        </annotation>
       </semantics>
      </math>
      on step
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p4.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px1.p4.2.m2.1a">
        <mi id="S6.SS2.SSS0.Px1.p4.2.m2.1.1" xref="S6.SS2.SSS0.Px1.p4.2.m2.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p4.2.m2.1b">
         <ci id="S6.SS2.SSS0.Px1.p4.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px1.p4.2.m2.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p4.2.m2.1c">
         t
        </annotation>
       </semantics>
      </math>
      :
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S6.E9">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="\text{Impact}_{i,t}=y^{\prime\prime}_{t,i}-y^{\prime}_{t}" class="ltx_Math" display="block" id="S6.E9.m1.4">
          <semantics id="S6.E9.m1.4a">
           <mrow id="S6.E9.m1.4.5" xref="S6.E9.m1.4.5.cmml">
            <msub id="S6.E9.m1.4.5.2" xref="S6.E9.m1.4.5.2.cmml">
             <mtext id="S6.E9.m1.4.5.2.2" xref="S6.E9.m1.4.5.2.2a.cmml">
              Impact
             </mtext>
             <mrow id="S6.E9.m1.2.2.2.4" xref="S6.E9.m1.2.2.2.3.cmml">
              <mi id="S6.E9.m1.1.1.1.1" xref="S6.E9.m1.1.1.1.1.cmml">
               i
              </mi>
              <mo id="S6.E9.m1.2.2.2.4.1" xref="S6.E9.m1.2.2.2.3.cmml">
               ,
              </mo>
              <mi id="S6.E9.m1.2.2.2.2" xref="S6.E9.m1.2.2.2.2.cmml">
               t
              </mi>
             </mrow>
            </msub>
            <mo id="S6.E9.m1.4.5.1" xref="S6.E9.m1.4.5.1.cmml">
             =
            </mo>
            <mrow id="S6.E9.m1.4.5.3" xref="S6.E9.m1.4.5.3.cmml">
             <msubsup id="S6.E9.m1.4.5.3.2" xref="S6.E9.m1.4.5.3.2.cmml">
              <mi id="S6.E9.m1.4.5.3.2.2.2" xref="S6.E9.m1.4.5.3.2.2.2.cmml">
               y
              </mi>
              <mrow id="S6.E9.m1.4.4.2.4" xref="S6.E9.m1.4.4.2.3.cmml">
               <mi id="S6.E9.m1.3.3.1.1" xref="S6.E9.m1.3.3.1.1.cmml">
                t
               </mi>
               <mo id="S6.E9.m1.4.4.2.4.1" xref="S6.E9.m1.4.4.2.3.cmml">
                ,
               </mo>
               <mi id="S6.E9.m1.4.4.2.2" xref="S6.E9.m1.4.4.2.2.cmml">
                i
               </mi>
              </mrow>
              <mo id="S6.E9.m1.4.5.3.2.2.3" xref="S6.E9.m1.4.5.3.2.2.3.cmml">
               ′′
              </mo>
             </msubsup>
             <mo id="S6.E9.m1.4.5.3.1" xref="S6.E9.m1.4.5.3.1.cmml">
              −
             </mo>
             <msubsup id="S6.E9.m1.4.5.3.3" xref="S6.E9.m1.4.5.3.3.cmml">
              <mi id="S6.E9.m1.4.5.3.3.2.2" xref="S6.E9.m1.4.5.3.3.2.2.cmml">
               y
              </mi>
              <mi id="S6.E9.m1.4.5.3.3.3" xref="S6.E9.m1.4.5.3.3.3.cmml">
               t
              </mi>
              <mo id="S6.E9.m1.4.5.3.3.2.3" xref="S6.E9.m1.4.5.3.3.2.3.cmml">
               ′
              </mo>
             </msubsup>
            </mrow>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.E9.m1.4b">
            <apply id="S6.E9.m1.4.5.cmml" xref="S6.E9.m1.4.5">
             <eq id="S6.E9.m1.4.5.1.cmml" xref="S6.E9.m1.4.5.1">
             </eq>
             <apply id="S6.E9.m1.4.5.2.cmml" xref="S6.E9.m1.4.5.2">
              <csymbol cd="ambiguous" id="S6.E9.m1.4.5.2.1.cmml" xref="S6.E9.m1.4.5.2">
               subscript
              </csymbol>
              <ci id="S6.E9.m1.4.5.2.2a.cmml" xref="S6.E9.m1.4.5.2.2">
               <mtext id="S6.E9.m1.4.5.2.2.cmml" xref="S6.E9.m1.4.5.2.2">
                Impact
               </mtext>
              </ci>
              <list id="S6.E9.m1.2.2.2.3.cmml" xref="S6.E9.m1.2.2.2.4">
               <ci id="S6.E9.m1.1.1.1.1.cmml" xref="S6.E9.m1.1.1.1.1">
                𝑖
               </ci>
               <ci id="S6.E9.m1.2.2.2.2.cmml" xref="S6.E9.m1.2.2.2.2">
                𝑡
               </ci>
              </list>
             </apply>
             <apply id="S6.E9.m1.4.5.3.cmml" xref="S6.E9.m1.4.5.3">
              <minus id="S6.E9.m1.4.5.3.1.cmml" xref="S6.E9.m1.4.5.3.1">
              </minus>
              <apply id="S6.E9.m1.4.5.3.2.cmml" xref="S6.E9.m1.4.5.3.2">
               <csymbol cd="ambiguous" id="S6.E9.m1.4.5.3.2.1.cmml" xref="S6.E9.m1.4.5.3.2">
                subscript
               </csymbol>
               <apply id="S6.E9.m1.4.5.3.2.2.cmml" xref="S6.E9.m1.4.5.3.2">
                <csymbol cd="ambiguous" id="S6.E9.m1.4.5.3.2.2.1.cmml" xref="S6.E9.m1.4.5.3.2">
                 superscript
                </csymbol>
                <ci id="S6.E9.m1.4.5.3.2.2.2.cmml" xref="S6.E9.m1.4.5.3.2.2.2">
                 𝑦
                </ci>
                <ci id="S6.E9.m1.4.5.3.2.2.3.cmml" xref="S6.E9.m1.4.5.3.2.2.3">
                 ′′
                </ci>
               </apply>
               <list id="S6.E9.m1.4.4.2.3.cmml" xref="S6.E9.m1.4.4.2.4">
                <ci id="S6.E9.m1.3.3.1.1.cmml" xref="S6.E9.m1.3.3.1.1">
                 𝑡
                </ci>
                <ci id="S6.E9.m1.4.4.2.2.cmml" xref="S6.E9.m1.4.4.2.2">
                 𝑖
                </ci>
               </list>
              </apply>
              <apply id="S6.E9.m1.4.5.3.3.cmml" xref="S6.E9.m1.4.5.3.3">
               <csymbol cd="ambiguous" id="S6.E9.m1.4.5.3.3.1.cmml" xref="S6.E9.m1.4.5.3.3">
                subscript
               </csymbol>
               <apply id="S6.E9.m1.4.5.3.3.2.cmml" xref="S6.E9.m1.4.5.3.3">
                <csymbol cd="ambiguous" id="S6.E9.m1.4.5.3.3.2.1.cmml" xref="S6.E9.m1.4.5.3.3">
                 superscript
                </csymbol>
                <ci id="S6.E9.m1.4.5.3.3.2.2.cmml" xref="S6.E9.m1.4.5.3.3.2.2">
                 𝑦
                </ci>
                <ci id="S6.E9.m1.4.5.3.3.2.3.cmml" xref="S6.E9.m1.4.5.3.3.2.3">
                 ′
                </ci>
               </apply>
               <ci id="S6.E9.m1.4.5.3.3.3.cmml" xref="S6.E9.m1.4.5.3.3.3">
                𝑡
               </ci>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.E9.m1.4c">
            \text{Impact}_{i,t}=y^{\prime\prime}_{t,i}-y^{\prime}_{t}
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (9)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <figure class="ltx_figure" id="S6.F10">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="S6.F10.g1" src="/html/2406.16033/assets/x10.png" width="368"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       Figure 10:
      </span>
      Future action linear probe in Llama-2-7b-chat-hf.
     </figcaption>
    </figure>
   </section>
   <section class="ltx_paragraph" id="S6.SS2.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Results and Analysis
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS0.Px2.p1">
     <p class="ltx_p" id="S6.SS2.SSS0.Px2.p1.2">
      As illustrated in the Figure
      <a class="ltx_ref" href="#S7.F11" title="Figure 11 ‣ Mechanistic Interpretability ‣ 7 Related work ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        11
       </span>
      </a>
      and Figure
      <a class="ltx_ref" href="#A1.F16" title="Figure 16 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
       <span class="ltx_text ltx_ref_tag">
        16
       </span>
      </a>
      , the columns represent the steps visible during prediction, the rows represent the steps being predicted, and the values inside represent the contribution of step
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.1.m1.1a">
        <mi id="S6.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S6.SS2.SSS0.Px2.p1.1.m1.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.1.m1.1b">
         <ci id="S6.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.1.m1.1c">
         t
        </annotation>
       </semantics>
      </math>
      to step
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.2.m2.1a">
        <mi id="S6.SS2.SSS0.Px2.p1.2.m2.1.1" xref="S6.SS2.SSS0.Px2.p1.2.m2.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.2.m2.1b">
         <ci id="S6.SS2.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.2.m2.1c">
         i
        </annotation>
       </semantics>
      </math>
      . (1) For example, in the second column of the sixth row, the model can increase the probability of inferring the correct decision in the sixth step by 0.24 just by using the information from the second step. This indicates that the model is not greedy and is not limited to only preparing for the next step, which causally proves the conclusion of look-ahead planning. (2) Observing the values in each column, for instance, the maximum value in the fifth row is 0.46, located in the third column. This represents that the third step is the most important for predicting the fifth step. It is found that the most important steps for prediction tend to be later steps, indicating that the look-ahead planning ability of LLMs is still relatively preliminary.
     </p>
    </div>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S7">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    7
   </span>
   Related work
  </h2>
  <section class="ltx_paragraph" id="S7.SS0.SSS0.Px1">
   <h4 class="ltx_title ltx_title_paragraph">
    LLM-Based Agents
   </h4>
   <div class="ltx_para" id="S7.SS0.SSS0.Px1.p1">
    <p class="ltx_p" id="S7.SS0.SSS0.Px1.p1.1">
     With the emergence of large language models, researchers begin to use them as intelligent agents
     <cite class="ltx_cite ltx_citemacro_cite">
      Xi et al. (
      <a class="ltx_ref" href="#bib.bib26" title="">
       2023
      </a>
      ); Wang et al. (
      <a class="ltx_ref" href="#bib.bib21" title="">
       2024a
      </a>
      )
     </cite>
     . Significantly, ReAct
     <cite class="ltx_cite ltx_citemacro_cite">
      Yao et al. (
      <a class="ltx_ref" href="#bib.bib30" title="">
       2022
      </a>
      )
     </cite>
     innovatively combines CoT reasoning with agent actions. Some tasks utilize the planning capabilities of large language models through prompt engineering methods
     <cite class="ltx_cite ltx_citemacro_cite">
      Huang et al. (
      <a class="ltx_ref" href="#bib.bib6" title="">
       2022
      </a>
      ); Hao et al. (
      <a class="ltx_ref" href="#bib.bib5" title="">
       2023
      </a>
      ); Yao et al. (
      <a class="ltx_ref" href="#bib.bib29" title="">
       2024
      </a>
      ); Zhang et al. (
      <a class="ltx_ref" href="#bib.bib33" title="">
       2024
      </a>
      )
     </cite>
     . Other researchers enhance the planning capabilities of large language models through fine-tuning methods
     <cite class="ltx_cite ltx_citemacro_cite">
      Zeng et al. (
      <a class="ltx_ref" href="#bib.bib32" title="">
       2023
      </a>
      ); Yu et al. (
      <a class="ltx_ref" href="#bib.bib31" title="">
       2024
      </a>
      )
     </cite>
     . Some researchers construct benchmarks to evaluate the planning ability of large language models
     <cite class="ltx_cite ltx_citemacro_cite">
      Shridhar et al. (
      <a class="ltx_ref" href="#bib.bib14" title="">
       2020
      </a>
      ); Wang et al. (
      <a class="ltx_ref" href="#bib.bib22" title="">
       2022
      </a>
      ); Zhou et al. (
      <a class="ltx_ref" href="#bib.bib35" title="">
       2023
      </a>
      ); Deng et al. (
      <a class="ltx_ref" href="#bib.bib3" title="">
       2024
      </a>
      ); Xu et al. (
      <a class="ltx_ref" href="#bib.bib28" title="">
       2023
      </a>
      ); Qin et al. (
      <a class="ltx_ref" href="#bib.bib13" title="">
       2023
      </a>
      )
     </cite>
     .
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S7.SS0.SSS0.Px2">
   <h4 class="ltx_title ltx_title_paragraph">
    Mechanistic Interpretability
   </h4>
   <div class="ltx_para" id="S7.SS0.SSS0.Px2.p1">
    <p class="ltx_p" id="S7.SS0.SSS0.Px2.p1.1">
     Recent works study mechanistic interpretability in factual associations, in-context Learning, and arithmetic reasoning tasks from the perspective of information flow
     <cite class="ltx_cite ltx_citemacro_cite">
      Geva et al. (
      <a class="ltx_ref" href="#bib.bib4" title="">
       2023
      </a>
      ); Wang et al. (
      <a class="ltx_ref" href="#bib.bib20" title="">
       2023
      </a>
      ); Stolfo et al. (
      <a class="ltx_ref" href="#bib.bib15" title="">
       2023
      </a>
      )
     </cite>
     . Researchers also study Othello
     <cite class="ltx_cite ltx_citemacro_cite">
      Li et al. (
      <a class="ltx_ref" href="#bib.bib9" title="">
       2022
      </a>
      ); Nanda et al. (
      <a class="ltx_ref" href="#bib.bib11" title="">
       2023
      </a>
      )
     </cite>
     , chess
     <cite class="ltx_cite ltx_citemacro_cite">
      Karvonen (
      <a class="ltx_ref" href="#bib.bib8" title="">
       2024
      </a>
      )
     </cite>
     and Blocksword
     <cite class="ltx_cite ltx_citemacro_cite">
      Wang et al. (
      <a class="ltx_ref" href="#bib.bib23" title="">
       2024b
      </a>
      )
     </cite>
     in transformer. However, research on the mechanistic interpretation of large language models performing planning tasks is still unexplored. Our work conducts a preliminary study from the perspective of information flow and internal representation.
    </p>
   </div>
   <figure class="ltx_figure" id="S7.F11">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="S7.F11.g1" src="/html/2406.16033/assets/x11.png" width="368"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      Figure 11:
     </span>
     Single step intervened analysis in Vicuna-7b.
    </figcaption>
   </figure>
  </section>
  <section class="ltx_paragraph" id="S7.SS0.SSS0.Px3">
   <h4 class="ltx_title ltx_title_paragraph">
    Look-Ahead
   </h4>
   <div class="ltx_para" id="S7.SS0.SSS0.Px3.p1">
    <p class="ltx_p" id="S7.SS0.SSS0.Px3.p1.1">
     <cite class="ltx_cite ltx_citemacro_citet">
      Pal et al. (
      <a class="ltx_ref" href="#bib.bib12" title="">
       2023
      </a>
      ); Wu et al. (
      <a class="ltx_ref" href="#bib.bib24" title="">
       2024a
      </a>
      ); Jenner et al. (
      <a class="ltx_ref" href="#bib.bib7" title="">
       2024
      </a>
      )
     </cite>
     demonstrate that it is possible to decode future tokens from the hidden representations of a language model at previous token positions. In task planning, a model needs to have look-ahead capabilities. However, it is not yet clear whether LLMs use similar mechanisms when planning. Our work focuses on the look-ahead mechanisms in planning in LLMs.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S8">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    8
   </span>
   Conclusion
  </h2>
  <div class="ltx_para" id="S8.p1">
   <p class="ltx_p" id="S8.p1.1">
    In this paper, we investigate the mechanisms of look-ahead planning in LLMs through the perspectives of information flow and internal representations. We demonstrate
    <span class="ltx_text ltx_font_bold" id="S8.p1.1.1">
     Look-Ahead Planning Decisions Existence Hypothesis
    </span>
    . Our findings indicate that internal representations of LLMs encode a few short-term future decisions to
some extent when planning is successful. These look-ahead decisions are enriched in the early layers, with their accuracy diminishing as the number of planning steps increases. We demonstrate that MHSA mainly extracts information from the spans of goal states and recent steps. Additionally, the output of MHSA in the middle layers at the final token can partially decode the correct decisions.
   </p>
  </div>
 </section>
 <section class="ltx_section" id="Sx1">
  <h2 class="ltx_title ltx_title_section">
   Limitation
  </h2>
  <div class="ltx_para" id="Sx1.p1">
   <p class="ltx_p" id="Sx1.p1.1">
    Although our work provides an in-depth analysis and explanation of look-ahead planning mechanisms of large language models, there are several limitations. First, our analytical methods require access to the internal parameters and representations of open-source models. Although black-box large language models such as ChatGPT possess strong planning capabilities, we cannot access their internal parameters, making it challenging to interpret the most advanced language models. Second, our research primarily focuses on the planning mechanisms in Blocksworld. However, many other planning tasks, such as commonsense planning (e.g., "how to make a meal"), lack standard answers, making it difficult to evaluate the correctness of the planning and conduct quantitative analysis. We leave these limitations for future work.
   </p>
  </div>
 </section>
 <section class="ltx_bibliography" id="bib">
  <h2 class="ltx_title ltx_title_bibliography">
   References
  </h2>
  <ul class="ltx_biblist">
   <li class="ltx_bibitem" id="bib.bib1">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Baumeister et al. (2016)
    </span>
    <span class="ltx_bibblock">
     Roy F Baumeister, Kathleen D Vohs, and Gabriele Oettingen. 2016.
    </span>
    <span class="ltx_bibblock">
     Pragmatic prospection: How and why people think about the future.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">
      Review of general psychology
     </em>
     , 20(1):3–16.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib2">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Chiang et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Wei-Lin Chiang, Zhuohan Li, Zi Lin, Ying Sheng, Zhanghao Wu, Hao Zhang, Lianmin Zheng, Siyuan Zhuang, Yonghao Zhuang, Joseph E. Gonzalez, Ion Stoica, and Eric P. Xing. 2023.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_href" href="https://lmsys.org/blog/2023-03-30-vicuna/" target="_blank" title="">
      Vicuna: An open-source chatbot impressing gpt-4 with 90%* chatgpt quality
     </a>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib3">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Deng et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Xiang Deng, Yu Gu, Boyuan Zheng, Shijie Chen, Sam Stevens, Boshi Wang, Huan Sun, and Yu Su. 2024.
    </span>
    <span class="ltx_bibblock">
     Mind2web: Towards a generalist agent for the web.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">
      Advances in Neural Information Processing Systems
     </em>
     , 36.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib4">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Geva et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Mor Geva, Jasmijn Bastings, Katja Filippova, and Amir Globerson. 2023.
    </span>
    <span class="ltx_bibblock">
     Dissecting recall of factual associations in auto-regressive language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">
      arXiv preprint arXiv:2304.14767
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib5">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Hao et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Shibo Hao, Yi Gu, Haodi Ma, Joshua Jiahua Hong, Zhen Wang, Daisy Zhe Wang, and Zhiting Hu. 2023.
    </span>
    <span class="ltx_bibblock">
     Reasoning with language model is planning with world model.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">
      arXiv preprint arXiv:2305.14992
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib6">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Huang et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Wenlong Huang, Pieter Abbeel, Deepak Pathak, and Igor Mordatch. 2022.
    </span>
    <span class="ltx_bibblock">
     Language models as zero-shot planners: Extracting actionable knowledge for embodied agents.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">
      International Conference on Machine Learning
     </em>
     , pages 9118–9147. PMLR.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib7">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Jenner et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Erik Jenner, Shreyas Kapur, Vasil Georgiev, Cameron Allen, Scott Emmons, and Stuart Russell. 2024.
    </span>
    <span class="ltx_bibblock">
     Evidence of learned look-ahead in a chess-playing neural network.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">
      arXiv preprint arXiv:2406.00877
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib8">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Karvonen (2024)
    </span>
    <span class="ltx_bibblock">
     Adam Karvonen. 2024.
    </span>
    <span class="ltx_bibblock">
     Emergent world models and latent variable estimation in chess-playing language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">
      arXiv preprint arXiv:2403.15498
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib9">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Li et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Kenneth Li, Aspen K Hopkins, David Bau, Fernanda Viégas, Hanspeter Pfister, and Martin Wattenberg. 2022.
    </span>
    <span class="ltx_bibblock">
     Emergent world representations: Exploring a sequence model trained on a synthetic task.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">
      arXiv preprint arXiv:2210.13382
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib10">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Liu et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Xiao Liu, Hao Yu, Hanchen Zhang, Yifan Xu, Xuanyu Lei, Hanyu Lai, Yu Gu, Hangliang Ding, Kaiwen Men, Kejuan Yang, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Agentbench: Evaluating llms as agents.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">
      arXiv preprint arXiv:2308.03688
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib11">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Nanda et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Neel Nanda, Andrew Lee, and Martin Wattenberg. 2023.
    </span>
    <span class="ltx_bibblock">
     Emergent linear representations in world models of self-supervised sequence models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">
      arXiv preprint arXiv:2309.00941
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib12">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Pal et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Koyena Pal, Jiuding Sun, Andrew Yuan, Byron C Wallace, and David Bau. 2023.
    </span>
    <span class="ltx_bibblock">
     Future lens: Anticipating subsequent tokens from a single hidden state.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">
      arXiv preprint arXiv:2311.04897
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib13">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Qin et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Yujia Qin, Shihao Liang, Yining Ye, Kunlun Zhu, Lan Yan, Yaxi Lu, Yankai Lin, Xin Cong, Xiangru Tang, Bill Qian, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Toolllm: Facilitating large language models to master 16000+ real-world apis.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">
      arXiv preprint arXiv:2307.16789
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib14">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Shridhar et al. (2020)
    </span>
    <span class="ltx_bibblock">
     Mohit Shridhar, Xingdi Yuan, Marc-Alexandre Côté, Yonatan Bisk, Adam Trischler, and Matthew Hausknecht. 2020.
    </span>
    <span class="ltx_bibblock">
     Alfworld: Aligning text and embodied environments for interactive learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">
      arXiv preprint arXiv:2010.03768
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib15">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Stolfo et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Alessandro Stolfo, Yonatan Belinkov, and Mrinmaya Sachan. 2023.
    </span>
    <span class="ltx_bibblock">
     A mechanistic interpretation of arithmetic reasoning in language models using causal mediation analysis.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">
      Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing
     </em>
     , pages 7035–7052.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib16">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Touvron et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Llama 2: Open foundation and fine-tuned chat models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">
      arXiv preprint arXiv:2307.09288
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib17">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Valmeekam et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Karthik Valmeekam, Matthew Marquez, Alberto Olmo, Sarath Sreedharan, and Subbarao Kambhampati. 2024.
    </span>
    <span class="ltx_bibblock">
     Planbench: An extensible benchmark for evaluating large language models on planning and reasoning about change.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">
      Advances in Neural Information Processing Systems
     </em>
     , 36.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib18">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Valmeekam et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Karthik Valmeekam, Matthew Marquez, Sarath Sreedharan, and Subbarao Kambhampati. 2023.
    </span>
    <span class="ltx_bibblock">
     On the planning abilities of large language models-a critical investigation.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">
      Advances in Neural Information Processing Systems
     </em>
     , 36:75993–76005.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib19">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Vaswani et al. (2017)
    </span>
    <span class="ltx_bibblock">
     Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017.
    </span>
    <span class="ltx_bibblock">
     Attention is all you need.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">
      Advances in neural information processing systems
     </em>
     , 30.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib20">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wang et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Lean Wang, Lei Li, Damai Dai, Deli Chen, Hao Zhou, Fandong Meng, Jie Zhou, and Xu Sun. 2023.
    </span>
    <span class="ltx_bibblock">
     Label words are anchors: An information flow perspective for understanding in-context learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">
      arXiv preprint arXiv:2305.14160
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib21">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wang et al. (2024a)
    </span>
    <span class="ltx_bibblock">
     Lei Wang, Chen Ma, Xueyang Feng, Zeyu Zhang, Hao Yang, Jingsen Zhang, Zhiyuan Chen, Jiakai Tang, Xu Chen, Yankai Lin, et al. 2024a.
    </span>
    <span class="ltx_bibblock">
     A survey on large language model based autonomous agents.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">
      Frontiers of Computer Science
     </em>
     , 18(6):186345.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib22">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wang et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Ruoyao Wang, Peter Jansen, Marc-Alexandre Côté, and Prithviraj Ammanabrolu. 2022.
    </span>
    <span class="ltx_bibblock">
     Scienceworld: Is your agent smarter than a 5th grader?
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">
      arXiv preprint arXiv:2203.07540
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib23">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wang et al. (2024b)
    </span>
    <span class="ltx_bibblock">
     Siwei Wang, Yifei Shen, Shi Feng, Haoran Sun, Shang-Hua Teng, and Wei Chen. 2024b.
    </span>
    <span class="ltx_bibblock">
     Alpine: Unveiling the planning capability of autoregressive learning in language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">
      arXiv preprint arXiv:2405.09220
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib24">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wu et al. (2024a)
    </span>
    <span class="ltx_bibblock">
     Wilson Wu, John X Morris, and Lionel Levine. 2024a.
    </span>
    <span class="ltx_bibblock">
     Do language models plan ahead for future tokens?
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">
      arXiv preprint arXiv:2404.00859
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib25">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wu et al. (2024b)
    </span>
    <span class="ltx_bibblock">
     Zhengxuan Wu, Atticus Geiger, Aryaman Arora, Jing Huang, Zheng Wang, Noah D Goodman, Christopher D Manning, and Christopher Potts. 2024b.
    </span>
    <span class="ltx_bibblock">
     pyvene: A library for understanding and improving pytorch models via interventions.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">
      arXiv preprint arXiv:2403.07809
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib26">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Xi et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Zhiheng Xi, Wenxiang Chen, Xin Guo, Wei He, Yiwen Ding, Boyang Hong, Ming Zhang, Junzhe Wang, Senjie Jin, Enyu Zhou, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     The rise and potential of large language model based agents: A survey.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">
      arXiv preprint arXiv:2309.07864
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib27">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Xi et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Zhiheng Xi, Yiwen Ding, Wenxiang Chen, Boyang Hong, Honglin Guo, Junzhe Wang, Dingwen Yang, Chenyang Liao, Xin Guo, Wei He, et al. 2024.
    </span>
    <span class="ltx_bibblock">
     Agentgym: Evolving large language model-based agents across diverse environments.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">
      arXiv preprint arXiv:2406.04151
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib28">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Xu et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Qiantong Xu, Fenglu Hong, Bo Li, Changran Hu, Zhengyu Chen, and Jian Zhang. 2023.
    </span>
    <span class="ltx_bibblock">
     On the tool manipulation capability of open-source large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">
      arXiv preprint arXiv:2305.16504
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib29">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yao et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Tom Griffiths, Yuan Cao, and Karthik Narasimhan. 2024.
    </span>
    <span class="ltx_bibblock">
     Tree of thoughts: Deliberate problem solving with large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">
      Advances in Neural Information Processing Systems
     </em>
     , 36.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib30">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yao et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik Narasimhan, and Yuan Cao. 2022.
    </span>
    <span class="ltx_bibblock">
     React: Synergizing reasoning and acting in language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">
      arXiv preprint arXiv:2210.03629
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib31">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yu et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Fangxu Yu, Lai Jiang, Haoqiang Kang, Shibo Hao, and Lianhui Qin. 2024.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_href" href="https://doi.org/10.48550/arXiv.2406.05673" target="_blank" title="">
      Flow of Reasoning: Efficient Training of LLM Policy with Divergent Thinking
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">
      arXiv e-prints
     </em>
     , arXiv:2406.05673.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib32">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zeng et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Aohan Zeng, Mingdao Liu, Rui Lu, Bowen Wang, Xiao Liu, Yuxiao Dong, and Jie Tang. 2023.
    </span>
    <span class="ltx_bibblock">
     Agenttuning: Enabling generalized agent abilities for llms.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">
      arXiv preprint arXiv:2310.12823
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib33">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zhang et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Li Zhang, Peter Jansen, Tianyi Zhang, Peter Clark, Chris Callison-Burch, and Niket Tandon. 2024.
    </span>
    <span class="ltx_bibblock">
     Pddlego: Iterative planning in textual environments.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">
      arXiv preprint arXiv:2405.19793
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib34">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zheng et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Longtao Zheng, Rundong Wang, Xinrun Wang, and Bo An. 2023.
    </span>
    <span class="ltx_bibblock">
     Synapse: Trajectory-as-exemplar prompting with memory for computer control.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">
      The Twelfth International Conference on Learning Representations
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib35">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zhou et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Shuyan Zhou, Frank F Xu, Hao Zhu, Xuhui Zhou, Robert Lo, Abishek Sridhar, Xianyi Cheng, Yonatan Bisk, Daniel Fried, Uri Alon, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Webarena: A realistic web environment for building autonomous agents.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">
      arXiv preprint arXiv:2307.13854
     </em>
     .
    </span>
   </li>
  </ul>
 </section>
 <section class="ltx_appendix" id="A1">
  <h2 class="ltx_title ltx_title_appendix">
   <span class="ltx_tag ltx_tag_appendix">
    Appendix A
   </span>
   Additional Results
  </h2>
  <div class="ltx_para" id="A1.p1">
   <p class="ltx_p" id="A1.p1.1">
    Information flow of last token in Vicuna-7b is shown in Figure
    <a class="ltx_ref" href="#A1.F12" title="Figure 12 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      12
     </span>
    </a>
    . Future action nonlinear probe in Llama-2-7b-chat-hf is shown in Figure
    <a class="ltx_ref" href="#A1.F13" title="Figure 13 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      13
     </span>
    </a>
    . Future action linear probe in Vicuna-7b is shown in Figure
    <a class="ltx_ref" href="#A1.F14" title="Figure 14 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      14
     </span>
    </a>
    . Future action nonlinear probe in Vicuna-7b is shown in Figure
    <a class="ltx_ref" href="#A1.F15" title="Figure 15 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      15
     </span>
    </a>
    , Single step intervened analysis in Llama-2-7b-chat-hf is shown in Figure
    <a class="ltx_ref" href="#A1.F16" title="Figure 16 ‣ Appendix A Additional Results ‣ Unlocking the Future: Exploring Look-Ahead Planning Mechanistic Interpretability in Large Language Models">
     <span class="ltx_text ltx_ref_tag">
      16
     </span>
    </a>
    .
   </p>
  </div>
  <figure class="ltx_table" id="A1.T1">
   <table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A1.T1.1">
    <tbody class="ltx_tbody">
     <tr class="ltx_tr" id="A1.T1.1.1.1">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A1.T1.1.1.1.1">
       <span class="ltx_text ltx_font_bold" id="A1.T1.1.1.1.1.1">
        LEVEL
       </span>
      </th>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.1.1.2">
       <span class="ltx_text ltx_font_bold" id="A1.T1.1.1.1.2.1">
        L1
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.1.1.3">
       <span class="ltx_text ltx_font_bold" id="A1.T1.1.1.1.3.1">
        L2
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.1.1.4">
       <span class="ltx_text ltx_font_bold" id="A1.T1.1.1.1.4.1">
        L3
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.1.1.5">
       <span class="ltx_text ltx_font_bold" id="A1.T1.1.1.1.5.1">
        Total
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.2.2">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="5" id="A1.T1.1.2.2.1">
       <span class="ltx_text ltx_font_italic" id="A1.T1.1.2.2.1.1">
        Train Size
       </span>
      </th>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.3.3">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A1.T1.1.3.3.1">
       4 blocks
      </th>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.3.3.2">
       3
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.3.3.3">
       17
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.3.3.4">
       25
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.3.3.5">
       45
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.4.4">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A1.T1.1.4.4.1">
       5 blocks
      </th>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.4.4.2">
       1
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.4.4.3">
       23
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.4.4.4">
       121
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.4.4.5">
       145
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.5.5">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A1.T1.1.5.5.1">
       6 blocks
      </th>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.5.5.2">
       3
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.5.5.3">
       48
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.5.5.4">
       326
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.5.5.5">
       377
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.6.6">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A1.T1.1.6.6.1">
       Total
      </th>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.6.6.2">
       7
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.6.6.3">
       88
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.6.6.4">
       472
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.6.6.5">
       567
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.7.7">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="5" id="A1.T1.1.7.7.1">
       <span class="ltx_text ltx_font_italic" id="A1.T1.1.7.7.1.1">
        Test Size
       </span>
      </th>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.8.8">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A1.T1.1.8.8.1">
       4 blocks
      </th>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.8.8.2">
       24
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.8.8.3">
       60
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.8.8.4">
       80
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T1.1.8.8.5">
       164
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.9.9">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A1.T1.1.9.9.1">
       5 blocks
      </th>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.9.9.2">
       34
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.9.9.3">
       115
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.9.9.4">
       268
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.9.9.5">
       417
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.10.10">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A1.T1.1.10.10.1">
       6 blocks
      </th>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.10.10.2">
       57
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.10.10.3">
       232
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.10.10.4">
       709
      </td>
      <td class="ltx_td ltx_align_center" id="A1.T1.1.10.10.5">
       998
      </td>
     </tr>
     <tr class="ltx_tr" id="A1.T1.1.11.11">
      <th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b ltx_border_r" id="A1.T1.1.11.11.1">
       Total
      </th>
      <td class="ltx_td ltx_align_center ltx_border_b" id="A1.T1.1.11.11.2">
       115
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="A1.T1.1.11.11.3">
       407
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="A1.T1.1.11.11.4">
       1057
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="A1.T1.1.11.11.5">
       1579
      </td>
     </tr>
    </tbody>
   </table>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_table">
     Table 1:
    </span>
    Blocksworld dataset statistics
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="A1.F12">
   <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="242" id="A1.F12.g1" src="/html/2406.16033/assets/x12.png" width="461"/>
   <figcaption class="ltx_caption">
    <span class="ltx_tag ltx_tag_figure">
     Figure 12:
    </span>
    Information flow of last token in Vicuna-7b.
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="A1.F13">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="A1.F13.g1" src="/html/2406.16033/assets/x13.png" width="368"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 13:
    </span>
    Future action nonlinear probe in Llama-2-7b-chat-hf.
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="A1.F14">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="A1.F14.g1" src="/html/2406.16033/assets/x14.png" width="368"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 14:
    </span>
    Future action linear probe in Vicuna-7b
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="A1.F15">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="A1.F15.g1" src="/html/2406.16033/assets/x15.png" width="368"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 15:
    </span>
    Future action nonlinear probe in Vicuna-7b
   </figcaption>
  </figure>
  <figure class="ltx_figure" id="A1.F16">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="368" id="A1.F16.g1" src="/html/2406.16033/assets/x16.png" width="368"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 16:
    </span>
    Single step intervened analysis in Llama-2-7b-chat-hf.
   </figcaption>
  </figure>
 </section>
</article>
