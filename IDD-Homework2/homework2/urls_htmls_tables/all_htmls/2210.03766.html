<!DOCTYPE html><html prefix="dcterms: http://purl.org/dc/terms/" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>[2210.03766] FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings</title><meta property="og:description" content="Federated learning is a training paradigm that learns from multiple distributed users without aggregating data on a centralized server. Such a paradigm promises the ability to deploy machine-learning at-scale to a dive…">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings">
<meta name="twitter:image:src" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta name="twitter:image:alt" content="ar5iv logo">
<meta property="og:title" content="FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings">
<meta property="og:site_name" content="ar5iv">
<meta property="og:image" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ar5iv.labs.arxiv.org/html/2210.03766">

<!--Generated on Thu Mar 14 01:43:13 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script>
  function detectColorScheme(){
    var theme="light";
    var current_theme = localStorage.getItem("ar5iv_theme");
    if(current_theme){
      if(current_theme == "dark"){
        theme = "dark";
      } }
    else if(!window.matchMedia) { return false; }
    else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
      theme = "dark"; }
    if (theme=="dark") {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.setAttribute("data-theme", "light"); } }

  detectColorScheme();

  function toggleColorScheme(){
    var current_theme = localStorage.getItem("ar5iv_theme");
    if (current_theme) {
      if (current_theme == "light") {
        localStorage.setItem("ar5iv_theme", "dark"); }
      else {
        localStorage.setItem("ar5iv_theme", "light"); } }
    else {
        localStorage.setItem("ar5iv_theme", "dark"); }
    detectColorScheme(); }
</script>
<link media="all" rel="stylesheet" href="/assets/ar5iv-fonts.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv-site.0.2.2.css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">  Andrew Silva 
<br class="ltx_break">School of Interactive Computing
<br class="ltx_break">Georgia Institute of Technology
<br class="ltx_break">Atlanta, GA
<br class="ltx_break"><span id="id2.2.id1" class="ltx_text ltx_font_typewriter">andrew.silva@gatech.edu</span> 
<br class="ltx_break">&amp; Pradyumna Tambwekar<sup id="id3.3.id2" class="ltx_sup">∗</sup> 
<br class="ltx_break">School of Interactive Computing
<br class="ltx_break">Georgia Institute of Technology
<br class="ltx_break">Atlanta, GA
<br class="ltx_break"><span id="id4.4.id3" class="ltx_text ltx_font_typewriter">ptambwekar3@gatech.edu</span> 
<br class="ltx_break">&amp; Matthew Gombolay 
<br class="ltx_break">School of Interactive Computing
<br class="ltx_break">Georgia Institute of Technology
<br class="ltx_break">Atlanta, GA
<br class="ltx_break"><span id="id5.5.id4" class="ltx_text ltx_font_typewriter">matthew.gombolay@cc.gatech.edu</span> 
<br class="ltx_break">
</span><span class="ltx_author_notes">Denotes equal contribution</span></span>
</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p id="id6.id1" class="ltx_p">Federated learning is a training paradigm that learns from multiple distributed users without aggregating data on a centralized server. Such a paradigm promises the ability to deploy machine-learning at-scale to a diverse population of end-users without first collecting a large, labeled dataset for all possible tasks.
As federated learning typically averages learning updates across a decentralized population, there is a growing need for personalization of federated learning systems (i.e conversational agents must be able to personalize to a <span id="id6.id1.1" class="ltx_text ltx_font_italic">specific</span> user’s preferences).
In this work, we propose a new direction for personalization research within federated learning, leveraging both personal embeddings and shared context embeddings.
We also present an approach to predict these “preference” embeddings, enabling personalization without backpropagation.
Compared to state-of-the-art personalization baselines, our approach achieves a 50% improvement in test-time perplexity using 0.001% of the memory required by baseline approaches, and achieving greater sample- and compute-efficiency.
</p>
</div>
<div id="p1" class="ltx_para ltx_noindent">
<p id="p1.2" class="ltx_p"><em id="p1.2.1" class="ltx_emph ltx_font_bold ltx_font_italic">Keywords</em> Natural Language Processing  <math id="p1.1.m1.1" class="ltx_Math" alttext="\cdot" display="inline"><semantics id="p1.1.m1.1a"><mo id="p1.1.m1.1.1" xref="p1.1.m1.1.1.cmml">⋅</mo><annotation-xml encoding="MathML-Content" id="p1.1.m1.1b"><ci id="p1.1.m1.1.1.cmml" xref="p1.1.m1.1.1">⋅</ci></annotation-xml><annotation encoding="application/x-tex" id="p1.1.m1.1c">\cdot</annotation></semantics></math>
Federated Learning  <math id="p1.2.m2.1" class="ltx_Math" alttext="\cdot" display="inline"><semantics id="p1.2.m2.1a"><mo id="p1.2.m2.1.1" xref="p1.2.m2.1.1.cmml">⋅</mo><annotation-xml encoding="MathML-Content" id="p1.2.m2.1b"><ci id="p1.2.m2.1.1.cmml" xref="p1.2.m2.1.1">⋅</ci></annotation-xml><annotation encoding="application/x-tex" id="p1.2.m2.1c">\cdot</annotation></semantics></math>
Personalization</p>
</div>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>

<div id="S1.p1" class="ltx_para ltx_noindent">
<p id="S1.p1.1" class="ltx_p">As conversational agents and dialog systems are deployed to real-world scenarios, these systems require data-efficient personalization paradigms such that language systems such as conversational agents can be effectively adapted on-device.
The benefits of on-device optimization are two-fold; (1) Swift adaptation of model-behavior based on human-interactions <cite class="ltx_cite ltx_citemacro_citep">(Dudy et al., <a href="#bib.bib1" title="" class="ltx_ref">2021</a>)</cite>, (2) Privacy protection by means of retaining all data related to the user on-device <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a href="#bib.bib2" title="" class="ltx_ref">2020a</a>)</cite>.
One of the prevailing paradigms for learning from and engaging with end-users is <span id="S1.p1.1.1" class="ltx_text ltx_font_italic">federated learning</span>.
Federated learning is an inherently decentralized learning paradigm that assumes no access to a large labeled dataset and instead leverages averaged parameter updates across all users of the system <cite class="ltx_cite ltx_citemacro_citep">(McMahan et al., <a href="#bib.bib3" title="" class="ltx_ref">2017</a>)</cite>. Such averaged updates invariably dilute individual preferences or deviations from the mean, resulting in a model that works well for the average user while failing to appropriately capture under-represented preferences or sub-groups within the data.
In this work, we present a novel approach (FedPC) to personalizing federated learning with personal and context embeddings (collectively called “preference embeddings”), adapting more efficiently and effectively than prior work with respect to both data and compute on-device.</p>
</div>
<figure id="S1.F1" class="ltx_figure"><img src="/html/2210.03766/assets/fig/overview_diagram.png" id="S1.F1.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="419" height="318" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Overview of our personalized federated learning setup, FedPC. Language models within client devices, such as individual agents deployed to communicate with people at hospitals, homes, or construction sites, pull down global model parameters and context embeddings. Local, on-device data is then paired with both personal and context embeddings to produce personalized predictions with global model parameters.</figcaption>
</figure>
<div id="S1.p2" class="ltx_para ltx_noindent">
<p id="S1.p2.1" class="ltx_p">We leverage the insight that a client’s data distribution is informed by both individual preferences and additional contextual information.
For example, while each user may have their own <span id="S1.p2.1.1" class="ltx_text ltx_font_italic">individual</span> style, there may be more general <span id="S1.p2.1.2" class="ltx_text ltx_font_italic">population-wide</span> trends that inform the style of personalized predictions (e.g., dialogue assistants helping patients with cognitive disorders, whereby agents can personalize to individual patients and broader condition-wide trends).
While individual preferences may be unique to each client (e.g. a user’s taste or affect), we can more accurately personalize to client preferences with the addition of context, as shared-context parameters carry beneficial stylistic information across clients <cite class="ltx_cite ltx_citemacro_citep">(Dudy et al., <a href="#bib.bib1" title="" class="ltx_ref">2021</a>; Jones, <a href="#bib.bib4" title="" class="ltx_ref">1999</a>)</cite>. Stylistic or situational context provides additional information to curate relevant language outputs that can be shared across users.</p>
</div>
<div id="S1.p3" class="ltx_para ltx_noindent">
<p id="S1.p3.1" class="ltx_p">In this work, we contribute a new approach to personalized federated learning that is both easier to learn and more effective than prior work, and investigate the utility of personalization via individual preferences and contexts.
While prior language generation approaches have developed personal or persona-based generative systems <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a href="#bib.bib5" title="" class="ltx_ref">2021</a>; Zhang et al., <a href="#bib.bib6" title="" class="ltx_ref">2018</a>)</cite> or context-based generative systems <cite class="ltx_cite ltx_citemacro_citep">(Cheng et al., <a href="#bib.bib7" title="" class="ltx_ref">2019</a>; Lin et al., <a href="#bib.bib8" title="" class="ltx_ref">2019a</a>)</cite> individually, none have combined them to personalize outputs in a low-data setting under stylized preferences. We show that our approach is more sample-efficient than state-of-the-art baselines, while requiring less time to train. We additionally present an inference-only version of our approach, personalizing without backpropagation for new users. Finally, we directly test the potential for personalization with users who have been held-out from training (i.e., testing with new users). An overview of our approach is given in Figure <a href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2>

<div id="S2.p1" class="ltx_para ltx_noindent">
<p id="S2.p1.1" class="ltx_p">Federated learning enables machine-learning at-scale to a diverse population of end-users without first collecting a large, labeled dataset for all possible tasks. After the introduction of <span id="S2.p1.1.1" class="ltx_text ltx_font_italic">federated averaging</span> <cite class="ltx_cite ltx_citemacro_citep">(McMahan et al., <a href="#bib.bib3" title="" class="ltx_ref">2017</a>)</cite>, focus has shifted to different ways of personalizing to individual users.
Prior personalization approaches for federated learning have typically involved learning personal network heads and a shared global encoder (i.e., “split-learning” approaches <cite class="ltx_cite ltx_citemacro_citep">(Gupta and Raskar, <a href="#bib.bib9" title="" class="ltx_ref">2018</a>)</cite>), or learning a separate local model from a global initialization (i.e., a “meta-learning” approach <cite class="ltx_cite ltx_citemacro_citep">(Finn et al., <a href="#bib.bib10" title="" class="ltx_ref">2017</a>; Nichol et al., <a href="#bib.bib11" title="" class="ltx_ref">2018</a>)</cite>).</p>
</div>
<section id="S2.SS0.SSS0.Px1" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Learning Personal Model Heads</h5>

<div id="S2.SS0.SSS0.Px1.p1" class="ltx_para ltx_noindent">
<p id="S2.SS0.SSS0.Px1.p1.1" class="ltx_p">The most prevalent approach to personalization in federated learning is through personalized model heads. Such approaches share gradient information to learn a global feature encoder, but retain user-specific classification-head gradients on-device. Approaches such as FedRep <cite class="ltx_cite ltx_citemacro_citep">(Collins et al., <a href="#bib.bib12" title="" class="ltx_ref">2021</a>)</cite> solely separate out local and global gradients, while other methods such as PFedMe <cite class="ltx_cite ltx_citemacro_citep">(Dinh et al., <a href="#bib.bib13" title="" class="ltx_ref">2020</a>)</cite> enforce constraints on model-divergence (such as via FedProx<cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a href="#bib.bib14" title="" class="ltx_ref">2020b</a>)</cite>). Other approaches, such as FedMD <cite class="ltx_cite ltx_citemacro_citep">(Li and Wang, <a href="#bib.bib15" title="" class="ltx_ref">2019</a>)</cite>, enable clients to adopt any desired architecture, sharing a common backbone but allowing for completely divergent model heads <cite class="ltx_cite ltx_citemacro_citep">(Arivazhagan et al., <a href="#bib.bib16" title="" class="ltx_ref">2019</a>; Kim et al., <a href="#bib.bib17" title="" class="ltx_ref">2021</a>; Rudovic et al., <a href="#bib.bib18" title="" class="ltx_ref">2021</a>; Paulik et al., <a href="#bib.bib19" title="" class="ltx_ref">2021</a>)</cite>. Finally, there has recently been increased effort on identifying clusters of related users to share model heads, such as with K-Means clustering in PFedKM <cite class="ltx_cite ltx_citemacro_citep">(Tang et al., <a href="#bib.bib20" title="" class="ltx_ref">2021</a>)</cite> or through clustered personal embeddings in FedEmbed <cite class="ltx_cite ltx_citemacro_citep">(Silva et al., <a href="#bib.bib21" title="" class="ltx_ref">2022</a>)</cite>. Notably, there is no prior work which learns both personal <span id="S2.SS0.SSS0.Px1.p1.1.1" class="ltx_text ltx_font_italic">and</span> contextual model heads for personalization within federated learning.</p>
</div>
</section>
<section id="S2.SS0.SSS0.Px2" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Meta-Learning Global Models</h5>

<div id="S2.SS0.SSS0.Px2.p1" class="ltx_para ltx_noindent">
<p id="S2.SS0.SSS0.Px2.p1.1" class="ltx_p">An alternate approach to personalizing federated learning models is through the adoption of meta-learning <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a href="#bib.bib22" title="" class="ltx_ref">2019</a>; Fallah et al., <a href="#bib.bib23" title="" class="ltx_ref">2020</a>)</cite>, for learning a global model prior to fine-tuning on client-data.
After cloning the global model as an initialization from all client’s updates, local, client-side models are permitted to diverge and fine-tune to a user’s individual preferences or data distribution <cite class="ltx_cite ltx_citemacro_citep">(Fallah et al., <a href="#bib.bib23" title="" class="ltx_ref">2020</a>; Deng et al., <a href="#bib.bib24" title="" class="ltx_ref">2020</a>; Hanzely and Richtárik, <a href="#bib.bib25" title="" class="ltx_ref">2020</a>; Hanzely et al., <a href="#bib.bib26" title="" class="ltx_ref">2020</a>; Lin et al., <a href="#bib.bib27" title="" class="ltx_ref">2019b</a>)</cite>. However, computing and applying gradients for a full model often requires too much time, power, and memory. As such, expensive full-model gradients can often only be computed and applied when a device is not actively in-use. As in the split-learning literature, there are not meta-learning approaches for disentangling personal and contextual preferences within personalized federated learning.</p>
</div>
</section>
<section id="S2.SS0.SSS0.Px3" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Learning with Personal Embeddings</h5>

<div id="S2.SS0.SSS0.Px3.p1" class="ltx_para ltx_noindent">
<p id="S2.SS0.SSS0.Px3.p1.1" class="ltx_p">Our work leverages the insight that personal preferences can be represented using a personalized embedding, allowing the model to condition output predictions on personal preferences without requiring completely re-trained classification heads or networks. Personal embeddings have been used in prior work to capture an individual’s “style,” often in imitation learning settings <cite class="ltx_cite ltx_citemacro_citep">(Tamar et al., <a href="#bib.bib28" title="" class="ltx_ref">2018</a>; Hsiao et al., <a href="#bib.bib29" title="" class="ltx_ref">2019</a>; Paleja et al., <a href="#bib.bib30" title="" class="ltx_ref">2020</a>; Schrum et al., <a href="#bib.bib31" title="" class="ltx_ref">2022</a>)</cite>.
Treating personal embeddings as neural network parameters that are updated on-device, these approaches learn to embed preferences and condition network output over both input data and preference embeddings. Most closely related to our work are FedNLG <cite class="ltx_cite ltx_citemacro_citep">(Lu et al., <a href="#bib.bib32" title="" class="ltx_ref">2021</a>)</cite>, which predicts “persona” parameters for users, and the Global+ model in FedEmbed <cite class="ltx_cite ltx_citemacro_citep">(Silva et al., <a href="#bib.bib21" title="" class="ltx_ref">2022</a>)</cite>, which learns a personal embedding for each user.
However, FedNLG requires access to a user’s entire history of language and demographic data in order to produce a “persona” for each user, informing the generation of a “persona” embedding, and Global+ incorporates supervised style feedback. Prior embedding-based approaches solely learn <span id="S2.SS0.SSS0.Px3.p1.1.1" class="ltx_text ltx_font_italic">personal</span> embeddings, neglecting stylization through context. In our work, we explore the utility of incorporating context in addition to personal preferences, and all preference embeddings are updated solely via a self-supervised language-modeling loss.</p>
</div>
</section>
<section id="S2.SS0.SSS0.Px4" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Personalization in Language</h5>

<div id="S2.SS0.SSS0.Px4.p1" class="ltx_para ltx_noindent">
<p id="S2.SS0.SSS0.Px4.p1.1" class="ltx_p">Personalization for language generation systems seeks to produce grounded systems that can efficiently adapt to end-user needs <cite class="ltx_cite ltx_citemacro_citep">(Yang and Flek, <a href="#bib.bib33" title="" class="ltx_ref">2021</a>; Dudy et al., <a href="#bib.bib1" title="" class="ltx_ref">2021</a>)</cite>.
One such approach to personalization is by learning a “persona” for each user and conditioning the language model on the embeddings or representation for the persona via a memory network <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a href="#bib.bib6" title="" class="ltx_ref">2018</a>; Wu et al., <a href="#bib.bib5" title="" class="ltx_ref">2021</a>; Lu et al., <a href="#bib.bib32" title="" class="ltx_ref">2021</a>)</cite>.
“Personas” are generally short sequences of 5-6 sentences which contain information about an individual such as “I have blonde hair” or “My mom is a doctor.”
Similar approaches leverage Bayesian inference methods to infer context<cite class="ltx_cite ltx_citemacro_citep">(Majumder et al., <a href="#bib.bib34" title="" class="ltx_ref">2020</a>)</cite> or persona <cite class="ltx_cite ltx_citemacro_citep">(Kim et al., <a href="#bib.bib35" title="" class="ltx_ref">2020</a>)</cite>, and then condition the language generation on the inferred context.
However such approaches involve collecting and maintaining user-profiles on a central server which may violate user-confidentiality.
Alternate approaches seek bypass this issue by enabling dynamic speaker modeling through context-based fine-tuning rather than conditioning on profile information <cite class="ltx_cite ltx_citemacro_citep">(Cheng et al., <a href="#bib.bib7" title="" class="ltx_ref">2019</a>; Li and Liang, <a href="#bib.bib36" title="" class="ltx_ref">2021</a>)</cite>.
FedPC leverages a similar design to dynamically learn personal and context embeddings through data from small datasets for a given user, while also preserving user-confidentiality via federated learning.</p>
</div>
<div id="S2.SS0.SSS0.Px4.p2" class="ltx_para ltx_noindent">
<p id="S2.SS0.SSS0.Px4.p2.1" class="ltx_p">FedPC represents a new direction in personalized federated learning research, enabling personal and stylized language generation with a fraction of the memory, data, and compute costs of prior approaches without requiring access to pre-made personal profiles.</p>
</div>
</section>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Approach</h2>

<div id="S3.p1" class="ltx_para ltx_noindent">
<p id="S3.p1.1" class="ltx_p">In this section, we present our novel approach to personalization in federated learning with FedPC.
FedPC produces personal and contextual preference embeddings either via backpropagation (i.e., learning preference embeddings), or by inference (i.e., predicting preference embeddings).
A visual overview of our federated learning architecture is in Figure <a href="#S3.F2" title="Figure 2 ‣ 3 Approach ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>, and a step-by-step walk-through of our training algorithm is given in Algorithm <a href="#alg1" title="Algorithm 1 ‣ 3.2 Federated Learning Algorithm ‣ 3 Approach ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<figure id="S3.F2" class="ltx_figure"><img src="/html/2210.03766/assets/fig/model_diagram.png" id="S3.F2.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="419" height="307" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>The FedPC model architecture. Input data, such as on-device conversation data for a user, is passed into the language model in addition to personal and context labels specifying user’s preference. The personal and context labels are embedded through a preference embedding layer to produce a single preference embedding.
This preference embedding is combined with the word embeddings for the input sequence and passed into the DistilGPT2 model to predict the next word.</figcaption>
</figure>
<section id="S3.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Personalization via Embeddings</h3>

<div id="S3.SS1.p1" class="ltx_para ltx_noindent">
<p id="S3.SS1.p1.1" class="ltx_p">Personalization in FedPC is achieved entirely through preference embeddings. Every input sample (e.g., an incomplete sentence) is accompanied by both a personal preference embedding, representing the user, and a contextual preference embedding, representing the context or style of the prediction.
These two embeddings are combined via an element-wise multiplication to produce a single preference embedding that accompanies the input sample.
By leveraging both personal and context embeddings, FedPC considers the individual user <span id="S3.SS1.p1.1.1" class="ltx_text ltx_font_italic">and</span> the broader context of an utterance, enabling personal, stylized prediction.</p>
</div>
<div id="S3.SS1.p2" class="ltx_para ltx_noindent">
<p id="S3.SS1.p2.1" class="ltx_p">In the language-modeling domain, the unified preference embedding is prepended to the input utterance, providing a prefix for the model to consider <cite class="ltx_cite ltx_citemacro_citep">(Li and Liang, <a href="#bib.bib36" title="" class="ltx_ref">2021</a>)</cite>.
The model then predicts the next token of the utterance, and a language-modeling loss is calculated by comparing the prediction to the user’s actual next token. The next token is then appended to the sequence, and preference embeddings are again prepended to the new input sequence, and the process repeats. After completing a full utterance, preference embeddings may be updated, either through backpropagation or by using an embedding-generator to predict new personal and contextual embeddings for the client.</p>
</div>
</section>
<section id="S3.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Federated Learning Algorithm</h3>

<div id="S3.SS2.p1" class="ltx_para ltx_noindent">
<p id="S3.SS2.p1.2" class="ltx_p">To begin, all clients initialize their own personal embedding on-device, and the server initializes a set of <math id="S3.SS2.p1.1.m1.1" class="ltx_Math" alttext="C" display="inline"><semantics id="S3.SS2.p1.1.m1.1a"><mi id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><ci id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">C</annotation></semantics></math> context vectors for each relevant setting given the target task.
We additionally assume that all data points on a client device have an associated context, <math id="S3.SS2.p1.2.m2.1" class="ltx_Math" alttext="c" display="inline"><semantics id="S3.SS2.p1.2.m2.1a"><mi id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><ci id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">c</annotation></semantics></math>, being derived from the contextual information of the client device when the data point was captured (e.g., time of day, location, etc.).</p>
</div>
<div id="S3.SS2.p2" class="ltx_para ltx_noindent">
<p id="S3.SS2.p2.5" class="ltx_p">Training begins by distributing all the requisite information to client-devices.
Client devices pull down the global model parameters, <math id="S3.SS2.p2.1.m1.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS2.p2.1.m1.1a"><mi id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><ci id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">\theta</annotation></semantics></math>, and the global context embedding parameters, <math id="S3.SS2.p2.2.m2.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="S3.SS2.p2.2.m2.1a"><mi id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><ci id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">\phi</annotation></semantics></math>, making local copies, <math id="S3.SS2.p2.3.m3.1" class="ltx_Math" alttext="\theta_{d}" display="inline"><semantics id="S3.SS2.p2.3.m3.1a"><msub id="S3.SS2.p2.3.m3.1.1" xref="S3.SS2.p2.3.m3.1.1.cmml"><mi id="S3.SS2.p2.3.m3.1.1.2" xref="S3.SS2.p2.3.m3.1.1.2.cmml">θ</mi><mi id="S3.SS2.p2.3.m3.1.1.3" xref="S3.SS2.p2.3.m3.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.1b"><apply id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.1.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p2.3.m3.1.1.2.cmml" xref="S3.SS2.p2.3.m3.1.1.2">𝜃</ci><ci id="S3.SS2.p2.3.m3.1.1.3.cmml" xref="S3.SS2.p2.3.m3.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.1c">\theta_{d}</annotation></semantics></math> and <math id="S3.SS2.p2.4.m4.1" class="ltx_Math" alttext="\phi_{d}" display="inline"><semantics id="S3.SS2.p2.4.m4.1a"><msub id="S3.SS2.p2.4.m4.1.1" xref="S3.SS2.p2.4.m4.1.1.cmml"><mi id="S3.SS2.p2.4.m4.1.1.2" xref="S3.SS2.p2.4.m4.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.p2.4.m4.1.1.3" xref="S3.SS2.p2.4.m4.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.4.m4.1b"><apply id="S3.SS2.p2.4.m4.1.1.cmml" xref="S3.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.1.1.1.cmml" xref="S3.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p2.4.m4.1.1.2.cmml" xref="S3.SS2.p2.4.m4.1.1.2">italic-ϕ</ci><ci id="S3.SS2.p2.4.m4.1.1.3.cmml" xref="S3.SS2.p2.4.m4.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.4.m4.1c">\phi_{d}</annotation></semantics></math> (line 6).
Unlike the global model parameters and context embeddings, the personal embeddings, <math id="S3.SS2.p2.5.m5.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.p2.5.m5.1a"><msub id="S3.SS2.p2.5.m5.1.1" xref="S3.SS2.p2.5.m5.1.1.cmml"><mi id="S3.SS2.p2.5.m5.1.1.2" xref="S3.SS2.p2.5.m5.1.1.2.cmml">ψ</mi><mi id="S3.SS2.p2.5.m5.1.1.3" xref="S3.SS2.p2.5.m5.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.5.m5.1b"><apply id="S3.SS2.p2.5.m5.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m5.1.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1">subscript</csymbol><ci id="S3.SS2.p2.5.m5.1.1.2.cmml" xref="S3.SS2.p2.5.m5.1.1.2">𝜓</ci><ci id="S3.SS2.p2.5.m5.1.1.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.5.m5.1c">\psi_{d}</annotation></semantics></math> do not need to be copied from the server as they are kept on client-devices.</p>
</div>
<div id="S3.SS2.p3" class="ltx_para ltx_noindent">
<p id="S3.SS2.p3.5" class="ltx_p">Client devices then take <math id="S3.SS2.p3.1.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S3.SS2.p3.1.m1.1a"><mi id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><ci id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">K</annotation></semantics></math> gradient steps using their own on-device data, where each input sample is paired with the client’s on-device embedding, <math id="S3.SS2.p3.2.m2.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.p3.2.m2.1a"><msub id="S3.SS2.p3.2.m2.1.1" xref="S3.SS2.p3.2.m2.1.1.cmml"><mi id="S3.SS2.p3.2.m2.1.1.2" xref="S3.SS2.p3.2.m2.1.1.2.cmml">ψ</mi><mi id="S3.SS2.p3.2.m2.1.1.3" xref="S3.SS2.p3.2.m2.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m2.1b"><apply id="S3.SS2.p3.2.m2.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m2.1.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m2.1.1.2.cmml" xref="S3.SS2.p3.2.m2.1.1.2">𝜓</ci><ci id="S3.SS2.p3.2.m2.1.1.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m2.1c">\psi_{d}</annotation></semantics></math>, and the context embedding for the particular sample, <math id="S3.SS2.p3.3.m3.2" class="ltx_Math" alttext="\phi_{d,c}" display="inline"><semantics id="S3.SS2.p3.3.m3.2a"><msub id="S3.SS2.p3.3.m3.2.3" xref="S3.SS2.p3.3.m3.2.3.cmml"><mi id="S3.SS2.p3.3.m3.2.3.2" xref="S3.SS2.p3.3.m3.2.3.2.cmml">ϕ</mi><mrow id="S3.SS2.p3.3.m3.2.2.2.4" xref="S3.SS2.p3.3.m3.2.2.2.3.cmml"><mi id="S3.SS2.p3.3.m3.1.1.1.1" xref="S3.SS2.p3.3.m3.1.1.1.1.cmml">d</mi><mo id="S3.SS2.p3.3.m3.2.2.2.4.1" xref="S3.SS2.p3.3.m3.2.2.2.3.cmml">,</mo><mi id="S3.SS2.p3.3.m3.2.2.2.2" xref="S3.SS2.p3.3.m3.2.2.2.2.cmml">c</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.3.m3.2b"><apply id="S3.SS2.p3.3.m3.2.3.cmml" xref="S3.SS2.p3.3.m3.2.3"><csymbol cd="ambiguous" id="S3.SS2.p3.3.m3.2.3.1.cmml" xref="S3.SS2.p3.3.m3.2.3">subscript</csymbol><ci id="S3.SS2.p3.3.m3.2.3.2.cmml" xref="S3.SS2.p3.3.m3.2.3.2">italic-ϕ</ci><list id="S3.SS2.p3.3.m3.2.2.2.3.cmml" xref="S3.SS2.p3.3.m3.2.2.2.4"><ci id="S3.SS2.p3.3.m3.1.1.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1.1.1">𝑑</ci><ci id="S3.SS2.p3.3.m3.2.2.2.2.cmml" xref="S3.SS2.p3.3.m3.2.2.2.2">𝑐</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.3.m3.2c">\phi_{d,c}</annotation></semantics></math>, assuming the data point was drawn under context <math id="S3.SS2.p3.4.m4.1" class="ltx_Math" alttext="c\in C" display="inline"><semantics id="S3.SS2.p3.4.m4.1a"><mrow id="S3.SS2.p3.4.m4.1.1" xref="S3.SS2.p3.4.m4.1.1.cmml"><mi id="S3.SS2.p3.4.m4.1.1.2" xref="S3.SS2.p3.4.m4.1.1.2.cmml">c</mi><mo id="S3.SS2.p3.4.m4.1.1.1" xref="S3.SS2.p3.4.m4.1.1.1.cmml">∈</mo><mi id="S3.SS2.p3.4.m4.1.1.3" xref="S3.SS2.p3.4.m4.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.4.m4.1b"><apply id="S3.SS2.p3.4.m4.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1"><in id="S3.SS2.p3.4.m4.1.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1.1"></in><ci id="S3.SS2.p3.4.m4.1.1.2.cmml" xref="S3.SS2.p3.4.m4.1.1.2">𝑐</ci><ci id="S3.SS2.p3.4.m4.1.1.3.cmml" xref="S3.SS2.p3.4.m4.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.4.m4.1c">c\in C</annotation></semantics></math>.
Gradients are calculated using a language-modeling objective, though any objective could theoretically be applied.
If preference embeddings are being generated via forward-propagation rather than learned via backpropagation, contextual and personal preference embeddings will also be predicted by an embedding-generator at this stage (note: the parameters of the embedding-generator are shared globally, being a part of <math id="S3.SS2.p3.5.m5.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS2.p3.5.m5.1a"><mi id="S3.SS2.p3.5.m5.1.1" xref="S3.SS2.p3.5.m5.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.5.m5.1b"><ci id="S3.SS2.p3.5.m5.1.1.cmml" xref="S3.SS2.p3.5.m5.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.5.m5.1c">\theta</annotation></semantics></math>).</p>
</div>
<div id="S3.SS2.p4" class="ltx_para ltx_noindent">
<p id="S3.SS2.p4.5" class="ltx_p">Gradients are applied to the shared-model parameters, <math id="S3.SS2.p4.1.m1.1" class="ltx_Math" alttext="\theta_{d}" display="inline"><semantics id="S3.SS2.p4.1.m1.1a"><msub id="S3.SS2.p4.1.m1.1.1" xref="S3.SS2.p4.1.m1.1.1.cmml"><mi id="S3.SS2.p4.1.m1.1.1.2" xref="S3.SS2.p4.1.m1.1.1.2.cmml">θ</mi><mi id="S3.SS2.p4.1.m1.1.1.3" xref="S3.SS2.p4.1.m1.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.1.m1.1b"><apply id="S3.SS2.p4.1.m1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.1.m1.1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p4.1.m1.1.1.2.cmml" xref="S3.SS2.p4.1.m1.1.1.2">𝜃</ci><ci id="S3.SS2.p4.1.m1.1.1.3.cmml" xref="S3.SS2.p4.1.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.1.m1.1c">\theta_{d}</annotation></semantics></math>, and are then used to update preference embeddings (line 9).
If preference embeddings are being predicted, these gradient steps are also applied to the shared embedding-generator, and preference embeddings (i.e., context embeddings <math id="S3.SS2.p4.2.m2.1" class="ltx_Math" alttext="\phi_{d}" display="inline"><semantics id="S3.SS2.p4.2.m2.1a"><msub id="S3.SS2.p4.2.m2.1.1" xref="S3.SS2.p4.2.m2.1.1.cmml"><mi id="S3.SS2.p4.2.m2.1.1.2" xref="S3.SS2.p4.2.m2.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.p4.2.m2.1.1.3" xref="S3.SS2.p4.2.m2.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.2.m2.1b"><apply id="S3.SS2.p4.2.m2.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.2.m2.1.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p4.2.m2.1.1.2.cmml" xref="S3.SS2.p4.2.m2.1.1.2">italic-ϕ</ci><ci id="S3.SS2.p4.2.m2.1.1.3.cmml" xref="S3.SS2.p4.2.m2.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.2.m2.1c">\phi_{d}</annotation></semantics></math> and personal embeddings <math id="S3.SS2.p4.3.m3.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.p4.3.m3.1a"><msub id="S3.SS2.p4.3.m3.1.1" xref="S3.SS2.p4.3.m3.1.1.cmml"><mi id="S3.SS2.p4.3.m3.1.1.2" xref="S3.SS2.p4.3.m3.1.1.2.cmml">ψ</mi><mi id="S3.SS2.p4.3.m3.1.1.3" xref="S3.SS2.p4.3.m3.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.3.m3.1b"><apply id="S3.SS2.p4.3.m3.1.1.cmml" xref="S3.SS2.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.3.m3.1.1.1.cmml" xref="S3.SS2.p4.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p4.3.m3.1.1.2.cmml" xref="S3.SS2.p4.3.m3.1.1.2">𝜓</ci><ci id="S3.SS2.p4.3.m3.1.1.3.cmml" xref="S3.SS2.p4.3.m3.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.3.m3.1c">\psi_{d}</annotation></semantics></math>) are overwritten with their latest predicted values (lines 10-11).
If preference embeddings are being learned via backpropagation, gradient steps are applied to <math id="S3.SS2.p4.4.m4.1" class="ltx_Math" alttext="\phi_{d}" display="inline"><semantics id="S3.SS2.p4.4.m4.1a"><msub id="S3.SS2.p4.4.m4.1.1" xref="S3.SS2.p4.4.m4.1.1.cmml"><mi id="S3.SS2.p4.4.m4.1.1.2" xref="S3.SS2.p4.4.m4.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.p4.4.m4.1.1.3" xref="S3.SS2.p4.4.m4.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.4.m4.1b"><apply id="S3.SS2.p4.4.m4.1.1.cmml" xref="S3.SS2.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.4.m4.1.1.1.cmml" xref="S3.SS2.p4.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p4.4.m4.1.1.2.cmml" xref="S3.SS2.p4.4.m4.1.1.2">italic-ϕ</ci><ci id="S3.SS2.p4.4.m4.1.1.3.cmml" xref="S3.SS2.p4.4.m4.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.4.m4.1c">\phi_{d}</annotation></semantics></math> and <math id="S3.SS2.p4.5.m5.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.p4.5.m5.1a"><msub id="S3.SS2.p4.5.m5.1.1" xref="S3.SS2.p4.5.m5.1.1.cmml"><mi id="S3.SS2.p4.5.m5.1.1.2" xref="S3.SS2.p4.5.m5.1.1.2.cmml">ψ</mi><mi id="S3.SS2.p4.5.m5.1.1.3" xref="S3.SS2.p4.5.m5.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.5.m5.1b"><apply id="S3.SS2.p4.5.m5.1.1.cmml" xref="S3.SS2.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.5.m5.1.1.1.cmml" xref="S3.SS2.p4.5.m5.1.1">subscript</csymbol><ci id="S3.SS2.p4.5.m5.1.1.2.cmml" xref="S3.SS2.p4.5.m5.1.1.2">𝜓</ci><ci id="S3.SS2.p4.5.m5.1.1.3.cmml" xref="S3.SS2.p4.5.m5.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.5.m5.1c">\psi_{d}</annotation></semantics></math> using Equation <a href="#S3.E1" title="In 3.2 Federated Learning Algorithm ‣ 3 Approach ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a> (lines 10-11).</p>
</div>
<div id="S3.SS2.p5" class="ltx_para ltx_noindent">
<p id="S3.SS2.p5.6" class="ltx_p">After <math id="S3.SS2.p5.1.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S3.SS2.p5.1.m1.1a"><mi id="S3.SS2.p5.1.m1.1.1" xref="S3.SS2.p5.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.1.m1.1b"><ci id="S3.SS2.p5.1.m1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.1.m1.1c">K</annotation></semantics></math> steps, gradients for <math id="S3.SS2.p5.2.m2.1" class="ltx_Math" alttext="\theta_{d}" display="inline"><semantics id="S3.SS2.p5.2.m2.1a"><msub id="S3.SS2.p5.2.m2.1.1" xref="S3.SS2.p5.2.m2.1.1.cmml"><mi id="S3.SS2.p5.2.m2.1.1.2" xref="S3.SS2.p5.2.m2.1.1.2.cmml">θ</mi><mi id="S3.SS2.p5.2.m2.1.1.3" xref="S3.SS2.p5.2.m2.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.2.m2.1b"><apply id="S3.SS2.p5.2.m2.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p5.2.m2.1.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p5.2.m2.1.1.2.cmml" xref="S3.SS2.p5.2.m2.1.1.2">𝜃</ci><ci id="S3.SS2.p5.2.m2.1.1.3.cmml" xref="S3.SS2.p5.2.m2.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.2.m2.1c">\theta_{d}</annotation></semantics></math> and <math id="S3.SS2.p5.3.m3.1" class="ltx_Math" alttext="\phi_{d}" display="inline"><semantics id="S3.SS2.p5.3.m3.1a"><msub id="S3.SS2.p5.3.m3.1.1" xref="S3.SS2.p5.3.m3.1.1.cmml"><mi id="S3.SS2.p5.3.m3.1.1.2" xref="S3.SS2.p5.3.m3.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.p5.3.m3.1.1.3" xref="S3.SS2.p5.3.m3.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.3.m3.1b"><apply id="S3.SS2.p5.3.m3.1.1.cmml" xref="S3.SS2.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p5.3.m3.1.1.1.cmml" xref="S3.SS2.p5.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p5.3.m3.1.1.2.cmml" xref="S3.SS2.p5.3.m3.1.1.2">italic-ϕ</ci><ci id="S3.SS2.p5.3.m3.1.1.3.cmml" xref="S3.SS2.p5.3.m3.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.3.m3.1c">\phi_{d}</annotation></semantics></math> are sent back to the server, while <math id="S3.SS2.p5.4.m4.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.p5.4.m4.1a"><msub id="S3.SS2.p5.4.m4.1.1" xref="S3.SS2.p5.4.m4.1.1.cmml"><mi id="S3.SS2.p5.4.m4.1.1.2" xref="S3.SS2.p5.4.m4.1.1.2.cmml">ψ</mi><mi id="S3.SS2.p5.4.m4.1.1.3" xref="S3.SS2.p5.4.m4.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.4.m4.1b"><apply id="S3.SS2.p5.4.m4.1.1.cmml" xref="S3.SS2.p5.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p5.4.m4.1.1.1.cmml" xref="S3.SS2.p5.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p5.4.m4.1.1.2.cmml" xref="S3.SS2.p5.4.m4.1.1.2">𝜓</ci><ci id="S3.SS2.p5.4.m4.1.1.3.cmml" xref="S3.SS2.p5.4.m4.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.4.m4.1c">\psi_{d}</annotation></semantics></math> remains on-device (lines 13 - 15).
The server computes a single update for the global model and context embeddings by averaging across all clients (lines 17-18).
The server applies the averaged update to <math id="S3.SS2.p5.5.m5.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS2.p5.5.m5.1a"><mi id="S3.SS2.p5.5.m5.1.1" xref="S3.SS2.p5.5.m5.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.5.m5.1b"><ci id="S3.SS2.p5.5.m5.1.1.cmml" xref="S3.SS2.p5.5.m5.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.5.m5.1c">\theta</annotation></semantics></math> and <math id="S3.SS2.p5.6.m6.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="S3.SS2.p5.6.m6.1a"><mi id="S3.SS2.p5.6.m6.1.1" xref="S3.SS2.p5.6.m6.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.6.m6.1b"><ci id="S3.SS2.p5.6.m6.1.1.cmml" xref="S3.SS2.p5.6.m6.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.6.m6.1c">\phi</annotation></semantics></math>, and the process repeats (lines 19-21).</p>
</div>
<figure id="alg1" class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="alg1.2.1.1" class="ltx_text ltx_font_bold">Algorithm 1</span> </span> FedPC Training Loop</figcaption>
<div id="alg1.3" class="ltx_listing ltx_listing">
<div id="alg1.l1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1:</span>  <span id="alg1.l1.1" class="ltx_text ltx_font_bold">Given:</span> Training objective <math id="alg1.l1.m1.1" class="ltx_Math" alttext="\mathcal{L}" display="inline"><semantics id="alg1.l1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml">ℒ</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><ci id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1">ℒ</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">\mathcal{L}</annotation></semantics></math>, Client devices <math id="alg1.l1.m2.1" class="ltx_Math" alttext="D" display="inline"><semantics id="alg1.l1.m2.1a"><mi id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><ci id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">D</annotation></semantics></math>, # client steps, <math id="alg1.l1.m3.1" class="ltx_Math" alttext="K" display="inline"><semantics id="alg1.l1.m3.1a"><mi id="alg1.l1.m3.1.1" xref="alg1.l1.m3.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m3.1b"><ci id="alg1.l1.m3.1.1.cmml" xref="alg1.l1.m3.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m3.1c">K</annotation></semantics></math>, # global steps, <math id="alg1.l1.m4.1" class="ltx_Math" alttext="N" display="inline"><semantics id="alg1.l1.m4.1a"><mi id="alg1.l1.m4.1.1" xref="alg1.l1.m4.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m4.1b"><ci id="alg1.l1.m4.1.1.cmml" xref="alg1.l1.m4.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m4.1c">N</annotation></semantics></math>

</div>
<div id="alg1.l2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2:</span>  <span id="alg1.l2.1" class="ltx_text ltx_font_bold">Initialize:</span> Global model <math id="alg1.l2.m1.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="alg1.l2.m1.1a"><mi id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">\theta</annotation></semantics></math>, Context embeds <math id="alg1.l2.m2.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="alg1.l2.m2.1a"><mi id="alg1.l2.m2.1.1" xref="alg1.l2.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.m2.1b"><ci id="alg1.l2.m2.1.1.cmml" xref="alg1.l2.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m2.1c">\phi</annotation></semantics></math> 
</div>
<div id="alg1.l3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3:</span>  <span id="alg1.l3.1" class="ltx_text ltx_font_bold">Initialize:</span> Personal embeddings on-device <math id="alg1.l3.m1.1" class="ltx_Math" alttext="\psi" display="inline"><semantics id="alg1.l3.m1.1a"><mi id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml">ψ</mi><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.1b"><ci id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1">𝜓</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.1c">\psi</annotation></semantics></math>

</div>
<div id="alg1.l4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4:</span>  <span id="alg1.l4.1" class="ltx_text ltx_font_bold">for</span> <math id="alg1.l4.m1.1" class="ltx_Math" alttext="n\in N" display="inline"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><mi id="alg1.l4.m1.1.1.2" xref="alg1.l4.m1.1.1.2.cmml">n</mi><mo id="alg1.l4.m1.1.1.1" xref="alg1.l4.m1.1.1.1.cmml">∈</mo><mi id="alg1.l4.m1.1.1.3" xref="alg1.l4.m1.1.1.3.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><in id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1"></in><ci id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2">𝑛</ci><ci id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3">𝑁</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">n\in N</annotation></semantics></math> <span id="alg1.l4.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="alg1.l5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5:</span>     <span id="alg1.l5.1" class="ltx_text ltx_font_bold">for</span> <math id="alg1.l5.m1.1" class="ltx_Math" alttext="d\in D" display="inline"><semantics id="alg1.l5.m1.1a"><mrow id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml"><mi id="alg1.l5.m1.1.1.2" xref="alg1.l5.m1.1.1.2.cmml">d</mi><mo id="alg1.l5.m1.1.1.1" xref="alg1.l5.m1.1.1.1.cmml">∈</mo><mi id="alg1.l5.m1.1.1.3" xref="alg1.l5.m1.1.1.3.cmml">D</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.1b"><apply id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1"><in id="alg1.l5.m1.1.1.1.cmml" xref="alg1.l5.m1.1.1.1"></in><ci id="alg1.l5.m1.1.1.2.cmml" xref="alg1.l5.m1.1.1.2">𝑑</ci><ci id="alg1.l5.m1.1.1.3.cmml" xref="alg1.l5.m1.1.1.3">𝐷</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.1c">d\in D</annotation></semantics></math> <span id="alg1.l5.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="alg1.l6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6:</span>        <math id="alg1.l6.m1.2" class="ltx_Math" alttext="\theta_{d}=\theta,\phi_{d}=\phi" display="inline"><semantics id="alg1.l6.m1.2a"><mrow id="alg1.l6.m1.2.2.2" xref="alg1.l6.m1.2.2.3.cmml"><mrow id="alg1.l6.m1.1.1.1.1" xref="alg1.l6.m1.1.1.1.1.cmml"><msub id="alg1.l6.m1.1.1.1.1.2" xref="alg1.l6.m1.1.1.1.1.2.cmml"><mi id="alg1.l6.m1.1.1.1.1.2.2" xref="alg1.l6.m1.1.1.1.1.2.2.cmml">θ</mi><mi id="alg1.l6.m1.1.1.1.1.2.3" xref="alg1.l6.m1.1.1.1.1.2.3.cmml">d</mi></msub><mo id="alg1.l6.m1.1.1.1.1.1" xref="alg1.l6.m1.1.1.1.1.1.cmml">=</mo><mi id="alg1.l6.m1.1.1.1.1.3" xref="alg1.l6.m1.1.1.1.1.3.cmml">θ</mi></mrow><mo id="alg1.l6.m1.2.2.2.3" xref="alg1.l6.m1.2.2.3a.cmml">,</mo><mrow id="alg1.l6.m1.2.2.2.2" xref="alg1.l6.m1.2.2.2.2.cmml"><msub id="alg1.l6.m1.2.2.2.2.2" xref="alg1.l6.m1.2.2.2.2.2.cmml"><mi id="alg1.l6.m1.2.2.2.2.2.2" xref="alg1.l6.m1.2.2.2.2.2.2.cmml">ϕ</mi><mi id="alg1.l6.m1.2.2.2.2.2.3" xref="alg1.l6.m1.2.2.2.2.2.3.cmml">d</mi></msub><mo id="alg1.l6.m1.2.2.2.2.1" xref="alg1.l6.m1.2.2.2.2.1.cmml">=</mo><mi id="alg1.l6.m1.2.2.2.2.3" xref="alg1.l6.m1.2.2.2.2.3.cmml">ϕ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.2b"><apply id="alg1.l6.m1.2.2.3.cmml" xref="alg1.l6.m1.2.2.2"><csymbol cd="ambiguous" id="alg1.l6.m1.2.2.3a.cmml" xref="alg1.l6.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg1.l6.m1.1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1.1"><eq id="alg1.l6.m1.1.1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1.1.1"></eq><apply id="alg1.l6.m1.1.1.1.1.2.cmml" xref="alg1.l6.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.1.1.2.1.cmml" xref="alg1.l6.m1.1.1.1.1.2">subscript</csymbol><ci id="alg1.l6.m1.1.1.1.1.2.2.cmml" xref="alg1.l6.m1.1.1.1.1.2.2">𝜃</ci><ci id="alg1.l6.m1.1.1.1.1.2.3.cmml" xref="alg1.l6.m1.1.1.1.1.2.3">𝑑</ci></apply><ci id="alg1.l6.m1.1.1.1.1.3.cmml" xref="alg1.l6.m1.1.1.1.1.3">𝜃</ci></apply><apply id="alg1.l6.m1.2.2.2.2.cmml" xref="alg1.l6.m1.2.2.2.2"><eq id="alg1.l6.m1.2.2.2.2.1.cmml" xref="alg1.l6.m1.2.2.2.2.1"></eq><apply id="alg1.l6.m1.2.2.2.2.2.cmml" xref="alg1.l6.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l6.m1.2.2.2.2.2.1.cmml" xref="alg1.l6.m1.2.2.2.2.2">subscript</csymbol><ci id="alg1.l6.m1.2.2.2.2.2.2.cmml" xref="alg1.l6.m1.2.2.2.2.2.2">italic-ϕ</ci><ci id="alg1.l6.m1.2.2.2.2.2.3.cmml" xref="alg1.l6.m1.2.2.2.2.2.3">𝑑</ci></apply><ci id="alg1.l6.m1.2.2.2.2.3.cmml" xref="alg1.l6.m1.2.2.2.2.3">italic-ϕ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.2c">\theta_{d}=\theta,\phi_{d}=\phi</annotation></semantics></math>

</div>
<div id="alg1.l7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7:</span>        <span id="alg1.l7.1" class="ltx_text ltx_font_bold">for</span> <math id="alg1.l7.m1.1" class="ltx_Math" alttext="k\in K" display="inline"><semantics id="alg1.l7.m1.1a"><mrow id="alg1.l7.m1.1.1" xref="alg1.l7.m1.1.1.cmml"><mi id="alg1.l7.m1.1.1.2" xref="alg1.l7.m1.1.1.2.cmml">k</mi><mo id="alg1.l7.m1.1.1.1" xref="alg1.l7.m1.1.1.1.cmml">∈</mo><mi id="alg1.l7.m1.1.1.3" xref="alg1.l7.m1.1.1.3.cmml">K</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.1b"><apply id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1"><in id="alg1.l7.m1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1"></in><ci id="alg1.l7.m1.1.1.2.cmml" xref="alg1.l7.m1.1.1.2">𝑘</ci><ci id="alg1.l7.m1.1.1.3.cmml" xref="alg1.l7.m1.1.1.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.1c">k\in K</annotation></semantics></math> <span id="alg1.l7.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="alg1.l8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8:</span>           Sample <math id="alg1.l8.m1.1" class="ltx_Math" alttext="B_{d}" display="inline"><semantics id="alg1.l8.m1.1a"><msub id="alg1.l8.m1.1.1" xref="alg1.l8.m1.1.1.cmml"><mi id="alg1.l8.m1.1.1.2" xref="alg1.l8.m1.1.1.2.cmml">B</mi><mi id="alg1.l8.m1.1.1.3" xref="alg1.l8.m1.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.1b"><apply id="alg1.l8.m1.1.1.cmml" xref="alg1.l8.m1.1.1"><csymbol cd="ambiguous" id="alg1.l8.m1.1.1.1.cmml" xref="alg1.l8.m1.1.1">subscript</csymbol><ci id="alg1.l8.m1.1.1.2.cmml" xref="alg1.l8.m1.1.1.2">𝐵</ci><ci id="alg1.l8.m1.1.1.3.cmml" xref="alg1.l8.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.1c">B_{d}</annotation></semantics></math> from user’s on-device data

</div>
<div id="alg1.l9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9:</span>           <math id="alg1.l9.m1.6" class="ltx_Math" alttext="\theta_{d}\leftarrow\theta_{d}+\nabla_{\theta}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="alg1.l9.m1.6a"><mrow id="alg1.l9.m1.6.6" xref="alg1.l9.m1.6.6.cmml"><msub id="alg1.l9.m1.6.6.6" xref="alg1.l9.m1.6.6.6.cmml"><mi id="alg1.l9.m1.6.6.6.2" xref="alg1.l9.m1.6.6.6.2.cmml">θ</mi><mi id="alg1.l9.m1.6.6.6.3" xref="alg1.l9.m1.6.6.6.3.cmml">d</mi></msub><mo stretchy="false" id="alg1.l9.m1.6.6.5" xref="alg1.l9.m1.6.6.5.cmml">←</mo><mrow id="alg1.l9.m1.6.6.4" xref="alg1.l9.m1.6.6.4.cmml"><msub id="alg1.l9.m1.6.6.4.6" xref="alg1.l9.m1.6.6.4.6.cmml"><mi id="alg1.l9.m1.6.6.4.6.2" xref="alg1.l9.m1.6.6.4.6.2.cmml">θ</mi><mi id="alg1.l9.m1.6.6.4.6.3" xref="alg1.l9.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="alg1.l9.m1.6.6.4.5" xref="alg1.l9.m1.6.6.4.5.cmml">+</mo><mrow id="alg1.l9.m1.6.6.4.4" xref="alg1.l9.m1.6.6.4.4.cmml"><mrow id="alg1.l9.m1.6.6.4.4.6" xref="alg1.l9.m1.6.6.4.4.6.cmml"><msub id="alg1.l9.m1.6.6.4.4.6.1" xref="alg1.l9.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="alg1.l9.m1.6.6.4.4.6.1.2" xref="alg1.l9.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi id="alg1.l9.m1.6.6.4.4.6.1.3" xref="alg1.l9.m1.6.6.4.4.6.1.3.cmml">θ</mi></msub><mi class="ltx_font_mathcaligraphic" id="alg1.l9.m1.6.6.4.4.6.2" xref="alg1.l9.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="alg1.l9.m1.6.6.4.4.5" xref="alg1.l9.m1.6.6.4.4.5.cmml">​</mo><mrow id="alg1.l9.m1.6.6.4.4.4.4" xref="alg1.l9.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="alg1.l9.m1.6.6.4.4.4.4.5" xref="alg1.l9.m1.6.6.4.4.4.5.cmml">(</mo><msub id="alg1.l9.m1.3.3.1.1.1.1.1" xref="alg1.l9.m1.3.3.1.1.1.1.1.cmml"><mi id="alg1.l9.m1.3.3.1.1.1.1.1.2" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="alg1.l9.m1.3.3.1.1.1.1.1.3" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="alg1.l9.m1.6.6.4.4.4.4.6" xref="alg1.l9.m1.6.6.4.4.4.5.cmml">,</mo><msub id="alg1.l9.m1.4.4.2.2.2.2.2" xref="alg1.l9.m1.4.4.2.2.2.2.2.cmml"><mi id="alg1.l9.m1.4.4.2.2.2.2.2.2" xref="alg1.l9.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="alg1.l9.m1.2.2.2.4" xref="alg1.l9.m1.2.2.2.3.cmml"><mi id="alg1.l9.m1.1.1.1.1" xref="alg1.l9.m1.1.1.1.1.cmml">d</mi><mo id="alg1.l9.m1.2.2.2.4.1" xref="alg1.l9.m1.2.2.2.3.cmml">,</mo><mi id="alg1.l9.m1.2.2.2.2" xref="alg1.l9.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="alg1.l9.m1.6.6.4.4.4.4.7" xref="alg1.l9.m1.6.6.4.4.4.5.cmml">,</mo><msub id="alg1.l9.m1.5.5.3.3.3.3.3" xref="alg1.l9.m1.5.5.3.3.3.3.3.cmml"><mi id="alg1.l9.m1.5.5.3.3.3.3.3.2" xref="alg1.l9.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="alg1.l9.m1.5.5.3.3.3.3.3.3" xref="alg1.l9.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="alg1.l9.m1.6.6.4.4.4.4.8" xref="alg1.l9.m1.6.6.4.4.4.5.cmml">,</mo><msub id="alg1.l9.m1.6.6.4.4.4.4.4" xref="alg1.l9.m1.6.6.4.4.4.4.4.cmml"><mi id="alg1.l9.m1.6.6.4.4.4.4.4.2" xref="alg1.l9.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="alg1.l9.m1.6.6.4.4.4.4.4.3" xref="alg1.l9.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="alg1.l9.m1.6.6.4.4.4.4.9" xref="alg1.l9.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.6b"><apply id="alg1.l9.m1.6.6.cmml" xref="alg1.l9.m1.6.6"><ci id="alg1.l9.m1.6.6.5.cmml" xref="alg1.l9.m1.6.6.5">←</ci><apply id="alg1.l9.m1.6.6.6.cmml" xref="alg1.l9.m1.6.6.6"><csymbol cd="ambiguous" id="alg1.l9.m1.6.6.6.1.cmml" xref="alg1.l9.m1.6.6.6">subscript</csymbol><ci id="alg1.l9.m1.6.6.6.2.cmml" xref="alg1.l9.m1.6.6.6.2">𝜃</ci><ci id="alg1.l9.m1.6.6.6.3.cmml" xref="alg1.l9.m1.6.6.6.3">𝑑</ci></apply><apply id="alg1.l9.m1.6.6.4.cmml" xref="alg1.l9.m1.6.6.4"><plus id="alg1.l9.m1.6.6.4.5.cmml" xref="alg1.l9.m1.6.6.4.5"></plus><apply id="alg1.l9.m1.6.6.4.6.cmml" xref="alg1.l9.m1.6.6.4.6"><csymbol cd="ambiguous" id="alg1.l9.m1.6.6.4.6.1.cmml" xref="alg1.l9.m1.6.6.4.6">subscript</csymbol><ci id="alg1.l9.m1.6.6.4.6.2.cmml" xref="alg1.l9.m1.6.6.4.6.2">𝜃</ci><ci id="alg1.l9.m1.6.6.4.6.3.cmml" xref="alg1.l9.m1.6.6.4.6.3">𝑑</ci></apply><apply id="alg1.l9.m1.6.6.4.4.cmml" xref="alg1.l9.m1.6.6.4.4"><times id="alg1.l9.m1.6.6.4.4.5.cmml" xref="alg1.l9.m1.6.6.4.4.5"></times><apply id="alg1.l9.m1.6.6.4.4.6.cmml" xref="alg1.l9.m1.6.6.4.4.6"><apply id="alg1.l9.m1.6.6.4.4.6.1.cmml" xref="alg1.l9.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="alg1.l9.m1.6.6.4.4.6.1.1.cmml" xref="alg1.l9.m1.6.6.4.4.6.1">subscript</csymbol><ci id="alg1.l9.m1.6.6.4.4.6.1.2.cmml" xref="alg1.l9.m1.6.6.4.4.6.1.2">∇</ci><ci id="alg1.l9.m1.6.6.4.4.6.1.3.cmml" xref="alg1.l9.m1.6.6.4.4.6.1.3">𝜃</ci></apply><ci id="alg1.l9.m1.6.6.4.4.6.2.cmml" xref="alg1.l9.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="alg1.l9.m1.6.6.4.4.4.5.cmml" xref="alg1.l9.m1.6.6.4.4.4.4"><apply id="alg1.l9.m1.3.3.1.1.1.1.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.1.1.1.2.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="alg1.l9.m1.3.3.1.1.1.1.1.3.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="alg1.l9.m1.4.4.2.2.2.2.2.cmml" xref="alg1.l9.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l9.m1.4.4.2.2.2.2.2.1.cmml" xref="alg1.l9.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="alg1.l9.m1.4.4.2.2.2.2.2.2.cmml" xref="alg1.l9.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="alg1.l9.m1.2.2.2.3.cmml" xref="alg1.l9.m1.2.2.2.4"><ci id="alg1.l9.m1.1.1.1.1.cmml" xref="alg1.l9.m1.1.1.1.1">𝑑</ci><ci id="alg1.l9.m1.2.2.2.2.cmml" xref="alg1.l9.m1.2.2.2.2">𝑐</ci></list></apply><apply id="alg1.l9.m1.5.5.3.3.3.3.3.cmml" xref="alg1.l9.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="alg1.l9.m1.5.5.3.3.3.3.3.1.cmml" xref="alg1.l9.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="alg1.l9.m1.5.5.3.3.3.3.3.2.cmml" xref="alg1.l9.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="alg1.l9.m1.5.5.3.3.3.3.3.3.cmml" xref="alg1.l9.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="alg1.l9.m1.6.6.4.4.4.4.4.cmml" xref="alg1.l9.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="alg1.l9.m1.6.6.4.4.4.4.4.1.cmml" xref="alg1.l9.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="alg1.l9.m1.6.6.4.4.4.4.4.2.cmml" xref="alg1.l9.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="alg1.l9.m1.6.6.4.4.4.4.4.3.cmml" xref="alg1.l9.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.6c">\theta_{d}\leftarrow\theta_{d}+\nabla_{\theta}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math> 
</div>
<div id="alg1.l10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10:</span>           <math id="alg1.l10.m1.1" class="ltx_Math" alttext="\phi_{d}\leftarrow\phi_{d}+\nabla_{\phi_{d}}" display="inline"><semantics id="alg1.l10.m1.1a"><mrow id="alg1.l10.m1.1.1" xref="alg1.l10.m1.1.1.cmml"><msub id="alg1.l10.m1.1.1.2" xref="alg1.l10.m1.1.1.2.cmml"><mi id="alg1.l10.m1.1.1.2.2" xref="alg1.l10.m1.1.1.2.2.cmml">ϕ</mi><mi id="alg1.l10.m1.1.1.2.3" xref="alg1.l10.m1.1.1.2.3.cmml">d</mi></msub><mo stretchy="false" id="alg1.l10.m1.1.1.1" xref="alg1.l10.m1.1.1.1.cmml">←</mo><mrow id="alg1.l10.m1.1.1.3" xref="alg1.l10.m1.1.1.3.cmml"><msub id="alg1.l10.m1.1.1.3.2" xref="alg1.l10.m1.1.1.3.2.cmml"><mi id="alg1.l10.m1.1.1.3.2.2" xref="alg1.l10.m1.1.1.3.2.2.cmml">ϕ</mi><mi id="alg1.l10.m1.1.1.3.2.3" xref="alg1.l10.m1.1.1.3.2.3.cmml">d</mi></msub><mo id="alg1.l10.m1.1.1.3.1" xref="alg1.l10.m1.1.1.3.1.cmml">+</mo><msub id="alg1.l10.m1.1.1.3.3" xref="alg1.l10.m1.1.1.3.3.cmml"><mo id="alg1.l10.m1.1.1.3.3.2" xref="alg1.l10.m1.1.1.3.3.2.cmml">∇</mo><msub id="alg1.l10.m1.1.1.3.3.3" xref="alg1.l10.m1.1.1.3.3.3.cmml"><mi id="alg1.l10.m1.1.1.3.3.3.2" xref="alg1.l10.m1.1.1.3.3.3.2.cmml">ϕ</mi><mi id="alg1.l10.m1.1.1.3.3.3.3" xref="alg1.l10.m1.1.1.3.3.3.3.cmml">d</mi></msub></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l10.m1.1b"><apply id="alg1.l10.m1.1.1.cmml" xref="alg1.l10.m1.1.1"><ci id="alg1.l10.m1.1.1.1.cmml" xref="alg1.l10.m1.1.1.1">←</ci><apply id="alg1.l10.m1.1.1.2.cmml" xref="alg1.l10.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.2.1.cmml" xref="alg1.l10.m1.1.1.2">subscript</csymbol><ci id="alg1.l10.m1.1.1.2.2.cmml" xref="alg1.l10.m1.1.1.2.2">italic-ϕ</ci><ci id="alg1.l10.m1.1.1.2.3.cmml" xref="alg1.l10.m1.1.1.2.3">𝑑</ci></apply><apply id="alg1.l10.m1.1.1.3.cmml" xref="alg1.l10.m1.1.1.3"><plus id="alg1.l10.m1.1.1.3.1.cmml" xref="alg1.l10.m1.1.1.3.1"></plus><apply id="alg1.l10.m1.1.1.3.2.cmml" xref="alg1.l10.m1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.3.2.1.cmml" xref="alg1.l10.m1.1.1.3.2">subscript</csymbol><ci id="alg1.l10.m1.1.1.3.2.2.cmml" xref="alg1.l10.m1.1.1.3.2.2">italic-ϕ</ci><ci id="alg1.l10.m1.1.1.3.2.3.cmml" xref="alg1.l10.m1.1.1.3.2.3">𝑑</ci></apply><apply id="alg1.l10.m1.1.1.3.3.cmml" xref="alg1.l10.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.3.3.1.cmml" xref="alg1.l10.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l10.m1.1.1.3.3.2.cmml" xref="alg1.l10.m1.1.1.3.3.2">∇</ci><apply id="alg1.l10.m1.1.1.3.3.3.cmml" xref="alg1.l10.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.3.3.3.1.cmml" xref="alg1.l10.m1.1.1.3.3.3">subscript</csymbol><ci id="alg1.l10.m1.1.1.3.3.3.2.cmml" xref="alg1.l10.m1.1.1.3.3.3.2">italic-ϕ</ci><ci id="alg1.l10.m1.1.1.3.3.3.3.cmml" xref="alg1.l10.m1.1.1.3.3.3.3">𝑑</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m1.1c">\phi_{d}\leftarrow\phi_{d}+\nabla_{\phi_{d}}</annotation></semantics></math>

</div>
<div id="alg1.l11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11:</span>           <math id="alg1.l11.m1.1" class="ltx_Math" alttext="\psi_{d}\leftarrow\psi_{d}+\nabla_{\psi_{d}}" display="inline"><semantics id="alg1.l11.m1.1a"><mrow id="alg1.l11.m1.1.1" xref="alg1.l11.m1.1.1.cmml"><msub id="alg1.l11.m1.1.1.2" xref="alg1.l11.m1.1.1.2.cmml"><mi id="alg1.l11.m1.1.1.2.2" xref="alg1.l11.m1.1.1.2.2.cmml">ψ</mi><mi id="alg1.l11.m1.1.1.2.3" xref="alg1.l11.m1.1.1.2.3.cmml">d</mi></msub><mo stretchy="false" id="alg1.l11.m1.1.1.1" xref="alg1.l11.m1.1.1.1.cmml">←</mo><mrow id="alg1.l11.m1.1.1.3" xref="alg1.l11.m1.1.1.3.cmml"><msub id="alg1.l11.m1.1.1.3.2" xref="alg1.l11.m1.1.1.3.2.cmml"><mi id="alg1.l11.m1.1.1.3.2.2" xref="alg1.l11.m1.1.1.3.2.2.cmml">ψ</mi><mi id="alg1.l11.m1.1.1.3.2.3" xref="alg1.l11.m1.1.1.3.2.3.cmml">d</mi></msub><mo id="alg1.l11.m1.1.1.3.1" xref="alg1.l11.m1.1.1.3.1.cmml">+</mo><msub id="alg1.l11.m1.1.1.3.3" xref="alg1.l11.m1.1.1.3.3.cmml"><mo id="alg1.l11.m1.1.1.3.3.2" xref="alg1.l11.m1.1.1.3.3.2.cmml">∇</mo><msub id="alg1.l11.m1.1.1.3.3.3" xref="alg1.l11.m1.1.1.3.3.3.cmml"><mi id="alg1.l11.m1.1.1.3.3.3.2" xref="alg1.l11.m1.1.1.3.3.3.2.cmml">ψ</mi><mi id="alg1.l11.m1.1.1.3.3.3.3" xref="alg1.l11.m1.1.1.3.3.3.3.cmml">d</mi></msub></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l11.m1.1b"><apply id="alg1.l11.m1.1.1.cmml" xref="alg1.l11.m1.1.1"><ci id="alg1.l11.m1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1">←</ci><apply id="alg1.l11.m1.1.1.2.cmml" xref="alg1.l11.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.2.1.cmml" xref="alg1.l11.m1.1.1.2">subscript</csymbol><ci id="alg1.l11.m1.1.1.2.2.cmml" xref="alg1.l11.m1.1.1.2.2">𝜓</ci><ci id="alg1.l11.m1.1.1.2.3.cmml" xref="alg1.l11.m1.1.1.2.3">𝑑</ci></apply><apply id="alg1.l11.m1.1.1.3.cmml" xref="alg1.l11.m1.1.1.3"><plus id="alg1.l11.m1.1.1.3.1.cmml" xref="alg1.l11.m1.1.1.3.1"></plus><apply id="alg1.l11.m1.1.1.3.2.cmml" xref="alg1.l11.m1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.3.2.1.cmml" xref="alg1.l11.m1.1.1.3.2">subscript</csymbol><ci id="alg1.l11.m1.1.1.3.2.2.cmml" xref="alg1.l11.m1.1.1.3.2.2">𝜓</ci><ci id="alg1.l11.m1.1.1.3.2.3.cmml" xref="alg1.l11.m1.1.1.3.2.3">𝑑</ci></apply><apply id="alg1.l11.m1.1.1.3.3.cmml" xref="alg1.l11.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.3.3.1.cmml" xref="alg1.l11.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l11.m1.1.1.3.3.2.cmml" xref="alg1.l11.m1.1.1.3.3.2">∇</ci><apply id="alg1.l11.m1.1.1.3.3.3.cmml" xref="alg1.l11.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.3.3.3.1.cmml" xref="alg1.l11.m1.1.1.3.3.3">subscript</csymbol><ci id="alg1.l11.m1.1.1.3.3.3.2.cmml" xref="alg1.l11.m1.1.1.3.3.3.2">𝜓</ci><ci id="alg1.l11.m1.1.1.3.3.3.3.cmml" xref="alg1.l11.m1.1.1.3.3.3.3">𝑑</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l11.m1.1c">\psi_{d}\leftarrow\psi_{d}+\nabla_{\psi_{d}}</annotation></semantics></math>

</div>
<div id="alg1.l12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12:</span>        <span id="alg1.l12.1" class="ltx_text ltx_font_bold">end</span> <span id="alg1.l12.2" class="ltx_text ltx_font_bold">for</span>
</div>
<div id="alg1.l13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13:</span>        <math id="alg1.l13.m1.1" class="ltx_Math" alttext="\nabla_{\theta_{d}}\leftarrow\theta-\theta_{d}" display="inline"><semantics id="alg1.l13.m1.1a"><mrow id="alg1.l13.m1.1.1" xref="alg1.l13.m1.1.1.cmml"><msub id="alg1.l13.m1.1.1.2" xref="alg1.l13.m1.1.1.2.cmml"><mo id="alg1.l13.m1.1.1.2.2" xref="alg1.l13.m1.1.1.2.2.cmml">∇</mo><msub id="alg1.l13.m1.1.1.2.3" xref="alg1.l13.m1.1.1.2.3.cmml"><mi id="alg1.l13.m1.1.1.2.3.2" xref="alg1.l13.m1.1.1.2.3.2.cmml">θ</mi><mi id="alg1.l13.m1.1.1.2.3.3" xref="alg1.l13.m1.1.1.2.3.3.cmml">d</mi></msub></msub><mo stretchy="false" id="alg1.l13.m1.1.1.1" xref="alg1.l13.m1.1.1.1.cmml">←</mo><mrow id="alg1.l13.m1.1.1.3" xref="alg1.l13.m1.1.1.3.cmml"><mi id="alg1.l13.m1.1.1.3.2" xref="alg1.l13.m1.1.1.3.2.cmml">θ</mi><mo id="alg1.l13.m1.1.1.3.1" xref="alg1.l13.m1.1.1.3.1.cmml">−</mo><msub id="alg1.l13.m1.1.1.3.3" xref="alg1.l13.m1.1.1.3.3.cmml"><mi id="alg1.l13.m1.1.1.3.3.2" xref="alg1.l13.m1.1.1.3.3.2.cmml">θ</mi><mi id="alg1.l13.m1.1.1.3.3.3" xref="alg1.l13.m1.1.1.3.3.3.cmml">d</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l13.m1.1b"><apply id="alg1.l13.m1.1.1.cmml" xref="alg1.l13.m1.1.1"><ci id="alg1.l13.m1.1.1.1.cmml" xref="alg1.l13.m1.1.1.1">←</ci><apply id="alg1.l13.m1.1.1.2.cmml" xref="alg1.l13.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l13.m1.1.1.2.1.cmml" xref="alg1.l13.m1.1.1.2">subscript</csymbol><ci id="alg1.l13.m1.1.1.2.2.cmml" xref="alg1.l13.m1.1.1.2.2">∇</ci><apply id="alg1.l13.m1.1.1.2.3.cmml" xref="alg1.l13.m1.1.1.2.3"><csymbol cd="ambiguous" id="alg1.l13.m1.1.1.2.3.1.cmml" xref="alg1.l13.m1.1.1.2.3">subscript</csymbol><ci id="alg1.l13.m1.1.1.2.3.2.cmml" xref="alg1.l13.m1.1.1.2.3.2">𝜃</ci><ci id="alg1.l13.m1.1.1.2.3.3.cmml" xref="alg1.l13.m1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="alg1.l13.m1.1.1.3.cmml" xref="alg1.l13.m1.1.1.3"><minus id="alg1.l13.m1.1.1.3.1.cmml" xref="alg1.l13.m1.1.1.3.1"></minus><ci id="alg1.l13.m1.1.1.3.2.cmml" xref="alg1.l13.m1.1.1.3.2">𝜃</ci><apply id="alg1.l13.m1.1.1.3.3.cmml" xref="alg1.l13.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l13.m1.1.1.3.3.1.cmml" xref="alg1.l13.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l13.m1.1.1.3.3.2.cmml" xref="alg1.l13.m1.1.1.3.3.2">𝜃</ci><ci id="alg1.l13.m1.1.1.3.3.3.cmml" xref="alg1.l13.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l13.m1.1c">\nabla_{\theta_{d}}\leftarrow\theta-\theta_{d}</annotation></semantics></math> 
</div>
<div id="alg1.l14" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14:</span>        <math id="alg1.l14.m1.1" class="ltx_Math" alttext="\nabla_{\phi_{d}}\leftarrow\phi-\phi_{d}" display="inline"><semantics id="alg1.l14.m1.1a"><mrow id="alg1.l14.m1.1.1" xref="alg1.l14.m1.1.1.cmml"><msub id="alg1.l14.m1.1.1.2" xref="alg1.l14.m1.1.1.2.cmml"><mo id="alg1.l14.m1.1.1.2.2" xref="alg1.l14.m1.1.1.2.2.cmml">∇</mo><msub id="alg1.l14.m1.1.1.2.3" xref="alg1.l14.m1.1.1.2.3.cmml"><mi id="alg1.l14.m1.1.1.2.3.2" xref="alg1.l14.m1.1.1.2.3.2.cmml">ϕ</mi><mi id="alg1.l14.m1.1.1.2.3.3" xref="alg1.l14.m1.1.1.2.3.3.cmml">d</mi></msub></msub><mo stretchy="false" id="alg1.l14.m1.1.1.1" xref="alg1.l14.m1.1.1.1.cmml">←</mo><mrow id="alg1.l14.m1.1.1.3" xref="alg1.l14.m1.1.1.3.cmml"><mi id="alg1.l14.m1.1.1.3.2" xref="alg1.l14.m1.1.1.3.2.cmml">ϕ</mi><mo id="alg1.l14.m1.1.1.3.1" xref="alg1.l14.m1.1.1.3.1.cmml">−</mo><msub id="alg1.l14.m1.1.1.3.3" xref="alg1.l14.m1.1.1.3.3.cmml"><mi id="alg1.l14.m1.1.1.3.3.2" xref="alg1.l14.m1.1.1.3.3.2.cmml">ϕ</mi><mi id="alg1.l14.m1.1.1.3.3.3" xref="alg1.l14.m1.1.1.3.3.3.cmml">d</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l14.m1.1b"><apply id="alg1.l14.m1.1.1.cmml" xref="alg1.l14.m1.1.1"><ci id="alg1.l14.m1.1.1.1.cmml" xref="alg1.l14.m1.1.1.1">←</ci><apply id="alg1.l14.m1.1.1.2.cmml" xref="alg1.l14.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l14.m1.1.1.2.1.cmml" xref="alg1.l14.m1.1.1.2">subscript</csymbol><ci id="alg1.l14.m1.1.1.2.2.cmml" xref="alg1.l14.m1.1.1.2.2">∇</ci><apply id="alg1.l14.m1.1.1.2.3.cmml" xref="alg1.l14.m1.1.1.2.3"><csymbol cd="ambiguous" id="alg1.l14.m1.1.1.2.3.1.cmml" xref="alg1.l14.m1.1.1.2.3">subscript</csymbol><ci id="alg1.l14.m1.1.1.2.3.2.cmml" xref="alg1.l14.m1.1.1.2.3.2">italic-ϕ</ci><ci id="alg1.l14.m1.1.1.2.3.3.cmml" xref="alg1.l14.m1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="alg1.l14.m1.1.1.3.cmml" xref="alg1.l14.m1.1.1.3"><minus id="alg1.l14.m1.1.1.3.1.cmml" xref="alg1.l14.m1.1.1.3.1"></minus><ci id="alg1.l14.m1.1.1.3.2.cmml" xref="alg1.l14.m1.1.1.3.2">italic-ϕ</ci><apply id="alg1.l14.m1.1.1.3.3.cmml" xref="alg1.l14.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l14.m1.1.1.3.3.1.cmml" xref="alg1.l14.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l14.m1.1.1.3.3.2.cmml" xref="alg1.l14.m1.1.1.3.3.2">italic-ϕ</ci><ci id="alg1.l14.m1.1.1.3.3.3.cmml" xref="alg1.l14.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l14.m1.1c">\nabla_{\phi_{d}}\leftarrow\phi-\phi_{d}</annotation></semantics></math> 
</div>
<div id="alg1.l15" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15:</span>        Return <math id="alg1.l15.m1.1" class="ltx_Math" alttext="\nabla_{\theta_{d}}" display="inline"><semantics id="alg1.l15.m1.1a"><msub id="alg1.l15.m1.1.1" xref="alg1.l15.m1.1.1.cmml"><mo id="alg1.l15.m1.1.1.2" xref="alg1.l15.m1.1.1.2.cmml">∇</mo><msub id="alg1.l15.m1.1.1.3" xref="alg1.l15.m1.1.1.3.cmml"><mi id="alg1.l15.m1.1.1.3.2" xref="alg1.l15.m1.1.1.3.2.cmml">θ</mi><mi id="alg1.l15.m1.1.1.3.3" xref="alg1.l15.m1.1.1.3.3.cmml">d</mi></msub></msub><annotation-xml encoding="MathML-Content" id="alg1.l15.m1.1b"><apply id="alg1.l15.m1.1.1.cmml" xref="alg1.l15.m1.1.1"><csymbol cd="ambiguous" id="alg1.l15.m1.1.1.1.cmml" xref="alg1.l15.m1.1.1">subscript</csymbol><ci id="alg1.l15.m1.1.1.2.cmml" xref="alg1.l15.m1.1.1.2">∇</ci><apply id="alg1.l15.m1.1.1.3.cmml" xref="alg1.l15.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l15.m1.1.1.3.1.cmml" xref="alg1.l15.m1.1.1.3">subscript</csymbol><ci id="alg1.l15.m1.1.1.3.2.cmml" xref="alg1.l15.m1.1.1.3.2">𝜃</ci><ci id="alg1.l15.m1.1.1.3.3.cmml" xref="alg1.l15.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l15.m1.1c">\nabla_{\theta_{d}}</annotation></semantics></math> and <math id="alg1.l15.m2.1" class="ltx_Math" alttext="\nabla_{\phi_{d}}" display="inline"><semantics id="alg1.l15.m2.1a"><msub id="alg1.l15.m2.1.1" xref="alg1.l15.m2.1.1.cmml"><mo id="alg1.l15.m2.1.1.2" xref="alg1.l15.m2.1.1.2.cmml">∇</mo><msub id="alg1.l15.m2.1.1.3" xref="alg1.l15.m2.1.1.3.cmml"><mi id="alg1.l15.m2.1.1.3.2" xref="alg1.l15.m2.1.1.3.2.cmml">ϕ</mi><mi id="alg1.l15.m2.1.1.3.3" xref="alg1.l15.m2.1.1.3.3.cmml">d</mi></msub></msub><annotation-xml encoding="MathML-Content" id="alg1.l15.m2.1b"><apply id="alg1.l15.m2.1.1.cmml" xref="alg1.l15.m2.1.1"><csymbol cd="ambiguous" id="alg1.l15.m2.1.1.1.cmml" xref="alg1.l15.m2.1.1">subscript</csymbol><ci id="alg1.l15.m2.1.1.2.cmml" xref="alg1.l15.m2.1.1.2">∇</ci><apply id="alg1.l15.m2.1.1.3.cmml" xref="alg1.l15.m2.1.1.3"><csymbol cd="ambiguous" id="alg1.l15.m2.1.1.3.1.cmml" xref="alg1.l15.m2.1.1.3">subscript</csymbol><ci id="alg1.l15.m2.1.1.3.2.cmml" xref="alg1.l15.m2.1.1.3.2">italic-ϕ</ci><ci id="alg1.l15.m2.1.1.3.3.cmml" xref="alg1.l15.m2.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l15.m2.1c">\nabla_{\phi_{d}}</annotation></semantics></math> to the server

</div>
<div id="alg1.l16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16:</span>     <span id="alg1.l16.1" class="ltx_text ltx_font_bold">end</span> <span id="alg1.l16.2" class="ltx_text ltx_font_bold">for</span>
</div>
<div id="alg1.l17" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17:</span>     <math id="alg1.l17.m1.1" class="ltx_Math" alttext="\nabla_{\theta}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\theta_{d}}" display="inline"><semantics id="alg1.l17.m1.1a"><mrow id="alg1.l17.m1.1.1" xref="alg1.l17.m1.1.1.cmml"><msub id="alg1.l17.m1.1.1.2" xref="alg1.l17.m1.1.1.2.cmml"><mo id="alg1.l17.m1.1.1.2.2" xref="alg1.l17.m1.1.1.2.2.cmml">∇</mo><mi id="alg1.l17.m1.1.1.2.3" xref="alg1.l17.m1.1.1.2.3.cmml">θ</mi></msub><mo stretchy="false" id="alg1.l17.m1.1.1.1" xref="alg1.l17.m1.1.1.1.cmml">←</mo><mrow id="alg1.l17.m1.1.1.3" xref="alg1.l17.m1.1.1.3.cmml"><mfrac id="alg1.l17.m1.1.1.3.2" xref="alg1.l17.m1.1.1.3.2.cmml"><mn id="alg1.l17.m1.1.1.3.2.2" xref="alg1.l17.m1.1.1.3.2.2.cmml">1</mn><mi id="alg1.l17.m1.1.1.3.2.3" xref="alg1.l17.m1.1.1.3.2.3.cmml">D</mi></mfrac><mo lspace="0em" rspace="0em" id="alg1.l17.m1.1.1.3.1" xref="alg1.l17.m1.1.1.3.1.cmml">​</mo><mrow id="alg1.l17.m1.1.1.3.3" xref="alg1.l17.m1.1.1.3.3.cmml"><msubsup id="alg1.l17.m1.1.1.3.3.1" xref="alg1.l17.m1.1.1.3.3.1.cmml"><mo id="alg1.l17.m1.1.1.3.3.1.2.2" xref="alg1.l17.m1.1.1.3.3.1.2.2.cmml">∑</mo><mi id="alg1.l17.m1.1.1.3.3.1.2.3" xref="alg1.l17.m1.1.1.3.3.1.2.3.cmml">d</mi><mi id="alg1.l17.m1.1.1.3.3.1.3" xref="alg1.l17.m1.1.1.3.3.1.3.cmml">D</mi></msubsup><msub id="alg1.l17.m1.1.1.3.3.2" xref="alg1.l17.m1.1.1.3.3.2.cmml"><mo id="alg1.l17.m1.1.1.3.3.2.2" xref="alg1.l17.m1.1.1.3.3.2.2.cmml">∇</mo><msub id="alg1.l17.m1.1.1.3.3.2.3" xref="alg1.l17.m1.1.1.3.3.2.3.cmml"><mi id="alg1.l17.m1.1.1.3.3.2.3.2" xref="alg1.l17.m1.1.1.3.3.2.3.2.cmml">θ</mi><mi id="alg1.l17.m1.1.1.3.3.2.3.3" xref="alg1.l17.m1.1.1.3.3.2.3.3.cmml">d</mi></msub></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l17.m1.1b"><apply id="alg1.l17.m1.1.1.cmml" xref="alg1.l17.m1.1.1"><ci id="alg1.l17.m1.1.1.1.cmml" xref="alg1.l17.m1.1.1.1">←</ci><apply id="alg1.l17.m1.1.1.2.cmml" xref="alg1.l17.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.2.1.cmml" xref="alg1.l17.m1.1.1.2">subscript</csymbol><ci id="alg1.l17.m1.1.1.2.2.cmml" xref="alg1.l17.m1.1.1.2.2">∇</ci><ci id="alg1.l17.m1.1.1.2.3.cmml" xref="alg1.l17.m1.1.1.2.3">𝜃</ci></apply><apply id="alg1.l17.m1.1.1.3.cmml" xref="alg1.l17.m1.1.1.3"><times id="alg1.l17.m1.1.1.3.1.cmml" xref="alg1.l17.m1.1.1.3.1"></times><apply id="alg1.l17.m1.1.1.3.2.cmml" xref="alg1.l17.m1.1.1.3.2"><divide id="alg1.l17.m1.1.1.3.2.1.cmml" xref="alg1.l17.m1.1.1.3.2"></divide><cn type="integer" id="alg1.l17.m1.1.1.3.2.2.cmml" xref="alg1.l17.m1.1.1.3.2.2">1</cn><ci id="alg1.l17.m1.1.1.3.2.3.cmml" xref="alg1.l17.m1.1.1.3.2.3">𝐷</ci></apply><apply id="alg1.l17.m1.1.1.3.3.cmml" xref="alg1.l17.m1.1.1.3.3"><apply id="alg1.l17.m1.1.1.3.3.1.cmml" xref="alg1.l17.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.3.3.1.1.cmml" xref="alg1.l17.m1.1.1.3.3.1">superscript</csymbol><apply id="alg1.l17.m1.1.1.3.3.1.2.cmml" xref="alg1.l17.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.3.3.1.2.1.cmml" xref="alg1.l17.m1.1.1.3.3.1">subscript</csymbol><sum id="alg1.l17.m1.1.1.3.3.1.2.2.cmml" xref="alg1.l17.m1.1.1.3.3.1.2.2"></sum><ci id="alg1.l17.m1.1.1.3.3.1.2.3.cmml" xref="alg1.l17.m1.1.1.3.3.1.2.3">𝑑</ci></apply><ci id="alg1.l17.m1.1.1.3.3.1.3.cmml" xref="alg1.l17.m1.1.1.3.3.1.3">𝐷</ci></apply><apply id="alg1.l17.m1.1.1.3.3.2.cmml" xref="alg1.l17.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.3.3.2.1.cmml" xref="alg1.l17.m1.1.1.3.3.2">subscript</csymbol><ci id="alg1.l17.m1.1.1.3.3.2.2.cmml" xref="alg1.l17.m1.1.1.3.3.2.2">∇</ci><apply id="alg1.l17.m1.1.1.3.3.2.3.cmml" xref="alg1.l17.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.3.3.2.3.1.cmml" xref="alg1.l17.m1.1.1.3.3.2.3">subscript</csymbol><ci id="alg1.l17.m1.1.1.3.3.2.3.2.cmml" xref="alg1.l17.m1.1.1.3.3.2.3.2">𝜃</ci><ci id="alg1.l17.m1.1.1.3.3.2.3.3.cmml" xref="alg1.l17.m1.1.1.3.3.2.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l17.m1.1c">\nabla_{\theta}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\theta_{d}}</annotation></semantics></math> 
</div>
<div id="alg1.l18" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18:</span>     <math id="alg1.l18.m1.1" class="ltx_Math" alttext="\nabla_{\phi}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\phi_{d}}" display="inline"><semantics id="alg1.l18.m1.1a"><mrow id="alg1.l18.m1.1.1" xref="alg1.l18.m1.1.1.cmml"><msub id="alg1.l18.m1.1.1.2" xref="alg1.l18.m1.1.1.2.cmml"><mo id="alg1.l18.m1.1.1.2.2" xref="alg1.l18.m1.1.1.2.2.cmml">∇</mo><mi id="alg1.l18.m1.1.1.2.3" xref="alg1.l18.m1.1.1.2.3.cmml">ϕ</mi></msub><mo stretchy="false" id="alg1.l18.m1.1.1.1" xref="alg1.l18.m1.1.1.1.cmml">←</mo><mrow id="alg1.l18.m1.1.1.3" xref="alg1.l18.m1.1.1.3.cmml"><mfrac id="alg1.l18.m1.1.1.3.2" xref="alg1.l18.m1.1.1.3.2.cmml"><mn id="alg1.l18.m1.1.1.3.2.2" xref="alg1.l18.m1.1.1.3.2.2.cmml">1</mn><mi id="alg1.l18.m1.1.1.3.2.3" xref="alg1.l18.m1.1.1.3.2.3.cmml">D</mi></mfrac><mo lspace="0em" rspace="0em" id="alg1.l18.m1.1.1.3.1" xref="alg1.l18.m1.1.1.3.1.cmml">​</mo><mrow id="alg1.l18.m1.1.1.3.3" xref="alg1.l18.m1.1.1.3.3.cmml"><msubsup id="alg1.l18.m1.1.1.3.3.1" xref="alg1.l18.m1.1.1.3.3.1.cmml"><mo id="alg1.l18.m1.1.1.3.3.1.2.2" xref="alg1.l18.m1.1.1.3.3.1.2.2.cmml">∑</mo><mi id="alg1.l18.m1.1.1.3.3.1.2.3" xref="alg1.l18.m1.1.1.3.3.1.2.3.cmml">d</mi><mi id="alg1.l18.m1.1.1.3.3.1.3" xref="alg1.l18.m1.1.1.3.3.1.3.cmml">D</mi></msubsup><msub id="alg1.l18.m1.1.1.3.3.2" xref="alg1.l18.m1.1.1.3.3.2.cmml"><mo id="alg1.l18.m1.1.1.3.3.2.2" xref="alg1.l18.m1.1.1.3.3.2.2.cmml">∇</mo><msub id="alg1.l18.m1.1.1.3.3.2.3" xref="alg1.l18.m1.1.1.3.3.2.3.cmml"><mi id="alg1.l18.m1.1.1.3.3.2.3.2" xref="alg1.l18.m1.1.1.3.3.2.3.2.cmml">ϕ</mi><mi id="alg1.l18.m1.1.1.3.3.2.3.3" xref="alg1.l18.m1.1.1.3.3.2.3.3.cmml">d</mi></msub></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l18.m1.1b"><apply id="alg1.l18.m1.1.1.cmml" xref="alg1.l18.m1.1.1"><ci id="alg1.l18.m1.1.1.1.cmml" xref="alg1.l18.m1.1.1.1">←</ci><apply id="alg1.l18.m1.1.1.2.cmml" xref="alg1.l18.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.2.1.cmml" xref="alg1.l18.m1.1.1.2">subscript</csymbol><ci id="alg1.l18.m1.1.1.2.2.cmml" xref="alg1.l18.m1.1.1.2.2">∇</ci><ci id="alg1.l18.m1.1.1.2.3.cmml" xref="alg1.l18.m1.1.1.2.3">italic-ϕ</ci></apply><apply id="alg1.l18.m1.1.1.3.cmml" xref="alg1.l18.m1.1.1.3"><times id="alg1.l18.m1.1.1.3.1.cmml" xref="alg1.l18.m1.1.1.3.1"></times><apply id="alg1.l18.m1.1.1.3.2.cmml" xref="alg1.l18.m1.1.1.3.2"><divide id="alg1.l18.m1.1.1.3.2.1.cmml" xref="alg1.l18.m1.1.1.3.2"></divide><cn type="integer" id="alg1.l18.m1.1.1.3.2.2.cmml" xref="alg1.l18.m1.1.1.3.2.2">1</cn><ci id="alg1.l18.m1.1.1.3.2.3.cmml" xref="alg1.l18.m1.1.1.3.2.3">𝐷</ci></apply><apply id="alg1.l18.m1.1.1.3.3.cmml" xref="alg1.l18.m1.1.1.3.3"><apply id="alg1.l18.m1.1.1.3.3.1.cmml" xref="alg1.l18.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.3.3.1.1.cmml" xref="alg1.l18.m1.1.1.3.3.1">superscript</csymbol><apply id="alg1.l18.m1.1.1.3.3.1.2.cmml" xref="alg1.l18.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.3.3.1.2.1.cmml" xref="alg1.l18.m1.1.1.3.3.1">subscript</csymbol><sum id="alg1.l18.m1.1.1.3.3.1.2.2.cmml" xref="alg1.l18.m1.1.1.3.3.1.2.2"></sum><ci id="alg1.l18.m1.1.1.3.3.1.2.3.cmml" xref="alg1.l18.m1.1.1.3.3.1.2.3">𝑑</ci></apply><ci id="alg1.l18.m1.1.1.3.3.1.3.cmml" xref="alg1.l18.m1.1.1.3.3.1.3">𝐷</ci></apply><apply id="alg1.l18.m1.1.1.3.3.2.cmml" xref="alg1.l18.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.3.3.2.1.cmml" xref="alg1.l18.m1.1.1.3.3.2">subscript</csymbol><ci id="alg1.l18.m1.1.1.3.3.2.2.cmml" xref="alg1.l18.m1.1.1.3.3.2.2">∇</ci><apply id="alg1.l18.m1.1.1.3.3.2.3.cmml" xref="alg1.l18.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.3.3.2.3.1.cmml" xref="alg1.l18.m1.1.1.3.3.2.3">subscript</csymbol><ci id="alg1.l18.m1.1.1.3.3.2.3.2.cmml" xref="alg1.l18.m1.1.1.3.3.2.3.2">italic-ϕ</ci><ci id="alg1.l18.m1.1.1.3.3.2.3.3.cmml" xref="alg1.l18.m1.1.1.3.3.2.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l18.m1.1c">\nabla_{\phi}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\phi_{d}}</annotation></semantics></math> 
</div>
<div id="alg1.l19" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19:</span>     <math id="alg1.l19.m1.1" class="ltx_Math" alttext="\theta\leftarrow\theta+\nabla_{\theta}" display="inline"><semantics id="alg1.l19.m1.1a"><mrow id="alg1.l19.m1.1.1" xref="alg1.l19.m1.1.1.cmml"><mi id="alg1.l19.m1.1.1.2" xref="alg1.l19.m1.1.1.2.cmml">θ</mi><mo stretchy="false" id="alg1.l19.m1.1.1.1" xref="alg1.l19.m1.1.1.1.cmml">←</mo><mrow id="alg1.l19.m1.1.1.3" xref="alg1.l19.m1.1.1.3.cmml"><mi id="alg1.l19.m1.1.1.3.2" xref="alg1.l19.m1.1.1.3.2.cmml">θ</mi><mo id="alg1.l19.m1.1.1.3.1" xref="alg1.l19.m1.1.1.3.1.cmml">+</mo><msub id="alg1.l19.m1.1.1.3.3" xref="alg1.l19.m1.1.1.3.3.cmml"><mo id="alg1.l19.m1.1.1.3.3.2" xref="alg1.l19.m1.1.1.3.3.2.cmml">∇</mo><mi id="alg1.l19.m1.1.1.3.3.3" xref="alg1.l19.m1.1.1.3.3.3.cmml">θ</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l19.m1.1b"><apply id="alg1.l19.m1.1.1.cmml" xref="alg1.l19.m1.1.1"><ci id="alg1.l19.m1.1.1.1.cmml" xref="alg1.l19.m1.1.1.1">←</ci><ci id="alg1.l19.m1.1.1.2.cmml" xref="alg1.l19.m1.1.1.2">𝜃</ci><apply id="alg1.l19.m1.1.1.3.cmml" xref="alg1.l19.m1.1.1.3"><plus id="alg1.l19.m1.1.1.3.1.cmml" xref="alg1.l19.m1.1.1.3.1"></plus><ci id="alg1.l19.m1.1.1.3.2.cmml" xref="alg1.l19.m1.1.1.3.2">𝜃</ci><apply id="alg1.l19.m1.1.1.3.3.cmml" xref="alg1.l19.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l19.m1.1.1.3.3.1.cmml" xref="alg1.l19.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l19.m1.1.1.3.3.2.cmml" xref="alg1.l19.m1.1.1.3.3.2">∇</ci><ci id="alg1.l19.m1.1.1.3.3.3.cmml" xref="alg1.l19.m1.1.1.3.3.3">𝜃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l19.m1.1c">\theta\leftarrow\theta+\nabla_{\theta}</annotation></semantics></math>

</div>
<div id="alg1.l20" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20:</span>     <math id="alg1.l20.m1.1" class="ltx_Math" alttext="\phi\leftarrow\phi+\nabla_{\phi}" display="inline"><semantics id="alg1.l20.m1.1a"><mrow id="alg1.l20.m1.1.1" xref="alg1.l20.m1.1.1.cmml"><mi id="alg1.l20.m1.1.1.2" xref="alg1.l20.m1.1.1.2.cmml">ϕ</mi><mo stretchy="false" id="alg1.l20.m1.1.1.1" xref="alg1.l20.m1.1.1.1.cmml">←</mo><mrow id="alg1.l20.m1.1.1.3" xref="alg1.l20.m1.1.1.3.cmml"><mi id="alg1.l20.m1.1.1.3.2" xref="alg1.l20.m1.1.1.3.2.cmml">ϕ</mi><mo id="alg1.l20.m1.1.1.3.1" xref="alg1.l20.m1.1.1.3.1.cmml">+</mo><msub id="alg1.l20.m1.1.1.3.3" xref="alg1.l20.m1.1.1.3.3.cmml"><mo id="alg1.l20.m1.1.1.3.3.2" xref="alg1.l20.m1.1.1.3.3.2.cmml">∇</mo><mi id="alg1.l20.m1.1.1.3.3.3" xref="alg1.l20.m1.1.1.3.3.3.cmml">ϕ</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l20.m1.1b"><apply id="alg1.l20.m1.1.1.cmml" xref="alg1.l20.m1.1.1"><ci id="alg1.l20.m1.1.1.1.cmml" xref="alg1.l20.m1.1.1.1">←</ci><ci id="alg1.l20.m1.1.1.2.cmml" xref="alg1.l20.m1.1.1.2">italic-ϕ</ci><apply id="alg1.l20.m1.1.1.3.cmml" xref="alg1.l20.m1.1.1.3"><plus id="alg1.l20.m1.1.1.3.1.cmml" xref="alg1.l20.m1.1.1.3.1"></plus><ci id="alg1.l20.m1.1.1.3.2.cmml" xref="alg1.l20.m1.1.1.3.2">italic-ϕ</ci><apply id="alg1.l20.m1.1.1.3.3.cmml" xref="alg1.l20.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l20.m1.1.1.3.3.1.cmml" xref="alg1.l20.m1.1.1.3.3">subscript</csymbol><ci id="alg1.l20.m1.1.1.3.3.2.cmml" xref="alg1.l20.m1.1.1.3.3.2">∇</ci><ci id="alg1.l20.m1.1.1.3.3.3.cmml" xref="alg1.l20.m1.1.1.3.3.3">italic-ϕ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l20.m1.1c">\phi\leftarrow\phi+\nabla_{\phi}</annotation></semantics></math>

</div>
<div id="alg1.l21" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21:</span>  <span id="alg1.l21.1" class="ltx_text ltx_font_bold">end</span> <span id="alg1.l21.2" class="ltx_text ltx_font_bold">for</span>
</div>
</div>
</figure>
<div id="S3.SS2.p6" class="ltx_para ltx_noindent">
<table id="S3.E1" class="ltx_equationgroup ltx_eqn_table">
<tbody>
<tr id="S3.E1X" class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S3.E1X.2.1.1.m1.6" class="ltx_Math" alttext="\displaystyle\phi_{d}=\phi_{d}+\nabla_{\phi}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="S3.E1X.2.1.1.m1.6a"><mrow id="S3.E1X.2.1.1.m1.6.6" xref="S3.E1X.2.1.1.m1.6.6.cmml"><msub id="S3.E1X.2.1.1.m1.6.6.6" xref="S3.E1X.2.1.1.m1.6.6.6.cmml"><mi id="S3.E1X.2.1.1.m1.6.6.6.2" xref="S3.E1X.2.1.1.m1.6.6.6.2.cmml">ϕ</mi><mi id="S3.E1X.2.1.1.m1.6.6.6.3" xref="S3.E1X.2.1.1.m1.6.6.6.3.cmml">d</mi></msub><mo id="S3.E1X.2.1.1.m1.6.6.5" xref="S3.E1X.2.1.1.m1.6.6.5.cmml">=</mo><mrow id="S3.E1X.2.1.1.m1.6.6.4" xref="S3.E1X.2.1.1.m1.6.6.4.cmml"><msub id="S3.E1X.2.1.1.m1.6.6.4.6" xref="S3.E1X.2.1.1.m1.6.6.4.6.cmml"><mi id="S3.E1X.2.1.1.m1.6.6.4.6.2" xref="S3.E1X.2.1.1.m1.6.6.4.6.2.cmml">ϕ</mi><mi id="S3.E1X.2.1.1.m1.6.6.4.6.3" xref="S3.E1X.2.1.1.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="S3.E1X.2.1.1.m1.6.6.4.5" xref="S3.E1X.2.1.1.m1.6.6.4.5.cmml">+</mo><mrow id="S3.E1X.2.1.1.m1.6.6.4.4" xref="S3.E1X.2.1.1.m1.6.6.4.4.cmml"><mrow id="S3.E1X.2.1.1.m1.6.6.4.4.6" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.cmml"><msub id="S3.E1X.2.1.1.m1.6.6.4.4.6.1" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.2" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.3" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1.3.cmml">ϕ</mi></msub><mi class="ltx_font_mathcaligraphic" id="S3.E1X.2.1.1.m1.6.6.4.4.6.2" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="S3.E1X.2.1.1.m1.6.6.4.4.5" xref="S3.E1X.2.1.1.m1.6.6.4.4.5.cmml">​</mo><mrow id="S3.E1X.2.1.1.m1.6.6.4.4.4.4" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.5" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml">(</mo><msub id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.cmml"><mi id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.2" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.3" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.6" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2" xref="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.cmml"><mi id="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.2" xref="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="S3.E1X.2.1.1.m1.2.2.2.4" xref="S3.E1X.2.1.1.m1.2.2.2.3.cmml"><mi id="S3.E1X.2.1.1.m1.1.1.1.1" xref="S3.E1X.2.1.1.m1.1.1.1.1.cmml">d</mi><mo id="S3.E1X.2.1.1.m1.2.2.2.4.1" xref="S3.E1X.2.1.1.m1.2.2.2.3.cmml">,</mo><mi id="S3.E1X.2.1.1.m1.2.2.2.2" xref="S3.E1X.2.1.1.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.7" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.cmml"><mi id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.2" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.3" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.8" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.cmml"><mi id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.2" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.3" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.9" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1X.2.1.1.m1.6b"><apply id="S3.E1X.2.1.1.m1.6.6.cmml" xref="S3.E1X.2.1.1.m1.6.6"><eq id="S3.E1X.2.1.1.m1.6.6.5.cmml" xref="S3.E1X.2.1.1.m1.6.6.5"></eq><apply id="S3.E1X.2.1.1.m1.6.6.6.cmml" xref="S3.E1X.2.1.1.m1.6.6.6"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.6.6.6.1.cmml" xref="S3.E1X.2.1.1.m1.6.6.6">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.6.6.6.2.cmml" xref="S3.E1X.2.1.1.m1.6.6.6.2">italic-ϕ</ci><ci id="S3.E1X.2.1.1.m1.6.6.6.3.cmml" xref="S3.E1X.2.1.1.m1.6.6.6.3">𝑑</ci></apply><apply id="S3.E1X.2.1.1.m1.6.6.4.cmml" xref="S3.E1X.2.1.1.m1.6.6.4"><plus id="S3.E1X.2.1.1.m1.6.6.4.5.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.5"></plus><apply id="S3.E1X.2.1.1.m1.6.6.4.6.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.6"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.6.6.4.6.1.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.6">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.6.6.4.6.2.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.6.2">italic-ϕ</ci><ci id="S3.E1X.2.1.1.m1.6.6.4.6.3.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.6.3">𝑑</ci></apply><apply id="S3.E1X.2.1.1.m1.6.6.4.4.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4"><times id="S3.E1X.2.1.1.m1.6.6.4.4.5.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.5"></times><apply id="S3.E1X.2.1.1.m1.6.6.4.4.6.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6"><apply id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.1.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.2.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1.2">∇</ci><ci id="S3.E1X.2.1.1.m1.6.6.4.4.6.1.3.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.1.3">italic-ϕ</ci></apply><ci id="S3.E1X.2.1.1.m1.6.6.4.4.6.2.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="S3.E1X.2.1.1.m1.6.6.4.4.4.5.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4"><apply id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.cmml" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.1.cmml" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.3.cmml" xref="S3.E1X.2.1.1.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.cmml" xref="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.1.cmml" xref="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.2.cmml" xref="S3.E1X.2.1.1.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="S3.E1X.2.1.1.m1.2.2.2.3.cmml" xref="S3.E1X.2.1.1.m1.2.2.2.4"><ci id="S3.E1X.2.1.1.m1.1.1.1.1.cmml" xref="S3.E1X.2.1.1.m1.1.1.1.1">𝑑</ci><ci id="S3.E1X.2.1.1.m1.2.2.2.2.cmml" xref="S3.E1X.2.1.1.m1.2.2.2.2">𝑐</ci></list></apply><apply id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.cmml" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.1.cmml" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.2.cmml" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.3.cmml" xref="S3.E1X.2.1.1.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.1.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.2.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.3.cmml" xref="S3.E1X.2.1.1.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1X.2.1.1.m1.6c">\displaystyle\phi_{d}=\phi_{d}+\nabla_{\phi}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td rowspan="2" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right"><span class="ltx_tag ltx_tag_equationgroup ltx_align_right">(1)</span></td>
</tr>
<tr id="S3.E1Xa" class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S3.E1Xa.2.1.1.m1.6" class="ltx_Math" alttext="\displaystyle\psi_{d}=\psi_{d}+\nabla_{\psi}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="S3.E1Xa.2.1.1.m1.6a"><mrow id="S3.E1Xa.2.1.1.m1.6.6" xref="S3.E1Xa.2.1.1.m1.6.6.cmml"><msub id="S3.E1Xa.2.1.1.m1.6.6.6" xref="S3.E1Xa.2.1.1.m1.6.6.6.cmml"><mi id="S3.E1Xa.2.1.1.m1.6.6.6.2" xref="S3.E1Xa.2.1.1.m1.6.6.6.2.cmml">ψ</mi><mi id="S3.E1Xa.2.1.1.m1.6.6.6.3" xref="S3.E1Xa.2.1.1.m1.6.6.6.3.cmml">d</mi></msub><mo id="S3.E1Xa.2.1.1.m1.6.6.5" xref="S3.E1Xa.2.1.1.m1.6.6.5.cmml">=</mo><mrow id="S3.E1Xa.2.1.1.m1.6.6.4" xref="S3.E1Xa.2.1.1.m1.6.6.4.cmml"><msub id="S3.E1Xa.2.1.1.m1.6.6.4.6" xref="S3.E1Xa.2.1.1.m1.6.6.4.6.cmml"><mi id="S3.E1Xa.2.1.1.m1.6.6.4.6.2" xref="S3.E1Xa.2.1.1.m1.6.6.4.6.2.cmml">ψ</mi><mi id="S3.E1Xa.2.1.1.m1.6.6.4.6.3" xref="S3.E1Xa.2.1.1.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="S3.E1Xa.2.1.1.m1.6.6.4.5" xref="S3.E1Xa.2.1.1.m1.6.6.4.5.cmml">+</mo><mrow id="S3.E1Xa.2.1.1.m1.6.6.4.4" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.cmml"><mrow id="S3.E1Xa.2.1.1.m1.6.6.4.4.6" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.cmml"><msub id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.2" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.3" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.3.cmml">ψ</mi></msub><mi class="ltx_font_mathcaligraphic" id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.2" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="S3.E1Xa.2.1.1.m1.6.6.4.4.5" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.5.cmml">​</mo><mrow id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.5" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml">(</mo><msub id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.cmml"><mi id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.2" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.3" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.6" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2" xref="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.cmml"><mi id="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.2" xref="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="S3.E1Xa.2.1.1.m1.2.2.2.4" xref="S3.E1Xa.2.1.1.m1.2.2.2.3.cmml"><mi id="S3.E1Xa.2.1.1.m1.1.1.1.1" xref="S3.E1Xa.2.1.1.m1.1.1.1.1.cmml">d</mi><mo id="S3.E1Xa.2.1.1.m1.2.2.2.4.1" xref="S3.E1Xa.2.1.1.m1.2.2.2.3.cmml">,</mo><mi id="S3.E1Xa.2.1.1.m1.2.2.2.2" xref="S3.E1Xa.2.1.1.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.7" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.cmml"><mi id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.2" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.3" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.8" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml">,</mo><msub id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.cmml"><mi id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.2" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.3" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.9" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1Xa.2.1.1.m1.6b"><apply id="S3.E1Xa.2.1.1.m1.6.6.cmml" xref="S3.E1Xa.2.1.1.m1.6.6"><eq id="S3.E1Xa.2.1.1.m1.6.6.5.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.5"></eq><apply id="S3.E1Xa.2.1.1.m1.6.6.6.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.6"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.6.6.6.1.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.6">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.6.6.6.2.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.6.2">𝜓</ci><ci id="S3.E1Xa.2.1.1.m1.6.6.6.3.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.6.3">𝑑</ci></apply><apply id="S3.E1Xa.2.1.1.m1.6.6.4.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4"><plus id="S3.E1Xa.2.1.1.m1.6.6.4.5.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.5"></plus><apply id="S3.E1Xa.2.1.1.m1.6.6.4.6.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.6"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.6.6.4.6.1.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.6">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.6.6.4.6.2.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.6.2">𝜓</ci><ci id="S3.E1Xa.2.1.1.m1.6.6.4.6.3.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.6.3">𝑑</ci></apply><apply id="S3.E1Xa.2.1.1.m1.6.6.4.4.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4"><times id="S3.E1Xa.2.1.1.m1.6.6.4.4.5.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.5"></times><apply id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6"><apply id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.1.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.2.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.2">∇</ci><ci id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.3.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.1.3">𝜓</ci></apply><ci id="S3.E1Xa.2.1.1.m1.6.6.4.4.6.2.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.5.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4"><apply id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.cmml" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.3.cmml" xref="S3.E1Xa.2.1.1.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.cmml" xref="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.1.cmml" xref="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.2.cmml" xref="S3.E1Xa.2.1.1.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="S3.E1Xa.2.1.1.m1.2.2.2.3.cmml" xref="S3.E1Xa.2.1.1.m1.2.2.2.4"><ci id="S3.E1Xa.2.1.1.m1.1.1.1.1.cmml" xref="S3.E1Xa.2.1.1.m1.1.1.1.1">𝑑</ci><ci id="S3.E1Xa.2.1.1.m1.2.2.2.2.cmml" xref="S3.E1Xa.2.1.1.m1.2.2.2.2">𝑐</ci></list></apply><apply id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.cmml" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.1.cmml" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.2.cmml" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.3.cmml" xref="S3.E1Xa.2.1.1.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.1.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.2.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.3.cmml" xref="S3.E1Xa.2.1.1.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1Xa.2.1.1.m1.6c">\displaystyle\psi_{d}=\psi_{d}+\nabla_{\psi}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</tbody>
</table>
<p id="S3.SS2.p6.5" class="ltx_p">In a typical federated averaging deployment, client devices will pull down global parameters, fine-tune on local datasets, and then test on held-out, local data.
With FedPC, the majority of the network’s parameters, <math id="S3.SS2.p6.1.m1.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS2.p6.1.m1.1a"><mi id="S3.SS2.p6.1.m1.1.1" xref="S3.SS2.p6.1.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.1.m1.1b"><ci id="S3.SS2.p6.1.m1.1.1.cmml" xref="S3.SS2.p6.1.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.1.m1.1c">\theta</annotation></semantics></math>, are frozen, reflecting a federated-learning setup with a more constrained computational budget when deploying large language models.
Using FedPC, clients pull down and subsequently freeze global parameters, <math id="S3.SS2.p6.2.m2.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS2.p6.2.m2.1a"><mi id="S3.SS2.p6.2.m2.1.1" xref="S3.SS2.p6.2.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.2.m2.1b"><ci id="S3.SS2.p6.2.m2.1.1.cmml" xref="S3.SS2.p6.2.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.2.m2.1c">\theta</annotation></semantics></math>, and either generate preference embeddings from observation, or only compute and apply gradients to context embeddings, <math id="S3.SS2.p6.3.m3.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="S3.SS2.p6.3.m3.1a"><mi id="S3.SS2.p6.3.m3.1.1" xref="S3.SS2.p6.3.m3.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.3.m3.1b"><ci id="S3.SS2.p6.3.m3.1.1.cmml" xref="S3.SS2.p6.3.m3.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.3.m3.1c">\phi</annotation></semantics></math>, and their local personal embedding <math id="S3.SS2.p6.4.m4.1" class="ltx_Math" alttext="\psi" display="inline"><semantics id="S3.SS2.p6.4.m4.1a"><mi id="S3.SS2.p6.4.m4.1.1" xref="S3.SS2.p6.4.m4.1.1.cmml">ψ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.4.m4.1b"><ci id="S3.SS2.p6.4.m4.1.1.cmml" xref="S3.SS2.p6.4.m4.1.1">𝜓</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.4.m4.1c">\psi</annotation></semantics></math>.
Relying on forward-propagation calls rather than backpropagation, or by computing gradients over only these embeddings, we reduce the computational overhead of FedPC while preserving or even improving upon accuracy relative to fine-tuning an entire model.
When testing over local data, all updates to context embeddings <math id="S3.SS2.p6.5.m5.1" class="ltx_Math" alttext="\nabla_{\phi}" display="inline"><semantics id="S3.SS2.p6.5.m5.1a"><msub id="S3.SS2.p6.5.m5.1.1" xref="S3.SS2.p6.5.m5.1.1.cmml"><mo id="S3.SS2.p6.5.m5.1.1.2" xref="S3.SS2.p6.5.m5.1.1.2.cmml">∇</mo><mi id="S3.SS2.p6.5.m5.1.1.3" xref="S3.SS2.p6.5.m5.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.5.m5.1b"><apply id="S3.SS2.p6.5.m5.1.1.cmml" xref="S3.SS2.p6.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.5.m5.1.1.1.cmml" xref="S3.SS2.p6.5.m5.1.1">subscript</csymbol><ci id="S3.SS2.p6.5.m5.1.1.2.cmml" xref="S3.SS2.p6.5.m5.1.1.2">∇</ci><ci id="S3.SS2.p6.5.m5.1.1.3.cmml" xref="S3.SS2.p6.5.m5.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.5.m5.1c">\nabla_{\phi}</annotation></semantics></math> are not sent to the central server.
Rather, these gradients are directly applied to the context embeddings for the current user, and then discarded. When instantiating a new embedding for a previously unseen user, we set the user’s embedding to the noisy-average of all known user embeddings.</p>
</div>
<section id="S3.SS2.SSS1" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.1 </span>Generating Preference Embeddings</h4>

<div id="S3.SS2.SSS1.p1" class="ltx_para ltx_noindent">
<p id="S3.SS2.SSS1.p1.2" class="ltx_p">To generate embeddings, we adopt a similar procedure to HyperNetworks <cite class="ltx_cite ltx_citemacro_citep">(Ha et al., <a href="#bib.bib37" title="" class="ltx_ref">2016</a>; Shamsian et al., <a href="#bib.bib38" title="" class="ltx_ref">2021</a>)</cite>, in which a neural network is trained to predict parameters of another network. In FedPC, an embedding-generator is trained to predict the parameters of preference embeddings (either personal or context).
To generate embeddings, we apply an additional transformer decoder block <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a href="#bib.bib39" title="" class="ltx_ref">2017</a>)</cite>, that uses a randomly-initialized personal embedding and a known context embedding as the queries, along with the word embeddings for the utterance as the keys and values to update the given preference embeddings.
We utilize separate generators to predict the personal embedding, <math id="S3.SS2.SSS1.p1.1.m1.1" class="ltx_Math" alttext="\psi_{d}" display="inline"><semantics id="S3.SS2.SSS1.p1.1.m1.1a"><msub id="S3.SS2.SSS1.p1.1.m1.1.1" xref="S3.SS2.SSS1.p1.1.m1.1.1.cmml"><mi id="S3.SS2.SSS1.p1.1.m1.1.1.2" xref="S3.SS2.SSS1.p1.1.m1.1.1.2.cmml">ψ</mi><mi id="S3.SS2.SSS1.p1.1.m1.1.1.3" xref="S3.SS2.SSS1.p1.1.m1.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.1.m1.1b"><apply id="S3.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.1.m1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p1.1.m1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.1.m1.1.1.2">𝜓</ci><ci id="S3.SS2.SSS1.p1.1.m1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.1.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.1.m1.1c">\psi_{d}</annotation></semantics></math>, and the context embedding, <math id="S3.SS2.SSS1.p1.2.m2.1" class="ltx_Math" alttext="\phi_{d}" display="inline"><semantics id="S3.SS2.SSS1.p1.2.m2.1a"><msub id="S3.SS2.SSS1.p1.2.m2.1.1" xref="S3.SS2.SSS1.p1.2.m2.1.1.cmml"><mi id="S3.SS2.SSS1.p1.2.m2.1.1.2" xref="S3.SS2.SSS1.p1.2.m2.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.SSS1.p1.2.m2.1.1.3" xref="S3.SS2.SSS1.p1.2.m2.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.2.m2.1b"><apply id="S3.SS2.SSS1.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.2.m2.1.1.1.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p1.2.m2.1.1.2.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1.2">italic-ϕ</ci><ci id="S3.SS2.SSS1.p1.2.m2.1.1.3.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.2.m2.1c">\phi_{d}</annotation></semantics></math>.
Specific training details for the embedding-generator applied to language-modeling are given in the appendix.</p>
</div>
<div id="S3.SS2.SSS1.p2" class="ltx_para ltx_noindent">
<p id="S3.SS2.SSS1.p2.1" class="ltx_p">While the embedding-generator must be learned from scratch during training, this method of predicting preference embeddings allows us to generate personal embeddings for previously <span id="S3.SS2.SSS1.p2.1.1" class="ltx_text ltx_font_italic">unseen</span> users when testing.
By predicting preference embeddings, we circumvent the need for expensive gradient calculation and on-device learning. Instead, new users can quickly reap the benefits of personalized predictions via a trained preference prediction module (i.e., the embedding generator), as opposed to conventional personalized federated learning methods that require slow and sample-inefficient on-device learning.</p>
</div>
</section>
</section>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>

<div id="S4.p1" class="ltx_para ltx_noindent">
<p id="S4.p1.1" class="ltx_p">We conduct several experiments to evaluate the sample efficiency, generalization, and runtime of our approach relative to baseline federated learning frameworks. In our experiments, we compare:</p>
<ul id="S4.I1" class="ltx_itemize">
<li id="S4.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S4.I1.i1.p1" class="ltx_para">
<p id="S4.I1.i1.p1.1" class="ltx_p">FedPC – Learning personal and context embeddings jointly with a global feature encoder, and performing local fine-tuning of personal and context embeddings on-device.</p>
</div>
</li>
<li id="S4.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S4.I1.i2.p1" class="ltx_para">
<p id="S4.I1.i2.p1.1" class="ltx_p">FedPC (Frozen) – As above but without local fine-tuning.</p>
</div>
</li>
<li id="S4.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S4.I1.i3.p1" class="ltx_para">
<p id="S4.I1.i3.p1.1" class="ltx_p">FedPC (Generated) – Learning an embedding generator and global feature encoder, and then using only generated embeddings at test-time.</p>
</div>
</li>
<li id="S4.I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S4.I1.i4.p1" class="ltx_para">
<p id="S4.I1.i4.p1.1" class="ltx_p">Split-Learning – Learning personal and context-specific model-heads jointly with a global feature encoder, and performing local fine-tuning of the personal and context-specific model heads on-device <cite class="ltx_cite ltx_citemacro_citep">(Dinh et al., <a href="#bib.bib13" title="" class="ltx_ref">2020</a>; Collins et al., <a href="#bib.bib12" title="" class="ltx_ref">2021</a>)</cite>.</p>
</div>
</li>
<li id="S4.I1.i5" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S4.I1.i5.p1" class="ltx_para ltx_noindent">
<p id="S4.I1.i5.p1.1" class="ltx_p">Meta-Learning – Learning a single global model for all users and contexts, and fine-tuning the shared model-head on-device <cite class="ltx_cite ltx_citemacro_citep">(Finn et al., <a href="#bib.bib10" title="" class="ltx_ref">2017</a>; Nichol et al., <a href="#bib.bib11" title="" class="ltx_ref">2018</a>)</cite>.</p>
</div>
</li>
</ul>
</div>
<div id="S4.p2" class="ltx_para ltx_noindent">
<p id="S4.p2.1" class="ltx_p">We conduct two sets of experiments to compare the above approaches on both sample efficiency and runtime efficiency. For the sample efficiency experiments, we present perplexity numbers for all methods across two versions of the dataset: known users and withheld users. For our known user experiments, all users are present in the training and testing set. For our withheld user experiments, a subset of users from each dataset is withheld entirely from training, and performance results are presented only for the held-out users. Perplexity is calculated over unseen utterances with the first three tokens of each utterance given as a prompt. Finally, we present qualitative results from our method, demonstrating the power of stylized generation for individual users.</p>
</div>
<div id="S4.p3" class="ltx_para ltx_noindent">
<p id="S4.p3.1" class="ltx_p">All models are initialized with the DistilGPT2 pre-trained model from Huggingface <cite class="ltx_cite ltx_citemacro_citep">(Wolf et al., <a href="#bib.bib40" title="" class="ltx_ref">2019</a>)</cite>, with all layers frozen. For Split-Learning and Meta-Learning, the last layer of the model is unfrozen. Training details are in the appendix.</p>
</div>
<figure id="S4.T1" class="ltx_table">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1: </span>Perplexity Showing Sample Efficiency Across All Methods for Known Users. Lower is Better.</figcaption>
<div id="S4.T1.40" class="ltx_inline-block ltx_align_center ltx_transformed_outer" style="width:433.6pt;height:181.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-19.3pt,8.1pt) scale(0.918387634369404,0.918387634369404) ;">
<table id="S4.T1.40.40" class="ltx_tabular ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S4.T1.40.40.41.1" class="ltx_tr">
<th id="S4.T1.40.40.41.1.1" class="ltx_td ltx_th ltx_th_column ltx_th_row"></th>
<th id="S4.T1.40.40.41.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r"># Samples</th>
<th id="S4.T1.40.40.41.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC</th>
<th id="S4.T1.40.40.41.1.4" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Frozen)</th>
<th id="S4.T1.40.40.41.1.5" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Generated)</th>
<th id="S4.T1.40.40.41.1.6" class="ltx_td ltx_align_center ltx_th ltx_th_column">Split-Learning</th>
<th id="S4.T1.40.40.41.1.7" class="ltx_td ltx_align_center ltx_th ltx_th_column">Meta-Learning</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S4.T1.40.40.42.1" class="ltx_tr">
<th id="S4.T1.40.40.42.1.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" rowspan="4">
<span id="S4.T1.40.40.42.1.1.1" class="ltx_inline-block ltx_parbox ltx_align_top" style="width:0.0pt;">
<span id="S4.T1.40.40.42.1.1.1.1" class="ltx_p">
<span id="S4.T1.40.40.42.1.1.1.1.1" class="ltx_inline-block ltx_transformed_outer" style="width:6.9pt;height:29.6pt;vertical-align:-11.3pt;"><span class="ltx_transformed_inner" style="width:29.6pt;transform:translate(-11.32pt,0pt) rotate(-90deg) ;">
<span id="S4.T1.40.40.42.1.1.1.1.1.1" class="ltx_p">Reddit</span>
</span></span></span>
</span>
</th>
<th id="S4.T1.40.40.42.1.2" class="ltx_td ltx_th ltx_th_row ltx_border_r ltx_border_t"></th>
<td id="S4.T1.40.40.42.1.3" class="ltx_td ltx_border_t"></td>
<td id="S4.T1.40.40.42.1.4" class="ltx_td ltx_border_t"></td>
<td id="S4.T1.40.40.42.1.5" class="ltx_td ltx_border_t"></td>
<td id="S4.T1.40.40.42.1.6" class="ltx_td ltx_border_t"></td>
<td id="S4.T1.40.40.42.1.7" class="ltx_td ltx_border_t"></td>
</tr>
<tr id="S4.T1.5.5.5" class="ltx_tr">
<th id="S4.T1.5.5.5.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">1</th>
<td id="S4.T1.1.1.1.1" class="ltx_td ltx_align_center">219.5 <math id="S4.T1.1.1.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.1.1.1.1.m1.1a"><mo id="S4.T1.1.1.1.1.m1.1.1" xref="S4.T1.1.1.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.1.1.1.1.m1.1b"><csymbol cd="latexml" id="S4.T1.1.1.1.1.m1.1.1.cmml" xref="S4.T1.1.1.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.1.1.1.1.m1.1c">\pm</annotation></semantics></math> 35.7</td>
<td id="S4.T1.2.2.2.2" class="ltx_td ltx_align_center">146.2 <math id="S4.T1.2.2.2.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.2.2.2.2.m1.1a"><mo id="S4.T1.2.2.2.2.m1.1.1" xref="S4.T1.2.2.2.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.2.2.2.2.m1.1b"><csymbol cd="latexml" id="S4.T1.2.2.2.2.m1.1.1.cmml" xref="S4.T1.2.2.2.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.2.2.2.2.m1.1c">\pm</annotation></semantics></math> 2.3</td>
<td id="S4.T1.3.3.3.3" class="ltx_td ltx_align_center"><span id="S4.T1.3.3.3.3.1" class="ltx_text ltx_font_bold">120.2 <math id="S4.T1.3.3.3.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.3.3.3.3.1.m1.1a"><mo id="S4.T1.3.3.3.3.1.m1.1.1" xref="S4.T1.3.3.3.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.3.3.3.3.1.m1.1b"><csymbol cd="latexml" id="S4.T1.3.3.3.3.1.m1.1.1.cmml" xref="S4.T1.3.3.3.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.3.3.3.3.1.m1.1c">\pm</annotation></semantics></math> 1.4</span></td>
<td id="S4.T1.4.4.4.4" class="ltx_td ltx_align_center">1297.5 <math id="S4.T1.4.4.4.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.4.4.4.4.m1.1a"><mo id="S4.T1.4.4.4.4.m1.1.1" xref="S4.T1.4.4.4.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.4.4.4.4.m1.1b"><csymbol cd="latexml" id="S4.T1.4.4.4.4.m1.1.1.cmml" xref="S4.T1.4.4.4.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.4.4.4.4.m1.1c">\pm</annotation></semantics></math> 21.9</td>
<td id="S4.T1.5.5.5.5" class="ltx_td ltx_align_center">226.2 <math id="S4.T1.5.5.5.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.5.5.5.5.m1.1a"><mo id="S4.T1.5.5.5.5.m1.1.1" xref="S4.T1.5.5.5.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.5.5.5.5.m1.1b"><csymbol cd="latexml" id="S4.T1.5.5.5.5.m1.1.1.cmml" xref="S4.T1.5.5.5.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.5.5.5.5.m1.1c">\pm</annotation></semantics></math> 3.7</td>
</tr>
<tr id="S4.T1.10.10.10" class="ltx_tr">
<th id="S4.T1.10.10.10.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">5</th>
<td id="S4.T1.6.6.6.1" class="ltx_td ltx_align_center">131.6 <math id="S4.T1.6.6.6.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.6.6.6.1.m1.1a"><mo id="S4.T1.6.6.6.1.m1.1.1" xref="S4.T1.6.6.6.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.6.6.6.1.m1.1b"><csymbol cd="latexml" id="S4.T1.6.6.6.1.m1.1.1.cmml" xref="S4.T1.6.6.6.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.6.6.6.1.m1.1c">\pm</annotation></semantics></math> 10.1</td>
<td id="S4.T1.7.7.7.2" class="ltx_td ltx_align_center">136.9 <math id="S4.T1.7.7.7.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.7.7.7.2.m1.1a"><mo id="S4.T1.7.7.7.2.m1.1.1" xref="S4.T1.7.7.7.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.7.7.7.2.m1.1b"><csymbol cd="latexml" id="S4.T1.7.7.7.2.m1.1.1.cmml" xref="S4.T1.7.7.7.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.7.7.7.2.m1.1c">\pm</annotation></semantics></math> 3.4</td>
<td id="S4.T1.8.8.8.3" class="ltx_td ltx_align_center"><span id="S4.T1.8.8.8.3.1" class="ltx_text ltx_font_bold">123.3 <math id="S4.T1.8.8.8.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.8.8.8.3.1.m1.1a"><mo id="S4.T1.8.8.8.3.1.m1.1.1" xref="S4.T1.8.8.8.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.8.8.8.3.1.m1.1b"><csymbol cd="latexml" id="S4.T1.8.8.8.3.1.m1.1.1.cmml" xref="S4.T1.8.8.8.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.8.8.8.3.1.m1.1c">\pm</annotation></semantics></math> 2.8</span></td>
<td id="S4.T1.9.9.9.4" class="ltx_td ltx_align_center">994.3 <math id="S4.T1.9.9.9.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.9.9.9.4.m1.1a"><mo id="S4.T1.9.9.9.4.m1.1.1" xref="S4.T1.9.9.9.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.9.9.9.4.m1.1b"><csymbol cd="latexml" id="S4.T1.9.9.9.4.m1.1.1.cmml" xref="S4.T1.9.9.9.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.9.9.9.4.m1.1c">\pm</annotation></semantics></math> 27.8</td>
<td id="S4.T1.10.10.10.5" class="ltx_td ltx_align_center">234.7 <math id="S4.T1.10.10.10.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.10.10.10.5.m1.1a"><mo id="S4.T1.10.10.10.5.m1.1.1" xref="S4.T1.10.10.10.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.10.10.10.5.m1.1b"><csymbol cd="latexml" id="S4.T1.10.10.10.5.m1.1.1.cmml" xref="S4.T1.10.10.10.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.10.10.10.5.m1.1c">\pm</annotation></semantics></math> 5.1</td>
</tr>
<tr id="S4.T1.15.15.15" class="ltx_tr">
<th id="S4.T1.15.15.15.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">15</th>
<td id="S4.T1.11.11.11.1" class="ltx_td ltx_align_center"><span id="S4.T1.11.11.11.1.1" class="ltx_text ltx_font_bold">111.4 <math id="S4.T1.11.11.11.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.11.11.11.1.1.m1.1a"><mo id="S4.T1.11.11.11.1.1.m1.1.1" xref="S4.T1.11.11.11.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.11.11.11.1.1.m1.1b"><csymbol cd="latexml" id="S4.T1.11.11.11.1.1.m1.1.1.cmml" xref="S4.T1.11.11.11.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.11.11.11.1.1.m1.1c">\pm</annotation></semantics></math> 3.5</span></td>
<td id="S4.T1.12.12.12.2" class="ltx_td ltx_align_center">132.6 <math id="S4.T1.12.12.12.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.12.12.12.2.m1.1a"><mo id="S4.T1.12.12.12.2.m1.1.1" xref="S4.T1.12.12.12.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.12.12.12.2.m1.1b"><csymbol cd="latexml" id="S4.T1.12.12.12.2.m1.1.1.cmml" xref="S4.T1.12.12.12.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.12.12.12.2.m1.1c">\pm</annotation></semantics></math> 4.7</td>
<td id="S4.T1.13.13.13.3" class="ltx_td ltx_align_center">120.0 <math id="S4.T1.13.13.13.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.13.13.13.3.m1.1a"><mo id="S4.T1.13.13.13.3.m1.1.1" xref="S4.T1.13.13.13.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.13.13.13.3.m1.1b"><csymbol cd="latexml" id="S4.T1.13.13.13.3.m1.1.1.cmml" xref="S4.T1.13.13.13.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.13.13.13.3.m1.1c">\pm</annotation></semantics></math> 3.3</td>
<td id="S4.T1.14.14.14.4" class="ltx_td ltx_align_center">691.3 <math id="S4.T1.14.14.14.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.14.14.14.4.m1.1a"><mo id="S4.T1.14.14.14.4.m1.1.1" xref="S4.T1.14.14.14.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.14.14.14.4.m1.1b"><csymbol cd="latexml" id="S4.T1.14.14.14.4.m1.1.1.cmml" xref="S4.T1.14.14.14.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.14.14.14.4.m1.1c">\pm</annotation></semantics></math> 34.3</td>
<td id="S4.T1.15.15.15.5" class="ltx_td ltx_align_center">227.1 <math id="S4.T1.15.15.15.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.15.15.15.5.m1.1a"><mo id="S4.T1.15.15.15.5.m1.1.1" xref="S4.T1.15.15.15.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.15.15.15.5.m1.1b"><csymbol cd="latexml" id="S4.T1.15.15.15.5.m1.1.1.cmml" xref="S4.T1.15.15.15.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.15.15.15.5.m1.1c">\pm</annotation></semantics></math> 8.4</td>
</tr>
<tr id="S4.T1.20.20.20" class="ltx_tr">
<th id="S4.T1.20.20.20.6" class="ltx_td ltx_th ltx_th_row"></th>
<th id="S4.T1.20.20.20.7" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">All</th>
<td id="S4.T1.16.16.16.1" class="ltx_td ltx_align_center">189.5 <math id="S4.T1.16.16.16.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.16.16.16.1.m1.1a"><mo id="S4.T1.16.16.16.1.m1.1.1" xref="S4.T1.16.16.16.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.16.16.16.1.m1.1b"><csymbol cd="latexml" id="S4.T1.16.16.16.1.m1.1.1.cmml" xref="S4.T1.16.16.16.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.16.16.16.1.m1.1c">\pm</annotation></semantics></math> 6.7</td>
<td id="S4.T1.17.17.17.2" class="ltx_td ltx_align_center">167.9 <math id="S4.T1.17.17.17.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.17.17.17.2.m1.1a"><mo id="S4.T1.17.17.17.2.m1.1.1" xref="S4.T1.17.17.17.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.17.17.17.2.m1.1b"><csymbol cd="latexml" id="S4.T1.17.17.17.2.m1.1.1.cmml" xref="S4.T1.17.17.17.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.17.17.17.2.m1.1c">\pm</annotation></semantics></math> 2.0</td>
<td id="S4.T1.18.18.18.3" class="ltx_td ltx_align_center"><span id="S4.T1.18.18.18.3.1" class="ltx_text ltx_font_bold">124.9 <math id="S4.T1.18.18.18.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.18.18.18.3.1.m1.1a"><mo id="S4.T1.18.18.18.3.1.m1.1.1" xref="S4.T1.18.18.18.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.18.18.18.3.1.m1.1b"><csymbol cd="latexml" id="S4.T1.18.18.18.3.1.m1.1.1.cmml" xref="S4.T1.18.18.18.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.18.18.18.3.1.m1.1c">\pm</annotation></semantics></math> 1.3</span></td>
<td id="S4.T1.19.19.19.4" class="ltx_td ltx_align_center">930.4 <math id="S4.T1.19.19.19.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.19.19.19.4.m1.1a"><mo id="S4.T1.19.19.19.4.m1.1.1" xref="S4.T1.19.19.19.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.19.19.19.4.m1.1b"><csymbol cd="latexml" id="S4.T1.19.19.19.4.m1.1.1.cmml" xref="S4.T1.19.19.19.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.19.19.19.4.m1.1c">\pm</annotation></semantics></math> 30.9</td>
<td id="S4.T1.20.20.20.5" class="ltx_td ltx_align_center">241.4 <math id="S4.T1.20.20.20.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.20.20.20.5.m1.1a"><mo id="S4.T1.20.20.20.5.m1.1.1" xref="S4.T1.20.20.20.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.20.20.20.5.m1.1b"><csymbol cd="latexml" id="S4.T1.20.20.20.5.m1.1.1.cmml" xref="S4.T1.20.20.20.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.20.20.20.5.m1.1c">\pm</annotation></semantics></math> 2.1</td>
</tr>
<tr id="S4.T1.40.40.43.2" class="ltx_tr">
<th id="S4.T1.40.40.43.2.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" rowspan="5">
<span id="S4.T1.40.40.43.2.1.1" class="ltx_inline-block ltx_parbox ltx_align_top" style="width:0.0pt;">
<span id="S4.T1.40.40.43.2.1.1.1" class="ltx_p">
<span id="S4.T1.40.40.43.2.1.1.1.1" class="ltx_inline-block ltx_transformed_outer" style="width:6.9pt;height:45.1pt;vertical-align:-19.1pt;"><span class="ltx_transformed_inner" style="width:45.1pt;transform:translate(-19.06pt,0pt) rotate(-90deg) ;">
<span id="S4.T1.40.40.43.2.1.1.1.1.1" class="ltx_p">TV Shows</span>
</span></span></span>
</span>
</th>
<th id="S4.T1.40.40.43.2.2" class="ltx_td ltx_th ltx_th_row ltx_border_r ltx_border_tt"></th>
<td id="S4.T1.40.40.43.2.3" class="ltx_td ltx_border_tt"></td>
<td id="S4.T1.40.40.43.2.4" class="ltx_td ltx_border_tt"></td>
<td id="S4.T1.40.40.43.2.5" class="ltx_td ltx_border_tt"></td>
<td id="S4.T1.40.40.43.2.6" class="ltx_td ltx_border_tt"></td>
<td id="S4.T1.40.40.43.2.7" class="ltx_td ltx_border_tt"></td>
</tr>
<tr id="S4.T1.25.25.25" class="ltx_tr">
<th id="S4.T1.25.25.25.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">1</th>
<td id="S4.T1.21.21.21.1" class="ltx_td ltx_align_center">57.2 <math id="S4.T1.21.21.21.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.21.21.21.1.m1.1a"><mo id="S4.T1.21.21.21.1.m1.1.1" xref="S4.T1.21.21.21.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.21.21.21.1.m1.1b"><csymbol cd="latexml" id="S4.T1.21.21.21.1.m1.1.1.cmml" xref="S4.T1.21.21.21.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.21.21.21.1.m1.1c">\pm</annotation></semantics></math> 3.6</td>
<td id="S4.T1.22.22.22.2" class="ltx_td ltx_align_center"><span id="S4.T1.22.22.22.2.1" class="ltx_text ltx_font_bold">50.3 <math id="S4.T1.22.22.22.2.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.22.22.22.2.1.m1.1a"><mo id="S4.T1.22.22.22.2.1.m1.1.1" xref="S4.T1.22.22.22.2.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.22.22.22.2.1.m1.1b"><csymbol cd="latexml" id="S4.T1.22.22.22.2.1.m1.1.1.cmml" xref="S4.T1.22.22.22.2.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.22.22.22.2.1.m1.1c">\pm</annotation></semantics></math> 1.6</span></td>
<td id="S4.T1.23.23.23.3" class="ltx_td ltx_align_center">51.6 <math id="S4.T1.23.23.23.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.23.23.23.3.m1.1a"><mo id="S4.T1.23.23.23.3.m1.1.1" xref="S4.T1.23.23.23.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.23.23.23.3.m1.1b"><csymbol cd="latexml" id="S4.T1.23.23.23.3.m1.1.1.cmml" xref="S4.T1.23.23.23.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.23.23.23.3.m1.1c">\pm</annotation></semantics></math> 1.3</td>
<td id="S4.T1.24.24.24.4" class="ltx_td ltx_align_center">359.4 <math id="S4.T1.24.24.24.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.24.24.24.4.m1.1a"><mo id="S4.T1.24.24.24.4.m1.1.1" xref="S4.T1.24.24.24.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.24.24.24.4.m1.1b"><csymbol cd="latexml" id="S4.T1.24.24.24.4.m1.1.1.cmml" xref="S4.T1.24.24.24.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.24.24.24.4.m1.1c">\pm</annotation></semantics></math> 28.2</td>
<td id="S4.T1.25.25.25.5" class="ltx_td ltx_align_center">111.7 <math id="S4.T1.25.25.25.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.25.25.25.5.m1.1a"><mo id="S4.T1.25.25.25.5.m1.1.1" xref="S4.T1.25.25.25.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.25.25.25.5.m1.1b"><csymbol cd="latexml" id="S4.T1.25.25.25.5.m1.1.1.cmml" xref="S4.T1.25.25.25.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.25.25.25.5.m1.1c">\pm</annotation></semantics></math> 4.6</td>
</tr>
<tr id="S4.T1.30.30.30" class="ltx_tr">
<th id="S4.T1.30.30.30.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">5</th>
<td id="S4.T1.26.26.26.1" class="ltx_td ltx_align_center">51.5<math id="S4.T1.26.26.26.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.26.26.26.1.m1.1a"><mo id="S4.T1.26.26.26.1.m1.1.1" xref="S4.T1.26.26.26.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.26.26.26.1.m1.1b"><csymbol cd="latexml" id="S4.T1.26.26.26.1.m1.1.1.cmml" xref="S4.T1.26.26.26.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.26.26.26.1.m1.1c">\pm</annotation></semantics></math> 1.5</td>
<td id="S4.T1.27.27.27.2" class="ltx_td ltx_align_center"><span id="S4.T1.27.27.27.2.1" class="ltx_text ltx_font_bold">50.7 <math id="S4.T1.27.27.27.2.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.27.27.27.2.1.m1.1a"><mo id="S4.T1.27.27.27.2.1.m1.1.1" xref="S4.T1.27.27.27.2.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.27.27.27.2.1.m1.1b"><csymbol cd="latexml" id="S4.T1.27.27.27.2.1.m1.1.1.cmml" xref="S4.T1.27.27.27.2.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.27.27.27.2.1.m1.1c">\pm</annotation></semantics></math> 2.1</span></td>
<td id="S4.T1.28.28.28.3" class="ltx_td ltx_align_center">51.7 <math id="S4.T1.28.28.28.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.28.28.28.3.m1.1a"><mo id="S4.T1.28.28.28.3.m1.1.1" xref="S4.T1.28.28.28.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.28.28.28.3.m1.1b"><csymbol cd="latexml" id="S4.T1.28.28.28.3.m1.1.1.cmml" xref="S4.T1.28.28.28.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.28.28.28.3.m1.1c">\pm</annotation></semantics></math> 2.0</td>
<td id="S4.T1.29.29.29.4" class="ltx_td ltx_align_center">244.5 <math id="S4.T1.29.29.29.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.29.29.29.4.m1.1a"><mo id="S4.T1.29.29.29.4.m1.1.1" xref="S4.T1.29.29.29.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.29.29.29.4.m1.1b"><csymbol cd="latexml" id="S4.T1.29.29.29.4.m1.1.1.cmml" xref="S4.T1.29.29.29.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.29.29.29.4.m1.1c">\pm</annotation></semantics></math> 15.1</td>
<td id="S4.T1.30.30.30.5" class="ltx_td ltx_align_center">110.0 <math id="S4.T1.30.30.30.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.30.30.30.5.m1.1a"><mo id="S4.T1.30.30.30.5.m1.1.1" xref="S4.T1.30.30.30.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.30.30.30.5.m1.1b"><csymbol cd="latexml" id="S4.T1.30.30.30.5.m1.1.1.cmml" xref="S4.T1.30.30.30.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.30.30.30.5.m1.1c">\pm</annotation></semantics></math> 6.5</td>
</tr>
<tr id="S4.T1.35.35.35" class="ltx_tr">
<th id="S4.T1.35.35.35.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">15</th>
<td id="S4.T1.31.31.31.1" class="ltx_td ltx_align_center"><span id="S4.T1.31.31.31.1.1" class="ltx_text ltx_font_bold">48.8 <math id="S4.T1.31.31.31.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.31.31.31.1.1.m1.1a"><mo id="S4.T1.31.31.31.1.1.m1.1.1" xref="S4.T1.31.31.31.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.31.31.31.1.1.m1.1b"><csymbol cd="latexml" id="S4.T1.31.31.31.1.1.m1.1.1.cmml" xref="S4.T1.31.31.31.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.31.31.31.1.1.m1.1c">\pm</annotation></semantics></math> 1.7</span></td>
<td id="S4.T1.32.32.32.2" class="ltx_td ltx_align_center">51.0 <math id="S4.T1.32.32.32.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.32.32.32.2.m1.1a"><mo id="S4.T1.32.32.32.2.m1.1.1" xref="S4.T1.32.32.32.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.32.32.32.2.m1.1b"><csymbol cd="latexml" id="S4.T1.32.32.32.2.m1.1.1.cmml" xref="S4.T1.32.32.32.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.32.32.32.2.m1.1c">\pm</annotation></semantics></math> 2.1</td>
<td id="S4.T1.33.33.33.3" class="ltx_td ltx_align_center">51.7 <math id="S4.T1.33.33.33.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.33.33.33.3.m1.1a"><mo id="S4.T1.33.33.33.3.m1.1.1" xref="S4.T1.33.33.33.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.33.33.33.3.m1.1b"><csymbol cd="latexml" id="S4.T1.33.33.33.3.m1.1.1.cmml" xref="S4.T1.33.33.33.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.33.33.33.3.m1.1c">\pm</annotation></semantics></math> 2.0</td>
<td id="S4.T1.34.34.34.4" class="ltx_td ltx_align_center">167.7 <math id="S4.T1.34.34.34.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.34.34.34.4.m1.1a"><mo id="S4.T1.34.34.34.4.m1.1.1" xref="S4.T1.34.34.34.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.34.34.34.4.m1.1b"><csymbol cd="latexml" id="S4.T1.34.34.34.4.m1.1.1.cmml" xref="S4.T1.34.34.34.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.34.34.34.4.m1.1c">\pm</annotation></semantics></math> 8.6</td>
<td id="S4.T1.35.35.35.5" class="ltx_td ltx_align_center">111.9 <math id="S4.T1.35.35.35.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.35.35.35.5.m1.1a"><mo id="S4.T1.35.35.35.5.m1.1.1" xref="S4.T1.35.35.35.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.35.35.35.5.m1.1b"><csymbol cd="latexml" id="S4.T1.35.35.35.5.m1.1.1.cmml" xref="S4.T1.35.35.35.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.35.35.35.5.m1.1c">\pm</annotation></semantics></math> 6.1</td>
</tr>
<tr id="S4.T1.40.40.40" class="ltx_tr">
<th id="S4.T1.40.40.40.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">All</th>
<td id="S4.T1.36.36.36.1" class="ltx_td ltx_align_center"><span id="S4.T1.36.36.36.1.1" class="ltx_text ltx_font_bold">46.7 <math id="S4.T1.36.36.36.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.36.36.36.1.1.m1.1a"><mo id="S4.T1.36.36.36.1.1.m1.1.1" xref="S4.T1.36.36.36.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.36.36.36.1.1.m1.1b"><csymbol cd="latexml" id="S4.T1.36.36.36.1.1.m1.1.1.cmml" xref="S4.T1.36.36.36.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.36.36.36.1.1.m1.1c">\pm</annotation></semantics></math> 1.7</span></td>
<td id="S4.T1.37.37.37.2" class="ltx_td ltx_align_center">51.2 <math id="S4.T1.37.37.37.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.37.37.37.2.m1.1a"><mo id="S4.T1.37.37.37.2.m1.1.1" xref="S4.T1.37.37.37.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.37.37.37.2.m1.1b"><csymbol cd="latexml" id="S4.T1.37.37.37.2.m1.1.1.cmml" xref="S4.T1.37.37.37.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.37.37.37.2.m1.1c">\pm</annotation></semantics></math> 2.0</td>
<td id="S4.T1.38.38.38.3" class="ltx_td ltx_align_center">52.1 <math id="S4.T1.38.38.38.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.38.38.38.3.m1.1a"><mo id="S4.T1.38.38.38.3.m1.1.1" xref="S4.T1.38.38.38.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.38.38.38.3.m1.1b"><csymbol cd="latexml" id="S4.T1.38.38.38.3.m1.1.1.cmml" xref="S4.T1.38.38.38.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.38.38.38.3.m1.1c">\pm</annotation></semantics></math> 2.6</td>
<td id="S4.T1.39.39.39.4" class="ltx_td ltx_align_center">82.1 <math id="S4.T1.39.39.39.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.39.39.39.4.m1.1a"><mo id="S4.T1.39.39.39.4.m1.1.1" xref="S4.T1.39.39.39.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.39.39.39.4.m1.1b"><csymbol cd="latexml" id="S4.T1.39.39.39.4.m1.1.1.cmml" xref="S4.T1.39.39.39.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.39.39.39.4.m1.1c">\pm</annotation></semantics></math> 3.3</td>
<td id="S4.T1.40.40.40.5" class="ltx_td ltx_align_center">113.0 <math id="S4.T1.40.40.40.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T1.40.40.40.5.m1.1a"><mo id="S4.T1.40.40.40.5.m1.1.1" xref="S4.T1.40.40.40.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T1.40.40.40.5.m1.1b"><csymbol cd="latexml" id="S4.T1.40.40.40.5.m1.1.1.cmml" xref="S4.T1.40.40.40.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.40.40.40.5.m1.1c">\pm</annotation></semantics></math> 4.7</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<section id="S4.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Datasets</h3>

<div id="S4.SS1.p1" class="ltx_para ltx_noindent">
<p id="S4.SS1.p1.1" class="ltx_p">We conduct our experiments using two datasets, a smaller dataset of TV Show scripts (“Friends” <cite class="ltx_cite ltx_citemacro_citep">(Chen and Choi, <a href="#bib.bib41" title="" class="ltx_ref">2016</a>)</cite> and “Game of Thrones” <cite class="ltx_cite ltx_citemacro_citep">(Koirala, <a href="#bib.bib42" title="" class="ltx_ref">2019</a>)</cite>) and a larger dataset of Reddit posts <cite class="ltx_cite ltx_citemacro_citep">(Chang et al., <a href="#bib.bib43" title="" class="ltx_ref">2020</a>)</cite>. Each dataset has a diverse set of individuals as well as clearly defined contexts/styles (i.e., TV shows or subreddits). These properties enable us to not only compare our approach to baseline approaches for personalized predictions, but they also enable us to move users between contexts or styles (e.g., producing text for a “Friends” character under a “Game of Thrones” context). By generating sequences for different users under new styles, we demonstrate the power of FedPC for personal, stylized prediction. Additional information about the datasets used in this work is given in the appendix.</p>
</div>
<div id="S4.SS1.p2" class="ltx_para ltx_noindent">
<p id="S4.SS1.p2.1" class="ltx_p">For both datasets, we treat each sentence from a speaker (i.e., TV Show character or Reddit user) as an independent utterance and we only consider utterances with at least three tokens. For experiments on known users, we perform a 60/20/20 Train/Validation/Test data split. For experiments on novel, unseen users, we perform a 70/15/15 split of Reddit users, and we manually select the “Friends” and “Game of Thones” users to include in each data fold. For both sets of experiments, all contexts are seen during training.</p>
</div>
<figure id="S4.T2" class="ltx_table">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 2: </span>Perplexity Showing Sample Efficiency Across All Methods for Withheld Users. Lower is Better</figcaption>
<div id="S4.T2.40" class="ltx_inline-block ltx_align_center ltx_transformed_outer" style="width:433.6pt;height:179.9pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-21.8pt,9.0pt) scale(0.908763998750653,0.908763998750653) ;">
<table id="S4.T2.40.40" class="ltx_tabular ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S4.T2.40.40.41.1" class="ltx_tr">
<th id="S4.T2.40.40.41.1.1" class="ltx_td ltx_th ltx_th_column ltx_th_row"></th>
<th id="S4.T2.40.40.41.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r"># Samples</th>
<th id="S4.T2.40.40.41.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC</th>
<th id="S4.T2.40.40.41.1.4" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Frozen)</th>
<th id="S4.T2.40.40.41.1.5" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Generated)</th>
<th id="S4.T2.40.40.41.1.6" class="ltx_td ltx_align_center ltx_th ltx_th_column">Split-Learning</th>
<th id="S4.T2.40.40.41.1.7" class="ltx_td ltx_align_center ltx_th ltx_th_column">Meta-Learning</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S4.T2.40.40.42.1" class="ltx_tr">
<th id="S4.T2.40.40.42.1.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" rowspan="4">
<span id="S4.T2.40.40.42.1.1.1" class="ltx_inline-block ltx_parbox ltx_align_top" style="width:0.0pt;">
<span id="S4.T2.40.40.42.1.1.1.1" class="ltx_p">
<span id="S4.T2.40.40.42.1.1.1.1.1" class="ltx_inline-block ltx_transformed_outer" style="width:6.9pt;height:29.6pt;vertical-align:-11.3pt;"><span class="ltx_transformed_inner" style="width:29.6pt;transform:translate(-11.32pt,0pt) rotate(-90deg) ;">
<span id="S4.T2.40.40.42.1.1.1.1.1.1" class="ltx_p">Reddit</span>
</span></span></span>
</span>
</th>
<th id="S4.T2.40.40.42.1.2" class="ltx_td ltx_th ltx_th_row ltx_border_r ltx_border_t"></th>
<td id="S4.T2.40.40.42.1.3" class="ltx_td ltx_border_t"></td>
<td id="S4.T2.40.40.42.1.4" class="ltx_td ltx_border_t"></td>
<td id="S4.T2.40.40.42.1.5" class="ltx_td ltx_border_t"></td>
<td id="S4.T2.40.40.42.1.6" class="ltx_td ltx_border_t"></td>
<td id="S4.T2.40.40.42.1.7" class="ltx_td ltx_border_t"></td>
</tr>
<tr id="S4.T2.5.5.5" class="ltx_tr">
<th id="S4.T2.5.5.5.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">1</th>
<td id="S4.T2.1.1.1.1" class="ltx_td ltx_align_center">594.3 <math id="S4.T2.1.1.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.1.1.1.1.m1.1a"><mo id="S4.T2.1.1.1.1.m1.1.1" xref="S4.T2.1.1.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.1.1.1.1.m1.1b"><csymbol cd="latexml" id="S4.T2.1.1.1.1.m1.1.1.cmml" xref="S4.T2.1.1.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.1.1.1.1.m1.1c">\pm</annotation></semantics></math> 973.8</td>
<td id="S4.T2.2.2.2.2" class="ltx_td ltx_align_center">202.0 <math id="S4.T2.2.2.2.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.2.2.2.2.m1.1a"><mo id="S4.T2.2.2.2.2.m1.1.1" xref="S4.T2.2.2.2.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.2.2.2.2.m1.1b"><csymbol cd="latexml" id="S4.T2.2.2.2.2.m1.1.1.cmml" xref="S4.T2.2.2.2.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.2.2.2.2.m1.1c">\pm</annotation></semantics></math> 5.9</td>
<td id="S4.T2.3.3.3.3" class="ltx_td ltx_align_center"><span id="S4.T2.3.3.3.3.1" class="ltx_text ltx_font_bold">117.3 <math id="S4.T2.3.3.3.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.3.3.3.3.1.m1.1a"><mo id="S4.T2.3.3.3.3.1.m1.1.1" xref="S4.T2.3.3.3.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.3.3.3.3.1.m1.1b"><csymbol cd="latexml" id="S4.T2.3.3.3.3.1.m1.1.1.cmml" xref="S4.T2.3.3.3.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.3.3.3.3.1.m1.1c">\pm</annotation></semantics></math> 1.8</span></td>
<td id="S4.T2.4.4.4.4" class="ltx_td ltx_align_center">922.9 <math id="S4.T2.4.4.4.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.4.4.4.4.m1.1a"><mo id="S4.T2.4.4.4.4.m1.1.1" xref="S4.T2.4.4.4.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.4.4.4.4.m1.1b"><csymbol cd="latexml" id="S4.T2.4.4.4.4.m1.1.1.cmml" xref="S4.T2.4.4.4.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.4.4.4.4.m1.1c">\pm</annotation></semantics></math> 27.8</td>
<td id="S4.T2.5.5.5.5" class="ltx_td ltx_align_center">213.9 <math id="S4.T2.5.5.5.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.5.5.5.5.m1.1a"><mo id="S4.T2.5.5.5.5.m1.1.1" xref="S4.T2.5.5.5.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.5.5.5.5.m1.1b"><csymbol cd="latexml" id="S4.T2.5.5.5.5.m1.1.1.cmml" xref="S4.T2.5.5.5.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.5.5.5.5.m1.1c">\pm</annotation></semantics></math> 6.0</td>
</tr>
<tr id="S4.T2.10.10.10" class="ltx_tr">
<th id="S4.T2.10.10.10.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">5</th>
<td id="S4.T2.6.6.6.1" class="ltx_td ltx_align_center">139.4 <math id="S4.T2.6.6.6.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.6.6.6.1.m1.1a"><mo id="S4.T2.6.6.6.1.m1.1.1" xref="S4.T2.6.6.6.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.6.6.6.1.m1.1b"><csymbol cd="latexml" id="S4.T2.6.6.6.1.m1.1.1.cmml" xref="S4.T2.6.6.6.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.6.6.6.1.m1.1c">\pm</annotation></semantics></math> 4.4</td>
<td id="S4.T2.7.7.7.2" class="ltx_td ltx_align_center">202.9 <math id="S4.T2.7.7.7.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.7.7.7.2.m1.1a"><mo id="S4.T2.7.7.7.2.m1.1.1" xref="S4.T2.7.7.7.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.7.7.7.2.m1.1b"><csymbol cd="latexml" id="S4.T2.7.7.7.2.m1.1.1.cmml" xref="S4.T2.7.7.7.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.7.7.7.2.m1.1c">\pm</annotation></semantics></math> 10.9</td>
<td id="S4.T2.8.8.8.3" class="ltx_td ltx_align_center"><span id="S4.T2.8.8.8.3.1" class="ltx_text ltx_font_bold">117.5 <math id="S4.T2.8.8.8.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.8.8.8.3.1.m1.1a"><mo id="S4.T2.8.8.8.3.1.m1.1.1" xref="S4.T2.8.8.8.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.8.8.8.3.1.m1.1b"><csymbol cd="latexml" id="S4.T2.8.8.8.3.1.m1.1.1.cmml" xref="S4.T2.8.8.8.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.8.8.8.3.1.m1.1c">\pm</annotation></semantics></math> 2.7</span></td>
<td id="S4.T2.9.9.9.4" class="ltx_td ltx_align_center">655.9 <math id="S4.T2.9.9.9.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.9.9.9.4.m1.1a"><mo id="S4.T2.9.9.9.4.m1.1.1" xref="S4.T2.9.9.9.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.9.9.9.4.m1.1b"><csymbol cd="latexml" id="S4.T2.9.9.9.4.m1.1.1.cmml" xref="S4.T2.9.9.9.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.9.9.9.4.m1.1c">\pm</annotation></semantics></math> 18.8</td>
<td id="S4.T2.10.10.10.5" class="ltx_td ltx_align_center">212.2 <math id="S4.T2.10.10.10.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.10.10.10.5.m1.1a"><mo id="S4.T2.10.10.10.5.m1.1.1" xref="S4.T2.10.10.10.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.10.10.10.5.m1.1b"><csymbol cd="latexml" id="S4.T2.10.10.10.5.m1.1.1.cmml" xref="S4.T2.10.10.10.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.10.10.10.5.m1.1c">\pm</annotation></semantics></math> 5.4</td>
</tr>
<tr id="S4.T2.15.15.15" class="ltx_tr">
<th id="S4.T2.15.15.15.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">15</th>
<td id="S4.T2.11.11.11.1" class="ltx_td ltx_align_center">117.4 <math id="S4.T2.11.11.11.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.11.11.11.1.m1.1a"><mo id="S4.T2.11.11.11.1.m1.1.1" xref="S4.T2.11.11.11.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.11.11.11.1.m1.1b"><csymbol cd="latexml" id="S4.T2.11.11.11.1.m1.1.1.cmml" xref="S4.T2.11.11.11.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.11.11.11.1.m1.1c">\pm</annotation></semantics></math> 1.9</td>
<td id="S4.T2.12.12.12.2" class="ltx_td ltx_align_center">203.6 <math id="S4.T2.12.12.12.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.12.12.12.2.m1.1a"><mo id="S4.T2.12.12.12.2.m1.1.1" xref="S4.T2.12.12.12.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.12.12.12.2.m1.1b"><csymbol cd="latexml" id="S4.T2.12.12.12.2.m1.1.1.cmml" xref="S4.T2.12.12.12.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.12.12.12.2.m1.1c">\pm</annotation></semantics></math> 11.2</td>
<td id="S4.T2.13.13.13.3" class="ltx_td ltx_align_center"><span id="S4.T2.13.13.13.3.1" class="ltx_text ltx_font_bold">116.6 <math id="S4.T2.13.13.13.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.13.13.13.3.1.m1.1a"><mo id="S4.T2.13.13.13.3.1.m1.1.1" xref="S4.T2.13.13.13.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.13.13.13.3.1.m1.1b"><csymbol cd="latexml" id="S4.T2.13.13.13.3.1.m1.1.1.cmml" xref="S4.T2.13.13.13.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.13.13.13.3.1.m1.1c">\pm</annotation></semantics></math> 2.6</span></td>
<td id="S4.T2.14.14.14.4" class="ltx_td ltx_align_center">449.2 <math id="S4.T2.14.14.14.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.14.14.14.4.m1.1a"><mo id="S4.T2.14.14.14.4.m1.1.1" xref="S4.T2.14.14.14.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.14.14.14.4.m1.1b"><csymbol cd="latexml" id="S4.T2.14.14.14.4.m1.1.1.cmml" xref="S4.T2.14.14.14.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.14.14.14.4.m1.1c">\pm</annotation></semantics></math> 11.4</td>
<td id="S4.T2.15.15.15.5" class="ltx_td ltx_align_center">211.7 <math id="S4.T2.15.15.15.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.15.15.15.5.m1.1a"><mo id="S4.T2.15.15.15.5.m1.1.1" xref="S4.T2.15.15.15.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.15.15.15.5.m1.1b"><csymbol cd="latexml" id="S4.T2.15.15.15.5.m1.1.1.cmml" xref="S4.T2.15.15.15.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.15.15.15.5.m1.1c">\pm</annotation></semantics></math> 3.7</td>
</tr>
<tr id="S4.T2.20.20.20" class="ltx_tr">
<th id="S4.T2.20.20.20.6" class="ltx_td ltx_th ltx_th_row"></th>
<th id="S4.T2.20.20.20.7" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">All</th>
<td id="S4.T2.16.16.16.1" class="ltx_td ltx_align_center"><span id="S4.T2.16.16.16.1.1" class="ltx_text ltx_font_bold">101.1<math id="S4.T2.16.16.16.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.16.16.16.1.1.m1.1a"><mo id="S4.T2.16.16.16.1.1.m1.1.1" xref="S4.T2.16.16.16.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.16.16.16.1.1.m1.1b"><csymbol cd="latexml" id="S4.T2.16.16.16.1.1.m1.1.1.cmml" xref="S4.T2.16.16.16.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.16.16.16.1.1.m1.1c">\pm</annotation></semantics></math> 2.2</span></td>
<td id="S4.T2.17.17.17.2" class="ltx_td ltx_align_center">202.2 <math id="S4.T2.17.17.17.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.17.17.17.2.m1.1a"><mo id="S4.T2.17.17.17.2.m1.1.1" xref="S4.T2.17.17.17.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.17.17.17.2.m1.1b"><csymbol cd="latexml" id="S4.T2.17.17.17.2.m1.1.1.cmml" xref="S4.T2.17.17.17.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.17.17.17.2.m1.1c">\pm</annotation></semantics></math> 7.6</td>
<td id="S4.T2.18.18.18.3" class="ltx_td ltx_align_center">117.9 <math id="S4.T2.18.18.18.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.18.18.18.3.m1.1a"><mo id="S4.T2.18.18.18.3.m1.1.1" xref="S4.T2.18.18.18.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.18.18.18.3.m1.1b"><csymbol cd="latexml" id="S4.T2.18.18.18.3.m1.1.1.cmml" xref="S4.T2.18.18.18.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.18.18.18.3.m1.1c">\pm</annotation></semantics></math> 2.8</td>
<td id="S4.T2.19.19.19.4" class="ltx_td ltx_align_center">309.3 <math id="S4.T2.19.19.19.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.19.19.19.4.m1.1a"><mo id="S4.T2.19.19.19.4.m1.1.1" xref="S4.T2.19.19.19.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.19.19.19.4.m1.1b"><csymbol cd="latexml" id="S4.T2.19.19.19.4.m1.1.1.cmml" xref="S4.T2.19.19.19.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.19.19.19.4.m1.1c">\pm</annotation></semantics></math> 8.3</td>
<td id="S4.T2.20.20.20.5" class="ltx_td ltx_align_center">212.8 <math id="S4.T2.20.20.20.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.20.20.20.5.m1.1a"><mo id="S4.T2.20.20.20.5.m1.1.1" xref="S4.T2.20.20.20.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.20.20.20.5.m1.1b"><csymbol cd="latexml" id="S4.T2.20.20.20.5.m1.1.1.cmml" xref="S4.T2.20.20.20.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.20.20.20.5.m1.1c">\pm</annotation></semantics></math> 5.2</td>
</tr>
<tr id="S4.T2.40.40.43.2" class="ltx_tr">
<th id="S4.T2.40.40.43.2.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" rowspan="5">
<span id="S4.T2.40.40.43.2.1.1" class="ltx_inline-block ltx_parbox ltx_align_top" style="width:0.0pt;">
<span id="S4.T2.40.40.43.2.1.1.1" class="ltx_p">
<span id="S4.T2.40.40.43.2.1.1.1.1" class="ltx_inline-block ltx_transformed_outer" style="width:6.9pt;height:45.1pt;vertical-align:-19.1pt;"><span class="ltx_transformed_inner" style="width:45.1pt;transform:translate(-19.06pt,0pt) rotate(-90deg) ;">
<span id="S4.T2.40.40.43.2.1.1.1.1.1" class="ltx_p">TV Shows</span>
</span></span></span>
</span>
</th>
<th id="S4.T2.40.40.43.2.2" class="ltx_td ltx_th ltx_th_row ltx_border_r ltx_border_tt"></th>
<td id="S4.T2.40.40.43.2.3" class="ltx_td ltx_border_tt"></td>
<td id="S4.T2.40.40.43.2.4" class="ltx_td ltx_border_tt"></td>
<td id="S4.T2.40.40.43.2.5" class="ltx_td ltx_border_tt"></td>
<td id="S4.T2.40.40.43.2.6" class="ltx_td ltx_border_tt"></td>
<td id="S4.T2.40.40.43.2.7" class="ltx_td ltx_border_tt"></td>
</tr>
<tr id="S4.T2.25.25.25" class="ltx_tr">
<th id="S4.T2.25.25.25.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">1</th>
<td id="S4.T2.21.21.21.1" class="ltx_td ltx_align_center">205.1 <math id="S4.T2.21.21.21.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.21.21.21.1.m1.1a"><mo id="S4.T2.21.21.21.1.m1.1.1" xref="S4.T2.21.21.21.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.21.21.21.1.m1.1b"><csymbol cd="latexml" id="S4.T2.21.21.21.1.m1.1.1.cmml" xref="S4.T2.21.21.21.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.21.21.21.1.m1.1c">\pm</annotation></semantics></math> 292.2</td>
<td id="S4.T2.22.22.22.2" class="ltx_td ltx_align_center">96.4 <math id="S4.T2.22.22.22.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.22.22.22.2.m1.1a"><mo id="S4.T2.22.22.22.2.m1.1.1" xref="S4.T2.22.22.22.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.22.22.22.2.m1.1b"><csymbol cd="latexml" id="S4.T2.22.22.22.2.m1.1.1.cmml" xref="S4.T2.22.22.22.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.22.22.22.2.m1.1c">\pm</annotation></semantics></math> 10.4</td>
<td id="S4.T2.23.23.23.3" class="ltx_td ltx_align_center"><span id="S4.T2.23.23.23.3.1" class="ltx_text ltx_font_bold">68.7 <math id="S4.T2.23.23.23.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.23.23.23.3.1.m1.1a"><mo id="S4.T2.23.23.23.3.1.m1.1.1" xref="S4.T2.23.23.23.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.23.23.23.3.1.m1.1b"><csymbol cd="latexml" id="S4.T2.23.23.23.3.1.m1.1.1.cmml" xref="S4.T2.23.23.23.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.23.23.23.3.1.m1.1c">\pm</annotation></semantics></math> 5.9</span></td>
<td id="S4.T2.24.24.24.4" class="ltx_td ltx_align_center">283.6 <math id="S4.T2.24.24.24.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.24.24.24.4.m1.1a"><mo id="S4.T2.24.24.24.4.m1.1.1" xref="S4.T2.24.24.24.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.24.24.24.4.m1.1b"><csymbol cd="latexml" id="S4.T2.24.24.24.4.m1.1.1.cmml" xref="S4.T2.24.24.24.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.24.24.24.4.m1.1c">\pm</annotation></semantics></math> 30.9</td>
<td id="S4.T2.25.25.25.5" class="ltx_td ltx_align_center">113.5 <math id="S4.T2.25.25.25.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.25.25.25.5.m1.1a"><mo id="S4.T2.25.25.25.5.m1.1.1" xref="S4.T2.25.25.25.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.25.25.25.5.m1.1b"><csymbol cd="latexml" id="S4.T2.25.25.25.5.m1.1.1.cmml" xref="S4.T2.25.25.25.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.25.25.25.5.m1.1c">\pm</annotation></semantics></math> 13.1</td>
</tr>
<tr id="S4.T2.30.30.30" class="ltx_tr">
<th id="S4.T2.30.30.30.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">5</th>
<td id="S4.T2.26.26.26.1" class="ltx_td ltx_align_center">68.6<math id="S4.T2.26.26.26.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.26.26.26.1.m1.1a"><mo id="S4.T2.26.26.26.1.m1.1.1" xref="S4.T2.26.26.26.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.26.26.26.1.m1.1b"><csymbol cd="latexml" id="S4.T2.26.26.26.1.m1.1.1.cmml" xref="S4.T2.26.26.26.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.26.26.26.1.m1.1c">\pm</annotation></semantics></math> 5.6</td>
<td id="S4.T2.27.27.27.2" class="ltx_td ltx_align_center">90.1 <math id="S4.T2.27.27.27.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.27.27.27.2.m1.1a"><mo id="S4.T2.27.27.27.2.m1.1.1" xref="S4.T2.27.27.27.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.27.27.27.2.m1.1b"><csymbol cd="latexml" id="S4.T2.27.27.27.2.m1.1.1.cmml" xref="S4.T2.27.27.27.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.27.27.27.2.m1.1c">\pm</annotation></semantics></math> 4.9</td>
<td id="S4.T2.28.28.28.3" class="ltx_td ltx_align_center"><span id="S4.T2.28.28.28.3.1" class="ltx_text ltx_font_bold">66.7 <math id="S4.T2.28.28.28.3.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.28.28.28.3.1.m1.1a"><mo id="S4.T2.28.28.28.3.1.m1.1.1" xref="S4.T2.28.28.28.3.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.28.28.28.3.1.m1.1b"><csymbol cd="latexml" id="S4.T2.28.28.28.3.1.m1.1.1.cmml" xref="S4.T2.28.28.28.3.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.28.28.28.3.1.m1.1c">\pm</annotation></semantics></math> 6.3</span></td>
<td id="S4.T2.29.29.29.4" class="ltx_td ltx_align_center">220.7 <math id="S4.T2.29.29.29.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.29.29.29.4.m1.1a"><mo id="S4.T2.29.29.29.4.m1.1.1" xref="S4.T2.29.29.29.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.29.29.29.4.m1.1b"><csymbol cd="latexml" id="S4.T2.29.29.29.4.m1.1.1.cmml" xref="S4.T2.29.29.29.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.29.29.29.4.m1.1c">\pm</annotation></semantics></math> 29.2</td>
<td id="S4.T2.30.30.30.5" class="ltx_td ltx_align_center">111.4 <math id="S4.T2.30.30.30.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.30.30.30.5.m1.1a"><mo id="S4.T2.30.30.30.5.m1.1.1" xref="S4.T2.30.30.30.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.30.30.30.5.m1.1b"><csymbol cd="latexml" id="S4.T2.30.30.30.5.m1.1.1.cmml" xref="S4.T2.30.30.30.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.30.30.30.5.m1.1c">\pm</annotation></semantics></math> 13.3</td>
</tr>
<tr id="S4.T2.35.35.35" class="ltx_tr">
<th id="S4.T2.35.35.35.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">15</th>
<td id="S4.T2.31.31.31.1" class="ltx_td ltx_align_center"><span id="S4.T2.31.31.31.1.1" class="ltx_text ltx_font_bold">62.1 <math id="S4.T2.31.31.31.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.31.31.31.1.1.m1.1a"><mo id="S4.T2.31.31.31.1.1.m1.1.1" xref="S4.T2.31.31.31.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.31.31.31.1.1.m1.1b"><csymbol cd="latexml" id="S4.T2.31.31.31.1.1.m1.1.1.cmml" xref="S4.T2.31.31.31.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.31.31.31.1.1.m1.1c">\pm</annotation></semantics></math> 5.0</span></td>
<td id="S4.T2.32.32.32.2" class="ltx_td ltx_align_center">97.6 <math id="S4.T2.32.32.32.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.32.32.32.2.m1.1a"><mo id="S4.T2.32.32.32.2.m1.1.1" xref="S4.T2.32.32.32.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.32.32.32.2.m1.1b"><csymbol cd="latexml" id="S4.T2.32.32.32.2.m1.1.1.cmml" xref="S4.T2.32.32.32.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.32.32.32.2.m1.1c">\pm</annotation></semantics></math> 6.8</td>
<td id="S4.T2.33.33.33.3" class="ltx_td ltx_align_center">66.1 <math id="S4.T2.33.33.33.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.33.33.33.3.m1.1a"><mo id="S4.T2.33.33.33.3.m1.1.1" xref="S4.T2.33.33.33.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.33.33.33.3.m1.1b"><csymbol cd="latexml" id="S4.T2.33.33.33.3.m1.1.1.cmml" xref="S4.T2.33.33.33.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.33.33.33.3.m1.1c">\pm</annotation></semantics></math> 5.5</td>
<td id="S4.T2.34.34.34.4" class="ltx_td ltx_align_center">158.1 <math id="S4.T2.34.34.34.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.34.34.34.4.m1.1a"><mo id="S4.T2.34.34.34.4.m1.1.1" xref="S4.T2.34.34.34.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.34.34.34.4.m1.1b"><csymbol cd="latexml" id="S4.T2.34.34.34.4.m1.1.1.cmml" xref="S4.T2.34.34.34.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.34.34.34.4.m1.1c">\pm</annotation></semantics></math> 20.0</td>
<td id="S4.T2.35.35.35.5" class="ltx_td ltx_align_center">117.3 <math id="S4.T2.35.35.35.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.35.35.35.5.m1.1a"><mo id="S4.T2.35.35.35.5.m1.1.1" xref="S4.T2.35.35.35.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.35.35.35.5.m1.1b"><csymbol cd="latexml" id="S4.T2.35.35.35.5.m1.1.1.cmml" xref="S4.T2.35.35.35.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.35.35.35.5.m1.1c">\pm</annotation></semantics></math> 10.5</td>
</tr>
<tr id="S4.T2.40.40.40" class="ltx_tr">
<th id="S4.T2.40.40.40.6" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r">All</th>
<td id="S4.T2.36.36.36.1" class="ltx_td ltx_align_center"><span id="S4.T2.36.36.36.1.1" class="ltx_text ltx_font_bold">52.3 <math id="S4.T2.36.36.36.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.36.36.36.1.1.m1.1a"><mo id="S4.T2.36.36.36.1.1.m1.1.1" xref="S4.T2.36.36.36.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.36.36.36.1.1.m1.1b"><csymbol cd="latexml" id="S4.T2.36.36.36.1.1.m1.1.1.cmml" xref="S4.T2.36.36.36.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.36.36.36.1.1.m1.1c">\pm</annotation></semantics></math> 3.3</span></td>
<td id="S4.T2.37.37.37.2" class="ltx_td ltx_align_center">98.2 <math id="S4.T2.37.37.37.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.37.37.37.2.m1.1a"><mo id="S4.T2.37.37.37.2.m1.1.1" xref="S4.T2.37.37.37.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.37.37.37.2.m1.1b"><csymbol cd="latexml" id="S4.T2.37.37.37.2.m1.1.1.cmml" xref="S4.T2.37.37.37.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.37.37.37.2.m1.1c">\pm</annotation></semantics></math> 9.5</td>
<td id="S4.T2.38.38.38.3" class="ltx_td ltx_align_center">68.6 <math id="S4.T2.38.38.38.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.38.38.38.3.m1.1a"><mo id="S4.T2.38.38.38.3.m1.1.1" xref="S4.T2.38.38.38.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.38.38.38.3.m1.1b"><csymbol cd="latexml" id="S4.T2.38.38.38.3.m1.1.1.cmml" xref="S4.T2.38.38.38.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.38.38.38.3.m1.1c">\pm</annotation></semantics></math> 5.1</td>
<td id="S4.T2.39.39.39.4" class="ltx_td ltx_align_center">96.7 <math id="S4.T2.39.39.39.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.39.39.39.4.m1.1a"><mo id="S4.T2.39.39.39.4.m1.1.1" xref="S4.T2.39.39.39.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.39.39.39.4.m1.1b"><csymbol cd="latexml" id="S4.T2.39.39.39.4.m1.1.1.cmml" xref="S4.T2.39.39.39.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.39.39.39.4.m1.1c">\pm</annotation></semantics></math> 14.5</td>
<td id="S4.T2.40.40.40.5" class="ltx_td ltx_align_center">114.2 <math id="S4.T2.40.40.40.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T2.40.40.40.5.m1.1a"><mo id="S4.T2.40.40.40.5.m1.1.1" xref="S4.T2.40.40.40.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T2.40.40.40.5.m1.1b"><csymbol cd="latexml" id="S4.T2.40.40.40.5.m1.1.1.cmml" xref="S4.T2.40.40.40.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.40.40.40.5.m1.1c">\pm</annotation></semantics></math> 17.0</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section id="S4.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Results and Discussion</h3>

<div id="S4.SS2.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.p1.1" class="ltx_p">All experiments are repeated fifteen times, and means and standard deviations for performance and runtime results are presented in Tables <a href="#S4.T1" title="Table 1 ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>, <a href="#S4.T2" title="Table 2 ‣ 4.1 Datasets ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>, and <a href="#S4.T3" title="Table 3 ‣ Memory Costs ‣ 4.2 Results and Discussion ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>.
Tables <a href="#S4.T1" title="Table 1 ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a> and <a href="#S4.T2" title="Table 2 ‣ 4.1 Datasets ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a> show that our approach is able to generate sensible language for both held-out user instances and known users.
Both embedding-based approaches presented in this paper (i.e., FedPC with generated or learned embeddings) show drastic improvements over baselines in terms of both sample- and runtime-efficiency, and are more suitable for real-world on-device language models.</p>
</div>
<section id="S4.SS2.SSS0.Px1" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Summary</h5>

<div id="S4.SS2.SSS0.Px1.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px1.p1.1" class="ltx_p">With known users, FedPC achieves perplexity as low as 46.7 and 100.3, on the TV Show and Reddit datasets, respectively, compared to the best baseline perplexities of 82.1 and 233.2 (a 45-50% improvement). For unknown users, FedPC achieves perplexities of 52.3 and 97.6, respectively, compared to baselines at 96.7 and 212.7 (a 45-55% improvement). FedPC training times are between 25-400% faster than baseline training times. Finally, FedPC uses 0.001% of the memory that baseline methods use for stylized personalization.</p>
</div>
</section>
<section id="S4.SS2.SSS0.Px2" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Memory Costs</h5>

<div id="S4.SS2.SSS0.Px2.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px2.p1.3" class="ltx_p">FedPC incurs a significantly lower memory cost than prior Split-Learning based approaches <cite class="ltx_cite ltx_citemacro_citep">(Li and Wang, <a href="#bib.bib15" title="" class="ltx_ref">2019</a>; Collins et al., <a href="#bib.bib12" title="" class="ltx_ref">2021</a>; Dinh et al., <a href="#bib.bib13" title="" class="ltx_ref">2020</a>; Tang et al., <a href="#bib.bib20" title="" class="ltx_ref">2021</a>; Rudovic et al., <a href="#bib.bib18" title="" class="ltx_ref">2021</a>; Gupta and Raskar, <a href="#bib.bib9" title="" class="ltx_ref">2018</a>)</cite>.
The Split-Learning baselines require maintaining a model-head for each user and context present in the dataset, and the size of these model heads is proportional to the size of the vocabulary.
On each client-device, a user’s personal model head and all context heads need to be stored in memory and used in forward passes.
In our work, every GPT model head is approximately 154 MB (being <math id="S4.SS2.SSS0.Px2.p1.1.m1.1" class="ltx_Math" alttext="768\times 50257" display="inline"><semantics id="S4.SS2.SSS0.Px2.p1.1.m1.1a"><mrow id="S4.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml">768</mn><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml">×</mo><mn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml">50257</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1"><times id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1"></times><cn type="integer" id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2">768</cn><cn type="integer" id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3">50257</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.1.m1.1c">768\times 50257</annotation></semantics></math> parameters).
To update the model on-device, one would need to store a model head corresponding to every possible context. Our Reddit dataset involves 57 contexts, totalling an additional <math id="S4.SS2.SSS0.Px2.p1.2.m2.1" class="ltx_Math" alttext="\sim" display="inline"><semantics id="S4.SS2.SSS0.Px2.p1.2.m2.1a"><mo id="S4.SS2.SSS0.Px2.p1.2.m2.1.1" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.2.m2.1b"><csymbol cd="latexml" id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.2.m2.1c">\sim</annotation></semantics></math> 8GB of data in memory. This memory requirement for personalized heads could become infeasible for real-world tasks, particularly for on-device inference or backpropagation on mobile devices.
Using FedPC, which only requires the addition of a drastically smaller preference embedding, the total amount of memory required on device to store the embeddings is only <math id="S4.SS2.SSS0.Px2.p1.3.m3.1" class="ltx_Math" alttext="\sim" display="inline"><semantics id="S4.SS2.SSS0.Px2.p1.3.m3.1a"><mo id="S4.SS2.SSS0.Px2.p1.3.m3.1.1" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.3.m3.1b"><csymbol cd="latexml" id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.3.m3.1c">\sim</annotation></semantics></math>171 KB (0.001% of the memory required by separate model heads).</p>
</div>
<figure id="S4.T3" class="ltx_table">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 3: </span>Training and Testing run-time for FedPC and our baselines, in milliseconds. Lower is better.</figcaption>
<table id="S4.T3.10" class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S4.T3.10.11.1" class="ltx_tr">
<th id="S4.T3.10.11.1.1" class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r">Method</th>
<th id="S4.T3.10.11.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC</th>
<th id="S4.T3.10.11.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Frozen)</th>
<th id="S4.T3.10.11.1.4" class="ltx_td ltx_align_center ltx_th ltx_th_column">FedPC (Generated)</th>
<th id="S4.T3.10.11.1.5" class="ltx_td ltx_align_center ltx_th ltx_th_column">Split-Learning</th>
<th id="S4.T3.10.11.1.6" class="ltx_td ltx_align_center ltx_th ltx_th_column">Meta-Learning</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S4.T3.5.5" class="ltx_tr">
<th id="S4.T3.5.5.6" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt">Train Pass Time</th>
<td id="S4.T3.1.1.1" class="ltx_td ltx_align_center ltx_border_tt">88.18 <math id="S4.T3.1.1.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.1.1.1.m1.1a"><mo id="S4.T3.1.1.1.m1.1.1" xref="S4.T3.1.1.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.1.1.1.m1.1b"><csymbol cd="latexml" id="S4.T3.1.1.1.m1.1.1.cmml" xref="S4.T3.1.1.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.1.1.1.m1.1c">\pm</annotation></semantics></math> 24.104</td>
<td id="S4.T3.2.2.2" class="ltx_td ltx_align_center ltx_border_tt"><span id="S4.T3.2.2.2.1" class="ltx_text ltx_font_bold">43.57 <math id="S4.T3.2.2.2.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.2.2.2.1.m1.1a"><mo id="S4.T3.2.2.2.1.m1.1.1" xref="S4.T3.2.2.2.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.2.2.2.1.m1.1b"><csymbol cd="latexml" id="S4.T3.2.2.2.1.m1.1.1.cmml" xref="S4.T3.2.2.2.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.2.2.2.1.m1.1c">\pm</annotation></semantics></math> 11.99</span></td>
<td id="S4.T3.3.3.3" class="ltx_td ltx_align_center ltx_border_tt">55.96 <math id="S4.T3.3.3.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.3.3.3.m1.1a"><mo id="S4.T3.3.3.3.m1.1.1" xref="S4.T3.3.3.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.3.3.3.m1.1b"><csymbol cd="latexml" id="S4.T3.3.3.3.m1.1.1.cmml" xref="S4.T3.3.3.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.3.3.3.m1.1c">\pm</annotation></semantics></math> 12.41</td>
<td id="S4.T3.4.4.4" class="ltx_td ltx_align_center ltx_border_tt">222.08 <math id="S4.T3.4.4.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.4.4.4.m1.1a"><mo id="S4.T3.4.4.4.m1.1.1" xref="S4.T3.4.4.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.4.4.4.m1.1b"><csymbol cd="latexml" id="S4.T3.4.4.4.m1.1.1.cmml" xref="S4.T3.4.4.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.4.4.4.m1.1c">\pm</annotation></semantics></math> 37.55</td>
<td id="S4.T3.5.5.5" class="ltx_td ltx_align_center ltx_border_tt">111.81 <math id="S4.T3.5.5.5.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.5.5.5.m1.1a"><mo id="S4.T3.5.5.5.m1.1.1" xref="S4.T3.5.5.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.5.5.5.m1.1b"><csymbol cd="latexml" id="S4.T3.5.5.5.m1.1.1.cmml" xref="S4.T3.5.5.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.5.5.5.m1.1c">\pm</annotation></semantics></math> 22.33</td>
</tr>
<tr id="S4.T3.10.10" class="ltx_tr">
<th id="S4.T3.10.10.6" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r">Test Pass Time</th>
<td id="S4.T3.6.6.1" class="ltx_td ltx_align_center">40.37 <math id="S4.T3.6.6.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.6.6.1.m1.1a"><mo id="S4.T3.6.6.1.m1.1.1" xref="S4.T3.6.6.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.6.6.1.m1.1b"><csymbol cd="latexml" id="S4.T3.6.6.1.m1.1.1.cmml" xref="S4.T3.6.6.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.6.6.1.m1.1c">\pm</annotation></semantics></math> 11.76</td>
<td id="S4.T3.7.7.2" class="ltx_td ltx_align_center">40.25 <math id="S4.T3.7.7.2.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.7.7.2.m1.1a"><mo id="S4.T3.7.7.2.m1.1.1" xref="S4.T3.7.7.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.7.7.2.m1.1b"><csymbol cd="latexml" id="S4.T3.7.7.2.m1.1.1.cmml" xref="S4.T3.7.7.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.7.7.2.m1.1c">\pm</annotation></semantics></math> 12.10</td>
<td id="S4.T3.8.8.3" class="ltx_td ltx_align_center">47.02 <math id="S4.T3.8.8.3.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.8.8.3.m1.1a"><mo id="S4.T3.8.8.3.m1.1.1" xref="S4.T3.8.8.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.8.8.3.m1.1b"><csymbol cd="latexml" id="S4.T3.8.8.3.m1.1.1.cmml" xref="S4.T3.8.8.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.8.8.3.m1.1c">\pm</annotation></semantics></math> 12.63</td>
<td id="S4.T3.9.9.4" class="ltx_td ltx_align_center">65.42 <math id="S4.T3.9.9.4.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.9.9.4.m1.1a"><mo id="S4.T3.9.9.4.m1.1.1" xref="S4.T3.9.9.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.9.9.4.m1.1b"><csymbol cd="latexml" id="S4.T3.9.9.4.m1.1.1.cmml" xref="S4.T3.9.9.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.9.9.4.m1.1c">\pm</annotation></semantics></math> 16.49</td>
<td id="S4.T3.10.10.5" class="ltx_td ltx_align_center"><span id="S4.T3.10.10.5.1" class="ltx_text ltx_font_bold">36.77 <math id="S4.T3.10.10.5.1.m1.1" class="ltx_Math" alttext="\pm" display="inline"><semantics id="S4.T3.10.10.5.1.m1.1a"><mo id="S4.T3.10.10.5.1.m1.1.1" xref="S4.T3.10.10.5.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.T3.10.10.5.1.m1.1b"><csymbol cd="latexml" id="S4.T3.10.10.5.1.m1.1.1.cmml" xref="S4.T3.10.10.5.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.10.10.5.1.m1.1c">\pm</annotation></semantics></math> 8.95</span></td>
</tr>
</tbody>
</table>
</figure>
</section>
<section id="S4.SS2.SSS0.Px3" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Sample Efficiency</h5>

<div id="S4.SS2.SSS0.Px3.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px3.p1.1" class="ltx_p">FedPC is able to outperform Split-Learning and Meta-Learning models with significantly fewer samples across both experiments and both datasets.
This trend is reflected regardless of whether embeddings are generated or learned through backpropagation.
When embeddings are learned, FedPC improves with online data to more effectively model the given user’s style as more data is made available to the model.
Conversely, while the generated embeddings exhibit greater sample performance with a single sample, they are unable to improve with more data.
For both known and with-held users, FedPC with generated embeddings is unable to effectively update the preference embedding to improve generation performance.
Finally, we see an increase in perplexity for Reddit users with all available data when using FedPC. This result suggests that it is possible to <span id="S4.SS2.SSS0.Px3.p1.1.1" class="ltx_text ltx_font_italic">overfit</span> preference embeddings, as we see an increase in perplexity from 15 to “All” samples (Table <a href="#S4.T1" title="Table 1 ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>).</p>
</div>
<div id="S4.SS2.SSS0.Px3.p2" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px3.p2.1" class="ltx_p">We observe no improvement for the Meta-Learning baseline, regardless of how much data is available for each user. This lack of improvement suggests that the model is not capable of rapidly personalizing to a single user or context with only a handful of available samples. Only updating the model head may be insufficient when the base, shared model head must generalize across all possible contexts and characters.</p>
</div>
<div id="S4.SS2.SSS0.Px3.p3" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px3.p3.1" class="ltx_p">The Split-Learning baseline, on the other hand, does show significant improvement with increasing amounts of data for withheld and known users. In our known user experiments, all personal model heads
should have already been well-tuned to personal preferences. Our result therefore suggests that context-specific model heads are over-generalized to their respective contexts, and must be refined to better-align with individual users.</p>
</div>
<figure id="S4.T4" class="ltx_table">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 4: </span>Generated Examples using Arya, from “Game of Thrones” (GoT) and Chandler, from “Friends”.</figcaption>
<div id="S4.T4.1" class="ltx_inline-block ltx_align_center ltx_transformed_outer" style="width:433.6pt;height:186.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-54.7pt,23.6pt) scale(0.798480461368793,0.798480461368793) ;">
<table id="S4.T4.1.1" class="ltx_tabular ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S4.T4.1.1.1.1" class="ltx_tr">
<th id="S4.T4.1.1.1.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r">Character</th>
<th id="S4.T4.1.1.1.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r">Show</th>
<th id="S4.T4.1.1.1.1.3" class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r">“We Must”</th>
<th id="S4.T4.1.1.1.1.4" class="ltx_td ltx_align_left ltx_th ltx_th_column">“I think”</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S4.T4.1.1.2.1" class="ltx_tr">
<th id="S4.T4.1.1.2.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_tt" rowspan="3"><span id="S4.T4.1.1.2.1.1.1" class="ltx_text">Chandler</span></th>
<th id="S4.T4.1.1.2.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_tt" rowspan="3"><span id="S4.T4.1.1.2.1.2.1" class="ltx_text">Friends</span></th>
<td id="S4.T4.1.1.2.1.3" class="ltx_td ltx_align_left ltx_border_r ltx_border_tt">be careful! I’m not going to get a divorce.</td>
<td id="S4.T4.1.1.2.1.4" class="ltx_td ltx_align_left ltx_border_tt">I’ll be able to do this.</td>
</tr>
<tr id="S4.T4.1.1.3.2" class="ltx_tr">
<td id="S4.T4.1.1.3.2.1" class="ltx_td ltx_align_left ltx_border_r">be a little bit more relaxed than we’re here.</td>
<td id="S4.T4.1.1.3.2.2" class="ltx_td ltx_align_left">I’m a good man</td>
</tr>
<tr id="S4.T4.1.1.4.3" class="ltx_tr">
<td id="S4.T4.1.1.4.3.1" class="ltx_td ltx_align_left ltx_border_r">be the one who’s the one who’s the one…</td>
<td id="S4.T4.1.1.4.3.2" class="ltx_td ltx_align_left">I’m a big fan of you</td>
</tr>
<tr id="S4.T4.1.1.5.4" class="ltx_tr">
<th id="S4.T4.1.1.5.4.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.5.4.1.1" class="ltx_text">Chandler</span></th>
<th id="S4.T4.1.1.5.4.2" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.5.4.2.1" class="ltx_text">GoT</span></th>
<td id="S4.T4.1.1.5.4.3" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">be honest with you.</td>
<td id="S4.T4.1.1.5.4.4" class="ltx_td ltx_align_left ltx_border_t">I’m going to be a little more serious</td>
</tr>
<tr id="S4.T4.1.1.6.5" class="ltx_tr">
<td id="S4.T4.1.1.6.5.1" class="ltx_td ltx_align_left ltx_border_r">be very nervous about the possibility of a bomb attack.</td>
<td id="S4.T4.1.1.6.5.2" class="ltx_td ltx_align_left">I’m going to be a little bit of a jerk</td>
</tr>
<tr id="S4.T4.1.1.7.6" class="ltx_tr">
<td id="S4.T4.1.1.7.6.1" class="ltx_td ltx_align_left ltx_border_r">be a little nervous about the situation</td>
<td id="S4.T4.1.1.7.6.2" class="ltx_td ltx_align_left">I’m going to have a big secret.</td>
</tr>
<tr id="S4.T4.1.1.8.7" class="ltx_tr">
<th id="S4.T4.1.1.8.7.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.8.7.1.1" class="ltx_text">Arya</span></th>
<th id="S4.T4.1.1.8.7.2" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.8.7.2.1" class="ltx_text">GoT</span></th>
<td id="S4.T4.1.1.8.7.3" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">be a little more careful.</td>
<td id="S4.T4.1.1.8.7.4" class="ltx_td ltx_align_left ltx_border_t">you can’t help me</td>
</tr>
<tr id="S4.T4.1.1.9.8" class="ltx_tr">
<td id="S4.T4.1.1.9.8.1" class="ltx_td ltx_align_left ltx_border_r">be careful about the dangers of the sea.</td>
<td id="S4.T4.1.1.9.8.2" class="ltx_td ltx_align_left">of the people</td>
</tr>
<tr id="S4.T4.1.1.10.9" class="ltx_tr">
<td id="S4.T4.1.1.10.9.1" class="ltx_td ltx_align_left ltx_border_r">be wary of the possibility of a coup.</td>
<td id="S4.T4.1.1.10.9.2" class="ltx_td ltx_align_left">you’re not going to be a hero?</td>
</tr>
<tr id="S4.T4.1.1.11.10" class="ltx_tr">
<th id="S4.T4.1.1.11.10.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.11.10.1.1" class="ltx_text">Arya</span></th>
<th id="S4.T4.1.1.11.10.2" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" rowspan="3"><span id="S4.T4.1.1.11.10.2.1" class="ltx_text">Friends</span></th>
<td id="S4.T4.1.1.11.10.3" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">be a thief</td>
<td id="S4.T4.1.1.11.10.4" class="ltx_td ltx_align_left ltx_border_t">I’m not a bad person</td>
</tr>
<tr id="S4.T4.1.1.12.11" class="ltx_tr">
<td id="S4.T4.1.1.12.11.1" class="ltx_td ltx_align_left ltx_border_r">be a hero.</td>
<td id="S4.T4.1.1.12.11.2" class="ltx_td ltx_align_left">I can do it</td>
</tr>
<tr id="S4.T4.1.1.13.12" class="ltx_tr">
<td id="S4.T4.1.1.13.12.1" class="ltx_td ltx_align_left ltx_border_r">be a little girl.</td>
<td id="S4.T4.1.1.13.12.2" class="ltx_td ltx_align_left">I should have a chance to do something</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section id="S4.SS2.SSS0.Px4" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Runtime Efficiency</h5>

<div id="S4.SS2.SSS0.Px4.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px4.p1.2" class="ltx_p">FedPC incurs significantly lower training costs than both Split-Learning and Meta-Learning approaches to personalization.
While Meta-Learning baseline does not have the memory-constraints of the split-learning model in terms of storing <span id="S4.SS2.SSS0.Px4.p1.2.1" class="ltx_text ltx_font_italic">additional</span> model heads, training the Meta-Learning baseline still involves computing gradients over all <math id="S4.SS2.SSS0.Px4.p1.1.m1.1" class="ltx_Math" alttext="768\times 50257" display="inline"><semantics id="S4.SS2.SSS0.Px4.p1.1.m1.1a"><mrow id="S4.SS2.SSS0.Px4.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.cmml"><mn id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2.cmml">768</mn><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1.cmml">×</mo><mn id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3.cmml">50257</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px4.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1"><times id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1"></times><cn type="integer" id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2">768</cn><cn type="integer" id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3">50257</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px4.p1.1.m1.1c">768\times 50257</annotation></semantics></math> parameters in the shared output layer. As we show in Table <a href="#S4.T3" title="Table 3 ‣ Memory Costs ‣ 4.2 Results and Discussion ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>, this leads to a significantly more costly training time for each user. Similarly, the Split-Learning baseline must update <span id="S4.SS2.SSS0.Px4.p1.2.2" class="ltx_text ltx_font_italic">at least</span> two model heads for each backward pass, requiring gradient computation for <math id="S4.SS2.SSS0.Px4.p1.2.m2.1" class="ltx_Math" alttext="2\times 768\times 50257" display="inline"><semantics id="S4.SS2.SSS0.Px4.p1.2.m2.1a"><mrow id="S4.SS2.SSS0.Px4.p1.2.m2.1.1" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.cmml"><mn id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.2" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.2.cmml">2</mn><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1.cmml">×</mo><mn id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.3" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.3.cmml">768</mn><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1a" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1.cmml">×</mo><mn id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.4" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.4.cmml">50257</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px4.p1.2.m2.1b"><apply id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1"><times id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.1"></times><cn type="integer" id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.2.cmml" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.2">2</cn><cn type="integer" id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.3.cmml" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.3">768</cn><cn type="integer" id="S4.SS2.SSS0.Px4.p1.2.m2.1.1.4.cmml" xref="S4.SS2.SSS0.Px4.p1.2.m2.1.1.4">50257</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px4.p1.2.m2.1c">2\times 768\times 50257</annotation></semantics></math> parameters. If a user is active in multiple contexts, then additional context model-heads must be used, further exacerbating the training cost of the Split-Learning approach. The Split-Learning approach must also leverage these additional context model-heads at test-time, resulting in the slowest forward-passes of any baseline.</p>
</div>
<div id="S4.SS2.SSS0.Px4.p2" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px4.p2.1" class="ltx_p">In contrast to prior approaches, training for FedPC only requires updating <math id="S4.SS2.SSS0.Px4.p2.1.m1.1" class="ltx_Math" alttext="2\times 768" display="inline"><semantics id="S4.SS2.SSS0.Px4.p2.1.m1.1a"><mrow id="S4.SS2.SSS0.Px4.p2.1.m1.1.1" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.cmml"><mn id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.2" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.2.cmml">2</mn><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.1" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.1.cmml">×</mo><mn id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.3" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.3.cmml">768</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px4.p2.1.m1.1b"><apply id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1"><times id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.1"></times><cn type="integer" id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.2">2</cn><cn type="integer" id="S4.SS2.SSS0.Px4.p2.1.m1.1.1.3.cmml" xref="S4.SS2.SSS0.Px4.p2.1.m1.1.1.3">768</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px4.p2.1.m1.1c">2\times 768</annotation></semantics></math> parameters.
This reduced computation results in significantly lower training times. When we train an embedding-generator, there is an increase in training times reflecting the added cost of computing gradients for the embedding generator. Additionally, there is a test-time penalty incurred by the added forward-pass parameters. When running inference with any version of FedPC, preference embeddings are combined and then prepended to the input utterance. This process results in marginally slower test times with FedPC relative to the Meta-Learning baseline.</p>
</div>
</section>
<section id="S4.SS2.SSS0.Px5" class="ltx_paragraph">
<h5 class="ltx_title ltx_title_paragraph">Qualitative Results</h5>

<div id="S4.SS2.SSS0.Px5.p1" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px5.p1.1" class="ltx_p">Our qualitative results in Table <a href="#S4.T4" title="Table 4 ‣ Sample Efficiency ‣ 4.2 Results and Discussion ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a> demonstrate the power of FedPC. Not only is our model able to complete sequences for a character in their “home” context (i.e., the context from which all of their data is drawn), but we are also able to stylize generation for characters, bringing them into <span id="S4.SS2.SSS0.Px5.p1.1.1" class="ltx_text ltx_font_italic">new</span> contexts. We present generated samples from a “Game of Thrones” (GoT) character (Arya) with a “Friends” context embedding and a GoT context embedding. We see that Arya’s generated sequences are distinct under the two different contexts. Under the GoT context, Arya’s utterances match the theme of the show, suggesting danger and revolution. Under the “Friends” context, Arya’s utterances change to instead reflect more mundane, modern language while still preserving personal attributes of the character.</p>
</div>
<div id="S4.SS2.SSS0.Px5.p2" class="ltx_para ltx_noindent">
<p id="S4.SS2.SSS0.Px5.p2.1" class="ltx_p">Across all of our experiments, particularly the novel experimental evaluation on held-out user-instances, our results provide evidence that embedding-conditioned personalization within federated learning can be effectively applied to real-world use-cases.
FedPC offers a promising avenue of future work towards on-device language models, capable of efficient language generation with respect to compute-power and data availability.</p>
</div>
</section>
</section>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Limitations</h2>

<div id="S5.p1" class="ltx_para ltx_noindent">
<p id="S5.p1.1" class="ltx_p">Firstly, although our embedding-generator offers a promising avenue of personalizing without any on-device gradient computation, our generator is currently unable to improve on its generated embeddings given more examples for a given user.
As shown in our results from Sec <a href="#S4.SS2" title="4.2 Results and Discussion ‣ 4 Experiments ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4.2</span></a>, while the model can generate an effective preference embedding for a user with a single sample, it is unable to improve with more data.
In future work, we hope to explore approaches to facilitate a generator which can effectively modify embeddings given additional data.</p>
</div>
<div id="S5.p2" class="ltx_para ltx_noindent">
<p id="S5.p2.1" class="ltx_p">Secondly, our approach caters to confidentiality by ensuring that user-data and embeddings remain on-device, however we have not incorporated differential privacy in our experiments <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a href="#bib.bib2" title="" class="ltx_ref">2020a</a>)</cite>.
Future work may apply differential privacy to guarantee user privacy while personalizing and contributing feature encoder information to a central server. Finally, it is important to note that FedPC does not solve all problems within the scope of language generation models. As FedPC offers a path forward to facilitate privacy protection and efficient on-device learning for large language models, future work may extend FedPC to additional problems (e.g., language summarization or turn-based dialogue generation).
</p>
</div>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>

<div id="S6.p1" class="ltx_para ltx_noindent">
<p id="S6.p1.1" class="ltx_p">We present FedPC, a new approach to personalized federated learning, enabling efficient and high-performance personalization to client devices by leveraging preference embeddings.
Combining context with individual personal preferences, FedPC outperforms baselines even when allotted a lower computational budget.
We also provide a method of generating preference embeddings through inference alone, providing personalization with no on-device gradient computation, and we show comparable performance to FedPC with learned embeddings.
We presented experiments on two datasets, TV Show scripts and Reddit user data, presenting empirical evidence of the utility of FedPC towards personalizing to unseen users in a federated learning setting, i.e. a 50% improvement in terms of runtime to fine-tune on new users as well as perplexity.
We also demonstrated qualitative results, showing the power of separate personal and context embeddings and enabling stylization of users in new contexts.
Our results show that FedPC offers a promising path forward for personalization within federated learning, achieving superior quantitative results, and requiring significantly less training time relative to baseline approaches.</p>
</div>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Acknowledgements</h2>

<div id="S7.p1" class="ltx_para">
<p id="S7.p1.1" class="ltx_p">This work was supported by the Office of Naval Research (ONR) under award N00014-19-1-2076.
Andrew Silva was supported by the Apple Scholars in AI/ML PhD fellowship.</p>
</div>
</section>
<section id="bib" class="ltx_bibliography">
<h2 class="ltx_title ltx_title_bibliography">References</h2>

<ul class="ltx_biblist">
<li id="bib.bib1" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dudy et al. [2021]</span>
<span class="ltx_bibblock">
Shiran Dudy, Steven Bedrick, and Bonnie Webber.

</span>
<span class="ltx_bibblock">Refocusing on relevance: Personalization in nlg.

</span>
<span class="ltx_bibblock"><em id="bib.bib1.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2109.05140</em>, 2021.

</span>
</li>
<li id="bib.bib2" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. [2020a]</span>
<span class="ltx_bibblock">
Yiwei Li, Tsung-Hui Chang, and Chong-Yung Chi.

</span>
<span class="ltx_bibblock">Secure federated averaging algorithm with differential privacy.

</span>
<span class="ltx_bibblock">In <em id="bib.bib2.1.1" class="ltx_emph ltx_font_italic">2020 IEEE 30th International Workshop on Machine Learning
for Signal Processing (MLSP)</em>, pages 1–6. IEEE, 2020a.

</span>
</li>
<li id="bib.bib3" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">McMahan et al. [2017]</span>
<span class="ltx_bibblock">
Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and Blaise Aguera
y Arcas.

</span>
<span class="ltx_bibblock">Communication-efficient learning of deep networks from decentralized
data.

</span>
<span class="ltx_bibblock">In <em id="bib.bib3.1.1" class="ltx_emph ltx_font_italic">Artificial intelligence and statistics</em>, pages 1273–1282.
PMLR, 2017.

</span>
</li>
<li id="bib.bib4" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jones [1999]</span>
<span class="ltx_bibblock">
Karen Sparck Jones.

</span>
<span class="ltx_bibblock">Automatic summarizing: factors immarizing: factors and directions.

</span>
<span class="ltx_bibblock"><em id="bib.bib4.1.1" class="ltx_emph ltx_font_italic">Advances in automatic text summarization</em>, page 1, 1999.

</span>
</li>
<li id="bib.bib5" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al. [2021]</span>
<span class="ltx_bibblock">
Yuwei Wu, Xuezhe Ma, and Diyi Yang.

</span>
<span class="ltx_bibblock">Personalized response generation via generative split memory network.

</span>
<span class="ltx_bibblock">In <em id="bib.bib5.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 2021 Conference of the North American
Chapter of the Association for Computational Linguistics: Human Language
Technologies</em>, pages 1956–1970, 2021.

</span>
</li>
<li id="bib.bib6" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. [2018]</span>
<span class="ltx_bibblock">
Saizheng Zhang, Emily Dinan, Jack Urbanek, Arthur Szlam, Douwe Kiela, and Jason
Weston.

</span>
<span class="ltx_bibblock">Personalizing dialogue agents: I have a dog, do you have pets too?

</span>
<span class="ltx_bibblock"><em id="bib.bib6.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1801.07243</em>, 2018.

</span>
</li>
<li id="bib.bib7" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cheng et al. [2019]</span>
<span class="ltx_bibblock">
Hao Cheng, Hao Fang, and Mari Ostendorf.

</span>
<span class="ltx_bibblock">A dynamic speaker model for conversational interactions.

</span>
<span class="ltx_bibblock">In <em id="bib.bib7.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 2019 Conference of the North American
Chapter of the Association for Computational Linguistics: Human Language
Technologies, Volume 1 (Long and Short Papers)</em>, pages 2772–2785, 2019.

</span>
</li>
<li id="bib.bib8" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. [2019a]</span>
<span class="ltx_bibblock">
Zhaojiang Lin, Andrea Madotto, Jamin Shin, Peng Xu, and Pascale Fung.

</span>
<span class="ltx_bibblock">Moel: Mixture of empathetic listeners.

</span>
<span class="ltx_bibblock"><em id="bib.bib8.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1908.07687</em>, 2019a.

</span>
</li>
<li id="bib.bib9" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gupta and Raskar [2018]</span>
<span class="ltx_bibblock">
Otkrist Gupta and Ramesh Raskar.

</span>
<span class="ltx_bibblock">Distributed learning of deep neural network over multiple agents.

</span>
<span class="ltx_bibblock"><em id="bib.bib9.1.1" class="ltx_emph ltx_font_italic">Journal of Network and Computer Applications</em>, 116:1–8, 2018.

</span>
</li>
<li id="bib.bib10" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Finn et al. [2017]</span>
<span class="ltx_bibblock">
Chelsea Finn, Pieter Abbeel, and Sergey Levine.

</span>
<span class="ltx_bibblock">Model-agnostic meta-learning for fast adaptation of deep networks.

</span>
<span class="ltx_bibblock">In Doina Precup and Yee Whye Teh, editors, <em id="bib.bib10.1.1" class="ltx_emph ltx_font_italic">Proceedings of the
34th International Conference on Machine Learning</em>, volume 70 of
<em id="bib.bib10.2.2" class="ltx_emph ltx_font_italic">Proceedings of Machine Learning Research</em>, pages 1126–1135, 06–11 Aug
2017.

</span>
</li>
<li id="bib.bib11" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nichol et al. [2018]</span>
<span class="ltx_bibblock">
Alex Nichol, Joshua Achiam, and John Schulman.

</span>
<span class="ltx_bibblock">On first-order meta-learning algorithms.

</span>
<span class="ltx_bibblock"><em id="bib.bib11.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1803.02999</em>, 2018.

</span>
</li>
<li id="bib.bib12" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Collins et al. [2021]</span>
<span class="ltx_bibblock">
Liam Collins, Hamed Hassani, Aryan Mokhtari, and Sanjay Shakkottai.

</span>
<span class="ltx_bibblock">Exploiting shared representations for personalized federated
learning.

</span>
<span class="ltx_bibblock">In Marina Meila and Tong Zhang, editors, <em id="bib.bib12.1.1" class="ltx_emph ltx_font_italic">Proceedings of the
38th International Conference on Machine Learning</em>, volume 139 of
<em id="bib.bib12.2.2" class="ltx_emph ltx_font_italic">Proceedings of Machine Learning Research</em>, pages 2089–2099, 18–24 Jul
2021.

</span>
</li>
<li id="bib.bib13" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dinh et al. [2020]</span>
<span class="ltx_bibblock">
Canh T Dinh, Nguyen H Tran, and Tuan Dung Nguyen.

</span>
<span class="ltx_bibblock">Personalized federated learning with moreau envelopes.

</span>
<span class="ltx_bibblock"><em id="bib.bib13.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2006.08848</em>, 2020.

</span>
</li>
<li id="bib.bib14" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. [2020b]</span>
<span class="ltx_bibblock">
Tian Li, Anit Kumar Sahu, Manzil Zaheer, Maziar Sanjabi, Ameet Talwalkar, and
Virginia Smith.

</span>
<span class="ltx_bibblock">Federated optimization in heterogeneous networks.

</span>
<span class="ltx_bibblock"><em id="bib.bib14.1.1" class="ltx_emph ltx_font_italic">Proceedings of Machine Learning and Systems</em>, 2:429–450, 2020b.

</span>
</li>
<li id="bib.bib15" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li and Wang [2019]</span>
<span class="ltx_bibblock">
Daliang Li and Junpu Wang.

</span>
<span class="ltx_bibblock">Fedmd: Heterogenous federated learning via model distillation.

</span>
<span class="ltx_bibblock"><em id="bib.bib15.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1910.03581</em>, 2019.

</span>
</li>
<li id="bib.bib16" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Arivazhagan et al. [2019]</span>
<span class="ltx_bibblock">
Manoj Ghuhan Arivazhagan, Vinay Aggarwal, Aaditya Kumar Singh, and Sunav
Choudhary.

</span>
<span class="ltx_bibblock">Federated learning with personalization layers.

</span>
<span class="ltx_bibblock"><em id="bib.bib16.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1912.00818</em>, 2019.

</span>
</li>
<li id="bib.bib17" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kim et al. [2021]</span>
<span class="ltx_bibblock">
Joongheon Kim, Seunghoon Park, Soyi Jung, and Seehwan Yoo.

</span>
<span class="ltx_bibblock">Spatio-temporal split learning.

</span>
<span class="ltx_bibblock">In <em id="bib.bib17.1.1" class="ltx_emph ltx_font_italic">2021 51st Annual IEEE/IFIP International Conference on
Dependable Systems and Networks-Supplemental Volume (DSN-S)</em>, pages 11–12.
IEEE, 2021.

</span>
</li>
<li id="bib.bib18" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rudovic et al. [2021]</span>
<span class="ltx_bibblock">
Ognjen Rudovic, Nicolas Tobis, Sebastian Kaltwang, Björn Schuller, Daniel
Rueckert, Jeffrey F Cohn, and Rosalind W Picard.

</span>
<span class="ltx_bibblock">Personalized federated deep learning for pain estimation from face
images.

</span>
<span class="ltx_bibblock"><em id="bib.bib18.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2101.04800</em>, 2021.

</span>
</li>
<li id="bib.bib19" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paulik et al. [2021]</span>
<span class="ltx_bibblock">
Matthias Paulik, Matt Seigel, Henry Mason, Dominic Telaar, Joris Kluivers,
Rogier van Dalen, Chi Wai Lau, Luke Carlson, Filip Granqvist, Chris
Vandevelde, et al.

</span>
<span class="ltx_bibblock">Federated evaluation and tuning for on-device personalization: System
design &amp; applications.

</span>
<span class="ltx_bibblock"><em id="bib.bib19.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2102.08503</em>, 2021.

</span>
</li>
<li id="bib.bib20" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tang et al. [2021]</span>
<span class="ltx_bibblock">
Xueyang Tang, Song Guo, and Jingcai Guo.

</span>
<span class="ltx_bibblock">Personalized federated learning with clustered generalization.

</span>
<span class="ltx_bibblock"><em id="bib.bib20.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2106.13044</em>, 2021.

</span>
</li>
<li id="bib.bib21" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Silva et al. [2022]</span>
<span class="ltx_bibblock">
Andrew Silva, Katherine Metcalf, Nicholas Apostoloff, and Barry-John Theobald.

</span>
<span class="ltx_bibblock">Fedembed: Personalized private federated learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib21.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2202.09472</em>, 2022.

</span>
</li>
<li id="bib.bib22" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. [2019]</span>
<span class="ltx_bibblock">
Yihan Jiang, Jakub Konečnỳ, Keith Rush, and Sreeram Kannan.

</span>
<span class="ltx_bibblock">Improving federated learning personalization via model agnostic meta
learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib22.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1909.12488</em>, 2019.

</span>
</li>
<li id="bib.bib23" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fallah et al. [2020]</span>
<span class="ltx_bibblock">
Alireza Fallah, Aryan Mokhtari, and Asuman Ozdaglar.

</span>
<span class="ltx_bibblock">Personalized federated learning: A meta-learning approach.

</span>
<span class="ltx_bibblock"><em id="bib.bib23.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2002.07948</em>, 2020.

</span>
</li>
<li id="bib.bib24" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Deng et al. [2020]</span>
<span class="ltx_bibblock">
Yuyang Deng, Mohammad Mahdi Kamani, and Mehrdad Mahdavi.

</span>
<span class="ltx_bibblock">Adaptive personalized federated learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib24.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2003.13461</em>, 2020.

</span>
</li>
<li id="bib.bib25" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hanzely and Richtárik [2020]</span>
<span class="ltx_bibblock">
Filip Hanzely and Peter Richtárik.

</span>
<span class="ltx_bibblock">Federated learning of a mixture of global and local models.

</span>
<span class="ltx_bibblock"><em id="bib.bib25.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2002.05516</em>, 2020.

</span>
</li>
<li id="bib.bib26" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hanzely et al. [2020]</span>
<span class="ltx_bibblock">
Filip Hanzely, Slavomír Hanzely, Samuel Horváth, and Peter
Richtárik.

</span>
<span class="ltx_bibblock">Lower bounds and optimal algorithms for personalized federated
learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib26.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2010.02372</em>, 2020.

</span>
</li>
<li id="bib.bib27" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. [2019b]</span>
<span class="ltx_bibblock">
Zhaojiang Lin, Andrea Madotto, Chien-Sheng Wu, and Pascale Fung.

</span>
<span class="ltx_bibblock">Personalizing dialogue agents via meta-learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib27.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1905.10033</em>, 2019b.

</span>
</li>
<li id="bib.bib28" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tamar et al. [2018]</span>
<span class="ltx_bibblock">
Aviv Tamar, Khashayar Rohanimanesh, Yinlam Chow, Chris Vigorito, Ben Goodrich,
Michael Kahane, and Derik Pridmore.

</span>
<span class="ltx_bibblock">Imitation learning from visual data with multiple intentions.

</span>
<span class="ltx_bibblock">In <em id="bib.bib28.1.1" class="ltx_emph ltx_font_italic">International Conference on Learning Representations</em>, 2018.

</span>
</li>
<li id="bib.bib29" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hsiao et al. [2019]</span>
<span class="ltx_bibblock">
Fang-I Hsiao, Jui-Hsuan Kuo, and Min Sun.

</span>
<span class="ltx_bibblock">Learning a multi-modal policy via imitating demonstrations with mixed
behaviors.

</span>
<span class="ltx_bibblock"><em id="bib.bib29.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1903.10304</em>, 2019.

</span>
</li>
<li id="bib.bib30" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paleja et al. [2020]</span>
<span class="ltx_bibblock">
Rohan Paleja, Andrew Silva, Letian Chen, and Matthew Gombolay.

</span>
<span class="ltx_bibblock">Interpretable and personalized apprenticeship scheduling: Learning
interpretable scheduling policies from heterogeneous user demonstrations.

</span>
<span class="ltx_bibblock">In H. Larochelle, M. Ranzato, R. Hadsell, M. F. Balcan, and H. Lin,
editors, <em id="bib.bib30.1.1" class="ltx_emph ltx_font_italic">Advances in Neural Information Processing Systems</em>, volume 33,
pages 6417–6428. Curran Associates, Inc., 2020.

</span>
</li>
<li id="bib.bib31" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Schrum et al. [2022]</span>
<span class="ltx_bibblock">
Mariah L Schrum, Erin Hedlund-Botti, Nina Moorman, and Matthew C Gombolay.

</span>
<span class="ltx_bibblock">Mind meld: Personalized meta-learning for robot-centric imitation
learning.

</span>
<span class="ltx_bibblock">In <em id="bib.bib31.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 2022 ACM/IEEE International Conference on
Human-Robot Interaction</em>, pages 157–165, 2022.

</span>
</li>
<li id="bib.bib32" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lu et al. [2021]</span>
<span class="ltx_bibblock">
Yujie Lu, Chao Huang, Huanli Zhan, and Yong Zhuang.

</span>
<span class="ltx_bibblock">Federated natural language generation for personalized dialogue
system.

</span>
<span class="ltx_bibblock"><em id="bib.bib32.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2110.06419</em>, 2021.

</span>
</li>
<li id="bib.bib33" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang and Flek [2021]</span>
<span class="ltx_bibblock">
Diyi Yang and Lucie Flek.

</span>
<span class="ltx_bibblock">Towards user-centric text-to-text generation: A survey.

</span>
<span class="ltx_bibblock">In <em id="bib.bib33.1.1" class="ltx_emph ltx_font_italic">International Conference on Text, Speech, and Dialogue</em>,
pages 3–22. Springer, 2021.

</span>
</li>
<li id="bib.bib34" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Majumder et al. [2020]</span>
<span class="ltx_bibblock">
Bodhisattwa Prasad Majumder, Harsh Jhamtani, Taylor Berg-Kirkpatrick, and
Julian McAuley.

</span>
<span class="ltx_bibblock">Like hiking? you probably enjoy nature: Persona-grounded dialog with
commonsense expansions.

</span>
<span class="ltx_bibblock"><em id="bib.bib34.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2010.03205</em>, 2020.

</span>
</li>
<li id="bib.bib35" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kim et al. [2020]</span>
<span class="ltx_bibblock">
Hyunwoo Kim, Byeongchang Kim, and Gunhee Kim.

</span>
<span class="ltx_bibblock">Will i sound like me? improving persona consistency in dialogues
through pragmatic self-consciousness.

</span>
<span class="ltx_bibblock"><em id="bib.bib35.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2004.05816</em>, 2020.

</span>
</li>
<li id="bib.bib36" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li and Liang [2021]</span>
<span class="ltx_bibblock">
Xiang Lisa Li and Percy Liang.

</span>
<span class="ltx_bibblock">Prefix-tuning: Optimizing continuous prompts for generation.

</span>
<span class="ltx_bibblock">In <em id="bib.bib36.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 59th Annual Meeting of the Association
for Computational Linguistics and the 11th International Joint Conference on
Natural Language Processing (Volume 1: Long Papers)</em>, pages 4582–4597,
Online, August 2021. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi:<a target="_blank" href="https://doi.org/10.18653/v1/2021.acl-long.353" title="" class="ltx_ref ltx_href">10.18653/v1/2021.acl-long.353</a>.

</span>
</li>
<li id="bib.bib37" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ha et al. [2016]</span>
<span class="ltx_bibblock">
David Ha, Andrew Dai, and Quoc V Le.

</span>
<span class="ltx_bibblock">Hypernetworks.

</span>
<span class="ltx_bibblock"><em id="bib.bib37.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1609.09106</em>, 2016.

</span>
</li>
<li id="bib.bib38" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shamsian et al. [2021]</span>
<span class="ltx_bibblock">
Aviv Shamsian, Aviv Navon, Ethan Fetaya, and Gal Chechik.

</span>
<span class="ltx_bibblock">Personalized federated learning using hypernetworks.

</span>
<span class="ltx_bibblock">In <em id="bib.bib38.1.1" class="ltx_emph ltx_font_italic">International Conference on Machine Learning</em>, pages
9489–9502. PMLR, 2021.

</span>
</li>
<li id="bib.bib39" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. [2017]</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones,
Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em id="bib.bib39.1.1" class="ltx_emph ltx_font_italic">Advances in neural information processing systems</em>, 30, 2017.

</span>
</li>
<li id="bib.bib40" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wolf et al. [2019]</span>
<span class="ltx_bibblock">
Thomas Wolf, Lysandre Debut, Victor Sanh, Julien Chaumond, Clement Delangue,
Anthony Moi, Pierric Cistac, Tim Rault, Rémi Louf, Morgan Funtowicz,
et al.

</span>
<span class="ltx_bibblock">Huggingface’s transformers: State-of-the-art natural language
processing.

</span>
<span class="ltx_bibblock"><em id="bib.bib40.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1910.03771</em>, 2019.

</span>
</li>
<li id="bib.bib41" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen and Choi [2016]</span>
<span class="ltx_bibblock">
Yu-Hsin Chen and Jinho D Choi.

</span>
<span class="ltx_bibblock">Character identification on multiparty conversation: Identifying
mentions of characters in tv shows.

</span>
<span class="ltx_bibblock">In <em id="bib.bib41.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 17th Annual Meeting of the Special
Interest Group on Discourse and Dialogue</em>, pages 90–100, 2016.

</span>
</li>
<li id="bib.bib42" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Koirala [2019]</span>
<span class="ltx_bibblock">
Shekhar Koirala.

</span>
<span class="ltx_bibblock">Game_of_thrones.

</span>
<span class="ltx_bibblock"><a href="github.com/shekharkoirala/Game_of_Thrones" title="" class="ltx_ref ltx_url ltx_font_typewriter">github.com/shekharkoirala/Game_of_Thrones</a>, 2019.

</span>
</li>
<li id="bib.bib43" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chang et al. [2020]</span>
<span class="ltx_bibblock">
Jonathan P. Chang, Caleb Chiam, Liye Fu, Andrew Z. Wang, Justine Zhang, and
Cristian Danescu-Niculescu-Mizil.

</span>
<span class="ltx_bibblock">Convokit: A toolkit for the analysis of conversations.

</span>
<span class="ltx_bibblock">In Olivier Pietquin, Smaranda Muresan, Vivian Chen, Casey Kennington,
David Vandyke, Nina Dethlefs, Koji Inoue, Erik Ekstedt, and Stefan Ultes,
editors, <em id="bib.bib43.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 21th Annual Meeting of the Special Interest
Group on Discourse and Dialogue, SIGdial 2020, 1st virtual meeting, July 1-3,
2020</em>, pages 57–60. Association for Computational Linguistics, 2020.

</span>
<span class="ltx_bibblock">URL <a target="_blank" href="https://aclanthology.org/2020.sigdial-1.8/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://aclanthology.org/2020.sigdial-1.8/</a>.

</span>
</li>
<li id="bib.bib44" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma and Ba [2014]</span>
<span class="ltx_bibblock">
Diederik P Kingma and Jimmy Ba.

</span>
<span class="ltx_bibblock">Adam: A method for stochastic optimization.

</span>
<span class="ltx_bibblock"><em id="bib.bib44.1.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1412.6980</em>, 2014.

</span>
</li>
</ul>
</section>
<section id="A1" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Generation Algorithm</h2>

<div id="A1.p1" class="ltx_para ltx_noindent">
<p id="A1.p1.1" class="ltx_p">At each time-step during inference, the embeddings are updated by the following equations.</p>
<table id="A3.EGx1" class="ltx_equationgroup ltx_eqn_gather ltx_eqn_table">

<tbody id="A1.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="A1.Ex1.m1.3" class="ltx_Math" alttext="\displaystyle e_{t}=Multi\_Head\_Attn(W_{&lt;t},LN(e_{t-1}),W_{&lt;t})" display="block"><semantics id="A1.Ex1.m1.3a"><mrow id="A1.Ex1.m1.3.3" xref="A1.Ex1.m1.3.3.cmml"><msub id="A1.Ex1.m1.3.3.5" xref="A1.Ex1.m1.3.3.5.cmml"><mi id="A1.Ex1.m1.3.3.5.2" xref="A1.Ex1.m1.3.3.5.2.cmml">e</mi><mi id="A1.Ex1.m1.3.3.5.3" xref="A1.Ex1.m1.3.3.5.3.cmml">t</mi></msub><mo id="A1.Ex1.m1.3.3.4" xref="A1.Ex1.m1.3.3.4.cmml">=</mo><mrow id="A1.Ex1.m1.3.3.3" xref="A1.Ex1.m1.3.3.3.cmml"><mi id="A1.Ex1.m1.3.3.3.5" xref="A1.Ex1.m1.3.3.3.5.cmml">M</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.6" xref="A1.Ex1.m1.3.3.3.6.cmml">u</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4a" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.7" xref="A1.Ex1.m1.3.3.3.7.cmml">l</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4b" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.8" xref="A1.Ex1.m1.3.3.3.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4c" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.9" xref="A1.Ex1.m1.3.3.3.9.cmml">i</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4d" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi mathvariant="normal" id="A1.Ex1.m1.3.3.3.10" xref="A1.Ex1.m1.3.3.3.10.cmml">_</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4e" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.11" xref="A1.Ex1.m1.3.3.3.11.cmml">H</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4f" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.12" xref="A1.Ex1.m1.3.3.3.12.cmml">e</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4g" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.13" xref="A1.Ex1.m1.3.3.3.13.cmml">a</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4h" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.14" xref="A1.Ex1.m1.3.3.3.14.cmml">d</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4i" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi mathvariant="normal" id="A1.Ex1.m1.3.3.3.15" xref="A1.Ex1.m1.3.3.3.15.cmml">_</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4j" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.16" xref="A1.Ex1.m1.3.3.3.16.cmml">A</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4k" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.17" xref="A1.Ex1.m1.3.3.3.17.cmml">t</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4l" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.18" xref="A1.Ex1.m1.3.3.3.18.cmml">t</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4m" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mi id="A1.Ex1.m1.3.3.3.19" xref="A1.Ex1.m1.3.3.3.19.cmml">n</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.3.3.3.4n" xref="A1.Ex1.m1.3.3.3.4.cmml">​</mo><mrow id="A1.Ex1.m1.3.3.3.3.3" xref="A1.Ex1.m1.3.3.3.3.4.cmml"><mo stretchy="false" id="A1.Ex1.m1.3.3.3.3.3.4" xref="A1.Ex1.m1.3.3.3.3.4.cmml">(</mo><msub id="A1.Ex1.m1.1.1.1.1.1.1" xref="A1.Ex1.m1.1.1.1.1.1.1.cmml"><mi id="A1.Ex1.m1.1.1.1.1.1.1.2" xref="A1.Ex1.m1.1.1.1.1.1.1.2.cmml">W</mi><mrow id="A1.Ex1.m1.1.1.1.1.1.1.3" xref="A1.Ex1.m1.1.1.1.1.1.1.3.cmml"><mi id="A1.Ex1.m1.1.1.1.1.1.1.3.2" xref="A1.Ex1.m1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="A1.Ex1.m1.1.1.1.1.1.1.3.1" xref="A1.Ex1.m1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="A1.Ex1.m1.1.1.1.1.1.1.3.3" xref="A1.Ex1.m1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub><mo id="A1.Ex1.m1.3.3.3.3.3.5" xref="A1.Ex1.m1.3.3.3.3.4.cmml">,</mo><mrow id="A1.Ex1.m1.2.2.2.2.2.2" xref="A1.Ex1.m1.2.2.2.2.2.2.cmml"><mi id="A1.Ex1.m1.2.2.2.2.2.2.3" xref="A1.Ex1.m1.2.2.2.2.2.2.3.cmml">L</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.2.2.2.2.2.2.2" xref="A1.Ex1.m1.2.2.2.2.2.2.2.cmml">​</mo><mi id="A1.Ex1.m1.2.2.2.2.2.2.4" xref="A1.Ex1.m1.2.2.2.2.2.2.4.cmml">N</mi><mo lspace="0em" rspace="0em" id="A1.Ex1.m1.2.2.2.2.2.2.2a" xref="A1.Ex1.m1.2.2.2.2.2.2.2.cmml">​</mo><mrow id="A1.Ex1.m1.2.2.2.2.2.2.1.1" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.cmml"><mo stretchy="false" id="A1.Ex1.m1.2.2.2.2.2.2.1.1.2" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.cmml">(</mo><msub id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.cmml"><mi id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.2" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.2.cmml">e</mi><mrow id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.cmml"><mi id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.2" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.2.cmml">t</mi><mo id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.1" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.1.cmml">−</mo><mn id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.3" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.3.cmml">1</mn></mrow></msub><mo stretchy="false" id="A1.Ex1.m1.2.2.2.2.2.2.1.1.3" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex1.m1.3.3.3.3.3.6" xref="A1.Ex1.m1.3.3.3.3.4.cmml">,</mo><msub id="A1.Ex1.m1.3.3.3.3.3.3" xref="A1.Ex1.m1.3.3.3.3.3.3.cmml"><mi id="A1.Ex1.m1.3.3.3.3.3.3.2" xref="A1.Ex1.m1.3.3.3.3.3.3.2.cmml">W</mi><mrow id="A1.Ex1.m1.3.3.3.3.3.3.3" xref="A1.Ex1.m1.3.3.3.3.3.3.3.cmml"><mi id="A1.Ex1.m1.3.3.3.3.3.3.3.2" xref="A1.Ex1.m1.3.3.3.3.3.3.3.2.cmml"></mi><mo id="A1.Ex1.m1.3.3.3.3.3.3.3.1" xref="A1.Ex1.m1.3.3.3.3.3.3.3.1.cmml">&lt;</mo><mi id="A1.Ex1.m1.3.3.3.3.3.3.3.3" xref="A1.Ex1.m1.3.3.3.3.3.3.3.3.cmml">t</mi></mrow></msub><mo stretchy="false" id="A1.Ex1.m1.3.3.3.3.3.7" xref="A1.Ex1.m1.3.3.3.3.4.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex1.m1.3b"><apply id="A1.Ex1.m1.3.3.cmml" xref="A1.Ex1.m1.3.3"><eq id="A1.Ex1.m1.3.3.4.cmml" xref="A1.Ex1.m1.3.3.4"></eq><apply id="A1.Ex1.m1.3.3.5.cmml" xref="A1.Ex1.m1.3.3.5"><csymbol cd="ambiguous" id="A1.Ex1.m1.3.3.5.1.cmml" xref="A1.Ex1.m1.3.3.5">subscript</csymbol><ci id="A1.Ex1.m1.3.3.5.2.cmml" xref="A1.Ex1.m1.3.3.5.2">𝑒</ci><ci id="A1.Ex1.m1.3.3.5.3.cmml" xref="A1.Ex1.m1.3.3.5.3">𝑡</ci></apply><apply id="A1.Ex1.m1.3.3.3.cmml" xref="A1.Ex1.m1.3.3.3"><times id="A1.Ex1.m1.3.3.3.4.cmml" xref="A1.Ex1.m1.3.3.3.4"></times><ci id="A1.Ex1.m1.3.3.3.5.cmml" xref="A1.Ex1.m1.3.3.3.5">𝑀</ci><ci id="A1.Ex1.m1.3.3.3.6.cmml" xref="A1.Ex1.m1.3.3.3.6">𝑢</ci><ci id="A1.Ex1.m1.3.3.3.7.cmml" xref="A1.Ex1.m1.3.3.3.7">𝑙</ci><ci id="A1.Ex1.m1.3.3.3.8.cmml" xref="A1.Ex1.m1.3.3.3.8">𝑡</ci><ci id="A1.Ex1.m1.3.3.3.9.cmml" xref="A1.Ex1.m1.3.3.3.9">𝑖</ci><ci id="A1.Ex1.m1.3.3.3.10.cmml" xref="A1.Ex1.m1.3.3.3.10">_</ci><ci id="A1.Ex1.m1.3.3.3.11.cmml" xref="A1.Ex1.m1.3.3.3.11">𝐻</ci><ci id="A1.Ex1.m1.3.3.3.12.cmml" xref="A1.Ex1.m1.3.3.3.12">𝑒</ci><ci id="A1.Ex1.m1.3.3.3.13.cmml" xref="A1.Ex1.m1.3.3.3.13">𝑎</ci><ci id="A1.Ex1.m1.3.3.3.14.cmml" xref="A1.Ex1.m1.3.3.3.14">𝑑</ci><ci id="A1.Ex1.m1.3.3.3.15.cmml" xref="A1.Ex1.m1.3.3.3.15">_</ci><ci id="A1.Ex1.m1.3.3.3.16.cmml" xref="A1.Ex1.m1.3.3.3.16">𝐴</ci><ci id="A1.Ex1.m1.3.3.3.17.cmml" xref="A1.Ex1.m1.3.3.3.17">𝑡</ci><ci id="A1.Ex1.m1.3.3.3.18.cmml" xref="A1.Ex1.m1.3.3.3.18">𝑡</ci><ci id="A1.Ex1.m1.3.3.3.19.cmml" xref="A1.Ex1.m1.3.3.3.19">𝑛</ci><vector id="A1.Ex1.m1.3.3.3.3.4.cmml" xref="A1.Ex1.m1.3.3.3.3.3"><apply id="A1.Ex1.m1.1.1.1.1.1.1.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex1.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex1.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1.2">𝑊</ci><apply id="A1.Ex1.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1.3"><lt id="A1.Ex1.m1.1.1.1.1.1.1.3.1.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="A1.Ex1.m1.1.1.1.1.1.1.3.2.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="A1.Ex1.m1.1.1.1.1.1.1.3.3.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply><apply id="A1.Ex1.m1.2.2.2.2.2.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2"><times id="A1.Ex1.m1.2.2.2.2.2.2.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.2"></times><ci id="A1.Ex1.m1.2.2.2.2.2.2.3.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.3">𝐿</ci><ci id="A1.Ex1.m1.2.2.2.2.2.2.4.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.4">𝑁</ci><apply id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1"><csymbol cd="ambiguous" id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.1.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1">subscript</csymbol><ci id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.2">𝑒</ci><apply id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3"><minus id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.1.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.1"></minus><ci id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.2">𝑡</ci><cn type="integer" id="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.3.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2.1.1.1.3.3">1</cn></apply></apply></apply><apply id="A1.Ex1.m1.3.3.3.3.3.3.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3"><csymbol cd="ambiguous" id="A1.Ex1.m1.3.3.3.3.3.3.1.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3">subscript</csymbol><ci id="A1.Ex1.m1.3.3.3.3.3.3.2.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3.2">𝑊</ci><apply id="A1.Ex1.m1.3.3.3.3.3.3.3.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3.3"><lt id="A1.Ex1.m1.3.3.3.3.3.3.3.1.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3.3.1"></lt><csymbol cd="latexml" id="A1.Ex1.m1.3.3.3.3.3.3.3.2.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3.3.2">absent</csymbol><ci id="A1.Ex1.m1.3.3.3.3.3.3.3.3.cmml" xref="A1.Ex1.m1.3.3.3.3.3.3.3.3">𝑡</ci></apply></apply></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex1.m1.3c">\displaystyle e_{t}=Multi\_Head\_Attn(W_{&lt;t},LN(e_{t-1}),W_{&lt;t})</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="A1.Ex2.m1.1" class="ltx_Math" alttext="\displaystyle e_{t}=LN(LN(e_{t})+LN(e_{t-1}))" display="block"><semantics id="A1.Ex2.m1.1a"><mrow id="A1.Ex2.m1.1.1" xref="A1.Ex2.m1.1.1.cmml"><msub id="A1.Ex2.m1.1.1.3" xref="A1.Ex2.m1.1.1.3.cmml"><mi id="A1.Ex2.m1.1.1.3.2" xref="A1.Ex2.m1.1.1.3.2.cmml">e</mi><mi id="A1.Ex2.m1.1.1.3.3" xref="A1.Ex2.m1.1.1.3.3.cmml">t</mi></msub><mo id="A1.Ex2.m1.1.1.2" xref="A1.Ex2.m1.1.1.2.cmml">=</mo><mrow id="A1.Ex2.m1.1.1.1" xref="A1.Ex2.m1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.3.cmml">L</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.2.cmml">​</mo><mi id="A1.Ex2.m1.1.1.1.4" xref="A1.Ex2.m1.1.1.1.4.cmml">N</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.2a" xref="A1.Ex2.m1.1.1.1.2.cmml">​</mo><mrow id="A1.Ex2.m1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.cmml"><mrow id="A1.Ex2.m1.1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.1.3.cmml">L</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.1.2.cmml">​</mo><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.4" xref="A1.Ex2.m1.1.1.1.1.1.1.1.4.cmml">N</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.1.1.1.1.2a" xref="A1.Ex2.m1.1.1.1.1.1.1.1.2.cmml">​</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">e</mi><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex2.m1.1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.3.cmml">+</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.2.3" xref="A1.Ex2.m1.1.1.1.1.1.1.2.3.cmml">L</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.1.1.1.2.2" xref="A1.Ex2.m1.1.1.1.1.1.1.2.2.cmml">​</mo><mi id="A1.Ex2.m1.1.1.1.1.1.1.2.4" xref="A1.Ex2.m1.1.1.1.1.1.1.2.4.cmml">N</mi><mo lspace="0em" rspace="0em" id="A1.Ex2.m1.1.1.1.1.1.1.2.2a" xref="A1.Ex2.m1.1.1.1.1.1.1.2.2.cmml">​</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.cmml"><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.cmml">(</mo><msub id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.2.cmml">e</mi><mrow id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.2" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.2.cmml">t</mi><mo id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.1" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.1.cmml">−</mo><mn id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.3" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.3.cmml">1</mn></mrow></msub><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo stretchy="false" id="A1.Ex2.m1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex2.m1.1b"><apply id="A1.Ex2.m1.1.1.cmml" xref="A1.Ex2.m1.1.1"><eq id="A1.Ex2.m1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.2"></eq><apply id="A1.Ex2.m1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex2.m1.1.1.3.1.cmml" xref="A1.Ex2.m1.1.1.3">subscript</csymbol><ci id="A1.Ex2.m1.1.1.3.2.cmml" xref="A1.Ex2.m1.1.1.3.2">𝑒</ci><ci id="A1.Ex2.m1.1.1.3.3.cmml" xref="A1.Ex2.m1.1.1.3.3">𝑡</ci></apply><apply id="A1.Ex2.m1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1"><times id="A1.Ex2.m1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.2"></times><ci id="A1.Ex2.m1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.3">𝐿</ci><ci id="A1.Ex2.m1.1.1.1.4.cmml" xref="A1.Ex2.m1.1.1.1.4">𝑁</ci><apply id="A1.Ex2.m1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1"><plus id="A1.Ex2.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.3"></plus><apply id="A1.Ex2.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1"><times id="A1.Ex2.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.2"></times><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.3">𝐿</ci><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.4.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.4">𝑁</ci><apply id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.2">𝑒</ci><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.1.1.3">𝑡</ci></apply></apply><apply id="A1.Ex2.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2"><times id="A1.Ex2.m1.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.2"></times><ci id="A1.Ex2.m1.1.1.1.1.1.1.2.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.3">𝐿</ci><ci id="A1.Ex2.m1.1.1.1.1.1.1.2.4.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.4">𝑁</ci><apply id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1"><csymbol cd="ambiguous" id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1">subscript</csymbol><ci id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.2">𝑒</ci><apply id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3"><minus id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.1"></minus><ci id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.2">𝑡</ci><cn type="integer" id="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.2.1.1.1.3.3">1</cn></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex2.m1.1c">\displaystyle e_{t}=LN(LN(e_{t})+LN(e_{t-1}))</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="A1.Ex3.m1.1" class="ltx_math_unparsed" alttext="\displaystyle e_{t}=LN(FFN(e_{t})+LN(e_{t-1})" display="block"><semantics id="A1.Ex3.m1.1a"><mrow id="A1.Ex3.m1.1b"><msub id="A1.Ex3.m1.1.1"><mi id="A1.Ex3.m1.1.1.2">e</mi><mi id="A1.Ex3.m1.1.1.3">t</mi></msub><mo id="A1.Ex3.m1.1.2">=</mo><mi id="A1.Ex3.m1.1.3">L</mi><mi id="A1.Ex3.m1.1.4">N</mi><mrow id="A1.Ex3.m1.1.5"><mo stretchy="false" id="A1.Ex3.m1.1.5.1">(</mo><mi id="A1.Ex3.m1.1.5.2">F</mi><mi id="A1.Ex3.m1.1.5.3">F</mi><mi id="A1.Ex3.m1.1.5.4">N</mi><mrow id="A1.Ex3.m1.1.5.5"><mo stretchy="false" id="A1.Ex3.m1.1.5.5.1">(</mo><msub id="A1.Ex3.m1.1.5.5.2"><mi id="A1.Ex3.m1.1.5.5.2.2">e</mi><mi id="A1.Ex3.m1.1.5.5.2.3">t</mi></msub><mo stretchy="false" id="A1.Ex3.m1.1.5.5.3">)</mo></mrow><mo id="A1.Ex3.m1.1.5.6">+</mo><mi id="A1.Ex3.m1.1.5.7">L</mi><mi id="A1.Ex3.m1.1.5.8">N</mi><mrow id="A1.Ex3.m1.1.5.9"><mo stretchy="false" id="A1.Ex3.m1.1.5.9.1">(</mo><msub id="A1.Ex3.m1.1.5.9.2"><mi id="A1.Ex3.m1.1.5.9.2.2">e</mi><mrow id="A1.Ex3.m1.1.5.9.2.3"><mi id="A1.Ex3.m1.1.5.9.2.3.2">t</mi><mo id="A1.Ex3.m1.1.5.9.2.3.1">−</mo><mn id="A1.Ex3.m1.1.5.9.2.3.3">1</mn></mrow></msub><mo stretchy="false" id="A1.Ex3.m1.1.5.9.3">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex" id="A1.Ex3.m1.1c">\displaystyle e_{t}=LN(FFN(e_{t})+LN(e_{t-1})</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="A1.p2" class="ltx_para ltx_noindent">
<p id="A1.p2.5" class="ltx_p">For the first timestep, <math id="A1.p2.1.m1.1" class="ltx_Math" alttext="e_{t-1}" display="inline"><semantics id="A1.p2.1.m1.1a"><msub id="A1.p2.1.m1.1.1" xref="A1.p2.1.m1.1.1.cmml"><mi id="A1.p2.1.m1.1.1.2" xref="A1.p2.1.m1.1.1.2.cmml">e</mi><mrow id="A1.p2.1.m1.1.1.3" xref="A1.p2.1.m1.1.1.3.cmml"><mi id="A1.p2.1.m1.1.1.3.2" xref="A1.p2.1.m1.1.1.3.2.cmml">t</mi><mo id="A1.p2.1.m1.1.1.3.1" xref="A1.p2.1.m1.1.1.3.1.cmml">−</mo><mn id="A1.p2.1.m1.1.1.3.3" xref="A1.p2.1.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="A1.p2.1.m1.1b"><apply id="A1.p2.1.m1.1.1.cmml" xref="A1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="A1.p2.1.m1.1.1.1.cmml" xref="A1.p2.1.m1.1.1">subscript</csymbol><ci id="A1.p2.1.m1.1.1.2.cmml" xref="A1.p2.1.m1.1.1.2">𝑒</ci><apply id="A1.p2.1.m1.1.1.3.cmml" xref="A1.p2.1.m1.1.1.3"><minus id="A1.p2.1.m1.1.1.3.1.cmml" xref="A1.p2.1.m1.1.1.3.1"></minus><ci id="A1.p2.1.m1.1.1.3.2.cmml" xref="A1.p2.1.m1.1.1.3.2">𝑡</ci><cn type="integer" id="A1.p2.1.m1.1.1.3.3.cmml" xref="A1.p2.1.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.1.m1.1c">e_{t-1}</annotation></semantics></math> is initialized as <math id="A1.p2.2.m2.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="A1.p2.2.m2.1a"><mi id="A1.p2.2.m2.1.1" xref="A1.p2.2.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="A1.p2.2.m2.1b"><ci id="A1.p2.2.m2.1.1.cmml" xref="A1.p2.2.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.2.m2.1c">\phi</annotation></semantics></math> or <math id="A1.p2.3.m3.1" class="ltx_Math" alttext="\psi" display="inline"><semantics id="A1.p2.3.m3.1a"><mi id="A1.p2.3.m3.1.1" xref="A1.p2.3.m3.1.1.cmml">ψ</mi><annotation-xml encoding="MathML-Content" id="A1.p2.3.m3.1b"><ci id="A1.p2.3.m3.1.1.cmml" xref="A1.p2.3.m3.1.1">𝜓</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.3.m3.1c">\psi</annotation></semantics></math> for personal and context embeddings respectively, and <math id="A1.p2.4.m4.1" class="ltx_Math" alttext="LN" display="inline"><semantics id="A1.p2.4.m4.1a"><mrow id="A1.p2.4.m4.1.1" xref="A1.p2.4.m4.1.1.cmml"><mi id="A1.p2.4.m4.1.1.2" xref="A1.p2.4.m4.1.1.2.cmml">L</mi><mo lspace="0em" rspace="0em" id="A1.p2.4.m4.1.1.1" xref="A1.p2.4.m4.1.1.1.cmml">​</mo><mi id="A1.p2.4.m4.1.1.3" xref="A1.p2.4.m4.1.1.3.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="A1.p2.4.m4.1b"><apply id="A1.p2.4.m4.1.1.cmml" xref="A1.p2.4.m4.1.1"><times id="A1.p2.4.m4.1.1.1.cmml" xref="A1.p2.4.m4.1.1.1"></times><ci id="A1.p2.4.m4.1.1.2.cmml" xref="A1.p2.4.m4.1.1.2">𝐿</ci><ci id="A1.p2.4.m4.1.1.3.cmml" xref="A1.p2.4.m4.1.1.3">𝑁</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.4.m4.1c">LN</annotation></semantics></math> represents a layer normalization function. We apply future-masking to prevent any future-information in the sequence from leaking forward into the rest of the model. After processing the entire utterance, the generated embedding is updated to the final value of <math id="A1.p2.5.m5.1" class="ltx_Math" alttext="e_{t}" display="inline"><semantics id="A1.p2.5.m5.1a"><msub id="A1.p2.5.m5.1.1" xref="A1.p2.5.m5.1.1.cmml"><mi id="A1.p2.5.m5.1.1.2" xref="A1.p2.5.m5.1.1.2.cmml">e</mi><mi id="A1.p2.5.m5.1.1.3" xref="A1.p2.5.m5.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="A1.p2.5.m5.1b"><apply id="A1.p2.5.m5.1.1.cmml" xref="A1.p2.5.m5.1.1"><csymbol cd="ambiguous" id="A1.p2.5.m5.1.1.1.cmml" xref="A1.p2.5.m5.1.1">subscript</csymbol><ci id="A1.p2.5.m5.1.1.2.cmml" xref="A1.p2.5.m5.1.1.2">𝑒</ci><ci id="A1.p2.5.m5.1.1.3.cmml" xref="A1.p2.5.m5.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.5.m5.1c">e_{t}</annotation></semantics></math>, which can then be stored on-device for future processing.
An updated algorithm which applies the generator to predict preference embeddings can be found in Alg <a href="#alg2" title="Algorithm 2 ‣ Appendix A Generation Algorithm ‣ FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<figure id="alg2" class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="alg2.2.1.1" class="ltx_text ltx_font_bold">Algorithm 2</span> </span> Personalized Federated Learning Loop with Generated Embeddings</figcaption>
<div id="alg2.3" class="ltx_listing ltx_listing">
<div id="algx1.l1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1:</span>  <span id="algx1.l1.1" class="ltx_text ltx_font_bold">Given:</span> Training objective, <math id="algx1.l1.m1.1" class="ltx_Math" alttext="\mathcal{L}" display="inline"><semantics id="algx1.l1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="algx1.l1.m1.1.1" xref="algx1.l1.m1.1.1.cmml">ℒ</mi><annotation-xml encoding="MathML-Content" id="algx1.l1.m1.1b"><ci id="algx1.l1.m1.1.1.cmml" xref="algx1.l1.m1.1.1">ℒ</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l1.m1.1c">\mathcal{L}</annotation></semantics></math>, Client devices <math id="algx1.l1.m2.1" class="ltx_Math" alttext="D" display="inline"><semantics id="algx1.l1.m2.1a"><mi id="algx1.l1.m2.1.1" xref="algx1.l1.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="algx1.l1.m2.1b"><ci id="algx1.l1.m2.1.1.cmml" xref="algx1.l1.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l1.m2.1c">D</annotation></semantics></math>

</div>
<div id="algx1.l2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2:</span>  <span id="algx1.l2.1" class="ltx_text ltx_font_bold">Given:</span> Number of client steps, <math id="algx1.l2.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="algx1.l2.m1.1a"><mi id="algx1.l2.m1.1.1" xref="algx1.l2.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="algx1.l2.m1.1b"><ci id="algx1.l2.m1.1.1.cmml" xref="algx1.l2.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l2.m1.1c">K</annotation></semantics></math>

</div>
<div id="algx1.l3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3:</span>  <span id="algx1.l3.1" class="ltx_text ltx_font_bold">Given:</span> Number of global steps, <math id="algx1.l3.m1.1" class="ltx_Math" alttext="N" display="inline"><semantics id="algx1.l3.m1.1a"><mi id="algx1.l3.m1.1.1" xref="algx1.l3.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="algx1.l3.m1.1b"><ci id="algx1.l3.m1.1.1.cmml" xref="algx1.l3.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l3.m1.1c">N</annotation></semantics></math>

</div>
<div id="algx1.l4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4:</span>  <span id="algx1.l4.1" class="ltx_text ltx_font_bold">Initialize:</span> Global model, <math id="algx1.l4.m1.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="algx1.l4.m1.1a"><mi id="algx1.l4.m1.1.1" xref="algx1.l4.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="algx1.l4.m1.1b"><ci id="algx1.l4.m1.1.1.cmml" xref="algx1.l4.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l4.m1.1c">\theta</annotation></semantics></math>, Context embeddings <math id="algx1.l4.m2.1" class="ltx_Math" alttext="\phi" display="inline"><semantics id="algx1.l4.m2.1a"><mi id="algx1.l4.m2.1.1" xref="algx1.l4.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="algx1.l4.m2.1b"><ci id="algx1.l4.m2.1.1.cmml" xref="algx1.l4.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l4.m2.1c">\phi</annotation></semantics></math>, Context Generator <math id="algx1.l4.m3.1" class="ltx_Math" alttext="\Gamma" display="inline"><semantics id="algx1.l4.m3.1a"><mi mathvariant="normal" id="algx1.l4.m3.1.1" xref="algx1.l4.m3.1.1.cmml">Γ</mi><annotation-xml encoding="MathML-Content" id="algx1.l4.m3.1b"><ci id="algx1.l4.m3.1.1.cmml" xref="algx1.l4.m3.1.1">Γ</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l4.m3.1c">\Gamma</annotation></semantics></math>, Client Generator <math id="algx1.l4.m4.1" class="ltx_Math" alttext="\nu" display="inline"><semantics id="algx1.l4.m4.1a"><mi id="algx1.l4.m4.1.1" xref="algx1.l4.m4.1.1.cmml">ν</mi><annotation-xml encoding="MathML-Content" id="algx1.l4.m4.1b"><ci id="algx1.l4.m4.1.1.cmml" xref="algx1.l4.m4.1.1">𝜈</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l4.m4.1c">\nu</annotation></semantics></math>

</div>
<div id="algx1.l5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5:</span>  <span id="algx1.l5.1" class="ltx_text ltx_font_bold">Initialize:</span> Personal embeddings on-device <math id="algx1.l5.m1.1" class="ltx_Math" alttext="\psi" display="inline"><semantics id="algx1.l5.m1.1a"><mi id="algx1.l5.m1.1.1" xref="algx1.l5.m1.1.1.cmml">ψ</mi><annotation-xml encoding="MathML-Content" id="algx1.l5.m1.1b"><ci id="algx1.l5.m1.1.1.cmml" xref="algx1.l5.m1.1.1">𝜓</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l5.m1.1c">\psi</annotation></semantics></math>

</div>
<div id="algx1.l6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6:</span>  <span id="algx1.l6.1" class="ltx_text ltx_font_bold">for</span> <math id="algx1.l6.m1.1" class="ltx_Math" alttext="n\in N" display="inline"><semantics id="algx1.l6.m1.1a"><mrow id="algx1.l6.m1.1.1" xref="algx1.l6.m1.1.1.cmml"><mi id="algx1.l6.m1.1.1.2" xref="algx1.l6.m1.1.1.2.cmml">n</mi><mo id="algx1.l6.m1.1.1.1" xref="algx1.l6.m1.1.1.1.cmml">∈</mo><mi id="algx1.l6.m1.1.1.3" xref="algx1.l6.m1.1.1.3.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="algx1.l6.m1.1b"><apply id="algx1.l6.m1.1.1.cmml" xref="algx1.l6.m1.1.1"><in id="algx1.l6.m1.1.1.1.cmml" xref="algx1.l6.m1.1.1.1"></in><ci id="algx1.l6.m1.1.1.2.cmml" xref="algx1.l6.m1.1.1.2">𝑛</ci><ci id="algx1.l6.m1.1.1.3.cmml" xref="algx1.l6.m1.1.1.3">𝑁</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l6.m1.1c">n\in N</annotation></semantics></math> <span id="algx1.l6.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="algx1.l7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7:</span>     <span id="algx1.l7.1" class="ltx_text ltx_font_bold">for</span> <math id="algx1.l7.m1.1" class="ltx_Math" alttext="d\in D" display="inline"><semantics id="algx1.l7.m1.1a"><mrow id="algx1.l7.m1.1.1" xref="algx1.l7.m1.1.1.cmml"><mi id="algx1.l7.m1.1.1.2" xref="algx1.l7.m1.1.1.2.cmml">d</mi><mo id="algx1.l7.m1.1.1.1" xref="algx1.l7.m1.1.1.1.cmml">∈</mo><mi id="algx1.l7.m1.1.1.3" xref="algx1.l7.m1.1.1.3.cmml">D</mi></mrow><annotation-xml encoding="MathML-Content" id="algx1.l7.m1.1b"><apply id="algx1.l7.m1.1.1.cmml" xref="algx1.l7.m1.1.1"><in id="algx1.l7.m1.1.1.1.cmml" xref="algx1.l7.m1.1.1.1"></in><ci id="algx1.l7.m1.1.1.2.cmml" xref="algx1.l7.m1.1.1.2">𝑑</ci><ci id="algx1.l7.m1.1.1.3.cmml" xref="algx1.l7.m1.1.1.3">𝐷</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l7.m1.1c">d\in D</annotation></semantics></math> <span id="algx1.l7.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="algx1.l8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8:</span>        <math id="algx1.l8.m1.2" class="ltx_Math" alttext="\theta_{d}=\theta,\phi_{d}=\phi,\Gamma_{d}=\Gamma,\nu_{d}=\nu" display="inline"><semantics id="algx1.l8.m1.2a"><mrow id="algx1.l8.m1.2.2.2" xref="algx1.l8.m1.2.2.3.cmml"><mrow id="algx1.l8.m1.1.1.1.1" xref="algx1.l8.m1.1.1.1.1.cmml"><msub id="algx1.l8.m1.1.1.1.1.2" xref="algx1.l8.m1.1.1.1.1.2.cmml"><mi id="algx1.l8.m1.1.1.1.1.2.2" xref="algx1.l8.m1.1.1.1.1.2.2.cmml">θ</mi><mi id="algx1.l8.m1.1.1.1.1.2.3" xref="algx1.l8.m1.1.1.1.1.2.3.cmml">d</mi></msub><mo id="algx1.l8.m1.1.1.1.1.1" xref="algx1.l8.m1.1.1.1.1.1.cmml">=</mo><mi id="algx1.l8.m1.1.1.1.1.3" xref="algx1.l8.m1.1.1.1.1.3.cmml">θ</mi></mrow><mo id="algx1.l8.m1.2.2.2.3" xref="algx1.l8.m1.2.2.3a.cmml">,</mo><mrow id="algx1.l8.m1.2.2.2.2.2" xref="algx1.l8.m1.2.2.2.2.3.cmml"><mrow id="algx1.l8.m1.2.2.2.2.1.1" xref="algx1.l8.m1.2.2.2.2.1.1.cmml"><msub id="algx1.l8.m1.2.2.2.2.1.1.2" xref="algx1.l8.m1.2.2.2.2.1.1.2.cmml"><mi id="algx1.l8.m1.2.2.2.2.1.1.2.2" xref="algx1.l8.m1.2.2.2.2.1.1.2.2.cmml">ϕ</mi><mi id="algx1.l8.m1.2.2.2.2.1.1.2.3" xref="algx1.l8.m1.2.2.2.2.1.1.2.3.cmml">d</mi></msub><mo id="algx1.l8.m1.2.2.2.2.1.1.1" xref="algx1.l8.m1.2.2.2.2.1.1.1.cmml">=</mo><mi id="algx1.l8.m1.2.2.2.2.1.1.3" xref="algx1.l8.m1.2.2.2.2.1.1.3.cmml">ϕ</mi></mrow><mo id="algx1.l8.m1.2.2.2.2.2.3" xref="algx1.l8.m1.2.2.2.2.3a.cmml">,</mo><mrow id="algx1.l8.m1.2.2.2.2.2.2.2" xref="algx1.l8.m1.2.2.2.2.2.2.3.cmml"><mrow id="algx1.l8.m1.2.2.2.2.2.2.1.1" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.cmml"><msub id="algx1.l8.m1.2.2.2.2.2.2.1.1.2" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2.cmml"><mi mathvariant="normal" id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.2" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2.2.cmml">Γ</mi><mi id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.3" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2.3.cmml">d</mi></msub><mo id="algx1.l8.m1.2.2.2.2.2.2.1.1.1" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.1.cmml">=</mo><mi mathvariant="normal" id="algx1.l8.m1.2.2.2.2.2.2.1.1.3" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.3.cmml">Γ</mi></mrow><mo id="algx1.l8.m1.2.2.2.2.2.2.2.3" xref="algx1.l8.m1.2.2.2.2.2.2.3a.cmml">,</mo><mrow id="algx1.l8.m1.2.2.2.2.2.2.2.2" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.cmml"><msub id="algx1.l8.m1.2.2.2.2.2.2.2.2.2" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2.cmml"><mi id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.2" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2.2.cmml">ν</mi><mi id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.3" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2.3.cmml">d</mi></msub><mo id="algx1.l8.m1.2.2.2.2.2.2.2.2.1" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.1.cmml">=</mo><mi id="algx1.l8.m1.2.2.2.2.2.2.2.2.3" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.3.cmml">ν</mi></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l8.m1.2b"><apply id="algx1.l8.m1.2.2.3.cmml" xref="algx1.l8.m1.2.2.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.3a.cmml" xref="algx1.l8.m1.2.2.2.3">formulae-sequence</csymbol><apply id="algx1.l8.m1.1.1.1.1.cmml" xref="algx1.l8.m1.1.1.1.1"><eq id="algx1.l8.m1.1.1.1.1.1.cmml" xref="algx1.l8.m1.1.1.1.1.1"></eq><apply id="algx1.l8.m1.1.1.1.1.2.cmml" xref="algx1.l8.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="algx1.l8.m1.1.1.1.1.2.1.cmml" xref="algx1.l8.m1.1.1.1.1.2">subscript</csymbol><ci id="algx1.l8.m1.1.1.1.1.2.2.cmml" xref="algx1.l8.m1.1.1.1.1.2.2">𝜃</ci><ci id="algx1.l8.m1.1.1.1.1.2.3.cmml" xref="algx1.l8.m1.1.1.1.1.2.3">𝑑</ci></apply><ci id="algx1.l8.m1.1.1.1.1.3.cmml" xref="algx1.l8.m1.1.1.1.1.3">𝜃</ci></apply><apply id="algx1.l8.m1.2.2.2.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.2.2.3a.cmml" xref="algx1.l8.m1.2.2.2.2.2.3">formulae-sequence</csymbol><apply id="algx1.l8.m1.2.2.2.2.1.1.cmml" xref="algx1.l8.m1.2.2.2.2.1.1"><eq id="algx1.l8.m1.2.2.2.2.1.1.1.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.1"></eq><apply id="algx1.l8.m1.2.2.2.2.1.1.2.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.2.2.1.1.2.1.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.2">subscript</csymbol><ci id="algx1.l8.m1.2.2.2.2.1.1.2.2.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.2.2">italic-ϕ</ci><ci id="algx1.l8.m1.2.2.2.2.1.1.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.2.3">𝑑</ci></apply><ci id="algx1.l8.m1.2.2.2.2.1.1.3.cmml" xref="algx1.l8.m1.2.2.2.2.1.1.3">italic-ϕ</ci></apply><apply id="algx1.l8.m1.2.2.2.2.2.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.2.2.2.2.3a.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.3">formulae-sequence</csymbol><apply id="algx1.l8.m1.2.2.2.2.2.2.1.1.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1"><eq id="algx1.l8.m1.2.2.2.2.2.2.1.1.1.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.1"></eq><apply id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.1.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2">subscript</csymbol><ci id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.2.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2.2">Γ</ci><ci id="algx1.l8.m1.2.2.2.2.2.2.1.1.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.2.3">𝑑</ci></apply><ci id="algx1.l8.m1.2.2.2.2.2.2.1.1.3.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.1.1.3">Γ</ci></apply><apply id="algx1.l8.m1.2.2.2.2.2.2.2.2.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2"><eq id="algx1.l8.m1.2.2.2.2.2.2.2.2.1.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.1"></eq><apply id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.1.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2">subscript</csymbol><ci id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.2.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2.2">𝜈</ci><ci id="algx1.l8.m1.2.2.2.2.2.2.2.2.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.2.3">𝑑</ci></apply><ci id="algx1.l8.m1.2.2.2.2.2.2.2.2.3.cmml" xref="algx1.l8.m1.2.2.2.2.2.2.2.2.3">𝜈</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l8.m1.2c">\theta_{d}=\theta,\phi_{d}=\phi,\Gamma_{d}=\Gamma,\nu_{d}=\nu</annotation></semantics></math>

</div>
<div id="algx1.l9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9:</span>        <span id="algx1.l9.1" class="ltx_text ltx_font_bold">for</span> <math id="algx1.l9.m1.1" class="ltx_Math" alttext="k\in K" display="inline"><semantics id="algx1.l9.m1.1a"><mrow id="algx1.l9.m1.1.1" xref="algx1.l9.m1.1.1.cmml"><mi id="algx1.l9.m1.1.1.2" xref="algx1.l9.m1.1.1.2.cmml">k</mi><mo id="algx1.l9.m1.1.1.1" xref="algx1.l9.m1.1.1.1.cmml">∈</mo><mi id="algx1.l9.m1.1.1.3" xref="algx1.l9.m1.1.1.3.cmml">K</mi></mrow><annotation-xml encoding="MathML-Content" id="algx1.l9.m1.1b"><apply id="algx1.l9.m1.1.1.cmml" xref="algx1.l9.m1.1.1"><in id="algx1.l9.m1.1.1.1.cmml" xref="algx1.l9.m1.1.1.1"></in><ci id="algx1.l9.m1.1.1.2.cmml" xref="algx1.l9.m1.1.1.2">𝑘</ci><ci id="algx1.l9.m1.1.1.3.cmml" xref="algx1.l9.m1.1.1.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l9.m1.1c">k\in K</annotation></semantics></math> <span id="algx1.l9.2" class="ltx_text ltx_font_bold">do</span>



</div>
<div id="algx1.l10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10:</span>           Sample <math id="algx1.l10.m1.1" class="ltx_Math" alttext="B_{d}" display="inline"><semantics id="algx1.l10.m1.1a"><msub id="algx1.l10.m1.1.1" xref="algx1.l10.m1.1.1.cmml"><mi id="algx1.l10.m1.1.1.2" xref="algx1.l10.m1.1.1.2.cmml">B</mi><mi id="algx1.l10.m1.1.1.3" xref="algx1.l10.m1.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="algx1.l10.m1.1b"><apply id="algx1.l10.m1.1.1.cmml" xref="algx1.l10.m1.1.1"><csymbol cd="ambiguous" id="algx1.l10.m1.1.1.1.cmml" xref="algx1.l10.m1.1.1">subscript</csymbol><ci id="algx1.l10.m1.1.1.2.cmml" xref="algx1.l10.m1.1.1.2">𝐵</ci><ci id="algx1.l10.m1.1.1.3.cmml" xref="algx1.l10.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l10.m1.1c">B_{d}</annotation></semantics></math> from client’s on-device data

</div>
<div id="algx1.l11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11:</span>           <math id="algx1.l11.m1.6" class="ltx_Math" alttext="\theta_{d}\leftarrow\theta_{d}+\nabla_{\theta}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="algx1.l11.m1.6a"><mrow id="algx1.l11.m1.6.6" xref="algx1.l11.m1.6.6.cmml"><msub id="algx1.l11.m1.6.6.6" xref="algx1.l11.m1.6.6.6.cmml"><mi id="algx1.l11.m1.6.6.6.2" xref="algx1.l11.m1.6.6.6.2.cmml">θ</mi><mi id="algx1.l11.m1.6.6.6.3" xref="algx1.l11.m1.6.6.6.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l11.m1.6.6.5" xref="algx1.l11.m1.6.6.5.cmml">←</mo><mrow id="algx1.l11.m1.6.6.4" xref="algx1.l11.m1.6.6.4.cmml"><msub id="algx1.l11.m1.6.6.4.6" xref="algx1.l11.m1.6.6.4.6.cmml"><mi id="algx1.l11.m1.6.6.4.6.2" xref="algx1.l11.m1.6.6.4.6.2.cmml">θ</mi><mi id="algx1.l11.m1.6.6.4.6.3" xref="algx1.l11.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="algx1.l11.m1.6.6.4.5" xref="algx1.l11.m1.6.6.4.5.cmml">+</mo><mrow id="algx1.l11.m1.6.6.4.4" xref="algx1.l11.m1.6.6.4.4.cmml"><mrow id="algx1.l11.m1.6.6.4.4.6" xref="algx1.l11.m1.6.6.4.4.6.cmml"><msub id="algx1.l11.m1.6.6.4.4.6.1" xref="algx1.l11.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="algx1.l11.m1.6.6.4.4.6.1.2" xref="algx1.l11.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi id="algx1.l11.m1.6.6.4.4.6.1.3" xref="algx1.l11.m1.6.6.4.4.6.1.3.cmml">θ</mi></msub><mi class="ltx_font_mathcaligraphic" id="algx1.l11.m1.6.6.4.4.6.2" xref="algx1.l11.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="algx1.l11.m1.6.6.4.4.5" xref="algx1.l11.m1.6.6.4.4.5.cmml">​</mo><mrow id="algx1.l11.m1.6.6.4.4.4.4" xref="algx1.l11.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="algx1.l11.m1.6.6.4.4.4.4.5" xref="algx1.l11.m1.6.6.4.4.4.5.cmml">(</mo><msub id="algx1.l11.m1.3.3.1.1.1.1.1" xref="algx1.l11.m1.3.3.1.1.1.1.1.cmml"><mi id="algx1.l11.m1.3.3.1.1.1.1.1.2" xref="algx1.l11.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="algx1.l11.m1.3.3.1.1.1.1.1.3" xref="algx1.l11.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="algx1.l11.m1.6.6.4.4.4.4.6" xref="algx1.l11.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l11.m1.4.4.2.2.2.2.2" xref="algx1.l11.m1.4.4.2.2.2.2.2.cmml"><mi id="algx1.l11.m1.4.4.2.2.2.2.2.2" xref="algx1.l11.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="algx1.l11.m1.2.2.2.4" xref="algx1.l11.m1.2.2.2.3.cmml"><mi id="algx1.l11.m1.1.1.1.1" xref="algx1.l11.m1.1.1.1.1.cmml">d</mi><mo id="algx1.l11.m1.2.2.2.4.1" xref="algx1.l11.m1.2.2.2.3.cmml">,</mo><mi id="algx1.l11.m1.2.2.2.2" xref="algx1.l11.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="algx1.l11.m1.6.6.4.4.4.4.7" xref="algx1.l11.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l11.m1.5.5.3.3.3.3.3" xref="algx1.l11.m1.5.5.3.3.3.3.3.cmml"><mi id="algx1.l11.m1.5.5.3.3.3.3.3.2" xref="algx1.l11.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="algx1.l11.m1.5.5.3.3.3.3.3.3" xref="algx1.l11.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="algx1.l11.m1.6.6.4.4.4.4.8" xref="algx1.l11.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l11.m1.6.6.4.4.4.4.4" xref="algx1.l11.m1.6.6.4.4.4.4.4.cmml"><mi id="algx1.l11.m1.6.6.4.4.4.4.4.2" xref="algx1.l11.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="algx1.l11.m1.6.6.4.4.4.4.4.3" xref="algx1.l11.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l11.m1.6.6.4.4.4.4.9" xref="algx1.l11.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l11.m1.6b"><apply id="algx1.l11.m1.6.6.cmml" xref="algx1.l11.m1.6.6"><ci id="algx1.l11.m1.6.6.5.cmml" xref="algx1.l11.m1.6.6.5">←</ci><apply id="algx1.l11.m1.6.6.6.cmml" xref="algx1.l11.m1.6.6.6"><csymbol cd="ambiguous" id="algx1.l11.m1.6.6.6.1.cmml" xref="algx1.l11.m1.6.6.6">subscript</csymbol><ci id="algx1.l11.m1.6.6.6.2.cmml" xref="algx1.l11.m1.6.6.6.2">𝜃</ci><ci id="algx1.l11.m1.6.6.6.3.cmml" xref="algx1.l11.m1.6.6.6.3">𝑑</ci></apply><apply id="algx1.l11.m1.6.6.4.cmml" xref="algx1.l11.m1.6.6.4"><plus id="algx1.l11.m1.6.6.4.5.cmml" xref="algx1.l11.m1.6.6.4.5"></plus><apply id="algx1.l11.m1.6.6.4.6.cmml" xref="algx1.l11.m1.6.6.4.6"><csymbol cd="ambiguous" id="algx1.l11.m1.6.6.4.6.1.cmml" xref="algx1.l11.m1.6.6.4.6">subscript</csymbol><ci id="algx1.l11.m1.6.6.4.6.2.cmml" xref="algx1.l11.m1.6.6.4.6.2">𝜃</ci><ci id="algx1.l11.m1.6.6.4.6.3.cmml" xref="algx1.l11.m1.6.6.4.6.3">𝑑</ci></apply><apply id="algx1.l11.m1.6.6.4.4.cmml" xref="algx1.l11.m1.6.6.4.4"><times id="algx1.l11.m1.6.6.4.4.5.cmml" xref="algx1.l11.m1.6.6.4.4.5"></times><apply id="algx1.l11.m1.6.6.4.4.6.cmml" xref="algx1.l11.m1.6.6.4.4.6"><apply id="algx1.l11.m1.6.6.4.4.6.1.cmml" xref="algx1.l11.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="algx1.l11.m1.6.6.4.4.6.1.1.cmml" xref="algx1.l11.m1.6.6.4.4.6.1">subscript</csymbol><ci id="algx1.l11.m1.6.6.4.4.6.1.2.cmml" xref="algx1.l11.m1.6.6.4.4.6.1.2">∇</ci><ci id="algx1.l11.m1.6.6.4.4.6.1.3.cmml" xref="algx1.l11.m1.6.6.4.4.6.1.3">𝜃</ci></apply><ci id="algx1.l11.m1.6.6.4.4.6.2.cmml" xref="algx1.l11.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="algx1.l11.m1.6.6.4.4.4.5.cmml" xref="algx1.l11.m1.6.6.4.4.4.4"><apply id="algx1.l11.m1.3.3.1.1.1.1.1.cmml" xref="algx1.l11.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="algx1.l11.m1.3.3.1.1.1.1.1.1.cmml" xref="algx1.l11.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="algx1.l11.m1.3.3.1.1.1.1.1.2.cmml" xref="algx1.l11.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="algx1.l11.m1.3.3.1.1.1.1.1.3.cmml" xref="algx1.l11.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="algx1.l11.m1.4.4.2.2.2.2.2.cmml" xref="algx1.l11.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l11.m1.4.4.2.2.2.2.2.1.cmml" xref="algx1.l11.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="algx1.l11.m1.4.4.2.2.2.2.2.2.cmml" xref="algx1.l11.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="algx1.l11.m1.2.2.2.3.cmml" xref="algx1.l11.m1.2.2.2.4"><ci id="algx1.l11.m1.1.1.1.1.cmml" xref="algx1.l11.m1.1.1.1.1">𝑑</ci><ci id="algx1.l11.m1.2.2.2.2.cmml" xref="algx1.l11.m1.2.2.2.2">𝑐</ci></list></apply><apply id="algx1.l11.m1.5.5.3.3.3.3.3.cmml" xref="algx1.l11.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="algx1.l11.m1.5.5.3.3.3.3.3.1.cmml" xref="algx1.l11.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="algx1.l11.m1.5.5.3.3.3.3.3.2.cmml" xref="algx1.l11.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="algx1.l11.m1.5.5.3.3.3.3.3.3.cmml" xref="algx1.l11.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="algx1.l11.m1.6.6.4.4.4.4.4.cmml" xref="algx1.l11.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="algx1.l11.m1.6.6.4.4.4.4.4.1.cmml" xref="algx1.l11.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="algx1.l11.m1.6.6.4.4.4.4.4.2.cmml" xref="algx1.l11.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="algx1.l11.m1.6.6.4.4.4.4.4.3.cmml" xref="algx1.l11.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l11.m1.6c">\theta_{d}\leftarrow\theta_{d}+\nabla_{\theta}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math> // Fine-tune global model with local data

</div>
<div id="algx1.l12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12:</span>           <math id="algx1.l12.m1.5" class="ltx_Math" alttext="\phi_{d}\leftarrow\nu_{d}(\theta_{d},\phi_{d,c},B_{d})" display="inline"><semantics id="algx1.l12.m1.5a"><mrow id="algx1.l12.m1.5.5" xref="algx1.l12.m1.5.5.cmml"><msub id="algx1.l12.m1.5.5.5" xref="algx1.l12.m1.5.5.5.cmml"><mi id="algx1.l12.m1.5.5.5.2" xref="algx1.l12.m1.5.5.5.2.cmml">ϕ</mi><mi id="algx1.l12.m1.5.5.5.3" xref="algx1.l12.m1.5.5.5.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l12.m1.5.5.4" xref="algx1.l12.m1.5.5.4.cmml">←</mo><mrow id="algx1.l12.m1.5.5.3" xref="algx1.l12.m1.5.5.3.cmml"><msub id="algx1.l12.m1.5.5.3.5" xref="algx1.l12.m1.5.5.3.5.cmml"><mi id="algx1.l12.m1.5.5.3.5.2" xref="algx1.l12.m1.5.5.3.5.2.cmml">ν</mi><mi id="algx1.l12.m1.5.5.3.5.3" xref="algx1.l12.m1.5.5.3.5.3.cmml">d</mi></msub><mo lspace="0em" rspace="0em" id="algx1.l12.m1.5.5.3.4" xref="algx1.l12.m1.5.5.3.4.cmml">​</mo><mrow id="algx1.l12.m1.5.5.3.3.3" xref="algx1.l12.m1.5.5.3.3.4.cmml"><mo stretchy="false" id="algx1.l12.m1.5.5.3.3.3.4" xref="algx1.l12.m1.5.5.3.3.4.cmml">(</mo><msub id="algx1.l12.m1.3.3.1.1.1.1" xref="algx1.l12.m1.3.3.1.1.1.1.cmml"><mi id="algx1.l12.m1.3.3.1.1.1.1.2" xref="algx1.l12.m1.3.3.1.1.1.1.2.cmml">θ</mi><mi id="algx1.l12.m1.3.3.1.1.1.1.3" xref="algx1.l12.m1.3.3.1.1.1.1.3.cmml">d</mi></msub><mo id="algx1.l12.m1.5.5.3.3.3.5" xref="algx1.l12.m1.5.5.3.3.4.cmml">,</mo><msub id="algx1.l12.m1.4.4.2.2.2.2" xref="algx1.l12.m1.4.4.2.2.2.2.cmml"><mi id="algx1.l12.m1.4.4.2.2.2.2.2" xref="algx1.l12.m1.4.4.2.2.2.2.2.cmml">ϕ</mi><mrow id="algx1.l12.m1.2.2.2.4" xref="algx1.l12.m1.2.2.2.3.cmml"><mi id="algx1.l12.m1.1.1.1.1" xref="algx1.l12.m1.1.1.1.1.cmml">d</mi><mo id="algx1.l12.m1.2.2.2.4.1" xref="algx1.l12.m1.2.2.2.3.cmml">,</mo><mi id="algx1.l12.m1.2.2.2.2" xref="algx1.l12.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="algx1.l12.m1.5.5.3.3.3.6" xref="algx1.l12.m1.5.5.3.3.4.cmml">,</mo><msub id="algx1.l12.m1.5.5.3.3.3.3" xref="algx1.l12.m1.5.5.3.3.3.3.cmml"><mi id="algx1.l12.m1.5.5.3.3.3.3.2" xref="algx1.l12.m1.5.5.3.3.3.3.2.cmml">B</mi><mi id="algx1.l12.m1.5.5.3.3.3.3.3" xref="algx1.l12.m1.5.5.3.3.3.3.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l12.m1.5.5.3.3.3.7" xref="algx1.l12.m1.5.5.3.3.4.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l12.m1.5b"><apply id="algx1.l12.m1.5.5.cmml" xref="algx1.l12.m1.5.5"><ci id="algx1.l12.m1.5.5.4.cmml" xref="algx1.l12.m1.5.5.4">←</ci><apply id="algx1.l12.m1.5.5.5.cmml" xref="algx1.l12.m1.5.5.5"><csymbol cd="ambiguous" id="algx1.l12.m1.5.5.5.1.cmml" xref="algx1.l12.m1.5.5.5">subscript</csymbol><ci id="algx1.l12.m1.5.5.5.2.cmml" xref="algx1.l12.m1.5.5.5.2">italic-ϕ</ci><ci id="algx1.l12.m1.5.5.5.3.cmml" xref="algx1.l12.m1.5.5.5.3">𝑑</ci></apply><apply id="algx1.l12.m1.5.5.3.cmml" xref="algx1.l12.m1.5.5.3"><times id="algx1.l12.m1.5.5.3.4.cmml" xref="algx1.l12.m1.5.5.3.4"></times><apply id="algx1.l12.m1.5.5.3.5.cmml" xref="algx1.l12.m1.5.5.3.5"><csymbol cd="ambiguous" id="algx1.l12.m1.5.5.3.5.1.cmml" xref="algx1.l12.m1.5.5.3.5">subscript</csymbol><ci id="algx1.l12.m1.5.5.3.5.2.cmml" xref="algx1.l12.m1.5.5.3.5.2">𝜈</ci><ci id="algx1.l12.m1.5.5.3.5.3.cmml" xref="algx1.l12.m1.5.5.3.5.3">𝑑</ci></apply><vector id="algx1.l12.m1.5.5.3.3.4.cmml" xref="algx1.l12.m1.5.5.3.3.3"><apply id="algx1.l12.m1.3.3.1.1.1.1.cmml" xref="algx1.l12.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="algx1.l12.m1.3.3.1.1.1.1.1.cmml" xref="algx1.l12.m1.3.3.1.1.1.1">subscript</csymbol><ci id="algx1.l12.m1.3.3.1.1.1.1.2.cmml" xref="algx1.l12.m1.3.3.1.1.1.1.2">𝜃</ci><ci id="algx1.l12.m1.3.3.1.1.1.1.3.cmml" xref="algx1.l12.m1.3.3.1.1.1.1.3">𝑑</ci></apply><apply id="algx1.l12.m1.4.4.2.2.2.2.cmml" xref="algx1.l12.m1.4.4.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l12.m1.4.4.2.2.2.2.1.cmml" xref="algx1.l12.m1.4.4.2.2.2.2">subscript</csymbol><ci id="algx1.l12.m1.4.4.2.2.2.2.2.cmml" xref="algx1.l12.m1.4.4.2.2.2.2.2">italic-ϕ</ci><list id="algx1.l12.m1.2.2.2.3.cmml" xref="algx1.l12.m1.2.2.2.4"><ci id="algx1.l12.m1.1.1.1.1.cmml" xref="algx1.l12.m1.1.1.1.1">𝑑</ci><ci id="algx1.l12.m1.2.2.2.2.cmml" xref="algx1.l12.m1.2.2.2.2">𝑐</ci></list></apply><apply id="algx1.l12.m1.5.5.3.3.3.3.cmml" xref="algx1.l12.m1.5.5.3.3.3.3"><csymbol cd="ambiguous" id="algx1.l12.m1.5.5.3.3.3.3.1.cmml" xref="algx1.l12.m1.5.5.3.3.3.3">subscript</csymbol><ci id="algx1.l12.m1.5.5.3.3.3.3.2.cmml" xref="algx1.l12.m1.5.5.3.3.3.3.2">𝐵</ci><ci id="algx1.l12.m1.5.5.3.3.3.3.3.cmml" xref="algx1.l12.m1.5.5.3.3.3.3.3">𝑑</ci></apply></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l12.m1.5c">\phi_{d}\leftarrow\nu_{d}(\theta_{d},\phi_{d,c},B_{d})</annotation></semantics></math> // Generate context embedding from local data

</div>
<div id="algx1.l13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13:</span>           <math id="algx1.l13.m1.3" class="ltx_Math" alttext="\psi_{d}\leftarrow\Gamma_{d}(\theta_{d},\psi_{d},B_{d})" display="inline"><semantics id="algx1.l13.m1.3a"><mrow id="algx1.l13.m1.3.3" xref="algx1.l13.m1.3.3.cmml"><msub id="algx1.l13.m1.3.3.5" xref="algx1.l13.m1.3.3.5.cmml"><mi id="algx1.l13.m1.3.3.5.2" xref="algx1.l13.m1.3.3.5.2.cmml">ψ</mi><mi id="algx1.l13.m1.3.3.5.3" xref="algx1.l13.m1.3.3.5.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l13.m1.3.3.4" xref="algx1.l13.m1.3.3.4.cmml">←</mo><mrow id="algx1.l13.m1.3.3.3" xref="algx1.l13.m1.3.3.3.cmml"><msub id="algx1.l13.m1.3.3.3.5" xref="algx1.l13.m1.3.3.3.5.cmml"><mi mathvariant="normal" id="algx1.l13.m1.3.3.3.5.2" xref="algx1.l13.m1.3.3.3.5.2.cmml">Γ</mi><mi id="algx1.l13.m1.3.3.3.5.3" xref="algx1.l13.m1.3.3.3.5.3.cmml">d</mi></msub><mo lspace="0em" rspace="0em" id="algx1.l13.m1.3.3.3.4" xref="algx1.l13.m1.3.3.3.4.cmml">​</mo><mrow id="algx1.l13.m1.3.3.3.3.3" xref="algx1.l13.m1.3.3.3.3.4.cmml"><mo stretchy="false" id="algx1.l13.m1.3.3.3.3.3.4" xref="algx1.l13.m1.3.3.3.3.4.cmml">(</mo><msub id="algx1.l13.m1.1.1.1.1.1.1" xref="algx1.l13.m1.1.1.1.1.1.1.cmml"><mi id="algx1.l13.m1.1.1.1.1.1.1.2" xref="algx1.l13.m1.1.1.1.1.1.1.2.cmml">θ</mi><mi id="algx1.l13.m1.1.1.1.1.1.1.3" xref="algx1.l13.m1.1.1.1.1.1.1.3.cmml">d</mi></msub><mo id="algx1.l13.m1.3.3.3.3.3.5" xref="algx1.l13.m1.3.3.3.3.4.cmml">,</mo><msub id="algx1.l13.m1.2.2.2.2.2.2" xref="algx1.l13.m1.2.2.2.2.2.2.cmml"><mi id="algx1.l13.m1.2.2.2.2.2.2.2" xref="algx1.l13.m1.2.2.2.2.2.2.2.cmml">ψ</mi><mi id="algx1.l13.m1.2.2.2.2.2.2.3" xref="algx1.l13.m1.2.2.2.2.2.2.3.cmml">d</mi></msub><mo id="algx1.l13.m1.3.3.3.3.3.6" xref="algx1.l13.m1.3.3.3.3.4.cmml">,</mo><msub id="algx1.l13.m1.3.3.3.3.3.3" xref="algx1.l13.m1.3.3.3.3.3.3.cmml"><mi id="algx1.l13.m1.3.3.3.3.3.3.2" xref="algx1.l13.m1.3.3.3.3.3.3.2.cmml">B</mi><mi id="algx1.l13.m1.3.3.3.3.3.3.3" xref="algx1.l13.m1.3.3.3.3.3.3.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l13.m1.3.3.3.3.3.7" xref="algx1.l13.m1.3.3.3.3.4.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l13.m1.3b"><apply id="algx1.l13.m1.3.3.cmml" xref="algx1.l13.m1.3.3"><ci id="algx1.l13.m1.3.3.4.cmml" xref="algx1.l13.m1.3.3.4">←</ci><apply id="algx1.l13.m1.3.3.5.cmml" xref="algx1.l13.m1.3.3.5"><csymbol cd="ambiguous" id="algx1.l13.m1.3.3.5.1.cmml" xref="algx1.l13.m1.3.3.5">subscript</csymbol><ci id="algx1.l13.m1.3.3.5.2.cmml" xref="algx1.l13.m1.3.3.5.2">𝜓</ci><ci id="algx1.l13.m1.3.3.5.3.cmml" xref="algx1.l13.m1.3.3.5.3">𝑑</ci></apply><apply id="algx1.l13.m1.3.3.3.cmml" xref="algx1.l13.m1.3.3.3"><times id="algx1.l13.m1.3.3.3.4.cmml" xref="algx1.l13.m1.3.3.3.4"></times><apply id="algx1.l13.m1.3.3.3.5.cmml" xref="algx1.l13.m1.3.3.3.5"><csymbol cd="ambiguous" id="algx1.l13.m1.3.3.3.5.1.cmml" xref="algx1.l13.m1.3.3.3.5">subscript</csymbol><ci id="algx1.l13.m1.3.3.3.5.2.cmml" xref="algx1.l13.m1.3.3.3.5.2">Γ</ci><ci id="algx1.l13.m1.3.3.3.5.3.cmml" xref="algx1.l13.m1.3.3.3.5.3">𝑑</ci></apply><vector id="algx1.l13.m1.3.3.3.3.4.cmml" xref="algx1.l13.m1.3.3.3.3.3"><apply id="algx1.l13.m1.1.1.1.1.1.1.cmml" xref="algx1.l13.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algx1.l13.m1.1.1.1.1.1.1.1.cmml" xref="algx1.l13.m1.1.1.1.1.1.1">subscript</csymbol><ci id="algx1.l13.m1.1.1.1.1.1.1.2.cmml" xref="algx1.l13.m1.1.1.1.1.1.1.2">𝜃</ci><ci id="algx1.l13.m1.1.1.1.1.1.1.3.cmml" xref="algx1.l13.m1.1.1.1.1.1.1.3">𝑑</ci></apply><apply id="algx1.l13.m1.2.2.2.2.2.2.cmml" xref="algx1.l13.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l13.m1.2.2.2.2.2.2.1.cmml" xref="algx1.l13.m1.2.2.2.2.2.2">subscript</csymbol><ci id="algx1.l13.m1.2.2.2.2.2.2.2.cmml" xref="algx1.l13.m1.2.2.2.2.2.2.2">𝜓</ci><ci id="algx1.l13.m1.2.2.2.2.2.2.3.cmml" xref="algx1.l13.m1.2.2.2.2.2.2.3">𝑑</ci></apply><apply id="algx1.l13.m1.3.3.3.3.3.3.cmml" xref="algx1.l13.m1.3.3.3.3.3.3"><csymbol cd="ambiguous" id="algx1.l13.m1.3.3.3.3.3.3.1.cmml" xref="algx1.l13.m1.3.3.3.3.3.3">subscript</csymbol><ci id="algx1.l13.m1.3.3.3.3.3.3.2.cmml" xref="algx1.l13.m1.3.3.3.3.3.3.2">𝐵</ci><ci id="algx1.l13.m1.3.3.3.3.3.3.3.cmml" xref="algx1.l13.m1.3.3.3.3.3.3.3">𝑑</ci></apply></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l13.m1.3c">\psi_{d}\leftarrow\Gamma_{d}(\theta_{d},\psi_{d},B_{d})</annotation></semantics></math> // Generate personal embedding from local data

</div>
<div id="algx1.l14" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14:</span>           <math id="algx1.l14.m1.6" class="ltx_Math" alttext="\nu_{d}\leftarrow\nu_{d}+\nabla_{\nu}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="algx1.l14.m1.6a"><mrow id="algx1.l14.m1.6.6" xref="algx1.l14.m1.6.6.cmml"><msub id="algx1.l14.m1.6.6.6" xref="algx1.l14.m1.6.6.6.cmml"><mi id="algx1.l14.m1.6.6.6.2" xref="algx1.l14.m1.6.6.6.2.cmml">ν</mi><mi id="algx1.l14.m1.6.6.6.3" xref="algx1.l14.m1.6.6.6.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l14.m1.6.6.5" xref="algx1.l14.m1.6.6.5.cmml">←</mo><mrow id="algx1.l14.m1.6.6.4" xref="algx1.l14.m1.6.6.4.cmml"><msub id="algx1.l14.m1.6.6.4.6" xref="algx1.l14.m1.6.6.4.6.cmml"><mi id="algx1.l14.m1.6.6.4.6.2" xref="algx1.l14.m1.6.6.4.6.2.cmml">ν</mi><mi id="algx1.l14.m1.6.6.4.6.3" xref="algx1.l14.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="algx1.l14.m1.6.6.4.5" xref="algx1.l14.m1.6.6.4.5.cmml">+</mo><mrow id="algx1.l14.m1.6.6.4.4" xref="algx1.l14.m1.6.6.4.4.cmml"><mrow id="algx1.l14.m1.6.6.4.4.6" xref="algx1.l14.m1.6.6.4.4.6.cmml"><msub id="algx1.l14.m1.6.6.4.4.6.1" xref="algx1.l14.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="algx1.l14.m1.6.6.4.4.6.1.2" xref="algx1.l14.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi id="algx1.l14.m1.6.6.4.4.6.1.3" xref="algx1.l14.m1.6.6.4.4.6.1.3.cmml">ν</mi></msub><mi class="ltx_font_mathcaligraphic" id="algx1.l14.m1.6.6.4.4.6.2" xref="algx1.l14.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="algx1.l14.m1.6.6.4.4.5" xref="algx1.l14.m1.6.6.4.4.5.cmml">​</mo><mrow id="algx1.l14.m1.6.6.4.4.4.4" xref="algx1.l14.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="algx1.l14.m1.6.6.4.4.4.4.5" xref="algx1.l14.m1.6.6.4.4.4.5.cmml">(</mo><msub id="algx1.l14.m1.3.3.1.1.1.1.1" xref="algx1.l14.m1.3.3.1.1.1.1.1.cmml"><mi id="algx1.l14.m1.3.3.1.1.1.1.1.2" xref="algx1.l14.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="algx1.l14.m1.3.3.1.1.1.1.1.3" xref="algx1.l14.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="algx1.l14.m1.6.6.4.4.4.4.6" xref="algx1.l14.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l14.m1.4.4.2.2.2.2.2" xref="algx1.l14.m1.4.4.2.2.2.2.2.cmml"><mi id="algx1.l14.m1.4.4.2.2.2.2.2.2" xref="algx1.l14.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="algx1.l14.m1.2.2.2.4" xref="algx1.l14.m1.2.2.2.3.cmml"><mi id="algx1.l14.m1.1.1.1.1" xref="algx1.l14.m1.1.1.1.1.cmml">d</mi><mo id="algx1.l14.m1.2.2.2.4.1" xref="algx1.l14.m1.2.2.2.3.cmml">,</mo><mi id="algx1.l14.m1.2.2.2.2" xref="algx1.l14.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="algx1.l14.m1.6.6.4.4.4.4.7" xref="algx1.l14.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l14.m1.5.5.3.3.3.3.3" xref="algx1.l14.m1.5.5.3.3.3.3.3.cmml"><mi id="algx1.l14.m1.5.5.3.3.3.3.3.2" xref="algx1.l14.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="algx1.l14.m1.5.5.3.3.3.3.3.3" xref="algx1.l14.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="algx1.l14.m1.6.6.4.4.4.4.8" xref="algx1.l14.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l14.m1.6.6.4.4.4.4.4" xref="algx1.l14.m1.6.6.4.4.4.4.4.cmml"><mi id="algx1.l14.m1.6.6.4.4.4.4.4.2" xref="algx1.l14.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="algx1.l14.m1.6.6.4.4.4.4.4.3" xref="algx1.l14.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l14.m1.6.6.4.4.4.4.9" xref="algx1.l14.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l14.m1.6b"><apply id="algx1.l14.m1.6.6.cmml" xref="algx1.l14.m1.6.6"><ci id="algx1.l14.m1.6.6.5.cmml" xref="algx1.l14.m1.6.6.5">←</ci><apply id="algx1.l14.m1.6.6.6.cmml" xref="algx1.l14.m1.6.6.6"><csymbol cd="ambiguous" id="algx1.l14.m1.6.6.6.1.cmml" xref="algx1.l14.m1.6.6.6">subscript</csymbol><ci id="algx1.l14.m1.6.6.6.2.cmml" xref="algx1.l14.m1.6.6.6.2">𝜈</ci><ci id="algx1.l14.m1.6.6.6.3.cmml" xref="algx1.l14.m1.6.6.6.3">𝑑</ci></apply><apply id="algx1.l14.m1.6.6.4.cmml" xref="algx1.l14.m1.6.6.4"><plus id="algx1.l14.m1.6.6.4.5.cmml" xref="algx1.l14.m1.6.6.4.5"></plus><apply id="algx1.l14.m1.6.6.4.6.cmml" xref="algx1.l14.m1.6.6.4.6"><csymbol cd="ambiguous" id="algx1.l14.m1.6.6.4.6.1.cmml" xref="algx1.l14.m1.6.6.4.6">subscript</csymbol><ci id="algx1.l14.m1.6.6.4.6.2.cmml" xref="algx1.l14.m1.6.6.4.6.2">𝜈</ci><ci id="algx1.l14.m1.6.6.4.6.3.cmml" xref="algx1.l14.m1.6.6.4.6.3">𝑑</ci></apply><apply id="algx1.l14.m1.6.6.4.4.cmml" xref="algx1.l14.m1.6.6.4.4"><times id="algx1.l14.m1.6.6.4.4.5.cmml" xref="algx1.l14.m1.6.6.4.4.5"></times><apply id="algx1.l14.m1.6.6.4.4.6.cmml" xref="algx1.l14.m1.6.6.4.4.6"><apply id="algx1.l14.m1.6.6.4.4.6.1.cmml" xref="algx1.l14.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="algx1.l14.m1.6.6.4.4.6.1.1.cmml" xref="algx1.l14.m1.6.6.4.4.6.1">subscript</csymbol><ci id="algx1.l14.m1.6.6.4.4.6.1.2.cmml" xref="algx1.l14.m1.6.6.4.4.6.1.2">∇</ci><ci id="algx1.l14.m1.6.6.4.4.6.1.3.cmml" xref="algx1.l14.m1.6.6.4.4.6.1.3">𝜈</ci></apply><ci id="algx1.l14.m1.6.6.4.4.6.2.cmml" xref="algx1.l14.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="algx1.l14.m1.6.6.4.4.4.5.cmml" xref="algx1.l14.m1.6.6.4.4.4.4"><apply id="algx1.l14.m1.3.3.1.1.1.1.1.cmml" xref="algx1.l14.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="algx1.l14.m1.3.3.1.1.1.1.1.1.cmml" xref="algx1.l14.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="algx1.l14.m1.3.3.1.1.1.1.1.2.cmml" xref="algx1.l14.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="algx1.l14.m1.3.3.1.1.1.1.1.3.cmml" xref="algx1.l14.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="algx1.l14.m1.4.4.2.2.2.2.2.cmml" xref="algx1.l14.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l14.m1.4.4.2.2.2.2.2.1.cmml" xref="algx1.l14.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="algx1.l14.m1.4.4.2.2.2.2.2.2.cmml" xref="algx1.l14.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="algx1.l14.m1.2.2.2.3.cmml" xref="algx1.l14.m1.2.2.2.4"><ci id="algx1.l14.m1.1.1.1.1.cmml" xref="algx1.l14.m1.1.1.1.1">𝑑</ci><ci id="algx1.l14.m1.2.2.2.2.cmml" xref="algx1.l14.m1.2.2.2.2">𝑐</ci></list></apply><apply id="algx1.l14.m1.5.5.3.3.3.3.3.cmml" xref="algx1.l14.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="algx1.l14.m1.5.5.3.3.3.3.3.1.cmml" xref="algx1.l14.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="algx1.l14.m1.5.5.3.3.3.3.3.2.cmml" xref="algx1.l14.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="algx1.l14.m1.5.5.3.3.3.3.3.3.cmml" xref="algx1.l14.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="algx1.l14.m1.6.6.4.4.4.4.4.cmml" xref="algx1.l14.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="algx1.l14.m1.6.6.4.4.4.4.4.1.cmml" xref="algx1.l14.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="algx1.l14.m1.6.6.4.4.4.4.4.2.cmml" xref="algx1.l14.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="algx1.l14.m1.6.6.4.4.4.4.4.3.cmml" xref="algx1.l14.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l14.m1.6c">\nu_{d}\leftarrow\nu_{d}+\nabla_{\nu}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math> // Update client Generator

</div>
<div id="algx1.l15" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15:</span>           <math id="algx1.l15.m1.6" class="ltx_Math" alttext="\Gamma_{d}\leftarrow\Gamma_{d}+\nabla_{\Gamma}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})" display="inline"><semantics id="algx1.l15.m1.6a"><mrow id="algx1.l15.m1.6.6" xref="algx1.l15.m1.6.6.cmml"><msub id="algx1.l15.m1.6.6.6" xref="algx1.l15.m1.6.6.6.cmml"><mi mathvariant="normal" id="algx1.l15.m1.6.6.6.2" xref="algx1.l15.m1.6.6.6.2.cmml">Γ</mi><mi id="algx1.l15.m1.6.6.6.3" xref="algx1.l15.m1.6.6.6.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l15.m1.6.6.5" xref="algx1.l15.m1.6.6.5.cmml">←</mo><mrow id="algx1.l15.m1.6.6.4" xref="algx1.l15.m1.6.6.4.cmml"><msub id="algx1.l15.m1.6.6.4.6" xref="algx1.l15.m1.6.6.4.6.cmml"><mi mathvariant="normal" id="algx1.l15.m1.6.6.4.6.2" xref="algx1.l15.m1.6.6.4.6.2.cmml">Γ</mi><mi id="algx1.l15.m1.6.6.4.6.3" xref="algx1.l15.m1.6.6.4.6.3.cmml">d</mi></msub><mo id="algx1.l15.m1.6.6.4.5" xref="algx1.l15.m1.6.6.4.5.cmml">+</mo><mrow id="algx1.l15.m1.6.6.4.4" xref="algx1.l15.m1.6.6.4.4.cmml"><mrow id="algx1.l15.m1.6.6.4.4.6" xref="algx1.l15.m1.6.6.4.4.6.cmml"><msub id="algx1.l15.m1.6.6.4.4.6.1" xref="algx1.l15.m1.6.6.4.4.6.1.cmml"><mo rspace="0.167em" id="algx1.l15.m1.6.6.4.4.6.1.2" xref="algx1.l15.m1.6.6.4.4.6.1.2.cmml">∇</mo><mi mathvariant="normal" id="algx1.l15.m1.6.6.4.4.6.1.3" xref="algx1.l15.m1.6.6.4.4.6.1.3.cmml">Γ</mi></msub><mi class="ltx_font_mathcaligraphic" id="algx1.l15.m1.6.6.4.4.6.2" xref="algx1.l15.m1.6.6.4.4.6.2.cmml">ℒ</mi></mrow><mo lspace="0em" rspace="0em" id="algx1.l15.m1.6.6.4.4.5" xref="algx1.l15.m1.6.6.4.4.5.cmml">​</mo><mrow id="algx1.l15.m1.6.6.4.4.4.4" xref="algx1.l15.m1.6.6.4.4.4.5.cmml"><mo stretchy="false" id="algx1.l15.m1.6.6.4.4.4.4.5" xref="algx1.l15.m1.6.6.4.4.4.5.cmml">(</mo><msub id="algx1.l15.m1.3.3.1.1.1.1.1" xref="algx1.l15.m1.3.3.1.1.1.1.1.cmml"><mi id="algx1.l15.m1.3.3.1.1.1.1.1.2" xref="algx1.l15.m1.3.3.1.1.1.1.1.2.cmml">θ</mi><mi id="algx1.l15.m1.3.3.1.1.1.1.1.3" xref="algx1.l15.m1.3.3.1.1.1.1.1.3.cmml">d</mi></msub><mo id="algx1.l15.m1.6.6.4.4.4.4.6" xref="algx1.l15.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l15.m1.4.4.2.2.2.2.2" xref="algx1.l15.m1.4.4.2.2.2.2.2.cmml"><mi id="algx1.l15.m1.4.4.2.2.2.2.2.2" xref="algx1.l15.m1.4.4.2.2.2.2.2.2.cmml">ϕ</mi><mrow id="algx1.l15.m1.2.2.2.4" xref="algx1.l15.m1.2.2.2.3.cmml"><mi id="algx1.l15.m1.1.1.1.1" xref="algx1.l15.m1.1.1.1.1.cmml">d</mi><mo id="algx1.l15.m1.2.2.2.4.1" xref="algx1.l15.m1.2.2.2.3.cmml">,</mo><mi id="algx1.l15.m1.2.2.2.2" xref="algx1.l15.m1.2.2.2.2.cmml">c</mi></mrow></msub><mo id="algx1.l15.m1.6.6.4.4.4.4.7" xref="algx1.l15.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l15.m1.5.5.3.3.3.3.3" xref="algx1.l15.m1.5.5.3.3.3.3.3.cmml"><mi id="algx1.l15.m1.5.5.3.3.3.3.3.2" xref="algx1.l15.m1.5.5.3.3.3.3.3.2.cmml">ψ</mi><mi id="algx1.l15.m1.5.5.3.3.3.3.3.3" xref="algx1.l15.m1.5.5.3.3.3.3.3.3.cmml">d</mi></msub><mo id="algx1.l15.m1.6.6.4.4.4.4.8" xref="algx1.l15.m1.6.6.4.4.4.5.cmml">,</mo><msub id="algx1.l15.m1.6.6.4.4.4.4.4" xref="algx1.l15.m1.6.6.4.4.4.4.4.cmml"><mi id="algx1.l15.m1.6.6.4.4.4.4.4.2" xref="algx1.l15.m1.6.6.4.4.4.4.4.2.cmml">B</mi><mi id="algx1.l15.m1.6.6.4.4.4.4.4.3" xref="algx1.l15.m1.6.6.4.4.4.4.4.3.cmml">d</mi></msub><mo stretchy="false" id="algx1.l15.m1.6.6.4.4.4.4.9" xref="algx1.l15.m1.6.6.4.4.4.5.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l15.m1.6b"><apply id="algx1.l15.m1.6.6.cmml" xref="algx1.l15.m1.6.6"><ci id="algx1.l15.m1.6.6.5.cmml" xref="algx1.l15.m1.6.6.5">←</ci><apply id="algx1.l15.m1.6.6.6.cmml" xref="algx1.l15.m1.6.6.6"><csymbol cd="ambiguous" id="algx1.l15.m1.6.6.6.1.cmml" xref="algx1.l15.m1.6.6.6">subscript</csymbol><ci id="algx1.l15.m1.6.6.6.2.cmml" xref="algx1.l15.m1.6.6.6.2">Γ</ci><ci id="algx1.l15.m1.6.6.6.3.cmml" xref="algx1.l15.m1.6.6.6.3">𝑑</ci></apply><apply id="algx1.l15.m1.6.6.4.cmml" xref="algx1.l15.m1.6.6.4"><plus id="algx1.l15.m1.6.6.4.5.cmml" xref="algx1.l15.m1.6.6.4.5"></plus><apply id="algx1.l15.m1.6.6.4.6.cmml" xref="algx1.l15.m1.6.6.4.6"><csymbol cd="ambiguous" id="algx1.l15.m1.6.6.4.6.1.cmml" xref="algx1.l15.m1.6.6.4.6">subscript</csymbol><ci id="algx1.l15.m1.6.6.4.6.2.cmml" xref="algx1.l15.m1.6.6.4.6.2">Γ</ci><ci id="algx1.l15.m1.6.6.4.6.3.cmml" xref="algx1.l15.m1.6.6.4.6.3">𝑑</ci></apply><apply id="algx1.l15.m1.6.6.4.4.cmml" xref="algx1.l15.m1.6.6.4.4"><times id="algx1.l15.m1.6.6.4.4.5.cmml" xref="algx1.l15.m1.6.6.4.4.5"></times><apply id="algx1.l15.m1.6.6.4.4.6.cmml" xref="algx1.l15.m1.6.6.4.4.6"><apply id="algx1.l15.m1.6.6.4.4.6.1.cmml" xref="algx1.l15.m1.6.6.4.4.6.1"><csymbol cd="ambiguous" id="algx1.l15.m1.6.6.4.4.6.1.1.cmml" xref="algx1.l15.m1.6.6.4.4.6.1">subscript</csymbol><ci id="algx1.l15.m1.6.6.4.4.6.1.2.cmml" xref="algx1.l15.m1.6.6.4.4.6.1.2">∇</ci><ci id="algx1.l15.m1.6.6.4.4.6.1.3.cmml" xref="algx1.l15.m1.6.6.4.4.6.1.3">Γ</ci></apply><ci id="algx1.l15.m1.6.6.4.4.6.2.cmml" xref="algx1.l15.m1.6.6.4.4.6.2">ℒ</ci></apply><vector id="algx1.l15.m1.6.6.4.4.4.5.cmml" xref="algx1.l15.m1.6.6.4.4.4.4"><apply id="algx1.l15.m1.3.3.1.1.1.1.1.cmml" xref="algx1.l15.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="algx1.l15.m1.3.3.1.1.1.1.1.1.cmml" xref="algx1.l15.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="algx1.l15.m1.3.3.1.1.1.1.1.2.cmml" xref="algx1.l15.m1.3.3.1.1.1.1.1.2">𝜃</ci><ci id="algx1.l15.m1.3.3.1.1.1.1.1.3.cmml" xref="algx1.l15.m1.3.3.1.1.1.1.1.3">𝑑</ci></apply><apply id="algx1.l15.m1.4.4.2.2.2.2.2.cmml" xref="algx1.l15.m1.4.4.2.2.2.2.2"><csymbol cd="ambiguous" id="algx1.l15.m1.4.4.2.2.2.2.2.1.cmml" xref="algx1.l15.m1.4.4.2.2.2.2.2">subscript</csymbol><ci id="algx1.l15.m1.4.4.2.2.2.2.2.2.cmml" xref="algx1.l15.m1.4.4.2.2.2.2.2.2">italic-ϕ</ci><list id="algx1.l15.m1.2.2.2.3.cmml" xref="algx1.l15.m1.2.2.2.4"><ci id="algx1.l15.m1.1.1.1.1.cmml" xref="algx1.l15.m1.1.1.1.1">𝑑</ci><ci id="algx1.l15.m1.2.2.2.2.cmml" xref="algx1.l15.m1.2.2.2.2">𝑐</ci></list></apply><apply id="algx1.l15.m1.5.5.3.3.3.3.3.cmml" xref="algx1.l15.m1.5.5.3.3.3.3.3"><csymbol cd="ambiguous" id="algx1.l15.m1.5.5.3.3.3.3.3.1.cmml" xref="algx1.l15.m1.5.5.3.3.3.3.3">subscript</csymbol><ci id="algx1.l15.m1.5.5.3.3.3.3.3.2.cmml" xref="algx1.l15.m1.5.5.3.3.3.3.3.2">𝜓</ci><ci id="algx1.l15.m1.5.5.3.3.3.3.3.3.cmml" xref="algx1.l15.m1.5.5.3.3.3.3.3.3">𝑑</ci></apply><apply id="algx1.l15.m1.6.6.4.4.4.4.4.cmml" xref="algx1.l15.m1.6.6.4.4.4.4.4"><csymbol cd="ambiguous" id="algx1.l15.m1.6.6.4.4.4.4.4.1.cmml" xref="algx1.l15.m1.6.6.4.4.4.4.4">subscript</csymbol><ci id="algx1.l15.m1.6.6.4.4.4.4.4.2.cmml" xref="algx1.l15.m1.6.6.4.4.4.4.4.2">𝐵</ci><ci id="algx1.l15.m1.6.6.4.4.4.4.4.3.cmml" xref="algx1.l15.m1.6.6.4.4.4.4.4.3">𝑑</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l15.m1.6c">\Gamma_{d}\leftarrow\Gamma_{d}+\nabla_{\Gamma}\mathcal{L}(\theta_{d},\phi_{d,c},\psi_{d},B_{d})</annotation></semantics></math> // Update context Generator

</div>
<div id="algx1.l16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16:</span>        <span id="algx1.l16.1" class="ltx_text ltx_font_bold">end</span> <span id="algx1.l16.2" class="ltx_text ltx_font_bold">for</span>
</div>
<div id="algx1.l17" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17:</span>        <math id="algx1.l17.m1.1" class="ltx_Math" alttext="\nabla_{\theta_{d}}\leftarrow\theta-\theta_{d}" display="inline"><semantics id="algx1.l17.m1.1a"><mrow id="algx1.l17.m1.1.1" xref="algx1.l17.m1.1.1.cmml"><msub id="algx1.l17.m1.1.1.2" xref="algx1.l17.m1.1.1.2.cmml"><mo id="algx1.l17.m1.1.1.2.2" xref="algx1.l17.m1.1.1.2.2.cmml">∇</mo><msub id="algx1.l17.m1.1.1.2.3" xref="algx1.l17.m1.1.1.2.3.cmml"><mi id="algx1.l17.m1.1.1.2.3.2" xref="algx1.l17.m1.1.1.2.3.2.cmml">θ</mi><mi id="algx1.l17.m1.1.1.2.3.3" xref="algx1.l17.m1.1.1.2.3.3.cmml">d</mi></msub></msub><mo stretchy="false" id="algx1.l17.m1.1.1.1" xref="algx1.l17.m1.1.1.1.cmml">←</mo><mrow id="algx1.l17.m1.1.1.3" xref="algx1.l17.m1.1.1.3.cmml"><mi id="algx1.l17.m1.1.1.3.2" xref="algx1.l17.m1.1.1.3.2.cmml">θ</mi><mo id="algx1.l17.m1.1.1.3.1" xref="algx1.l17.m1.1.1.3.1.cmml">−</mo><msub id="algx1.l17.m1.1.1.3.3" xref="algx1.l17.m1.1.1.3.3.cmml"><mi id="algx1.l17.m1.1.1.3.3.2" xref="algx1.l17.m1.1.1.3.3.2.cmml">θ</mi><mi id="algx1.l17.m1.1.1.3.3.3" xref="algx1.l17.m1.1.1.3.3.3.cmml">d</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l17.m1.1b"><apply id="algx1.l17.m1.1.1.cmml" xref="algx1.l17.m1.1.1"><ci id="algx1.l17.m1.1.1.1.cmml" xref="algx1.l17.m1.1.1.1">←</ci><apply id="algx1.l17.m1.1.1.2.cmml" xref="algx1.l17.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l17.m1.1.1.2.1.cmml" xref="algx1.l17.m1.1.1.2">subscript</csymbol><ci id="algx1.l17.m1.1.1.2.2.cmml" xref="algx1.l17.m1.1.1.2.2">∇</ci><apply id="algx1.l17.m1.1.1.2.3.cmml" xref="algx1.l17.m1.1.1.2.3"><csymbol cd="ambiguous" id="algx1.l17.m1.1.1.2.3.1.cmml" xref="algx1.l17.m1.1.1.2.3">subscript</csymbol><ci id="algx1.l17.m1.1.1.2.3.2.cmml" xref="algx1.l17.m1.1.1.2.3.2">𝜃</ci><ci id="algx1.l17.m1.1.1.2.3.3.cmml" xref="algx1.l17.m1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="algx1.l17.m1.1.1.3.cmml" xref="algx1.l17.m1.1.1.3"><minus id="algx1.l17.m1.1.1.3.1.cmml" xref="algx1.l17.m1.1.1.3.1"></minus><ci id="algx1.l17.m1.1.1.3.2.cmml" xref="algx1.l17.m1.1.1.3.2">𝜃</ci><apply id="algx1.l17.m1.1.1.3.3.cmml" xref="algx1.l17.m1.1.1.3.3"><csymbol cd="ambiguous" id="algx1.l17.m1.1.1.3.3.1.cmml" xref="algx1.l17.m1.1.1.3.3">subscript</csymbol><ci id="algx1.l17.m1.1.1.3.3.2.cmml" xref="algx1.l17.m1.1.1.3.3.2">𝜃</ci><ci id="algx1.l17.m1.1.1.3.3.3.cmml" xref="algx1.l17.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l17.m1.1c">\nabla_{\theta_{d}}\leftarrow\theta-\theta_{d}</annotation></semantics></math> // compute final client <math id="algx1.l17.m2.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="algx1.l17.m2.1a"><mi id="algx1.l17.m2.1.1" xref="algx1.l17.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="algx1.l17.m2.1b"><ci id="algx1.l17.m2.1.1.cmml" xref="algx1.l17.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l17.m2.1c">\theta</annotation></semantics></math> gradients

</div>
<div id="algx1.l18" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18:</span>        <math id="algx1.l18.m1.1" class="ltx_Math" alttext="\nabla_{\Gamma_{d}}\leftarrow\Gamma-\Gamma_{d}" display="inline"><semantics id="algx1.l18.m1.1a"><mrow id="algx1.l18.m1.1.1" xref="algx1.l18.m1.1.1.cmml"><msub id="algx1.l18.m1.1.1.2" xref="algx1.l18.m1.1.1.2.cmml"><mo id="algx1.l18.m1.1.1.2.2" xref="algx1.l18.m1.1.1.2.2.cmml">∇</mo><msub id="algx1.l18.m1.1.1.2.3" xref="algx1.l18.m1.1.1.2.3.cmml"><mi mathvariant="normal" id="algx1.l18.m1.1.1.2.3.2" xref="algx1.l18.m1.1.1.2.3.2.cmml">Γ</mi><mi id="algx1.l18.m1.1.1.2.3.3" xref="algx1.l18.m1.1.1.2.3.3.cmml">d</mi></msub></msub><mo stretchy="false" id="algx1.l18.m1.1.1.1" xref="algx1.l18.m1.1.1.1.cmml">←</mo><mrow id="algx1.l18.m1.1.1.3" xref="algx1.l18.m1.1.1.3.cmml"><mi mathvariant="normal" id="algx1.l18.m1.1.1.3.2" xref="algx1.l18.m1.1.1.3.2.cmml">Γ</mi><mo id="algx1.l18.m1.1.1.3.1" xref="algx1.l18.m1.1.1.3.1.cmml">−</mo><msub id="algx1.l18.m1.1.1.3.3" xref="algx1.l18.m1.1.1.3.3.cmml"><mi mathvariant="normal" id="algx1.l18.m1.1.1.3.3.2" xref="algx1.l18.m1.1.1.3.3.2.cmml">Γ</mi><mi id="algx1.l18.m1.1.1.3.3.3" xref="algx1.l18.m1.1.1.3.3.3.cmml">d</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l18.m1.1b"><apply id="algx1.l18.m1.1.1.cmml" xref="algx1.l18.m1.1.1"><ci id="algx1.l18.m1.1.1.1.cmml" xref="algx1.l18.m1.1.1.1">←</ci><apply id="algx1.l18.m1.1.1.2.cmml" xref="algx1.l18.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l18.m1.1.1.2.1.cmml" xref="algx1.l18.m1.1.1.2">subscript</csymbol><ci id="algx1.l18.m1.1.1.2.2.cmml" xref="algx1.l18.m1.1.1.2.2">∇</ci><apply id="algx1.l18.m1.1.1.2.3.cmml" xref="algx1.l18.m1.1.1.2.3"><csymbol cd="ambiguous" id="algx1.l18.m1.1.1.2.3.1.cmml" xref="algx1.l18.m1.1.1.2.3">subscript</csymbol><ci id="algx1.l18.m1.1.1.2.3.2.cmml" xref="algx1.l18.m1.1.1.2.3.2">Γ</ci><ci id="algx1.l18.m1.1.1.2.3.3.cmml" xref="algx1.l18.m1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="algx1.l18.m1.1.1.3.cmml" xref="algx1.l18.m1.1.1.3"><minus id="algx1.l18.m1.1.1.3.1.cmml" xref="algx1.l18.m1.1.1.3.1"></minus><ci id="algx1.l18.m1.1.1.3.2.cmml" xref="algx1.l18.m1.1.1.3.2">Γ</ci><apply id="algx1.l18.m1.1.1.3.3.cmml" xref="algx1.l18.m1.1.1.3.3"><csymbol cd="ambiguous" id="algx1.l18.m1.1.1.3.3.1.cmml" xref="algx1.l18.m1.1.1.3.3">subscript</csymbol><ci id="algx1.l18.m1.1.1.3.3.2.cmml" xref="algx1.l18.m1.1.1.3.3.2">Γ</ci><ci id="algx1.l18.m1.1.1.3.3.3.cmml" xref="algx1.l18.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l18.m1.1c">\nabla_{\Gamma_{d}}\leftarrow\Gamma-\Gamma_{d}</annotation></semantics></math> // compute final client <math id="algx1.l18.m2.1" class="ltx_Math" alttext="\Gamma" display="inline"><semantics id="algx1.l18.m2.1a"><mi mathvariant="normal" id="algx1.l18.m2.1.1" xref="algx1.l18.m2.1.1.cmml">Γ</mi><annotation-xml encoding="MathML-Content" id="algx1.l18.m2.1b"><ci id="algx1.l18.m2.1.1.cmml" xref="algx1.l18.m2.1.1">Γ</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l18.m2.1c">\Gamma</annotation></semantics></math> gradients

</div>
<div id="algx1.l19" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19:</span>        <math id="algx1.l19.m1.1" class="ltx_Math" alttext="\nabla_{\nu_{d}}\leftarrow\nu-\nu_{d}" display="inline"><semantics id="algx1.l19.m1.1a"><mrow id="algx1.l19.m1.1.1" xref="algx1.l19.m1.1.1.cmml"><msub id="algx1.l19.m1.1.1.2" xref="algx1.l19.m1.1.1.2.cmml"><mo id="algx1.l19.m1.1.1.2.2" xref="algx1.l19.m1.1.1.2.2.cmml">∇</mo><msub id="algx1.l19.m1.1.1.2.3" xref="algx1.l19.m1.1.1.2.3.cmml"><mi id="algx1.l19.m1.1.1.2.3.2" xref="algx1.l19.m1.1.1.2.3.2.cmml">ν</mi><mi id="algx1.l19.m1.1.1.2.3.3" xref="algx1.l19.m1.1.1.2.3.3.cmml">d</mi></msub></msub><mo stretchy="false" id="algx1.l19.m1.1.1.1" xref="algx1.l19.m1.1.1.1.cmml">←</mo><mrow id="algx1.l19.m1.1.1.3" xref="algx1.l19.m1.1.1.3.cmml"><mi id="algx1.l19.m1.1.1.3.2" xref="algx1.l19.m1.1.1.3.2.cmml">ν</mi><mo id="algx1.l19.m1.1.1.3.1" xref="algx1.l19.m1.1.1.3.1.cmml">−</mo><msub id="algx1.l19.m1.1.1.3.3" xref="algx1.l19.m1.1.1.3.3.cmml"><mi id="algx1.l19.m1.1.1.3.3.2" xref="algx1.l19.m1.1.1.3.3.2.cmml">ν</mi><mi id="algx1.l19.m1.1.1.3.3.3" xref="algx1.l19.m1.1.1.3.3.3.cmml">d</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l19.m1.1b"><apply id="algx1.l19.m1.1.1.cmml" xref="algx1.l19.m1.1.1"><ci id="algx1.l19.m1.1.1.1.cmml" xref="algx1.l19.m1.1.1.1">←</ci><apply id="algx1.l19.m1.1.1.2.cmml" xref="algx1.l19.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l19.m1.1.1.2.1.cmml" xref="algx1.l19.m1.1.1.2">subscript</csymbol><ci id="algx1.l19.m1.1.1.2.2.cmml" xref="algx1.l19.m1.1.1.2.2">∇</ci><apply id="algx1.l19.m1.1.1.2.3.cmml" xref="algx1.l19.m1.1.1.2.3"><csymbol cd="ambiguous" id="algx1.l19.m1.1.1.2.3.1.cmml" xref="algx1.l19.m1.1.1.2.3">subscript</csymbol><ci id="algx1.l19.m1.1.1.2.3.2.cmml" xref="algx1.l19.m1.1.1.2.3.2">𝜈</ci><ci id="algx1.l19.m1.1.1.2.3.3.cmml" xref="algx1.l19.m1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="algx1.l19.m1.1.1.3.cmml" xref="algx1.l19.m1.1.1.3"><minus id="algx1.l19.m1.1.1.3.1.cmml" xref="algx1.l19.m1.1.1.3.1"></minus><ci id="algx1.l19.m1.1.1.3.2.cmml" xref="algx1.l19.m1.1.1.3.2">𝜈</ci><apply id="algx1.l19.m1.1.1.3.3.cmml" xref="algx1.l19.m1.1.1.3.3"><csymbol cd="ambiguous" id="algx1.l19.m1.1.1.3.3.1.cmml" xref="algx1.l19.m1.1.1.3.3">subscript</csymbol><ci id="algx1.l19.m1.1.1.3.3.2.cmml" xref="algx1.l19.m1.1.1.3.3.2">𝜈</ci><ci id="algx1.l19.m1.1.1.3.3.3.cmml" xref="algx1.l19.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l19.m1.1c">\nabla_{\nu_{d}}\leftarrow\nu-\nu_{d}</annotation></semantics></math> // compute final client <math id="algx1.l19.m2.1" class="ltx_Math" alttext="\nu" display="inline"><semantics id="algx1.l19.m2.1a"><mi id="algx1.l19.m2.1.1" xref="algx1.l19.m2.1.1.cmml">ν</mi><annotation-xml encoding="MathML-Content" id="algx1.l19.m2.1b"><ci id="algx1.l19.m2.1.1.cmml" xref="algx1.l19.m2.1.1">𝜈</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l19.m2.1c">\nu</annotation></semantics></math> gradients

</div>
<div id="algx1.l20" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20:</span>        Return <math id="algx1.l20.m1.1" class="ltx_Math" alttext="\nabla_{\theta_{d}}" display="inline"><semantics id="algx1.l20.m1.1a"><msub id="algx1.l20.m1.1.1" xref="algx1.l20.m1.1.1.cmml"><mo id="algx1.l20.m1.1.1.2" xref="algx1.l20.m1.1.1.2.cmml">∇</mo><msub id="algx1.l20.m1.1.1.3" xref="algx1.l20.m1.1.1.3.cmml"><mi id="algx1.l20.m1.1.1.3.2" xref="algx1.l20.m1.1.1.3.2.cmml">θ</mi><mi id="algx1.l20.m1.1.1.3.3" xref="algx1.l20.m1.1.1.3.3.cmml">d</mi></msub></msub><annotation-xml encoding="MathML-Content" id="algx1.l20.m1.1b"><apply id="algx1.l20.m1.1.1.cmml" xref="algx1.l20.m1.1.1"><csymbol cd="ambiguous" id="algx1.l20.m1.1.1.1.cmml" xref="algx1.l20.m1.1.1">subscript</csymbol><ci id="algx1.l20.m1.1.1.2.cmml" xref="algx1.l20.m1.1.1.2">∇</ci><apply id="algx1.l20.m1.1.1.3.cmml" xref="algx1.l20.m1.1.1.3"><csymbol cd="ambiguous" id="algx1.l20.m1.1.1.3.1.cmml" xref="algx1.l20.m1.1.1.3">subscript</csymbol><ci id="algx1.l20.m1.1.1.3.2.cmml" xref="algx1.l20.m1.1.1.3.2">𝜃</ci><ci id="algx1.l20.m1.1.1.3.3.cmml" xref="algx1.l20.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l20.m1.1c">\nabla_{\theta_{d}}</annotation></semantics></math>, <math id="algx1.l20.m2.1" class="ltx_Math" alttext="\nabla_{\nu_{d}}" display="inline"><semantics id="algx1.l20.m2.1a"><msub id="algx1.l20.m2.1.1" xref="algx1.l20.m2.1.1.cmml"><mo id="algx1.l20.m2.1.1.2" xref="algx1.l20.m2.1.1.2.cmml">∇</mo><msub id="algx1.l20.m2.1.1.3" xref="algx1.l20.m2.1.1.3.cmml"><mi id="algx1.l20.m2.1.1.3.2" xref="algx1.l20.m2.1.1.3.2.cmml">ν</mi><mi id="algx1.l20.m2.1.1.3.3" xref="algx1.l20.m2.1.1.3.3.cmml">d</mi></msub></msub><annotation-xml encoding="MathML-Content" id="algx1.l20.m2.1b"><apply id="algx1.l20.m2.1.1.cmml" xref="algx1.l20.m2.1.1"><csymbol cd="ambiguous" id="algx1.l20.m2.1.1.1.cmml" xref="algx1.l20.m2.1.1">subscript</csymbol><ci id="algx1.l20.m2.1.1.2.cmml" xref="algx1.l20.m2.1.1.2">∇</ci><apply id="algx1.l20.m2.1.1.3.cmml" xref="algx1.l20.m2.1.1.3"><csymbol cd="ambiguous" id="algx1.l20.m2.1.1.3.1.cmml" xref="algx1.l20.m2.1.1.3">subscript</csymbol><ci id="algx1.l20.m2.1.1.3.2.cmml" xref="algx1.l20.m2.1.1.3.2">𝜈</ci><ci id="algx1.l20.m2.1.1.3.3.cmml" xref="algx1.l20.m2.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l20.m2.1c">\nabla_{\nu_{d}}</annotation></semantics></math> and <math id="algx1.l20.m3.1" class="ltx_Math" alttext="\nabla_{\Gamma_{d}}" display="inline"><semantics id="algx1.l20.m3.1a"><msub id="algx1.l20.m3.1.1" xref="algx1.l20.m3.1.1.cmml"><mo id="algx1.l20.m3.1.1.2" xref="algx1.l20.m3.1.1.2.cmml">∇</mo><msub id="algx1.l20.m3.1.1.3" xref="algx1.l20.m3.1.1.3.cmml"><mi mathvariant="normal" id="algx1.l20.m3.1.1.3.2" xref="algx1.l20.m3.1.1.3.2.cmml">Γ</mi><mi id="algx1.l20.m3.1.1.3.3" xref="algx1.l20.m3.1.1.3.3.cmml">d</mi></msub></msub><annotation-xml encoding="MathML-Content" id="algx1.l20.m3.1b"><apply id="algx1.l20.m3.1.1.cmml" xref="algx1.l20.m3.1.1"><csymbol cd="ambiguous" id="algx1.l20.m3.1.1.1.cmml" xref="algx1.l20.m3.1.1">subscript</csymbol><ci id="algx1.l20.m3.1.1.2.cmml" xref="algx1.l20.m3.1.1.2">∇</ci><apply id="algx1.l20.m3.1.1.3.cmml" xref="algx1.l20.m3.1.1.3"><csymbol cd="ambiguous" id="algx1.l20.m3.1.1.3.1.cmml" xref="algx1.l20.m3.1.1.3">subscript</csymbol><ci id="algx1.l20.m3.1.1.3.2.cmml" xref="algx1.l20.m3.1.1.3.2">Γ</ci><ci id="algx1.l20.m3.1.1.3.3.cmml" xref="algx1.l20.m3.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l20.m3.1c">\nabla_{\Gamma_{d}}</annotation></semantics></math> to the server

</div>
<div id="algx1.l21" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21:</span>     <span id="algx1.l21.1" class="ltx_text ltx_font_bold">end</span> <span id="algx1.l21.2" class="ltx_text ltx_font_bold">for</span>
</div>
<div id="algx1.l22" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">22:</span>     <math id="algx1.l22.m1.1" class="ltx_Math" alttext="\nabla_{\theta}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\theta_{d}}" display="inline"><semantics id="algx1.l22.m1.1a"><mrow id="algx1.l22.m1.1.1" xref="algx1.l22.m1.1.1.cmml"><msub id="algx1.l22.m1.1.1.2" xref="algx1.l22.m1.1.1.2.cmml"><mo id="algx1.l22.m1.1.1.2.2" xref="algx1.l22.m1.1.1.2.2.cmml">∇</mo><mi id="algx1.l22.m1.1.1.2.3" xref="algx1.l22.m1.1.1.2.3.cmml">θ</mi></msub><mo stretchy="false" id="algx1.l22.m1.1.1.1" xref="algx1.l22.m1.1.1.1.cmml">←</mo><mrow id="algx1.l22.m1.1.1.3" xref="algx1.l22.m1.1.1.3.cmml"><mfrac id="algx1.l22.m1.1.1.3.2" xref="algx1.l22.m1.1.1.3.2.cmml"><mn id="algx1.l22.m1.1.1.3.2.2" xref="algx1.l22.m1.1.1.3.2.2.cmml">1</mn><mi id="algx1.l22.m1.1.1.3.2.3" xref="algx1.l22.m1.1.1.3.2.3.cmml">D</mi></mfrac><mo lspace="0em" rspace="0em" id="algx1.l22.m1.1.1.3.1" xref="algx1.l22.m1.1.1.3.1.cmml">​</mo><mrow id="algx1.l22.m1.1.1.3.3" xref="algx1.l22.m1.1.1.3.3.cmml"><msubsup id="algx1.l22.m1.1.1.3.3.1" xref="algx1.l22.m1.1.1.3.3.1.cmml"><mo id="algx1.l22.m1.1.1.3.3.1.2.2" xref="algx1.l22.m1.1.1.3.3.1.2.2.cmml">∑</mo><mi id="algx1.l22.m1.1.1.3.3.1.2.3" xref="algx1.l22.m1.1.1.3.3.1.2.3.cmml">d</mi><mi id="algx1.l22.m1.1.1.3.3.1.3" xref="algx1.l22.m1.1.1.3.3.1.3.cmml">D</mi></msubsup><msub id="algx1.l22.m1.1.1.3.3.2" xref="algx1.l22.m1.1.1.3.3.2.cmml"><mo id="algx1.l22.m1.1.1.3.3.2.2" xref="algx1.l22.m1.1.1.3.3.2.2.cmml">∇</mo><msub id="algx1.l22.m1.1.1.3.3.2.3" xref="algx1.l22.m1.1.1.3.3.2.3.cmml"><mi id="algx1.l22.m1.1.1.3.3.2.3.2" xref="algx1.l22.m1.1.1.3.3.2.3.2.cmml">θ</mi><mi id="algx1.l22.m1.1.1.3.3.2.3.3" xref="algx1.l22.m1.1.1.3.3.2.3.3.cmml">d</mi></msub></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l22.m1.1b"><apply id="algx1.l22.m1.1.1.cmml" xref="algx1.l22.m1.1.1"><ci id="algx1.l22.m1.1.1.1.cmml" xref="algx1.l22.m1.1.1.1">←</ci><apply id="algx1.l22.m1.1.1.2.cmml" xref="algx1.l22.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l22.m1.1.1.2.1.cmml" xref="algx1.l22.m1.1.1.2">subscript</csymbol><ci id="algx1.l22.m1.1.1.2.2.cmml" xref="algx1.l22.m1.1.1.2.2">∇</ci><ci id="algx1.l22.m1.1.1.2.3.cmml" xref="algx1.l22.m1.1.1.2.3">𝜃</ci></apply><apply id="algx1.l22.m1.1.1.3.cmml" xref="algx1.l22.m1.1.1.3"><times id="algx1.l22.m1.1.1.3.1.cmml" xref="algx1.l22.m1.1.1.3.1"></times><apply id="algx1.l22.m1.1.1.3.2.cmml" xref="algx1.l22.m1.1.1.3.2"><divide id="algx1.l22.m1.1.1.3.2.1.cmml" xref="algx1.l22.m1.1.1.3.2"></divide><cn type="integer" id="algx1.l22.m1.1.1.3.2.2.cmml" xref="algx1.l22.m1.1.1.3.2.2">1</cn><ci id="algx1.l22.m1.1.1.3.2.3.cmml" xref="algx1.l22.m1.1.1.3.2.3">𝐷</ci></apply><apply id="algx1.l22.m1.1.1.3.3.cmml" xref="algx1.l22.m1.1.1.3.3"><apply id="algx1.l22.m1.1.1.3.3.1.cmml" xref="algx1.l22.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l22.m1.1.1.3.3.1.1.cmml" xref="algx1.l22.m1.1.1.3.3.1">superscript</csymbol><apply id="algx1.l22.m1.1.1.3.3.1.2.cmml" xref="algx1.l22.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l22.m1.1.1.3.3.1.2.1.cmml" xref="algx1.l22.m1.1.1.3.3.1">subscript</csymbol><sum id="algx1.l22.m1.1.1.3.3.1.2.2.cmml" xref="algx1.l22.m1.1.1.3.3.1.2.2"></sum><ci id="algx1.l22.m1.1.1.3.3.1.2.3.cmml" xref="algx1.l22.m1.1.1.3.3.1.2.3">𝑑</ci></apply><ci id="algx1.l22.m1.1.1.3.3.1.3.cmml" xref="algx1.l22.m1.1.1.3.3.1.3">𝐷</ci></apply><apply id="algx1.l22.m1.1.1.3.3.2.cmml" xref="algx1.l22.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="algx1.l22.m1.1.1.3.3.2.1.cmml" xref="algx1.l22.m1.1.1.3.3.2">subscript</csymbol><ci id="algx1.l22.m1.1.1.3.3.2.2.cmml" xref="algx1.l22.m1.1.1.3.3.2.2">∇</ci><apply id="algx1.l22.m1.1.1.3.3.2.3.cmml" xref="algx1.l22.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="algx1.l22.m1.1.1.3.3.2.3.1.cmml" xref="algx1.l22.m1.1.1.3.3.2.3">subscript</csymbol><ci id="algx1.l22.m1.1.1.3.3.2.3.2.cmml" xref="algx1.l22.m1.1.1.3.3.2.3.2">𝜃</ci><ci id="algx1.l22.m1.1.1.3.3.2.3.3.cmml" xref="algx1.l22.m1.1.1.3.3.2.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l22.m1.1c">\nabla_{\theta}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\theta_{d}}</annotation></semantics></math> // calculate average <math id="algx1.l22.m2.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="algx1.l22.m2.1a"><mi id="algx1.l22.m2.1.1" xref="algx1.l22.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="algx1.l22.m2.1b"><ci id="algx1.l22.m2.1.1.cmml" xref="algx1.l22.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l22.m2.1c">\theta</annotation></semantics></math> gradients

</div>
<div id="algx1.l23" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">23:</span>     <math id="algx1.l23.m1.1" class="ltx_Math" alttext="\nabla_{\Gamma}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\Gamma_{d}}" display="inline"><semantics id="algx1.l23.m1.1a"><mrow id="algx1.l23.m1.1.1" xref="algx1.l23.m1.1.1.cmml"><msub id="algx1.l23.m1.1.1.2" xref="algx1.l23.m1.1.1.2.cmml"><mo id="algx1.l23.m1.1.1.2.2" xref="algx1.l23.m1.1.1.2.2.cmml">∇</mo><mi mathvariant="normal" id="algx1.l23.m1.1.1.2.3" xref="algx1.l23.m1.1.1.2.3.cmml">Γ</mi></msub><mo stretchy="false" id="algx1.l23.m1.1.1.1" xref="algx1.l23.m1.1.1.1.cmml">←</mo><mrow id="algx1.l23.m1.1.1.3" xref="algx1.l23.m1.1.1.3.cmml"><mfrac id="algx1.l23.m1.1.1.3.2" xref="algx1.l23.m1.1.1.3.2.cmml"><mn id="algx1.l23.m1.1.1.3.2.2" xref="algx1.l23.m1.1.1.3.2.2.cmml">1</mn><mi id="algx1.l23.m1.1.1.3.2.3" xref="algx1.l23.m1.1.1.3.2.3.cmml">D</mi></mfrac><mo lspace="0em" rspace="0em" id="algx1.l23.m1.1.1.3.1" xref="algx1.l23.m1.1.1.3.1.cmml">​</mo><mrow id="algx1.l23.m1.1.1.3.3" xref="algx1.l23.m1.1.1.3.3.cmml"><msubsup id="algx1.l23.m1.1.1.3.3.1" xref="algx1.l23.m1.1.1.3.3.1.cmml"><mo id="algx1.l23.m1.1.1.3.3.1.2.2" xref="algx1.l23.m1.1.1.3.3.1.2.2.cmml">∑</mo><mi id="algx1.l23.m1.1.1.3.3.1.2.3" xref="algx1.l23.m1.1.1.3.3.1.2.3.cmml">d</mi><mi id="algx1.l23.m1.1.1.3.3.1.3" xref="algx1.l23.m1.1.1.3.3.1.3.cmml">D</mi></msubsup><msub id="algx1.l23.m1.1.1.3.3.2" xref="algx1.l23.m1.1.1.3.3.2.cmml"><mo id="algx1.l23.m1.1.1.3.3.2.2" xref="algx1.l23.m1.1.1.3.3.2.2.cmml">∇</mo><msub id="algx1.l23.m1.1.1.3.3.2.3" xref="algx1.l23.m1.1.1.3.3.2.3.cmml"><mi mathvariant="normal" id="algx1.l23.m1.1.1.3.3.2.3.2" xref="algx1.l23.m1.1.1.3.3.2.3.2.cmml">Γ</mi><mi id="algx1.l23.m1.1.1.3.3.2.3.3" xref="algx1.l23.m1.1.1.3.3.2.3.3.cmml">d</mi></msub></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l23.m1.1b"><apply id="algx1.l23.m1.1.1.cmml" xref="algx1.l23.m1.1.1"><ci id="algx1.l23.m1.1.1.1.cmml" xref="algx1.l23.m1.1.1.1">←</ci><apply id="algx1.l23.m1.1.1.2.cmml" xref="algx1.l23.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l23.m1.1.1.2.1.cmml" xref="algx1.l23.m1.1.1.2">subscript</csymbol><ci id="algx1.l23.m1.1.1.2.2.cmml" xref="algx1.l23.m1.1.1.2.2">∇</ci><ci id="algx1.l23.m1.1.1.2.3.cmml" xref="algx1.l23.m1.1.1.2.3">Γ</ci></apply><apply id="algx1.l23.m1.1.1.3.cmml" xref="algx1.l23.m1.1.1.3"><times id="algx1.l23.m1.1.1.3.1.cmml" xref="algx1.l23.m1.1.1.3.1"></times><apply id="algx1.l23.m1.1.1.3.2.cmml" xref="algx1.l23.m1.1.1.3.2"><divide id="algx1.l23.m1.1.1.3.2.1.cmml" xref="algx1.l23.m1.1.1.3.2"></divide><cn type="integer" id="algx1.l23.m1.1.1.3.2.2.cmml" xref="algx1.l23.m1.1.1.3.2.2">1</cn><ci id="algx1.l23.m1.1.1.3.2.3.cmml" xref="algx1.l23.m1.1.1.3.2.3">𝐷</ci></apply><apply id="algx1.l23.m1.1.1.3.3.cmml" xref="algx1.l23.m1.1.1.3.3"><apply id="algx1.l23.m1.1.1.3.3.1.cmml" xref="algx1.l23.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l23.m1.1.1.3.3.1.1.cmml" xref="algx1.l23.m1.1.1.3.3.1">superscript</csymbol><apply id="algx1.l23.m1.1.1.3.3.1.2.cmml" xref="algx1.l23.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l23.m1.1.1.3.3.1.2.1.cmml" xref="algx1.l23.m1.1.1.3.3.1">subscript</csymbol><sum id="algx1.l23.m1.1.1.3.3.1.2.2.cmml" xref="algx1.l23.m1.1.1.3.3.1.2.2"></sum><ci id="algx1.l23.m1.1.1.3.3.1.2.3.cmml" xref="algx1.l23.m1.1.1.3.3.1.2.3">𝑑</ci></apply><ci id="algx1.l23.m1.1.1.3.3.1.3.cmml" xref="algx1.l23.m1.1.1.3.3.1.3">𝐷</ci></apply><apply id="algx1.l23.m1.1.1.3.3.2.cmml" xref="algx1.l23.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="algx1.l23.m1.1.1.3.3.2.1.cmml" xref="algx1.l23.m1.1.1.3.3.2">subscript</csymbol><ci id="algx1.l23.m1.1.1.3.3.2.2.cmml" xref="algx1.l23.m1.1.1.3.3.2.2">∇</ci><apply id="algx1.l23.m1.1.1.3.3.2.3.cmml" xref="algx1.l23.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="algx1.l23.m1.1.1.3.3.2.3.1.cmml" xref="algx1.l23.m1.1.1.3.3.2.3">subscript</csymbol><ci id="algx1.l23.m1.1.1.3.3.2.3.2.cmml" xref="algx1.l23.m1.1.1.3.3.2.3.2">Γ</ci><ci id="algx1.l23.m1.1.1.3.3.2.3.3.cmml" xref="algx1.l23.m1.1.1.3.3.2.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l23.m1.1c">\nabla_{\Gamma}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\Gamma_{d}}</annotation></semantics></math> // calculate average <math id="algx1.l23.m2.1" class="ltx_Math" alttext="\Gamma" display="inline"><semantics id="algx1.l23.m2.1a"><mi mathvariant="normal" id="algx1.l23.m2.1.1" xref="algx1.l23.m2.1.1.cmml">Γ</mi><annotation-xml encoding="MathML-Content" id="algx1.l23.m2.1b"><ci id="algx1.l23.m2.1.1.cmml" xref="algx1.l23.m2.1.1">Γ</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l23.m2.1c">\Gamma</annotation></semantics></math> gradients

</div>
<div id="algx1.l24" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">24:</span>     <math id="algx1.l24.m1.1" class="ltx_Math" alttext="\nabla_{\nu}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\nu_{d}}" display="inline"><semantics id="algx1.l24.m1.1a"><mrow id="algx1.l24.m1.1.1" xref="algx1.l24.m1.1.1.cmml"><msub id="algx1.l24.m1.1.1.2" xref="algx1.l24.m1.1.1.2.cmml"><mo id="algx1.l24.m1.1.1.2.2" xref="algx1.l24.m1.1.1.2.2.cmml">∇</mo><mi id="algx1.l24.m1.1.1.2.3" xref="algx1.l24.m1.1.1.2.3.cmml">ν</mi></msub><mo stretchy="false" id="algx1.l24.m1.1.1.1" xref="algx1.l24.m1.1.1.1.cmml">←</mo><mrow id="algx1.l24.m1.1.1.3" xref="algx1.l24.m1.1.1.3.cmml"><mfrac id="algx1.l24.m1.1.1.3.2" xref="algx1.l24.m1.1.1.3.2.cmml"><mn id="algx1.l24.m1.1.1.3.2.2" xref="algx1.l24.m1.1.1.3.2.2.cmml">1</mn><mi id="algx1.l24.m1.1.1.3.2.3" xref="algx1.l24.m1.1.1.3.2.3.cmml">D</mi></mfrac><mo lspace="0em" rspace="0em" id="algx1.l24.m1.1.1.3.1" xref="algx1.l24.m1.1.1.3.1.cmml">​</mo><mrow id="algx1.l24.m1.1.1.3.3" xref="algx1.l24.m1.1.1.3.3.cmml"><msubsup id="algx1.l24.m1.1.1.3.3.1" xref="algx1.l24.m1.1.1.3.3.1.cmml"><mo id="algx1.l24.m1.1.1.3.3.1.2.2" xref="algx1.l24.m1.1.1.3.3.1.2.2.cmml">∑</mo><mi id="algx1.l24.m1.1.1.3.3.1.2.3" xref="algx1.l24.m1.1.1.3.3.1.2.3.cmml">d</mi><mi id="algx1.l24.m1.1.1.3.3.1.3" xref="algx1.l24.m1.1.1.3.3.1.3.cmml">D</mi></msubsup><msub id="algx1.l24.m1.1.1.3.3.2" xref="algx1.l24.m1.1.1.3.3.2.cmml"><mo id="algx1.l24.m1.1.1.3.3.2.2" xref="algx1.l24.m1.1.1.3.3.2.2.cmml">∇</mo><msub id="algx1.l24.m1.1.1.3.3.2.3" xref="algx1.l24.m1.1.1.3.3.2.3.cmml"><mi id="algx1.l24.m1.1.1.3.3.2.3.2" xref="algx1.l24.m1.1.1.3.3.2.3.2.cmml">ν</mi><mi id="algx1.l24.m1.1.1.3.3.2.3.3" xref="algx1.l24.m1.1.1.3.3.2.3.3.cmml">d</mi></msub></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l24.m1.1b"><apply id="algx1.l24.m1.1.1.cmml" xref="algx1.l24.m1.1.1"><ci id="algx1.l24.m1.1.1.1.cmml" xref="algx1.l24.m1.1.1.1">←</ci><apply id="algx1.l24.m1.1.1.2.cmml" xref="algx1.l24.m1.1.1.2"><csymbol cd="ambiguous" id="algx1.l24.m1.1.1.2.1.cmml" xref="algx1.l24.m1.1.1.2">subscript</csymbol><ci id="algx1.l24.m1.1.1.2.2.cmml" xref="algx1.l24.m1.1.1.2.2">∇</ci><ci id="algx1.l24.m1.1.1.2.3.cmml" xref="algx1.l24.m1.1.1.2.3">𝜈</ci></apply><apply id="algx1.l24.m1.1.1.3.cmml" xref="algx1.l24.m1.1.1.3"><times id="algx1.l24.m1.1.1.3.1.cmml" xref="algx1.l24.m1.1.1.3.1"></times><apply id="algx1.l24.m1.1.1.3.2.cmml" xref="algx1.l24.m1.1.1.3.2"><divide id="algx1.l24.m1.1.1.3.2.1.cmml" xref="algx1.l24.m1.1.1.3.2"></divide><cn type="integer" id="algx1.l24.m1.1.1.3.2.2.cmml" xref="algx1.l24.m1.1.1.3.2.2">1</cn><ci id="algx1.l24.m1.1.1.3.2.3.cmml" xref="algx1.l24.m1.1.1.3.2.3">𝐷</ci></apply><apply id="algx1.l24.m1.1.1.3.3.cmml" xref="algx1.l24.m1.1.1.3.3"><apply id="algx1.l24.m1.1.1.3.3.1.cmml" xref="algx1.l24.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l24.m1.1.1.3.3.1.1.cmml" xref="algx1.l24.m1.1.1.3.3.1">superscript</csymbol><apply id="algx1.l24.m1.1.1.3.3.1.2.cmml" xref="algx1.l24.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="algx1.l24.m1.1.1.3.3.1.2.1.cmml" xref="algx1.l24.m1.1.1.3.3.1">subscript</csymbol><sum id="algx1.l24.m1.1.1.3.3.1.2.2.cmml" xref="algx1.l24.m1.1.1.3.3.1.2.2"></sum><ci id="algx1.l24.m1.1.1.3.3.1.2.3.cmml" xref="algx1.l24.m1.1.1.3.3.1.2.3">𝑑</ci></apply><ci id="algx1.l24.m1.1.1.3.3.1.3.cmml" xref="algx1.l24.m1.1.1.3.3.1.3">𝐷</ci></apply><apply id="algx1.l24.m1.1.1.3.3.2.cmml" xref="algx1.l24.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="algx1.l24.m1.1.1.3.3.2.1.cmml" xref="algx1.l24.m1.1.1.3.3.2">subscript</csymbol><ci id="algx1.l24.m1.1.1.3.3.2.2.cmml" xref="algx1.l24.m1.1.1.3.3.2.2">∇</ci><apply id="algx1.l24.m1.1.1.3.3.2.3.cmml" xref="algx1.l24.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="algx1.l24.m1.1.1.3.3.2.3.1.cmml" xref="algx1.l24.m1.1.1.3.3.2.3">subscript</csymbol><ci id="algx1.l24.m1.1.1.3.3.2.3.2.cmml" xref="algx1.l24.m1.1.1.3.3.2.3.2">𝜈</ci><ci id="algx1.l24.m1.1.1.3.3.2.3.3.cmml" xref="algx1.l24.m1.1.1.3.3.2.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l24.m1.1c">\nabla_{\nu}\leftarrow\frac{1}{D}\sum_{d}^{D}\nabla_{\nu_{d}}</annotation></semantics></math> // calculate average <math id="algx1.l24.m2.1" class="ltx_Math" alttext="\nu" display="inline"><semantics id="algx1.l24.m2.1a"><mi id="algx1.l24.m2.1.1" xref="algx1.l24.m2.1.1.cmml">ν</mi><annotation-xml encoding="MathML-Content" id="algx1.l24.m2.1b"><ci id="algx1.l24.m2.1.1.cmml" xref="algx1.l24.m2.1.1">𝜈</ci></annotation-xml><annotation encoding="application/x-tex" id="algx1.l24.m2.1c">\nu</annotation></semantics></math> gradients

</div>
<div id="algx1.l25" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">25:</span>     <math id="algx1.l25.m1.1" class="ltx_Math" alttext="\theta\leftarrow\theta+\nabla_{\theta}" display="inline"><semantics id="algx1.l25.m1.1a"><mrow id="algx1.l25.m1.1.1" xref="algx1.l25.m1.1.1.cmml"><mi id="algx1.l25.m1.1.1.2" xref="algx1.l25.m1.1.1.2.cmml">θ</mi><mo stretchy="false" id="algx1.l25.m1.1.1.1" xref="algx1.l25.m1.1.1.1.cmml">←</mo><mrow id="algx1.l25.m1.1.1.3" xref="algx1.l25.m1.1.1.3.cmml"><mi id="algx1.l25.m1.1.1.3.2" xref="algx1.l25.m1.1.1.3.2.cmml">θ</mi><mo id="algx1.l25.m1.1.1.3.1" xref="algx1.l25.m1.1.1.3.1.cmml">+</mo><msub id="algx1.l25.m1.1.1.3.3" xref="algx1.l25.m1.1.1.3.3.cmml"><mo id="algx1.l25.m1.1.1.3.3.2" xref="algx1.l25.m1.1.1.3.3.2.cmml">∇</mo><mi id="algx1.l25.m1.1.1.3.3.3" xref="algx1.l25.m1.1.1.3.3.3.cmml">θ</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l25.m1.1b"><apply id="algx1.l25.m1.1.1.cmml" xref="algx1.l25.m1.1.1"><ci id="algx1.l25.m1.1.1.1.cmml" xref="algx1.l25.m1.1.1.1">←</ci><ci id="algx1.l25.m1.1.1.2.cmml" xref="algx1.l25.m1.1.1.2">𝜃</ci><apply id="algx1.l25.m1.1.1.3.cmml" xref="algx1.l25.m1.1.1.3"><plus id="algx1.l25.m1.1.1.3.1.cmml" xref="algx1.l25.m1.1.1.3.1"></plus><ci id="algx1.l25.m1.1.1.3.2.cmml" xref="algx1.l25.m1.1.1.3.2">𝜃</ci><apply id="algx1.l25.m1.1.1.3.3.cmml" xref="algx1.l25.m1.1.1.3.3"><csymbol cd="ambiguous" id="algx1.l25.m1.1.1.3.3.1.cmml" xref="algx1.l25.m1.1.1.3.3">subscript</csymbol><ci id="algx1.l25.m1.1.1.3.3.2.cmml" xref="algx1.l25.m1.1.1.3.3.2">∇</ci><ci id="algx1.l25.m1.1.1.3.3.3.cmml" xref="algx1.l25.m1.1.1.3.3.3">𝜃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l25.m1.1c">\theta\leftarrow\theta+\nabla_{\theta}</annotation></semantics></math>

</div>
<div id="algx1.l26" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">26:</span>     <math id="algx1.l26.m1.1" class="ltx_Math" alttext="\phi\leftarrow\phi+\nabla_{\phi}" display="inline"><semantics id="algx1.l26.m1.1a"><mrow id="algx1.l26.m1.1.1" xref="algx1.l26.m1.1.1.cmml"><mi id="algx1.l26.m1.1.1.2" xref="algx1.l26.m1.1.1.2.cmml">ϕ</mi><mo stretchy="false" id="algx1.l26.m1.1.1.1" xref="algx1.l26.m1.1.1.1.cmml">←</mo><mrow id="algx1.l26.m1.1.1.3" xref="algx1.l26.m1.1.1.3.cmml"><mi id="algx1.l26.m1.1.1.3.2" xref="algx1.l26.m1.1.1.3.2.cmml">ϕ</mi><mo id="algx1.l26.m1.1.1.3.1" xref="algx1.l26.m1.1.1.3.1.cmml">+</mo><msub id="algx1.l26.m1.1.1.3.3" xref="algx1.l26.m1.1.1.3.3.cmml"><mo id="algx1.l26.m1.1.1.3.3.2" xref="algx1.l26.m1.1.1.3.3.2.cmml">∇</mo><mi id="algx1.l26.m1.1.1.3.3.3" xref="algx1.l26.m1.1.1.3.3.3.cmml">ϕ</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="algx1.l26.m1.1b"><apply id="algx1.l26.m1.1.1.cmml" xref="algx1.l26.m1.1.1"><ci id="algx1.l26.m1.1.1.1.cmml" xref="algx1.l26.m1.1.1.1">←</ci><ci id="algx1.l26.m1.1.1.2.cmml" xref="algx1.l26.m1.1.1.2">italic-ϕ</ci><apply id="algx1.l26.m1.1.1.3.cmml" xref="algx1.l26.m1.1.1.3"><plus id="algx1.l26.m1.1.1.3.1.cmml" xref="algx1.l26.m1.1.1.3.1"></plus><ci id="algx1.l26.m1.1.1.3.2.cmml" xref="algx1.l26.m1.1.1.3.2">italic-ϕ</ci><apply id="algx1.l26.m1.1.1.3.3.cmml" xref="algx1.l26.m1.1.1.3.3"><csymbol cd="ambiguous" id="algx1.l26.m1.1.1.3.3.1.cmml" xref="algx1.l26.m1.1.1.3.3">subscript</csymbol><ci id="algx1.l26.m1.1.1.3.3.2.cmml" xref="algx1.l26.m1.1.1.3.3.2">∇</ci><ci id="algx1.l26.m1.1.1.3.3.3.cmml" xref="algx1.l26.m1.1.1.3.3.3">italic-ϕ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algx1.l26.m1.1c">\phi\leftarrow\phi+\nabla_{\phi}</annotation></semantics></math>

</div>
<div id="algx1.l27" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">27:</span>  <span id="algx1.l27.1" class="ltx_text ltx_font_bold">end</span> <span id="algx1.l27.2" class="ltx_text ltx_font_bold">for</span>
</div>
</div>
</figure>
</section>
<section id="A2" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Training Details</h2>

<div id="A2.p1" class="ltx_para ltx_noindent">
<p id="A2.p1.1" class="ltx_p">All models are initialized with the DistilGPT2 pre-trained model from Huggingface <cite class="ltx_cite ltx_citemacro_citep">[Wolf et al., <a href="#bib.bib40" title="" class="ltx_ref">2019</a>]</cite>. All layers of the model are frozen, and FedPC only backpropagates error to personal and context preference embeddings. For our Meta-Learning baseline, the last layer is unfrozen and all users jointly update this final output layer (note: there is no dedicated context head in this approach). Our Split-Learning baseline assigns a unique model head to each user and to each context, and each user only updates their own model head and the contexts that they use.</p>
</div>
<div id="A2.p2" class="ltx_para ltx_noindent">
<p id="A2.p2.1" class="ltx_p">All models are trained for 55 epochs over their training datasets using the Adam optimizer <cite class="ltx_cite ltx_citemacro_citep">[Kingma and Ba, <a href="#bib.bib44" title="" class="ltx_ref">2014</a>]</cite> for global updates (learning rate = 1) and local updates (learning rate = 0.001). Each client (character or Reddit user) makes 10 local updates before passing their pooled gradient information back to the server. During training, each client samples 15 data points per training pass. For local fine-tuning updates at test-time, each user makes 15 updates using a small portion of the test data (the data used for fine-tuning is not used for testing).</p>
</div>
<div id="A2.p3" class="ltx_para ltx_noindent">
<p id="A2.p3.1" class="ltx_p">All models use a frozen DistilGPT2 model from HuggingFace as their initialization. After empirical experimentation, we opted to freeze the majority of the DistilGPT2 parameters by default. This freezing helped to save on computational and memory costs as well as improving generalization performance across diverse users. As a result of this freezing, shared learning and personalization updates will only affect model heads, shared embeddings, and/or personal embeddings.</p>
</div>
<div id="A2.p4" class="ltx_para ltx_noindent">
<p id="A2.p4.1" class="ltx_p">FedPC leverages a standard federated averaging training procedure (FedAvg) <cite class="ltx_cite ltx_citemacro_citep">[McMahan et al., <a href="#bib.bib3" title="" class="ltx_ref">2017</a>]</cite> with the addition of a FedProx penalty term <cite class="ltx_cite ltx_citemacro_citep">[Li et al., <a href="#bib.bib14" title="" class="ltx_ref">2020b</a>]</cite> to regularize on-device client updates back to the globally-averaged model. Empirically, FedProx improved performance for all methods. We fix the FedProx <math id="A2.p4.1.m1.1" class="ltx_Math" alttext="\mu" display="inline"><semantics id="A2.p4.1.m1.1a"><mi id="A2.p4.1.m1.1.1" xref="A2.p4.1.m1.1.1.cmml">μ</mi><annotation-xml encoding="MathML-Content" id="A2.p4.1.m1.1b"><ci id="A2.p4.1.m1.1.1.cmml" xref="A2.p4.1.m1.1.1">𝜇</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.p4.1.m1.1c">\mu</annotation></semantics></math> parameter to 1.</p>
</div>
<div id="A2.p5" class="ltx_para ltx_noindent">
<p id="A2.p5.1" class="ltx_p">Training was carried out on an NVIDIA A40 GPU with 48GB of memory. Due to limitations of the GPU, not all context-heads could be stored in memory at once for our Split Learning baseline when working with the Reddit dataset. The GPU could only accommodate 14 model heads in addition to the DistilGPT2 model, but the dataset featured 57 unique subreddits. To work around this limitation, 13 context heads were active at all times, and the parameters of those heads were saved and overwritten as necessary to ensure that each user had access to their required context heads.</p>
</div>
</section>
<section id="A3" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>Dataset Information</h2>

<div id="A3.p1" class="ltx_para ltx_noindent">
<p id="A3.p1.1" class="ltx_p">The TV Show dataset is constructed by merging scripts from two shows, “Friends” and “Game of Thrones.” We use ConvoKit <cite class="ltx_cite ltx_citemacro_citep">[Chang et al., <a href="#bib.bib43" title="" class="ltx_ref">2020</a>]</cite> to gather the “Friends” Corpus <cite class="ltx_cite ltx_citemacro_citep">[Chen and Choi, <a href="#bib.bib41" title="" class="ltx_ref">2016</a>]</cite>, and retain the six main characters. We use a set of “Game of Thrones” scripts <cite class="ltx_cite ltx_citemacro_citep">[Koirala, <a href="#bib.bib42" title="" class="ltx_ref">2019</a>]</cite> to query for the thirteen characters with the highest utterance-count.
Our merged dataset has 19 characters, 60650 utterances, and two contexts.
The average utterance count for each character is 3370, with “Friends” characters having more utterances than “Game of Thrones” characters.</p>
</div>
<div id="A3.p2" class="ltx_para ltx_noindent">
<p id="A3.p2.1" class="ltx_p">Our Reddit experiments use the “reddit-corpus-small“ dataset from ConvoKit <cite class="ltx_cite ltx_citemacro_citep">[Chang et al., <a href="#bib.bib43" title="" class="ltx_ref">2020</a>]</cite>, which includes posts from the top-100 subreddits over a set period of time. We filter the dataset to only include users with at least 50 utterances and contexts (subreddits) with at least 150 utterances.
The resulting dataset has 326 characters, 30260 utterances, and 57 contexts.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section><div class="ltx_rdf" about="" property="dcterms:creator" content="Andrew Silva${}^{*}$, Pradyumna Tambwekar${}^{*}$, Matthew Gombolay"></div>
<div class="ltx_rdf" about="" property="dcterms:subject" content="Natural Language Processing, Federated Learning, Personalization"></div>
<div class="ltx_rdf" about="" property="dcterms:subject" content="q-bio.NC, q-bio.QM"></div>
<div class="ltx_rdf" about="" property="dcterms:title" content="FedPC: Federated Learning for Language Generation with Personal and Context Preference Embeddings"></div>

</article>
</div>
<div class="ar5iv-footer"><a href="/html/2210.03765" class="ar5iv-nav-button ar5iv-nav-button-prev">◄</a>
    <a class="ar5iv-home-button" href="/"><img height="40" alt="ar5iv homepage" src="/assets/ar5iv.png"></a>
    <a href="/feeling_lucky" class="ar5iv-text-button">Feeling<br>lucky?</a>
    <a href="/log/2210.03766" class="ar5iv-text-button ar5iv-severity-warning">Conversion<br>report</a>
    <a class="ar5iv-text-button" target="_blank" href="https://github.com/dginev/ar5iv/issues/new?template=improve-article--arxiv-id-.md&title=Improve+article+2210.03766">Report<br>an issue</a>
    <a href="https://arxiv.org/abs/2210.03766" class="ar5iv-text-button arxiv-ui-theme">View&nbsp;original<br>on&nbsp;arXiv</a><a href="/html/2210.03767" class="ar5iv-nav-button ar5iv-nav-button-next">►</a>
</div><footer class="ltx_page_footer">
<a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle ar5iv color scheme"><span class="color-scheme-icon"></span></a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/license" target="_blank">Copyright</a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/policies/privacy_policy" target="_blank">Privacy Policy</a>

<div class="ltx_page_logo">Generated  on Thu Mar 14 01:43:13 2024 by <a target="_blank" href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>

    <script>
      var canMathML = typeof(MathMLElement) == "function";
      if (!canMathML) {
        var body = document.querySelector("body");
        body.firstElementChild.setAttribute('style', 'opacity: 0;');
        var loading = document.createElement("div");
        loading.setAttribute("id", "mathjax-loading-spinner");
        var message = document.createElement("div");
        message.setAttribute("id", "mathjax-loading-message");
        message.innerText = "Typesetting Equations...";
        body.prepend(loading);
        body.prepend(message);

        var el = document.createElement("script");
        el.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
        document.querySelector("head").appendChild(el);

        window.MathJax = {
          startup: {
            pageReady: () => {
              return MathJax.startup.defaultPageReady().then(() => {
                body.removeChild(loading);
                body.removeChild(message);
                body.firstElementChild.removeAttribute('style');
              }); } } };
      }
    </script>
    <script>
    // Auxiliary function, building the preview feature when
    // an inline citation is clicked
    function clicked_cite(e) {
      e.preventDefault();
      let cite = this.closest('.ltx_cite');
      let next = cite.nextSibling;
      if (next && next.nodeType == Node.ELEMENT_NODE && next.getAttribute('class') == "ar5iv-bibitem-preview") {
        next.remove();
        return; }
      // Before adding a preview modal,
      // cleanup older previews, in case they're still open
      document.querySelectorAll('span.ar5iv-bibitem-preview').forEach(function(node) {
        node.remove();
      })

      // Create the preview
      preview = document.createElement('span');
      preview.setAttribute('class','ar5iv-bibitem-preview');
      let target = document.getElementById(this.getAttribute('href').slice(1));
      target.childNodes.forEach(function (child) {
        preview.append(child.cloneNode(true));
      });
      let close_x = document.createElement('button');
      close_x.setAttribute("aria-label","Close modal for bibliography item preview");
      close_x.textContent = "×";
      close_x.setAttribute('class', 'ar5iv-button-close-preview');
      close_x.setAttribute('onclick','this.parentNode.remove()');
      preview.append(close_x);
      preview.querySelectorAll('.ltx_tag_bibitem').forEach(function(node) {
        node.remove();
      });
      cite.parentNode.insertBefore(preview, cite.nextSibling);
      return;
    }
    // Global Document initialization:
    // - assign the preview feature to all inline citation links
    document.querySelectorAll(".ltx_cite .ltx_ref").forEach(function (link) {
      link.addEventListener("click", clicked_cite);
    });
    </script>
    </body>
</html>
