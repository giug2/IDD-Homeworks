<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items</title>
<!--Generated on Mon Aug 19 13:37:32 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2408.09992v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S1" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Background</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.SS0.SSS0.Px1" title="In 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title">Large-catalogue Sequential RecSys</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.SS0.SSS0.Px2" title="In 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title">Sub-Id based recommendation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S3" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>PQTopK Algorithm</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S4" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experimental Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Analysis</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S6" title="In Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Aleksandr V. Petrov
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id4.1.id1">University of Glasgow</span><span class="ltx_text ltx_affiliation_country" id="id5.2.id2">United Kingdom</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:a.petrov.1@research.gla.ac.uk">a.petrov.1@research.gla.ac.uk</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Craig Macdonald
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id6.1.id1">University of Glasgow</span><span class="ltx_text ltx_affiliation_country" id="id7.2.id2">United Kingdom</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:craig.macdonald@glasgow.ac.uk">craig.macdonald@glasgow.ac.uk</a>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Nicola Tonellotto
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id8.1.id1">University of Pisa</span><span class="ltx_text ltx_affiliation_country" id="id9.2.id2">Italy</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:nicola.tonellotto@unipi.it">nicola.tonellotto@unipi.it</a>
</span></span></span>
</div>
<div class="ltx_dates">(2024; 2024)</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id3.3">Transformer-based recommender systems, such as BERT4Rec or SASRec, achieve state-of-the-art results in sequential recommendation. However, it is challenging to use these models in production environments with catalogues of millions of items: scaling Transformers beyond a few thousand items is problematic for several reasons, including high model memory consumption and slow inference. In this respect, RecJPQ is a state-of-the-art method of reducing the <span class="ltx_text" id="id3.3.3">models’<span class="ltx_text" id="id3.3.3.3"> memory consumption; RecJPQ compresses item catalogues by decomposing item IDs into a small number of shared sub-item IDs. Despite reporting the reduction of memory consumption by a factor of up to <math alttext="50\times" class="ltx_math_unparsed" display="inline" id="id1.1.1.1.m1.1"><semantics id="id1.1.1.1.m1.1a"><mrow id="id1.1.1.1.m1.1b"><mn id="id1.1.1.1.m1.1.1" mathcolor="#000000">50</mn><mo id="id1.1.1.1.m1.1.2" lspace="0.222em" mathcolor="#000000">×</mo></mrow><annotation encoding="application/x-tex" id="id1.1.1.1.m1.1c">50\times</annotation><annotation encoding="application/x-llamapun" id="id1.1.1.1.m1.1d">50 ×</annotation></semantics></math>, the original RecJPQ paper did not report inference efficiency improvements over the baseline Transformer-based models.
<span class="ltx_text" id="id3.3.3.3.2">Upon analysing<span class="ltx_text" id="id3.3.3.3.2.2"> RecJPQ’s scoring algorithm, we find that its efficiency is limited by <span class="ltx_text" id="id3.3.3.3.2.2.2">its use of score accumulators for each item<span class="ltx_text" id="id3.3.3.3.2.2.2.2">, which <span class="ltx_text" id="id3.3.3.3.2.2.2.2.2">prevents<span class="ltx_text" id="id3.3.3.3.2.2.2.2.2.2"> parallelisation.<span class="ltx_text" id="id3.3.3.3.2.2.2.2.2.2.2"> <span class="ltx_text" id="id3.3.3.3.2.2.2.2.2.2.2.2">In contrast<span class="ltx_text" id="id3.3.3.3.2.2.2.2.2.2.2.2.2">, LightRec (a non-sequential method that uses a similar idea of sub-ids) reported large inference efficiency improvements using an algorithm we call PQTopK. We show that it is also possible to improve RecJPQ-based models’ inference efficiency using the PQTopK algorithm. <span class="ltx_text" id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2"> In particular, we speed up RecJPQ-enhanced SASRec by a factor of 4.5<math alttext="\times" class="ltx_Math" display="inline" id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1"><semantics id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1a"><mo id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1b"><times id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id2.2.2.2.1.1.1.1.1.1.1.1.1.1.m1.1d">×</annotation></semantics></math> compared to the original SASRec’s inference method and by the factor of 1.56<math alttext="\times" class="ltx_Math" display="inline" id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1"><semantics id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1a"><mo id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1.1" mathcolor="#000000" xref="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1b"><times id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1.1.cmml" xref="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id3.3.3.3.2.2.2.2.2.2.2.2.2.2.m2.1d">×</annotation></semantics></math> compared to the method implemented in RecJPQ code on a large-scale Gowalla dataset with more than million items. Further, using simulated data, we show that PQTopK remains efficient with catalogues of up to tens of millions of items, removing one of the last obstacles to using Transformer-based models in production environments with large catalogues.</span></span></span></span></span></span></span></span></span></span></span></span></p>
</div>
<span class="ltx_note ltx_note_frontmatter ltx_role_journalyear" id="id1"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2024</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_journalyear" id="id2"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2024</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_copyright" id="id3"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>rightsretained</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_conference" id="id4"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>18th ACM Conference on Recommender Systems; October 14–18, 2024; Bari, Italy</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_booktitle" id="id5"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">booktitle: </span>18th ACM Conference on Recommender Systems (RecSys ’24), October 14–18, 2024, Bari, Italy</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_doi" id="id6"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>10.1145/3640457.3688168</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_isbn" id="id7"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>979-8-4007-0505-2/24/10</span></span></span>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">The goal of sequential recommender models is to predict the next item in a sequence of user-item interactions. The best models for this task, such as SASRec <cite class="ltx_cite ltx_citemacro_citep">(Kang and McAuley, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib10" title="">2018</a>)</cite> and BERT4Rec <cite class="ltx_cite ltx_citemacro_citep">(Sun et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib18" title="">2019</a>)</cite>, are based on adaptations of the Transformer <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib21" title="">2017</a>)</cite> architecture.
Indeed, while the <span class="ltx_text" id="S1.p1.1.1">Transformer<span class="ltx_text" id="S1.p1.1.1.1"> architecture was originally developed for natural language processing, sequential recommender systems adapt the architecture by using tokens to represent items, <span class="ltx_text" id="S1.p1.1.1.1.1">and <span class="ltx_text" id="S1.p1.1.1.1.1.1">the<span class="ltx_text" id="S1.p1.1.1.1.1.1.1"> next item prediction task then becomes equivalent to the next token prediction task in the language models.<span class="ltx_text" id="S1.p1.1.1.1.1.1.1.1"></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Despite achieving state-of-the-art results on <span class="ltx_text" id="S1.p2.1.1">datasets available in academia<span class="ltx_text" id="S1.p2.1.1.1">, it is challenging to use these models in a production environment due to the scalability issues: the number of items in large-scale recommender systems, such as product recommendations in Amazon, can reach hundreds of millions <cite class="ltx_cite ltx_citemacro_citep">(Ama, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib2" title="">2023</a>)</cite>, which is much larger than tens of thousands of tokens in the dictionaries of language models. A large catalogue causes <span class="ltx_text" id="S1.p2.1.1.1.1">several problems<span class="ltx_text" id="S1.p2.1.1.1.1.1"> in Transformer models, such as large GPU memory requirements to store the item embeddings <span class="ltx_text" id="S1.p2.1.1.1.1.1.1">during training<span class="ltx_text" id="S1.p2.1.1.1.1.1.1.1">, large computational resources required to train models, and slow inference in production. Several works have recently addressed the memory consumption issues <cite class="ltx_cite ltx_citemacro_citep">(Xia et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib22" title="">2023</a>; Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite> and inefficient training <cite class="ltx_cite ltx_citemacro_citep">(Klenitskiy and Vasilev, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib11" title="">2023</a>; Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib16" title="">2023</a>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib14" title="">2025</a>)</cite>; however, efficient model inference remains an open question, which is the focus of this paper.</span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1"><span class="ltx_text" id="S1.p3.1.1">Efficient inference is especially important when considering a model deployment on CPU-only hardware (i.e. without GPU acceleration). Indeed, deploying a trained model on CPU-only hardware is often a practical choice, considering the high <span class="ltx_text" id="S1.p3.1.1.1">running<span class="ltx_text" id="S1.p3.1.1.1.1"> costs associated with GPU accelerators.
Hence, in this paper, we specifically focus on the CPU-only inference efficiency of Transformer-based sequential recommendation models.<span class="ltx_text" id="S1.p3.1.1.1.1.1"></span></span></span></span></p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="154" id="S1.F1.g1" src="x1.png" width="664"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>Reconstruction of item embeddings <span class="ltx_text" id="S1.F1.2.1">and computing item scores<span class="ltx_text" id="S1.F1.2.1.1"> using Product Quantisation <span class="ltx_text" id="S1.F1.2.1.1.1">with <math alttext="m=3" class="ltx_Math" display="inline" id="S1.F1.2.1.1.1.m1.1"><semantics id="S1.F1.2.1.1.1.m1.1b"><mrow id="S1.F1.2.1.1.1.m1.1.1" xref="S1.F1.2.1.1.1.m1.1.1.cmml"><mi id="S1.F1.2.1.1.1.m1.1.1.2" mathcolor="#000000" xref="S1.F1.2.1.1.1.m1.1.1.2.cmml">m</mi><mo id="S1.F1.2.1.1.1.m1.1.1.1" mathcolor="#000000" xref="S1.F1.2.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S1.F1.2.1.1.1.m1.1.1.3" mathcolor="#000000" xref="S1.F1.2.1.1.1.m1.1.1.3.cmml">3</mn></mrow><annotation-xml encoding="MathML-Content" id="S1.F1.2.1.1.1.m1.1c"><apply id="S1.F1.2.1.1.1.m1.1.1.cmml" xref="S1.F1.2.1.1.1.m1.1.1"><eq id="S1.F1.2.1.1.1.m1.1.1.1.cmml" xref="S1.F1.2.1.1.1.m1.1.1.1"></eq><ci id="S1.F1.2.1.1.1.m1.1.1.2.cmml" xref="S1.F1.2.1.1.1.m1.1.1.2">𝑚</ci><cn id="S1.F1.2.1.1.1.m1.1.1.3.cmml" type="integer" xref="S1.F1.2.1.1.1.m1.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.2.1.1.1.m1.1d">m=3</annotation><annotation encoding="application/x-llamapun" id="S1.F1.2.1.1.1.m1.1e">italic_m = 3</annotation></semantics></math> splits.<span class="ltx_text" id="S1.F1.2.1.1.1.1"> </span></span></span></span></figcaption>
</figure>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.2"><span class="ltx_text" id="S1.p4.2.2">The inference of a Transformer-based recommendation model consists of two parts: computing a em sequence representation using the <em class="ltx_emph ltx_font_italic" id="S1.p4.2.2.3">backbone</em> Transformer model, followed by computing the scores of individual items using this representation (see Section <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2" title="2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a> for details).<span class="ltx_text" id="S1.p4.2.2.2"> The main cause of the slow inference by Transformer-based models arises not from the Transformer backbone model itself but from the computation of <span class="ltx_text" id="S1.p4.2.2.2.2">all the item scores<span class="ltx_text" id="S1.p4.2.2.2.2.2">. Indeed, the inference time of a given Transformer backbone model is constant w.r.t. the number of items <span class="ltx_text" id="S1.p4.2.2.2.2.2.2">(after embedding lookup, which is <math alttext="\mathcal{O}(1)" class="ltx_Math" display="inline" id="S1.p4.1.1.1.1.1.1.m1.1"><semantics id="S1.p4.1.1.1.1.1.1.m1.1a"><mrow id="S1.p4.1.1.1.1.1.1.m1.1.2" xref="S1.p4.1.1.1.1.1.1.m1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S1.p4.1.1.1.1.1.1.m1.1.2.2" mathcolor="#000000" xref="S1.p4.1.1.1.1.1.1.m1.1.2.2.cmml">𝒪</mi><mo id="S1.p4.1.1.1.1.1.1.m1.1.2.1" xref="S1.p4.1.1.1.1.1.1.m1.1.2.1.cmml">⁢</mo><mrow id="S1.p4.1.1.1.1.1.1.m1.1.2.3.2" xref="S1.p4.1.1.1.1.1.1.m1.1.2.cmml"><mo id="S1.p4.1.1.1.1.1.1.m1.1.2.3.2.1" mathcolor="#000000" stretchy="false" xref="S1.p4.1.1.1.1.1.1.m1.1.2.cmml">(</mo><mn id="S1.p4.1.1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="S1.p4.1.1.1.1.1.1.m1.1.1.cmml">1</mn><mo id="S1.p4.1.1.1.1.1.1.m1.1.2.3.2.2" mathcolor="#000000" stretchy="false" xref="S1.p4.1.1.1.1.1.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p4.1.1.1.1.1.1.m1.1b"><apply id="S1.p4.1.1.1.1.1.1.m1.1.2.cmml" xref="S1.p4.1.1.1.1.1.1.m1.1.2"><times id="S1.p4.1.1.1.1.1.1.m1.1.2.1.cmml" xref="S1.p4.1.1.1.1.1.1.m1.1.2.1"></times><ci id="S1.p4.1.1.1.1.1.1.m1.1.2.2.cmml" xref="S1.p4.1.1.1.1.1.1.m1.1.2.2">𝒪</ci><cn id="S1.p4.1.1.1.1.1.1.m1.1.1.cmml" type="integer" xref="S1.p4.1.1.1.1.1.1.m1.1.1">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p4.1.1.1.1.1.1.m1.1c">\mathcal{O}(1)</annotation><annotation encoding="application/x-llamapun" id="S1.p4.1.1.1.1.1.1.m1.1d">caligraphic_O ( 1 )</annotation></semantics></math> operation, the Transformer model only works with embeddings, which do not depend on the number of items)<span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1">; however, computing item scores has a linear complexity w.r.t. the number of items. Hence, to speed up inference, there are three options: (i) reduce the number of scored items, (ii) reduce the number of operations per item, and (iii) efficiently parallelise computations.
In the first category are the approximate nearest neighbour methods, such as FAISS <cite class="ltx_cite ltx_citemacro_citep">(Johnson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib9" title="">2021</a>)</cite> or Annoy <cite class="ltx_cite ltx_citemacro_citep">(Spo, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib3" title="">2024</a>)</cite>. While these methods can be practical in some cases, there are two problems: (i) these methods are <em class="ltx_emph ltx_font_italic" id="S1.p4.2.2.2.2.2.2.1.2">unsafe</em><span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1"> <cite class="ltx_cite ltx_citemacro_citep">(Turtle and Flood, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib20" title="">1995</a>; Tonellotto et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib19" title="">2018</a>)</cite><span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1">, meaning that the results retrieved using an ANN index may omit some candidates that would have been scored high by the model and (ii) they require item embeddings to be present in the first place in order to build the index, and training item embeddings for all items in large catalogue case may not be feasible in the first place <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>.
Therefore, this paper focuses on <span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1">analysing the efficiency of existing methods and<span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1"> reducing the number of operations per item and parallelising the computations. In particular, we build upon RecJPQ <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>, a recent state-of-the-art approach for compressing embedding tables in Transformer-based sequential recommenders. RecJPQ achieves compression by representing items using a concatenation of shared sub-ids. While achieving great results on compression (for example, on the Gowalla <cite class="ltx_cite ltx_citemacro_citep">(Cho et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib6" title="">2011</a>)</cite> dataset, RecJPQ achieves up to 50<math alttext="\times" class="ltx_Math" display="inline" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1"><semantics id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1a"><mo id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1b"><times id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1.1.cmml" xref="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.m1.1d">×</annotation></semantics></math> compression without degrading effectiveness), the RecJPQ paper does not perform any analysis of the model’s inference in large catalogues and only briefly mentions that it is similar to the inference time of the original non-compressed models. On the other hand, prior works that built upon similar ideas of sub-id-based recommendation, such as LightRec <cite class="ltx_cite ltx_citemacro_citep">(Lian et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib12" title="">2020</a>)</cite>, showed that the sub-id-based method could indeed improve model inference time. <span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.1">Inspired by LightRec, we describe a sub-id-based scoring algorithm for PQ-based models, which we call <span class="ltx_text ltx_font_italic" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.1.1">PQTopK</span>.<span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.1.2"> <span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.1.2.1">We further<span class="ltx_text" id="S1.p4.2.2.2.2.2.2.1.1.1.1.1.1.2.1.1"> analyse if RecJPQ-enhanced Transformer-based recommendation models can be efficiently inferred on catalogues with (multiple) millions of items using the PQTopK algorithm in a CPU-only environment.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">The main contributions of this paper can be summarised as follows: (i) we analyse inference efficiency of RecJPQ-enhanced versions of SASRec <cite class="ltx_cite ltx_citemacro_citep">(Kang and McAuley, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib10" title="">2018</a>)</cite> and BERT4Rec <cite class="ltx_cite ltx_citemacro_citep">(Sun et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib18" title="">2019</a>)</cite> and find that it is more efficient than Matrix-Multiplication based scoring used in the original models; (ii) we show that scoring <span class="ltx_text" id="S1.p5.1.1">efficiency<span class="ltx_text" id="S1.p5.1.1.1"> of RecJPQ-based models can be <span class="ltx_text" id="S1.p5.1.1.1.1">improved using the PQTopK algorithm<span class="ltx_text" id="S1.p5.1.1.1.1.1"> (iii) we explore the limits of <span class="ltx_text" id="S1.p5.1.1.1.1.1.1">PQTopK<span class="ltx_text" id="S1.p5.1.1.1.1.1.1.1">-based inference using simulated settings with up to 1 billion items in catalogue and show that inference remains efficient with millions of items.
To the best of our knowledge, this is the first analysis of the inference of sub-id-based sequential models on large-scale datasets and the first demonstration of the feasibility of using these models in the large-catalogue scenario.</span></span></span></span></span></span></p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Background</h2>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px1">
<h3 class="ltx_title ltx_title_paragraph">Large-catalogue Sequential RecSys</h3>
<div class="ltx_para" id="S2.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.4">Usually, sequential recommendation is cast as the <em class="ltx_emph ltx_font_italic" id="S2.SS0.SSS0.Px1.p1.4.1">next item prediction</em> task. Formally, given a sequence of user-item interactions <math alttext="\left\{i_{1},i_{2},i_{3}...i_{n}\right\}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.1.m1.3"><semantics id="S2.SS0.SSS0.Px1.p1.1.m1.3a"><mrow id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml"><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml">{</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.5" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.3.cmml">2</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.6" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml">,</mo><mrow id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.cmml"><msub id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.3.cmml">3</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1.cmml">⁢</mo><mi id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.3" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.3.cmml">…</mi><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1a" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1.cmml">⁢</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.2.cmml">i</mi><mi id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.3.cmml">n</mi></msub></mrow><mo id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.7" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.1.m1.3b"><set id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.4.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3"><apply id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.3">1</cn></apply><apply id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.2.2.3">2</cn></apply><apply id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3"><times id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.1"></times><apply id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.2.3">3</cn></apply><ci id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.3">…</ci><apply id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.2">𝑖</ci><ci id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.3.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.3.3.4.3">𝑛</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.1.m1.3c">\left\{i_{1},i_{2},i_{3}...i_{n}\right\}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.1.m1.3d">{ italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_i start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_i start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT … italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math>, <span class="ltx_text" id="S2.SS0.SSS0.Px1.p1.4.2" style="color:#000000;">also known as their <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px1.p1.4.2.1">interactions history</span>,</span> the goal of a recommender system is to predict the next item in the sequence, <math alttext="i_{n+1}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.2.m2.1"><semantics id="S2.SS0.SSS0.Px1.p1.2.m2.1a"><msub id="S2.SS0.SSS0.Px1.p1.2.m2.1.1" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.2.cmml">i</mi><mrow id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.2.cmml">n</mi><mo id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.1.cmml">+</mo><mn id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.2.m2.1b"><apply id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.2">𝑖</ci><apply id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3"><plus id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.1"></plus><ci id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.2">𝑛</ci><cn id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.2.m2.1c">i_{n+1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.2.m2.1d">italic_i start_POSTSUBSCRIPT italic_n + 1 end_POSTSUBSCRIPT</annotation></semantics></math> from the <em class="ltx_emph ltx_font_italic" id="S2.SS0.SSS0.Px1.p1.4.3">item catalogue</em> (the set of all possible items) <math alttext="I" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.3.m3.1"><semantics id="S2.SS0.SSS0.Px1.p1.3.m3.1a"><mi id="S2.SS0.SSS0.Px1.p1.3.m3.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.cmml">I</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.3.m3.1b"><ci id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1">𝐼</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.3.m3.1c">I</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.3.m3.1d">italic_I</annotation></semantics></math>. The total number of items <math alttext="|I|" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.4.m4.1"><semantics id="S2.SS0.SSS0.Px1.p1.4.m4.1a"><mrow id="S2.SS0.SSS0.Px1.p1.4.m4.1.2.2" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.2.1.cmml"><mo id="S2.SS0.SSS0.Px1.p1.4.m4.1.2.2.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.2.1.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p1.4.m4.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p1.4.m4.1.2.2.2" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.4.m4.1b"><apply id="S2.SS0.SSS0.Px1.p1.4.m4.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.2.2"><abs id="S2.SS0.SSS0.Px1.p1.4.m4.1.2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.2.2.1"></abs><ci id="S2.SS0.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m4.1.1">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.4.m4.1c">|I|</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.4.m4.1d">| italic_I |</annotation></semantics></math> is the <em class="ltx_emph ltx_font_italic" id="S2.SS0.SSS0.Px1.p1.4.4">catalogue size</em>.</p>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px1.p2">
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p2.8">Typically, to generate recommendations given a history of interactions <math alttext="h=\left\{i_{1},i_{2},i_{3}...i_{n}\right\}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.1.m1.3"><semantics id="S2.SS0.SSS0.Px1.p2.1.m1.3a"><mrow id="S2.SS0.SSS0.Px1.p2.1.m1.3.3" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.cmml"><mi id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.5" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.5.cmml">h</mi><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.4.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml"><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml">{</mo><msub id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.5" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.3.cmml">2</mn></msub><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.6" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml">,</mo><mrow id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.cmml"><msub id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.cmml"><mi id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.2.cmml">i</mi><mn id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.3.cmml">3</mn></msub><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.3" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.3.cmml">…</mi><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1a" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1.cmml">⁢</mo><msub id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.cmml"><mi id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.2.cmml">i</mi><mi id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.3.cmml">n</mi></msub></mrow><mo id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.7" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.1.m1.3b"><apply id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3"><eq id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.4.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.4"></eq><ci id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.5.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.5">ℎ</ci><set id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.4.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3"><apply id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p2.1.m1.1.1.1.1.1.3">1</cn></apply><apply id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p2.1.m1.2.2.2.2.2.3">2</cn></apply><apply id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3"><times id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.1"></times><apply id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.2">𝑖</ci><cn id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.2.3">3</cn></apply><ci id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.3">…</ci><apply id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.1.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.2.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.2">𝑖</ci><ci id="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.3.cmml" xref="S2.SS0.SSS0.Px1.p2.1.m1.3.3.3.3.3.4.3">𝑛</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.1.m1.3c">h=\left\{i_{1},i_{2},i_{3}...i_{n}\right\}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.1.m1.3d">italic_h = { italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_i start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_i start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT … italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math>, Transformer-based models first generate a sequence embedding <math alttext="\phi\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.2.m2.1"><semantics id="S2.SS0.SSS0.Px1.p2.2.m2.1a"><mrow id="S2.SS0.SSS0.Px1.p2.2.m2.1.1" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.2.cmml">ϕ</mi><mo id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.1.cmml">∈</mo><msup id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.2.cmml">ℝ</mi><mi id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.2.m2.1b"><apply id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1"><in id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.1"></in><ci id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.2">italic-ϕ</ci><apply id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3">superscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.2">ℝ</ci><ci id="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.2.m2.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.2.m2.1c">\phi\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.2.m2.1d">italic_ϕ ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math>.
The scores for all items, <math alttext="r=(r_{1},\ldots,r_{|I|})\in\mathbb{R}^{|I|}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.3.m3.5"><semantics id="S2.SS0.SSS0.Px1.p2.3.m3.5a"><mrow id="S2.SS0.SSS0.Px1.p2.3.m3.5.5" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.cmml"><mi id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.4.cmml">r</mi><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.5" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.5.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml"><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.3" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml">(</mo><msub id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.2.cmml">r</mi><mn id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml">,</mo><mi id="S2.SS0.SSS0.Px1.p2.3.m3.3.3" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px1.p2.3.m3.3.3.cmml">…</mi><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.5" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.2.cmml">r</mi><mrow id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.3" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.3.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.2.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.3.2" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.2.1.cmml">|</mo></mrow></msub><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.6" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml">)</mo></mrow><mo id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.6" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.6.cmml">∈</mo><msup id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.cmml"><mi id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.2.cmml">ℝ</mi><mrow id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.3" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.3.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.2.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.3.2" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.2.1.cmml">|</mo></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.3.m3.5b"><apply id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5"><and id="S2.SS0.SSS0.Px1.p2.3.m3.5.5a.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5"></and><apply id="S2.SS0.SSS0.Px1.p2.3.m3.5.5b.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5"><eq id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.5.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.5"></eq><ci id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.4.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.4">𝑟</ci><vector id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.3.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2"><apply id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.2">𝑟</ci><cn id="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p2.3.m3.4.4.1.1.1.3">1</cn></apply><ci id="S2.SS0.SSS0.Px1.p2.3.m3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.3.3">…</ci><apply id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.2.2.2">𝑟</ci><apply id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.3"><abs id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.3.1"></abs><ci id="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.1.1.1.1">𝐼</ci></apply></apply></vector></apply><apply id="S2.SS0.SSS0.Px1.p2.3.m3.5.5c.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5"><in id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.6.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.6"></in><share href="https://arxiv.org/html/2408.09992v1#S2.SS0.SSS0.Px1.p2.3.m3.5.5.2.cmml" id="S2.SS0.SSS0.Px1.p2.3.m3.5.5d.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5"></share><apply id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7">superscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.5.5.7.2">ℝ</ci><apply id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.3"><abs id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.3.1"></abs><ci id="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.3.m3.2.2.1.1">𝐼</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.3.m3.5c">r=(r_{1},\ldots,r_{|I|})\in\mathbb{R}^{|I|}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.3.m3.5d">italic_r = ( italic_r start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_r start_POSTSUBSCRIPT | italic_I | end_POSTSUBSCRIPT ) ∈ blackboard_R start_POSTSUPERSCRIPT | italic_I | end_POSTSUPERSCRIPT</annotation></semantics></math>, are then computed by multiplying the matrix of item embeddings <math alttext="W\in\mathbb{R}^{|I|\times d}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.4.m4.1"><semantics id="S2.SS0.SSS0.Px1.p2.4.m4.1a"><mrow id="S2.SS0.SSS0.Px1.p2.4.m4.1.2" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.cmml"><mi id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.2.cmml">W</mi><mo id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.1.cmml">∈</mo><msup id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.cmml"><mi id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.2.cmml">ℝ</mi><mrow id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.cmml"><mrow id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.2" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.1.cmml"><mo id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.2.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.1.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.2.2" mathcolor="#000000" rspace="0.055em" stretchy="false" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.1.1.cmml">|</mo></mrow><mo id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.2" mathcolor="#000000" rspace="0.222em" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.2.cmml">×</mo><mi id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.4.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.4.m4.1b"><apply id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2"><in id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.1"></in><ci id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.2.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.2">𝑊</ci><apply id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3">superscript</csymbol><ci id="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.2.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.2.3.2">ℝ</ci><apply id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1"><times id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.2"></times><apply id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.2"><abs id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.3.2.1"></abs><ci id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.1">𝐼</ci></apply><ci id="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.4.cmml" xref="S2.SS0.SSS0.Px1.p2.4.m4.1.1.1.4">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.4.m4.1c">W\in\mathbb{R}^{|I|\times d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.4.m4.1d">italic_W ∈ blackboard_R start_POSTSUPERSCRIPT | italic_I | × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math>, which is usually shared with the embeddings layer of the Transformer model, by the sequence embedding <math alttext="\phi" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.5.m5.1"><semantics id="S2.SS0.SSS0.Px1.p2.5.m5.1a"><mi id="S2.SS0.SSS0.Px1.p2.5.m5.1.1" xref="S2.SS0.SSS0.Px1.p2.5.m5.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.5.m5.1b"><ci id="S2.SS0.SSS0.Px1.p2.5.m5.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.5.m5.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.5.m5.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.5.m5.1d">italic_ϕ</annotation></semantics></math>, i.e., <math alttext="r=W\phi" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.6.m6.1"><semantics id="S2.SS0.SSS0.Px1.p2.6.m6.1a"><mrow id="S2.SS0.SSS0.Px1.p2.6.m6.1.1" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.2.cmml">r</mi><mo id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.1.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.2.cmml">W</mi><mo id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.1" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.3.cmml">ϕ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.6.m6.1b"><apply id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1"><eq id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.1"></eq><ci id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.2">𝑟</ci><apply id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3"><times id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.1"></times><ci id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.2">𝑊</ci><ci id="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p2.6.m6.1.1.3.3">italic-ϕ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.6.m6.1c">r=W\phi</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.6.m6.1d">italic_r = italic_W italic_ϕ</annotation></semantics></math>.
Finally, the model generates recommendations by selecting <span class="ltx_text" id="S2.SS0.SSS0.Px1.p2.8.2">from<span class="ltx_text" id="S2.SS0.SSS0.Px1.p2.8.2.2"> <math alttext="r" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1"><semantics id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1a"><mi id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1b"><ci id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.7.1.1.m1.1d">italic_r</annotation></semantics></math> the top <math alttext="K" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1"><semantics id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1a"><mi id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1b"><ci id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1c">K</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p2.8.2.2.m2.1d">italic_K</annotation></semantics></math> items with the highest scores.</span></span></p>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px1.p3">
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p3.3">Despite their effectiveness, training Transformer-based models with large item catalogues is a challenging task, as these models typically have to be trained for long time <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib15" title="">2022</a>)</cite> and require appropriate selection of training objective <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib14" title="">2025</a>)</cite>, negative sampling strategy and loss function <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib16" title="">2023</a>; Klenitskiy and Vasilev, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib11" title="">2023</a>)</cite>.
Transformer-based models with large catalogues also require a lot of memory to store the item embeddings <math alttext="W" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p3.1.m1.1"><semantics id="S2.SS0.SSS0.Px1.p3.1.m1.1a"><mi id="S2.SS0.SSS0.Px1.p3.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p3.1.m1.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p3.1.m1.1b"><ci id="S2.SS0.SSS0.Px1.p3.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p3.1.m1.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p3.1.m1.1c">W</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p3.1.m1.1d">italic_W</annotation></semantics></math>. This problem has recently been addressed by Product Quantisation, which we describe in the next section.
Finally, another problem with Transformer-based models with large catalogues is their slow inference with large catalogues. Indeed, computing all item scores
may be prohibitively expensive when the item catalogue is large: it requires <math alttext="|I|\times d" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p3.2.m2.1"><semantics id="S2.SS0.SSS0.Px1.p3.2.m2.1a"><mrow id="S2.SS0.SSS0.Px1.p3.2.m2.1.2" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.cmml"><mrow id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.2" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.1.cmml"><mo id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.2.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.1.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p3.2.m2.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.2.2" mathcolor="#000000" rspace="0.055em" stretchy="false" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.1.1.cmml">|</mo></mrow><mo id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.1" mathcolor="#000000" rspace="0.222em" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.1.cmml">×</mo><mi id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p3.2.m2.1b"><apply id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2"><times id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.1"></times><apply id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.2"><abs id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.2.2.1"></abs><ci id="S2.SS0.SSS0.Px1.p3.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.1">𝐼</ci></apply><ci id="S2.SS0.SSS0.Px1.p3.2.m2.1.2.3.cmml" xref="S2.SS0.SSS0.Px1.p3.2.m2.1.2.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p3.2.m2.1c">|I|\times d</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p3.2.m2.1d">| italic_I | × italic_d</annotation></semantics></math> scalar multiplications and additions, and, as we noted in Section <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S1" title="1. Introduction ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a>, in real-world recommender systems, the catalogue size <math alttext="|I|" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p3.3.m3.1"><semantics id="S2.SS0.SSS0.Px1.p3.3.m3.1a"><mrow id="S2.SS0.SSS0.Px1.p3.3.m3.1.2.2" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.2.1.cmml"><mo id="S2.SS0.SSS0.Px1.p3.3.m3.1.2.2.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.2.1.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p3.3.m3.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px1.p3.3.m3.1.2.2.2" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p3.3.m3.1b"><apply id="S2.SS0.SSS0.Px1.p3.3.m3.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.2.2"><abs id="S2.SS0.SSS0.Px1.p3.3.m3.1.2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.2.2.1"></abs><ci id="S2.SS0.SSS0.Px1.p3.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px1.p3.3.m3.1.1">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p3.3.m3.1c">|I|</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p3.3.m3.1d">| italic_I |</annotation></semantics></math> may reach hundreds of millions of items, making exhaustive computation
impractical. Moreover, typically large-catalogue recommender systems have a large number of users as well; therefore, the model has to be used for inference very frequently and, ideally, using only low-cost hardware, i.e., without using GPU acceleration. Therefore, real-life recommender systems rarely exhaustively score all items for all users and instead apply unsafe heuristics (i.e. heuristics that do not provide theoretical guarantees that all high-scored items will be returned, such as two-stage ranking).</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px2">
<h3 class="ltx_title ltx_title_paragraph">Sub-Id based recommendation</h3>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.1">When the catalogue size reaches several million items, the item embedding matrix <math alttext="W" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.1.m1.1"><semantics id="S2.SS0.SSS0.Px2.p1.1.m1.1a"><mi id="S2.SS0.SSS0.Px2.p1.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.1.m1.1b"><ci id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.1.m1.1c">W</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p1.1.m1.1d">italic_W</annotation></semantics></math> becomes too large to fit in a GPU’s memory <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>. To reduce its memory footprint, several recent recommendation <span class="ltx_text" id="S2.SS0.SSS0.Px2.p1.1.1">models <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib13" title="">2024</a>)</cite><span class="ltx_text" id="S2.SS0.SSS0.Px2.p1.1.1.1"> adopted Product Quantisation (PQ) <cite class="ltx_cite ltx_citemacro_citep">(Jégou et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib8" title="">2011</a>)</cite> – a well-studied method for vector compression. PQ is a generic method that can be applied to any <span class="ltx_text" id="S2.SS0.SSS0.Px2.p1.1.1.1.1" style="color:#000000;">set of vectors</span>; however, in this section, we <span class="ltx_text" id="S2.SS0.SSS0.Px2.p1.1.1.1.2" style="color:#000000;">describe</span> PQ as applied to item embeddings.</span></span></p>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p2">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p2.4">To compress the item embedding matrix <math alttext="W" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.1.m1.1"><semantics id="S2.SS0.SSS0.Px2.p2.1.m1.1a"><mi id="S2.SS0.SSS0.Px2.p2.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.1.m1.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.1.m1.1b"><ci id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.1.m1.1c">W</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.1.m1.1d">italic_W</annotation></semantics></math>, PQ associates each item id to a list of <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p2.4.1">sub-ids</span>, akin to language models breaking down words into sub-word tokens. PQ reconstructs an item’s embedding by combining the sub-id embeddings assigned to it. These sub-ids are organised into <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p2.4.2">splits</span>, with each item having precisely one sub-id from each split<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>We use the terminology from <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>. In the PQ literature, another popular term for sub-id embeddings is <em class="ltx_emph ltx_font_italic" id="footnote1.1">centroids</em>, and another popular term for splits is <em class="ltx_emph ltx_font_italic" id="footnote1.2">sub-spaces</em>.</span></span></span>. More formally, PQ first builds a <em class="ltx_emph ltx_font_italic" id="S2.SS0.SSS0.Px2.p2.4.3">codebook</em> <math alttext="G\in\mathbb{N}^{|I|\times m}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.2.m2.1"><semantics id="S2.SS0.SSS0.Px2.p2.2.m2.1a"><mrow id="S2.SS0.SSS0.Px2.p2.2.m2.1.2" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.2.cmml">G</mi><mo id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.1.cmml">∈</mo><msup id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.2.cmml">ℕ</mi><mrow id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.cmml"><mrow id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.1.cmml"><mo id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.2.1" mathcolor="#000000" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.1.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.1.cmml">I</mi><mo id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.2.2" mathcolor="#000000" rspace="0.055em" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.1.1.cmml">|</mo></mrow><mo id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.2" mathcolor="#000000" rspace="0.222em" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.2.cmml">×</mo><mi id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.4" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.4.cmml">m</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.2.m2.1b"><apply id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2"><in id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.1"></in><ci id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.2">𝐺</ci><apply id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.2.3.2">ℕ</ci><apply id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1"><times id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.2"></times><apply id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.2"><abs id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.3.2.1"></abs><ci id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.1">𝐼</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.4.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.1.4">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.2.m2.1c">G\in\mathbb{N}^{|I|\times m}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.2.m2.1d">italic_G ∈ blackboard_N start_POSTSUPERSCRIPT | italic_I | × italic_m end_POSTSUPERSCRIPT</annotation></semantics></math> that maps an item id <math alttext="i" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.3.m3.1"><semantics id="S2.SS0.SSS0.Px2.p2.3.m3.1a"><mi id="S2.SS0.SSS0.Px2.p2.3.m3.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.3.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.3.m3.1b"><ci id="S2.SS0.SSS0.Px2.p2.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.3.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.3.m3.1d">italic_i</annotation></semantics></math> to its associated <math alttext="m" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.4.m4.1"><semantics id="S2.SS0.SSS0.Px2.p2.4.m4.1a"><mi id="S2.SS0.SSS0.Px2.p2.4.m4.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.4.m4.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.4.m4.1b"><ci id="S2.SS0.SSS0.Px2.p2.4.m4.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m4.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.4.m4.1c">m</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.4.m4.1d">italic_m</annotation></semantics></math> sub-ids:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx1">
<tbody id="S2.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle G[i]\rightarrow\left\{g_{i1},g_{i2},...,g_{im}\right\}" class="ltx_Math" display="inline" id="S2.E1.m1.5"><semantics id="S2.E1.m1.5a"><mrow id="S2.E1.m1.5.5" xref="S2.E1.m1.5.5.cmml"><mrow id="S2.E1.m1.5.5.5" xref="S2.E1.m1.5.5.5.cmml"><mi id="S2.E1.m1.5.5.5.2" xref="S2.E1.m1.5.5.5.2.cmml">G</mi><mo id="S2.E1.m1.5.5.5.1" xref="S2.E1.m1.5.5.5.1.cmml">⁢</mo><mrow id="S2.E1.m1.5.5.5.3.2" xref="S2.E1.m1.5.5.5.3.1.cmml"><mo id="S2.E1.m1.5.5.5.3.2.1" stretchy="false" xref="S2.E1.m1.5.5.5.3.1.1.cmml">[</mo><mi id="S2.E1.m1.1.1" xref="S2.E1.m1.1.1.cmml">i</mi><mo id="S2.E1.m1.5.5.5.3.2.2" stretchy="false" xref="S2.E1.m1.5.5.5.3.1.1.cmml">]</mo></mrow></mrow><mo id="S2.E1.m1.5.5.4" stretchy="false" xref="S2.E1.m1.5.5.4.cmml">→</mo><mrow id="S2.E1.m1.5.5.3.3" xref="S2.E1.m1.5.5.3.4.cmml"><mo id="S2.E1.m1.5.5.3.3.4" xref="S2.E1.m1.5.5.3.4.cmml">{</mo><msub id="S2.E1.m1.3.3.1.1.1" xref="S2.E1.m1.3.3.1.1.1.cmml"><mi id="S2.E1.m1.3.3.1.1.1.2" xref="S2.E1.m1.3.3.1.1.1.2.cmml">g</mi><mrow id="S2.E1.m1.3.3.1.1.1.3" xref="S2.E1.m1.3.3.1.1.1.3.cmml"><mi id="S2.E1.m1.3.3.1.1.1.3.2" xref="S2.E1.m1.3.3.1.1.1.3.2.cmml">i</mi><mo id="S2.E1.m1.3.3.1.1.1.3.1" xref="S2.E1.m1.3.3.1.1.1.3.1.cmml">⁢</mo><mn id="S2.E1.m1.3.3.1.1.1.3.3" xref="S2.E1.m1.3.3.1.1.1.3.3.cmml">1</mn></mrow></msub><mo id="S2.E1.m1.5.5.3.3.5" xref="S2.E1.m1.5.5.3.4.cmml">,</mo><msub id="S2.E1.m1.4.4.2.2.2" xref="S2.E1.m1.4.4.2.2.2.cmml"><mi id="S2.E1.m1.4.4.2.2.2.2" xref="S2.E1.m1.4.4.2.2.2.2.cmml">g</mi><mrow id="S2.E1.m1.4.4.2.2.2.3" xref="S2.E1.m1.4.4.2.2.2.3.cmml"><mi id="S2.E1.m1.4.4.2.2.2.3.2" xref="S2.E1.m1.4.4.2.2.2.3.2.cmml">i</mi><mo id="S2.E1.m1.4.4.2.2.2.3.1" xref="S2.E1.m1.4.4.2.2.2.3.1.cmml">⁢</mo><mn id="S2.E1.m1.4.4.2.2.2.3.3" xref="S2.E1.m1.4.4.2.2.2.3.3.cmml">2</mn></mrow></msub><mo id="S2.E1.m1.5.5.3.3.6" xref="S2.E1.m1.5.5.3.4.cmml">,</mo><mi id="S2.E1.m1.2.2" mathvariant="normal" xref="S2.E1.m1.2.2.cmml">…</mi><mo id="S2.E1.m1.5.5.3.3.7" xref="S2.E1.m1.5.5.3.4.cmml">,</mo><msub id="S2.E1.m1.5.5.3.3.3" xref="S2.E1.m1.5.5.3.3.3.cmml"><mi id="S2.E1.m1.5.5.3.3.3.2" xref="S2.E1.m1.5.5.3.3.3.2.cmml">g</mi><mrow id="S2.E1.m1.5.5.3.3.3.3" xref="S2.E1.m1.5.5.3.3.3.3.cmml"><mi id="S2.E1.m1.5.5.3.3.3.3.2" xref="S2.E1.m1.5.5.3.3.3.3.2.cmml">i</mi><mo id="S2.E1.m1.5.5.3.3.3.3.1" xref="S2.E1.m1.5.5.3.3.3.3.1.cmml">⁢</mo><mi id="S2.E1.m1.5.5.3.3.3.3.3" xref="S2.E1.m1.5.5.3.3.3.3.3.cmml">m</mi></mrow></msub><mo id="S2.E1.m1.5.5.3.3.8" xref="S2.E1.m1.5.5.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m1.5b"><apply id="S2.E1.m1.5.5.cmml" xref="S2.E1.m1.5.5"><ci id="S2.E1.m1.5.5.4.cmml" xref="S2.E1.m1.5.5.4">→</ci><apply id="S2.E1.m1.5.5.5.cmml" xref="S2.E1.m1.5.5.5"><times id="S2.E1.m1.5.5.5.1.cmml" xref="S2.E1.m1.5.5.5.1"></times><ci id="S2.E1.m1.5.5.5.2.cmml" xref="S2.E1.m1.5.5.5.2">𝐺</ci><apply id="S2.E1.m1.5.5.5.3.1.cmml" xref="S2.E1.m1.5.5.5.3.2"><csymbol cd="latexml" id="S2.E1.m1.5.5.5.3.1.1.cmml" xref="S2.E1.m1.5.5.5.3.2.1">delimited-[]</csymbol><ci id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1">𝑖</ci></apply></apply><set id="S2.E1.m1.5.5.3.4.cmml" xref="S2.E1.m1.5.5.3.3"><apply id="S2.E1.m1.3.3.1.1.1.cmml" xref="S2.E1.m1.3.3.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.3.3.1.1.1.1.cmml" xref="S2.E1.m1.3.3.1.1.1">subscript</csymbol><ci id="S2.E1.m1.3.3.1.1.1.2.cmml" xref="S2.E1.m1.3.3.1.1.1.2">𝑔</ci><apply id="S2.E1.m1.3.3.1.1.1.3.cmml" xref="S2.E1.m1.3.3.1.1.1.3"><times id="S2.E1.m1.3.3.1.1.1.3.1.cmml" xref="S2.E1.m1.3.3.1.1.1.3.1"></times><ci id="S2.E1.m1.3.3.1.1.1.3.2.cmml" xref="S2.E1.m1.3.3.1.1.1.3.2">𝑖</ci><cn id="S2.E1.m1.3.3.1.1.1.3.3.cmml" type="integer" xref="S2.E1.m1.3.3.1.1.1.3.3">1</cn></apply></apply><apply id="S2.E1.m1.4.4.2.2.2.cmml" xref="S2.E1.m1.4.4.2.2.2"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.2.2.2.1.cmml" xref="S2.E1.m1.4.4.2.2.2">subscript</csymbol><ci id="S2.E1.m1.4.4.2.2.2.2.cmml" xref="S2.E1.m1.4.4.2.2.2.2">𝑔</ci><apply id="S2.E1.m1.4.4.2.2.2.3.cmml" xref="S2.E1.m1.4.4.2.2.2.3"><times id="S2.E1.m1.4.4.2.2.2.3.1.cmml" xref="S2.E1.m1.4.4.2.2.2.3.1"></times><ci id="S2.E1.m1.4.4.2.2.2.3.2.cmml" xref="S2.E1.m1.4.4.2.2.2.3.2">𝑖</ci><cn id="S2.E1.m1.4.4.2.2.2.3.3.cmml" type="integer" xref="S2.E1.m1.4.4.2.2.2.3.3">2</cn></apply></apply><ci id="S2.E1.m1.2.2.cmml" xref="S2.E1.m1.2.2">…</ci><apply id="S2.E1.m1.5.5.3.3.3.cmml" xref="S2.E1.m1.5.5.3.3.3"><csymbol cd="ambiguous" id="S2.E1.m1.5.5.3.3.3.1.cmml" xref="S2.E1.m1.5.5.3.3.3">subscript</csymbol><ci id="S2.E1.m1.5.5.3.3.3.2.cmml" xref="S2.E1.m1.5.5.3.3.3.2">𝑔</ci><apply id="S2.E1.m1.5.5.3.3.3.3.cmml" xref="S2.E1.m1.5.5.3.3.3.3"><times id="S2.E1.m1.5.5.3.3.3.3.1.cmml" xref="S2.E1.m1.5.5.3.3.3.3.1"></times><ci id="S2.E1.m1.5.5.3.3.3.3.2.cmml" xref="S2.E1.m1.5.5.3.3.3.3.2">𝑖</ci><ci id="S2.E1.m1.5.5.3.3.3.3.3.cmml" xref="S2.E1.m1.5.5.3.3.3.3.3">𝑚</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.5c">\displaystyle G[i]\rightarrow\left\{g_{i1},g_{i2},...,g_{im}\right\}</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.5d">italic_G [ italic_i ] → { italic_g start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT , italic_g start_POSTSUBSCRIPT italic_i 2 end_POSTSUBSCRIPT , … , italic_g start_POSTSUBSCRIPT italic_i italic_m end_POSTSUBSCRIPT }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p2.8">where <math alttext="g_{ij}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.5.m1.1"><semantics id="S2.SS0.SSS0.Px2.p2.5.m1.1a"><msub id="S2.SS0.SSS0.Px2.p2.5.m1.1.1" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.2.cmml">g</mi><mrow id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.2.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.5.m1.1b"><apply id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.2">𝑔</ci><apply id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3"><times id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.1"></times><ci id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.2">𝑖</ci><ci id="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m1.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.5.m1.1c">g_{ij}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.5.m1.1d">italic_g start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is the <math alttext="j" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.6.m2.1"><semantics id="S2.SS0.SSS0.Px2.p2.6.m2.1a"><mi id="S2.SS0.SSS0.Px2.p2.6.m2.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.6.m2.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.6.m2.1b"><ci id="S2.SS0.SSS0.Px2.p2.6.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m2.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.6.m2.1c">j</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.6.m2.1d">italic_j</annotation></semantics></math>-th sub-id associated with item <math alttext="i" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.7.m3.1"><semantics id="S2.SS0.SSS0.Px2.p2.7.m3.1a"><mi id="S2.SS0.SSS0.Px2.p2.7.m3.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.7.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.7.m3.1b"><ci id="S2.SS0.SSS0.Px2.p2.7.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.7.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.7.m3.1d">italic_i</annotation></semantics></math> and <math alttext="m" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.8.m4.1"><semantics id="S2.SS0.SSS0.Px2.p2.8.m4.1a"><mi id="S2.SS0.SSS0.Px2.p2.8.m4.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p2.8.m4.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.8.m4.1b"><ci id="S2.SS0.SSS0.Px2.p2.8.m4.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m4.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.8.m4.1c">m</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.8.m4.1d">italic_m</annotation></semantics></math> is the number of splits. There are several algorithms for associating ids to sub-ids, for instance, using KMeans <cite class="ltx_cite ltx_citemacro_citep">(Jégou et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib8" title="">2011</a>)</cite>, or learning during model training <cite class="ltx_cite ltx_citemacro_citep">(Chen et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib5" title="">2020</a>)</cite>;
RecJPQ <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite> derives the codes from a truncated SVD decomposition of the user-item interactions matrix.</p>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p3">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p3.9">For each split <math alttext="k=1,\ldots,m" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.1.m1.3"><semantics id="S2.SS0.SSS0.Px2.p3.1.m1.3a"><mrow id="S2.SS0.SSS0.Px2.p3.1.m1.3.4" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.cmml"><mi id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.2.cmml">k</mi><mo id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.1.cmml">=</mo><mrow id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.2" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.1.cmml"><mn id="S2.SS0.SSS0.Px2.p3.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.1.1.cmml">1</mn><mo id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.2.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.1.cmml">,</mo><mi id="S2.SS0.SSS0.Px2.p3.1.m1.2.2" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px2.p3.1.m1.2.2.cmml">…</mi><mo id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.1.cmml">,</mo><mi id="S2.SS0.SSS0.Px2.p3.1.m1.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.3.cmml">m</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.1.m1.3b"><apply id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4"><eq id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.1.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.1"></eq><ci id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.2.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.2">𝑘</ci><list id="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.4.3.2"><cn id="S2.SS0.SSS0.Px2.p3.1.m1.1.1.cmml" type="integer" xref="S2.SS0.SSS0.Px2.p3.1.m1.1.1">1</cn><ci id="S2.SS0.SSS0.Px2.p3.1.m1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.2.2">…</ci><ci id="S2.SS0.SSS0.Px2.p3.1.m1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.1.m1.3.3">𝑚</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.1.m1.3c">k=1,\ldots,m</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.1.m1.3d">italic_k = 1 , … , italic_m</annotation></semantics></math>, PQ stores a sub-item embedding matrix <math alttext="\Psi_{k}\in\mathbb{R}^{b\times\frac{d}{m}}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.2.m2.1"><semantics id="S2.SS0.SSS0.Px2.p3.2.m2.1a"><mrow id="S2.SS0.SSS0.Px2.p3.2.m2.1.1" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.cmml"><msub id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.2" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.2.cmml">Ψ</mi><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.3.cmml">k</mi></msub><mo id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.1.cmml">∈</mo><msup id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.2.cmml">b</mi><mo id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.1.cmml">×</mo><mfrac id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.2.cmml">d</mi><mi id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.3.cmml">m</mi></mfrac></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.2.m2.1b"><apply id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1"><in id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.1"></in><apply id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.2">Ψ</ci><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.3.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.2.3">𝑘</ci></apply><apply id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.2">ℝ</ci><apply id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3"><times id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.1"></times><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.2">𝑏</ci><apply id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3"><divide id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3"></divide><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.2">𝑑</ci><ci id="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.2.m2.1.1.3.3.3.3">𝑚</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.2.m2.1c">\Psi_{k}\in\mathbb{R}^{b\times\frac{d}{m}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.2.m2.1d">roman_Ψ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_b × divide start_ARG italic_d end_ARG start_ARG italic_m end_ARG end_POSTSUPERSCRIPT</annotation></semantics></math>, where <math alttext="b" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.3.m3.1"><semantics id="S2.SS0.SSS0.Px2.p3.3.m3.1a"><mi id="S2.SS0.SSS0.Px2.p3.3.m3.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.3.m3.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.3.m3.1b"><ci id="S2.SS0.SSS0.Px2.p3.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.3.m3.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.3.m3.1c">b</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.3.m3.1d">italic_b</annotation></semantics></math> is the number of distinct sub-ids in each split. The <math alttext="j" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.4.m4.1"><semantics id="S2.SS0.SSS0.Px2.p3.4.m4.1a"><mi id="S2.SS0.SSS0.Px2.p3.4.m4.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.4.m4.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.4.m4.1b"><ci id="S2.SS0.SSS0.Px2.p3.4.m4.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.4.m4.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.4.m4.1c">j</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.4.m4.1d">italic_j</annotation></semantics></math>-th row of <math alttext="\Psi_{k}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.5.m5.1"><semantics id="S2.SS0.SSS0.Px2.p3.5.m5.1a"><msub id="S2.SS0.SSS0.Px2.p3.5.m5.1.1" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.2" mathcolor="#000000" mathvariant="normal" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1.2.cmml">Ψ</mi><mi id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.5.m5.1b"><apply id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1.2">Ψ</ci><ci id="S2.SS0.SSS0.Px2.p3.5.m5.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p3.5.m5.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.5.m5.1c">\Psi_{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.5.m5.1d">roman_Ψ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> denotes the sub-item embedding <math alttext="\psi_{k,j}\in\mathbb{R}^{\frac{d}{m}}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.6.m6.2"><semantics id="S2.SS0.SSS0.Px2.p3.6.m6.2a"><mrow id="S2.SS0.SSS0.Px2.p3.6.m6.2.3" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.cmml"><msub id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.cmml"><mi id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.2.cmml">ψ</mi><mrow id="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.4" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.6.m6.1.1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.1.1.1.1.cmml">k</mi><mo id="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.4.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.3.cmml">,</mo><mi id="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.2.cmml">j</mi></mrow></msub><mo id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.1.cmml">∈</mo><msup id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.2.cmml">ℝ</mi><mfrac id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.cmml"><mi id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.2.cmml">d</mi><mi id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.3.cmml">m</mi></mfrac></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.6.m6.2b"><apply id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3"><in id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.1"></in><apply id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.1.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.2.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.2.2">𝜓</ci><list id="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.3.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.4"><ci id="S2.SS0.SSS0.Px2.p3.6.m6.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.1.1.1.1">𝑘</ci><ci id="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.2.2.2">𝑗</ci></list></apply><apply id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.2">ℝ</ci><apply id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3"><divide id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3"></divide><ci id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.2">𝑑</ci><ci id="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px2.p3.6.m6.2.3.3.3.3">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.6.m6.2c">\psi_{k,j}\in\mathbb{R}^{\frac{d}{m}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.6.m6.2d">italic_ψ start_POSTSUBSCRIPT italic_k , italic_j end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT divide start_ARG italic_d end_ARG start_ARG italic_m end_ARG end_POSTSUPERSCRIPT</annotation></semantics></math> associated with the <math alttext="j" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.7.m7.1"><semantics id="S2.SS0.SSS0.Px2.p3.7.m7.1a"><mi id="S2.SS0.SSS0.Px2.p3.7.m7.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.7.m7.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.7.m7.1b"><ci id="S2.SS0.SSS0.Px2.p3.7.m7.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.7.m7.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.7.m7.1c">j</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.7.m7.1d">italic_j</annotation></semantics></math>-th sub-id, in the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.8.m8.1"><semantics id="S2.SS0.SSS0.Px2.p3.8.m8.1a"><mi id="S2.SS0.SSS0.Px2.p3.8.m8.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.8.m8.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.8.m8.1b"><ci id="S2.SS0.SSS0.Px2.p3.8.m8.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.8.m8.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.8.m8.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.8.m8.1d">italic_k</annotation></semantics></math>-th split.
Then, PQ reconstructs the item embedding <math alttext="w_{i}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p3.9.m9.1"><semantics id="S2.SS0.SSS0.Px2.p3.9.m9.1a"><msub id="S2.SS0.SSS0.Px2.p3.9.m9.1.1" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.2" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1.2.cmml">w</mi><mi id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.3" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p3.9.m9.1b"><apply id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1.2">𝑤</ci><ci id="S2.SS0.SSS0.Px2.p3.9.m9.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p3.9.m9.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p3.9.m9.1c">w_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p3.9.m9.1d">italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> as a concatenation of the associated sub-id embedding:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx2">
<tbody id="S2.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle w_{i}=\psi_{1,g_{i1}}\mathbin{\|}\psi_{2,g_{i2}}\mathbin{\|}...%
\mathbin{\|}\psi_{m,g_{im}}" class="ltx_Math" display="inline" id="S2.E2.m1.6"><semantics id="S2.E2.m1.6a"><mrow id="S2.E2.m1.6.7" xref="S2.E2.m1.6.7.cmml"><msub id="S2.E2.m1.6.7.2" xref="S2.E2.m1.6.7.2.cmml"><mi id="S2.E2.m1.6.7.2.2" xref="S2.E2.m1.6.7.2.2.cmml">w</mi><mi id="S2.E2.m1.6.7.2.3" xref="S2.E2.m1.6.7.2.3.cmml">i</mi></msub><mo id="S2.E2.m1.6.7.1" xref="S2.E2.m1.6.7.1.cmml">=</mo><mrow id="S2.E2.m1.6.7.3" xref="S2.E2.m1.6.7.3.cmml"><msub id="S2.E2.m1.6.7.3.2" xref="S2.E2.m1.6.7.3.2.cmml"><mi id="S2.E2.m1.6.7.3.2.2" xref="S2.E2.m1.6.7.3.2.2.cmml">ψ</mi><mrow id="S2.E2.m1.2.2.2.2" xref="S2.E2.m1.2.2.2.3.cmml"><mn id="S2.E2.m1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml">1</mn><mo id="S2.E2.m1.2.2.2.2.2" xref="S2.E2.m1.2.2.2.3.cmml">,</mo><msub id="S2.E2.m1.2.2.2.2.1" xref="S2.E2.m1.2.2.2.2.1.cmml"><mi id="S2.E2.m1.2.2.2.2.1.2" xref="S2.E2.m1.2.2.2.2.1.2.cmml">g</mi><mrow id="S2.E2.m1.2.2.2.2.1.3" xref="S2.E2.m1.2.2.2.2.1.3.cmml"><mi id="S2.E2.m1.2.2.2.2.1.3.2" xref="S2.E2.m1.2.2.2.2.1.3.2.cmml">i</mi><mo id="S2.E2.m1.2.2.2.2.1.3.1" xref="S2.E2.m1.2.2.2.2.1.3.1.cmml">⁢</mo><mn id="S2.E2.m1.2.2.2.2.1.3.3" xref="S2.E2.m1.2.2.2.2.1.3.3.cmml">1</mn></mrow></msub></mrow></msub><mo id="S2.E2.m1.6.7.3.1" lspace="0.222em" rspace="0.222em" xref="S2.E2.m1.6.7.3.1.cmml">∥</mo><msub id="S2.E2.m1.6.7.3.3" xref="S2.E2.m1.6.7.3.3.cmml"><mi id="S2.E2.m1.6.7.3.3.2" xref="S2.E2.m1.6.7.3.3.2.cmml">ψ</mi><mrow id="S2.E2.m1.4.4.2.2" xref="S2.E2.m1.4.4.2.3.cmml"><mn id="S2.E2.m1.3.3.1.1" xref="S2.E2.m1.3.3.1.1.cmml">2</mn><mo id="S2.E2.m1.4.4.2.2.2" xref="S2.E2.m1.4.4.2.3.cmml">,</mo><msub id="S2.E2.m1.4.4.2.2.1" xref="S2.E2.m1.4.4.2.2.1.cmml"><mi id="S2.E2.m1.4.4.2.2.1.2" xref="S2.E2.m1.4.4.2.2.1.2.cmml">g</mi><mrow id="S2.E2.m1.4.4.2.2.1.3" xref="S2.E2.m1.4.4.2.2.1.3.cmml"><mi id="S2.E2.m1.4.4.2.2.1.3.2" xref="S2.E2.m1.4.4.2.2.1.3.2.cmml">i</mi><mo id="S2.E2.m1.4.4.2.2.1.3.1" xref="S2.E2.m1.4.4.2.2.1.3.1.cmml">⁢</mo><mn id="S2.E2.m1.4.4.2.2.1.3.3" xref="S2.E2.m1.4.4.2.2.1.3.3.cmml">2</mn></mrow></msub></mrow></msub><mo id="S2.E2.m1.6.7.3.1a" lspace="0.222em" rspace="0.222em" xref="S2.E2.m1.6.7.3.1.cmml">∥</mo><mi id="S2.E2.m1.6.7.3.4" mathvariant="normal" xref="S2.E2.m1.6.7.3.4.cmml">…</mi><mo id="S2.E2.m1.6.7.3.1b" lspace="0.222em" rspace="0.222em" xref="S2.E2.m1.6.7.3.1.cmml">∥</mo><msub id="S2.E2.m1.6.7.3.5" xref="S2.E2.m1.6.7.3.5.cmml"><mi id="S2.E2.m1.6.7.3.5.2" xref="S2.E2.m1.6.7.3.5.2.cmml">ψ</mi><mrow id="S2.E2.m1.6.6.2.2" xref="S2.E2.m1.6.6.2.3.cmml"><mi id="S2.E2.m1.5.5.1.1" xref="S2.E2.m1.5.5.1.1.cmml">m</mi><mo id="S2.E2.m1.6.6.2.2.2" xref="S2.E2.m1.6.6.2.3.cmml">,</mo><msub id="S2.E2.m1.6.6.2.2.1" xref="S2.E2.m1.6.6.2.2.1.cmml"><mi id="S2.E2.m1.6.6.2.2.1.2" xref="S2.E2.m1.6.6.2.2.1.2.cmml">g</mi><mrow id="S2.E2.m1.6.6.2.2.1.3" xref="S2.E2.m1.6.6.2.2.1.3.cmml"><mi id="S2.E2.m1.6.6.2.2.1.3.2" xref="S2.E2.m1.6.6.2.2.1.3.2.cmml">i</mi><mo id="S2.E2.m1.6.6.2.2.1.3.1" xref="S2.E2.m1.6.6.2.2.1.3.1.cmml">⁢</mo><mi id="S2.E2.m1.6.6.2.2.1.3.3" xref="S2.E2.m1.6.6.2.2.1.3.3.cmml">m</mi></mrow></msub></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m1.6b"><apply id="S2.E2.m1.6.7.cmml" xref="S2.E2.m1.6.7"><eq id="S2.E2.m1.6.7.1.cmml" xref="S2.E2.m1.6.7.1"></eq><apply id="S2.E2.m1.6.7.2.cmml" xref="S2.E2.m1.6.7.2"><csymbol cd="ambiguous" id="S2.E2.m1.6.7.2.1.cmml" xref="S2.E2.m1.6.7.2">subscript</csymbol><ci id="S2.E2.m1.6.7.2.2.cmml" xref="S2.E2.m1.6.7.2.2">𝑤</ci><ci id="S2.E2.m1.6.7.2.3.cmml" xref="S2.E2.m1.6.7.2.3">𝑖</ci></apply><apply id="S2.E2.m1.6.7.3.cmml" xref="S2.E2.m1.6.7.3"><ci id="S2.E2.m1.6.7.3.1.cmml" xref="S2.E2.m1.6.7.3.1">∥</ci><apply id="S2.E2.m1.6.7.3.2.cmml" xref="S2.E2.m1.6.7.3.2"><csymbol cd="ambiguous" id="S2.E2.m1.6.7.3.2.1.cmml" xref="S2.E2.m1.6.7.3.2">subscript</csymbol><ci id="S2.E2.m1.6.7.3.2.2.cmml" xref="S2.E2.m1.6.7.3.2.2">𝜓</ci><list id="S2.E2.m1.2.2.2.3.cmml" xref="S2.E2.m1.2.2.2.2"><cn id="S2.E2.m1.1.1.1.1.cmml" type="integer" xref="S2.E2.m1.1.1.1.1">1</cn><apply id="S2.E2.m1.2.2.2.2.1.cmml" xref="S2.E2.m1.2.2.2.2.1"><csymbol cd="ambiguous" id="S2.E2.m1.2.2.2.2.1.1.cmml" xref="S2.E2.m1.2.2.2.2.1">subscript</csymbol><ci id="S2.E2.m1.2.2.2.2.1.2.cmml" xref="S2.E2.m1.2.2.2.2.1.2">𝑔</ci><apply id="S2.E2.m1.2.2.2.2.1.3.cmml" xref="S2.E2.m1.2.2.2.2.1.3"><times id="S2.E2.m1.2.2.2.2.1.3.1.cmml" xref="S2.E2.m1.2.2.2.2.1.3.1"></times><ci id="S2.E2.m1.2.2.2.2.1.3.2.cmml" xref="S2.E2.m1.2.2.2.2.1.3.2">𝑖</ci><cn id="S2.E2.m1.2.2.2.2.1.3.3.cmml" type="integer" xref="S2.E2.m1.2.2.2.2.1.3.3">1</cn></apply></apply></list></apply><apply id="S2.E2.m1.6.7.3.3.cmml" xref="S2.E2.m1.6.7.3.3"><csymbol cd="ambiguous" id="S2.E2.m1.6.7.3.3.1.cmml" xref="S2.E2.m1.6.7.3.3">subscript</csymbol><ci id="S2.E2.m1.6.7.3.3.2.cmml" xref="S2.E2.m1.6.7.3.3.2">𝜓</ci><list id="S2.E2.m1.4.4.2.3.cmml" xref="S2.E2.m1.4.4.2.2"><cn id="S2.E2.m1.3.3.1.1.cmml" type="integer" xref="S2.E2.m1.3.3.1.1">2</cn><apply id="S2.E2.m1.4.4.2.2.1.cmml" xref="S2.E2.m1.4.4.2.2.1"><csymbol cd="ambiguous" id="S2.E2.m1.4.4.2.2.1.1.cmml" xref="S2.E2.m1.4.4.2.2.1">subscript</csymbol><ci id="S2.E2.m1.4.4.2.2.1.2.cmml" xref="S2.E2.m1.4.4.2.2.1.2">𝑔</ci><apply id="S2.E2.m1.4.4.2.2.1.3.cmml" xref="S2.E2.m1.4.4.2.2.1.3"><times id="S2.E2.m1.4.4.2.2.1.3.1.cmml" xref="S2.E2.m1.4.4.2.2.1.3.1"></times><ci id="S2.E2.m1.4.4.2.2.1.3.2.cmml" xref="S2.E2.m1.4.4.2.2.1.3.2">𝑖</ci><cn id="S2.E2.m1.4.4.2.2.1.3.3.cmml" type="integer" xref="S2.E2.m1.4.4.2.2.1.3.3">2</cn></apply></apply></list></apply><ci id="S2.E2.m1.6.7.3.4.cmml" xref="S2.E2.m1.6.7.3.4">…</ci><apply id="S2.E2.m1.6.7.3.5.cmml" xref="S2.E2.m1.6.7.3.5"><csymbol cd="ambiguous" id="S2.E2.m1.6.7.3.5.1.cmml" xref="S2.E2.m1.6.7.3.5">subscript</csymbol><ci id="S2.E2.m1.6.7.3.5.2.cmml" xref="S2.E2.m1.6.7.3.5.2">𝜓</ci><list id="S2.E2.m1.6.6.2.3.cmml" xref="S2.E2.m1.6.6.2.2"><ci id="S2.E2.m1.5.5.1.1.cmml" xref="S2.E2.m1.5.5.1.1">𝑚</ci><apply id="S2.E2.m1.6.6.2.2.1.cmml" xref="S2.E2.m1.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E2.m1.6.6.2.2.1.1.cmml" xref="S2.E2.m1.6.6.2.2.1">subscript</csymbol><ci id="S2.E2.m1.6.6.2.2.1.2.cmml" xref="S2.E2.m1.6.6.2.2.1.2">𝑔</ci><apply id="S2.E2.m1.6.6.2.2.1.3.cmml" xref="S2.E2.m1.6.6.2.2.1.3"><times id="S2.E2.m1.6.6.2.2.1.3.1.cmml" xref="S2.E2.m1.6.6.2.2.1.3.1"></times><ci id="S2.E2.m1.6.6.2.2.1.3.2.cmml" xref="S2.E2.m1.6.6.2.2.1.3.2">𝑖</ci><ci id="S2.E2.m1.6.6.2.2.1.3.3.cmml" xref="S2.E2.m1.6.6.2.2.1.3.3">𝑚</ci></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m1.6c">\displaystyle w_{i}=\psi_{1,g_{i1}}\mathbin{\|}\psi_{2,g_{i2}}\mathbin{\|}...%
\mathbin{\|}\psi_{m,g_{im}}</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.6d">italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_ψ start_POSTSUBSCRIPT 1 , italic_g start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∥ italic_ψ start_POSTSUBSCRIPT 2 , italic_g start_POSTSUBSCRIPT italic_i 2 end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∥ … ∥ italic_ψ start_POSTSUBSCRIPT italic_m , italic_g start_POSTSUBSCRIPT italic_i italic_m end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p4">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p4.2">Finally, an item score is computed as the dot product of the sequence embedding and the constructed item embedding:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx3">
<tbody id="S2.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle r_{i}=w_{i}\cdot\phi" class="ltx_Math" display="inline" id="S2.E3.m1.1"><semantics id="S2.E3.m1.1a"><mrow id="S2.E3.m1.1.1" xref="S2.E3.m1.1.1.cmml"><msub id="S2.E3.m1.1.1.2" xref="S2.E3.m1.1.1.2.cmml"><mi id="S2.E3.m1.1.1.2.2" xref="S2.E3.m1.1.1.2.2.cmml">r</mi><mi id="S2.E3.m1.1.1.2.3" xref="S2.E3.m1.1.1.2.3.cmml">i</mi></msub><mo id="S2.E3.m1.1.1.1" xref="S2.E3.m1.1.1.1.cmml">=</mo><mrow id="S2.E3.m1.1.1.3" xref="S2.E3.m1.1.1.3.cmml"><msub id="S2.E3.m1.1.1.3.2" xref="S2.E3.m1.1.1.3.2.cmml"><mi id="S2.E3.m1.1.1.3.2.2" xref="S2.E3.m1.1.1.3.2.2.cmml">w</mi><mi id="S2.E3.m1.1.1.3.2.3" xref="S2.E3.m1.1.1.3.2.3.cmml">i</mi></msub><mo id="S2.E3.m1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S2.E3.m1.1.1.3.1.cmml">⋅</mo><mi id="S2.E3.m1.1.1.3.3" xref="S2.E3.m1.1.1.3.3.cmml">ϕ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m1.1b"><apply id="S2.E3.m1.1.1.cmml" xref="S2.E3.m1.1.1"><eq id="S2.E3.m1.1.1.1.cmml" xref="S2.E3.m1.1.1.1"></eq><apply id="S2.E3.m1.1.1.2.cmml" xref="S2.E3.m1.1.1.2"><csymbol cd="ambiguous" id="S2.E3.m1.1.1.2.1.cmml" xref="S2.E3.m1.1.1.2">subscript</csymbol><ci id="S2.E3.m1.1.1.2.2.cmml" xref="S2.E3.m1.1.1.2.2">𝑟</ci><ci id="S2.E3.m1.1.1.2.3.cmml" xref="S2.E3.m1.1.1.2.3">𝑖</ci></apply><apply id="S2.E3.m1.1.1.3.cmml" xref="S2.E3.m1.1.1.3"><ci id="S2.E3.m1.1.1.3.1.cmml" xref="S2.E3.m1.1.1.3.1">⋅</ci><apply id="S2.E3.m1.1.1.3.2.cmml" xref="S2.E3.m1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E3.m1.1.1.3.2.1.cmml" xref="S2.E3.m1.1.1.3.2">subscript</csymbol><ci id="S2.E3.m1.1.1.3.2.2.cmml" xref="S2.E3.m1.1.1.3.2.2">𝑤</ci><ci id="S2.E3.m1.1.1.3.2.3.cmml" xref="S2.E3.m1.1.1.3.2.3">𝑖</ci></apply><ci id="S2.E3.m1.1.1.3.3.cmml" xref="S2.E3.m1.1.1.3.3">italic-ϕ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m1.1c">\displaystyle r_{i}=w_{i}\cdot\phi</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m1.1d">italic_r start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ⋅ italic_ϕ</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p4.1">A straightforward use of Equation (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.E3" title="In Sub-Id based recommendation ‣ 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">3</span></a>) for item scoring in PQ-based recommendation models does not lead to any computational efficiency improvements compared to models where all item embeddings are stored explicitly: <span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1">in both cases, the algorithm would need to multiply the sequence embedding <math alttext="w" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p4.1.1.m1.1"><semantics id="S2.SS0.SSS0.Px2.p4.1.1.m1.1a"><mi id="S2.SS0.SSS0.Px2.p4.1.1.m1.1.1" mathcolor="#000000" xref="S2.SS0.SSS0.Px2.p4.1.1.m1.1.1.cmml">w</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p4.1.1.m1.1b"><ci id="S2.SS0.SSS0.Px2.p4.1.1.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p4.1.1.m1.1.1">𝑤</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p4.1.1.m1.1c">w</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p4.1.1.m1.1d">italic_w</annotation></semantics></math> by the (reconstructed) embeddings of all items.<span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1">
However, <span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1">the sub-id representations of<span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1.1"> PQ <span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1.1.1">allow<span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1.1.1.1"> a more efficient scoring algorithm, <span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1.1.1.1.1">which we describe next<span class="ltx_text" id="S2.SS0.SSS0.Px2.p4.1.1.1.1.1.1.1.1.1">.</span></span></span></span></span></span></span></span></p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>PQTopK Algorithm</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1"><span class="ltx_text" id="S3.p1.1.1">PQTopK is a scoring algorithm for PQ-based models <span class="ltx_text" id="S3.p1.1.1.1">that uses pre-computation of sub-id scores for improved inference efficiency<span class="ltx_text" id="S3.p1.1.1.1.1">. While versions of this algorithm have previously been described, for example, for a different recommendation scenario <cite class="ltx_cite ltx_citemacro_citep">(Lian et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib12" title="">2020</a>)</cite> and for document retrieval <cite class="ltx_cite ltx_citemacro_citep">(Zhan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib23" title="">2021</a>)</cite>, to the best of our knowledge, it has not been previously applied for sequential recommendation nor Transformer-based models.<span class="ltx_text" id="S3.p1.1.1.1.1.1"></span></span></span></span></p>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p" id="S3.p2.8">PQTopK first splits the sequence embedding <math alttext="\phi\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.p2.1.m1.1"><semantics id="S3.p2.1.m1.1a"><mrow id="S3.p2.1.m1.1.1" xref="S3.p2.1.m1.1.1.cmml"><mi id="S3.p2.1.m1.1.1.2" mathcolor="#000000" xref="S3.p2.1.m1.1.1.2.cmml">ϕ</mi><mo id="S3.p2.1.m1.1.1.1" mathcolor="#000000" xref="S3.p2.1.m1.1.1.1.cmml">∈</mo><msup id="S3.p2.1.m1.1.1.3" xref="S3.p2.1.m1.1.1.3.cmml"><mi id="S3.p2.1.m1.1.1.3.2" mathcolor="#000000" xref="S3.p2.1.m1.1.1.3.2.cmml">ℝ</mi><mi id="S3.p2.1.m1.1.1.3.3" mathcolor="#000000" xref="S3.p2.1.m1.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.1b"><apply id="S3.p2.1.m1.1.1.cmml" xref="S3.p2.1.m1.1.1"><in id="S3.p2.1.m1.1.1.1.cmml" xref="S3.p2.1.m1.1.1.1"></in><ci id="S3.p2.1.m1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.2">italic-ϕ</ci><apply id="S3.p2.1.m1.1.1.3.cmml" xref="S3.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.p2.1.m1.1.1.3.1.cmml" xref="S3.p2.1.m1.1.1.3">superscript</csymbol><ci id="S3.p2.1.m1.1.1.3.2.cmml" xref="S3.p2.1.m1.1.1.3.2">ℝ</ci><ci id="S3.p2.1.m1.1.1.3.3.cmml" xref="S3.p2.1.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.1c">\phi\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.1.m1.1d">italic_ϕ ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> <span class="ltx_text" id="S3.p2.8.7">obtained from a Transformer model<span class="ltx_text" id="S3.p2.8.7.7"> into <math alttext="m" class="ltx_Math" display="inline" id="S3.p2.2.1.1.m1.1"><semantics id="S3.p2.2.1.1.m1.1a"><mi id="S3.p2.2.1.1.m1.1.1" mathcolor="#000000" xref="S3.p2.2.1.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.p2.2.1.1.m1.1b"><ci id="S3.p2.2.1.1.m1.1.1.cmml" xref="S3.p2.2.1.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.2.1.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.p2.2.1.1.m1.1d">italic_m</annotation></semantics></math> sub-embeddings <math alttext="\left\{\phi_{1},\phi_{2}...\phi_{m}\right\}" class="ltx_Math" display="inline" id="S3.p2.3.2.2.m2.2"><semantics id="S3.p2.3.2.2.m2.2a"><mrow id="S3.p2.3.2.2.m2.2.2.2" xref="S3.p2.3.2.2.m2.2.2.3.cmml"><mo id="S3.p2.3.2.2.m2.2.2.2.3" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.3.cmml">{</mo><msub id="S3.p2.3.2.2.m2.1.1.1.1" xref="S3.p2.3.2.2.m2.1.1.1.1.cmml"><mi id="S3.p2.3.2.2.m2.1.1.1.1.2" mathcolor="#000000" xref="S3.p2.3.2.2.m2.1.1.1.1.2.cmml">ϕ</mi><mn id="S3.p2.3.2.2.m2.1.1.1.1.3" mathcolor="#000000" xref="S3.p2.3.2.2.m2.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.p2.3.2.2.m2.2.2.2.4" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.3.cmml">,</mo><mrow id="S3.p2.3.2.2.m2.2.2.2.2" xref="S3.p2.3.2.2.m2.2.2.2.2.cmml"><msub id="S3.p2.3.2.2.m2.2.2.2.2.2" xref="S3.p2.3.2.2.m2.2.2.2.2.2.cmml"><mi id="S3.p2.3.2.2.m2.2.2.2.2.2.2" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.2.2.2.2.cmml">ϕ</mi><mn id="S3.p2.3.2.2.m2.2.2.2.2.2.3" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.2.2.2.3.cmml">2</mn></msub><mo id="S3.p2.3.2.2.m2.2.2.2.2.1" xref="S3.p2.3.2.2.m2.2.2.2.2.1.cmml">⁢</mo><mi id="S3.p2.3.2.2.m2.2.2.2.2.3" mathcolor="#000000" mathvariant="normal" xref="S3.p2.3.2.2.m2.2.2.2.2.3.cmml">…</mi><mo id="S3.p2.3.2.2.m2.2.2.2.2.1a" xref="S3.p2.3.2.2.m2.2.2.2.2.1.cmml">⁢</mo><msub id="S3.p2.3.2.2.m2.2.2.2.2.4" xref="S3.p2.3.2.2.m2.2.2.2.2.4.cmml"><mi id="S3.p2.3.2.2.m2.2.2.2.2.4.2" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.2.2.4.2.cmml">ϕ</mi><mi id="S3.p2.3.2.2.m2.2.2.2.2.4.3" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.2.2.4.3.cmml">m</mi></msub></mrow><mo id="S3.p2.3.2.2.m2.2.2.2.5" mathcolor="#000000" xref="S3.p2.3.2.2.m2.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.3.2.2.m2.2b"><set id="S3.p2.3.2.2.m2.2.2.3.cmml" xref="S3.p2.3.2.2.m2.2.2.2"><apply id="S3.p2.3.2.2.m2.1.1.1.1.cmml" xref="S3.p2.3.2.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S3.p2.3.2.2.m2.1.1.1.1.1.cmml" xref="S3.p2.3.2.2.m2.1.1.1.1">subscript</csymbol><ci id="S3.p2.3.2.2.m2.1.1.1.1.2.cmml" xref="S3.p2.3.2.2.m2.1.1.1.1.2">italic-ϕ</ci><cn id="S3.p2.3.2.2.m2.1.1.1.1.3.cmml" type="integer" xref="S3.p2.3.2.2.m2.1.1.1.1.3">1</cn></apply><apply id="S3.p2.3.2.2.m2.2.2.2.2.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2"><times id="S3.p2.3.2.2.m2.2.2.2.2.1.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.1"></times><apply id="S3.p2.3.2.2.m2.2.2.2.2.2.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p2.3.2.2.m2.2.2.2.2.2.1.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.2">subscript</csymbol><ci id="S3.p2.3.2.2.m2.2.2.2.2.2.2.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.2.2">italic-ϕ</ci><cn id="S3.p2.3.2.2.m2.2.2.2.2.2.3.cmml" type="integer" xref="S3.p2.3.2.2.m2.2.2.2.2.2.3">2</cn></apply><ci id="S3.p2.3.2.2.m2.2.2.2.2.3.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.3">…</ci><apply id="S3.p2.3.2.2.m2.2.2.2.2.4.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.4"><csymbol cd="ambiguous" id="S3.p2.3.2.2.m2.2.2.2.2.4.1.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.4">subscript</csymbol><ci id="S3.p2.3.2.2.m2.2.2.2.2.4.2.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.4.2">italic-ϕ</ci><ci id="S3.p2.3.2.2.m2.2.2.2.2.4.3.cmml" xref="S3.p2.3.2.2.m2.2.2.2.2.4.3">𝑚</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.3.2.2.m2.2c">\left\{\phi_{1},\phi_{2}...\phi_{m}\right\}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.3.2.2.m2.2d">{ italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT … italic_ϕ start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT }</annotation></semantics></math>, with <math alttext="\phi_{k}\in\mathbb{R}^{\frac{d}{m}}" class="ltx_Math" display="inline" id="S3.p2.4.3.3.m3.1"><semantics id="S3.p2.4.3.3.m3.1a"><mrow id="S3.p2.4.3.3.m3.1.1" xref="S3.p2.4.3.3.m3.1.1.cmml"><msub id="S3.p2.4.3.3.m3.1.1.2" xref="S3.p2.4.3.3.m3.1.1.2.cmml"><mi id="S3.p2.4.3.3.m3.1.1.2.2" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.2.2.cmml">ϕ</mi><mi id="S3.p2.4.3.3.m3.1.1.2.3" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.2.3.cmml">k</mi></msub><mo id="S3.p2.4.3.3.m3.1.1.1" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.1.cmml">∈</mo><msup id="S3.p2.4.3.3.m3.1.1.3" xref="S3.p2.4.3.3.m3.1.1.3.cmml"><mi id="S3.p2.4.3.3.m3.1.1.3.2" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.3.2.cmml">ℝ</mi><mfrac id="S3.p2.4.3.3.m3.1.1.3.3" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.3.3.cmml"><mi id="S3.p2.4.3.3.m3.1.1.3.3.2" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.3.3.2.cmml">d</mi><mi id="S3.p2.4.3.3.m3.1.1.3.3.3" mathcolor="#000000" xref="S3.p2.4.3.3.m3.1.1.3.3.3.cmml">m</mi></mfrac></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.4.3.3.m3.1b"><apply id="S3.p2.4.3.3.m3.1.1.cmml" xref="S3.p2.4.3.3.m3.1.1"><in id="S3.p2.4.3.3.m3.1.1.1.cmml" xref="S3.p2.4.3.3.m3.1.1.1"></in><apply id="S3.p2.4.3.3.m3.1.1.2.cmml" xref="S3.p2.4.3.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.p2.4.3.3.m3.1.1.2.1.cmml" xref="S3.p2.4.3.3.m3.1.1.2">subscript</csymbol><ci id="S3.p2.4.3.3.m3.1.1.2.2.cmml" xref="S3.p2.4.3.3.m3.1.1.2.2">italic-ϕ</ci><ci id="S3.p2.4.3.3.m3.1.1.2.3.cmml" xref="S3.p2.4.3.3.m3.1.1.2.3">𝑘</ci></apply><apply id="S3.p2.4.3.3.m3.1.1.3.cmml" xref="S3.p2.4.3.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.p2.4.3.3.m3.1.1.3.1.cmml" xref="S3.p2.4.3.3.m3.1.1.3">superscript</csymbol><ci id="S3.p2.4.3.3.m3.1.1.3.2.cmml" xref="S3.p2.4.3.3.m3.1.1.3.2">ℝ</ci><apply id="S3.p2.4.3.3.m3.1.1.3.3.cmml" xref="S3.p2.4.3.3.m3.1.1.3.3"><divide id="S3.p2.4.3.3.m3.1.1.3.3.1.cmml" xref="S3.p2.4.3.3.m3.1.1.3.3"></divide><ci id="S3.p2.4.3.3.m3.1.1.3.3.2.cmml" xref="S3.p2.4.3.3.m3.1.1.3.3.2">𝑑</ci><ci id="S3.p2.4.3.3.m3.1.1.3.3.3.cmml" xref="S3.p2.4.3.3.m3.1.1.3.3.3">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.4.3.3.m3.1c">\phi_{k}\in\mathbb{R}^{\frac{d}{m}}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.4.3.3.m3.1d">italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT divide start_ARG italic_d end_ARG start_ARG italic_m end_ARG end_POSTSUPERSCRIPT</annotation></semantics></math> for <math alttext="k=1,\ldots,m" class="ltx_Math" display="inline" id="S3.p2.5.4.4.m4.3"><semantics id="S3.p2.5.4.4.m4.3a"><mrow id="S3.p2.5.4.4.m4.3.4" xref="S3.p2.5.4.4.m4.3.4.cmml"><mi id="S3.p2.5.4.4.m4.3.4.2" mathcolor="#000000" xref="S3.p2.5.4.4.m4.3.4.2.cmml">k</mi><mo id="S3.p2.5.4.4.m4.3.4.1" mathcolor="#000000" xref="S3.p2.5.4.4.m4.3.4.1.cmml">=</mo><mrow id="S3.p2.5.4.4.m4.3.4.3.2" xref="S3.p2.5.4.4.m4.3.4.3.1.cmml"><mn id="S3.p2.5.4.4.m4.1.1" mathcolor="#000000" xref="S3.p2.5.4.4.m4.1.1.cmml">1</mn><mo id="S3.p2.5.4.4.m4.3.4.3.2.1" mathcolor="#000000" xref="S3.p2.5.4.4.m4.3.4.3.1.cmml">,</mo><mi id="S3.p2.5.4.4.m4.2.2" mathcolor="#000000" mathvariant="normal" xref="S3.p2.5.4.4.m4.2.2.cmml">…</mi><mo id="S3.p2.5.4.4.m4.3.4.3.2.2" mathcolor="#000000" xref="S3.p2.5.4.4.m4.3.4.3.1.cmml">,</mo><mi id="S3.p2.5.4.4.m4.3.3" mathcolor="#000000" xref="S3.p2.5.4.4.m4.3.3.cmml">m</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.5.4.4.m4.3b"><apply id="S3.p2.5.4.4.m4.3.4.cmml" xref="S3.p2.5.4.4.m4.3.4"><eq id="S3.p2.5.4.4.m4.3.4.1.cmml" xref="S3.p2.5.4.4.m4.3.4.1"></eq><ci id="S3.p2.5.4.4.m4.3.4.2.cmml" xref="S3.p2.5.4.4.m4.3.4.2">𝑘</ci><list id="S3.p2.5.4.4.m4.3.4.3.1.cmml" xref="S3.p2.5.4.4.m4.3.4.3.2"><cn id="S3.p2.5.4.4.m4.1.1.cmml" type="integer" xref="S3.p2.5.4.4.m4.1.1">1</cn><ci id="S3.p2.5.4.4.m4.2.2.cmml" xref="S3.p2.5.4.4.m4.2.2">…</ci><ci id="S3.p2.5.4.4.m4.3.3.cmml" xref="S3.p2.5.4.4.m4.3.3">𝑚</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.5.4.4.m4.3c">k=1,\ldots,m</annotation><annotation encoding="application/x-llamapun" id="S3.p2.5.4.4.m4.3d">italic_k = 1 , … , italic_m</annotation></semantics></math>, such that <math alttext="\phi=\phi_{1}\mathbin{\|}\phi_{2}\mathbin{\|}...\mathbin{\|}\phi_{m}" class="ltx_Math" display="inline" id="S3.p2.6.5.5.m5.1"><semantics id="S3.p2.6.5.5.m5.1a"><mrow id="S3.p2.6.5.5.m5.1.1" xref="S3.p2.6.5.5.m5.1.1.cmml"><mi id="S3.p2.6.5.5.m5.1.1.2" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.2.cmml">ϕ</mi><mo id="S3.p2.6.5.5.m5.1.1.1" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.1.cmml">=</mo><mrow id="S3.p2.6.5.5.m5.1.1.3" xref="S3.p2.6.5.5.m5.1.1.3.cmml"><msub id="S3.p2.6.5.5.m5.1.1.3.2" xref="S3.p2.6.5.5.m5.1.1.3.2.cmml"><mi id="S3.p2.6.5.5.m5.1.1.3.2.2" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.2.2.cmml">ϕ</mi><mn id="S3.p2.6.5.5.m5.1.1.3.2.3" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.2.3.cmml">1</mn></msub><mo id="S3.p2.6.5.5.m5.1.1.3.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.p2.6.5.5.m5.1.1.3.1.cmml">∥</mo><msub id="S3.p2.6.5.5.m5.1.1.3.3" xref="S3.p2.6.5.5.m5.1.1.3.3.cmml"><mi id="S3.p2.6.5.5.m5.1.1.3.3.2" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.3.2.cmml">ϕ</mi><mn id="S3.p2.6.5.5.m5.1.1.3.3.3" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.3.3.cmml">2</mn></msub><mo id="S3.p2.6.5.5.m5.1.1.3.1a" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.p2.6.5.5.m5.1.1.3.1.cmml">∥</mo><mi id="S3.p2.6.5.5.m5.1.1.3.4" mathcolor="#000000" mathvariant="normal" xref="S3.p2.6.5.5.m5.1.1.3.4.cmml">…</mi><mo id="S3.p2.6.5.5.m5.1.1.3.1b" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.p2.6.5.5.m5.1.1.3.1.cmml">∥</mo><msub id="S3.p2.6.5.5.m5.1.1.3.5" xref="S3.p2.6.5.5.m5.1.1.3.5.cmml"><mi id="S3.p2.6.5.5.m5.1.1.3.5.2" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.5.2.cmml">ϕ</mi><mi id="S3.p2.6.5.5.m5.1.1.3.5.3" mathcolor="#000000" xref="S3.p2.6.5.5.m5.1.1.3.5.3.cmml">m</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.6.5.5.m5.1b"><apply id="S3.p2.6.5.5.m5.1.1.cmml" xref="S3.p2.6.5.5.m5.1.1"><eq id="S3.p2.6.5.5.m5.1.1.1.cmml" xref="S3.p2.6.5.5.m5.1.1.1"></eq><ci id="S3.p2.6.5.5.m5.1.1.2.cmml" xref="S3.p2.6.5.5.m5.1.1.2">italic-ϕ</ci><apply id="S3.p2.6.5.5.m5.1.1.3.cmml" xref="S3.p2.6.5.5.m5.1.1.3"><ci id="S3.p2.6.5.5.m5.1.1.3.1.cmml" xref="S3.p2.6.5.5.m5.1.1.3.1">∥</ci><apply id="S3.p2.6.5.5.m5.1.1.3.2.cmml" xref="S3.p2.6.5.5.m5.1.1.3.2"><csymbol cd="ambiguous" id="S3.p2.6.5.5.m5.1.1.3.2.1.cmml" xref="S3.p2.6.5.5.m5.1.1.3.2">subscript</csymbol><ci id="S3.p2.6.5.5.m5.1.1.3.2.2.cmml" xref="S3.p2.6.5.5.m5.1.1.3.2.2">italic-ϕ</ci><cn id="S3.p2.6.5.5.m5.1.1.3.2.3.cmml" type="integer" xref="S3.p2.6.5.5.m5.1.1.3.2.3">1</cn></apply><apply id="S3.p2.6.5.5.m5.1.1.3.3.cmml" xref="S3.p2.6.5.5.m5.1.1.3.3"><csymbol cd="ambiguous" id="S3.p2.6.5.5.m5.1.1.3.3.1.cmml" xref="S3.p2.6.5.5.m5.1.1.3.3">subscript</csymbol><ci id="S3.p2.6.5.5.m5.1.1.3.3.2.cmml" xref="S3.p2.6.5.5.m5.1.1.3.3.2">italic-ϕ</ci><cn id="S3.p2.6.5.5.m5.1.1.3.3.3.cmml" type="integer" xref="S3.p2.6.5.5.m5.1.1.3.3.3">2</cn></apply><ci id="S3.p2.6.5.5.m5.1.1.3.4.cmml" xref="S3.p2.6.5.5.m5.1.1.3.4">…</ci><apply id="S3.p2.6.5.5.m5.1.1.3.5.cmml" xref="S3.p2.6.5.5.m5.1.1.3.5"><csymbol cd="ambiguous" id="S3.p2.6.5.5.m5.1.1.3.5.1.cmml" xref="S3.p2.6.5.5.m5.1.1.3.5">subscript</csymbol><ci id="S3.p2.6.5.5.m5.1.1.3.5.2.cmml" xref="S3.p2.6.5.5.m5.1.1.3.5.2">italic-ϕ</ci><ci id="S3.p2.6.5.5.m5.1.1.3.5.3.cmml" xref="S3.p2.6.5.5.m5.1.1.3.5.3">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.6.5.5.m5.1c">\phi=\phi_{1}\mathbin{\|}\phi_{2}\mathbin{\|}...\mathbin{\|}\phi_{m}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.6.5.5.m5.1d">italic_ϕ = italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∥ italic_ϕ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∥ … ∥ italic_ϕ start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math>.
By substituting Equation (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.E2" title="In Sub-Id based recommendation ‣ 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a>) and the similarly decomposed sequence embedding <math alttext="\phi" class="ltx_Math" display="inline" id="S3.p2.7.6.6.m6.1"><semantics id="S3.p2.7.6.6.m6.1a"><mi id="S3.p2.7.6.6.m6.1.1" xref="S3.p2.7.6.6.m6.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.p2.7.6.6.m6.1b"><ci id="S3.p2.7.6.6.m6.1.1.cmml" xref="S3.p2.7.6.6.m6.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.7.6.6.m6.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.p2.7.6.6.m6.1d">italic_ϕ</annotation></semantics></math> into Equation (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.E3" title="In Sub-Id based recommendation ‣ 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">3</span></a>), the final item score for item <math alttext="i" class="ltx_Math" display="inline" id="S3.p2.8.7.7.m7.1"><semantics id="S3.p2.8.7.7.m7.1a"><mi id="S3.p2.8.7.7.m7.1.1" mathcolor="#000000" xref="S3.p2.8.7.7.m7.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.p2.8.7.7.m7.1b"><ci id="S3.p2.8.7.7.m7.1.1.cmml" xref="S3.p2.8.7.7.m7.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.8.7.7.m7.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.p2.8.7.7.m7.1d">italic_i</annotation></semantics></math> is obtained as the sum of sub-embedding dot-products:</span></span></p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx4">
<tbody id="S3.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle r_{i}=w_{i}\cdot\phi" class="ltx_Math" display="inline" id="S3.Ex1.m1.1"><semantics id="S3.Ex1.m1.1a"><mrow id="S3.Ex1.m1.1.1" xref="S3.Ex1.m1.1.1.cmml"><msub id="S3.Ex1.m1.1.1.2" xref="S3.Ex1.m1.1.1.2.cmml"><mi id="S3.Ex1.m1.1.1.2.2" xref="S3.Ex1.m1.1.1.2.2.cmml">r</mi><mi id="S3.Ex1.m1.1.1.2.3" xref="S3.Ex1.m1.1.1.2.3.cmml">i</mi></msub><mo id="S3.Ex1.m1.1.1.1" xref="S3.Ex1.m1.1.1.1.cmml">=</mo><mrow id="S3.Ex1.m1.1.1.3" xref="S3.Ex1.m1.1.1.3.cmml"><msub id="S3.Ex1.m1.1.1.3.2" xref="S3.Ex1.m1.1.1.3.2.cmml"><mi id="S3.Ex1.m1.1.1.3.2.2" xref="S3.Ex1.m1.1.1.3.2.2.cmml">w</mi><mi id="S3.Ex1.m1.1.1.3.2.3" xref="S3.Ex1.m1.1.1.3.2.3.cmml">i</mi></msub><mo id="S3.Ex1.m1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex1.m1.1.1.3.1.cmml">⋅</mo><mi id="S3.Ex1.m1.1.1.3.3" xref="S3.Ex1.m1.1.1.3.3.cmml">ϕ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.1b"><apply id="S3.Ex1.m1.1.1.cmml" xref="S3.Ex1.m1.1.1"><eq id="S3.Ex1.m1.1.1.1.cmml" xref="S3.Ex1.m1.1.1.1"></eq><apply id="S3.Ex1.m1.1.1.2.cmml" xref="S3.Ex1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.1.1.2.1.cmml" xref="S3.Ex1.m1.1.1.2">subscript</csymbol><ci id="S3.Ex1.m1.1.1.2.2.cmml" xref="S3.Ex1.m1.1.1.2.2">𝑟</ci><ci id="S3.Ex1.m1.1.1.2.3.cmml" xref="S3.Ex1.m1.1.1.2.3">𝑖</ci></apply><apply id="S3.Ex1.m1.1.1.3.cmml" xref="S3.Ex1.m1.1.1.3"><ci id="S3.Ex1.m1.1.1.3.1.cmml" xref="S3.Ex1.m1.1.1.3.1">⋅</ci><apply id="S3.Ex1.m1.1.1.3.2.cmml" xref="S3.Ex1.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.1.1.3.2.1.cmml" xref="S3.Ex1.m1.1.1.3.2">subscript</csymbol><ci id="S3.Ex1.m1.1.1.3.2.2.cmml" xref="S3.Ex1.m1.1.1.3.2.2">𝑤</ci><ci id="S3.Ex1.m1.1.1.3.2.3.cmml" xref="S3.Ex1.m1.1.1.3.2.3">𝑖</ci></apply><ci id="S3.Ex1.m1.1.1.3.3.cmml" xref="S3.Ex1.m1.1.1.3.3">italic-ϕ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.1c">\displaystyle r_{i}=w_{i}\cdot\phi</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m1.1d">italic_r start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ⋅ italic_ϕ</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(\psi_{1,g_{i1}}\mathbin{\|}...\mathbin{\|}\psi_{m,g_{im}})\cdot%
(\phi_{1}\mathbin{\|}...\mathbin{\|}\phi_{m})=\sum_{k=1}^{m}\psi_{k,g_{ik}}%
\cdot\phi_{k}" class="ltx_Math" display="inline" id="S3.Ex1.m2.8"><semantics id="S3.Ex1.m2.8a"><mrow id="S3.Ex1.m2.8.8" xref="S3.Ex1.m2.8.8.cmml"><mi id="S3.Ex1.m2.8.8.4" xref="S3.Ex1.m2.8.8.4.cmml"></mi><mo id="S3.Ex1.m2.8.8.5" mathcolor="#000000" xref="S3.Ex1.m2.8.8.5.cmml">=</mo><mrow id="S3.Ex1.m2.8.8.2" xref="S3.Ex1.m2.8.8.2.cmml"><mrow id="S3.Ex1.m2.7.7.1.1.1" xref="S3.Ex1.m2.7.7.1.1.1.1.cmml"><mo id="S3.Ex1.m2.7.7.1.1.1.2" mathcolor="#000000" stretchy="false" xref="S3.Ex1.m2.7.7.1.1.1.1.cmml">(</mo><mrow id="S3.Ex1.m2.7.7.1.1.1.1" xref="S3.Ex1.m2.7.7.1.1.1.1.cmml"><msub id="S3.Ex1.m2.7.7.1.1.1.1.2" xref="S3.Ex1.m2.7.7.1.1.1.1.2.cmml"><mi id="S3.Ex1.m2.7.7.1.1.1.1.2.2" mathcolor="#000000" xref="S3.Ex1.m2.7.7.1.1.1.1.2.2.cmml">ψ</mi><mrow id="S3.Ex1.m2.2.2.2.2" xref="S3.Ex1.m2.2.2.2.3.cmml"><mn id="S3.Ex1.m2.1.1.1.1" mathcolor="#000000" xref="S3.Ex1.m2.1.1.1.1.cmml">1</mn><mo id="S3.Ex1.m2.2.2.2.2.2" mathcolor="#000000" xref="S3.Ex1.m2.2.2.2.3.cmml">,</mo><msub id="S3.Ex1.m2.2.2.2.2.1" xref="S3.Ex1.m2.2.2.2.2.1.cmml"><mi id="S3.Ex1.m2.2.2.2.2.1.2" mathcolor="#000000" xref="S3.Ex1.m2.2.2.2.2.1.2.cmml">g</mi><mrow id="S3.Ex1.m2.2.2.2.2.1.3" xref="S3.Ex1.m2.2.2.2.2.1.3.cmml"><mi id="S3.Ex1.m2.2.2.2.2.1.3.2" mathcolor="#000000" xref="S3.Ex1.m2.2.2.2.2.1.3.2.cmml">i</mi><mo id="S3.Ex1.m2.2.2.2.2.1.3.1" xref="S3.Ex1.m2.2.2.2.2.1.3.1.cmml">⁢</mo><mn id="S3.Ex1.m2.2.2.2.2.1.3.3" mathcolor="#000000" xref="S3.Ex1.m2.2.2.2.2.1.3.3.cmml">1</mn></mrow></msub></mrow></msub><mo id="S3.Ex1.m2.7.7.1.1.1.1.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.7.7.1.1.1.1.1.cmml">∥</mo><mi id="S3.Ex1.m2.7.7.1.1.1.1.3" mathcolor="#000000" mathvariant="normal" xref="S3.Ex1.m2.7.7.1.1.1.1.3.cmml">…</mi><mo id="S3.Ex1.m2.7.7.1.1.1.1.1a" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.7.7.1.1.1.1.1.cmml">∥</mo><msub id="S3.Ex1.m2.7.7.1.1.1.1.4" xref="S3.Ex1.m2.7.7.1.1.1.1.4.cmml"><mi id="S3.Ex1.m2.7.7.1.1.1.1.4.2" mathcolor="#000000" xref="S3.Ex1.m2.7.7.1.1.1.1.4.2.cmml">ψ</mi><mrow id="S3.Ex1.m2.4.4.2.2" xref="S3.Ex1.m2.4.4.2.3.cmml"><mi id="S3.Ex1.m2.3.3.1.1" mathcolor="#000000" xref="S3.Ex1.m2.3.3.1.1.cmml">m</mi><mo id="S3.Ex1.m2.4.4.2.2.2" mathcolor="#000000" xref="S3.Ex1.m2.4.4.2.3.cmml">,</mo><msub id="S3.Ex1.m2.4.4.2.2.1" xref="S3.Ex1.m2.4.4.2.2.1.cmml"><mi id="S3.Ex1.m2.4.4.2.2.1.2" mathcolor="#000000" xref="S3.Ex1.m2.4.4.2.2.1.2.cmml">g</mi><mrow id="S3.Ex1.m2.4.4.2.2.1.3" xref="S3.Ex1.m2.4.4.2.2.1.3.cmml"><mi id="S3.Ex1.m2.4.4.2.2.1.3.2" mathcolor="#000000" xref="S3.Ex1.m2.4.4.2.2.1.3.2.cmml">i</mi><mo id="S3.Ex1.m2.4.4.2.2.1.3.1" xref="S3.Ex1.m2.4.4.2.2.1.3.1.cmml">⁢</mo><mi id="S3.Ex1.m2.4.4.2.2.1.3.3" mathcolor="#000000" xref="S3.Ex1.m2.4.4.2.2.1.3.3.cmml">m</mi></mrow></msub></mrow></msub></mrow><mo id="S3.Ex1.m2.7.7.1.1.1.3" mathcolor="#000000" rspace="0.055em" stretchy="false" xref="S3.Ex1.m2.7.7.1.1.1.1.cmml">)</mo></mrow><mo id="S3.Ex1.m2.8.8.2.3" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.8.8.2.3.cmml">⋅</mo><mrow id="S3.Ex1.m2.8.8.2.2.1" xref="S3.Ex1.m2.8.8.2.2.1.1.cmml"><mo id="S3.Ex1.m2.8.8.2.2.1.2" mathcolor="#000000" stretchy="false" xref="S3.Ex1.m2.8.8.2.2.1.1.cmml">(</mo><mrow id="S3.Ex1.m2.8.8.2.2.1.1" xref="S3.Ex1.m2.8.8.2.2.1.1.cmml"><msub id="S3.Ex1.m2.8.8.2.2.1.1.2" xref="S3.Ex1.m2.8.8.2.2.1.1.2.cmml"><mi id="S3.Ex1.m2.8.8.2.2.1.1.2.2" mathcolor="#000000" xref="S3.Ex1.m2.8.8.2.2.1.1.2.2.cmml">ϕ</mi><mn id="S3.Ex1.m2.8.8.2.2.1.1.2.3" mathcolor="#000000" xref="S3.Ex1.m2.8.8.2.2.1.1.2.3.cmml">1</mn></msub><mo id="S3.Ex1.m2.8.8.2.2.1.1.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.8.8.2.2.1.1.1.cmml">∥</mo><mi id="S3.Ex1.m2.8.8.2.2.1.1.3" mathcolor="#000000" mathvariant="normal" xref="S3.Ex1.m2.8.8.2.2.1.1.3.cmml">…</mi><mo id="S3.Ex1.m2.8.8.2.2.1.1.1a" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.8.8.2.2.1.1.1.cmml">∥</mo><msub id="S3.Ex1.m2.8.8.2.2.1.1.4" xref="S3.Ex1.m2.8.8.2.2.1.1.4.cmml"><mi id="S3.Ex1.m2.8.8.2.2.1.1.4.2" mathcolor="#000000" xref="S3.Ex1.m2.8.8.2.2.1.1.4.2.cmml">ϕ</mi><mi id="S3.Ex1.m2.8.8.2.2.1.1.4.3" mathcolor="#000000" xref="S3.Ex1.m2.8.8.2.2.1.1.4.3.cmml">m</mi></msub></mrow><mo id="S3.Ex1.m2.8.8.2.2.1.3" mathcolor="#000000" stretchy="false" xref="S3.Ex1.m2.8.8.2.2.1.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex1.m2.8.8.6" mathcolor="#000000" xref="S3.Ex1.m2.8.8.6.cmml">=</mo><mrow id="S3.Ex1.m2.8.8.7" xref="S3.Ex1.m2.8.8.7.cmml"><mstyle displaystyle="true" id="S3.Ex1.m2.8.8.7.1" xref="S3.Ex1.m2.8.8.7.1.cmml"><munderover id="S3.Ex1.m2.8.8.7.1a" xref="S3.Ex1.m2.8.8.7.1.cmml"><mo id="S3.Ex1.m2.8.8.7.1.2.2" mathcolor="#000000" movablelimits="false" xref="S3.Ex1.m2.8.8.7.1.2.2.cmml">∑</mo><mrow id="S3.Ex1.m2.8.8.7.1.2.3" xref="S3.Ex1.m2.8.8.7.1.2.3.cmml"><mi id="S3.Ex1.m2.8.8.7.1.2.3.2" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.1.2.3.2.cmml">k</mi><mo id="S3.Ex1.m2.8.8.7.1.2.3.1" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.1.2.3.1.cmml">=</mo><mn id="S3.Ex1.m2.8.8.7.1.2.3.3" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.1.2.3.3.cmml">1</mn></mrow><mi id="S3.Ex1.m2.8.8.7.1.3" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.1.3.cmml">m</mi></munderover></mstyle><mrow id="S3.Ex1.m2.8.8.7.2" xref="S3.Ex1.m2.8.8.7.2.cmml"><msub id="S3.Ex1.m2.8.8.7.2.2" xref="S3.Ex1.m2.8.8.7.2.2.cmml"><mi id="S3.Ex1.m2.8.8.7.2.2.2" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.2.2.2.cmml">ψ</mi><mrow id="S3.Ex1.m2.6.6.2.2" xref="S3.Ex1.m2.6.6.2.3.cmml"><mi id="S3.Ex1.m2.5.5.1.1" mathcolor="#000000" xref="S3.Ex1.m2.5.5.1.1.cmml">k</mi><mo id="S3.Ex1.m2.6.6.2.2.2" mathcolor="#000000" xref="S3.Ex1.m2.6.6.2.3.cmml">,</mo><msub id="S3.Ex1.m2.6.6.2.2.1" xref="S3.Ex1.m2.6.6.2.2.1.cmml"><mi id="S3.Ex1.m2.6.6.2.2.1.2" mathcolor="#000000" xref="S3.Ex1.m2.6.6.2.2.1.2.cmml">g</mi><mrow id="S3.Ex1.m2.6.6.2.2.1.3" xref="S3.Ex1.m2.6.6.2.2.1.3.cmml"><mi id="S3.Ex1.m2.6.6.2.2.1.3.2" mathcolor="#000000" xref="S3.Ex1.m2.6.6.2.2.1.3.2.cmml">i</mi><mo id="S3.Ex1.m2.6.6.2.2.1.3.1" xref="S3.Ex1.m2.6.6.2.2.1.3.1.cmml">⁢</mo><mi id="S3.Ex1.m2.6.6.2.2.1.3.3" mathcolor="#000000" xref="S3.Ex1.m2.6.6.2.2.1.3.3.cmml">k</mi></mrow></msub></mrow></msub><mo id="S3.Ex1.m2.8.8.7.2.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.Ex1.m2.8.8.7.2.1.cmml">⋅</mo><msub id="S3.Ex1.m2.8.8.7.2.3" xref="S3.Ex1.m2.8.8.7.2.3.cmml"><mi id="S3.Ex1.m2.8.8.7.2.3.2" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.2.3.2.cmml">ϕ</mi><mi id="S3.Ex1.m2.8.8.7.2.3.3" mathcolor="#000000" xref="S3.Ex1.m2.8.8.7.2.3.3.cmml">k</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m2.8b"><apply id="S3.Ex1.m2.8.8.cmml" xref="S3.Ex1.m2.8.8"><and id="S3.Ex1.m2.8.8a.cmml" xref="S3.Ex1.m2.8.8"></and><apply id="S3.Ex1.m2.8.8b.cmml" xref="S3.Ex1.m2.8.8"><eq id="S3.Ex1.m2.8.8.5.cmml" xref="S3.Ex1.m2.8.8.5"></eq><csymbol cd="latexml" id="S3.Ex1.m2.8.8.4.cmml" xref="S3.Ex1.m2.8.8.4">absent</csymbol><apply id="S3.Ex1.m2.8.8.2.cmml" xref="S3.Ex1.m2.8.8.2"><ci id="S3.Ex1.m2.8.8.2.3.cmml" xref="S3.Ex1.m2.8.8.2.3">⋅</ci><apply id="S3.Ex1.m2.7.7.1.1.1.1.cmml" xref="S3.Ex1.m2.7.7.1.1.1"><ci id="S3.Ex1.m2.7.7.1.1.1.1.1.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.1">∥</ci><apply id="S3.Ex1.m2.7.7.1.1.1.1.2.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m2.7.7.1.1.1.1.2.1.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex1.m2.7.7.1.1.1.1.2.2.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.2.2">𝜓</ci><list id="S3.Ex1.m2.2.2.2.3.cmml" xref="S3.Ex1.m2.2.2.2.2"><cn id="S3.Ex1.m2.1.1.1.1.cmml" type="integer" xref="S3.Ex1.m2.1.1.1.1">1</cn><apply id="S3.Ex1.m2.2.2.2.2.1.cmml" xref="S3.Ex1.m2.2.2.2.2.1"><csymbol cd="ambiguous" id="S3.Ex1.m2.2.2.2.2.1.1.cmml" xref="S3.Ex1.m2.2.2.2.2.1">subscript</csymbol><ci id="S3.Ex1.m2.2.2.2.2.1.2.cmml" xref="S3.Ex1.m2.2.2.2.2.1.2">𝑔</ci><apply id="S3.Ex1.m2.2.2.2.2.1.3.cmml" xref="S3.Ex1.m2.2.2.2.2.1.3"><times id="S3.Ex1.m2.2.2.2.2.1.3.1.cmml" xref="S3.Ex1.m2.2.2.2.2.1.3.1"></times><ci id="S3.Ex1.m2.2.2.2.2.1.3.2.cmml" xref="S3.Ex1.m2.2.2.2.2.1.3.2">𝑖</ci><cn id="S3.Ex1.m2.2.2.2.2.1.3.3.cmml" type="integer" xref="S3.Ex1.m2.2.2.2.2.1.3.3">1</cn></apply></apply></list></apply><ci id="S3.Ex1.m2.7.7.1.1.1.1.3.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.3">…</ci><apply id="S3.Ex1.m2.7.7.1.1.1.1.4.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m2.7.7.1.1.1.1.4.1.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.4">subscript</csymbol><ci id="S3.Ex1.m2.7.7.1.1.1.1.4.2.cmml" xref="S3.Ex1.m2.7.7.1.1.1.1.4.2">𝜓</ci><list id="S3.Ex1.m2.4.4.2.3.cmml" xref="S3.Ex1.m2.4.4.2.2"><ci id="S3.Ex1.m2.3.3.1.1.cmml" xref="S3.Ex1.m2.3.3.1.1">𝑚</ci><apply id="S3.Ex1.m2.4.4.2.2.1.cmml" xref="S3.Ex1.m2.4.4.2.2.1"><csymbol cd="ambiguous" id="S3.Ex1.m2.4.4.2.2.1.1.cmml" xref="S3.Ex1.m2.4.4.2.2.1">subscript</csymbol><ci id="S3.Ex1.m2.4.4.2.2.1.2.cmml" xref="S3.Ex1.m2.4.4.2.2.1.2">𝑔</ci><apply id="S3.Ex1.m2.4.4.2.2.1.3.cmml" xref="S3.Ex1.m2.4.4.2.2.1.3"><times id="S3.Ex1.m2.4.4.2.2.1.3.1.cmml" xref="S3.Ex1.m2.4.4.2.2.1.3.1"></times><ci id="S3.Ex1.m2.4.4.2.2.1.3.2.cmml" xref="S3.Ex1.m2.4.4.2.2.1.3.2">𝑖</ci><ci id="S3.Ex1.m2.4.4.2.2.1.3.3.cmml" xref="S3.Ex1.m2.4.4.2.2.1.3.3">𝑚</ci></apply></apply></list></apply></apply><apply id="S3.Ex1.m2.8.8.2.2.1.1.cmml" xref="S3.Ex1.m2.8.8.2.2.1"><ci id="S3.Ex1.m2.8.8.2.2.1.1.1.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.1">∥</ci><apply id="S3.Ex1.m2.8.8.2.2.1.1.2.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.2.2.1.1.2.1.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.2">subscript</csymbol><ci id="S3.Ex1.m2.8.8.2.2.1.1.2.2.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.2.2">italic-ϕ</ci><cn id="S3.Ex1.m2.8.8.2.2.1.1.2.3.cmml" type="integer" xref="S3.Ex1.m2.8.8.2.2.1.1.2.3">1</cn></apply><ci id="S3.Ex1.m2.8.8.2.2.1.1.3.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.3">…</ci><apply id="S3.Ex1.m2.8.8.2.2.1.1.4.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.2.2.1.1.4.1.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.4">subscript</csymbol><ci id="S3.Ex1.m2.8.8.2.2.1.1.4.2.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.4.2">italic-ϕ</ci><ci id="S3.Ex1.m2.8.8.2.2.1.1.4.3.cmml" xref="S3.Ex1.m2.8.8.2.2.1.1.4.3">𝑚</ci></apply></apply></apply></apply><apply id="S3.Ex1.m2.8.8c.cmml" xref="S3.Ex1.m2.8.8"><eq id="S3.Ex1.m2.8.8.6.cmml" xref="S3.Ex1.m2.8.8.6"></eq><share href="https://arxiv.org/html/2408.09992v1#S3.Ex1.m2.8.8.2.cmml" id="S3.Ex1.m2.8.8d.cmml" xref="S3.Ex1.m2.8.8"></share><apply id="S3.Ex1.m2.8.8.7.cmml" xref="S3.Ex1.m2.8.8.7"><apply id="S3.Ex1.m2.8.8.7.1.cmml" xref="S3.Ex1.m2.8.8.7.1"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.7.1.1.cmml" xref="S3.Ex1.m2.8.8.7.1">superscript</csymbol><apply id="S3.Ex1.m2.8.8.7.1.2.cmml" xref="S3.Ex1.m2.8.8.7.1"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.7.1.2.1.cmml" xref="S3.Ex1.m2.8.8.7.1">subscript</csymbol><sum id="S3.Ex1.m2.8.8.7.1.2.2.cmml" xref="S3.Ex1.m2.8.8.7.1.2.2"></sum><apply id="S3.Ex1.m2.8.8.7.1.2.3.cmml" xref="S3.Ex1.m2.8.8.7.1.2.3"><eq id="S3.Ex1.m2.8.8.7.1.2.3.1.cmml" xref="S3.Ex1.m2.8.8.7.1.2.3.1"></eq><ci id="S3.Ex1.m2.8.8.7.1.2.3.2.cmml" xref="S3.Ex1.m2.8.8.7.1.2.3.2">𝑘</ci><cn id="S3.Ex1.m2.8.8.7.1.2.3.3.cmml" type="integer" xref="S3.Ex1.m2.8.8.7.1.2.3.3">1</cn></apply></apply><ci id="S3.Ex1.m2.8.8.7.1.3.cmml" xref="S3.Ex1.m2.8.8.7.1.3">𝑚</ci></apply><apply id="S3.Ex1.m2.8.8.7.2.cmml" xref="S3.Ex1.m2.8.8.7.2"><ci id="S3.Ex1.m2.8.8.7.2.1.cmml" xref="S3.Ex1.m2.8.8.7.2.1">⋅</ci><apply id="S3.Ex1.m2.8.8.7.2.2.cmml" xref="S3.Ex1.m2.8.8.7.2.2"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.7.2.2.1.cmml" xref="S3.Ex1.m2.8.8.7.2.2">subscript</csymbol><ci id="S3.Ex1.m2.8.8.7.2.2.2.cmml" xref="S3.Ex1.m2.8.8.7.2.2.2">𝜓</ci><list id="S3.Ex1.m2.6.6.2.3.cmml" xref="S3.Ex1.m2.6.6.2.2"><ci id="S3.Ex1.m2.5.5.1.1.cmml" xref="S3.Ex1.m2.5.5.1.1">𝑘</ci><apply id="S3.Ex1.m2.6.6.2.2.1.cmml" xref="S3.Ex1.m2.6.6.2.2.1"><csymbol cd="ambiguous" id="S3.Ex1.m2.6.6.2.2.1.1.cmml" xref="S3.Ex1.m2.6.6.2.2.1">subscript</csymbol><ci id="S3.Ex1.m2.6.6.2.2.1.2.cmml" xref="S3.Ex1.m2.6.6.2.2.1.2">𝑔</ci><apply id="S3.Ex1.m2.6.6.2.2.1.3.cmml" xref="S3.Ex1.m2.6.6.2.2.1.3"><times id="S3.Ex1.m2.6.6.2.2.1.3.1.cmml" xref="S3.Ex1.m2.6.6.2.2.1.3.1"></times><ci id="S3.Ex1.m2.6.6.2.2.1.3.2.cmml" xref="S3.Ex1.m2.6.6.2.2.1.3.2">𝑖</ci><ci id="S3.Ex1.m2.6.6.2.2.1.3.3.cmml" xref="S3.Ex1.m2.6.6.2.2.1.3.3">𝑘</ci></apply></apply></list></apply><apply id="S3.Ex1.m2.8.8.7.2.3.cmml" xref="S3.Ex1.m2.8.8.7.2.3"><csymbol cd="ambiguous" id="S3.Ex1.m2.8.8.7.2.3.1.cmml" xref="S3.Ex1.m2.8.8.7.2.3">subscript</csymbol><ci id="S3.Ex1.m2.8.8.7.2.3.2.cmml" xref="S3.Ex1.m2.8.8.7.2.3.2">italic-ϕ</ci><ci id="S3.Ex1.m2.8.8.7.2.3.3.cmml" xref="S3.Ex1.m2.8.8.7.2.3.3">𝑘</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m2.8c">\displaystyle=(\psi_{1,g_{i1}}\mathbin{\|}...\mathbin{\|}\psi_{m,g_{im}})\cdot%
(\phi_{1}\mathbin{\|}...\mathbin{\|}\phi_{m})=\sum_{k=1}^{m}\psi_{k,g_{ik}}%
\cdot\phi_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m2.8d">= ( italic_ψ start_POSTSUBSCRIPT 1 , italic_g start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∥ … ∥ italic_ψ start_POSTSUBSCRIPT italic_m , italic_g start_POSTSUBSCRIPT italic_i italic_m end_POSTSUBSCRIPT end_POSTSUBSCRIPT ) ⋅ ( italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∥ … ∥ italic_ϕ start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT italic_ψ start_POSTSUBSCRIPT italic_k , italic_g start_POSTSUBSCRIPT italic_i italic_k end_POSTSUBSCRIPT end_POSTSUBSCRIPT ⋅ italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.p3">
<p class="ltx_p" id="S3.p3.4">Let <math alttext="S\in\mathbb{R}^{m\times b}" class="ltx_Math" display="inline" id="S3.p3.1.m1.1"><semantics id="S3.p3.1.m1.1a"><mrow id="S3.p3.1.m1.1.1" xref="S3.p3.1.m1.1.1.cmml"><mi id="S3.p3.1.m1.1.1.2" mathcolor="#000000" xref="S3.p3.1.m1.1.1.2.cmml">S</mi><mo id="S3.p3.1.m1.1.1.1" mathcolor="#000000" xref="S3.p3.1.m1.1.1.1.cmml">∈</mo><msup id="S3.p3.1.m1.1.1.3" xref="S3.p3.1.m1.1.1.3.cmml"><mi id="S3.p3.1.m1.1.1.3.2" mathcolor="#000000" xref="S3.p3.1.m1.1.1.3.2.cmml">ℝ</mi><mrow id="S3.p3.1.m1.1.1.3.3" xref="S3.p3.1.m1.1.1.3.3.cmml"><mi id="S3.p3.1.m1.1.1.3.3.2" mathcolor="#000000" xref="S3.p3.1.m1.1.1.3.3.2.cmml">m</mi><mo id="S3.p3.1.m1.1.1.3.3.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.p3.1.m1.1.1.3.3.1.cmml">×</mo><mi id="S3.p3.1.m1.1.1.3.3.3" mathcolor="#000000" xref="S3.p3.1.m1.1.1.3.3.3.cmml">b</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.1.m1.1b"><apply id="S3.p3.1.m1.1.1.cmml" xref="S3.p3.1.m1.1.1"><in id="S3.p3.1.m1.1.1.1.cmml" xref="S3.p3.1.m1.1.1.1"></in><ci id="S3.p3.1.m1.1.1.2.cmml" xref="S3.p3.1.m1.1.1.2">𝑆</ci><apply id="S3.p3.1.m1.1.1.3.cmml" xref="S3.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.p3.1.m1.1.1.3.1.cmml" xref="S3.p3.1.m1.1.1.3">superscript</csymbol><ci id="S3.p3.1.m1.1.1.3.2.cmml" xref="S3.p3.1.m1.1.1.3.2">ℝ</ci><apply id="S3.p3.1.m1.1.1.3.3.cmml" xref="S3.p3.1.m1.1.1.3.3"><times id="S3.p3.1.m1.1.1.3.3.1.cmml" xref="S3.p3.1.m1.1.1.3.3.1"></times><ci id="S3.p3.1.m1.1.1.3.3.2.cmml" xref="S3.p3.1.m1.1.1.3.3.2">𝑚</ci><ci id="S3.p3.1.m1.1.1.3.3.3.cmml" xref="S3.p3.1.m1.1.1.3.3.3">𝑏</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.1.m1.1c">S\in\mathbb{R}^{m\times b}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.1.m1.1d">italic_S ∈ blackboard_R start_POSTSUPERSCRIPT italic_m × italic_b end_POSTSUPERSCRIPT</annotation></semantics></math> denote the <em class="ltx_emph ltx_font_italic" id="S3.p3.4.1">sub-id score matrix</em>, which consists of <em class="ltx_emph ltx_font_italic" id="S3.p3.4.2">sub-id scores</em> <math alttext="s_{k,j}" class="ltx_Math" display="inline" id="S3.p3.2.m2.2"><semantics id="S3.p3.2.m2.2a"><msub id="S3.p3.2.m2.2.3" xref="S3.p3.2.m2.2.3.cmml"><mi id="S3.p3.2.m2.2.3.2" mathcolor="#000000" xref="S3.p3.2.m2.2.3.2.cmml">s</mi><mrow id="S3.p3.2.m2.2.2.2.4" xref="S3.p3.2.m2.2.2.2.3.cmml"><mi id="S3.p3.2.m2.1.1.1.1" mathcolor="#000000" xref="S3.p3.2.m2.1.1.1.1.cmml">k</mi><mo id="S3.p3.2.m2.2.2.2.4.1" mathcolor="#000000" xref="S3.p3.2.m2.2.2.2.3.cmml">,</mo><mi id="S3.p3.2.m2.2.2.2.2" mathcolor="#000000" xref="S3.p3.2.m2.2.2.2.2.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p3.2.m2.2b"><apply id="S3.p3.2.m2.2.3.cmml" xref="S3.p3.2.m2.2.3"><csymbol cd="ambiguous" id="S3.p3.2.m2.2.3.1.cmml" xref="S3.p3.2.m2.2.3">subscript</csymbol><ci id="S3.p3.2.m2.2.3.2.cmml" xref="S3.p3.2.m2.2.3.2">𝑠</ci><list id="S3.p3.2.m2.2.2.2.3.cmml" xref="S3.p3.2.m2.2.2.2.4"><ci id="S3.p3.2.m2.1.1.1.1.cmml" xref="S3.p3.2.m2.1.1.1.1">𝑘</ci><ci id="S3.p3.2.m2.2.2.2.2.cmml" xref="S3.p3.2.m2.2.2.2.2">𝑗</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.2.m2.2c">s_{k,j}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.2.m2.2d">italic_s start_POSTSUBSCRIPT italic_k , italic_j end_POSTSUBSCRIPT</annotation></semantics></math>, defined as dot products of the sub-item embedding <math alttext="\psi_{k,j}" class="ltx_Math" display="inline" id="S3.p3.3.m3.2"><semantics id="S3.p3.3.m3.2a"><msub id="S3.p3.3.m3.2.3" xref="S3.p3.3.m3.2.3.cmml"><mi id="S3.p3.3.m3.2.3.2" mathcolor="#000000" xref="S3.p3.3.m3.2.3.2.cmml">ψ</mi><mrow id="S3.p3.3.m3.2.2.2.4" xref="S3.p3.3.m3.2.2.2.3.cmml"><mi id="S3.p3.3.m3.1.1.1.1" mathcolor="#000000" xref="S3.p3.3.m3.1.1.1.1.cmml">k</mi><mo id="S3.p3.3.m3.2.2.2.4.1" mathcolor="#000000" xref="S3.p3.3.m3.2.2.2.3.cmml">,</mo><mi id="S3.p3.3.m3.2.2.2.2" mathcolor="#000000" xref="S3.p3.3.m3.2.2.2.2.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p3.3.m3.2b"><apply id="S3.p3.3.m3.2.3.cmml" xref="S3.p3.3.m3.2.3"><csymbol cd="ambiguous" id="S3.p3.3.m3.2.3.1.cmml" xref="S3.p3.3.m3.2.3">subscript</csymbol><ci id="S3.p3.3.m3.2.3.2.cmml" xref="S3.p3.3.m3.2.3.2">𝜓</ci><list id="S3.p3.3.m3.2.2.2.3.cmml" xref="S3.p3.3.m3.2.2.2.4"><ci id="S3.p3.3.m3.1.1.1.1.cmml" xref="S3.p3.3.m3.1.1.1.1">𝑘</ci><ci id="S3.p3.3.m3.2.2.2.2.cmml" xref="S3.p3.3.m3.2.2.2.2">𝑗</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.3.m3.2c">\psi_{k,j}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.3.m3.2d">italic_ψ start_POSTSUBSCRIPT italic_k , italic_j end_POSTSUBSCRIPT</annotation></semantics></math> and the sequence sub-embeddings <math alttext="\phi_{k}" class="ltx_Math" display="inline" id="S3.p3.4.m4.1"><semantics id="S3.p3.4.m4.1a"><msub id="S3.p3.4.m4.1.1" xref="S3.p3.4.m4.1.1.cmml"><mi id="S3.p3.4.m4.1.1.2" mathcolor="#000000" xref="S3.p3.4.m4.1.1.2.cmml">ϕ</mi><mi id="S3.p3.4.m4.1.1.3" mathcolor="#000000" xref="S3.p3.4.m4.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p3.4.m4.1b"><apply id="S3.p3.4.m4.1.1.cmml" xref="S3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S3.p3.4.m4.1.1.1.cmml" xref="S3.p3.4.m4.1.1">subscript</csymbol><ci id="S3.p3.4.m4.1.1.2.cmml" xref="S3.p3.4.m4.1.1.2">italic-ϕ</ci><ci id="S3.p3.4.m4.1.1.3.cmml" xref="S3.p3.4.m4.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.4.m4.1c">\phi_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.4.m4.1d">italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx5">
<tbody id="S3.E4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle s_{k,j}=\psi_{k,j}\cdot\phi_{k}" class="ltx_Math" display="inline" id="S3.E4.m1.4"><semantics id="S3.E4.m1.4a"><mrow id="S3.E4.m1.4.5" xref="S3.E4.m1.4.5.cmml"><msub id="S3.E4.m1.4.5.2" xref="S3.E4.m1.4.5.2.cmml"><mi id="S3.E4.m1.4.5.2.2" xref="S3.E4.m1.4.5.2.2.cmml">s</mi><mrow id="S3.E4.m1.2.2.2.4" xref="S3.E4.m1.2.2.2.3.cmml"><mi id="S3.E4.m1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.cmml">k</mi><mo id="S3.E4.m1.2.2.2.4.1" xref="S3.E4.m1.2.2.2.3.cmml">,</mo><mi id="S3.E4.m1.2.2.2.2" xref="S3.E4.m1.2.2.2.2.cmml">j</mi></mrow></msub><mo id="S3.E4.m1.4.5.1" xref="S3.E4.m1.4.5.1.cmml">=</mo><mrow id="S3.E4.m1.4.5.3" xref="S3.E4.m1.4.5.3.cmml"><msub id="S3.E4.m1.4.5.3.2" xref="S3.E4.m1.4.5.3.2.cmml"><mi id="S3.E4.m1.4.5.3.2.2" xref="S3.E4.m1.4.5.3.2.2.cmml">ψ</mi><mrow id="S3.E4.m1.4.4.2.4" xref="S3.E4.m1.4.4.2.3.cmml"><mi id="S3.E4.m1.3.3.1.1" xref="S3.E4.m1.3.3.1.1.cmml">k</mi><mo id="S3.E4.m1.4.4.2.4.1" xref="S3.E4.m1.4.4.2.3.cmml">,</mo><mi id="S3.E4.m1.4.4.2.2" xref="S3.E4.m1.4.4.2.2.cmml">j</mi></mrow></msub><mo id="S3.E4.m1.4.5.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E4.m1.4.5.3.1.cmml">⋅</mo><msub id="S3.E4.m1.4.5.3.3" xref="S3.E4.m1.4.5.3.3.cmml"><mi id="S3.E4.m1.4.5.3.3.2" xref="S3.E4.m1.4.5.3.3.2.cmml">ϕ</mi><mi id="S3.E4.m1.4.5.3.3.3" xref="S3.E4.m1.4.5.3.3.3.cmml">k</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.4b"><apply id="S3.E4.m1.4.5.cmml" xref="S3.E4.m1.4.5"><eq id="S3.E4.m1.4.5.1.cmml" xref="S3.E4.m1.4.5.1"></eq><apply id="S3.E4.m1.4.5.2.cmml" xref="S3.E4.m1.4.5.2"><csymbol cd="ambiguous" id="S3.E4.m1.4.5.2.1.cmml" xref="S3.E4.m1.4.5.2">subscript</csymbol><ci id="S3.E4.m1.4.5.2.2.cmml" xref="S3.E4.m1.4.5.2.2">𝑠</ci><list id="S3.E4.m1.2.2.2.3.cmml" xref="S3.E4.m1.2.2.2.4"><ci id="S3.E4.m1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1">𝑘</ci><ci id="S3.E4.m1.2.2.2.2.cmml" xref="S3.E4.m1.2.2.2.2">𝑗</ci></list></apply><apply id="S3.E4.m1.4.5.3.cmml" xref="S3.E4.m1.4.5.3"><ci id="S3.E4.m1.4.5.3.1.cmml" xref="S3.E4.m1.4.5.3.1">⋅</ci><apply id="S3.E4.m1.4.5.3.2.cmml" xref="S3.E4.m1.4.5.3.2"><csymbol cd="ambiguous" id="S3.E4.m1.4.5.3.2.1.cmml" xref="S3.E4.m1.4.5.3.2">subscript</csymbol><ci id="S3.E4.m1.4.5.3.2.2.cmml" xref="S3.E4.m1.4.5.3.2.2">𝜓</ci><list id="S3.E4.m1.4.4.2.3.cmml" xref="S3.E4.m1.4.4.2.4"><ci id="S3.E4.m1.3.3.1.1.cmml" xref="S3.E4.m1.3.3.1.1">𝑘</ci><ci id="S3.E4.m1.4.4.2.2.cmml" xref="S3.E4.m1.4.4.2.2">𝑗</ci></list></apply><apply id="S3.E4.m1.4.5.3.3.cmml" xref="S3.E4.m1.4.5.3.3"><csymbol cd="ambiguous" id="S3.E4.m1.4.5.3.3.1.cmml" xref="S3.E4.m1.4.5.3.3">subscript</csymbol><ci id="S3.E4.m1.4.5.3.3.2.cmml" xref="S3.E4.m1.4.5.3.3.2">italic-ϕ</ci><ci id="S3.E4.m1.4.5.3.3.3.cmml" xref="S3.E4.m1.4.5.3.3.3">𝑘</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.4c">\displaystyle s_{k,j}=\psi_{k,j}\cdot\phi_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.4d">italic_s start_POSTSUBSCRIPT italic_k , italic_j end_POSTSUBSCRIPT = italic_ψ start_POSTSUBSCRIPT italic_k , italic_j end_POSTSUBSCRIPT ⋅ italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.p4">
<p class="ltx_p" id="S3.p4.1">The final score of item <math alttext="i" class="ltx_Math" display="inline" id="S3.p4.1.m1.1"><semantics id="S3.p4.1.m1.1a"><mi id="S3.p4.1.m1.1.1" mathcolor="#000000" xref="S3.p4.1.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.p4.1.m1.1b"><ci id="S3.p4.1.m1.1.1.cmml" xref="S3.p4.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.1.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.p4.1.m1.1d">italic_i</annotation></semantics></math> can, therefore, also be computed as the sum of the scores of its associated sub-ids:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S6.EGx6">
<tbody id="S3.E5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(5)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle r_{i}=\sum_{k=1}^{m}s_{k,g_{ik}}" class="ltx_Math" display="inline" id="S3.E5.m1.2"><semantics id="S3.E5.m1.2a"><mrow id="S3.E5.m1.2.3" xref="S3.E5.m1.2.3.cmml"><msub id="S3.E5.m1.2.3.2" xref="S3.E5.m1.2.3.2.cmml"><mi id="S3.E5.m1.2.3.2.2" xref="S3.E5.m1.2.3.2.2.cmml">r</mi><mi id="S3.E5.m1.2.3.2.3" xref="S3.E5.m1.2.3.2.3.cmml">i</mi></msub><mo id="S3.E5.m1.2.3.1" xref="S3.E5.m1.2.3.1.cmml">=</mo><mrow id="S3.E5.m1.2.3.3" xref="S3.E5.m1.2.3.3.cmml"><mstyle displaystyle="true" id="S3.E5.m1.2.3.3.1" xref="S3.E5.m1.2.3.3.1.cmml"><munderover id="S3.E5.m1.2.3.3.1a" xref="S3.E5.m1.2.3.3.1.cmml"><mo id="S3.E5.m1.2.3.3.1.2.2" movablelimits="false" xref="S3.E5.m1.2.3.3.1.2.2.cmml">∑</mo><mrow id="S3.E5.m1.2.3.3.1.2.3" xref="S3.E5.m1.2.3.3.1.2.3.cmml"><mi id="S3.E5.m1.2.3.3.1.2.3.2" xref="S3.E5.m1.2.3.3.1.2.3.2.cmml">k</mi><mo id="S3.E5.m1.2.3.3.1.2.3.1" xref="S3.E5.m1.2.3.3.1.2.3.1.cmml">=</mo><mn id="S3.E5.m1.2.3.3.1.2.3.3" xref="S3.E5.m1.2.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E5.m1.2.3.3.1.3" xref="S3.E5.m1.2.3.3.1.3.cmml">m</mi></munderover></mstyle><msub id="S3.E5.m1.2.3.3.2" xref="S3.E5.m1.2.3.3.2.cmml"><mi id="S3.E5.m1.2.3.3.2.2" xref="S3.E5.m1.2.3.3.2.2.cmml">s</mi><mrow id="S3.E5.m1.2.2.2.2" xref="S3.E5.m1.2.2.2.3.cmml"><mi id="S3.E5.m1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml">k</mi><mo id="S3.E5.m1.2.2.2.2.2" xref="S3.E5.m1.2.2.2.3.cmml">,</mo><msub id="S3.E5.m1.2.2.2.2.1" xref="S3.E5.m1.2.2.2.2.1.cmml"><mi id="S3.E5.m1.2.2.2.2.1.2" xref="S3.E5.m1.2.2.2.2.1.2.cmml">g</mi><mrow id="S3.E5.m1.2.2.2.2.1.3" xref="S3.E5.m1.2.2.2.2.1.3.cmml"><mi id="S3.E5.m1.2.2.2.2.1.3.2" xref="S3.E5.m1.2.2.2.2.1.3.2.cmml">i</mi><mo id="S3.E5.m1.2.2.2.2.1.3.1" xref="S3.E5.m1.2.2.2.2.1.3.1.cmml">⁢</mo><mi id="S3.E5.m1.2.2.2.2.1.3.3" xref="S3.E5.m1.2.2.2.2.1.3.3.cmml">k</mi></mrow></msub></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.2b"><apply id="S3.E5.m1.2.3.cmml" xref="S3.E5.m1.2.3"><eq id="S3.E5.m1.2.3.1.cmml" xref="S3.E5.m1.2.3.1"></eq><apply id="S3.E5.m1.2.3.2.cmml" xref="S3.E5.m1.2.3.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.3.2.1.cmml" xref="S3.E5.m1.2.3.2">subscript</csymbol><ci id="S3.E5.m1.2.3.2.2.cmml" xref="S3.E5.m1.2.3.2.2">𝑟</ci><ci id="S3.E5.m1.2.3.2.3.cmml" xref="S3.E5.m1.2.3.2.3">𝑖</ci></apply><apply id="S3.E5.m1.2.3.3.cmml" xref="S3.E5.m1.2.3.3"><apply id="S3.E5.m1.2.3.3.1.cmml" xref="S3.E5.m1.2.3.3.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.3.3.1.1.cmml" xref="S3.E5.m1.2.3.3.1">superscript</csymbol><apply id="S3.E5.m1.2.3.3.1.2.cmml" xref="S3.E5.m1.2.3.3.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.3.3.1.2.1.cmml" xref="S3.E5.m1.2.3.3.1">subscript</csymbol><sum id="S3.E5.m1.2.3.3.1.2.2.cmml" xref="S3.E5.m1.2.3.3.1.2.2"></sum><apply id="S3.E5.m1.2.3.3.1.2.3.cmml" xref="S3.E5.m1.2.3.3.1.2.3"><eq id="S3.E5.m1.2.3.3.1.2.3.1.cmml" xref="S3.E5.m1.2.3.3.1.2.3.1"></eq><ci id="S3.E5.m1.2.3.3.1.2.3.2.cmml" xref="S3.E5.m1.2.3.3.1.2.3.2">𝑘</ci><cn id="S3.E5.m1.2.3.3.1.2.3.3.cmml" type="integer" xref="S3.E5.m1.2.3.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E5.m1.2.3.3.1.3.cmml" xref="S3.E5.m1.2.3.3.1.3">𝑚</ci></apply><apply id="S3.E5.m1.2.3.3.2.cmml" xref="S3.E5.m1.2.3.3.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.3.3.2.1.cmml" xref="S3.E5.m1.2.3.3.2">subscript</csymbol><ci id="S3.E5.m1.2.3.3.2.2.cmml" xref="S3.E5.m1.2.3.3.2.2">𝑠</ci><list id="S3.E5.m1.2.2.2.3.cmml" xref="S3.E5.m1.2.2.2.2"><ci id="S3.E5.m1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1">𝑘</ci><apply id="S3.E5.m1.2.2.2.2.1.cmml" xref="S3.E5.m1.2.2.2.2.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.1.1.cmml" xref="S3.E5.m1.2.2.2.2.1">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.1.2.cmml" xref="S3.E5.m1.2.2.2.2.1.2">𝑔</ci><apply id="S3.E5.m1.2.2.2.2.1.3.cmml" xref="S3.E5.m1.2.2.2.2.1.3"><times id="S3.E5.m1.2.2.2.2.1.3.1.cmml" xref="S3.E5.m1.2.2.2.2.1.3.1"></times><ci id="S3.E5.m1.2.2.2.2.1.3.2.cmml" xref="S3.E5.m1.2.2.2.2.1.3.2">𝑖</ci><ci id="S3.E5.m1.2.2.2.2.1.3.3.cmml" xref="S3.E5.m1.2.2.2.2.1.3.3">𝑘</ci></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.2c">\displaystyle r_{i}=\sum_{k=1}^{m}s_{k,g_{ik}}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.2d">italic_r start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT italic_s start_POSTSUBSCRIPT italic_k , italic_g start_POSTSUBSCRIPT italic_i italic_k end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p4.2"><span class="ltx_text" id="S3.p4.2.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a> also graphically illustrates how item scores are computed using PQ.<span class="ltx_text" id="S3.p4.2.1.1"></span></span></p>
</div>
<div class="ltx_para" id="S3.p5">
<p class="ltx_p" id="S3.p5.8">The number of splits <math alttext="m" class="ltx_Math" display="inline" id="S3.p5.1.m1.1"><semantics id="S3.p5.1.m1.1a"><mi id="S3.p5.1.m1.1.1" mathcolor="#000000" xref="S3.p5.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.p5.1.m1.1b"><ci id="S3.p5.1.m1.1.1.cmml" xref="S3.p5.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.p5.1.m1.1d">italic_m</annotation></semantics></math> and the number of sub-ids per split <math alttext="b" class="ltx_Math" display="inline" id="S3.p5.2.m2.1"><semantics id="S3.p5.2.m2.1a"><mi id="S3.p5.2.m2.1.1" mathcolor="#000000" xref="S3.p5.2.m2.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S3.p5.2.m2.1b"><ci id="S3.p5.2.m2.1.1.cmml" xref="S3.p5.2.m2.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.2.m2.1c">b</annotation><annotation encoding="application/x-llamapun" id="S3.p5.2.m2.1d">italic_b</annotation></semantics></math> are usually chosen to be relatively small,
so that the total number of sub-id scores is much less compared to the size of the catalogue, e.g., <math alttext="m\times b\ll|I|" class="ltx_Math" display="inline" id="S3.p5.3.m3.1"><semantics id="S3.p5.3.m3.1a"><mrow id="S3.p5.3.m3.1.2" xref="S3.p5.3.m3.1.2.cmml"><mrow id="S3.p5.3.m3.1.2.2" xref="S3.p5.3.m3.1.2.2.cmml"><mi id="S3.p5.3.m3.1.2.2.2" mathcolor="#000000" xref="S3.p5.3.m3.1.2.2.2.cmml">m</mi><mo id="S3.p5.3.m3.1.2.2.1" lspace="0.222em" mathcolor="#000000" rspace="0.222em" xref="S3.p5.3.m3.1.2.2.1.cmml">×</mo><mi id="S3.p5.3.m3.1.2.2.3" mathcolor="#000000" xref="S3.p5.3.m3.1.2.2.3.cmml">b</mi></mrow><mo id="S3.p5.3.m3.1.2.1" mathcolor="#000000" xref="S3.p5.3.m3.1.2.1.cmml">≪</mo><mrow id="S3.p5.3.m3.1.2.3.2" xref="S3.p5.3.m3.1.2.3.1.cmml"><mo id="S3.p5.3.m3.1.2.3.2.1" mathcolor="#000000" stretchy="false" xref="S3.p5.3.m3.1.2.3.1.1.cmml">|</mo><mi id="S3.p5.3.m3.1.1" mathcolor="#000000" xref="S3.p5.3.m3.1.1.cmml">I</mi><mo id="S3.p5.3.m3.1.2.3.2.2" mathcolor="#000000" stretchy="false" xref="S3.p5.3.m3.1.2.3.1.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p5.3.m3.1b"><apply id="S3.p5.3.m3.1.2.cmml" xref="S3.p5.3.m3.1.2"><csymbol cd="latexml" id="S3.p5.3.m3.1.2.1.cmml" xref="S3.p5.3.m3.1.2.1">much-less-than</csymbol><apply id="S3.p5.3.m3.1.2.2.cmml" xref="S3.p5.3.m3.1.2.2"><times id="S3.p5.3.m3.1.2.2.1.cmml" xref="S3.p5.3.m3.1.2.2.1"></times><ci id="S3.p5.3.m3.1.2.2.2.cmml" xref="S3.p5.3.m3.1.2.2.2">𝑚</ci><ci id="S3.p5.3.m3.1.2.2.3.cmml" xref="S3.p5.3.m3.1.2.2.3">𝑏</ci></apply><apply id="S3.p5.3.m3.1.2.3.1.cmml" xref="S3.p5.3.m3.1.2.3.2"><abs id="S3.p5.3.m3.1.2.3.1.1.cmml" xref="S3.p5.3.m3.1.2.3.2.1"></abs><ci id="S3.p5.3.m3.1.1.cmml" xref="S3.p5.3.m3.1.1">𝐼</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.3.m3.1c">m\times b\ll|I|</annotation><annotation encoding="application/x-llamapun" id="S3.p5.3.m3.1d">italic_m × italic_b ≪ | italic_I |</annotation></semantics></math>.
Therefore, <span class="ltx_text" id="S3.p5.8.5">this allows to compute the matrix <math alttext="S" class="ltx_Math" display="inline" id="S3.p5.4.1.m1.1"><semantics id="S3.p5.4.1.m1.1a"><mi id="S3.p5.4.1.m1.1.1" mathcolor="#000000" xref="S3.p5.4.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.p5.4.1.m1.1b"><ci id="S3.p5.4.1.m1.1.1.cmml" xref="S3.p5.4.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.4.1.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.p5.4.1.m1.1d">italic_S</annotation></semantics></math> only once for a given sequence embedding<span class="ltx_text" id="S3.p5.8.5.4"> and then reuse these scores for all items. This leads to efficiency gains compared to matrix multiplication, as scoring each item now only requires <math alttext="m\ll d" class="ltx_Math" display="inline" id="S3.p5.5.2.1.m1.1"><semantics id="S3.p5.5.2.1.m1.1a"><mrow id="S3.p5.5.2.1.m1.1.1" xref="S3.p5.5.2.1.m1.1.1.cmml"><mi id="S3.p5.5.2.1.m1.1.1.2" mathcolor="#000000" xref="S3.p5.5.2.1.m1.1.1.2.cmml">m</mi><mo id="S3.p5.5.2.1.m1.1.1.1" mathcolor="#000000" xref="S3.p5.5.2.1.m1.1.1.1.cmml">≪</mo><mi id="S3.p5.5.2.1.m1.1.1.3" mathcolor="#000000" xref="S3.p5.5.2.1.m1.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.p5.5.2.1.m1.1b"><apply id="S3.p5.5.2.1.m1.1.1.cmml" xref="S3.p5.5.2.1.m1.1.1"><csymbol cd="latexml" id="S3.p5.5.2.1.m1.1.1.1.cmml" xref="S3.p5.5.2.1.m1.1.1.1">much-less-than</csymbol><ci id="S3.p5.5.2.1.m1.1.1.2.cmml" xref="S3.p5.5.2.1.m1.1.1.2">𝑚</ci><ci id="S3.p5.5.2.1.m1.1.1.3.cmml" xref="S3.p5.5.2.1.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.5.2.1.m1.1c">m\ll d</annotation><annotation encoding="application/x-llamapun" id="S3.p5.5.2.1.m1.1d">italic_m ≪ italic_d</annotation></semantics></math> additions instead of <math alttext="d" class="ltx_Math" display="inline" id="S3.p5.6.3.2.m2.1"><semantics id="S3.p5.6.3.2.m2.1a"><mi id="S3.p5.6.3.2.m2.1.1" mathcolor="#000000" xref="S3.p5.6.3.2.m2.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S3.p5.6.3.2.m2.1b"><ci id="S3.p5.6.3.2.m2.1.1.cmml" xref="S3.p5.6.3.2.m2.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.6.3.2.m2.1c">d</annotation><annotation encoding="application/x-llamapun" id="S3.p5.6.3.2.m2.1d">italic_d</annotation></semantics></math> multiplications and <math alttext="d" class="ltx_Math" display="inline" id="S3.p5.7.4.3.m3.1"><semantics id="S3.p5.7.4.3.m3.1a"><mi id="S3.p5.7.4.3.m3.1.1" mathcolor="#000000" xref="S3.p5.7.4.3.m3.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S3.p5.7.4.3.m3.1b"><ci id="S3.p5.7.4.3.m3.1.1.cmml" xref="S3.p5.7.4.3.m3.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.7.4.3.m3.1c">d</annotation><annotation encoding="application/x-llamapun" id="S3.p5.7.4.3.m3.1d">italic_d</annotation></semantics></math> additions per item. The time for pre-computing sub-item scores does not depend on <math alttext="|I|" class="ltx_Math" display="inline" id="S3.p5.8.5.4.m4.1"><semantics id="S3.p5.8.5.4.m4.1a"><mrow id="S3.p5.8.5.4.m4.1.2.2" xref="S3.p5.8.5.4.m4.1.2.1.cmml"><mo id="S3.p5.8.5.4.m4.1.2.2.1" mathcolor="#000000" stretchy="false" xref="S3.p5.8.5.4.m4.1.2.1.1.cmml">|</mo><mi id="S3.p5.8.5.4.m4.1.1" mathcolor="#000000" xref="S3.p5.8.5.4.m4.1.1.cmml">I</mi><mo id="S3.p5.8.5.4.m4.1.2.2.2" mathcolor="#000000" stretchy="false" xref="S3.p5.8.5.4.m4.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.p5.8.5.4.m4.1b"><apply id="S3.p5.8.5.4.m4.1.2.1.cmml" xref="S3.p5.8.5.4.m4.1.2.2"><abs id="S3.p5.8.5.4.m4.1.2.1.1.cmml" xref="S3.p5.8.5.4.m4.1.2.2.1"></abs><ci id="S3.p5.8.5.4.m4.1.1.cmml" xref="S3.p5.8.5.4.m4.1.1">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.8.5.4.m4.1c">|I|</annotation><annotation encoding="application/x-llamapun" id="S3.p5.8.5.4.m4.1d">| italic_I |</annotation></semantics></math> and
we can assume that it is negligible w.r.t. the exhaustive scoring of all items.</span></span></p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption" style="font-size:90%;"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.16.1.1">Algorithm 1</span> </span> PQTopK(<math alttext="G" class="ltx_Math" display="inline" id="alg1.5.m1.1"><semantics id="alg1.5.m1.1b"><mi id="alg1.5.m1.1.1" xref="alg1.5.m1.1.1.cmml">G</mi><annotation-xml encoding="MathML-Content" id="alg1.5.m1.1c"><ci id="alg1.5.m1.1.1.cmml" xref="alg1.5.m1.1.1">𝐺</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.5.m1.1d">G</annotation><annotation encoding="application/x-llamapun" id="alg1.5.m1.1e">italic_G</annotation></semantics></math>, <math alttext="S" class="ltx_Math" display="inline" id="alg1.6.m2.1"><semantics id="alg1.6.m2.1b"><mi id="alg1.6.m2.1.1" xref="alg1.6.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg1.6.m2.1c"><ci id="alg1.6.m2.1.1.cmml" xref="alg1.6.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.6.m2.1d">S</annotation><annotation encoding="application/x-llamapun" id="alg1.6.m2.1e">italic_S</annotation></semantics></math>, <math alttext="K" class="ltx_Math" display="inline" id="alg1.7.m3.1"><semantics id="alg1.7.m3.1b"><mi id="alg1.7.m3.1.1" xref="alg1.7.m3.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.7.m3.1c"><ci id="alg1.7.m3.1.1.cmml" xref="alg1.7.m3.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.7.m3.1d">K</annotation><annotation encoding="application/x-llamapun" id="alg1.7.m3.1e">italic_K</annotation></semantics></math>, <math alttext="V" class="ltx_Math" display="inline" id="alg1.8.m4.1"><semantics id="alg1.8.m4.1b"><mi id="alg1.8.m4.1.1" xref="alg1.8.m4.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="alg1.8.m4.1c"><ci id="alg1.8.m4.1.1.cmml" xref="alg1.8.m4.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.8.m4.1d">V</annotation><annotation encoding="application/x-llamapun" id="alg1.8.m4.1e">italic_V</annotation></semantics></math>).</figcaption>
<div class="ltx_listing ltx_listing" id="alg1.17">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.1.1.1" style="font-size:80%;">1:</span></span><math alttext="G" class="ltx_Math" display="inline" id="alg1.l1.m1.1"><semantics id="alg1.l1.m1.1a"><mi id="alg1.l1.m1.1.1" mathsize="90%" xref="alg1.l1.m1.1.1.cmml">G</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><ci id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1">𝐺</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">G</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.1d">italic_G</annotation></semantics></math><span class="ltx_text" id="alg1.l1.2" style="font-size:90%;"> is the codebook (mapping: item id </span><math alttext="\rightarrow" class="ltx_Math" display="inline" id="alg1.l1.m2.1"><semantics id="alg1.l1.m2.1a"><mo id="alg1.l1.m2.1.1" mathsize="90%" stretchy="false" xref="alg1.l1.m2.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><ci id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">\rightarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m2.1d">→</annotation></semantics></math><span class="ltx_text" id="alg1.l1.3" style="font-size:90%;"> sub-item ids), Eq. (</span><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.E1" style="font-size:90%;" title="In Sub-Id based recommendation ‣ 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a><span class="ltx_text" id="alg1.l1.4" style="font-size:90%;">)
</span>
</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.1.1.1" style="font-size:80%;">2:</span></span><math alttext="S" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><mi id="alg1.l2.m1.1.1" mathsize="90%" xref="alg1.l2.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_S</annotation></semantics></math><span class="ltx_text" id="alg1.l2.2" style="font-size:90%;"> is the matrix of pre-computed sub-item scores, indexed by split and sub-item, Eq. (</span><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S3.E4" style="font-size:90%;" title="In 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">4</span></a><span class="ltx_text" id="alg1.l2.3" style="font-size:90%;">)
</span>
</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l3.1.1.1" style="font-size:80%;">3:</span></span><math alttext="K" class="ltx_Math" display="inline" id="alg1.l3.m1.1"><semantics id="alg1.l3.m1.1a"><mi id="alg1.l3.m1.1.1" mathsize="90%" xref="alg1.l3.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.1b"><ci id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.1d">italic_K</annotation></semantics></math><span class="ltx_text" id="alg1.l3.2" style="font-size:90%;"> is the number of results to return
</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l4.1.1.1" style="font-size:80%;">4:</span></span><math alttext="V\subseteq I" class="ltx_Math" display="inline" id="alg1.l4.m1.1"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><mi id="alg1.l4.m1.1.1.2" mathsize="90%" xref="alg1.l4.m1.1.1.2.cmml">V</mi><mo id="alg1.l4.m1.1.1.1" mathsize="90%" xref="alg1.l4.m1.1.1.1.cmml">⊆</mo><mi id="alg1.l4.m1.1.1.3" mathsize="90%" xref="alg1.l4.m1.1.1.3.cmml">I</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><subset id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1"></subset><ci id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2">𝑉</ci><ci id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">V\subseteq I</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.1d">italic_V ⊆ italic_I</annotation></semantics></math><span class="ltx_text" id="alg1.l4.2" style="font-size:90%;"> are the items to score; all items (</span><math alttext="V=I" class="ltx_Math" display="inline" id="alg1.l4.m2.1"><semantics id="alg1.l4.m2.1a"><mrow id="alg1.l4.m2.1.1" xref="alg1.l4.m2.1.1.cmml"><mi id="alg1.l4.m2.1.1.2" mathsize="90%" xref="alg1.l4.m2.1.1.2.cmml">V</mi><mo id="alg1.l4.m2.1.1.1" mathsize="90%" xref="alg1.l4.m2.1.1.1.cmml">=</mo><mi id="alg1.l4.m2.1.1.3" mathsize="90%" xref="alg1.l4.m2.1.1.3.cmml">I</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m2.1b"><apply id="alg1.l4.m2.1.1.cmml" xref="alg1.l4.m2.1.1"><eq id="alg1.l4.m2.1.1.1.cmml" xref="alg1.l4.m2.1.1.1"></eq><ci id="alg1.l4.m2.1.1.2.cmml" xref="alg1.l4.m2.1.1.2">𝑉</ci><ci id="alg1.l4.m2.1.1.3.cmml" xref="alg1.l4.m2.1.1.3">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m2.1c">V=I</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m2.1d">italic_V = italic_I</annotation></semantics></math><span class="ltx_text" id="alg1.l4.3" style="font-size:90%;">) if not given
</span>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l5.1.1.1" style="font-size:80%;">5:</span></span><math alttext="scores\leftarrow" class="ltx_Math" display="inline" id="alg1.l5.m1.1"><semantics id="alg1.l5.m1.1a"><mrow id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml"><mrow id="alg1.l5.m1.1.1.2" xref="alg1.l5.m1.1.1.2.cmml"><mi id="alg1.l5.m1.1.1.2.2" mathsize="90%" xref="alg1.l5.m1.1.1.2.2.cmml">s</mi><mo id="alg1.l5.m1.1.1.2.1" xref="alg1.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l5.m1.1.1.2.3" mathsize="90%" xref="alg1.l5.m1.1.1.2.3.cmml">c</mi><mo id="alg1.l5.m1.1.1.2.1a" xref="alg1.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l5.m1.1.1.2.4" mathsize="90%" xref="alg1.l5.m1.1.1.2.4.cmml">o</mi><mo id="alg1.l5.m1.1.1.2.1b" xref="alg1.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l5.m1.1.1.2.5" mathsize="90%" xref="alg1.l5.m1.1.1.2.5.cmml">r</mi><mo id="alg1.l5.m1.1.1.2.1c" xref="alg1.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l5.m1.1.1.2.6" mathsize="90%" xref="alg1.l5.m1.1.1.2.6.cmml">e</mi><mo id="alg1.l5.m1.1.1.2.1d" xref="alg1.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l5.m1.1.1.2.7" mathsize="90%" xref="alg1.l5.m1.1.1.2.7.cmml">s</mi></mrow><mo id="alg1.l5.m1.1.1.1" mathsize="90%" stretchy="false" xref="alg1.l5.m1.1.1.1.cmml">←</mo><mi id="alg1.l5.m1.1.1.3" xref="alg1.l5.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.1b"><apply id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1"><ci id="alg1.l5.m1.1.1.1.cmml" xref="alg1.l5.m1.1.1.1">←</ci><apply id="alg1.l5.m1.1.1.2.cmml" xref="alg1.l5.m1.1.1.2"><times id="alg1.l5.m1.1.1.2.1.cmml" xref="alg1.l5.m1.1.1.2.1"></times><ci id="alg1.l5.m1.1.1.2.2.cmml" xref="alg1.l5.m1.1.1.2.2">𝑠</ci><ci id="alg1.l5.m1.1.1.2.3.cmml" xref="alg1.l5.m1.1.1.2.3">𝑐</ci><ci id="alg1.l5.m1.1.1.2.4.cmml" xref="alg1.l5.m1.1.1.2.4">𝑜</ci><ci id="alg1.l5.m1.1.1.2.5.cmml" xref="alg1.l5.m1.1.1.2.5">𝑟</ci><ci id="alg1.l5.m1.1.1.2.6.cmml" xref="alg1.l5.m1.1.1.2.6">𝑒</ci><ci id="alg1.l5.m1.1.1.2.7.cmml" xref="alg1.l5.m1.1.1.2.7">𝑠</ci></apply><csymbol cd="latexml" id="alg1.l5.m1.1.1.3.cmml" xref="alg1.l5.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.1c">scores\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.1d">italic_s italic_c italic_o italic_r italic_e italic_s ←</annotation></semantics></math><span class="ltx_text" id="alg1.l5.2" style="font-size:90%;"> empty array of scores for all items in </span><math alttext="V" class="ltx_Math" display="inline" id="alg1.l5.m2.1"><semantics id="alg1.l5.m2.1a"><mi id="alg1.l5.m2.1.1" mathsize="90%" xref="alg1.l5.m2.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="alg1.l5.m2.1b"><ci id="alg1.l5.m2.1.1.cmml" xref="alg1.l5.m2.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m2.1c">V</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m2.1d">italic_V</annotation></semantics></math><span class="ltx_text" id="alg1.l5.3" style="font-size:90%;">, initialised to 0
</span>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l6.2.1.1" style="font-size:80%;">6:</span></span><span class="ltx_text ltx_font_bold" id="alg1.l6.3" style="font-size:90%;">for</span><span class="ltx_text" id="alg1.l6.4" style="font-size:90%;"> </span><math alttext="item\_id\in V" class="ltx_Math" display="inline" id="alg1.l6.m1.1"><semantics id="alg1.l6.m1.1a"><mrow id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml"><mrow id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml"><mi id="alg1.l6.m1.1.1.2.2" mathsize="90%" xref="alg1.l6.m1.1.1.2.2.cmml">i</mi><mo id="alg1.l6.m1.1.1.2.1" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.3" mathsize="90%" xref="alg1.l6.m1.1.1.2.3.cmml">t</mi><mo id="alg1.l6.m1.1.1.2.1a" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.4" mathsize="90%" xref="alg1.l6.m1.1.1.2.4.cmml">e</mi><mo id="alg1.l6.m1.1.1.2.1b" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.5" mathsize="90%" xref="alg1.l6.m1.1.1.2.5.cmml">m</mi><mo id="alg1.l6.m1.1.1.2.1c" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.6" mathsize="90%" mathvariant="normal" xref="alg1.l6.m1.1.1.2.6.cmml">_</mi><mo id="alg1.l6.m1.1.1.2.1d" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.7" mathsize="90%" xref="alg1.l6.m1.1.1.2.7.cmml">i</mi><mo id="alg1.l6.m1.1.1.2.1e" xref="alg1.l6.m1.1.1.2.1.cmml">⁢</mo><mi id="alg1.l6.m1.1.1.2.8" mathsize="90%" xref="alg1.l6.m1.1.1.2.8.cmml">d</mi></mrow><mo id="alg1.l6.m1.1.1.1" mathsize="90%" xref="alg1.l6.m1.1.1.1.cmml">∈</mo><mi id="alg1.l6.m1.1.1.3" mathsize="90%" xref="alg1.l6.m1.1.1.3.cmml">V</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1"><in id="alg1.l6.m1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1"></in><apply id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2"><times id="alg1.l6.m1.1.1.2.1.cmml" xref="alg1.l6.m1.1.1.2.1"></times><ci id="alg1.l6.m1.1.1.2.2.cmml" xref="alg1.l6.m1.1.1.2.2">𝑖</ci><ci id="alg1.l6.m1.1.1.2.3.cmml" xref="alg1.l6.m1.1.1.2.3">𝑡</ci><ci id="alg1.l6.m1.1.1.2.4.cmml" xref="alg1.l6.m1.1.1.2.4">𝑒</ci><ci id="alg1.l6.m1.1.1.2.5.cmml" xref="alg1.l6.m1.1.1.2.5">𝑚</ci><ci id="alg1.l6.m1.1.1.2.6.cmml" xref="alg1.l6.m1.1.1.2.6">_</ci><ci id="alg1.l6.m1.1.1.2.7.cmml" xref="alg1.l6.m1.1.1.2.7">𝑖</ci><ci id="alg1.l6.m1.1.1.2.8.cmml" xref="alg1.l6.m1.1.1.2.8">𝑑</ci></apply><ci id="alg1.l6.m1.1.1.3.cmml" xref="alg1.l6.m1.1.1.3">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">item\_id\in V</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.1d">italic_i italic_t italic_e italic_m _ italic_i italic_d ∈ italic_V</annotation></semantics></math><span class="ltx_text" id="alg1.l6.5" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l6.6" style="font-size:90%;">do</span><span class="ltx_text" id="alg1.l6.7" style="font-size:90%;"> </span><span class="ltx_text" id="alg1.l6.1" style="font-size:90%;float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l6.1.m1.1"><semantics id="alg1.l6.1.m1.1a"><mo id="alg1.l6.1.m1.1.1" xref="alg1.l6.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l6.1.m1.1b"><ci id="alg1.l6.1.m1.1.1.cmml" xref="alg1.l6.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.1.m1.1d">▷</annotation></semantics></math> This loop can be efficiently parallelised
</span>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l7.2.1.1" style="font-size:80%;">7:</span></span><span class="ltx_text" id="alg1.l7.3" style="font-size:90%;">    </span><math alttext="score[item\_id]\leftarrow\sum_{k=1}^{m}S[k,G[item\_id,k]]" class="ltx_Math" display="inline" id="alg1.l7.m1.4"><semantics id="alg1.l7.m1.4a"><mrow id="alg1.l7.m1.4.4" xref="alg1.l7.m1.4.4.cmml"><mrow id="alg1.l7.m1.3.3.1" xref="alg1.l7.m1.3.3.1.cmml"><mi id="alg1.l7.m1.3.3.1.3" mathsize="90%" xref="alg1.l7.m1.3.3.1.3.cmml">s</mi><mo id="alg1.l7.m1.3.3.1.2" xref="alg1.l7.m1.3.3.1.2.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.4" mathsize="90%" xref="alg1.l7.m1.3.3.1.4.cmml">c</mi><mo id="alg1.l7.m1.3.3.1.2a" xref="alg1.l7.m1.3.3.1.2.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.5" mathsize="90%" xref="alg1.l7.m1.3.3.1.5.cmml">o</mi><mo id="alg1.l7.m1.3.3.1.2b" xref="alg1.l7.m1.3.3.1.2.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.6" mathsize="90%" xref="alg1.l7.m1.3.3.1.6.cmml">r</mi><mo id="alg1.l7.m1.3.3.1.2c" xref="alg1.l7.m1.3.3.1.2.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.7" mathsize="90%" xref="alg1.l7.m1.3.3.1.7.cmml">e</mi><mo id="alg1.l7.m1.3.3.1.2d" xref="alg1.l7.m1.3.3.1.2.cmml">⁢</mo><mrow id="alg1.l7.m1.3.3.1.1.1" xref="alg1.l7.m1.3.3.1.1.2.cmml"><mo id="alg1.l7.m1.3.3.1.1.1.2" maxsize="90%" minsize="90%" xref="alg1.l7.m1.3.3.1.1.2.1.cmml">[</mo><mrow id="alg1.l7.m1.3.3.1.1.1.1" xref="alg1.l7.m1.3.3.1.1.1.1.cmml"><mi id="alg1.l7.m1.3.3.1.1.1.1.2" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.2.cmml">i</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.3" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.3.cmml">t</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1a" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.4" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.4.cmml">e</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1b" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.5" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.5.cmml">m</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1c" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.6" mathsize="90%" mathvariant="normal" xref="alg1.l7.m1.3.3.1.1.1.1.6.cmml">_</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1d" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.7" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.7.cmml">i</mi><mo id="alg1.l7.m1.3.3.1.1.1.1.1e" xref="alg1.l7.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.3.3.1.1.1.1.8" mathsize="90%" xref="alg1.l7.m1.3.3.1.1.1.1.8.cmml">d</mi></mrow><mo id="alg1.l7.m1.3.3.1.1.1.3" maxsize="90%" minsize="90%" xref="alg1.l7.m1.3.3.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="alg1.l7.m1.4.4.3" mathsize="90%" rspace="0.111em" stretchy="false" xref="alg1.l7.m1.4.4.3.cmml">←</mo><mrow id="alg1.l7.m1.4.4.2" xref="alg1.l7.m1.4.4.2.cmml"><msubsup id="alg1.l7.m1.4.4.2.2" xref="alg1.l7.m1.4.4.2.2.cmml"><mo id="alg1.l7.m1.4.4.2.2.2.2" maxsize="90%" minsize="90%" stretchy="true" xref="alg1.l7.m1.4.4.2.2.2.2.cmml">∑</mo><mrow id="alg1.l7.m1.4.4.2.2.2.3" xref="alg1.l7.m1.4.4.2.2.2.3.cmml"><mi id="alg1.l7.m1.4.4.2.2.2.3.2" mathsize="90%" xref="alg1.l7.m1.4.4.2.2.2.3.2.cmml">k</mi><mo id="alg1.l7.m1.4.4.2.2.2.3.1" mathsize="90%" xref="alg1.l7.m1.4.4.2.2.2.3.1.cmml">=</mo><mn id="alg1.l7.m1.4.4.2.2.2.3.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.2.2.3.3.cmml">1</mn></mrow><mi id="alg1.l7.m1.4.4.2.2.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.2.3.cmml">m</mi></msubsup><mrow id="alg1.l7.m1.4.4.2.1" xref="alg1.l7.m1.4.4.2.1.cmml"><mi id="alg1.l7.m1.4.4.2.1.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.3.cmml">S</mi><mo id="alg1.l7.m1.4.4.2.1.2" xref="alg1.l7.m1.4.4.2.1.2.cmml">⁢</mo><mrow id="alg1.l7.m1.4.4.2.1.1.1" xref="alg1.l7.m1.4.4.2.1.1.2.cmml"><mo id="alg1.l7.m1.4.4.2.1.1.1.2" maxsize="90%" minsize="90%" xref="alg1.l7.m1.4.4.2.1.1.2.cmml">[</mo><mi id="alg1.l7.m1.2.2" mathsize="90%" xref="alg1.l7.m1.2.2.cmml">k</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.2.cmml">,</mo><mrow id="alg1.l7.m1.4.4.2.1.1.1.1" xref="alg1.l7.m1.4.4.2.1.1.1.1.cmml"><mi id="alg1.l7.m1.4.4.2.1.1.1.1.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.3.cmml">G</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.2" xref="alg1.l7.m1.4.4.2.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l7.m1.4.4.2.1.1.1.1.1.1" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.2.cmml"><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.2" maxsize="90%" minsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.2.cmml">[</mo><mrow id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.cmml"><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.2" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.2.cmml">i</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.3.cmml">t</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1a" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.4" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.4.cmml">e</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1b" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.5" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.5.cmml">m</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1c" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.6" mathsize="90%" mathvariant="normal" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.6.cmml">_</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1d" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.7" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.7.cmml">i</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1e" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.8" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.8.cmml">d</mi></mrow><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.3" mathsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.2.cmml">,</mo><mi id="alg1.l7.m1.1.1" mathsize="90%" xref="alg1.l7.m1.1.1.cmml">k</mi><mo id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.4" maxsize="90%" minsize="90%" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.2.cmml">]</mo></mrow></mrow><mo id="alg1.l7.m1.4.4.2.1.1.1.4" maxsize="90%" minsize="90%" xref="alg1.l7.m1.4.4.2.1.1.2.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.4b"><apply id="alg1.l7.m1.4.4.cmml" xref="alg1.l7.m1.4.4"><ci id="alg1.l7.m1.4.4.3.cmml" xref="alg1.l7.m1.4.4.3">←</ci><apply id="alg1.l7.m1.3.3.1.cmml" xref="alg1.l7.m1.3.3.1"><times id="alg1.l7.m1.3.3.1.2.cmml" xref="alg1.l7.m1.3.3.1.2"></times><ci id="alg1.l7.m1.3.3.1.3.cmml" xref="alg1.l7.m1.3.3.1.3">𝑠</ci><ci id="alg1.l7.m1.3.3.1.4.cmml" xref="alg1.l7.m1.3.3.1.4">𝑐</ci><ci id="alg1.l7.m1.3.3.1.5.cmml" xref="alg1.l7.m1.3.3.1.5">𝑜</ci><ci id="alg1.l7.m1.3.3.1.6.cmml" xref="alg1.l7.m1.3.3.1.6">𝑟</ci><ci id="alg1.l7.m1.3.3.1.7.cmml" xref="alg1.l7.m1.3.3.1.7">𝑒</ci><apply id="alg1.l7.m1.3.3.1.1.2.cmml" xref="alg1.l7.m1.3.3.1.1.1"><csymbol cd="latexml" id="alg1.l7.m1.3.3.1.1.2.1.cmml" xref="alg1.l7.m1.3.3.1.1.1.2">delimited-[]</csymbol><apply id="alg1.l7.m1.3.3.1.1.1.1.cmml" xref="alg1.l7.m1.3.3.1.1.1.1"><times id="alg1.l7.m1.3.3.1.1.1.1.1.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.1"></times><ci id="alg1.l7.m1.3.3.1.1.1.1.2.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.2">𝑖</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.3.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.3">𝑡</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.4.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.4">𝑒</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.5.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.5">𝑚</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.6.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.6">_</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.7.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.7">𝑖</ci><ci id="alg1.l7.m1.3.3.1.1.1.1.8.cmml" xref="alg1.l7.m1.3.3.1.1.1.1.8">𝑑</ci></apply></apply></apply><apply id="alg1.l7.m1.4.4.2.cmml" xref="alg1.l7.m1.4.4.2"><apply id="alg1.l7.m1.4.4.2.2.cmml" xref="alg1.l7.m1.4.4.2.2"><csymbol cd="ambiguous" id="alg1.l7.m1.4.4.2.2.1.cmml" xref="alg1.l7.m1.4.4.2.2">superscript</csymbol><apply id="alg1.l7.m1.4.4.2.2.2.cmml" xref="alg1.l7.m1.4.4.2.2"><csymbol cd="ambiguous" id="alg1.l7.m1.4.4.2.2.2.1.cmml" xref="alg1.l7.m1.4.4.2.2">subscript</csymbol><sum id="alg1.l7.m1.4.4.2.2.2.2.cmml" xref="alg1.l7.m1.4.4.2.2.2.2"></sum><apply id="alg1.l7.m1.4.4.2.2.2.3.cmml" xref="alg1.l7.m1.4.4.2.2.2.3"><eq id="alg1.l7.m1.4.4.2.2.2.3.1.cmml" xref="alg1.l7.m1.4.4.2.2.2.3.1"></eq><ci id="alg1.l7.m1.4.4.2.2.2.3.2.cmml" xref="alg1.l7.m1.4.4.2.2.2.3.2">𝑘</ci><cn id="alg1.l7.m1.4.4.2.2.2.3.3.cmml" type="integer" xref="alg1.l7.m1.4.4.2.2.2.3.3">1</cn></apply></apply><ci id="alg1.l7.m1.4.4.2.2.3.cmml" xref="alg1.l7.m1.4.4.2.2.3">𝑚</ci></apply><apply id="alg1.l7.m1.4.4.2.1.cmml" xref="alg1.l7.m1.4.4.2.1"><times id="alg1.l7.m1.4.4.2.1.2.cmml" xref="alg1.l7.m1.4.4.2.1.2"></times><ci id="alg1.l7.m1.4.4.2.1.3.cmml" xref="alg1.l7.m1.4.4.2.1.3">𝑆</ci><interval closure="closed" id="alg1.l7.m1.4.4.2.1.1.2.cmml" xref="alg1.l7.m1.4.4.2.1.1.1"><ci id="alg1.l7.m1.2.2.cmml" xref="alg1.l7.m1.2.2">𝑘</ci><apply id="alg1.l7.m1.4.4.2.1.1.1.1.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1"><times id="alg1.l7.m1.4.4.2.1.1.1.1.2.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.2"></times><ci id="alg1.l7.m1.4.4.2.1.1.1.1.3.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.3">𝐺</ci><interval closure="closed" id="alg1.l7.m1.4.4.2.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1"><apply id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1"><times id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.1"></times><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.2">𝑖</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.3.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.3">𝑡</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.4.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.4">𝑒</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.5.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.5">𝑚</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.6.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.6">_</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.7.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.7">𝑖</ci><ci id="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.8.cmml" xref="alg1.l7.m1.4.4.2.1.1.1.1.1.1.1.8">𝑑</ci></apply><ci id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1">𝑘</ci></interval></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.4c">score[item\_id]\leftarrow\sum_{k=1}^{m}S[k,G[item\_id,k]]</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m1.4d">italic_s italic_c italic_o italic_r italic_e [ italic_i italic_t italic_e italic_m _ italic_i italic_d ] ← ∑ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT italic_S [ italic_k , italic_G [ italic_i italic_t italic_e italic_m _ italic_i italic_d , italic_k ] ]</annotation></semantics></math><span class="ltx_text" id="alg1.l7.4" style="font-size:90%;"> </span><span class="ltx_text" id="alg1.l7.1" style="font-size:90%;float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l7.1.m1.1"><semantics id="alg1.l7.1.m1.1a"><mo id="alg1.l7.1.m1.1.1" xref="alg1.l7.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l7.1.m1.1b"><ci id="alg1.l7.1.m1.1.1.cmml" xref="alg1.l7.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.1.m1.1d">▷</annotation></semantics></math> Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S3.E5" title="In 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">5</span></a>)
</span>
</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l8.1.1.1" style="font-size:80%;">8:</span></span><span class="ltx_text ltx_font_bold" id="alg1.l8.2" style="font-size:90%;">end</span><span class="ltx_text" id="alg1.l8.3" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l8.4" style="font-size:90%;">for</span>
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l9.4.1.1" style="font-size:80%;">9:</span></span><span class="ltx_text ltx_font_bold" id="alg1.l9.5" style="font-size:90%;">return</span><span class="ltx_text" id="alg1.l9.6" style="font-size:90%;"> TopK(</span><math alttext="score" class="ltx_Math" display="inline" id="alg1.l9.m1.1"><semantics id="alg1.l9.m1.1a"><mrow id="alg1.l9.m1.1.1" xref="alg1.l9.m1.1.1.cmml"><mi id="alg1.l9.m1.1.1.2" mathsize="90%" xref="alg1.l9.m1.1.1.2.cmml">s</mi><mo id="alg1.l9.m1.1.1.1" xref="alg1.l9.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l9.m1.1.1.3" mathsize="90%" xref="alg1.l9.m1.1.1.3.cmml">c</mi><mo id="alg1.l9.m1.1.1.1a" xref="alg1.l9.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l9.m1.1.1.4" mathsize="90%" xref="alg1.l9.m1.1.1.4.cmml">o</mi><mo id="alg1.l9.m1.1.1.1b" xref="alg1.l9.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l9.m1.1.1.5" mathsize="90%" xref="alg1.l9.m1.1.1.5.cmml">r</mi><mo id="alg1.l9.m1.1.1.1c" xref="alg1.l9.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l9.m1.1.1.6" mathsize="90%" xref="alg1.l9.m1.1.1.6.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.1b"><apply id="alg1.l9.m1.1.1.cmml" xref="alg1.l9.m1.1.1"><times id="alg1.l9.m1.1.1.1.cmml" xref="alg1.l9.m1.1.1.1"></times><ci id="alg1.l9.m1.1.1.2.cmml" xref="alg1.l9.m1.1.1.2">𝑠</ci><ci id="alg1.l9.m1.1.1.3.cmml" xref="alg1.l9.m1.1.1.3">𝑐</ci><ci id="alg1.l9.m1.1.1.4.cmml" xref="alg1.l9.m1.1.1.4">𝑜</ci><ci id="alg1.l9.m1.1.1.5.cmml" xref="alg1.l9.m1.1.1.5">𝑟</ci><ci id="alg1.l9.m1.1.1.6.cmml" xref="alg1.l9.m1.1.1.6">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.1c">score</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.m1.1d">italic_s italic_c italic_o italic_r italic_e</annotation></semantics></math><span class="ltx_text" id="alg1.l9.7" style="font-size:90%;">, </span><math alttext="K" class="ltx_Math" display="inline" id="alg1.l9.m2.1"><semantics id="alg1.l9.m2.1a"><mi id="alg1.l9.m2.1.1" mathsize="90%" xref="alg1.l9.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.l9.m2.1b"><ci id="alg1.l9.m2.1.1.cmml" xref="alg1.l9.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m2.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.m2.1d">italic_K</annotation></semantics></math><span class="ltx_text" id="alg1.l9.8" style="font-size:90%;">) </span><span class="ltx_text" id="alg1.l9.3" style="font-size:90%;float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l9.1.m1.1"><semantics id="alg1.l9.1.m1.1a"><mo id="alg1.l9.1.m1.1.1" xref="alg1.l9.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l9.1.m1.1b"><ci id="alg1.l9.1.m1.1.1.cmml" xref="alg1.l9.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.1.m1.1d">▷</annotation></semantics></math> Returns a list of <math alttext="\langle" class="ltx_Math" display="inline" id="alg1.l9.2.m2.1"><semantics id="alg1.l9.2.m2.1a"><mo id="alg1.l9.2.m2.1.1" stretchy="false" xref="alg1.l9.2.m2.1.1.cmml">⟨</mo><annotation-xml encoding="MathML-Content" id="alg1.l9.2.m2.1b"><ci id="alg1.l9.2.m2.1.1.cmml" xref="alg1.l9.2.m2.1.1">⟨</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.2.m2.1c">\langle</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.2.m2.1d">⟨</annotation></semantics></math>ItemId, Score<math alttext="\rangle" class="ltx_Math" display="inline" id="alg1.l9.3.m3.1"><semantics id="alg1.l9.3.m3.1a"><mo id="alg1.l9.3.m3.1.1" stretchy="false" xref="alg1.l9.3.m3.1.1.cmml">⟩</mo><annotation-xml encoding="MathML-Content" id="alg1.l9.3.m3.1b"><ci id="alg1.l9.3.m3.1.1.cmml" xref="alg1.l9.3.m3.1.1">⟩</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.3.m3.1c">\rangle</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.3.m3.1d">⟩</annotation></semantics></math> pairs
</span>
</div>
</div>
</figure>
<div class="ltx_para" id="S3.p6">
<p class="ltx_p" id="S3.p6.1">Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg1" title="Algorithm 1 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a> illustrates the PQTopK in pseudo-code. Note that the algorithm has two loops: the outer loop (line <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg1.l6" title="In Algorithm 1 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">6</span></a>) iterates over the items in the catalogue, and the inner loop (line <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg1.l7" title="In Algorithm 1 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">7</span></a>) iterates over codes associated with the item. However, as the item scores are independent of each other, both loops can be efficiently parallelised<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span><span class="ltx_text" id="footnote2.1">We achieve parallelisation using Tensorflow accelerated computation framework.</span></span></span></span><span class="ltx_text" id="S3.p6.1.1">.</span></p>
</div>
<div class="ltx_para" id="S3.p7">
<p class="ltx_p" id="S3.p7.1">The original RecJPQ <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite> code is also based on the same idea of pre-computing item scores and then computing item scores as the sum of associated sub-id scores. However, in RecJPQ, the order of loops is swapped compared to the PQTopK algorithm: the outer loop iterates over the splits, and in the inner loop, the scores for each item are accumulated <span class="ltx_text" id="S3.p7.1.1">for each item<span class="ltx_text" id="S3.p7.1.1.1"> (<span class="ltx_text" id="S3.p7.1.1.1.1">we list RecJPQ’s original scoring algorithm in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg2" title="Algorithm 2 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a><span class="ltx_text" id="S3.p7.1.1.1.1.1">). Due to the <span class="ltx_text" id="S3.p7.1.1.1.1.1.1">iterative accumulation of item scores<span class="ltx_text" id="S3.p7.1.1.1.1.1.1.1">, the outer loop in RecJPQ’s scoring algorithm is not parallelised. <span class="ltx_text" id="S3.p7.1.1.1.1.1.1.1.1">In Section <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5" title="5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">5</span></a>, we show<span class="ltx_text" id="S3.p7.1.1.1.1.1.1.1.1.1"> that this makes RecJPQ’s scoring algorithm less efficient compared to PQTopK.</span></span></span></span></span></span></span></span></p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg2">
<figcaption class="ltx_caption" style="font-size:90%;"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.17.1.1">Algorithm 2</span> </span> RecJPQScore(<math alttext="G" class="ltx_Math" display="inline" id="alg2.5.m1.1"><semantics id="alg2.5.m1.1b"><mi id="alg2.5.m1.1.1" xref="alg2.5.m1.1.1.cmml">G</mi><annotation-xml encoding="MathML-Content" id="alg2.5.m1.1c"><ci id="alg2.5.m1.1.1.cmml" xref="alg2.5.m1.1.1">𝐺</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.5.m1.1d">G</annotation><annotation encoding="application/x-llamapun" id="alg2.5.m1.1e">italic_G</annotation></semantics></math>, <math alttext="S" class="ltx_Math" display="inline" id="alg2.6.m2.1"><semantics id="alg2.6.m2.1b"><mi id="alg2.6.m2.1.1" xref="alg2.6.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg2.6.m2.1c"><ci id="alg2.6.m2.1.1.cmml" xref="alg2.6.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.6.m2.1d">S</annotation><annotation encoding="application/x-llamapun" id="alg2.6.m2.1e">italic_S</annotation></semantics></math>, <math alttext="K" class="ltx_Math" display="inline" id="alg2.7.m3.1"><semantics id="alg2.7.m3.1b"><mi id="alg2.7.m3.1.1" xref="alg2.7.m3.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg2.7.m3.1c"><ci id="alg2.7.m3.1.1.cmml" xref="alg2.7.m3.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.7.m3.1d">K</annotation><annotation encoding="application/x-llamapun" id="alg2.7.m3.1e">italic_K</annotation></semantics></math>, <math alttext="V" class="ltx_Math" display="inline" id="alg2.8.m4.1"><semantics id="alg2.8.m4.1b"><mi id="alg2.8.m4.1.1" xref="alg2.8.m4.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="alg2.8.m4.1c"><ci id="alg2.8.m4.1.1.cmml" xref="alg2.8.m4.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.8.m4.1d">V</annotation><annotation encoding="application/x-llamapun" id="alg2.8.m4.1e">italic_V</annotation></semantics></math>) Scoring algorithm <span class="ltx_text" id="alg2.18.2">originally<span class="ltx_text" id="alg2.18.2.1"> used in RecJPQ.</span></span></figcaption>
<div class="ltx_listing ltx_listing" id="alg2.19">
<div class="ltx_listingline" id="alg2.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l1.1.1.1" style="font-size:80%;">1:</span></span><math alttext="G" class="ltx_Math" display="inline" id="alg2.l1.m1.1"><semantics id="alg2.l1.m1.1a"><mi id="alg2.l1.m1.1.1" mathsize="90%" xref="alg2.l1.m1.1.1.cmml">G</mi><annotation-xml encoding="MathML-Content" id="alg2.l1.m1.1b"><ci id="alg2.l1.m1.1.1.cmml" xref="alg2.l1.m1.1.1">𝐺</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m1.1c">G</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m1.1d">italic_G</annotation></semantics></math><span class="ltx_text" id="alg2.l1.2" style="font-size:90%;"> is the codebook (mapping: item id </span><math alttext="\rightarrow" class="ltx_Math" display="inline" id="alg2.l1.m2.1"><semantics id="alg2.l1.m2.1a"><mo id="alg2.l1.m2.1.1" mathsize="90%" stretchy="false" xref="alg2.l1.m2.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="alg2.l1.m2.1b"><ci id="alg2.l1.m2.1.1.cmml" xref="alg2.l1.m2.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m2.1c">\rightarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m2.1d">→</annotation></semantics></math><span class="ltx_text" id="alg2.l1.3" style="font-size:90%;"> sub-item ids), Eq. (</span><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S2.E1" style="font-size:90%;" title="In Sub-Id based recommendation ‣ 2. Background ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a><span class="ltx_text" id="alg2.l1.4" style="font-size:90%;">)
</span>
</div>
<div class="ltx_listingline" id="alg2.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l2.1.1.1" style="font-size:80%;">2:</span></span><math alttext="S" class="ltx_Math" display="inline" id="alg2.l2.m1.1"><semantics id="alg2.l2.m1.1a"><mi id="alg2.l2.m1.1.1" mathsize="90%" xref="alg2.l2.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg2.l2.m1.1b"><ci id="alg2.l2.m1.1.1.cmml" xref="alg2.l2.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l2.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="alg2.l2.m1.1d">italic_S</annotation></semantics></math><span class="ltx_text" id="alg2.l2.2" style="font-size:90%;"> is the matrix of pre-computed sub-item scores, indexed by split and sub-item, Eq. (</span><a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S3.E4" style="font-size:90%;" title="In 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">4</span></a><span class="ltx_text" id="alg2.l2.3" style="font-size:90%;">)
</span>
</div>
<div class="ltx_listingline" id="alg2.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3.1.1.1" style="font-size:80%;">3:</span></span><math alttext="K" class="ltx_Math" display="inline" id="alg2.l3.m1.1"><semantics id="alg2.l3.m1.1a"><mi id="alg2.l3.m1.1.1" mathsize="90%" xref="alg2.l3.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg2.l3.m1.1b"><ci id="alg2.l3.m1.1.1.cmml" xref="alg2.l3.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg2.l3.m1.1d">italic_K</annotation></semantics></math><span class="ltx_text" id="alg2.l3.2" style="font-size:90%;"> is the number of results to return
</span>
</div>
<div class="ltx_listingline" id="alg2.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l4.1.1.1" style="font-size:80%;">4:</span></span><math alttext="V\subseteq I" class="ltx_Math" display="inline" id="alg2.l4.m1.1"><semantics id="alg2.l4.m1.1a"><mrow id="alg2.l4.m1.1.1" xref="alg2.l4.m1.1.1.cmml"><mi id="alg2.l4.m1.1.1.2" mathsize="90%" xref="alg2.l4.m1.1.1.2.cmml">V</mi><mo id="alg2.l4.m1.1.1.1" mathsize="90%" xref="alg2.l4.m1.1.1.1.cmml">⊆</mo><mi id="alg2.l4.m1.1.1.3" mathsize="90%" xref="alg2.l4.m1.1.1.3.cmml">I</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l4.m1.1b"><apply id="alg2.l4.m1.1.1.cmml" xref="alg2.l4.m1.1.1"><subset id="alg2.l4.m1.1.1.1.cmml" xref="alg2.l4.m1.1.1.1"></subset><ci id="alg2.l4.m1.1.1.2.cmml" xref="alg2.l4.m1.1.1.2">𝑉</ci><ci id="alg2.l4.m1.1.1.3.cmml" xref="alg2.l4.m1.1.1.3">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m1.1c">V\subseteq I</annotation><annotation encoding="application/x-llamapun" id="alg2.l4.m1.1d">italic_V ⊆ italic_I</annotation></semantics></math><span class="ltx_text" id="alg2.l4.2" style="font-size:90%;"> are the items to score; all items (</span><math alttext="V=I" class="ltx_Math" display="inline" id="alg2.l4.m2.1"><semantics id="alg2.l4.m2.1a"><mrow id="alg2.l4.m2.1.1" xref="alg2.l4.m2.1.1.cmml"><mi id="alg2.l4.m2.1.1.2" mathsize="90%" xref="alg2.l4.m2.1.1.2.cmml">V</mi><mo id="alg2.l4.m2.1.1.1" mathsize="90%" xref="alg2.l4.m2.1.1.1.cmml">=</mo><mi id="alg2.l4.m2.1.1.3" mathsize="90%" xref="alg2.l4.m2.1.1.3.cmml">I</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l4.m2.1b"><apply id="alg2.l4.m2.1.1.cmml" xref="alg2.l4.m2.1.1"><eq id="alg2.l4.m2.1.1.1.cmml" xref="alg2.l4.m2.1.1.1"></eq><ci id="alg2.l4.m2.1.1.2.cmml" xref="alg2.l4.m2.1.1.2">𝑉</ci><ci id="alg2.l4.m2.1.1.3.cmml" xref="alg2.l4.m2.1.1.3">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m2.1c">V=I</annotation><annotation encoding="application/x-llamapun" id="alg2.l4.m2.1d">italic_V = italic_I</annotation></semantics></math><span class="ltx_text" id="alg2.l4.3" style="font-size:90%;">) if not given
</span>
</div>
<div class="ltx_listingline" id="alg2.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l5.1.1.1" style="font-size:80%;">5:</span></span><math alttext="scores\leftarrow" class="ltx_Math" display="inline" id="alg2.l5.m1.1"><semantics id="alg2.l5.m1.1a"><mrow id="alg2.l5.m1.1.1" xref="alg2.l5.m1.1.1.cmml"><mrow id="alg2.l5.m1.1.1.2" xref="alg2.l5.m1.1.1.2.cmml"><mi id="alg2.l5.m1.1.1.2.2" mathsize="90%" xref="alg2.l5.m1.1.1.2.2.cmml">s</mi><mo id="alg2.l5.m1.1.1.2.1" xref="alg2.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.3" mathsize="90%" xref="alg2.l5.m1.1.1.2.3.cmml">c</mi><mo id="alg2.l5.m1.1.1.2.1a" xref="alg2.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.4" mathsize="90%" xref="alg2.l5.m1.1.1.2.4.cmml">o</mi><mo id="alg2.l5.m1.1.1.2.1b" xref="alg2.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.5" mathsize="90%" xref="alg2.l5.m1.1.1.2.5.cmml">r</mi><mo id="alg2.l5.m1.1.1.2.1c" xref="alg2.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.6" mathsize="90%" xref="alg2.l5.m1.1.1.2.6.cmml">e</mi><mo id="alg2.l5.m1.1.1.2.1d" xref="alg2.l5.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.7" mathsize="90%" xref="alg2.l5.m1.1.1.2.7.cmml">s</mi></mrow><mo id="alg2.l5.m1.1.1.1" mathsize="90%" stretchy="false" xref="alg2.l5.m1.1.1.1.cmml">←</mo><mi id="alg2.l5.m1.1.1.3" xref="alg2.l5.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m1.1b"><apply id="alg2.l5.m1.1.1.cmml" xref="alg2.l5.m1.1.1"><ci id="alg2.l5.m1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1">←</ci><apply id="alg2.l5.m1.1.1.2.cmml" xref="alg2.l5.m1.1.1.2"><times id="alg2.l5.m1.1.1.2.1.cmml" xref="alg2.l5.m1.1.1.2.1"></times><ci id="alg2.l5.m1.1.1.2.2.cmml" xref="alg2.l5.m1.1.1.2.2">𝑠</ci><ci id="alg2.l5.m1.1.1.2.3.cmml" xref="alg2.l5.m1.1.1.2.3">𝑐</ci><ci id="alg2.l5.m1.1.1.2.4.cmml" xref="alg2.l5.m1.1.1.2.4">𝑜</ci><ci id="alg2.l5.m1.1.1.2.5.cmml" xref="alg2.l5.m1.1.1.2.5">𝑟</ci><ci id="alg2.l5.m1.1.1.2.6.cmml" xref="alg2.l5.m1.1.1.2.6">𝑒</ci><ci id="alg2.l5.m1.1.1.2.7.cmml" xref="alg2.l5.m1.1.1.2.7">𝑠</ci></apply><csymbol cd="latexml" id="alg2.l5.m1.1.1.3.cmml" xref="alg2.l5.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m1.1c">scores\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m1.1d">italic_s italic_c italic_o italic_r italic_e italic_s ←</annotation></semantics></math><span class="ltx_text" id="alg2.l5.2" style="font-size:90%;"> empty array of scores for all items in </span><math alttext="V" class="ltx_Math" display="inline" id="alg2.l5.m2.1"><semantics id="alg2.l5.m2.1a"><mi id="alg2.l5.m2.1.1" mathsize="90%" xref="alg2.l5.m2.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="alg2.l5.m2.1b"><ci id="alg2.l5.m2.1.1.cmml" xref="alg2.l5.m2.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m2.1c">V</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m2.1d">italic_V</annotation></semantics></math><span class="ltx_text" id="alg2.l5.3" style="font-size:90%;">, initialised to 0
</span>
</div>
<div class="ltx_listingline" id="alg2.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l6.2.1.1" style="font-size:80%;">6:</span></span><span class="ltx_text ltx_font_bold" id="alg2.l6.3" style="font-size:90%;">for</span><span class="ltx_text" id="alg2.l6.4" style="font-size:90%;"> </span><math alttext="k\in 1..m" class="ltx_math_unparsed" display="inline" id="alg2.l6.m1.1"><semantics id="alg2.l6.m1.1a"><mrow id="alg2.l6.m1.1b"><mi id="alg2.l6.m1.1.1" mathsize="90%">k</mi><mo id="alg2.l6.m1.1.2" mathsize="90%">∈</mo><mn id="alg2.l6.m1.1.3" mathsize="90%">1</mn><mo id="alg2.l6.m1.1.4" lspace="0em" mathsize="90%" rspace="0.0835em">.</mo><mo id="alg2.l6.m1.1.5" lspace="0.0835em" mathsize="90%" rspace="0.167em">.</mo><mi id="alg2.l6.m1.1.6" mathsize="90%">m</mi></mrow><annotation encoding="application/x-tex" id="alg2.l6.m1.1c">k\in 1..m</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.m1.1d">italic_k ∈ 1 . . italic_m</annotation></semantics></math><span class="ltx_text" id="alg2.l6.5" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l6.6" style="font-size:90%;">do</span><span class="ltx_text" id="alg2.l6.7" style="font-size:90%;"> </span><span class="ltx_text" id="alg2.l6.1" style="font-size:90%;float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg2.l6.1.m1.1"><semantics id="alg2.l6.1.m1.1a"><mo id="alg2.l6.1.m1.1.1" xref="alg2.l6.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg2.l6.1.m1.1b"><ci id="alg2.l6.1.m1.1.1.cmml" xref="alg2.l6.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.1.m1.1d">▷</annotation></semantics></math> Not parallelised in RecJPQ
</span>
</div>
<div class="ltx_listingline" id="alg2.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l7.1.1.1" style="font-size:80%;">7:</span></span><span class="ltx_text" id="alg2.l7.2" style="font-size:90%;">    </span><span class="ltx_text ltx_font_bold" id="alg2.l7.3" style="font-size:90%;">for</span><span class="ltx_text" id="alg2.l7.4" style="font-size:90%;"> </span><math alttext="item\_id\in V" class="ltx_Math" display="inline" id="alg2.l7.m1.1"><semantics id="alg2.l7.m1.1a"><mrow id="alg2.l7.m1.1.1" xref="alg2.l7.m1.1.1.cmml"><mrow id="alg2.l7.m1.1.1.2" xref="alg2.l7.m1.1.1.2.cmml"><mi id="alg2.l7.m1.1.1.2.2" mathsize="90%" xref="alg2.l7.m1.1.1.2.2.cmml">i</mi><mo id="alg2.l7.m1.1.1.2.1" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.3" mathsize="90%" xref="alg2.l7.m1.1.1.2.3.cmml">t</mi><mo id="alg2.l7.m1.1.1.2.1a" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.4" mathsize="90%" xref="alg2.l7.m1.1.1.2.4.cmml">e</mi><mo id="alg2.l7.m1.1.1.2.1b" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.5" mathsize="90%" xref="alg2.l7.m1.1.1.2.5.cmml">m</mi><mo id="alg2.l7.m1.1.1.2.1c" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.6" mathsize="90%" mathvariant="normal" xref="alg2.l7.m1.1.1.2.6.cmml">_</mi><mo id="alg2.l7.m1.1.1.2.1d" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.7" mathsize="90%" xref="alg2.l7.m1.1.1.2.7.cmml">i</mi><mo id="alg2.l7.m1.1.1.2.1e" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.8" mathsize="90%" xref="alg2.l7.m1.1.1.2.8.cmml">d</mi></mrow><mo id="alg2.l7.m1.1.1.1" mathsize="90%" xref="alg2.l7.m1.1.1.1.cmml">∈</mo><mi id="alg2.l7.m1.1.1.3" mathsize="90%" xref="alg2.l7.m1.1.1.3.cmml">V</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m1.1b"><apply id="alg2.l7.m1.1.1.cmml" xref="alg2.l7.m1.1.1"><in id="alg2.l7.m1.1.1.1.cmml" xref="alg2.l7.m1.1.1.1"></in><apply id="alg2.l7.m1.1.1.2.cmml" xref="alg2.l7.m1.1.1.2"><times id="alg2.l7.m1.1.1.2.1.cmml" xref="alg2.l7.m1.1.1.2.1"></times><ci id="alg2.l7.m1.1.1.2.2.cmml" xref="alg2.l7.m1.1.1.2.2">𝑖</ci><ci id="alg2.l7.m1.1.1.2.3.cmml" xref="alg2.l7.m1.1.1.2.3">𝑡</ci><ci id="alg2.l7.m1.1.1.2.4.cmml" xref="alg2.l7.m1.1.1.2.4">𝑒</ci><ci id="alg2.l7.m1.1.1.2.5.cmml" xref="alg2.l7.m1.1.1.2.5">𝑚</ci><ci id="alg2.l7.m1.1.1.2.6.cmml" xref="alg2.l7.m1.1.1.2.6">_</ci><ci id="alg2.l7.m1.1.1.2.7.cmml" xref="alg2.l7.m1.1.1.2.7">𝑖</ci><ci id="alg2.l7.m1.1.1.2.8.cmml" xref="alg2.l7.m1.1.1.2.8">𝑑</ci></apply><ci id="alg2.l7.m1.1.1.3.cmml" xref="alg2.l7.m1.1.1.3">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m1.1c">item\_id\in V</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m1.1d">italic_i italic_t italic_e italic_m _ italic_i italic_d ∈ italic_V</annotation></semantics></math><span class="ltx_text" id="alg2.l7.5" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l7.6" style="font-size:90%;">do</span><span class="ltx_text" id="alg2.l7.7" style="font-size:90%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l8.1.1.1" style="font-size:80%;">8:</span></span><span class="ltx_text" id="alg2.l8.2" style="font-size:90%;">         </span><math alttext="score[item\_id]\mathrel{+}=S[k,G[item\_id,k]]" class="ltx_math_unparsed" display="inline" id="alg2.l8.m1.1"><semantics id="alg2.l8.m1.1a"><mrow id="alg2.l8.m1.1b"><mi id="alg2.l8.m1.1.1" mathsize="90%">s</mi><mi id="alg2.l8.m1.1.2" mathsize="90%">c</mi><mi id="alg2.l8.m1.1.3" mathsize="90%">o</mi><mi id="alg2.l8.m1.1.4" mathsize="90%">r</mi><mi id="alg2.l8.m1.1.5" mathsize="90%">e</mi><mrow id="alg2.l8.m1.1.6"><mo id="alg2.l8.m1.1.6.1" maxsize="90%" minsize="90%">[</mo><mi id="alg2.l8.m1.1.6.2" mathsize="90%">i</mi><mi id="alg2.l8.m1.1.6.3" mathsize="90%">t</mi><mi id="alg2.l8.m1.1.6.4" mathsize="90%">e</mi><mi id="alg2.l8.m1.1.6.5" mathsize="90%">m</mi><mi id="alg2.l8.m1.1.6.6" mathsize="90%" mathvariant="normal">_</mi><mi id="alg2.l8.m1.1.6.7" mathsize="90%">i</mi><mi id="alg2.l8.m1.1.6.8" mathsize="90%">d</mi><mo id="alg2.l8.m1.1.6.9" maxsize="90%" minsize="90%" rspace="0.056em">]</mo></mrow><mo id="alg2.l8.m1.1.7" mathsize="90%" rspace="0em">+</mo><mo id="alg2.l8.m1.1.8" lspace="0em" mathsize="90%">=</mo><mi id="alg2.l8.m1.1.9" mathsize="90%">S</mi><mrow id="alg2.l8.m1.1.10"><mo id="alg2.l8.m1.1.10.1" maxsize="90%" minsize="90%">[</mo><mi id="alg2.l8.m1.1.10.2" mathsize="90%">k</mi><mo id="alg2.l8.m1.1.10.3" mathsize="90%">,</mo><mi id="alg2.l8.m1.1.10.4" mathsize="90%">G</mi><mrow id="alg2.l8.m1.1.10.5"><mo id="alg2.l8.m1.1.10.5.1" maxsize="90%" minsize="90%">[</mo><mi id="alg2.l8.m1.1.10.5.2" mathsize="90%">i</mi><mi id="alg2.l8.m1.1.10.5.3" mathsize="90%">t</mi><mi id="alg2.l8.m1.1.10.5.4" mathsize="90%">e</mi><mi id="alg2.l8.m1.1.10.5.5" mathsize="90%">m</mi><mi id="alg2.l8.m1.1.10.5.6" mathsize="90%" mathvariant="normal">_</mi><mi id="alg2.l8.m1.1.10.5.7" mathsize="90%">i</mi><mi id="alg2.l8.m1.1.10.5.8" mathsize="90%">d</mi><mo id="alg2.l8.m1.1.10.5.9" mathsize="90%">,</mo><mi id="alg2.l8.m1.1.10.5.10" mathsize="90%">k</mi><mo id="alg2.l8.m1.1.10.5.11" maxsize="90%" minsize="90%">]</mo></mrow><mo id="alg2.l8.m1.1.10.6" maxsize="90%" minsize="90%">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg2.l8.m1.1c">score[item\_id]\mathrel{+}=S[k,G[item\_id,k]]</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m1.1d">italic_s italic_c italic_o italic_r italic_e [ italic_i italic_t italic_e italic_m _ italic_i italic_d ] + = italic_S [ italic_k , italic_G [ italic_i italic_t italic_e italic_m _ italic_i italic_d , italic_k ] ]</annotation></semantics></math><span class="ltx_text" id="alg2.l8.3" style="font-size:90%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l9.1.1.1" style="font-size:80%;">9:</span></span><span class="ltx_text" id="alg2.l9.2" style="font-size:90%;">    </span><span class="ltx_text ltx_font_bold" id="alg2.l9.3" style="font-size:90%;">end</span><span class="ltx_text" id="alg2.l9.4" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l9.5" style="font-size:90%;">for</span>
</div>
<div class="ltx_listingline" id="alg2.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l10.1.1.1" style="font-size:80%;">10:</span></span><span class="ltx_text ltx_font_bold" id="alg2.l10.2" style="font-size:90%;">end</span><span class="ltx_text" id="alg2.l10.3" style="font-size:90%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l10.4" style="font-size:90%;">for</span>
</div>
<div class="ltx_listingline" id="alg2.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l11.1.1.1" style="font-size:80%;">11:</span></span><span class="ltx_text ltx_font_bold" id="alg2.l11.2" style="font-size:90%;">return</span><span class="ltx_text" id="alg2.l11.3" style="font-size:90%;"> TopK(</span><math alttext="score" class="ltx_Math" display="inline" id="alg2.l11.m1.1"><semantics id="alg2.l11.m1.1a"><mrow id="alg2.l11.m1.1.1" xref="alg2.l11.m1.1.1.cmml"><mi id="alg2.l11.m1.1.1.2" mathsize="90%" xref="alg2.l11.m1.1.1.2.cmml">s</mi><mo id="alg2.l11.m1.1.1.1" xref="alg2.l11.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.3" mathsize="90%" xref="alg2.l11.m1.1.1.3.cmml">c</mi><mo id="alg2.l11.m1.1.1.1a" xref="alg2.l11.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.4" mathsize="90%" xref="alg2.l11.m1.1.1.4.cmml">o</mi><mo id="alg2.l11.m1.1.1.1b" xref="alg2.l11.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.5" mathsize="90%" xref="alg2.l11.m1.1.1.5.cmml">r</mi><mo id="alg2.l11.m1.1.1.1c" xref="alg2.l11.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.6" mathsize="90%" xref="alg2.l11.m1.1.1.6.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l11.m1.1b"><apply id="alg2.l11.m1.1.1.cmml" xref="alg2.l11.m1.1.1"><times id="alg2.l11.m1.1.1.1.cmml" xref="alg2.l11.m1.1.1.1"></times><ci id="alg2.l11.m1.1.1.2.cmml" xref="alg2.l11.m1.1.1.2">𝑠</ci><ci id="alg2.l11.m1.1.1.3.cmml" xref="alg2.l11.m1.1.1.3">𝑐</ci><ci id="alg2.l11.m1.1.1.4.cmml" xref="alg2.l11.m1.1.1.4">𝑜</ci><ci id="alg2.l11.m1.1.1.5.cmml" xref="alg2.l11.m1.1.1.5">𝑟</ci><ci id="alg2.l11.m1.1.1.6.cmml" xref="alg2.l11.m1.1.1.6">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l11.m1.1c">score</annotation><annotation encoding="application/x-llamapun" id="alg2.l11.m1.1d">italic_s italic_c italic_o italic_r italic_e</annotation></semantics></math><span class="ltx_text" id="alg2.l11.4" style="font-size:90%;">, </span><math alttext="K" class="ltx_Math" display="inline" id="alg2.l11.m2.1"><semantics id="alg2.l11.m2.1a"><mi id="alg2.l11.m2.1.1" mathsize="90%" xref="alg2.l11.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg2.l11.m2.1b"><ci id="alg2.l11.m2.1.1.cmml" xref="alg2.l11.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l11.m2.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg2.l11.m2.1d">italic_K</annotation></semantics></math><span class="ltx_text" id="alg2.l11.5" style="font-size:90%;">)
</span>
</div>
</div>
</figure>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Experimental Setup</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">We designed our experiments to answer two research questions:</p>
<ul class="ltx_itemize" id="S4.I1">
<li class="ltx_item" id="S4.I1.ix1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">RQ1</span>
<div class="ltx_para" id="S4.I1.ix1.p1">
<p class="ltx_p" id="S4.I1.ix1.p1.1">How does PQTopK inference efficiency compare to baseline item scoring methods?</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.ix2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">RQ2</span>
<div class="ltx_para" id="S4.I1.ix2.p1">
<p class="ltx_p" id="S4.I1.ix2.p1.1">How does PQTopK inference efficiency change when increasing the number of items in the catalogue?</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_table" id="S4.T1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1. </span>Salient characteristics of the experimental datasets.</figcaption>
<div class="ltx_inline-block ltx_transformed_outer" id="S4.T1.1" style="width:433.6pt;height:77.3pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(65.4pt,-11.7pt) scale(1.43239941161061,1.43239941161061) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T1.1.1">
<tr class="ltx_tr" id="S4.T1.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T1.1.1.1.1">Dataset</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T1.1.1.1.2">Users</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T1.1.1.1.3">Items</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T1.1.1.1.4">Interactions</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T1.1.1.1.5">Avg. length</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.1.2.1">Booking.com</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T1.1.1.2.2">140,746</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T1.1.1.2.3">34,742</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T1.1.1.2.4">917,729</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T1.1.1.2.5">6.52</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.3">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T1.1.1.3.1">Gowalla</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T1.1.1.3.2">86,168</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T1.1.1.3.3">1,271,638</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T1.1.1.3.4">6,397,903</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T1.1.1.3.5">74.24</td>
</tr>
</table>
</span></div>
</figure>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.2"><span class="ltx_text ltx_font_italic" id="S4.p2.2.1">Datasets.</span> We experiment with two real-world datasets: Booking.com <cite class="ltx_cite ltx_citemacro_citep">(Goldenberg and Levin, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib7" title="">2021</a>)</cite> (<math alttext="\sim" class="ltx_Math" display="inline" id="S4.p2.1.m1.1"><semantics id="S4.p2.1.m1.1a"><mo id="S4.p2.1.m1.1.1" mathcolor="#000000" xref="S4.p2.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.p2.1.m1.1b"><csymbol cd="latexml" id="S4.p2.1.m1.1.1.cmml" xref="S4.p2.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.p2.1.m1.1d">∼</annotation></semantics></math>35K items) and Gowalla <cite class="ltx_cite ltx_citemacro_citep">(Cho et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib6" title="">2011</a>)</cite> (<math alttext="\sim" class="ltx_Math" display="inline" id="S4.p2.2.m2.1"><semantics id="S4.p2.2.m2.1a"><mo id="S4.p2.2.m2.1.1" mathcolor="#000000" xref="S4.p2.2.m2.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.p2.2.m2.1b"><csymbol cd="latexml" id="S4.p2.2.m2.1.1.cmml" xref="S4.p2.2.m2.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.2.m2.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.p2.2.m2.1d">∼</annotation></semantics></math>1.3M items). Following common practice, we remove users with less than five items from the data. Salient characteristics of the experimental data are provided in Table <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S4.T1" title="Table 1 ‣ 4. Experimental Setup ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a>. Additionally, to test the inference speed of different scoring methods, we use simulated data with up to 1 billion items in the catalogue.</p>
</div>
<div class="ltx_para" id="S4.p3">
<p class="ltx_p" id="S4.p3.2"><span class="ltx_text ltx_font_italic" id="S4.p3.2.3">Backbone Models.</span> <span class="ltx_text" id="S4.p3.2.2">In RQ1, <span class="ltx_text" id="S4.p3.2.2.2"> we experiment with two commonly used Transformer models: SASRec and BERT4Rec. To be able to train the models on large catalogues, we replace the item embedding layer with RecJPQ <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>. Moreover, the original BERT4Rec does not use negative sampling, which makes it infeasible to train on large catalogues, such as Gowalla. Hence, to be able to deal with large catalogues, we use gBERT4Rec <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib16" title="">2023</a>)</cite>, a version of BERT4Rec trained with negative sampling and gBCE loss. The configuration of the models follows the details described in the RecJPQ paper <cite class="ltx_cite ltx_citemacro_citep">(Petrov and Macdonald, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib17" title="">2024</a>)</cite>. In particular, we use 512-dimensional embeddings; we use 2 Transformer blocks for SASRec and 3 Transformer blocks for BERT4Rec. When answering RQ1, we use RecJPQ with <math alttext="m=8" class="ltx_Math" display="inline" id="S4.p3.1.1.1.m1.1"><semantics id="S4.p3.1.1.1.m1.1a"><mrow id="S4.p3.1.1.1.m1.1.1" xref="S4.p3.1.1.1.m1.1.1.cmml"><mi id="S4.p3.1.1.1.m1.1.1.2" mathcolor="#000000" xref="S4.p3.1.1.1.m1.1.1.2.cmml">m</mi><mo id="S4.p3.1.1.1.m1.1.1.1" mathcolor="#000000" xref="S4.p3.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S4.p3.1.1.1.m1.1.1.3" mathcolor="#000000" xref="S4.p3.1.1.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.p3.1.1.1.m1.1b"><apply id="S4.p3.1.1.1.m1.1.1.cmml" xref="S4.p3.1.1.1.m1.1.1"><eq id="S4.p3.1.1.1.m1.1.1.1.cmml" xref="S4.p3.1.1.1.m1.1.1.1"></eq><ci id="S4.p3.1.1.1.m1.1.1.2.cmml" xref="S4.p3.1.1.1.m1.1.1.2">𝑚</ci><cn id="S4.p3.1.1.1.m1.1.1.3.cmml" type="integer" xref="S4.p3.1.1.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p3.1.1.1.m1.1c">m=8</annotation><annotation encoding="application/x-llamapun" id="S4.p3.1.1.1.m1.1d">italic_m = 8</annotation></semantics></math> splits but vary <math alttext="m" class="ltx_Math" display="inline" id="S4.p3.2.2.2.m2.1"><semantics id="S4.p3.2.2.2.m2.1a"><mi id="S4.p3.2.2.2.m2.1.1" mathcolor="#000000" xref="S4.p3.2.2.2.m2.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.p3.2.2.2.m2.1b"><ci id="S4.p3.2.2.2.m2.1.1.cmml" xref="S4.p3.2.2.2.m2.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p3.2.2.2.m2.1c">m</annotation><annotation encoding="application/x-llamapun" id="S4.p3.2.2.2.m2.1d">italic_m</annotation></semantics></math> in RQ2. <span class="ltx_text" id="S4.p3.2.2.2.1">In RQ2, we exclude the backbone model from our analysis;<span class="ltx_text" id="S4.p3.2.2.2.1.1"> therefore, <span class="ltx_text" id="S4.p3.2.2.2.1.1.1">the results are model-agnostic and apply to any backbone<span class="ltx_text" id="S4.p3.2.2.2.1.1.1.1">.<span class="ltx_text" id="S4.p3.2.2.2.1.1.1.1.1"></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S4.p4">
<p class="ltx_p" id="S4.p4.1"><span class="ltx_text ltx_font_italic" id="S4.p4.1.1">Scoring Methods.</span> We analyse three scoring methods: (i) Transformer Default, matrix multiplication-based scoring <math alttext="r=W\phi" class="ltx_Math" display="inline" id="S4.p4.1.m1.1"><semantics id="S4.p4.1.m1.1a"><mrow id="S4.p4.1.m1.1.1" xref="S4.p4.1.m1.1.1.cmml"><mi id="S4.p4.1.m1.1.1.2" mathcolor="#000000" xref="S4.p4.1.m1.1.1.2.cmml">r</mi><mo id="S4.p4.1.m1.1.1.1" mathcolor="#000000" xref="S4.p4.1.m1.1.1.1.cmml">=</mo><mrow id="S4.p4.1.m1.1.1.3" xref="S4.p4.1.m1.1.1.3.cmml"><mi id="S4.p4.1.m1.1.1.3.2" mathcolor="#000000" xref="S4.p4.1.m1.1.1.3.2.cmml">W</mi><mo id="S4.p4.1.m1.1.1.3.1" xref="S4.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.p4.1.m1.1.1.3.3" mathcolor="#000000" xref="S4.p4.1.m1.1.1.3.3.cmml">ϕ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p4.1.m1.1b"><apply id="S4.p4.1.m1.1.1.cmml" xref="S4.p4.1.m1.1.1"><eq id="S4.p4.1.m1.1.1.1.cmml" xref="S4.p4.1.m1.1.1.1"></eq><ci id="S4.p4.1.m1.1.1.2.cmml" xref="S4.p4.1.m1.1.1.2">𝑟</ci><apply id="S4.p4.1.m1.1.1.3.cmml" xref="S4.p4.1.m1.1.1.3"><times id="S4.p4.1.m1.1.1.3.1.cmml" xref="S4.p4.1.m1.1.1.3.1"></times><ci id="S4.p4.1.m1.1.1.3.2.cmml" xref="S4.p4.1.m1.1.1.3.2">𝑊</ci><ci id="S4.p4.1.m1.1.1.3.3.cmml" xref="S4.p4.1.m1.1.1.3.3">italic-ϕ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.1.m1.1c">r=W\phi</annotation><annotation encoding="application/x-llamapun" id="S4.p4.1.m1.1d">italic_r = italic_W italic_ϕ</annotation></semantics></math> used by default in SASRec and BERT4Rec <span class="ltx_text" id="S4.p4.1.2">(w/o any PQ enhancements)<span class="ltx_text" id="S4.p4.1.2.1">; (ii) the original RecJPQ <span class="ltx_text" id="S4.p4.1.2.1.1">scoring<span class="ltx_text" id="S4.p4.1.2.1.1.1"> <span class="ltx_text" id="S4.p4.1.2.1.1.1.1">(Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg2" title="Algorithm 2 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a>)<span class="ltx_text" id="S4.p4.1.2.1.1.1.1.1">; (iv) PQTopK scoring (<span class="ltx_text" id="S4.p4.1.2.1.1.1.1.1.1">Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#alg1" title="Algorithm 1 ‣ 3. PQTopK Algorithm ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">1</span></a><span class="ltx_text" id="S4.p4.1.2.1.1.1.1.1.1.1">). We implement<span class="ltx_note ltx_role_footnote" id="footnote3"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span><span class="ltx_text" id="footnote3.1">Code for the paper: <a class="ltx_ref ltx_href" href="https://github.com/asash/RecJPQ-TopK" title="">https://github.com/asash/RecJPQ-TopK</a><span class="ltx_text" id="footnote3.1.1">.</span></span></span></span></span> all algorithms using TensorFlow <cite class="ltx_cite ltx_citemacro_citep">(Abadi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#bib.bib4" title="">2016</a>)</cite>.</span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S4.p5">
<p class="ltx_p" id="S4.p5.1"><span class="ltx_text ltx_font_italic" id="S4.p5.1.1">Metrics.</span> Our main focus is on the model inference speed. We measure inference using the median response time <span class="ltx_text" id="S4.p5.1.2">per user<span class="ltx_text" id="S4.p5.1.2.1"> (mRT, time required by the model to return recommendations). We do not use GPU acceleration when measuring any response time <span class="ltx_text" id="S4.p5.1.2.1.1">(details of our hardware configuration are in Table <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.T2" title="Table 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a>)<span class="ltx_text" id="S4.p5.1.2.1.1.1">. We separately measure total response time, time spent by the model for running the backbone Transformer model, and time spent by the scoring algorithm. For completeness, we also report effectiveness using NDCG@10, even though optimising model effectiveness is outside of the scope of the paper <span class="ltx_text" id="S4.p5.1.2.1.1.1.1">and all scoring methods for RecJPQ-based models have the same effectiveness<span class="ltx_text" id="S4.p5.1.2.1.1.1.1.1">.</span></span></span></span></span></span></p>
</div>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Analysis</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1"><span class="ltx_text ltx_font_italic" id="S5.p1.1.1">RQ1. Comparison of PQTopK and other scoring methods.</span> Table <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.T3" title="Table 3 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">3</span></a> reports effectiveness and efficiency metrics for SASRec and BERT4Rec on both Booking.com and Gowalla datasets. We first observe that nDCG@10 values do not depend on the scoring method, as all algorithms compute the same score distribution. We also see that <span class="ltx_text" id="S5.p1.1.2">the model backbone model inference time<span class="ltx_text" id="S5.p1.1.2.1"> does not depend on the scoring method as well, as different scoring methods are applied on top of the backbone Transformer model (i.e. we use different “heads” in Transformer terminology). Interestingly, the time required by the backbone Transformer model does not depend on the dataset either: e.g., BERT4Rec requires roughly 37 milliseconds on both Booking and Gowalla, while SASRec requires roughly 24 milliseconds. This makes sense as Transformer complexity depends on the embedding dimensionality, the number of Transformer blocks and the sequence length but not on the number of items in the catalogue.</span></span></p>
</div>
<div class="ltx_para" id="S5.p2">
<p class="ltx_p" id="S5.p2.1">On the smaller Booking.com dataset, we see that <span class="ltx_text" id="S5.p2.1.1">the running time of the backbone Transformer model dominates the total model response time<span class="ltx_text" id="S5.p2.1.1.1">, and the differences between different scoring methods are rather unimportant. For example, when using gBERT4Rec on this dataset, the slowest scoring method (Transformer Default) requires 43 milliseconds per user. In contrast, the faster method (PQTopK) requires 40 milliseconds (<math alttext="\Delta" class="ltx_Math" display="inline" id="S5.p2.1.1.1.m1.1"><semantics id="S5.p2.1.1.1.m1.1a"><mi id="S5.p2.1.1.1.m1.1.1" mathcolor="#000000" mathvariant="normal" xref="S5.p2.1.1.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.p2.1.1.1.m1.1b"><ci id="S5.p2.1.1.1.m1.1.1.cmml" xref="S5.p2.1.1.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p2.1.1.1.m1.1c">\Delta</annotation><annotation encoding="application/x-llamapun" id="S5.p2.1.1.1.m1.1d">roman_Δ</annotation></semantics></math>¡10%) – <span class="ltx_text" id="S5.p2.1.1.1.1">even though PQTopK is two times faster compared to Transformer Default scoring when comparing without the backbone model inference.<span class="ltx_text" id="S5.p2.1.1.1.1.1"> In contrast, on the larger Gowalla dataset with more than 1M items, there is a large difference between different scoring methods. For example, when using Default Transformer scoring with SASRec, inference time is dominated by the item scoring (131ms out of 171ms).</span></span></span></span></p>
</div>
<figure class="ltx_table" id="S5.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2. </span>Hardware Configuration</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S5.T2.1">
<tr class="ltx_tr" id="S5.T2.1.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S5.T2.1.1.1">CPU</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.1.1.2">AMD Ryzen 5950x</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.2">
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.2.1">Memory</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.2.2">128 GB DDR4</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.3">
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.3.1">OS</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.3.2">Ubuntu 22.04.3 LTS</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.4">
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.4.1">Accelerated computing framework</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.4.2">TensorFlow 2.11.0</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.5">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T2.1.5.1">GPU Acceleration</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.1.5.2">Not used</td>
</tr>
</table>
</figure>
<figure class="ltx_table" id="S5.T3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 3. </span>Efficiency analysis of item scoring methods. mRT is the Median Response Time, measured in milliseconds; SAS is the SASRec model and BERT is the gBERT4Rec model.</figcaption>
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1">
<tr class="ltx_tr" id="S5.T3.1.1">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.1"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="S5.T3.1.1.2"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="3" id="S5.T3.1.1.3">Dataset: Booking</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="3" id="S5.T3.1.1.4">Dataset: Gowalla</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.2.1"></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T3.1.2.2">
<span class="ltx_text" id="S5.T3.1.2.2.1"></span><span class="ltx_text" id="S5.T3.1.2.2.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.2.2.1">
<span class="ltx_tr" id="S5.T3.1.2.2.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_left" id="S5.T3.1.2.2.2.1.1.1">Scoring</span></span>
<span class="ltx_tr" id="S5.T3.1.2.2.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_left" id="S5.T3.1.2.2.2.1.2.1">method</span></span>
</span></span><span class="ltx_text" id="S5.T3.1.2.2.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.2.3">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.3.1">
<tr class="ltx_tr" id="S5.T3.1.2.3.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.3.1.1.1">mRT</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.3.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.3.1.2.1">(Scoring)</td>
</tr>
</table>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.2.4">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.4.1">
<tr class="ltx_tr" id="S5.T3.1.2.4.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.4.1.1.1">mRT</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.4.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.4.1.2.1">(Total)</td>
</tr>
</table>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.2.5">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.5.1">
<tr class="ltx_tr" id="S5.T3.1.2.5.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.5.1.1.1">Backbone</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.5.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.5.1.2.1">measures</td>
</tr>
</table>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.2.6">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.6.1">
<tr class="ltx_tr" id="S5.T3.1.2.6.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.6.1.1.1">mRT</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.6.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.6.1.2.1">(Scoring)</td>
</tr>
</table>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.2.7">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.7.1">
<tr class="ltx_tr" id="S5.T3.1.2.7.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.7.1.1.1">mRT</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.7.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.2.7.1.2.1">(Total)</td>
</tr>
</table>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.2.8">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.1.2.8.1">
<tr class="ltx_tr" id="S5.T3.1.2.8.1.1">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S5.T3.1.2.8.1.1.1">Backbone</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.2.8.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S5.T3.1.2.8.1.2.1">measures</td>
</tr>
</table>
</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.3">
<td class="ltx_td ltx_align_left ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.3.1" rowspan="3"><span class="ltx_text" id="S5.T3.1.3.1.1">
<span class="ltx_inline-block ltx_transformed_outer" id="S5.T3.1.3.1.1.1" style="width:6.8pt;height:27.6pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="width:27.6pt;transform:translate(-10.4pt,-10.4pt) rotate(-90deg) ;">
<span class="ltx_p" id="S5.T3.1.3.1.1.1.1">BERT</span>
</span></span></span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T3.1.3.2">Default</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.3.3">6.22</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.3.4">43.37</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T3.1.3.5" rowspan="3"><span class="ltx_text" id="S5.T3.1.3.5.1">
<span class="ltx_tabular ltx_align_middle" id="S5.T3.1.3.5.1.1">
<span class="ltx_tr" id="S5.T3.1.3.5.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.5.1.1.1.1">NDCG@10: 0.328</span></span>
<span class="ltx_tr" id="S5.T3.1.3.5.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.5.1.1.2.1">Model mRT:</span></span>
<span class="ltx_tr" id="S5.T3.1.3.5.1.1.3">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.5.1.1.3.1">37.16</span></span>
</span></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.3.6">133.40</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.3.7">171.04</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.3.8" rowspan="3"><span class="ltx_text" id="S5.T3.1.3.8.1">
<span class="ltx_tabular ltx_align_middle" id="S5.T3.1.3.8.1.1">
<span class="ltx_tr" id="S5.T3.1.3.8.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.8.1.1.1.1">NDCG@10: 0.168</span></span>
<span class="ltx_tr" id="S5.T3.1.3.8.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.8.1.1.2.1">Model mRT:</span></span>
<span class="ltx_tr" id="S5.T3.1.3.8.1.1.3">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.3.8.1.1.3.1">37.52</span></span>
</span></span></td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T3.1.4.1">RecJPQ</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.4.2">3.90</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.4.3">41.08</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.4.4">33.87</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.4.5">71.42</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.5">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T3.1.5.1"><span class="ltx_text" id="S5.T3.1.5.1.1">PQTopK</span></td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.5.2"><span class="ltx_text ltx_font_bold" id="S5.T3.1.5.2.1">3.09</span></td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.5.3"><span class="ltx_text ltx_font_bold" id="S5.T3.1.5.3.1">40.23</span></td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.5.4"><span class="ltx_text ltx_font_bold" id="S5.T3.1.5.4.1">13.79</span></td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.5.5"><span class="ltx_text ltx_font_bold" id="S5.T3.1.5.5.1">51.33</span></td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.6">
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.6.1" rowspan="3"><span class="ltx_text" id="S5.T3.1.6.1.1">
<span class="ltx_inline-block ltx_transformed_outer" id="S5.T3.1.6.1.1.1" style="width:6.8pt;height:18.6pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="width:18.6pt;transform:translate(-5.89pt,-5.89pt) rotate(-90deg) ;">
<span class="ltx_p" id="S5.T3.1.6.1.1.1.1">SAS</span>
</span></span></span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T3.1.6.2">Default</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.6.3">6.27</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.6.4">30.03</td>
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_r ltx_border_t" id="S5.T3.1.6.5" rowspan="3"><span class="ltx_text" id="S5.T3.1.6.5.1">
<span class="ltx_tabular ltx_align_middle" id="S5.T3.1.6.5.1.1">
<span class="ltx_tr" id="S5.T3.1.6.5.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.5.1.1.1.1">NDCG@10: 0.188</span></span>
<span class="ltx_tr" id="S5.T3.1.6.5.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.5.1.1.2.1">Model mRT:</span></span>
<span class="ltx_tr" id="S5.T3.1.6.5.1.1.3">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.5.1.1.3.1">23.75</span></span>
</span></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.6.6">131.35</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.6.7">156.07</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S5.T3.1.6.8" rowspan="3"><span class="ltx_text" id="S5.T3.1.6.8.1">
<span class="ltx_tabular ltx_align_middle" id="S5.T3.1.6.8.1.1">
<span class="ltx_tr" id="S5.T3.1.6.8.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.8.1.1.1.1">NDCG@10: 0.120</span></span>
<span class="ltx_tr" id="S5.T3.1.6.8.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.8.1.1.2.1">Model mRT:</span></span>
<span class="ltx_tr" id="S5.T3.1.6.8.1.1.3">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.1.6.8.1.1.3.1">24.67</span></span>
</span></span></td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.7">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T3.1.7.1">RecJPQ</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.7.2">3.77</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.7.3">27.53</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.7.4">29.65</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.7.5">54.32</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.8">
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_r" id="S5.T3.1.8.1"><span class="ltx_text" id="S5.T3.1.8.1.1">PQTopK</span></td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T3.1.8.2"><span class="ltx_text ltx_font_bold" id="S5.T3.1.8.2.1">2.93</span></td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T3.1.8.3"><span class="ltx_text ltx_font_bold" id="S5.T3.1.8.3.1">26.69</span></td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T3.1.8.4"><span class="ltx_text ltx_font_bold" id="S5.T3.1.8.4.1">10.03</span></td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T3.1.8.5"><span class="ltx_text ltx_font_bold" id="S5.T3.1.8.5.1">34.72</span></td>
</tr>
</table>
</figure>
<div class="ltx_para" id="S5.p3">
<p class="ltx_p" id="S5.p3.2">When using <span class="ltx_text" id="S5.p3.2.2">SASRec as the backbone with RecJPQ scoring<span class="ltx_text" id="S5.p3.2.2.2">, both <span class="ltx_text" id="S5.p3.2.2.2.2">the backbone and the scoring head<span class="ltx_text" id="S5.p3.2.2.2.2.2"> contribute <span class="ltx_text" id="S5.p3.2.2.2.2.2.2">similarly<span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2"> towards total scoring time (SASRec takes 24ms while scoring takes 29ms). <span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2">In contrast<span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2.2">, when using PQTopK, the total time <span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2.2.2">is dominated by<span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2"> the Transformer model itself (e.g., PQTopK only uses 10<span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2">ms.<span class="ltx_text" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2"> out of 34 when using the SASRec backbone). If we isolate scoring time, the Gowalla with SASRec backbone dataset with PQTopK is 13<math alttext="\times" class="ltx_Math" display="inline" id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1"><semantics id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1a"><mo id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1b"><times id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S5.p3.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1d">×</annotation></semantics></math> faster than the Transformer default and <math alttext="3\times" class="ltx_math_unparsed" display="inline" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1"><semantics id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1a"><mrow id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1b"><mn id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1.1" mathcolor="#000000">3</mn><mo id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1.2" lspace="0.222em" mathcolor="#000000">×</mo></mrow><annotation encoding="application/x-tex" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1c">3\times</annotation><annotation encoding="application/x-llamapun" id="S5.p3.2.2.2.2.2.2.2.2.2.2.2.2.2.m2.1d">3 ×</annotation></semantics></math> faster than RecJPQ scoring.</span></span></span></span></span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p4">
<p class="ltx_p" id="S5.p4.1">In summary, answering RQ1, we find that PQTopK is the most efficient method among the baselines. <span class="ltx_text" id="S5.p4.1.1">On the Gowalla dataset with more than a million items, PQTopK<span class="ltx_text" id="S5.p4.1.1.1"> requires much less time compared to backbone Transformer models. On the other hand, on smaller datasets with only a few thousand items (such as Booking.com), even Default Matrix Multiplication remains efficient.</span></span></p>
</div>
<div class="ltx_para" id="S5.p5">
<p class="ltx_p" id="S5.p5.2"><span class="ltx_text ltx_font_italic" id="S5.p5.2.3">RQ2. PQTopK efficiency with very large catalogues.</span> As observed in RQ1, the inference time of a backbone Transformer model (without scoring head) is constant <span class="ltx_text" id="S5.p5.2.2">w.r.t. catalogue size <math alttext="|I|" class="ltx_Math" display="inline" id="S5.p5.1.1.m1.1"><semantics id="S5.p5.1.1.m1.1a"><mrow id="S5.p5.1.1.m1.1.2.2" xref="S5.p5.1.1.m1.1.2.1.cmml"><mo id="S5.p5.1.1.m1.1.2.2.1" mathcolor="#000000" stretchy="false" xref="S5.p5.1.1.m1.1.2.1.1.cmml">|</mo><mi id="S5.p5.1.1.m1.1.1" mathcolor="#000000" xref="S5.p5.1.1.m1.1.1.cmml">I</mi><mo id="S5.p5.1.1.m1.1.2.2.2" mathcolor="#000000" stretchy="false" xref="S5.p5.1.1.m1.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.p5.1.1.m1.1b"><apply id="S5.p5.1.1.m1.1.2.1.cmml" xref="S5.p5.1.1.m1.1.2.2"><abs id="S5.p5.1.1.m1.1.2.1.1.cmml" xref="S5.p5.1.1.m1.1.2.2.1"></abs><ci id="S5.p5.1.1.m1.1.1.cmml" xref="S5.p5.1.1.m1.1.1">𝐼</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p5.1.1.m1.1c">|I|</annotation><annotation encoding="application/x-llamapun" id="S5.p5.1.1.m1.1d">| italic_I |</annotation></semantics></math><span class="ltx_text" id="S5.p5.2.2.1">. Therefore, as our goal is efficiency analysis, we exclude the Transformer model from the analysis and simulate it using a random model output for each output. <span class="ltx_text" id="S5.p5.2.2.1.1">We also generate<span class="ltx_text" id="S5.p5.2.2.1.1.1"> a random sub-id embedding matrix <math alttext="\Psi" class="ltx_Math" display="inline" id="S5.p5.2.2.1.1.1.m1.1"><semantics id="S5.p5.2.2.1.1.1.m1.1a"><mi id="S5.p5.2.2.1.1.1.m1.1.1" mathcolor="#000000" mathvariant="normal" xref="S5.p5.2.2.1.1.1.m1.1.1.cmml">Ψ</mi><annotation-xml encoding="MathML-Content" id="S5.p5.2.2.1.1.1.m1.1b"><ci id="S5.p5.2.2.1.1.1.m1.1.1.cmml" xref="S5.p5.2.2.1.1.1.m1.1.1">Ψ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p5.2.2.1.1.1.m1.1c">\Psi</annotation><annotation encoding="application/x-llamapun" id="S5.p5.2.2.1.1.1.m1.1d">roman_Ψ</annotation></semantics></math> to compute item scores. In all cases, we include the time required for selecting top-k (<span class="ltx_text ltx_font_typewriter" id="S5.p5.2.2.1.1.1.1">tf.math.top_k()<span class="ltx_text ltx_font_serif" id="S5.p5.2.2.1.1.1.1.1"> in TensorFlow<span class="ltx_text" id="S5.p5.2.2.1.1.1.1.1.1">) after scoring, as this time also depends on the number of items in the catalogue.</span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p6">
<p class="ltx_p" id="S5.p6.2">Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2" title="Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2</span></a> reports the mean response time for Default Transformer scoring, PQTopK and RecJPQ without the backbone Transformer model, for <math alttext="m=8" class="ltx_Math" display="inline" id="S5.p6.1.m1.1"><semantics id="S5.p6.1.m1.1a"><mrow id="S5.p6.1.m1.1.1" xref="S5.p6.1.m1.1.1.cmml"><mi id="S5.p6.1.m1.1.1.2" mathcolor="#000000" xref="S5.p6.1.m1.1.1.2.cmml">m</mi><mo id="S5.p6.1.m1.1.1.1" mathcolor="#000000" xref="S5.p6.1.m1.1.1.1.cmml">=</mo><mn id="S5.p6.1.m1.1.1.3" mathcolor="#000000" xref="S5.p6.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p6.1.m1.1b"><apply id="S5.p6.1.m1.1.1.cmml" xref="S5.p6.1.m1.1.1"><eq id="S5.p6.1.m1.1.1.1.cmml" xref="S5.p6.1.m1.1.1.1"></eq><ci id="S5.p6.1.m1.1.1.2.cmml" xref="S5.p6.1.m1.1.1.2">𝑚</ci><cn id="S5.p6.1.m1.1.1.3.cmml" type="integer" xref="S5.p6.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p6.1.m1.1c">m=8</annotation><annotation encoding="application/x-llamapun" id="S5.p6.1.m1.1d">italic_m = 8</annotation></semantics></math> splits (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf1" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2a</span></a>) and <math alttext="m=64" class="ltx_Math" display="inline" id="S5.p6.2.m2.1"><semantics id="S5.p6.2.m2.1a"><mrow id="S5.p6.2.m2.1.1" xref="S5.p6.2.m2.1.1.cmml"><mi id="S5.p6.2.m2.1.1.2" mathcolor="#000000" xref="S5.p6.2.m2.1.1.2.cmml">m</mi><mo id="S5.p6.2.m2.1.1.1" mathcolor="#000000" xref="S5.p6.2.m2.1.1.1.cmml">=</mo><mn id="S5.p6.2.m2.1.1.3" mathcolor="#000000" xref="S5.p6.2.m2.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p6.2.m2.1b"><apply id="S5.p6.2.m2.1.1.cmml" xref="S5.p6.2.m2.1.1"><eq id="S5.p6.2.m2.1.1.1.cmml" xref="S5.p6.2.m2.1.1.1"></eq><ci id="S5.p6.2.m2.1.1.2.cmml" xref="S5.p6.2.m2.1.1.2">𝑚</ci><cn id="S5.p6.2.m2.1.1.3.cmml" type="integer" xref="S5.p6.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p6.2.m2.1c">m=64</annotation><annotation encoding="application/x-llamapun" id="S5.p6.2.m2.1d">italic_m = 64</annotation></semantics></math> splits (<a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf2" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2b</span></a>).
Both <span class="ltx_text" id="S5.p6.2.1">Figures<span class="ltx_text" id="S5.p6.2.1.1"> <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf1" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2a</span></a> &amp; <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf2" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2b</span></a> include the matrix multiplication-based Transformer Default baseline that does not <span class="ltx_text" id="S5.p6.2.1.1.1">use<span class="ltx_text" id="S5.p6.2.1.1.1.1"> the number of splits.</span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p7">
<p class="ltx_p" id="S5.p7.1">We observe from the figures that with <span class="ltx_text" id="S5.p7.1.1">a<span class="ltx_text" id="S5.p7.1.1.1"> a low number of items in the catalogue (<math alttext="\leq 10^{4}" class="ltx_Math" display="inline" id="S5.p7.1.1.1.m1.1"><semantics id="S5.p7.1.1.1.m1.1a"><mrow id="S5.p7.1.1.1.m1.1.1" xref="S5.p7.1.1.1.m1.1.1.cmml"><mi id="S5.p7.1.1.1.m1.1.1.2" xref="S5.p7.1.1.1.m1.1.1.2.cmml"></mi><mo id="S5.p7.1.1.1.m1.1.1.1" mathcolor="#000000" xref="S5.p7.1.1.1.m1.1.1.1.cmml">≤</mo><msup id="S5.p7.1.1.1.m1.1.1.3" xref="S5.p7.1.1.1.m1.1.1.3.cmml"><mn id="S5.p7.1.1.1.m1.1.1.3.2" mathcolor="#000000" xref="S5.p7.1.1.1.m1.1.1.3.2.cmml">10</mn><mn id="S5.p7.1.1.1.m1.1.1.3.3" mathcolor="#000000" xref="S5.p7.1.1.1.m1.1.1.3.3.cmml">4</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.p7.1.1.1.m1.1b"><apply id="S5.p7.1.1.1.m1.1.1.cmml" xref="S5.p7.1.1.1.m1.1.1"><leq id="S5.p7.1.1.1.m1.1.1.1.cmml" xref="S5.p7.1.1.1.m1.1.1.1"></leq><csymbol cd="latexml" id="S5.p7.1.1.1.m1.1.1.2.cmml" xref="S5.p7.1.1.1.m1.1.1.2">absent</csymbol><apply id="S5.p7.1.1.1.m1.1.1.3.cmml" xref="S5.p7.1.1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S5.p7.1.1.1.m1.1.1.3.1.cmml" xref="S5.p7.1.1.1.m1.1.1.3">superscript</csymbol><cn id="S5.p7.1.1.1.m1.1.1.3.2.cmml" type="integer" xref="S5.p7.1.1.1.m1.1.1.3.2">10</cn><cn id="S5.p7.1.1.1.m1.1.1.3.3.cmml" type="integer" xref="S5.p7.1.1.1.m1.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p7.1.1.1.m1.1c">\leq 10^{4}</annotation><annotation encoding="application/x-llamapun" id="S5.p7.1.1.1.m1.1d">≤ 10 start_POSTSUPERSCRIPT 4 end_POSTSUPERSCRIPT</annotation></semantics></math>), the default matrix multiplication-based approach is the most efficient, requiring less than a millisecond for scoring. However, as we observed in RQ1, with this small number of items, the actual method is not that important, as the scoring time is likely to be dominated by the backbone model inference.</span></span></p>
</div>
<div class="ltx_para" id="S5.p8">
<p class="ltx_p" id="S5.p8.5">With the smaller number of splits, <math alttext="m=8" class="ltx_Math" display="inline" id="S5.p8.1.m1.1"><semantics id="S5.p8.1.m1.1a"><mrow id="S5.p8.1.m1.1.1" xref="S5.p8.1.m1.1.1.cmml"><mi id="S5.p8.1.m1.1.1.2" mathcolor="#000000" xref="S5.p8.1.m1.1.1.2.cmml">m</mi><mo id="S5.p8.1.m1.1.1.1" mathcolor="#000000" xref="S5.p8.1.m1.1.1.1.cmml">=</mo><mn id="S5.p8.1.m1.1.1.3" mathcolor="#000000" xref="S5.p8.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p8.1.m1.1b"><apply id="S5.p8.1.m1.1.1.cmml" xref="S5.p8.1.m1.1.1"><eq id="S5.p8.1.m1.1.1.1.cmml" xref="S5.p8.1.m1.1.1.1"></eq><ci id="S5.p8.1.m1.1.1.2.cmml" xref="S5.p8.1.m1.1.1.2">𝑚</ci><cn id="S5.p8.1.m1.1.1.3.cmml" type="integer" xref="S5.p8.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p8.1.m1.1c">m=8</annotation><annotation encoding="application/x-llamapun" id="S5.p8.1.m1.1d">italic_m = 8</annotation></semantics></math>, matrix multiplication becomes <span class="ltx_text" id="S5.p8.5.4">less efficient compared to PQ-based methods for item catalogues with more than <math alttext="10^{5}" class="ltx_Math" display="inline" id="S5.p8.2.1.m1.1"><semantics id="S5.p8.2.1.m1.1a"><msup id="S5.p8.2.1.m1.1.1" xref="S5.p8.2.1.m1.1.1.cmml"><mn id="S5.p8.2.1.m1.1.1.2" mathcolor="#000000" xref="S5.p8.2.1.m1.1.1.2.cmml">10</mn><mn id="S5.p8.2.1.m1.1.1.3" mathcolor="#000000" xref="S5.p8.2.1.m1.1.1.3.cmml">5</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p8.2.1.m1.1b"><apply id="S5.p8.2.1.m1.1.1.cmml" xref="S5.p8.2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p8.2.1.m1.1.1.1.cmml" xref="S5.p8.2.1.m1.1.1">superscript</csymbol><cn id="S5.p8.2.1.m1.1.1.2.cmml" type="integer" xref="S5.p8.2.1.m1.1.1.2">10</cn><cn id="S5.p8.2.1.m1.1.1.3.cmml" type="integer" xref="S5.p8.2.1.m1.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p8.2.1.m1.1c">10^{5}</annotation><annotation encoding="application/x-llamapun" id="S5.p8.2.1.m1.1d">10 start_POSTSUPERSCRIPT 5 end_POSTSUPERSCRIPT</annotation></semantics></math><span class="ltx_text" id="S5.p8.5.4.3"> items. Note that the figure is shown in logarithmic scale, meaning that, for example, at 10M items, PQTopK is <span class="ltx_text" id="S5.p8.5.4.3.3">10<math alttext="\times" class="ltx_Math" display="inline" id="S5.p8.3.2.1.1.m1.1"><semantics id="S5.p8.3.2.1.1.m1.1a"><mo id="S5.p8.3.2.1.1.m1.1.1" mathcolor="#000000" xref="S5.p8.3.2.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S5.p8.3.2.1.1.m1.1b"><times id="S5.p8.3.2.1.1.m1.1.1.cmml" xref="S5.p8.3.2.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S5.p8.3.2.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S5.p8.3.2.1.1.m1.1d">×</annotation></semantics></math><span class="ltx_text" id="S5.p8.5.4.3.3.2"> more efficient compared to the default approach. Also, note that the matrix multiplication baseline only extends up to <math alttext="10^{7}" class="ltx_Math" display="inline" id="S5.p8.4.3.2.2.1.m1.1"><semantics id="S5.p8.4.3.2.2.1.m1.1a"><msup id="S5.p8.4.3.2.2.1.m1.1.1" xref="S5.p8.4.3.2.2.1.m1.1.1.cmml"><mn id="S5.p8.4.3.2.2.1.m1.1.1.2" mathcolor="#000000" xref="S5.p8.4.3.2.2.1.m1.1.1.2.cmml">10</mn><mn id="S5.p8.4.3.2.2.1.m1.1.1.3" mathcolor="#000000" xref="S5.p8.4.3.2.2.1.m1.1.1.3.cmml">7</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p8.4.3.2.2.1.m1.1b"><apply id="S5.p8.4.3.2.2.1.m1.1.1.cmml" xref="S5.p8.4.3.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p8.4.3.2.2.1.m1.1.1.1.cmml" xref="S5.p8.4.3.2.2.1.m1.1.1">superscript</csymbol><cn id="S5.p8.4.3.2.2.1.m1.1.1.2.cmml" type="integer" xref="S5.p8.4.3.2.2.1.m1.1.1.2">10</cn><cn id="S5.p8.4.3.2.2.1.m1.1.1.3.cmml" type="integer" xref="S5.p8.4.3.2.2.1.m1.1.1.3">7</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p8.4.3.2.2.1.m1.1c">10^{7}</annotation><annotation encoding="application/x-llamapun" id="S5.p8.4.3.2.2.1.m1.1d">10 start_POSTSUPERSCRIPT 7 end_POSTSUPERSCRIPT</annotation></semantics></math> items: after that point, the default approach exhausts all available system memory (128GB). We also observe that PQTopK is always more efficient than RecJPQ. Despite (due to the logarithmic scale) the lines looking close to each other, PQTopK is always faster than RecJPQ by 50-100%. For example, with 10M items in the catalogue, PQTopK requires 146ms per user, whereas <span class="ltx_text" id="S5.p8.5.4.3.3.2.1">RecJPQ<span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1"> requires 253ms (+68%). With 100M items in the catalogue, PQTopK remains relatively efficient (<math alttext="\approx" class="ltx_Math" display="inline" id="S5.p8.5.4.3.3.2.1.1.m1.1"><semantics id="S5.p8.5.4.3.3.2.1.1.m1.1a"><mo id="S5.p8.5.4.3.3.2.1.1.m1.1.1" mathcolor="#000000" xref="S5.p8.5.4.3.3.2.1.1.m1.1.1.cmml">≈</mo><annotation-xml encoding="MathML-Content" id="S5.p8.5.4.3.3.2.1.1.m1.1b"><approx id="S5.p8.5.4.3.3.2.1.1.m1.1.1.cmml" xref="S5.p8.5.4.3.3.2.1.1.m1.1.1"></approx></annotation-xml><annotation encoding="application/x-tex" id="S5.p8.5.4.3.3.2.1.1.m1.1c">\approx</annotation><annotation encoding="application/x-llamapun" id="S5.p8.5.4.3.3.2.1.1.m1.1d">≈</annotation></semantics></math> 1 second per user); however, with 1 billion items, the method requires more than 10 seconds <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1">per user<span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1">. <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1">Aruguably, 10 seconds per item is not suitable for interactive recommendations (for example, when the model inference occurs during web page loading), but may still <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1">work<span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1"> in <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1.1">suit<span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1.1.1"> situations when recommendations can be pre-computed <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1.1.1.1">(e.g. updated once every day)<span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1.1.1.1.1">. <span class="ltx_text" id="S5.p8.5.4.3.3.2.1.1.1.1.1.1.1.1.1.1.1.1"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p9">
<p class="ltx_p" id="S5.p9.3">On the other hand, as we can see from Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf2" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2b</span></a>, <span class="ltx_text" id="S5.p9.3.3">with<span class="ltx_text" id="S5.p9.3.3.3"> a large number of splits (<math alttext="m=64" class="ltx_Math" display="inline" id="S5.p9.1.1.1.m1.1"><semantics id="S5.p9.1.1.1.m1.1a"><mrow id="S5.p9.1.1.1.m1.1.1" xref="S5.p9.1.1.1.m1.1.1.cmml"><mi id="S5.p9.1.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p9.1.1.1.m1.1.1.2.cmml">m</mi><mo id="S5.p9.1.1.1.m1.1.1.1" mathcolor="#000000" xref="S5.p9.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S5.p9.1.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p9.1.1.1.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p9.1.1.1.m1.1b"><apply id="S5.p9.1.1.1.m1.1.1.cmml" xref="S5.p9.1.1.1.m1.1.1"><eq id="S5.p9.1.1.1.m1.1.1.1.cmml" xref="S5.p9.1.1.1.m1.1.1.1"></eq><ci id="S5.p9.1.1.1.m1.1.1.2.cmml" xref="S5.p9.1.1.1.m1.1.1.2">𝑚</ci><cn id="S5.p9.1.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p9.1.1.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p9.1.1.1.m1.1c">m=64</annotation><annotation encoding="application/x-llamapun" id="S5.p9.1.1.1.m1.1d">italic_m = 64</annotation></semantics></math>), <span class="ltx_text" id="S5.p9.3.3.3.2">Default<span class="ltx_text" id="S5.p9.3.3.3.2.2"> and PQtopK perform <span class="ltx_text" id="S5.p9.3.3.3.2.2.2">similarly<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2">; <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2">e.g.<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2">, both methods require <math alttext="\sim" class="ltx_Math" display="inline" id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1"><semantics id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1a"><mo id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="S5.p9.2.2.2.1.1.1.1.1.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1b"><csymbol cd="latexml" id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.p9.2.2.2.1.1.1.1.1.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S5.p9.2.2.2.1.1.1.1.1.1.m1.1d">∼</annotation></semantics></math>100ms for scoring 1M items, <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1">50ms faster than RecJPQ<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1">. However, <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1">on our hardware,<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1"> <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1">Default<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1"> consumes all available memory above 10M items <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1">(this is why the line for Default on Figures <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf2" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2b</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2408.09992v1#S5.F2.sf2" title="In Figure 2 ‣ 5. Analysis ‣ Efficient Inference of Sub-Item Id-based Sequential Recommendation Models with Millions of Items"><span class="ltx_text ltx_ref_tag">2b</span></a> does not go beyond <math alttext="10^{7}" class="ltx_Math" display="inline" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1"><semantics id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1a"><msup id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.cmml"><mn id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.2.cmml">10</mn><mn id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.3.cmml">7</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1b"><apply id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.1.cmml" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1">superscript</csymbol><cn id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.2.cmml" type="integer" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.2">10</cn><cn id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1.1.3">7</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1c">10^{7}</annotation><annotation encoding="application/x-llamapun" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.m1.1d">10 start_POSTSUPERSCRIPT 7 end_POSTSUPERSCRIPT</annotation></semantics></math> items)<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.1">, whereas PQTopK and RecJPQ allow for scores up to <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1">100M items<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1">. <span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1">Nevertheless<span class="ltx_text" id="S5.p9.3.3.3.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1">, PQTopK scoring, in this case, requires 10 seconds per user, limiting its application to the pre-computing scenario.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p10">
<p class="ltx_p" id="S5.p10.2"><span class="ltx_text" id="S5.p10.2.2">Finally, we observe that with catalogues with more than <math alttext="10^{5}" class="ltx_Math" display="inline" id="S5.p10.1.1.m1.1"><semantics id="S5.p10.1.1.m1.1a"><msup id="S5.p10.1.1.m1.1.1" xref="S5.p10.1.1.m1.1.1.cmml"><mn id="S5.p10.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p10.1.1.m1.1.1.2.cmml">10</mn><mn id="S5.p10.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p10.1.1.m1.1.1.3.cmml">5</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p10.1.1.m1.1b"><apply id="S5.p10.1.1.m1.1.1.cmml" xref="S5.p10.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p10.1.1.m1.1.1.1.cmml" xref="S5.p10.1.1.m1.1.1">superscript</csymbol><cn id="S5.p10.1.1.m1.1.1.2.cmml" type="integer" xref="S5.p10.1.1.m1.1.1.2">10</cn><cn id="S5.p10.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p10.1.1.m1.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p10.1.1.m1.1c">10^{5}</annotation><annotation encoding="application/x-llamapun" id="S5.p10.1.1.m1.1d">10 start_POSTSUPERSCRIPT 5 end_POSTSUPERSCRIPT</annotation></semantics></math> items, the response depends linearly on the number of items for all scoring methods<span class="ltx_text" id="S5.p10.2.2.1">. <span class="ltx_text" id="S5.p10.2.2.1.1">However, with less than <math alttext="10^{5}" class="ltx_Math" display="inline" id="S5.p10.2.2.1.1.m1.1"><semantics id="S5.p10.2.2.1.1.m1.1a"><msup id="S5.p10.2.2.1.1.m1.1.1" xref="S5.p10.2.2.1.1.m1.1.1.cmml"><mn id="S5.p10.2.2.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p10.2.2.1.1.m1.1.1.2.cmml">10</mn><mn id="S5.p10.2.2.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p10.2.2.1.1.m1.1.1.3.cmml">5</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p10.2.2.1.1.m1.1b"><apply id="S5.p10.2.2.1.1.m1.1.1.cmml" xref="S5.p10.2.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p10.2.2.1.1.m1.1.1.1.cmml" xref="S5.p10.2.2.1.1.m1.1.1">superscript</csymbol><cn id="S5.p10.2.2.1.1.m1.1.1.2.cmml" type="integer" xref="S5.p10.2.2.1.1.m1.1.1.2">10</cn><cn id="S5.p10.2.2.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p10.2.2.1.1.m1.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p10.2.2.1.1.m1.1c">10^{5}</annotation><annotation encoding="application/x-llamapun" id="S5.p10.2.2.1.1.m1.1d">10 start_POSTSUPERSCRIPT 5 end_POSTSUPERSCRIPT</annotation></semantics></math> items, there is a <span class="ltx_text" id="S5.p10.2.2.1.1.1"> ”elbow-style” non-linearity <span class="ltx_text" id="S5.p10.2.2.1.1.1.1">that<span class="ltx_text" id="S5.p10.2.2.1.1.1.1.1"> can be explained <span class="ltx_text" id="S5.p10.2.2.1.1.1.1.1.1">by the fact that the time required<span class="ltx_text" id="S5.p10.2.2.1.1.1.1.1.1.1"> by auxiliary operations such as function calls becomes important at this small scale.</span></span></span></span></span></span></span></span></p>
</div>
<div class="ltx_para" id="S5.p11">
<p class="ltx_p" id="S5.p11.3"><span class="ltx_text" id="S5.p11.3.3">Summarising<span class="ltx_text" id="S5.p11.3.3.3"> RQ2, we <span class="ltx_text" id="S5.p11.3.3.3.3">conclude<span class="ltx_text" id="S5.p11.3.3.3.3.3"> that PQTopK with 8 splits is a very efficient algorithm that allows performing efficient inference on catalogues even with hundreds of millions of items. With a larger number of splits <math alttext="m=64" class="ltx_Math" display="inline" id="S5.p11.1.1.1.1.1.m1.1"><semantics id="S5.p11.1.1.1.1.1.m1.1a"><mrow id="S5.p11.1.1.1.1.1.m1.1.1" xref="S5.p11.1.1.1.1.1.m1.1.1.cmml"><mi id="S5.p11.1.1.1.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p11.1.1.1.1.1.m1.1.1.2.cmml">m</mi><mo id="S5.p11.1.1.1.1.1.m1.1.1.1" mathcolor="#000000" xref="S5.p11.1.1.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S5.p11.1.1.1.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p11.1.1.1.1.1.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p11.1.1.1.1.1.m1.1b"><apply id="S5.p11.1.1.1.1.1.m1.1.1.cmml" xref="S5.p11.1.1.1.1.1.m1.1.1"><eq id="S5.p11.1.1.1.1.1.m1.1.1.1.cmml" xref="S5.p11.1.1.1.1.1.m1.1.1.1"></eq><ci id="S5.p11.1.1.1.1.1.m1.1.1.2.cmml" xref="S5.p11.1.1.1.1.1.m1.1.1.2">𝑚</ci><cn id="S5.p11.1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p11.1.1.1.1.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p11.1.1.1.1.1.m1.1c">m=64</annotation><annotation encoding="application/x-llamapun" id="S5.p11.1.1.1.1.1.m1.1d">italic_m = 64</annotation></semantics></math>, the inference time of PQTopK is similar to the default matrix multiplication scoring, but it allows scoring up to <math alttext="10^{8}" class="ltx_Math" display="inline" id="S5.p11.2.2.2.2.2.m2.1"><semantics id="S5.p11.2.2.2.2.2.m2.1a"><msup id="S5.p11.2.2.2.2.2.m2.1.1" xref="S5.p11.2.2.2.2.2.m2.1.1.cmml"><mn id="S5.p11.2.2.2.2.2.m2.1.1.2" mathcolor="#000000" xref="S5.p11.2.2.2.2.2.m2.1.1.2.cmml">10</mn><mn id="S5.p11.2.2.2.2.2.m2.1.1.3" mathcolor="#000000" xref="S5.p11.2.2.2.2.2.m2.1.1.3.cmml">8</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p11.2.2.2.2.2.m2.1b"><apply id="S5.p11.2.2.2.2.2.m2.1.1.cmml" xref="S5.p11.2.2.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.p11.2.2.2.2.2.m2.1.1.1.cmml" xref="S5.p11.2.2.2.2.2.m2.1.1">superscript</csymbol><cn id="S5.p11.2.2.2.2.2.m2.1.1.2.cmml" type="integer" xref="S5.p11.2.2.2.2.2.m2.1.1.2">10</cn><cn id="S5.p11.2.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="S5.p11.2.2.2.2.2.m2.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p11.2.2.2.2.2.m2.1c">10^{8}</annotation><annotation encoding="application/x-llamapun" id="S5.p11.2.2.2.2.2.m2.1d">10 start_POSTSUPERSCRIPT 8 end_POSTSUPERSCRIPT</annotation></semantics></math> items. In contrast, matrix multiplication <span class="ltx_text" id="S5.p11.3.3.3.3.3.1">exhausts available memory<span class="ltx_text" id="S5.p11.3.3.3.3.3.1.1"> with catalogues larger than <math alttext="10^{7}" class="ltx_Math" display="inline" id="S5.p11.3.3.3.3.3.1.1.m1.1"><semantics id="S5.p11.3.3.3.3.3.1.1.m1.1a"><msup id="S5.p11.3.3.3.3.3.1.1.m1.1.1" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1.cmml"><mn id="S5.p11.3.3.3.3.3.1.1.m1.1.1.2" mathcolor="#000000" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1.2.cmml">10</mn><mn id="S5.p11.3.3.3.3.3.1.1.m1.1.1.3" mathcolor="#000000" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1.3.cmml">7</mn></msup><annotation-xml encoding="MathML-Content" id="S5.p11.3.3.3.3.3.1.1.m1.1b"><apply id="S5.p11.3.3.3.3.3.1.1.m1.1.1.cmml" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.p11.3.3.3.3.3.1.1.m1.1.1.1.cmml" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1">superscript</csymbol><cn id="S5.p11.3.3.3.3.3.1.1.m1.1.1.2.cmml" type="integer" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1.2">10</cn><cn id="S5.p11.3.3.3.3.3.1.1.m1.1.1.3.cmml" type="integer" xref="S5.p11.3.3.3.3.3.1.1.m1.1.1.3">7</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p11.3.3.3.3.3.1.1.m1.1c">10^{7}</annotation><annotation encoding="application/x-llamapun" id="S5.p11.3.3.3.3.3.1.1.m1.1d">10 start_POSTSUPERSCRIPT 7 end_POSTSUPERSCRIPT</annotation></semantics></math> items, <span class="ltx_text" id="S5.p11.3.3.3.3.3.1.1.1">which highlights the importance of RecJPQ for reducing memory consumption<span class="ltx_text" id="S5.p11.3.3.3.3.3.1.1.1.1">.</span></span></span></span></span></span></span></span></p>
</div>
<figure class="ltx_figure" id="S5.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F2.sf1">
<div class="ltx_inline-block ltx_transformed_outer" id="S5.F2.sf1.1" style="width:303.5pt;height:118.9pt;vertical-align:-2.5pt;"><span class="ltx_transformed_inner" style="transform:translate(29.3pt,-11.2pt) scale(1.23898169684721,1.23898169684721) ;"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="180" id="S5.F2.sf1.1.g1" src="x2.png" width="280"/>
</span></div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span>Number of splits: <math alttext="m=8" class="ltx_Math" display="inline" id="S5.F2.sf1.3.m1.1"><semantics id="S5.F2.sf1.3.m1.1b"><mrow id="S5.F2.sf1.3.m1.1.1" xref="S5.F2.sf1.3.m1.1.1.cmml"><mi id="S5.F2.sf1.3.m1.1.1.2" mathcolor="#000000" xref="S5.F2.sf1.3.m1.1.1.2.cmml">m</mi><mo id="S5.F2.sf1.3.m1.1.1.1" mathcolor="#000000" xref="S5.F2.sf1.3.m1.1.1.1.cmml">=</mo><mn id="S5.F2.sf1.3.m1.1.1.3" mathcolor="#000000" xref="S5.F2.sf1.3.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.F2.sf1.3.m1.1c"><apply id="S5.F2.sf1.3.m1.1.1.cmml" xref="S5.F2.sf1.3.m1.1.1"><eq id="S5.F2.sf1.3.m1.1.1.1.cmml" xref="S5.F2.sf1.3.m1.1.1.1"></eq><ci id="S5.F2.sf1.3.m1.1.1.2.cmml" xref="S5.F2.sf1.3.m1.1.1.2">𝑚</ci><cn id="S5.F2.sf1.3.m1.1.1.3.cmml" type="integer" xref="S5.F2.sf1.3.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F2.sf1.3.m1.1d">m=8</annotation><annotation encoding="application/x-llamapun" id="S5.F2.sf1.3.m1.1e">italic_m = 8</annotation></semantics></math></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F2.sf2">
<div class="ltx_inline-block ltx_transformed_outer" id="S5.F2.sf2.1" style="width:303.5pt;height:116.5pt;vertical-align:-2.4pt;"><span class="ltx_transformed_inner" style="transform:translate(26.8pt,-10.1pt) scale(1.214200560982,1.214200560982) ;"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="180" id="S5.F2.sf2.1.g1" src="x3.png" width="280"/>
</span></div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span>Number of splits: <math alttext="m=64" class="ltx_Math" display="inline" id="S5.F2.sf2.3.m1.1"><semantics id="S5.F2.sf2.3.m1.1b"><mrow id="S5.F2.sf2.3.m1.1.1" xref="S5.F2.sf2.3.m1.1.1.cmml"><mi id="S5.F2.sf2.3.m1.1.1.2" mathcolor="#000000" xref="S5.F2.sf2.3.m1.1.1.2.cmml">m</mi><mo id="S5.F2.sf2.3.m1.1.1.1" mathcolor="#000000" xref="S5.F2.sf2.3.m1.1.1.1.cmml">=</mo><mn id="S5.F2.sf2.3.m1.1.1.3" mathcolor="#000000" xref="S5.F2.sf2.3.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.F2.sf2.3.m1.1c"><apply id="S5.F2.sf2.3.m1.1.1.cmml" xref="S5.F2.sf2.3.m1.1.1"><eq id="S5.F2.sf2.3.m1.1.1.1.cmml" xref="S5.F2.sf2.3.m1.1.1.1"></eq><ci id="S5.F2.sf2.3.m1.1.1.2.cmml" xref="S5.F2.sf2.3.m1.1.1.2">𝑚</ci><cn id="S5.F2.sf2.3.m1.1.1.3.cmml" type="integer" xref="S5.F2.sf2.3.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F2.sf2.3.m1.1d">m=64</annotation><annotation encoding="application/x-llamapun" id="S5.F2.sf2.3.m1.1e">italic_m = 64</annotation></semantics></math></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2. </span>Efficiency of PQTopK on simulated data</figcaption>
</figure>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.2">This paper analysed the inference time of Transformer-based sequential recommender systems with large catalogues. <span class="ltx_text" id="S6.p1.2.2">We found that using RecJPQ enhancement, which enables training on large catalogues via sub-item-id representation, coupled with an efficient PQTopK scoring algorithm,<span class="ltx_text" id="S6.p1.2.2.2"> allows model inference on large catalogues. In particular, <span class="ltx_text" id="S6.p1.2.2.2.2">using PQTopK, we sped up RecJPQ-enhanced SASRec 1.56<math alttext="\times" class="ltx_Math" display="inline" id="S6.p1.1.1.1.1.m1.1"><semantics id="S6.p1.1.1.1.1.m1.1a"><mo id="S6.p1.1.1.1.1.m1.1.1" mathcolor="#000000" xref="S6.p1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.p1.1.1.1.1.m1.1b"><times id="S6.p1.1.1.1.1.m1.1.1.cmml" xref="S6.p1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.p1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.p1.1.1.1.1.m1.1d">×</annotation></semantics></math> compared to the original RecJPQ scoring and 4.5<math alttext="\times" class="ltx_Math" display="inline" id="S6.p1.2.2.2.2.m2.1"><semantics id="S6.p1.2.2.2.2.m2.1a"><mo id="S6.p1.2.2.2.2.m2.1.1" mathcolor="#000000" xref="S6.p1.2.2.2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.p1.2.2.2.2.m2.1b"><times id="S6.p1.2.2.2.2.m2.1.1.cmml" xref="S6.p1.2.2.2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.p1.2.2.2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.p1.2.2.2.2.m2.1d">×</annotation></semantics></math> compared to default SASRec scoring<span class="ltx_text" id="S6.p1.2.2.2.2.1"> <span class="ltx_text" id="S6.p1.2.2.2.2.1.1">on the Gowalla dataset with 1.3M items<span class="ltx_text" id="S6.p1.2.2.2.2.1.1.1">. We also showed that, when considering the pre-scoring scenario, PQTopK can be applicable to catalogues of up to 1 billion items. We believe that our findings will help the wider adoption of state-of-the-art Transformer-based models in real production environments.</span></span></span></span></span></span></p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ama (2023)</span>
<span class="ltx_bibblock">
2023.

</span>
<span class="ltx_bibblock">Amazon Statistics: Up-to-Date Numbers
Relevant for 2023-2024.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://amzscout.net/blog/amazon-statistics/" title="">https://amzscout.net/blog/amazon-statistics/</a>
</span>
<span class="ltx_bibblock">[Online; accessed 16 January 2024].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Spo (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">Spotify/Annoy.

</span>
<span class="ltx_bibblock">Spotify.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/spotify/annoy" title="">https://github.com/spotify/annoy</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abadi et al<span class="ltx_text" id="bib.bib4.2.2.1">.</span> (2016)</span>
<span class="ltx_bibblock">
Martin Abadi, Paul
Barham, Jianmin Chen, Zhifeng Chen,
Andy Davis, Jeffrey Dean,
Matthieu Devin, Sanjay Ghemawat,
Geoffrey Irving, Michael Isard,
Manjunath Kudlur, Josh Levenberg,
Rajat Monga, Sherry Moore,
Derek G. Murray, Benoit Steiner,
Paul Tucker, Vijay Vasudevan,
Pete Warden, Martin Wicke,
Yuan Yu, and Xiaoqiang Zheng.
2016.

</span>
<span class="ltx_bibblock">TensorFlow: A System for Large-Scale Machine
Learning. In <em class="ltx_emph ltx_font_italic" id="bib.bib4.3.1">12th USENIX Symposium on
Operating Systems Design and Implementation (OSDI 16)</em>.
265–283.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span class="ltx_text" id="bib.bib5.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Ting Chen, Lala Li, and
Yizhou Sun. 2020.

</span>
<span class="ltx_bibblock">Differentiable Product Quantization for
End-to-End Embedding Compression. In <em class="ltx_emph ltx_font_italic" id="bib.bib5.3.1">Proc.
ICML</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cho et al<span class="ltx_text" id="bib.bib6.2.2.1">.</span> (2011)</span>
<span class="ltx_bibblock">
Eunjoon Cho, Seth A.
Myers, and Jure Leskovec.
2011.

</span>
<span class="ltx_bibblock">Friendship and Mobility: User Movement in
Location-Based Social Networks. In <em class="ltx_emph ltx_font_italic" id="bib.bib6.3.1">Proc.
KDD</em>. 1082–1090.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Goldenberg and Levin (2021)</span>
<span class="ltx_bibblock">
Dmitri Goldenberg and
Pavel Levin. 2021.

</span>
<span class="ltx_bibblock">Booking.com Multi-Destination Trips Dataset. In
<em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proc. SIGIR</em>. 2457–2462.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jégou et al<span class="ltx_text" id="bib.bib8.2.2.1">.</span> (2011)</span>
<span class="ltx_bibblock">
Herve Jégou, Matthijs
Douze, and Cordelia Schmid.
2011.

</span>
<span class="ltx_bibblock">Product Quantization for Nearest Neighbor
Search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.3.1">IEEE Transactions on Pattern Analysis and
Machine Intelligence</em> 33, 1
(2011), 117–128.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Johnson et al<span class="ltx_text" id="bib.bib9.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Jeff Johnson, Matthijs
Douze, and Hervé Jégou.
2021.

</span>
<span class="ltx_bibblock">Billion-Scale Similarity Search with GPUs.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.3.1">IEEE Transactions on Big Data</em>
7, 3 (2021),
535–547.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kang and McAuley (2018)</span>
<span class="ltx_bibblock">
Wang-Cheng Kang and
Julian McAuley. 2018.

</span>
<span class="ltx_bibblock">Self-Attentive Sequential Recommendation. In
<em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">Proc. ICDM</em>. 197–206.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Klenitskiy and Vasilev (2023)</span>
<span class="ltx_bibblock">
Anton Klenitskiy and
Alexey Vasilev. 2023.

</span>
<span class="ltx_bibblock">Turning Dross Into Gold Loss: Is BERT4Rec
Really Better than SASRec?. In <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Proc. RecSys</em>.
1120–1125.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lian et al<span class="ltx_text" id="bib.bib12.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Defu Lian, Haoyu Wang,
Zheng Liu, Jianxun Lian,
Enhong Chen, and Xing Xie.
2020.

</span>
<span class="ltx_bibblock">LightRec: A Memory and Search-Efficient
Recommender System. In <em class="ltx_emph ltx_font_italic" id="bib.bib12.3.1">Proc. WWW</em>.
695–705.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib13.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Qijiong Liu, Xiaoyu Dong,
Jiaren Xiao, Nuo Chen,
Hengchang Hu, Jieming Zhu,
Chenxu Zhu, Tetsuya Sakai, and
Xiao-Ming Wu. 2024.

</span>
<span class="ltx_bibblock">Vector Quantization for Recommender Systems:
A Review and Outlook.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2405.03110 [cs]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petrov and Macdonald (2025)</span>
<span class="ltx_bibblock">
Aleksandr Petrov and
Craig Macdonald. 2025.

</span>
<span class="ltx_bibblock">RSS: Effective and Efficient Training
for Sequential Recommendation Using Recency Sampling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">ACM Transactions on Recommender Systems</em>
3, 1 (2025),
1–32.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petrov and Macdonald (2022)</span>
<span class="ltx_bibblock">
Aleksandr V. Petrov and
Craig Macdonald. 2022.

</span>
<span class="ltx_bibblock">A Systematic Review and Replicability Study
of BERT4Rec for Sequential Recommendation. In
<em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Proc. RecSys</em>. 436–447.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petrov and Macdonald (2023)</span>
<span class="ltx_bibblock">
Aleksandr V. Petrov and
Craig Macdonald. 2023.

</span>
<span class="ltx_bibblock">gSASRec: Reducing Overconfidence in
Sequential Recommendation Trained with Negative Sampling. In
<em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Proc. RecSys</em>. 116–128.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petrov and Macdonald (2024)</span>
<span class="ltx_bibblock">
Aleksandr V. Petrov and
Craig Macdonald. 2024.

</span>
<span class="ltx_bibblock">RecJPQ: Training Large-Catalogue Sequential
Recommenders. In <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Proc. WSDM</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al<span class="ltx_text" id="bib.bib18.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Fei Sun, Jun Liu,
Jian Wu, Changhua Pei,
Xiao Lin, Wenwu Ou, and
Peng Jiang. 2019.

</span>
<span class="ltx_bibblock">BERT4Rec: Sequential Recommendation with
Bidirectional Encoder Representations from Transformer. In
<em class="ltx_emph ltx_font_italic" id="bib.bib18.3.1">Proc. CIKM</em>. 1441–1450.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tonellotto et al<span class="ltx_text" id="bib.bib19.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Nicola Tonellotto, Craig
Macdonald, and Iadh Ounis.
2018.

</span>
<span class="ltx_bibblock">Efficient Query Processing for Scalable Web
Search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.3.1">Foundations and Trends® in
Information Retrieval</em> 12, 4-5
(2018), 319–500.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Turtle and Flood (1995)</span>
<span class="ltx_bibblock">
Howard Turtle and James
Flood. 1995.

</span>
<span class="ltx_bibblock">Query Evaluation: Strategies and
Optimizations.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">Information Processing &amp; Management</em>
31, 6 (1995),
831–850.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al<span class="ltx_text" id="bib.bib21.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam
Shazeer, Niki Parmar, Jakob Uszkoreit,
Llion Jones, Aidan N Gomez,
Łukasz Kaiser, and Illia
Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention Is All You Need. In
<em class="ltx_emph ltx_font_italic" id="bib.bib21.3.1">Proc. NeurIPS</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al<span class="ltx_text" id="bib.bib22.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Xin Xia, Junliang Yu,
Qinyong Wang, Chaoqun Yang,
Nguyen Quoc Viet Hung, and Hongzhi
Yin. 2023.

</span>
<span class="ltx_bibblock">Efficient On-Device Session-Based
Recommendation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.3.1">ACM Transactions on Information Systems</em>
41, 4 (2023),
1–24.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhan et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Jingtao Zhan, Jiaxin Mao,
Yiqun Liu, Jiafeng Guo,
Min Zhang, and Shaoping Ma.
2021.

</span>
<span class="ltx_bibblock">Jointly Optimizing Query Encoder and Product
Quantization to Improve Retrieval Performance. In
<em class="ltx_emph ltx_font_italic" id="bib.bib23.3.1">Proc. CIKM</em>. 2487–2496.

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon Aug 19 13:37:32 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
