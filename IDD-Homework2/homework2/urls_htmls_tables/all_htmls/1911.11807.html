<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>[1911.11807] Federated Learning for Ranking Browser History Suggestions</title><meta property="og:description" content="Federated Learning is a new subfield of machine learning that allows fitting models without collecting the training data itself.
Instead of sharing data, users collaboratively train a model by only sending weight updat…">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Federated Learning for Ranking Browser History Suggestions">
<meta name="twitter:image:src" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta name="twitter:image:alt" content="ar5iv logo">
<meta property="og:title" content="Federated Learning for Ranking Browser History Suggestions">
<meta property="og:site_name" content="ar5iv">
<meta property="og:image" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ar5iv.labs.arxiv.org/html/1911.11807">

<!--Generated on Sun Mar 17 14:17:13 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" lang="en" content="federated learning,  privacy-preserving machine learning,  learning to rank">

<script>
  function detectColorScheme(){
    var theme="light";
    var current_theme = localStorage.getItem("ar5iv_theme");
    if(current_theme){
      if(current_theme == "dark"){
        theme = "dark";
      } }
    else if(!window.matchMedia) { return false; }
    else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
      theme = "dark"; }
    if (theme=="dark") {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.setAttribute("data-theme", "light"); } }

  detectColorScheme();

  function toggleColorScheme(){
    var current_theme = localStorage.getItem("ar5iv_theme");
    if (current_theme) {
      if (current_theme == "light") {
        localStorage.setItem("ar5iv_theme", "dark"); }
      else {
        localStorage.setItem("ar5iv_theme", "light"); } }
    else {
        localStorage.setItem("ar5iv_theme", "dark"); }
    detectColorScheme(); }
</script>
<link media="all" rel="stylesheet" href="/assets/ar5iv-fonts.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv-site.0.2.2.css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Federated Learning for Ranking Browser History Suggestions</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Florian Hartmann
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span id="id1.1.id1" class="ltx_text ltx_affiliation_institution">Mozilla</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:fhartmann@google.com">fhartmann@google.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Sunah Suh
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span id="id2.1.id1" class="ltx_text ltx_affiliation_institution">Mozilla</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:ssuh@mozilla.com">ssuh@mozilla.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Arkadiusz Komarzewski
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span id="id3.1.id1" class="ltx_text ltx_affiliation_institution">Mozilla</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:akomarzewski@mozilla.com">akomarzewski@mozilla.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Tim D. Smith
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span id="id4.1.id1" class="ltx_text ltx_affiliation_institution">Mozilla</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:tdsmith@mozilla.com">tdsmith@mozilla.com</a>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Ilana Segall
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span id="id5.1.id1" class="ltx_text ltx_affiliation_institution">Mozilla</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:isegall@mozilla.com">isegall@mozilla.com</a>
</span></span></span>
</div>
<div class="ltx_dates">(2019)</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p id="id6.id1" class="ltx_p">Federated Learning is a new subfield of machine learning that allows fitting models without collecting the training data itself.
Instead of sharing data, users collaboratively train a model by only sending weight updates to a server.
To improve the ranking of suggestions in the Firefox URL bar, we make use of Federated Learning to train a model on user interactions in a privacy-preserving way.
This trained model replaces a handcrafted heuristic, and our results show that users now type over half a character less to find what they are looking for.</p>
<p id="id7.id2" class="ltx_p">To be able to deploy our system to real users without degrading their experience during training, we design the optimization process to be robust.
To this end, we use a variant of Rprop for optimization, and implement additional safeguards.
By using a numerical gradient approximation technique, our system is able to optimize anything in Firefox that is currently based on handcrafted heuristics.
Our paper shows that Federated Learning can be used successfully to train models in privacy-respecting ways.
</p>
</div>
<div class="ltx_keywords">federated learning, privacy-preserving machine learning, learning to rank
</div>
<span id="id1" class="ltx_note ltx_note_frontmatter ltx_role_copyright"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>rightsretained</span></span></span><span id="id2" class="ltx_note ltx_note_frontmatter ltx_role_doi"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>?</span></span></span><span id="id3" class="ltx_note ltx_note_frontmatter ltx_role_isbn"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>?</span></span></span><span id="id4" class="ltx_note ltx_note_frontmatter ltx_role_article"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">article: </span>?</span></span></span><span id="id5" class="ltx_note ltx_note_frontmatter ltx_role_price"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">price: </span>?</span></span></span><span id="id6" class="ltx_note ltx_note_frontmatter ltx_role_conference"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>;  2019</span></span></span><span id="id7" class="ltx_note ltx_note_frontmatter ltx_role_journalyear"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>;</span></span></span><span id="id8" class="ltx_note ltx_note_frontmatter ltx_role_ccs"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Machine learning</span></span></span><span id="id9" class="ltx_note ltx_note_frontmatter ltx_role_ccs"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Distributed artificial intelligence</span></span></span><span id="id10" class="ltx_note ltx_note_frontmatter ltx_role_ccs"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Learning to rank</span></span></span><span id="id11" class="ltx_note ltx_note_frontmatter ltx_role_ccs"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Distributed algorithms</span></span></span>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>

<div id="S1.p1" class="ltx_para">
<p id="S1.p1.1" class="ltx_p">Mozilla is constantly balancing user privacy with the benefits that could be produced for users by collecting data.
There are processes in place to ensure that all data collected is reviewed and evaluated against principles of necessity, privacy, transparency, and accountability <cite class="ltx_cite ltx_citemacro_citep">(Network, <a href="#bib.bib20" title="" class="ltx_ref">2019a</a>)</cite>.
When it comes to developing machine-learning-based products, however, many potential ideas would traditionally have required collecting highly sensitive user data.
Even if some users agree to share their data, it is difficult to build representative models in this way.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p id="S1.p2.1" class="ltx_p">A promising solution to Mozilla’s problem is <em id="S1.p2.1.1" class="ltx_emph ltx_font_italic">Federated Learning</em>, a new technique that allows training models on data which only exists on user devices.
Rather than sharing their data, users only send model improvements to a server.
These updates are locally derived based on private data.
Since the data is not directly shared, and there exist various additional protection mechanisms in Federated Learning, this approach offers much better privacy.</p>
</div>
<div id="S1.p3" class="ltx_para">
<p id="S1.p3.1" class="ltx_p">To experiment with Federated Learning, we decided to use it to try to improve the Firefox URL bar.
When typing a query into the URL bar, Firefox tries to suggest history entries, bookmarks, and other items that the user might want to click on.
At the time of our experiment, the algorithm that selects and ranks these suggestions was based on handcrafted heuristics.
It used several constants for configuring how different features should be weighted.
The values of these weights were chosen because they intuitively seemed reasonable, and not because a data-driven process provided evidence that they work well.</p>
</div>
<div id="S1.p4" class="ltx_para">
<p id="S1.p4.1" class="ltx_p">Since many users regularly type queries into the URL bar and select from the suggestions shown to them, Firefox could collect data in order to optimize the URL bar with a learning algorithm.
However, search queries, history entries, and bookmarks are clearly private to users.
Collecting this data on a server would severely violate privacy constraints or produce non-representative results due to opt-in bias.</p>
</div>
<div id="S1.p5" class="ltx_para">
<p id="S1.p5.1" class="ltx_p">To still optimize the URL bar suggestions based on user interactions, we developed a system that uses Federated Learning.
This system allows us to compute model improvements based on the users’ data, without directly collecting it.
Instead, the optimization algorithm is distributed so that the parts that directly touch the user data are also executed on the users’ computers.</p>
</div>
<div id="S1.p6" class="ltx_para">
<p id="S1.p6.1" class="ltx_p">To the best of our knowledge this system represents the first use of Federated Learning in a major software product outside of Google.
Federated Learning research published so far has been based purely on simulations.
These simulations represent an easier problem setting since the developer can test many different optimization algorithms and hyperparameters in a short amount of time.
</p>
</div>
<div id="S1.p7" class="ltx_para">
<p id="S1.p7.1" class="ltx_p">Deploying a Federated Learning system is more difficult because there is a much larger cost attached to testing out different versions.
Each experiment with real users takes much more time, and, even worse, can lead to a bad user experience.
For these reasons, we developed additional techniques to make our system robust enough to get good results by deploying it to Firefox just once.
These contributions include carefully designing the optimization algorithm, and implementing safeguards to ensure model quality.</p>
</div>
<div id="S1.p8" class="ltx_para">
<p id="S1.p8.1" class="ltx_p">We also designed our system in a way that it can optimize anything in Firefox that is currently based on hardcoded constants.
Since there are other places where handcrafted heuristics could be replaced by trained models, we believe our system to be widely applicable in Firefox.
All code that was used during the experiment, and in preparing it, is open sourced in accordance with Mozilla’s philosophy <cite class="ltx_cite ltx_citemacro_citep">(Hartmann, <a href="#bib.bib11" title="" class="ltx_ref">2018a</a>; Komarzewski, <a href="#bib.bib15" title="" class="ltx_ref">2018</a>; Hartmann, <a href="#bib.bib12" title="" class="ltx_ref">2018b</a>)</cite>.</p>
</div>
<div id="S1.p9" class="ltx_para">
<p id="S1.p9.1" class="ltx_p">Our system ended up being deployed to a large fraction of Firefox Beta users.
Over the course of under four days, roughly 360,000 users helped to train and evaluate a new model for the improved URL bar.
The new model leads to users typing over half a character less before selecting one of the proposed suggestions.
We have released an anonymized dataset containing the client data collected during this study [forthcoming].</p>
</div>
<figure id="S1.F1" class="ltx_figure"><img src="/html/1911.11807/assets/bar.png" id="S1.F1.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="346" height="193" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S1.F1.2.1.1" class="ltx_text" style="font-size:90%;">Figure 1</span>. </span><span id="S1.F1.3.2" class="ltx_text" style="font-size:90%;">The Firefox URL bar provides suggestions based on the browsing history</span></figcaption>
</figure>
<div id="S1.p10" class="ltx_para">
<p id="S1.p10.1" class="ltx_p">In this paper, we describe how we built the system, what we learned from doing so, and how it could be improved in the future.
Concretely, our contributions include:</p>
<ul id="S1.I1" class="ltx_itemize">
<li id="S1.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i1.p1" class="ltx_para">
<p id="S1.I1.i1.p1.1" class="ltx_p">We show that Federated Learning can be used successfully in major software products, rather than just in simulations.</p>
</div>
</li>
<li id="S1.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i2.p1" class="ltx_para">
<p id="S1.I1.i2.p1.1" class="ltx_p">Since little control over data can be exercised in this setting, we propose specialized optimization methods.</p>
</div>
</li>
<li id="S1.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i3.p1" class="ltx_para">
<p id="S1.I1.i3.p1.1" class="ltx_p">We discuss how any black box functions can be optimized based on user interactions, without sacrificing user privacy, by using a custom way of computing gradients.</p>
</div>
</li>
</ul>
</div>
<div id="S1.p11" class="ltx_para">
<p id="S1.p11.1" class="ltx_p">The remainder of the paper is structured as follows.
Section <a href="#S2" title="2. Related Work ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a> briefly introduces related work, while Section <a href="#S3" title="3. Background ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a> gives the necessary background knowledge.
In Section <a href="#S4" title="4. Search in the Firefox URL bar ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a>, we show how the URL bar search in Firefox generally works.
Section <a href="#S5" title="5. Optimization System Design ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a> explains how we designed the optimization process to be robust and easily reusable for future applications.
The process of launching our experiment as well as the analysis of the results are discussed in Section <a href="#S6" title="6. Experiment ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>.
Finally, we provide a short conclusion in Section <a href="#S7" title="7. Conclusion ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7</span></a>.</p>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Related Work</h2>

<div id="S2.p1" class="ltx_para">
<p id="S2.p1.1" class="ltx_p"><cite class="ltx_cite ltx_citemacro_citet">McMahan et al<span class="ltx_text">.</span> (<a href="#bib.bib18" title="" class="ltx_ref">2017</a>)</cite> initially proposed Federated Learning and an algorithm for computing model updates in a distributed way.
This algorithm repeatedly receives gradients from clients, averages them and applies them to the model.</p>
</div>
<div id="S2.p2" class="ltx_para">
<p id="S2.p2.1" class="ltx_p">Since neural networks can contain millions of parameters, this approach could lead to a high communication cost.
To make the algorithm feasible for large models, various compression techniques have been suggested subsequently <cite class="ltx_cite ltx_citemacro_citep">(Konečnỳ et al<span class="ltx_text">.</span>, <a href="#bib.bib16" title="" class="ltx_ref">2016</a>)</cite>.</p>
</div>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>Background</h2>

<section id="S3.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Federated Learning</h3>

<div id="S3.SS1.p1" class="ltx_para">
<p id="S3.SS1.p1.1" class="ltx_p">One of the reasons why machine learning has been applied so successfully to many problems in the past few years is that more data has become available.
For some applications of machine learning, collecting data can be privacy-invasive.
One such example application is predicting the next word that a person is going to use by considering the previously typed words.
This is typically done using machine learning nowadays, e.g. with recurrent neural networks and LSTMs <cite class="ltx_cite ltx_citemacro_citep">(Sundermeyer et al<span class="ltx_text">.</span>, <a href="#bib.bib26" title="" class="ltx_ref">2012</a>)</cite>.</p>
</div>
<div id="S3.SS1.p2" class="ltx_para">
<p id="S3.SS1.p2.1" class="ltx_p">Although it is possible to train such a model using a text corpus from Wikipedia, the language found there differs from the one commonly used by people in daily life.
To train a model on the same data distribution that is also used for inference when the model is deployed, one would need to collect data directly from users.
This, however, would violate the privacy of users.
Users do not want to send everything they type to a server.</p>
</div>
<div id="S3.SS1.p3" class="ltx_para">
<p id="S3.SS1.p3.1" class="ltx_p">Federated Learning is a recently proposed technique for training models on this data, without sending it to a server.
Instead, we collaboratively train a model by distributing the training process among many users.
A server has the role of coordinating this process but most of the work is not performed by a central entity anymore but by a <em id="S3.SS1.p3.1.1" class="ltx_emph ltx_font_italic">federation</em> of users.</p>
</div>
<div id="S3.SS1.p4" class="ltx_para">
<p id="S3.SS1.p4.1" class="ltx_p">Before the server starts off the distributed learning process, it needs to initialize the model.
Theoretically, this can be done arbitrarily, by using any of the common model initialization strategies.
In practice, it makes sense to intelligently initialize the model with sensible default values.
If some data is already available on the server, it can be used to pretrain the model.
In other cases, there might be a known configuration of model parameters that already leads to acceptable results.
Having a good first model gives the training process a head start and can reduce the time until convergence is reached.</p>
</div>
<div id="S3.SS1.p5" class="ltx_para">
<p id="S3.SS1.p5.6" class="ltx_p">After the model has been initialized, the iterative training process is kicked off.
At the beginning of an iteration, a subset of <math id="S3.SS1.p5.1.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S3.SS1.p5.1.m1.1a"><mi id="S3.SS1.p5.1.m1.1.1" xref="S3.SS1.p5.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.1.m1.1b"><ci id="S3.SS1.p5.1.m1.1.1.cmml" xref="S3.SS1.p5.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.1.m1.1c">K</annotation></semantics></math> clients is randomly selected by the server.
They receive a copy of the current model parameters and use their locally available training data to compute an update.
The updates are then sent back to the server.
We denote the model parameter tensor by <math id="S3.SS1.p5.2.m2.1" class="ltx_Math" alttext="\theta" display="inline"><semantics id="S3.SS1.p5.2.m2.1a"><mi id="S3.SS1.p5.2.m2.1.1" xref="S3.SS1.p5.2.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.2.m2.1b"><ci id="S3.SS1.p5.2.m2.1.1.cmml" xref="S3.SS1.p5.2.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.2.m2.1c">\theta</annotation></semantics></math>, the update of the <span id="S3.SS1.p5.3.1" class="ltx_text"><math id="S3.SS1.p5.3.1.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="S3.SS1.p5.3.1.m1.1a"><mi id="S3.SS1.p5.3.1.m1.1.1" xref="S3.SS1.p5.3.1.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.3.1.m1.1b"><ci id="S3.SS1.p5.3.1.m1.1.1.cmml" xref="S3.SS1.p5.3.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.3.1.m1.1c">i</annotation></semantics></math>-th</span> user by <math id="S3.SS1.p5.4.m3.1" class="ltx_Math" alttext="H_{i}" display="inline"><semantics id="S3.SS1.p5.4.m3.1a"><msub id="S3.SS1.p5.4.m3.1.1" xref="S3.SS1.p5.4.m3.1.1.cmml"><mi id="S3.SS1.p5.4.m3.1.1.2" xref="S3.SS1.p5.4.m3.1.1.2.cmml">H</mi><mi id="S3.SS1.p5.4.m3.1.1.3" xref="S3.SS1.p5.4.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.4.m3.1b"><apply id="S3.SS1.p5.4.m3.1.1.cmml" xref="S3.SS1.p5.4.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p5.4.m3.1.1.1.cmml" xref="S3.SS1.p5.4.m3.1.1">subscript</csymbol><ci id="S3.SS1.p5.4.m3.1.1.2.cmml" xref="S3.SS1.p5.4.m3.1.1.2">𝐻</ci><ci id="S3.SS1.p5.4.m3.1.1.3.cmml" xref="S3.SS1.p5.4.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.4.m3.1c">H_{i}</annotation></semantics></math>, and the number of data points on the computer of the <math id="S3.SS1.p5.5.m4.1" class="ltx_Math" alttext="i" display="inline"><semantics id="S3.SS1.p5.5.m4.1a"><mi id="S3.SS1.p5.5.m4.1.1" xref="S3.SS1.p5.5.m4.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.5.m4.1b"><ci id="S3.SS1.p5.5.m4.1.1.cmml" xref="S3.SS1.p5.5.m4.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.5.m4.1c">i</annotation></semantics></math>-th user by <math id="S3.SS1.p5.6.m5.1" class="ltx_Math" alttext="n_{i}" display="inline"><semantics id="S3.SS1.p5.6.m5.1a"><msub id="S3.SS1.p5.6.m5.1.1" xref="S3.SS1.p5.6.m5.1.1.cmml"><mi id="S3.SS1.p5.6.m5.1.1.2" xref="S3.SS1.p5.6.m5.1.1.2.cmml">n</mi><mi id="S3.SS1.p5.6.m5.1.1.3" xref="S3.SS1.p5.6.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p5.6.m5.1b"><apply id="S3.SS1.p5.6.m5.1.1.cmml" xref="S3.SS1.p5.6.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p5.6.m5.1.1.1.cmml" xref="S3.SS1.p5.6.m5.1.1">subscript</csymbol><ci id="S3.SS1.p5.6.m5.1.1.2.cmml" xref="S3.SS1.p5.6.m5.1.1.2">𝑛</ci><ci id="S3.SS1.p5.6.m5.1.1.3.cmml" xref="S3.SS1.p5.6.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p5.6.m5.1c">n_{i}</annotation></semantics></math>.
A visualization of the steps performed in each iteration is shown in Figure <a href="#S3.F2" title="Figure 2 ‣ 3.1. Federated Learning ‣ 3. Background ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<figure id="S3.F2" class="ltx_figure">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S3.F2.sf1" class="ltx_figure ltx_figure_panel"><img src="/html/1911.11807/assets/FL2.png" id="S3.F2.sf1.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="479" height="290" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S3.F2.sf1.4.2.1" class="ltx_text" style="font-size:90%;">(a)</span> </span><span id="S3.F2.sf1.2.1" class="ltx_text" style="font-size:90%;">The server selects <math id="S3.F2.sf1.2.1.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S3.F2.sf1.2.1.m1.1b"><mi id="S3.F2.sf1.2.1.m1.1.1" xref="S3.F2.sf1.2.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.F2.sf1.2.1.m1.1c"><ci id="S3.F2.sf1.2.1.m1.1.1.cmml" xref="S3.F2.sf1.2.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F2.sf1.2.1.m1.1d">K</annotation></semantics></math> users</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S3.F2.sf2" class="ltx_figure ltx_figure_panel"><img src="/html/1911.11807/assets/FL3.png" id="S3.F2.sf2.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="479" height="290" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S3.F2.sf2.2.1.1" class="ltx_text" style="font-size:90%;">(b)</span> </span><span id="S3.F2.sf2.3.2" class="ltx_text" style="font-size:90%;">They receive the current model</span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S3.F2.sf3" class="ltx_figure ltx_figure_panel"><img src="/html/1911.11807/assets/FL4.png" id="S3.F2.sf3.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="479" height="290" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S3.F2.sf3.2.1.1" class="ltx_text" style="font-size:90%;">(c)</span> </span><span id="S3.F2.sf3.3.2" class="ltx_text" style="font-size:90%;">and compute updates using their data</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S3.F2.sf4" class="ltx_figure ltx_figure_panel"><img src="/html/1911.11807/assets/FL5.png" id="S3.F2.sf4.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="479" height="290" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S3.F2.sf4.2.1.1" class="ltx_text" style="font-size:90%;">(d)</span> </span><span id="S3.F2.sf4.3.2" class="ltx_text" style="font-size:90%;">Updates are shared with the server</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span id="S3.F2.2.1.1" class="ltx_text" style="font-size:90%;">Figure 2</span>. </span><span id="S3.F2.3.2" class="ltx_text" style="font-size:90%;">One communication round in a Federated Learning system</span></figcaption>
</figure>
<div id="S3.SS1.p6" class="ltx_para ltx_noindent">
<p id="S3.SS1.p6.1" class="ltx_p">The server waits until it has received all updates of the iteration and then combines them into one final update.
This is usually done by computing an average of all updates, weighted by how many training examples the respective clients used.
The weights for iteration <math id="S3.SS1.p6.1.m1.1" class="ltx_Math" alttext="t" display="inline"><semantics id="S3.SS1.p6.1.m1.1a"><mi id="S3.SS1.p6.1.m1.1.1" xref="S3.SS1.p6.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.1.m1.1b"><ci id="S3.SS1.p6.1.m1.1.1.cmml" xref="S3.SS1.p6.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.1.m1.1c">t</annotation></semantics></math> are then computed using</p>
<table id="S3.Ex1" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S3.Ex1.m1.2" class="ltx_Math" alttext="\theta^{(t)}=\theta^{(t-1)}-\sum\limits_{i=1}^{K}\frac{n_{i}}{N}H_{i}" display="block"><semantics id="S3.Ex1.m1.2a"><mrow id="S3.Ex1.m1.2.3" xref="S3.Ex1.m1.2.3.cmml"><msup id="S3.Ex1.m1.2.3.2" xref="S3.Ex1.m1.2.3.2.cmml"><mi id="S3.Ex1.m1.2.3.2.2" xref="S3.Ex1.m1.2.3.2.2.cmml">θ</mi><mrow id="S3.Ex1.m1.1.1.1.3" xref="S3.Ex1.m1.2.3.2.cmml"><mo stretchy="false" id="S3.Ex1.m1.1.1.1.3.1" xref="S3.Ex1.m1.2.3.2.cmml">(</mo><mi id="S3.Ex1.m1.1.1.1.1" xref="S3.Ex1.m1.1.1.1.1.cmml">t</mi><mo stretchy="false" id="S3.Ex1.m1.1.1.1.3.2" xref="S3.Ex1.m1.2.3.2.cmml">)</mo></mrow></msup><mo id="S3.Ex1.m1.2.3.1" xref="S3.Ex1.m1.2.3.1.cmml">=</mo><mrow id="S3.Ex1.m1.2.3.3" xref="S3.Ex1.m1.2.3.3.cmml"><msup id="S3.Ex1.m1.2.3.3.2" xref="S3.Ex1.m1.2.3.3.2.cmml"><mi id="S3.Ex1.m1.2.3.3.2.2" xref="S3.Ex1.m1.2.3.3.2.2.cmml">θ</mi><mrow id="S3.Ex1.m1.2.2.1.1" xref="S3.Ex1.m1.2.2.1.1.1.cmml"><mo stretchy="false" id="S3.Ex1.m1.2.2.1.1.2" xref="S3.Ex1.m1.2.2.1.1.1.cmml">(</mo><mrow id="S3.Ex1.m1.2.2.1.1.1" xref="S3.Ex1.m1.2.2.1.1.1.cmml"><mi id="S3.Ex1.m1.2.2.1.1.1.2" xref="S3.Ex1.m1.2.2.1.1.1.2.cmml">t</mi><mo id="S3.Ex1.m1.2.2.1.1.1.1" xref="S3.Ex1.m1.2.2.1.1.1.1.cmml">−</mo><mn id="S3.Ex1.m1.2.2.1.1.1.3" xref="S3.Ex1.m1.2.2.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S3.Ex1.m1.2.2.1.1.3" xref="S3.Ex1.m1.2.2.1.1.1.cmml">)</mo></mrow></msup><mo rspace="0.055em" id="S3.Ex1.m1.2.3.3.1" xref="S3.Ex1.m1.2.3.3.1.cmml">−</mo><mrow id="S3.Ex1.m1.2.3.3.3" xref="S3.Ex1.m1.2.3.3.3.cmml"><munderover id="S3.Ex1.m1.2.3.3.3.1" xref="S3.Ex1.m1.2.3.3.3.1.cmml"><mo movablelimits="false" id="S3.Ex1.m1.2.3.3.3.1.2.2" xref="S3.Ex1.m1.2.3.3.3.1.2.2.cmml">∑</mo><mrow id="S3.Ex1.m1.2.3.3.3.1.2.3" xref="S3.Ex1.m1.2.3.3.3.1.2.3.cmml"><mi id="S3.Ex1.m1.2.3.3.3.1.2.3.2" xref="S3.Ex1.m1.2.3.3.3.1.2.3.2.cmml">i</mi><mo id="S3.Ex1.m1.2.3.3.3.1.2.3.1" xref="S3.Ex1.m1.2.3.3.3.1.2.3.1.cmml">=</mo><mn id="S3.Ex1.m1.2.3.3.3.1.2.3.3" xref="S3.Ex1.m1.2.3.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.Ex1.m1.2.3.3.3.1.3" xref="S3.Ex1.m1.2.3.3.3.1.3.cmml">K</mi></munderover><mrow id="S3.Ex1.m1.2.3.3.3.2" xref="S3.Ex1.m1.2.3.3.3.2.cmml"><mfrac id="S3.Ex1.m1.2.3.3.3.2.2" xref="S3.Ex1.m1.2.3.3.3.2.2.cmml"><msub id="S3.Ex1.m1.2.3.3.3.2.2.2" xref="S3.Ex1.m1.2.3.3.3.2.2.2.cmml"><mi id="S3.Ex1.m1.2.3.3.3.2.2.2.2" xref="S3.Ex1.m1.2.3.3.3.2.2.2.2.cmml">n</mi><mi id="S3.Ex1.m1.2.3.3.3.2.2.2.3" xref="S3.Ex1.m1.2.3.3.3.2.2.2.3.cmml">i</mi></msub><mi id="S3.Ex1.m1.2.3.3.3.2.2.3" xref="S3.Ex1.m1.2.3.3.3.2.2.3.cmml">N</mi></mfrac><mo lspace="0em" rspace="0em" id="S3.Ex1.m1.2.3.3.3.2.1" xref="S3.Ex1.m1.2.3.3.3.2.1.cmml">​</mo><msub id="S3.Ex1.m1.2.3.3.3.2.3" xref="S3.Ex1.m1.2.3.3.3.2.3.cmml"><mi id="S3.Ex1.m1.2.3.3.3.2.3.2" xref="S3.Ex1.m1.2.3.3.3.2.3.2.cmml">H</mi><mi id="S3.Ex1.m1.2.3.3.3.2.3.3" xref="S3.Ex1.m1.2.3.3.3.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.2b"><apply id="S3.Ex1.m1.2.3.cmml" xref="S3.Ex1.m1.2.3"><eq id="S3.Ex1.m1.2.3.1.cmml" xref="S3.Ex1.m1.2.3.1"></eq><apply id="S3.Ex1.m1.2.3.2.cmml" xref="S3.Ex1.m1.2.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.2.1.cmml" xref="S3.Ex1.m1.2.3.2">superscript</csymbol><ci id="S3.Ex1.m1.2.3.2.2.cmml" xref="S3.Ex1.m1.2.3.2.2">𝜃</ci><ci id="S3.Ex1.m1.1.1.1.1.cmml" xref="S3.Ex1.m1.1.1.1.1">𝑡</ci></apply><apply id="S3.Ex1.m1.2.3.3.cmml" xref="S3.Ex1.m1.2.3.3"><minus id="S3.Ex1.m1.2.3.3.1.cmml" xref="S3.Ex1.m1.2.3.3.1"></minus><apply id="S3.Ex1.m1.2.3.3.2.cmml" xref="S3.Ex1.m1.2.3.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.3.2.1.cmml" xref="S3.Ex1.m1.2.3.3.2">superscript</csymbol><ci id="S3.Ex1.m1.2.3.3.2.2.cmml" xref="S3.Ex1.m1.2.3.3.2.2">𝜃</ci><apply id="S3.Ex1.m1.2.2.1.1.1.cmml" xref="S3.Ex1.m1.2.2.1.1"><minus id="S3.Ex1.m1.2.2.1.1.1.1.cmml" xref="S3.Ex1.m1.2.2.1.1.1.1"></minus><ci id="S3.Ex1.m1.2.2.1.1.1.2.cmml" xref="S3.Ex1.m1.2.2.1.1.1.2">𝑡</ci><cn type="integer" id="S3.Ex1.m1.2.2.1.1.1.3.cmml" xref="S3.Ex1.m1.2.2.1.1.1.3">1</cn></apply></apply><apply id="S3.Ex1.m1.2.3.3.3.cmml" xref="S3.Ex1.m1.2.3.3.3"><apply id="S3.Ex1.m1.2.3.3.3.1.cmml" xref="S3.Ex1.m1.2.3.3.3.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.3.3.1.1.cmml" xref="S3.Ex1.m1.2.3.3.3.1">superscript</csymbol><apply id="S3.Ex1.m1.2.3.3.3.1.2.cmml" xref="S3.Ex1.m1.2.3.3.3.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.3.3.1.2.1.cmml" xref="S3.Ex1.m1.2.3.3.3.1">subscript</csymbol><sum id="S3.Ex1.m1.2.3.3.3.1.2.2.cmml" xref="S3.Ex1.m1.2.3.3.3.1.2.2"></sum><apply id="S3.Ex1.m1.2.3.3.3.1.2.3.cmml" xref="S3.Ex1.m1.2.3.3.3.1.2.3"><eq id="S3.Ex1.m1.2.3.3.3.1.2.3.1.cmml" xref="S3.Ex1.m1.2.3.3.3.1.2.3.1"></eq><ci id="S3.Ex1.m1.2.3.3.3.1.2.3.2.cmml" xref="S3.Ex1.m1.2.3.3.3.1.2.3.2">𝑖</ci><cn type="integer" id="S3.Ex1.m1.2.3.3.3.1.2.3.3.cmml" xref="S3.Ex1.m1.2.3.3.3.1.2.3.3">1</cn></apply></apply><ci id="S3.Ex1.m1.2.3.3.3.1.3.cmml" xref="S3.Ex1.m1.2.3.3.3.1.3">𝐾</ci></apply><apply id="S3.Ex1.m1.2.3.3.3.2.cmml" xref="S3.Ex1.m1.2.3.3.3.2"><times id="S3.Ex1.m1.2.3.3.3.2.1.cmml" xref="S3.Ex1.m1.2.3.3.3.2.1"></times><apply id="S3.Ex1.m1.2.3.3.3.2.2.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2"><divide id="S3.Ex1.m1.2.3.3.3.2.2.1.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2"></divide><apply id="S3.Ex1.m1.2.3.3.3.2.2.2.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.3.3.2.2.2.1.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2.2">subscript</csymbol><ci id="S3.Ex1.m1.2.3.3.3.2.2.2.2.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2.2.2">𝑛</ci><ci id="S3.Ex1.m1.2.3.3.3.2.2.2.3.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2.2.3">𝑖</ci></apply><ci id="S3.Ex1.m1.2.3.3.3.2.2.3.cmml" xref="S3.Ex1.m1.2.3.3.3.2.2.3">𝑁</ci></apply><apply id="S3.Ex1.m1.2.3.3.3.2.3.cmml" xref="S3.Ex1.m1.2.3.3.3.2.3"><csymbol cd="ambiguous" id="S3.Ex1.m1.2.3.3.3.2.3.1.cmml" xref="S3.Ex1.m1.2.3.3.3.2.3">subscript</csymbol><ci id="S3.Ex1.m1.2.3.3.3.2.3.2.cmml" xref="S3.Ex1.m1.2.3.3.3.2.3.2">𝐻</ci><ci id="S3.Ex1.m1.2.3.3.3.2.3.3.cmml" xref="S3.Ex1.m1.2.3.3.3.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.2c">\theta^{(t)}=\theta^{(t-1)}-\sum\limits_{i=1}^{K}\frac{n_{i}}{N}H_{i}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S3.SS1.p6.2" class="ltx_p">where <math id="S3.SS1.p6.2.m1.1" class="ltx_Math" alttext="N=\sum_{i=1}^{K}n_{i}" display="inline"><semantics id="S3.SS1.p6.2.m1.1a"><mrow id="S3.SS1.p6.2.m1.1.1" xref="S3.SS1.p6.2.m1.1.1.cmml"><mi id="S3.SS1.p6.2.m1.1.1.2" xref="S3.SS1.p6.2.m1.1.1.2.cmml">N</mi><mo rspace="0.111em" id="S3.SS1.p6.2.m1.1.1.1" xref="S3.SS1.p6.2.m1.1.1.1.cmml">=</mo><mrow id="S3.SS1.p6.2.m1.1.1.3" xref="S3.SS1.p6.2.m1.1.1.3.cmml"><msubsup id="S3.SS1.p6.2.m1.1.1.3.1" xref="S3.SS1.p6.2.m1.1.1.3.1.cmml"><mo id="S3.SS1.p6.2.m1.1.1.3.1.2.2" xref="S3.SS1.p6.2.m1.1.1.3.1.2.2.cmml">∑</mo><mrow id="S3.SS1.p6.2.m1.1.1.3.1.2.3" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.cmml"><mi id="S3.SS1.p6.2.m1.1.1.3.1.2.3.2" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.2.cmml">i</mi><mo id="S3.SS1.p6.2.m1.1.1.3.1.2.3.1" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.1.cmml">=</mo><mn id="S3.SS1.p6.2.m1.1.1.3.1.2.3.3" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.SS1.p6.2.m1.1.1.3.1.3" xref="S3.SS1.p6.2.m1.1.1.3.1.3.cmml">K</mi></msubsup><msub id="S3.SS1.p6.2.m1.1.1.3.2" xref="S3.SS1.p6.2.m1.1.1.3.2.cmml"><mi id="S3.SS1.p6.2.m1.1.1.3.2.2" xref="S3.SS1.p6.2.m1.1.1.3.2.2.cmml">n</mi><mi id="S3.SS1.p6.2.m1.1.1.3.2.3" xref="S3.SS1.p6.2.m1.1.1.3.2.3.cmml">i</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.2.m1.1b"><apply id="S3.SS1.p6.2.m1.1.1.cmml" xref="S3.SS1.p6.2.m1.1.1"><eq id="S3.SS1.p6.2.m1.1.1.1.cmml" xref="S3.SS1.p6.2.m1.1.1.1"></eq><ci id="S3.SS1.p6.2.m1.1.1.2.cmml" xref="S3.SS1.p6.2.m1.1.1.2">𝑁</ci><apply id="S3.SS1.p6.2.m1.1.1.3.cmml" xref="S3.SS1.p6.2.m1.1.1.3"><apply id="S3.SS1.p6.2.m1.1.1.3.1.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1"><csymbol cd="ambiguous" id="S3.SS1.p6.2.m1.1.1.3.1.1.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1">superscript</csymbol><apply id="S3.SS1.p6.2.m1.1.1.3.1.2.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1"><csymbol cd="ambiguous" id="S3.SS1.p6.2.m1.1.1.3.1.2.1.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1">subscript</csymbol><sum id="S3.SS1.p6.2.m1.1.1.3.1.2.2.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.2.2"></sum><apply id="S3.SS1.p6.2.m1.1.1.3.1.2.3.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3"><eq id="S3.SS1.p6.2.m1.1.1.3.1.2.3.1.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.1"></eq><ci id="S3.SS1.p6.2.m1.1.1.3.1.2.3.2.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.2">𝑖</ci><cn type="integer" id="S3.SS1.p6.2.m1.1.1.3.1.2.3.3.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="S3.SS1.p6.2.m1.1.1.3.1.3.cmml" xref="S3.SS1.p6.2.m1.1.1.3.1.3">𝐾</ci></apply><apply id="S3.SS1.p6.2.m1.1.1.3.2.cmml" xref="S3.SS1.p6.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.SS1.p6.2.m1.1.1.3.2.1.cmml" xref="S3.SS1.p6.2.m1.1.1.3.2">subscript</csymbol><ci id="S3.SS1.p6.2.m1.1.1.3.2.2.cmml" xref="S3.SS1.p6.2.m1.1.1.3.2.2">𝑛</ci><ci id="S3.SS1.p6.2.m1.1.1.3.2.3.cmml" xref="S3.SS1.p6.2.m1.1.1.3.2.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.2.m1.1c">N=\sum_{i=1}^{K}n_{i}</annotation></semantics></math> is the total number of data points used in this round.
A new iteration begins after every model update.</p>
</div>
<div id="S3.SS1.p7" class="ltx_para">
<p id="S3.SS1.p7.1" class="ltx_p">In each iteration only <math id="S3.SS1.p7.1.m1.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S3.SS1.p7.1.m1.1a"><mi id="S3.SS1.p7.1.m1.1.1" xref="S3.SS1.p7.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p7.1.m1.1b"><ci id="S3.SS1.p7.1.m1.1.1.cmml" xref="S3.SS1.p7.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p7.1.m1.1c">K</annotation></semantics></math> users are queried for updates.
While requesting updates from all users would lead to more stable model improvements, it would also be extremely expensive to do because there could be millions of users.
Only querying a subset of them makes it more feasible to efficiently run many iterations.</p>
</div>
<div id="S3.SS1.p8" class="ltx_para">
<p id="S3.SS1.p8.1" class="ltx_p">This training process is then repeated until the model parameters converge, as determined by an appropriate criterion.
In some situations, it can also make sense to keep the training running indefinitely.
This can for example be the case in some recommender system applications, where the model needs to deal with new data all the time.
</p>
</div>
<div id="S3.SS1.p9" class="ltx_para">
<p id="S3.SS1.p9.1" class="ltx_p">One potential attack vector against Federated Learning systems is trying to analyze updates sent to the server, in order to make conclusions about the original data.
To prevent such <span id="S3.SS1.p9.1.1" class="ltx_text">man-in-the-middle</span> attacks, <em id="S3.SS1.p9.1.2" class="ltx_emph ltx_font_italic">secure multi-party aggregation</em> mechanisms can be used <cite class="ltx_cite ltx_citemacro_citep">(Bonawitz et al<span class="ltx_text">.</span>, <a href="#bib.bib5" title="" class="ltx_ref">2016</a>; Hardy et al<span class="ltx_text">.</span>, <a href="#bib.bib10" title="" class="ltx_ref">2017</a>)</cite>.
These protocols use encryption techniques to allow only the analysis of the aggregated updates from a certain number of users, thus securing individual updates.</p>
</div>
<div id="S3.SS1.p10" class="ltx_para">
<p id="S3.SS1.p10.1" class="ltx_p">To ensure that the model itself does not implicitly memorize personal information, <em id="S3.SS1.p10.1.1" class="ltx_emph ltx_font_italic">differential privacy</em> <cite class="ltx_cite ltx_citemacro_citep">(Dwork
et al<span class="ltx_text">.</span>, <a href="#bib.bib8" title="" class="ltx_ref">2014</a>)</cite> offers a framework to formalize privacy.
Differential privacy has been applied to Federated Learning, and there exist gradient descent variants that adhere to a specified level of <math id="S3.SS1.p10.1.m1.2" class="ltx_Math" alttext="(\epsilon,\delta)" display="inline"><semantics id="S3.SS1.p10.1.m1.2a"><mrow id="S3.SS1.p10.1.m1.2.3.2" xref="S3.SS1.p10.1.m1.2.3.1.cmml"><mo stretchy="false" id="S3.SS1.p10.1.m1.2.3.2.1" xref="S3.SS1.p10.1.m1.2.3.1.cmml">(</mo><mi id="S3.SS1.p10.1.m1.1.1" xref="S3.SS1.p10.1.m1.1.1.cmml">ϵ</mi><mo id="S3.SS1.p10.1.m1.2.3.2.2" xref="S3.SS1.p10.1.m1.2.3.1.cmml">,</mo><mi id="S3.SS1.p10.1.m1.2.2" xref="S3.SS1.p10.1.m1.2.2.cmml">δ</mi><mo stretchy="false" id="S3.SS1.p10.1.m1.2.3.2.3" xref="S3.SS1.p10.1.m1.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p10.1.m1.2b"><interval closure="open" id="S3.SS1.p10.1.m1.2.3.1.cmml" xref="S3.SS1.p10.1.m1.2.3.2"><ci id="S3.SS1.p10.1.m1.1.1.cmml" xref="S3.SS1.p10.1.m1.1.1">italic-ϵ</ci><ci id="S3.SS1.p10.1.m1.2.2.cmml" xref="S3.SS1.p10.1.m1.2.2">𝛿</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p10.1.m1.2c">(\epsilon,\delta)</annotation></semantics></math>-differential privacy <cite class="ltx_cite ltx_citemacro_citep">(Abadi et al<span class="ltx_text">.</span>, <a href="#bib.bib3" title="" class="ltx_ref">2016b</a>; McMahan
et al<span class="ltx_text">.</span>, <a href="#bib.bib19" title="" class="ltx_ref">2018</a>)</cite>.</p>
</div>
</section>
<section id="S3.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Learning to Rank</h3>

<div id="S3.SS2.p1" class="ltx_para">
<p id="S3.SS2.p1.1" class="ltx_p">A ranking algorithm takes a set of items and sorts them by some criterion.
Before diving into ranking in the Firefox URL bar, it is worth taking a step back to understand how ranking in machine learning works.
This makes it easier to see how the current implementation fits into a learning system.
Fundamentally, there are three different approaches to learning a ranking algorithm <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a href="#bib.bib17" title="" class="ltx_ref">2009</a>; Cao
et al<span class="ltx_text">.</span>, <a href="#bib.bib7" title="" class="ltx_ref">2007</a>)</cite>.</p>
</div>
<div id="S3.SS2.p2" class="ltx_para">
<p id="S3.SS2.p2.1" class="ltx_p"><em id="S3.SS2.p2.1.1" class="ltx_emph ltx_font_italic">Pointwise ranking</em> algorithms process all items individually and assign a score to each item independently of the others.
The ranking is then determined by sorting all items using their respective scores.
Essentially, this is a special type of a regression model since we are assigning a real number to each input.</p>
</div>
<div id="S3.SS2.p3" class="ltx_para">
<p id="S3.SS2.p3.1" class="ltx_p">A <em id="S3.SS2.p3.1.1" class="ltx_emph ltx_font_italic">pairwise ranking</em> model learns to compare pairs of items.
Its task is to decide which of the two items should be ranked higher.
The learned comparison function can then be used to sort the items.
In this approach, we treat the problem as a classification task since the model can only have two possible outputs.</p>
</div>
<div id="S3.SS2.p4" class="ltx_para">
<p id="S3.SS2.p4.1" class="ltx_p">The third approach is <em id="S3.SS2.p4.1.1" class="ltx_emph ltx_font_italic">listwise ranking</em>, which are methods that try to operate on the entire list.
The motivation behind this idea is to optimize information retrieval metrics directly.
In practice, this turns out to be fairly difficult because many of those metrics are not differentiable and the models need to work with more inputs.</p>
</div>
<div id="S3.SS2.p5" class="ltx_para">
<p id="S3.SS2.p5.1" class="ltx_p">All these approaches have different advantages and disadvantages.
The existing ranking algorithm in Firefox is very similar to a pointwise ranking approach.
Since this algorithm should be optimized using machine learning techniques, this gives us a clear set of techniques that could be useful in this project.
To optimize the current algorithm, we took a known pairwise ranking loss function and adapted it to work with our pointwise ranking system.</p>
</div>
</section>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Search in the Firefox URL bar</h2>

<div id="S4.p1" class="ltx_para">
<p id="S4.p1.1" class="ltx_p">The Firefox URL bar offers suggestions when users type a search query.
A part of these suggestions is provided directly by a search engine.
The others are generated by Firefox itself, for example based on the user’s history, bookmarks, or open tabs.
We tried to optimize the history and bookmark suggestions using our project.
The search engine results are shown below those, and we have no influence over their selection and ranking since everything is provided directly by the search engine.
</p>
</div>
<div id="S4.p2" class="ltx_para">
<p id="S4.p2.1" class="ltx_p">Searching for history and bookmark entries in the Firefox URL bar is a two-step process:</p>
<ol id="S4.I1" class="ltx_enumerate">
<li id="S4.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span> 
<div id="S4.I1.i1.p1" class="ltx_para">
<p id="S4.I1.i1.p1.1" class="ltx_p">The search query is matched against the browser history and bookmarks. Matching is a binary decision. Pages either match the query or do not.</p>
</div>
</li>
<li id="S4.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span> 
<div id="S4.I1.i2.p1" class="ltx_para">
<p id="S4.I1.i2.p1.1" class="ltx_p">The set of matched links is ranked based on the user’s history.</p>
</div>
</li>
</ol>
</div>
<div id="S4.p3" class="ltx_para">
<p id="S4.p3.1" class="ltx_p">Our project purely tries to optimize the ranking part of this process.
Future work could tackle the problem directly from the query matching.</p>
</div>
<div id="S4.p4" class="ltx_para">
<p id="S4.p4.1" class="ltx_p">The ranking of possible suggestions in the Firefox URL bar is determined using <em id="S4.p4.1.1" class="ltx_emph ltx_font_italic">frecency</em> <cite class="ltx_cite ltx_citemacro_citep">(Network, <a href="#bib.bib22" title="" class="ltx_ref">2019c</a>)</cite>, an algorithm that weights how <em id="S4.p4.1.2" class="ltx_emph ltx_font_italic">frequently</em> and <em id="S4.p4.1.3" class="ltx_emph ltx_font_italic">recently</em> a site was visited.
To do this, a frecency score is assigned to each history entry and bookmark entry.
After the score is computed, it is cached.
When searching, the matched results are then sorted using their frecency scores.
This makes frecency a pointwise ranking approach.</p>
</div>
<div id="S4.p5" class="ltx_para">
<p id="S4.p5.2" class="ltx_p">Frecency does not only take frequency and recency into account but also other information, such as how the page was visited and whether it is bookmarked.
It does this by looking at the latest visits to the respective site.
The value <math id="S4.p5.1.m1.2" class="ltx_Math" alttext="\operatorname{visit}(v)" display="inline"><semantics id="S4.p5.1.m1.2a"><mrow id="S4.p5.1.m1.2.3.2" xref="S4.p5.1.m1.2.3.1.cmml"><mi id="S4.p5.1.m1.1.1" xref="S4.p5.1.m1.1.1.cmml">visit</mi><mo id="S4.p5.1.m1.2.3.2a" xref="S4.p5.1.m1.2.3.1.cmml">⁡</mo><mrow id="S4.p5.1.m1.2.3.2.1" xref="S4.p5.1.m1.2.3.1.cmml"><mo stretchy="false" id="S4.p5.1.m1.2.3.2.1.1" xref="S4.p5.1.m1.2.3.1.cmml">(</mo><mi id="S4.p5.1.m1.2.2" xref="S4.p5.1.m1.2.2.cmml">v</mi><mo stretchy="false" id="S4.p5.1.m1.2.3.2.1.2" xref="S4.p5.1.m1.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p5.1.m1.2b"><apply id="S4.p5.1.m1.2.3.1.cmml" xref="S4.p5.1.m1.2.3.2"><ci id="S4.p5.1.m1.1.1.cmml" xref="S4.p5.1.m1.1.1">visit</ci><ci id="S4.p5.1.m1.2.2.cmml" xref="S4.p5.1.m1.2.2">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.1.m1.2c">\operatorname{visit}(v)</annotation></semantics></math> of one single visit <math id="S4.p5.2.m2.1" class="ltx_Math" alttext="v" display="inline"><semantics id="S4.p5.2.m2.1a"><mi id="S4.p5.2.m2.1.1" xref="S4.p5.2.m2.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S4.p5.2.m2.1b"><ci id="S4.p5.2.m2.1.1.cmml" xref="S4.p5.2.m2.1.1">𝑣</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.2.m2.1c">v</annotation></semantics></math> is then defined by how recent that visit was, scaled by the type of visit:</p>
<table id="S4.Ex2" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.Ex2.m1.6" class="ltx_Math" alttext="\operatorname{visit}(v)=\operatorname{recency}(v)*\operatorname{type}(v)" display="block"><semantics id="S4.Ex2.m1.6a"><mrow id="S4.Ex2.m1.6.7" xref="S4.Ex2.m1.6.7.cmml"><mrow id="S4.Ex2.m1.6.7.2.2" xref="S4.Ex2.m1.6.7.2.1.cmml"><mi id="S4.Ex2.m1.1.1" xref="S4.Ex2.m1.1.1.cmml">visit</mi><mo id="S4.Ex2.m1.6.7.2.2a" xref="S4.Ex2.m1.6.7.2.1.cmml">⁡</mo><mrow id="S4.Ex2.m1.6.7.2.2.1" xref="S4.Ex2.m1.6.7.2.1.cmml"><mo stretchy="false" id="S4.Ex2.m1.6.7.2.2.1.1" xref="S4.Ex2.m1.6.7.2.1.cmml">(</mo><mi id="S4.Ex2.m1.2.2" xref="S4.Ex2.m1.2.2.cmml">v</mi><mo stretchy="false" id="S4.Ex2.m1.6.7.2.2.1.2" xref="S4.Ex2.m1.6.7.2.1.cmml">)</mo></mrow></mrow><mo id="S4.Ex2.m1.6.7.1" xref="S4.Ex2.m1.6.7.1.cmml">=</mo><mrow id="S4.Ex2.m1.6.7.3" xref="S4.Ex2.m1.6.7.3.cmml"><mrow id="S4.Ex2.m1.6.7.3.2.2" xref="S4.Ex2.m1.6.7.3.2.1.cmml"><mi id="S4.Ex2.m1.3.3" xref="S4.Ex2.m1.3.3.cmml">recency</mi><mo id="S4.Ex2.m1.6.7.3.2.2a" xref="S4.Ex2.m1.6.7.3.2.1.cmml">⁡</mo><mrow id="S4.Ex2.m1.6.7.3.2.2.1" xref="S4.Ex2.m1.6.7.3.2.1.cmml"><mo stretchy="false" id="S4.Ex2.m1.6.7.3.2.2.1.1" xref="S4.Ex2.m1.6.7.3.2.1.cmml">(</mo><mi id="S4.Ex2.m1.4.4" xref="S4.Ex2.m1.4.4.cmml">v</mi><mo rspace="0.055em" stretchy="false" id="S4.Ex2.m1.6.7.3.2.2.1.2" xref="S4.Ex2.m1.6.7.3.2.1.cmml">)</mo></mrow></mrow><mo rspace="0.222em" id="S4.Ex2.m1.6.7.3.1" xref="S4.Ex2.m1.6.7.3.1.cmml">∗</mo><mrow id="S4.Ex2.m1.6.7.3.3.2" xref="S4.Ex2.m1.6.7.3.3.1.cmml"><mi id="S4.Ex2.m1.5.5" xref="S4.Ex2.m1.5.5.cmml">type</mi><mo id="S4.Ex2.m1.6.7.3.3.2a" xref="S4.Ex2.m1.6.7.3.3.1.cmml">⁡</mo><mrow id="S4.Ex2.m1.6.7.3.3.2.1" xref="S4.Ex2.m1.6.7.3.3.1.cmml"><mo stretchy="false" id="S4.Ex2.m1.6.7.3.3.2.1.1" xref="S4.Ex2.m1.6.7.3.3.1.cmml">(</mo><mi id="S4.Ex2.m1.6.6" xref="S4.Ex2.m1.6.6.cmml">v</mi><mo stretchy="false" id="S4.Ex2.m1.6.7.3.3.2.1.2" xref="S4.Ex2.m1.6.7.3.3.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex2.m1.6b"><apply id="S4.Ex2.m1.6.7.cmml" xref="S4.Ex2.m1.6.7"><eq id="S4.Ex2.m1.6.7.1.cmml" xref="S4.Ex2.m1.6.7.1"></eq><apply id="S4.Ex2.m1.6.7.2.1.cmml" xref="S4.Ex2.m1.6.7.2.2"><ci id="S4.Ex2.m1.1.1.cmml" xref="S4.Ex2.m1.1.1">visit</ci><ci id="S4.Ex2.m1.2.2.cmml" xref="S4.Ex2.m1.2.2">𝑣</ci></apply><apply id="S4.Ex2.m1.6.7.3.cmml" xref="S4.Ex2.m1.6.7.3"><times id="S4.Ex2.m1.6.7.3.1.cmml" xref="S4.Ex2.m1.6.7.3.1"></times><apply id="S4.Ex2.m1.6.7.3.2.1.cmml" xref="S4.Ex2.m1.6.7.3.2.2"><ci id="S4.Ex2.m1.3.3.cmml" xref="S4.Ex2.m1.3.3">recency</ci><ci id="S4.Ex2.m1.4.4.cmml" xref="S4.Ex2.m1.4.4">𝑣</ci></apply><apply id="S4.Ex2.m1.6.7.3.3.1.cmml" xref="S4.Ex2.m1.6.7.3.3.2"><ci id="S4.Ex2.m1.5.5.cmml" xref="S4.Ex2.m1.5.5">type</ci><ci id="S4.Ex2.m1.6.6.cmml" xref="S4.Ex2.m1.6.6">𝑣</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex2.m1.6c">\operatorname{visit}(v)=\operatorname{recency}(v)*\operatorname{type}(v)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S4.p6" class="ltx_para">
<p id="S4.p6.1" class="ltx_p">Frecency scores have to be cached in order to allow an efficient ranking while the user is typing.
This means that the recency aspect has to be modeled using time buckets.
Otherwise, the score would change all the time and caching would not work.
In the current Firefox implementation, there are five time buckets.
With this approach, the recency score only changes when a visit changes time buckets:</p>
<table id="S4.Ex3" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.Ex3.m1.12" class="ltx_Math" alttext="\operatorname{recency}(v)=\begin{cases}100&amp;\text{if visited in the past 4 days}\\
70&amp;\text{if visited in the past 14 days}\\
50&amp;\text{if visited in the past 31 days}\\
30&amp;\text{if visited in the past 90 days}\\
10&amp;\text{otherwise}\end{cases}" display="block"><semantics id="S4.Ex3.m1.12a"><mrow id="S4.Ex3.m1.12.13" xref="S4.Ex3.m1.12.13.cmml"><mrow id="S4.Ex3.m1.12.13.2.2" xref="S4.Ex3.m1.12.13.2.1.cmml"><mi id="S4.Ex3.m1.11.11" xref="S4.Ex3.m1.11.11.cmml">recency</mi><mo id="S4.Ex3.m1.12.13.2.2a" xref="S4.Ex3.m1.12.13.2.1.cmml">⁡</mo><mrow id="S4.Ex3.m1.12.13.2.2.1" xref="S4.Ex3.m1.12.13.2.1.cmml"><mo stretchy="false" id="S4.Ex3.m1.12.13.2.2.1.1" xref="S4.Ex3.m1.12.13.2.1.cmml">(</mo><mi id="S4.Ex3.m1.12.12" xref="S4.Ex3.m1.12.12.cmml">v</mi><mo stretchy="false" id="S4.Ex3.m1.12.13.2.2.1.2" xref="S4.Ex3.m1.12.13.2.1.cmml">)</mo></mrow></mrow><mo id="S4.Ex3.m1.12.13.1" xref="S4.Ex3.m1.12.13.1.cmml">=</mo><mrow id="S4.Ex3.m1.10.10" xref="S4.Ex3.m1.12.13.3.1.cmml"><mo id="S4.Ex3.m1.10.10.11" xref="S4.Ex3.m1.12.13.3.1.1.cmml">{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt" id="S4.Ex3.m1.10.10.10" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtr id="S4.Ex3.m1.10.10.10a" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10b" xref="S4.Ex3.m1.12.13.3.1.cmml"><mn id="S4.Ex3.m1.1.1.1.1.1.1" xref="S4.Ex3.m1.1.1.1.1.1.1.cmml">100</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10c" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtext id="S4.Ex3.m1.2.2.2.2.2.1" xref="S4.Ex3.m1.2.2.2.2.2.1a.cmml">if visited in the past 4 days</mtext></mtd></mtr><mtr id="S4.Ex3.m1.10.10.10d" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10e" xref="S4.Ex3.m1.12.13.3.1.cmml"><mn id="S4.Ex3.m1.3.3.3.3.1.1" xref="S4.Ex3.m1.3.3.3.3.1.1.cmml">70</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10f" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtext id="S4.Ex3.m1.4.4.4.4.2.1" xref="S4.Ex3.m1.4.4.4.4.2.1a.cmml">if visited in the past 14 days</mtext></mtd></mtr><mtr id="S4.Ex3.m1.10.10.10g" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10h" xref="S4.Ex3.m1.12.13.3.1.cmml"><mn id="S4.Ex3.m1.5.5.5.5.1.1" xref="S4.Ex3.m1.5.5.5.5.1.1.cmml">50</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10i" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtext id="S4.Ex3.m1.6.6.6.6.2.1" xref="S4.Ex3.m1.6.6.6.6.2.1a.cmml">if visited in the past 31 days</mtext></mtd></mtr><mtr id="S4.Ex3.m1.10.10.10j" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10k" xref="S4.Ex3.m1.12.13.3.1.cmml"><mn id="S4.Ex3.m1.7.7.7.7.1.1" xref="S4.Ex3.m1.7.7.7.7.1.1.cmml">30</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10l" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtext id="S4.Ex3.m1.8.8.8.8.2.1" xref="S4.Ex3.m1.8.8.8.8.2.1a.cmml">if visited in the past 90 days</mtext></mtd></mtr><mtr id="S4.Ex3.m1.10.10.10m" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10n" xref="S4.Ex3.m1.12.13.3.1.cmml"><mn id="S4.Ex3.m1.9.9.9.9.1.1" xref="S4.Ex3.m1.9.9.9.9.1.1.cmml">10</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex3.m1.10.10.10o" xref="S4.Ex3.m1.12.13.3.1.cmml"><mtext id="S4.Ex3.m1.10.10.10.10.2.1" xref="S4.Ex3.m1.10.10.10.10.2.1a.cmml">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex3.m1.12b"><apply id="S4.Ex3.m1.12.13.cmml" xref="S4.Ex3.m1.12.13"><eq id="S4.Ex3.m1.12.13.1.cmml" xref="S4.Ex3.m1.12.13.1"></eq><apply id="S4.Ex3.m1.12.13.2.1.cmml" xref="S4.Ex3.m1.12.13.2.2"><ci id="S4.Ex3.m1.11.11.cmml" xref="S4.Ex3.m1.11.11">recency</ci><ci id="S4.Ex3.m1.12.12.cmml" xref="S4.Ex3.m1.12.12">𝑣</ci></apply><apply id="S4.Ex3.m1.12.13.3.1.cmml" xref="S4.Ex3.m1.10.10"><csymbol cd="latexml" id="S4.Ex3.m1.12.13.3.1.1.cmml" xref="S4.Ex3.m1.10.10.11">cases</csymbol><cn type="integer" id="S4.Ex3.m1.1.1.1.1.1.1.cmml" xref="S4.Ex3.m1.1.1.1.1.1.1">100</cn><ci id="S4.Ex3.m1.2.2.2.2.2.1a.cmml" xref="S4.Ex3.m1.2.2.2.2.2.1"><mtext id="S4.Ex3.m1.2.2.2.2.2.1.cmml" xref="S4.Ex3.m1.2.2.2.2.2.1">if visited in the past 4 days</mtext></ci><cn type="integer" id="S4.Ex3.m1.3.3.3.3.1.1.cmml" xref="S4.Ex3.m1.3.3.3.3.1.1">70</cn><ci id="S4.Ex3.m1.4.4.4.4.2.1a.cmml" xref="S4.Ex3.m1.4.4.4.4.2.1"><mtext id="S4.Ex3.m1.4.4.4.4.2.1.cmml" xref="S4.Ex3.m1.4.4.4.4.2.1">if visited in the past 14 days</mtext></ci><cn type="integer" id="S4.Ex3.m1.5.5.5.5.1.1.cmml" xref="S4.Ex3.m1.5.5.5.5.1.1">50</cn><ci id="S4.Ex3.m1.6.6.6.6.2.1a.cmml" xref="S4.Ex3.m1.6.6.6.6.2.1"><mtext id="S4.Ex3.m1.6.6.6.6.2.1.cmml" xref="S4.Ex3.m1.6.6.6.6.2.1">if visited in the past 31 days</mtext></ci><cn type="integer" id="S4.Ex3.m1.7.7.7.7.1.1.cmml" xref="S4.Ex3.m1.7.7.7.7.1.1">30</cn><ci id="S4.Ex3.m1.8.8.8.8.2.1a.cmml" xref="S4.Ex3.m1.8.8.8.8.2.1"><mtext id="S4.Ex3.m1.8.8.8.8.2.1.cmml" xref="S4.Ex3.m1.8.8.8.8.2.1">if visited in the past 90 days</mtext></ci><cn type="integer" id="S4.Ex3.m1.9.9.9.9.1.1.cmml" xref="S4.Ex3.m1.9.9.9.9.1.1">10</cn><ci id="S4.Ex3.m1.10.10.10.10.2.1a.cmml" xref="S4.Ex3.m1.10.10.10.10.2.1"><mtext id="S4.Ex3.m1.10.10.10.10.2.1.cmml" xref="S4.Ex3.m1.10.10.10.10.2.1">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex3.m1.12c">\operatorname{recency}(v)=\begin{cases}100&amp;\text{if visited in the past 4 days}\\
70&amp;\text{if visited in the past 14 days}\\
50&amp;\text{if visited in the past 31 days}\\
30&amp;\text{if visited in the past 90 days}\\
10&amp;\text{otherwise}\end{cases}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S4.p7" class="ltx_para">
<p id="S4.p7.1" class="ltx_p">Sites can be visited in many different ways.
If the user typed the entire link themselves or if it was a bookmarked link, we want to weight that differently to visiting a page by clicking a link.
Other visit types, like some types of redirects, should not be worth any score at all.
We implement this by scaling the recency score with a type weight:
</p>
<table id="S4.Ex4" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.Ex4.m1.10" class="ltx_Math" alttext="\operatorname{type}(v)=\begin{cases}1.2&amp;\text{if URL was visited by following a link on a website}\\
2&amp;\text{if URL was typed out}\\
1.4&amp;\text{if URL is bookmarked}\\
0&amp;\text{otherwise}\end{cases}" display="block"><semantics id="S4.Ex4.m1.10a"><mrow id="S4.Ex4.m1.10.11" xref="S4.Ex4.m1.10.11.cmml"><mrow id="S4.Ex4.m1.10.11.2.2" xref="S4.Ex4.m1.10.11.2.1.cmml"><mi id="S4.Ex4.m1.9.9" xref="S4.Ex4.m1.9.9.cmml">type</mi><mo id="S4.Ex4.m1.10.11.2.2a" xref="S4.Ex4.m1.10.11.2.1.cmml">⁡</mo><mrow id="S4.Ex4.m1.10.11.2.2.1" xref="S4.Ex4.m1.10.11.2.1.cmml"><mo stretchy="false" id="S4.Ex4.m1.10.11.2.2.1.1" xref="S4.Ex4.m1.10.11.2.1.cmml">(</mo><mi id="S4.Ex4.m1.10.10" xref="S4.Ex4.m1.10.10.cmml">v</mi><mo stretchy="false" id="S4.Ex4.m1.10.11.2.2.1.2" xref="S4.Ex4.m1.10.11.2.1.cmml">)</mo></mrow></mrow><mo id="S4.Ex4.m1.10.11.1" xref="S4.Ex4.m1.10.11.1.cmml">=</mo><mrow id="S4.Ex4.m1.8.8" xref="S4.Ex4.m1.10.11.3.1.cmml"><mo id="S4.Ex4.m1.8.8.9" xref="S4.Ex4.m1.10.11.3.1.1.cmml">{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt" id="S4.Ex4.m1.8.8.8" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtr id="S4.Ex4.m1.8.8.8a" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8b" xref="S4.Ex4.m1.10.11.3.1.cmml"><mn id="S4.Ex4.m1.1.1.1.1.1.1" xref="S4.Ex4.m1.1.1.1.1.1.1.cmml">1.2</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8c" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtext id="S4.Ex4.m1.2.2.2.2.2.1" xref="S4.Ex4.m1.2.2.2.2.2.1a.cmml">if URL was visited by following a link on a website</mtext></mtd></mtr><mtr id="S4.Ex4.m1.8.8.8d" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8e" xref="S4.Ex4.m1.10.11.3.1.cmml"><mn id="S4.Ex4.m1.3.3.3.3.1.1" xref="S4.Ex4.m1.3.3.3.3.1.1.cmml">2</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8f" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtext id="S4.Ex4.m1.4.4.4.4.2.1" xref="S4.Ex4.m1.4.4.4.4.2.1a.cmml">if URL was typed out</mtext></mtd></mtr><mtr id="S4.Ex4.m1.8.8.8g" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8h" xref="S4.Ex4.m1.10.11.3.1.cmml"><mn id="S4.Ex4.m1.5.5.5.5.1.1" xref="S4.Ex4.m1.5.5.5.5.1.1.cmml">1.4</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8i" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtext id="S4.Ex4.m1.6.6.6.6.2.1" xref="S4.Ex4.m1.6.6.6.6.2.1a.cmml">if URL is bookmarked</mtext></mtd></mtr><mtr id="S4.Ex4.m1.8.8.8j" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8k" xref="S4.Ex4.m1.10.11.3.1.cmml"><mn id="S4.Ex4.m1.7.7.7.7.1.1" xref="S4.Ex4.m1.7.7.7.7.1.1.cmml">0</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S4.Ex4.m1.8.8.8l" xref="S4.Ex4.m1.10.11.3.1.cmml"><mtext id="S4.Ex4.m1.8.8.8.8.2.1" xref="S4.Ex4.m1.8.8.8.8.2.1a.cmml">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex4.m1.10b"><apply id="S4.Ex4.m1.10.11.cmml" xref="S4.Ex4.m1.10.11"><eq id="S4.Ex4.m1.10.11.1.cmml" xref="S4.Ex4.m1.10.11.1"></eq><apply id="S4.Ex4.m1.10.11.2.1.cmml" xref="S4.Ex4.m1.10.11.2.2"><ci id="S4.Ex4.m1.9.9.cmml" xref="S4.Ex4.m1.9.9">type</ci><ci id="S4.Ex4.m1.10.10.cmml" xref="S4.Ex4.m1.10.10">𝑣</ci></apply><apply id="S4.Ex4.m1.10.11.3.1.cmml" xref="S4.Ex4.m1.8.8"><csymbol cd="latexml" id="S4.Ex4.m1.10.11.3.1.1.cmml" xref="S4.Ex4.m1.8.8.9">cases</csymbol><cn type="float" id="S4.Ex4.m1.1.1.1.1.1.1.cmml" xref="S4.Ex4.m1.1.1.1.1.1.1">1.2</cn><ci id="S4.Ex4.m1.2.2.2.2.2.1a.cmml" xref="S4.Ex4.m1.2.2.2.2.2.1"><mtext id="S4.Ex4.m1.2.2.2.2.2.1.cmml" xref="S4.Ex4.m1.2.2.2.2.2.1">if URL was visited by following a link on a website</mtext></ci><cn type="integer" id="S4.Ex4.m1.3.3.3.3.1.1.cmml" xref="S4.Ex4.m1.3.3.3.3.1.1">2</cn><ci id="S4.Ex4.m1.4.4.4.4.2.1a.cmml" xref="S4.Ex4.m1.4.4.4.4.2.1"><mtext id="S4.Ex4.m1.4.4.4.4.2.1.cmml" xref="S4.Ex4.m1.4.4.4.4.2.1">if URL was typed out</mtext></ci><cn type="float" id="S4.Ex4.m1.5.5.5.5.1.1.cmml" xref="S4.Ex4.m1.5.5.5.5.1.1">1.4</cn><ci id="S4.Ex4.m1.6.6.6.6.2.1a.cmml" xref="S4.Ex4.m1.6.6.6.6.2.1"><mtext id="S4.Ex4.m1.6.6.6.6.2.1.cmml" xref="S4.Ex4.m1.6.6.6.6.2.1">if URL is bookmarked</mtext></ci><cn type="integer" id="S4.Ex4.m1.7.7.7.7.1.1.cmml" xref="S4.Ex4.m1.7.7.7.7.1.1">0</cn><ci id="S4.Ex4.m1.8.8.8.8.2.1a.cmml" xref="S4.Ex4.m1.8.8.8.8.2.1"><mtext id="S4.Ex4.m1.8.8.8.8.2.1.cmml" xref="S4.Ex4.m1.8.8.8.8.2.1">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex4.m1.10c">\operatorname{type}(v)=\begin{cases}1.2&amp;\text{if URL was visited by following a link on a website}\\
2&amp;\text{if URL was typed out}\\
1.4&amp;\text{if URL is bookmarked}\\
0&amp;\text{otherwise}\end{cases}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S4.p8" class="ltx_para">
<p id="S4.p8.1" class="ltx_p">Now that we can assign a score to every visit, we could determine the full points of a page by summing up the scores of each visit to that page.
This approach has several disadvantages.
For one, it would scale badly because some pages are visited a lot.
Additionally, user preferences change over time and we might want to decrease the points in some situations.</p>
</div>
<div id="S4.p9" class="ltx_para">
<p id="S4.p9.3" class="ltx_p">Instead, we compute the average score of the last 10 visits.
This score is then scaled by the total number of visits.
The full frecency score can now be computed efficiently and changes in user behavior are reflected fairly quickly.
Let <math id="S4.p9.1.m1.1" class="ltx_Math" alttext="S_{x}" display="inline"><semantics id="S4.p9.1.m1.1a"><msub id="S4.p9.1.m1.1.1" xref="S4.p9.1.m1.1.1.cmml"><mi id="S4.p9.1.m1.1.1.2" xref="S4.p9.1.m1.1.1.2.cmml">S</mi><mi id="S4.p9.1.m1.1.1.3" xref="S4.p9.1.m1.1.1.3.cmml">x</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p9.1.m1.1b"><apply id="S4.p9.1.m1.1.1.cmml" xref="S4.p9.1.m1.1.1"><csymbol cd="ambiguous" id="S4.p9.1.m1.1.1.1.cmml" xref="S4.p9.1.m1.1.1">subscript</csymbol><ci id="S4.p9.1.m1.1.1.2.cmml" xref="S4.p9.1.m1.1.1.2">𝑆</ci><ci id="S4.p9.1.m1.1.1.3.cmml" xref="S4.p9.1.m1.1.1.3">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p9.1.m1.1c">S_{x}</annotation></semantics></math> be the set of all visits to page <math id="S4.p9.2.m2.1" class="ltx_Math" alttext="x" display="inline"><semantics id="S4.p9.2.m2.1a"><mi id="S4.p9.2.m2.1.1" xref="S4.p9.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.p9.2.m2.1b"><ci id="S4.p9.2.m2.1.1.cmml" xref="S4.p9.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p9.2.m2.1c">x</annotation></semantics></math>, and let <math id="S4.p9.3.m3.1" class="ltx_Math" alttext="T_{x}" display="inline"><semantics id="S4.p9.3.m3.1a"><msub id="S4.p9.3.m3.1.1" xref="S4.p9.3.m3.1.1.cmml"><mi id="S4.p9.3.m3.1.1.2" xref="S4.p9.3.m3.1.1.2.cmml">T</mi><mi id="S4.p9.3.m3.1.1.3" xref="S4.p9.3.m3.1.1.3.cmml">x</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p9.3.m3.1b"><apply id="S4.p9.3.m3.1.1.cmml" xref="S4.p9.3.m3.1.1"><csymbol cd="ambiguous" id="S4.p9.3.m3.1.1.1.cmml" xref="S4.p9.3.m3.1.1">subscript</csymbol><ci id="S4.p9.3.m3.1.1.2.cmml" xref="S4.p9.3.m3.1.1.2">𝑇</ci><ci id="S4.p9.3.m3.1.1.3.cmml" xref="S4.p9.3.m3.1.1.3">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p9.3.m3.1c">T_{x}</annotation></semantics></math> be the set of the last up to 10 of these.
The full frecency score is then given by:</p>
<table id="S4.Ex5" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.Ex5.m1.6" class="ltx_Math" alttext="\operatorname{frecency}(x)=\frac{|S_{x}|}{|T_{x}|}*\sum\limits_{v\in T_{x}}\operatorname{visit}(v)" display="block"><semantics id="S4.Ex5.m1.6a"><mrow id="S4.Ex5.m1.6.7" xref="S4.Ex5.m1.6.7.cmml"><mrow id="S4.Ex5.m1.6.7.2.2" xref="S4.Ex5.m1.6.7.2.1.cmml"><mi id="S4.Ex5.m1.3.3" xref="S4.Ex5.m1.3.3.cmml">frecency</mi><mo id="S4.Ex5.m1.6.7.2.2a" xref="S4.Ex5.m1.6.7.2.1.cmml">⁡</mo><mrow id="S4.Ex5.m1.6.7.2.2.1" xref="S4.Ex5.m1.6.7.2.1.cmml"><mo stretchy="false" id="S4.Ex5.m1.6.7.2.2.1.1" xref="S4.Ex5.m1.6.7.2.1.cmml">(</mo><mi id="S4.Ex5.m1.4.4" xref="S4.Ex5.m1.4.4.cmml">x</mi><mo stretchy="false" id="S4.Ex5.m1.6.7.2.2.1.2" xref="S4.Ex5.m1.6.7.2.1.cmml">)</mo></mrow></mrow><mo id="S4.Ex5.m1.6.7.1" xref="S4.Ex5.m1.6.7.1.cmml">=</mo><mrow id="S4.Ex5.m1.6.7.3" xref="S4.Ex5.m1.6.7.3.cmml"><mfrac id="S4.Ex5.m1.2.2" xref="S4.Ex5.m1.2.2.cmml"><mrow id="S4.Ex5.m1.1.1.1.1" xref="S4.Ex5.m1.1.1.1.2.cmml"><mo stretchy="false" id="S4.Ex5.m1.1.1.1.1.2" xref="S4.Ex5.m1.1.1.1.2.1.cmml">|</mo><msub id="S4.Ex5.m1.1.1.1.1.1" xref="S4.Ex5.m1.1.1.1.1.1.cmml"><mi id="S4.Ex5.m1.1.1.1.1.1.2" xref="S4.Ex5.m1.1.1.1.1.1.2.cmml">S</mi><mi id="S4.Ex5.m1.1.1.1.1.1.3" xref="S4.Ex5.m1.1.1.1.1.1.3.cmml">x</mi></msub><mo stretchy="false" id="S4.Ex5.m1.1.1.1.1.3" xref="S4.Ex5.m1.1.1.1.2.1.cmml">|</mo></mrow><mrow id="S4.Ex5.m1.2.2.2.1" xref="S4.Ex5.m1.2.2.2.2.cmml"><mo stretchy="false" id="S4.Ex5.m1.2.2.2.1.2" xref="S4.Ex5.m1.2.2.2.2.1.cmml">|</mo><msub id="S4.Ex5.m1.2.2.2.1.1" xref="S4.Ex5.m1.2.2.2.1.1.cmml"><mi id="S4.Ex5.m1.2.2.2.1.1.2" xref="S4.Ex5.m1.2.2.2.1.1.2.cmml">T</mi><mi id="S4.Ex5.m1.2.2.2.1.1.3" xref="S4.Ex5.m1.2.2.2.1.1.3.cmml">x</mi></msub><mo stretchy="false" id="S4.Ex5.m1.2.2.2.1.3" xref="S4.Ex5.m1.2.2.2.2.1.cmml">|</mo></mrow></mfrac><mo lspace="0.222em" rspace="0.055em" id="S4.Ex5.m1.6.7.3.1" xref="S4.Ex5.m1.6.7.3.1.cmml">∗</mo><mrow id="S4.Ex5.m1.6.7.3.2" xref="S4.Ex5.m1.6.7.3.2.cmml"><munder id="S4.Ex5.m1.6.7.3.2.1" xref="S4.Ex5.m1.6.7.3.2.1.cmml"><mo movablelimits="false" id="S4.Ex5.m1.6.7.3.2.1.2" xref="S4.Ex5.m1.6.7.3.2.1.2.cmml">∑</mo><mrow id="S4.Ex5.m1.6.7.3.2.1.3" xref="S4.Ex5.m1.6.7.3.2.1.3.cmml"><mi id="S4.Ex5.m1.6.7.3.2.1.3.2" xref="S4.Ex5.m1.6.7.3.2.1.3.2.cmml">v</mi><mo id="S4.Ex5.m1.6.7.3.2.1.3.1" xref="S4.Ex5.m1.6.7.3.2.1.3.1.cmml">∈</mo><msub id="S4.Ex5.m1.6.7.3.2.1.3.3" xref="S4.Ex5.m1.6.7.3.2.1.3.3.cmml"><mi id="S4.Ex5.m1.6.7.3.2.1.3.3.2" xref="S4.Ex5.m1.6.7.3.2.1.3.3.2.cmml">T</mi><mi id="S4.Ex5.m1.6.7.3.2.1.3.3.3" xref="S4.Ex5.m1.6.7.3.2.1.3.3.3.cmml">x</mi></msub></mrow></munder><mrow id="S4.Ex5.m1.6.7.3.2.2.2" xref="S4.Ex5.m1.6.7.3.2.2.1.cmml"><mi id="S4.Ex5.m1.5.5" xref="S4.Ex5.m1.5.5.cmml">visit</mi><mo id="S4.Ex5.m1.6.7.3.2.2.2a" xref="S4.Ex5.m1.6.7.3.2.2.1.cmml">⁡</mo><mrow id="S4.Ex5.m1.6.7.3.2.2.2.1" xref="S4.Ex5.m1.6.7.3.2.2.1.cmml"><mo stretchy="false" id="S4.Ex5.m1.6.7.3.2.2.2.1.1" xref="S4.Ex5.m1.6.7.3.2.2.1.cmml">(</mo><mi id="S4.Ex5.m1.6.6" xref="S4.Ex5.m1.6.6.cmml">v</mi><mo stretchy="false" id="S4.Ex5.m1.6.7.3.2.2.2.1.2" xref="S4.Ex5.m1.6.7.3.2.2.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex5.m1.6b"><apply id="S4.Ex5.m1.6.7.cmml" xref="S4.Ex5.m1.6.7"><eq id="S4.Ex5.m1.6.7.1.cmml" xref="S4.Ex5.m1.6.7.1"></eq><apply id="S4.Ex5.m1.6.7.2.1.cmml" xref="S4.Ex5.m1.6.7.2.2"><ci id="S4.Ex5.m1.3.3.cmml" xref="S4.Ex5.m1.3.3">frecency</ci><ci id="S4.Ex5.m1.4.4.cmml" xref="S4.Ex5.m1.4.4">𝑥</ci></apply><apply id="S4.Ex5.m1.6.7.3.cmml" xref="S4.Ex5.m1.6.7.3"><times id="S4.Ex5.m1.6.7.3.1.cmml" xref="S4.Ex5.m1.6.7.3.1"></times><apply id="S4.Ex5.m1.2.2.cmml" xref="S4.Ex5.m1.2.2"><divide id="S4.Ex5.m1.2.2.3.cmml" xref="S4.Ex5.m1.2.2"></divide><apply id="S4.Ex5.m1.1.1.1.2.cmml" xref="S4.Ex5.m1.1.1.1.1"><abs id="S4.Ex5.m1.1.1.1.2.1.cmml" xref="S4.Ex5.m1.1.1.1.1.2"></abs><apply id="S4.Ex5.m1.1.1.1.1.1.cmml" xref="S4.Ex5.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.Ex5.m1.1.1.1.1.1.1.cmml" xref="S4.Ex5.m1.1.1.1.1.1">subscript</csymbol><ci id="S4.Ex5.m1.1.1.1.1.1.2.cmml" xref="S4.Ex5.m1.1.1.1.1.1.2">𝑆</ci><ci id="S4.Ex5.m1.1.1.1.1.1.3.cmml" xref="S4.Ex5.m1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.Ex5.m1.2.2.2.2.cmml" xref="S4.Ex5.m1.2.2.2.1"><abs id="S4.Ex5.m1.2.2.2.2.1.cmml" xref="S4.Ex5.m1.2.2.2.1.2"></abs><apply id="S4.Ex5.m1.2.2.2.1.1.cmml" xref="S4.Ex5.m1.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.Ex5.m1.2.2.2.1.1.1.cmml" xref="S4.Ex5.m1.2.2.2.1.1">subscript</csymbol><ci id="S4.Ex5.m1.2.2.2.1.1.2.cmml" xref="S4.Ex5.m1.2.2.2.1.1.2">𝑇</ci><ci id="S4.Ex5.m1.2.2.2.1.1.3.cmml" xref="S4.Ex5.m1.2.2.2.1.1.3">𝑥</ci></apply></apply></apply><apply id="S4.Ex5.m1.6.7.3.2.cmml" xref="S4.Ex5.m1.6.7.3.2"><apply id="S4.Ex5.m1.6.7.3.2.1.cmml" xref="S4.Ex5.m1.6.7.3.2.1"><csymbol cd="ambiguous" id="S4.Ex5.m1.6.7.3.2.1.1.cmml" xref="S4.Ex5.m1.6.7.3.2.1">subscript</csymbol><sum id="S4.Ex5.m1.6.7.3.2.1.2.cmml" xref="S4.Ex5.m1.6.7.3.2.1.2"></sum><apply id="S4.Ex5.m1.6.7.3.2.1.3.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3"><in id="S4.Ex5.m1.6.7.3.2.1.3.1.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.1"></in><ci id="S4.Ex5.m1.6.7.3.2.1.3.2.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.2">𝑣</ci><apply id="S4.Ex5.m1.6.7.3.2.1.3.3.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.3"><csymbol cd="ambiguous" id="S4.Ex5.m1.6.7.3.2.1.3.3.1.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.3">subscript</csymbol><ci id="S4.Ex5.m1.6.7.3.2.1.3.3.2.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.3.2">𝑇</ci><ci id="S4.Ex5.m1.6.7.3.2.1.3.3.3.cmml" xref="S4.Ex5.m1.6.7.3.2.1.3.3.3">𝑥</ci></apply></apply></apply><apply id="S4.Ex5.m1.6.7.3.2.2.1.cmml" xref="S4.Ex5.m1.6.7.3.2.2.2"><ci id="S4.Ex5.m1.5.5.cmml" xref="S4.Ex5.m1.5.5">visit</ci><ci id="S4.Ex5.m1.6.6.cmml" xref="S4.Ex5.m1.6.6">𝑣</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex5.m1.6c">\operatorname{frecency}(x)=\frac{|S_{x}|}{|T_{x}|}*\sum\limits_{v\in T_{x}}\operatorname{visit}(v)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S4.p10" class="ltx_para">
<p id="S4.p10.1" class="ltx_p">For legacy reasons, Firefox additionally decays frecency scores over time.
Once a day, all scores are decreased by a few percentage.
This feature exists in Firefox for historic reasons and could also be modeled using time buckets.</p>
</div>
<div id="S4.p11" class="ltx_para">
<p id="S4.p11.1" class="ltx_p">Note that this is a simplified version of the algorithm.
There is some additional logic for special cases, such as typing out bookmarks or different kinds of redirects.
The description here only shows the essence of the algorithm in a mathematical form.</p>
</div>
<div id="S4.p12" class="ltx_para">
<p id="S4.p12.1" class="ltx_p">The weights of the current algorithm were handchosen in a way they were deemed reasonable.
Our Federated Learning system tries to optimize the weights based on user interactions, while keeping the general logic of frecency intact.
This optimization process includes all constants in the previous formulas.</p>
</div>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Optimization System Design</h2>

<section id="S5.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1. </span>Optimization By User Interactions</h3>

<div id="S5.SS1.p1" class="ltx_para">
<p id="S5.SS1.p1.1" class="ltx_p">User interactions with the Firefox URL bar provide a feedback signal that can be used to optimize the weights in the frecency algorithm.
By checking what items users clicked on, the weights can be adapted to make it more likely to show these items earlier the next time similar searches are performed.</p>
</div>
<div id="S5.SS1.p2" class="ltx_para">
<p id="S5.SS1.p2.1" class="ltx_p">The general optimization loop works as follows:
Users search in the URL bar and click on a suggestion.
This provides data to our system that can be used to compute model improvements, in the form of gradients.
These gradients are computed for many users at the same time and are sent to a Mozilla server.
A job on the server averages all gradients of the current iteration and applies a scaled version of the result to the model.
The new model is redistributed periodically when a new iteration begins.
</p>
</div>
<div id="S5.SS1.p3" class="ltx_para">
<p id="S5.SS1.p3.1" class="ltx_p">Part of the promise of our system is that this feedback signal from users is perfectly clean.
Users do not only generate data by searching in the URL bar, but they also label it for ranking by selecting an item.
Thus we know exactly how the ranking should have been.
Since machine learning is relying on good data to work with, this is an important point.</p>
</div>
</section>
<section id="S5.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2. </span>Pointwise SVM Ranking</h3>

<div id="S5.SS2.p1" class="ltx_para">
<p id="S5.SS2.p1.1" class="ltx_p">To describe the ranking goal formally, we need to have a loss function that evaluates how well our model did.
To this end, we take a previously proposed SVM loss for pairwise ranking <cite class="ltx_cite ltx_citemacro_citep">(Cao
et al<span class="ltx_text">.</span>, <a href="#bib.bib6" title="" class="ltx_ref">2006</a>; Zhang, <a href="#bib.bib29" title="" class="ltx_ref">2004</a>)</cite> and adapt it to our pointwise approach.</p>
</div>
<div id="S5.SS2.p2" class="ltx_para">
<p id="S5.SS2.p2.1" class="ltx_p">Essentially, the ranking loss function takes in a set of items with their assigned scores as well as the index of the item selected by the user.
The optimization goal is that the selected item should have the highest score.</p>
</div>
<div id="S5.SS2.p3" class="ltx_para">
<p id="S5.SS2.p3.1" class="ltx_p">But even if this was the case, our model might not have been too confident in that decision.
One example of this is the selected item having a score of 100 and the second item having a score of 99.9.
The model made the correct prediction, but only barely so.
To make sure it does a good job in similar cases, we need to provide a signal to the model which shows that it can still improve.
This is what we aim to do with the SVM loss.
</p>
</div>
<div id="S5.SS2.p4" class="ltx_para ltx_noindent">
<p id="S5.SS2.p4.2" class="ltx_p">If the URL bar displayed the suggestions for pages <math id="S5.SS2.p4.1.m1.3" class="ltx_Math" alttext="x_{1},\dots,x_{n}" display="inline"><semantics id="S5.SS2.p4.1.m1.3a"><mrow id="S5.SS2.p4.1.m1.3.3.2" xref="S5.SS2.p4.1.m1.3.3.3.cmml"><msub id="S5.SS2.p4.1.m1.2.2.1.1" xref="S5.SS2.p4.1.m1.2.2.1.1.cmml"><mi id="S5.SS2.p4.1.m1.2.2.1.1.2" xref="S5.SS2.p4.1.m1.2.2.1.1.2.cmml">x</mi><mn id="S5.SS2.p4.1.m1.2.2.1.1.3" xref="S5.SS2.p4.1.m1.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p4.1.m1.3.3.2.3" xref="S5.SS2.p4.1.m1.3.3.3.cmml">,</mo><mi mathvariant="normal" id="S5.SS2.p4.1.m1.1.1" xref="S5.SS2.p4.1.m1.1.1.cmml">…</mi><mo id="S5.SS2.p4.1.m1.3.3.2.4" xref="S5.SS2.p4.1.m1.3.3.3.cmml">,</mo><msub id="S5.SS2.p4.1.m1.3.3.2.2" xref="S5.SS2.p4.1.m1.3.3.2.2.cmml"><mi id="S5.SS2.p4.1.m1.3.3.2.2.2" xref="S5.SS2.p4.1.m1.3.3.2.2.2.cmml">x</mi><mi id="S5.SS2.p4.1.m1.3.3.2.2.3" xref="S5.SS2.p4.1.m1.3.3.2.2.3.cmml">n</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p4.1.m1.3b"><list id="S5.SS2.p4.1.m1.3.3.3.cmml" xref="S5.SS2.p4.1.m1.3.3.2"><apply id="S5.SS2.p4.1.m1.2.2.1.1.cmml" xref="S5.SS2.p4.1.m1.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p4.1.m1.2.2.1.1.1.cmml" xref="S5.SS2.p4.1.m1.2.2.1.1">subscript</csymbol><ci id="S5.SS2.p4.1.m1.2.2.1.1.2.cmml" xref="S5.SS2.p4.1.m1.2.2.1.1.2">𝑥</ci><cn type="integer" id="S5.SS2.p4.1.m1.2.2.1.1.3.cmml" xref="S5.SS2.p4.1.m1.2.2.1.1.3">1</cn></apply><ci id="S5.SS2.p4.1.m1.1.1.cmml" xref="S5.SS2.p4.1.m1.1.1">…</ci><apply id="S5.SS2.p4.1.m1.3.3.2.2.cmml" xref="S5.SS2.p4.1.m1.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS2.p4.1.m1.3.3.2.2.1.cmml" xref="S5.SS2.p4.1.m1.3.3.2.2">subscript</csymbol><ci id="S5.SS2.p4.1.m1.3.3.2.2.2.cmml" xref="S5.SS2.p4.1.m1.3.3.2.2.2">𝑥</ci><ci id="S5.SS2.p4.1.m1.3.3.2.2.3.cmml" xref="S5.SS2.p4.1.m1.3.3.2.2.3">𝑛</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p4.1.m1.3c">x_{1},\dots,x_{n}</annotation></semantics></math> in that order and suggestion <math id="S5.SS2.p4.2.m2.1" class="ltx_Math" alttext="x_{i}" display="inline"><semantics id="S5.SS2.p4.2.m2.1a"><msub id="S5.SS2.p4.2.m2.1.1" xref="S5.SS2.p4.2.m2.1.1.cmml"><mi id="S5.SS2.p4.2.m2.1.1.2" xref="S5.SS2.p4.2.m2.1.1.2.cmml">x</mi><mi id="S5.SS2.p4.2.m2.1.1.3" xref="S5.SS2.p4.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p4.2.m2.1b"><apply id="S5.SS2.p4.2.m2.1.1.cmml" xref="S5.SS2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p4.2.m2.1.1.1.cmml" xref="S5.SS2.p4.2.m2.1.1">subscript</csymbol><ci id="S5.SS2.p4.2.m2.1.1.2.cmml" xref="S5.SS2.p4.2.m2.1.1.2">𝑥</ci><ci id="S5.SS2.p4.2.m2.1.1.3.cmml" xref="S5.SS2.p4.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p4.2.m2.1c">x_{i}</annotation></semantics></math> was chosen, then the SVM loss for the pointwise ranking is given by</p>
<table id="S5.Ex6" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S5.Ex6.m1.3" class="ltx_Math" alttext="E=\sum\limits_{j\neq i}\max(0,f(x_{j})+\Delta-f(x_{i}))" display="block"><semantics id="S5.Ex6.m1.3a"><mrow id="S5.Ex6.m1.3.3" xref="S5.Ex6.m1.3.3.cmml"><mi id="S5.Ex6.m1.3.3.3" xref="S5.Ex6.m1.3.3.3.cmml">E</mi><mo rspace="0.111em" id="S5.Ex6.m1.3.3.2" xref="S5.Ex6.m1.3.3.2.cmml">=</mo><mrow id="S5.Ex6.m1.3.3.1" xref="S5.Ex6.m1.3.3.1.cmml"><munder id="S5.Ex6.m1.3.3.1.2" xref="S5.Ex6.m1.3.3.1.2.cmml"><mo movablelimits="false" id="S5.Ex6.m1.3.3.1.2.2" xref="S5.Ex6.m1.3.3.1.2.2.cmml">∑</mo><mrow id="S5.Ex6.m1.3.3.1.2.3" xref="S5.Ex6.m1.3.3.1.2.3.cmml"><mi id="S5.Ex6.m1.3.3.1.2.3.2" xref="S5.Ex6.m1.3.3.1.2.3.2.cmml">j</mi><mo id="S5.Ex6.m1.3.3.1.2.3.1" xref="S5.Ex6.m1.3.3.1.2.3.1.cmml">≠</mo><mi id="S5.Ex6.m1.3.3.1.2.3.3" xref="S5.Ex6.m1.3.3.1.2.3.3.cmml">i</mi></mrow></munder><mrow id="S5.Ex6.m1.3.3.1.1.1" xref="S5.Ex6.m1.3.3.1.1.2.cmml"><mi id="S5.Ex6.m1.1.1" xref="S5.Ex6.m1.1.1.cmml">max</mi><mo id="S5.Ex6.m1.3.3.1.1.1a" xref="S5.Ex6.m1.3.3.1.1.2.cmml">⁡</mo><mrow id="S5.Ex6.m1.3.3.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.2.cmml"><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.2.cmml">(</mo><mn id="S5.Ex6.m1.2.2" xref="S5.Ex6.m1.2.2.cmml">0</mn><mo id="S5.Ex6.m1.3.3.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.2.cmml">,</mo><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.cmml"><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.cmml"><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.3.cmml">f</mi><mo lspace="0em" rspace="0em" id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.2.cmml">​</mo><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S5.Ex6.m1.3.3.1.1.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.2.cmml">+</mo><mi mathvariant="normal" id="S5.Ex6.m1.3.3.1.1.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.3.cmml">Δ</mi></mrow><mo id="S5.Ex6.m1.3.3.1.1.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.3.cmml">−</mo><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.cmml"><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.2.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.3.cmml">f</mi><mo lspace="0em" rspace="0em" id="S5.Ex6.m1.3.3.1.1.1.1.1.2.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.2.cmml">​</mo><mrow id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.cmml"><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.cmml">(</mo><msub id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.cmml"><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.2" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.2.cmml">x</mi><mi id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.3.cmml">i</mi></msub><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.3" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo stretchy="false" id="S5.Ex6.m1.3.3.1.1.1.1.4" xref="S5.Ex6.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.Ex6.m1.3b"><apply id="S5.Ex6.m1.3.3.cmml" xref="S5.Ex6.m1.3.3"><eq id="S5.Ex6.m1.3.3.2.cmml" xref="S5.Ex6.m1.3.3.2"></eq><ci id="S5.Ex6.m1.3.3.3.cmml" xref="S5.Ex6.m1.3.3.3">𝐸</ci><apply id="S5.Ex6.m1.3.3.1.cmml" xref="S5.Ex6.m1.3.3.1"><apply id="S5.Ex6.m1.3.3.1.2.cmml" xref="S5.Ex6.m1.3.3.1.2"><csymbol cd="ambiguous" id="S5.Ex6.m1.3.3.1.2.1.cmml" xref="S5.Ex6.m1.3.3.1.2">subscript</csymbol><sum id="S5.Ex6.m1.3.3.1.2.2.cmml" xref="S5.Ex6.m1.3.3.1.2.2"></sum><apply id="S5.Ex6.m1.3.3.1.2.3.cmml" xref="S5.Ex6.m1.3.3.1.2.3"><neq id="S5.Ex6.m1.3.3.1.2.3.1.cmml" xref="S5.Ex6.m1.3.3.1.2.3.1"></neq><ci id="S5.Ex6.m1.3.3.1.2.3.2.cmml" xref="S5.Ex6.m1.3.3.1.2.3.2">𝑗</ci><ci id="S5.Ex6.m1.3.3.1.2.3.3.cmml" xref="S5.Ex6.m1.3.3.1.2.3.3">𝑖</ci></apply></apply><apply id="S5.Ex6.m1.3.3.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1"><max id="S5.Ex6.m1.1.1.cmml" xref="S5.Ex6.m1.1.1"></max><cn type="integer" id="S5.Ex6.m1.2.2.cmml" xref="S5.Ex6.m1.2.2">0</cn><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1"><minus id="S5.Ex6.m1.3.3.1.1.1.1.1.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.3"></minus><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1"><plus id="S5.Ex6.m1.3.3.1.1.1.1.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.2"></plus><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1"><times id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.2"></times><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.3">𝑓</ci><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply></apply><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.1.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.1.3">Δ</ci></apply><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2"><times id="S5.Ex6.m1.3.3.1.1.1.1.1.2.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.2"></times><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.2.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.3">𝑓</ci><apply id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1"><csymbol cd="ambiguous" id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.1.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1">subscript</csymbol><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.2.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.2">𝑥</ci><ci id="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.3.cmml" xref="S5.Ex6.m1.3.3.1.1.1.1.1.2.1.1.1.3">𝑖</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.Ex6.m1.3c">E=\sum\limits_{j\neq i}\max(0,f(x_{j})+\Delta-f(x_{i}))</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S5.SS2.p4.4" class="ltx_p">where <math id="S5.SS2.p4.3.m1.1" class="ltx_Math" alttext="f(x_{i})" display="inline"><semantics id="S5.SS2.p4.3.m1.1a"><mrow id="S5.SS2.p4.3.m1.1.1" xref="S5.SS2.p4.3.m1.1.1.cmml"><mi id="S5.SS2.p4.3.m1.1.1.3" xref="S5.SS2.p4.3.m1.1.1.3.cmml">f</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p4.3.m1.1.1.2" xref="S5.SS2.p4.3.m1.1.1.2.cmml">​</mo><mrow id="S5.SS2.p4.3.m1.1.1.1.1" xref="S5.SS2.p4.3.m1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.SS2.p4.3.m1.1.1.1.1.2" xref="S5.SS2.p4.3.m1.1.1.1.1.1.cmml">(</mo><msub id="S5.SS2.p4.3.m1.1.1.1.1.1" xref="S5.SS2.p4.3.m1.1.1.1.1.1.cmml"><mi id="S5.SS2.p4.3.m1.1.1.1.1.1.2" xref="S5.SS2.p4.3.m1.1.1.1.1.1.2.cmml">x</mi><mi id="S5.SS2.p4.3.m1.1.1.1.1.1.3" xref="S5.SS2.p4.3.m1.1.1.1.1.1.3.cmml">i</mi></msub><mo stretchy="false" id="S5.SS2.p4.3.m1.1.1.1.1.3" xref="S5.SS2.p4.3.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p4.3.m1.1b"><apply id="S5.SS2.p4.3.m1.1.1.cmml" xref="S5.SS2.p4.3.m1.1.1"><times id="S5.SS2.p4.3.m1.1.1.2.cmml" xref="S5.SS2.p4.3.m1.1.1.2"></times><ci id="S5.SS2.p4.3.m1.1.1.3.cmml" xref="S5.SS2.p4.3.m1.1.1.3">𝑓</ci><apply id="S5.SS2.p4.3.m1.1.1.1.1.1.cmml" xref="S5.SS2.p4.3.m1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p4.3.m1.1.1.1.1.1.1.cmml" xref="S5.SS2.p4.3.m1.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p4.3.m1.1.1.1.1.1.2.cmml" xref="S5.SS2.p4.3.m1.1.1.1.1.1.2">𝑥</ci><ci id="S5.SS2.p4.3.m1.1.1.1.1.1.3.cmml" xref="S5.SS2.p4.3.m1.1.1.1.1.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p4.3.m1.1c">f(x_{i})</annotation></semantics></math> denotes the pointwise ranking score of item <math id="S5.SS2.p4.4.m2.1" class="ltx_Math" alttext="x_{i}" display="inline"><semantics id="S5.SS2.p4.4.m2.1a"><msub id="S5.SS2.p4.4.m2.1.1" xref="S5.SS2.p4.4.m2.1.1.cmml"><mi id="S5.SS2.p4.4.m2.1.1.2" xref="S5.SS2.p4.4.m2.1.1.2.cmml">x</mi><mi id="S5.SS2.p4.4.m2.1.1.3" xref="S5.SS2.p4.4.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p4.4.m2.1b"><apply id="S5.SS2.p4.4.m2.1.1.cmml" xref="S5.SS2.p4.4.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p4.4.m2.1.1.1.cmml" xref="S5.SS2.p4.4.m2.1.1">subscript</csymbol><ci id="S5.SS2.p4.4.m2.1.1.2.cmml" xref="S5.SS2.p4.4.m2.1.1.2">𝑥</ci><ci id="S5.SS2.p4.4.m2.1.1.3.cmml" xref="S5.SS2.p4.4.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p4.4.m2.1c">x_{i}</annotation></semantics></math>, which corresponds to frecency in our case.</p>
</div>
<div id="S5.SS2.p5" class="ltx_para">
<p id="S5.SS2.p5.2" class="ltx_p">We iterate over all suggestions that were not chosen and check that their scores were smaller than the one of the selected page by at least a margin of <math id="S5.SS2.p5.1.m1.1" class="ltx_Math" alttext="\Delta" display="inline"><semantics id="S5.SS2.p5.1.m1.1a"><mi mathvariant="normal" id="S5.SS2.p5.1.m1.1.1" xref="S5.SS2.p5.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p5.1.m1.1b"><ci id="S5.SS2.p5.1.m1.1.1.cmml" xref="S5.SS2.p5.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p5.1.m1.1c">\Delta</annotation></semantics></math>.
If not, an error is added.
The full loss should be minimized.
The margin <math id="S5.SS2.p5.2.m2.1" class="ltx_Math" alttext="\Delta" display="inline"><semantics id="S5.SS2.p5.2.m2.1a"><mi mathvariant="normal" id="S5.SS2.p5.2.m2.1.1" xref="S5.SS2.p5.2.m2.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p5.2.m2.1b"><ci id="S5.SS2.p5.2.m2.1.1.cmml" xref="S5.SS2.p5.2.m2.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p5.2.m2.1c">\Delta</annotation></semantics></math> is a hyperparameter that needs to be decided on before the optimization process starts.</p>
</div>
<figure id="S5.F3" class="ltx_figure">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S5.F3.1" class="ltx_figure ltx_figure_panel"><svg id="S5.F3.1.pic1" class="ltx_picture" height="20.24" overflow="visible" version="1.1" width="170.96"><g transform="translate(0,20.24) matrix(1 0 0 -1 0 0) translate(157.48,0) translate(0,0.28)" fill="#000000" stroke="#000000" stroke-width="0.4pt"><g stroke="#000000" fill="#000000" color="#000000"><path d="M -157.48 0 M -157.48 0 L -157.48 19.69 L -137.8 19.69 L -137.8 0 Z M -137.8 19.69" style="stroke:none"></path></g><g transform="matrix(1.0 0.0 0.0 1.0 -137.67 5.04)" fill="#000000" stroke="#000000"><foreignObject width="78.49" height="9.61" transform="matrix(1 0 0 -1 0 16.6)" overflow="visible"><span id="S5.F3.1.pic1.1.1.1.1.1" class="ltx_text">selected item</span></foreignObject></g><path d="M 0 4.15 L 4.29 -0.14" style="fill:none"></path><defs><pattern id="pgfupat1" href="#pgfpat4"><g fill="#000000" stroke="#000000"><use href="#pgfsym4"></use></g></pattern></defs><g fill="url(#pgfupat1)"><path d="M -39.37 0 M -39.37 0 L -39.37 19.69 L -19.69 19.69 L -19.69 0 Z M -19.69 19.69"></path></g><g transform="matrix(1.0 0.0 0.0 1.0 -12.81 5.04)" fill="#000000" stroke="#000000"><foreignObject width="21.68" height="9.61" transform="matrix(1 0 0 -1 0 16.6)" overflow="visible"><span id="S5.F3.1.pic1.2.2.2.1.1" class="ltx_text">loss</span></foreignObject></g></g></svg>
<br class="ltx_break ltx_centering">
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure id="S5.F3.2" class="ltx_figure ltx_figure_panel"><svg id="S5.F3.2.pic1" class="ltx_picture" height="246.73" overflow="visible" version="1.1" width="326.74"><g transform="translate(0,246.73) matrix(1 0 0 -1 0 0) translate(158.19,0) translate(0,133.98)" fill="#000000" stroke="#000000"><g stroke-width="1.6pt"><path d="M -147.64 -124.02 L 145.96 -124.02" style="fill:none"></path><g transform="matrix(1.0 0.0 0.0 1.0 145.96 -124.02)" stroke-dasharray="none" stroke-dashoffset="0.0pt" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.28pt"><path d="M -3.15 4.21 C -2.89 2.63 0 0.26 0.79 0 C 0 -0.26 -2.89 -2.63 -3.15 -4.21" style="fill:none"></path></g><g transform="matrix(1.0 0.0 0.0 1.0 153.36 -125.72)" fill="#000000" stroke="#000000"><foreignObject width="10.58" height="8.51" transform="matrix(1 0 0 -1 0 16.6)" overflow="visible"><math id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1" class="ltx_Math" alttext="x_{i}" display="inline"><semantics id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1a"><msub id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml"><mi id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml">x</mi><mi id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1b"><apply id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.cmml" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2">𝑥</ci><ci id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml" xref="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F3.2.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1c">x_{i}</annotation></semantics></math></foreignObject></g></g><g stroke-width="1.6pt"><path d="M -138.78 -132.87 L -138.78 86.91" style="fill:none"></path><g transform="matrix(0.0 1.0 -1.0 0.0 -138.78 86.91)" stroke-dasharray="none" stroke-dashoffset="0.0pt" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.28pt"><path d="M -3.15 4.21 C -2.89 2.63 0 0.26 0.79 0 C 0 -0.26 -2.89 -2.63 -3.15 -4.21" style="fill:none"></path></g><g transform="matrix(1.0 0.0 0.0 1.0 -153.58 97.76)" fill="#000000" stroke="#000000"><foreignObject width="29.6" height="13.84" transform="matrix(1 0 0 -1 0 16.6)" overflow="visible"><math id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1" class="ltx_Math" alttext="f(x_{i})" display="inline"><semantics id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1a"><mrow id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml"><mi id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml">f</mi><mo lspace="0em" rspace="0em" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml">​</mo><mrow id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.2" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.cmml">(</mo><msub id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.cmml"><mi id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.2" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.2.cmml">x</mi><mi id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.3" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.3.cmml">i</mi></msub><mo stretchy="false" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.3" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1b"><apply id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1"><times id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.2"></times><ci id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.3">𝑓</ci><apply id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.1.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1">subscript</csymbol><ci id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.2.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.2">𝑥</ci><ci id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.3.cmml" xref="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.1.1.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F3.2.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.1.1.1.1.1.1.1.1.1.1.1.m1.1c">f(x_{i})</annotation></semantics></math></foreignObject></g></g><g stroke-width="0.4pt"><g stroke="#000000" fill="#000000" color="#000000"><path d="M -138.78 -124.02 M -138.78 -124.02 L -138.78 29.53 L -109.25 29.53 L -109.25 -124.02 Z M -109.25 29.53" style="fill:none"></path></g><defs><pattern id="pgfupat2" href="#pgfpat4"><g fill="#000000" stroke="#000000"><use href="#pgfsym4"></use></g></pattern></defs><g fill="url(#pgfupat2)"><path d="M -138.78 0 M -138.78 0 L -138.78 29.53 L -109.25 29.53 L -109.25 0 Z M -109.25 29.53"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M -109.25 -124.02 M -109.25 -124.02 L -109.25 -8.86 L -79.72 -8.86 L -79.72 -124.02 Z M -79.72 -8.86" style="fill:none"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M -79.72 -124.02 M -79.72 -124.02 L -79.72 -20.67 L -50.2 -20.67 L -50.2 -124.02 Z M -50.2 -20.67" style="fill:none"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M -50.2 -124.02 M -50.2 -124.02 L -50.2 -11.81 L -20.67 -11.81 L -20.67 -124.02 Z M -20.67 -11.81" style="fill:none"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M -20.67 -124.02 M -20.67 -124.02 L -20.67 59.06 L 8.86 59.06 L 8.86 -124.02 Z M 8.86 59.06" style="stroke:none"></path></g><defs><pattern id="pgfupat3" href="#pgfpat4"><g fill="#000000" stroke="#000000"><use href="#pgfsym4"></use></g></pattern></defs><g fill="url(#pgfupat3)"><path d="M 8.86 0 M 8.86 0 L 8.86 29.53 L 38.39 29.53 L 38.39 0 Z M 38.39 29.53"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M 8.86 -124.02 M 8.86 -124.02 L 8.86 29.53 L 38.39 29.53 L 38.39 -124.02 Z M 38.39 29.53" style="fill:none"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M 38.39 -124.02 M 38.39 -124.02 L 38.39 -14.76 L 67.91 -14.76 L 67.91 -124.02 Z M 67.91 -14.76" style="fill:none"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M 67.91 -124.02 M 67.91 -124.02 L 67.91 73.82 L 97.44 73.82 L 97.44 -124.02 Z M 97.44 73.82" style="fill:none"></path></g><defs><pattern id="pgfupat4" href="#pgfpat4"><g fill="#000000" stroke="#000000"><use href="#pgfsym4"></use></g></pattern></defs><g fill="url(#pgfupat4)"><path d="M 67.91 0 M 67.91 0 L 67.91 73.82 L 97.44 73.82 L 97.44 0 Z M 97.44 73.82"></path></g><g stroke="#000000" fill="#000000" color="#000000"><path d="M 97.44 -124.02 M 97.44 -124.02 L 97.44 29.53 L 126.97 29.53 L 126.97 -124.02 Z M 126.97 29.53" style="fill:none"></path></g><defs><pattern id="pgfupat5" href="#pgfpat4"><g fill="#000000" stroke="#000000"><use href="#pgfsym4"></use></g></pattern></defs><g fill="url(#pgfupat5)"><path d="M 97.44 0 M 97.44 0 L 97.44 29.53 L 126.97 29.53 L 126.97 0 Z M 126.97 29.53"></path></g><path d="M -24.82 0.59 M -24.82 0.59 C -26.07 1.21 -26.9 2.67 -26.9 4.74 L -26.9 25.38 C -26.9 27.45 -27.73 28.9 -28.97 29.53 C -27.73 30.15 -26.9 31.6 -26.9 33.68 L -26.9 54.31 C -26.9 56.39 -26.07 57.84 -24.82 58.46" style="fill:none"></path><g transform="matrix(1.0 0.0 0.0 1.0 -42.4 24.8)" fill="#000000" stroke="#000000" color="#000000"><foreignObject width="11.53" height="9.46" transform="matrix(1 0 0 -1 0 16.6)" overflow="visible"><math id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1" class="ltx_Math" alttext="\Delta" display="inline"><semantics id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1a"><mi mathvariant="normal" id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1.1" xref="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1b"><ci id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F3.2.pic1.3.3.3.3.3.3.3.3.3.3.3.3.3.1.1.1.1.1.1.1.1.1.1.1.m1.1c">\Delta</annotation></semantics></math></foreignObject></g></g></g></svg>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span id="S5.F3.4.1.1" class="ltx_text" style="font-size:90%;">Figure 3</span>. </span><span id="S5.F3.5.2" class="ltx_text" style="font-size:90%;">A visualization of the SVM loss for pointwise ranking</span></figcaption>
</figure>
<div id="S5.SS2.p6" class="ltx_para">
<p id="S5.SS2.p6.1" class="ltx_p">A visualization of this loss function is given in Figure <a href="#S5.F3" title="Figure 3 ‣ 5.2. Pointwise SVM Ranking ‣ 5. Optimization System Design ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>.
Each bar represents a possible suggestion, with the selected one being shown in black.
The y-axis displays how many points the model assigned to the respective suggestion.
The hatched areas show the SVM loss.
Everything above the selected suggestion as well as everything below it by a margin of <math id="S5.SS2.p6.1.m1.1" class="ltx_Math" alttext="\Delta" display="inline"><semantics id="S5.SS2.p6.1.m1.1a"><mi mathvariant="normal" id="S5.SS2.p6.1.m1.1.1" xref="S5.SS2.p6.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.1.m1.1b"><ci id="S5.SS2.p6.1.m1.1.1.cmml" xref="S5.SS2.p6.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.1.m1.1c">\Delta</annotation></semantics></math> adds to the full loss.
Even though the selected suggestion had the second highest score, four suggestions contribute to the penalty in our example.</p>
</div>
</section>
<section id="S5.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3. </span>Rprop</h3>

<div id="S5.SS3.p1" class="ltx_para">
<p id="S5.SS3.p1.1" class="ltx_p">Gradient descent is a natural choice for optimization in machine learning.
But since we never collected any data, we have no idea what gradient magnitudes for our problem are like.
Tuning the learning rate for vanilla gradient descent on the server prior to Federated Learning thus does not work.</p>
</div>
<div id="S5.SS3.p2" class="ltx_para">
<p id="S5.SS3.p2.1" class="ltx_p">Adam <cite class="ltx_cite ltx_citemacro_citep">(Kingma and Ba, <a href="#bib.bib14" title="" class="ltx_ref">2014</a>)</cite> and other optimization algorithms automatically adapt learning rates and are better suited for our problem setting.
We experimented with several such algorithms but finally settled for Rprop <cite class="ltx_cite ltx_citemacro_citep">(Riedmiller and
Braun, <a href="#bib.bib25" title="" class="ltx_ref">1993</a>)</cite>.
Rprop ignores gradient magnitudes and dynamically adapts learning rates for each weight individually.
The optimization algorithm bounds the magnitude of updates by design and thus limits by how much individual iterations affect the model.</p>
</div>
<div id="S5.SS3.p3" class="ltx_para">
<p id="S5.SS3.p3.5" class="ltx_p">Let <math id="S5.SS3.p3.1.m1.1" class="ltx_Math" alttext="\eta_{i}^{(t)}" display="inline"><semantics id="S5.SS3.p3.1.m1.1a"><msubsup id="S5.SS3.p3.1.m1.1.2" xref="S5.SS3.p3.1.m1.1.2.cmml"><mi id="S5.SS3.p3.1.m1.1.2.2.2" xref="S5.SS3.p3.1.m1.1.2.2.2.cmml">η</mi><mi id="S5.SS3.p3.1.m1.1.2.2.3" xref="S5.SS3.p3.1.m1.1.2.2.3.cmml">i</mi><mrow id="S5.SS3.p3.1.m1.1.1.1.3" xref="S5.SS3.p3.1.m1.1.2.cmml"><mo stretchy="false" id="S5.SS3.p3.1.m1.1.1.1.3.1" xref="S5.SS3.p3.1.m1.1.2.cmml">(</mo><mi id="S5.SS3.p3.1.m1.1.1.1.1" xref="S5.SS3.p3.1.m1.1.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.SS3.p3.1.m1.1.1.1.3.2" xref="S5.SS3.p3.1.m1.1.2.cmml">)</mo></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.1.m1.1b"><apply id="S5.SS3.p3.1.m1.1.2.cmml" xref="S5.SS3.p3.1.m1.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.1.m1.1.2.1.cmml" xref="S5.SS3.p3.1.m1.1.2">superscript</csymbol><apply id="S5.SS3.p3.1.m1.1.2.2.cmml" xref="S5.SS3.p3.1.m1.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.1.m1.1.2.2.1.cmml" xref="S5.SS3.p3.1.m1.1.2">subscript</csymbol><ci id="S5.SS3.p3.1.m1.1.2.2.2.cmml" xref="S5.SS3.p3.1.m1.1.2.2.2">𝜂</ci><ci id="S5.SS3.p3.1.m1.1.2.2.3.cmml" xref="S5.SS3.p3.1.m1.1.2.2.3">𝑖</ci></apply><ci id="S5.SS3.p3.1.m1.1.1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.1.m1.1c">\eta_{i}^{(t)}</annotation></semantics></math> be the step size for the <math id="S5.SS3.p3.2.m2.1" class="ltx_Math" alttext="i" display="inline"><semantics id="S5.SS3.p3.2.m2.1a"><mi id="S5.SS3.p3.2.m2.1.1" xref="S5.SS3.p3.2.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.2.m2.1b"><ci id="S5.SS3.p3.2.m2.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.2.m2.1c">i</annotation></semantics></math>-th weight in the <math id="S5.SS3.p3.3.m3.1" class="ltx_Math" alttext="t" display="inline"><semantics id="S5.SS3.p3.3.m3.1a"><mi id="S5.SS3.p3.3.m3.1.1" xref="S5.SS3.p3.3.m3.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.3.m3.1b"><ci id="S5.SS3.p3.3.m3.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.3.m3.1c">t</annotation></semantics></math>-th iteration of gradient descent.
The value for the first and second iteration, <math id="S5.SS3.p3.4.m4.1" class="ltx_Math" alttext="\eta_{i}^{(0)}" display="inline"><semantics id="S5.SS3.p3.4.m4.1a"><msubsup id="S5.SS3.p3.4.m4.1.2" xref="S5.SS3.p3.4.m4.1.2.cmml"><mi id="S5.SS3.p3.4.m4.1.2.2.2" xref="S5.SS3.p3.4.m4.1.2.2.2.cmml">η</mi><mi id="S5.SS3.p3.4.m4.1.2.2.3" xref="S5.SS3.p3.4.m4.1.2.2.3.cmml">i</mi><mrow id="S5.SS3.p3.4.m4.1.1.1.3" xref="S5.SS3.p3.4.m4.1.2.cmml"><mo stretchy="false" id="S5.SS3.p3.4.m4.1.1.1.3.1" xref="S5.SS3.p3.4.m4.1.2.cmml">(</mo><mn id="S5.SS3.p3.4.m4.1.1.1.1" xref="S5.SS3.p3.4.m4.1.1.1.1.cmml">0</mn><mo stretchy="false" id="S5.SS3.p3.4.m4.1.1.1.3.2" xref="S5.SS3.p3.4.m4.1.2.cmml">)</mo></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.4.m4.1b"><apply id="S5.SS3.p3.4.m4.1.2.cmml" xref="S5.SS3.p3.4.m4.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.1.2.1.cmml" xref="S5.SS3.p3.4.m4.1.2">superscript</csymbol><apply id="S5.SS3.p3.4.m4.1.2.2.cmml" xref="S5.SS3.p3.4.m4.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.1.2.2.1.cmml" xref="S5.SS3.p3.4.m4.1.2">subscript</csymbol><ci id="S5.SS3.p3.4.m4.1.2.2.2.cmml" xref="S5.SS3.p3.4.m4.1.2.2.2">𝜂</ci><ci id="S5.SS3.p3.4.m4.1.2.2.3.cmml" xref="S5.SS3.p3.4.m4.1.2.2.3">𝑖</ci></apply><cn type="integer" id="S5.SS3.p3.4.m4.1.1.1.1.cmml" xref="S5.SS3.p3.4.m4.1.1.1.1">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.4.m4.1c">\eta_{i}^{(0)}</annotation></semantics></math> and <math id="S5.SS3.p3.5.m5.1" class="ltx_Math" alttext="\eta_{i}^{(1)}" display="inline"><semantics id="S5.SS3.p3.5.m5.1a"><msubsup id="S5.SS3.p3.5.m5.1.2" xref="S5.SS3.p3.5.m5.1.2.cmml"><mi id="S5.SS3.p3.5.m5.1.2.2.2" xref="S5.SS3.p3.5.m5.1.2.2.2.cmml">η</mi><mi id="S5.SS3.p3.5.m5.1.2.2.3" xref="S5.SS3.p3.5.m5.1.2.2.3.cmml">i</mi><mrow id="S5.SS3.p3.5.m5.1.1.1.3" xref="S5.SS3.p3.5.m5.1.2.cmml"><mo stretchy="false" id="S5.SS3.p3.5.m5.1.1.1.3.1" xref="S5.SS3.p3.5.m5.1.2.cmml">(</mo><mn id="S5.SS3.p3.5.m5.1.1.1.1" xref="S5.SS3.p3.5.m5.1.1.1.1.cmml">1</mn><mo stretchy="false" id="S5.SS3.p3.5.m5.1.1.1.3.2" xref="S5.SS3.p3.5.m5.1.2.cmml">)</mo></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.5.m5.1b"><apply id="S5.SS3.p3.5.m5.1.2.cmml" xref="S5.SS3.p3.5.m5.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.5.m5.1.2.1.cmml" xref="S5.SS3.p3.5.m5.1.2">superscript</csymbol><apply id="S5.SS3.p3.5.m5.1.2.2.cmml" xref="S5.SS3.p3.5.m5.1.2"><csymbol cd="ambiguous" id="S5.SS3.p3.5.m5.1.2.2.1.cmml" xref="S5.SS3.p3.5.m5.1.2">subscript</csymbol><ci id="S5.SS3.p3.5.m5.1.2.2.2.cmml" xref="S5.SS3.p3.5.m5.1.2.2.2">𝜂</ci><ci id="S5.SS3.p3.5.m5.1.2.2.3.cmml" xref="S5.SS3.p3.5.m5.1.2.2.3">𝑖</ci></apply><cn type="integer" id="S5.SS3.p3.5.m5.1.1.1.1.cmml" xref="S5.SS3.p3.5.m5.1.1.1.1">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.5.m5.1c">\eta_{i}^{(1)}</annotation></semantics></math>, is a hyperparameter that needs to be chosen in advance.
This step size is then dynamically adapted for each weight, depending on the gradient.</p>
</div>
<div id="S5.SS3.p4" class="ltx_para ltx_noindent">
<p id="S5.SS3.p4.1" class="ltx_p">The weights themselves are updated using</p>
<table id="S5.E1" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S5.E1.m1.6" class="ltx_Math" alttext="\theta_{i}^{(t)}=\theta_{i}^{(t-1)}-\eta_{i}^{(t-1)}*\operatorname{sgn}\left(\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}\right)" display="block"><semantics id="S5.E1.m1.6a"><mrow id="S5.E1.m1.6.7" xref="S5.E1.m1.6.7.cmml"><msubsup id="S5.E1.m1.6.7.2" xref="S5.E1.m1.6.7.2.cmml"><mi id="S5.E1.m1.6.7.2.2.2" xref="S5.E1.m1.6.7.2.2.2.cmml">θ</mi><mi id="S5.E1.m1.6.7.2.2.3" xref="S5.E1.m1.6.7.2.2.3.cmml">i</mi><mrow id="S5.E1.m1.1.1.1.3" xref="S5.E1.m1.6.7.2.cmml"><mo stretchy="false" id="S5.E1.m1.1.1.1.3.1" xref="S5.E1.m1.6.7.2.cmml">(</mo><mi id="S5.E1.m1.1.1.1.1" xref="S5.E1.m1.1.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.E1.m1.1.1.1.3.2" xref="S5.E1.m1.6.7.2.cmml">)</mo></mrow></msubsup><mo id="S5.E1.m1.6.7.1" xref="S5.E1.m1.6.7.1.cmml">=</mo><mrow id="S5.E1.m1.6.7.3" xref="S5.E1.m1.6.7.3.cmml"><msubsup id="S5.E1.m1.6.7.3.2" xref="S5.E1.m1.6.7.3.2.cmml"><mi id="S5.E1.m1.6.7.3.2.2.2" xref="S5.E1.m1.6.7.3.2.2.2.cmml">θ</mi><mi id="S5.E1.m1.6.7.3.2.2.3" xref="S5.E1.m1.6.7.3.2.2.3.cmml">i</mi><mrow id="S5.E1.m1.2.2.1.1" xref="S5.E1.m1.2.2.1.1.1.cmml"><mo stretchy="false" id="S5.E1.m1.2.2.1.1.2" xref="S5.E1.m1.2.2.1.1.1.cmml">(</mo><mrow id="S5.E1.m1.2.2.1.1.1" xref="S5.E1.m1.2.2.1.1.1.cmml"><mi id="S5.E1.m1.2.2.1.1.1.2" xref="S5.E1.m1.2.2.1.1.1.2.cmml">t</mi><mo id="S5.E1.m1.2.2.1.1.1.1" xref="S5.E1.m1.2.2.1.1.1.1.cmml">−</mo><mn id="S5.E1.m1.2.2.1.1.1.3" xref="S5.E1.m1.2.2.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E1.m1.2.2.1.1.3" xref="S5.E1.m1.2.2.1.1.1.cmml">)</mo></mrow></msubsup><mo id="S5.E1.m1.6.7.3.1" xref="S5.E1.m1.6.7.3.1.cmml">−</mo><mrow id="S5.E1.m1.6.7.3.3" xref="S5.E1.m1.6.7.3.3.cmml"><msubsup id="S5.E1.m1.6.7.3.3.2" xref="S5.E1.m1.6.7.3.3.2.cmml"><mi id="S5.E1.m1.6.7.3.3.2.2.2" xref="S5.E1.m1.6.7.3.3.2.2.2.cmml">η</mi><mi id="S5.E1.m1.6.7.3.3.2.2.3" xref="S5.E1.m1.6.7.3.3.2.2.3.cmml">i</mi><mrow id="S5.E1.m1.3.3.1.1" xref="S5.E1.m1.3.3.1.1.1.cmml"><mo stretchy="false" id="S5.E1.m1.3.3.1.1.2" xref="S5.E1.m1.3.3.1.1.1.cmml">(</mo><mrow id="S5.E1.m1.3.3.1.1.1" xref="S5.E1.m1.3.3.1.1.1.cmml"><mi id="S5.E1.m1.3.3.1.1.1.2" xref="S5.E1.m1.3.3.1.1.1.2.cmml">t</mi><mo id="S5.E1.m1.3.3.1.1.1.1" xref="S5.E1.m1.3.3.1.1.1.1.cmml">−</mo><mn id="S5.E1.m1.3.3.1.1.1.3" xref="S5.E1.m1.3.3.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E1.m1.3.3.1.1.3" xref="S5.E1.m1.3.3.1.1.1.cmml">)</mo></mrow></msubsup><mo lspace="0.222em" rspace="0.222em" id="S5.E1.m1.6.7.3.3.1" xref="S5.E1.m1.6.7.3.3.1.cmml">∗</mo><mrow id="S5.E1.m1.6.7.3.3.3.2" xref="S5.E1.m1.6.7.3.3.3.1.cmml"><mi id="S5.E1.m1.6.6" xref="S5.E1.m1.6.6.cmml">sgn</mi><mo id="S5.E1.m1.6.7.3.3.3.2a" xref="S5.E1.m1.6.7.3.3.3.1.cmml">⁡</mo><mrow id="S5.E1.m1.6.7.3.3.3.2.1" xref="S5.E1.m1.6.7.3.3.3.1.cmml"><mo id="S5.E1.m1.6.7.3.3.3.2.1.1" xref="S5.E1.m1.6.7.3.3.3.1.cmml">(</mo><mfrac id="S5.E1.m1.5.5" xref="S5.E1.m1.5.5.cmml"><mrow id="S5.E1.m1.4.4.1" xref="S5.E1.m1.4.4.1.cmml"><mo rspace="0em" id="S5.E1.m1.4.4.1.2" xref="S5.E1.m1.4.4.1.2.cmml">∂</mo><msup id="S5.E1.m1.4.4.1.3" xref="S5.E1.m1.4.4.1.3.cmml"><mi id="S5.E1.m1.4.4.1.3.2" xref="S5.E1.m1.4.4.1.3.2.cmml">E</mi><mrow id="S5.E1.m1.4.4.1.1.1.1" xref="S5.E1.m1.4.4.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E1.m1.4.4.1.1.1.1.2" xref="S5.E1.m1.4.4.1.1.1.1.1.cmml">(</mo><mrow id="S5.E1.m1.4.4.1.1.1.1.1" xref="S5.E1.m1.4.4.1.1.1.1.1.cmml"><mi id="S5.E1.m1.4.4.1.1.1.1.1.2" xref="S5.E1.m1.4.4.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E1.m1.4.4.1.1.1.1.1.1" xref="S5.E1.m1.4.4.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E1.m1.4.4.1.1.1.1.1.3" xref="S5.E1.m1.4.4.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E1.m1.4.4.1.1.1.1.3" xref="S5.E1.m1.4.4.1.1.1.1.1.cmml">)</mo></mrow></msup></mrow><mrow id="S5.E1.m1.5.5.2" xref="S5.E1.m1.5.5.2.cmml"><mo rspace="0em" id="S5.E1.m1.5.5.2.2" xref="S5.E1.m1.5.5.2.2.cmml">∂</mo><msubsup id="S5.E1.m1.5.5.2.3" xref="S5.E1.m1.5.5.2.3.cmml"><mi id="S5.E1.m1.5.5.2.3.2.2" xref="S5.E1.m1.5.5.2.3.2.2.cmml">θ</mi><mi id="S5.E1.m1.5.5.2.3.2.3" xref="S5.E1.m1.5.5.2.3.2.3.cmml">i</mi><mrow id="S5.E1.m1.5.5.2.1.1.1" xref="S5.E1.m1.5.5.2.1.1.1.1.cmml"><mo stretchy="false" id="S5.E1.m1.5.5.2.1.1.1.2" xref="S5.E1.m1.5.5.2.1.1.1.1.cmml">(</mo><mrow id="S5.E1.m1.5.5.2.1.1.1.1" xref="S5.E1.m1.5.5.2.1.1.1.1.cmml"><mi id="S5.E1.m1.5.5.2.1.1.1.1.2" xref="S5.E1.m1.5.5.2.1.1.1.1.2.cmml">t</mi><mo id="S5.E1.m1.5.5.2.1.1.1.1.1" xref="S5.E1.m1.5.5.2.1.1.1.1.1.cmml">−</mo><mn id="S5.E1.m1.5.5.2.1.1.1.1.3" xref="S5.E1.m1.5.5.2.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E1.m1.5.5.2.1.1.1.3" xref="S5.E1.m1.5.5.2.1.1.1.1.cmml">)</mo></mrow></msubsup></mrow></mfrac><mo id="S5.E1.m1.6.7.3.3.3.2.1.2" xref="S5.E1.m1.6.7.3.3.3.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E1.m1.6b"><apply id="S5.E1.m1.6.7.cmml" xref="S5.E1.m1.6.7"><eq id="S5.E1.m1.6.7.1.cmml" xref="S5.E1.m1.6.7.1"></eq><apply id="S5.E1.m1.6.7.2.cmml" xref="S5.E1.m1.6.7.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.2.1.cmml" xref="S5.E1.m1.6.7.2">superscript</csymbol><apply id="S5.E1.m1.6.7.2.2.cmml" xref="S5.E1.m1.6.7.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.2.2.1.cmml" xref="S5.E1.m1.6.7.2">subscript</csymbol><ci id="S5.E1.m1.6.7.2.2.2.cmml" xref="S5.E1.m1.6.7.2.2.2">𝜃</ci><ci id="S5.E1.m1.6.7.2.2.3.cmml" xref="S5.E1.m1.6.7.2.2.3">𝑖</ci></apply><ci id="S5.E1.m1.1.1.1.1.cmml" xref="S5.E1.m1.1.1.1.1">𝑡</ci></apply><apply id="S5.E1.m1.6.7.3.cmml" xref="S5.E1.m1.6.7.3"><minus id="S5.E1.m1.6.7.3.1.cmml" xref="S5.E1.m1.6.7.3.1"></minus><apply id="S5.E1.m1.6.7.3.2.cmml" xref="S5.E1.m1.6.7.3.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.3.2.1.cmml" xref="S5.E1.m1.6.7.3.2">superscript</csymbol><apply id="S5.E1.m1.6.7.3.2.2.cmml" xref="S5.E1.m1.6.7.3.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.3.2.2.1.cmml" xref="S5.E1.m1.6.7.3.2">subscript</csymbol><ci id="S5.E1.m1.6.7.3.2.2.2.cmml" xref="S5.E1.m1.6.7.3.2.2.2">𝜃</ci><ci id="S5.E1.m1.6.7.3.2.2.3.cmml" xref="S5.E1.m1.6.7.3.2.2.3">𝑖</ci></apply><apply id="S5.E1.m1.2.2.1.1.1.cmml" xref="S5.E1.m1.2.2.1.1"><minus id="S5.E1.m1.2.2.1.1.1.1.cmml" xref="S5.E1.m1.2.2.1.1.1.1"></minus><ci id="S5.E1.m1.2.2.1.1.1.2.cmml" xref="S5.E1.m1.2.2.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E1.m1.2.2.1.1.1.3.cmml" xref="S5.E1.m1.2.2.1.1.1.3">1</cn></apply></apply><apply id="S5.E1.m1.6.7.3.3.cmml" xref="S5.E1.m1.6.7.3.3"><times id="S5.E1.m1.6.7.3.3.1.cmml" xref="S5.E1.m1.6.7.3.3.1"></times><apply id="S5.E1.m1.6.7.3.3.2.cmml" xref="S5.E1.m1.6.7.3.3.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.3.3.2.1.cmml" xref="S5.E1.m1.6.7.3.3.2">superscript</csymbol><apply id="S5.E1.m1.6.7.3.3.2.2.cmml" xref="S5.E1.m1.6.7.3.3.2"><csymbol cd="ambiguous" id="S5.E1.m1.6.7.3.3.2.2.1.cmml" xref="S5.E1.m1.6.7.3.3.2">subscript</csymbol><ci id="S5.E1.m1.6.7.3.3.2.2.2.cmml" xref="S5.E1.m1.6.7.3.3.2.2.2">𝜂</ci><ci id="S5.E1.m1.6.7.3.3.2.2.3.cmml" xref="S5.E1.m1.6.7.3.3.2.2.3">𝑖</ci></apply><apply id="S5.E1.m1.3.3.1.1.1.cmml" xref="S5.E1.m1.3.3.1.1"><minus id="S5.E1.m1.3.3.1.1.1.1.cmml" xref="S5.E1.m1.3.3.1.1.1.1"></minus><ci id="S5.E1.m1.3.3.1.1.1.2.cmml" xref="S5.E1.m1.3.3.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E1.m1.3.3.1.1.1.3.cmml" xref="S5.E1.m1.3.3.1.1.1.3">1</cn></apply></apply><apply id="S5.E1.m1.6.7.3.3.3.1.cmml" xref="S5.E1.m1.6.7.3.3.3.2"><ci id="S5.E1.m1.6.6.cmml" xref="S5.E1.m1.6.6">sgn</ci><apply id="S5.E1.m1.5.5.cmml" xref="S5.E1.m1.5.5"><divide id="S5.E1.m1.5.5.3.cmml" xref="S5.E1.m1.5.5"></divide><apply id="S5.E1.m1.4.4.1.cmml" xref="S5.E1.m1.4.4.1"><partialdiff id="S5.E1.m1.4.4.1.2.cmml" xref="S5.E1.m1.4.4.1.2"></partialdiff><apply id="S5.E1.m1.4.4.1.3.cmml" xref="S5.E1.m1.4.4.1.3"><csymbol cd="ambiguous" id="S5.E1.m1.4.4.1.3.1.cmml" xref="S5.E1.m1.4.4.1.3">superscript</csymbol><ci id="S5.E1.m1.4.4.1.3.2.cmml" xref="S5.E1.m1.4.4.1.3.2">𝐸</ci><apply id="S5.E1.m1.4.4.1.1.1.1.1.cmml" xref="S5.E1.m1.4.4.1.1.1.1"><minus id="S5.E1.m1.4.4.1.1.1.1.1.1.cmml" xref="S5.E1.m1.4.4.1.1.1.1.1.1"></minus><ci id="S5.E1.m1.4.4.1.1.1.1.1.2.cmml" xref="S5.E1.m1.4.4.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E1.m1.4.4.1.1.1.1.1.3.cmml" xref="S5.E1.m1.4.4.1.1.1.1.1.3">1</cn></apply></apply></apply><apply id="S5.E1.m1.5.5.2.cmml" xref="S5.E1.m1.5.5.2"><partialdiff id="S5.E1.m1.5.5.2.2.cmml" xref="S5.E1.m1.5.5.2.2"></partialdiff><apply id="S5.E1.m1.5.5.2.3.cmml" xref="S5.E1.m1.5.5.2.3"><csymbol cd="ambiguous" id="S5.E1.m1.5.5.2.3.1.cmml" xref="S5.E1.m1.5.5.2.3">superscript</csymbol><apply id="S5.E1.m1.5.5.2.3.2.cmml" xref="S5.E1.m1.5.5.2.3"><csymbol cd="ambiguous" id="S5.E1.m1.5.5.2.3.2.1.cmml" xref="S5.E1.m1.5.5.2.3">subscript</csymbol><ci id="S5.E1.m1.5.5.2.3.2.2.cmml" xref="S5.E1.m1.5.5.2.3.2.2">𝜃</ci><ci id="S5.E1.m1.5.5.2.3.2.3.cmml" xref="S5.E1.m1.5.5.2.3.2.3">𝑖</ci></apply><apply id="S5.E1.m1.5.5.2.1.1.1.1.cmml" xref="S5.E1.m1.5.5.2.1.1.1"><minus id="S5.E1.m1.5.5.2.1.1.1.1.1.cmml" xref="S5.E1.m1.5.5.2.1.1.1.1.1"></minus><ci id="S5.E1.m1.5.5.2.1.1.1.1.2.cmml" xref="S5.E1.m1.5.5.2.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E1.m1.5.5.2.1.1.1.1.3.cmml" xref="S5.E1.m1.5.5.2.1.1.1.1.3">1</cn></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E1.m1.6c">\theta_{i}^{(t)}=\theta_{i}^{(t-1)}-\eta_{i}^{(t-1)}*\operatorname{sgn}\left(\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}\right)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S5.SS3.p4.2" class="ltx_p">where the sign of the partial derivative of the error in the last step
with respect to the given weight is computed.
We go in the direction of descent using the determined step size.</p>
</div>
<div id="S5.SS3.p5" class="ltx_para">
<p id="S5.SS3.p5.1" class="ltx_p">In each iteration of Rprop, the gradients are computed and the step sizes are
updated for each dimension individually.
This is done by comparing the gradient’s sign of the current and previous
iteration.
The idea here is the following:
</p>
<ul id="S5.I1" class="ltx_itemize">
<li id="S5.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S5.I1.i1.p1" class="ltx_para">
<p id="S5.I1.i1.p1.1" class="ltx_p">When the signs are the same, we go in the same direction as in the
previous iteration. Since this seems to be a good direction, the step size
should be increased to go to the optimum more quickly.</p>
</div>
</li>
<li id="S5.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S5.I1.i2.p1" class="ltx_para">
<p id="S5.I1.i2.p1.1" class="ltx_p">If the sign changed, the new update is moving in a different direction.
This means that we just jumped over an optimum.
The step size should be decreased to avoid jumping over the optimum again.</p>
</div>
</li>
</ul>
</div>
<div id="S5.SS3.p6" class="ltx_para ltx_noindent">
<p id="S5.SS3.p6.4" class="ltx_p">To implement this update scheme, the following formula is used:</p>
<table id="S5.E2" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S5.E2.m1.7" class="ltx_Math" alttext="\eta_{i}^{(t)}=\begin{cases}\min(\eta_{i}^{(t-1)}*\alpha,\eta_{\max})&amp;\text{if }\frac{\partial E^{(t)}}{\partial\theta_{i}^{(t)}}*\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}&gt;0\\
\max(\eta_{i}^{(t-1)}*\beta,\eta_{\min})&amp;\text{if }\frac{\partial E^{(t)}}{\partial\theta_{i}^{(t)}}*\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}&lt;0\\
\eta_{i}^{(t-1)}&amp;\text{otherwise}\end{cases}" display="block"><semantics id="S5.E2.m1.7a"><mrow id="S5.E2.m1.7.8" xref="S5.E2.m1.7.8.cmml"><msubsup id="S5.E2.m1.7.8.2" xref="S5.E2.m1.7.8.2.cmml"><mi id="S5.E2.m1.7.8.2.2.2" xref="S5.E2.m1.7.8.2.2.2.cmml">η</mi><mi id="S5.E2.m1.7.8.2.2.3" xref="S5.E2.m1.7.8.2.2.3.cmml">i</mi><mrow id="S5.E2.m1.7.7.1.3" xref="S5.E2.m1.7.8.2.cmml"><mo stretchy="false" id="S5.E2.m1.7.7.1.3.1" xref="S5.E2.m1.7.8.2.cmml">(</mo><mi id="S5.E2.m1.7.7.1.1" xref="S5.E2.m1.7.7.1.1.cmml">t</mi><mo stretchy="false" id="S5.E2.m1.7.7.1.3.2" xref="S5.E2.m1.7.8.2.cmml">)</mo></mrow></msubsup><mo id="S5.E2.m1.7.8.1" xref="S5.E2.m1.7.8.1.cmml">=</mo><mrow id="S5.E2.m1.6.6" xref="S5.E2.m1.7.8.3.1.cmml"><mo id="S5.E2.m1.6.6.7" xref="S5.E2.m1.7.8.3.1.1.cmml">{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt" id="S5.E2.m1.6.6.6" xref="S5.E2.m1.7.8.3.1.cmml"><mtr id="S5.E2.m1.6.6.6a" xref="S5.E2.m1.7.8.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6b" xref="S5.E2.m1.7.8.3.1.cmml"><mrow id="S5.E2.m1.1.1.1.1.1.1.4" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml"><mi id="S5.E2.m1.1.1.1.1.1.1.2" xref="S5.E2.m1.1.1.1.1.1.1.2.cmml">min</mi><mo id="S5.E2.m1.1.1.1.1.1.1.4a" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml">⁡</mo><mrow id="S5.E2.m1.1.1.1.1.1.1.4.2" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml"><mo stretchy="false" id="S5.E2.m1.1.1.1.1.1.1.4.2.3" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml">(</mo><mrow id="S5.E2.m1.1.1.1.1.1.1.3.1.1" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.cmml"><msubsup id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.cmml"><mi id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.2" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.2.cmml">η</mi><mi id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.3" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.3.cmml">i</mi><mrow id="S5.E2.m1.1.1.1.1.1.1.1.1.1" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.1.1.1.1.1.1.1.1.1.2" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.1" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.1.1.1.1.1.1.1.1.1.3" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></msubsup><mo lspace="0.222em" rspace="0.222em" id="S5.E2.m1.1.1.1.1.1.1.3.1.1.1" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.1.cmml">∗</mo><mi id="S5.E2.m1.1.1.1.1.1.1.3.1.1.3" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.3.cmml">α</mi></mrow><mo id="S5.E2.m1.1.1.1.1.1.1.4.2.4" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml">,</mo><msub id="S5.E2.m1.1.1.1.1.1.1.4.2.2" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2.cmml"><mi id="S5.E2.m1.1.1.1.1.1.1.4.2.2.2" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2.2.cmml">η</mi><mi id="S5.E2.m1.1.1.1.1.1.1.4.2.2.3" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2.3.cmml">max</mi></msub><mo stretchy="false" id="S5.E2.m1.1.1.1.1.1.1.4.2.5" xref="S5.E2.m1.1.1.1.1.1.1.5.cmml">)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6c" xref="S5.E2.m1.7.8.3.1.cmml"><mrow id="S5.E2.m1.2.2.2.2.2.1" xref="S5.E2.m1.2.2.2.2.2.1.cmml"><mrow id="S5.E2.m1.2.2.2.2.2.1.6" xref="S5.E2.m1.2.2.2.2.2.1.6.cmml"><mrow id="S5.E2.m1.2.2.2.2.2.1.6.2" xref="S5.E2.m1.2.2.2.2.2.1.6.2.cmml"><mtext id="S5.E2.m1.2.2.2.2.2.1.6.2.2" xref="S5.E2.m1.2.2.2.2.2.1.6.2.2a.cmml">if </mtext><mo lspace="0em" rspace="0em" id="S5.E2.m1.2.2.2.2.2.1.6.2.1" xref="S5.E2.m1.2.2.2.2.2.1.6.2.1.cmml">​</mo><mstyle displaystyle="false" id="S5.E2.m1.2.2.2.2.2.1.2" xref="S5.E2.m1.2.2.2.2.2.1.2.cmml"><mfrac id="S5.E2.m1.2.2.2.2.2.1.2a" xref="S5.E2.m1.2.2.2.2.2.1.2.cmml"><mrow id="S5.E2.m1.2.2.2.2.2.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.1.1.cmml"><mo rspace="0em" id="S5.E2.m1.2.2.2.2.2.1.1.1.2" xref="S5.E2.m1.2.2.2.2.2.1.1.1.2.cmml">∂</mo><msup id="S5.E2.m1.2.2.2.2.2.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.1.1.3.2" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.2.cmml">E</mi><mrow id="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.cmml"><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.3.1" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.cmml">(</mo><mi id="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.3.2" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.cmml">)</mo></mrow></msup></mrow><mrow id="S5.E2.m1.2.2.2.2.2.1.2.2" xref="S5.E2.m1.2.2.2.2.2.1.2.2.cmml"><mo rspace="0em" id="S5.E2.m1.2.2.2.2.2.1.2.2.2" xref="S5.E2.m1.2.2.2.2.2.1.2.2.2.cmml">∂</mo><msubsup id="S5.E2.m1.2.2.2.2.2.1.2.2.3" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.2" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.2.cmml">θ</mi><mi id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.3" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.3.cmml">i</mi><mrow id="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.cmml"><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.3.1" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.cmml">(</mo><mi id="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.3.2" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.cmml">)</mo></mrow></msubsup></mrow></mfrac></mstyle></mrow><mo lspace="0.222em" rspace="0.222em" id="S5.E2.m1.2.2.2.2.2.1.6.1" xref="S5.E2.m1.2.2.2.2.2.1.6.1.cmml">∗</mo><mstyle displaystyle="false" id="S5.E2.m1.2.2.2.2.2.1.4" xref="S5.E2.m1.2.2.2.2.2.1.4.cmml"><mfrac id="S5.E2.m1.2.2.2.2.2.1.4a" xref="S5.E2.m1.2.2.2.2.2.1.4.cmml"><mrow id="S5.E2.m1.2.2.2.2.2.1.3.1" xref="S5.E2.m1.2.2.2.2.2.1.3.1.cmml"><mo rspace="0em" id="S5.E2.m1.2.2.2.2.2.1.3.1.2" xref="S5.E2.m1.2.2.2.2.2.1.3.1.2.cmml">∂</mo><msup id="S5.E2.m1.2.2.2.2.2.1.3.1.3" xref="S5.E2.m1.2.2.2.2.2.1.3.1.3.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.3.1.3.2" xref="S5.E2.m1.2.2.2.2.2.1.3.1.3.2.cmml">E</mi><mrow id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.2" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.2" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml">)</mo></mrow></msup></mrow><mrow id="S5.E2.m1.2.2.2.2.2.1.4.2" xref="S5.E2.m1.2.2.2.2.2.1.4.2.cmml"><mo rspace="0em" id="S5.E2.m1.2.2.2.2.2.1.4.2.2" xref="S5.E2.m1.2.2.2.2.2.1.4.2.2.cmml">∂</mo><msubsup id="S5.E2.m1.2.2.2.2.2.1.4.2.3" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.2" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.2.cmml">θ</mi><mi id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.3" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.3.cmml">i</mi><mrow id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.2" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.cmml"><mi id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.2" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.1" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.3" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.cmml">)</mo></mrow></msubsup></mrow></mfrac></mstyle></mrow><mo id="S5.E2.m1.2.2.2.2.2.1.5" xref="S5.E2.m1.2.2.2.2.2.1.5.cmml">&gt;</mo><mn id="S5.E2.m1.2.2.2.2.2.1.7" xref="S5.E2.m1.2.2.2.2.2.1.7.cmml">0</mn></mrow></mtd></mtr><mtr id="S5.E2.m1.6.6.6d" xref="S5.E2.m1.7.8.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6e" xref="S5.E2.m1.7.8.3.1.cmml"><mrow id="S5.E2.m1.3.3.3.3.1.1.4" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml"><mi id="S5.E2.m1.3.3.3.3.1.1.2" xref="S5.E2.m1.3.3.3.3.1.1.2.cmml">max</mi><mo id="S5.E2.m1.3.3.3.3.1.1.4a" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml">⁡</mo><mrow id="S5.E2.m1.3.3.3.3.1.1.4.2" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml"><mo stretchy="false" id="S5.E2.m1.3.3.3.3.1.1.4.2.3" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml">(</mo><mrow id="S5.E2.m1.3.3.3.3.1.1.3.1.1" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.cmml"><msubsup id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.cmml"><mi id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.2" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.2.cmml">η</mi><mi id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.3" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.3.cmml">i</mi><mrow id="S5.E2.m1.3.3.3.3.1.1.1.1.1" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.3.3.3.3.1.1.1.1.1.2" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.cmml"><mi id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.2" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.1" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.3" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.3.3.3.3.1.1.1.1.1.3" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.cmml">)</mo></mrow></msubsup><mo lspace="0.222em" rspace="0.222em" id="S5.E2.m1.3.3.3.3.1.1.3.1.1.1" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.1.cmml">∗</mo><mi id="S5.E2.m1.3.3.3.3.1.1.3.1.1.3" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.3.cmml">β</mi></mrow><mo id="S5.E2.m1.3.3.3.3.1.1.4.2.4" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml">,</mo><msub id="S5.E2.m1.3.3.3.3.1.1.4.2.2" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2.cmml"><mi id="S5.E2.m1.3.3.3.3.1.1.4.2.2.2" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2.2.cmml">η</mi><mi id="S5.E2.m1.3.3.3.3.1.1.4.2.2.3" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2.3.cmml">min</mi></msub><mo stretchy="false" id="S5.E2.m1.3.3.3.3.1.1.4.2.5" xref="S5.E2.m1.3.3.3.3.1.1.5.cmml">)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6f" xref="S5.E2.m1.7.8.3.1.cmml"><mrow id="S5.E2.m1.4.4.4.4.2.1" xref="S5.E2.m1.4.4.4.4.2.1.cmml"><mrow id="S5.E2.m1.4.4.4.4.2.1.6" xref="S5.E2.m1.4.4.4.4.2.1.6.cmml"><mrow id="S5.E2.m1.4.4.4.4.2.1.6.2" xref="S5.E2.m1.4.4.4.4.2.1.6.2.cmml"><mtext id="S5.E2.m1.4.4.4.4.2.1.6.2.2" xref="S5.E2.m1.4.4.4.4.2.1.6.2.2a.cmml">if </mtext><mo lspace="0em" rspace="0em" id="S5.E2.m1.4.4.4.4.2.1.6.2.1" xref="S5.E2.m1.4.4.4.4.2.1.6.2.1.cmml">​</mo><mstyle displaystyle="false" id="S5.E2.m1.4.4.4.4.2.1.2" xref="S5.E2.m1.4.4.4.4.2.1.2.cmml"><mfrac id="S5.E2.m1.4.4.4.4.2.1.2a" xref="S5.E2.m1.4.4.4.4.2.1.2.cmml"><mrow id="S5.E2.m1.4.4.4.4.2.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.1.1.cmml"><mo rspace="0em" id="S5.E2.m1.4.4.4.4.2.1.1.1.2" xref="S5.E2.m1.4.4.4.4.2.1.1.1.2.cmml">∂</mo><msup id="S5.E2.m1.4.4.4.4.2.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.1.1.3.2" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.2.cmml">E</mi><mrow id="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.cmml"><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.3.1" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.cmml">(</mo><mi id="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.3.2" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.cmml">)</mo></mrow></msup></mrow><mrow id="S5.E2.m1.4.4.4.4.2.1.2.2" xref="S5.E2.m1.4.4.4.4.2.1.2.2.cmml"><mo rspace="0em" id="S5.E2.m1.4.4.4.4.2.1.2.2.2" xref="S5.E2.m1.4.4.4.4.2.1.2.2.2.cmml">∂</mo><msubsup id="S5.E2.m1.4.4.4.4.2.1.2.2.3" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.2" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.2.cmml">θ</mi><mi id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.3" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.3.cmml">i</mi><mrow id="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.cmml"><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.3.1" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.cmml">(</mo><mi id="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.1.cmml">t</mi><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.3.2" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.cmml">)</mo></mrow></msubsup></mrow></mfrac></mstyle></mrow><mo lspace="0.222em" rspace="0.222em" id="S5.E2.m1.4.4.4.4.2.1.6.1" xref="S5.E2.m1.4.4.4.4.2.1.6.1.cmml">∗</mo><mstyle displaystyle="false" id="S5.E2.m1.4.4.4.4.2.1.4" xref="S5.E2.m1.4.4.4.4.2.1.4.cmml"><mfrac id="S5.E2.m1.4.4.4.4.2.1.4a" xref="S5.E2.m1.4.4.4.4.2.1.4.cmml"><mrow id="S5.E2.m1.4.4.4.4.2.1.3.1" xref="S5.E2.m1.4.4.4.4.2.1.3.1.cmml"><mo rspace="0em" id="S5.E2.m1.4.4.4.4.2.1.3.1.2" xref="S5.E2.m1.4.4.4.4.2.1.3.1.2.cmml">∂</mo><msup id="S5.E2.m1.4.4.4.4.2.1.3.1.3" xref="S5.E2.m1.4.4.4.4.2.1.3.1.3.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.3.1.3.2" xref="S5.E2.m1.4.4.4.4.2.1.3.1.3.2.cmml">E</mi><mrow id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.2" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.2" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.cmml">)</mo></mrow></msup></mrow><mrow id="S5.E2.m1.4.4.4.4.2.1.4.2" xref="S5.E2.m1.4.4.4.4.2.1.4.2.cmml"><mo rspace="0em" id="S5.E2.m1.4.4.4.4.2.1.4.2.2" xref="S5.E2.m1.4.4.4.4.2.1.4.2.2.cmml">∂</mo><msubsup id="S5.E2.m1.4.4.4.4.2.1.4.2.3" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.2" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.2.cmml">θ</mi><mi id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.3" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.3.cmml">i</mi><mrow id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.2" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.cmml"><mi id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.2" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.1" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.3" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.cmml">)</mo></mrow></msubsup></mrow></mfrac></mstyle></mrow><mo id="S5.E2.m1.4.4.4.4.2.1.5" xref="S5.E2.m1.4.4.4.4.2.1.5.cmml">&lt;</mo><mn id="S5.E2.m1.4.4.4.4.2.1.7" xref="S5.E2.m1.4.4.4.4.2.1.7.cmml">0</mn></mrow></mtd></mtr><mtr id="S5.E2.m1.6.6.6g" xref="S5.E2.m1.7.8.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6h" xref="S5.E2.m1.7.8.3.1.cmml"><msubsup id="S5.E2.m1.5.5.5.5.1.1" xref="S5.E2.m1.5.5.5.5.1.1.cmml"><mi id="S5.E2.m1.5.5.5.5.1.1.3.2" xref="S5.E2.m1.5.5.5.5.1.1.3.2.cmml">η</mi><mi id="S5.E2.m1.5.5.5.5.1.1.3.3" xref="S5.E2.m1.5.5.5.5.1.1.3.3.cmml">i</mi><mrow id="S5.E2.m1.5.5.5.5.1.1.1.1.1" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.E2.m1.5.5.5.5.1.1.1.1.1.2" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.cmml"><mi id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.2" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.2.cmml">t</mi><mo id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.1" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.1.cmml">−</mo><mn id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.3" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S5.E2.m1.5.5.5.5.1.1.1.1.1.3" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.cmml">)</mo></mrow></msubsup></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E2.m1.6.6.6i" xref="S5.E2.m1.7.8.3.1.cmml"><mtext id="S5.E2.m1.6.6.6.6.2.1" xref="S5.E2.m1.6.6.6.6.2.1a.cmml">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E2.m1.7b"><apply id="S5.E2.m1.7.8.cmml" xref="S5.E2.m1.7.8"><eq id="S5.E2.m1.7.8.1.cmml" xref="S5.E2.m1.7.8.1"></eq><apply id="S5.E2.m1.7.8.2.cmml" xref="S5.E2.m1.7.8.2"><csymbol cd="ambiguous" id="S5.E2.m1.7.8.2.1.cmml" xref="S5.E2.m1.7.8.2">superscript</csymbol><apply id="S5.E2.m1.7.8.2.2.cmml" xref="S5.E2.m1.7.8.2"><csymbol cd="ambiguous" id="S5.E2.m1.7.8.2.2.1.cmml" xref="S5.E2.m1.7.8.2">subscript</csymbol><ci id="S5.E2.m1.7.8.2.2.2.cmml" xref="S5.E2.m1.7.8.2.2.2">𝜂</ci><ci id="S5.E2.m1.7.8.2.2.3.cmml" xref="S5.E2.m1.7.8.2.2.3">𝑖</ci></apply><ci id="S5.E2.m1.7.7.1.1.cmml" xref="S5.E2.m1.7.7.1.1">𝑡</ci></apply><apply id="S5.E2.m1.7.8.3.1.cmml" xref="S5.E2.m1.6.6"><csymbol cd="latexml" id="S5.E2.m1.7.8.3.1.1.cmml" xref="S5.E2.m1.6.6.7">cases</csymbol><apply id="S5.E2.m1.1.1.1.1.1.1.5.cmml" xref="S5.E2.m1.1.1.1.1.1.1.4"><min id="S5.E2.m1.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.2"></min><apply id="S5.E2.m1.1.1.1.1.1.1.3.1.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1"><times id="S5.E2.m1.1.1.1.1.1.1.3.1.1.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.1"></times><apply id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2">superscript</csymbol><apply id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2">subscript</csymbol><ci id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.2">𝜂</ci><ci id="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.3.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.2.2.3">𝑖</ci></apply><apply id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1"><minus id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.1"></minus><ci id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E2.m1.1.1.1.1.1.1.1.1.1.1.3">1</cn></apply></apply><ci id="S5.E2.m1.1.1.1.1.1.1.3.1.1.3.cmml" xref="S5.E2.m1.1.1.1.1.1.1.3.1.1.3">𝛼</ci></apply><apply id="S5.E2.m1.1.1.1.1.1.1.4.2.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2"><csymbol cd="ambiguous" id="S5.E2.m1.1.1.1.1.1.1.4.2.2.1.cmml" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2">subscript</csymbol><ci id="S5.E2.m1.1.1.1.1.1.1.4.2.2.2.cmml" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2.2">𝜂</ci><max id="S5.E2.m1.1.1.1.1.1.1.4.2.2.3.cmml" xref="S5.E2.m1.1.1.1.1.1.1.4.2.2.3"></max></apply></apply><apply id="S5.E2.m1.2.2.2.2.2.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1"><gt id="S5.E2.m1.2.2.2.2.2.1.5.cmml" xref="S5.E2.m1.2.2.2.2.2.1.5"></gt><apply id="S5.E2.m1.2.2.2.2.2.1.6.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6"><times id="S5.E2.m1.2.2.2.2.2.1.6.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6.1"></times><apply id="S5.E2.m1.2.2.2.2.2.1.6.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6.2"><times id="S5.E2.m1.2.2.2.2.2.1.6.2.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6.2.1"></times><ci id="S5.E2.m1.2.2.2.2.2.1.6.2.2a.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6.2.2"><mtext id="S5.E2.m1.2.2.2.2.2.1.6.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.6.2.2">if </mtext></ci><apply id="S5.E2.m1.2.2.2.2.2.1.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2"><divide id="S5.E2.m1.2.2.2.2.2.1.2.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2"></divide><apply id="S5.E2.m1.2.2.2.2.2.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1"><partialdiff id="S5.E2.m1.2.2.2.2.2.1.1.1.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1.2"></partialdiff><apply id="S5.E2.m1.2.2.2.2.2.1.1.1.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.1.1.3.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3">superscript</csymbol><ci id="S5.E2.m1.2.2.2.2.2.1.1.1.3.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1.3.2">𝐸</ci><ci id="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.1.1.1.1.1">𝑡</ci></apply></apply><apply id="S5.E2.m1.2.2.2.2.2.1.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2"><partialdiff id="S5.E2.m1.2.2.2.2.2.1.2.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.2"></partialdiff><apply id="S5.E2.m1.2.2.2.2.2.1.2.2.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.2.2.3.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3">superscript</csymbol><apply id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3">subscript</csymbol><ci id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.2">𝜃</ci><ci id="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.3.2.3">𝑖</ci></apply><ci id="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.2.2.1.1.1">𝑡</ci></apply></apply></apply></apply><apply id="S5.E2.m1.2.2.2.2.2.1.4.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4"><divide id="S5.E2.m1.2.2.2.2.2.1.4.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4"></divide><apply id="S5.E2.m1.2.2.2.2.2.1.3.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1"><partialdiff id="S5.E2.m1.2.2.2.2.2.1.3.1.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.2"></partialdiff><apply id="S5.E2.m1.2.2.2.2.2.1.3.1.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.3.1.3.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.3">superscript</csymbol><ci id="S5.E2.m1.2.2.2.2.2.1.3.1.3.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.3.2">𝐸</ci><apply id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1"><minus id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.1"></minus><ci id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.3.1.1.1.1.1.3">1</cn></apply></apply></apply><apply id="S5.E2.m1.2.2.2.2.2.1.4.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2"><partialdiff id="S5.E2.m1.2.2.2.2.2.1.4.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.2"></partialdiff><apply id="S5.E2.m1.2.2.2.2.2.1.4.2.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.4.2.3.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3">superscript</csymbol><apply id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3">subscript</csymbol><ci id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.2">𝜃</ci><ci id="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.3.2.3">𝑖</ci></apply><apply id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1"><minus id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.1.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.1"></minus><ci id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.2.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.3.cmml" xref="S5.E2.m1.2.2.2.2.2.1.4.2.1.1.1.1.3">1</cn></apply></apply></apply></apply></apply><cn type="integer" id="S5.E2.m1.2.2.2.2.2.1.7.cmml" xref="S5.E2.m1.2.2.2.2.2.1.7">0</cn></apply><apply id="S5.E2.m1.3.3.3.3.1.1.5.cmml" xref="S5.E2.m1.3.3.3.3.1.1.4"><max id="S5.E2.m1.3.3.3.3.1.1.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.2"></max><apply id="S5.E2.m1.3.3.3.3.1.1.3.1.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1"><times id="S5.E2.m1.3.3.3.3.1.1.3.1.1.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.1"></times><apply id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2">superscript</csymbol><apply id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2">subscript</csymbol><ci id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.2">𝜂</ci><ci id="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.3.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.2.2.3">𝑖</ci></apply><apply id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1"><minus id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.1"></minus><ci id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.3.cmml" xref="S5.E2.m1.3.3.3.3.1.1.1.1.1.1.3">1</cn></apply></apply><ci id="S5.E2.m1.3.3.3.3.1.1.3.1.1.3.cmml" xref="S5.E2.m1.3.3.3.3.1.1.3.1.1.3">𝛽</ci></apply><apply id="S5.E2.m1.3.3.3.3.1.1.4.2.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2"><csymbol cd="ambiguous" id="S5.E2.m1.3.3.3.3.1.1.4.2.2.1.cmml" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2">subscript</csymbol><ci id="S5.E2.m1.3.3.3.3.1.1.4.2.2.2.cmml" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2.2">𝜂</ci><min id="S5.E2.m1.3.3.3.3.1.1.4.2.2.3.cmml" xref="S5.E2.m1.3.3.3.3.1.1.4.2.2.3"></min></apply></apply><apply id="S5.E2.m1.4.4.4.4.2.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1"><lt id="S5.E2.m1.4.4.4.4.2.1.5.cmml" xref="S5.E2.m1.4.4.4.4.2.1.5"></lt><apply id="S5.E2.m1.4.4.4.4.2.1.6.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6"><times id="S5.E2.m1.4.4.4.4.2.1.6.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6.1"></times><apply id="S5.E2.m1.4.4.4.4.2.1.6.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6.2"><times id="S5.E2.m1.4.4.4.4.2.1.6.2.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6.2.1"></times><ci id="S5.E2.m1.4.4.4.4.2.1.6.2.2a.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6.2.2"><mtext id="S5.E2.m1.4.4.4.4.2.1.6.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.6.2.2">if </mtext></ci><apply id="S5.E2.m1.4.4.4.4.2.1.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2"><divide id="S5.E2.m1.4.4.4.4.2.1.2.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2"></divide><apply id="S5.E2.m1.4.4.4.4.2.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1"><partialdiff id="S5.E2.m1.4.4.4.4.2.1.1.1.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1.2"></partialdiff><apply id="S5.E2.m1.4.4.4.4.2.1.1.1.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.1.1.3.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3">superscript</csymbol><ci id="S5.E2.m1.4.4.4.4.2.1.1.1.3.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1.3.2">𝐸</ci><ci id="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.1.1.1.1.1">𝑡</ci></apply></apply><apply id="S5.E2.m1.4.4.4.4.2.1.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2"><partialdiff id="S5.E2.m1.4.4.4.4.2.1.2.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.2"></partialdiff><apply id="S5.E2.m1.4.4.4.4.2.1.2.2.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.2.2.3.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3">superscript</csymbol><apply id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3">subscript</csymbol><ci id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.2">𝜃</ci><ci id="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.3.2.3">𝑖</ci></apply><ci id="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.2.2.1.1.1">𝑡</ci></apply></apply></apply></apply><apply id="S5.E2.m1.4.4.4.4.2.1.4.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4"><divide id="S5.E2.m1.4.4.4.4.2.1.4.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4"></divide><apply id="S5.E2.m1.4.4.4.4.2.1.3.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1"><partialdiff id="S5.E2.m1.4.4.4.4.2.1.3.1.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.2"></partialdiff><apply id="S5.E2.m1.4.4.4.4.2.1.3.1.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.3.1.3.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.3">superscript</csymbol><ci id="S5.E2.m1.4.4.4.4.2.1.3.1.3.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.3.2">𝐸</ci><apply id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1"><minus id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.1"></minus><ci id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.3.1.1.1.1.1.3">1</cn></apply></apply></apply><apply id="S5.E2.m1.4.4.4.4.2.1.4.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2"><partialdiff id="S5.E2.m1.4.4.4.4.2.1.4.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.2"></partialdiff><apply id="S5.E2.m1.4.4.4.4.2.1.4.2.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.4.2.3.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3">superscript</csymbol><apply id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3"><csymbol cd="ambiguous" id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3">subscript</csymbol><ci id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.2">𝜃</ci><ci id="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.3.2.3">𝑖</ci></apply><apply id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1"><minus id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.1.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.1"></minus><ci id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.2.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.3.cmml" xref="S5.E2.m1.4.4.4.4.2.1.4.2.1.1.1.1.3">1</cn></apply></apply></apply></apply></apply><cn type="integer" id="S5.E2.m1.4.4.4.4.2.1.7.cmml" xref="S5.E2.m1.4.4.4.4.2.1.7">0</cn></apply><apply id="S5.E2.m1.5.5.5.5.1.1.cmml" xref="S5.E2.m1.5.5.5.5.1.1"><csymbol cd="ambiguous" id="S5.E2.m1.5.5.5.5.1.1.2.cmml" xref="S5.E2.m1.5.5.5.5.1.1">superscript</csymbol><apply id="S5.E2.m1.5.5.5.5.1.1.3.cmml" xref="S5.E2.m1.5.5.5.5.1.1"><csymbol cd="ambiguous" id="S5.E2.m1.5.5.5.5.1.1.3.1.cmml" xref="S5.E2.m1.5.5.5.5.1.1">subscript</csymbol><ci id="S5.E2.m1.5.5.5.5.1.1.3.2.cmml" xref="S5.E2.m1.5.5.5.5.1.1.3.2">𝜂</ci><ci id="S5.E2.m1.5.5.5.5.1.1.3.3.cmml" xref="S5.E2.m1.5.5.5.5.1.1.3.3">𝑖</ci></apply><apply id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1"><minus id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.1"></minus><ci id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.2">𝑡</ci><cn type="integer" id="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.3.cmml" xref="S5.E2.m1.5.5.5.5.1.1.1.1.1.1.3">1</cn></apply></apply><ci id="S5.E2.m1.6.6.6.6.2.1a.cmml" xref="S5.E2.m1.6.6.6.6.2.1"><mtext id="S5.E2.m1.6.6.6.6.2.1.cmml" xref="S5.E2.m1.6.6.6.6.2.1">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E2.m1.7c">\eta_{i}^{(t)}=\begin{cases}\min(\eta_{i}^{(t-1)}*\alpha,\eta_{\max})&amp;\text{if }\frac{\partial E^{(t)}}{\partial\theta_{i}^{(t)}}*\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}&gt;0\\
\max(\eta_{i}^{(t-1)}*\beta,\eta_{\min})&amp;\text{if }\frac{\partial E^{(t)}}{\partial\theta_{i}^{(t)}}*\frac{\partial E^{(t-1)}}{\partial\theta_{i}^{(t-1)}}&lt;0\\
\eta_{i}^{(t-1)}&amp;\text{otherwise}\end{cases}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S5.SS3.p6.3" class="ltx_p">where <math id="S5.SS3.p6.1.m1.1" class="ltx_Math" alttext="\alpha&gt;1&gt;\beta" display="inline"><semantics id="S5.SS3.p6.1.m1.1a"><mrow id="S5.SS3.p6.1.m1.1.1" xref="S5.SS3.p6.1.m1.1.1.cmml"><mi id="S5.SS3.p6.1.m1.1.1.2" xref="S5.SS3.p6.1.m1.1.1.2.cmml">α</mi><mo id="S5.SS3.p6.1.m1.1.1.3" xref="S5.SS3.p6.1.m1.1.1.3.cmml">&gt;</mo><mn id="S5.SS3.p6.1.m1.1.1.4" xref="S5.SS3.p6.1.m1.1.1.4.cmml">1</mn><mo id="S5.SS3.p6.1.m1.1.1.5" xref="S5.SS3.p6.1.m1.1.1.5.cmml">&gt;</mo><mi id="S5.SS3.p6.1.m1.1.1.6" xref="S5.SS3.p6.1.m1.1.1.6.cmml">β</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p6.1.m1.1b"><apply id="S5.SS3.p6.1.m1.1.1.cmml" xref="S5.SS3.p6.1.m1.1.1"><and id="S5.SS3.p6.1.m1.1.1a.cmml" xref="S5.SS3.p6.1.m1.1.1"></and><apply id="S5.SS3.p6.1.m1.1.1b.cmml" xref="S5.SS3.p6.1.m1.1.1"><gt id="S5.SS3.p6.1.m1.1.1.3.cmml" xref="S5.SS3.p6.1.m1.1.1.3"></gt><ci id="S5.SS3.p6.1.m1.1.1.2.cmml" xref="S5.SS3.p6.1.m1.1.1.2">𝛼</ci><cn type="integer" id="S5.SS3.p6.1.m1.1.1.4.cmml" xref="S5.SS3.p6.1.m1.1.1.4">1</cn></apply><apply id="S5.SS3.p6.1.m1.1.1c.cmml" xref="S5.SS3.p6.1.m1.1.1"><gt id="S5.SS3.p6.1.m1.1.1.5.cmml" xref="S5.SS3.p6.1.m1.1.1.5"></gt><share href="#S5.SS3.p6.1.m1.1.1.4.cmml" id="S5.SS3.p6.1.m1.1.1d.cmml" xref="S5.SS3.p6.1.m1.1.1"></share><ci id="S5.SS3.p6.1.m1.1.1.6.cmml" xref="S5.SS3.p6.1.m1.1.1.6">𝛽</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p6.1.m1.1c">\alpha&gt;1&gt;\beta</annotation></semantics></math> scale the step size, depending on whether
the speed should be increased or decreased. The step size is then clipped using
<math id="S5.SS3.p6.2.m2.1" class="ltx_Math" alttext="\eta_{\min}" display="inline"><semantics id="S5.SS3.p6.2.m2.1a"><msub id="S5.SS3.p6.2.m2.1.1" xref="S5.SS3.p6.2.m2.1.1.cmml"><mi id="S5.SS3.p6.2.m2.1.1.2" xref="S5.SS3.p6.2.m2.1.1.2.cmml">η</mi><mi id="S5.SS3.p6.2.m2.1.1.3" xref="S5.SS3.p6.2.m2.1.1.3.cmml">min</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p6.2.m2.1b"><apply id="S5.SS3.p6.2.m2.1.1.cmml" xref="S5.SS3.p6.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p6.2.m2.1.1.1.cmml" xref="S5.SS3.p6.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.p6.2.m2.1.1.2.cmml" xref="S5.SS3.p6.2.m2.1.1.2">𝜂</ci><min id="S5.SS3.p6.2.m2.1.1.3.cmml" xref="S5.SS3.p6.2.m2.1.1.3"></min></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p6.2.m2.1c">\eta_{\min}</annotation></semantics></math> and <math id="S5.SS3.p6.3.m3.1" class="ltx_Math" alttext="\eta_{\max}" display="inline"><semantics id="S5.SS3.p6.3.m3.1a"><msub id="S5.SS3.p6.3.m3.1.1" xref="S5.SS3.p6.3.m3.1.1.cmml"><mi id="S5.SS3.p6.3.m3.1.1.2" xref="S5.SS3.p6.3.m3.1.1.2.cmml">η</mi><mi id="S5.SS3.p6.3.m3.1.1.3" xref="S5.SS3.p6.3.m3.1.1.3.cmml">max</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p6.3.m3.1b"><apply id="S5.SS3.p6.3.m3.1.1.cmml" xref="S5.SS3.p6.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.p6.3.m3.1.1.1.cmml" xref="S5.SS3.p6.3.m3.1.1">subscript</csymbol><ci id="S5.SS3.p6.3.m3.1.1.2.cmml" xref="S5.SS3.p6.3.m3.1.1.2">𝜂</ci><max id="S5.SS3.p6.3.m3.1.1.3.cmml" xref="S5.SS3.p6.3.m3.1.1.3"></max></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p6.3.m3.1c">\eta_{\max}</annotation></semantics></math> to avoid it becoming too large or too small.
If a gradient was zero, a local optimum for this weight was found and the step
size is not changed.</p>
</div>
<div id="S5.SS3.p7" class="ltx_para">
<p id="S5.SS3.p7.1" class="ltx_p">There are well-known hyperparameters that tend to work well for Rprop <cite class="ltx_cite ltx_citemacro_citep">(Igel and
Hüsken, <a href="#bib.bib13" title="" class="ltx_ref">2003</a>)</cite> and we validated those using simulations.
Rprop turned out to be a great choice for us for multiple reasons.
In contrast to Adam and most other gradient descent variants, it completely ignores the gradient magnitude.
It can thus deal with any data we might see after deploying our system.
Furthermore, it adapts learning rates dynamically for each weight individually, rendering the initial choice to not be that important.
A third reason is that the updates from Rprop are very interpretable and we can ensure that each iteration of optimization can only change frecency scores by a few points.</p>
</div>
<div id="S5.SS3.p8" class="ltx_para">
<p id="S5.SS3.p8.1" class="ltx_p">To get an additional compression advantage out of Rprop, it can be adapted to only use the signs of the gradient from each client.
Rather than computing the sign of the sum of gradients in Equation <a href="#S5.E1" title="In 5.3. Rprop ‣ 5. Optimization System Design ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>, one can take the most common sign in the set of received gradients.
If we ignore the unlikely case of having a gradient of 0 in Equation <a href="#S5.E2" title="In 5.3. Rprop ‣ 5. Optimization System Design ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>, which would correspond to a perfect local optimum, clients now only need to share a single bit for each weight.
If one does not want to ignore this third case, two bits are required.
This is a strong compression factor, considering that we otherwise need to transfer 32 or 64 bits for each weight.
Additionally, this can also provide a privacy advantage because clients now need to share even less information with the server.</p>
</div>
</section>
<section id="S5.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4. </span>Approximating Gradients</h3>

<div id="S5.SS4.p1" class="ltx_para">
<p id="S5.SS4.p1.1" class="ltx_p">Initially, we prototoyped our algorithms with computational graph libraries that can automatically compute gradients <cite class="ltx_cite ltx_citemacro_citep">(Abadi et al<span class="ltx_text">.</span>, <a href="#bib.bib2" title="" class="ltx_ref">2016a</a>; Paszke et al<span class="ltx_text">.</span>, <a href="#bib.bib24" title="" class="ltx_ref">2017</a>)</cite>.
However, it was difficult to add those to Firefox for our experiments.
The frecency algorithm is written in C++.
The corresponding modules are core to the browser and can only be changed if Firefox itself is updated.</p>
</div>
<div id="S5.SS4.p2" class="ltx_para">
<p id="S5.SS4.p2.1" class="ltx_p">To quickly prototype new ideas, Firefox has a separate mechanism for launching experiments, called <em id="S5.SS4.p2.1.1" class="ltx_emph ltx_font_italic">Shield</em> <cite class="ltx_cite ltx_citemacro_citep">(Network, <a href="#bib.bib23" title="" class="ltx_ref">2019d</a>)</cite>.
This system lets us dynamically ship code to clients, completely independently of other major releases, by limiting which modules can be changed.
Since we wanted to use Shield for quick prototyping, we could not adapt the code behind the frecency algorithm itself.
However, it was still possible to change the weights behind the algorithm.</p>
</div>
<div id="S5.SS4.p3" class="ltx_para ltx_noindent">
<p id="S5.SS4.p3.1" class="ltx_p">So instead of replacing the current implementation with a computational graph, we used a <em id="S5.SS4.p3.1.1" class="ltx_emph ltx_font_italic">finite-difference method</em> for approximating the gradients.
If <math id="S5.SS4.p3.1.m1.1" class="ltx_Math" alttext="g" display="inline"><semantics id="S5.SS4.p3.1.m1.1a"><mi id="S5.SS4.p3.1.m1.1.1" xref="S5.SS4.p3.1.m1.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p3.1.m1.1b"><ci id="S5.SS4.p3.1.m1.1.1.cmml" xref="S5.SS4.p3.1.m1.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p3.1.m1.1c">g</annotation></semantics></math> is any univariate function, its gradient can be approximated using:</p>
<table id="S5.Ex7" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S5.Ex7.m1.3" class="ltx_Math" alttext="g^{\prime}(x)\approx\frac{g(x+\epsilon)-g(x)}{\epsilon}" display="block"><semantics id="S5.Ex7.m1.3a"><mrow id="S5.Ex7.m1.3.4" xref="S5.Ex7.m1.3.4.cmml"><mrow id="S5.Ex7.m1.3.4.2" xref="S5.Ex7.m1.3.4.2.cmml"><msup id="S5.Ex7.m1.3.4.2.2" xref="S5.Ex7.m1.3.4.2.2.cmml"><mi id="S5.Ex7.m1.3.4.2.2.2" xref="S5.Ex7.m1.3.4.2.2.2.cmml">g</mi><mo id="S5.Ex7.m1.3.4.2.2.3" xref="S5.Ex7.m1.3.4.2.2.3.cmml">′</mo></msup><mo lspace="0em" rspace="0em" id="S5.Ex7.m1.3.4.2.1" xref="S5.Ex7.m1.3.4.2.1.cmml">​</mo><mrow id="S5.Ex7.m1.3.4.2.3.2" xref="S5.Ex7.m1.3.4.2.cmml"><mo stretchy="false" id="S5.Ex7.m1.3.4.2.3.2.1" xref="S5.Ex7.m1.3.4.2.cmml">(</mo><mi id="S5.Ex7.m1.3.3" xref="S5.Ex7.m1.3.3.cmml">x</mi><mo stretchy="false" id="S5.Ex7.m1.3.4.2.3.2.2" xref="S5.Ex7.m1.3.4.2.cmml">)</mo></mrow></mrow><mo id="S5.Ex7.m1.3.4.1" xref="S5.Ex7.m1.3.4.1.cmml">≈</mo><mfrac id="S5.Ex7.m1.2.2" xref="S5.Ex7.m1.2.2.cmml"><mrow id="S5.Ex7.m1.2.2.2" xref="S5.Ex7.m1.2.2.2.cmml"><mrow id="S5.Ex7.m1.2.2.2.2" xref="S5.Ex7.m1.2.2.2.2.cmml"><mi id="S5.Ex7.m1.2.2.2.2.3" xref="S5.Ex7.m1.2.2.2.2.3.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.Ex7.m1.2.2.2.2.2" xref="S5.Ex7.m1.2.2.2.2.2.cmml">​</mo><mrow id="S5.Ex7.m1.2.2.2.2.1.1" xref="S5.Ex7.m1.2.2.2.2.1.1.1.cmml"><mo stretchy="false" id="S5.Ex7.m1.2.2.2.2.1.1.2" xref="S5.Ex7.m1.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.Ex7.m1.2.2.2.2.1.1.1" xref="S5.Ex7.m1.2.2.2.2.1.1.1.cmml"><mi id="S5.Ex7.m1.2.2.2.2.1.1.1.2" xref="S5.Ex7.m1.2.2.2.2.1.1.1.2.cmml">x</mi><mo id="S5.Ex7.m1.2.2.2.2.1.1.1.1" xref="S5.Ex7.m1.2.2.2.2.1.1.1.1.cmml">+</mo><mi id="S5.Ex7.m1.2.2.2.2.1.1.1.3" xref="S5.Ex7.m1.2.2.2.2.1.1.1.3.cmml">ϵ</mi></mrow><mo stretchy="false" id="S5.Ex7.m1.2.2.2.2.1.1.3" xref="S5.Ex7.m1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S5.Ex7.m1.2.2.2.3" xref="S5.Ex7.m1.2.2.2.3.cmml">−</mo><mrow id="S5.Ex7.m1.2.2.2.4" xref="S5.Ex7.m1.2.2.2.4.cmml"><mi id="S5.Ex7.m1.2.2.2.4.2" xref="S5.Ex7.m1.2.2.2.4.2.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.Ex7.m1.2.2.2.4.1" xref="S5.Ex7.m1.2.2.2.4.1.cmml">​</mo><mrow id="S5.Ex7.m1.2.2.2.4.3.2" xref="S5.Ex7.m1.2.2.2.4.cmml"><mo stretchy="false" id="S5.Ex7.m1.2.2.2.4.3.2.1" xref="S5.Ex7.m1.2.2.2.4.cmml">(</mo><mi id="S5.Ex7.m1.1.1.1.1" xref="S5.Ex7.m1.1.1.1.1.cmml">x</mi><mo stretchy="false" id="S5.Ex7.m1.2.2.2.4.3.2.2" xref="S5.Ex7.m1.2.2.2.4.cmml">)</mo></mrow></mrow></mrow><mi id="S5.Ex7.m1.2.2.4" xref="S5.Ex7.m1.2.2.4.cmml">ϵ</mi></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S5.Ex7.m1.3b"><apply id="S5.Ex7.m1.3.4.cmml" xref="S5.Ex7.m1.3.4"><approx id="S5.Ex7.m1.3.4.1.cmml" xref="S5.Ex7.m1.3.4.1"></approx><apply id="S5.Ex7.m1.3.4.2.cmml" xref="S5.Ex7.m1.3.4.2"><times id="S5.Ex7.m1.3.4.2.1.cmml" xref="S5.Ex7.m1.3.4.2.1"></times><apply id="S5.Ex7.m1.3.4.2.2.cmml" xref="S5.Ex7.m1.3.4.2.2"><csymbol cd="ambiguous" id="S5.Ex7.m1.3.4.2.2.1.cmml" xref="S5.Ex7.m1.3.4.2.2">superscript</csymbol><ci id="S5.Ex7.m1.3.4.2.2.2.cmml" xref="S5.Ex7.m1.3.4.2.2.2">𝑔</ci><ci id="S5.Ex7.m1.3.4.2.2.3.cmml" xref="S5.Ex7.m1.3.4.2.2.3">′</ci></apply><ci id="S5.Ex7.m1.3.3.cmml" xref="S5.Ex7.m1.3.3">𝑥</ci></apply><apply id="S5.Ex7.m1.2.2.cmml" xref="S5.Ex7.m1.2.2"><divide id="S5.Ex7.m1.2.2.3.cmml" xref="S5.Ex7.m1.2.2"></divide><apply id="S5.Ex7.m1.2.2.2.cmml" xref="S5.Ex7.m1.2.2.2"><minus id="S5.Ex7.m1.2.2.2.3.cmml" xref="S5.Ex7.m1.2.2.2.3"></minus><apply id="S5.Ex7.m1.2.2.2.2.cmml" xref="S5.Ex7.m1.2.2.2.2"><times id="S5.Ex7.m1.2.2.2.2.2.cmml" xref="S5.Ex7.m1.2.2.2.2.2"></times><ci id="S5.Ex7.m1.2.2.2.2.3.cmml" xref="S5.Ex7.m1.2.2.2.2.3">𝑔</ci><apply id="S5.Ex7.m1.2.2.2.2.1.1.1.cmml" xref="S5.Ex7.m1.2.2.2.2.1.1"><plus id="S5.Ex7.m1.2.2.2.2.1.1.1.1.cmml" xref="S5.Ex7.m1.2.2.2.2.1.1.1.1"></plus><ci id="S5.Ex7.m1.2.2.2.2.1.1.1.2.cmml" xref="S5.Ex7.m1.2.2.2.2.1.1.1.2">𝑥</ci><ci id="S5.Ex7.m1.2.2.2.2.1.1.1.3.cmml" xref="S5.Ex7.m1.2.2.2.2.1.1.1.3">italic-ϵ</ci></apply></apply><apply id="S5.Ex7.m1.2.2.2.4.cmml" xref="S5.Ex7.m1.2.2.2.4"><times id="S5.Ex7.m1.2.2.2.4.1.cmml" xref="S5.Ex7.m1.2.2.2.4.1"></times><ci id="S5.Ex7.m1.2.2.2.4.2.cmml" xref="S5.Ex7.m1.2.2.2.4.2">𝑔</ci><ci id="S5.Ex7.m1.1.1.1.1.cmml" xref="S5.Ex7.m1.1.1.1.1">𝑥</ci></apply></apply><ci id="S5.Ex7.m1.2.2.4.cmml" xref="S5.Ex7.m1.2.2.4">italic-ϵ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.Ex7.m1.3c">g^{\prime}(x)\approx\frac{g(x+\epsilon)-g(x)}{\epsilon}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S5.SS4.p3.3" class="ltx_p">where <math id="S5.SS4.p3.2.m1.1" class="ltx_Math" alttext="\epsilon&gt;0" display="inline"><semantics id="S5.SS4.p3.2.m1.1a"><mrow id="S5.SS4.p3.2.m1.1.1" xref="S5.SS4.p3.2.m1.1.1.cmml"><mi id="S5.SS4.p3.2.m1.1.1.2" xref="S5.SS4.p3.2.m1.1.1.2.cmml">ϵ</mi><mo id="S5.SS4.p3.2.m1.1.1.1" xref="S5.SS4.p3.2.m1.1.1.1.cmml">&gt;</mo><mn id="S5.SS4.p3.2.m1.1.1.3" xref="S5.SS4.p3.2.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p3.2.m1.1b"><apply id="S5.SS4.p3.2.m1.1.1.cmml" xref="S5.SS4.p3.2.m1.1.1"><gt id="S5.SS4.p3.2.m1.1.1.1.cmml" xref="S5.SS4.p3.2.m1.1.1.1"></gt><ci id="S5.SS4.p3.2.m1.1.1.2.cmml" xref="S5.SS4.p3.2.m1.1.1.2">italic-ϵ</ci><cn type="integer" id="S5.SS4.p3.2.m1.1.1.3.cmml" xref="S5.SS4.p3.2.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p3.2.m1.1c">\epsilon&gt;0</annotation></semantics></math> is a very small number.
To compute the gradient of a multivariate function, such as the SVM loss based on frecency, this process is then performed by iterating through all dimensions.
In each dimension, the value is changed by <math id="S5.SS4.p3.3.m2.1" class="ltx_Math" alttext="\epsilon" display="inline"><semantics id="S5.SS4.p3.3.m2.1a"><mi id="S5.SS4.p3.3.m2.1.1" xref="S5.SS4.p3.3.m2.1.1.cmml">ϵ</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p3.3.m2.1b"><ci id="S5.SS4.p3.3.m2.1.1.cmml" xref="S5.SS4.p3.3.m2.1.1">italic-ϵ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p3.3.m2.1c">\epsilon</annotation></semantics></math> in the two directions, while all other values stay constant.
The resulting vector is our gradient estimate.</p>
</div>
<div id="S5.SS4.p4" class="ltx_para">
<p id="S5.SS4.p4.1" class="ltx_p">Because <math id="S5.SS4.p4.1.m1.1" class="ltx_Math" alttext="\epsilon" display="inline"><semantics id="S5.SS4.p4.1.m1.1a"><mi id="S5.SS4.p4.1.m1.1.1" xref="S5.SS4.p4.1.m1.1.1.cmml">ϵ</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p4.1.m1.1b"><ci id="S5.SS4.p4.1.m1.1.1.cmml" xref="S5.SS4.p4.1.m1.1.1">italic-ϵ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p4.1.m1.1c">\epsilon</annotation></semantics></math> needs to be a small value for the approximation to be good, this formula inherently has problems with numerical stability.
To improve on this, we used an alternative that has previously been proposed for better stability <cite class="ltx_cite ltx_citemacro_citep">(Baydin et al<span class="ltx_text">.</span>, <a href="#bib.bib4" title="" class="ltx_ref">2018</a>)</cite>:</p>
<table id="S5.Ex8" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S5.Ex8.m1.3" class="ltx_Math" alttext="g^{\prime}(x)\approx\frac{g(x+\epsilon)-g(x-\epsilon)}{2*\epsilon}" display="block"><semantics id="S5.Ex8.m1.3a"><mrow id="S5.Ex8.m1.3.4" xref="S5.Ex8.m1.3.4.cmml"><mrow id="S5.Ex8.m1.3.4.2" xref="S5.Ex8.m1.3.4.2.cmml"><msup id="S5.Ex8.m1.3.4.2.2" xref="S5.Ex8.m1.3.4.2.2.cmml"><mi id="S5.Ex8.m1.3.4.2.2.2" xref="S5.Ex8.m1.3.4.2.2.2.cmml">g</mi><mo id="S5.Ex8.m1.3.4.2.2.3" xref="S5.Ex8.m1.3.4.2.2.3.cmml">′</mo></msup><mo lspace="0em" rspace="0em" id="S5.Ex8.m1.3.4.2.1" xref="S5.Ex8.m1.3.4.2.1.cmml">​</mo><mrow id="S5.Ex8.m1.3.4.2.3.2" xref="S5.Ex8.m1.3.4.2.cmml"><mo stretchy="false" id="S5.Ex8.m1.3.4.2.3.2.1" xref="S5.Ex8.m1.3.4.2.cmml">(</mo><mi id="S5.Ex8.m1.3.3" xref="S5.Ex8.m1.3.3.cmml">x</mi><mo stretchy="false" id="S5.Ex8.m1.3.4.2.3.2.2" xref="S5.Ex8.m1.3.4.2.cmml">)</mo></mrow></mrow><mo id="S5.Ex8.m1.3.4.1" xref="S5.Ex8.m1.3.4.1.cmml">≈</mo><mfrac id="S5.Ex8.m1.2.2" xref="S5.Ex8.m1.2.2.cmml"><mrow id="S5.Ex8.m1.2.2.2" xref="S5.Ex8.m1.2.2.2.cmml"><mrow id="S5.Ex8.m1.1.1.1.1" xref="S5.Ex8.m1.1.1.1.1.cmml"><mi id="S5.Ex8.m1.1.1.1.1.3" xref="S5.Ex8.m1.1.1.1.1.3.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.Ex8.m1.1.1.1.1.2" xref="S5.Ex8.m1.1.1.1.1.2.cmml">​</mo><mrow id="S5.Ex8.m1.1.1.1.1.1.1" xref="S5.Ex8.m1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.Ex8.m1.1.1.1.1.1.1.2" xref="S5.Ex8.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.Ex8.m1.1.1.1.1.1.1.1" xref="S5.Ex8.m1.1.1.1.1.1.1.1.cmml"><mi id="S5.Ex8.m1.1.1.1.1.1.1.1.2" xref="S5.Ex8.m1.1.1.1.1.1.1.1.2.cmml">x</mi><mo id="S5.Ex8.m1.1.1.1.1.1.1.1.1" xref="S5.Ex8.m1.1.1.1.1.1.1.1.1.cmml">+</mo><mi id="S5.Ex8.m1.1.1.1.1.1.1.1.3" xref="S5.Ex8.m1.1.1.1.1.1.1.1.3.cmml">ϵ</mi></mrow><mo stretchy="false" id="S5.Ex8.m1.1.1.1.1.1.1.3" xref="S5.Ex8.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S5.Ex8.m1.2.2.2.3" xref="S5.Ex8.m1.2.2.2.3.cmml">−</mo><mrow id="S5.Ex8.m1.2.2.2.2" xref="S5.Ex8.m1.2.2.2.2.cmml"><mi id="S5.Ex8.m1.2.2.2.2.3" xref="S5.Ex8.m1.2.2.2.2.3.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.Ex8.m1.2.2.2.2.2" xref="S5.Ex8.m1.2.2.2.2.2.cmml">​</mo><mrow id="S5.Ex8.m1.2.2.2.2.1.1" xref="S5.Ex8.m1.2.2.2.2.1.1.1.cmml"><mo stretchy="false" id="S5.Ex8.m1.2.2.2.2.1.1.2" xref="S5.Ex8.m1.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.Ex8.m1.2.2.2.2.1.1.1" xref="S5.Ex8.m1.2.2.2.2.1.1.1.cmml"><mi id="S5.Ex8.m1.2.2.2.2.1.1.1.2" xref="S5.Ex8.m1.2.2.2.2.1.1.1.2.cmml">x</mi><mo id="S5.Ex8.m1.2.2.2.2.1.1.1.1" xref="S5.Ex8.m1.2.2.2.2.1.1.1.1.cmml">−</mo><mi id="S5.Ex8.m1.2.2.2.2.1.1.1.3" xref="S5.Ex8.m1.2.2.2.2.1.1.1.3.cmml">ϵ</mi></mrow><mo stretchy="false" id="S5.Ex8.m1.2.2.2.2.1.1.3" xref="S5.Ex8.m1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mrow id="S5.Ex8.m1.2.2.4" xref="S5.Ex8.m1.2.2.4.cmml"><mn id="S5.Ex8.m1.2.2.4.2" xref="S5.Ex8.m1.2.2.4.2.cmml">2</mn><mo lspace="0.222em" rspace="0.222em" id="S5.Ex8.m1.2.2.4.1" xref="S5.Ex8.m1.2.2.4.1.cmml">∗</mo><mi id="S5.Ex8.m1.2.2.4.3" xref="S5.Ex8.m1.2.2.4.3.cmml">ϵ</mi></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S5.Ex8.m1.3b"><apply id="S5.Ex8.m1.3.4.cmml" xref="S5.Ex8.m1.3.4"><approx id="S5.Ex8.m1.3.4.1.cmml" xref="S5.Ex8.m1.3.4.1"></approx><apply id="S5.Ex8.m1.3.4.2.cmml" xref="S5.Ex8.m1.3.4.2"><times id="S5.Ex8.m1.3.4.2.1.cmml" xref="S5.Ex8.m1.3.4.2.1"></times><apply id="S5.Ex8.m1.3.4.2.2.cmml" xref="S5.Ex8.m1.3.4.2.2"><csymbol cd="ambiguous" id="S5.Ex8.m1.3.4.2.2.1.cmml" xref="S5.Ex8.m1.3.4.2.2">superscript</csymbol><ci id="S5.Ex8.m1.3.4.2.2.2.cmml" xref="S5.Ex8.m1.3.4.2.2.2">𝑔</ci><ci id="S5.Ex8.m1.3.4.2.2.3.cmml" xref="S5.Ex8.m1.3.4.2.2.3">′</ci></apply><ci id="S5.Ex8.m1.3.3.cmml" xref="S5.Ex8.m1.3.3">𝑥</ci></apply><apply id="S5.Ex8.m1.2.2.cmml" xref="S5.Ex8.m1.2.2"><divide id="S5.Ex8.m1.2.2.3.cmml" xref="S5.Ex8.m1.2.2"></divide><apply id="S5.Ex8.m1.2.2.2.cmml" xref="S5.Ex8.m1.2.2.2"><minus id="S5.Ex8.m1.2.2.2.3.cmml" xref="S5.Ex8.m1.2.2.2.3"></minus><apply id="S5.Ex8.m1.1.1.1.1.cmml" xref="S5.Ex8.m1.1.1.1.1"><times id="S5.Ex8.m1.1.1.1.1.2.cmml" xref="S5.Ex8.m1.1.1.1.1.2"></times><ci id="S5.Ex8.m1.1.1.1.1.3.cmml" xref="S5.Ex8.m1.1.1.1.1.3">𝑔</ci><apply id="S5.Ex8.m1.1.1.1.1.1.1.1.cmml" xref="S5.Ex8.m1.1.1.1.1.1.1"><plus id="S5.Ex8.m1.1.1.1.1.1.1.1.1.cmml" xref="S5.Ex8.m1.1.1.1.1.1.1.1.1"></plus><ci id="S5.Ex8.m1.1.1.1.1.1.1.1.2.cmml" xref="S5.Ex8.m1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S5.Ex8.m1.1.1.1.1.1.1.1.3.cmml" xref="S5.Ex8.m1.1.1.1.1.1.1.1.3">italic-ϵ</ci></apply></apply><apply id="S5.Ex8.m1.2.2.2.2.cmml" xref="S5.Ex8.m1.2.2.2.2"><times id="S5.Ex8.m1.2.2.2.2.2.cmml" xref="S5.Ex8.m1.2.2.2.2.2"></times><ci id="S5.Ex8.m1.2.2.2.2.3.cmml" xref="S5.Ex8.m1.2.2.2.2.3">𝑔</ci><apply id="S5.Ex8.m1.2.2.2.2.1.1.1.cmml" xref="S5.Ex8.m1.2.2.2.2.1.1"><minus id="S5.Ex8.m1.2.2.2.2.1.1.1.1.cmml" xref="S5.Ex8.m1.2.2.2.2.1.1.1.1"></minus><ci id="S5.Ex8.m1.2.2.2.2.1.1.1.2.cmml" xref="S5.Ex8.m1.2.2.2.2.1.1.1.2">𝑥</ci><ci id="S5.Ex8.m1.2.2.2.2.1.1.1.3.cmml" xref="S5.Ex8.m1.2.2.2.2.1.1.1.3">italic-ϵ</ci></apply></apply></apply><apply id="S5.Ex8.m1.2.2.4.cmml" xref="S5.Ex8.m1.2.2.4"><times id="S5.Ex8.m1.2.2.4.1.cmml" xref="S5.Ex8.m1.2.2.4.1"></times><cn type="integer" id="S5.Ex8.m1.2.2.4.2.cmml" xref="S5.Ex8.m1.2.2.4.2">2</cn><ci id="S5.Ex8.m1.2.2.4.3.cmml" xref="S5.Ex8.m1.2.2.4.3">italic-ϵ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.Ex8.m1.3c">g^{\prime}(x)\approx\frac{g(x+\epsilon)-g(x-\epsilon)}{2*\epsilon}</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S5.SS4.p5" class="ltx_para">
<p id="S5.SS4.p5.1" class="ltx_p">It is worth noting that this numerical way of approximating gradients scales badly with the number of weights.
Instead of one forward pass in total to compute the gradient, we now need one forward pass per weight.
In our case, this was not a problem because there were comparatively few weights.
For neural networks with millions of parameters this would not be the case.
</p>
</div>
<div id="S5.SS4.p6" class="ltx_para">
<p id="S5.SS4.p6.1" class="ltx_p">Still, this approach saved us a lot of engineering time, while only adding a very small performance penalty.
We did not have to rewrite any C++ code, and could treat the existing implementation as a black box.
It also makes our system generally applicable since anything in Firefox that has configurable weights can now be optimized.</p>
</div>
</section>
<section id="S5.SS5" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.5. </span>General Protocol and Server Side</h3>

<div id="S5.SS5.p1" class="ltx_para">
<p id="S5.SS5.p1.1" class="ltx_p">The server provides clients with a model file.
Clients fetch the current model when the browser is first opened as well as every time a new gradient descent iteration is completed.
This happens every 30 minutes and is triggered by the server.</p>
</div>
<div id="S5.SS5.p2" class="ltx_para">
<p id="S5.SS5.p2.1" class="ltx_p">Every time a user participating in the optimization performs a history or bookmark search in the URL bar, a gradient is computed.
This gradient is pushed to a Mozilla server using the Firefox Telemetry system <cite class="ltx_cite ltx_citemacro_citep">(Network, <a href="#bib.bib21" title="" class="ltx_ref">2019b</a>)</cite>, which has several advantages.
It is a well-designed system with clear rules about what can be collected.
There is a lot of infrastructure around using it and dealing with the data on the server.</p>
</div>
<div id="S5.SS5.p3" class="ltx_para">
<p id="S5.SS5.p3.1" class="ltx_p">All messages sent by clients are stored in a Parquet <cite class="ltx_cite ltx_citemacro_citep">(Foundation, <a href="#bib.bib9" title="" class="ltx_ref">2019</a>)</cite> data store.
A Spark streaming job <cite class="ltx_cite ltx_citemacro_citep">(Zaharia et al<span class="ltx_text">.</span>, <a href="#bib.bib28" title="" class="ltx_ref">2010</a>)</cite> reads the new updates from clients and averages them in real-time.
Every 30 minutes, the average update is then given to the optimizer, and applied to the model.
The resulting model is published and fetched by clients.</p>
</div>
<div id="S5.SS5.p4" class="ltx_para">
<p id="S5.SS5.p4.1" class="ltx_p">We store all gradient updates on the server for later analysis.
For a proven production system this is not strictly necessary.
The system could also work by adding gradients to the current average after which they are directly discarded.</p>
</div>
</section>
<section id="S5.SS6" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.6. </span>Safeguards</h3>

<div id="S5.SS6.p1" class="ltx_para">
<p id="S5.SS6.p1.1" class="ltx_p">The model that we are training is being used by the URL bar at the very same time as we are optimizing it.
Thus, it was important to make sure that the experiment does not degrade the quality of the URL bar too much if the optimization process fails.
To keep this from happening, we carefully configured Rprop and implemented several safeguards on top of it.</p>
</div>
<div id="S5.SS6.p2" class="ltx_para">
<p id="S5.SS6.p2.1" class="ltx_p">First of all, we initialize our model with the weights that the traditional frecency algorithm used.
This replicates the previous ranking behavior perfectly.
The optimization process thus starts off with a decent initial model.</p>
</div>
<div id="S5.SS6.p3" class="ltx_para">
<p id="S5.SS6.p3.1" class="ltx_p">To gradually improve on this initial solution, updates are bounded so that the model slowly converges to an optimum.
We wanted to avoid huge model changes to make it unlikely to jump far over an optimum.
Because our weights are intepretable, we can understand by how much updates can change frecency scores in one iteration, and limit this to a reasonable value.
In conjunction with the smart initialization, this ensures that our optimization process gradually improves the traditional frecency weights.
</p>
</div>
<div id="S5.SS6.p4" class="ltx_para">
<p id="S5.SS6.p4.1" class="ltx_p">Since the weights of the frecency algorithm have a clear meaning, we were able to implement several additional constraints.
Recent visits should always be weighted higher than old ones.
To enforce this, the value of each time bucket weight is bounded to be smaller than the values of newer time buckets.
Finally, we force all weights to be nonnegative to ensure that visits can never be worth a negative number of points.</p>
</div>
<div id="S5.SS6.p5" class="ltx_para">
<p id="S5.SS6.p5.1" class="ltx_p">The exact safeguards we implemented for our system are highly domain-specific.
However, we expect that other domains should have similar constraints.
Bounding update size is a good idea, even if it is harder to interpret what exactly the weights represent.
Starting off from a decent initial model also helps to ensure that users do not interact with a bad model during the first few iterations of training.</p>
</div>
</section>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Experiment</h2>

<section id="S6.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1. </span>Simulations</h3>

<div id="S6.SS1.p1" class="ltx_para">
<p id="S6.SS1.p1.1" class="ltx_p">To prototype whether our ideas for optimizing the frecency weights could work, and to quickly iterate on them, a simulation was created before developing the actual system for Firefox <cite class="ltx_cite ltx_citemacro_citep">(Hartmann, <a href="#bib.bib12" title="" class="ltx_ref">2018b</a>)</cite>.
This made it possible to simulate an entire Federated Learning optimization process in little time, without having to wait for code to be deployed to actual clients.
Much of the code that we wrote for the simulation ended up being reused in Firefox <cite class="ltx_cite ltx_citemacro_citep">(Hartmann, <a href="#bib.bib11" title="" class="ltx_ref">2018a</a>)</cite>.</p>
</div>
<div id="S6.SS1.p2" class="ltx_para">
<p id="S6.SS1.p2.1" class="ltx_p">The only major part that differs between the simulation and the actual implementation is what data is used for training.
Since no data should be collected, the simulation could not be based on real data from users.
Instead, a mock dataset was created.
This dataset was designed to resemble the data we expected users to generate.</p>
</div>
<div id="S6.SS1.p3" class="ltx_para">
<p id="S6.SS1.p3.1" class="ltx_p">Since there was no way of knowing how the data is actually distributed, several assumptions had to be made.
We modeled how recently websites were visited using a made-up distribution that was skewed towards more recent visits.
To decide on how many pages were bookmarked, we used existing statistics.</p>
</div>
<div id="S6.SS1.p4" class="ltx_para">
<p id="S6.SS1.p4.1" class="ltx_p">The frequency in which websites are visited is modeled using an exponential distribution with <math id="S6.SS1.p4.1.m1.1" class="ltx_Math" alttext="\lambda=7" display="inline"><semantics id="S6.SS1.p4.1.m1.1a"><mrow id="S6.SS1.p4.1.m1.1.1" xref="S6.SS1.p4.1.m1.1.1.cmml"><mi id="S6.SS1.p4.1.m1.1.1.2" xref="S6.SS1.p4.1.m1.1.1.2.cmml">λ</mi><mo id="S6.SS1.p4.1.m1.1.1.1" xref="S6.SS1.p4.1.m1.1.1.1.cmml">=</mo><mn id="S6.SS1.p4.1.m1.1.1.3" xref="S6.SS1.p4.1.m1.1.1.3.cmml">7</mn></mrow><annotation-xml encoding="MathML-Content" id="S6.SS1.p4.1.m1.1b"><apply id="S6.SS1.p4.1.m1.1.1.cmml" xref="S6.SS1.p4.1.m1.1.1"><eq id="S6.SS1.p4.1.m1.1.1.1.cmml" xref="S6.SS1.p4.1.m1.1.1.1"></eq><ci id="S6.SS1.p4.1.m1.1.1.2.cmml" xref="S6.SS1.p4.1.m1.1.1.2">𝜆</ci><cn type="integer" id="S6.SS1.p4.1.m1.1.1.3.cmml" xref="S6.SS1.p4.1.m1.1.1.3">7</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p4.1.m1.1c">\lambda=7</annotation></semantics></math>.
This distribution mirrors the assumption that there are many websites that are only visited few times and few websites that are visited a lot.
For simplicity’s sake, recency, type, and frequency were assumed to be independent of each other.</p>
</div>
<div id="S6.SS1.p5" class="ltx_para">
<p id="S6.SS1.p5.1" class="ltx_p">To model what suggestion a user clicks on, the existing frecency algorithm is used to compute a score for each suggestion.
Random noise, sampled from a normal distribution with <math id="S6.SS1.p5.1.m1.2" class="ltx_Math" alttext="\mu=0,\sigma^{2}=30" display="inline"><semantics id="S6.SS1.p5.1.m1.2a"><mrow id="S6.SS1.p5.1.m1.2.2.2" xref="S6.SS1.p5.1.m1.2.2.3.cmml"><mrow id="S6.SS1.p5.1.m1.1.1.1.1" xref="S6.SS1.p5.1.m1.1.1.1.1.cmml"><mi id="S6.SS1.p5.1.m1.1.1.1.1.2" xref="S6.SS1.p5.1.m1.1.1.1.1.2.cmml">μ</mi><mo id="S6.SS1.p5.1.m1.1.1.1.1.1" xref="S6.SS1.p5.1.m1.1.1.1.1.1.cmml">=</mo><mn id="S6.SS1.p5.1.m1.1.1.1.1.3" xref="S6.SS1.p5.1.m1.1.1.1.1.3.cmml">0</mn></mrow><mo id="S6.SS1.p5.1.m1.2.2.2.3" xref="S6.SS1.p5.1.m1.2.2.3a.cmml">,</mo><mrow id="S6.SS1.p5.1.m1.2.2.2.2" xref="S6.SS1.p5.1.m1.2.2.2.2.cmml"><msup id="S6.SS1.p5.1.m1.2.2.2.2.2" xref="S6.SS1.p5.1.m1.2.2.2.2.2.cmml"><mi id="S6.SS1.p5.1.m1.2.2.2.2.2.2" xref="S6.SS1.p5.1.m1.2.2.2.2.2.2.cmml">σ</mi><mn id="S6.SS1.p5.1.m1.2.2.2.2.2.3" xref="S6.SS1.p5.1.m1.2.2.2.2.2.3.cmml">2</mn></msup><mo id="S6.SS1.p5.1.m1.2.2.2.2.1" xref="S6.SS1.p5.1.m1.2.2.2.2.1.cmml">=</mo><mn id="S6.SS1.p5.1.m1.2.2.2.2.3" xref="S6.SS1.p5.1.m1.2.2.2.2.3.cmml">30</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS1.p5.1.m1.2b"><apply id="S6.SS1.p5.1.m1.2.2.3.cmml" xref="S6.SS1.p5.1.m1.2.2.2"><csymbol cd="ambiguous" id="S6.SS1.p5.1.m1.2.2.3a.cmml" xref="S6.SS1.p5.1.m1.2.2.2.3">formulae-sequence</csymbol><apply id="S6.SS1.p5.1.m1.1.1.1.1.cmml" xref="S6.SS1.p5.1.m1.1.1.1.1"><eq id="S6.SS1.p5.1.m1.1.1.1.1.1.cmml" xref="S6.SS1.p5.1.m1.1.1.1.1.1"></eq><ci id="S6.SS1.p5.1.m1.1.1.1.1.2.cmml" xref="S6.SS1.p5.1.m1.1.1.1.1.2">𝜇</ci><cn type="integer" id="S6.SS1.p5.1.m1.1.1.1.1.3.cmml" xref="S6.SS1.p5.1.m1.1.1.1.1.3">0</cn></apply><apply id="S6.SS1.p5.1.m1.2.2.2.2.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2"><eq id="S6.SS1.p5.1.m1.2.2.2.2.1.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.1"></eq><apply id="S6.SS1.p5.1.m1.2.2.2.2.2.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S6.SS1.p5.1.m1.2.2.2.2.2.1.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.2">superscript</csymbol><ci id="S6.SS1.p5.1.m1.2.2.2.2.2.2.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.2.2">𝜎</ci><cn type="integer" id="S6.SS1.p5.1.m1.2.2.2.2.2.3.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.2.3">2</cn></apply><cn type="integer" id="S6.SS1.p5.1.m1.2.2.2.2.3.cmml" xref="S6.SS1.p5.1.m1.2.2.2.2.3">30</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p5.1.m1.2c">\mu=0,\sigma^{2}=30</annotation></semantics></math>, is then added to the score.
The dataset assumes that the suggestion with the highest score is selected.
By using the existing frecency algorithm with some noise, it is easy to see whether the simulation finds useful weights, as they should be similar to the ones of the current algorithm.</p>
</div>
<div id="S6.SS1.p6" class="ltx_para">
<p id="S6.SS1.p6.1" class="ltx_p">It is worth noting that this dataset is likely to differ substantially from the data generated by real users.
It is difficult to perfectly describe how the data looks like without having seen any of it.
Still, creating the dataset allowed for quick prototyping, which made it much easier to make many design decisions.
We implemented variations of the optimization algorithms described in the previous section, and tested their properties using our simulations.
When the Firefox client-side and server-side implementations were ready, we used data from the simulation to test our final system end-to-end.
</p>
</div>
</section>
<section id="S6.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2. </span>Study Design</h3>

<div id="S6.SS2.p1" class="ltx_para">
<p id="S6.SS2.p1.1" class="ltx_p">After developing the Firefox client and server components of our system, 25% of Firefox Beta users were enrolled in the experiment, which corresponds to roughly 500,000 daily active users.
Since it takes some time to roll out updates, only a part of the users was enrolled in the study before the optimization process was completed.</p>
</div>
<div id="S6.SS2.p2" class="ltx_para">
<p id="S6.SS2.p2.1" class="ltx_p">Users were partitioned into three groups:</p>
<ol id="S6.I1" class="ltx_enumerate">
<li id="S6.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span> 
<div id="S6.I1.i1.p1" class="ltx_para">
<p id="S6.I1.i1.p1.1" class="ltx_p"><em id="S6.I1.i1.p1.1.1" class="ltx_emph ltx_font_italic">treatment</em>: The full study was shipped to these users. They compute updates, send them to the server, and start using a new model every 30 minutes.</p>
</div>
</li>
<li id="S6.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span> 
<div id="S6.I1.i2.p1" class="ltx_para">
<p id="S6.I1.i2.p1.1" class="ltx_p"><em id="S6.I1.i2.p1.1.1" class="ltx_emph ltx_font_italic">control</em>: This group is solely observational. No behavior in the URL bar actually changes. We are just collecting statistics for comparison to treatment.</p>
</div>
</li>
<li id="S6.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(3)</span> 
<div id="S6.I1.i3.p1" class="ltx_para">
<p id="S6.I1.i3.p1.1" class="ltx_p"><em id="S6.I1.i3.p1.1.1" class="ltx_emph ltx_font_italic">control-no-decay</em>: Firefox decays frecency scores over time. Our treatment group loses this effect because we are recomputing scores every 30 minutes. To check if the decay is actually useful, this group has no decay effect but uses the same original algorithm otherwise.</p>
</div>
</li>
</ol>
<p id="S6.SS2.p2.2" class="ltx_p">60% of users were assigned to the treatment group and 20% to both control groups respectively.</p>
</div>
<div id="S6.SS2.p3" class="ltx_para">
<p id="S6.SS2.p3.1" class="ltx_p">To decide on these numbers, we performed a power analysis and used results from our simulation.
We carefully chose the number of people that should participate in the experiment for two reasons.
For one, if our study enrolls most Firefox users, we would block other studies that want to experiment with changes in the URL bar.
Another reason is that the experiment might break parts of Firefox.
If this happens, it should not affect unnecessarily many people.
</p>
</div>
<div id="S6.SS2.p4" class="ltx_para">
<p id="S6.SS2.p4.1" class="ltx_p">Concretely, our analysis consisted of two parts:</p>
<ol id="S6.I2" class="ltx_enumerate">
<li id="S6.I2.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span> 
<div id="S6.I2.i1.p1" class="ltx_para">
<p id="S6.I2.i1.p1.1" class="ltx_p">How many users do we need to have enough data to train a model? (relevant for treatment)</p>
</div>
</li>
<li id="S6.I2.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span> 
<div id="S6.I2.i2.p1" class="ltx_para">
<p id="S6.I2.i2.p1.1" class="ltx_p">How many users do we need to show certain effects confidently? (relevant for treatment and control)</p>
</div>
</li>
</ol>
</div>
<div id="S6.SS2.p5" class="ltx_para">
<p id="S6.SS2.p5.1" class="ltx_p">The first part was answered using simulations.
By using an adapted form of the simulation we used to decide on optimization hyperparameters, we could get some idea on how many users we would need.
Existing Telemetry data was helpful for this, as it allowed us to get some idea of how many history searches people perform every day <cite class="ltx_cite ltx_citemacro_citep">(Telemetry, <a href="#bib.bib27" title="" class="ltx_ref">2019</a>)</cite>.
The second part of the power analysis was tackled using classical hypothesis testing, based on the <span id="S6.SS2.p5.1.1" class="ltx_text"><em id="S6.SS2.p5.1.1.1" class="ltx_emph ltx_font_italic">Mann-Whitney-U test</em></span>.
This analysis concluded that the control groups required fewer users than the treatment group.</p>
</div>
<div id="S6.SS2.p6" class="ltx_para">
<p id="S6.SS2.p6.1" class="ltx_p">To be able to evaluate how well our new model worked after the optimization converged, we also collected two metrics:</p>
<ol id="S6.I3" class="ltx_enumerate">
<li id="S6.I3.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span> 
<div id="S6.I3.i1.p1" class="ltx_para">
<p id="S6.I3.i1.p1.1" class="ltx_p">The number of characters typed before selecting a result: Users should have to type few characters to find what they are looking for.</p>
</div>
</li>
<li id="S6.I3.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span> 
<div id="S6.I3.i2.p1" class="ltx_para">
<p id="S6.I3.i2.p1.1" class="ltx_p">The rank of the suggestion that was selected: The item that is selected should be as far on top as possible.</p>
</div>
</li>
</ol>
<p id="S6.SS2.p6.2" class="ltx_p">Clients shared these two metrics with the server by sending them jointly with gradients.</p>
</div>
</section>
<section id="S6.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.3. </span>Analyzing the Results</h3>

<div id="S6.SS3.p1" class="ltx_para">
<p id="S6.SS3.p1.1" class="ltx_p">Over the course of the experiment, 723,581 users were enrolled in the study.
The model was fetched 58,399,063 times from the server.
360,518 users participated in sending updates and evaluation data to the server, accounting for a total of 5,748,814 messages.
The optimization phase of the experiment consisted of 137 iterations of 30 minutes each, or just under three days.
In this phase, 186,315 users sent pings to help in the training process.</p>
</div>
<div id="S6.SS3.p2" class="ltx_para">
<p id="S6.SS3.p2.1" class="ltx_p">A separate phase of purely evaluating the model was started afterwards and took a total of 10 days.
In this phase, 306,200 users sent 3,674,063 pings, which included statistics detailing how well the model worked for them.
Since all these users were assigned to treatment or control groups, the new model can be compared well to the old one that was used by the control groups.
Some users were enrolled but did not help with optimization or evaluation because they performed no history and bookmark searches.</p>
</div>
<div id="S6.SS3.p3" class="ltx_para">
<p id="S6.SS3.p3.1" class="ltx_p">During the optimization process, the loss of the model was supervised to check how well the training was going.
Figure <a href="#S6.F4" title="Figure 4 ‣ 6.3. Analyzing the Results ‣ 6. Experiment ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a> shows how the loss changed over time, across all three study variations.
There is some noise in this plot, since each iteration only had a very limited number of users.
However, it can still be seen that the loss of the treatment group continues to decline over the course of the experiment.
This shows that the optimization process generally worked.
After 40 iterations, less than one day of optimization, the loss of the treatment group is clearly below the loss of the control groups.</p>
</div>
<figure id="S6.F4" class="ltx_figure"><img src="/html/1911.11807/assets/loss-smooth5.png" id="S6.F4.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="346" height="144" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S6.F4.2.1.1" class="ltx_text" style="font-size:90%;">Figure 4</span>. </span><span id="S6.F4.3.2" class="ltx_text" style="font-size:90%;">Rolling average of reported validation loss over the last 5 iterations</span></figcaption>
</figure>
<div id="S6.SS3.p4" class="ltx_para">
<p id="S6.SS3.p4.2" class="ltx_p">After the optimization process ended, an evaluation phase began to determine how well the new model works.
This is equivalent to the testing phase in machine learning.
The model is evaluated on new data that was not used for training or validation.
Table <a href="#S6.F5" title="Figure 5 ‣ 6.3. Analyzing the Results ‣ 6. Experiment ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a> shows these results.
On average, users in the treatment group type about half a character less to find what they are looking for.
This is a strong improvement over both control groups.
However, users in the treatment group also choose suggestions that were ranked slightly worse.
Hypothesis testing determined that the changes in the treatment group were highly significant, with p-values being below <math id="S6.SS3.p4.1.m1.1" class="ltx_Math" alttext="10^{-75}" display="inline"><semantics id="S6.SS3.p4.1.m1.1a"><msup id="S6.SS3.p4.1.m1.1.1" xref="S6.SS3.p4.1.m1.1.1.cmml"><mn id="S6.SS3.p4.1.m1.1.1.2" xref="S6.SS3.p4.1.m1.1.1.2.cmml">10</mn><mrow id="S6.SS3.p4.1.m1.1.1.3" xref="S6.SS3.p4.1.m1.1.1.3.cmml"><mo id="S6.SS3.p4.1.m1.1.1.3a" xref="S6.SS3.p4.1.m1.1.1.3.cmml">−</mo><mn id="S6.SS3.p4.1.m1.1.1.3.2" xref="S6.SS3.p4.1.m1.1.1.3.2.cmml">75</mn></mrow></msup><annotation-xml encoding="MathML-Content" id="S6.SS3.p4.1.m1.1b"><apply id="S6.SS3.p4.1.m1.1.1.cmml" xref="S6.SS3.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S6.SS3.p4.1.m1.1.1.1.cmml" xref="S6.SS3.p4.1.m1.1.1">superscript</csymbol><cn type="integer" id="S6.SS3.p4.1.m1.1.1.2.cmml" xref="S6.SS3.p4.1.m1.1.1.2">10</cn><apply id="S6.SS3.p4.1.m1.1.1.3.cmml" xref="S6.SS3.p4.1.m1.1.1.3"><minus id="S6.SS3.p4.1.m1.1.1.3.1.cmml" xref="S6.SS3.p4.1.m1.1.1.3"></minus><cn type="integer" id="S6.SS3.p4.1.m1.1.1.3.2.cmml" xref="S6.SS3.p4.1.m1.1.1.3.2">75</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p4.1.m1.1c">10^{-75}</annotation></semantics></math>.
Because we compared results of several experiment branches, we used a Bonferroni-corrected significance level of <math id="S6.SS3.p4.2.m2.1" class="ltx_Math" alttext="\alpha=0.05/6" display="inline"><semantics id="S6.SS3.p4.2.m2.1a"><mrow id="S6.SS3.p4.2.m2.1.1" xref="S6.SS3.p4.2.m2.1.1.cmml"><mi id="S6.SS3.p4.2.m2.1.1.2" xref="S6.SS3.p4.2.m2.1.1.2.cmml">α</mi><mo id="S6.SS3.p4.2.m2.1.1.1" xref="S6.SS3.p4.2.m2.1.1.1.cmml">=</mo><mrow id="S6.SS3.p4.2.m2.1.1.3" xref="S6.SS3.p4.2.m2.1.1.3.cmml"><mn id="S6.SS3.p4.2.m2.1.1.3.2" xref="S6.SS3.p4.2.m2.1.1.3.2.cmml">0.05</mn><mo id="S6.SS3.p4.2.m2.1.1.3.1" xref="S6.SS3.p4.2.m2.1.1.3.1.cmml">/</mo><mn id="S6.SS3.p4.2.m2.1.1.3.3" xref="S6.SS3.p4.2.m2.1.1.3.3.cmml">6</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS3.p4.2.m2.1b"><apply id="S6.SS3.p4.2.m2.1.1.cmml" xref="S6.SS3.p4.2.m2.1.1"><eq id="S6.SS3.p4.2.m2.1.1.1.cmml" xref="S6.SS3.p4.2.m2.1.1.1"></eq><ci id="S6.SS3.p4.2.m2.1.1.2.cmml" xref="S6.SS3.p4.2.m2.1.1.2">𝛼</ci><apply id="S6.SS3.p4.2.m2.1.1.3.cmml" xref="S6.SS3.p4.2.m2.1.1.3"><divide id="S6.SS3.p4.2.m2.1.1.3.1.cmml" xref="S6.SS3.p4.2.m2.1.1.3.1"></divide><cn type="float" id="S6.SS3.p4.2.m2.1.1.3.2.cmml" xref="S6.SS3.p4.2.m2.1.1.3.2">0.05</cn><cn type="integer" id="S6.SS3.p4.2.m2.1.1.3.3.cmml" xref="S6.SS3.p4.2.m2.1.1.3.3">6</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p4.2.m2.1c">\alpha=0.05/6</annotation></semantics></math>.</p>
</div>
<figure id="S6.F5" class="ltx_figure">
<table id="S6.F5.2" class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S6.F5.2.1.1" class="ltx_tr">
<th id="S6.F5.2.1.1.1" class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_rr"></th>
<th id="S6.F5.2.1.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r"><span id="S6.F5.2.1.1.2.1" class="ltx_text ltx_font_bold">mean characters typed</span></th>
<th id="S6.F5.2.1.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column"><span id="S6.F5.2.1.1.3.1" class="ltx_text ltx_font_bold">mean rank chosen</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S6.F5.2.2.1" class="ltx_tr">
<th id="S6.F5.2.2.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_rr ltx_border_t">treatment</th>
<td id="S6.F5.2.2.1.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_t">3.6747</td>
<td id="S6.F5.2.2.1.3" class="ltx_td ltx_align_center ltx_border_t">0.37435</td>
</tr>
<tr id="S6.F5.2.3.2" class="ltx_tr">
<th id="S6.F5.2.3.2.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_rr">control</th>
<td id="S6.F5.2.3.2.2" class="ltx_td ltx_align_center ltx_border_r">4.26239</td>
<td id="S6.F5.2.3.2.3" class="ltx_td ltx_align_center">0.35350</td>
</tr>
<tr id="S6.F5.2.4.3" class="ltx_tr">
<th id="S6.F5.2.4.3.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_rr">control-no-decay</th>
<td id="S6.F5.2.4.3.2" class="ltx_td ltx_align_center ltx_border_r">4.24125</td>
<td id="S6.F5.2.4.3.3" class="ltx_td ltx_align_center">0.35771</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S6.F5.3.1.1" class="ltx_text" style="font-size:90%;">Figure 5</span>. </span><span id="S6.F5.4.2" class="ltx_text" style="font-size:90%;">Results of the evaluation phase</span></figcaption>
</figure>
<div id="S6.SS3.p5" class="ltx_para">
<p id="S6.SS3.p5.1" class="ltx_p">From a user perspective, it is not clear if these changes improve the user experience.
While users now have to type a good amount less, they also select suggestions more often that are not on top of the list.
One potential explanation for this could be that the items they were looking for are displayed earlier in the suggestion list.
Since they spent less time typing, they might be willing to select an item that is not the top ranked one.
In the future, we plan to evaluate this hypothesis by collecting data about how the rank of the selected item changed while the user was typing.</p>
</div>
<div id="S6.SS3.p6" class="ltx_para">
<p id="S6.SS3.p6.1" class="ltx_p">It is difficult to determine purely based on the two metrics already collected if this change is good, since it is not clear how their importance should be weighted.
Instead, surveying users would be required to decide on which metric is more important.
But even if users are not satisfied with the new model, the Federated Learning system is still highly useful.
Since the optimization process works well, one would only need to find a loss function that correlates more closely with what users want.</p>
</div>
</section>
<section id="S6.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.4. </span>Analyzing the Optimization System</h3>

<div id="S6.SS4.p1" class="ltx_para">
<p id="S6.SS4.p1.1" class="ltx_p">To learn from this experiment for further Federated Learning studies, we additionally analyzed all the update data later on.
In retrospect, the Federated Learning protocol we used was too simple.
Figure <a href="#S6.F6" title="Figure 6 ‣ 6.4. Analyzing the Optimization System ‣ 6. Experiment ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a> shows how Firefox Beta activity in our study varies over time.
Since Firefox Beta usage has a bias towards Asian countries, we receive more pings during day time in Asia.</p>
</div>
<div id="S6.SS4.p2" class="ltx_para">
<p id="S6.SS4.p2.1" class="ltx_p">The protocol could be improved by dynamically determining the iteration length depending on how many updates were sent to the server so far.
This way, there would be no iterations with very few updates.
Furthermore, there could be more iterations during periods with many active users, allowing for a faster optimization process.</p>
</div>
<figure id="S6.F6" class="ltx_figure"><img src="/html/1911.11807/assets/pings-over-time.png" id="S6.F6.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="346" height="139" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S6.F6.2.1.1" class="ltx_text" style="font-size:90%;">Figure 6</span>. </span><span id="S6.F6.3.2" class="ltx_text" style="font-size:90%;">The number of pings sent by clients over time</span></figcaption>
</figure>
<div id="S6.SS4.p3" class="ltx_para">
<p id="S6.SS4.p3.1" class="ltx_p">A more sophisticated protocol could adapt the iteration length depending on how stable the current update estimate is.
We noticed that the later iterations of the optimization process require many fewer reports to compute a good estimate.
Figure <a href="#S6.F7" title="Figure 7 ‣ 6.4. Analyzing the Optimization System ‣ 6. Experiment ‣ Federated Learning for Ranking Browser History Suggestions" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7</span></a> compares the update we actually used to updates we would get by randomly sampling 2,000 of these update reports.
The <math id="S6.SS4.p3.1.m1.1" class="ltx_Math" alttext="L_{1}" display="inline"><semantics id="S6.SS4.p3.1.m1.1a"><msub id="S6.SS4.p3.1.m1.1.1" xref="S6.SS4.p3.1.m1.1.1.cmml"><mi id="S6.SS4.p3.1.m1.1.1.2" xref="S6.SS4.p3.1.m1.1.1.2.cmml">L</mi><mn id="S6.SS4.p3.1.m1.1.1.3" xref="S6.SS4.p3.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.1.m1.1b"><apply id="S6.SS4.p3.1.m1.1.1.cmml" xref="S6.SS4.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S6.SS4.p3.1.m1.1.1.1.cmml" xref="S6.SS4.p3.1.m1.1.1">subscript</csymbol><ci id="S6.SS4.p3.1.m1.1.1.2.cmml" xref="S6.SS4.p3.1.m1.1.1.2">𝐿</ci><cn type="integer" id="S6.SS4.p3.1.m1.1.1.3.cmml" xref="S6.SS4.p3.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.1.m1.1c">L_{1}</annotation></semantics></math>-distance is used to perform this comparison.
Because of the randomness, the mean and standard deviation after 50 such simulations per iteration are reported.</p>
</div>
<figure id="S6.F7" class="ltx_figure"><img src="/html/1911.11807/assets/update-quality.png" id="S6.F7.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="346" height="149" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S6.F7.2.1.1" class="ltx_text" style="font-size:90%;">Figure 7</span>. </span><span id="S6.F7.3.2" class="ltx_text" style="font-size:90%;">Mean and standard deviation of difference in update quality when using 2,000 updates</span></figcaption>
</figure>
<div id="S6.SS4.p4" class="ltx_para">
<p id="S6.SS4.p4.1" class="ltx_p">It can be observed that the estimates become much more stable after iteration 100.
While the <math id="S6.SS4.p4.1.m1.1" class="ltx_Math" alttext="L_{1}" display="inline"><semantics id="S6.SS4.p4.1.m1.1a"><msub id="S6.SS4.p4.1.m1.1.1" xref="S6.SS4.p4.1.m1.1.1.cmml"><mi id="S6.SS4.p4.1.m1.1.1.2" xref="S6.SS4.p4.1.m1.1.1.2.cmml">L</mi><mn id="S6.SS4.p4.1.m1.1.1.3" xref="S6.SS4.p4.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S6.SS4.p4.1.m1.1b"><apply id="S6.SS4.p4.1.m1.1.1.cmml" xref="S6.SS4.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S6.SS4.p4.1.m1.1.1.1.cmml" xref="S6.SS4.p4.1.m1.1.1">subscript</csymbol><ci id="S6.SS4.p4.1.m1.1.1.2.cmml" xref="S6.SS4.p4.1.m1.1.1.2">𝐿</ci><cn type="integer" id="S6.SS4.p4.1.m1.1.1.3.cmml" xref="S6.SS4.p4.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p4.1.m1.1c">L_{1}</annotation></semantics></math>-distance of two updates can be large without affecting the Rprop optimizer much, this is still an interesting result.
We observed similar results for the loss estimates.</p>
</div>
<div id="S6.SS4.p5" class="ltx_para">
<p id="S6.SS4.p5.1" class="ltx_p">The exact differences might be specific to our problem, but this observation can still be used to generally improve the system:
While updates are coming in, the server could check the variance of updates and start a new iteration earlier when it observes little variance.</p>
</div>
</section>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7. </span>Conclusion</h2>

<div id="S7.p1" class="ltx_para">
<p id="S7.p1.1" class="ltx_p">In this paper, we introduced a Federated Learning system built for use in Firefox.
Our system can optimize parts of Firefox purely based on user interactions.
The system is effective in optimization and preserves user privacy, as no personal data is ever shared with a server.
It is also widely applicable since it can replace or tune any heuristics, even if they can only be queried as black boxes.
We used the system to optimize the ranking of suggestion in the Firefox URL bar, which lead to users typing around half a character less before selecting an item.</p>
</div>
<div id="S7.p2" class="ltx_para">
<p id="S7.p2.1" class="ltx_p">Future work is multi-fold.
For one, the existing protocol can be improved to make better use of available data by adapting iteration length dynamically.
Furthermore, many other parts of Firefox can now be optimized using Federated Learning.
The work here mostly lies in posing problems as learning tasks and in designing models.
Lastly, differentially-private mechanisms and secure multi-party aggregation could be added to our system in order to yield stronger privacy guarantees.
</p>
</div>
<div class="ltx_acknowledgements">
<h6 class="ltx_title ltx_title_acknowledgements">Acknowledgements.</h6>
The authors would like to extend their thanks to several people at Mozilla:
Drew Willcoxon and Rob Helmer helped out with the Firefox client-side parts of the project.
Jeff Klukas and Katie Parlante provided additional support during the project.
Outside of Mozilla, we would like to thank Lukas Zilka and Ralf Hinze for giving valuable feedback while writing this paper.

</div>
</section>
<section id="bib" class="ltx_bibliography">
<h2 class="ltx_title ltx_title_bibliography">References</h2>

<ul class="ltx_biblist">
<li id="bib.bib1" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">        




</span>
</li>
<li id="bib.bib2" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abadi et al<span id="bib.bib2.3.3.1" class="ltx_text">.</span> (2016a)</span>
<span class="ltx_bibblock">
Martín Abadi, Paul
Barham, Jianmin Chen, Zhifeng Chen,
Andy Davis, Jeffrey Dean,
Matthieu Devin, Sanjay Ghemawat,
Geoffrey Irving, Michael Isard,
et al<span id="bib.bib2.4.1" class="ltx_text">.</span> 2016a.

</span>
<span class="ltx_bibblock">TensorFlow: A System for Large-Scale Machine
Learning.. In <em id="bib.bib2.5.1" class="ltx_emph ltx_font_italic">OSDI</em>, Vol. 16.
265–283.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib3" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abadi et al<span id="bib.bib3.2.2.1" class="ltx_text">.</span> (2016b)</span>
<span class="ltx_bibblock">
Martin Abadi, Andy Chu,
Ian Goodfellow, H Brendan McMahan,
Ilya Mironov, Kunal Talwar, and
Li Zhang. 2016b.

</span>
<span class="ltx_bibblock">Deep learning with differential privacy. In
<em id="bib.bib3.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 2016 ACM SIGSAC Conference on
Computer and Communications Security</em>. ACM, 308–318.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib4" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Baydin et al<span id="bib.bib4.2.2.1" class="ltx_text">.</span> (2018)</span>
<span class="ltx_bibblock">
Atilim Gunes Baydin,
Barak A Pearlmutter, Alexey Andreyevich
Radul, and Jeffrey Mark Siskind.
2018.

</span>
<span class="ltx_bibblock">Automatic differentiation in machine learning: a
survey.

</span>
<span class="ltx_bibblock"><em id="bib.bib4.3.1" class="ltx_emph ltx_font_italic">Journal of Marchine Learning Research</em>
18 (2018), 1–43.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib5" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bonawitz et al<span id="bib.bib5.2.2.1" class="ltx_text">.</span> (2016)</span>
<span class="ltx_bibblock">
Keith Bonawitz, Vladimir
Ivanov, Ben Kreuter, Antonio Marcedone,
H Brendan McMahan, Sarvar Patel,
Daniel Ramage, Aaron Segal, and
Karn Seth. 2016.

</span>
<span class="ltx_bibblock">Practical secure aggregation for federated learning
on user-held data.

</span>
<span class="ltx_bibblock"><em id="bib.bib5.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1611.04482</em>
(2016).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib6" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cao
et al<span id="bib.bib6.2.2.1" class="ltx_text">.</span> (2006)</span>
<span class="ltx_bibblock">
Yunbo Cao, Jun Xu,
Tie-Yan Liu, Hang Li,
Yalou Huang, and Hsiao-Wuen Hon.
2006.

</span>
<span class="ltx_bibblock">Adapting ranking SVM to document retrieval. In
<em id="bib.bib6.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 29th annual international ACM
SIGIR conference on Research and development in information retrieval</em>. ACM,
186–193.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib7" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cao
et al<span id="bib.bib7.2.2.1" class="ltx_text">.</span> (2007)</span>
<span class="ltx_bibblock">
Zhe Cao, Tao Qin,
Tie-Yan Liu, Ming-Feng Tsai, and
Hang Li. 2007.

</span>
<span class="ltx_bibblock">Learning to rank: from pairwise approach to
listwise approach. In <em id="bib.bib7.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 24th
international conference on Machine learning</em>. ACM,
129–136.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib8" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dwork
et al<span id="bib.bib8.3.3.1" class="ltx_text">.</span> (2014)</span>
<span class="ltx_bibblock">
Cynthia Dwork, Aaron
Roth, et al<span id="bib.bib8.4.1" class="ltx_text">.</span> 2014.

</span>
<span class="ltx_bibblock">The algorithmic foundations of differential
privacy.

</span>
<span class="ltx_bibblock"><em id="bib.bib8.5.1" class="ltx_emph ltx_font_italic">Foundations and Trends® in
Theoretical Computer Science</em> 9, 3–4
(2014), 211–407.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib9" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Foundation (2019)</span>
<span class="ltx_bibblock">
Apache Software Foundation.
2019.

</span>
<span class="ltx_bibblock">Apache Parquet.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://parquet.apache.org" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://parquet.apache.org</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib10" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hardy et al<span id="bib.bib10.2.2.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
Stephen Hardy, Wilko
Henecka, Hamish Ivey-Law, Richard Nock,
Giorgio Patrini, Guillaume Smith, and
Brian Thorne. 2017.

</span>
<span class="ltx_bibblock">Private federated learning on vertically
partitioned data via entity resolution and additively homomorphic
encryption.

</span>
<span class="ltx_bibblock"><em id="bib.bib10.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1711.10677</em>
(2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib11" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hartmann (2018a)</span>
<span class="ltx_bibblock">
Florian Hartmann.
2018a.

</span>
<span class="ltx_bibblock">Federated Learning – Client Implementation.

</span>
<span class="ltx_bibblock"><a target="_blank" href="http://github.com/florian/federated-learning-addon" title="" class="ltx_ref ltx_url ltx_font_typewriter">http://github.com/florian/federated-learning-addon</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib12" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hartmann (2018b)</span>
<span class="ltx_bibblock">
Florian Hartmann.
2018b.

</span>
<span class="ltx_bibblock">Federated Learning – Simulations.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://github.com/florian/federated-learning" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/florian/federated-learning</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib13" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Igel and
Hüsken (2003)</span>
<span class="ltx_bibblock">
Christian Igel and
Michael Hüsken. 2003.

</span>
<span class="ltx_bibblock">Empirical evaluation of the improved Rprop learning
algorithms.

</span>
<span class="ltx_bibblock"><em id="bib.bib13.1.1" class="ltx_emph ltx_font_italic">Neurocomputing</em> 50
(2003), 105–123.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib14" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma and Ba (2014)</span>
<span class="ltx_bibblock">
Diederik P. Kingma and
Jimmy Ba. 2014.

</span>
<span class="ltx_bibblock">Adam: A Method for Stochastic Optimization.

</span>
<span class="ltx_bibblock"><em id="bib.bib14.1.1" class="ltx_emph ltx_font_italic">CoRR</em> abs/1412.6980
(2014).

</span>
<span class="ltx_bibblock">
<a target="_blank" href="http://dblp.uni-trier.de/db/journals/corr/corr1412.html#KingmaB14" title="" class="ltx_ref ltx_url ltx_font_typewriter">http://dblp.uni-trier.de/db/journals/corr/corr1412.html#KingmaB14</a>

</span>
</li>
<li id="bib.bib15" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Komarzewski (2018)</span>
<span class="ltx_bibblock">
Arkadiusz Komarzewski.
2018.

</span>
<span class="ltx_bibblock">Federated Learning – Server Implementation.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://github.com/mozilla/telemetry-streaming/tree/master/src/main/scala/com/mozilla/telemetry/learning/federated" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/mozilla/telemetry-streaming/tree/master/src/main/scala/com/mozilla/telemetry/learning/federated</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib16" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Konečnỳ et al<span id="bib.bib16.2.2.1" class="ltx_text">.</span> (2016)</span>
<span class="ltx_bibblock">
Jakub Konečnỳ,
H Brendan McMahan, Felix X Yu,
Peter Richtárik, Ananda Theertha
Suresh, and Dave Bacon.
2016.

</span>
<span class="ltx_bibblock">Federated learning: Strategies for improving
communication efficiency. NIPS Workshop on Private
Multi-Party Machine Learning.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib17" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span id="bib.bib17.3.3.1" class="ltx_text">.</span> (2009)</span>
<span class="ltx_bibblock">
Tie-Yan Liu et al<span id="bib.bib17.4.1" class="ltx_text">.</span>
2009.

</span>
<span class="ltx_bibblock">Learning to rank for information retrieval.

</span>
<span class="ltx_bibblock"><em id="bib.bib17.5.1" class="ltx_emph ltx_font_italic">Foundations and Trends® in
Information Retrieval</em> 3, 3
(2009), 225–331.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib18" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">McMahan et al<span id="bib.bib18.3.3.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
H Brendan McMahan, Eider
Moore, Daniel Ramage, Seth Hampson,
et al<span id="bib.bib18.4.1" class="ltx_text">.</span> 2017.

</span>
<span class="ltx_bibblock">Communication-efficient learning of deep networks
from decentralized data. In <em id="bib.bib18.5.1" class="ltx_emph ltx_font_italic">Proceedings of the
20th International Conference on Artificial Intelligence and Statistics
(AISTATS)</em>.

</span>
<span class="ltx_bibblock">
<a target="_blank" href="http://arxiv.org/abs/1602.05629" title="" class="ltx_ref ltx_url ltx_font_typewriter">http://arxiv.org/abs/1602.05629</a>

</span>
</li>
<li id="bib.bib19" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">McMahan
et al<span id="bib.bib19.2.2.1" class="ltx_text">.</span> (2018)</span>
<span class="ltx_bibblock">
H Brendan McMahan, Daniel
Ramage, Kunal Talwar, and Li Zhang.
2018.

</span>
<span class="ltx_bibblock">Learning differentially private language models
without losing accuracy. In <em id="bib.bib19.3.1" class="ltx_emph ltx_font_italic">International
Conference on Learning Representations (ICLR)</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib20" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Network (2019a)</span>
<span class="ltx_bibblock">
Mozilla Developer Network.
2019a.

</span>
<span class="ltx_bibblock">Firefox Data Collection.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://wiki.mozilla.org/Firefox/Data_Collection" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://wiki.mozilla.org/Firefox/Data_Collection</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib21" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Network (2019b)</span>
<span class="ltx_bibblock">
Mozilla Developer Network.
2019b.

</span>
<span class="ltx_bibblock">Firefox Telemetry.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/telemetry/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/telemetry/</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib22" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Network (2019c)</span>
<span class="ltx_bibblock">
Mozilla Developer Network.
2019c.

</span>
<span class="ltx_bibblock">Frecency – Mozilla Developer Network.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Places/Frecency_algorithm" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Places/Frecency_algorithm</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib23" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Network (2019d)</span>
<span class="ltx_bibblock">
Mozilla Developer Network.
2019d.

</span>
<span class="ltx_bibblock">SHIELD – Mozilla wiki.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://wiki.mozilla.org/Firefox/Shield" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://wiki.mozilla.org/Firefox/Shield</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib24" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paszke et al<span id="bib.bib24.2.2.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
Adam Paszke, Sam Gross,
Soumith Chintala, Gregory Chanan,
Edward Yang, Zachary DeVito,
Zeming Lin, Alban Desmaison,
Luca Antiga, and Adam Lerer.
2017.

</span>
<span class="ltx_bibblock">Automatic differentiation in PyTorch.

</span>
<span class="ltx_bibblock">(2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib25" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Riedmiller and
Braun (1993)</span>
<span class="ltx_bibblock">
Martin Riedmiller and
Heinrich Braun. 1993.

</span>
<span class="ltx_bibblock">A direct adaptive method for faster backpropagation
learning: The RPROP algorithm. In <em id="bib.bib25.1.1" class="ltx_emph ltx_font_italic">Neural Networks,
1993., IEEE International Conference on</em>. IEEE, 586–591.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib26" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sundermeyer et al<span id="bib.bib26.2.2.1" class="ltx_text">.</span> (2012)</span>
<span class="ltx_bibblock">
Martin Sundermeyer, Ralf
Schlüter, and Hermann Ney.
2012.

</span>
<span class="ltx_bibblock">LSTM neural networks for language modeling. In
<em id="bib.bib26.3.1" class="ltx_emph ltx_font_italic">Thirteenth annual conference of the international
speech communication association</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib27" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Telemetry (2019)</span>
<span class="ltx_bibblock">
Mozilla Telemetry.
2019.

</span>
<span class="ltx_bibblock">Rank of selected URL bar suggestions by type.

</span>
<span class="ltx_bibblock"><a target="_blank" href="https://mzl.la/2ONXI5N" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://mzl.la/2ONXI5N</a>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib28" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zaharia et al<span id="bib.bib28.2.2.1" class="ltx_text">.</span> (2010)</span>
<span class="ltx_bibblock">
Matei Zaharia, Mosharaf
Chowdhury, Michael J Franklin, Scott
Shenker, and Ion Stoica.
2010.

</span>
<span class="ltx_bibblock">Spark: Cluster computing with working sets.

</span>
<span class="ltx_bibblock"><em id="bib.bib28.3.1" class="ltx_emph ltx_font_italic">HotCloud</em> 10,
10-10 (2010), 95.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib29" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang (2004)</span>
<span class="ltx_bibblock">
Tong Zhang.
2004.

</span>
<span class="ltx_bibblock">Solving large scale linear prediction problems
using stochastic gradient descent algorithms. In
<em id="bib.bib29.1.1" class="ltx_emph ltx_font_italic">Proceedings of the twenty-first international
conference on Machine learning</em>. ACM, 116.

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
</article>
</div>
<div class="ar5iv-footer"><a href="/html/1911.11806" class="ar5iv-nav-button ar5iv-nav-button-prev">◄</a>
    <a class="ar5iv-home-button" href="/"><img height="40" alt="ar5iv homepage" src="/assets/ar5iv.png"></a>
    <a href="/feeling_lucky" class="ar5iv-text-button">Feeling<br>lucky?</a>
    <a href="/log/1911.11807" class="ar5iv-text-button ar5iv-severity-ok">Conversion<br>report</a>
    <a class="ar5iv-text-button" target="_blank" href="https://github.com/dginev/ar5iv/issues/new?template=improve-article--arxiv-id-.md&title=Improve+article+1911.11807">Report<br>an issue</a>
    <a href="https://arxiv.org/abs/1911.11807" class="ar5iv-text-button arxiv-ui-theme">View&nbsp;original<br>on&nbsp;arXiv</a><a href="/html/1911.11809" class="ar5iv-nav-button ar5iv-nav-button-next">►</a>
</div><footer class="ltx_page_footer">
<a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle ar5iv color scheme"><span class="color-scheme-icon"></span></a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/license" target="_blank">Copyright</a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/policies/privacy_policy" target="_blank">Privacy Policy</a>

<div class="ltx_page_logo">Generated  on Sun Mar 17 14:17:13 2024 by <a target="_blank" href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>

    <script>
      var canMathML = typeof(MathMLElement) == "function";
      if (!canMathML) {
        var body = document.querySelector("body");
        body.firstElementChild.setAttribute('style', 'opacity: 0;');
        var loading = document.createElement("div");
        loading.setAttribute("id", "mathjax-loading-spinner");
        var message = document.createElement("div");
        message.setAttribute("id", "mathjax-loading-message");
        message.innerText = "Typesetting Equations...";
        body.prepend(loading);
        body.prepend(message);

        var el = document.createElement("script");
        el.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
        document.querySelector("head").appendChild(el);

        window.MathJax = {
          startup: {
            pageReady: () => {
              return MathJax.startup.defaultPageReady().then(() => {
                body.removeChild(loading);
                body.removeChild(message);
                body.firstElementChild.removeAttribute('style');
              }); } } };
      }
    </script>
    <script>
    // Auxiliary function, building the preview feature when
    // an inline citation is clicked
    function clicked_cite(e) {
      e.preventDefault();
      let cite = this.closest('.ltx_cite');
      let next = cite.nextSibling;
      if (next && next.nodeType == Node.ELEMENT_NODE && next.getAttribute('class') == "ar5iv-bibitem-preview") {
        next.remove();
        return; }
      // Before adding a preview modal,
      // cleanup older previews, in case they're still open
      document.querySelectorAll('span.ar5iv-bibitem-preview').forEach(function(node) {
        node.remove();
      })

      // Create the preview
      preview = document.createElement('span');
      preview.setAttribute('class','ar5iv-bibitem-preview');
      let target = document.getElementById(this.getAttribute('href').slice(1));
      target.childNodes.forEach(function (child) {
        preview.append(child.cloneNode(true));
      });
      let close_x = document.createElement('button');
      close_x.setAttribute("aria-label","Close modal for bibliography item preview");
      close_x.textContent = "×";
      close_x.setAttribute('class', 'ar5iv-button-close-preview');
      close_x.setAttribute('onclick','this.parentNode.remove()');
      preview.append(close_x);
      preview.querySelectorAll('.ltx_tag_bibitem').forEach(function(node) {
        node.remove();
      });
      cite.parentNode.insertBefore(preview, cite.nextSibling);
      return;
    }
    // Global Document initialization:
    // - assign the preview feature to all inline citation links
    document.querySelectorAll(".ltx_cite .ltx_ref").forEach(function (link) {
      link.addEventListener("click", clicked_cite);
    });
    </script>
    </body>
</html>
