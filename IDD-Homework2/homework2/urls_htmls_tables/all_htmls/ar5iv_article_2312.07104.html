<article class="ltx_document ltx_authors_1line">
 <h1 class="ltx_title ltx_title_document">
  Efficiently Programming Large Language Models using SGLang
 </h1>
 <div class="ltx_authors">
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Lianmin Zheng
    <math alttext="{}^{\text{2},*}" class="ltx_Math" display="inline" id="id1.1.m1.2">
     <semantics id="id1.1.m1.2a">
      <msup id="id1.1.m1.2.2" xref="id1.1.m1.2.2.cmml">
       <mi id="id1.1.m1.2.2a" xref="id1.1.m1.2.2.cmml">
       </mi>
       <mrow id="id1.1.m1.2.2.2.4" xref="id1.1.m1.2.2.2.3.cmml">
        <mtext id="id1.1.m1.1.1.1.1" xref="id1.1.m1.1.1.1.1a.cmml">
         2
        </mtext>
        <mo id="id1.1.m1.2.2.2.4.1" rspace="0em" xref="id1.1.m1.2.2.2.3.cmml">
         ,
        </mo>
        <mo id="id1.1.m1.2.2.2.2" lspace="0em" xref="id1.1.m1.2.2.2.2.cmml">
         ∗
        </mo>
       </mrow>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id1.1.m1.2b">
       <apply id="id1.1.m1.2.2.cmml" xref="id1.1.m1.2.2">
        <list id="id1.1.m1.2.2.2.3.cmml" xref="id1.1.m1.2.2.2.4">
         <ci id="id1.1.m1.1.1.1.1a.cmml" xref="id1.1.m1.1.1.1.1">
          <mtext id="id1.1.m1.1.1.1.1.cmml" mathsize="70%" xref="id1.1.m1.1.1.1.1">
           2
          </mtext>
         </ci>
         <times id="id1.1.m1.2.2.2.2.cmml" xref="id1.1.m1.2.2.2.2">
         </times>
        </list>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id1.1.m1.2c">
       {}^{\text{2},*}
      </annotation>
     </semantics>
    </math>
    Liangsheng Yin
    <math alttext="{}^{\text{3}}" class="ltx_Math" display="inline" id="id2.2.m2.1">
     <semantics id="id2.2.m2.1a">
      <msup id="id2.2.m2.1.1" xref="id2.2.m2.1.1.cmml">
       <mi id="id2.2.m2.1.1a" xref="id2.2.m2.1.1.cmml">
       </mi>
       <mtext id="id2.2.m2.1.1.1" xref="id2.2.m2.1.1.1a.cmml">
        3
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id2.2.m2.1b">
       <apply id="id2.2.m2.1.1.cmml" xref="id2.2.m2.1.1">
        <ci id="id2.2.m2.1.1.1a.cmml" xref="id2.2.m2.1.1.1">
         <mtext id="id2.2.m2.1.1.1.cmml" mathsize="70%" xref="id2.2.m2.1.1.1">
          3
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id2.2.m2.1c">
       {}^{\text{3}}
      </annotation>
     </semantics>
    </math>
    Zhiqiang Xie
    <math alttext="{}^{\text{1}}" class="ltx_Math" display="inline" id="id3.3.m3.1">
     <semantics id="id3.3.m3.1a">
      <msup id="id3.3.m3.1.1" xref="id3.3.m3.1.1.cmml">
       <mi id="id3.3.m3.1.1a" xref="id3.3.m3.1.1.cmml">
       </mi>
       <mtext id="id3.3.m3.1.1.1" xref="id3.3.m3.1.1.1a.cmml">
        1
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id3.3.m3.1b">
       <apply id="id3.3.m3.1.1.cmml" xref="id3.3.m3.1.1">
        <ci id="id3.3.m3.1.1.1a.cmml" xref="id3.3.m3.1.1.1">
         <mtext id="id3.3.m3.1.1.1.cmml" mathsize="70%" xref="id3.3.m3.1.1.1">
          1
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id3.3.m3.1c">
       {}^{\text{1}}
      </annotation>
     </semantics>
    </math>
    Jeff Huang
    <math alttext="{}^{\text{4}}" class="ltx_Math" display="inline" id="id4.4.m4.1">
     <semantics id="id4.4.m4.1a">
      <msup id="id4.4.m4.1.1" xref="id4.4.m4.1.1.cmml">
       <mi id="id4.4.m4.1.1a" xref="id4.4.m4.1.1.cmml">
       </mi>
       <mtext id="id4.4.m4.1.1.1" xref="id4.4.m4.1.1.1a.cmml">
        4
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id4.4.m4.1b">
       <apply id="id4.4.m4.1.1.cmml" xref="id4.4.m4.1.1">
        <ci id="id4.4.m4.1.1.1a.cmml" xref="id4.4.m4.1.1.1">
         <mtext id="id4.4.m4.1.1.1.cmml" mathsize="70%" xref="id4.4.m4.1.1.1">
          4
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id4.4.m4.1c">
       {}^{\text{4}}
      </annotation>
     </semantics>
    </math>
    Chuyue Sun
    <math alttext="{}^{\text{1}}" class="ltx_Math" display="inline" id="id5.5.m5.1">
     <semantics id="id5.5.m5.1a">
      <msup id="id5.5.m5.1.1" xref="id5.5.m5.1.1.cmml">
       <mi id="id5.5.m5.1.1a" xref="id5.5.m5.1.1.cmml">
       </mi>
       <mtext id="id5.5.m5.1.1.1" xref="id5.5.m5.1.1.1a.cmml">
        1
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id5.5.m5.1b">
       <apply id="id5.5.m5.1.1.cmml" xref="id5.5.m5.1.1">
        <ci id="id5.5.m5.1.1.1a.cmml" xref="id5.5.m5.1.1.1">
         <mtext id="id5.5.m5.1.1.1.cmml" mathsize="70%" xref="id5.5.m5.1.1.1">
          1
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id5.5.m5.1c">
       {}^{\text{1}}
      </annotation>
     </semantics>
    </math>
    Cody Hao Yu
    <math alttext="{}^{\text{5}}" class="ltx_Math" display="inline" id="id6.6.m6.1">
     <semantics id="id6.6.m6.1a">
      <msup id="id6.6.m6.1.1" xref="id6.6.m6.1.1.cmml">
       <mi id="id6.6.m6.1.1a" xref="id6.6.m6.1.1.cmml">
       </mi>
       <mtext id="id6.6.m6.1.1.1" xref="id6.6.m6.1.1.1a.cmml">
        5
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id6.6.m6.1b">
       <apply id="id6.6.m6.1.1.cmml" xref="id6.6.m6.1.1">
        <ci id="id6.6.m6.1.1.1a.cmml" xref="id6.6.m6.1.1.1">
         <mtext id="id6.6.m6.1.1.1.cmml" mathsize="70%" xref="id6.6.m6.1.1.1">
          5
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id6.6.m6.1c">
       {}^{\text{5}}
      </annotation>
     </semantics>
    </math>
    Shiyi Cao
    <math alttext="{}^{\text{2}}" class="ltx_Math" display="inline" id="id7.7.m7.1">
     <semantics id="id7.7.m7.1a">
      <msup id="id7.7.m7.1.1" xref="id7.7.m7.1.1.cmml">
       <mi id="id7.7.m7.1.1a" xref="id7.7.m7.1.1.cmml">
       </mi>
       <mtext id="id7.7.m7.1.1.1" xref="id7.7.m7.1.1.1a.cmml">
        2
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id7.7.m7.1b">
       <apply id="id7.7.m7.1.1.cmml" xref="id7.7.m7.1.1">
        <ci id="id7.7.m7.1.1.1a.cmml" xref="id7.7.m7.1.1.1">
         <mtext id="id7.7.m7.1.1.1.cmml" mathsize="70%" xref="id7.7.m7.1.1.1">
          2
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id7.7.m7.1c">
       {}^{\text{2}}
      </annotation>
     </semantics>
    </math>
    <br class="ltx_break"/>
    Christos Kozyrakis
    <math alttext="{}^{\text{1}}" class="ltx_Math" display="inline" id="id8.8.m8.1">
     <semantics id="id8.8.m8.1a">
      <msup id="id8.8.m8.1.1" xref="id8.8.m8.1.1.cmml">
       <mi id="id8.8.m8.1.1a" xref="id8.8.m8.1.1.cmml">
       </mi>
       <mtext id="id8.8.m8.1.1.1" xref="id8.8.m8.1.1.1a.cmml">
        1
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id8.8.m8.1b">
       <apply id="id8.8.m8.1.1.cmml" xref="id8.8.m8.1.1">
        <ci id="id8.8.m8.1.1.1a.cmml" xref="id8.8.m8.1.1.1">
         <mtext id="id8.8.m8.1.1.1.cmml" mathsize="70%" xref="id8.8.m8.1.1.1">
          1
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id8.8.m8.1c">
       {}^{\text{1}}
      </annotation>
     </semantics>
    </math>
    Ion Stoica
    <math alttext="{}^{\text{2}}" class="ltx_Math" display="inline" id="id9.9.m9.1">
     <semantics id="id9.9.m9.1a">
      <msup id="id9.9.m9.1.1" xref="id9.9.m9.1.1.cmml">
       <mi id="id9.9.m9.1.1a" xref="id9.9.m9.1.1.cmml">
       </mi>
       <mtext id="id9.9.m9.1.1.1" xref="id9.9.m9.1.1.1a.cmml">
        2
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id9.9.m9.1b">
       <apply id="id9.9.m9.1.1.cmml" xref="id9.9.m9.1.1">
        <ci id="id9.9.m9.1.1.1a.cmml" xref="id9.9.m9.1.1.1">
         <mtext id="id9.9.m9.1.1.1.cmml" mathsize="70%" xref="id9.9.m9.1.1.1">
          2
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id9.9.m9.1c">
       {}^{\text{2}}
      </annotation>
     </semantics>
    </math>
    Joseph E. Gonzalez
    <math alttext="{}^{\text{2}}" class="ltx_Math" display="inline" id="id10.10.m10.1">
     <semantics id="id10.10.m10.1a">
      <msup id="id10.10.m10.1.1" xref="id10.10.m10.1.1.cmml">
       <mi id="id10.10.m10.1.1a" xref="id10.10.m10.1.1.cmml">
       </mi>
       <mtext id="id10.10.m10.1.1.1" xref="id10.10.m10.1.1.1a.cmml">
        2
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id10.10.m10.1b">
       <apply id="id10.10.m10.1.1.cmml" xref="id10.10.m10.1.1">
        <ci id="id10.10.m10.1.1.1a.cmml" xref="id10.10.m10.1.1.1">
         <mtext id="id10.10.m10.1.1.1.cmml" mathsize="70%" xref="id10.10.m10.1.1.1">
          2
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id10.10.m10.1c">
       {}^{\text{2}}
      </annotation>
     </semantics>
    </math>
    Clark Barrett
    <math alttext="{}^{\text{1}}" class="ltx_Math" display="inline" id="id11.11.m11.1">
     <semantics id="id11.11.m11.1a">
      <msup id="id11.11.m11.1.1" xref="id11.11.m11.1.1.cmml">
       <mi id="id11.11.m11.1.1a" xref="id11.11.m11.1.1.cmml">
       </mi>
       <mtext id="id11.11.m11.1.1.1" xref="id11.11.m11.1.1.1a.cmml">
        1
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id11.11.m11.1b">
       <apply id="id11.11.m11.1.1.cmml" xref="id11.11.m11.1.1">
        <ci id="id11.11.m11.1.1.1a.cmml" xref="id11.11.m11.1.1.1">
         <mtext id="id11.11.m11.1.1.1.cmml" mathsize="70%" xref="id11.11.m11.1.1.1">
          1
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id11.11.m11.1c">
       {}^{\text{1}}
      </annotation>
     </semantics>
    </math>
    Ying Sheng
    <math alttext="{}^{\text{1,*}}" class="ltx_Math" display="inline" id="id12.12.m12.1">
     <semantics id="id12.12.m12.1a">
      <msup id="id12.12.m12.1.1" xref="id12.12.m12.1.1.cmml">
       <mi id="id12.12.m12.1.1a" xref="id12.12.m12.1.1.cmml">
       </mi>
       <mtext id="id12.12.m12.1.1.1" xref="id12.12.m12.1.1.1a.cmml">
        1,*
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id12.12.m12.1b">
       <apply id="id12.12.m12.1.1.cmml" xref="id12.12.m12.1.1">
        <ci id="id12.12.m12.1.1.1a.cmml" xref="id12.12.m12.1.1.1">
         <mtext id="id12.12.m12.1.1.1.cmml" mathsize="70%" xref="id12.12.m12.1.1.1">
          1,*
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id12.12.m12.1c">
       {}^{\text{1,*}}
      </annotation>
     </semantics>
    </math>
    <br class="ltx_break"/>
    <br class="ltx_break"/>
    <math alttext="{}^{\text{1}}" class="ltx_Math" display="inline" id="id13.13.m13.1">
     <semantics id="id13.13.m13.1a">
      <msup id="id13.13.m13.1.1" xref="id13.13.m13.1.1.cmml">
       <mi id="id13.13.m13.1.1a" xref="id13.13.m13.1.1.cmml">
       </mi>
       <mtext id="id13.13.m13.1.1.1" xref="id13.13.m13.1.1.1a.cmml">
        1
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id13.13.m13.1b">
       <apply id="id13.13.m13.1.1.cmml" xref="id13.13.m13.1.1">
        <ci id="id13.13.m13.1.1.1a.cmml" xref="id13.13.m13.1.1.1">
         <mtext id="id13.13.m13.1.1.1.cmml" mathsize="70%" xref="id13.13.m13.1.1.1">
          1
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id13.13.m13.1c">
       {}^{\text{1}}
      </annotation>
     </semantics>
    </math>
    Stanford University
    <math alttext="{}^{\text{2}}" class="ltx_Math" display="inline" id="id14.14.m14.1">
     <semantics id="id14.14.m14.1a">
      <msup id="id14.14.m14.1.1" xref="id14.14.m14.1.1.cmml">
       <mi id="id14.14.m14.1.1a" xref="id14.14.m14.1.1.cmml">
       </mi>
       <mtext id="id14.14.m14.1.1.1" xref="id14.14.m14.1.1.1a.cmml">
        2
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id14.14.m14.1b">
       <apply id="id14.14.m14.1.1.cmml" xref="id14.14.m14.1.1">
        <ci id="id14.14.m14.1.1.1a.cmml" xref="id14.14.m14.1.1.1">
         <mtext id="id14.14.m14.1.1.1.cmml" mathsize="70%" xref="id14.14.m14.1.1.1">
          2
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id14.14.m14.1c">
       {}^{\text{2}}
      </annotation>
     </semantics>
    </math>
    UC Berkeley
    <math alttext="{}^{\text{3}}" class="ltx_Math" display="inline" id="id15.15.m15.1">
     <semantics id="id15.15.m15.1a">
      <msup id="id15.15.m15.1.1" xref="id15.15.m15.1.1.cmml">
       <mi id="id15.15.m15.1.1a" xref="id15.15.m15.1.1.cmml">
       </mi>
       <mtext id="id15.15.m15.1.1.1" xref="id15.15.m15.1.1.1a.cmml">
        3
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id15.15.m15.1b">
       <apply id="id15.15.m15.1.1.cmml" xref="id15.15.m15.1.1">
        <ci id="id15.15.m15.1.1.1a.cmml" xref="id15.15.m15.1.1.1">
         <mtext id="id15.15.m15.1.1.1.cmml" mathsize="70%" xref="id15.15.m15.1.1.1">
          3
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id15.15.m15.1c">
       {}^{\text{3}}
      </annotation>
     </semantics>
    </math>
    Shanghai Jiao Tong University
    <br class="ltx_break"/>
    <math alttext="{}^{\text{4}}" class="ltx_Math" display="inline" id="id16.16.m16.1">
     <semantics id="id16.16.m16.1a">
      <msup id="id16.16.m16.1.1" xref="id16.16.m16.1.1.cmml">
       <mi id="id16.16.m16.1.1a" xref="id16.16.m16.1.1.cmml">
       </mi>
       <mtext id="id16.16.m16.1.1.1" xref="id16.16.m16.1.1.1a.cmml">
        4
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id16.16.m16.1b">
       <apply id="id16.16.m16.1.1.cmml" xref="id16.16.m16.1.1">
        <ci id="id16.16.m16.1.1.1a.cmml" xref="id16.16.m16.1.1.1">
         <mtext id="id16.16.m16.1.1.1.cmml" mathsize="70%" xref="id16.16.m16.1.1.1">
          4
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id16.16.m16.1c">
       {}^{\text{4}}
      </annotation>
     </semantics>
    </math>
    Texas A&amp;M University
    <math alttext="{}^{\text{5}}" class="ltx_Math" display="inline" id="id17.17.m17.1">
     <semantics id="id17.17.m17.1a">
      <msup id="id17.17.m17.1.1" xref="id17.17.m17.1.1.cmml">
       <mi id="id17.17.m17.1.1a" xref="id17.17.m17.1.1.cmml">
       </mi>
       <mtext id="id17.17.m17.1.1.1" xref="id17.17.m17.1.1.1a.cmml">
        5
       </mtext>
      </msup>
      <annotation-xml encoding="MathML-Content" id="id17.17.m17.1b">
       <apply id="id17.17.m17.1.1.cmml" xref="id17.17.m17.1.1">
        <ci id="id17.17.m17.1.1.1a.cmml" xref="id17.17.m17.1.1.1">
         <mtext id="id17.17.m17.1.1.1.cmml" mathsize="70%" xref="id17.17.m17.1.1.1">
          5
         </mtext>
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="id17.17.m17.1c">
       {}^{\text{5}}
      </annotation>
     </semantics>
    </math>
    Independent Researcher
   </span>
  </span>
 </div>
 <div class="ltx_abstract">
  <h6 class="ltx_title ltx_title_abstract">
   Abstract
  </h6>
  <p class="ltx_p" id="id18.1">
   Large language models (LLMs) are increasingly used for complex tasks requiring multiple chained generation calls, advanced prompting techniques, control flow, and interaction with external environments. However, efficient systems for programming and executing these applications are lacking.
To bridge this gap, we introduce SGLang, a
   <span class="ltx_text ltx_framed ltx_framed_underline" id="id18.1.1">
    S
   </span>
   tructured
   <span class="ltx_text ltx_framed ltx_framed_underline" id="id18.1.2">
    G
   </span>
   eneration
   <span class="ltx_text ltx_framed ltx_framed_underline" id="id18.1.3">
    Lang
   </span>
   uage for LLMs. SGLang is designed for the efficient programming of LLMs and incorporates primitives for common LLM programming patterns. We have implemented SGLang as a domain-specific language embedded in Python, and we developed an interpreter, a compiler, and a high-performance runtime for SGLang.
These components work together to enable optimizations such as parallelism, batching, caching, sharing, and other compilation techniques. Additionally, we propose RadixAttention, a novel technique that maintains a Least Recently Used (LRU) cache of the Key-Value (KV) cache for all requests in a radix tree, enabling automatic KV cache reuse across multiple generation calls at runtime. SGLang simplifies the writing of LLM programs and boosts execution efficiency.
Our experiments demonstrate that SGLang can speed up common LLM tasks by up to
   <math alttext="5\times" class="ltx_math_unparsed" display="inline" id="id18.1.m1.1">
    <semantics id="id18.1.m1.1a">
     <mrow id="id18.1.m1.1b">
      <mn id="id18.1.m1.1.1">
       5
      </mn>
      <mo id="id18.1.m1.1.2" lspace="0.222em">
       ×
      </mo>
     </mrow>
     <annotation encoding="application/x-tex" id="id18.1.m1.1c">
      5\times
     </annotation>
    </semantics>
   </math>
   , while reducing code complexity and enhancing control.
  </p>
 </div>
 <span class="ltx_note ltx_role_footnote" id="footnote1">
  <sup class="ltx_note_mark">
   †
  </sup>
  <span class="ltx_note_outer">
   <span class="ltx_note_content">
    <sup class="ltx_note_mark">
     †
    </sup>
    <sup class="ltx_sup" id="footnote1.1">
     ∗
    </sup>
    Equal contribution.
   </span>
  </span>
 </span>
 <section class="ltx_section" id="S1">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    1
   </span>
   Introduction
  </h2>
  <div class="ltx_para" id="S1.p1">
   <p class="ltx_p" id="S1.p1.1">
    Recent increases in the capabilities of LLMs have broadened their utility, enabling them to tackle a wider range of general tasks and act as autonomous agents
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib40" title="">
      40
     </a>
     ,
     <a class="ltx_ref" href="#bib.bib6" title="">
      6
     </a>
     ,
     <a class="ltx_ref" href="#bib.bib42" title="">
      42
     </a>
     ,
     <a class="ltx_ref" href="#bib.bib61" title="">
      61
     </a>
     ]
    </cite>
    .
In such applications, LLMs engage in
    <em class="ltx_emph ltx_font_italic" id="S1.p1.1.1">
     multi-round
    </em>
    planning, reasoning, and interaction with external environments.
This is accomplished through tool usage
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib49" title="">
      49
     </a>
     ]
    </cite>
    , multiple input modalities
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib1" title="">
      1
     </a>
     ]
    </cite>
    , and a wide-range of prompting techniques
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib31" title="">
      31
     </a>
     ]
    </cite>
    , like few-shot learning
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib5" title="">
      5
     </a>
     ]
    </cite>
    ,
self-consistency
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib63" title="">
      63
     </a>
     ]
    </cite>
    , skeleton-of-thought
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib37" title="">
      37
     </a>
     ]
    </cite>
    , and tree-of-thought
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib70" title="">
      70
     </a>
     ]
    </cite>
    .
All of these new use cases require multiple, often dependent, LLM generation calls, and critically, the control flow of these programs may depend on the output of LLMs
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib71" title="">
      71
     </a>
     ]
    </cite>
    .
    <em class="ltx_emph ltx_font_italic" id="S1.p1.1.2">
     The emergence of these complex patterns signifies a shift in our interaction with LLMs, moving from simple turn-based chatting to a more sophisticated form of programmatic usage of LLMs (see
     <a class="ltx_ref ltx_refmacro_autoref" href="#S2.SS2" title="2.2 The Paradigm of Programming LLMs ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Section 2.2
      </span>
     </a>
     ).
    </em>
    <a class="ltx_ref ltx_refmacro_autoref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Figure 1
     </span>
    </a>
    shows an example of such an LLM program, where multiple generation calls are used to accomplish a task. The example uses SGLang, a new domain-specific language we introduce in this paper and explain in
    <a class="ltx_ref ltx_refmacro_autoref" href="#S4" title="4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 4
     </span>
    </a>
    .
   </p>
  </div>
  <figure class="ltx_figure" id="S1.F1">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="376" id="S1.F1.g1" src="/html/2312.07104/assets/x1.png" width="461"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     <span class="ltx_text" id="S1.F1.7.1.1" style="font-size:90%;">
      Figure 1
     </span>
     :
    </span>
    <span class="ltx_text" id="S1.F1.8.2" style="font-size:90%;">
     The implementation of a multi-dimensional essay judge in SGLang utilizes the branch-solve-merge prompting technique
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib48" title="">
       48
      </a>
      ]
     </cite>
     .
This function uses LLMs to evaluate the quality of an essay from multiple dimensions, merges the judgments, generates a summary, and assigns a final grade.
The highlighted regions illustrate the use of SGLang APIs.
(1)
     <span class="ltx_text ltx_font_typewriter" id="S1.F1.8.2.1">
      fork
     </span>
     creates multiple parallel copies of a prompt.
(2)
     <span class="ltx_text ltx_font_typewriter" id="S1.F1.8.2.2">
      gen
     </span>
     invokes an LLM generation and stores the result in a variable.
(3)
     <span class="ltx_text ltx_font_typewriter" id="S1.F1.8.2.3">
      [variable_name]
     </span>
     retrieves the result of the generation.
(4)
     <span class="ltx_text ltx_font_typewriter" id="S1.F1.8.2.4">
      choices
     </span>
     imposes constraints on the generation.
(5)
     <span class="ltx_text ltx_font_typewriter" id="S1.F1.8.2.5">
      run
     </span>
     executes a SGLang function with its arguments.
    </span>
   </figcaption>
  </figure>
  <div class="ltx_para" id="S1.p2">
   <p class="ltx_p" id="S1.p2.1">
    To align with emerging trends, the community has seen the development and rising popularity of new interfaces such as LangChain
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib24" title="">
      24
     </a>
     ]
    </cite>
    , LMQL
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib4" title="">
      4
     </a>
     ]
    </cite>
    , Guidance
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib16" title="">
      16
     </a>
     ]
    </cite>
    , and DSPy
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib21" title="">
      21
     </a>
     ]
    </cite>
    .
These tools help users manage prompt templates and program pipelines with ease. However, their primary focus on front-end design often results in compromised runtime performance.
   </p>
  </div>
  <div class="ltx_para" id="S1.p3">
   <p class="ltx_p" id="S1.p3.1">
    Conversely, while back-end inference engines like NVIDIA TensorRT-LLM
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib38" title="">
      38
     </a>
     ]
    </cite>
    , Hugging Face TGI
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib19" title="">
      19
     </a>
     ]
    </cite>
    , Orca
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib74" title="">
      74
     </a>
     ]
    </cite>
    , and vLLM
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib23" title="">
      23
     </a>
     ]
    </cite>
    continue to reduce latency and improve throughput, their design largely remains anchored in traditional single-generation call interfaces. They typically support APIs similar to the OpenAI Completion API
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib39" title="">
      39
     </a>
     ]
    </cite>
    , where a user prompt is processed and a response is returned in a stateless manner.
   </p>
  </div>
  <div class="ltx_para" id="S1.p4">
   <p class="ltx_p" id="S1.p4.1">
    While both front-end and back-end technologies are advancing rapidly, they are evolving along separate trajectories. The front end largely remains oblivious to the LLM inference processes, while the back end often lacks awareness of the application’s structure and is unable to optimize across multiple calls. This disjointed development leads to numerous missed opportunities for performance optimization, such as KV cache sharing and parallelism, as discussed in
    <a class="ltx_ref ltx_refmacro_autoref" href="#S2.SS3" title="2.3 Challenges and Opportunities ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 2.3
     </span>
    </a>
    .
   </p>
  </div>
  <div class="ltx_para" id="S1.p5">
   <p class="ltx_p" id="S1.p5.1">
    In this paper, we present a holistic approach for an efficient LLM programming system by co-designing both the front-end language and the back-end runtime.
The process involves three key challenges: (i) creating a flexible, domain-specific language with primitives suitable for LLM programming and ecosystem integration; (ii)
ensuring efficient program execution via automatic parallelism, batching, caching, and sharing across multiple calls and multiple programs; and (iii)
enhancing program performance through compiler optimizations like code movement and prefetching annotations.
   </p>
  </div>
  <div class="ltx_para" id="S1.p6">
   <p class="ltx_p" id="S1.p6.1">
    On the front end, we introduce SGLang, a domain-specific language embedded in Python. It provides a set of primitives specifically designed to facilitate programming LLMs. These primitives enable the manipulation of prompts and generations (e.g.,
    <span class="ltx_text ltx_font_typewriter" id="S1.p6.1.1">
     extend
    </span>
    ,
    <span class="ltx_text ltx_font_typewriter" id="S1.p6.1.2">
     gen
    </span>
    ,
    <span class="ltx_text ltx_font_typewriter" id="S1.p6.1.3">
     select
    </span>
    ) and the control of parallelism (e.g.,
    <span class="ltx_text ltx_font_typewriter" id="S1.p6.1.4">
     fork
    </span>
    ,
    <span class="ltx_text ltx_font_typewriter" id="S1.p6.1.5">
     join
    </span>
    ). Furthermore, SGLang is compatible with Python’s control flow and libraries.
Leveraging these primitives along with native Python syntax, users can
intuitively develop sophisticated prompting strategies and agents, while obviating the need for manual optimization.
Moreover, the unified language enhances portability, enabling users to transition easily between different open-source and proprietary models, such as those from OpenAI and Anthropic.
   </p>
  </div>
  <div class="ltx_para" id="S1.p7">
   <p class="ltx_p" id="S1.p7.1">
    We develop both an interpreter and a compiler for SGLang. The interpreter is responsible for managing the prompt state and executing SGLang programs.
Specifically, it treats a prompt as a stream and submits primitive operations to this stream for asynchronous execution, ensuring proper control over synchronization and intra-program parallelism.
Additionally, we can trace a SGLang program and utilize the compiler to compile it into a computational graph.
This approach opens opportunities for more aggressive optimizations. We explore several classical compiler optimizations, e.g., code movement, in the context of LLM programming.
   </p>
  </div>
  <div class="ltx_para" id="S1.p8">
   <p class="ltx_p" id="S1.p8.1">
    On the back end, we propose a novel technique called RadixAttention to automatically reuse the KV cache across multiple generation calls. In existing systems, the KV cache of a request is discarded after processing is completed, which prevents KV cache from being reused across multiple generation calls.
Instead, our system maintains an LRU cache of the KV cache for all requests within a radix tree. This approach allows the runtime to efficiently achieve automatic sharing for various reuse patterns.
Additionally, to increase the cache hit rate, we utilize a cache-aware scheduling policy.
   </p>
  </div>
  <div class="ltx_para" id="S1.p9">
   <p class="ltx_p" id="S1.p9.1">
    In summary, we make the following contributions:
   </p>
   <ul class="ltx_itemize" id="S1.I1">
    <li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i1.p1">
      <p class="ltx_p" id="S1.I1.i1.p1.1">
       We present SGLang, a domain-specific language with primitives for LLM programming, supporting parallelism, control flow, nested calls, and external calls.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i2.p1">
      <p class="ltx_p" id="S1.I1.i2.p1.1">
       We develop an interpreter capable of executing SGLang programs in tandem with the Python interpreter and managing prompt states as asynchronous streams.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i3.p1">
      <p class="ltx_p" id="S1.I1.i3.p1.1">
       We build a compiler capable of compiling programs into computational graphs and explore classical compiler techniques in the context of LLM programming.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i4" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i4.p1">
      <p class="ltx_p" id="S1.I1.i4.p1.1">
       We propose RadixAttention, a novel technique for automatic KV cache reuse across multiple generation calls at runtime.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i5" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i5.p1">
      <p class="ltx_p" id="S1.I1.i5.p1.1">
       Using SGLang, we implement various LLM applications, including agent control, logical reasoning, content generation, benchmarking, and long document processing.
Our experiments demonstrate that SGLang can accelerate common LLM tasks by up to
       <math alttext="5\times" class="ltx_math_unparsed" display="inline" id="S1.I1.i5.p1.1.m1.1">
        <semantics id="S1.I1.i5.p1.1.m1.1a">
         <mrow id="S1.I1.i5.p1.1.m1.1b">
          <mn id="S1.I1.i5.p1.1.m1.1.1">
           5
          </mn>
          <mo id="S1.I1.i5.p1.1.m1.1.2" lspace="0.222em">
           ×
          </mo>
         </mrow>
         <annotation encoding="application/x-tex" id="S1.I1.i5.p1.1.m1.1c">
          5\times
         </annotation>
        </semantics>
       </math>
       , while reducing code complexity and enhancing control.
      </p>
     </div>
    </li>
   </ul>
  </div>
 </section>
 <section class="ltx_section" id="S2">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    2
   </span>
   Background
  </h2>
  <section class="ltx_subsection" id="S2.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.1
    </span>
    The Inference Process of LLMs
   </h3>
   <div class="ltx_para" id="S2.SS1.p1">
    <p class="ltx_p" id="S2.SS1.p1.1">
     Most LLMs in use today, such as GPT-3
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib5" title="">
       5
      </a>
      ]
     </cite>
     , PaLM
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib8" title="">
       8
      </a>
      ]
     </cite>
     , and LLaMA
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib58" title="">
       58
      </a>
      ]
     </cite>
     , are based on the autoregressive Transformer architecture
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib60" title="">
       60
      </a>
      ]
     </cite>
     .
The models predict the probability of the next token in a sequence based on the preceding tokens.
During inference, the model first processes a sequence of input tokens through a forward pass.
It then sequentially decodes output tokens, with each token depending on prior tokens.
We refer to the process of taking a sequence of input tokens and generating a sequence of output tokens as a single generation call.
Throughout this process, each token generates some intermediate tensors, which are used for decoding further tokens.
These intermediate tensors, known as the "KV Cache", are named for the key-value pairs in the self-attention mechanism.
An observation that will be important when discussing optimizations later is that the computation of the KV cache only depends on all previous tokens, so different sequences with the same prefix can reuse the KV cache of the prefix tokens and avoid redundant computation.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S2.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.2
    </span>
    The Paradigm of Programming LLMs
   </h3>
   <div class="ltx_para" id="S2.SS2.p1">
    <p class="ltx_p" id="S2.SS2.p1.1">
     As LLMs become more powerful, they are increasingly employed as versatile task solvers in complex systems. In these contexts, it is imperative that LLMs operate as dependable and intelligent components.
This evolves the use of LLMs from single, straightforward generation calls to multiple, interdependent generation calls interleaved with control flow, leading to the emergence of the "Programming LLMs" paradigm.
Programming LLMs refers to the development of computer programs that control the generation processes of LLMs. This concept can be exemplified in several ways.
    </p>
   </div>
   <div class="ltx_para" id="S2.SS2.p2">
    <p class="ltx_p" id="S2.SS2.p2.1">
     First, advanced prompting techniques are examples of programming LLMs. An exemplary case is meta-reasoning
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib73" title="">
       73
      </a>
      ]
     </cite>
     . To solve a problem, the LLM initially generates multiple solutions through chain-of-thought prompting. It then performs meta-reasoning across these solutions to derive the final resolution. Another example is skeleton-of-thought
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib37" title="">
       37
      </a>
      ]
     </cite>
     . To answer a question, the LLM first generates a skeleton of the answer. It then issues multiple parallel calls to elaborate the skeleton into a detailed explanation. A more complex case is the tree-of-thought approach
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib70" title="">
       70
      </a>
      ]
     </cite>
     , which integrates LLM calls within tree search algorithms (e.g., breadth-first search).
    </p>
   </div>
   <div class="ltx_para" id="S2.SS2.p3">
    <p class="ltx_p" id="S2.SS2.p3.1">
     Second, in LLM-based agents, the programmatic use of LLMs is crucial. Take the ReAct agent
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib71" title="">
       71
      </a>
      ]
     </cite>
     , for example. The behavior of the agent is controlled by loops and conditional statements. The agent performs one action per iteration. In each iteration, the agent chooses the action type (search or finish), generates action parameters, and processes observations from the external environment.
    </p>
   </div>
   <div class="ltx_para" id="S2.SS2.p4">
    <p class="ltx_p" id="S2.SS2.p4.1">
     Third, simpler prompting forms also fall under the scope of programming LLMs. Techniques like few-shot prompting
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib5" title="">
       5
      </a>
      ]
     </cite>
     , chain-of-thought prompting
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib64" title="">
       64
      </a>
      ]
     </cite>
     , and retrieval-augmented generation
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib26" title="">
       26
      </a>
      ]
     </cite>
     are basic elements in programming LLMs.
    </p>
   </div>
   <figure class="ltx_figure" id="S2.F2">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="665" id="S2.F2.g1" src="/html/2312.07104/assets/x2.png" width="461"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      <span class="ltx_text" id="S2.F2.2.1.1" style="font-size:90%;">
       Figure 2
      </span>
      :
     </span>
     <span class="ltx_text" id="S2.F2.3.2" style="font-size:90%;">
      KV cache sharing examples. Blue boxes represent shareable prompt parts, green boxes indicate non-shareable parts, and yellow boxes mark non-shareable model outputs. Shareable elements include few-shot learning examples, questions in self-consistency
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib63" title="">
        63
       </a>
       ]
      </cite>
      , chat history in multi-turn chats, and search history in tree-of-thought
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib70" title="">
        70
       </a>
       ]
      </cite>
      .
     </span>
    </figcaption>
   </figure>
   <figure class="ltx_table" id="S2.T1">
    <table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S2.T1.2">
     <thead class="ltx_thead">
      <tr class="ltx_tr" id="S2.T1.2.3.1">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S2.T1.2.3.1.1">
        <span class="ltx_text" id="S2.T1.2.3.1.1.1" style="font-size:80%;">
         Language
        </span>
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S2.T1.2.3.1.2">
        <span class="ltx_text" id="S2.T1.2.3.1.2.1" style="font-size:80%;">
         Syntax
        </span>
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S2.T1.2.3.1.3">
        <span class="ltx_text" id="S2.T1.2.3.1.3.1" style="font-size:80%;">
         Primitives
        </span>
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S2.T1.2.3.1.4">
        <span class="ltx_text" id="S2.T1.2.3.1.4.1" style="font-size:80%;">
         Runtime Backends
        </span>
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S2.T1.2.3.1.5">
        <span class="ltx_text" id="S2.T1.2.3.1.5.1" style="font-size:80%;">
         Execution Modes
        </span>
       </th>
      </tr>
     </thead>
     <tbody class="ltx_tbody">
      <tr class="ltx_tr" id="S2.T1.2.4.1">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S2.T1.2.4.1.1">
        <span class="ltx_text" id="S2.T1.2.4.1.1.1" style="font-size:80%;">
         LMQL
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_t" id="S2.T1.2.4.1.2">
        <span class="ltx_text" id="S2.T1.2.4.1.2.1" style="font-size:80%;">
         Custom
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_t" id="S2.T1.2.4.1.3">
        <span class="ltx_text" id="S2.T1.2.4.1.3.1" style="font-size:80%;">
         extend, gen, select
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_t" id="S2.T1.2.4.1.4">
        <span class="ltx_text" id="S2.T1.2.4.1.4.1" style="font-size:80%;">
         Hugging Face Transformers, llama.cpp, OpenAI
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_t" id="S2.T1.2.4.1.5">
        <span class="ltx_text" id="S2.T1.2.4.1.5.1" style="font-size:80%;">
         Compiler
        </span>
       </td>
      </tr>
      <tr class="ltx_tr" id="S2.T1.2.5.2">
       <td class="ltx_td ltx_align_left" id="S2.T1.2.5.2.1">
        <span class="ltx_text" id="S2.T1.2.5.2.1.1" style="font-size:80%;">
         Guidance
        </span>
       </td>
       <td class="ltx_td ltx_align_left" id="S2.T1.2.5.2.2">
        <span class="ltx_text" id="S2.T1.2.5.2.2.1" style="font-size:80%;">
         Python
        </span>
       </td>
       <td class="ltx_td ltx_align_left" id="S2.T1.2.5.2.3">
        <span class="ltx_text" id="S2.T1.2.5.2.3.1" style="font-size:80%;">
         extend, gen, select
        </span>
       </td>
       <td class="ltx_td ltx_align_left" id="S2.T1.2.5.2.4">
        <span class="ltx_text" id="S2.T1.2.5.2.4.1" style="font-size:80%;">
         Hugging Face Transformers, llama.cpp, OpenAI, VertexAI
        </span>
       </td>
       <td class="ltx_td ltx_align_left" id="S2.T1.2.5.2.5">
        <span class="ltx_text" id="S2.T1.2.5.2.5.1" style="font-size:80%;">
         Interpreter
        </span>
       </td>
      </tr>
      <tr class="ltx_tr" id="S2.T1.2.2">
       <td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S2.T1.2.2.3">
        <span class="ltx_text" id="S2.T1.2.2.3.1" style="font-size:80%;">
         SGLang
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S2.T1.2.2.4">
        <span class="ltx_text" id="S2.T1.2.2.4.1" style="font-size:80%;">
         Python
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S2.T1.2.2.5">
        <span class="ltx_text" id="S2.T1.2.2.5.1" style="font-size:80%;">
         extend, gen, select, fork, join
        </span>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S2.T1.2.2.2">
        <span class="ltx_text" id="S2.T1.2.2.2.1" style="font-size:80%;">
         SGVM, OpenAI, Anthropic, Hugging Face TGI
        </span>
        <sup class="ltx_sup" id="S2.T1.2.2.2.2">
         <span class="ltx_text" id="S2.T1.2.2.2.2.1" style="font-size:80%;">
          ∗
         </span>
        </sup>
        <span class="ltx_text" id="S2.T1.2.2.2.3" style="font-size:80%;">
         , llama.cpp
        </span>
        <sup class="ltx_sup" id="S2.T1.2.2.2.4">
         <span class="ltx_text" id="S2.T1.2.2.2.4.1" style="font-size:80%;">
          ∗
         </span>
        </sup>
       </td>
       <td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S2.T1.2.2.6">
        <span class="ltx_text" id="S2.T1.2.2.6.1" style="font-size:80%;">
         Interpreter and compiler
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <figcaption class="ltx_caption ltx_centering" style="font-size:80%;">
     <span class="ltx_tag ltx_tag_table">
      <span class="ltx_text" id="S2.T1.10.2.1" style="font-size:113%;">
       Table 1
      </span>
      :
     </span>
     <span class="ltx_text" id="S2.T1.4.1" style="font-size:113%;">
      Comparison among LMQL, Guidance, and SGLang. The backends marked with
      <sup class="ltx_sup" id="S2.T1.4.1.1">
       ∗
      </sup>
      are experimental.
     </span>
    </figcaption>
   </figure>
  </section>
  <section class="ltx_subsection" id="S2.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.3
    </span>
    Challenges and Opportunities
   </h3>
   <div class="ltx_para" id="S2.SS3.p1">
    <p class="ltx_p" id="S2.SS3.p1.1">
     Designing programming systems for LLMs presents unique challenges and opportunities.
A good system should help a programmer be productive, offering an intuitive and expressive interface for common programming tasks, including LLM state management, decoding process control, and smooth integration with external tools.
Furthermore, it is essential to ensure performance by optimizing for low latency and high throughput execution.
In particular, the rich structure of LLM programs and the unique properties of LLM inference provide plenty of opportunities for runtime optimizations. These include:
    </p>
   </div>
   <div class="ltx_para" id="S2.SS3.p2">
    <ul class="ltx_itemize" id="S2.I1">
     <li class="ltx_item" id="S2.I1.i1" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S2.I1.i1.p1">
       <p class="ltx_p" id="S2.I1.i1.p1.1">
        <span class="ltx_text ltx_font_bold" id="S2.I1.i1.p1.1.1">
         Caching:
        </span>
        Often in LLM programs, multiple text segments and generation calls are appended to a single prompt. Caching the computed KV cache for previous tokens across multiple chained calls can reduce redundant computation. This optimization, however, is neither free nor trivial, as it requires additional storage and more complex memory management.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S2.I1.i2" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S2.I1.i2.p1">
       <p class="ltx_p" id="S2.I1.i2.p1.1">
        <span class="ltx_text ltx_font_bold" id="S2.I1.i2.p1.1.1">
         Batching:
        </span>
        The decoding process in LLMs is primarily memory-bound, meaning increasing the batch size can significantly enhance throughput. Running a large number of LLM programs in a batch, and utilizing the contiguous batching technique
        <cite class="ltx_cite ltx_citemacro_cite">
         [
         <a class="ltx_ref" href="#bib.bib74" title="">
          74
         </a>
         ]
        </cite>
        can be beneficial.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S2.I1.i3" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S2.I1.i3.p1">
       <p class="ltx_p" id="S2.I1.i3.p1.1">
        <span class="ltx_text ltx_font_bold" id="S2.I1.i3.p1.1.1">
         Sharing:
        </span>
        It is common in LLM programs to generate multiple outputs from a single prompt or to fork a new prompt from the current state. Basic prefix sharing has been investigated in vLLM
        <cite class="ltx_cite ltx_citemacro_cite">
         [
         <a class="ltx_ref" href="#bib.bib23" title="">
          23
         </a>
         ]
        </cite>
        . More advanced sharing patterns like irregular tree-structured sharing can also be employed.
        <a class="ltx_ref ltx_refmacro_autoref" href="#S2.F2" title="Figure 2 ‣ 2.2 The Paradigm of Programming LLMs ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
         <span class="ltx_text ltx_ref_tag">
          Figure 2
         </span>
        </a>
        shows four typical patterns of KV cache sharing across multiple calls; none of the existing systems can automatically handle all of them.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S2.I1.i4" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S2.I1.i4.p1">
       <p class="ltx_p" id="S2.I1.i4.p1.1">
        <span class="ltx_text ltx_font_bold" id="S2.I1.i4.p1.1.1">
         Parallelism:
        </span>
        An LLM program often includes multiple generation calls. By creating a dependency graph for these calls, we can identify independent calls and execute them in parallel. This creates intra-program parallelism, which adds additional parallelism to the straightforward inter-program parallelism.
For example, in
        <a class="ltx_ref ltx_refmacro_autoref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Efficiently Programming Large Language Models using SGLang">
         <span class="ltx_text ltx_ref_tag">
          Figure 1
         </span>
        </a>
        , the generation of multiple judgments can be parallelized.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S2.I1.i5" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S2.I1.i5.p1">
       <p class="ltx_p" id="S2.I1.i5.p1.1">
        <span class="ltx_text ltx_font_bold" id="S2.I1.i5.p1.1.1">
         Compilation:
        </span>
        Once a full program is available, it can be compiled into an optimized intermediate representation for more efficient execution. More aggressive optimizations can also be implemented, such as automatically adjusting the original prompts based on user-provided test cases. These optimizations may include expanding, compressing, rearranging parts of the prompts, and selecting different models for different calls.
       </p>
      </div>
     </li>
    </ul>
   </div>
   <div class="ltx_para" id="S2.SS3.p3">
    <p class="ltx_p" id="S2.SS3.p3.1">
     To systematically explore these opportunities, it is essential to co-design the programming interface and runtime. However, inference engines like Orca and vLLM fall short, as they optimize only for single generation calls. This limitation leads to redundant computations and missed opportunities when executing LLM programs that involve multiple calls.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S2.SS4">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.4
    </span>
    Existing LLM Programming Systems
   </h3>
   <div class="ltx_para" id="S2.SS4.p1">
    <p class="ltx_p" id="S2.SS4.p1.1">
     Given the significance of LLM programming, specialized programming systems have been developed. The top layer comprises high-level application development libraries with pre-built modules, such as LangChain
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib24" title="">
       24
      </a>
      ]
     </cite>
     . The middle layer features more flexible pipeline programming frameworks like DSPy
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib21" title="">
       21
      </a>
      ]
     </cite>
     . At the bottom layer, there are domain-specific languages designed for controlling a single prompt, including LMQL
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib4" title="">
       4
      </a>
      ]
     </cite>
     and Guidance
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib16" title="">
       16
      </a>
      ]
     </cite>
     .
    </p>
   </div>
   <div class="ltx_para" id="S2.SS4.p2">
    <p class="ltx_p" id="S2.SS4.p2.1">
     SGLang, uniquely positioned between the middle and bottom layers, shares similarities with LMQL and Guidance. However, unlike LMQL and Guidance, which primarily focus on language design while often overlooking runtime efficiency, SGLang thoughtfully integrates front-end language features with back-end runtime optimizations. This approach significantly enhances runtime efficiency, sometimes by an order of magnitude or more.
For its front-end, LMQL employs an SQL-like custom syntax, contrasting with the more intuitive Python syntax. Guidance initially used the Handlebars template language and later transitioned to a Pythonic language embedded within Python. The front-end language of SGLang, inspired by Guidance, is being developed concurrently with the new version of Guidance.
    </p>
   </div>
   <div class="ltx_para" id="S2.SS4.p3">
    <p class="ltx_p" id="S2.SS4.p3.1">
     SGLang introduces new primitives for enhanced expressiveness and runtime efficiency. It also offers the flexibility of both interpreter and compiler modes. A comparison among LMQL, Guidance, and SGLang is presented in
     <a class="ltx_ref ltx_refmacro_autoref" href="#S2.T1" title="Table 1 ‣ 2.2 The Paradigm of Programming LLMs ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Table 1
      </span>
     </a>
     . We omit the comparison with LangChain and DSPy because they are at a higher level. It is possible to compile high-level pipelines from LangChain and DSPy to SGLang.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S3">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    3
   </span>
   Overview
  </h2>
  <div class="ltx_para" id="S3.p1">
   <p class="ltx_p" id="S3.p1.1">
    <a class="ltx_ref ltx_refmacro_autoref" href="#S3.F3" title="Figure 3 ‣ 3 Overview ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Figure 3
     </span>
    </a>
    shows an overview of our system.
At the user level, SGLang programs are written in Python with embedded SGLang primitives for managing prompts and generation calls.
The syntax and primitives of SGLang will be introduced in
    <a class="ltx_ref ltx_refmacro_autoref" href="#S4.SS1" title="4.1 Syntax and Primitives ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 4.1
     </span>
    </a>
    .
SGLang programs can be executed in two ways: either using an interpreter or a compiler. When using the interpreter, SGLang programs, which are also valid Python programs, are processed by both the Python and SGLang interpreters. The SGLang interpreter handles specific SGLang primitives.
The design of this interpreter is explained in
    <a class="ltx_ref ltx_refmacro_autoref" href="#S4.SS2" title="4.2 Interpreter ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 4.2
     </span>
    </a>
    .
Alternatively, a limited set of SGLang programs can be compiled, enabling further optimizations.
    <a class="ltx_ref ltx_refmacro_autoref" href="#S4.SS3" title="4.3 Compiler ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 4.3
     </span>
    </a>
    is dedicated to the SGLang compiler.
Both the interpreter and the compiler work with the SGVM, which is our custom serving engine for LLM generation calls (
    <a class="ltx_ref ltx_refmacro_autoref" href="#S5" title="5 Runtime with RadixAttention ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 5
     </span>
    </a>
    ).
A key aspect of SGVM is its RadixAttention feature, which automatically reuses KV caches across multiple calls.
   </p>
  </div>
  <figure class="ltx_figure" id="S3.F3">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="84" id="S3.F3.g1" src="/html/2312.07104/assets/x3.png" width="461"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     <span class="ltx_text" id="S3.F3.2.1.1" style="font-size:90%;">
      Figure 3
     </span>
     :
    </span>
    <span class="ltx_text" id="S3.F3.3.2" style="font-size:90%;">
     The overview of the system.
    </span>
   </figcaption>
  </figure>
 </section>
 <section class="ltx_section" id="S4">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    4
   </span>
   Language, Interpreter, and Compiler
  </h2>
  <section class="ltx_subsection" id="S4.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.1
    </span>
    Syntax and Primitives
   </h3>
   <div class="ltx_para" id="S4.SS1.p1">
    <p class="ltx_p" id="S4.SS1.p1.1">
     SGLang is implemented as an embedded domain-specific language in Python.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS1.p2">
    <p class="ltx_p" id="S4.SS1.p2.1">
     <a class="ltx_ref ltx_refmacro_autoref" href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Figure 1
      </span>
     </a>
     shows an example of a SGLang program.
This program evaluates the quality of an essay from multiple dimensions using the branch-solve-merge prompting method
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib48" title="">
       48
      </a>
      ]
     </cite>
     .
The function
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p2.1.1">
      essay_judge
     </span>
     takes two arguments:
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p2.1.2">
      s
     </span>
     and
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p2.1.3">
      essay
     </span>
     .
The variable
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p2.1.4">
      s
     </span>
     manages the state of a prompt, allowing new strings and SGLang primitives to be appended using
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p2.1.5">
      +=
     </span>
     .
In the function, it first adds the essay to the prompt, and then forks the prompt into three copies.
These forks run in parallel, generating judgments from different dimensions.
Finally, it merges these judgments, generates a summary, and assigns a letter grade to the essay.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS1.p3">
    <p class="ltx_p" id="S4.SS1.p3.1">
     <a class="ltx_ref ltx_refmacro_autoref" href="#S4.F4" title="Figure 4 ‣ 4.2 Interpreter ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Figure 4
      </span>
     </a>
     presents another example.
This program generates two tips in parallel for a given topic using the skeleton-of-thought prompting method
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib37" title="">
       37
      </a>
      ]
     </cite>
     .
It employs two functions:
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p3.1.1">
      expand
     </span>
     , which elaborates a short tip into a detailed paragraph, and
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p3.1.2">
      tip_suggestion
     </span>
     , which orchestrates the entire process.
It first generates two short tips and then calls
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p3.1.3">
      expand
     </span>
     to elaborate them in parallel.
Finally, it generates a summary.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS1.p4">
    <p class="ltx_p" id="S4.SS1.p4.1">
     These examples illustrate the use of SGLang. In SGLang, we provide the following primitives:
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.1">
      gen
     </span>
     for calling LLM generation,
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.2">
      select
     </span>
     for letting the LLM choose the option with the highest probability from a list,
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.3">
      +=
     </span>
     or
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.4">
      extend
     </span>
     for extending the current prompt,
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.5">
      fork
     </span>
     for forking the current prompt state, and
     <span class="ltx_text ltx_font_typewriter" id="S4.SS1.p4.1.6">
      join
     </span>
     for rejoining the forked prompt states.
Users can interleave these primitives with arbitrary Python control flow and libraries.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S4.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.2
    </span>
    Interpreter
   </h3>
   <div class="ltx_para" id="S4.SS2.p1">
    <p class="ltx_p" id="S4.SS2.p1.1">
     The most basic way to execute a SGLang program is through an interpreter. In SGLang, a prompt is treated as an asynchronous stream. Executing primitives such as extend, gen, and select on a prompt leads to the interpreter submitting these primitives into the stream for asynchronous execution. These submission calls are non-blocking, allowing the Python interpreter to continue executing Python code without waiting for the LLM generation to finish. This process is akin to launching CUDA kernels to CUDA streams asynchronously. Each prompt is managed by a stream executor in a background thread, enabling users to achieve parallelism.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS2.p2">
    <p class="ltx_p" id="S4.SS2.p2.1">
     When fetching the generation results from a prompt, the fetch action will be blocked until the desired generation results are ready. This is implemented using event mechanisms, where a generation call sets an event upon producing its output. Thus, the interpreter effectively manages intra-program parallelism and synchronization.
    </p>
   </div>
   <figure class="ltx_figure" id="S4.F4">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="448" id="S4.F4.g1" src="/html/2312.07104/assets/x4.png" width="461"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      <span class="ltx_text" id="S4.F4.2.1.1" style="font-size:90%;">
       Figure 4
      </span>
      :
     </span>
     <span class="ltx_text" id="S4.F4.3.2" style="font-size:90%;">
      The SGLang program for parallel tip suggestion with skeleton-of-thought prompting.
     </span>
    </figcaption>
   </figure>
  </section>
  <section class="ltx_subsection" id="S4.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.3
    </span>
    Compiler
   </h3>
   <figure class="ltx_figure" id="S4.F5">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="466" id="S4.F5.g1" src="/html/2312.07104/assets/x5.png" width="392"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      <span class="ltx_text" id="S4.F5.2.1.1" style="font-size:90%;">
       Figure 5
      </span>
      :
     </span>
     <span class="ltx_text" id="S4.F5.3.2" style="font-size:90%;">
      A computational graph for the program in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S4.F4" title="Figure 4 ‣ 4.2 Interpreter ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 4
       </span>
      </a>
      . The three streams correspond to three function calls.
     </span>
    </figcaption>
   </figure>
   <div class="ltx_para" id="S4.SS3.p1">
    <p class="ltx_p" id="S4.SS3.p1.1">
     Another way to run SGLang programs is to compile them as computational graphs and run them with a graph executor. This opens the opportunity for more compilation optimizations, as we can rewrite the graph.
    </p>
   </div>
   <section class="ltx_subsubsection" id="S4.SS3.SSS1">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      4.3.1
     </span>
     Tracing and Graph Executor
    </h4>
    <div class="ltx_para" id="S4.SS3.SSS1.p1">
     <p class="ltx_p" id="S4.SS3.SSS1.p1.1">
      We design an intermediate representation (IR) for SGLang, representing SGLang program structures and operations as a computational graph.
This graph includes nodes for primitive operators and edges for dependencies. See
      <a class="ltx_ref ltx_refmacro_autoref" href="#S4.F5" title="Figure 5 ‣ 4.3 Compiler ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 5
       </span>
      </a>
      for the graph corresponding to the program in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S4.F4" title="Figure 4 ‣ 4.2 Interpreter ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 4
       </span>
      </a>
      .
In the program, each call to a decorated function and or fork will create a new prompt state, or a stream.
     </p>
    </div>
    <div class="ltx_para" id="S4.SS3.SSS1.p2">
     <p class="ltx_p" id="S4.SS3.SSS1.p2.1">
      There are several types of nodes. Each operand of
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.1">
       +=
      </span>
      and
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.2">
       +
      </span>
      in a SGLang program is represented by an IR node. These include
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.3">
       ConstantText
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.4">
       Argument
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.5">
       Gen
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.6">
       Select
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.7">
       Variable
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.8">
       Fork
      </span>
      ,
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.9">
       GetForkItem
      </span>
      , and
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.10">
       Join
      </span>
      .
There are two types of dependencies.
The first is intra-stream dependency, where operations submitted into a stream using
      <span class="ltx_text ltx_font_typewriter" id="S4.SS3.SSS1.p2.1.11">
       +=
      </span>
      must be executed after all preceding operations in that stream. The second is inter-stream dependency, which occurs when one stream needs to fetch variable values from another stream, necessitating synchronization. Operations like fork manipulate multiple streams and thus introduce inter-stream dependencies.
     </p>
    </div>
    <div class="ltx_para" id="S4.SS3.SSS1.p3">
     <p class="ltx_p" id="S4.SS3.SSS1.p3.1">
      To generate the graph, we use tracing to run the program with abstract arguments and construct the graph dynamically.
This method is limited to programs without data-dependent control flow, a limitation we plan to address in future work.
Once constructed, the graph can be executed through a graph executor, eliminating the need to reinterpret the original Python program. This results in benefits like graph rewriting optimizations, reduced runtime overhead, and program serialization.
For execution, stream executors are launched for each data stream, dispatching IR nodes to the streams in topological order.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S4.SS3.SSS2">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      4.3.2
     </span>
     Compilation Optimizations
    </h4>
    <div class="ltx_para" id="S4.SS3.SSS2.p1">
     <p class="ltx_p" id="S4.SS3.SSS2.p1.1">
      We explore two compilation optimizations for SGLang IR. The first one is noteworthy as it integrates GPT-4 into compiler optimization processes. The second one is more conventional.
We anticipate more classical compiler techniques can also be applied, such as auto-tuning and instruction selection.
     </p>
    </div>
    <div class="ltx_para" id="S4.SS3.SSS2.p2">
     <p class="ltx_p" id="S4.SS3.SSS2.p2.1">
      <span class="ltx_text ltx_font_bold" id="S4.SS3.SSS2.p2.1.1">
       Code Movement for Improving Prefix Sharing.
      </span>
      This optimization aims to improve prefix sharing by reordering nodes in the graph to increase the length of the constant prefix. It does not strictly preserve the original computation, classifying it as an aggressive optimization. For instance, changing the prompt from
“Here is a question + {question}. Please act as a math expert and solve the given question” to “Please act as a math expert and solve the given question. Here is a question + {question}.”
results in a longer sharable prefix.
This optimization is interesting because traditional program analysis cannot achieve it, due to the presence of natural language instructions in SGLang. Instead, we prompt GPT-4 to reorder graph nodes. We write a prompt with several examples to teach GPT-4 the concepts of SGLang IR, and we find that GPT-4 can successfully apply this optimization for some simple SGLang programs.
     </p>
    </div>
    <div class="ltx_para" id="S4.SS3.SSS2.p3">
     <p class="ltx_p" id="S4.SS3.SSS2.p3.1">
      <span class="ltx_text ltx_font_bold" id="S4.SS3.SSS2.p3.1.1">
       Prefetching Annotations.
      </span>
      This involves automatically adding prefetching nodes to the graph, signaling the runtime to move the cached KV cache from the CPU to the GPU if the cache exists for a long prompt. This can reduce the latency for pipelines with long prompts.
     </p>
    </div>
    <figure class="ltx_figure" id="S4.F6">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="368" id="S4.F6.g1" src="/html/2312.07104/assets/x6.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S4.F6.2.1.1" style="font-size:90%;">
        Figure 6
       </span>
       :
      </span>
      <span class="ltx_text" id="S4.F6.3.2" style="font-size:90%;">
       Examples of RadixAttention operations with an LRU eviction policy, illustrated across nine time points.
The figure demonstrates the dynamic evolution of the radix tree in response to various requests. These requests include two chat sessions, a batch of few-shot learning inquiries, and a self-consistency sampling.
Each tree edge carries a label denoting a substring or a sequence of tokens. The nodes are color-coded to reflect different states: green for newly added nodes, blue for cached nodes accessed during the time point, and red for nodes that have been evicted.
In step (1), the radix tree is initially empty.
In step (2), the server processes an incoming user message "Hello" and responds with the LLM output "Hi". The system prompt "You are a helpful assistant", the user message "Hello!", and the LLM reply "Hi!" are consolidated into the tree as a single edge linked to a new node.
In step (3), a new prompt arrives and the server finds the prefix of the prompt (i.e., the first turn of the conversation) in the radix tree and reuses its KV cache. The new turn is appended to the tree as a new node.
In step (4), a new chat session begins. The node “b” from (3) is split into two nodes to allow the two chat sessions to share the system prompt.
In step (5), the second chat session continues. However, due to the memory limit, node "c" from (4) must be evicted. The new turn is appended after node "d" in (4).
In step (6), the server receives a few-shot learning query, processes it, and inserts it into the tree. The root node is split because the new query does not share any prefix with existing nodes.
In step (7), the server receives a batch of additional few-shot learning queries. These queries share the same set of few-shot examples, so we split node ’e’ from (6) to enable sharing.
In step (8), the server receives a new message from the first chat session. It evicts all nodes from the second chat session (node "g" and "h") as they are least recently used.
In step (9), the server receives a request to sample more answers for the questions in node "j" from (8), likely for self-consistency prompting. To make space for these requests, we evict node "i", "k", and "l" in (8)."
      </span>
     </figcaption>
    </figure>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S5">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    5
   </span>
   Runtime with RadixAttention
  </h2>
  <div class="ltx_para" id="S5.p1">
   <p class="ltx_p" id="S5.p1.1">
    The primary challenge in optimizing the execution of SGLang programs lies in reusing the KV cache across multiple calls and programs, as discussed in
    <a class="ltx_ref ltx_refmacro_autoref" href="#S2.SS3" title="2.3 Challenges and Opportunities ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
     <span class="ltx_text ltx_ref_tag">
      Section 2.3
     </span>
    </a>
    . While some existing systems can handle KV cache reuse in certain scenarios, this often requires manual configurations and ad-hoc adjustments. However, even with manual configurations, no existing system can automatically handle all scenarios due to the variety of possible reuse patterns.
   </p>
  </div>
  <div class="ltx_para" id="S5.p2">
   <p class="ltx_p" id="S5.p2.1">
    This section introduces RadixAttention, a novel technique for automatic KV cache reuse during runtime. Instead of discarding the KV cache after finishing a generation request, our approach retains the KV cache for both prompts and generation results in a radix tree. This structure enables efficient prefix search, reuse, insertion, and eviction. We implement a Least Recently Used (LRU) eviction policy, complemented by a cache-aware scheduling policy, to enhance the cache hit rate.
Furthermore, RadixAttention is compatible with existing techniques like continuous batching and paged attention.
   </p>
  </div>
  <section class="ltx_subsection" id="S5.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.1
    </span>
    RadixAttention
   </h3>
   <div class="ltx_para" id="S5.SS1.p1">
    <p class="ltx_p" id="S5.SS1.p1.1">
     A radix tree is a data structure that serves as a space-efficient alternative to a trie (prefix tree). Unlike typical trees, the edges of a radix tree can be labeled with not just single elements, but also with sequences of elements of varying lengths.
This feature significantly boosts the efficiency of radix trees.
In our system, we utilize a radix tree to manage a mapping. This mapping is between sequences of tokens, which act as the keys, and their corresponding KV cache tensors, which serve as the values. These KV cache tensors are stored in a non-contiguous, paged layout, where the size of each page is equivalent to one token.
    </p>
   </div>
   <div class="ltx_para" id="S5.SS1.p2">
    <p class="ltx_p" id="S5.SS1.p2.1">
     Considering the limited capacity of GPU memory, we cannot retrain infinite KV cache tensors, which necessitates an eviction policy. To tackle this, we implement an LRU eviction policy that recursively evicts leaf nodes.
In the continuous batching setting, we cannot evict nodes that are being used by the currently running batch. Therefore, each node maintains a reference counter indicating how many running requests are using it. A node is evictable if its reference counter is zero.
    </p>
   </div>
   <div class="ltx_para" id="S5.SS1.p3">
    <p class="ltx_p" id="S5.SS1.p3.1">
     The front end always sends full prompts to the runtime and the runtime will automatically do prefix matching, reuse, and caching.
     <a class="ltx_ref ltx_refmacro_autoref" href="#S4.F6" title="Figure 6 ‣ 4.3.2 Compilation Optimizations ‣ 4.3 Compiler ‣ 4 Language, Interpreter, and Compiler ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Figure 6
      </span>
     </a>
     illustrates how the radix tree is maintained when processing several incoming requests.
The tree structure is stored on the CPU and the maintenance overhead is small.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S5.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.2
    </span>
    Cache-Aware Scheduling
   </h3>
   <div class="ltx_para" id="S5.SS2.p1">
    <p class="ltx_p" id="S5.SS2.p1.1">
     To increase the cache hit rate, the scheduler must be cache-aware. Otherwise, when a large batch of requests arrives, the scheduler may switch between different requests, leading to cache thrashing.
     <a class="ltx_ref ltx_refmacro_autoref" href="#alg1" title="Algorithm 1 ‣ 5.2 Cache-Aware Scheduling ‣ 5 Runtime with RadixAttention ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Algorithm 1
      </span>
     </a>
     presents the algorithm for cache-aware scheduling in RadixAttention with contiguous batching. The key idea is to sort the requests by matched prefix length, as opposed to adhering to a first-come-first-serve schedule.
There are further opportunities for the implementation of more advanced scheduling strategies that assign priority based on the weights of subtrees. Essentially, this would involve counting the total number of requests within each sub-tree(prefix-sharing trees) and even considering requests that have been historically evicted. The weighted priority can fully utilize the tree-shape locality of some LLM tasks such as tree-of-thought
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib70" title="">
       70
      </a>
      ]
     </cite>
     , making the least redundant evictions.
    </p>
   </div>
   <figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_float">
      <span class="ltx_text ltx_font_bold" id="alg1.2.1.1">
       Algorithm 1
      </span>
     </span>
     Cache-Aware Scheduling for RadixAttention with Continuous Batching.
    </figcaption>
    <div class="ltx_listing ltx_listing" id="alg1.3">
     <div class="ltx_listingline" id="alg1.l1">
      The radix tree
      <math alttext="T" class="ltx_Math" display="inline" id="alg1.l1.m1.1">
       <semantics id="alg1.l1.m1.1a">
        <mi id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml">
         T
        </mi>
        <annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b">
         <ci id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1">
          𝑇
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l1.m1.1c">
         T
        </annotation>
       </semantics>
      </math>
      , the memory pool
      <math alttext="P" class="ltx_Math" display="inline" id="alg1.l1.m2.1">
       <semantics id="alg1.l1.m2.1a">
        <mi id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml">
         P
        </mi>
        <annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b">
         <ci id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1">
          𝑃
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l1.m2.1c">
         P
        </annotation>
       </semantics>
      </math>
      , the current running batch
      <math alttext="B" class="ltx_Math" display="inline" id="alg1.l1.m3.1">
       <semantics id="alg1.l1.m3.1a">
        <mi id="alg1.l1.m3.1.1" xref="alg1.l1.m3.1.1.cmml">
         B
        </mi>
        <annotation-xml encoding="MathML-Content" id="alg1.l1.m3.1b">
         <ci id="alg1.l1.m3.1.1.cmml" xref="alg1.l1.m3.1.1">
          𝐵
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l1.m3.1c">
         B
        </annotation>
       </semantics>
      </math>
      , the waiting queue
      <math alttext="Q" class="ltx_Math" display="inline" id="alg1.l1.m4.1">
       <semantics id="alg1.l1.m4.1a">
        <mi id="alg1.l1.m4.1.1" xref="alg1.l1.m4.1.1.cmml">
         Q
        </mi>
        <annotation-xml encoding="MathML-Content" id="alg1.l1.m4.1b">
         <ci id="alg1.l1.m4.1.1.cmml" xref="alg1.l1.m4.1.1">
          𝑄
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l1.m4.1c">
         Q
        </annotation>
       </semantics>
      </math>
      .
     </div>
     <div class="ltx_listingline" id="alg1.l2">
      Finished requests and updated system state.
     </div>
     <div class="ltx_listingline" id="alg1.l3">
      <span class="ltx_text" id="alg1.l3.1">
       // Get all requests from the waiting queue
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l4">
      <math alttext="requests\leftarrow Q.\text{get\_all\_requests}()" class="ltx_Math" display="inline" id="alg1.l4.m1.2">
       <semantics id="alg1.l4.m1.2a">
        <mrow id="alg1.l4.m1.2.2.2" xref="alg1.l4.m1.2.2.3.cmml">
         <mrow id="alg1.l4.m1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.cmml">
          <mrow id="alg1.l4.m1.1.1.1.1.2" xref="alg1.l4.m1.1.1.1.1.2.cmml">
           <mi id="alg1.l4.m1.1.1.1.1.2.2" xref="alg1.l4.m1.1.1.1.1.2.2.cmml">
            r
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.3" xref="alg1.l4.m1.1.1.1.1.2.3.cmml">
            e
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.4" xref="alg1.l4.m1.1.1.1.1.2.4.cmml">
            q
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.5" xref="alg1.l4.m1.1.1.1.1.2.5.cmml">
            u
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.6" xref="alg1.l4.m1.1.1.1.1.2.6.cmml">
            e
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.7" xref="alg1.l4.m1.1.1.1.1.2.7.cmml">
            s
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.8" xref="alg1.l4.m1.1.1.1.1.2.8.cmml">
            t
           </mi>
           <mo id="alg1.l4.m1.1.1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l4.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l4.m1.1.1.1.1.2.9" xref="alg1.l4.m1.1.1.1.1.2.9.cmml">
            s
           </mi>
          </mrow>
          <mo id="alg1.l4.m1.1.1.1.1.1" stretchy="false" xref="alg1.l4.m1.1.1.1.1.1.cmml">
           ←
          </mo>
          <mi id="alg1.l4.m1.1.1.1.1.3" xref="alg1.l4.m1.1.1.1.1.3.cmml">
           Q
          </mi>
         </mrow>
         <mo id="alg1.l4.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l4.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l4.m1.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.cmml">
          <mtext id="alg1.l4.m1.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2a.cmml">
           get_all_requests
          </mtext>
          <mo id="alg1.l4.m1.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l4.m1.2.2.2.2.1.cmml">
           ​
          </mo>
          <mrow id="alg1.l4.m1.2.2.2.2.3.2" xref="alg1.l4.m1.2.2.2.2.cmml">
           <mo id="alg1.l4.m1.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l4.m1.2.2.2.2.3.1.cmml">
            (
           </mo>
           <mo id="alg1.l4.m1.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l4.m1.2.2.2.2.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l4.m1.2b">
         <apply id="alg1.l4.m1.2.2.3.cmml" xref="alg1.l4.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l4.m1.2.2.3a.cmml" xref="alg1.l4.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l4.m1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1">
           <ci id="alg1.l4.m1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1">
            ←
           </ci>
           <apply id="alg1.l4.m1.1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.1.2">
            <times id="alg1.l4.m1.1.1.1.1.2.1.cmml" xref="alg1.l4.m1.1.1.1.1.2.1">
            </times>
            <ci id="alg1.l4.m1.1.1.1.1.2.2.cmml" xref="alg1.l4.m1.1.1.1.1.2.2">
             𝑟
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.3.cmml" xref="alg1.l4.m1.1.1.1.1.2.3">
             𝑒
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.4.cmml" xref="alg1.l4.m1.1.1.1.1.2.4">
             𝑞
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.5.cmml" xref="alg1.l4.m1.1.1.1.1.2.5">
             𝑢
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.6.cmml" xref="alg1.l4.m1.1.1.1.1.2.6">
             𝑒
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.7.cmml" xref="alg1.l4.m1.1.1.1.1.2.7">
             𝑠
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.8.cmml" xref="alg1.l4.m1.1.1.1.1.2.8">
             𝑡
            </ci>
            <ci id="alg1.l4.m1.1.1.1.1.2.9.cmml" xref="alg1.l4.m1.1.1.1.1.2.9">
             𝑠
            </ci>
           </apply>
           <ci id="alg1.l4.m1.1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.1.3">
            𝑄
           </ci>
          </apply>
          <apply id="alg1.l4.m1.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2">
           <times id="alg1.l4.m1.2.2.2.2.1.cmml" xref="alg1.l4.m1.2.2.2.2.1">
           </times>
           <ci id="alg1.l4.m1.2.2.2.2.2a.cmml" xref="alg1.l4.m1.2.2.2.2.2">
            <mtext id="alg1.l4.m1.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2">
             get_all_requests
            </mtext>
           </ci>
           <list id="alg1.l4.m1.2.2.2.2.3.1.cmml" xref="alg1.l4.m1.2.2.2.2.3.2.1">
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l4.m1.2c">
         requests\leftarrow Q.\text{get\_all\_requests}()
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l5">
      <span class="ltx_text" id="alg1.l5.1">
       // Search for the prefix matching for all waiting requests
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l6">
      <span class="ltx_text ltx_font_bold" id="alg1.l6.1">
       for
      </span>
      <math alttext="req\in requests" class="ltx_Math" display="inline" id="alg1.l6.m1.1">
       <semantics id="alg1.l6.m1.1a">
        <mrow id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml">
         <mrow id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml">
          <mi id="alg1.l6.m1.1.1.2.2" xref="alg1.l6.m1.1.1.2.2.cmml">
           r
          </mi>
          <mo id="alg1.l6.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.2.3" xref="alg1.l6.m1.1.1.2.3.cmml">
           e
          </mi>
          <mo id="alg1.l6.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.2.4" xref="alg1.l6.m1.1.1.2.4.cmml">
           q
          </mi>
         </mrow>
         <mo id="alg1.l6.m1.1.1.1" xref="alg1.l6.m1.1.1.1.cmml">
          ∈
         </mo>
         <mrow id="alg1.l6.m1.1.1.3" xref="alg1.l6.m1.1.1.3.cmml">
          <mi id="alg1.l6.m1.1.1.3.2" xref="alg1.l6.m1.1.1.3.2.cmml">
           r
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.3" xref="alg1.l6.m1.1.1.3.3.cmml">
           e
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.4" xref="alg1.l6.m1.1.1.3.4.cmml">
           q
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1b" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.5" xref="alg1.l6.m1.1.1.3.5.cmml">
           u
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1c" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.6" xref="alg1.l6.m1.1.1.3.6.cmml">
           e
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1d" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.7" xref="alg1.l6.m1.1.1.3.7.cmml">
           s
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1e" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.8" xref="alg1.l6.m1.1.1.3.8.cmml">
           t
          </mi>
          <mo id="alg1.l6.m1.1.1.3.1f" lspace="0em" rspace="0em" xref="alg1.l6.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l6.m1.1.1.3.9" xref="alg1.l6.m1.1.1.3.9.cmml">
           s
          </mi>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b">
         <apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1">
          <in id="alg1.l6.m1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1">
          </in>
          <apply id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2">
           <times id="alg1.l6.m1.1.1.2.1.cmml" xref="alg1.l6.m1.1.1.2.1">
           </times>
           <ci id="alg1.l6.m1.1.1.2.2.cmml" xref="alg1.l6.m1.1.1.2.2">
            𝑟
           </ci>
           <ci id="alg1.l6.m1.1.1.2.3.cmml" xref="alg1.l6.m1.1.1.2.3">
            𝑒
           </ci>
           <ci id="alg1.l6.m1.1.1.2.4.cmml" xref="alg1.l6.m1.1.1.2.4">
            𝑞
           </ci>
          </apply>
          <apply id="alg1.l6.m1.1.1.3.cmml" xref="alg1.l6.m1.1.1.3">
           <times id="alg1.l6.m1.1.1.3.1.cmml" xref="alg1.l6.m1.1.1.3.1">
           </times>
           <ci id="alg1.l6.m1.1.1.3.2.cmml" xref="alg1.l6.m1.1.1.3.2">
            𝑟
           </ci>
           <ci id="alg1.l6.m1.1.1.3.3.cmml" xref="alg1.l6.m1.1.1.3.3">
            𝑒
           </ci>
           <ci id="alg1.l6.m1.1.1.3.4.cmml" xref="alg1.l6.m1.1.1.3.4">
            𝑞
           </ci>
           <ci id="alg1.l6.m1.1.1.3.5.cmml" xref="alg1.l6.m1.1.1.3.5">
            𝑢
           </ci>
           <ci id="alg1.l6.m1.1.1.3.6.cmml" xref="alg1.l6.m1.1.1.3.6">
            𝑒
           </ci>
           <ci id="alg1.l6.m1.1.1.3.7.cmml" xref="alg1.l6.m1.1.1.3.7">
            𝑠
           </ci>
           <ci id="alg1.l6.m1.1.1.3.8.cmml" xref="alg1.l6.m1.1.1.3.8">
            𝑡
           </ci>
           <ci id="alg1.l6.m1.1.1.3.9.cmml" xref="alg1.l6.m1.1.1.3.9">
            𝑠
           </ci>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l6.m1.1c">
         req\in requests
        </annotation>
       </semantics>
      </math>
      <span class="ltx_text ltx_font_bold" id="alg1.l6.2">
       do
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l7">
      <math alttext="req.prefix\_node,req.prefix\_len\leftarrow" class="ltx_Math" display="inline" id="alg1.l7.m1.3">
       <semantics id="alg1.l7.m1.3a">
        <mrow id="alg1.l7.m1.3.3.3" xref="alg1.l7.m1.3.3.4.cmml">
         <mrow id="alg1.l7.m1.1.1.1.1" xref="alg1.l7.m1.1.1.1.1.cmml">
          <mi id="alg1.l7.m1.1.1.1.1.2" xref="alg1.l7.m1.1.1.1.1.2.cmml">
           r
          </mi>
          <mo id="alg1.l7.m1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l7.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l7.m1.1.1.1.1.3" xref="alg1.l7.m1.1.1.1.1.3.cmml">
           e
          </mi>
          <mo id="alg1.l7.m1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l7.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l7.m1.1.1.1.1.4" xref="alg1.l7.m1.1.1.1.1.4.cmml">
           q
          </mi>
         </mrow>
         <mo id="alg1.l7.m1.3.3.3.4" lspace="0em" rspace="0.167em" xref="alg1.l7.m1.3.3.4a.cmml">
          .
         </mo>
         <mrow id="alg1.l7.m1.2.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.3.cmml">
          <mrow id="alg1.l7.m1.2.2.2.2.1.1" xref="alg1.l7.m1.2.2.2.2.1.1.cmml">
           <mi id="alg1.l7.m1.2.2.2.2.1.1.2" xref="alg1.l7.m1.2.2.2.2.1.1.2.cmml">
            p
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.3" xref="alg1.l7.m1.2.2.2.2.1.1.3.cmml">
            r
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.4" xref="alg1.l7.m1.2.2.2.2.1.1.4.cmml">
            e
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.5" xref="alg1.l7.m1.2.2.2.2.1.1.5.cmml">
            f
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.6" xref="alg1.l7.m1.2.2.2.2.1.1.6.cmml">
            i
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.7" xref="alg1.l7.m1.2.2.2.2.1.1.7.cmml">
            x
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.8" mathvariant="normal" xref="alg1.l7.m1.2.2.2.2.1.1.8.cmml">
            _
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.9" xref="alg1.l7.m1.2.2.2.2.1.1.9.cmml">
            n
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.10" xref="alg1.l7.m1.2.2.2.2.1.1.10.cmml">
            o
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1h" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.11" xref="alg1.l7.m1.2.2.2.2.1.1.11.cmml">
            d
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.1.1.1i" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.1.1.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.1.1.12" xref="alg1.l7.m1.2.2.2.2.1.1.12.cmml">
            e
           </mi>
          </mrow>
          <mo id="alg1.l7.m1.2.2.2.2.2.3" xref="alg1.l7.m1.2.2.2.2.3.cmml">
           ,
          </mo>
          <mrow id="alg1.l7.m1.2.2.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.2.2.cmml">
           <mi id="alg1.l7.m1.2.2.2.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.2.2.2.cmml">
            r
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.2.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.2.2.3" xref="alg1.l7.m1.2.2.2.2.2.2.3.cmml">
            e
           </mi>
           <mo id="alg1.l7.m1.2.2.2.2.2.2.1a" lspace="0em" rspace="0em" xref="alg1.l7.m1.2.2.2.2.2.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.2.2.2.2.2.2.4" xref="alg1.l7.m1.2.2.2.2.2.2.4.cmml">
            q
           </mi>
          </mrow>
         </mrow>
         <mo id="alg1.l7.m1.3.3.3.5" lspace="0em" rspace="0.167em" xref="alg1.l7.m1.3.3.4a.cmml">
          .
         </mo>
         <mrow id="alg1.l7.m1.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.cmml">
          <mrow id="alg1.l7.m1.3.3.3.3.2" xref="alg1.l7.m1.3.3.3.3.2.cmml">
           <mi id="alg1.l7.m1.3.3.3.3.2.2" xref="alg1.l7.m1.3.3.3.3.2.2.cmml">
            p
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.3" xref="alg1.l7.m1.3.3.3.3.2.3.cmml">
            r
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1a" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.4" xref="alg1.l7.m1.3.3.3.3.2.4.cmml">
            e
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1b" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.5" xref="alg1.l7.m1.3.3.3.3.2.5.cmml">
            f
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1c" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.6" xref="alg1.l7.m1.3.3.3.3.2.6.cmml">
            i
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1d" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.7" xref="alg1.l7.m1.3.3.3.3.2.7.cmml">
            x
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1e" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.8" mathvariant="normal" xref="alg1.l7.m1.3.3.3.3.2.8.cmml">
            _
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1f" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.9" xref="alg1.l7.m1.3.3.3.3.2.9.cmml">
            l
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1g" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.10" xref="alg1.l7.m1.3.3.3.3.2.10.cmml">
            e
           </mi>
           <mo id="alg1.l7.m1.3.3.3.3.2.1h" lspace="0em" rspace="0em" xref="alg1.l7.m1.3.3.3.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l7.m1.3.3.3.3.2.11" xref="alg1.l7.m1.3.3.3.3.2.11.cmml">
            n
           </mi>
          </mrow>
          <mo id="alg1.l7.m1.3.3.3.3.1" stretchy="false" xref="alg1.l7.m1.3.3.3.3.1.cmml">
           ←
          </mo>
          <mi id="alg1.l7.m1.3.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.3.cmml">
          </mi>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l7.m1.3b">
         <apply id="alg1.l7.m1.3.3.4.cmml" xref="alg1.l7.m1.3.3.3">
          <csymbol cd="ambiguous" id="alg1.l7.m1.3.3.4a.cmml" xref="alg1.l7.m1.3.3.3.4">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l7.m1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1">
           <times id="alg1.l7.m1.1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1.1">
           </times>
           <ci id="alg1.l7.m1.1.1.1.1.2.cmml" xref="alg1.l7.m1.1.1.1.1.2">
            𝑟
           </ci>
           <ci id="alg1.l7.m1.1.1.1.1.3.cmml" xref="alg1.l7.m1.1.1.1.1.3">
            𝑒
           </ci>
           <ci id="alg1.l7.m1.1.1.1.1.4.cmml" xref="alg1.l7.m1.1.1.1.1.4">
            𝑞
           </ci>
          </apply>
          <list id="alg1.l7.m1.2.2.2.2.3.cmml" xref="alg1.l7.m1.2.2.2.2.2">
           <apply id="alg1.l7.m1.2.2.2.2.1.1.cmml" xref="alg1.l7.m1.2.2.2.2.1.1">
            <times id="alg1.l7.m1.2.2.2.2.1.1.1.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.1">
            </times>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.2.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.2">
             𝑝
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.3.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.3">
             𝑟
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.4.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.4">
             𝑒
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.5.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.5">
             𝑓
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.6.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.6">
             𝑖
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.7.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.7">
             𝑥
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.8.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.8">
             _
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.9.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.9">
             𝑛
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.10.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.10">
             𝑜
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.11.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.11">
             𝑑
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.1.1.12.cmml" xref="alg1.l7.m1.2.2.2.2.1.1.12">
             𝑒
            </ci>
           </apply>
           <apply id="alg1.l7.m1.2.2.2.2.2.2.cmml" xref="alg1.l7.m1.2.2.2.2.2.2">
            <times id="alg1.l7.m1.2.2.2.2.2.2.1.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.1">
            </times>
            <ci id="alg1.l7.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.2">
             𝑟
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.2.2.3.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.3">
             𝑒
            </ci>
            <ci id="alg1.l7.m1.2.2.2.2.2.2.4.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.4">
             𝑞
            </ci>
           </apply>
          </list>
          <apply id="alg1.l7.m1.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3">
           <ci id="alg1.l7.m1.3.3.3.3.1.cmml" xref="alg1.l7.m1.3.3.3.3.1">
            ←
           </ci>
           <apply id="alg1.l7.m1.3.3.3.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.2">
            <times id="alg1.l7.m1.3.3.3.3.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.2.1">
            </times>
            <ci id="alg1.l7.m1.3.3.3.3.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.2.2">
             𝑝
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.2.3">
             𝑟
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.4.cmml" xref="alg1.l7.m1.3.3.3.3.2.4">
             𝑒
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.5.cmml" xref="alg1.l7.m1.3.3.3.3.2.5">
             𝑓
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.6.cmml" xref="alg1.l7.m1.3.3.3.3.2.6">
             𝑖
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.7.cmml" xref="alg1.l7.m1.3.3.3.3.2.7">
             𝑥
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.8.cmml" xref="alg1.l7.m1.3.3.3.3.2.8">
             _
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.9.cmml" xref="alg1.l7.m1.3.3.3.3.2.9">
             𝑙
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.10.cmml" xref="alg1.l7.m1.3.3.3.3.2.10">
             𝑒
            </ci>
            <ci id="alg1.l7.m1.3.3.3.3.2.11.cmml" xref="alg1.l7.m1.3.3.3.3.2.11">
             𝑛
            </ci>
           </apply>
           <csymbol cd="latexml" id="alg1.l7.m1.3.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3">
            absent
           </csymbol>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l7.m1.3c">
         req.prefix\_node,req.prefix\_len\leftarrow
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l8">
      <math alttext="T.\text{match\_prefix}(req.input\_tokens)" class="ltx_math_unparsed" display="inline" id="alg1.l8.m1.2">
       <semantics id="alg1.l8.m1.2a">
        <mrow id="alg1.l8.m1.2b">
         <mi id="alg1.l8.m1.1.1">
          T
         </mi>
         <mo id="alg1.l8.m1.2.3" lspace="0em" rspace="0.167em">
          .
         </mo>
         <mtext id="alg1.l8.m1.2.2">
          match_prefix
         </mtext>
         <mrow id="alg1.l8.m1.2.4">
          <mo id="alg1.l8.m1.2.4.1" stretchy="false">
           (
          </mo>
          <mi id="alg1.l8.m1.2.4.2">
           r
          </mi>
          <mi id="alg1.l8.m1.2.4.3">
           e
          </mi>
          <mi id="alg1.l8.m1.2.4.4">
           q
          </mi>
          <mo id="alg1.l8.m1.2.4.5" lspace="0em" rspace="0.167em">
           .
          </mo>
          <mi id="alg1.l8.m1.2.4.6">
           i
          </mi>
          <mi id="alg1.l8.m1.2.4.7">
           n
          </mi>
          <mi id="alg1.l8.m1.2.4.8">
           p
          </mi>
          <mi id="alg1.l8.m1.2.4.9">
           u
          </mi>
          <mi id="alg1.l8.m1.2.4.10">
           t
          </mi>
          <mi id="alg1.l8.m1.2.4.11" mathvariant="normal">
           _
          </mi>
          <mi id="alg1.l8.m1.2.4.12">
           t
          </mi>
          <mi id="alg1.l8.m1.2.4.13">
           o
          </mi>
          <mi id="alg1.l8.m1.2.4.14">
           k
          </mi>
          <mi id="alg1.l8.m1.2.4.15">
           e
          </mi>
          <mi id="alg1.l8.m1.2.4.16">
           n
          </mi>
          <mi id="alg1.l8.m1.2.4.17">
           s
          </mi>
          <mo id="alg1.l8.m1.2.4.18" stretchy="false">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation encoding="application/x-tex" id="alg1.l8.m1.2c">
         T.\text{match\_prefix}(req.input\_tokens)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l9">
      <span class="ltx_text" id="alg1.l9.1">
       // Sort the requests according to the matched prefix lenghts
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l10">
      <math alttext="requests.\text{sort}()" class="ltx_Math" display="inline" id="alg1.l10.m1.2">
       <semantics id="alg1.l10.m1.2a">
        <mrow id="alg1.l10.m1.2.2.2" xref="alg1.l10.m1.2.2.3.cmml">
         <mrow id="alg1.l10.m1.1.1.1.1" xref="alg1.l10.m1.1.1.1.1.cmml">
          <mi id="alg1.l10.m1.1.1.1.1.2" xref="alg1.l10.m1.1.1.1.1.2.cmml">
           r
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.3" xref="alg1.l10.m1.1.1.1.1.3.cmml">
           e
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.4" xref="alg1.l10.m1.1.1.1.1.4.cmml">
           q
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.5" xref="alg1.l10.m1.1.1.1.1.5.cmml">
           u
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.6" xref="alg1.l10.m1.1.1.1.1.6.cmml">
           e
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.7" xref="alg1.l10.m1.1.1.1.1.7.cmml">
           s
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.8" xref="alg1.l10.m1.1.1.1.1.8.cmml">
           t
          </mi>
          <mo id="alg1.l10.m1.1.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l10.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l10.m1.1.1.1.1.9" xref="alg1.l10.m1.1.1.1.1.9.cmml">
           s
          </mi>
         </mrow>
         <mo id="alg1.l10.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l10.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l10.m1.2.2.2.2" xref="alg1.l10.m1.2.2.2.2.cmml">
          <mtext id="alg1.l10.m1.2.2.2.2.2" xref="alg1.l10.m1.2.2.2.2.2a.cmml">
           sort
          </mtext>
          <mo id="alg1.l10.m1.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l10.m1.2.2.2.2.1.cmml">
           ​
          </mo>
          <mrow id="alg1.l10.m1.2.2.2.2.3.2" xref="alg1.l10.m1.2.2.2.2.cmml">
           <mo id="alg1.l10.m1.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l10.m1.2.2.2.2.3.1.cmml">
            (
           </mo>
           <mo id="alg1.l10.m1.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l10.m1.2.2.2.2.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l10.m1.2b">
         <apply id="alg1.l10.m1.2.2.3.cmml" xref="alg1.l10.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l10.m1.2.2.3a.cmml" xref="alg1.l10.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l10.m1.1.1.1.1.cmml" xref="alg1.l10.m1.1.1.1.1">
           <times id="alg1.l10.m1.1.1.1.1.1.cmml" xref="alg1.l10.m1.1.1.1.1.1">
           </times>
           <ci id="alg1.l10.m1.1.1.1.1.2.cmml" xref="alg1.l10.m1.1.1.1.1.2">
            𝑟
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.3.cmml" xref="alg1.l10.m1.1.1.1.1.3">
            𝑒
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.4.cmml" xref="alg1.l10.m1.1.1.1.1.4">
            𝑞
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.5.cmml" xref="alg1.l10.m1.1.1.1.1.5">
            𝑢
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.6.cmml" xref="alg1.l10.m1.1.1.1.1.6">
            𝑒
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.7.cmml" xref="alg1.l10.m1.1.1.1.1.7">
            𝑠
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.8.cmml" xref="alg1.l10.m1.1.1.1.1.8">
            𝑡
           </ci>
           <ci id="alg1.l10.m1.1.1.1.1.9.cmml" xref="alg1.l10.m1.1.1.1.1.9">
            𝑠
           </ci>
          </apply>
          <apply id="alg1.l10.m1.2.2.2.2.cmml" xref="alg1.l10.m1.2.2.2.2">
           <times id="alg1.l10.m1.2.2.2.2.1.cmml" xref="alg1.l10.m1.2.2.2.2.1">
           </times>
           <ci id="alg1.l10.m1.2.2.2.2.2a.cmml" xref="alg1.l10.m1.2.2.2.2.2">
            <mtext id="alg1.l10.m1.2.2.2.2.2.cmml" xref="alg1.l10.m1.2.2.2.2.2">
             sort
            </mtext>
           </ci>
           <list id="alg1.l10.m1.2.2.2.2.3.1.cmml" xref="alg1.l10.m1.2.2.2.2.3.2.1">
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l10.m1.2c">
         requests.\text{sort}()
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l11">
      <span class="ltx_text" id="alg1.l11.1">
       // Select requests for the next batch
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l12">
      <math alttext="available\_size\leftarrow T.\text{evictable\_size}()+P.\text{available\_size}()" class="ltx_Math" display="inline" id="alg1.l12.m1.3">
       <semantics id="alg1.l12.m1.3a">
        <mrow id="alg1.l12.m1.3.3.3" xref="alg1.l12.m1.3.3.4.cmml">
         <mrow id="alg1.l12.m1.1.1.1.1" xref="alg1.l12.m1.1.1.1.1.cmml">
          <mrow id="alg1.l12.m1.1.1.1.1.2" xref="alg1.l12.m1.1.1.1.1.2.cmml">
           <mi id="alg1.l12.m1.1.1.1.1.2.2" xref="alg1.l12.m1.1.1.1.1.2.2.cmml">
            a
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.3" xref="alg1.l12.m1.1.1.1.1.2.3.cmml">
            v
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.4" xref="alg1.l12.m1.1.1.1.1.2.4.cmml">
            a
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.5" xref="alg1.l12.m1.1.1.1.1.2.5.cmml">
            i
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.6" xref="alg1.l12.m1.1.1.1.1.2.6.cmml">
            l
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.7" xref="alg1.l12.m1.1.1.1.1.2.7.cmml">
            a
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.8" xref="alg1.l12.m1.1.1.1.1.2.8.cmml">
            b
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.9" xref="alg1.l12.m1.1.1.1.1.2.9.cmml">
            l
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.10" xref="alg1.l12.m1.1.1.1.1.2.10.cmml">
            e
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1h" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.11" mathvariant="normal" xref="alg1.l12.m1.1.1.1.1.2.11.cmml">
            _
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1i" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.12" xref="alg1.l12.m1.1.1.1.1.2.12.cmml">
            s
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1j" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.13" xref="alg1.l12.m1.1.1.1.1.2.13.cmml">
            i
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1k" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.14" xref="alg1.l12.m1.1.1.1.1.2.14.cmml">
            z
           </mi>
           <mo id="alg1.l12.m1.1.1.1.1.2.1l" lspace="0em" rspace="0em" xref="alg1.l12.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l12.m1.1.1.1.1.2.15" xref="alg1.l12.m1.1.1.1.1.2.15.cmml">
            e
           </mi>
          </mrow>
          <mo id="alg1.l12.m1.1.1.1.1.1" stretchy="false" xref="alg1.l12.m1.1.1.1.1.1.cmml">
           ←
          </mo>
          <mi id="alg1.l12.m1.1.1.1.1.3" xref="alg1.l12.m1.1.1.1.1.3.cmml">
           T
          </mi>
         </mrow>
         <mo id="alg1.l12.m1.3.3.3.4" lspace="0em" rspace="0.167em" xref="alg1.l12.m1.3.3.4a.cmml">
          .
         </mo>
         <mrow id="alg1.l12.m1.2.2.2.2" xref="alg1.l12.m1.2.2.2.2.cmml">
          <mrow id="alg1.l12.m1.2.2.2.2.2" xref="alg1.l12.m1.2.2.2.2.2.cmml">
           <mtext id="alg1.l12.m1.2.2.2.2.2.2" xref="alg1.l12.m1.2.2.2.2.2.2a.cmml">
            evictable_size
           </mtext>
           <mo id="alg1.l12.m1.2.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">
            ​
           </mo>
           <mrow id="alg1.l12.m1.2.2.2.2.2.3.2" xref="alg1.l12.m1.2.2.2.2.2.cmml">
            <mo id="alg1.l12.m1.2.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l12.m1.2.2.2.2.2.3.1.cmml">
             (
            </mo>
            <mo id="alg1.l12.m1.2.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l12.m1.2.2.2.2.2.3.1.cmml">
             )
            </mo>
           </mrow>
          </mrow>
          <mo id="alg1.l12.m1.2.2.2.2.1" xref="alg1.l12.m1.2.2.2.2.1.cmml">
           +
          </mo>
          <mi id="alg1.l12.m1.2.2.2.2.3" xref="alg1.l12.m1.2.2.2.2.3.cmml">
           P
          </mi>
         </mrow>
         <mo id="alg1.l12.m1.3.3.3.5" lspace="0em" rspace="0.167em" xref="alg1.l12.m1.3.3.4a.cmml">
          .
         </mo>
         <mrow id="alg1.l12.m1.3.3.3.3" xref="alg1.l12.m1.3.3.3.3.cmml">
          <mtext id="alg1.l12.m1.3.3.3.3.2" xref="alg1.l12.m1.3.3.3.3.2a.cmml">
           available_size
          </mtext>
          <mo id="alg1.l12.m1.3.3.3.3.1" lspace="0em" rspace="0em" xref="alg1.l12.m1.3.3.3.3.1.cmml">
           ​
          </mo>
          <mrow id="alg1.l12.m1.3.3.3.3.3.2" xref="alg1.l12.m1.3.3.3.3.cmml">
           <mo id="alg1.l12.m1.3.3.3.3.3.2.1" stretchy="false" xref="alg1.l12.m1.3.3.3.3.3.1.cmml">
            (
           </mo>
           <mo id="alg1.l12.m1.3.3.3.3.3.2.2" stretchy="false" xref="alg1.l12.m1.3.3.3.3.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l12.m1.3b">
         <apply id="alg1.l12.m1.3.3.4.cmml" xref="alg1.l12.m1.3.3.3">
          <csymbol cd="ambiguous" id="alg1.l12.m1.3.3.4a.cmml" xref="alg1.l12.m1.3.3.3.4">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l12.m1.1.1.1.1.cmml" xref="alg1.l12.m1.1.1.1.1">
           <ci id="alg1.l12.m1.1.1.1.1.1.cmml" xref="alg1.l12.m1.1.1.1.1.1">
            ←
           </ci>
           <apply id="alg1.l12.m1.1.1.1.1.2.cmml" xref="alg1.l12.m1.1.1.1.1.2">
            <times id="alg1.l12.m1.1.1.1.1.2.1.cmml" xref="alg1.l12.m1.1.1.1.1.2.1">
            </times>
            <ci id="alg1.l12.m1.1.1.1.1.2.2.cmml" xref="alg1.l12.m1.1.1.1.1.2.2">
             𝑎
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.3.cmml" xref="alg1.l12.m1.1.1.1.1.2.3">
             𝑣
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.4.cmml" xref="alg1.l12.m1.1.1.1.1.2.4">
             𝑎
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.5.cmml" xref="alg1.l12.m1.1.1.1.1.2.5">
             𝑖
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.6.cmml" xref="alg1.l12.m1.1.1.1.1.2.6">
             𝑙
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.7.cmml" xref="alg1.l12.m1.1.1.1.1.2.7">
             𝑎
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.8.cmml" xref="alg1.l12.m1.1.1.1.1.2.8">
             𝑏
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.9.cmml" xref="alg1.l12.m1.1.1.1.1.2.9">
             𝑙
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.10.cmml" xref="alg1.l12.m1.1.1.1.1.2.10">
             𝑒
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.11.cmml" xref="alg1.l12.m1.1.1.1.1.2.11">
             _
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.12.cmml" xref="alg1.l12.m1.1.1.1.1.2.12">
             𝑠
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.13.cmml" xref="alg1.l12.m1.1.1.1.1.2.13">
             𝑖
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.14.cmml" xref="alg1.l12.m1.1.1.1.1.2.14">
             𝑧
            </ci>
            <ci id="alg1.l12.m1.1.1.1.1.2.15.cmml" xref="alg1.l12.m1.1.1.1.1.2.15">
             𝑒
            </ci>
           </apply>
           <ci id="alg1.l12.m1.1.1.1.1.3.cmml" xref="alg1.l12.m1.1.1.1.1.3">
            𝑇
           </ci>
          </apply>
          <apply id="alg1.l12.m1.2.2.2.2.cmml" xref="alg1.l12.m1.2.2.2.2">
           <plus id="alg1.l12.m1.2.2.2.2.1.cmml" xref="alg1.l12.m1.2.2.2.2.1">
           </plus>
           <apply id="alg1.l12.m1.2.2.2.2.2.cmml" xref="alg1.l12.m1.2.2.2.2.2">
            <times id="alg1.l12.m1.2.2.2.2.2.1.cmml" xref="alg1.l12.m1.2.2.2.2.2.1">
            </times>
            <ci id="alg1.l12.m1.2.2.2.2.2.2a.cmml" xref="alg1.l12.m1.2.2.2.2.2.2">
             <mtext id="alg1.l12.m1.2.2.2.2.2.2.cmml" xref="alg1.l12.m1.2.2.2.2.2.2">
              evictable_size
             </mtext>
            </ci>
            <list id="alg1.l12.m1.2.2.2.2.2.3.1.cmml" xref="alg1.l12.m1.2.2.2.2.2.3.2.1">
            </list>
           </apply>
           <ci id="alg1.l12.m1.2.2.2.2.3.cmml" xref="alg1.l12.m1.2.2.2.2.3">
            𝑃
           </ci>
          </apply>
          <apply id="alg1.l12.m1.3.3.3.3.cmml" xref="alg1.l12.m1.3.3.3.3">
           <times id="alg1.l12.m1.3.3.3.3.1.cmml" xref="alg1.l12.m1.3.3.3.3.1">
           </times>
           <ci id="alg1.l12.m1.3.3.3.3.2a.cmml" xref="alg1.l12.m1.3.3.3.3.2">
            <mtext id="alg1.l12.m1.3.3.3.3.2.cmml" xref="alg1.l12.m1.3.3.3.3.2">
             available_size
            </mtext>
           </ci>
           <list id="alg1.l12.m1.3.3.3.3.3.1.cmml" xref="alg1.l12.m1.3.3.3.3.3.2.1">
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l12.m1.3c">
         available\_size\leftarrow T.\text{evictable\_size}()+P.\text{available\_size}()
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l13">
      <math alttext="current\_size\leftarrow 0" class="ltx_Math" display="inline" id="alg1.l13.m1.1">
       <semantics id="alg1.l13.m1.1a">
        <mrow id="alg1.l13.m1.1.1" xref="alg1.l13.m1.1.1.cmml">
         <mrow id="alg1.l13.m1.1.1.2" xref="alg1.l13.m1.1.1.2.cmml">
          <mi id="alg1.l13.m1.1.1.2.2" xref="alg1.l13.m1.1.1.2.2.cmml">
           c
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.3" xref="alg1.l13.m1.1.1.2.3.cmml">
           u
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.4" xref="alg1.l13.m1.1.1.2.4.cmml">
           r
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.5" xref="alg1.l13.m1.1.1.2.5.cmml">
           r
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.6" xref="alg1.l13.m1.1.1.2.6.cmml">
           e
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.7" xref="alg1.l13.m1.1.1.2.7.cmml">
           n
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.8" xref="alg1.l13.m1.1.1.2.8.cmml">
           t
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.9" mathvariant="normal" xref="alg1.l13.m1.1.1.2.9.cmml">
           _
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.10" xref="alg1.l13.m1.1.1.2.10.cmml">
           s
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1h" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.11" xref="alg1.l13.m1.1.1.2.11.cmml">
           i
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1i" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.12" xref="alg1.l13.m1.1.1.2.12.cmml">
           z
          </mi>
          <mo id="alg1.l13.m1.1.1.2.1j" lspace="0em" rspace="0em" xref="alg1.l13.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l13.m1.1.1.2.13" xref="alg1.l13.m1.1.1.2.13.cmml">
           e
          </mi>
         </mrow>
         <mo id="alg1.l13.m1.1.1.1" stretchy="false" xref="alg1.l13.m1.1.1.1.cmml">
          ←
         </mo>
         <mn id="alg1.l13.m1.1.1.3" xref="alg1.l13.m1.1.1.3.cmml">
          0
         </mn>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l13.m1.1b">
         <apply id="alg1.l13.m1.1.1.cmml" xref="alg1.l13.m1.1.1">
          <ci id="alg1.l13.m1.1.1.1.cmml" xref="alg1.l13.m1.1.1.1">
           ←
          </ci>
          <apply id="alg1.l13.m1.1.1.2.cmml" xref="alg1.l13.m1.1.1.2">
           <times id="alg1.l13.m1.1.1.2.1.cmml" xref="alg1.l13.m1.1.1.2.1">
           </times>
           <ci id="alg1.l13.m1.1.1.2.2.cmml" xref="alg1.l13.m1.1.1.2.2">
            𝑐
           </ci>
           <ci id="alg1.l13.m1.1.1.2.3.cmml" xref="alg1.l13.m1.1.1.2.3">
            𝑢
           </ci>
           <ci id="alg1.l13.m1.1.1.2.4.cmml" xref="alg1.l13.m1.1.1.2.4">
            𝑟
           </ci>
           <ci id="alg1.l13.m1.1.1.2.5.cmml" xref="alg1.l13.m1.1.1.2.5">
            𝑟
           </ci>
           <ci id="alg1.l13.m1.1.1.2.6.cmml" xref="alg1.l13.m1.1.1.2.6">
            𝑒
           </ci>
           <ci id="alg1.l13.m1.1.1.2.7.cmml" xref="alg1.l13.m1.1.1.2.7">
            𝑛
           </ci>
           <ci id="alg1.l13.m1.1.1.2.8.cmml" xref="alg1.l13.m1.1.1.2.8">
            𝑡
           </ci>
           <ci id="alg1.l13.m1.1.1.2.9.cmml" xref="alg1.l13.m1.1.1.2.9">
            _
           </ci>
           <ci id="alg1.l13.m1.1.1.2.10.cmml" xref="alg1.l13.m1.1.1.2.10">
            𝑠
           </ci>
           <ci id="alg1.l13.m1.1.1.2.11.cmml" xref="alg1.l13.m1.1.1.2.11">
            𝑖
           </ci>
           <ci id="alg1.l13.m1.1.1.2.12.cmml" xref="alg1.l13.m1.1.1.2.12">
            𝑧
           </ci>
           <ci id="alg1.l13.m1.1.1.2.13.cmml" xref="alg1.l13.m1.1.1.2.13">
            𝑒
           </ci>
          </apply>
          <cn id="alg1.l13.m1.1.1.3.cmml" type="integer" xref="alg1.l13.m1.1.1.3">
           0
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l13.m1.1c">
         current\_size\leftarrow 0
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l14">
      <math alttext="new\_batch\leftarrow[]" class="ltx_Math" display="inline" id="alg1.l14.m1.1">
       <semantics id="alg1.l14.m1.1a">
        <mrow id="alg1.l14.m1.1.1" xref="alg1.l14.m1.1.1.cmml">
         <mrow id="alg1.l14.m1.1.1.2" xref="alg1.l14.m1.1.1.2.cmml">
          <mi id="alg1.l14.m1.1.1.2.2" xref="alg1.l14.m1.1.1.2.2.cmml">
           n
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.3" xref="alg1.l14.m1.1.1.2.3.cmml">
           e
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.4" xref="alg1.l14.m1.1.1.2.4.cmml">
           w
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.5" mathvariant="normal" xref="alg1.l14.m1.1.1.2.5.cmml">
           _
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.6" xref="alg1.l14.m1.1.1.2.6.cmml">
           b
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.7" xref="alg1.l14.m1.1.1.2.7.cmml">
           a
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.8" xref="alg1.l14.m1.1.1.2.8.cmml">
           t
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.9" xref="alg1.l14.m1.1.1.2.9.cmml">
           c
          </mi>
          <mo id="alg1.l14.m1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l14.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l14.m1.1.1.2.10" xref="alg1.l14.m1.1.1.2.10.cmml">
           h
          </mi>
         </mrow>
         <mo id="alg1.l14.m1.1.1.1" stretchy="false" xref="alg1.l14.m1.1.1.1.cmml">
          ←
         </mo>
         <mrow id="alg1.l14.m1.1.1.3.2" xref="alg1.l14.m1.1.1.cmml">
          <mo id="alg1.l14.m1.1.1.3.2.1" stretchy="false" xref="alg1.l14.m1.1.1.3.1.cmml">
           [
          </mo>
          <mo id="alg1.l14.m1.1.1.3.2.2" stretchy="false" xref="alg1.l14.m1.1.1.3.1.cmml">
           ]
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l14.m1.1b">
         <apply id="alg1.l14.m1.1.1.cmml" xref="alg1.l14.m1.1.1">
          <ci id="alg1.l14.m1.1.1.1.cmml" xref="alg1.l14.m1.1.1.1">
           ←
          </ci>
          <apply id="alg1.l14.m1.1.1.2.cmml" xref="alg1.l14.m1.1.1.2">
           <times id="alg1.l14.m1.1.1.2.1.cmml" xref="alg1.l14.m1.1.1.2.1">
           </times>
           <ci id="alg1.l14.m1.1.1.2.2.cmml" xref="alg1.l14.m1.1.1.2.2">
            𝑛
           </ci>
           <ci id="alg1.l14.m1.1.1.2.3.cmml" xref="alg1.l14.m1.1.1.2.3">
            𝑒
           </ci>
           <ci id="alg1.l14.m1.1.1.2.4.cmml" xref="alg1.l14.m1.1.1.2.4">
            𝑤
           </ci>
           <ci id="alg1.l14.m1.1.1.2.5.cmml" xref="alg1.l14.m1.1.1.2.5">
            _
           </ci>
           <ci id="alg1.l14.m1.1.1.2.6.cmml" xref="alg1.l14.m1.1.1.2.6">
            𝑏
           </ci>
           <ci id="alg1.l14.m1.1.1.2.7.cmml" xref="alg1.l14.m1.1.1.2.7">
            𝑎
           </ci>
           <ci id="alg1.l14.m1.1.1.2.8.cmml" xref="alg1.l14.m1.1.1.2.8">
            𝑡
           </ci>
           <ci id="alg1.l14.m1.1.1.2.9.cmml" xref="alg1.l14.m1.1.1.2.9">
            𝑐
           </ci>
           <ci id="alg1.l14.m1.1.1.2.10.cmml" xref="alg1.l14.m1.1.1.2.10">
            ℎ
           </ci>
          </apply>
          <list id="alg1.l14.m1.1.1.3.1.cmml" xref="alg1.l14.m1.1.1.3.2.1">
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l14.m1.1c">
         new\_batch\leftarrow[]
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l15">
      <span class="ltx_text ltx_font_bold" id="alg1.l15.1">
       for
      </span>
      <math alttext="req\in requests" class="ltx_Math" display="inline" id="alg1.l15.m1.1">
       <semantics id="alg1.l15.m1.1a">
        <mrow id="alg1.l15.m1.1.1" xref="alg1.l15.m1.1.1.cmml">
         <mrow id="alg1.l15.m1.1.1.2" xref="alg1.l15.m1.1.1.2.cmml">
          <mi id="alg1.l15.m1.1.1.2.2" xref="alg1.l15.m1.1.1.2.2.cmml">
           r
          </mi>
          <mo id="alg1.l15.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.2.3" xref="alg1.l15.m1.1.1.2.3.cmml">
           e
          </mi>
          <mo id="alg1.l15.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.2.4" xref="alg1.l15.m1.1.1.2.4.cmml">
           q
          </mi>
         </mrow>
         <mo id="alg1.l15.m1.1.1.1" xref="alg1.l15.m1.1.1.1.cmml">
          ∈
         </mo>
         <mrow id="alg1.l15.m1.1.1.3" xref="alg1.l15.m1.1.1.3.cmml">
          <mi id="alg1.l15.m1.1.1.3.2" xref="alg1.l15.m1.1.1.3.2.cmml">
           r
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.3" xref="alg1.l15.m1.1.1.3.3.cmml">
           e
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.4" xref="alg1.l15.m1.1.1.3.4.cmml">
           q
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1b" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.5" xref="alg1.l15.m1.1.1.3.5.cmml">
           u
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1c" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.6" xref="alg1.l15.m1.1.1.3.6.cmml">
           e
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1d" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.7" xref="alg1.l15.m1.1.1.3.7.cmml">
           s
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1e" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.8" xref="alg1.l15.m1.1.1.3.8.cmml">
           t
          </mi>
          <mo id="alg1.l15.m1.1.1.3.1f" lspace="0em" rspace="0em" xref="alg1.l15.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l15.m1.1.1.3.9" xref="alg1.l15.m1.1.1.3.9.cmml">
           s
          </mi>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l15.m1.1b">
         <apply id="alg1.l15.m1.1.1.cmml" xref="alg1.l15.m1.1.1">
          <in id="alg1.l15.m1.1.1.1.cmml" xref="alg1.l15.m1.1.1.1">
          </in>
          <apply id="alg1.l15.m1.1.1.2.cmml" xref="alg1.l15.m1.1.1.2">
           <times id="alg1.l15.m1.1.1.2.1.cmml" xref="alg1.l15.m1.1.1.2.1">
           </times>
           <ci id="alg1.l15.m1.1.1.2.2.cmml" xref="alg1.l15.m1.1.1.2.2">
            𝑟
           </ci>
           <ci id="alg1.l15.m1.1.1.2.3.cmml" xref="alg1.l15.m1.1.1.2.3">
            𝑒
           </ci>
           <ci id="alg1.l15.m1.1.1.2.4.cmml" xref="alg1.l15.m1.1.1.2.4">
            𝑞
           </ci>
          </apply>
          <apply id="alg1.l15.m1.1.1.3.cmml" xref="alg1.l15.m1.1.1.3">
           <times id="alg1.l15.m1.1.1.3.1.cmml" xref="alg1.l15.m1.1.1.3.1">
           </times>
           <ci id="alg1.l15.m1.1.1.3.2.cmml" xref="alg1.l15.m1.1.1.3.2">
            𝑟
           </ci>
           <ci id="alg1.l15.m1.1.1.3.3.cmml" xref="alg1.l15.m1.1.1.3.3">
            𝑒
           </ci>
           <ci id="alg1.l15.m1.1.1.3.4.cmml" xref="alg1.l15.m1.1.1.3.4">
            𝑞
           </ci>
           <ci id="alg1.l15.m1.1.1.3.5.cmml" xref="alg1.l15.m1.1.1.3.5">
            𝑢
           </ci>
           <ci id="alg1.l15.m1.1.1.3.6.cmml" xref="alg1.l15.m1.1.1.3.6">
            𝑒
           </ci>
           <ci id="alg1.l15.m1.1.1.3.7.cmml" xref="alg1.l15.m1.1.1.3.7">
            𝑠
           </ci>
           <ci id="alg1.l15.m1.1.1.3.8.cmml" xref="alg1.l15.m1.1.1.3.8">
            𝑡
           </ci>
           <ci id="alg1.l15.m1.1.1.3.9.cmml" xref="alg1.l15.m1.1.1.3.9">
            𝑠
           </ci>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l15.m1.1c">
         req\in requests
        </annotation>
       </semantics>
      </math>
      <span class="ltx_text ltx_font_bold" id="alg1.l15.2">
       do
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l16">
      <span class="ltx_text ltx_font_bold" id="alg1.l16.1">
       if
      </span>
      <math alttext="req.\text{size}()+current\_size&lt;available\_size" class="ltx_Math" display="inline" id="alg1.l16.m1.2">
       <semantics id="alg1.l16.m1.2a">
        <mrow id="alg1.l16.m1.2.2.2" xref="alg1.l16.m1.2.2.3.cmml">
         <mrow id="alg1.l16.m1.1.1.1.1" xref="alg1.l16.m1.1.1.1.1.cmml">
          <mi id="alg1.l16.m1.1.1.1.1.2" xref="alg1.l16.m1.1.1.1.1.2.cmml">
           r
          </mi>
          <mo id="alg1.l16.m1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l16.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l16.m1.1.1.1.1.3" xref="alg1.l16.m1.1.1.1.1.3.cmml">
           e
          </mi>
          <mo id="alg1.l16.m1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l16.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l16.m1.1.1.1.1.4" xref="alg1.l16.m1.1.1.1.1.4.cmml">
           q
          </mi>
         </mrow>
         <mo id="alg1.l16.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l16.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l16.m1.2.2.2.2" xref="alg1.l16.m1.2.2.2.2.cmml">
          <mrow id="alg1.l16.m1.2.2.2.2.2" xref="alg1.l16.m1.2.2.2.2.2.cmml">
           <mrow id="alg1.l16.m1.2.2.2.2.2.2" xref="alg1.l16.m1.2.2.2.2.2.2.cmml">
            <mtext id="alg1.l16.m1.2.2.2.2.2.2.2" xref="alg1.l16.m1.2.2.2.2.2.2.2a.cmml">
             size
            </mtext>
            <mo id="alg1.l16.m1.2.2.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.2.1.cmml">
             ​
            </mo>
            <mrow id="alg1.l16.m1.2.2.2.2.2.2.3.2" xref="alg1.l16.m1.2.2.2.2.2.2.cmml">
             <mo id="alg1.l16.m1.2.2.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l16.m1.2.2.2.2.2.2.3.1.cmml">
              (
             </mo>
             <mo id="alg1.l16.m1.2.2.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l16.m1.2.2.2.2.2.2.3.1.cmml">
              )
             </mo>
            </mrow>
           </mrow>
           <mo id="alg1.l16.m1.2.2.2.2.2.1" xref="alg1.l16.m1.2.2.2.2.2.1.cmml">
            +
           </mo>
           <mrow id="alg1.l16.m1.2.2.2.2.2.3" xref="alg1.l16.m1.2.2.2.2.2.3.cmml">
            <mi id="alg1.l16.m1.2.2.2.2.2.3.2" xref="alg1.l16.m1.2.2.2.2.2.3.2.cmml">
             c
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.3" xref="alg1.l16.m1.2.2.2.2.2.3.3.cmml">
             u
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1a" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.4" xref="alg1.l16.m1.2.2.2.2.2.3.4.cmml">
             r
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1b" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.5" xref="alg1.l16.m1.2.2.2.2.2.3.5.cmml">
             r
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1c" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.6" xref="alg1.l16.m1.2.2.2.2.2.3.6.cmml">
             e
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1d" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.7" xref="alg1.l16.m1.2.2.2.2.2.3.7.cmml">
             n
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1e" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.8" xref="alg1.l16.m1.2.2.2.2.2.3.8.cmml">
             t
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1f" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.9" mathvariant="normal" xref="alg1.l16.m1.2.2.2.2.2.3.9.cmml">
             _
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1g" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.10" xref="alg1.l16.m1.2.2.2.2.2.3.10.cmml">
             s
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1h" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.11" xref="alg1.l16.m1.2.2.2.2.2.3.11.cmml">
             i
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1i" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.12" xref="alg1.l16.m1.2.2.2.2.2.3.12.cmml">
             z
            </mi>
            <mo id="alg1.l16.m1.2.2.2.2.2.3.1j" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.2.3.1.cmml">
             ​
            </mo>
            <mi id="alg1.l16.m1.2.2.2.2.2.3.13" xref="alg1.l16.m1.2.2.2.2.2.3.13.cmml">
             e
            </mi>
           </mrow>
          </mrow>
          <mo id="alg1.l16.m1.2.2.2.2.1" xref="alg1.l16.m1.2.2.2.2.1.cmml">
           &lt;
          </mo>
          <mrow id="alg1.l16.m1.2.2.2.2.3" xref="alg1.l16.m1.2.2.2.2.3.cmml">
           <mi id="alg1.l16.m1.2.2.2.2.3.2" xref="alg1.l16.m1.2.2.2.2.3.2.cmml">
            a
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.3" xref="alg1.l16.m1.2.2.2.2.3.3.cmml">
            v
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1a" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.4" xref="alg1.l16.m1.2.2.2.2.3.4.cmml">
            a
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1b" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.5" xref="alg1.l16.m1.2.2.2.2.3.5.cmml">
            i
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1c" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.6" xref="alg1.l16.m1.2.2.2.2.3.6.cmml">
            l
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1d" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.7" xref="alg1.l16.m1.2.2.2.2.3.7.cmml">
            a
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1e" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.8" xref="alg1.l16.m1.2.2.2.2.3.8.cmml">
            b
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1f" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.9" xref="alg1.l16.m1.2.2.2.2.3.9.cmml">
            l
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1g" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.10" xref="alg1.l16.m1.2.2.2.2.3.10.cmml">
            e
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1h" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.11" mathvariant="normal" xref="alg1.l16.m1.2.2.2.2.3.11.cmml">
            _
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1i" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.12" xref="alg1.l16.m1.2.2.2.2.3.12.cmml">
            s
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1j" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.13" xref="alg1.l16.m1.2.2.2.2.3.13.cmml">
            i
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1k" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.14" xref="alg1.l16.m1.2.2.2.2.3.14.cmml">
            z
           </mi>
           <mo id="alg1.l16.m1.2.2.2.2.3.1l" lspace="0em" rspace="0em" xref="alg1.l16.m1.2.2.2.2.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l16.m1.2.2.2.2.3.15" xref="alg1.l16.m1.2.2.2.2.3.15.cmml">
            e
           </mi>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l16.m1.2b">
         <apply id="alg1.l16.m1.2.2.3.cmml" xref="alg1.l16.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l16.m1.2.2.3a.cmml" xref="alg1.l16.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l16.m1.1.1.1.1.cmml" xref="alg1.l16.m1.1.1.1.1">
           <times id="alg1.l16.m1.1.1.1.1.1.cmml" xref="alg1.l16.m1.1.1.1.1.1">
           </times>
           <ci id="alg1.l16.m1.1.1.1.1.2.cmml" xref="alg1.l16.m1.1.1.1.1.2">
            𝑟
           </ci>
           <ci id="alg1.l16.m1.1.1.1.1.3.cmml" xref="alg1.l16.m1.1.1.1.1.3">
            𝑒
           </ci>
           <ci id="alg1.l16.m1.1.1.1.1.4.cmml" xref="alg1.l16.m1.1.1.1.1.4">
            𝑞
           </ci>
          </apply>
          <apply id="alg1.l16.m1.2.2.2.2.cmml" xref="alg1.l16.m1.2.2.2.2">
           <lt id="alg1.l16.m1.2.2.2.2.1.cmml" xref="alg1.l16.m1.2.2.2.2.1">
           </lt>
           <apply id="alg1.l16.m1.2.2.2.2.2.cmml" xref="alg1.l16.m1.2.2.2.2.2">
            <plus id="alg1.l16.m1.2.2.2.2.2.1.cmml" xref="alg1.l16.m1.2.2.2.2.2.1">
            </plus>
            <apply id="alg1.l16.m1.2.2.2.2.2.2.cmml" xref="alg1.l16.m1.2.2.2.2.2.2">
             <times id="alg1.l16.m1.2.2.2.2.2.2.1.cmml" xref="alg1.l16.m1.2.2.2.2.2.2.1">
             </times>
             <ci id="alg1.l16.m1.2.2.2.2.2.2.2a.cmml" xref="alg1.l16.m1.2.2.2.2.2.2.2">
              <mtext id="alg1.l16.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l16.m1.2.2.2.2.2.2.2">
               size
              </mtext>
             </ci>
             <list id="alg1.l16.m1.2.2.2.2.2.2.3.1.cmml" xref="alg1.l16.m1.2.2.2.2.2.2.3.2.1">
             </list>
            </apply>
            <apply id="alg1.l16.m1.2.2.2.2.2.3.cmml" xref="alg1.l16.m1.2.2.2.2.2.3">
             <times id="alg1.l16.m1.2.2.2.2.2.3.1.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.1">
             </times>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.2.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.2">
              𝑐
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.3.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.3">
              𝑢
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.4.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.4">
              𝑟
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.5.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.5">
              𝑟
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.6.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.6">
              𝑒
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.7.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.7">
              𝑛
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.8.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.8">
              𝑡
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.9.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.9">
              _
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.10.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.10">
              𝑠
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.11.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.11">
              𝑖
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.12.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.12">
              𝑧
             </ci>
             <ci id="alg1.l16.m1.2.2.2.2.2.3.13.cmml" xref="alg1.l16.m1.2.2.2.2.2.3.13">
              𝑒
             </ci>
            </apply>
           </apply>
           <apply id="alg1.l16.m1.2.2.2.2.3.cmml" xref="alg1.l16.m1.2.2.2.2.3">
            <times id="alg1.l16.m1.2.2.2.2.3.1.cmml" xref="alg1.l16.m1.2.2.2.2.3.1">
            </times>
            <ci id="alg1.l16.m1.2.2.2.2.3.2.cmml" xref="alg1.l16.m1.2.2.2.2.3.2">
             𝑎
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.3.cmml" xref="alg1.l16.m1.2.2.2.2.3.3">
             𝑣
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.4.cmml" xref="alg1.l16.m1.2.2.2.2.3.4">
             𝑎
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.5.cmml" xref="alg1.l16.m1.2.2.2.2.3.5">
             𝑖
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.6.cmml" xref="alg1.l16.m1.2.2.2.2.3.6">
             𝑙
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.7.cmml" xref="alg1.l16.m1.2.2.2.2.3.7">
             𝑎
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.8.cmml" xref="alg1.l16.m1.2.2.2.2.3.8">
             𝑏
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.9.cmml" xref="alg1.l16.m1.2.2.2.2.3.9">
             𝑙
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.10.cmml" xref="alg1.l16.m1.2.2.2.2.3.10">
             𝑒
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.11.cmml" xref="alg1.l16.m1.2.2.2.2.3.11">
             _
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.12.cmml" xref="alg1.l16.m1.2.2.2.2.3.12">
             𝑠
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.13.cmml" xref="alg1.l16.m1.2.2.2.2.3.13">
             𝑖
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.14.cmml" xref="alg1.l16.m1.2.2.2.2.3.14">
             𝑧
            </ci>
            <ci id="alg1.l16.m1.2.2.2.2.3.15.cmml" xref="alg1.l16.m1.2.2.2.2.3.15">
             𝑒
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l16.m1.2c">
         req.\text{size}()+current\_size&lt;available\_size
        </annotation>
       </semantics>
      </math>
      <span class="ltx_text ltx_font_bold" id="alg1.l16.2">
       then
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l17">
      <math alttext="new\_batch.\text{append}(req)" class="ltx_Math" display="inline" id="alg1.l17.m1.2">
       <semantics id="alg1.l17.m1.2a">
        <mrow id="alg1.l17.m1.2.2.2" xref="alg1.l17.m1.2.2.3.cmml">
         <mrow id="alg1.l17.m1.1.1.1.1" xref="alg1.l17.m1.1.1.1.1.cmml">
          <mi id="alg1.l17.m1.1.1.1.1.2" xref="alg1.l17.m1.1.1.1.1.2.cmml">
           n
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.3" xref="alg1.l17.m1.1.1.1.1.3.cmml">
           e
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.4" xref="alg1.l17.m1.1.1.1.1.4.cmml">
           w
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.5" mathvariant="normal" xref="alg1.l17.m1.1.1.1.1.5.cmml">
           _
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.6" xref="alg1.l17.m1.1.1.1.1.6.cmml">
           b
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.7" xref="alg1.l17.m1.1.1.1.1.7.cmml">
           a
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.8" xref="alg1.l17.m1.1.1.1.1.8.cmml">
           t
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.9" xref="alg1.l17.m1.1.1.1.1.9.cmml">
           c
          </mi>
          <mo id="alg1.l17.m1.1.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l17.m1.1.1.1.1.1.cmml">
           ​
          </mo>
          <mi id="alg1.l17.m1.1.1.1.1.10" xref="alg1.l17.m1.1.1.1.1.10.cmml">
           h
          </mi>
         </mrow>
         <mo id="alg1.l17.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l17.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l17.m1.2.2.2.2" xref="alg1.l17.m1.2.2.2.2.cmml">
          <mtext id="alg1.l17.m1.2.2.2.2.3" xref="alg1.l17.m1.2.2.2.2.3a.cmml">
           append
          </mtext>
          <mo id="alg1.l17.m1.2.2.2.2.2" lspace="0em" rspace="0em" xref="alg1.l17.m1.2.2.2.2.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l17.m1.2.2.2.2.1.1" xref="alg1.l17.m1.2.2.2.2.1.1.1.cmml">
           <mo id="alg1.l17.m1.2.2.2.2.1.1.2" stretchy="false" xref="alg1.l17.m1.2.2.2.2.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l17.m1.2.2.2.2.1.1.1" xref="alg1.l17.m1.2.2.2.2.1.1.1.cmml">
            <mi id="alg1.l17.m1.2.2.2.2.1.1.1.2" xref="alg1.l17.m1.2.2.2.2.1.1.1.2.cmml">
             r
            </mi>
            <mo id="alg1.l17.m1.2.2.2.2.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l17.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l17.m1.2.2.2.2.1.1.1.3" xref="alg1.l17.m1.2.2.2.2.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l17.m1.2.2.2.2.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l17.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l17.m1.2.2.2.2.1.1.1.4" xref="alg1.l17.m1.2.2.2.2.1.1.1.4.cmml">
             q
            </mi>
           </mrow>
           <mo id="alg1.l17.m1.2.2.2.2.1.1.3" stretchy="false" xref="alg1.l17.m1.2.2.2.2.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l17.m1.2b">
         <apply id="alg1.l17.m1.2.2.3.cmml" xref="alg1.l17.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l17.m1.2.2.3a.cmml" xref="alg1.l17.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l17.m1.1.1.1.1.cmml" xref="alg1.l17.m1.1.1.1.1">
           <times id="alg1.l17.m1.1.1.1.1.1.cmml" xref="alg1.l17.m1.1.1.1.1.1">
           </times>
           <ci id="alg1.l17.m1.1.1.1.1.2.cmml" xref="alg1.l17.m1.1.1.1.1.2">
            𝑛
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.3.cmml" xref="alg1.l17.m1.1.1.1.1.3">
            𝑒
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.4.cmml" xref="alg1.l17.m1.1.1.1.1.4">
            𝑤
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.5.cmml" xref="alg1.l17.m1.1.1.1.1.5">
            _
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.6.cmml" xref="alg1.l17.m1.1.1.1.1.6">
            𝑏
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.7.cmml" xref="alg1.l17.m1.1.1.1.1.7">
            𝑎
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.8.cmml" xref="alg1.l17.m1.1.1.1.1.8">
            𝑡
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.9.cmml" xref="alg1.l17.m1.1.1.1.1.9">
            𝑐
           </ci>
           <ci id="alg1.l17.m1.1.1.1.1.10.cmml" xref="alg1.l17.m1.1.1.1.1.10">
            ℎ
           </ci>
          </apply>
          <apply id="alg1.l17.m1.2.2.2.2.cmml" xref="alg1.l17.m1.2.2.2.2">
           <times id="alg1.l17.m1.2.2.2.2.2.cmml" xref="alg1.l17.m1.2.2.2.2.2">
           </times>
           <ci id="alg1.l17.m1.2.2.2.2.3a.cmml" xref="alg1.l17.m1.2.2.2.2.3">
            <mtext id="alg1.l17.m1.2.2.2.2.3.cmml" xref="alg1.l17.m1.2.2.2.2.3">
             append
            </mtext>
           </ci>
           <apply id="alg1.l17.m1.2.2.2.2.1.1.1.cmml" xref="alg1.l17.m1.2.2.2.2.1.1">
            <times id="alg1.l17.m1.2.2.2.2.1.1.1.1.cmml" xref="alg1.l17.m1.2.2.2.2.1.1.1.1">
            </times>
            <ci id="alg1.l17.m1.2.2.2.2.1.1.1.2.cmml" xref="alg1.l17.m1.2.2.2.2.1.1.1.2">
             𝑟
            </ci>
            <ci id="alg1.l17.m1.2.2.2.2.1.1.1.3.cmml" xref="alg1.l17.m1.2.2.2.2.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l17.m1.2.2.2.2.1.1.1.4.cmml" xref="alg1.l17.m1.2.2.2.2.1.1.1.4">
             𝑞
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l17.m1.2c">
         new\_batch.\text{append}(req)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l18">
      <math alttext="delta\leftarrow T.\text{increase\_ref\_counter}(req.prefix\_node)" class="ltx_math_unparsed" display="inline" id="alg1.l18.m1.1">
       <semantics id="alg1.l18.m1.1a">
        <mrow id="alg1.l18.m1.1b">
         <mi id="alg1.l18.m1.1.2">
          d
         </mi>
         <mi id="alg1.l18.m1.1.3">
          e
         </mi>
         <mi id="alg1.l18.m1.1.4">
          l
         </mi>
         <mi id="alg1.l18.m1.1.5">
          t
         </mi>
         <mi id="alg1.l18.m1.1.6">
          a
         </mi>
         <mo id="alg1.l18.m1.1.7" stretchy="false">
          ←
         </mo>
         <mi id="alg1.l18.m1.1.8">
          T
         </mi>
         <mo id="alg1.l18.m1.1.9" lspace="0em" rspace="0.167em">
          .
         </mo>
         <mtext id="alg1.l18.m1.1.1">
          increase_ref_counter
         </mtext>
         <mrow id="alg1.l18.m1.1.10">
          <mo id="alg1.l18.m1.1.10.1" stretchy="false">
           (
          </mo>
          <mi id="alg1.l18.m1.1.10.2">
           r
          </mi>
          <mi id="alg1.l18.m1.1.10.3">
           e
          </mi>
          <mi id="alg1.l18.m1.1.10.4">
           q
          </mi>
          <mo id="alg1.l18.m1.1.10.5" lspace="0em" rspace="0.167em">
           .
          </mo>
          <mi id="alg1.l18.m1.1.10.6">
           p
          </mi>
          <mi id="alg1.l18.m1.1.10.7">
           r
          </mi>
          <mi id="alg1.l18.m1.1.10.8">
           e
          </mi>
          <mi id="alg1.l18.m1.1.10.9">
           f
          </mi>
          <mi id="alg1.l18.m1.1.10.10">
           i
          </mi>
          <mi id="alg1.l18.m1.1.10.11">
           x
          </mi>
          <mi id="alg1.l18.m1.1.10.12" mathvariant="normal">
           _
          </mi>
          <mi id="alg1.l18.m1.1.10.13">
           n
          </mi>
          <mi id="alg1.l18.m1.1.10.14">
           o
          </mi>
          <mi id="alg1.l18.m1.1.10.15">
           d
          </mi>
          <mi id="alg1.l18.m1.1.10.16">
           e
          </mi>
          <mo id="alg1.l18.m1.1.10.17" stretchy="false">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation encoding="application/x-tex" id="alg1.l18.m1.1c">
         delta\leftarrow T.\text{increase\_ref\_counter}(req.prefix\_node)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l19">
      <math alttext="available\_size\leftarrow available\_size+delta" class="ltx_Math" display="inline" id="alg1.l19.m1.1">
       <semantics id="alg1.l19.m1.1a">
        <mrow id="alg1.l19.m1.1.1" xref="alg1.l19.m1.1.1.cmml">
         <mrow id="alg1.l19.m1.1.1.2" xref="alg1.l19.m1.1.1.2.cmml">
          <mi id="alg1.l19.m1.1.1.2.2" xref="alg1.l19.m1.1.1.2.2.cmml">
           a
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.3" xref="alg1.l19.m1.1.1.2.3.cmml">
           v
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.4" xref="alg1.l19.m1.1.1.2.4.cmml">
           a
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.5" xref="alg1.l19.m1.1.1.2.5.cmml">
           i
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.6" xref="alg1.l19.m1.1.1.2.6.cmml">
           l
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.7" xref="alg1.l19.m1.1.1.2.7.cmml">
           a
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.8" xref="alg1.l19.m1.1.1.2.8.cmml">
           b
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.9" xref="alg1.l19.m1.1.1.2.9.cmml">
           l
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.10" xref="alg1.l19.m1.1.1.2.10.cmml">
           e
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1h" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.11" mathvariant="normal" xref="alg1.l19.m1.1.1.2.11.cmml">
           _
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1i" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.12" xref="alg1.l19.m1.1.1.2.12.cmml">
           s
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1j" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.13" xref="alg1.l19.m1.1.1.2.13.cmml">
           i
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1k" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.14" xref="alg1.l19.m1.1.1.2.14.cmml">
           z
          </mi>
          <mo id="alg1.l19.m1.1.1.2.1l" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l19.m1.1.1.2.15" xref="alg1.l19.m1.1.1.2.15.cmml">
           e
          </mi>
         </mrow>
         <mo id="alg1.l19.m1.1.1.1" stretchy="false" xref="alg1.l19.m1.1.1.1.cmml">
          ←
         </mo>
         <mrow id="alg1.l19.m1.1.1.3" xref="alg1.l19.m1.1.1.3.cmml">
          <mrow id="alg1.l19.m1.1.1.3.2" xref="alg1.l19.m1.1.1.3.2.cmml">
           <mi id="alg1.l19.m1.1.1.3.2.2" xref="alg1.l19.m1.1.1.3.2.2.cmml">
            a
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.3" xref="alg1.l19.m1.1.1.3.2.3.cmml">
            v
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1a" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.4" xref="alg1.l19.m1.1.1.3.2.4.cmml">
            a
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1b" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.5" xref="alg1.l19.m1.1.1.3.2.5.cmml">
            i
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1c" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.6" xref="alg1.l19.m1.1.1.3.2.6.cmml">
            l
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1d" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.7" xref="alg1.l19.m1.1.1.3.2.7.cmml">
            a
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1e" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.8" xref="alg1.l19.m1.1.1.3.2.8.cmml">
            b
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1f" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.9" xref="alg1.l19.m1.1.1.3.2.9.cmml">
            l
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1g" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.10" xref="alg1.l19.m1.1.1.3.2.10.cmml">
            e
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1h" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.11" mathvariant="normal" xref="alg1.l19.m1.1.1.3.2.11.cmml">
            _
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1i" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.12" xref="alg1.l19.m1.1.1.3.2.12.cmml">
            s
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1j" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.13" xref="alg1.l19.m1.1.1.3.2.13.cmml">
            i
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1k" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.14" xref="alg1.l19.m1.1.1.3.2.14.cmml">
            z
           </mi>
           <mo id="alg1.l19.m1.1.1.3.2.1l" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.2.15" xref="alg1.l19.m1.1.1.3.2.15.cmml">
            e
           </mi>
          </mrow>
          <mo id="alg1.l19.m1.1.1.3.1" xref="alg1.l19.m1.1.1.3.1.cmml">
           +
          </mo>
          <mrow id="alg1.l19.m1.1.1.3.3" xref="alg1.l19.m1.1.1.3.3.cmml">
           <mi id="alg1.l19.m1.1.1.3.3.2" xref="alg1.l19.m1.1.1.3.3.2.cmml">
            d
           </mi>
           <mo id="alg1.l19.m1.1.1.3.3.1" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.3.3" xref="alg1.l19.m1.1.1.3.3.3.cmml">
            e
           </mi>
           <mo id="alg1.l19.m1.1.1.3.3.1a" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.3.4" xref="alg1.l19.m1.1.1.3.3.4.cmml">
            l
           </mi>
           <mo id="alg1.l19.m1.1.1.3.3.1b" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.3.5" xref="alg1.l19.m1.1.1.3.3.5.cmml">
            t
           </mi>
           <mo id="alg1.l19.m1.1.1.3.3.1c" lspace="0em" rspace="0em" xref="alg1.l19.m1.1.1.3.3.1.cmml">
            ​
           </mo>
           <mi id="alg1.l19.m1.1.1.3.3.6" xref="alg1.l19.m1.1.1.3.3.6.cmml">
            a
           </mi>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l19.m1.1b">
         <apply id="alg1.l19.m1.1.1.cmml" xref="alg1.l19.m1.1.1">
          <ci id="alg1.l19.m1.1.1.1.cmml" xref="alg1.l19.m1.1.1.1">
           ←
          </ci>
          <apply id="alg1.l19.m1.1.1.2.cmml" xref="alg1.l19.m1.1.1.2">
           <times id="alg1.l19.m1.1.1.2.1.cmml" xref="alg1.l19.m1.1.1.2.1">
           </times>
           <ci id="alg1.l19.m1.1.1.2.2.cmml" xref="alg1.l19.m1.1.1.2.2">
            𝑎
           </ci>
           <ci id="alg1.l19.m1.1.1.2.3.cmml" xref="alg1.l19.m1.1.1.2.3">
            𝑣
           </ci>
           <ci id="alg1.l19.m1.1.1.2.4.cmml" xref="alg1.l19.m1.1.1.2.4">
            𝑎
           </ci>
           <ci id="alg1.l19.m1.1.1.2.5.cmml" xref="alg1.l19.m1.1.1.2.5">
            𝑖
           </ci>
           <ci id="alg1.l19.m1.1.1.2.6.cmml" xref="alg1.l19.m1.1.1.2.6">
            𝑙
           </ci>
           <ci id="alg1.l19.m1.1.1.2.7.cmml" xref="alg1.l19.m1.1.1.2.7">
            𝑎
           </ci>
           <ci id="alg1.l19.m1.1.1.2.8.cmml" xref="alg1.l19.m1.1.1.2.8">
            𝑏
           </ci>
           <ci id="alg1.l19.m1.1.1.2.9.cmml" xref="alg1.l19.m1.1.1.2.9">
            𝑙
           </ci>
           <ci id="alg1.l19.m1.1.1.2.10.cmml" xref="alg1.l19.m1.1.1.2.10">
            𝑒
           </ci>
           <ci id="alg1.l19.m1.1.1.2.11.cmml" xref="alg1.l19.m1.1.1.2.11">
            _
           </ci>
           <ci id="alg1.l19.m1.1.1.2.12.cmml" xref="alg1.l19.m1.1.1.2.12">
            𝑠
           </ci>
           <ci id="alg1.l19.m1.1.1.2.13.cmml" xref="alg1.l19.m1.1.1.2.13">
            𝑖
           </ci>
           <ci id="alg1.l19.m1.1.1.2.14.cmml" xref="alg1.l19.m1.1.1.2.14">
            𝑧
           </ci>
           <ci id="alg1.l19.m1.1.1.2.15.cmml" xref="alg1.l19.m1.1.1.2.15">
            𝑒
           </ci>
          </apply>
          <apply id="alg1.l19.m1.1.1.3.cmml" xref="alg1.l19.m1.1.1.3">
           <plus id="alg1.l19.m1.1.1.3.1.cmml" xref="alg1.l19.m1.1.1.3.1">
           </plus>
           <apply id="alg1.l19.m1.1.1.3.2.cmml" xref="alg1.l19.m1.1.1.3.2">
            <times id="alg1.l19.m1.1.1.3.2.1.cmml" xref="alg1.l19.m1.1.1.3.2.1">
            </times>
            <ci id="alg1.l19.m1.1.1.3.2.2.cmml" xref="alg1.l19.m1.1.1.3.2.2">
             𝑎
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.3.cmml" xref="alg1.l19.m1.1.1.3.2.3">
             𝑣
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.4.cmml" xref="alg1.l19.m1.1.1.3.2.4">
             𝑎
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.5.cmml" xref="alg1.l19.m1.1.1.3.2.5">
             𝑖
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.6.cmml" xref="alg1.l19.m1.1.1.3.2.6">
             𝑙
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.7.cmml" xref="alg1.l19.m1.1.1.3.2.7">
             𝑎
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.8.cmml" xref="alg1.l19.m1.1.1.3.2.8">
             𝑏
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.9.cmml" xref="alg1.l19.m1.1.1.3.2.9">
             𝑙
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.10.cmml" xref="alg1.l19.m1.1.1.3.2.10">
             𝑒
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.11.cmml" xref="alg1.l19.m1.1.1.3.2.11">
             _
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.12.cmml" xref="alg1.l19.m1.1.1.3.2.12">
             𝑠
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.13.cmml" xref="alg1.l19.m1.1.1.3.2.13">
             𝑖
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.14.cmml" xref="alg1.l19.m1.1.1.3.2.14">
             𝑧
            </ci>
            <ci id="alg1.l19.m1.1.1.3.2.15.cmml" xref="alg1.l19.m1.1.1.3.2.15">
             𝑒
            </ci>
           </apply>
           <apply id="alg1.l19.m1.1.1.3.3.cmml" xref="alg1.l19.m1.1.1.3.3">
            <times id="alg1.l19.m1.1.1.3.3.1.cmml" xref="alg1.l19.m1.1.1.3.3.1">
            </times>
            <ci id="alg1.l19.m1.1.1.3.3.2.cmml" xref="alg1.l19.m1.1.1.3.3.2">
             𝑑
            </ci>
            <ci id="alg1.l19.m1.1.1.3.3.3.cmml" xref="alg1.l19.m1.1.1.3.3.3">
             𝑒
            </ci>
            <ci id="alg1.l19.m1.1.1.3.3.4.cmml" xref="alg1.l19.m1.1.1.3.3.4">
             𝑙
            </ci>
            <ci id="alg1.l19.m1.1.1.3.3.5.cmml" xref="alg1.l19.m1.1.1.3.3.5">
             𝑡
            </ci>
            <ci id="alg1.l19.m1.1.1.3.3.6.cmml" xref="alg1.l19.m1.1.1.3.3.6">
             𝑎
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l19.m1.1c">
         available\_size\leftarrow available\_size+delta
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l20">
      <math alttext="Q.\text{remove\_requests}(new\_batch)" class="ltx_Math" display="inline" id="alg1.l20.m1.2">
       <semantics id="alg1.l20.m1.2a">
        <mrow id="alg1.l20.m1.2.2.1" xref="alg1.l20.m1.2.2.2.cmml">
         <mi id="alg1.l20.m1.1.1" xref="alg1.l20.m1.1.1.cmml">
          Q
         </mi>
         <mo id="alg1.l20.m1.2.2.1.2" lspace="0em" rspace="0.167em" xref="alg1.l20.m1.2.2.2a.cmml">
          .
         </mo>
         <mrow id="alg1.l20.m1.2.2.1.1" xref="alg1.l20.m1.2.2.1.1.cmml">
          <mtext id="alg1.l20.m1.2.2.1.1.3" xref="alg1.l20.m1.2.2.1.1.3a.cmml">
           remove_requests
          </mtext>
          <mo id="alg1.l20.m1.2.2.1.1.2" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l20.m1.2.2.1.1.1.1" xref="alg1.l20.m1.2.2.1.1.1.1.1.cmml">
           <mo id="alg1.l20.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.l20.m1.2.2.1.1.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l20.m1.2.2.1.1.1.1.1" xref="alg1.l20.m1.2.2.1.1.1.1.1.cmml">
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.2" xref="alg1.l20.m1.2.2.1.1.1.1.1.2.cmml">
             n
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.3" xref="alg1.l20.m1.2.2.1.1.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.4" xref="alg1.l20.m1.2.2.1.1.1.1.1.4.cmml">
             w
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.5" mathvariant="normal" xref="alg1.l20.m1.2.2.1.1.1.1.1.5.cmml">
             _
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.6" xref="alg1.l20.m1.2.2.1.1.1.1.1.6.cmml">
             b
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.7" xref="alg1.l20.m1.2.2.1.1.1.1.1.7.cmml">
             a
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.8" xref="alg1.l20.m1.2.2.1.1.1.1.1.8.cmml">
             t
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.9" xref="alg1.l20.m1.2.2.1.1.1.1.1.9.cmml">
             c
            </mi>
            <mo id="alg1.l20.m1.2.2.1.1.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l20.m1.2.2.1.1.1.1.1.10" xref="alg1.l20.m1.2.2.1.1.1.1.1.10.cmml">
             h
            </mi>
           </mrow>
           <mo id="alg1.l20.m1.2.2.1.1.1.1.3" stretchy="false" xref="alg1.l20.m1.2.2.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l20.m1.2b">
         <apply id="alg1.l20.m1.2.2.2.cmml" xref="alg1.l20.m1.2.2.1">
          <csymbol cd="ambiguous" id="alg1.l20.m1.2.2.2a.cmml" xref="alg1.l20.m1.2.2.1.2">
           formulae-sequence
          </csymbol>
          <ci id="alg1.l20.m1.1.1.cmml" xref="alg1.l20.m1.1.1">
           𝑄
          </ci>
          <apply id="alg1.l20.m1.2.2.1.1.cmml" xref="alg1.l20.m1.2.2.1.1">
           <times id="alg1.l20.m1.2.2.1.1.2.cmml" xref="alg1.l20.m1.2.2.1.1.2">
           </times>
           <ci id="alg1.l20.m1.2.2.1.1.3a.cmml" xref="alg1.l20.m1.2.2.1.1.3">
            <mtext id="alg1.l20.m1.2.2.1.1.3.cmml" xref="alg1.l20.m1.2.2.1.1.3">
             remove_requests
            </mtext>
           </ci>
           <apply id="alg1.l20.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l20.m1.2.2.1.1.1.1">
            <times id="alg1.l20.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.1">
            </times>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.2">
             𝑛
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.4.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.4">
             𝑤
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.5.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.5">
             _
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.6.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.6">
             𝑏
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.7.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.7">
             𝑎
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.8.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.8">
             𝑡
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.9.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.9">
             𝑐
            </ci>
            <ci id="alg1.l20.m1.2.2.1.1.1.1.1.10.cmml" xref="alg1.l20.m1.2.2.1.1.1.1.1.10">
             ℎ
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l20.m1.2c">
         Q.\text{remove\_requests}(new\_batch)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l21">
      <span class="ltx_text" id="alg1.l21.1">
       // Insert requests into the current running batch
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l22">
      <math alttext="B.\text{merge}(new\_batch)" class="ltx_Math" display="inline" id="alg1.l22.m1.2">
       <semantics id="alg1.l22.m1.2a">
        <mrow id="alg1.l22.m1.2.2.1" xref="alg1.l22.m1.2.2.2.cmml">
         <mi id="alg1.l22.m1.1.1" xref="alg1.l22.m1.1.1.cmml">
          B
         </mi>
         <mo id="alg1.l22.m1.2.2.1.2" lspace="0em" rspace="0.167em" xref="alg1.l22.m1.2.2.2a.cmml">
          .
         </mo>
         <mrow id="alg1.l22.m1.2.2.1.1" xref="alg1.l22.m1.2.2.1.1.cmml">
          <mtext id="alg1.l22.m1.2.2.1.1.3" xref="alg1.l22.m1.2.2.1.1.3a.cmml">
           merge
          </mtext>
          <mo id="alg1.l22.m1.2.2.1.1.2" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l22.m1.2.2.1.1.1.1" xref="alg1.l22.m1.2.2.1.1.1.1.1.cmml">
           <mo id="alg1.l22.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.l22.m1.2.2.1.1.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l22.m1.2.2.1.1.1.1.1" xref="alg1.l22.m1.2.2.1.1.1.1.1.cmml">
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.2" xref="alg1.l22.m1.2.2.1.1.1.1.1.2.cmml">
             n
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.3" xref="alg1.l22.m1.2.2.1.1.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.4" xref="alg1.l22.m1.2.2.1.1.1.1.1.4.cmml">
             w
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.5" mathvariant="normal" xref="alg1.l22.m1.2.2.1.1.1.1.1.5.cmml">
             _
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.6" xref="alg1.l22.m1.2.2.1.1.1.1.1.6.cmml">
             b
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.7" xref="alg1.l22.m1.2.2.1.1.1.1.1.7.cmml">
             a
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.8" xref="alg1.l22.m1.2.2.1.1.1.1.1.8.cmml">
             t
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.9" xref="alg1.l22.m1.2.2.1.1.1.1.1.9.cmml">
             c
            </mi>
            <mo id="alg1.l22.m1.2.2.1.1.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l22.m1.2.2.1.1.1.1.1.10" xref="alg1.l22.m1.2.2.1.1.1.1.1.10.cmml">
             h
            </mi>
           </mrow>
           <mo id="alg1.l22.m1.2.2.1.1.1.1.3" stretchy="false" xref="alg1.l22.m1.2.2.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l22.m1.2b">
         <apply id="alg1.l22.m1.2.2.2.cmml" xref="alg1.l22.m1.2.2.1">
          <csymbol cd="ambiguous" id="alg1.l22.m1.2.2.2a.cmml" xref="alg1.l22.m1.2.2.1.2">
           formulae-sequence
          </csymbol>
          <ci id="alg1.l22.m1.1.1.cmml" xref="alg1.l22.m1.1.1">
           𝐵
          </ci>
          <apply id="alg1.l22.m1.2.2.1.1.cmml" xref="alg1.l22.m1.2.2.1.1">
           <times id="alg1.l22.m1.2.2.1.1.2.cmml" xref="alg1.l22.m1.2.2.1.1.2">
           </times>
           <ci id="alg1.l22.m1.2.2.1.1.3a.cmml" xref="alg1.l22.m1.2.2.1.1.3">
            <mtext id="alg1.l22.m1.2.2.1.1.3.cmml" xref="alg1.l22.m1.2.2.1.1.3">
             merge
            </mtext>
           </ci>
           <apply id="alg1.l22.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l22.m1.2.2.1.1.1.1">
            <times id="alg1.l22.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.1">
            </times>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.2">
             𝑛
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.4.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.4">
             𝑤
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.5.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.5">
             _
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.6.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.6">
             𝑏
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.7.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.7">
             𝑎
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.8.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.8">
             𝑡
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.9.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.9">
             𝑐
            </ci>
            <ci id="alg1.l22.m1.2.2.1.1.1.1.1.10.cmml" xref="alg1.l22.m1.2.2.1.1.1.1.1.10">
             ℎ
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l22.m1.2c">
         B.\text{merge}(new\_batch)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l23">
      <span class="ltx_text" id="alg1.l23.1">
       // Allocate new memory and do eviction if necessary
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l24">
      <math alttext="needed\_size\leftarrow B.\text{needed\_size}()" class="ltx_Math" display="inline" id="alg1.l24.m1.2">
       <semantics id="alg1.l24.m1.2a">
        <mrow id="alg1.l24.m1.2.2.2" xref="alg1.l24.m1.2.2.3.cmml">
         <mrow id="alg1.l24.m1.1.1.1.1" xref="alg1.l24.m1.1.1.1.1.cmml">
          <mrow id="alg1.l24.m1.1.1.1.1.2" xref="alg1.l24.m1.1.1.1.1.2.cmml">
           <mi id="alg1.l24.m1.1.1.1.1.2.2" xref="alg1.l24.m1.1.1.1.1.2.2.cmml">
            n
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.3" xref="alg1.l24.m1.1.1.1.1.2.3.cmml">
            e
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.4" xref="alg1.l24.m1.1.1.1.1.2.4.cmml">
            e
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.5" xref="alg1.l24.m1.1.1.1.1.2.5.cmml">
            d
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.6" xref="alg1.l24.m1.1.1.1.1.2.6.cmml">
            e
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.7" xref="alg1.l24.m1.1.1.1.1.2.7.cmml">
            d
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.8" mathvariant="normal" xref="alg1.l24.m1.1.1.1.1.2.8.cmml">
            _
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.9" xref="alg1.l24.m1.1.1.1.1.2.9.cmml">
            s
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.10" xref="alg1.l24.m1.1.1.1.1.2.10.cmml">
            i
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1h" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.11" xref="alg1.l24.m1.1.1.1.1.2.11.cmml">
            z
           </mi>
           <mo id="alg1.l24.m1.1.1.1.1.2.1i" lspace="0em" rspace="0em" xref="alg1.l24.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l24.m1.1.1.1.1.2.12" xref="alg1.l24.m1.1.1.1.1.2.12.cmml">
            e
           </mi>
          </mrow>
          <mo id="alg1.l24.m1.1.1.1.1.1" stretchy="false" xref="alg1.l24.m1.1.1.1.1.1.cmml">
           ←
          </mo>
          <mi id="alg1.l24.m1.1.1.1.1.3" xref="alg1.l24.m1.1.1.1.1.3.cmml">
           B
          </mi>
         </mrow>
         <mo id="alg1.l24.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l24.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l24.m1.2.2.2.2" xref="alg1.l24.m1.2.2.2.2.cmml">
          <mtext id="alg1.l24.m1.2.2.2.2.2" xref="alg1.l24.m1.2.2.2.2.2a.cmml">
           needed_size
          </mtext>
          <mo id="alg1.l24.m1.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l24.m1.2.2.2.2.1.cmml">
           ​
          </mo>
          <mrow id="alg1.l24.m1.2.2.2.2.3.2" xref="alg1.l24.m1.2.2.2.2.cmml">
           <mo id="alg1.l24.m1.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l24.m1.2.2.2.2.3.1.cmml">
            (
           </mo>
           <mo id="alg1.l24.m1.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l24.m1.2.2.2.2.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l24.m1.2b">
         <apply id="alg1.l24.m1.2.2.3.cmml" xref="alg1.l24.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l24.m1.2.2.3a.cmml" xref="alg1.l24.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l24.m1.1.1.1.1.cmml" xref="alg1.l24.m1.1.1.1.1">
           <ci id="alg1.l24.m1.1.1.1.1.1.cmml" xref="alg1.l24.m1.1.1.1.1.1">
            ←
           </ci>
           <apply id="alg1.l24.m1.1.1.1.1.2.cmml" xref="alg1.l24.m1.1.1.1.1.2">
            <times id="alg1.l24.m1.1.1.1.1.2.1.cmml" xref="alg1.l24.m1.1.1.1.1.2.1">
            </times>
            <ci id="alg1.l24.m1.1.1.1.1.2.2.cmml" xref="alg1.l24.m1.1.1.1.1.2.2">
             𝑛
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.3.cmml" xref="alg1.l24.m1.1.1.1.1.2.3">
             𝑒
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.4.cmml" xref="alg1.l24.m1.1.1.1.1.2.4">
             𝑒
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.5.cmml" xref="alg1.l24.m1.1.1.1.1.2.5">
             𝑑
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.6.cmml" xref="alg1.l24.m1.1.1.1.1.2.6">
             𝑒
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.7.cmml" xref="alg1.l24.m1.1.1.1.1.2.7">
             𝑑
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.8.cmml" xref="alg1.l24.m1.1.1.1.1.2.8">
             _
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.9.cmml" xref="alg1.l24.m1.1.1.1.1.2.9">
             𝑠
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.10.cmml" xref="alg1.l24.m1.1.1.1.1.2.10">
             𝑖
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.11.cmml" xref="alg1.l24.m1.1.1.1.1.2.11">
             𝑧
            </ci>
            <ci id="alg1.l24.m1.1.1.1.1.2.12.cmml" xref="alg1.l24.m1.1.1.1.1.2.12">
             𝑒
            </ci>
           </apply>
           <ci id="alg1.l24.m1.1.1.1.1.3.cmml" xref="alg1.l24.m1.1.1.1.1.3">
            𝐵
           </ci>
          </apply>
          <apply id="alg1.l24.m1.2.2.2.2.cmml" xref="alg1.l24.m1.2.2.2.2">
           <times id="alg1.l24.m1.2.2.2.2.1.cmml" xref="alg1.l24.m1.2.2.2.2.1">
           </times>
           <ci id="alg1.l24.m1.2.2.2.2.2a.cmml" xref="alg1.l24.m1.2.2.2.2.2">
            <mtext id="alg1.l24.m1.2.2.2.2.2.cmml" xref="alg1.l24.m1.2.2.2.2.2">
             needed_size
            </mtext>
           </ci>
           <list id="alg1.l24.m1.2.2.2.2.3.1.cmml" xref="alg1.l24.m1.2.2.2.2.3.2.1">
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l24.m1.2c">
         needed\_size\leftarrow B.\text{needed\_size}()
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l25">
      <math alttext="success,buffer\leftarrow P.\text{alloc}(needed\_size)" class="ltx_Math" display="inline" id="alg1.l25.m1.2">
       <semantics id="alg1.l25.m1.2a">
        <mrow id="alg1.l25.m1.2.2.2" xref="alg1.l25.m1.2.2.3.cmml">
         <mrow id="alg1.l25.m1.1.1.1.1" xref="alg1.l25.m1.1.1.1.1.cmml">
          <mrow id="alg1.l25.m1.1.1.1.1.2.2" xref="alg1.l25.m1.1.1.1.1.2.3.cmml">
           <mrow id="alg1.l25.m1.1.1.1.1.1.1.1" xref="alg1.l25.m1.1.1.1.1.1.1.1.cmml">
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.2" xref="alg1.l25.m1.1.1.1.1.1.1.1.2.cmml">
             s
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.3" xref="alg1.l25.m1.1.1.1.1.1.1.1.3.cmml">
             u
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.4" xref="alg1.l25.m1.1.1.1.1.1.1.1.4.cmml">
             c
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.5" xref="alg1.l25.m1.1.1.1.1.1.1.1.5.cmml">
             c
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.6" xref="alg1.l25.m1.1.1.1.1.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.7" xref="alg1.l25.m1.1.1.1.1.1.1.1.7.cmml">
             s
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.1.1.1.8" xref="alg1.l25.m1.1.1.1.1.1.1.1.8.cmml">
             s
            </mi>
           </mrow>
           <mo id="alg1.l25.m1.1.1.1.1.2.2.3" xref="alg1.l25.m1.1.1.1.1.2.3.cmml">
            ,
           </mo>
           <mrow id="alg1.l25.m1.1.1.1.1.2.2.2" xref="alg1.l25.m1.1.1.1.1.2.2.2.cmml">
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.2" xref="alg1.l25.m1.1.1.1.1.2.2.2.2.cmml">
             b
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.3" xref="alg1.l25.m1.1.1.1.1.2.2.2.3.cmml">
             u
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.2.2.2.1a" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.4" xref="alg1.l25.m1.1.1.1.1.2.2.2.4.cmml">
             f
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.2.2.2.1b" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.5" xref="alg1.l25.m1.1.1.1.1.2.2.2.5.cmml">
             f
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.2.2.2.1c" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.6" xref="alg1.l25.m1.1.1.1.1.2.2.2.6.cmml">
             e
            </mi>
            <mo id="alg1.l25.m1.1.1.1.1.2.2.2.1d" lspace="0em" rspace="0em" xref="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.1.1.1.1.2.2.2.7" xref="alg1.l25.m1.1.1.1.1.2.2.2.7.cmml">
             r
            </mi>
           </mrow>
          </mrow>
          <mo id="alg1.l25.m1.1.1.1.1.3" stretchy="false" xref="alg1.l25.m1.1.1.1.1.3.cmml">
           ←
          </mo>
          <mi id="alg1.l25.m1.1.1.1.1.4" xref="alg1.l25.m1.1.1.1.1.4.cmml">
           P
          </mi>
         </mrow>
         <mo id="alg1.l25.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l25.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l25.m1.2.2.2.2" xref="alg1.l25.m1.2.2.2.2.cmml">
          <mtext id="alg1.l25.m1.2.2.2.2.3" xref="alg1.l25.m1.2.2.2.2.3a.cmml">
           alloc
          </mtext>
          <mo id="alg1.l25.m1.2.2.2.2.2" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l25.m1.2.2.2.2.1.1" xref="alg1.l25.m1.2.2.2.2.1.1.1.cmml">
           <mo id="alg1.l25.m1.2.2.2.2.1.1.2" stretchy="false" xref="alg1.l25.m1.2.2.2.2.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l25.m1.2.2.2.2.1.1.1" xref="alg1.l25.m1.2.2.2.2.1.1.1.cmml">
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.2" xref="alg1.l25.m1.2.2.2.2.1.1.1.2.cmml">
             n
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.3" xref="alg1.l25.m1.2.2.2.2.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.4" xref="alg1.l25.m1.2.2.2.2.1.1.1.4.cmml">
             e
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.5" xref="alg1.l25.m1.2.2.2.2.1.1.1.5.cmml">
             d
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.6" xref="alg1.l25.m1.2.2.2.2.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.7" xref="alg1.l25.m1.2.2.2.2.1.1.1.7.cmml">
             d
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.8" mathvariant="normal" xref="alg1.l25.m1.2.2.2.2.1.1.1.8.cmml">
             _
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.9" xref="alg1.l25.m1.2.2.2.2.1.1.1.9.cmml">
             s
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.10" xref="alg1.l25.m1.2.2.2.2.1.1.1.10.cmml">
             i
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1h" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.11" xref="alg1.l25.m1.2.2.2.2.1.1.1.11.cmml">
             z
            </mi>
            <mo id="alg1.l25.m1.2.2.2.2.1.1.1.1i" lspace="0em" rspace="0em" xref="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l25.m1.2.2.2.2.1.1.1.12" xref="alg1.l25.m1.2.2.2.2.1.1.1.12.cmml">
             e
            </mi>
           </mrow>
           <mo id="alg1.l25.m1.2.2.2.2.1.1.3" stretchy="false" xref="alg1.l25.m1.2.2.2.2.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l25.m1.2b">
         <apply id="alg1.l25.m1.2.2.3.cmml" xref="alg1.l25.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l25.m1.2.2.3a.cmml" xref="alg1.l25.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l25.m1.1.1.1.1.cmml" xref="alg1.l25.m1.1.1.1.1">
           <ci id="alg1.l25.m1.1.1.1.1.3.cmml" xref="alg1.l25.m1.1.1.1.1.3">
            ←
           </ci>
           <list id="alg1.l25.m1.1.1.1.1.2.3.cmml" xref="alg1.l25.m1.1.1.1.1.2.2">
            <apply id="alg1.l25.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1">
             <times id="alg1.l25.m1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.1">
             </times>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.2">
              𝑠
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.3">
              𝑢
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.4.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.4">
              𝑐
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.5.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.5">
              𝑐
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.6.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.6">
              𝑒
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.7.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.7">
              𝑠
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.1.1.1.8.cmml" xref="alg1.l25.m1.1.1.1.1.1.1.1.8">
              𝑠
             </ci>
            </apply>
            <apply id="alg1.l25.m1.1.1.1.1.2.2.2.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2">
             <times id="alg1.l25.m1.1.1.1.1.2.2.2.1.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.1">
             </times>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.2.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.2">
              𝑏
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.3.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.3">
              𝑢
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.4.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.4">
              𝑓
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.5.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.5">
              𝑓
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.6.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.6">
              𝑒
             </ci>
             <ci id="alg1.l25.m1.1.1.1.1.2.2.2.7.cmml" xref="alg1.l25.m1.1.1.1.1.2.2.2.7">
              𝑟
             </ci>
            </apply>
           </list>
           <ci id="alg1.l25.m1.1.1.1.1.4.cmml" xref="alg1.l25.m1.1.1.1.1.4">
            𝑃
           </ci>
          </apply>
          <apply id="alg1.l25.m1.2.2.2.2.cmml" xref="alg1.l25.m1.2.2.2.2">
           <times id="alg1.l25.m1.2.2.2.2.2.cmml" xref="alg1.l25.m1.2.2.2.2.2">
           </times>
           <ci id="alg1.l25.m1.2.2.2.2.3a.cmml" xref="alg1.l25.m1.2.2.2.2.3">
            <mtext id="alg1.l25.m1.2.2.2.2.3.cmml" xref="alg1.l25.m1.2.2.2.2.3">
             alloc
            </mtext>
           </ci>
           <apply id="alg1.l25.m1.2.2.2.2.1.1.1.cmml" xref="alg1.l25.m1.2.2.2.2.1.1">
            <times id="alg1.l25.m1.2.2.2.2.1.1.1.1.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.1">
            </times>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.2.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.2">
             𝑛
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.3.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.4.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.4">
             𝑒
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.5.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.5">
             𝑑
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.6.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.6">
             𝑒
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.7.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.7">
             𝑑
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.8.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.8">
             _
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.9.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.9">
             𝑠
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.10.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.10">
             𝑖
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.11.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.11">
             𝑧
            </ci>
            <ci id="alg1.l25.m1.2.2.2.2.1.1.1.12.cmml" xref="alg1.l25.m1.2.2.2.2.1.1.1.12">
             𝑒
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l25.m1.2c">
         success,buffer\leftarrow P.\text{alloc}(needed\_size)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l26">
      <span class="ltx_text ltx_font_bold" id="alg1.l26.1">
       if
      </span>
      not
      <math alttext="success" class="ltx_Math" display="inline" id="alg1.l26.m1.1">
       <semantics id="alg1.l26.m1.1a">
        <mrow id="alg1.l26.m1.1.1" xref="alg1.l26.m1.1.1.cmml">
         <mi id="alg1.l26.m1.1.1.2" xref="alg1.l26.m1.1.1.2.cmml">
          s
         </mi>
         <mo id="alg1.l26.m1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.3" xref="alg1.l26.m1.1.1.3.cmml">
          u
         </mi>
         <mo id="alg1.l26.m1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.4" xref="alg1.l26.m1.1.1.4.cmml">
          c
         </mi>
         <mo id="alg1.l26.m1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.5" xref="alg1.l26.m1.1.1.5.cmml">
          c
         </mi>
         <mo id="alg1.l26.m1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.6" xref="alg1.l26.m1.1.1.6.cmml">
          e
         </mi>
         <mo id="alg1.l26.m1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.7" xref="alg1.l26.m1.1.1.7.cmml">
          s
         </mi>
         <mo id="alg1.l26.m1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l26.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l26.m1.1.1.8" xref="alg1.l26.m1.1.1.8.cmml">
          s
         </mi>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l26.m1.1b">
         <apply id="alg1.l26.m1.1.1.cmml" xref="alg1.l26.m1.1.1">
          <times id="alg1.l26.m1.1.1.1.cmml" xref="alg1.l26.m1.1.1.1">
          </times>
          <ci id="alg1.l26.m1.1.1.2.cmml" xref="alg1.l26.m1.1.1.2">
           𝑠
          </ci>
          <ci id="alg1.l26.m1.1.1.3.cmml" xref="alg1.l26.m1.1.1.3">
           𝑢
          </ci>
          <ci id="alg1.l26.m1.1.1.4.cmml" xref="alg1.l26.m1.1.1.4">
           𝑐
          </ci>
          <ci id="alg1.l26.m1.1.1.5.cmml" xref="alg1.l26.m1.1.1.5">
           𝑐
          </ci>
          <ci id="alg1.l26.m1.1.1.6.cmml" xref="alg1.l26.m1.1.1.6">
           𝑒
          </ci>
          <ci id="alg1.l26.m1.1.1.7.cmml" xref="alg1.l26.m1.1.1.7">
           𝑠
          </ci>
          <ci id="alg1.l26.m1.1.1.8.cmml" xref="alg1.l26.m1.1.1.8">
           𝑠
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l26.m1.1c">
         success
        </annotation>
       </semantics>
      </math>
      <span class="ltx_text ltx_font_bold" id="alg1.l26.2">
       then
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l27">
      <math alttext="T.\text{evict}(needed\_size)" class="ltx_Math" display="inline" id="alg1.l27.m1.2">
       <semantics id="alg1.l27.m1.2a">
        <mrow id="alg1.l27.m1.2.2.1" xref="alg1.l27.m1.2.2.2.cmml">
         <mi id="alg1.l27.m1.1.1" xref="alg1.l27.m1.1.1.cmml">
          T
         </mi>
         <mo id="alg1.l27.m1.2.2.1.2" lspace="0em" rspace="0.167em" xref="alg1.l27.m1.2.2.2a.cmml">
          .
         </mo>
         <mrow id="alg1.l27.m1.2.2.1.1" xref="alg1.l27.m1.2.2.1.1.cmml">
          <mtext id="alg1.l27.m1.2.2.1.1.3" xref="alg1.l27.m1.2.2.1.1.3a.cmml">
           evict
          </mtext>
          <mo id="alg1.l27.m1.2.2.1.1.2" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l27.m1.2.2.1.1.1.1" xref="alg1.l27.m1.2.2.1.1.1.1.1.cmml">
           <mo id="alg1.l27.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.l27.m1.2.2.1.1.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l27.m1.2.2.1.1.1.1.1" xref="alg1.l27.m1.2.2.1.1.1.1.1.cmml">
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.2" xref="alg1.l27.m1.2.2.1.1.1.1.1.2.cmml">
             n
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.3" xref="alg1.l27.m1.2.2.1.1.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.4" xref="alg1.l27.m1.2.2.1.1.1.1.1.4.cmml">
             e
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.5" xref="alg1.l27.m1.2.2.1.1.1.1.1.5.cmml">
             d
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.6" xref="alg1.l27.m1.2.2.1.1.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.7" xref="alg1.l27.m1.2.2.1.1.1.1.1.7.cmml">
             d
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.8" mathvariant="normal" xref="alg1.l27.m1.2.2.1.1.1.1.1.8.cmml">
             _
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.9" xref="alg1.l27.m1.2.2.1.1.1.1.1.9.cmml">
             s
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.10" xref="alg1.l27.m1.2.2.1.1.1.1.1.10.cmml">
             i
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1h" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.11" xref="alg1.l27.m1.2.2.1.1.1.1.1.11.cmml">
             z
            </mi>
            <mo id="alg1.l27.m1.2.2.1.1.1.1.1.1i" lspace="0em" rspace="0em" xref="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l27.m1.2.2.1.1.1.1.1.12" xref="alg1.l27.m1.2.2.1.1.1.1.1.12.cmml">
             e
            </mi>
           </mrow>
           <mo id="alg1.l27.m1.2.2.1.1.1.1.3" stretchy="false" xref="alg1.l27.m1.2.2.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l27.m1.2b">
         <apply id="alg1.l27.m1.2.2.2.cmml" xref="alg1.l27.m1.2.2.1">
          <csymbol cd="ambiguous" id="alg1.l27.m1.2.2.2a.cmml" xref="alg1.l27.m1.2.2.1.2">
           formulae-sequence
          </csymbol>
          <ci id="alg1.l27.m1.1.1.cmml" xref="alg1.l27.m1.1.1">
           𝑇
          </ci>
          <apply id="alg1.l27.m1.2.2.1.1.cmml" xref="alg1.l27.m1.2.2.1.1">
           <times id="alg1.l27.m1.2.2.1.1.2.cmml" xref="alg1.l27.m1.2.2.1.1.2">
           </times>
           <ci id="alg1.l27.m1.2.2.1.1.3a.cmml" xref="alg1.l27.m1.2.2.1.1.3">
            <mtext id="alg1.l27.m1.2.2.1.1.3.cmml" xref="alg1.l27.m1.2.2.1.1.3">
             evict
            </mtext>
           </ci>
           <apply id="alg1.l27.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l27.m1.2.2.1.1.1.1">
            <times id="alg1.l27.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.1">
            </times>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.2">
             𝑛
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.4.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.4">
             𝑒
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.5.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.5">
             𝑑
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.6.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.6">
             𝑒
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.7.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.7">
             𝑑
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.8.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.8">
             _
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.9.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.9">
             𝑠
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.10.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.10">
             𝑖
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.11.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.11">
             𝑧
            </ci>
            <ci id="alg1.l27.m1.2.2.1.1.1.1.1.12.cmml" xref="alg1.l27.m1.2.2.1.1.1.1.1.12">
             𝑒
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l27.m1.2c">
         T.\text{evict}(needed\_size)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l28">
      <math alttext="success,buffer\leftarrow P.\text{alloc}(needed\_size)" class="ltx_Math" display="inline" id="alg1.l28.m1.2">
       <semantics id="alg1.l28.m1.2a">
        <mrow id="alg1.l28.m1.2.2.2" xref="alg1.l28.m1.2.2.3.cmml">
         <mrow id="alg1.l28.m1.1.1.1.1" xref="alg1.l28.m1.1.1.1.1.cmml">
          <mrow id="alg1.l28.m1.1.1.1.1.2.2" xref="alg1.l28.m1.1.1.1.1.2.3.cmml">
           <mrow id="alg1.l28.m1.1.1.1.1.1.1.1" xref="alg1.l28.m1.1.1.1.1.1.1.1.cmml">
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.2" xref="alg1.l28.m1.1.1.1.1.1.1.1.2.cmml">
             s
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.3" xref="alg1.l28.m1.1.1.1.1.1.1.1.3.cmml">
             u
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.4" xref="alg1.l28.m1.1.1.1.1.1.1.1.4.cmml">
             c
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.5" xref="alg1.l28.m1.1.1.1.1.1.1.1.5.cmml">
             c
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.6" xref="alg1.l28.m1.1.1.1.1.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.7" xref="alg1.l28.m1.1.1.1.1.1.1.1.7.cmml">
             s
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.1.1.1.8" xref="alg1.l28.m1.1.1.1.1.1.1.1.8.cmml">
             s
            </mi>
           </mrow>
           <mo id="alg1.l28.m1.1.1.1.1.2.2.3" xref="alg1.l28.m1.1.1.1.1.2.3.cmml">
            ,
           </mo>
           <mrow id="alg1.l28.m1.1.1.1.1.2.2.2" xref="alg1.l28.m1.1.1.1.1.2.2.2.cmml">
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.2" xref="alg1.l28.m1.1.1.1.1.2.2.2.2.cmml">
             b
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.3" xref="alg1.l28.m1.1.1.1.1.2.2.2.3.cmml">
             u
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.2.2.2.1a" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.4" xref="alg1.l28.m1.1.1.1.1.2.2.2.4.cmml">
             f
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.2.2.2.1b" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.5" xref="alg1.l28.m1.1.1.1.1.2.2.2.5.cmml">
             f
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.2.2.2.1c" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.6" xref="alg1.l28.m1.1.1.1.1.2.2.2.6.cmml">
             e
            </mi>
            <mo id="alg1.l28.m1.1.1.1.1.2.2.2.1d" lspace="0em" rspace="0em" xref="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.1.1.1.1.2.2.2.7" xref="alg1.l28.m1.1.1.1.1.2.2.2.7.cmml">
             r
            </mi>
           </mrow>
          </mrow>
          <mo id="alg1.l28.m1.1.1.1.1.3" stretchy="false" xref="alg1.l28.m1.1.1.1.1.3.cmml">
           ←
          </mo>
          <mi id="alg1.l28.m1.1.1.1.1.4" xref="alg1.l28.m1.1.1.1.1.4.cmml">
           P
          </mi>
         </mrow>
         <mo id="alg1.l28.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l28.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l28.m1.2.2.2.2" xref="alg1.l28.m1.2.2.2.2.cmml">
          <mtext id="alg1.l28.m1.2.2.2.2.3" xref="alg1.l28.m1.2.2.2.2.3a.cmml">
           alloc
          </mtext>
          <mo id="alg1.l28.m1.2.2.2.2.2" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l28.m1.2.2.2.2.1.1" xref="alg1.l28.m1.2.2.2.2.1.1.1.cmml">
           <mo id="alg1.l28.m1.2.2.2.2.1.1.2" stretchy="false" xref="alg1.l28.m1.2.2.2.2.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l28.m1.2.2.2.2.1.1.1" xref="alg1.l28.m1.2.2.2.2.1.1.1.cmml">
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.2" xref="alg1.l28.m1.2.2.2.2.1.1.1.2.cmml">
             n
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.3" xref="alg1.l28.m1.2.2.2.2.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.4" xref="alg1.l28.m1.2.2.2.2.1.1.1.4.cmml">
             e
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.5" xref="alg1.l28.m1.2.2.2.2.1.1.1.5.cmml">
             d
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.6" xref="alg1.l28.m1.2.2.2.2.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.7" xref="alg1.l28.m1.2.2.2.2.1.1.1.7.cmml">
             d
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.8" mathvariant="normal" xref="alg1.l28.m1.2.2.2.2.1.1.1.8.cmml">
             _
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.9" xref="alg1.l28.m1.2.2.2.2.1.1.1.9.cmml">
             s
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.10" xref="alg1.l28.m1.2.2.2.2.1.1.1.10.cmml">
             i
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1h" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.11" xref="alg1.l28.m1.2.2.2.2.1.1.1.11.cmml">
             z
            </mi>
            <mo id="alg1.l28.m1.2.2.2.2.1.1.1.1i" lspace="0em" rspace="0em" xref="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l28.m1.2.2.2.2.1.1.1.12" xref="alg1.l28.m1.2.2.2.2.1.1.1.12.cmml">
             e
            </mi>
           </mrow>
           <mo id="alg1.l28.m1.2.2.2.2.1.1.3" stretchy="false" xref="alg1.l28.m1.2.2.2.2.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l28.m1.2b">
         <apply id="alg1.l28.m1.2.2.3.cmml" xref="alg1.l28.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l28.m1.2.2.3a.cmml" xref="alg1.l28.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l28.m1.1.1.1.1.cmml" xref="alg1.l28.m1.1.1.1.1">
           <ci id="alg1.l28.m1.1.1.1.1.3.cmml" xref="alg1.l28.m1.1.1.1.1.3">
            ←
           </ci>
           <list id="alg1.l28.m1.1.1.1.1.2.3.cmml" xref="alg1.l28.m1.1.1.1.1.2.2">
            <apply id="alg1.l28.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1">
             <times id="alg1.l28.m1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.1">
             </times>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.2">
              𝑠
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.3">
              𝑢
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.4.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.4">
              𝑐
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.5.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.5">
              𝑐
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.6.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.6">
              𝑒
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.7.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.7">
              𝑠
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.1.1.1.8.cmml" xref="alg1.l28.m1.1.1.1.1.1.1.1.8">
              𝑠
             </ci>
            </apply>
            <apply id="alg1.l28.m1.1.1.1.1.2.2.2.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2">
             <times id="alg1.l28.m1.1.1.1.1.2.2.2.1.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.1">
             </times>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.2.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.2">
              𝑏
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.3.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.3">
              𝑢
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.4.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.4">
              𝑓
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.5.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.5">
              𝑓
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.6.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.6">
              𝑒
             </ci>
             <ci id="alg1.l28.m1.1.1.1.1.2.2.2.7.cmml" xref="alg1.l28.m1.1.1.1.1.2.2.2.7">
              𝑟
             </ci>
            </apply>
           </list>
           <ci id="alg1.l28.m1.1.1.1.1.4.cmml" xref="alg1.l28.m1.1.1.1.1.4">
            𝑃
           </ci>
          </apply>
          <apply id="alg1.l28.m1.2.2.2.2.cmml" xref="alg1.l28.m1.2.2.2.2">
           <times id="alg1.l28.m1.2.2.2.2.2.cmml" xref="alg1.l28.m1.2.2.2.2.2">
           </times>
           <ci id="alg1.l28.m1.2.2.2.2.3a.cmml" xref="alg1.l28.m1.2.2.2.2.3">
            <mtext id="alg1.l28.m1.2.2.2.2.3.cmml" xref="alg1.l28.m1.2.2.2.2.3">
             alloc
            </mtext>
           </ci>
           <apply id="alg1.l28.m1.2.2.2.2.1.1.1.cmml" xref="alg1.l28.m1.2.2.2.2.1.1">
            <times id="alg1.l28.m1.2.2.2.2.1.1.1.1.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.1">
            </times>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.2.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.2">
             𝑛
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.3.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.4.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.4">
             𝑒
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.5.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.5">
             𝑑
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.6.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.6">
             𝑒
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.7.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.7">
             𝑑
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.8.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.8">
             _
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.9.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.9">
             𝑠
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.10.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.10">
             𝑖
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.11.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.11">
             𝑧
            </ci>
            <ci id="alg1.l28.m1.2.2.2.2.1.1.1.12.cmml" xref="alg1.l28.m1.2.2.2.2.1.1.1.12">
             𝑒
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l28.m1.2c">
         success,buffer\leftarrow P.\text{alloc}(needed\_size)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l29">
      <math alttext="B.\text{run}(buffer)" class="ltx_Math" display="inline" id="alg1.l29.m1.2">
       <semantics id="alg1.l29.m1.2a">
        <mrow id="alg1.l29.m1.2.2.1" xref="alg1.l29.m1.2.2.2.cmml">
         <mi id="alg1.l29.m1.1.1" xref="alg1.l29.m1.1.1.cmml">
          B
         </mi>
         <mo id="alg1.l29.m1.2.2.1.2" lspace="0em" rspace="0.167em" xref="alg1.l29.m1.2.2.2a.cmml">
          .
         </mo>
         <mrow id="alg1.l29.m1.2.2.1.1" xref="alg1.l29.m1.2.2.1.1.cmml">
          <mtext id="alg1.l29.m1.2.2.1.1.3" xref="alg1.l29.m1.2.2.1.1.3a.cmml">
           run
          </mtext>
          <mo id="alg1.l29.m1.2.2.1.1.2" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l29.m1.2.2.1.1.1.1" xref="alg1.l29.m1.2.2.1.1.1.1.1.cmml">
           <mo id="alg1.l29.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.l29.m1.2.2.1.1.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l29.m1.2.2.1.1.1.1.1" xref="alg1.l29.m1.2.2.1.1.1.1.1.cmml">
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.2" xref="alg1.l29.m1.2.2.1.1.1.1.1.2.cmml">
             b
            </mi>
            <mo id="alg1.l29.m1.2.2.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.3" xref="alg1.l29.m1.2.2.1.1.1.1.1.3.cmml">
             u
            </mi>
            <mo id="alg1.l29.m1.2.2.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.4" xref="alg1.l29.m1.2.2.1.1.1.1.1.4.cmml">
             f
            </mi>
            <mo id="alg1.l29.m1.2.2.1.1.1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.5" xref="alg1.l29.m1.2.2.1.1.1.1.1.5.cmml">
             f
            </mi>
            <mo id="alg1.l29.m1.2.2.1.1.1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.6" xref="alg1.l29.m1.2.2.1.1.1.1.1.6.cmml">
             e
            </mi>
            <mo id="alg1.l29.m1.2.2.1.1.1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l29.m1.2.2.1.1.1.1.1.7" xref="alg1.l29.m1.2.2.1.1.1.1.1.7.cmml">
             r
            </mi>
           </mrow>
           <mo id="alg1.l29.m1.2.2.1.1.1.1.3" stretchy="false" xref="alg1.l29.m1.2.2.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l29.m1.2b">
         <apply id="alg1.l29.m1.2.2.2.cmml" xref="alg1.l29.m1.2.2.1">
          <csymbol cd="ambiguous" id="alg1.l29.m1.2.2.2a.cmml" xref="alg1.l29.m1.2.2.1.2">
           formulae-sequence
          </csymbol>
          <ci id="alg1.l29.m1.1.1.cmml" xref="alg1.l29.m1.1.1">
           𝐵
          </ci>
          <apply id="alg1.l29.m1.2.2.1.1.cmml" xref="alg1.l29.m1.2.2.1.1">
           <times id="alg1.l29.m1.2.2.1.1.2.cmml" xref="alg1.l29.m1.2.2.1.1.2">
           </times>
           <ci id="alg1.l29.m1.2.2.1.1.3a.cmml" xref="alg1.l29.m1.2.2.1.1.3">
            <mtext id="alg1.l29.m1.2.2.1.1.3.cmml" xref="alg1.l29.m1.2.2.1.1.3">
             run
            </mtext>
           </ci>
           <apply id="alg1.l29.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l29.m1.2.2.1.1.1.1">
            <times id="alg1.l29.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.1">
            </times>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.2">
             𝑏
            </ci>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.3">
             𝑢
            </ci>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.4.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.4">
             𝑓
            </ci>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.5.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.5">
             𝑓
            </ci>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.6.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.6">
             𝑒
            </ci>
            <ci id="alg1.l29.m1.2.2.1.1.1.1.1.7.cmml" xref="alg1.l29.m1.2.2.1.1.1.1.1.7">
             𝑟
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l29.m1.2c">
         B.\text{run}(buffer)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l30">
      <span class="ltx_text" id="alg1.l30.1">
       // Process finished requests
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l31">
      <math alttext="finished\_requests\leftarrow B.\text{drop\_finished\_requests}()" class="ltx_Math" display="inline" id="alg1.l31.m1.2">
       <semantics id="alg1.l31.m1.2a">
        <mrow id="alg1.l31.m1.2.2.2" xref="alg1.l31.m1.2.2.3.cmml">
         <mrow id="alg1.l31.m1.1.1.1.1" xref="alg1.l31.m1.1.1.1.1.cmml">
          <mrow id="alg1.l31.m1.1.1.1.1.2" xref="alg1.l31.m1.1.1.1.1.2.cmml">
           <mi id="alg1.l31.m1.1.1.1.1.2.2" xref="alg1.l31.m1.1.1.1.1.2.2.cmml">
            f
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.3" xref="alg1.l31.m1.1.1.1.1.2.3.cmml">
            i
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.4" xref="alg1.l31.m1.1.1.1.1.2.4.cmml">
            n
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1b" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.5" xref="alg1.l31.m1.1.1.1.1.2.5.cmml">
            i
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1c" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.6" xref="alg1.l31.m1.1.1.1.1.2.6.cmml">
            s
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1d" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.7" xref="alg1.l31.m1.1.1.1.1.2.7.cmml">
            h
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1e" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.8" xref="alg1.l31.m1.1.1.1.1.2.8.cmml">
            e
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1f" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.9" xref="alg1.l31.m1.1.1.1.1.2.9.cmml">
            d
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1g" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.10" mathvariant="normal" xref="alg1.l31.m1.1.1.1.1.2.10.cmml">
            _
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1h" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.11" xref="alg1.l31.m1.1.1.1.1.2.11.cmml">
            r
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1i" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.12" xref="alg1.l31.m1.1.1.1.1.2.12.cmml">
            e
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1j" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.13" xref="alg1.l31.m1.1.1.1.1.2.13.cmml">
            q
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1k" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.14" xref="alg1.l31.m1.1.1.1.1.2.14.cmml">
            u
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1l" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.15" xref="alg1.l31.m1.1.1.1.1.2.15.cmml">
            e
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1m" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.16" xref="alg1.l31.m1.1.1.1.1.2.16.cmml">
            s
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1n" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.17" xref="alg1.l31.m1.1.1.1.1.2.17.cmml">
            t
           </mi>
           <mo id="alg1.l31.m1.1.1.1.1.2.1o" lspace="0em" rspace="0em" xref="alg1.l31.m1.1.1.1.1.2.1.cmml">
            ​
           </mo>
           <mi id="alg1.l31.m1.1.1.1.1.2.18" xref="alg1.l31.m1.1.1.1.1.2.18.cmml">
            s
           </mi>
          </mrow>
          <mo id="alg1.l31.m1.1.1.1.1.1" stretchy="false" xref="alg1.l31.m1.1.1.1.1.1.cmml">
           ←
          </mo>
          <mi id="alg1.l31.m1.1.1.1.1.3" xref="alg1.l31.m1.1.1.1.1.3.cmml">
           B
          </mi>
         </mrow>
         <mo id="alg1.l31.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l31.m1.2.2.3a.cmml">
          .
         </mo>
         <mrow id="alg1.l31.m1.2.2.2.2" xref="alg1.l31.m1.2.2.2.2.cmml">
          <mtext id="alg1.l31.m1.2.2.2.2.2" xref="alg1.l31.m1.2.2.2.2.2a.cmml">
           drop_finished_requests
          </mtext>
          <mo id="alg1.l31.m1.2.2.2.2.1" lspace="0em" rspace="0em" xref="alg1.l31.m1.2.2.2.2.1.cmml">
           ​
          </mo>
          <mrow id="alg1.l31.m1.2.2.2.2.3.2" xref="alg1.l31.m1.2.2.2.2.cmml">
           <mo id="alg1.l31.m1.2.2.2.2.3.2.1" stretchy="false" xref="alg1.l31.m1.2.2.2.2.3.1.cmml">
            (
           </mo>
           <mo id="alg1.l31.m1.2.2.2.2.3.2.2" stretchy="false" xref="alg1.l31.m1.2.2.2.2.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l31.m1.2b">
         <apply id="alg1.l31.m1.2.2.3.cmml" xref="alg1.l31.m1.2.2.2">
          <csymbol cd="ambiguous" id="alg1.l31.m1.2.2.3a.cmml" xref="alg1.l31.m1.2.2.2.3">
           formulae-sequence
          </csymbol>
          <apply id="alg1.l31.m1.1.1.1.1.cmml" xref="alg1.l31.m1.1.1.1.1">
           <ci id="alg1.l31.m1.1.1.1.1.1.cmml" xref="alg1.l31.m1.1.1.1.1.1">
            ←
           </ci>
           <apply id="alg1.l31.m1.1.1.1.1.2.cmml" xref="alg1.l31.m1.1.1.1.1.2">
            <times id="alg1.l31.m1.1.1.1.1.2.1.cmml" xref="alg1.l31.m1.1.1.1.1.2.1">
            </times>
            <ci id="alg1.l31.m1.1.1.1.1.2.2.cmml" xref="alg1.l31.m1.1.1.1.1.2.2">
             𝑓
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.3.cmml" xref="alg1.l31.m1.1.1.1.1.2.3">
             𝑖
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.4.cmml" xref="alg1.l31.m1.1.1.1.1.2.4">
             𝑛
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.5.cmml" xref="alg1.l31.m1.1.1.1.1.2.5">
             𝑖
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.6.cmml" xref="alg1.l31.m1.1.1.1.1.2.6">
             𝑠
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.7.cmml" xref="alg1.l31.m1.1.1.1.1.2.7">
             ℎ
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.8.cmml" xref="alg1.l31.m1.1.1.1.1.2.8">
             𝑒
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.9.cmml" xref="alg1.l31.m1.1.1.1.1.2.9">
             𝑑
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.10.cmml" xref="alg1.l31.m1.1.1.1.1.2.10">
             _
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.11.cmml" xref="alg1.l31.m1.1.1.1.1.2.11">
             𝑟
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.12.cmml" xref="alg1.l31.m1.1.1.1.1.2.12">
             𝑒
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.13.cmml" xref="alg1.l31.m1.1.1.1.1.2.13">
             𝑞
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.14.cmml" xref="alg1.l31.m1.1.1.1.1.2.14">
             𝑢
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.15.cmml" xref="alg1.l31.m1.1.1.1.1.2.15">
             𝑒
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.16.cmml" xref="alg1.l31.m1.1.1.1.1.2.16">
             𝑠
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.17.cmml" xref="alg1.l31.m1.1.1.1.1.2.17">
             𝑡
            </ci>
            <ci id="alg1.l31.m1.1.1.1.1.2.18.cmml" xref="alg1.l31.m1.1.1.1.1.2.18">
             𝑠
            </ci>
           </apply>
           <ci id="alg1.l31.m1.1.1.1.1.3.cmml" xref="alg1.l31.m1.1.1.1.1.3">
            𝐵
           </ci>
          </apply>
          <apply id="alg1.l31.m1.2.2.2.2.cmml" xref="alg1.l31.m1.2.2.2.2">
           <times id="alg1.l31.m1.2.2.2.2.1.cmml" xref="alg1.l31.m1.2.2.2.2.1">
           </times>
           <ci id="alg1.l31.m1.2.2.2.2.2a.cmml" xref="alg1.l31.m1.2.2.2.2.2">
            <mtext id="alg1.l31.m1.2.2.2.2.2.cmml" xref="alg1.l31.m1.2.2.2.2.2">
             drop_finished_requests
            </mtext>
           </ci>
           <list id="alg1.l31.m1.2.2.2.2.3.1.cmml" xref="alg1.l31.m1.2.2.2.2.3.2.1">
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l31.m1.2c">
         finished\_requests\leftarrow B.\text{drop\_finished\_requests}()
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l32">
      <span class="ltx_text ltx_font_bold" id="alg1.l32.1">
       for
      </span>
      <math alttext="req\in finished\_requests" class="ltx_Math" display="inline" id="alg1.l32.m1.1">
       <semantics id="alg1.l32.m1.1a">
        <mrow id="alg1.l32.m1.1.1" xref="alg1.l32.m1.1.1.cmml">
         <mrow id="alg1.l32.m1.1.1.2" xref="alg1.l32.m1.1.1.2.cmml">
          <mi id="alg1.l32.m1.1.1.2.2" xref="alg1.l32.m1.1.1.2.2.cmml">
           r
          </mi>
          <mo id="alg1.l32.m1.1.1.2.1" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.2.3" xref="alg1.l32.m1.1.1.2.3.cmml">
           e
          </mi>
          <mo id="alg1.l32.m1.1.1.2.1a" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.2.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.2.4" xref="alg1.l32.m1.1.1.2.4.cmml">
           q
          </mi>
         </mrow>
         <mo id="alg1.l32.m1.1.1.1" xref="alg1.l32.m1.1.1.1.cmml">
          ∈
         </mo>
         <mrow id="alg1.l32.m1.1.1.3" xref="alg1.l32.m1.1.1.3.cmml">
          <mi id="alg1.l32.m1.1.1.3.2" xref="alg1.l32.m1.1.1.3.2.cmml">
           f
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.3" xref="alg1.l32.m1.1.1.3.3.cmml">
           i
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.4" xref="alg1.l32.m1.1.1.3.4.cmml">
           n
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1b" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.5" xref="alg1.l32.m1.1.1.3.5.cmml">
           i
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1c" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.6" xref="alg1.l32.m1.1.1.3.6.cmml">
           s
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1d" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.7" xref="alg1.l32.m1.1.1.3.7.cmml">
           h
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1e" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.8" xref="alg1.l32.m1.1.1.3.8.cmml">
           e
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1f" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.9" xref="alg1.l32.m1.1.1.3.9.cmml">
           d
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1g" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.10" mathvariant="normal" xref="alg1.l32.m1.1.1.3.10.cmml">
           _
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1h" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.11" xref="alg1.l32.m1.1.1.3.11.cmml">
           r
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1i" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.12" xref="alg1.l32.m1.1.1.3.12.cmml">
           e
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1j" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.13" xref="alg1.l32.m1.1.1.3.13.cmml">
           q
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1k" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.14" xref="alg1.l32.m1.1.1.3.14.cmml">
           u
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1l" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.15" xref="alg1.l32.m1.1.1.3.15.cmml">
           e
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1m" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.16" xref="alg1.l32.m1.1.1.3.16.cmml">
           s
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1n" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.17" xref="alg1.l32.m1.1.1.3.17.cmml">
           t
          </mi>
          <mo id="alg1.l32.m1.1.1.3.1o" lspace="0em" rspace="0em" xref="alg1.l32.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="alg1.l32.m1.1.1.3.18" xref="alg1.l32.m1.1.1.3.18.cmml">
           s
          </mi>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l32.m1.1b">
         <apply id="alg1.l32.m1.1.1.cmml" xref="alg1.l32.m1.1.1">
          <in id="alg1.l32.m1.1.1.1.cmml" xref="alg1.l32.m1.1.1.1">
          </in>
          <apply id="alg1.l32.m1.1.1.2.cmml" xref="alg1.l32.m1.1.1.2">
           <times id="alg1.l32.m1.1.1.2.1.cmml" xref="alg1.l32.m1.1.1.2.1">
           </times>
           <ci id="alg1.l32.m1.1.1.2.2.cmml" xref="alg1.l32.m1.1.1.2.2">
            𝑟
           </ci>
           <ci id="alg1.l32.m1.1.1.2.3.cmml" xref="alg1.l32.m1.1.1.2.3">
            𝑒
           </ci>
           <ci id="alg1.l32.m1.1.1.2.4.cmml" xref="alg1.l32.m1.1.1.2.4">
            𝑞
           </ci>
          </apply>
          <apply id="alg1.l32.m1.1.1.3.cmml" xref="alg1.l32.m1.1.1.3">
           <times id="alg1.l32.m1.1.1.3.1.cmml" xref="alg1.l32.m1.1.1.3.1">
           </times>
           <ci id="alg1.l32.m1.1.1.3.2.cmml" xref="alg1.l32.m1.1.1.3.2">
            𝑓
           </ci>
           <ci id="alg1.l32.m1.1.1.3.3.cmml" xref="alg1.l32.m1.1.1.3.3">
            𝑖
           </ci>
           <ci id="alg1.l32.m1.1.1.3.4.cmml" xref="alg1.l32.m1.1.1.3.4">
            𝑛
           </ci>
           <ci id="alg1.l32.m1.1.1.3.5.cmml" xref="alg1.l32.m1.1.1.3.5">
            𝑖
           </ci>
           <ci id="alg1.l32.m1.1.1.3.6.cmml" xref="alg1.l32.m1.1.1.3.6">
            𝑠
           </ci>
           <ci id="alg1.l32.m1.1.1.3.7.cmml" xref="alg1.l32.m1.1.1.3.7">
            ℎ
           </ci>
           <ci id="alg1.l32.m1.1.1.3.8.cmml" xref="alg1.l32.m1.1.1.3.8">
            𝑒
           </ci>
           <ci id="alg1.l32.m1.1.1.3.9.cmml" xref="alg1.l32.m1.1.1.3.9">
            𝑑
           </ci>
           <ci id="alg1.l32.m1.1.1.3.10.cmml" xref="alg1.l32.m1.1.1.3.10">
            _
           </ci>
           <ci id="alg1.l32.m1.1.1.3.11.cmml" xref="alg1.l32.m1.1.1.3.11">
            𝑟
           </ci>
           <ci id="alg1.l32.m1.1.1.3.12.cmml" xref="alg1.l32.m1.1.1.3.12">
            𝑒
           </ci>
           <ci id="alg1.l32.m1.1.1.3.13.cmml" xref="alg1.l32.m1.1.1.3.13">
            𝑞
           </ci>
           <ci id="alg1.l32.m1.1.1.3.14.cmml" xref="alg1.l32.m1.1.1.3.14">
            𝑢
           </ci>
           <ci id="alg1.l32.m1.1.1.3.15.cmml" xref="alg1.l32.m1.1.1.3.15">
            𝑒
           </ci>
           <ci id="alg1.l32.m1.1.1.3.16.cmml" xref="alg1.l32.m1.1.1.3.16">
            𝑠
           </ci>
           <ci id="alg1.l32.m1.1.1.3.17.cmml" xref="alg1.l32.m1.1.1.3.17">
            𝑡
           </ci>
           <ci id="alg1.l32.m1.1.1.3.18.cmml" xref="alg1.l32.m1.1.1.3.18">
            𝑠
           </ci>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l32.m1.1c">
         req\in finished\_requests
        </annotation>
       </semantics>
      </math>
      <span class="ltx_text ltx_font_bold" id="alg1.l32.2">
       do
      </span>
     </div>
     <div class="ltx_listingline" id="alg1.l33">
      <math alttext="T.\text{decrease\_ref\_counter}(req.prefix\_node)" class="ltx_math_unparsed" display="inline" id="alg1.l33.m1.2">
       <semantics id="alg1.l33.m1.2a">
        <mrow id="alg1.l33.m1.2b">
         <mi id="alg1.l33.m1.1.1">
          T
         </mi>
         <mo id="alg1.l33.m1.2.3" lspace="0em" rspace="0.167em">
          .
         </mo>
         <mtext id="alg1.l33.m1.2.2">
          decrease_ref_counter
         </mtext>
         <mrow id="alg1.l33.m1.2.4">
          <mo id="alg1.l33.m1.2.4.1" stretchy="false">
           (
          </mo>
          <mi id="alg1.l33.m1.2.4.2">
           r
          </mi>
          <mi id="alg1.l33.m1.2.4.3">
           e
          </mi>
          <mi id="alg1.l33.m1.2.4.4">
           q
          </mi>
          <mo id="alg1.l33.m1.2.4.5" lspace="0em" rspace="0.167em">
           .
          </mo>
          <mi id="alg1.l33.m1.2.4.6">
           p
          </mi>
          <mi id="alg1.l33.m1.2.4.7">
           r
          </mi>
          <mi id="alg1.l33.m1.2.4.8">
           e
          </mi>
          <mi id="alg1.l33.m1.2.4.9">
           f
          </mi>
          <mi id="alg1.l33.m1.2.4.10">
           i
          </mi>
          <mi id="alg1.l33.m1.2.4.11">
           x
          </mi>
          <mi id="alg1.l33.m1.2.4.12" mathvariant="normal">
           _
          </mi>
          <mi id="alg1.l33.m1.2.4.13">
           n
          </mi>
          <mi id="alg1.l33.m1.2.4.14">
           o
          </mi>
          <mi id="alg1.l33.m1.2.4.15">
           d
          </mi>
          <mi id="alg1.l33.m1.2.4.16">
           e
          </mi>
          <mo id="alg1.l33.m1.2.4.17" stretchy="false">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation encoding="application/x-tex" id="alg1.l33.m1.2c">
         T.\text{decrease\_ref\_counter}(req.prefix\_node)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l34">
      <math alttext="T.\text{insert}(req)" class="ltx_Math" display="inline" id="alg1.l34.m1.2">
       <semantics id="alg1.l34.m1.2a">
        <mrow id="alg1.l34.m1.2.2.1" xref="alg1.l34.m1.2.2.2.cmml">
         <mi id="alg1.l34.m1.1.1" xref="alg1.l34.m1.1.1.cmml">
          T
         </mi>
         <mo id="alg1.l34.m1.2.2.1.2" lspace="0em" rspace="0.167em" xref="alg1.l34.m1.2.2.2a.cmml">
          .
         </mo>
         <mrow id="alg1.l34.m1.2.2.1.1" xref="alg1.l34.m1.2.2.1.1.cmml">
          <mtext id="alg1.l34.m1.2.2.1.1.3" xref="alg1.l34.m1.2.2.1.1.3a.cmml">
           insert
          </mtext>
          <mo id="alg1.l34.m1.2.2.1.1.2" lspace="0em" rspace="0em" xref="alg1.l34.m1.2.2.1.1.2.cmml">
           ​
          </mo>
          <mrow id="alg1.l34.m1.2.2.1.1.1.1" xref="alg1.l34.m1.2.2.1.1.1.1.1.cmml">
           <mo id="alg1.l34.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.l34.m1.2.2.1.1.1.1.1.cmml">
            (
           </mo>
           <mrow id="alg1.l34.m1.2.2.1.1.1.1.1" xref="alg1.l34.m1.2.2.1.1.1.1.1.cmml">
            <mi id="alg1.l34.m1.2.2.1.1.1.1.1.2" xref="alg1.l34.m1.2.2.1.1.1.1.1.2.cmml">
             r
            </mi>
            <mo id="alg1.l34.m1.2.2.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l34.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l34.m1.2.2.1.1.1.1.1.3" xref="alg1.l34.m1.2.2.1.1.1.1.1.3.cmml">
             e
            </mi>
            <mo id="alg1.l34.m1.2.2.1.1.1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l34.m1.2.2.1.1.1.1.1.1.cmml">
             ​
            </mo>
            <mi id="alg1.l34.m1.2.2.1.1.1.1.1.4" xref="alg1.l34.m1.2.2.1.1.1.1.1.4.cmml">
             q
            </mi>
           </mrow>
           <mo id="alg1.l34.m1.2.2.1.1.1.1.3" stretchy="false" xref="alg1.l34.m1.2.2.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l34.m1.2b">
         <apply id="alg1.l34.m1.2.2.2.cmml" xref="alg1.l34.m1.2.2.1">
          <csymbol cd="ambiguous" id="alg1.l34.m1.2.2.2a.cmml" xref="alg1.l34.m1.2.2.1.2">
           formulae-sequence
          </csymbol>
          <ci id="alg1.l34.m1.1.1.cmml" xref="alg1.l34.m1.1.1">
           𝑇
          </ci>
          <apply id="alg1.l34.m1.2.2.1.1.cmml" xref="alg1.l34.m1.2.2.1.1">
           <times id="alg1.l34.m1.2.2.1.1.2.cmml" xref="alg1.l34.m1.2.2.1.1.2">
           </times>
           <ci id="alg1.l34.m1.2.2.1.1.3a.cmml" xref="alg1.l34.m1.2.2.1.1.3">
            <mtext id="alg1.l34.m1.2.2.1.1.3.cmml" xref="alg1.l34.m1.2.2.1.1.3">
             insert
            </mtext>
           </ci>
           <apply id="alg1.l34.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l34.m1.2.2.1.1.1.1">
            <times id="alg1.l34.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l34.m1.2.2.1.1.1.1.1.1">
            </times>
            <ci id="alg1.l34.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.l34.m1.2.2.1.1.1.1.1.2">
             𝑟
            </ci>
            <ci id="alg1.l34.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.l34.m1.2.2.1.1.1.1.1.3">
             𝑒
            </ci>
            <ci id="alg1.l34.m1.2.2.1.1.1.1.1.4.cmml" xref="alg1.l34.m1.2.2.1.1.1.1.1.4">
             𝑞
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l34.m1.2c">
         T.\text{insert}(req)
        </annotation>
       </semantics>
      </math>
     </div>
     <div class="ltx_listingline" id="alg1.l35">
      <span class="ltx_text ltx_font_bold" id="alg1.l35.1">
       return
      </span>
      <math alttext="finished\_requests" class="ltx_Math" display="inline" id="alg1.l35.m1.1">
       <semantics id="alg1.l35.m1.1a">
        <mrow id="alg1.l35.m1.1.1" xref="alg1.l35.m1.1.1.cmml">
         <mi id="alg1.l35.m1.1.1.2" xref="alg1.l35.m1.1.1.2.cmml">
          f
         </mi>
         <mo id="alg1.l35.m1.1.1.1" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.3" xref="alg1.l35.m1.1.1.3.cmml">
          i
         </mi>
         <mo id="alg1.l35.m1.1.1.1a" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.4" xref="alg1.l35.m1.1.1.4.cmml">
          n
         </mi>
         <mo id="alg1.l35.m1.1.1.1b" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.5" xref="alg1.l35.m1.1.1.5.cmml">
          i
         </mi>
         <mo id="alg1.l35.m1.1.1.1c" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.6" xref="alg1.l35.m1.1.1.6.cmml">
          s
         </mi>
         <mo id="alg1.l35.m1.1.1.1d" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.7" xref="alg1.l35.m1.1.1.7.cmml">
          h
         </mi>
         <mo id="alg1.l35.m1.1.1.1e" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.8" xref="alg1.l35.m1.1.1.8.cmml">
          e
         </mi>
         <mo id="alg1.l35.m1.1.1.1f" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.9" xref="alg1.l35.m1.1.1.9.cmml">
          d
         </mi>
         <mo id="alg1.l35.m1.1.1.1g" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.10" mathvariant="normal" xref="alg1.l35.m1.1.1.10.cmml">
          _
         </mi>
         <mo id="alg1.l35.m1.1.1.1h" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.11" xref="alg1.l35.m1.1.1.11.cmml">
          r
         </mi>
         <mo id="alg1.l35.m1.1.1.1i" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.12" xref="alg1.l35.m1.1.1.12.cmml">
          e
         </mi>
         <mo id="alg1.l35.m1.1.1.1j" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.13" xref="alg1.l35.m1.1.1.13.cmml">
          q
         </mi>
         <mo id="alg1.l35.m1.1.1.1k" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.14" xref="alg1.l35.m1.1.1.14.cmml">
          u
         </mi>
         <mo id="alg1.l35.m1.1.1.1l" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.15" xref="alg1.l35.m1.1.1.15.cmml">
          e
         </mi>
         <mo id="alg1.l35.m1.1.1.1m" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.16" xref="alg1.l35.m1.1.1.16.cmml">
          s
         </mi>
         <mo id="alg1.l35.m1.1.1.1n" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.17" xref="alg1.l35.m1.1.1.17.cmml">
          t
         </mi>
         <mo id="alg1.l35.m1.1.1.1o" lspace="0em" rspace="0em" xref="alg1.l35.m1.1.1.1.cmml">
          ​
         </mo>
         <mi id="alg1.l35.m1.1.1.18" xref="alg1.l35.m1.1.1.18.cmml">
          s
         </mi>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="alg1.l35.m1.1b">
         <apply id="alg1.l35.m1.1.1.cmml" xref="alg1.l35.m1.1.1">
          <times id="alg1.l35.m1.1.1.1.cmml" xref="alg1.l35.m1.1.1.1">
          </times>
          <ci id="alg1.l35.m1.1.1.2.cmml" xref="alg1.l35.m1.1.1.2">
           𝑓
          </ci>
          <ci id="alg1.l35.m1.1.1.3.cmml" xref="alg1.l35.m1.1.1.3">
           𝑖
          </ci>
          <ci id="alg1.l35.m1.1.1.4.cmml" xref="alg1.l35.m1.1.1.4">
           𝑛
          </ci>
          <ci id="alg1.l35.m1.1.1.5.cmml" xref="alg1.l35.m1.1.1.5">
           𝑖
          </ci>
          <ci id="alg1.l35.m1.1.1.6.cmml" xref="alg1.l35.m1.1.1.6">
           𝑠
          </ci>
          <ci id="alg1.l35.m1.1.1.7.cmml" xref="alg1.l35.m1.1.1.7">
           ℎ
          </ci>
          <ci id="alg1.l35.m1.1.1.8.cmml" xref="alg1.l35.m1.1.1.8">
           𝑒
          </ci>
          <ci id="alg1.l35.m1.1.1.9.cmml" xref="alg1.l35.m1.1.1.9">
           𝑑
          </ci>
          <ci id="alg1.l35.m1.1.1.10.cmml" xref="alg1.l35.m1.1.1.10">
           _
          </ci>
          <ci id="alg1.l35.m1.1.1.11.cmml" xref="alg1.l35.m1.1.1.11">
           𝑟
          </ci>
          <ci id="alg1.l35.m1.1.1.12.cmml" xref="alg1.l35.m1.1.1.12">
           𝑒
          </ci>
          <ci id="alg1.l35.m1.1.1.13.cmml" xref="alg1.l35.m1.1.1.13">
           𝑞
          </ci>
          <ci id="alg1.l35.m1.1.1.14.cmml" xref="alg1.l35.m1.1.1.14">
           𝑢
          </ci>
          <ci id="alg1.l35.m1.1.1.15.cmml" xref="alg1.l35.m1.1.1.15">
           𝑒
          </ci>
          <ci id="alg1.l35.m1.1.1.16.cmml" xref="alg1.l35.m1.1.1.16">
           𝑠
          </ci>
          <ci id="alg1.l35.m1.1.1.17.cmml" xref="alg1.l35.m1.1.1.17">
           𝑡
          </ci>
          <ci id="alg1.l35.m1.1.1.18.cmml" xref="alg1.l35.m1.1.1.18">
           𝑠
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="alg1.l35.m1.1c">
         finished\_requests
        </annotation>
       </semantics>
      </math>
     </div>
    </div>
   </figure>
  </section>
  <section class="ltx_subsection" id="S5.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.3
    </span>
    Other Optimizations
   </h3>
   <div class="ltx_para" id="S5.SS3.p1">
    <p class="ltx_p" id="S5.SS3.p1.1">
     The development of new CUDA kernels is essential to enhance the efficiency of KV cache reuse.
Existing systems mostly implement CUDA kernels for two main functions: prefill and decoding. The prefill kernel assumes that the lengths of the query and key are identical. Conversely, the decode kernel assumes that the query length is one.
However, in the case of KV cache reuse, these kernels cannot be directly applied.
We introduce a new “extend” kernel for this computation, capable of reading the KV cache from both contiguous buffers and non-contiguous memory pools. This fused extend kernel operates without extra copy overhead.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S6">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    6
   </span>
   Evaluation
  </h2>
  <div class="ltx_para" id="S6.p1">
   <p class="ltx_p" id="S6.p1.1">
    SGLang and SGVM are implemented in approximately 9K lines of Python code. SGVM reuses some components from LightLLM
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib35" title="">
      35
     </a>
     ]
    </cite>
    , an LLM serving system based on PyTorch
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib43" title="">
      43
     </a>
     ]
    </cite>
    and Triton
    <cite class="ltx_cite ltx_citemacro_cite">
     [
     <a class="ltx_ref" href="#bib.bib57" title="">
      57
     </a>
     ]
    </cite>
    .
   </p>
  </div>
  <div class="ltx_para" id="S6.p2">
   <p class="ltx_p" id="S6.p2.1">
    We evaluate the performance of SGLang across a diverse range of LLM workloads. Subsequently, we conduct case studies and ablation studies to demonstrate the effectiveness of specific components.
   </p>
  </div>
  <section class="ltx_subsection" id="S6.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.1
    </span>
    Setup
   </h3>
   <div class="ltx_para ltx_noindent" id="S6.SS1.p1">
    <p class="ltx_p" id="S6.SS1.p1.1">
     <span class="ltx_text ltx_font_bold" id="S6.SS1.p1.1.1">
      Models.
     </span>
     We test the Llama 2 chat models
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib58" title="">
       58
      </a>
      ]
     </cite>
     , CodeLlama models
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib47" title="">
       47
      </a>
      ]
     </cite>
     , and vision language model LLaVA
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib29" title="">
       29
      </a>
      ]
     </cite>
     models of various sizes. The number of parameters ranges from 7B to 33B. We use float16 precision for Llama and CodeLlama models, and 4-bit quantized precision for LLaVA models.
    </p>
   </div>
   <div class="ltx_para ltx_noindent" id="S6.SS1.p2">
    <p class="ltx_p" id="S6.SS1.p2.1">
     <span class="ltx_text ltx_font_bold" id="S6.SS1.p2.1.1">
      Hardware.
     </span>
     Most experiments are conducted on AWS EC2 G5 instances unless otherwise stated. The GPUs on G5 instances are NVIDIA A10G GPUs, each with 24 GB of memory. The CPUs are AMD EPYC processors. For most experiments, we run 7B models with a single A10G GPU.
To see how our system handles larger models, we also test a 33B model on an A100 GPU (80GB).
    </p>
   </div>
   <div class="ltx_para ltx_noindent" id="S6.SS1.p3">
    <p class="ltx_p" id="S6.SS1.p3.1">
     <span class="ltx_text ltx_font_bold" id="S6.SS1.p3.1.1">
      Baseline.
     </span>
     We compare SGLang against both high-level programming systems with their respective languages and default runtimes, as well as low-level inference engines with standard OpenAI-like Completion APIs. The baselines include:
    </p>
    <ul class="ltx_itemize" id="S6.I1">
     <li class="ltx_item" id="S6.I1.i1" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S6.I1.i1.p1">
       <p class="ltx_p" id="S6.I1.i1.p1.1">
        Guidance
        <cite class="ltx_cite ltx_citemacro_cite">
         [
         <a class="ltx_ref" href="#bib.bib16" title="">
          16
         </a>
         ]
        </cite>
        , a language for controlling LLMs. We use Guidance v0.1.4 with the llama.cpp backend.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S6.I1.i2" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S6.I1.i2.p1">
       <p class="ltx_p" id="S6.I1.i2.p1.1">
        LMQL
        <cite class="ltx_cite ltx_citemacro_cite">
         [
         <a class="ltx_ref" href="#bib.bib4" title="">
          4
         </a>
         ]
        </cite>
        , a query language for LLMs. We use LMQL v0.7.3 with the Hugging Face Transformers backend.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S6.I1.i3" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S6.I1.i3.p1">
       <p class="ltx_p" id="S6.I1.i3.p1.1">
        vLLM
        <cite class="ltx_cite ltx_citemacro_cite">
         [
         <a class="ltx_ref" href="#bib.bib23" title="">
          23
         </a>
         ]
        </cite>
        , a high-throughput inference engine. We use vLLM v0.2.2 and its default API server.
       </p>
      </div>
     </li>
    </ul>
   </div>
   <div class="ltx_para ltx_noindent" id="S6.SS1.p4">
    <p class="ltx_p" id="S6.SS1.p4.1">
     <span class="ltx_text ltx_font_bold" id="S6.SS1.p4.1.1">
      Metrics.
     </span>
     We report two performance metrics: throughput and latency. For throughput, we run a sufficiently large batch of program instances to compute the maximum throughput, comparing the number of program instances executed per second (programs per second, p/s). For latency, we execute a single program at a time without batching and report the average latency for multiple instances. Unless otherwise stated, most of our optimizations do not change the computation results.
    </p>
   </div>
   <div class="ltx_para" id="S6.SS1.p5">
    <p class="ltx_p" id="S6.SS1.p5.1">
     While our primary focus is on runtime efficiency, we also conduct several case studies to compare the number of lines of code for productivity.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S6.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.2
    </span>
    End-to-End Benchmark
   </h3>
   <section class="ltx_subsubsection" id="S6.SS2.SSS1">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.2.1
     </span>
     Few-Shot In-Context Learning
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS1.p1">
     <p class="ltx_p" id="S6.SS2.SSS1.p1.1">
      We start with the most basic few-shot learning prompting.
We evaluate the maximum throughput of systems during batch processing of few-shot learning requests using three benchmarks, each with 5 shots. Results are shown in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F7" title="Figure 7 ‣ 6.2.1 Few-Shot In-Context Learning ‣ 6.2 End-to-End Benchmark ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 7
       </span>
      </a>
      .
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS1.p2">
     <p class="ltx_p" id="S6.SS2.SSS1.p2.1">
      MMLU
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib18" title="">
        18
       </a>
       ]
      </cite>
      is a multi-choice knowledge benchmark where the LLM outputs a single token (A/B/C/D) for answer selection. LMQL exhibits the worst performance due to its slow backend and complex pre- and post-processing. Guidance, being faster than LMQL, benefits from reduced processing overhead and some KV cache reuse. However, both systems support only a batch size of one. vLLM performs similarly to Guidance, but it lacks automatic KV cache reuse for the shared prefix. Although the vLLM paper discusses this feature, the released code does not support it due to the absence of a reliable high-performance kernel.
Even if a high-performance kernel is implemented for vLLM, manual configuration is required to use this feature.
Conversely, SGLang automatically achieves sharing with RadixAttention and attains a throughput that is
      <math alttext="4.4\times" class="ltx_math_unparsed" display="inline" id="S6.SS2.SSS1.p2.1.m1.1">
       <semantics id="S6.SS2.SSS1.p2.1.m1.1a">
        <mrow id="S6.SS2.SSS1.p2.1.m1.1b">
         <mn id="S6.SS2.SSS1.p2.1.m1.1.1">
          4.4
         </mn>
         <mo id="S6.SS2.SSS1.p2.1.m1.1.2" lspace="0.222em">
          ×
         </mo>
        </mrow>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS1.p2.1.m1.1c">
         4.4\times
        </annotation>
       </semantics>
      </math>
      higher than its closest competitor.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS1.p3">
     <p class="ltx_p" id="S6.SS2.SSS1.p3.1">
      HellaSwag
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib76" title="">
        76
       </a>
       ]
      </cite>
      is a multi-choice benchmark where each option is a short string. Unlike MMLU, which decodes a single output token, HellaSwag requires an LLM to calculate the probability of each string choice by performing a forward pass. LMQL exhibits slowness due to high overhead.
vLLM lacks a “select” primitive. Instead, it concatenates each choice with the prompt and computes the probability for the entire concatenated prompt for all choices, leading to redundant calculations.
Guidance, although offering a “select” feature, is limited to a batch size of 1. SGLang outperforms others by
      <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S6.SS2.SSS1.p3.1.m1.1">
       <semantics id="S6.SS2.SSS1.p3.1.m1.1a">
        <mrow id="S6.SS2.SSS1.p3.1.m1.1b">
         <mn id="S6.SS2.SSS1.p3.1.m1.1.1">
          2
         </mn>
         <mo id="S6.SS2.SSS1.p3.1.m1.1.2" lspace="0.222em">
          ×
         </mo>
        </mrow>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS1.p3.1.m1.1c">
         2\times
        </annotation>
       </semantics>
      </math>
      with automatic KV cache sharing and batching.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS1.p4">
     <p class="ltx_p" id="S6.SS2.SSS1.p4.1">
      GSM-8K
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib9" title="">
        9
       </a>
       ]
      </cite>
      is a benchmark that requires LLMs to generate a reasoning process and produce an integer answer. Since the benchmark demands longer output lengths, batching is crucial for enhanced throughput.
However, LMQL and guidance currently lack support for batching, leading to reduced performance. vLLM is also slow due to its inability to reuse the KV cache for the shared prefix.
In contrast, SGLang achieves a
      <math alttext="4.5\times" class="ltx_math_unparsed" display="inline" id="S6.SS2.SSS1.p4.1.m1.1">
       <semantics id="S6.SS2.SSS1.p4.1.m1.1a">
        <mrow id="S6.SS2.SSS1.p4.1.m1.1b">
         <mn id="S6.SS2.SSS1.p4.1.m1.1.1">
          4.5
         </mn>
         <mo id="S6.SS2.SSS1.p4.1.m1.1.2" lspace="0.222em">
          ×
         </mo>
        </mrow>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS1.p4.1.m1.1c">
         4.5\times
        </annotation>
       </semantics>
      </math>
      increase in throughput, thanks to the integration of RadixAttention and contiguous batching.
     </p>
    </div>
    <figure class="ltx_figure" id="S6.F7">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="202" id="S6.F7.g1" src="/html/2312.07104/assets/x7.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F7.2.1.1" style="font-size:90%;">
        Figure 7
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F7.3.2" style="font-size:90%;">
       Throughput on few-shot in-context learning tasks.
      </span>
     </figcaption>
    </figure>
    <div class="ltx_para" id="S6.SS2.SSS1.p5">
     <p class="ltx_p" id="S6.SS2.SSS1.p5.1">
      Due to its overhead, LMQL often performs significantly worse than other systems in both short and long-generation tasks, so we will not include it in our future benchmarks.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS2.SSS2">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.2.2
     </span>
     LLM-Based Agents
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS2.p1">
     <p class="ltx_p" id="S6.SS2.SSS2.p1.1">
      We benchmark on two highly regarded agent frameworks: ReAct agent
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib71" title="">
        71
       </a>
       ]
      </cite>
      , which processes tasks in an interleaved manner by chaining multiple LLM calls with actions like web search; and generative agents
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib42" title="">
        42
       </a>
       ]
      </cite>
      , employed in a gaming environment where agents interact with each other and make decisions by invoking LLMs. Both original papers utilized OpenAI models.
To accurately gauge potential performance gains, we mirrored the settings described in the papers and used GPT-3.5-turbo as the backbone model, and then traced the input and output of LLM calls to create a dataset.
For ReAct agents, we used the HotpotQA
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib69" title="">
        69
       </a>
       ]
      </cite>
      evaluation as reported in the paper. For generative agents, we rewrote the top five functions (out of forty traced) from the game using SGLang, which accounts for approximately 70% of all LLM calls.
We then replayed these traces on our experimental platform.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS2.p2">
     <p class="ltx_p" id="S6.SS2.SSS2.p2.2">
      As depicted in Figure
      <a class="ltx_ref" href="#S6.F8" title="Figure 8 ‣ 6.2.2 LLM-Based Agents ‣ 6.2 End-to-End Benchmark ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        8
       </span>
      </a>
      , the ReAct agent, using SGLang, achieves a throughput that is
      <math alttext="5.6\times" class="ltx_math_unparsed" display="inline" id="S6.SS2.SSS2.p2.1.m1.1">
       <semantics id="S6.SS2.SSS2.p2.1.m1.1a">
        <mrow id="S6.SS2.SSS2.p2.1.m1.1b">
         <mn id="S6.SS2.SSS2.p2.1.m1.1.1">
          5.6
         </mn>
         <mo id="S6.SS2.SSS2.p2.1.m1.1.2" lspace="0.222em">
          ×
         </mo>
        </mrow>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.1.m1.1c">
         5.6\times
        </annotation>
       </semantics>
      </math>
      higher than that of vLLM and has only
      <math alttext="13\%" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.2.m2.1">
       <semantics id="S6.SS2.SSS2.p2.2.m2.1a">
        <mrow id="S6.SS2.SSS2.p2.2.m2.1.1" xref="S6.SS2.SSS2.p2.2.m2.1.1.cmml">
         <mn id="S6.SS2.SSS2.p2.2.m2.1.1.2" xref="S6.SS2.SSS2.p2.2.m2.1.1.2.cmml">
          13
         </mn>
         <mo id="S6.SS2.SSS2.p2.2.m2.1.1.1" xref="S6.SS2.SSS2.p2.2.m2.1.1.1.cmml">
          %
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.2.m2.1b">
         <apply id="S6.SS2.SSS2.p2.2.m2.1.1.cmml" xref="S6.SS2.SSS2.p2.2.m2.1.1">
          <csymbol cd="latexml" id="S6.SS2.SSS2.p2.2.m2.1.1.1.cmml" xref="S6.SS2.SSS2.p2.2.m2.1.1.1">
           percent
          </csymbol>
          <cn id="S6.SS2.SSS2.p2.2.m2.1.1.2.cmml" type="integer" xref="S6.SS2.SSS2.p2.2.m2.1.1.2">
           13
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.2.m2.1c">
         13\%
        </annotation>
       </semantics>
      </math>
      of its latency. This improvement primarily results from the agent’s process of appending current states (thoughts, actions, and observations) to the prompt for subsequent LLM calls. Our RadixAttention mechanism effectively identifies and minimizes redundant computations, a capability not present in the current inference engines. This mechanism also significantly reduces memory usage, allowing more questions to be addressed by a greater number of agents, thereby optimizing GPU utilization and enhancing throughput.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS2.p3">
     <p class="ltx_p" id="S6.SS2.SSS2.p3.1">
      In the case of the generative agent task, the gaming setting’s constraints permit only a single LLM call per simulation to maintain game logic consistency. In this case, SGLang still outperforms vLLM by 30% in both throughput and latency. This efficiency is due to the caching of agents’ predefined routines, reducing redundant computations.
The task prompt templates contain multiple arguments that vary at different speeds based on timestamps, resulting in complex prefix reuse patterns. Nevertheless, the SGLang runtime can automatically detect these patterns and reuse the KV cache.
     </p>
    </div>
    <figure class="ltx_figure" id="S6.F8">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="206" id="S6.F8.g1" src="/html/2312.07104/assets/x8.png" width="415"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F8.2.1.1" style="font-size:90%;">
        Figure 8
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F8.3.2" style="font-size:90%;">
       Throughput and latency on agent tasks.
      </span>
     </figcaption>
    </figure>
    <figure class="ltx_figure" id="S6.F9">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="97" id="S6.F9.g1" src="/html/2312.07104/assets/x9.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F9.2.1.1" style="font-size:90%;">
        Figure 9
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F9.3.2" style="font-size:90%;">
       (a) Throughput on reasoning tasks. (b) Latency on reasoning tasks. (c) Throughput on content generation tasks. (d) Latency on content generation tasks. (e) Throughput on long-context tasks.
      </span>
     </figcaption>
    </figure>
   </section>
   <section class="ltx_subsubsection" id="S6.SS2.SSS3">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.2.3
     </span>
     Reasoning
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS3.p1">
     <p class="ltx_p" id="S6.SS2.SSS3.p1.1">
      We benchmark the performance of systems using advanced prompting techniques for reasoning tasks. These tasks involve solving GSM-8K problems in a zero-shot setting. Both throughput and latency metrics are reported in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F9" title="Figure 9 ‣ 6.2.2 LLM-Based Agents ‣ 6.2 End-to-End Benchmark ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 9
       </span>
      </a>
      (a)(b).
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS3.p2">
     <p class="ltx_p" id="S6.SS2.SSS3.p2.1">
      Multi-chain reasoning
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib73" title="">
        73
       </a>
       ]
      </cite>
      involves generating several solutions to one question and using meta-reasoning across these solutions for the final answer.
This process allows for sharing the question and parallelizing the generation of multiple solutions.
For each solution generation, we use various eliciting prompts such as "Think step-by-step" and "Take a deep breath". Unlike simple parallel sampling, this flexible approach with different eliciting prompts is not supported by the vLLM API. Hence, vLLM exhibits lower throughput due to its inability to share prefixes flexibly.
Guidance has lower throughput due to no batching.
In contrast, SGLang allows users to intuitively implement this technique without worrying about manual optimizations, yet achieve high throughput.
The improvement in throughput is not as substantial as in previous cases of few-shot learning, due to the zero-shot setting having a shorter shareable prefix.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS3.p3">
     <p class="ltx_p" id="S6.SS2.SSS3.p3.1">
      Regarding latency, the SGLang interpreter can automatically resolve dependencies and submit requests in parallel. For a fair comparison, we directly translate the SGLang program into an equivalent Python program without explicitly using threading or asyncio to avoid added complexity. Consequently, the translated program does not parallelize parallelizable requests, resulting in higher latency.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS3.p4">
     <p class="ltx_p" id="S6.SS2.SSS3.p4.1">
      Tree-of-thought
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib70" title="">
        70
       </a>
       ]
      </cite>
      incorporates LLMs into the breadth-first tree-search algorithm. The LLMs must propose the next steps for branch exploration, execute these proposals, and evaluate the solutions.
This method leads to complex sharing patterns beyond the capabilities of existing systems.
Once again, SGLang surpasses others in terms of both higher throughput and lower latency in this benchmark.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS2.SSS4">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.2.4
     </span>
     Content Generation
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS4.p1">
     <p class="ltx_p" id="S6.SS2.SSS4.p1.1">
      We evaluate two advanced prompting methods for content generation: tip generation and article review.
The skeleton-of-thought technique
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib37" title="">
        37
       </a>
       ]
      </cite>
      first creates a brief outline of tips, then elaborates each into a detailed paragraph. The branch-solve-merge approach
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib48" title="">
        48
       </a>
       ]
      </cite>
      assesses an article from multiple dimensions and then assigns a final grade.
Results are shown in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F9" title="Figure 9 ‣ 6.2.2 LLM-Based Agents ‣ 6.2 End-to-End Benchmark ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 9
       </span>
      </a>
      (c)(d).
In both cases, there are opportunities for sharing and intra-program parallelism. SGLang systematically exploits them through an intuitive programming model, achieving higher throughput and reduced latency.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS2.SSS5">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.2.5
     </span>
     Long Document Processing
    </h4>
    <div class="ltx_para" id="S6.SS2.SSS5.p1">
     <p class="ltx_p" id="S6.SS2.SSS5.p1.1">
      We benchmark the performance on long document processing tasks. When the document is long, KV cache reuse becomes more important as the forward pass to encode the prompt becomes significantly longer. We use CodeLlama models, which were fine-tuned on a context length of 16K tokens. On our setup, running a 7B model in fp16 precision on a 24 GB GPU, we can store at most 15K tokens. We select inputs exceeding 10K tokens in length, meaning the system can process only one request at a time at most.
The first benchmark tests answering questions using multiple document segments from a paper, akin to a retrieval augmented generation setup. The second benchmark involves summarizing a city’s information from its Wikipedia page and outputting a JSON object.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS2.SSS5.p2">
     <p class="ltx_p" id="S6.SS2.SSS5.p2.1">
      For the first benchmark, we employ the fork/join primitives in SGLang to implement parallel-context window
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib46" title="">
        46
       </a>
       ]
      </cite>
      . By using this technique, we can encode multiple documents separately in parallel and concatenate the resulting KV cache, without letting them attend to each other. This approach reduces the quadratic computational cost of self-attention for long prompts. While this optimization alters the computation, it does not negatively impact accuracy in our benchmark.
For the second benchmark, we reuse the KV cache of the long prompts when decoding multiple fields of the JSON object. The results are shown in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F9" title="Figure 9 ‣ 6.2.2 LLM-Based Agents ‣ 6.2 End-to-End Benchmark ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 9
       </span>
      </a>
      (e). SGLang achieves 1.2× and 2.9× improvement on these two benchmarks, respectively.
Since the maximum batch size is one, latency improvements are the same as throughput improvements.
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S6.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.3
    </span>
    Case Study
   </h3>
   <section class="ltx_subsubsection" id="S6.SS3.SSS1">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.3.1
     </span>
     Vision Language Models
    </h4>
    <div class="ltx_para" id="S6.SS3.SSS1.p1">
     <p class="ltx_p" id="S6.SS3.SSS1.p1.1">
      We conduct a case study to demonstrate the extensibility of SGLang by supporting a new vision language model, LLaVA v1.5
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib29" title="">
        29
       </a>
       ]
      </cite>
      , on a new hardware platform, Apple Silicon.
To achieve this, we add a new primitive,
      <span class="ltx_text ltx_font_typewriter" id="S6.SS3.SSS1.p1.1.1">
       sgl.image
      </span>
      , to accept image inputs, and incorporate a new backend, llama.cpp
      <cite class="ltx_cite ltx_citemacro_cite">
       [
       <a class="ltx_ref" href="#bib.bib15" title="">
        15
       </a>
       ]
      </cite>
      , an inference engine compatible with a wide range of hardware.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS3.SSS1.p2">
     <p class="ltx_p" id="S6.SS3.SSS1.p2.1">
      We integrate
      <span class="ltx_text ltx_font_typewriter" id="S6.SS3.SSS1.p2.1.1">
       sgl.image
      </span>
      as a new IR node into the interpreter and reuse the SGVM protocol to build a server based on llama.cpp. This integration is achieved in around 400 lines of code. Additionally, the code that uses
      <span class="ltx_text ltx_font_typewriter" id="S6.SS3.SSS1.p2.1.2">
       sgl.image
      </span>
      can be executed on GPT-4 Vision through the OpenAI back-end without code modification.
We create a cache for image tokens based on the image’s hash ID, similar to how we maintain RadixAttention.
We run the LLaVA-Bench and report the throughput using SGLang and the default llama.cpp server on an M2 Ultra. The LLaVA-Bench contains a total of 24 images and 60 questions, with 2.5 questions on each image on average.
SGLang increases the throughput of llama.cpp by 1.7
      <math alttext="\times" class="ltx_Math" display="inline" id="S6.SS3.SSS1.p2.1.m1.1">
       <semantics id="S6.SS3.SSS1.p2.1.m1.1a">
        <mo id="S6.SS3.SSS1.p2.1.m1.1.1" xref="S6.SS3.SSS1.p2.1.m1.1.1.cmml">
         ×
        </mo>
        <annotation-xml encoding="MathML-Content" id="S6.SS3.SSS1.p2.1.m1.1b">
         <times id="S6.SS3.SSS1.p2.1.m1.1.1.cmml" xref="S6.SS3.SSS1.p2.1.m1.1.1">
         </times>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS3.SSS1.p2.1.m1.1c">
         \times
        </annotation>
       </semantics>
      </math>
      . The speedup is mainly affected by the number of questions per shared image and the output length.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS3.SSS2">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.3.2
     </span>
     Compiler Optimizations
    </h4>
    <div class="ltx_para" id="S6.SS3.SSS2.p1">
     <p class="ltx_p" id="S6.SS3.SSS2.p1.1">
      We evaluate the effectiveness of two compiler optimizations. The first is GPT-4-assisted code movement for prefix sharing. We collect 20 prompt templates from the internet and implement them in SGLang.
We utilize 5 of these templates for few-shot training examples and the remaining 15 as test cases. Our evaluation shows that, for 12 out of the 15 templates, GPT-4 successfully reorders the graph nodes without altering the semantics, as confirmed by manual inspection of the modified prompts.
On average, this optimization results in a 60-token increase in the sharable prefix length, showcasing GPT-4’s effectiveness. Failures in creating optimized prompt order come from an incorrect understanding of the semantic meaning behind the graph nodes. It is too aggressive and puts all constants upfront even when such ordering changes the original semantics.
This case study aims to explore the use of GPT-4 for compiler optimizations. More work is needed to make these kinds of optimizations reliable in the future.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS3.SSS2.p2">
     <p class="ltx_p" id="S6.SS3.SSS2.p2.2">
      The second optimization involves prefetching annotation insertion.
For frequently used long prompts, we cache them in CPU memory. The compiler automatically inserts prefetch nodes into the computational graph. During runtime, when the server encounters a prefetch node, it evicts nodes from the radix tree and swaps in the cached prefix.
As the cost of swapping can be substantially overlapped, this reduces the first-token latency of the subsequent request.
We test SGLang programs that contain function calls with a
      <math alttext="4" class="ltx_Math" display="inline" id="S6.SS3.SSS2.p2.1.m1.1">
       <semantics id="S6.SS3.SSS2.p2.1.m1.1a">
        <mn id="S6.SS3.SSS2.p2.1.m1.1.1" xref="S6.SS3.SSS2.p2.1.m1.1.1.cmml">
         4
        </mn>
        <annotation-xml encoding="MathML-Content" id="S6.SS3.SSS2.p2.1.m1.1b">
         <cn id="S6.SS3.SSS2.p2.1.m1.1.1.cmml" type="integer" xref="S6.SS3.SSS2.p2.1.m1.1.1">
          4
         </cn>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS3.SSS2.p2.1.m1.1c">
         4
        </annotation>
       </semantics>
      </math>
      k prefix length. By prefetching the
      <math alttext="4" class="ltx_Math" display="inline" id="S6.SS3.SSS2.p2.2.m2.1">
       <semantics id="S6.SS3.SSS2.p2.2.m2.1a">
        <mn id="S6.SS3.SSS2.p2.2.m2.1.1" xref="S6.SS3.SSS2.p2.2.m2.1.1.cmml">
         4
        </mn>
        <annotation-xml encoding="MathML-Content" id="S6.SS3.SSS2.p2.2.m2.1b">
         <cn id="S6.SS3.SSS2.p2.2.m2.1.1.cmml" type="integer" xref="S6.SS3.SSS2.p2.2.m2.1.1">
          4
         </cn>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS3.SSS2.p2.2.m2.1c">
         4
        </annotation>
       </semantics>
      </math>
      k prefix, the first token latency of the called function has been reduced from 1 second to 0.2 seconds, which is a 80% reduction.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS3.SSS3">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.3.3
     </span>
     Productivity
    </h4>
    <div class="ltx_para" id="S6.SS3.SSS3.p1">
     <p class="ltx_p" id="S6.SS3.SSS3.p1.1">
      We conducted a case study to demonstrate SGLang’s productivity improvement by comparing its Lines of Code (LoC) with OpenAI APIs. We designed a prompting flow for article analysis: if it’s about a celebrity, the program generates a bio and introduction; otherwise, it summarizes the article. Implementing this flow in both OpenAI APIs and SGLang, we counted effective LoC, excluding comments and empty lines. The results show the OpenAI API required 206 lines, while SGLang needed only 91, marking a 55% reduction.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS3.SSS3.p2">
     <p class="ltx_p" id="S6.SS3.SSS3.p2.1">
      We delve into the implementations and summarize the insights regarding why SGLang is capable of using fewer LoC.
First, whereas users must manually extract content from OpenAI API responses and chain them to form a multi-step flow, SGLang simplifies this process by leveraging the string concatenation operator.
Second, since the flow involves several calls with restricted answers, such as true/false and integers, users are required to construct an appropriate logit bias to ensure OpenAI returns one of the expected answers. In contrast, SGLang provides primitives that automatically construct logit bias for this purpose, allowing users to merely specify the acceptable data type and choices.
Third, in cases where skeleton-based prompting is used to reduce end-to-end latency, OpenAI API users need to initiate a thread pool for parallel request submission explicitly. However, SGLang’s built-in primitive
      <span class="ltx_text ltx_font_typewriter" id="S6.SS3.SSS3.p2.1.1">
       fork
      </span>
      automatically parallelizes requests.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS3.SSS4">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.3.4
     </span>
     Larger Models
    </h4>
    <div class="ltx_para" id="S6.SS3.SSS4.p1">
     <p class="ltx_p" id="S6.SS3.SSS4.p1.1">
      While most of our experiments are conducted using a 7B model, our techniques also perform effectively on larger models. We test a 13B model on an A100 (40GB) and a 33B model on an A100 (80GB) using the ReAct agent benchmark, achieving a similar speedup (
      <math alttext="5\times" class="ltx_math_unparsed" display="inline" id="S6.SS3.SSS4.p1.1.m1.1">
       <semantics id="S6.SS3.SSS4.p1.1.m1.1a">
        <mrow id="S6.SS3.SSS4.p1.1.m1.1b">
         <mn id="S6.SS3.SSS4.p1.1.m1.1.1">
          5
         </mn>
         <mo id="S6.SS3.SSS4.p1.1.m1.1.2" lspace="0.222em">
          ×
         </mo>
        </mrow>
        <annotation encoding="application/x-tex" id="S6.SS3.SSS4.p1.1.m1.1c">
         5\times
        </annotation>
       </semantics>
      </math>
      ).
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S6.SS4">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.4
    </span>
    Ablation Study
   </h3>
   <section class="ltx_subsubsection" id="S6.SS4.SSS1">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.4.1
     </span>
     Scheduling Policy
    </h4>
    <figure class="ltx_figure" id="S6.F10">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="200" id="S6.F10.g1" src="/html/2312.07104/assets/x10.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F10.2.1.1" style="font-size:90%;">
        Figure 10
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F10.3.2" style="font-size:90%;">
       Performance of different scheduling policies.
      </span>
     </figcaption>
    </figure>
    <div class="ltx_para" id="S6.SS4.SSS1.p1">
     <p class="ltx_p" id="S6.SS4.SSS1.p1.1">
      We evaluate the effectiveness of our cache-aware scheduling by comparing it with several other policies. The results are shown in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F10" title="Figure 10 ‣ 6.4.1 Scheduling Policy ‣ 6.4 Ablation Study ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 10
       </span>
      </a>
      . “LMP”, or longest matching prefix, is the default policy outlined in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S5.SS2" title="5.2 Cache-Aware Scheduling ‣ 5 Runtime with RadixAttention ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Section 5.2
       </span>
      </a>
      . “Random” employs a random order. “FCFS” adheres to a first-come-first-serve policy. “No interpreter help” omits the prefix hints from the interpreter, which is explained in detail below.
Although RadixAttention can automatically detect shared prefixes, our runtime implementation is simplified: we only compare a pending request with the existing cache tree. We do not construct a tree index for all requests in the waiting queue. This approach may lead to suboptimal performance when there is a large batch of pending requests that share a prefix but have yet to be processed and inserted into the tree. To mitigate this, we use the interpreter to help with the scheduling. When the interpreter identifies a highly likely shared prefix (e.g., during a fork), it issues a forward request for this prefix first and stores it in the tree, and then it sends out the requests that can reuse the prefix. This method leverages hints from the interpreter to lessen the load on backend scheduling, underscoring the benefits of our co-design strategy.
As depicted in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F10" title="Figure 10 ‣ 6.4.1 Scheduling Policy ‣ 6.4 Ablation Study ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 10
       </span>
      </a>
      , “LPM” exhibits superior performance, while other policies struggle with a lower cache hit rate and reduced throughput.
All policies perform similarly for simple tasks like MMLU.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS4.SSS2">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.4.2
     </span>
     Optimization Breakdown
    </h4>
    <div class="ltx_para" id="S6.SS4.SSS2.p1">
     <p class="ltx_p" id="S6.SS4.SSS2.p1.1">
      We study the effectiveness of optimizations by disabling each one individually.
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F11" title="Figure 11 ‣ 6.4.2 Optimization Breakdown ‣ 6.4 Ablation Study ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 11
       </span>
      </a>
      illustrates the results.
“No Extend Kernel” disables our optimized kernel, leading to degraded performance, particularly in long-context tasks. “No Interpreter Parallelism” turns off intra-program parallelism, resulting in reduced parallelism and cache locality.
“No Cache” deactivates the cache, significantly deteriorating throughput across all benchmarks. “No Radix Tree” uses a list instead of a tree to manage the cache, leading to increased memory usage and copy overhead, and consequently, lower performance.
     </p>
    </div>
    <figure class="ltx_figure" id="S6.F11">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="186" id="S6.F11.g1" src="/html/2312.07104/assets/x11.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F11.2.1.1" style="font-size:90%;">
        Figure 11
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F11.3.2" style="font-size:90%;">
       Optimization breakdown.
      </span>
     </figcaption>
    </figure>
   </section>
   <section class="ltx_subsubsection" id="S6.SS4.SSS3">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.4.3
     </span>
     Improvements under Different Sharing Settings
    </h4>
    <div class="ltx_para" id="S6.SS4.SSS3.p1">
     <p class="ltx_p" id="S6.SS4.SSS3.p1.1">
      We study how the improvement of prefix sharing is influenced by different parameters, including the lengths of shareable and unshareable inputs, and sharing structure configurations.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS4.SSS3.p2">
     <p class="ltx_p" id="S6.SS4.SSS3.p2.1">
      As shown in
      <a class="ltx_ref ltx_refmacro_autoref" href="#S6.F12" title="Figure 12 ‣ 6.4.4 RadixAttention Overhead Analysis ‣ 6.4 Ablation Study ‣ 6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
       <span class="ltx_text ltx_ref_tag">
        Figure 12
       </span>
      </a>
      , in the left subfigure, we establish a base setting with a shareable input length of 256, an unshareable input length of 256, and an output length of 256. We then gradually increase either the shareable input length or the unshareable length and observe the changes in throughput. The results demonstrate that the RadixAttention cache significantly enhances throughput compared to the “No Cache” scenario, with more notable improvements observed when the shareable length is longer.
     </p>
    </div>
    <div class="ltx_para" id="S6.SS4.SSS3.p3">
     <p class="ltx_p" id="S6.SS4.SSS3.p3.1">
      In the right subfigure, we set a base scenario with 5 articles and 2 questions per article, where the article comprises 1000 tokens and each question 256 tokens. There are
      <math alttext="5\times 2=10" class="ltx_Math" display="inline" id="S6.SS4.SSS3.p3.1.m1.1">
       <semantics id="S6.SS4.SSS3.p3.1.m1.1a">
        <mrow id="S6.SS4.SSS3.p3.1.m1.1.1" xref="S6.SS4.SSS3.p3.1.m1.1.1.cmml">
         <mrow id="S6.SS4.SSS3.p3.1.m1.1.1.2" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.cmml">
          <mn id="S6.SS4.SSS3.p3.1.m1.1.1.2.2" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.2.cmml">
           5
          </mn>
          <mo id="S6.SS4.SSS3.p3.1.m1.1.1.2.1" lspace="0.222em" rspace="0.222em" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.1.cmml">
           ×
          </mo>
          <mn id="S6.SS4.SSS3.p3.1.m1.1.1.2.3" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.3.cmml">
           2
          </mn>
         </mrow>
         <mo id="S6.SS4.SSS3.p3.1.m1.1.1.1" xref="S6.SS4.SSS3.p3.1.m1.1.1.1.cmml">
          =
         </mo>
         <mn id="S6.SS4.SSS3.p3.1.m1.1.1.3" xref="S6.SS4.SSS3.p3.1.m1.1.1.3.cmml">
          10
         </mn>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS4.SSS3.p3.1.m1.1b">
         <apply id="S6.SS4.SSS3.p3.1.m1.1.1.cmml" xref="S6.SS4.SSS3.p3.1.m1.1.1">
          <eq id="S6.SS4.SSS3.p3.1.m1.1.1.1.cmml" xref="S6.SS4.SSS3.p3.1.m1.1.1.1">
          </eq>
          <apply id="S6.SS4.SSS3.p3.1.m1.1.1.2.cmml" xref="S6.SS4.SSS3.p3.1.m1.1.1.2">
           <times id="S6.SS4.SSS3.p3.1.m1.1.1.2.1.cmml" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.1">
           </times>
           <cn id="S6.SS4.SSS3.p3.1.m1.1.1.2.2.cmml" type="integer" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.2">
            5
           </cn>
           <cn id="S6.SS4.SSS3.p3.1.m1.1.1.2.3.cmml" type="integer" xref="S6.SS4.SSS3.p3.1.m1.1.1.2.3">
            2
           </cn>
          </apply>
          <cn id="S6.SS4.SSS3.p3.1.m1.1.1.3.cmml" type="integer" xref="S6.SS4.SSS3.p3.1.m1.1.1.3">
           10
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS4.SSS3.p3.1.m1.1c">
         5\times 2=10
        </annotation>
       </semantics>
      </math>
      requests in this base setting, with each article being shared by two questions. Subsequently, we increment either the number of articles or the number of questions per article. The findings indicate that the RadixAttention cache exhibits superior performance when the number of questions per article increases, as this creates more opportunities for sharing.
     </p>
    </div>
   </section>
   <section class="ltx_subsubsection" id="S6.SS4.SSS4">
    <h4 class="ltx_title ltx_title_subsubsection">
     <span class="ltx_tag ltx_tag_subsubsection">
      6.4.4
     </span>
     RadixAttention Overhead Analysis
    </h4>
    <div class="ltx_para" id="S6.SS4.SSS4.p1">
     <p class="ltx_p" id="S6.SS4.SSS4.p1.1">
      We analyze the overhead of maintaining the radix tree at runtime. The tree structure is maintained on the CPU. In a typical scenario, which has a shareable input length of 256, an unshareable input length of 256, and 128 requests (organized into 16 subtrees, with 8 branches for each subtree), the forward pass in our setup takes 17.6 seconds. Meanwhile, the tree operation only takes 0.07 seconds.
We also construct a request trace with no cache hits and observe the tree maintenance incurs only a 0.5% overhead.
Therefore, the overhead is negligible. Furthermore, the overhead of tree maintenance can be further reduced by using a high-performance C++ implementation and by overlapping CPU and GPU operations.
     </p>
    </div>
    <figure class="ltx_figure" id="S6.F12">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="216" id="S6.F12.g1" src="/html/2312.07104/assets/x12.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       <span class="ltx_text" id="S6.F12.2.1.1" style="font-size:90%;">
        Figure 12
       </span>
       :
      </span>
      <span class="ltx_text" id="S6.F12.3.2" style="font-size:90%;">
       Improvements under Different Sharing Settings
      </span>
     </figcaption>
    </figure>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S7">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    7
   </span>
   Discussion and Limitations
  </h2>
  <div class="ltx_para" id="S7.p1">
   <p class="ltx_p" id="S7.p1.1">
    Here are SGLang’s limitations and future development plans:
   </p>
   <ul class="ltx_itemize" id="S7.I1">
    <li class="ltx_item" id="S7.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S7.I1.i1.p1">
      <p class="ltx_p" id="S7.I1.i1.p1.1">
       Our interpreter runs arbitrary Python code, but the tracing and compiler lack support for data-dependent control flows. Introducing new control flow nodes to the SGLang IR, similar to TensorFlow’s dynamic flow
       <cite class="ltx_cite ltx_citemacro_cite">
        [
        <a class="ltx_ref" href="#bib.bib75" title="">
         75
        </a>
        ]
       </cite>
       , is required to address this.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S7.I1.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S7.I1.i2.p1">
      <p class="ltx_p" id="S7.I1.i2.p1.1">
       The current tokenization algorithm may create artifacts at prompt and generation boundaries. Implementing the token healing technique
       <cite class="ltx_cite ltx_citemacro_cite">
        [
        <a class="ltx_ref" href="#bib.bib16" title="">
         16
        </a>
        ]
       </cite>
       could resolve this.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S7.I1.i3" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S7.I1.i3.p1">
      <p class="ltx_p" id="S7.I1.i3.p1.1">
       We have not yet implemented grammar-constrained decoding. Efficient implementation would necessitate techniques from
       <cite class="ltx_cite ltx_citemacro_cite">
        [
        <a class="ltx_ref" href="#bib.bib65" title="">
         65
        </a>
        ,
        <a class="ltx_ref" href="#bib.bib22" title="">
         22
        </a>
        ]
       </cite>
       and careful batching.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S7.I1.i4" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S7.I1.i4.p1">
      <p class="ltx_p" id="S7.I1.i4.p1.1">
       Plans include integrating more input and output modalities, such as incorporating text-to-image models into SGLang and exploring audio and video capabilities.
      </p>
     </div>
    </li>
   </ul>
  </div>
 </section>
 <section class="ltx_section" id="S8">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    8
   </span>
   Related Work
  </h2>
  <section class="ltx_paragraph" id="S8.SS0.SSS0.Px1">
   <h5 class="ltx_title ltx_title_paragraph">
    Programming with Language Models
   </h5>
   <div class="ltx_para" id="S8.SS0.SSS0.Px1.p1">
    <p class="ltx_p" id="S8.SS0.SSS0.Px1.p1.1">
     The trend in programming LLM includes the development of better prompting techniques
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib64" title="">
       64
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib37" title="">
       37
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib70" title="">
       70
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib3" title="">
       3
      </a>
      ]
     </cite>
     , tools usage
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib49" title="">
       49
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib50" title="">
       50
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib44" title="">
       44
      </a>
      ]
     </cite>
     , agent frameworks
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib67" title="">
       67
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib54" title="">
       54
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib71" title="">
       71
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib53" title="">
       53
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib27" title="">
       27
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib41" title="">
       41
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib42" title="">
       42
      </a>
      ]
     </cite>
     , and programming systems
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib4" title="">
       4
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib16" title="">
       16
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib24" title="">
       24
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib21" title="">
       21
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib30" title="">
       30
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib65" title="">
       65
      </a>
      ]
     </cite>
     . Among these, Guidance and LMQL are the most similar to our work. We discuss the differences between SGLang and existing LLM programming systems in
     <a class="ltx_ref ltx_refmacro_autoref" href="#S2.SS4" title="2.4 Existing LLM Programming Systems ‣ 2 Background ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Section 2.4
      </span>
     </a>
     and evaluate their performance in
     <a class="ltx_ref ltx_refmacro_autoref" href="#S6" title="6 Evaluation ‣ Efficiently Programming Large Language Models using SGLang">
      <span class="ltx_text ltx_ref_tag">
       Section 6
      </span>
     </a>
     . In short, the co-design approach of SGLang significantly enhances execution efficiency.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S8.SS0.SSS0.Px2">
   <h5 class="ltx_title ltx_title_paragraph">
    Inference Optimizations for LLMs.
   </h5>
   <div class="ltx_para" id="S8.SS0.SSS0.Px2.p1">
    <p class="ltx_p" id="S8.SS0.SSS0.Px2.p1.1">
     Common inference optimizations for LLMs include batching
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib74" title="">
       74
      </a>
      ]
     </cite>
     , memory optimizations
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib52" title="">
       52
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib23" title="">
       23
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib2" title="">
       2
      </a>
      ]
     </cite>
     , GPU kernel optimizations
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib10" title="">
       10
      </a>
      ]
     </cite>
     , model parallelism
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib45" title="">
       45
      </a>
      ]
     </cite>
     , parameter sharing
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib51" title="">
       51
      </a>
      ]
     </cite>
     , speculative execution
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib56" title="">
       56
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib25" title="">
       25
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib34" title="">
       34
      </a>
      ]
     </cite>
     , scheduling
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib66" title="">
       66
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib17" title="">
       17
      </a>
      ]
     </cite>
     , caching
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib55" title="">
       55
      </a>
      ]
     </cite>
     ,
quantization
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib68" title="">
       68
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib28" title="">
       28
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib11" title="">
       11
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib14" title="">
       14
      </a>
      ]
     </cite>
     , and sparsification
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib13" title="">
       13
      </a>
      ]
     </cite>
     . These optimizations are complementary to our work and can be, or have already been, integrated into our backend.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S8.SS0.SSS0.Px3">
   <h5 class="ltx_title ltx_title_paragraph">
    Compilers for Machine Learning.
   </h5>
   <div class="ltx_para" id="S8.SS0.SSS0.Px3.p1">
    <p class="ltx_p" id="S8.SS0.SSS0.Px3.p1.1">
     Various domain-specific compilers for machine learning have been developed. These compilers are capable of optimizing a single tensor operator
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib7" title="">
       7
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib12" title="">
       12
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib77" title="">
       77
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib33" title="">
       33
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib57" title="">
       57
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib72" title="">
       72
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib62" title="">
       62
      </a>
      ]
     </cite>
     , a computational graph
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib20" title="">
       20
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib59" title="">
       59
      </a>
      ]
     </cite>
     , a distributed computation graph
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib78" title="">
       78
      </a>
      ,
      <a class="ltx_ref" href="#bib.bib32" title="">
       32
      </a>
      ]
     </cite>
     , and classical algorithms
     <cite class="ltx_cite ltx_citemacro_cite">
      [
      <a class="ltx_ref" href="#bib.bib36" title="">
       36
      </a>
      ]
     </cite>
     . Distinct from these more general-purpose or low-level compilers, SGLang is specifically designed for LLM applications and incorporates LLM-specific optimizations.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S9">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    9
   </span>
   Conclusion
  </h2>
  <div class="ltx_para" id="S9.p1">
   <p class="ltx_p" id="S9.p1.1">
    In this paper, we introduce SGLang, an efficient programming system for LLMs.
SGLang greatly accelerates common LLM workloads by up to
    <math alttext="5\times" class="ltx_math_unparsed" display="inline" id="S9.p1.1.m1.1">
     <semantics id="S9.p1.1.m1.1a">
      <mrow id="S9.p1.1.m1.1b">
       <mn id="S9.p1.1.m1.1.1">
        5
       </mn>
       <mo id="S9.p1.1.m1.1.2" lspace="0.222em">
        ×
       </mo>
      </mrow>
      <annotation encoding="application/x-tex" id="S9.p1.1.m1.1c">
       5\times
      </annotation>
     </semantics>
    </math>
    with reduced code complexity and improved control.
Through the co-design of the language and runtime, we aim to present a more integrated approach to optimizing LLM programming paradigms.
   </p>
  </div>
 </section>
 <section class="ltx_bibliography" id="bib">
  <h2 class="ltx_title ltx_title_bibliography">
   References
  </h2>
  <ul class="ltx_biblist">
   <li class="ltx_bibitem" id="bib.bib1">
    <span class="ltx_tag ltx_tag_bibitem">
     [1]
    </span>
    <span class="ltx_bibblock">
     Jean-Baptiste Alayrac, Jeff Donahue, Pauline Luc, Antoine Miech, Iain Barr, Yana Hasson, Karel Lenc, Arthur Mensch, Katherine Millican, Malcolm Reynolds, et al.
    </span>
    <span class="ltx_bibblock">
     Flamingo: a visual language model for few-shot learning.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib1.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 35:23716–23736, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib2">
    <span class="ltx_tag ltx_tag_bibitem">
     [2]
    </span>
    <span class="ltx_bibblock">
     Reza Yazdani Aminabadi, Samyam Rajbhandari, Ammar Ahmad Awan, Cheng Li, Du Li, Elton Zheng, Olatunji Ruwase, Shaden Smith, Minjia Zhang, Jeff Rasley, et al.
    </span>
    <span class="ltx_bibblock">
     Deepspeed-inference: enabling efficient inference of transformer models at unprecedented scale.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib2.1.1">
      SC22: International Conference for High Performance Computing, Networking, Storage and Analysis
     </span>
     , pages 1–15. IEEE, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib3">
    <span class="ltx_tag ltx_tag_bibitem">
     [3]
    </span>
    <span class="ltx_bibblock">
     Maciej Besta, Nils Blach, Ales Kubicek, Robert Gerstenberger, Lukas Gianinazzi, Joanna Gajda, Tomasz Lehmann, Michal Podstawski, Hubert Niewiadomski, Piotr Nyczyk, et al.
    </span>
    <span class="ltx_bibblock">
     Graph of thoughts: Solving elaborate problems with large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib3.1.1">
      arXiv preprint arXiv:2308.09687
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib4">
    <span class="ltx_tag ltx_tag_bibitem">
     [4]
    </span>
    <span class="ltx_bibblock">
     Luca Beurer-Kellner, Marc Fischer, and Martin Vechev.
    </span>
    <span class="ltx_bibblock">
     Prompting is programming: A query language for large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib4.1.1">
      Proceedings of the ACM on Programming Languages
     </span>
     , 7(PLDI):1946–1969, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib5">
    <span class="ltx_tag ltx_tag_bibitem">
     [5]
    </span>
    <span class="ltx_bibblock">
     Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al.
    </span>
    <span class="ltx_bibblock">
     Language models are few-shot learners.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib5.1.1">
      Advances in neural information processing systems
     </span>
     , 33:1877–1901, 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib6">
    <span class="ltx_tag ltx_tag_bibitem">
     [6]
    </span>
    <span class="ltx_bibblock">
     Sébastien Bubeck, Varun Chandrasekaran, Ronen Eldan, Johannes Gehrke, Eric Horvitz, Ece Kamar, Peter Lee, Yin Tat Lee, Yuanzhi Li, Scott Lundberg, et al.
    </span>
    <span class="ltx_bibblock">
     Sparks of artificial general intelligence: Early experiments with gpt-4.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib6.1.1">
      arXiv preprint arXiv:2303.12712
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib7">
    <span class="ltx_tag ltx_tag_bibitem">
     [7]
    </span>
    <span class="ltx_bibblock">
     Tianqi Chen, Thierry Moreau, Ziheng Jiang, Lianmin Zheng, Eddie Yan, Haichen Shen, Meghan Cowan, Leyuan Wang, Yuwei Hu, Luis Ceze, et al.
    </span>
    <span class="ltx_bibblock">
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib7.1.m1.1">
      <semantics id="bib.bib7.1.m1.1a">
       <mo id="bib.bib7.1.m1.1.1" stretchy="false" xref="bib.bib7.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib7.1.m1.1b">
        <ci id="bib.bib7.1.m1.1.1.cmml" xref="bib.bib7.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib7.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     TVM
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib7.2.m2.1">
      <semantics id="bib.bib7.2.m2.1a">
       <mo id="bib.bib7.2.m2.1.1" stretchy="false" xref="bib.bib7.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib7.2.m2.1b">
        <ci id="bib.bib7.2.m2.1.1.cmml" xref="bib.bib7.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib7.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     : An automated
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib7.3.m3.1">
      <semantics id="bib.bib7.3.m3.1a">
       <mo id="bib.bib7.3.m3.1.1" stretchy="false" xref="bib.bib7.3.m3.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib7.3.m3.1b">
        <ci id="bib.bib7.3.m3.1.1.cmml" xref="bib.bib7.3.m3.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib7.3.m3.1c">
        \{
       </annotation>
      </semantics>
     </math>
     End-to-End
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib7.4.m4.1">
      <semantics id="bib.bib7.4.m4.1a">
       <mo id="bib.bib7.4.m4.1.1" stretchy="false" xref="bib.bib7.4.m4.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib7.4.m4.1b">
        <ci id="bib.bib7.4.m4.1.1.cmml" xref="bib.bib7.4.m4.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib7.4.m4.1c">
        \}
       </annotation>
      </semantics>
     </math>
     optimizing compiler for deep learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib7.5.1">
      13th USENIX Symposium on Operating Systems Design and Implementation (OSDI 18)
     </span>
     , pages 578–594, 2018.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib8">
    <span class="ltx_tag ltx_tag_bibitem">
     [8]
    </span>
    <span class="ltx_bibblock">
     Aakanksha Chowdhery, Sharan Narang, Jacob Devlin, Maarten Bosma, Gaurav Mishra, Adam Roberts, Paul Barham, Hyung Won Chung, Charles Sutton, Sebastian Gehrmann, et al.
    </span>
    <span class="ltx_bibblock">
     Palm: Scaling language modeling with pathways.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib8.1.1">
      arXiv preprint arXiv:2204.02311
     </span>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib9">
    <span class="ltx_tag ltx_tag_bibitem">
     [9]
    </span>
    <span class="ltx_bibblock">
     Karl Cobbe, Vineet Kosaraju, Mohammad Bavarian, Mark Chen, Heewoo Jun, Lukasz Kaiser, Matthias Plappert, Jerry Tworek, Jacob Hilton, Reiichiro Nakano, et al.
    </span>
    <span class="ltx_bibblock">
     Training verifiers to solve math word problems.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib9.1.1">
      arXiv preprint arXiv:2110.14168
     </span>
     , 2021.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib10">
    <span class="ltx_tag ltx_tag_bibitem">
     [10]
    </span>
    <span class="ltx_bibblock">
     Tri Dao, Dan Fu, Stefano Ermon, Atri Rudra, and Christopher Ré.
    </span>
    <span class="ltx_bibblock">
     Flashattention: Fast and memory-efficient exact attention with io-awareness.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib10.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 35:16344–16359, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib11">
    <span class="ltx_tag ltx_tag_bibitem">
     [11]
    </span>
    <span class="ltx_bibblock">
     Tim Dettmers, Mike Lewis, Younes Belkada, and Luke Zettlemoyer.
    </span>
    <span class="ltx_bibblock">
     Gpt3. int8 (): 8-bit matrix multiplication for transformers at scale.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib11.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 35:30318–30332, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib12">
    <span class="ltx_tag ltx_tag_bibitem">
     [12]
    </span>
    <span class="ltx_bibblock">
     Siyuan Feng, Bohan Hou, Hongyi Jin, Wuwei Lin, Junru Shao, Ruihang Lai, Zihao Ye, Lianmin Zheng, Cody Hao Yu, Yong Yu, et al.
    </span>
    <span class="ltx_bibblock">
     Tensorir: An abstraction for automatic tensorized program optimization.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib12.1.1">
      Proceedings of the 28th ACM International Conference on Architectural Support for Programming Languages and Operating Systems, Volume 2
     </span>
     , pages 804–817, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib13">
    <span class="ltx_tag ltx_tag_bibitem">
     [13]
    </span>
    <span class="ltx_bibblock">
     Elias Frantar and Dan Alistarh.
    </span>
    <span class="ltx_bibblock">
     Sparsegpt: Massive language models can be accurately pruned in one-shot.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib13.1.1">
      International Conference on Machine Learning
     </span>
     , pages 10323–10337. PMLR, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib14">
    <span class="ltx_tag ltx_tag_bibitem">
     [14]
    </span>
    <span class="ltx_bibblock">
     Elias Frantar, Saleh Ashkboos, Torsten Hoefler, and Dan Alistarh.
    </span>
    <span class="ltx_bibblock">
     Optq: Accurate quantization for generative pre-trained transformers.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib14.1.1">
      The Eleventh International Conference on Learning Representations
     </span>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib15">
    <span class="ltx_tag ltx_tag_bibitem">
     [15]
    </span>
    <span class="ltx_bibblock">
     Georgi Gerganov.
    </span>
    <span class="ltx_bibblock">
     Llama.cpp.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/ggerganov/llama.cpp" target="_blank" title="">
      https://github.com/ggerganov/llama.cpp
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib16">
    <span class="ltx_tag ltx_tag_bibitem">
     [16]
    </span>
    <span class="ltx_bibblock">
     Guidance AI.
    </span>
    <span class="ltx_bibblock">
     A guidance language for controlling large language models.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/guidance-ai/guidance" target="_blank" title="">
      https://github.com/guidance-ai/guidance
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib17">
    <span class="ltx_tag ltx_tag_bibitem">
     [17]
    </span>
    <span class="ltx_bibblock">
     Mingcong Han, Hanze Zhang, Rong Chen, and Haibo Chen.
    </span>
    <span class="ltx_bibblock">
     Microsecond-scale preemption for concurrent
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib17.1.m1.1">
      <semantics id="bib.bib17.1.m1.1a">
       <mo id="bib.bib17.1.m1.1.1" stretchy="false" xref="bib.bib17.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib17.1.m1.1b">
        <ci id="bib.bib17.1.m1.1.1.cmml" xref="bib.bib17.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib17.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     GPU-accelerated
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib17.2.m2.1">
      <semantics id="bib.bib17.2.m2.1a">
       <mo id="bib.bib17.2.m2.1.1" stretchy="false" xref="bib.bib17.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib17.2.m2.1b">
        <ci id="bib.bib17.2.m2.1.1.cmml" xref="bib.bib17.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib17.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib17.3.m3.1">
      <semantics id="bib.bib17.3.m3.1a">
       <mo id="bib.bib17.3.m3.1.1" stretchy="false" xref="bib.bib17.3.m3.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib17.3.m3.1b">
        <ci id="bib.bib17.3.m3.1.1.cmml" xref="bib.bib17.3.m3.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib17.3.m3.1c">
        \{
       </annotation>
      </semantics>
     </math>
     DNN
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib17.4.m4.1">
      <semantics id="bib.bib17.4.m4.1a">
       <mo id="bib.bib17.4.m4.1.1" stretchy="false" xref="bib.bib17.4.m4.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib17.4.m4.1b">
        <ci id="bib.bib17.4.m4.1.1.cmml" xref="bib.bib17.4.m4.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib17.4.m4.1c">
        \}
       </annotation>
      </semantics>
     </math>
     inferences.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib17.5.1">
      16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)
     </span>
     , pages 539–558, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib18">
    <span class="ltx_tag ltx_tag_bibitem">
     [18]
    </span>
    <span class="ltx_bibblock">
     Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt.
    </span>
    <span class="ltx_bibblock">
     Measuring massive multitask language understanding.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib18.1.1">
      International Conference on Learning Representations
     </span>
     , 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib19">
    <span class="ltx_tag ltx_tag_bibitem">
     [19]
    </span>
    <span class="ltx_bibblock">
     Hugging Face.
    </span>
    <span class="ltx_bibblock">
     Text generation inference.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/huggingface/text-generation-inference" target="_blank" title="">
      https://github.com/huggingface/text-generation-inference
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib20">
    <span class="ltx_tag ltx_tag_bibitem">
     [20]
    </span>
    <span class="ltx_bibblock">
     Zhihao Jia, Oded Padon, James Thomas, Todd Warszawski, Matei Zaharia, and Alex Aiken.
    </span>
    <span class="ltx_bibblock">
     Taso: optimizing deep learning computation with automatic generation of graph substitutions.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib20.1.1">
      Proceedings of the 27th ACM Symposium on Operating Systems Principles
     </span>
     , pages 47–62, 2019.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib21">
    <span class="ltx_tag ltx_tag_bibitem">
     [21]
    </span>
    <span class="ltx_bibblock">
     Omar Khattab, Arnav Singhvi, Paridhi Maheshwari, Zhiyuan Zhang, Keshav Santhanam, Sri Vardhamanan, Saiful Haq, Ashutosh Sharma, Thomas T. Joshi, Hanna Moazam, Heather Miller, Matei Zaharia, and Christopher Potts.
    </span>
    <span class="ltx_bibblock">
     Dspy: Compiling declarative language model calls into self-improving pipelines.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib21.1.1">
      arXiv preprint arXiv:2310.03714
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib22">
    <span class="ltx_tag ltx_tag_bibitem">
     [22]
    </span>
    <span class="ltx_bibblock">
     Michael Kuchnik, Virginia Smith, and George Amvrosiadis.
    </span>
    <span class="ltx_bibblock">
     Validating large language models with relm.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib22.1.1">
      Proceedings of Machine Learning and Systems
     </span>
     , 5, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib23">
    <span class="ltx_tag ltx_tag_bibitem">
     [23]
    </span>
    <span class="ltx_bibblock">
     Woosuk Kwon, Zhuohan Li, Siyuan Zhuang, Ying Sheng, Lianmin Zheng, Cody Hao Yu, Joseph Gonzalez, Hao Zhang, and Ion Stoica.
    </span>
    <span class="ltx_bibblock">
     Efficient memory management for large language model serving with pagedattention.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib23.1.1">
      Proceedings of the 29th Symposium on Operating Systems Principles
     </span>
     , pages 611–626, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib24">
    <span class="ltx_tag ltx_tag_bibitem">
     [24]
    </span>
    <span class="ltx_bibblock">
     LangChain AI.
    </span>
    <span class="ltx_bibblock">
     Langchain.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/langchain-ai/langchain" target="_blank" title="">
      https://github.com/langchain-ai/langchain
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib25">
    <span class="ltx_tag ltx_tag_bibitem">
     [25]
    </span>
    <span class="ltx_bibblock">
     Yaniv Leviathan, Matan Kalman, and Yossi Matias.
    </span>
    <span class="ltx_bibblock">
     Fast inference from transformers via speculative decoding.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib25.1.1">
      International Conference on Machine Learning
     </span>
     , pages 19274–19286. PMLR, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib26">
    <span class="ltx_tag ltx_tag_bibitem">
     [26]
    </span>
    <span class="ltx_bibblock">
     Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, Mike Lewis, Wen-tau Yih, Tim Rocktäschel, et al.
    </span>
    <span class="ltx_bibblock">
     Retrieval-augmented generation for knowledge-intensive nlp tasks.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib26.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 33:9459–9474, 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib27">
    <span class="ltx_tag ltx_tag_bibitem">
     [27]
    </span>
    <span class="ltx_bibblock">
     Guohao Li, Hasan Abed Al Kader Hammoud, Hani Itani, Dmitrii Khizbullin, and Bernard Ghanem.
    </span>
    <span class="ltx_bibblock">
     Camel: Communicative agents for "mind" exploration of large language model society.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib27.1.1">
      Thirty-seventh Conference on Neural Information Processing Systems
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib28">
    <span class="ltx_tag ltx_tag_bibitem">
     [28]
    </span>
    <span class="ltx_bibblock">
     Ji Lin, Jiaming Tang, Haotian Tang, Shang Yang, Xingyu Dang, and Song Han.
    </span>
    <span class="ltx_bibblock">
     Awq: Activation-aware weight quantization for llm compression and acceleration.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib28.1.1">
      arXiv preprint arXiv:2306.00978
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib29">
    <span class="ltx_tag ltx_tag_bibitem">
     [29]
    </span>
    <span class="ltx_bibblock">
     Haotian Liu, Chunyuan Li, Yuheng Li, and Yong Jae Lee.
    </span>
    <span class="ltx_bibblock">
     Improved baselines with visual instruction tuning.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib29.1.1">
      arXiv preprint arXiv:2310.03744
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib30">
    <span class="ltx_tag ltx_tag_bibitem">
     [30]
    </span>
    <span class="ltx_bibblock">
     Jerry Liu.
    </span>
    <span class="ltx_bibblock">
     LlamaIndex, November 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib31">
    <span class="ltx_tag ltx_tag_bibitem">
     [31]
    </span>
    <span class="ltx_bibblock">
     Xiaoxia Liu, Jingyi Wang, Jun Sun, Xiaohan Yuan, Guoliang Dong, Peng Di, Wenhai Wang, and Dongxia Wang.
    </span>
    <span class="ltx_bibblock">
     Prompting frameworks for large language models: A survey.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib31.1.1">
      arXiv preprint arXiv:2311.12785
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib32">
    <span class="ltx_tag ltx_tag_bibitem">
     [32]
    </span>
    <span class="ltx_bibblock">
     Wenyan Lu, Guihai Yan, Jiajun Li, Shijun Gong, Yinhe Han, and Xiaowei Li.
    </span>
    <span class="ltx_bibblock">
     Flexflow: A flexible dataflow accelerator architecture for convolutional neural networks.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib32.1.1">
      2017 IEEE International Symposium on High Performance Computer Architecture (HPCA)
     </span>
     , pages 553–564. IEEE, 2017.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib33">
    <span class="ltx_tag ltx_tag_bibitem">
     [33]
    </span>
    <span class="ltx_bibblock">
     Lingxiao Ma, Zhiqiang Xie, Zhi Yang, Jilong Xue, Youshan Miao, Wei Cui, Wenxiang Hu, Fan Yang, Lintao Zhang, and Lidong Zhou.
    </span>
    <span class="ltx_bibblock">
     Rammer: Enabling holistic deep learning compiler optimizations with
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib33.1.m1.1">
      <semantics id="bib.bib33.1.m1.1a">
       <mo id="bib.bib33.1.m1.1.1" stretchy="false" xref="bib.bib33.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib33.1.m1.1b">
        <ci id="bib.bib33.1.m1.1.1.cmml" xref="bib.bib33.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib33.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     rTasks
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib33.2.m2.1">
      <semantics id="bib.bib33.2.m2.1a">
       <mo id="bib.bib33.2.m2.1.1" stretchy="false" xref="bib.bib33.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib33.2.m2.1b">
        <ci id="bib.bib33.2.m2.1.1.cmml" xref="bib.bib33.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib33.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     .
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib33.3.1">
      14th USENIX Symposium on Operating Systems Design and Implementation (OSDI 20)
     </span>
     , pages 881–897, 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib34">
    <span class="ltx_tag ltx_tag_bibitem">
     [34]
    </span>
    <span class="ltx_bibblock">
     Xupeng Miao, Gabriele Oliaro, Zhihao Zhang, Xinhao Cheng, Zeyu Wang, Rae Ying Yee Wong, Zhuoming Chen, Daiyaan Arfeen, Reyna Abhyankar, and Zhihao Jia.
    </span>
    <span class="ltx_bibblock">
     Specinfer: Accelerating generative llm serving with speculative inference and token tree verification.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib34.1.1">
      arXiv preprint arXiv:2305.09781
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib35">
    <span class="ltx_tag ltx_tag_bibitem">
     [35]
    </span>
    <span class="ltx_bibblock">
     Model TC.
    </span>
    <span class="ltx_bibblock">
     Lightllm.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/ModelTC/lightllm" target="_blank" title="">
      https://github.com/ModelTC/lightllm
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib36">
    <span class="ltx_tag ltx_tag_bibitem">
     [36]
    </span>
    <span class="ltx_bibblock">
     Supun Nakandala, Karla Saur, Gyeong-In Yu, Konstantinos Karanasos, Carlo Curino, Markus Weimer, and Matteo Interlandi.
    </span>
    <span class="ltx_bibblock">
     A tensor compiler for unified machine learning prediction serving.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib36.1.1">
      14th USENIX Symposium on Operating Systems Design and Implementation (OSDI 20)
     </span>
     , pages 899–917, 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib37">
    <span class="ltx_tag ltx_tag_bibitem">
     [37]
    </span>
    <span class="ltx_bibblock">
     Xuefei Ning, Zinan Lin, Zixuan Zhou, Huazhong Yang, and Yu Wang.
    </span>
    <span class="ltx_bibblock">
     Skeleton-of-thought: Large language models can do parallel decoding.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib37.1.1">
      arXiv preprint arXiv:2307.15337
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib38">
    <span class="ltx_tag ltx_tag_bibitem">
     [38]
    </span>
    <span class="ltx_bibblock">
     NVIDIA.
    </span>
    <span class="ltx_bibblock">
     Tensorrt-llm.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/NVIDIA/TensorRT-LLM" target="_blank" title="">
      https://github.com/NVIDIA/TensorRT-LLM
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib39">
    <span class="ltx_tag ltx_tag_bibitem">
     [39]
    </span>
    <span class="ltx_bibblock">
     OpenAI.
    </span>
    <span class="ltx_bibblock">
     Openai api reference.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://platform.openai.com/docs/api-reference" target="_blank" title="">
      https://platform.openai.com/docs/api-reference
     </a>
     .
    </span>
    <span class="ltx_bibblock">
     Accessed: 2023-11.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib40">
    <span class="ltx_tag ltx_tag_bibitem">
     [40]
    </span>
    <span class="ltx_bibblock">
     OpenAI.
    </span>
    <span class="ltx_bibblock">
     Gpt-4 technical report, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib41">
    <span class="ltx_tag ltx_tag_bibitem">
     [41]
    </span>
    <span class="ltx_bibblock">
     Charles Packer, Vivian Fang, Shishir G. Patil, Kevin Lin, Sarah Wooders, and Joseph E. Gonzalez.
    </span>
    <span class="ltx_bibblock">
     Memgpt: Towards llms as operating systems, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib42">
    <span class="ltx_tag ltx_tag_bibitem">
     [42]
    </span>
    <span class="ltx_bibblock">
     Joon Sung Park, Joseph C. O’Brien, Carrie J. Cai, Meredith Ringel Morris, Percy Liang, and Michael S. Bernstein.
    </span>
    <span class="ltx_bibblock">
     Generative agents: Interactive simulacra of human behavior.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib42.1.1">
      In the 36th Annual ACM Symposium on User Interface Software and Technology (UIST ’23)
     </span>
     , UIST ’23, New York, NY, USA, 2023. Association for Computing Machinery.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib43">
    <span class="ltx_tag ltx_tag_bibitem">
     [43]
    </span>
    <span class="ltx_bibblock">
     Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, et al.
    </span>
    <span class="ltx_bibblock">
     Pytorch: An imperative style, high-performance deep learning library.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib43.1.1">
      Advances in neural information processing systems
     </span>
     , 32, 2019.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib44">
    <span class="ltx_tag ltx_tag_bibitem">
     [44]
    </span>
    <span class="ltx_bibblock">
     Shishir G. Patil, Tianjun Zhang, Xin Wang, and Joseph E. Gonzalez.
    </span>
    <span class="ltx_bibblock">
     Gorilla: Large language model connected with massive apis.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib44.1.1">
      arXiv preprint arXiv:2305.15334
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib45">
    <span class="ltx_tag ltx_tag_bibitem">
     [45]
    </span>
    <span class="ltx_bibblock">
     Reiner Pope, Sholto Douglas, Aakanksha Chowdhery, Jacob Devlin, James Bradbury, Jonathan Heek, Kefan Xiao, Shivani Agrawal, and Jeff Dean.
    </span>
    <span class="ltx_bibblock">
     Efficiently scaling transformer inference.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib45.1.1">
      Proceedings of Machine Learning and Systems
     </span>
     , 5, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib46">
    <span class="ltx_tag ltx_tag_bibitem">
     [46]
    </span>
    <span class="ltx_bibblock">
     Nir Ratner, Yoav Levine, Yonatan Belinkov, Ori Ram, Inbal Magar, Omri Abend, Ehud Karpas, Amnon Shashua, Kevin Leyton-Brown, and Yoav Shoham.
    </span>
    <span class="ltx_bibblock">
     Parallel context windows for large language models.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib46.1.1">
      Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers)
     </span>
     , pages 6383–6402, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib47">
    <span class="ltx_tag ltx_tag_bibitem">
     [47]
    </span>
    <span class="ltx_bibblock">
     Baptiste Roziere, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat, Xiaoqing Ellen Tan, Yossi Adi, Jingyu Liu, Tal Remez, Jérémy Rapin, et al.
    </span>
    <span class="ltx_bibblock">
     Code llama: Open foundation models for code.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib47.1.1">
      arXiv preprint arXiv:2308.12950
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib48">
    <span class="ltx_tag ltx_tag_bibitem">
     [48]
    </span>
    <span class="ltx_bibblock">
     Swarnadeep Saha, Omer Levy, Asli Celikyilmaz, Mohit Bansal, Jason Weston, and Xian Li.
    </span>
    <span class="ltx_bibblock">
     Branch-solve-merge improves large language model evaluation and generation.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib48.1.1">
      arXiv preprint arXiv:2310.15123
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib49">
    <span class="ltx_tag ltx_tag_bibitem">
     [49]
    </span>
    <span class="ltx_bibblock">
     Timo Schick, Jane Dwivedi-Yu, Roberto Dessì, Roberta Raileanu, Maria Lomeli, Luke Zettlemoyer, Nicola Cancedda, and Thomas Scialom.
    </span>
    <span class="ltx_bibblock">
     Toolformer: Language models can teach themselves to use tools.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib49.1.1">
      arXiv preprint arXiv:2302.04761
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib50">
    <span class="ltx_tag ltx_tag_bibitem">
     [50]
    </span>
    <span class="ltx_bibblock">
     Yongliang Shen, Kaitao Song, Xu Tan, Dongsheng Li, Weiming Lu, and Yueting Zhuang.
    </span>
    <span class="ltx_bibblock">
     Hugginggpt: Solving ai tasks with chatgpt and its friends in huggingface.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib50.1.1">
      arXiv preprint arXiv:2303.17580
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib51">
    <span class="ltx_tag ltx_tag_bibitem">
     [51]
    </span>
    <span class="ltx_bibblock">
     Ying Sheng, Shiyi Cao, Dacheng Li, Coleman Hooper, Nicholas Lee, Shuo Yang, Christopher Chou, Banghua Zhu, Lianmin Zheng, Kurt Keutzer, et al.
    </span>
    <span class="ltx_bibblock">
     S-lora: Serving thousands of concurrent lora adapters.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib51.1.1">
      arXiv preprint arXiv:2311.03285
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib52">
    <span class="ltx_tag ltx_tag_bibitem">
     [52]
    </span>
    <span class="ltx_bibblock">
     Ying Sheng, Lianmin Zheng, Binhang Yuan, Zhuohan Li, Max Ryabinin, Beidi Chen, Percy Liang, Christopher Ré, Ion Stoica, and Ce Zhang.
    </span>
    <span class="ltx_bibblock">
     Flexgen: high-throughput generative inference of large language models with a single gpu.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib52.1.1">
      International Conference on Machine Learning
     </span>
     , pages 31094–31116. PMLR, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib53">
    <span class="ltx_tag ltx_tag_bibitem">
     [53]
    </span>
    <span class="ltx_bibblock">
     Noah Shinn, Federico Cassano, Ashwin Gopinath, Karthik R Narasimhan, and Shunyu Yao.
    </span>
    <span class="ltx_bibblock">
     Reflexion: Language agents with verbal reinforcement learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib53.1.1">
      Thirty-seventh Conference on Neural Information Processing Systems
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib54">
    <span class="ltx_tag ltx_tag_bibitem">
     [54]
    </span>
    <span class="ltx_bibblock">
     Significant Gravitas.
    </span>
    <span class="ltx_bibblock">
     AutoGPT.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib55">
    <span class="ltx_tag ltx_tag_bibitem">
     [55]
    </span>
    <span class="ltx_bibblock">
     Xiaoniu Song, Yiwen Zhang, Rong Chen, and Haibo Chen.
    </span>
    <span class="ltx_bibblock">
     Ugache: A unified gpu cache for embedding-based deep learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib55.1.1">
      Proceedings of the 29th Symposium on Operating Systems Principles
     </span>
     , pages 627–641, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib56">
    <span class="ltx_tag ltx_tag_bibitem">
     [56]
    </span>
    <span class="ltx_bibblock">
     Mitchell Stern, Noam Shazeer, and Jakob Uszkoreit.
    </span>
    <span class="ltx_bibblock">
     Blockwise parallel decoding for deep autoregressive models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib56.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 31, 2018.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib57">
    <span class="ltx_tag ltx_tag_bibitem">
     [57]
    </span>
    <span class="ltx_bibblock">
     Philippe Tillet, Hsiang-Tsung Kung, and David Cox.
    </span>
    <span class="ltx_bibblock">
     Triton: an intermediate language and compiler for tiled neural network computations.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib57.1.1">
      Proceedings of the 3rd ACM SIGPLAN International Workshop on Machine Learning and Programming Languages
     </span>
     , pages 10–19, 2019.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib58">
    <span class="ltx_tag ltx_tag_bibitem">
     [58]
    </span>
    <span class="ltx_bibblock">
     Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al.
    </span>
    <span class="ltx_bibblock">
     Llama 2: Open foundation and fine-tuned chat models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib58.1.1">
      arXiv preprint arXiv:2307.09288
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib59">
    <span class="ltx_tag ltx_tag_bibitem">
     [59]
    </span>
    <span class="ltx_bibblock">
     Colin Unger, Zhihao Jia, Wei Wu, Sina Lin, Mandeep Baines, Carlos Efrain Quintero Narvaez, Vinay Ramakrishnaiah, Nirmal Prajapati, Pat McCormick, Jamaludin Mohd-Yusof, et al.
    </span>
    <span class="ltx_bibblock">
     Unity: Accelerating
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib59.1.m1.1">
      <semantics id="bib.bib59.1.m1.1a">
       <mo id="bib.bib59.1.m1.1.1" stretchy="false" xref="bib.bib59.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib59.1.m1.1b">
        <ci id="bib.bib59.1.m1.1.1.cmml" xref="bib.bib59.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib59.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     DNN
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib59.2.m2.1">
      <semantics id="bib.bib59.2.m2.1a">
       <mo id="bib.bib59.2.m2.1.1" stretchy="false" xref="bib.bib59.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib59.2.m2.1b">
        <ci id="bib.bib59.2.m2.1.1.cmml" xref="bib.bib59.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib59.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     training through joint optimization of algebraic transformations and parallelization.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib59.3.1">
      16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)
     </span>
     , pages 267–284, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib60">
    <span class="ltx_tag ltx_tag_bibitem">
     [60]
    </span>
    <span class="ltx_bibblock">
     Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin.
    </span>
    <span class="ltx_bibblock">
     Attention is all you need.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib60.1.1">
      Advances in neural information processing systems
     </span>
     , 30, 2017.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib61">
    <span class="ltx_tag ltx_tag_bibitem">
     [61]
    </span>
    <span class="ltx_bibblock">
     Guanzhi Wang, Yuqi Xie, Yunfan Jiang, Ajay Mandlekar, Chaowei Xiao, Yuke Zhu, Linxi Fan, and Anima Anandkumar.
    </span>
    <span class="ltx_bibblock">
     Voyager: An open-ended embodied agent with large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib61.1.1">
      arXiv preprint arXiv: Arxiv-2305.16291
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib62">
    <span class="ltx_tag ltx_tag_bibitem">
     [62]
    </span>
    <span class="ltx_bibblock">
     Haojie Wang, Jidong Zhai, Mingyu Gao, Zixuan Ma, Shizhi Tang, Liyan Zheng, Yuanzhi Li, Kaiyuan Rong, Yuanyong Chen, and Zhihao Jia.
    </span>
    <span class="ltx_bibblock">
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib62.1.m1.1">
      <semantics id="bib.bib62.1.m1.1a">
       <mo id="bib.bib62.1.m1.1.1" stretchy="false" xref="bib.bib62.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib62.1.m1.1b">
        <ci id="bib.bib62.1.m1.1.1.cmml" xref="bib.bib62.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib62.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     PET
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib62.2.m2.1">
      <semantics id="bib.bib62.2.m2.1a">
       <mo id="bib.bib62.2.m2.1.1" stretchy="false" xref="bib.bib62.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib62.2.m2.1b">
        <ci id="bib.bib62.2.m2.1.1.cmml" xref="bib.bib62.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib62.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     : Optimizing tensor programs with partially equivalent transformations and automated corrections.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib62.3.1">
      15th USENIX Symposium on Operating Systems Design and Implementation (OSDI 21)
     </span>
     , pages 37–54, 2021.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib63">
    <span class="ltx_tag ltx_tag_bibitem">
     [63]
    </span>
    <span class="ltx_bibblock">
     Xuezhi Wang, Jason Wei, Dale Schuurmans, Quoc V Le, Ed H Chi, Sharan Narang, Aakanksha Chowdhery, and Denny Zhou.
    </span>
    <span class="ltx_bibblock">
     Self-consistency improves chain of thought reasoning in language models.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib63.1.1">
      The Eleventh International Conference on Learning Representations
     </span>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib64">
    <span class="ltx_tag ltx_tag_bibitem">
     [64]
    </span>
    <span class="ltx_bibblock">
     Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Fei Xia, Ed Chi, Quoc V Le, Denny Zhou, et al.
    </span>
    <span class="ltx_bibblock">
     Chain-of-thought prompting elicits reasoning in large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib64.1.1">
      Advances in Neural Information Processing Systems
     </span>
     , 35:24824–24837, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib65">
    <span class="ltx_tag ltx_tag_bibitem">
     [65]
    </span>
    <span class="ltx_bibblock">
     Brandon T Willard and Rémi Louf.
    </span>
    <span class="ltx_bibblock">
     Efficient guided generation for large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib65.1.1">
      arXiv e-prints
     </span>
     , pages arXiv–2307, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib66">
    <span class="ltx_tag ltx_tag_bibitem">
     [66]
    </span>
    <span class="ltx_bibblock">
     Bingyang Wu, Yinmin Zhong, Zili Zhang, Gang Huang, Xuanzhe Liu, and Xin Jin.
    </span>
    <span class="ltx_bibblock">
     Fast distributed inference serving for large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib66.1.1">
      arXiv preprint arXiv:2305.05920
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib67">
    <span class="ltx_tag ltx_tag_bibitem">
     [67]
    </span>
    <span class="ltx_bibblock">
     Qingyun Wu, Gagan Bansal, Jieyu Zhang, Yiran Wu, Beibin Li, Erkang Zhu, Li Jiang, Xiaoyun Zhang, Shaokun Zhang, Jiale Liu, Ahmed Hassan Awadallah, Ryen W White, Doug Burger, and Chi Wang.
    </span>
    <span class="ltx_bibblock">
     Autogen: Enabling next-gen llm applications via multi-agent conversation framework.
    </span>
    <span class="ltx_bibblock">
     2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib68">
    <span class="ltx_tag ltx_tag_bibitem">
     [68]
    </span>
    <span class="ltx_bibblock">
     Guangxuan Xiao, Ji Lin, Mickael Seznec, Hao Wu, Julien Demouth, and Song Han.
    </span>
    <span class="ltx_bibblock">
     Smoothquant: Accurate and efficient post-training quantization for large language models.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib68.1.1">
      International Conference on Machine Learning
     </span>
     , pages 38087–38099. PMLR, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib69">
    <span class="ltx_tag ltx_tag_bibitem">
     [69]
    </span>
    <span class="ltx_bibblock">
     Zhilin Yang, Peng Qi, Saizheng Zhang, Yoshua Bengio, William W. Cohen, Ruslan Salakhutdinov, and Christopher D. Manning.
    </span>
    <span class="ltx_bibblock">
     HotpotQA: A dataset for diverse, explainable multi-hop question answering.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib69.1.1">
      Conference on Empirical Methods in Natural Language Processing (EMNLP)
     </span>
     , 2018.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib70">
    <span class="ltx_tag ltx_tag_bibitem">
     [70]
    </span>
    <span class="ltx_bibblock">
     Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Thomas L Griffiths, Yuan Cao, and Karthik Narasimhan.
    </span>
    <span class="ltx_bibblock">
     Tree of thoughts: Deliberate problem solving with large language models.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib70.1.1">
      arXiv preprint arXiv:2305.10601
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib71">
    <span class="ltx_tag ltx_tag_bibitem">
     [71]
    </span>
    <span class="ltx_bibblock">
     Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik R Narasimhan, and Yuan Cao.
    </span>
    <span class="ltx_bibblock">
     React: Synergizing reasoning and acting in language models.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib71.1.1">
      The Eleventh International Conference on Learning Representations
     </span>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib72">
    <span class="ltx_tag ltx_tag_bibitem">
     [72]
    </span>
    <span class="ltx_bibblock">
     Zihao Ye, Ruihang Lai, Junru Shao, Tianqi Chen, and Luis Ceze.
    </span>
    <span class="ltx_bibblock">
     Sparsetir: Composable abstractions for sparse compilation in deep learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib72.1.1">
      Proceedings of the 28th ACM International Conference on Architectural Support for Programming Languages and Operating Systems, Volume 3
     </span>
     , pages 660–678, 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib73">
    <span class="ltx_tag ltx_tag_bibitem">
     [73]
    </span>
    <span class="ltx_bibblock">
     Ori Yoran, Tomer Wolfson, Ben Bogin, Uri Katz, Daniel Deutch, and Jonathan Berant.
    </span>
    <span class="ltx_bibblock">
     Answering questions by meta-reasoning over multiple chains of thought.
    </span>
    <span class="ltx_bibblock">
     <span class="ltx_text ltx_font_italic" id="bib.bib73.1.1">
      arXiv preprint arXiv:2304.13007
     </span>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib74">
    <span class="ltx_tag ltx_tag_bibitem">
     [74]
    </span>
    <span class="ltx_bibblock">
     Gyeong-In Yu, Joo Seong Jeong, Geon-Woo Kim, Soojeong Kim, and Byung-Gon Chun.
    </span>
    <span class="ltx_bibblock">
     Orca: A distributed serving system for
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib74.1.m1.1">
      <semantics id="bib.bib74.1.m1.1a">
       <mo id="bib.bib74.1.m1.1.1" stretchy="false" xref="bib.bib74.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib74.1.m1.1b">
        <ci id="bib.bib74.1.m1.1.1.cmml" xref="bib.bib74.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib74.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     Transformer-Based
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib74.2.m2.1">
      <semantics id="bib.bib74.2.m2.1a">
       <mo id="bib.bib74.2.m2.1.1" stretchy="false" xref="bib.bib74.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib74.2.m2.1b">
        <ci id="bib.bib74.2.m2.1.1.cmml" xref="bib.bib74.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib74.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     generative models.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib74.3.1">
      16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)
     </span>
     , pages 521–538, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib75">
    <span class="ltx_tag ltx_tag_bibitem">
     [75]
    </span>
    <span class="ltx_bibblock">
     Yuan Yu, Martín Abadi, Paul Barham, Eugene Brevdo, Mike Burrows, Andy Davis, Jeff Dean, Sanjay Ghemawat, Tim Harley, Peter Hawkins, et al.
    </span>
    <span class="ltx_bibblock">
     Dynamic control flow in large-scale machine learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib75.1.1">
      Proceedings of the Thirteenth EuroSys Conference
     </span>
     , pages 1–15, 2018.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib76">
    <span class="ltx_tag ltx_tag_bibitem">
     [76]
    </span>
    <span class="ltx_bibblock">
     Rowan Zellers, Ari Holtzman, Yonatan Bisk, Ali Farhadi, and Yejin Choi.
    </span>
    <span class="ltx_bibblock">
     Hellaswag: Can a machine really finish your sentence?
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib76.1.1">
      Proceedings of the 57th Annual Meeting of the Association for Computational Linguistics
     </span>
     , pages 4791–4800, 2019.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib77">
    <span class="ltx_tag ltx_tag_bibitem">
     [77]
    </span>
    <span class="ltx_bibblock">
     Lianmin Zheng, Chengfan Jia, Minmin Sun, Zhao Wu, Cody Hao Yu, Ameer Haj-Ali, Yida Wang, Jun Yang, Danyang Zhuo, Koushik Sen, et al.
    </span>
    <span class="ltx_bibblock">
     Ansor: Generating
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib77.1.m1.1">
      <semantics id="bib.bib77.1.m1.1a">
       <mo id="bib.bib77.1.m1.1.1" stretchy="false" xref="bib.bib77.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib77.1.m1.1b">
        <ci id="bib.bib77.1.m1.1.1.cmml" xref="bib.bib77.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib77.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     High-Performance
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib77.2.m2.1">
      <semantics id="bib.bib77.2.m2.1a">
       <mo id="bib.bib77.2.m2.1.1" stretchy="false" xref="bib.bib77.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib77.2.m2.1b">
        <ci id="bib.bib77.2.m2.1.1.cmml" xref="bib.bib77.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib77.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     tensor programs for deep learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib77.3.1">
      14th USENIX symposium on operating systems design and implementation (OSDI 20)
     </span>
     , pages 863–879, 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib78">
    <span class="ltx_tag ltx_tag_bibitem">
     [78]
    </span>
    <span class="ltx_bibblock">
     Lianmin Zheng, Zhuohan Li, Hao Zhang, Yonghao Zhuang, Zhifeng Chen, Yanping Huang, Yida Wang, Yuanzhong Xu, Danyang Zhuo, Eric P Xing, et al.
    </span>
    <span class="ltx_bibblock">
     Alpa: Automating inter-and
     <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib78.1.m1.1">
      <semantics id="bib.bib78.1.m1.1a">
       <mo id="bib.bib78.1.m1.1.1" stretchy="false" xref="bib.bib78.1.m1.1.1.cmml">
        {
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib78.1.m1.1b">
        <ci id="bib.bib78.1.m1.1.1.cmml" xref="bib.bib78.1.m1.1.1">
         {
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib78.1.m1.1c">
        \{
       </annotation>
      </semantics>
     </math>
     Intra-Operator
     <math alttext="\}" class="ltx_Math" display="inline" id="bib.bib78.2.m2.1">
      <semantics id="bib.bib78.2.m2.1a">
       <mo id="bib.bib78.2.m2.1.1" stretchy="false" xref="bib.bib78.2.m2.1.1.cmml">
        }
       </mo>
       <annotation-xml encoding="MathML-Content" id="bib.bib78.2.m2.1b">
        <ci id="bib.bib78.2.m2.1.1.cmml" xref="bib.bib78.2.m2.1.1">
         }
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="bib.bib78.2.m2.1c">
        \}
       </annotation>
      </semantics>
     </math>
     parallelism for distributed deep learning.
    </span>
    <span class="ltx_bibblock">
     In
     <span class="ltx_text ltx_font_italic" id="bib.bib78.3.1">
      16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)
     </span>
     , pages 559–578, 2022.
    </span>
   </li>
  </ul>
 </section>
 <div class="ltx_pagination ltx_role_newpage">
 </div>
</article>
