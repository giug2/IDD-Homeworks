<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Shadow Removal Refinement via Material-Consistent Shadow Edges</title>
<!--Generated on Tue Sep 10 20:09:49 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2409.06848v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S2" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Works</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Method</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.SS1" title="In 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Material-Consistent Shadow Edge Extraction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.SS2" title="In 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Test-time Adaptation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>New Benchmark Testset and Evaluation Metric</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS1" title="In 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Comparison with SOTA Models</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS2" title="In 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Usefulness of CDD</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS3" title="In 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Ablation Studies</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS4" title="In 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4 </span>Cross dataset testing</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS5" title="In 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.5 </span>Limitations</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Details of Material-Consistent Shadow Edge Extraction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S2a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Correctness of the Proposed CDD Metric</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Further Details of Implementation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.SS1" title="In 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Computation Overhead</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.SS2" title="In 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Number and size of sampled patches</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.SS3" title="In 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Test settings</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.SS4" title="In 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>MC-Edge Annotations for the ISTD+</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Quantitative results on ISTD+ test set</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6a" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>More Results on The Cross-Dataset Testing</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6.SS1" title="In 6 More Results on The Cross-Dataset Testing ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1 </span>Effect of <math alttext="L_{nonshadow}" class="ltx_Math" display="inline"><semantics><msub><mi>L</mi><mrow><mi>n</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>n</mi><mo>⁢</mo><mi>s</mi><mo>⁢</mo><mi>h</mi><mo>⁢</mo><mi>a</mi><mo>⁢</mo><mi>d</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>w</mi></mrow></msub><annotation-xml encoding="MathML-Content"><apply><csymbol cd="ambiguous">subscript</csymbol><ci>𝐿</ci><apply><times></times><ci>𝑛</ci><ci>𝑜</ci><ci>𝑛</ci><ci>𝑠</ci><ci>ℎ</ci><ci>𝑎</ci><ci>𝑑</ci><ci>𝑜</ci><ci>𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6.SS2" title="In 6 More Results on The Cross-Dataset Testing ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2 </span>Qualitative results on SRD pre-trained model</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7" title="In Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>More Qualitative Results</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Shadow Removal Refinement via Material-Consistent Shadow Edges</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Shilin Hu<sup class="ltx_sup" id="id1.1.id1">1</sup>, Hieu Le<sup class="ltx_sup" id="id2.2.id2">2</sup>, ShahRukh Athar<sup class="ltx_sup" id="id3.3.id3">1</sup>, Sagnik Das<sup class="ltx_sup" id="id4.4.id4">3</sup>, Dimitris Samaras<sup class="ltx_sup" id="id5.5.id5">1</sup>
<br class="ltx_break"/><sup class="ltx_sup" id="id6.6.id6">1</sup>Stony Brook University     <sup class="ltx_sup" id="id7.7.id7">2</sup>EPFL     <sup class="ltx_sup" id="id8.8.id8">3</sup>Amazon 
<br class="ltx_break"/>
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id9.id1">Shadow boundaries can be confused with material boundaries as both exhibit sharp changes in luminance or contrast within a scene. However, shadows do not modify the intrinsic color or texture of surfaces.
Therefore, on both sides of shadow edges traversing regions with the same material, the original color and textures should be the same if the shadow is removed properly.
These shadow/shadow-free pairs are very useful but hard-to-collect supervision signals.
The crucial contribution of this paper is to learn how to identify those shadow edges that traverse material-consistent regions and how to use them as self-supervision for shadow removal refinement during test time. To achieve this, we fine-tune SAM, an image segmentation foundation model, to produce a shadow-invariant segmentation and then extract material-consistent shadow edges by comparing the SAM segmentation with the shadow mask.
Utilizing these shadow edges, we introduce color and texture-consistency losses to enhance the shadow removal process. We demonstrate the effectiveness of our method in improving shadow removal results on more challenging, in-the-wild images, outperforming the state-of-the-art shadow removal methods. Additionally, we propose a new metric and an annotated dataset for evaluating the performance of shadow removal methods without the need for paired shadow/shadow-free data.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<figure class="ltx_figure" id="S1.F1">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="181" id="S1.F1.g1" src="extracted/5846543/pics_jpg/teaser1.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S1.F1.2"><span class="ltx_text ltx_inline-block" id="S1.F1.2.1" style="font-size:90%;width:82.4pt;">(a) Input</span>
<span class="ltx_text ltx_inline-block" id="S1.F1.2.2" style="font-size:90%;width:82.4pt;">(b) SID <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S1.F1.2.3" style="font-size:90%;width:82.4pt;">(c) SID+Ours</span>
<span class="ltx_text ltx_inline-block" id="S1.F1.2.4" style="font-size:90%;width:82.4pt;">(d) ShadowFormer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S1.F1.2.5" style="font-size:90%;width:82.4pt;">(e) ShadowFormer+Ours</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S1.F1.5.1.1" style="font-size:90%;">Figure 1</span>: </span><span class="ltx_text" id="S1.F1.6.2" style="font-size:90%;">Examples from our proposed SBU-S (<span class="ltx_text ltx_font_italic" id="S1.F1.6.2.1">top</span>) and CUHK-S (<span class="ltx_text ltx_font_italic" id="S1.F1.6.2.2">bottom</span>) testing sets. We show the shadow removal results of two existing state-of-the-art methods, SID<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> and ShadowFormer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> in columns (b) and (d) respectively for two challenging cases. The results of both methods are significantly improved when used jointly with our refinement method - as in columns (c) and (e). Our proposed Color Distribution Difference (CDD) metric for each image is shown in red, which can measure shadow removal performance without the need for shadow-free images.</span></figcaption>
</figure>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Shadow edges were extensively studied in early shadow removal work<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib27" title="">27</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib11" title="">11</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib42" title="">42</a>]</cite>. These edges delineate the boundary between shadow and non-shadow areas, providing a clear indication of the transition in the pixel color and intensity that characterizes the shadow, providing useful supervision signals for shadow removal <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib39" title="">39</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib21" title="">21</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib24" title="">24</a>]</cite>.
However, shadow edges can also coincide with object boundaries. In these cases, the color and texture differences between the two sides of the shadow edges result from both the shadow effect and the different materials, which are hard to disentangle. Therefore, identifying shadow edges that cross areas of consistent material is beneficial for shadow removal. However, this is challenging since object boundaries can be confused with shadow boundaries as both exhibit sharp changes in luminance or contrast within a scene. In this work, we propose a novel method to identify those material-consistent shadow edges and use them as supervision signals for shadow removal.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">To identify material-consistent shadow edges, we propose to fine-tune SAM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite>, an image segmentation foundation model, to produce a shadow-invariant segmentation. The main idea is to force SAM to output the same segmentation mask, with or without shadows, thereby guiding the model to be less responsive to the shadow presence.
We then compare the output shadow-invariant segmentation with the shadow mask to obtain material-consistent shadow edges. These are shadow edges that do not coincide with any material edges from SAM.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">These material-consistent shadow edges can be extracted for any image. We show that at test time, we can extract these edges and use them as supervision to refine shadow-removal results. To do so, we sample pixels and patches alongside the shadow edges to form shadow/shadow-free pairs. We then introduce two losses: a RGB distance loss and a RGB distribution loss. The RGB distance loss calculates the minimum distance between each sampled shadow and non-shadow pixel along the selected edges to recover the correct color of the shadow region. The RGB distribution loss computes the Earth Mover’s Distance (EMD) between the color distributions of the sampled pixels to ensure texture consistency alongside the shadow edges. We further use the Learned Perceptual Image Patch Similarity (LPIPS) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib46" title="">46</a>]</cite> loss on sampled patches within the same material to constrain the texture consistency between the non-edge shadow/non-shadow region.
By imposing these constraints, we refine the pre-trained model in a <span class="ltx_text ltx_font_italic" id="S1.p3.1.1">self-supervised</span> manner, enabling adaptation to more complex shadow images (see <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1.F1" title="In 1 Introduction ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">1</span></a>).</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Further, we propose a novel evaluation metric based on material-consistent shadow edges, namely Color Distribution Difference (CDD). In essence, we can evaluate shadow removal performance by measuring the disparity in pixel color distribution on both sides of the material-consistent shadow edges. These edges can be easily annotated, even in cases where shadow-free images are hard to obtain. A lower CDD value corresponds to a more effective shadow removal performance, signifying a closer alignment between the textures on either side of the shadow edge, as shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1.F1" title="In 1 Introduction ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">1</span></a>. This new evaluation scheme enables bench-marking shadow-removal methods on challenging, in-the-wild shadow images. We curate a test set sourced from existing shadow detection datasets, namely SBU <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib35" title="">35</a>]</cite> and CUHK <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib18" title="">18</a>]</cite>.
These datasets contain images under complex shadow scenarios, providing a more comprehensive representation of shadow images in general.
We annotate pixels on both sides of the shadow edge that belong to the same background material for each image within the proposed dataset.
This benchmark test set (to be released upon publication) will serve as a valuable resource for evaluating the generalizability of shadow removal methods on complex shadow images.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">To summarize, our contributions are as follows:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We introduce an efficient shadow edge extraction module designed to identify shadow edges that traverse the same material. We achieve this by fine-tuning SAM to generate shadow-invariant segmentation and then comparing this segmentation with the shadow mask to perform the extraction.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">We propose a test-time adaptation method that refines the shadow removal result, which relies on the extracted self-supervision signal to enforce the material consistency between shadow and non-shadow regions.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">We curate a dataset featuring shadow images in general scenes, serving as a benchmark for assessing shadow removal methods in complex scenarios. We propose a novel evaluation metric, Color Distribution Difference (CDD) to assess the shadow removal performance, even when shadow-free ground truth is not available.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i4.p1">
<p class="ltx_p" id="S1.I1.i4.p1.1">Experimental results demonstrate that our method can be seamlessly integrated with existing models, significantly enhancing performance on complex shadow images. Specifically, when combined with two state-of-the-art shadow removal approaches, SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> and ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>, our method outperforms by at least 30% on CDD measurement on our proposed dataset. Code will be released upon acceptance.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Works</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">Early-stage shadow removal research <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib8" title="">8</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib10" title="">10</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib7" title="">7</a>]</cite> is motivated by physical modeling of illumination and color, typically in a light source-occluder system <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib1" title="">1</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib19" title="">19</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib32" title="">32</a>]</cite>.
The aim was to find useful self-supervision signals to fit the model and then remove the shadows.
Guo <em class="ltx_emph ltx_font_italic" id="S2.p1.1.1">et al</em>.<span class="ltx_text" id="S2.p1.1.2"></span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib16" title="">16</a>]</cite> proposed identifying pairs of regions under different illuminations within the same material.
Several methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib31" title="">31</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib38" title="">38</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib39" title="">39</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib21" title="">21</a>]</cite> looked for cues at shadow edges, which typically involve designing hand-crafted features that capture the illumination and color changes.
However, these methods are built under ideal assumptions from the physical modeling, which does not fit real-world settings due to the complexity and variability of shadow appearances.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">State-of-the-art shadow removal methods include deep networks trained end-to-end on pairs of shadow/shadow-free images <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib37" title="">37</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib5" title="">5</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib12" title="">12</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib3" title="">3</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib47" title="">47</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib26" title="">26</a>]</cite>, taking advantage of the powerful ability in learning mappings from the training pairs.
Iterative refinement is also adopted for shadow removal, <em class="ltx_emph ltx_font_italic" id="S2.p2.1.1">e.g</em>.<span class="ltx_text" id="S2.p2.1.2"></span> ARGAN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib6" title="">6</a>]</cite>, which removed shadows progressively using a multi-step generator, each step refining the output by removing remaining shadows.
Recently, <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib20" title="">20</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib29" title="">29</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib28" title="">28</a>]</cite> have utilized diffusion models for shadow removal via iterative denoising.
A method similar to us is the work of Guo <em class="ltx_emph ltx_font_italic" id="S2.p2.1.3">et al</em>.<span class="ltx_text" id="S2.p2.1.4"></span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib15" title="">15</a>]</cite> that also explored boundary cues for shadow removal. They found that their illumination model does not sufficiently model the boundary region, which necessitate extra supervision during training.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">A few methods try to mitigate the dependence on paired data.
Hu <em class="ltx_emph ltx_font_italic" id="S2.p3.1.1">et al</em>.<span class="ltx_text" id="S2.p3.1.2"></span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib17" title="">17</a>]</cite> proposed Mask-ShadowGAN, which leverages unpaired data to learn the adaptation from the shadow-free domain to the shadow domain and vice versa.
Le and Samaras <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib24" title="">24</a>]</cite> introduced cropping unpaired patches from the same shadow image without the requirement of a shadow-free image.
However, these un-/semi-supervised methods do not surpass their fully-supervised counterparts.</p>
</div>
<div class="ltx_para" id="S2.p4">
<p class="ltx_p" id="S2.p4.1">Our method is among the first to employ test-time adaptation (TTA) for shadow removal. In general, TTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib34" title="">34</a>]</cite> aims to enhance a pre-trained model’s performance on specific test data. Xiao <em class="ltx_emph ltx_font_italic" id="S2.p4.1.1">et al</em>.<span class="ltx_text" id="S2.p4.1.2"></span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib40" title="">40</a>]</cite> and Yuan <em class="ltx_emph ltx_font_italic" id="S2.p4.1.3">et al</em>.<span class="ltx_text" id="S2.p4.1.4"></span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib44" title="">44</a>]</cite> proposed energy-based models to align target samples with the source distribution. MEMO <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib45" title="">45</a>]</cite> augmented test points in various ways to encourage consistent and confident predictions for test-time robustness. TENT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib36" title="">36</a>]</cite> focused on the fully test-time adaptation setting, similar to ours, using only test data and a specific test loss for adaptation. In our case, we search for supervision from each testing sample for test-time adaption.
Leveraging the learning capacity of deep models and the guidance provided by material-consistent edges, we propose extracting self-supervision signals for refining shadow removal performance during inference.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Method</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">In this section, we describe our novel self-supervised test-time adaptation method for refining shadow removal, given the shadow image and its corresponding shadow mask.
First, we introduce our shadow edge extraction module to extract useful supervision from shadow/non-shadow pairs alongside shadow edges. We fine-tune the Segment Anything Model (SAM) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite> to learn to generate a segmentation of materials regardless of the presence of shadows. By comparing the segmentation masks with the shadow mask, we can identify edges that traverse the same materials.
Next, we outline our adaptation process, which uses the shadow edges to iteratively refine shadow removal results during inference. Comparing pixels across two sides of shadow edges provides us with information about the color transition caused by the shadow. Additionally, patches within each material mask should exhibit consistent textures when the shadow is properly removed.
Using the collected supervision from shadow/shadow-free pairs and an iterative adaptation approach, our method significantly enhances the performance of pre-trained shadow removal models, even on more complex shadow images in the wild.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Material-Consistent Shadow Edge Extraction</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">Shadow edges mark the boundary between shadow and shadow-free areas. The areas on either side of these edges offer potential supervision for shadow removal, as they contain regions with matching colors and textures.
However, shadow edges do not always separate areas with consistent underlying materials. For instance, when an object is well-illuminated and casts a shadow on the background, shadow edges form along the object boundaries. In such cases, the two sides of the shadow edges display disparate colors and textures, lacking material consistency and thus rendering them unsuitable for supervising shadow removal.
A simple strategy to avoid selecting those edges is to segment materials within the image, and then identify shadow edges that go across the same material.</p>
</div>
<figure class="ltx_figure" id="S3.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="151" id="S3.F2.g1" src="extracted/5846543/pics_jpg/samcompare.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S3.F2.2"><span class="ltx_text ltx_inline-block" id="S3.F2.2.1" style="font-size:90%;width:138.8pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S3.F2.2.2" style="font-size:90%;width:138.8pt;">Vanilla SAM</span>
<span class="ltx_text ltx_inline-block" id="S3.F2.2.3" style="font-size:90%;width:138.8pt;">Fine-tuned SAM</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F2.4.1.1" style="font-size:90%;">Figure 2</span>: </span><span class="ltx_text ltx_font_bold" id="S3.F2.5.2" style="font-size:90%;">Fine-tuning SAM for Material-Consistent Edge Extraction.<span class="ltx_text ltx_font_medium" id="S3.F2.5.2.1"> Given the input image, we compare the segmentation results of vanilla SAM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite> with our fine-tuned SAM. Our fine-tuned SAM achieves shadow-invariant segmentation, preserving the material consistency of each mask. In contrast, vanilla SAM is sensitive to shadow presence, segmenting shadow regions as individual masks.</span></span></figcaption>
</figure>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1">We propose fine-tuning the Segment Anything Model (SAM) to generate a segmentation of materials in images, irrespective of shadow presence. While Vanilla SAM demonstrates robust performance in semantic segmentation, its sensitivity to shadows results in segmenting partially shadowed materials into separate masks (<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F2" title="In 3.1 Material-Consistent Shadow Edge Extraction ‣ 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">2</span></a>). To mitigate this, we follow the common strategy <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib2" title="">2</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib41" title="">41</a>]</cite> of freezing the image and prompt encoders while fine-tuning the mask decoder.
Unlike <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib2" title="">2</a>]</cite>, which trains adapted prompt encoders, our input prompts remain a grid of points uniformly distributed over the image (as pre-defined in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite>) and the input is the shadow image.
We fine-tune SAM to be shadow-invariant by forcing it to output the same segmentation as the pseudo-ground truth generated from the shadow-free counterpart.
We use the Dice Loss <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib33" title="">33</a>]</cite> to constrain the similarity between masks predicted with and without shadows and achieve shadow-invariant material segmentation with our fine-tuned SAM, as illustrated in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F2" title="In 3.1 Material-Consistent Shadow Edge Extraction ‣ 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1">For a given test image, we compare the shadow mask with each of the SAM segments. The SAM is fine-tuned to ensure that each segment corresponds to a specific material. Therefore, any shadow edge intersecting a SAM segment is regarded as a material-consistent shadow edge.
This approach enables us to extract edges that traverse the same material, facilitating the sampling of pixels near the edges and patches in the shadow/non-shadow regions.
</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Test-time Adaptation</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">Due to the complexity and variability in shadow appearances, existing methods often struggle when confronted with out-of-distribution shadow images, leading to residual shadow effects.
To address this challenge, we propose an iterative adaptation approach for pre-trained models based on the supervision captured from shadow edges and shadow-invariant segmentation masks.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.6">To ensure color consistency between the shadow and non-shadow regions, we sample pixels along the extracted shadow edges, denoted as <math alttext="S_{in}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><msub id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.2.cmml">S</mi><mrow id="S3.SS2.p2.1.m1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.3.cmml"><mi id="S3.SS2.p2.1.m1.1.1.3.2" xref="S3.SS2.p2.1.m1.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p2.1.m1.1.1.3.1" xref="S3.SS2.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.1.m1.1.1.3.3" xref="S3.SS2.p2.1.m1.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><apply id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2">𝑆</ci><apply id="S3.SS2.p2.1.m1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3"><times id="S3.SS2.p2.1.m1.1.1.3.1.cmml" xref="S3.SS2.p2.1.m1.1.1.3.1"></times><ci id="S3.SS2.p2.1.m1.1.1.3.2.cmml" xref="S3.SS2.p2.1.m1.1.1.3.2">𝑖</ci><ci id="S3.SS2.p2.1.m1.1.1.3.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">S_{in}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="S_{out}" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><msub id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml"><mi id="S3.SS2.p2.2.m2.1.1.2" xref="S3.SS2.p2.2.m2.1.1.2.cmml">S</mi><mrow id="S3.SS2.p2.2.m2.1.1.3" xref="S3.SS2.p2.2.m2.1.1.3.cmml"><mi id="S3.SS2.p2.2.m2.1.1.3.2" xref="S3.SS2.p2.2.m2.1.1.3.2.cmml">o</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.3" xref="S3.SS2.p2.2.m2.1.1.3.3.cmml">u</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1a" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.4" xref="S3.SS2.p2.2.m2.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><apply id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.2.m2.1.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p2.2.m2.1.1.2.cmml" xref="S3.SS2.p2.2.m2.1.1.2">𝑆</ci><apply id="S3.SS2.p2.2.m2.1.1.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3"><times id="S3.SS2.p2.2.m2.1.1.3.1.cmml" xref="S3.SS2.p2.2.m2.1.1.3.1"></times><ci id="S3.SS2.p2.2.m2.1.1.3.2.cmml" xref="S3.SS2.p2.2.m2.1.1.3.2">𝑜</ci><ci id="S3.SS2.p2.2.m2.1.1.3.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3.3">𝑢</ci><ci id="S3.SS2.p2.2.m2.1.1.3.4.cmml" xref="S3.SS2.p2.2.m2.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">S_{out}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> (see <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F3" title="In 3.2 Test-time Adaptation ‣ 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">3</span></a>).
<math alttext="S_{in}=\{u_{1},\dots,u_{i},\dots,u_{M}\},i\in[1,M]" class="ltx_Math" display="inline" id="S3.SS2.p2.3.m3.6"><semantics id="S3.SS2.p2.3.m3.6a"><mrow id="S3.SS2.p2.3.m3.6.6.2" xref="S3.SS2.p2.3.m3.6.6.3.cmml"><mrow id="S3.SS2.p2.3.m3.5.5.1.1" xref="S3.SS2.p2.3.m3.5.5.1.1.cmml"><msub id="S3.SS2.p2.3.m3.5.5.1.1.5" xref="S3.SS2.p2.3.m3.5.5.1.1.5.cmml"><mi id="S3.SS2.p2.3.m3.5.5.1.1.5.2" xref="S3.SS2.p2.3.m3.5.5.1.1.5.2.cmml">S</mi><mrow id="S3.SS2.p2.3.m3.5.5.1.1.5.3" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.cmml"><mi id="S3.SS2.p2.3.m3.5.5.1.1.5.3.2" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.2.cmml">i</mi><mo id="S3.SS2.p2.3.m3.5.5.1.1.5.3.1" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.3.m3.5.5.1.1.5.3.3" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.3.cmml">n</mi></mrow></msub><mo id="S3.SS2.p2.3.m3.5.5.1.1.4" xref="S3.SS2.p2.3.m3.5.5.1.1.4.cmml">=</mo><mrow id="S3.SS2.p2.3.m3.5.5.1.1.3.3" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml"><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.4" stretchy="false" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">{</mo><msub id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.cmml"><mi id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.2" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.2.cmml">u</mi><mn id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.3" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.5" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p2.3.m3.1.1" mathvariant="normal" xref="S3.SS2.p2.3.m3.1.1.cmml">…</mi><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.6" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.cmml"><mi id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.2" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.2.cmml">u</mi><mi id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.3" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.7" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p2.3.m3.2.2" mathvariant="normal" xref="S3.SS2.p2.3.m3.2.2.cmml">…</mi><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.8" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.cmml"><mi id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.2" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.2.cmml">u</mi><mi id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.3" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.3.cmml">M</mi></msub><mo id="S3.SS2.p2.3.m3.5.5.1.1.3.3.9" stretchy="false" xref="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S3.SS2.p2.3.m3.6.6.2.3" xref="S3.SS2.p2.3.m3.6.6.3a.cmml">,</mo><mrow id="S3.SS2.p2.3.m3.6.6.2.2" xref="S3.SS2.p2.3.m3.6.6.2.2.cmml"><mi id="S3.SS2.p2.3.m3.6.6.2.2.2" xref="S3.SS2.p2.3.m3.6.6.2.2.2.cmml">i</mi><mo id="S3.SS2.p2.3.m3.6.6.2.2.1" xref="S3.SS2.p2.3.m3.6.6.2.2.1.cmml">∈</mo><mrow id="S3.SS2.p2.3.m3.6.6.2.2.3.2" xref="S3.SS2.p2.3.m3.6.6.2.2.3.1.cmml"><mo id="S3.SS2.p2.3.m3.6.6.2.2.3.2.1" stretchy="false" xref="S3.SS2.p2.3.m3.6.6.2.2.3.1.cmml">[</mo><mn id="S3.SS2.p2.3.m3.3.3" xref="S3.SS2.p2.3.m3.3.3.cmml">1</mn><mo id="S3.SS2.p2.3.m3.6.6.2.2.3.2.2" xref="S3.SS2.p2.3.m3.6.6.2.2.3.1.cmml">,</mo><mi id="S3.SS2.p2.3.m3.4.4" xref="S3.SS2.p2.3.m3.4.4.cmml">M</mi><mo id="S3.SS2.p2.3.m3.6.6.2.2.3.2.3" stretchy="false" xref="S3.SS2.p2.3.m3.6.6.2.2.3.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.6b"><apply id="S3.SS2.p2.3.m3.6.6.3.cmml" xref="S3.SS2.p2.3.m3.6.6.2"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.6.6.3a.cmml" xref="S3.SS2.p2.3.m3.6.6.2.3">formulae-sequence</csymbol><apply id="S3.SS2.p2.3.m3.5.5.1.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1"><eq id="S3.SS2.p2.3.m3.5.5.1.1.4.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.4"></eq><apply id="S3.SS2.p2.3.m3.5.5.1.1.5.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.5.5.1.1.5.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5">subscript</csymbol><ci id="S3.SS2.p2.3.m3.5.5.1.1.5.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5.2">𝑆</ci><apply id="S3.SS2.p2.3.m3.5.5.1.1.5.3.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3"><times id="S3.SS2.p2.3.m3.5.5.1.1.5.3.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.1"></times><ci id="S3.SS2.p2.3.m3.5.5.1.1.5.3.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.2">𝑖</ci><ci id="S3.SS2.p2.3.m3.5.5.1.1.5.3.3.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.5.3.3">𝑛</ci></apply></apply><set id="S3.SS2.p2.3.m3.5.5.1.1.3.4.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3"><apply id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.2">𝑢</ci><cn id="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.3.cmml" type="integer" xref="S3.SS2.p2.3.m3.5.5.1.1.1.1.1.3">1</cn></apply><ci id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1">…</ci><apply id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2">subscript</csymbol><ci id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.2">𝑢</ci><ci id="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.3.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.2.2.2.3">𝑖</ci></apply><ci id="S3.SS2.p2.3.m3.2.2.cmml" xref="S3.SS2.p2.3.m3.2.2">…</ci><apply id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.1.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3">subscript</csymbol><ci id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.2.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.2">𝑢</ci><ci id="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.3.cmml" xref="S3.SS2.p2.3.m3.5.5.1.1.3.3.3.3">𝑀</ci></apply></set></apply><apply id="S3.SS2.p2.3.m3.6.6.2.2.cmml" xref="S3.SS2.p2.3.m3.6.6.2.2"><in id="S3.SS2.p2.3.m3.6.6.2.2.1.cmml" xref="S3.SS2.p2.3.m3.6.6.2.2.1"></in><ci id="S3.SS2.p2.3.m3.6.6.2.2.2.cmml" xref="S3.SS2.p2.3.m3.6.6.2.2.2">𝑖</ci><interval closure="closed" id="S3.SS2.p2.3.m3.6.6.2.2.3.1.cmml" xref="S3.SS2.p2.3.m3.6.6.2.2.3.2"><cn id="S3.SS2.p2.3.m3.3.3.cmml" type="integer" xref="S3.SS2.p2.3.m3.3.3">1</cn><ci id="S3.SS2.p2.3.m3.4.4.cmml" xref="S3.SS2.p2.3.m3.4.4">𝑀</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.6c">S_{in}=\{u_{1},\dots,u_{i},\dots,u_{M}\},i\in[1,M]</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.3.m3.6d">italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT = { italic_u start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_u start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , … , italic_u start_POSTSUBSCRIPT italic_M end_POSTSUBSCRIPT } , italic_i ∈ [ 1 , italic_M ]</annotation></semantics></math> represents the pixels inside the shadow boundary, obtained by subtracting an eroded shadow mask from the original shadow mask.
Similarly, <math alttext="S_{out}=\{v_{1},\dots,v_{j},\dots,v_{N}\},j\in[1,N]" class="ltx_Math" display="inline" id="S3.SS2.p2.4.m4.6"><semantics id="S3.SS2.p2.4.m4.6a"><mrow id="S3.SS2.p2.4.m4.6.6.2" xref="S3.SS2.p2.4.m4.6.6.3.cmml"><mrow id="S3.SS2.p2.4.m4.5.5.1.1" xref="S3.SS2.p2.4.m4.5.5.1.1.cmml"><msub id="S3.SS2.p2.4.m4.5.5.1.1.5" xref="S3.SS2.p2.4.m4.5.5.1.1.5.cmml"><mi id="S3.SS2.p2.4.m4.5.5.1.1.5.2" xref="S3.SS2.p2.4.m4.5.5.1.1.5.2.cmml">S</mi><mrow id="S3.SS2.p2.4.m4.5.5.1.1.5.3" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.cmml"><mi id="S3.SS2.p2.4.m4.5.5.1.1.5.3.2" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.2.cmml">o</mi><mo id="S3.SS2.p2.4.m4.5.5.1.1.5.3.1" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m4.5.5.1.1.5.3.3" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.3.cmml">u</mi><mo id="S3.SS2.p2.4.m4.5.5.1.1.5.3.1a" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m4.5.5.1.1.5.3.4" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.4.cmml">t</mi></mrow></msub><mo id="S3.SS2.p2.4.m4.5.5.1.1.4" xref="S3.SS2.p2.4.m4.5.5.1.1.4.cmml">=</mo><mrow id="S3.SS2.p2.4.m4.5.5.1.1.3.3" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml"><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.4" stretchy="false" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">{</mo><msub id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.cmml"><mi id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.2" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.2.cmml">v</mi><mn id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.3" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.5" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p2.4.m4.1.1" mathvariant="normal" xref="S3.SS2.p2.4.m4.1.1.cmml">…</mi><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.6" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.cmml"><mi id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.2" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.2.cmml">v</mi><mi id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.3" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.3.cmml">j</mi></msub><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.7" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p2.4.m4.2.2" mathvariant="normal" xref="S3.SS2.p2.4.m4.2.2.cmml">…</mi><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.8" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.cmml"><mi id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.2" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.2.cmml">v</mi><mi id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.3" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.3.cmml">N</mi></msub><mo id="S3.SS2.p2.4.m4.5.5.1.1.3.3.9" stretchy="false" xref="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S3.SS2.p2.4.m4.6.6.2.3" xref="S3.SS2.p2.4.m4.6.6.3a.cmml">,</mo><mrow id="S3.SS2.p2.4.m4.6.6.2.2" xref="S3.SS2.p2.4.m4.6.6.2.2.cmml"><mi id="S3.SS2.p2.4.m4.6.6.2.2.2" xref="S3.SS2.p2.4.m4.6.6.2.2.2.cmml">j</mi><mo id="S3.SS2.p2.4.m4.6.6.2.2.1" xref="S3.SS2.p2.4.m4.6.6.2.2.1.cmml">∈</mo><mrow id="S3.SS2.p2.4.m4.6.6.2.2.3.2" xref="S3.SS2.p2.4.m4.6.6.2.2.3.1.cmml"><mo id="S3.SS2.p2.4.m4.6.6.2.2.3.2.1" stretchy="false" xref="S3.SS2.p2.4.m4.6.6.2.2.3.1.cmml">[</mo><mn id="S3.SS2.p2.4.m4.3.3" xref="S3.SS2.p2.4.m4.3.3.cmml">1</mn><mo id="S3.SS2.p2.4.m4.6.6.2.2.3.2.2" xref="S3.SS2.p2.4.m4.6.6.2.2.3.1.cmml">,</mo><mi id="S3.SS2.p2.4.m4.4.4" xref="S3.SS2.p2.4.m4.4.4.cmml">N</mi><mo id="S3.SS2.p2.4.m4.6.6.2.2.3.2.3" stretchy="false" xref="S3.SS2.p2.4.m4.6.6.2.2.3.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.4.m4.6b"><apply id="S3.SS2.p2.4.m4.6.6.3.cmml" xref="S3.SS2.p2.4.m4.6.6.2"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.6.6.3a.cmml" xref="S3.SS2.p2.4.m4.6.6.2.3">formulae-sequence</csymbol><apply id="S3.SS2.p2.4.m4.5.5.1.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1"><eq id="S3.SS2.p2.4.m4.5.5.1.1.4.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.4"></eq><apply id="S3.SS2.p2.4.m4.5.5.1.1.5.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.5.5.1.1.5.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5">subscript</csymbol><ci id="S3.SS2.p2.4.m4.5.5.1.1.5.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.2">𝑆</ci><apply id="S3.SS2.p2.4.m4.5.5.1.1.5.3.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3"><times id="S3.SS2.p2.4.m4.5.5.1.1.5.3.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.1"></times><ci id="S3.SS2.p2.4.m4.5.5.1.1.5.3.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.2">𝑜</ci><ci id="S3.SS2.p2.4.m4.5.5.1.1.5.3.3.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.3">𝑢</ci><ci id="S3.SS2.p2.4.m4.5.5.1.1.5.3.4.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.5.3.4">𝑡</ci></apply></apply><set id="S3.SS2.p2.4.m4.5.5.1.1.3.4.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3"><apply id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.2">𝑣</ci><cn id="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.3.cmml" type="integer" xref="S3.SS2.p2.4.m4.5.5.1.1.1.1.1.3">1</cn></apply><ci id="S3.SS2.p2.4.m4.1.1.cmml" xref="S3.SS2.p2.4.m4.1.1">…</ci><apply id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2">subscript</csymbol><ci id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.2">𝑣</ci><ci id="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.3.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.2.2.2.3">𝑗</ci></apply><ci id="S3.SS2.p2.4.m4.2.2.cmml" xref="S3.SS2.p2.4.m4.2.2">…</ci><apply id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.1.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3">subscript</csymbol><ci id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.2.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.2">𝑣</ci><ci id="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.3.cmml" xref="S3.SS2.p2.4.m4.5.5.1.1.3.3.3.3">𝑁</ci></apply></set></apply><apply id="S3.SS2.p2.4.m4.6.6.2.2.cmml" xref="S3.SS2.p2.4.m4.6.6.2.2"><in id="S3.SS2.p2.4.m4.6.6.2.2.1.cmml" xref="S3.SS2.p2.4.m4.6.6.2.2.1"></in><ci id="S3.SS2.p2.4.m4.6.6.2.2.2.cmml" xref="S3.SS2.p2.4.m4.6.6.2.2.2">𝑗</ci><interval closure="closed" id="S3.SS2.p2.4.m4.6.6.2.2.3.1.cmml" xref="S3.SS2.p2.4.m4.6.6.2.2.3.2"><cn id="S3.SS2.p2.4.m4.3.3.cmml" type="integer" xref="S3.SS2.p2.4.m4.3.3">1</cn><ci id="S3.SS2.p2.4.m4.4.4.cmml" xref="S3.SS2.p2.4.m4.4.4">𝑁</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.4.m4.6c">S_{out}=\{v_{1},\dots,v_{j},\dots,v_{N}\},j\in[1,N]</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.4.m4.6d">italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT = { italic_v start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_v start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , … , italic_v start_POSTSUBSCRIPT italic_N end_POSTSUBSCRIPT } , italic_j ∈ [ 1 , italic_N ]</annotation></semantics></math> is obtained by subtracting the shadow mask from its dilated version.
To mitigate the influence of annotation errors in the shadow mask, we apply dilation and erosion operations to the shadow mask before subtraction.
We then introduce two novel losses to constrain color consistency: 1) The RGB distance loss calculates the mean of the minimum distance between a pixel in <math alttext="S_{in}" class="ltx_Math" display="inline" id="S3.SS2.p2.5.m5.1"><semantics id="S3.SS2.p2.5.m5.1a"><msub id="S3.SS2.p2.5.m5.1.1" xref="S3.SS2.p2.5.m5.1.1.cmml"><mi id="S3.SS2.p2.5.m5.1.1.2" xref="S3.SS2.p2.5.m5.1.1.2.cmml">S</mi><mrow id="S3.SS2.p2.5.m5.1.1.3" xref="S3.SS2.p2.5.m5.1.1.3.cmml"><mi id="S3.SS2.p2.5.m5.1.1.3.2" xref="S3.SS2.p2.5.m5.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p2.5.m5.1.1.3.1" xref="S3.SS2.p2.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m5.1.1.3.3" xref="S3.SS2.p2.5.m5.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.5.m5.1b"><apply id="S3.SS2.p2.5.m5.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m5.1.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1">subscript</csymbol><ci id="S3.SS2.p2.5.m5.1.1.2.cmml" xref="S3.SS2.p2.5.m5.1.1.2">𝑆</ci><apply id="S3.SS2.p2.5.m5.1.1.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3"><times id="S3.SS2.p2.5.m5.1.1.3.1.cmml" xref="S3.SS2.p2.5.m5.1.1.3.1"></times><ci id="S3.SS2.p2.5.m5.1.1.3.2.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2">𝑖</ci><ci id="S3.SS2.p2.5.m5.1.1.3.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.5.m5.1c">S_{in}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.5.m5.1d">italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> and all pixels in <math alttext="S_{out}" class="ltx_Math" display="inline" id="S3.SS2.p2.6.m6.1"><semantics id="S3.SS2.p2.6.m6.1a"><msub id="S3.SS2.p2.6.m6.1.1" xref="S3.SS2.p2.6.m6.1.1.cmml"><mi id="S3.SS2.p2.6.m6.1.1.2" xref="S3.SS2.p2.6.m6.1.1.2.cmml">S</mi><mrow id="S3.SS2.p2.6.m6.1.1.3" xref="S3.SS2.p2.6.m6.1.1.3.cmml"><mi id="S3.SS2.p2.6.m6.1.1.3.2" xref="S3.SS2.p2.6.m6.1.1.3.2.cmml">o</mi><mo id="S3.SS2.p2.6.m6.1.1.3.1" xref="S3.SS2.p2.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m6.1.1.3.3" xref="S3.SS2.p2.6.m6.1.1.3.3.cmml">u</mi><mo id="S3.SS2.p2.6.m6.1.1.3.1a" xref="S3.SS2.p2.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m6.1.1.3.4" xref="S3.SS2.p2.6.m6.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.6.m6.1b"><apply id="S3.SS2.p2.6.m6.1.1.cmml" xref="S3.SS2.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.6.m6.1.1.1.cmml" xref="S3.SS2.p2.6.m6.1.1">subscript</csymbol><ci id="S3.SS2.p2.6.m6.1.1.2.cmml" xref="S3.SS2.p2.6.m6.1.1.2">𝑆</ci><apply id="S3.SS2.p2.6.m6.1.1.3.cmml" xref="S3.SS2.p2.6.m6.1.1.3"><times id="S3.SS2.p2.6.m6.1.1.3.1.cmml" xref="S3.SS2.p2.6.m6.1.1.3.1"></times><ci id="S3.SS2.p2.6.m6.1.1.3.2.cmml" xref="S3.SS2.p2.6.m6.1.1.3.2">𝑜</ci><ci id="S3.SS2.p2.6.m6.1.1.3.3.cmml" xref="S3.SS2.p2.6.m6.1.1.3.3">𝑢</ci><ci id="S3.SS2.p2.6.m6.1.1.3.4.cmml" xref="S3.SS2.p2.6.m6.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.6.m6.1c">S_{out}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.6.m6.1d">italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, enforcing the restoration of the correct color of the shadow region; 2) The RGB distribution loss computes the Earth Mover’s Distance (EMD) between the color distributions of the two sets of sampled pixels, ensuring color distribution consistency within the sampled pixel sets. The losses are formulated as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="L_{distance}=\frac{\sum_{i=1}^{M}\min_{j\in[1,N]}d(u_{i},v_{j})}{M}," class="ltx_Math" display="block" id="S3.E1.m1.5"><semantics id="S3.E1.m1.5a"><mrow id="S3.E1.m1.5.5.1" xref="S3.E1.m1.5.5.1.1.cmml"><mrow id="S3.E1.m1.5.5.1.1" xref="S3.E1.m1.5.5.1.1.cmml"><msub id="S3.E1.m1.5.5.1.1.2" xref="S3.E1.m1.5.5.1.1.2.cmml"><mi id="S3.E1.m1.5.5.1.1.2.2" xref="S3.E1.m1.5.5.1.1.2.2.cmml">L</mi><mrow id="S3.E1.m1.5.5.1.1.2.3" xref="S3.E1.m1.5.5.1.1.2.3.cmml"><mi id="S3.E1.m1.5.5.1.1.2.3.2" xref="S3.E1.m1.5.5.1.1.2.3.2.cmml">d</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.3" xref="S3.E1.m1.5.5.1.1.2.3.3.cmml">i</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1a" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.4" xref="S3.E1.m1.5.5.1.1.2.3.4.cmml">s</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1b" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.5" xref="S3.E1.m1.5.5.1.1.2.3.5.cmml">t</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1c" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.6" xref="S3.E1.m1.5.5.1.1.2.3.6.cmml">a</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1d" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.7" xref="S3.E1.m1.5.5.1.1.2.3.7.cmml">n</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1e" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.8" xref="S3.E1.m1.5.5.1.1.2.3.8.cmml">c</mi><mo id="S3.E1.m1.5.5.1.1.2.3.1f" xref="S3.E1.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E1.m1.5.5.1.1.2.3.9" xref="S3.E1.m1.5.5.1.1.2.3.9.cmml">e</mi></mrow></msub><mo id="S3.E1.m1.5.5.1.1.1" xref="S3.E1.m1.5.5.1.1.1.cmml">=</mo><mfrac id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml"><mrow id="S3.E1.m1.4.4.4" xref="S3.E1.m1.4.4.4.cmml"><msubsup id="S3.E1.m1.4.4.4.5" xref="S3.E1.m1.4.4.4.5.cmml"><mo id="S3.E1.m1.4.4.4.5.2.2" xref="S3.E1.m1.4.4.4.5.2.2.cmml">∑</mo><mrow id="S3.E1.m1.4.4.4.5.2.3" xref="S3.E1.m1.4.4.4.5.2.3.cmml"><mi id="S3.E1.m1.4.4.4.5.2.3.2" xref="S3.E1.m1.4.4.4.5.2.3.2.cmml">i</mi><mo id="S3.E1.m1.4.4.4.5.2.3.1" xref="S3.E1.m1.4.4.4.5.2.3.1.cmml">=</mo><mn id="S3.E1.m1.4.4.4.5.2.3.3" xref="S3.E1.m1.4.4.4.5.2.3.3.cmml">1</mn></mrow><mi id="S3.E1.m1.4.4.4.5.3" xref="S3.E1.m1.4.4.4.5.3.cmml">M</mi></msubsup><mrow id="S3.E1.m1.4.4.4.4" xref="S3.E1.m1.4.4.4.4.cmml"><mrow id="S3.E1.m1.4.4.4.4.4" xref="S3.E1.m1.4.4.4.4.4.cmml"><msub id="S3.E1.m1.4.4.4.4.4.1" xref="S3.E1.m1.4.4.4.4.4.1.cmml"><mi id="S3.E1.m1.4.4.4.4.4.1.2" xref="S3.E1.m1.4.4.4.4.4.1.2.cmml">min</mi><mrow id="S3.E1.m1.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.cmml"><mi id="S3.E1.m1.2.2.2.2.2.4" xref="S3.E1.m1.2.2.2.2.2.4.cmml">j</mi><mo id="S3.E1.m1.2.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.2.3.cmml">∈</mo><mrow id="S3.E1.m1.2.2.2.2.2.5.2" xref="S3.E1.m1.2.2.2.2.2.5.1.cmml"><mo id="S3.E1.m1.2.2.2.2.2.5.2.1" stretchy="false" xref="S3.E1.m1.2.2.2.2.2.5.1.cmml">[</mo><mn id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml">1</mn><mo id="S3.E1.m1.2.2.2.2.2.5.2.2" xref="S3.E1.m1.2.2.2.2.2.5.1.cmml">,</mo><mi id="S3.E1.m1.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.cmml">N</mi><mo id="S3.E1.m1.2.2.2.2.2.5.2.3" stretchy="false" xref="S3.E1.m1.2.2.2.2.2.5.1.cmml">]</mo></mrow></mrow></msub><mo id="S3.E1.m1.4.4.4.4.4a" lspace="0.167em" xref="S3.E1.m1.4.4.4.4.4.cmml">⁡</mo><mi id="S3.E1.m1.4.4.4.4.4.2" xref="S3.E1.m1.4.4.4.4.4.2.cmml">d</mi></mrow><mo id="S3.E1.m1.4.4.4.4.3" xref="S3.E1.m1.4.4.4.4.3.cmml">⁢</mo><mrow id="S3.E1.m1.4.4.4.4.2.2" xref="S3.E1.m1.4.4.4.4.2.3.cmml"><mo id="S3.E1.m1.4.4.4.4.2.2.3" stretchy="false" xref="S3.E1.m1.4.4.4.4.2.3.cmml">(</mo><msub id="S3.E1.m1.3.3.3.3.1.1.1" xref="S3.E1.m1.3.3.3.3.1.1.1.cmml"><mi id="S3.E1.m1.3.3.3.3.1.1.1.2" xref="S3.E1.m1.3.3.3.3.1.1.1.2.cmml">u</mi><mi id="S3.E1.m1.3.3.3.3.1.1.1.3" xref="S3.E1.m1.3.3.3.3.1.1.1.3.cmml">i</mi></msub><mo id="S3.E1.m1.4.4.4.4.2.2.4" xref="S3.E1.m1.4.4.4.4.2.3.cmml">,</mo><msub id="S3.E1.m1.4.4.4.4.2.2.2" xref="S3.E1.m1.4.4.4.4.2.2.2.cmml"><mi id="S3.E1.m1.4.4.4.4.2.2.2.2" xref="S3.E1.m1.4.4.4.4.2.2.2.2.cmml">v</mi><mi id="S3.E1.m1.4.4.4.4.2.2.2.3" xref="S3.E1.m1.4.4.4.4.2.2.2.3.cmml">j</mi></msub><mo id="S3.E1.m1.4.4.4.4.2.2.5" stretchy="false" xref="S3.E1.m1.4.4.4.4.2.3.cmml">)</mo></mrow></mrow></mrow><mi id="S3.E1.m1.4.4.6" xref="S3.E1.m1.4.4.6.cmml">M</mi></mfrac></mrow><mo id="S3.E1.m1.5.5.1.2" xref="S3.E1.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.5b"><apply id="S3.E1.m1.5.5.1.1.cmml" xref="S3.E1.m1.5.5.1"><eq id="S3.E1.m1.5.5.1.1.1.cmml" xref="S3.E1.m1.5.5.1.1.1"></eq><apply id="S3.E1.m1.5.5.1.1.2.cmml" xref="S3.E1.m1.5.5.1.1.2"><csymbol cd="ambiguous" id="S3.E1.m1.5.5.1.1.2.1.cmml" xref="S3.E1.m1.5.5.1.1.2">subscript</csymbol><ci id="S3.E1.m1.5.5.1.1.2.2.cmml" xref="S3.E1.m1.5.5.1.1.2.2">𝐿</ci><apply id="S3.E1.m1.5.5.1.1.2.3.cmml" xref="S3.E1.m1.5.5.1.1.2.3"><times id="S3.E1.m1.5.5.1.1.2.3.1.cmml" xref="S3.E1.m1.5.5.1.1.2.3.1"></times><ci id="S3.E1.m1.5.5.1.1.2.3.2.cmml" xref="S3.E1.m1.5.5.1.1.2.3.2">𝑑</ci><ci id="S3.E1.m1.5.5.1.1.2.3.3.cmml" xref="S3.E1.m1.5.5.1.1.2.3.3">𝑖</ci><ci id="S3.E1.m1.5.5.1.1.2.3.4.cmml" xref="S3.E1.m1.5.5.1.1.2.3.4">𝑠</ci><ci id="S3.E1.m1.5.5.1.1.2.3.5.cmml" xref="S3.E1.m1.5.5.1.1.2.3.5">𝑡</ci><ci id="S3.E1.m1.5.5.1.1.2.3.6.cmml" xref="S3.E1.m1.5.5.1.1.2.3.6">𝑎</ci><ci id="S3.E1.m1.5.5.1.1.2.3.7.cmml" xref="S3.E1.m1.5.5.1.1.2.3.7">𝑛</ci><ci id="S3.E1.m1.5.5.1.1.2.3.8.cmml" xref="S3.E1.m1.5.5.1.1.2.3.8">𝑐</ci><ci id="S3.E1.m1.5.5.1.1.2.3.9.cmml" xref="S3.E1.m1.5.5.1.1.2.3.9">𝑒</ci></apply></apply><apply id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4"><divide id="S3.E1.m1.4.4.5.cmml" xref="S3.E1.m1.4.4"></divide><apply id="S3.E1.m1.4.4.4.cmml" xref="S3.E1.m1.4.4.4"><apply id="S3.E1.m1.4.4.4.5.cmml" xref="S3.E1.m1.4.4.4.5"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.5.1.cmml" xref="S3.E1.m1.4.4.4.5">superscript</csymbol><apply id="S3.E1.m1.4.4.4.5.2.cmml" xref="S3.E1.m1.4.4.4.5"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.5.2.1.cmml" xref="S3.E1.m1.4.4.4.5">subscript</csymbol><sum id="S3.E1.m1.4.4.4.5.2.2.cmml" xref="S3.E1.m1.4.4.4.5.2.2"></sum><apply id="S3.E1.m1.4.4.4.5.2.3.cmml" xref="S3.E1.m1.4.4.4.5.2.3"><eq id="S3.E1.m1.4.4.4.5.2.3.1.cmml" xref="S3.E1.m1.4.4.4.5.2.3.1"></eq><ci id="S3.E1.m1.4.4.4.5.2.3.2.cmml" xref="S3.E1.m1.4.4.4.5.2.3.2">𝑖</ci><cn id="S3.E1.m1.4.4.4.5.2.3.3.cmml" type="integer" xref="S3.E1.m1.4.4.4.5.2.3.3">1</cn></apply></apply><ci id="S3.E1.m1.4.4.4.5.3.cmml" xref="S3.E1.m1.4.4.4.5.3">𝑀</ci></apply><apply id="S3.E1.m1.4.4.4.4.cmml" xref="S3.E1.m1.4.4.4.4"><times id="S3.E1.m1.4.4.4.4.3.cmml" xref="S3.E1.m1.4.4.4.4.3"></times><apply id="S3.E1.m1.4.4.4.4.4.cmml" xref="S3.E1.m1.4.4.4.4.4"><apply id="S3.E1.m1.4.4.4.4.4.1.cmml" xref="S3.E1.m1.4.4.4.4.4.1"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.4.4.1.1.cmml" xref="S3.E1.m1.4.4.4.4.4.1">subscript</csymbol><min id="S3.E1.m1.4.4.4.4.4.1.2.cmml" xref="S3.E1.m1.4.4.4.4.4.1.2"></min><apply id="S3.E1.m1.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2"><in id="S3.E1.m1.2.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2.3"></in><ci id="S3.E1.m1.2.2.2.2.2.4.cmml" xref="S3.E1.m1.2.2.2.2.2.4">𝑗</ci><interval closure="closed" id="S3.E1.m1.2.2.2.2.2.5.1.cmml" xref="S3.E1.m1.2.2.2.2.2.5.2"><cn id="S3.E1.m1.1.1.1.1.1.1.cmml" type="integer" xref="S3.E1.m1.1.1.1.1.1.1">1</cn><ci id="S3.E1.m1.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2">𝑁</ci></interval></apply></apply><ci id="S3.E1.m1.4.4.4.4.4.2.cmml" xref="S3.E1.m1.4.4.4.4.4.2">𝑑</ci></apply><interval closure="open" id="S3.E1.m1.4.4.4.4.2.3.cmml" xref="S3.E1.m1.4.4.4.4.2.2"><apply id="S3.E1.m1.3.3.3.3.1.1.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3.3.1.1.1.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1">subscript</csymbol><ci id="S3.E1.m1.3.3.3.3.1.1.1.2.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.2">𝑢</ci><ci id="S3.E1.m1.3.3.3.3.1.1.1.3.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.3">𝑖</ci></apply><apply id="S3.E1.m1.4.4.4.4.2.2.2.cmml" xref="S3.E1.m1.4.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.4.2.2.2.1.cmml" xref="S3.E1.m1.4.4.4.4.2.2.2">subscript</csymbol><ci id="S3.E1.m1.4.4.4.4.2.2.2.2.cmml" xref="S3.E1.m1.4.4.4.4.2.2.2.2">𝑣</ci><ci id="S3.E1.m1.4.4.4.4.2.2.2.3.cmml" xref="S3.E1.m1.4.4.4.4.2.2.2.3">𝑗</ci></apply></interval></apply></apply><ci id="S3.E1.m1.4.4.6.cmml" xref="S3.E1.m1.4.4.6">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.5c">L_{distance}=\frac{\sum_{i=1}^{M}\min_{j\in[1,N]}d(u_{i},v_{j})}{M},</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.5d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e end_POSTSUBSCRIPT = divide start_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_M end_POSTSUPERSCRIPT roman_min start_POSTSUBSCRIPT italic_j ∈ [ 1 , italic_N ] end_POSTSUBSCRIPT italic_d ( italic_u start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_v start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) end_ARG start_ARG italic_M end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="L_{distribution}=\textrm{EMD}([Hist(S_{in}),Hist(S_{out})])," class="ltx_Math" display="block" id="S3.E2.m1.1"><semantics id="S3.E2.m1.1a"><mrow id="S3.E2.m1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml"><mrow id="S3.E2.m1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml"><msub id="S3.E2.m1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.3.cmml"><mi id="S3.E2.m1.1.1.1.1.3.2" xref="S3.E2.m1.1.1.1.1.3.2.cmml">L</mi><mrow id="S3.E2.m1.1.1.1.1.3.3" xref="S3.E2.m1.1.1.1.1.3.3.cmml"><mi id="S3.E2.m1.1.1.1.1.3.3.2" xref="S3.E2.m1.1.1.1.1.3.3.2.cmml">d</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.3" xref="S3.E2.m1.1.1.1.1.3.3.3.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1a" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.4" xref="S3.E2.m1.1.1.1.1.3.3.4.cmml">s</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1b" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.5" xref="S3.E2.m1.1.1.1.1.3.3.5.cmml">t</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1c" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.6" xref="S3.E2.m1.1.1.1.1.3.3.6.cmml">r</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1d" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.7" xref="S3.E2.m1.1.1.1.1.3.3.7.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1e" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.8" xref="S3.E2.m1.1.1.1.1.3.3.8.cmml">b</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1f" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.9" xref="S3.E2.m1.1.1.1.1.3.3.9.cmml">u</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1g" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.10" xref="S3.E2.m1.1.1.1.1.3.3.10.cmml">t</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1h" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.11" xref="S3.E2.m1.1.1.1.1.3.3.11.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1i" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.12" xref="S3.E2.m1.1.1.1.1.3.3.12.cmml">o</mi><mo id="S3.E2.m1.1.1.1.1.3.3.1j" xref="S3.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.3.3.13" xref="S3.E2.m1.1.1.1.1.3.3.13.cmml">n</mi></mrow></msub><mo id="S3.E2.m1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.2.cmml">=</mo><mrow id="S3.E2.m1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.cmml"><mtext id="S3.E2.m1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.3a.cmml">EMD</mtext><mo id="S3.E2.m1.1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.cmml"><mo id="S3.E2.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.3.cmml"><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.3.cmml">[</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">H</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.4" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.4.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2a" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.5" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.5.cmml">s</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2b" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.6" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.6.cmml">t</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2c" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">S</mi><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml">n</mi></mrow></msub><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.4" xref="S3.E2.m1.1.1.1.1.1.1.1.1.3.cmml">,</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.3.cmml">H</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.4" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.4.cmml">i</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2a" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.5" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.5.cmml">s</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2b" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.6" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.6.cmml">t</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2c" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">⁢</mo><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.cmml"><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.2" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.cmml">(</mo><msub id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.2.cmml">S</mi><mrow id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.2.cmml">o</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.3.cmml">u</mi><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1a" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.4" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.4.cmml">t</mi></mrow></msub><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.1.1.3.cmml">]</mo></mrow><mo id="S3.E2.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E2.m1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.1b"><apply id="S3.E2.m1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1"><eq id="S3.E2.m1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.2"></eq><apply id="S3.E2.m1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.1.1.1.1.3">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.1.1.1.1.3.2">𝐿</ci><apply id="S3.E2.m1.1.1.1.1.3.3.cmml" xref="S3.E2.m1.1.1.1.1.3.3"><times id="S3.E2.m1.1.1.1.1.3.3.1.cmml" xref="S3.E2.m1.1.1.1.1.3.3.1"></times><ci id="S3.E2.m1.1.1.1.1.3.3.2.cmml" xref="S3.E2.m1.1.1.1.1.3.3.2">𝑑</ci><ci id="S3.E2.m1.1.1.1.1.3.3.3.cmml" xref="S3.E2.m1.1.1.1.1.3.3.3">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.3.3.4.cmml" xref="S3.E2.m1.1.1.1.1.3.3.4">𝑠</ci><ci id="S3.E2.m1.1.1.1.1.3.3.5.cmml" xref="S3.E2.m1.1.1.1.1.3.3.5">𝑡</ci><ci id="S3.E2.m1.1.1.1.1.3.3.6.cmml" xref="S3.E2.m1.1.1.1.1.3.3.6">𝑟</ci><ci id="S3.E2.m1.1.1.1.1.3.3.7.cmml" xref="S3.E2.m1.1.1.1.1.3.3.7">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.3.3.8.cmml" xref="S3.E2.m1.1.1.1.1.3.3.8">𝑏</ci><ci id="S3.E2.m1.1.1.1.1.3.3.9.cmml" xref="S3.E2.m1.1.1.1.1.3.3.9">𝑢</ci><ci id="S3.E2.m1.1.1.1.1.3.3.10.cmml" xref="S3.E2.m1.1.1.1.1.3.3.10">𝑡</ci><ci id="S3.E2.m1.1.1.1.1.3.3.11.cmml" xref="S3.E2.m1.1.1.1.1.3.3.11">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.3.3.12.cmml" xref="S3.E2.m1.1.1.1.1.3.3.12">𝑜</ci><ci id="S3.E2.m1.1.1.1.1.3.3.13.cmml" xref="S3.E2.m1.1.1.1.1.3.3.13">𝑛</ci></apply></apply><apply id="S3.E2.m1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1"><times id="S3.E2.m1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.2"></times><ci id="S3.E2.m1.1.1.1.1.1.3a.cmml" xref="S3.E2.m1.1.1.1.1.1.3"><mtext id="S3.E2.m1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.3">EMD</mtext></ci><interval closure="closed" id="S3.E2.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2"><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1"><times id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.2"></times><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.3">𝐻</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.4.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.4">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.5.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.5">𝑠</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.6.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.6">𝑡</ci><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑆</ci><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3"><times id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.3">𝑛</ci></apply></apply></apply><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2"><times id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.2"></times><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.3">𝐻</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.4.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.4">𝑖</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.5.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.5">𝑠</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.6.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.6">𝑡</ci><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.2">𝑆</ci><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3"><times id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.1"></times><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.2">𝑜</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.3">𝑢</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.4.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.2.2.1.1.1.3.4">𝑡</ci></apply></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.1c">L_{distribution}=\textrm{EMD}([Hist(S_{in}),Hist(S_{out})]),</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.1d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_r italic_i italic_b italic_u italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT = EMD ( [ italic_H italic_i italic_s italic_t ( italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT ) , italic_H italic_i italic_s italic_t ( italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT ) ] ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p2.8">where <math alttext="d(u,v)" class="ltx_Math" display="inline" id="S3.SS2.p2.7.m1.2"><semantics id="S3.SS2.p2.7.m1.2a"><mrow id="S3.SS2.p2.7.m1.2.3" xref="S3.SS2.p2.7.m1.2.3.cmml"><mi id="S3.SS2.p2.7.m1.2.3.2" xref="S3.SS2.p2.7.m1.2.3.2.cmml">d</mi><mo id="S3.SS2.p2.7.m1.2.3.1" xref="S3.SS2.p2.7.m1.2.3.1.cmml">⁢</mo><mrow id="S3.SS2.p2.7.m1.2.3.3.2" xref="S3.SS2.p2.7.m1.2.3.3.1.cmml"><mo id="S3.SS2.p2.7.m1.2.3.3.2.1" stretchy="false" xref="S3.SS2.p2.7.m1.2.3.3.1.cmml">(</mo><mi id="S3.SS2.p2.7.m1.1.1" xref="S3.SS2.p2.7.m1.1.1.cmml">u</mi><mo id="S3.SS2.p2.7.m1.2.3.3.2.2" xref="S3.SS2.p2.7.m1.2.3.3.1.cmml">,</mo><mi id="S3.SS2.p2.7.m1.2.2" xref="S3.SS2.p2.7.m1.2.2.cmml">v</mi><mo id="S3.SS2.p2.7.m1.2.3.3.2.3" stretchy="false" xref="S3.SS2.p2.7.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.7.m1.2b"><apply id="S3.SS2.p2.7.m1.2.3.cmml" xref="S3.SS2.p2.7.m1.2.3"><times id="S3.SS2.p2.7.m1.2.3.1.cmml" xref="S3.SS2.p2.7.m1.2.3.1"></times><ci id="S3.SS2.p2.7.m1.2.3.2.cmml" xref="S3.SS2.p2.7.m1.2.3.2">𝑑</ci><interval closure="open" id="S3.SS2.p2.7.m1.2.3.3.1.cmml" xref="S3.SS2.p2.7.m1.2.3.3.2"><ci id="S3.SS2.p2.7.m1.1.1.cmml" xref="S3.SS2.p2.7.m1.1.1">𝑢</ci><ci id="S3.SS2.p2.7.m1.2.2.cmml" xref="S3.SS2.p2.7.m1.2.2">𝑣</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.7.m1.2c">d(u,v)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.7.m1.2d">italic_d ( italic_u , italic_v )</annotation></semantics></math> denotes the Euclidean distance between two pixels in RGB color space, and <math alttext="Hist(S)" class="ltx_Math" display="inline" id="S3.SS2.p2.8.m2.1"><semantics id="S3.SS2.p2.8.m2.1a"><mrow id="S3.SS2.p2.8.m2.1.2" xref="S3.SS2.p2.8.m2.1.2.cmml"><mi id="S3.SS2.p2.8.m2.1.2.2" xref="S3.SS2.p2.8.m2.1.2.2.cmml">H</mi><mo id="S3.SS2.p2.8.m2.1.2.1" xref="S3.SS2.p2.8.m2.1.2.1.cmml">⁢</mo><mi id="S3.SS2.p2.8.m2.1.2.3" xref="S3.SS2.p2.8.m2.1.2.3.cmml">i</mi><mo id="S3.SS2.p2.8.m2.1.2.1a" xref="S3.SS2.p2.8.m2.1.2.1.cmml">⁢</mo><mi id="S3.SS2.p2.8.m2.1.2.4" xref="S3.SS2.p2.8.m2.1.2.4.cmml">s</mi><mo id="S3.SS2.p2.8.m2.1.2.1b" xref="S3.SS2.p2.8.m2.1.2.1.cmml">⁢</mo><mi id="S3.SS2.p2.8.m2.1.2.5" xref="S3.SS2.p2.8.m2.1.2.5.cmml">t</mi><mo id="S3.SS2.p2.8.m2.1.2.1c" xref="S3.SS2.p2.8.m2.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p2.8.m2.1.2.6.2" xref="S3.SS2.p2.8.m2.1.2.cmml"><mo id="S3.SS2.p2.8.m2.1.2.6.2.1" stretchy="false" xref="S3.SS2.p2.8.m2.1.2.cmml">(</mo><mi id="S3.SS2.p2.8.m2.1.1" xref="S3.SS2.p2.8.m2.1.1.cmml">S</mi><mo id="S3.SS2.p2.8.m2.1.2.6.2.2" stretchy="false" xref="S3.SS2.p2.8.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.8.m2.1b"><apply id="S3.SS2.p2.8.m2.1.2.cmml" xref="S3.SS2.p2.8.m2.1.2"><times id="S3.SS2.p2.8.m2.1.2.1.cmml" xref="S3.SS2.p2.8.m2.1.2.1"></times><ci id="S3.SS2.p2.8.m2.1.2.2.cmml" xref="S3.SS2.p2.8.m2.1.2.2">𝐻</ci><ci id="S3.SS2.p2.8.m2.1.2.3.cmml" xref="S3.SS2.p2.8.m2.1.2.3">𝑖</ci><ci id="S3.SS2.p2.8.m2.1.2.4.cmml" xref="S3.SS2.p2.8.m2.1.2.4">𝑠</ci><ci id="S3.SS2.p2.8.m2.1.2.5.cmml" xref="S3.SS2.p2.8.m2.1.2.5">𝑡</ci><ci id="S3.SS2.p2.8.m2.1.1.cmml" xref="S3.SS2.p2.8.m2.1.1">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.8.m2.1c">Hist(S)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.8.m2.1d">italic_H italic_i italic_s italic_t ( italic_S )</annotation></semantics></math> is the histogram of sampled pixel colors across RGB channels.</p>
</div>
<figure class="ltx_figure" id="S3.F3">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="220" id="S3.F3.g1" src="extracted/5846543/pics_jpg/supervision.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S3.F3.10"><span class="ltx_text ltx_inline-block" id="S3.F3.10.1" style="font-size:90%;width:104.1pt;">Input&amp;Mask</span>
<span class="ltx_text ltx_inline-block" id="S3.F3.10.2" style="font-size:90%;width:104.1pt;">MC Masks</span>
<span class="ltx_text ltx_inline-block" id="S3.F3.10.3" style="font-size:90%;width:104.1pt;">MC Pixels</span>
<span class="ltx_text ltx_inline-block" id="S3.F3.10.4" style="font-size:90%;width:104.1pt;">MC Patches</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F3.12.5.1" style="font-size:90%;">Figure 3</span>: </span><span class="ltx_text ltx_font_bold" id="S3.F3.8.4" style="font-size:90%;">Supervision for the adaptation.<span class="ltx_text ltx_font_medium" id="S3.F3.8.4.4"> Given the input image and the shadow mask, we first use the fine-tuned SAM to produce material-consistent (MC) masks. We sample pixels on both sides alongside the MC shadow edge, denoted as <math alttext="S_{in}" class="ltx_Math" display="inline" id="S3.F3.5.1.1.m1.1"><semantics id="S3.F3.5.1.1.m1.1b"><msub id="S3.F3.5.1.1.m1.1.1" xref="S3.F3.5.1.1.m1.1.1.cmml"><mi id="S3.F3.5.1.1.m1.1.1.2" xref="S3.F3.5.1.1.m1.1.1.2.cmml">S</mi><mrow id="S3.F3.5.1.1.m1.1.1.3" xref="S3.F3.5.1.1.m1.1.1.3.cmml"><mi id="S3.F3.5.1.1.m1.1.1.3.2" xref="S3.F3.5.1.1.m1.1.1.3.2.cmml">i</mi><mo id="S3.F3.5.1.1.m1.1.1.3.1" xref="S3.F3.5.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.5.1.1.m1.1.1.3.3" xref="S3.F3.5.1.1.m1.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.F3.5.1.1.m1.1c"><apply id="S3.F3.5.1.1.m1.1.1.cmml" xref="S3.F3.5.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.F3.5.1.1.m1.1.1.1.cmml" xref="S3.F3.5.1.1.m1.1.1">subscript</csymbol><ci id="S3.F3.5.1.1.m1.1.1.2.cmml" xref="S3.F3.5.1.1.m1.1.1.2">𝑆</ci><apply id="S3.F3.5.1.1.m1.1.1.3.cmml" xref="S3.F3.5.1.1.m1.1.1.3"><times id="S3.F3.5.1.1.m1.1.1.3.1.cmml" xref="S3.F3.5.1.1.m1.1.1.3.1"></times><ci id="S3.F3.5.1.1.m1.1.1.3.2.cmml" xref="S3.F3.5.1.1.m1.1.1.3.2">𝑖</ci><ci id="S3.F3.5.1.1.m1.1.1.3.3.cmml" xref="S3.F3.5.1.1.m1.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.5.1.1.m1.1d">S_{in}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.5.1.1.m1.1e">italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> (shown in red) and <math alttext="S_{out}" class="ltx_Math" display="inline" id="S3.F3.6.2.2.m2.1"><semantics id="S3.F3.6.2.2.m2.1b"><msub id="S3.F3.6.2.2.m2.1.1" xref="S3.F3.6.2.2.m2.1.1.cmml"><mi id="S3.F3.6.2.2.m2.1.1.2" xref="S3.F3.6.2.2.m2.1.1.2.cmml">S</mi><mrow id="S3.F3.6.2.2.m2.1.1.3" xref="S3.F3.6.2.2.m2.1.1.3.cmml"><mi id="S3.F3.6.2.2.m2.1.1.3.2" xref="S3.F3.6.2.2.m2.1.1.3.2.cmml">o</mi><mo id="S3.F3.6.2.2.m2.1.1.3.1" xref="S3.F3.6.2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.6.2.2.m2.1.1.3.3" xref="S3.F3.6.2.2.m2.1.1.3.3.cmml">u</mi><mo id="S3.F3.6.2.2.m2.1.1.3.1b" xref="S3.F3.6.2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.6.2.2.m2.1.1.3.4" xref="S3.F3.6.2.2.m2.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.F3.6.2.2.m2.1c"><apply id="S3.F3.6.2.2.m2.1.1.cmml" xref="S3.F3.6.2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.F3.6.2.2.m2.1.1.1.cmml" xref="S3.F3.6.2.2.m2.1.1">subscript</csymbol><ci id="S3.F3.6.2.2.m2.1.1.2.cmml" xref="S3.F3.6.2.2.m2.1.1.2">𝑆</ci><apply id="S3.F3.6.2.2.m2.1.1.3.cmml" xref="S3.F3.6.2.2.m2.1.1.3"><times id="S3.F3.6.2.2.m2.1.1.3.1.cmml" xref="S3.F3.6.2.2.m2.1.1.3.1"></times><ci id="S3.F3.6.2.2.m2.1.1.3.2.cmml" xref="S3.F3.6.2.2.m2.1.1.3.2">𝑜</ci><ci id="S3.F3.6.2.2.m2.1.1.3.3.cmml" xref="S3.F3.6.2.2.m2.1.1.3.3">𝑢</ci><ci id="S3.F3.6.2.2.m2.1.1.3.4.cmml" xref="S3.F3.6.2.2.m2.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.6.2.2.m2.1d">S_{out}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.6.2.2.m2.1e">italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> (shown in green), and patches within the same material, denoted as <math alttext="P_{in}" class="ltx_Math" display="inline" id="S3.F3.7.3.3.m3.1"><semantics id="S3.F3.7.3.3.m3.1b"><msub id="S3.F3.7.3.3.m3.1.1" xref="S3.F3.7.3.3.m3.1.1.cmml"><mi id="S3.F3.7.3.3.m3.1.1.2" xref="S3.F3.7.3.3.m3.1.1.2.cmml">P</mi><mrow id="S3.F3.7.3.3.m3.1.1.3" xref="S3.F3.7.3.3.m3.1.1.3.cmml"><mi id="S3.F3.7.3.3.m3.1.1.3.2" xref="S3.F3.7.3.3.m3.1.1.3.2.cmml">i</mi><mo id="S3.F3.7.3.3.m3.1.1.3.1" xref="S3.F3.7.3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.7.3.3.m3.1.1.3.3" xref="S3.F3.7.3.3.m3.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.F3.7.3.3.m3.1c"><apply id="S3.F3.7.3.3.m3.1.1.cmml" xref="S3.F3.7.3.3.m3.1.1"><csymbol cd="ambiguous" id="S3.F3.7.3.3.m3.1.1.1.cmml" xref="S3.F3.7.3.3.m3.1.1">subscript</csymbol><ci id="S3.F3.7.3.3.m3.1.1.2.cmml" xref="S3.F3.7.3.3.m3.1.1.2">𝑃</ci><apply id="S3.F3.7.3.3.m3.1.1.3.cmml" xref="S3.F3.7.3.3.m3.1.1.3"><times id="S3.F3.7.3.3.m3.1.1.3.1.cmml" xref="S3.F3.7.3.3.m3.1.1.3.1"></times><ci id="S3.F3.7.3.3.m3.1.1.3.2.cmml" xref="S3.F3.7.3.3.m3.1.1.3.2">𝑖</ci><ci id="S3.F3.7.3.3.m3.1.1.3.3.cmml" xref="S3.F3.7.3.3.m3.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.7.3.3.m3.1d">P_{in}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.7.3.3.m3.1e">italic_P start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> (shown in red) and <math alttext="P_{out}" class="ltx_Math" display="inline" id="S3.F3.8.4.4.m4.1"><semantics id="S3.F3.8.4.4.m4.1b"><msub id="S3.F3.8.4.4.m4.1.1" xref="S3.F3.8.4.4.m4.1.1.cmml"><mi id="S3.F3.8.4.4.m4.1.1.2" xref="S3.F3.8.4.4.m4.1.1.2.cmml">P</mi><mrow id="S3.F3.8.4.4.m4.1.1.3" xref="S3.F3.8.4.4.m4.1.1.3.cmml"><mi id="S3.F3.8.4.4.m4.1.1.3.2" xref="S3.F3.8.4.4.m4.1.1.3.2.cmml">o</mi><mo id="S3.F3.8.4.4.m4.1.1.3.1" xref="S3.F3.8.4.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.8.4.4.m4.1.1.3.3" xref="S3.F3.8.4.4.m4.1.1.3.3.cmml">u</mi><mo id="S3.F3.8.4.4.m4.1.1.3.1b" xref="S3.F3.8.4.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.F3.8.4.4.m4.1.1.3.4" xref="S3.F3.8.4.4.m4.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.F3.8.4.4.m4.1c"><apply id="S3.F3.8.4.4.m4.1.1.cmml" xref="S3.F3.8.4.4.m4.1.1"><csymbol cd="ambiguous" id="S3.F3.8.4.4.m4.1.1.1.cmml" xref="S3.F3.8.4.4.m4.1.1">subscript</csymbol><ci id="S3.F3.8.4.4.m4.1.1.2.cmml" xref="S3.F3.8.4.4.m4.1.1.2">𝑃</ci><apply id="S3.F3.8.4.4.m4.1.1.3.cmml" xref="S3.F3.8.4.4.m4.1.1.3"><times id="S3.F3.8.4.4.m4.1.1.3.1.cmml" xref="S3.F3.8.4.4.m4.1.1.3.1"></times><ci id="S3.F3.8.4.4.m4.1.1.3.2.cmml" xref="S3.F3.8.4.4.m4.1.1.3.2">𝑜</ci><ci id="S3.F3.8.4.4.m4.1.1.3.3.cmml" xref="S3.F3.8.4.4.m4.1.1.3.3">𝑢</ci><ci id="S3.F3.8.4.4.m4.1.1.3.4.cmml" xref="S3.F3.8.4.4.m4.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.8.4.4.m4.1d">P_{out}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.8.4.4.m4.1e">italic_P start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> (shown in green). Pixels and patches on both sides of the shadow edge provide supervision for the following adaptation process.</span></span></figcaption>
</figure>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.5">To ensure texture consistency between the shadow and non-shadow regions, we randomly sample <math alttext="16\times 16" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><mrow id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml"><mn id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">16</mn><mo id="S3.SS2.p3.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.p3.1.m1.1.1.1.cmml">×</mo><mn id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3.cmml">16</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"><times id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1.1"></times><cn id="S3.SS2.p3.1.m1.1.1.2.cmml" type="integer" xref="S3.SS2.p3.1.m1.1.1.2">16</cn><cn id="S3.SS2.p3.1.m1.1.1.3.cmml" type="integer" xref="S3.SS2.p3.1.m1.1.1.3">16</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">16\times 16</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">16 × 16</annotation></semantics></math> patches within the segmentation mask of the same material, denoted as <math alttext="P_{in}" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m2.1"><semantics id="S3.SS2.p3.2.m2.1a"><msub id="S3.SS2.p3.2.m2.1.1" xref="S3.SS2.p3.2.m2.1.1.cmml"><mi id="S3.SS2.p3.2.m2.1.1.2" xref="S3.SS2.p3.2.m2.1.1.2.cmml">P</mi><mrow id="S3.SS2.p3.2.m2.1.1.3" xref="S3.SS2.p3.2.m2.1.1.3.cmml"><mi id="S3.SS2.p3.2.m2.1.1.3.2" xref="S3.SS2.p3.2.m2.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p3.2.m2.1.1.3.1" xref="S3.SS2.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.2.m2.1.1.3.3" xref="S3.SS2.p3.2.m2.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m2.1b"><apply id="S3.SS2.p3.2.m2.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m2.1.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m2.1.1.2.cmml" xref="S3.SS2.p3.2.m2.1.1.2">𝑃</ci><apply id="S3.SS2.p3.2.m2.1.1.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3"><times id="S3.SS2.p3.2.m2.1.1.3.1.cmml" xref="S3.SS2.p3.2.m2.1.1.3.1"></times><ci id="S3.SS2.p3.2.m2.1.1.3.2.cmml" xref="S3.SS2.p3.2.m2.1.1.3.2">𝑖</ci><ci id="S3.SS2.p3.2.m2.1.1.3.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m2.1c">P_{in}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.2.m2.1d">italic_P start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="P_{out}" class="ltx_Math" display="inline" id="S3.SS2.p3.3.m3.1"><semantics id="S3.SS2.p3.3.m3.1a"><msub id="S3.SS2.p3.3.m3.1.1" xref="S3.SS2.p3.3.m3.1.1.cmml"><mi id="S3.SS2.p3.3.m3.1.1.2" xref="S3.SS2.p3.3.m3.1.1.2.cmml">P</mi><mrow id="S3.SS2.p3.3.m3.1.1.3" xref="S3.SS2.p3.3.m3.1.1.3.cmml"><mi id="S3.SS2.p3.3.m3.1.1.3.2" xref="S3.SS2.p3.3.m3.1.1.3.2.cmml">o</mi><mo id="S3.SS2.p3.3.m3.1.1.3.1" xref="S3.SS2.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.3.m3.1.1.3.3" xref="S3.SS2.p3.3.m3.1.1.3.3.cmml">u</mi><mo id="S3.SS2.p3.3.m3.1.1.3.1a" xref="S3.SS2.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.3.m3.1.1.3.4" xref="S3.SS2.p3.3.m3.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.3.m3.1b"><apply id="S3.SS2.p3.3.m3.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.3.m3.1.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p3.3.m3.1.1.2.cmml" xref="S3.SS2.p3.3.m3.1.1.2">𝑃</ci><apply id="S3.SS2.p3.3.m3.1.1.3.cmml" xref="S3.SS2.p3.3.m3.1.1.3"><times id="S3.SS2.p3.3.m3.1.1.3.1.cmml" xref="S3.SS2.p3.3.m3.1.1.3.1"></times><ci id="S3.SS2.p3.3.m3.1.1.3.2.cmml" xref="S3.SS2.p3.3.m3.1.1.3.2">𝑜</ci><ci id="S3.SS2.p3.3.m3.1.1.3.3.cmml" xref="S3.SS2.p3.3.m3.1.1.3.3">𝑢</ci><ci id="S3.SS2.p3.3.m3.1.1.3.4.cmml" xref="S3.SS2.p3.3.m3.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.3.m3.1c">P_{out}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.3.m3.1d">italic_P start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> (see <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F3" title="In 3.2 Test-time Adaptation ‣ 3 Method ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">3</span></a>).
<math alttext="P_{in}=\{p_{1},\dots,p_{i},\dots,p_{M}\},i\in[1,M]" class="ltx_Math" display="inline" id="S3.SS2.p3.4.m4.6"><semantics id="S3.SS2.p3.4.m4.6a"><mrow id="S3.SS2.p3.4.m4.6.6.2" xref="S3.SS2.p3.4.m4.6.6.3.cmml"><mrow id="S3.SS2.p3.4.m4.5.5.1.1" xref="S3.SS2.p3.4.m4.5.5.1.1.cmml"><msub id="S3.SS2.p3.4.m4.5.5.1.1.5" xref="S3.SS2.p3.4.m4.5.5.1.1.5.cmml"><mi id="S3.SS2.p3.4.m4.5.5.1.1.5.2" xref="S3.SS2.p3.4.m4.5.5.1.1.5.2.cmml">P</mi><mrow id="S3.SS2.p3.4.m4.5.5.1.1.5.3" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.cmml"><mi id="S3.SS2.p3.4.m4.5.5.1.1.5.3.2" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.2.cmml">i</mi><mo id="S3.SS2.p3.4.m4.5.5.1.1.5.3.1" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.4.m4.5.5.1.1.5.3.3" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.3.cmml">n</mi></mrow></msub><mo id="S3.SS2.p3.4.m4.5.5.1.1.4" xref="S3.SS2.p3.4.m4.5.5.1.1.4.cmml">=</mo><mrow id="S3.SS2.p3.4.m4.5.5.1.1.3.3" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml"><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.4" stretchy="false" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">{</mo><msub id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.cmml"><mi id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.2" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.2.cmml">p</mi><mn id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.3" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.5" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p3.4.m4.1.1" mathvariant="normal" xref="S3.SS2.p3.4.m4.1.1.cmml">…</mi><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.6" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.cmml"><mi id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.2" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.2.cmml">p</mi><mi id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.3" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.7" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p3.4.m4.2.2" mathvariant="normal" xref="S3.SS2.p3.4.m4.2.2.cmml">…</mi><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.8" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.cmml"><mi id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.2" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.2.cmml">p</mi><mi id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.3" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.3.cmml">M</mi></msub><mo id="S3.SS2.p3.4.m4.5.5.1.1.3.3.9" stretchy="false" xref="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S3.SS2.p3.4.m4.6.6.2.3" xref="S3.SS2.p3.4.m4.6.6.3a.cmml">,</mo><mrow id="S3.SS2.p3.4.m4.6.6.2.2" xref="S3.SS2.p3.4.m4.6.6.2.2.cmml"><mi id="S3.SS2.p3.4.m4.6.6.2.2.2" xref="S3.SS2.p3.4.m4.6.6.2.2.2.cmml">i</mi><mo id="S3.SS2.p3.4.m4.6.6.2.2.1" xref="S3.SS2.p3.4.m4.6.6.2.2.1.cmml">∈</mo><mrow id="S3.SS2.p3.4.m4.6.6.2.2.3.2" xref="S3.SS2.p3.4.m4.6.6.2.2.3.1.cmml"><mo id="S3.SS2.p3.4.m4.6.6.2.2.3.2.1" stretchy="false" xref="S3.SS2.p3.4.m4.6.6.2.2.3.1.cmml">[</mo><mn id="S3.SS2.p3.4.m4.3.3" xref="S3.SS2.p3.4.m4.3.3.cmml">1</mn><mo id="S3.SS2.p3.4.m4.6.6.2.2.3.2.2" xref="S3.SS2.p3.4.m4.6.6.2.2.3.1.cmml">,</mo><mi id="S3.SS2.p3.4.m4.4.4" xref="S3.SS2.p3.4.m4.4.4.cmml">M</mi><mo id="S3.SS2.p3.4.m4.6.6.2.2.3.2.3" stretchy="false" xref="S3.SS2.p3.4.m4.6.6.2.2.3.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.4.m4.6b"><apply id="S3.SS2.p3.4.m4.6.6.3.cmml" xref="S3.SS2.p3.4.m4.6.6.2"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.6.6.3a.cmml" xref="S3.SS2.p3.4.m4.6.6.2.3">formulae-sequence</csymbol><apply id="S3.SS2.p3.4.m4.5.5.1.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1"><eq id="S3.SS2.p3.4.m4.5.5.1.1.4.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.4"></eq><apply id="S3.SS2.p3.4.m4.5.5.1.1.5.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.5.5.1.1.5.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5">subscript</csymbol><ci id="S3.SS2.p3.4.m4.5.5.1.1.5.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5.2">𝑃</ci><apply id="S3.SS2.p3.4.m4.5.5.1.1.5.3.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3"><times id="S3.SS2.p3.4.m4.5.5.1.1.5.3.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.1"></times><ci id="S3.SS2.p3.4.m4.5.5.1.1.5.3.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.2">𝑖</ci><ci id="S3.SS2.p3.4.m4.5.5.1.1.5.3.3.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.5.3.3">𝑛</ci></apply></apply><set id="S3.SS2.p3.4.m4.5.5.1.1.3.4.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3"><apply id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.2">𝑝</ci><cn id="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.3.cmml" type="integer" xref="S3.SS2.p3.4.m4.5.5.1.1.1.1.1.3">1</cn></apply><ci id="S3.SS2.p3.4.m4.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1">…</ci><apply id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2">subscript</csymbol><ci id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.2">𝑝</ci><ci id="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.3.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.2.2.2.3">𝑖</ci></apply><ci id="S3.SS2.p3.4.m4.2.2.cmml" xref="S3.SS2.p3.4.m4.2.2">…</ci><apply id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.1.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3">subscript</csymbol><ci id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.2.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.2">𝑝</ci><ci id="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.3.cmml" xref="S3.SS2.p3.4.m4.5.5.1.1.3.3.3.3">𝑀</ci></apply></set></apply><apply id="S3.SS2.p3.4.m4.6.6.2.2.cmml" xref="S3.SS2.p3.4.m4.6.6.2.2"><in id="S3.SS2.p3.4.m4.6.6.2.2.1.cmml" xref="S3.SS2.p3.4.m4.6.6.2.2.1"></in><ci id="S3.SS2.p3.4.m4.6.6.2.2.2.cmml" xref="S3.SS2.p3.4.m4.6.6.2.2.2">𝑖</ci><interval closure="closed" id="S3.SS2.p3.4.m4.6.6.2.2.3.1.cmml" xref="S3.SS2.p3.4.m4.6.6.2.2.3.2"><cn id="S3.SS2.p3.4.m4.3.3.cmml" type="integer" xref="S3.SS2.p3.4.m4.3.3">1</cn><ci id="S3.SS2.p3.4.m4.4.4.cmml" xref="S3.SS2.p3.4.m4.4.4">𝑀</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.4.m4.6c">P_{in}=\{p_{1},\dots,p_{i},\dots,p_{M}\},i\in[1,M]</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.4.m4.6d">italic_P start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT = { italic_p start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , … , italic_p start_POSTSUBSCRIPT italic_M end_POSTSUBSCRIPT } , italic_i ∈ [ 1 , italic_M ]</annotation></semantics></math> represents patches in the shadow region, <math alttext="P_{out}=\{q_{1},\dots,q_{j},\dots,q_{N}\},j\in[1,N]" class="ltx_Math" display="inline" id="S3.SS2.p3.5.m5.6"><semantics id="S3.SS2.p3.5.m5.6a"><mrow id="S3.SS2.p3.5.m5.6.6.2" xref="S3.SS2.p3.5.m5.6.6.3.cmml"><mrow id="S3.SS2.p3.5.m5.5.5.1.1" xref="S3.SS2.p3.5.m5.5.5.1.1.cmml"><msub id="S3.SS2.p3.5.m5.5.5.1.1.5" xref="S3.SS2.p3.5.m5.5.5.1.1.5.cmml"><mi id="S3.SS2.p3.5.m5.5.5.1.1.5.2" xref="S3.SS2.p3.5.m5.5.5.1.1.5.2.cmml">P</mi><mrow id="S3.SS2.p3.5.m5.5.5.1.1.5.3" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.cmml"><mi id="S3.SS2.p3.5.m5.5.5.1.1.5.3.2" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.2.cmml">o</mi><mo id="S3.SS2.p3.5.m5.5.5.1.1.5.3.1" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.5.m5.5.5.1.1.5.3.3" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.3.cmml">u</mi><mo id="S3.SS2.p3.5.m5.5.5.1.1.5.3.1a" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.1.cmml">⁢</mo><mi id="S3.SS2.p3.5.m5.5.5.1.1.5.3.4" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.4.cmml">t</mi></mrow></msub><mo id="S3.SS2.p3.5.m5.5.5.1.1.4" xref="S3.SS2.p3.5.m5.5.5.1.1.4.cmml">=</mo><mrow id="S3.SS2.p3.5.m5.5.5.1.1.3.3" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml"><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.4" stretchy="false" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">{</mo><msub id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.cmml"><mi id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.2" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.2.cmml">q</mi><mn id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.3" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.5" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p3.5.m5.1.1" mathvariant="normal" xref="S3.SS2.p3.5.m5.1.1.cmml">…</mi><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.6" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.cmml"><mi id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.2" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.2.cmml">q</mi><mi id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.3" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.3.cmml">j</mi></msub><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.7" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">,</mo><mi id="S3.SS2.p3.5.m5.2.2" mathvariant="normal" xref="S3.SS2.p3.5.m5.2.2.cmml">…</mi><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.8" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">,</mo><msub id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.cmml"><mi id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.2" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.2.cmml">q</mi><mi id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.3" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.3.cmml">N</mi></msub><mo id="S3.SS2.p3.5.m5.5.5.1.1.3.3.9" stretchy="false" xref="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S3.SS2.p3.5.m5.6.6.2.3" xref="S3.SS2.p3.5.m5.6.6.3a.cmml">,</mo><mrow id="S3.SS2.p3.5.m5.6.6.2.2" xref="S3.SS2.p3.5.m5.6.6.2.2.cmml"><mi id="S3.SS2.p3.5.m5.6.6.2.2.2" xref="S3.SS2.p3.5.m5.6.6.2.2.2.cmml">j</mi><mo id="S3.SS2.p3.5.m5.6.6.2.2.1" xref="S3.SS2.p3.5.m5.6.6.2.2.1.cmml">∈</mo><mrow id="S3.SS2.p3.5.m5.6.6.2.2.3.2" xref="S3.SS2.p3.5.m5.6.6.2.2.3.1.cmml"><mo id="S3.SS2.p3.5.m5.6.6.2.2.3.2.1" stretchy="false" xref="S3.SS2.p3.5.m5.6.6.2.2.3.1.cmml">[</mo><mn id="S3.SS2.p3.5.m5.3.3" xref="S3.SS2.p3.5.m5.3.3.cmml">1</mn><mo id="S3.SS2.p3.5.m5.6.6.2.2.3.2.2" xref="S3.SS2.p3.5.m5.6.6.2.2.3.1.cmml">,</mo><mi id="S3.SS2.p3.5.m5.4.4" xref="S3.SS2.p3.5.m5.4.4.cmml">N</mi><mo id="S3.SS2.p3.5.m5.6.6.2.2.3.2.3" stretchy="false" xref="S3.SS2.p3.5.m5.6.6.2.2.3.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.5.m5.6b"><apply id="S3.SS2.p3.5.m5.6.6.3.cmml" xref="S3.SS2.p3.5.m5.6.6.2"><csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.6.6.3a.cmml" xref="S3.SS2.p3.5.m5.6.6.2.3">formulae-sequence</csymbol><apply id="S3.SS2.p3.5.m5.5.5.1.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1"><eq id="S3.SS2.p3.5.m5.5.5.1.1.4.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.4"></eq><apply id="S3.SS2.p3.5.m5.5.5.1.1.5.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5"><csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.5.5.1.1.5.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5">subscript</csymbol><ci id="S3.SS2.p3.5.m5.5.5.1.1.5.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.2">𝑃</ci><apply id="S3.SS2.p3.5.m5.5.5.1.1.5.3.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3"><times id="S3.SS2.p3.5.m5.5.5.1.1.5.3.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.1"></times><ci id="S3.SS2.p3.5.m5.5.5.1.1.5.3.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.2">𝑜</ci><ci id="S3.SS2.p3.5.m5.5.5.1.1.5.3.3.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.3">𝑢</ci><ci id="S3.SS2.p3.5.m5.5.5.1.1.5.3.4.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.5.3.4">𝑡</ci></apply></apply><set id="S3.SS2.p3.5.m5.5.5.1.1.3.4.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3"><apply id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.2">𝑞</ci><cn id="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.3.cmml" type="integer" xref="S3.SS2.p3.5.m5.5.5.1.1.1.1.1.3">1</cn></apply><ci id="S3.SS2.p3.5.m5.1.1.cmml" xref="S3.SS2.p3.5.m5.1.1">…</ci><apply id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2">subscript</csymbol><ci id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.2">𝑞</ci><ci id="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.3.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.2.2.2.3">𝑗</ci></apply><ci id="S3.SS2.p3.5.m5.2.2.cmml" xref="S3.SS2.p3.5.m5.2.2">…</ci><apply id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.1.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3">subscript</csymbol><ci id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.2.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.2">𝑞</ci><ci id="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.3.cmml" xref="S3.SS2.p3.5.m5.5.5.1.1.3.3.3.3">𝑁</ci></apply></set></apply><apply id="S3.SS2.p3.5.m5.6.6.2.2.cmml" xref="S3.SS2.p3.5.m5.6.6.2.2"><in id="S3.SS2.p3.5.m5.6.6.2.2.1.cmml" xref="S3.SS2.p3.5.m5.6.6.2.2.1"></in><ci id="S3.SS2.p3.5.m5.6.6.2.2.2.cmml" xref="S3.SS2.p3.5.m5.6.6.2.2.2">𝑗</ci><interval closure="closed" id="S3.SS2.p3.5.m5.6.6.2.2.3.1.cmml" xref="S3.SS2.p3.5.m5.6.6.2.2.3.2"><cn id="S3.SS2.p3.5.m5.3.3.cmml" type="integer" xref="S3.SS2.p3.5.m5.3.3">1</cn><ci id="S3.SS2.p3.5.m5.4.4.cmml" xref="S3.SS2.p3.5.m5.4.4">𝑁</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.5.m5.6c">P_{out}=\{q_{1},\dots,q_{j},\dots,q_{N}\},j\in[1,N]</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.5.m5.6d">italic_P start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT = { italic_q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_q start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , … , italic_q start_POSTSUBSCRIPT italic_N end_POSTSUBSCRIPT } , italic_j ∈ [ 1 , italic_N ]</annotation></semantics></math> represents patches in the non-shadow region.
Note that, to ensure the patches are within the material masks, we apply an erosion operation to the material mask before sampling.
We then compute the mean of the minimum of the Learned Perceptual Image Patch Similarity (LPIPS) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib46" title="">46</a>]</cite> loss between each patch in the shadow region and all patches in the non-shadow region. The loss is formulated as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="L_{per}=\frac{\sum_{i=1}^{M}\min_{j\in[1,N]}\textrm{LPIPS}(p_{i},q_{j})}{M}," class="ltx_Math" display="block" id="S3.E3.m1.5"><semantics id="S3.E3.m1.5a"><mrow id="S3.E3.m1.5.5.1" xref="S3.E3.m1.5.5.1.1.cmml"><mrow id="S3.E3.m1.5.5.1.1" xref="S3.E3.m1.5.5.1.1.cmml"><msub id="S3.E3.m1.5.5.1.1.2" xref="S3.E3.m1.5.5.1.1.2.cmml"><mi id="S3.E3.m1.5.5.1.1.2.2" xref="S3.E3.m1.5.5.1.1.2.2.cmml">L</mi><mrow id="S3.E3.m1.5.5.1.1.2.3" xref="S3.E3.m1.5.5.1.1.2.3.cmml"><mi id="S3.E3.m1.5.5.1.1.2.3.2" xref="S3.E3.m1.5.5.1.1.2.3.2.cmml">p</mi><mo id="S3.E3.m1.5.5.1.1.2.3.1" xref="S3.E3.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.5.5.1.1.2.3.3" xref="S3.E3.m1.5.5.1.1.2.3.3.cmml">e</mi><mo id="S3.E3.m1.5.5.1.1.2.3.1a" xref="S3.E3.m1.5.5.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.5.5.1.1.2.3.4" xref="S3.E3.m1.5.5.1.1.2.3.4.cmml">r</mi></mrow></msub><mo id="S3.E3.m1.5.5.1.1.1" xref="S3.E3.m1.5.5.1.1.1.cmml">=</mo><mfrac id="S3.E3.m1.4.4" xref="S3.E3.m1.4.4.cmml"><mrow id="S3.E3.m1.4.4.4" xref="S3.E3.m1.4.4.4.cmml"><msubsup id="S3.E3.m1.4.4.4.5" xref="S3.E3.m1.4.4.4.5.cmml"><mo id="S3.E3.m1.4.4.4.5.2.2" xref="S3.E3.m1.4.4.4.5.2.2.cmml">∑</mo><mrow id="S3.E3.m1.4.4.4.5.2.3" xref="S3.E3.m1.4.4.4.5.2.3.cmml"><mi id="S3.E3.m1.4.4.4.5.2.3.2" xref="S3.E3.m1.4.4.4.5.2.3.2.cmml">i</mi><mo id="S3.E3.m1.4.4.4.5.2.3.1" xref="S3.E3.m1.4.4.4.5.2.3.1.cmml">=</mo><mn id="S3.E3.m1.4.4.4.5.2.3.3" xref="S3.E3.m1.4.4.4.5.2.3.3.cmml">1</mn></mrow><mi id="S3.E3.m1.4.4.4.5.3" xref="S3.E3.m1.4.4.4.5.3.cmml">M</mi></msubsup><mrow id="S3.E3.m1.4.4.4.4" xref="S3.E3.m1.4.4.4.4.cmml"><mrow id="S3.E3.m1.4.4.4.4.4" xref="S3.E3.m1.4.4.4.4.4.cmml"><msub id="S3.E3.m1.4.4.4.4.4.1" xref="S3.E3.m1.4.4.4.4.4.1.cmml"><mi id="S3.E3.m1.4.4.4.4.4.1.2" xref="S3.E3.m1.4.4.4.4.4.1.2.cmml">min</mi><mrow id="S3.E3.m1.2.2.2.2.2" xref="S3.E3.m1.2.2.2.2.2.cmml"><mi id="S3.E3.m1.2.2.2.2.2.4" xref="S3.E3.m1.2.2.2.2.2.4.cmml">j</mi><mo id="S3.E3.m1.2.2.2.2.2.3" xref="S3.E3.m1.2.2.2.2.2.3.cmml">∈</mo><mrow id="S3.E3.m1.2.2.2.2.2.5.2" xref="S3.E3.m1.2.2.2.2.2.5.1.cmml"><mo id="S3.E3.m1.2.2.2.2.2.5.2.1" stretchy="false" xref="S3.E3.m1.2.2.2.2.2.5.1.cmml">[</mo><mn id="S3.E3.m1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.cmml">1</mn><mo id="S3.E3.m1.2.2.2.2.2.5.2.2" xref="S3.E3.m1.2.2.2.2.2.5.1.cmml">,</mo><mi id="S3.E3.m1.2.2.2.2.2.2" xref="S3.E3.m1.2.2.2.2.2.2.cmml">N</mi><mo id="S3.E3.m1.2.2.2.2.2.5.2.3" stretchy="false" xref="S3.E3.m1.2.2.2.2.2.5.1.cmml">]</mo></mrow></mrow></msub><mo id="S3.E3.m1.4.4.4.4.4a" lspace="0.167em" xref="S3.E3.m1.4.4.4.4.4.cmml">⁡</mo><mtext id="S3.E3.m1.4.4.4.4.4.2" xref="S3.E3.m1.4.4.4.4.4.2a.cmml">LPIPS</mtext></mrow><mo id="S3.E3.m1.4.4.4.4.3" xref="S3.E3.m1.4.4.4.4.3.cmml">⁢</mo><mrow id="S3.E3.m1.4.4.4.4.2.2" xref="S3.E3.m1.4.4.4.4.2.3.cmml"><mo id="S3.E3.m1.4.4.4.4.2.2.3" stretchy="false" xref="S3.E3.m1.4.4.4.4.2.3.cmml">(</mo><msub id="S3.E3.m1.3.3.3.3.1.1.1" xref="S3.E3.m1.3.3.3.3.1.1.1.cmml"><mi id="S3.E3.m1.3.3.3.3.1.1.1.2" xref="S3.E3.m1.3.3.3.3.1.1.1.2.cmml">p</mi><mi id="S3.E3.m1.3.3.3.3.1.1.1.3" xref="S3.E3.m1.3.3.3.3.1.1.1.3.cmml">i</mi></msub><mo id="S3.E3.m1.4.4.4.4.2.2.4" xref="S3.E3.m1.4.4.4.4.2.3.cmml">,</mo><msub id="S3.E3.m1.4.4.4.4.2.2.2" xref="S3.E3.m1.4.4.4.4.2.2.2.cmml"><mi id="S3.E3.m1.4.4.4.4.2.2.2.2" xref="S3.E3.m1.4.4.4.4.2.2.2.2.cmml">q</mi><mi id="S3.E3.m1.4.4.4.4.2.2.2.3" xref="S3.E3.m1.4.4.4.4.2.2.2.3.cmml">j</mi></msub><mo id="S3.E3.m1.4.4.4.4.2.2.5" stretchy="false" xref="S3.E3.m1.4.4.4.4.2.3.cmml">)</mo></mrow></mrow></mrow><mi id="S3.E3.m1.4.4.6" xref="S3.E3.m1.4.4.6.cmml">M</mi></mfrac></mrow><mo id="S3.E3.m1.5.5.1.2" xref="S3.E3.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.5b"><apply id="S3.E3.m1.5.5.1.1.cmml" xref="S3.E3.m1.5.5.1"><eq id="S3.E3.m1.5.5.1.1.1.cmml" xref="S3.E3.m1.5.5.1.1.1"></eq><apply id="S3.E3.m1.5.5.1.1.2.cmml" xref="S3.E3.m1.5.5.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.5.5.1.1.2.1.cmml" xref="S3.E3.m1.5.5.1.1.2">subscript</csymbol><ci id="S3.E3.m1.5.5.1.1.2.2.cmml" xref="S3.E3.m1.5.5.1.1.2.2">𝐿</ci><apply id="S3.E3.m1.5.5.1.1.2.3.cmml" xref="S3.E3.m1.5.5.1.1.2.3"><times id="S3.E3.m1.5.5.1.1.2.3.1.cmml" xref="S3.E3.m1.5.5.1.1.2.3.1"></times><ci id="S3.E3.m1.5.5.1.1.2.3.2.cmml" xref="S3.E3.m1.5.5.1.1.2.3.2">𝑝</ci><ci id="S3.E3.m1.5.5.1.1.2.3.3.cmml" xref="S3.E3.m1.5.5.1.1.2.3.3">𝑒</ci><ci id="S3.E3.m1.5.5.1.1.2.3.4.cmml" xref="S3.E3.m1.5.5.1.1.2.3.4">𝑟</ci></apply></apply><apply id="S3.E3.m1.4.4.cmml" xref="S3.E3.m1.4.4"><divide id="S3.E3.m1.4.4.5.cmml" xref="S3.E3.m1.4.4"></divide><apply id="S3.E3.m1.4.4.4.cmml" xref="S3.E3.m1.4.4.4"><apply id="S3.E3.m1.4.4.4.5.cmml" xref="S3.E3.m1.4.4.4.5"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.4.5.1.cmml" xref="S3.E3.m1.4.4.4.5">superscript</csymbol><apply id="S3.E3.m1.4.4.4.5.2.cmml" xref="S3.E3.m1.4.4.4.5"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.4.5.2.1.cmml" xref="S3.E3.m1.4.4.4.5">subscript</csymbol><sum id="S3.E3.m1.4.4.4.5.2.2.cmml" xref="S3.E3.m1.4.4.4.5.2.2"></sum><apply id="S3.E3.m1.4.4.4.5.2.3.cmml" xref="S3.E3.m1.4.4.4.5.2.3"><eq id="S3.E3.m1.4.4.4.5.2.3.1.cmml" xref="S3.E3.m1.4.4.4.5.2.3.1"></eq><ci id="S3.E3.m1.4.4.4.5.2.3.2.cmml" xref="S3.E3.m1.4.4.4.5.2.3.2">𝑖</ci><cn id="S3.E3.m1.4.4.4.5.2.3.3.cmml" type="integer" xref="S3.E3.m1.4.4.4.5.2.3.3">1</cn></apply></apply><ci id="S3.E3.m1.4.4.4.5.3.cmml" xref="S3.E3.m1.4.4.4.5.3">𝑀</ci></apply><apply id="S3.E3.m1.4.4.4.4.cmml" xref="S3.E3.m1.4.4.4.4"><times id="S3.E3.m1.4.4.4.4.3.cmml" xref="S3.E3.m1.4.4.4.4.3"></times><apply id="S3.E3.m1.4.4.4.4.4.cmml" xref="S3.E3.m1.4.4.4.4.4"><apply id="S3.E3.m1.4.4.4.4.4.1.cmml" xref="S3.E3.m1.4.4.4.4.4.1"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.4.4.4.1.1.cmml" xref="S3.E3.m1.4.4.4.4.4.1">subscript</csymbol><min id="S3.E3.m1.4.4.4.4.4.1.2.cmml" xref="S3.E3.m1.4.4.4.4.4.1.2"></min><apply id="S3.E3.m1.2.2.2.2.2.cmml" xref="S3.E3.m1.2.2.2.2.2"><in id="S3.E3.m1.2.2.2.2.2.3.cmml" xref="S3.E3.m1.2.2.2.2.2.3"></in><ci id="S3.E3.m1.2.2.2.2.2.4.cmml" xref="S3.E3.m1.2.2.2.2.2.4">𝑗</ci><interval closure="closed" id="S3.E3.m1.2.2.2.2.2.5.1.cmml" xref="S3.E3.m1.2.2.2.2.2.5.2"><cn id="S3.E3.m1.1.1.1.1.1.1.cmml" type="integer" xref="S3.E3.m1.1.1.1.1.1.1">1</cn><ci id="S3.E3.m1.2.2.2.2.2.2.cmml" xref="S3.E3.m1.2.2.2.2.2.2">𝑁</ci></interval></apply></apply><ci id="S3.E3.m1.4.4.4.4.4.2a.cmml" xref="S3.E3.m1.4.4.4.4.4.2"><mtext id="S3.E3.m1.4.4.4.4.4.2.cmml" xref="S3.E3.m1.4.4.4.4.4.2">LPIPS</mtext></ci></apply><interval closure="open" id="S3.E3.m1.4.4.4.4.2.3.cmml" xref="S3.E3.m1.4.4.4.4.2.2"><apply id="S3.E3.m1.3.3.3.3.1.1.1.cmml" xref="S3.E3.m1.3.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.3.3.1.1.1.1.cmml" xref="S3.E3.m1.3.3.3.3.1.1.1">subscript</csymbol><ci id="S3.E3.m1.3.3.3.3.1.1.1.2.cmml" xref="S3.E3.m1.3.3.3.3.1.1.1.2">𝑝</ci><ci id="S3.E3.m1.3.3.3.3.1.1.1.3.cmml" xref="S3.E3.m1.3.3.3.3.1.1.1.3">𝑖</ci></apply><apply id="S3.E3.m1.4.4.4.4.2.2.2.cmml" xref="S3.E3.m1.4.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.4.4.2.2.2.1.cmml" xref="S3.E3.m1.4.4.4.4.2.2.2">subscript</csymbol><ci id="S3.E3.m1.4.4.4.4.2.2.2.2.cmml" xref="S3.E3.m1.4.4.4.4.2.2.2.2">𝑞</ci><ci id="S3.E3.m1.4.4.4.4.2.2.2.3.cmml" xref="S3.E3.m1.4.4.4.4.2.2.2.3">𝑗</ci></apply></interval></apply></apply><ci id="S3.E3.m1.4.4.6.cmml" xref="S3.E3.m1.4.4.6">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.5c">L_{per}=\frac{\sum_{i=1}^{M}\min_{j\in[1,N]}\textrm{LPIPS}(p_{i},q_{j})}{M},</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.5d">italic_L start_POSTSUBSCRIPT italic_p italic_e italic_r end_POSTSUBSCRIPT = divide start_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_M end_POSTSUPERSCRIPT roman_min start_POSTSUBSCRIPT italic_j ∈ [ 1 , italic_N ] end_POSTSUBSCRIPT LPIPS ( italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) end_ARG start_ARG italic_M end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.2">We compute the average across all material masks for <math alttext="L_{distance},L_{distribution}" class="ltx_Math" display="inline" id="S3.SS2.p4.1.m1.2"><semantics id="S3.SS2.p4.1.m1.2a"><mrow id="S3.SS2.p4.1.m1.2.2.2" xref="S3.SS2.p4.1.m1.2.2.3.cmml"><msub id="S3.SS2.p4.1.m1.1.1.1.1" xref="S3.SS2.p4.1.m1.1.1.1.1.cmml"><mi id="S3.SS2.p4.1.m1.1.1.1.1.2" xref="S3.SS2.p4.1.m1.1.1.1.1.2.cmml">L</mi><mrow id="S3.SS2.p4.1.m1.1.1.1.1.3" xref="S3.SS2.p4.1.m1.1.1.1.1.3.cmml"><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.2" xref="S3.SS2.p4.1.m1.1.1.1.1.3.2.cmml">d</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.3" xref="S3.SS2.p4.1.m1.1.1.1.1.3.3.cmml">i</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1a" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.4" xref="S3.SS2.p4.1.m1.1.1.1.1.3.4.cmml">s</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1b" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.5" xref="S3.SS2.p4.1.m1.1.1.1.1.3.5.cmml">t</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1c" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.6" xref="S3.SS2.p4.1.m1.1.1.1.1.3.6.cmml">a</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1d" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.7" xref="S3.SS2.p4.1.m1.1.1.1.1.3.7.cmml">n</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1e" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.8" xref="S3.SS2.p4.1.m1.1.1.1.1.3.8.cmml">c</mi><mo id="S3.SS2.p4.1.m1.1.1.1.1.3.1f" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.1.1.1.1.3.9" xref="S3.SS2.p4.1.m1.1.1.1.1.3.9.cmml">e</mi></mrow></msub><mo id="S3.SS2.p4.1.m1.2.2.2.3" xref="S3.SS2.p4.1.m1.2.2.3.cmml">,</mo><msub id="S3.SS2.p4.1.m1.2.2.2.2" xref="S3.SS2.p4.1.m1.2.2.2.2.cmml"><mi id="S3.SS2.p4.1.m1.2.2.2.2.2" xref="S3.SS2.p4.1.m1.2.2.2.2.2.cmml">L</mi><mrow id="S3.SS2.p4.1.m1.2.2.2.2.3" xref="S3.SS2.p4.1.m1.2.2.2.2.3.cmml"><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.2" xref="S3.SS2.p4.1.m1.2.2.2.2.3.2.cmml">d</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.3" xref="S3.SS2.p4.1.m1.2.2.2.2.3.3.cmml">i</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1a" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.4" xref="S3.SS2.p4.1.m1.2.2.2.2.3.4.cmml">s</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1b" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.5" xref="S3.SS2.p4.1.m1.2.2.2.2.3.5.cmml">t</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1c" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.6" xref="S3.SS2.p4.1.m1.2.2.2.2.3.6.cmml">r</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1d" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.7" xref="S3.SS2.p4.1.m1.2.2.2.2.3.7.cmml">i</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1e" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.8" xref="S3.SS2.p4.1.m1.2.2.2.2.3.8.cmml">b</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1f" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.9" xref="S3.SS2.p4.1.m1.2.2.2.2.3.9.cmml">u</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1g" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.10" xref="S3.SS2.p4.1.m1.2.2.2.2.3.10.cmml">t</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1h" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.11" xref="S3.SS2.p4.1.m1.2.2.2.2.3.11.cmml">i</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1i" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.12" xref="S3.SS2.p4.1.m1.2.2.2.2.3.12.cmml">o</mi><mo id="S3.SS2.p4.1.m1.2.2.2.2.3.1j" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.1.m1.2.2.2.2.3.13" xref="S3.SS2.p4.1.m1.2.2.2.2.3.13.cmml">n</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.1.m1.2b"><list id="S3.SS2.p4.1.m1.2.2.3.cmml" xref="S3.SS2.p4.1.m1.2.2.2"><apply id="S3.SS2.p4.1.m1.1.1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.1.m1.1.1.1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p4.1.m1.1.1.1.1.2.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.2">𝐿</ci><apply id="S3.SS2.p4.1.m1.1.1.1.1.3.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3"><times id="S3.SS2.p4.1.m1.1.1.1.1.3.1.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.1"></times><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.2.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.2">𝑑</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.3.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.3">𝑖</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.4.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.4">𝑠</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.5.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.5">𝑡</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.6.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.6">𝑎</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.7.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.7">𝑛</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.8.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.8">𝑐</ci><ci id="S3.SS2.p4.1.m1.1.1.1.1.3.9.cmml" xref="S3.SS2.p4.1.m1.1.1.1.1.3.9">𝑒</ci></apply></apply><apply id="S3.SS2.p4.1.m1.2.2.2.2.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p4.1.m1.2.2.2.2.1.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2">subscript</csymbol><ci id="S3.SS2.p4.1.m1.2.2.2.2.2.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.2">𝐿</ci><apply id="S3.SS2.p4.1.m1.2.2.2.2.3.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3"><times id="S3.SS2.p4.1.m1.2.2.2.2.3.1.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.1"></times><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.2.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.2">𝑑</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.3.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.3">𝑖</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.4.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.4">𝑠</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.5.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.5">𝑡</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.6.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.6">𝑟</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.7.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.7">𝑖</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.8.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.8">𝑏</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.9.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.9">𝑢</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.10.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.10">𝑡</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.11.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.11">𝑖</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.12.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.12">𝑜</ci><ci id="S3.SS2.p4.1.m1.2.2.2.2.3.13.cmml" xref="S3.SS2.p4.1.m1.2.2.2.2.3.13">𝑛</ci></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.1.m1.2c">L_{distance},L_{distribution}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.1.m1.2d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e end_POSTSUBSCRIPT , italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_r italic_i italic_b italic_u italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="L_{per}" class="ltx_Math" display="inline" id="S3.SS2.p4.2.m2.1"><semantics id="S3.SS2.p4.2.m2.1a"><msub id="S3.SS2.p4.2.m2.1.1" xref="S3.SS2.p4.2.m2.1.1.cmml"><mi id="S3.SS2.p4.2.m2.1.1.2" xref="S3.SS2.p4.2.m2.1.1.2.cmml">L</mi><mrow id="S3.SS2.p4.2.m2.1.1.3" xref="S3.SS2.p4.2.m2.1.1.3.cmml"><mi id="S3.SS2.p4.2.m2.1.1.3.2" xref="S3.SS2.p4.2.m2.1.1.3.2.cmml">p</mi><mo id="S3.SS2.p4.2.m2.1.1.3.1" xref="S3.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.3.3" xref="S3.SS2.p4.2.m2.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p4.2.m2.1.1.3.1a" xref="S3.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.3.4" xref="S3.SS2.p4.2.m2.1.1.3.4.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.2.m2.1b"><apply id="S3.SS2.p4.2.m2.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p4.2.m2.1.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p4.2.m2.1.1.2.cmml" xref="S3.SS2.p4.2.m2.1.1.2">𝐿</ci><apply id="S3.SS2.p4.2.m2.1.1.3.cmml" xref="S3.SS2.p4.2.m2.1.1.3"><times id="S3.SS2.p4.2.m2.1.1.3.1.cmml" xref="S3.SS2.p4.2.m2.1.1.3.1"></times><ci id="S3.SS2.p4.2.m2.1.1.3.2.cmml" xref="S3.SS2.p4.2.m2.1.1.3.2">𝑝</ci><ci id="S3.SS2.p4.2.m2.1.1.3.3.cmml" xref="S3.SS2.p4.2.m2.1.1.3.3">𝑒</ci><ci id="S3.SS2.p4.2.m2.1.1.3.4.cmml" xref="S3.SS2.p4.2.m2.1.1.3.4">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.2.m2.1c">L_{per}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_p italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math>.
Finally, the pre-trained shadow removal model is updated iteratively to adapt to each testing case, using the weighted sum of all four losses:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="L_{total}=\lambda_{1}\cdot L_{distance}+\lambda_{2}\cdot L_{distribution}+%
\lambda_{3}\cdot L_{per}" class="ltx_Math" display="block" id="S3.E4.m1.1"><semantics id="S3.E4.m1.1a"><mrow id="S3.E4.m1.1.1" xref="S3.E4.m1.1.1.cmml"><msub id="S3.E4.m1.1.1.2" xref="S3.E4.m1.1.1.2.cmml"><mi id="S3.E4.m1.1.1.2.2" xref="S3.E4.m1.1.1.2.2.cmml">L</mi><mrow id="S3.E4.m1.1.1.2.3" xref="S3.E4.m1.1.1.2.3.cmml"><mi id="S3.E4.m1.1.1.2.3.2" xref="S3.E4.m1.1.1.2.3.2.cmml">t</mi><mo id="S3.E4.m1.1.1.2.3.1" xref="S3.E4.m1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.2.3.3" xref="S3.E4.m1.1.1.2.3.3.cmml">o</mi><mo id="S3.E4.m1.1.1.2.3.1a" xref="S3.E4.m1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.2.3.4" xref="S3.E4.m1.1.1.2.3.4.cmml">t</mi><mo id="S3.E4.m1.1.1.2.3.1b" xref="S3.E4.m1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.2.3.5" xref="S3.E4.m1.1.1.2.3.5.cmml">a</mi><mo id="S3.E4.m1.1.1.2.3.1c" xref="S3.E4.m1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.2.3.6" xref="S3.E4.m1.1.1.2.3.6.cmml">l</mi></mrow></msub><mo id="S3.E4.m1.1.1.1" xref="S3.E4.m1.1.1.1.cmml">=</mo><mrow id="S3.E4.m1.1.1.3" xref="S3.E4.m1.1.1.3.cmml"><mrow id="S3.E4.m1.1.1.3.2" xref="S3.E4.m1.1.1.3.2.cmml"><msub id="S3.E4.m1.1.1.3.2.2" xref="S3.E4.m1.1.1.3.2.2.cmml"><mi id="S3.E4.m1.1.1.3.2.2.2" xref="S3.E4.m1.1.1.3.2.2.2.cmml">λ</mi><mn id="S3.E4.m1.1.1.3.2.2.3" xref="S3.E4.m1.1.1.3.2.2.3.cmml">1</mn></msub><mo id="S3.E4.m1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E4.m1.1.1.3.2.1.cmml">⋅</mo><msub id="S3.E4.m1.1.1.3.2.3" xref="S3.E4.m1.1.1.3.2.3.cmml"><mi id="S3.E4.m1.1.1.3.2.3.2" xref="S3.E4.m1.1.1.3.2.3.2.cmml">L</mi><mrow id="S3.E4.m1.1.1.3.2.3.3" xref="S3.E4.m1.1.1.3.2.3.3.cmml"><mi id="S3.E4.m1.1.1.3.2.3.3.2" xref="S3.E4.m1.1.1.3.2.3.3.2.cmml">d</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.3" xref="S3.E4.m1.1.1.3.2.3.3.3.cmml">i</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1a" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.4" xref="S3.E4.m1.1.1.3.2.3.3.4.cmml">s</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1b" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.5" xref="S3.E4.m1.1.1.3.2.3.3.5.cmml">t</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1c" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.6" xref="S3.E4.m1.1.1.3.2.3.3.6.cmml">a</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1d" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.7" xref="S3.E4.m1.1.1.3.2.3.3.7.cmml">n</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1e" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.8" xref="S3.E4.m1.1.1.3.2.3.3.8.cmml">c</mi><mo id="S3.E4.m1.1.1.3.2.3.3.1f" xref="S3.E4.m1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.2.3.3.9" xref="S3.E4.m1.1.1.3.2.3.3.9.cmml">e</mi></mrow></msub></mrow><mo id="S3.E4.m1.1.1.3.1" xref="S3.E4.m1.1.1.3.1.cmml">+</mo><mrow id="S3.E4.m1.1.1.3.3" xref="S3.E4.m1.1.1.3.3.cmml"><msub id="S3.E4.m1.1.1.3.3.2" xref="S3.E4.m1.1.1.3.3.2.cmml"><mi id="S3.E4.m1.1.1.3.3.2.2" xref="S3.E4.m1.1.1.3.3.2.2.cmml">λ</mi><mn id="S3.E4.m1.1.1.3.3.2.3" xref="S3.E4.m1.1.1.3.3.2.3.cmml">2</mn></msub><mo id="S3.E4.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E4.m1.1.1.3.3.1.cmml">⋅</mo><msub id="S3.E4.m1.1.1.3.3.3" xref="S3.E4.m1.1.1.3.3.3.cmml"><mi id="S3.E4.m1.1.1.3.3.3.2" xref="S3.E4.m1.1.1.3.3.3.2.cmml">L</mi><mrow id="S3.E4.m1.1.1.3.3.3.3" xref="S3.E4.m1.1.1.3.3.3.3.cmml"><mi id="S3.E4.m1.1.1.3.3.3.3.2" xref="S3.E4.m1.1.1.3.3.3.3.2.cmml">d</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.3" xref="S3.E4.m1.1.1.3.3.3.3.3.cmml">i</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1a" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.4" xref="S3.E4.m1.1.1.3.3.3.3.4.cmml">s</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1b" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.5" xref="S3.E4.m1.1.1.3.3.3.3.5.cmml">t</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1c" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.6" xref="S3.E4.m1.1.1.3.3.3.3.6.cmml">r</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1d" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.7" xref="S3.E4.m1.1.1.3.3.3.3.7.cmml">i</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1e" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.8" xref="S3.E4.m1.1.1.3.3.3.3.8.cmml">b</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1f" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.9" xref="S3.E4.m1.1.1.3.3.3.3.9.cmml">u</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1g" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.10" xref="S3.E4.m1.1.1.3.3.3.3.10.cmml">t</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1h" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.11" xref="S3.E4.m1.1.1.3.3.3.3.11.cmml">i</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1i" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.12" xref="S3.E4.m1.1.1.3.3.3.3.12.cmml">o</mi><mo id="S3.E4.m1.1.1.3.3.3.3.1j" xref="S3.E4.m1.1.1.3.3.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.3.3.3.13" xref="S3.E4.m1.1.1.3.3.3.3.13.cmml">n</mi></mrow></msub></mrow><mo id="S3.E4.m1.1.1.3.1a" xref="S3.E4.m1.1.1.3.1.cmml">+</mo><mrow id="S3.E4.m1.1.1.3.4" xref="S3.E4.m1.1.1.3.4.cmml"><msub id="S3.E4.m1.1.1.3.4.2" xref="S3.E4.m1.1.1.3.4.2.cmml"><mi id="S3.E4.m1.1.1.3.4.2.2" xref="S3.E4.m1.1.1.3.4.2.2.cmml">λ</mi><mn id="S3.E4.m1.1.1.3.4.2.3" xref="S3.E4.m1.1.1.3.4.2.3.cmml">3</mn></msub><mo id="S3.E4.m1.1.1.3.4.1" lspace="0.222em" rspace="0.222em" xref="S3.E4.m1.1.1.3.4.1.cmml">⋅</mo><msub id="S3.E4.m1.1.1.3.4.3" xref="S3.E4.m1.1.1.3.4.3.cmml"><mi id="S3.E4.m1.1.1.3.4.3.2" xref="S3.E4.m1.1.1.3.4.3.2.cmml">L</mi><mrow id="S3.E4.m1.1.1.3.4.3.3" xref="S3.E4.m1.1.1.3.4.3.3.cmml"><mi id="S3.E4.m1.1.1.3.4.3.3.2" xref="S3.E4.m1.1.1.3.4.3.3.2.cmml">p</mi><mo id="S3.E4.m1.1.1.3.4.3.3.1" xref="S3.E4.m1.1.1.3.4.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.4.3.3.3" xref="S3.E4.m1.1.1.3.4.3.3.3.cmml">e</mi><mo id="S3.E4.m1.1.1.3.4.3.3.1a" xref="S3.E4.m1.1.1.3.4.3.3.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.3.4.3.3.4" xref="S3.E4.m1.1.1.3.4.3.3.4.cmml">r</mi></mrow></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.1b"><apply id="S3.E4.m1.1.1.cmml" xref="S3.E4.m1.1.1"><eq id="S3.E4.m1.1.1.1.cmml" xref="S3.E4.m1.1.1.1"></eq><apply id="S3.E4.m1.1.1.2.cmml" xref="S3.E4.m1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.2.1.cmml" xref="S3.E4.m1.1.1.2">subscript</csymbol><ci id="S3.E4.m1.1.1.2.2.cmml" xref="S3.E4.m1.1.1.2.2">𝐿</ci><apply id="S3.E4.m1.1.1.2.3.cmml" xref="S3.E4.m1.1.1.2.3"><times id="S3.E4.m1.1.1.2.3.1.cmml" xref="S3.E4.m1.1.1.2.3.1"></times><ci id="S3.E4.m1.1.1.2.3.2.cmml" xref="S3.E4.m1.1.1.2.3.2">𝑡</ci><ci id="S3.E4.m1.1.1.2.3.3.cmml" xref="S3.E4.m1.1.1.2.3.3">𝑜</ci><ci id="S3.E4.m1.1.1.2.3.4.cmml" xref="S3.E4.m1.1.1.2.3.4">𝑡</ci><ci id="S3.E4.m1.1.1.2.3.5.cmml" xref="S3.E4.m1.1.1.2.3.5">𝑎</ci><ci id="S3.E4.m1.1.1.2.3.6.cmml" xref="S3.E4.m1.1.1.2.3.6">𝑙</ci></apply></apply><apply id="S3.E4.m1.1.1.3.cmml" xref="S3.E4.m1.1.1.3"><plus id="S3.E4.m1.1.1.3.1.cmml" xref="S3.E4.m1.1.1.3.1"></plus><apply id="S3.E4.m1.1.1.3.2.cmml" xref="S3.E4.m1.1.1.3.2"><ci id="S3.E4.m1.1.1.3.2.1.cmml" xref="S3.E4.m1.1.1.3.2.1">⋅</ci><apply id="S3.E4.m1.1.1.3.2.2.cmml" xref="S3.E4.m1.1.1.3.2.2"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.2.2.1.cmml" xref="S3.E4.m1.1.1.3.2.2">subscript</csymbol><ci id="S3.E4.m1.1.1.3.2.2.2.cmml" xref="S3.E4.m1.1.1.3.2.2.2">𝜆</ci><cn id="S3.E4.m1.1.1.3.2.2.3.cmml" type="integer" xref="S3.E4.m1.1.1.3.2.2.3">1</cn></apply><apply id="S3.E4.m1.1.1.3.2.3.cmml" xref="S3.E4.m1.1.1.3.2.3"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.2.3.1.cmml" xref="S3.E4.m1.1.1.3.2.3">subscript</csymbol><ci id="S3.E4.m1.1.1.3.2.3.2.cmml" xref="S3.E4.m1.1.1.3.2.3.2">𝐿</ci><apply id="S3.E4.m1.1.1.3.2.3.3.cmml" xref="S3.E4.m1.1.1.3.2.3.3"><times id="S3.E4.m1.1.1.3.2.3.3.1.cmml" xref="S3.E4.m1.1.1.3.2.3.3.1"></times><ci id="S3.E4.m1.1.1.3.2.3.3.2.cmml" xref="S3.E4.m1.1.1.3.2.3.3.2">𝑑</ci><ci id="S3.E4.m1.1.1.3.2.3.3.3.cmml" xref="S3.E4.m1.1.1.3.2.3.3.3">𝑖</ci><ci id="S3.E4.m1.1.1.3.2.3.3.4.cmml" xref="S3.E4.m1.1.1.3.2.3.3.4">𝑠</ci><ci id="S3.E4.m1.1.1.3.2.3.3.5.cmml" xref="S3.E4.m1.1.1.3.2.3.3.5">𝑡</ci><ci id="S3.E4.m1.1.1.3.2.3.3.6.cmml" xref="S3.E4.m1.1.1.3.2.3.3.6">𝑎</ci><ci id="S3.E4.m1.1.1.3.2.3.3.7.cmml" xref="S3.E4.m1.1.1.3.2.3.3.7">𝑛</ci><ci id="S3.E4.m1.1.1.3.2.3.3.8.cmml" xref="S3.E4.m1.1.1.3.2.3.3.8">𝑐</ci><ci id="S3.E4.m1.1.1.3.2.3.3.9.cmml" xref="S3.E4.m1.1.1.3.2.3.3.9">𝑒</ci></apply></apply></apply><apply id="S3.E4.m1.1.1.3.3.cmml" xref="S3.E4.m1.1.1.3.3"><ci id="S3.E4.m1.1.1.3.3.1.cmml" xref="S3.E4.m1.1.1.3.3.1">⋅</ci><apply id="S3.E4.m1.1.1.3.3.2.cmml" xref="S3.E4.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.3.2.1.cmml" xref="S3.E4.m1.1.1.3.3.2">subscript</csymbol><ci id="S3.E4.m1.1.1.3.3.2.2.cmml" xref="S3.E4.m1.1.1.3.3.2.2">𝜆</ci><cn id="S3.E4.m1.1.1.3.3.2.3.cmml" type="integer" xref="S3.E4.m1.1.1.3.3.2.3">2</cn></apply><apply id="S3.E4.m1.1.1.3.3.3.cmml" xref="S3.E4.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.3.3.1.cmml" xref="S3.E4.m1.1.1.3.3.3">subscript</csymbol><ci id="S3.E4.m1.1.1.3.3.3.2.cmml" xref="S3.E4.m1.1.1.3.3.3.2">𝐿</ci><apply id="S3.E4.m1.1.1.3.3.3.3.cmml" xref="S3.E4.m1.1.1.3.3.3.3"><times id="S3.E4.m1.1.1.3.3.3.3.1.cmml" xref="S3.E4.m1.1.1.3.3.3.3.1"></times><ci id="S3.E4.m1.1.1.3.3.3.3.2.cmml" xref="S3.E4.m1.1.1.3.3.3.3.2">𝑑</ci><ci id="S3.E4.m1.1.1.3.3.3.3.3.cmml" xref="S3.E4.m1.1.1.3.3.3.3.3">𝑖</ci><ci id="S3.E4.m1.1.1.3.3.3.3.4.cmml" xref="S3.E4.m1.1.1.3.3.3.3.4">𝑠</ci><ci id="S3.E4.m1.1.1.3.3.3.3.5.cmml" xref="S3.E4.m1.1.1.3.3.3.3.5">𝑡</ci><ci id="S3.E4.m1.1.1.3.3.3.3.6.cmml" xref="S3.E4.m1.1.1.3.3.3.3.6">𝑟</ci><ci id="S3.E4.m1.1.1.3.3.3.3.7.cmml" xref="S3.E4.m1.1.1.3.3.3.3.7">𝑖</ci><ci id="S3.E4.m1.1.1.3.3.3.3.8.cmml" xref="S3.E4.m1.1.1.3.3.3.3.8">𝑏</ci><ci id="S3.E4.m1.1.1.3.3.3.3.9.cmml" xref="S3.E4.m1.1.1.3.3.3.3.9">𝑢</ci><ci id="S3.E4.m1.1.1.3.3.3.3.10.cmml" xref="S3.E4.m1.1.1.3.3.3.3.10">𝑡</ci><ci id="S3.E4.m1.1.1.3.3.3.3.11.cmml" xref="S3.E4.m1.1.1.3.3.3.3.11">𝑖</ci><ci id="S3.E4.m1.1.1.3.3.3.3.12.cmml" xref="S3.E4.m1.1.1.3.3.3.3.12">𝑜</ci><ci id="S3.E4.m1.1.1.3.3.3.3.13.cmml" xref="S3.E4.m1.1.1.3.3.3.3.13">𝑛</ci></apply></apply></apply><apply id="S3.E4.m1.1.1.3.4.cmml" xref="S3.E4.m1.1.1.3.4"><ci id="S3.E4.m1.1.1.3.4.1.cmml" xref="S3.E4.m1.1.1.3.4.1">⋅</ci><apply id="S3.E4.m1.1.1.3.4.2.cmml" xref="S3.E4.m1.1.1.3.4.2"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.4.2.1.cmml" xref="S3.E4.m1.1.1.3.4.2">subscript</csymbol><ci id="S3.E4.m1.1.1.3.4.2.2.cmml" xref="S3.E4.m1.1.1.3.4.2.2">𝜆</ci><cn id="S3.E4.m1.1.1.3.4.2.3.cmml" type="integer" xref="S3.E4.m1.1.1.3.4.2.3">3</cn></apply><apply id="S3.E4.m1.1.1.3.4.3.cmml" xref="S3.E4.m1.1.1.3.4.3"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.3.4.3.1.cmml" xref="S3.E4.m1.1.1.3.4.3">subscript</csymbol><ci id="S3.E4.m1.1.1.3.4.3.2.cmml" xref="S3.E4.m1.1.1.3.4.3.2">𝐿</ci><apply id="S3.E4.m1.1.1.3.4.3.3.cmml" xref="S3.E4.m1.1.1.3.4.3.3"><times id="S3.E4.m1.1.1.3.4.3.3.1.cmml" xref="S3.E4.m1.1.1.3.4.3.3.1"></times><ci id="S3.E4.m1.1.1.3.4.3.3.2.cmml" xref="S3.E4.m1.1.1.3.4.3.3.2">𝑝</ci><ci id="S3.E4.m1.1.1.3.4.3.3.3.cmml" xref="S3.E4.m1.1.1.3.4.3.3.3">𝑒</ci><ci id="S3.E4.m1.1.1.3.4.3.3.4.cmml" xref="S3.E4.m1.1.1.3.4.3.3.4">𝑟</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.1c">L_{total}=\lambda_{1}\cdot L_{distance}+\lambda_{2}\cdot L_{distribution}+%
\lambda_{3}\cdot L_{per}</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.1d">italic_L start_POSTSUBSCRIPT italic_t italic_o italic_t italic_a italic_l end_POSTSUBSCRIPT = italic_λ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ⋅ italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e end_POSTSUBSCRIPT + italic_λ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ⋅ italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_r italic_i italic_b italic_u italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT + italic_λ start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ⋅ italic_L start_POSTSUBSCRIPT italic_p italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS2.p5">
<p class="ltx_p" id="S3.SS2.p5.1">Our method can be seamlessly integrated into existing pre-trained models. The shadow edge extraction serves as a standalone module, while the proposed losses replace the training objective of the pre-trained models.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>New Benchmark Testset and Evaluation Metric</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">The most commonly used datasets for shadow removal training and evaluation are ISTD<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib37" title="">37</a>]</cite>, ISTD+<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>, and SRD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib30" title="">30</a>]</cite>, which provide triplets of shadow image, shadow mask, and shadow-free ground truth. However, these datasets contain only simple shadows as they lack occluders within the image.
We argue that the current evaluation data is insufficient to assess the adaptability of current shadow removal methods due to limitations in data diversity.</p>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1">To address this gap, we curate a benchmark test set of shadow images in the wild. These images are sourced from existing shadow detection datasets, namely SBU <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib35" title="">35</a>]</cite> and CUHK <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib18" title="">18</a>]</cite>, exhibiting more complex scenes and larger variations in illumination, and thus better-representing shadow images in real-world scenarios.
The proposed dataset contains 400 images in total. Among them, 210 shadow images are from SBU (SBU-S), and 190 images from CUHK (CUHK-S).
To enable assessment of shadow removal performance on the proposed benchmark test set, we annotate pixels alongside the shadow edges that traverse the same material for each image in the dataset, examples of images and corresponding annotations are shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.F4" title="In 4 New Benchmark Testset and Evaluation Metric ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a>.
We believe that this dataset can serve as a valuable resource for evaluating shadow removal performance for general shadow images in real-world scenarios.</p>
</div>
<figure class="ltx_figure" id="S4.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F4.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="676" id="S4.F4.sf1.g1" src="extracted/5846543/pics_jpg/dataset1.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F4.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S4.F4.sf1.3.2" style="font-size:90%;">Shadow Images from SBU-S</span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F4.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="676" id="S4.F4.sf2.g1" src="extracted/5846543/pics_jpg/dataset2.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F4.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S4.F4.sf2.3.2" style="font-size:90%;">Shadow Images from CUHK-S</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F4.6.3.1" style="font-size:90%;">Figure 4</span>: </span><span class="ltx_text" id="S4.F4.4.2" style="font-size:90%;">Example images from our proposed benchmark test set for shadow removal performance evaluation. Annotated pixels alongside the shadow edges are also shown per image, <math alttext="S_{in}" class="ltx_Math" display="inline" id="S4.F4.3.1.m1.1"><semantics id="S4.F4.3.1.m1.1b"><msub id="S4.F4.3.1.m1.1.1" xref="S4.F4.3.1.m1.1.1.cmml"><mi id="S4.F4.3.1.m1.1.1.2" xref="S4.F4.3.1.m1.1.1.2.cmml">S</mi><mrow id="S4.F4.3.1.m1.1.1.3" xref="S4.F4.3.1.m1.1.1.3.cmml"><mi id="S4.F4.3.1.m1.1.1.3.2" xref="S4.F4.3.1.m1.1.1.3.2.cmml">i</mi><mo id="S4.F4.3.1.m1.1.1.3.1" xref="S4.F4.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.F4.3.1.m1.1.1.3.3" xref="S4.F4.3.1.m1.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.F4.3.1.m1.1c"><apply id="S4.F4.3.1.m1.1.1.cmml" xref="S4.F4.3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.F4.3.1.m1.1.1.1.cmml" xref="S4.F4.3.1.m1.1.1">subscript</csymbol><ci id="S4.F4.3.1.m1.1.1.2.cmml" xref="S4.F4.3.1.m1.1.1.2">𝑆</ci><apply id="S4.F4.3.1.m1.1.1.3.cmml" xref="S4.F4.3.1.m1.1.1.3"><times id="S4.F4.3.1.m1.1.1.3.1.cmml" xref="S4.F4.3.1.m1.1.1.3.1"></times><ci id="S4.F4.3.1.m1.1.1.3.2.cmml" xref="S4.F4.3.1.m1.1.1.3.2">𝑖</ci><ci id="S4.F4.3.1.m1.1.1.3.3.cmml" xref="S4.F4.3.1.m1.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.3.1.m1.1d">S_{in}</annotation><annotation encoding="application/x-llamapun" id="S4.F4.3.1.m1.1e">italic_S start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT</annotation></semantics></math> in red and <math alttext="S_{out}" class="ltx_Math" display="inline" id="S4.F4.4.2.m2.1"><semantics id="S4.F4.4.2.m2.1b"><msub id="S4.F4.4.2.m2.1.1" xref="S4.F4.4.2.m2.1.1.cmml"><mi id="S4.F4.4.2.m2.1.1.2" xref="S4.F4.4.2.m2.1.1.2.cmml">S</mi><mrow id="S4.F4.4.2.m2.1.1.3" xref="S4.F4.4.2.m2.1.1.3.cmml"><mi id="S4.F4.4.2.m2.1.1.3.2" xref="S4.F4.4.2.m2.1.1.3.2.cmml">o</mi><mo id="S4.F4.4.2.m2.1.1.3.1" xref="S4.F4.4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.F4.4.2.m2.1.1.3.3" xref="S4.F4.4.2.m2.1.1.3.3.cmml">u</mi><mo id="S4.F4.4.2.m2.1.1.3.1b" xref="S4.F4.4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.F4.4.2.m2.1.1.3.4" xref="S4.F4.4.2.m2.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.F4.4.2.m2.1c"><apply id="S4.F4.4.2.m2.1.1.cmml" xref="S4.F4.4.2.m2.1.1"><csymbol cd="ambiguous" id="S4.F4.4.2.m2.1.1.1.cmml" xref="S4.F4.4.2.m2.1.1">subscript</csymbol><ci id="S4.F4.4.2.m2.1.1.2.cmml" xref="S4.F4.4.2.m2.1.1.2">𝑆</ci><apply id="S4.F4.4.2.m2.1.1.3.cmml" xref="S4.F4.4.2.m2.1.1.3"><times id="S4.F4.4.2.m2.1.1.3.1.cmml" xref="S4.F4.4.2.m2.1.1.3.1"></times><ci id="S4.F4.4.2.m2.1.1.3.2.cmml" xref="S4.F4.4.2.m2.1.1.3.2">𝑜</ci><ci id="S4.F4.4.2.m2.1.1.3.3.cmml" xref="S4.F4.4.2.m2.1.1.3.3">𝑢</ci><ci id="S4.F4.4.2.m2.1.1.3.4.cmml" xref="S4.F4.4.2.m2.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.4.2.m2.1d">S_{out}</annotation><annotation encoding="application/x-llamapun" id="S4.F4.4.2.m2.1e">italic_S start_POSTSUBSCRIPT italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> in green. (a) shows examples from the SBU-S, and (b) shows images from the CUHK-S.</span></figcaption>
</figure>
<div class="ltx_para" id="S4.p3">
<p class="ltx_p" id="S4.p3.1">Another challenge in assessing shadow removal for shadow images in the wild is the lack of an evaluation metric.
All current metrics used in shadow removal evaluation, <em class="ltx_emph ltx_font_italic" id="S4.p3.1.1">e.g</em>.<span class="ltx_text" id="S4.p3.1.2"></span> Mean Absolute Error (MAE), Peak Signal-to-Noise Ratio (PSNR), and Structural Similarity Index (SSIM), necessitate the comparison between the shadow-removed result and the ground truth shadow-free image.
However, due to the complexity of real-world scenarios, obtaining the shadow-free version of the scene is impractical.</p>
</div>
<div class="ltx_para" id="S4.p4">
<p class="ltx_p" id="S4.p4.2">To tackle the absence of an effective evaluation metric, we propose a straightforward metric called Color Distribution Difference (CDD).
CDD is grounded in the assumption that the area alongside the shadow edge maintains the same underlying texture.
The CDD metric calculates the Earth Mover’s Distance (EMD) between the color distribution histograms of pixels on both sides of the shadow edges.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="CDD=\textrm{EMD}([Hist(S),Hist(NS)])" class="ltx_Math" display="block" id="S4.E5.m1.2"><semantics id="S4.E5.m1.2a"><mrow id="S4.E5.m1.2.2" xref="S4.E5.m1.2.2.cmml"><mrow id="S4.E5.m1.2.2.3" xref="S4.E5.m1.2.2.3.cmml"><mi id="S4.E5.m1.2.2.3.2" xref="S4.E5.m1.2.2.3.2.cmml">C</mi><mo id="S4.E5.m1.2.2.3.1" xref="S4.E5.m1.2.2.3.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.3.3" xref="S4.E5.m1.2.2.3.3.cmml">D</mi><mo id="S4.E5.m1.2.2.3.1a" xref="S4.E5.m1.2.2.3.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.3.4" xref="S4.E5.m1.2.2.3.4.cmml">D</mi></mrow><mo id="S4.E5.m1.2.2.2" xref="S4.E5.m1.2.2.2.cmml">=</mo><mrow id="S4.E5.m1.2.2.1" xref="S4.E5.m1.2.2.1.cmml"><mtext id="S4.E5.m1.2.2.1.3" xref="S4.E5.m1.2.2.1.3a.cmml">EMD</mtext><mo id="S4.E5.m1.2.2.1.2" xref="S4.E5.m1.2.2.1.2.cmml">⁢</mo><mrow id="S4.E5.m1.2.2.1.1.1" xref="S4.E5.m1.2.2.1.cmml"><mo id="S4.E5.m1.2.2.1.1.1.2" stretchy="false" xref="S4.E5.m1.2.2.1.cmml">(</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.2" xref="S4.E5.m1.2.2.1.1.1.1.3.cmml"><mo id="S4.E5.m1.2.2.1.1.1.1.2.3" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.3.cmml">[</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.1.1" xref="S4.E5.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S4.E5.m1.2.2.1.1.1.1.1.1.2" xref="S4.E5.m1.2.2.1.1.1.1.1.1.2.cmml">H</mi><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.1" xref="S4.E5.m1.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.1.1.3" xref="S4.E5.m1.2.2.1.1.1.1.1.1.3.cmml">i</mi><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.1a" xref="S4.E5.m1.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.1.1.4" xref="S4.E5.m1.2.2.1.1.1.1.1.1.4.cmml">s</mi><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.1b" xref="S4.E5.m1.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.1.1.5" xref="S4.E5.m1.2.2.1.1.1.1.1.1.5.cmml">t</mi><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.1c" xref="S4.E5.m1.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.1.1.6.2" xref="S4.E5.m1.2.2.1.1.1.1.1.1.cmml"><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.6.2.1" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.1.1.cmml">(</mo><mi id="S4.E5.m1.1.1" xref="S4.E5.m1.1.1.cmml">S</mi><mo id="S4.E5.m1.2.2.1.1.1.1.1.1.6.2.2" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E5.m1.2.2.1.1.1.1.2.4" xref="S4.E5.m1.2.2.1.1.1.1.3.cmml">,</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.2.2" xref="S4.E5.m1.2.2.1.1.1.1.2.2.cmml"><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.3" xref="S4.E5.m1.2.2.1.1.1.1.2.2.3.cmml">H</mi><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.2" xref="S4.E5.m1.2.2.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.4" xref="S4.E5.m1.2.2.1.1.1.1.2.2.4.cmml">i</mi><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.2a" xref="S4.E5.m1.2.2.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.5" xref="S4.E5.m1.2.2.1.1.1.1.2.2.5.cmml">s</mi><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.2b" xref="S4.E5.m1.2.2.1.1.1.1.2.2.2.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.6" xref="S4.E5.m1.2.2.1.1.1.1.2.2.6.cmml">t</mi><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.2c" xref="S4.E5.m1.2.2.1.1.1.1.2.2.2.cmml">⁢</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.cmml"><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.2" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.cmml">(</mo><mrow id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.cmml"><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.2" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.2.cmml">N</mi><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.1" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.1.cmml">⁢</mo><mi id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.3" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.3.cmml">S</mi></mrow><mo id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.3" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E5.m1.2.2.1.1.1.1.2.5" stretchy="false" xref="S4.E5.m1.2.2.1.1.1.1.3.cmml">]</mo></mrow><mo id="S4.E5.m1.2.2.1.1.1.3" stretchy="false" xref="S4.E5.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E5.m1.2b"><apply id="S4.E5.m1.2.2.cmml" xref="S4.E5.m1.2.2"><eq id="S4.E5.m1.2.2.2.cmml" xref="S4.E5.m1.2.2.2"></eq><apply id="S4.E5.m1.2.2.3.cmml" xref="S4.E5.m1.2.2.3"><times id="S4.E5.m1.2.2.3.1.cmml" xref="S4.E5.m1.2.2.3.1"></times><ci id="S4.E5.m1.2.2.3.2.cmml" xref="S4.E5.m1.2.2.3.2">𝐶</ci><ci id="S4.E5.m1.2.2.3.3.cmml" xref="S4.E5.m1.2.2.3.3">𝐷</ci><ci id="S4.E5.m1.2.2.3.4.cmml" xref="S4.E5.m1.2.2.3.4">𝐷</ci></apply><apply id="S4.E5.m1.2.2.1.cmml" xref="S4.E5.m1.2.2.1"><times id="S4.E5.m1.2.2.1.2.cmml" xref="S4.E5.m1.2.2.1.2"></times><ci id="S4.E5.m1.2.2.1.3a.cmml" xref="S4.E5.m1.2.2.1.3"><mtext id="S4.E5.m1.2.2.1.3.cmml" xref="S4.E5.m1.2.2.1.3">EMD</mtext></ci><interval closure="closed" id="S4.E5.m1.2.2.1.1.1.1.3.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2"><apply id="S4.E5.m1.2.2.1.1.1.1.1.1.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1"><times id="S4.E5.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1.1"></times><ci id="S4.E5.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1.2">𝐻</ci><ci id="S4.E5.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1.3">𝑖</ci><ci id="S4.E5.m1.2.2.1.1.1.1.1.1.4.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1.4">𝑠</ci><ci id="S4.E5.m1.2.2.1.1.1.1.1.1.5.cmml" xref="S4.E5.m1.2.2.1.1.1.1.1.1.5">𝑡</ci><ci id="S4.E5.m1.1.1.cmml" xref="S4.E5.m1.1.1">𝑆</ci></apply><apply id="S4.E5.m1.2.2.1.1.1.1.2.2.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2"><times id="S4.E5.m1.2.2.1.1.1.1.2.2.2.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.2"></times><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.3.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.3">𝐻</ci><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.4.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.4">𝑖</ci><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.5.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.5">𝑠</ci><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.6.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.6">𝑡</ci><apply id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1"><times id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.1.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.1"></times><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.2.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.2">𝑁</ci><ci id="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.3.cmml" xref="S4.E5.m1.2.2.1.1.1.1.2.2.1.1.1.3">𝑆</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E5.m1.2c">CDD=\textrm{EMD}([Hist(S),Hist(NS)])</annotation><annotation encoding="application/x-llamapun" id="S4.E5.m1.2d">italic_C italic_D italic_D = EMD ( [ italic_H italic_i italic_s italic_t ( italic_S ) , italic_H italic_i italic_s italic_t ( italic_N italic_S ) ] )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p4.1">where <math alttext="S,NS" class="ltx_Math" display="inline" id="S4.p4.1.m1.2"><semantics id="S4.p4.1.m1.2a"><mrow id="S4.p4.1.m1.2.2.1" xref="S4.p4.1.m1.2.2.2.cmml"><mi id="S4.p4.1.m1.1.1" xref="S4.p4.1.m1.1.1.cmml">S</mi><mo id="S4.p4.1.m1.2.2.1.2" xref="S4.p4.1.m1.2.2.2.cmml">,</mo><mrow id="S4.p4.1.m1.2.2.1.1" xref="S4.p4.1.m1.2.2.1.1.cmml"><mi id="S4.p4.1.m1.2.2.1.1.2" xref="S4.p4.1.m1.2.2.1.1.2.cmml">N</mi><mo id="S4.p4.1.m1.2.2.1.1.1" xref="S4.p4.1.m1.2.2.1.1.1.cmml">⁢</mo><mi id="S4.p4.1.m1.2.2.1.1.3" xref="S4.p4.1.m1.2.2.1.1.3.cmml">S</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p4.1.m1.2b"><list id="S4.p4.1.m1.2.2.2.cmml" xref="S4.p4.1.m1.2.2.1"><ci id="S4.p4.1.m1.1.1.cmml" xref="S4.p4.1.m1.1.1">𝑆</ci><apply id="S4.p4.1.m1.2.2.1.1.cmml" xref="S4.p4.1.m1.2.2.1.1"><times id="S4.p4.1.m1.2.2.1.1.1.cmml" xref="S4.p4.1.m1.2.2.1.1.1"></times><ci id="S4.p4.1.m1.2.2.1.1.2.cmml" xref="S4.p4.1.m1.2.2.1.1.2">𝑁</ci><ci id="S4.p4.1.m1.2.2.1.1.3.cmml" xref="S4.p4.1.m1.2.2.1.1.3">𝑆</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.1.m1.2c">S,NS</annotation><annotation encoding="application/x-llamapun" id="S4.p4.1.m1.2d">italic_S , italic_N italic_S</annotation></semantics></math> denotes the pixel sets in the shadow region and the non-shadow region, respectively.</p>
</div>
<div class="ltx_para" id="S4.p5">
<p class="ltx_p" id="S4.p5.1">The CDD quantifies the disparity in color distribution and is correlated with the quality of shadow removal performance.
A lower mean CDD value indicates a better shadow-removal outcome, showcasing alignment between the colors on both sides of the shadow edge.
A lower variance suggests more consistent performance across various shadow appearances, illustrating the method’s generalizability.</p>
</div>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Experiments</h2>
<div class="ltx_para ltx_noindent" id="S5.p1">
<p class="ltx_p" id="S5.p1.4"><span class="ltx_text ltx_font_bold" id="S5.p1.4.1">Implementation Details.</span>
The proposed method is implemented using Pytorch, all experiments are tested on an NVIDIA TITAN RTX GPU.
We apply our method on top of two models, SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> and ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>.
Hyper-parameters are set to be the same as in the training phase, except that the learning rate is set to <math alttext="1e^{-5}" class="ltx_Math" display="inline" id="S5.p1.1.m1.1"><semantics id="S5.p1.1.m1.1a"><mrow id="S5.p1.1.m1.1.1" xref="S5.p1.1.m1.1.1.cmml"><mn id="S5.p1.1.m1.1.1.2" xref="S5.p1.1.m1.1.1.2.cmml">1</mn><mo id="S5.p1.1.m1.1.1.1" xref="S5.p1.1.m1.1.1.1.cmml">⁢</mo><msup id="S5.p1.1.m1.1.1.3" xref="S5.p1.1.m1.1.1.3.cmml"><mi id="S5.p1.1.m1.1.1.3.2" xref="S5.p1.1.m1.1.1.3.2.cmml">e</mi><mrow id="S5.p1.1.m1.1.1.3.3" xref="S5.p1.1.m1.1.1.3.3.cmml"><mo id="S5.p1.1.m1.1.1.3.3a" xref="S5.p1.1.m1.1.1.3.3.cmml">−</mo><mn id="S5.p1.1.m1.1.1.3.3.2" xref="S5.p1.1.m1.1.1.3.3.2.cmml">5</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.p1.1.m1.1b"><apply id="S5.p1.1.m1.1.1.cmml" xref="S5.p1.1.m1.1.1"><times id="S5.p1.1.m1.1.1.1.cmml" xref="S5.p1.1.m1.1.1.1"></times><cn id="S5.p1.1.m1.1.1.2.cmml" type="integer" xref="S5.p1.1.m1.1.1.2">1</cn><apply id="S5.p1.1.m1.1.1.3.cmml" xref="S5.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S5.p1.1.m1.1.1.3.1.cmml" xref="S5.p1.1.m1.1.1.3">superscript</csymbol><ci id="S5.p1.1.m1.1.1.3.2.cmml" xref="S5.p1.1.m1.1.1.3.2">𝑒</ci><apply id="S5.p1.1.m1.1.1.3.3.cmml" xref="S5.p1.1.m1.1.1.3.3"><minus id="S5.p1.1.m1.1.1.3.3.1.cmml" xref="S5.p1.1.m1.1.1.3.3"></minus><cn id="S5.p1.1.m1.1.1.3.3.2.cmml" type="integer" xref="S5.p1.1.m1.1.1.3.3.2">5</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.1.m1.1c">1e^{-5}</annotation><annotation encoding="application/x-llamapun" id="S5.p1.1.m1.1d">1 italic_e start_POSTSUPERSCRIPT - 5 end_POSTSUPERSCRIPT</annotation></semantics></math>.
During the adaptation process, we update the pre-trained model for 20 iterations per image.
The refining parameters <math alttext="\lambda_{1},\lambda_{2},\lambda_{3}" class="ltx_Math" display="inline" id="S5.p1.2.m2.3"><semantics id="S5.p1.2.m2.3a"><mrow id="S5.p1.2.m2.3.3.3" xref="S5.p1.2.m2.3.3.4.cmml"><msub id="S5.p1.2.m2.1.1.1.1" xref="S5.p1.2.m2.1.1.1.1.cmml"><mi id="S5.p1.2.m2.1.1.1.1.2" xref="S5.p1.2.m2.1.1.1.1.2.cmml">λ</mi><mn id="S5.p1.2.m2.1.1.1.1.3" xref="S5.p1.2.m2.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.p1.2.m2.3.3.3.4" xref="S5.p1.2.m2.3.3.4.cmml">,</mo><msub id="S5.p1.2.m2.2.2.2.2" xref="S5.p1.2.m2.2.2.2.2.cmml"><mi id="S5.p1.2.m2.2.2.2.2.2" xref="S5.p1.2.m2.2.2.2.2.2.cmml">λ</mi><mn id="S5.p1.2.m2.2.2.2.2.3" xref="S5.p1.2.m2.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.p1.2.m2.3.3.3.5" xref="S5.p1.2.m2.3.3.4.cmml">,</mo><msub id="S5.p1.2.m2.3.3.3.3" xref="S5.p1.2.m2.3.3.3.3.cmml"><mi id="S5.p1.2.m2.3.3.3.3.2" xref="S5.p1.2.m2.3.3.3.3.2.cmml">λ</mi><mn id="S5.p1.2.m2.3.3.3.3.3" xref="S5.p1.2.m2.3.3.3.3.3.cmml">3</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.p1.2.m2.3b"><list id="S5.p1.2.m2.3.3.4.cmml" xref="S5.p1.2.m2.3.3.3"><apply id="S5.p1.2.m2.1.1.1.1.cmml" xref="S5.p1.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S5.p1.2.m2.1.1.1.1.1.cmml" xref="S5.p1.2.m2.1.1.1.1">subscript</csymbol><ci id="S5.p1.2.m2.1.1.1.1.2.cmml" xref="S5.p1.2.m2.1.1.1.1.2">𝜆</ci><cn id="S5.p1.2.m2.1.1.1.1.3.cmml" type="integer" xref="S5.p1.2.m2.1.1.1.1.3">1</cn></apply><apply id="S5.p1.2.m2.2.2.2.2.cmml" xref="S5.p1.2.m2.2.2.2.2"><csymbol cd="ambiguous" id="S5.p1.2.m2.2.2.2.2.1.cmml" xref="S5.p1.2.m2.2.2.2.2">subscript</csymbol><ci id="S5.p1.2.m2.2.2.2.2.2.cmml" xref="S5.p1.2.m2.2.2.2.2.2">𝜆</ci><cn id="S5.p1.2.m2.2.2.2.2.3.cmml" type="integer" xref="S5.p1.2.m2.2.2.2.2.3">2</cn></apply><apply id="S5.p1.2.m2.3.3.3.3.cmml" xref="S5.p1.2.m2.3.3.3.3"><csymbol cd="ambiguous" id="S5.p1.2.m2.3.3.3.3.1.cmml" xref="S5.p1.2.m2.3.3.3.3">subscript</csymbol><ci id="S5.p1.2.m2.3.3.3.3.2.cmml" xref="S5.p1.2.m2.3.3.3.3.2">𝜆</ci><cn id="S5.p1.2.m2.3.3.3.3.3.cmml" type="integer" xref="S5.p1.2.m2.3.3.3.3.3">3</cn></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.2.m2.3c">\lambda_{1},\lambda_{2},\lambda_{3}</annotation><annotation encoding="application/x-llamapun" id="S5.p1.2.m2.3d">italic_λ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_λ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_λ start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\lambda_{4}" class="ltx_Math" display="inline" id="S5.p1.3.m3.1"><semantics id="S5.p1.3.m3.1a"><msub id="S5.p1.3.m3.1.1" xref="S5.p1.3.m3.1.1.cmml"><mi id="S5.p1.3.m3.1.1.2" xref="S5.p1.3.m3.1.1.2.cmml">λ</mi><mn id="S5.p1.3.m3.1.1.3" xref="S5.p1.3.m3.1.1.3.cmml">4</mn></msub><annotation-xml encoding="MathML-Content" id="S5.p1.3.m3.1b"><apply id="S5.p1.3.m3.1.1.cmml" xref="S5.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.p1.3.m3.1.1.1.cmml" xref="S5.p1.3.m3.1.1">subscript</csymbol><ci id="S5.p1.3.m3.1.1.2.cmml" xref="S5.p1.3.m3.1.1.2">𝜆</ci><cn id="S5.p1.3.m3.1.1.3.cmml" type="integer" xref="S5.p1.3.m3.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.3.m3.1c">\lambda_{4}</annotation><annotation encoding="application/x-llamapun" id="S5.p1.3.m3.1d">italic_λ start_POSTSUBSCRIPT 4 end_POSTSUBSCRIPT</annotation></semantics></math> are set to <math alttext="1,1,0.1,10" class="ltx_Math" display="inline" id="S5.p1.4.m4.4"><semantics id="S5.p1.4.m4.4a"><mrow id="S5.p1.4.m4.4.5.2" xref="S5.p1.4.m4.4.5.1.cmml"><mn id="S5.p1.4.m4.1.1" xref="S5.p1.4.m4.1.1.cmml">1</mn><mo id="S5.p1.4.m4.4.5.2.1" xref="S5.p1.4.m4.4.5.1.cmml">,</mo><mn id="S5.p1.4.m4.2.2" xref="S5.p1.4.m4.2.2.cmml">1</mn><mo id="S5.p1.4.m4.4.5.2.2" xref="S5.p1.4.m4.4.5.1.cmml">,</mo><mn id="S5.p1.4.m4.3.3" xref="S5.p1.4.m4.3.3.cmml">0.1</mn><mo id="S5.p1.4.m4.4.5.2.3" xref="S5.p1.4.m4.4.5.1.cmml">,</mo><mn id="S5.p1.4.m4.4.4" xref="S5.p1.4.m4.4.4.cmml">10</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.p1.4.m4.4b"><list id="S5.p1.4.m4.4.5.1.cmml" xref="S5.p1.4.m4.4.5.2"><cn id="S5.p1.4.m4.1.1.cmml" type="integer" xref="S5.p1.4.m4.1.1">1</cn><cn id="S5.p1.4.m4.2.2.cmml" type="integer" xref="S5.p1.4.m4.2.2">1</cn><cn id="S5.p1.4.m4.3.3.cmml" type="float" xref="S5.p1.4.m4.3.3">0.1</cn><cn id="S5.p1.4.m4.4.4.cmml" type="integer" xref="S5.p1.4.m4.4.4">10</cn></list></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.4.m4.4c">1,1,0.1,10</annotation><annotation encoding="application/x-llamapun" id="S5.p1.4.m4.4d">1 , 1 , 0.1 , 10</annotation></semantics></math> in our experiments.
More details can be found in the supplementary.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p2">
<p class="ltx_p" id="S5.p2.1"><span class="ltx_text ltx_font_bold" id="S5.p2.1.1">Datasets and Evaluation Metrics.</span>
We evaluate shadow removal performance for images-in-the-wild on our proposed test set, comprising 400 shadow images from SBU <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib35" title="">35</a>]</cite> and CUHK <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib18" title="">18</a>]</cite>, with material-consistent shadow edge pixels annotated per image.
As shadow-free images are not available in our test set, we use the proposed Color Distribution Difference (CDD) as the quantitative evaluation metric.
Additional evaluation results on the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> dataset are provided in the supplementary materials.</p>
</div>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Comparison with SOTA Models</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">To demonstrate the seamless integration of our proposed adaptation method with existing shadow removal models, we apply our method on top of three state-of-the-art (SOTA) models: SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>, a CNN-based model, ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>, a Transformer-based model, and ShadowDiffusion <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>]</cite>, a diffusion-based model.</p>
</div>
<figure class="ltx_table" id="S5.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T1.8.3.1" style="font-size:90%;">Table 1</span>: </span><span class="ltx_text" id="S5.T1.4.2" style="font-size:90%;">Comparison with SOTA models. We report the performance of existing state-of-the-art (SOTA) methods on our proposed test set and compare them with our adaptation method. CDD mean and variance values are provided, note that these values are reported as <math alttext="1000\times" class="ltx_math_unparsed" display="inline" id="S5.T1.3.1.m1.1"><semantics id="S5.T1.3.1.m1.1b"><mrow id="S5.T1.3.1.m1.1c"><mn id="S5.T1.3.1.m1.1.1">1000</mn><mo id="S5.T1.3.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S5.T1.3.1.m1.1d">1000\times</annotation><annotation encoding="application/x-llamapun" id="S5.T1.3.1.m1.1e">1000 ×</annotation></semantics></math> the original value. <math alttext="*" class="ltx_Math" display="inline" id="S5.T1.4.2.m2.1"><semantics id="S5.T1.4.2.m2.1b"><mo id="S5.T1.4.2.m2.1.1" xref="S5.T1.4.2.m2.1.1.cmml">∗</mo><annotation-xml encoding="MathML-Content" id="S5.T1.4.2.m2.1c"><times id="S5.T1.4.2.m2.1.1.cmml" xref="S5.T1.4.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.4.2.m2.1d">*</annotation><annotation encoding="application/x-llamapun" id="S5.T1.4.2.m2.1e">∗</annotation></semantics></math> denotes that only the SRD pre-trained model is available for evaluation.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T1.6" style="width:433.6pt;height:172.7pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-9.1pt,3.6pt) scale(0.959582369213912,0.959582369213912) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T1.6.2">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T1.6.2.3.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S5.T1.6.2.3.1.1" rowspan="2"><span class="ltx_text" id="S5.T1.6.2.3.1.1.1">Methods</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S5.T1.6.2.3.1.2">CUHK-S</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S5.T1.6.2.3.1.3">SBU-S</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.4.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.4.2.1">CDD Mean</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.4.2.2">CDD Var</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.4.2.3">CDD Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.6.2.4.2.4">CDD Var</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.6.2.5.3.1">Input</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.5.3.2">291.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.5.3.3">125.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.5.3.4">279.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.6.2.5.3.5">119.0</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.6.2.6.4.1">Inpaint4Shadow <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib26" title="">26</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.6.4.2">25.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.6.4.3">36.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.6.4.4">28.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.6.2.6.4.5">40.7</td>
</tr>
<tr class="ltx_tr" id="S5.T1.5.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.5.1.1.1">ShadowDiffusion<sup class="ltx_sup" id="S5.T1.5.1.1.1.1">∗</sup> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.5.1.1.2">50.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.5.1.1.3">89.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.5.1.1.4">82.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.5.1.1.5">111.9</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T1.6.2.2.1">ShadowDiffusion<sup class="ltx_sup" id="S5.T1.6.2.2.1.1">∗</sup>+Ours</th>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.2.2">48.7</td>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.2.3">77.1</td>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.2.4">78.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.6.2.2.5">103.4</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.6.2.7.5.1">SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.7.5.2">41.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.7.5.3">52.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.7.5.4">43.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.6.2.7.5.5">54.9</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.8.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T1.6.2.8.6.1">SP+M-Net+Ours</th>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.8.6.2">22.2</td>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.8.6.3">36.5</td>
<td class="ltx_td ltx_align_center" id="S5.T1.6.2.8.6.4">23.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.6.2.8.6.5">46.7</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.6.2.9.7.1">ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.9.7.2">23.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.9.7.3">33.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.6.2.9.7.4">27.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.6.2.9.7.5">45.4</td>
</tr>
<tr class="ltx_tr" id="S5.T1.6.2.10.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S5.T1.6.2.10.8.1">ShadowFormer+Ours</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.6.2.10.8.2"><span class="ltx_text ltx_font_bold" id="S5.T1.6.2.10.8.2.1">16.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.6.2.10.8.3"><span class="ltx_text ltx_font_bold" id="S5.T1.6.2.10.8.3.1">31.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.6.2.10.8.4"><span class="ltx_text ltx_font_bold" id="S5.T1.6.2.10.8.4.1">15.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T1.6.2.10.8.5"><span class="ltx_text ltx_font_bold" id="S5.T1.6.2.10.8.5.1">26.3</span></td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F5">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="457" id="S5.F5.g1" src="extracted/5846543/pics_jpg/qualitative5.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F5.2"><span class="ltx_text ltx_inline-block" id="S5.F5.2.1" style="font-size:90%;width:82.4pt;">(a) Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F5.2.2" style="font-size:90%;width:82.4pt;">(b) SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F5.2.3" style="font-size:90%;width:82.4pt;">(c)<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>+Ours</span>
<span class="ltx_text ltx_inline-block" id="S5.F5.2.4" style="font-size:90%;width:82.4pt;">(d) ShadowFormer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F5.2.5" style="font-size:90%;width:82.4pt;">(e)<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>+Ours</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F5.3.1.1" style="font-size:90%;">Figure 5</span>: </span><span class="ltx_text" id="S5.F5.4.2" style="font-size:90%;">Examples from test cases in our proposed dataset, (a) shows input images from our curated dataset, first three rows are from SBU-S and last two rows are from CUHK-S, (b) and (c) present pre-trained and refined SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> results, (d) and (e) show pre-trained and refined ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> results.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S5.SS1.p2.1.1">Quantitative evaluation.</span> For fair comparisons, we evaluate the performance of all existing methods using models trained on the ISTD+ dataset (except for ShadowDiffusion, where only the SRD-trained model is available).
As shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T1" title="In 5.1 Comparison with SOTA Models ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">1</span></a>, our adaptation method enables both SP+M-Net and ShadowFormer to surpass their original results, with ShadowFormer achieving the best performance when our adaptation is applied.
The high errors from existing SOTA methods indicate limited adaptability to various complex shadow scenes in the wild, as they are trained on simple and limited scenes.
In contrast, our adaptation method leverages self-supervision from shadow edges in each image, refining each case during test time.
Notably, the SRD-trained ShadowDiffusion performs the worst among the SOTA methods due to the intensity differences between the training shadow and shadow-free pairs, which we discuss further in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.SS4" title="5.4 Cross dataset testing ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">5.4</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS1.p3">
<p class="ltx_p" id="S5.SS1.p3.1"><span class="ltx_text ltx_font_bold" id="S5.SS1.p3.1.1">Qualitative evaluation.</span> As shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F5" title="In 5.1 Comparison with SOTA Models ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">5</span></a>, we demonstrate the improvement with our proposed adaptation method on both base models. Column (a) shows the input shadow images. In columns (b) and (d), we can see that pre-trained models struggle with complex shadows of various shapes, near the dark materials, and with occluders in the scene, resulting in obvious artifacts in the shadow region. With our adaptation method, as shown in columns (c) and (e), we fix the color shift in the shadow region. This is because our proposed adaptation constrains the color and texture consistency between shadow/non-shadow regions.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Usefulness of CDD</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.1">We propose the Color Distribution Difference (CDD) metric to address the lack of evaluation metrics for shadow removal in the wild, as existing metrics require ground truth shadow-free images. To validate the usefulness of our CDD metric, we plot the Mean Absolute Error (MAE) values alongside the CDD values for each shadow image in the ISTD+ test set <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F6" title="In 5.2 Usefulness of CDD ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">6</span></a>.
This plot reveals a strong correlation between the two metrics, demonstrating that CDD is a reliable alternative for evaluating shadow removal methods when shadow-free ground truth is not available.</p>
</div>
<figure class="ltx_figure" id="S5.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="311" id="S5.F6.g1" src="extracted/5846543/pics_jpg/maecdd.jpg" width="389"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F6.2.1.1" style="font-size:90%;">Figure 6</span>: </span><span class="ltx_text" id="S5.F6.3.2" style="font-size:90%;">Per-image CDD and MAE errors for shadow images of the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> test set. Each point represents the CDD and MAE error computed for a single image. The two metrics are highly correlated. Note that measuring MAE requires the paired shadow-free image while measuring our proposed CDD only requires annotating MC-shadow edges in the input shadow image.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Ablation Studies</h3>
<div class="ltx_para ltx_noindent" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.1"><span class="ltx_text ltx_font_bold" id="S5.SS3.p1.1.1">The effect of Fine-tuned SAM.</span>
We fine-tune the Segment Anything Model <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite> to extract shadow edges that traverse the same material. In <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F7" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">7</span></a>, we demonstrate that the fine-tuned SAM produces shadow-invariant masks.
Additionally, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T2" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">2</span></a> compares the performance of using vanilla SAM and our fine-tuned SAM for adaptation. The latter surpasses the former due to its reduced sensitivity to shadow presence.</p>
</div>
<figure class="ltx_figure" id="S5.F7">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="298" id="S5.F7.g1" src="extracted/5846543/pics_jpg/comparesam.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F7.2"><span class="ltx_text ltx_inline-block" id="S5.F7.2.1" style="font-size:90%;width:138.8pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F7.2.2" style="font-size:90%;width:138.8pt;">Vanilla SAM</span>
<span class="ltx_text ltx_inline-block" id="S5.F7.2.3" style="font-size:90%;width:138.8pt;">Fine-tuned SAM</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F7.3.1.1" style="font-size:90%;">Figure 7</span>: </span><span class="ltx_text" id="S5.F7.4.2" style="font-size:90%;">Comparison of vanilla SAM and fine-tuned SAM on test images. Our fine-tuned SAM predicts shadow-invariant masks while vanilla SAM is sensitive to shadow regions.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.1"><span class="ltx_text ltx_font_bold" id="S5.SS3.p2.1.1">The effectiveness of the Proposed Adaptation Method.</span>
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T2" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">2</span></a> shows evaluations of different configurations for the adaptation method. We find that the proposed approach, which combines fine-tuned SAM edge extraction with pixel and patch sampling for supervision, yields the overall best results.
“Per Mask” refines the edge pixels and patches on each SAM-detected material mask that intersects with the shadow mask, and “Pixels” refines only the pixels on all extracted edges at once. We can see that the “Pixels&amp;Patches” configuration achieves the best overall results (shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F8" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">8</span></a>), as it maintains texture consistency within each material while ensuring global consistency across all the extracted shadow edges. When no edge extraction is performed, the entire shadow edge is used, including those edges coinciding with material boundaries, the adaptation process is misguided because these edges separate different materials on either side, as depicted in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F9" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">9</span></a>.</p>
</div>
<figure class="ltx_table" id="S5.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T2.7.2.1" style="font-size:90%;">Table 2</span>: </span><span class="ltx_text" id="S5.T2.2.1" style="font-size:90%;">Quantitative results with different configurations of the adaptation method and with different loss settings. We report the CDD mean and variance values on our proposed dataset. Note that the CDD values are reported in <math alttext="1000\times" class="ltx_math_unparsed" display="inline" id="S5.T2.2.1.m1.1"><semantics id="S5.T2.2.1.m1.1b"><mrow id="S5.T2.2.1.m1.1c"><mn id="S5.T2.2.1.m1.1.1">1000</mn><mo id="S5.T2.2.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S5.T2.2.1.m1.1d">1000\times</annotation><annotation encoding="application/x-llamapun" id="S5.T2.2.1.m1.1e">1000 ×</annotation></semantics></math> the original value.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T2.5" style="width:216.8pt;height:112.4pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-82.5pt,42.8pt) scale(0.56785366663676,0.56785366663676) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T2.5.3">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T2.5.3.4.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S5.T2.5.3.4.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S5.T2.5.3.4.1.2">CUHK</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S5.T2.5.3.4.1.3">SBU</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.5.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.5.2.1"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.5.2.1.1">Configurations</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.5.2.2">CDD Mean</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.5.2.3">CDD Var</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.5.2.4">CDD Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.5.2.5">CDD Var</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.6.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.6.3.1">VanillaSAM+Pixels&amp;Patches</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.6.3.2">19.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.6.3.3">34.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.6.3.4">21.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.6.3.5">44.9</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.7.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.7.4.1">FinetunedSAM+Per Mask</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.7.4.2">16.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.7.4.3"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.7.4.3.1">29.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.7.4.4">16.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.7.4.5">33.6</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.8.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.8.5.1">FinetunedSAM+Pixels</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.8.5.2">16.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.8.5.3">32.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.8.5.4">15.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.8.5.5">27.0</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.9.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.9.6.1">FinetunedSAM+Pixels&amp;Patches</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.9.6.2"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.9.6.2.1">16.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.9.6.3">31.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.9.6.4"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.9.6.4.1">15.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.9.6.5"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.9.6.5.1">26.3</span></td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.10.7">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.10.7.1"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.10.7.1.1">Losses</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.10.7.2">CDD Mean</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.10.7.3">CDD Var</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.10.7.4">CDD Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.10.7.5">CDD Var</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.11.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.5.3.11.8.1">All losses</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.11.8.2"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.11.8.2.1">16.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.11.8.3"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.11.8.3.1">31.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.5.3.11.8.4"><span class="ltx_text ltx_font_bold" id="S5.T2.5.3.11.8.4.1">15.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.5.3.11.8.5">26.3</td>
</tr>
<tr class="ltx_tr" id="S5.T2.3.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.3.1.1.1">- <math alttext="L_{distance}" class="ltx_Math" display="inline" id="S5.T2.3.1.1.1.m1.1"><semantics id="S5.T2.3.1.1.1.m1.1a"><msub id="S5.T2.3.1.1.1.m1.1.1" xref="S5.T2.3.1.1.1.m1.1.1.cmml"><mi id="S5.T2.3.1.1.1.m1.1.1.2" xref="S5.T2.3.1.1.1.m1.1.1.2.cmml">L</mi><mrow id="S5.T2.3.1.1.1.m1.1.1.3" xref="S5.T2.3.1.1.1.m1.1.1.3.cmml"><mi id="S5.T2.3.1.1.1.m1.1.1.3.2" xref="S5.T2.3.1.1.1.m1.1.1.3.2.cmml">d</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.3" xref="S5.T2.3.1.1.1.m1.1.1.3.3.cmml">i</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1a" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.4" xref="S5.T2.3.1.1.1.m1.1.1.3.4.cmml">s</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1b" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.5" xref="S5.T2.3.1.1.1.m1.1.1.3.5.cmml">t</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1c" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.6" xref="S5.T2.3.1.1.1.m1.1.1.3.6.cmml">a</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1d" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.7" xref="S5.T2.3.1.1.1.m1.1.1.3.7.cmml">n</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1e" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.8" xref="S5.T2.3.1.1.1.m1.1.1.3.8.cmml">c</mi><mo id="S5.T2.3.1.1.1.m1.1.1.3.1f" xref="S5.T2.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.3.1.1.1.m1.1.1.3.9" xref="S5.T2.3.1.1.1.m1.1.1.3.9.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T2.3.1.1.1.m1.1b"><apply id="S5.T2.3.1.1.1.m1.1.1.cmml" xref="S5.T2.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T2.3.1.1.1.m1.1.1.1.cmml" xref="S5.T2.3.1.1.1.m1.1.1">subscript</csymbol><ci id="S5.T2.3.1.1.1.m1.1.1.2.cmml" xref="S5.T2.3.1.1.1.m1.1.1.2">𝐿</ci><apply id="S5.T2.3.1.1.1.m1.1.1.3.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3"><times id="S5.T2.3.1.1.1.m1.1.1.3.1.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.1"></times><ci id="S5.T2.3.1.1.1.m1.1.1.3.2.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.2">𝑑</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.3.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.3">𝑖</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.4.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.4">𝑠</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.5.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.5">𝑡</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.6.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.6">𝑎</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.7.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.7">𝑛</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.8.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.8">𝑐</ci><ci id="S5.T2.3.1.1.1.m1.1.1.3.9.cmml" xref="S5.T2.3.1.1.1.m1.1.1.3.9">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.3.1.1.1.m1.1c">L_{distance}</annotation><annotation encoding="application/x-llamapun" id="S5.T2.3.1.1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.3.1.1.2">16.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.3.1.1.3">32.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.3.1.1.4">15.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.3.1.1.5"><span class="ltx_text ltx_font_bold" id="S5.T2.3.1.1.5.1">25.8</span></td>
</tr>
<tr class="ltx_tr" id="S5.T2.4.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.4.2.2.1">- <math alttext="L_{distribution}" class="ltx_Math" display="inline" id="S5.T2.4.2.2.1.m1.1"><semantics id="S5.T2.4.2.2.1.m1.1a"><msub id="S5.T2.4.2.2.1.m1.1.1" xref="S5.T2.4.2.2.1.m1.1.1.cmml"><mi id="S5.T2.4.2.2.1.m1.1.1.2" xref="S5.T2.4.2.2.1.m1.1.1.2.cmml">L</mi><mrow id="S5.T2.4.2.2.1.m1.1.1.3" xref="S5.T2.4.2.2.1.m1.1.1.3.cmml"><mi id="S5.T2.4.2.2.1.m1.1.1.3.2" xref="S5.T2.4.2.2.1.m1.1.1.3.2.cmml">d</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.3" xref="S5.T2.4.2.2.1.m1.1.1.3.3.cmml">i</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1a" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.4" xref="S5.T2.4.2.2.1.m1.1.1.3.4.cmml">s</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1b" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.5" xref="S5.T2.4.2.2.1.m1.1.1.3.5.cmml">t</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1c" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.6" xref="S5.T2.4.2.2.1.m1.1.1.3.6.cmml">r</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1d" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.7" xref="S5.T2.4.2.2.1.m1.1.1.3.7.cmml">i</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1e" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.8" xref="S5.T2.4.2.2.1.m1.1.1.3.8.cmml">b</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1f" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.9" xref="S5.T2.4.2.2.1.m1.1.1.3.9.cmml">u</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1g" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.10" xref="S5.T2.4.2.2.1.m1.1.1.3.10.cmml">t</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1h" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.11" xref="S5.T2.4.2.2.1.m1.1.1.3.11.cmml">i</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1i" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.12" xref="S5.T2.4.2.2.1.m1.1.1.3.12.cmml">o</mi><mo id="S5.T2.4.2.2.1.m1.1.1.3.1j" xref="S5.T2.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.4.2.2.1.m1.1.1.3.13" xref="S5.T2.4.2.2.1.m1.1.1.3.13.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T2.4.2.2.1.m1.1b"><apply id="S5.T2.4.2.2.1.m1.1.1.cmml" xref="S5.T2.4.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T2.4.2.2.1.m1.1.1.1.cmml" xref="S5.T2.4.2.2.1.m1.1.1">subscript</csymbol><ci id="S5.T2.4.2.2.1.m1.1.1.2.cmml" xref="S5.T2.4.2.2.1.m1.1.1.2">𝐿</ci><apply id="S5.T2.4.2.2.1.m1.1.1.3.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3"><times id="S5.T2.4.2.2.1.m1.1.1.3.1.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.1"></times><ci id="S5.T2.4.2.2.1.m1.1.1.3.2.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.2">𝑑</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.3.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.3">𝑖</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.4.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.4">𝑠</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.5.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.5">𝑡</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.6.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.6">𝑟</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.7.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.7">𝑖</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.8.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.8">𝑏</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.9.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.9">𝑢</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.10.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.10">𝑡</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.11.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.11">𝑖</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.12.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.12">𝑜</ci><ci id="S5.T2.4.2.2.1.m1.1.1.3.13.cmml" xref="S5.T2.4.2.2.1.m1.1.1.3.13">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.4.2.2.1.m1.1c">L_{distribution}</annotation><annotation encoding="application/x-llamapun" id="S5.T2.4.2.2.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_r italic_i italic_b italic_u italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.2.2.2">19.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.2.2.3">30.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.2.2.4">21.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.4.2.2.5">43.6</td>
</tr>
<tr class="ltx_tr" id="S5.T2.5.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S5.T2.5.3.3.1">- <math alttext="L_{per}" class="ltx_Math" display="inline" id="S5.T2.5.3.3.1.m1.1"><semantics id="S5.T2.5.3.3.1.m1.1a"><msub id="S5.T2.5.3.3.1.m1.1.1" xref="S5.T2.5.3.3.1.m1.1.1.cmml"><mi id="S5.T2.5.3.3.1.m1.1.1.2" xref="S5.T2.5.3.3.1.m1.1.1.2.cmml">L</mi><mrow id="S5.T2.5.3.3.1.m1.1.1.3" xref="S5.T2.5.3.3.1.m1.1.1.3.cmml"><mi id="S5.T2.5.3.3.1.m1.1.1.3.2" xref="S5.T2.5.3.3.1.m1.1.1.3.2.cmml">p</mi><mo id="S5.T2.5.3.3.1.m1.1.1.3.1" xref="S5.T2.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.5.3.3.1.m1.1.1.3.3" xref="S5.T2.5.3.3.1.m1.1.1.3.3.cmml">e</mi><mo id="S5.T2.5.3.3.1.m1.1.1.3.1a" xref="S5.T2.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T2.5.3.3.1.m1.1.1.3.4" xref="S5.T2.5.3.3.1.m1.1.1.3.4.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T2.5.3.3.1.m1.1b"><apply id="S5.T2.5.3.3.1.m1.1.1.cmml" xref="S5.T2.5.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T2.5.3.3.1.m1.1.1.1.cmml" xref="S5.T2.5.3.3.1.m1.1.1">subscript</csymbol><ci id="S5.T2.5.3.3.1.m1.1.1.2.cmml" xref="S5.T2.5.3.3.1.m1.1.1.2">𝐿</ci><apply id="S5.T2.5.3.3.1.m1.1.1.3.cmml" xref="S5.T2.5.3.3.1.m1.1.1.3"><times id="S5.T2.5.3.3.1.m1.1.1.3.1.cmml" xref="S5.T2.5.3.3.1.m1.1.1.3.1"></times><ci id="S5.T2.5.3.3.1.m1.1.1.3.2.cmml" xref="S5.T2.5.3.3.1.m1.1.1.3.2">𝑝</ci><ci id="S5.T2.5.3.3.1.m1.1.1.3.3.cmml" xref="S5.T2.5.3.3.1.m1.1.1.3.3">𝑒</ci><ci id="S5.T2.5.3.3.1.m1.1.1.3.4.cmml" xref="S5.T2.5.3.3.1.m1.1.1.3.4">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.5.3.3.1.m1.1c">L_{per}</annotation><annotation encoding="application/x-llamapun" id="S5.T2.5.3.3.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_p italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T2.5.3.3.2">16.9</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T2.5.3.3.3">32.1</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T2.5.3.3.4">15.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S5.T2.5.3.3.5">27.0</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F8">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="115" id="S5.F8.g1" src="extracted/5846543/pics_jpg/compareconfig.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F8.2"><span class="ltx_text ltx_inline-block" id="S5.F8.2.1" style="font-size:90%;width:104.1pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F8.2.2" style="font-size:90%;width:104.1pt;">Per Mask</span>
<span class="ltx_text ltx_inline-block" id="S5.F8.2.3" style="font-size:90%;width:104.1pt;">Pixels</span>
<span class="ltx_text ltx_inline-block" id="S5.F8.2.4" style="font-size:90%;width:104.1pt;">Pixels&amp;Patches</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F8.3.1.1" style="font-size:90%;">Figure 8</span>: </span><span class="ltx_text" id="S5.F8.4.2" style="font-size:90%;">Comparison of different refinement configurations. Refining pixels on all extracted shadow edges and patches per material mask yields the best performance.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S5.F9">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="115" id="S5.F9.g1" src="extracted/5846543/pics_jpg/edgecompare.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F9.2"><span class="ltx_text ltx_inline-block" id="S5.F9.2.1" style="font-size:90%;width:104.1pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F9.2.2" style="width:104.1pt;"><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S5.F9.2.2.1.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S5.F9.2.2.2.2" style="font-size:90%;">]</span></cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F9.2.3" style="font-size:90%;width:104.1pt;">All Edges</span>
<span class="ltx_text ltx_inline-block" id="S5.F9.2.4" style="font-size:90%;width:104.1pt;">MC Edges</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F9.3.1.1" style="font-size:90%;">Figure 9</span>: </span><span class="ltx_text" id="S5.F9.4.2" style="font-size:90%;">Example of using proposed edge extraction. We show the refined outputs using all shadow edges (colored in red), and the refined outputs using only our extracted material-consistent shadow edges (colored in green). Using extracted MC edges improves the performance from 0.0372 to 0.0039.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS3.p3">
<p class="ltx_p" id="S5.SS3.p3.3"><span class="ltx_text ltx_font_bold" id="S5.SS3.p3.3.1">Proposed Losses.</span>
Our adaptation method comprises four loss functions.
In <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T2" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">2</span></a>, we present experimental results by ablation of each of these losses.
<math alttext="L_{distance}" class="ltx_Math" display="inline" id="S5.SS3.p3.1.m1.1"><semantics id="S5.SS3.p3.1.m1.1a"><msub id="S5.SS3.p3.1.m1.1.1" xref="S5.SS3.p3.1.m1.1.1.cmml"><mi id="S5.SS3.p3.1.m1.1.1.2" xref="S5.SS3.p3.1.m1.1.1.2.cmml">L</mi><mrow id="S5.SS3.p3.1.m1.1.1.3" xref="S5.SS3.p3.1.m1.1.1.3.cmml"><mi id="S5.SS3.p3.1.m1.1.1.3.2" xref="S5.SS3.p3.1.m1.1.1.3.2.cmml">d</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.3" xref="S5.SS3.p3.1.m1.1.1.3.3.cmml">i</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1a" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.4" xref="S5.SS3.p3.1.m1.1.1.3.4.cmml">s</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1b" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.5" xref="S5.SS3.p3.1.m1.1.1.3.5.cmml">t</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1c" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.6" xref="S5.SS3.p3.1.m1.1.1.3.6.cmml">a</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1d" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.7" xref="S5.SS3.p3.1.m1.1.1.3.7.cmml">n</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1e" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.8" xref="S5.SS3.p3.1.m1.1.1.3.8.cmml">c</mi><mo id="S5.SS3.p3.1.m1.1.1.3.1f" xref="S5.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.1.m1.1.1.3.9" xref="S5.SS3.p3.1.m1.1.1.3.9.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.1.m1.1b"><apply id="S5.SS3.p3.1.m1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.1.m1.1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.p3.1.m1.1.1.2.cmml" xref="S5.SS3.p3.1.m1.1.1.2">𝐿</ci><apply id="S5.SS3.p3.1.m1.1.1.3.cmml" xref="S5.SS3.p3.1.m1.1.1.3"><times id="S5.SS3.p3.1.m1.1.1.3.1.cmml" xref="S5.SS3.p3.1.m1.1.1.3.1"></times><ci id="S5.SS3.p3.1.m1.1.1.3.2.cmml" xref="S5.SS3.p3.1.m1.1.1.3.2">𝑑</ci><ci id="S5.SS3.p3.1.m1.1.1.3.3.cmml" xref="S5.SS3.p3.1.m1.1.1.3.3">𝑖</ci><ci id="S5.SS3.p3.1.m1.1.1.3.4.cmml" xref="S5.SS3.p3.1.m1.1.1.3.4">𝑠</ci><ci id="S5.SS3.p3.1.m1.1.1.3.5.cmml" xref="S5.SS3.p3.1.m1.1.1.3.5">𝑡</ci><ci id="S5.SS3.p3.1.m1.1.1.3.6.cmml" xref="S5.SS3.p3.1.m1.1.1.3.6">𝑎</ci><ci id="S5.SS3.p3.1.m1.1.1.3.7.cmml" xref="S5.SS3.p3.1.m1.1.1.3.7">𝑛</ci><ci id="S5.SS3.p3.1.m1.1.1.3.8.cmml" xref="S5.SS3.p3.1.m1.1.1.3.8">𝑐</ci><ci id="S5.SS3.p3.1.m1.1.1.3.9.cmml" xref="S5.SS3.p3.1.m1.1.1.3.9">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.1.m1.1c">L_{distance}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{distribution}" class="ltx_Math" display="inline" id="S5.SS3.p3.2.m2.1"><semantics id="S5.SS3.p3.2.m2.1a"><msub id="S5.SS3.p3.2.m2.1.1" xref="S5.SS3.p3.2.m2.1.1.cmml"><mi id="S5.SS3.p3.2.m2.1.1.2" xref="S5.SS3.p3.2.m2.1.1.2.cmml">L</mi><mrow id="S5.SS3.p3.2.m2.1.1.3" xref="S5.SS3.p3.2.m2.1.1.3.cmml"><mi id="S5.SS3.p3.2.m2.1.1.3.2" xref="S5.SS3.p3.2.m2.1.1.3.2.cmml">d</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.3" xref="S5.SS3.p3.2.m2.1.1.3.3.cmml">i</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1a" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.4" xref="S5.SS3.p3.2.m2.1.1.3.4.cmml">s</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1b" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.5" xref="S5.SS3.p3.2.m2.1.1.3.5.cmml">t</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1c" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.6" xref="S5.SS3.p3.2.m2.1.1.3.6.cmml">r</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1d" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.7" xref="S5.SS3.p3.2.m2.1.1.3.7.cmml">i</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1e" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.8" xref="S5.SS3.p3.2.m2.1.1.3.8.cmml">b</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1f" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.9" xref="S5.SS3.p3.2.m2.1.1.3.9.cmml">u</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1g" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.10" xref="S5.SS3.p3.2.m2.1.1.3.10.cmml">t</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1h" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.11" xref="S5.SS3.p3.2.m2.1.1.3.11.cmml">i</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1i" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.12" xref="S5.SS3.p3.2.m2.1.1.3.12.cmml">o</mi><mo id="S5.SS3.p3.2.m2.1.1.3.1j" xref="S5.SS3.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.2.m2.1.1.3.13" xref="S5.SS3.p3.2.m2.1.1.3.13.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.2.m2.1b"><apply id="S5.SS3.p3.2.m2.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.2.m2.1.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.p3.2.m2.1.1.2.cmml" xref="S5.SS3.p3.2.m2.1.1.2">𝐿</ci><apply id="S5.SS3.p3.2.m2.1.1.3.cmml" xref="S5.SS3.p3.2.m2.1.1.3"><times id="S5.SS3.p3.2.m2.1.1.3.1.cmml" xref="S5.SS3.p3.2.m2.1.1.3.1"></times><ci id="S5.SS3.p3.2.m2.1.1.3.2.cmml" xref="S5.SS3.p3.2.m2.1.1.3.2">𝑑</ci><ci id="S5.SS3.p3.2.m2.1.1.3.3.cmml" xref="S5.SS3.p3.2.m2.1.1.3.3">𝑖</ci><ci id="S5.SS3.p3.2.m2.1.1.3.4.cmml" xref="S5.SS3.p3.2.m2.1.1.3.4">𝑠</ci><ci id="S5.SS3.p3.2.m2.1.1.3.5.cmml" xref="S5.SS3.p3.2.m2.1.1.3.5">𝑡</ci><ci id="S5.SS3.p3.2.m2.1.1.3.6.cmml" xref="S5.SS3.p3.2.m2.1.1.3.6">𝑟</ci><ci id="S5.SS3.p3.2.m2.1.1.3.7.cmml" xref="S5.SS3.p3.2.m2.1.1.3.7">𝑖</ci><ci id="S5.SS3.p3.2.m2.1.1.3.8.cmml" xref="S5.SS3.p3.2.m2.1.1.3.8">𝑏</ci><ci id="S5.SS3.p3.2.m2.1.1.3.9.cmml" xref="S5.SS3.p3.2.m2.1.1.3.9">𝑢</ci><ci id="S5.SS3.p3.2.m2.1.1.3.10.cmml" xref="S5.SS3.p3.2.m2.1.1.3.10">𝑡</ci><ci id="S5.SS3.p3.2.m2.1.1.3.11.cmml" xref="S5.SS3.p3.2.m2.1.1.3.11">𝑖</ci><ci id="S5.SS3.p3.2.m2.1.1.3.12.cmml" xref="S5.SS3.p3.2.m2.1.1.3.12">𝑜</ci><ci id="S5.SS3.p3.2.m2.1.1.3.13.cmml" xref="S5.SS3.p3.2.m2.1.1.3.13">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.2.m2.1c">L_{distribution}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_d italic_i italic_s italic_t italic_r italic_i italic_b italic_u italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math> enforce color matching and distribution alignment along the shadow edges, while the <math alttext="L_{per}" class="ltx_Math" display="inline" id="S5.SS3.p3.3.m3.1"><semantics id="S5.SS3.p3.3.m3.1a"><msub id="S5.SS3.p3.3.m3.1.1" xref="S5.SS3.p3.3.m3.1.1.cmml"><mi id="S5.SS3.p3.3.m3.1.1.2" xref="S5.SS3.p3.3.m3.1.1.2.cmml">L</mi><mrow id="S5.SS3.p3.3.m3.1.1.3" xref="S5.SS3.p3.3.m3.1.1.3.cmml"><mi id="S5.SS3.p3.3.m3.1.1.3.2" xref="S5.SS3.p3.3.m3.1.1.3.2.cmml">p</mi><mo id="S5.SS3.p3.3.m3.1.1.3.1" xref="S5.SS3.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.3.m3.1.1.3.3" xref="S5.SS3.p3.3.m3.1.1.3.3.cmml">e</mi><mo id="S5.SS3.p3.3.m3.1.1.3.1a" xref="S5.SS3.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p3.3.m3.1.1.3.4" xref="S5.SS3.p3.3.m3.1.1.3.4.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.3.m3.1b"><apply id="S5.SS3.p3.3.m3.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.3.m3.1.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1">subscript</csymbol><ci id="S5.SS3.p3.3.m3.1.1.2.cmml" xref="S5.SS3.p3.3.m3.1.1.2">𝐿</ci><apply id="S5.SS3.p3.3.m3.1.1.3.cmml" xref="S5.SS3.p3.3.m3.1.1.3"><times id="S5.SS3.p3.3.m3.1.1.3.1.cmml" xref="S5.SS3.p3.3.m3.1.1.3.1"></times><ci id="S5.SS3.p3.3.m3.1.1.3.2.cmml" xref="S5.SS3.p3.3.m3.1.1.3.2">𝑝</ci><ci id="S5.SS3.p3.3.m3.1.1.3.3.cmml" xref="S5.SS3.p3.3.m3.1.1.3.3">𝑒</ci><ci id="S5.SS3.p3.3.m3.1.1.3.4.cmml" xref="S5.SS3.p3.3.m3.1.1.3.4">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.3.m3.1c">L_{per}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.3.m3.1d">italic_L start_POSTSUBSCRIPT italic_p italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math> ensures texture consistency within the same material. The combination of these three losses achieves the best performance.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4 </span>Cross dataset testing</h3>
<div class="ltx_para" id="S5.SS4.p1">
<p class="ltx_p" id="S5.SS4.p1.1">To further demonstrate our adaptation method’s performance on adapting to out-of-distribution images, we apply our method on ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> pre-trained on the SRD dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib30" title="">30</a>]</cite> (shadow masks provided by DHAN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib5" title="">5</a>]</cite>) and the ISTD dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib37" title="">37</a>]</cite> to test on the ISTD+ test set.
Note that images from the SRD and ISTD datasets exhibit different light intensities between training shadow and shadow-free image pairs, due to the image acquisition process. Thus, models pre-trained on those datasets often alter the overall color intensity of the whole input image.</p>
</div>
<div class="ltx_para" id="S5.SS4.p2">
<p class="ltx_p" id="S5.SS4.p2.2">To address this, we additionally calculate the Mean Squared Error (MSE) loss of the non-shadow region pixels, denoted as <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S5.SS4.p2.1.m1.1"><semantics id="S5.SS4.p2.1.m1.1a"><msub id="S5.SS4.p2.1.m1.1.1" xref="S5.SS4.p2.1.m1.1.1.cmml"><mi id="S5.SS4.p2.1.m1.1.1.2" xref="S5.SS4.p2.1.m1.1.1.2.cmml">L</mi><mrow id="S5.SS4.p2.1.m1.1.1.3" xref="S5.SS4.p2.1.m1.1.1.3.cmml"><mi id="S5.SS4.p2.1.m1.1.1.3.2" xref="S5.SS4.p2.1.m1.1.1.3.2.cmml">n</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.3" xref="S5.SS4.p2.1.m1.1.1.3.3.cmml">o</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1a" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.4" xref="S5.SS4.p2.1.m1.1.1.3.4.cmml">n</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1b" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.5" xref="S5.SS4.p2.1.m1.1.1.3.5.cmml">s</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1c" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.6" xref="S5.SS4.p2.1.m1.1.1.3.6.cmml">h</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1d" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.7" xref="S5.SS4.p2.1.m1.1.1.3.7.cmml">a</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1e" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.8" xref="S5.SS4.p2.1.m1.1.1.3.8.cmml">d</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1f" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.9" xref="S5.SS4.p2.1.m1.1.1.3.9.cmml">o</mi><mo id="S5.SS4.p2.1.m1.1.1.3.1g" xref="S5.SS4.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.1.m1.1.1.3.10" xref="S5.SS4.p2.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.1.m1.1b"><apply id="S5.SS4.p2.1.m1.1.1.cmml" xref="S5.SS4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.1.m1.1.1.1.cmml" xref="S5.SS4.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS4.p2.1.m1.1.1.2.cmml" xref="S5.SS4.p2.1.m1.1.1.2">𝐿</ci><apply id="S5.SS4.p2.1.m1.1.1.3.cmml" xref="S5.SS4.p2.1.m1.1.1.3"><times id="S5.SS4.p2.1.m1.1.1.3.1.cmml" xref="S5.SS4.p2.1.m1.1.1.3.1"></times><ci id="S5.SS4.p2.1.m1.1.1.3.2.cmml" xref="S5.SS4.p2.1.m1.1.1.3.2">𝑛</ci><ci id="S5.SS4.p2.1.m1.1.1.3.3.cmml" xref="S5.SS4.p2.1.m1.1.1.3.3">𝑜</ci><ci id="S5.SS4.p2.1.m1.1.1.3.4.cmml" xref="S5.SS4.p2.1.m1.1.1.3.4">𝑛</ci><ci id="S5.SS4.p2.1.m1.1.1.3.5.cmml" xref="S5.SS4.p2.1.m1.1.1.3.5">𝑠</ci><ci id="S5.SS4.p2.1.m1.1.1.3.6.cmml" xref="S5.SS4.p2.1.m1.1.1.3.6">ℎ</ci><ci id="S5.SS4.p2.1.m1.1.1.3.7.cmml" xref="S5.SS4.p2.1.m1.1.1.3.7">𝑎</ci><ci id="S5.SS4.p2.1.m1.1.1.3.8.cmml" xref="S5.SS4.p2.1.m1.1.1.3.8">𝑑</ci><ci id="S5.SS4.p2.1.m1.1.1.3.9.cmml" xref="S5.SS4.p2.1.m1.1.1.3.9">𝑜</ci><ci id="S5.SS4.p2.1.m1.1.1.3.10.cmml" xref="S5.SS4.p2.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>.
<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T3" title="In 5.4 Cross dataset testing ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">3</span></a> presents the ISTD+ test results of those models with and without our proposed adaptation method. With our adaptation method, the output images exhibit correct colors for both shadow and non-shadow regions, outperforming pre-trained models in both MAE and CDD measurements.
As illustrated in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F10" title="In 5.4 Cross dataset testing ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">10</span></a>, the ISTD pre-trained model alters the overall light intensity of the image, resulting in subpar performance on ISTD+ test cases. In contrast, our adaptation method effectively corrects this error through the design of <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S5.SS4.p2.2.m2.1"><semantics id="S5.SS4.p2.2.m2.1a"><msub id="S5.SS4.p2.2.m2.1.1" xref="S5.SS4.p2.2.m2.1.1.cmml"><mi id="S5.SS4.p2.2.m2.1.1.2" xref="S5.SS4.p2.2.m2.1.1.2.cmml">L</mi><mrow id="S5.SS4.p2.2.m2.1.1.3" xref="S5.SS4.p2.2.m2.1.1.3.cmml"><mi id="S5.SS4.p2.2.m2.1.1.3.2" xref="S5.SS4.p2.2.m2.1.1.3.2.cmml">n</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.3" xref="S5.SS4.p2.2.m2.1.1.3.3.cmml">o</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1a" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.4" xref="S5.SS4.p2.2.m2.1.1.3.4.cmml">n</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1b" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.5" xref="S5.SS4.p2.2.m2.1.1.3.5.cmml">s</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1c" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.6" xref="S5.SS4.p2.2.m2.1.1.3.6.cmml">h</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1d" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.7" xref="S5.SS4.p2.2.m2.1.1.3.7.cmml">a</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1e" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.8" xref="S5.SS4.p2.2.m2.1.1.3.8.cmml">d</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1f" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.9" xref="S5.SS4.p2.2.m2.1.1.3.9.cmml">o</mi><mo id="S5.SS4.p2.2.m2.1.1.3.1g" xref="S5.SS4.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.2.m2.1.1.3.10" xref="S5.SS4.p2.2.m2.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.2.m2.1b"><apply id="S5.SS4.p2.2.m2.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.2.m2.1.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS4.p2.2.m2.1.1.2.cmml" xref="S5.SS4.p2.2.m2.1.1.2">𝐿</ci><apply id="S5.SS4.p2.2.m2.1.1.3.cmml" xref="S5.SS4.p2.2.m2.1.1.3"><times id="S5.SS4.p2.2.m2.1.1.3.1.cmml" xref="S5.SS4.p2.2.m2.1.1.3.1"></times><ci id="S5.SS4.p2.2.m2.1.1.3.2.cmml" xref="S5.SS4.p2.2.m2.1.1.3.2">𝑛</ci><ci id="S5.SS4.p2.2.m2.1.1.3.3.cmml" xref="S5.SS4.p2.2.m2.1.1.3.3">𝑜</ci><ci id="S5.SS4.p2.2.m2.1.1.3.4.cmml" xref="S5.SS4.p2.2.m2.1.1.3.4">𝑛</ci><ci id="S5.SS4.p2.2.m2.1.1.3.5.cmml" xref="S5.SS4.p2.2.m2.1.1.3.5">𝑠</ci><ci id="S5.SS4.p2.2.m2.1.1.3.6.cmml" xref="S5.SS4.p2.2.m2.1.1.3.6">ℎ</ci><ci id="S5.SS4.p2.2.m2.1.1.3.7.cmml" xref="S5.SS4.p2.2.m2.1.1.3.7">𝑎</ci><ci id="S5.SS4.p2.2.m2.1.1.3.8.cmml" xref="S5.SS4.p2.2.m2.1.1.3.8">𝑑</ci><ci id="S5.SS4.p2.2.m2.1.1.3.9.cmml" xref="S5.SS4.p2.2.m2.1.1.3.9">𝑜</ci><ci id="S5.SS4.p2.2.m2.1.1.3.10.cmml" xref="S5.SS4.p2.2.m2.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.2.m2.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>, which enforces color consistency in the non-shadow regions.</p>
</div>
<figure class="ltx_table" id="S5.T3">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T3.2.1.1" style="font-size:90%;">Table 3</span>: </span><span class="ltx_text" id="S5.T3.3.2" style="font-size:90%;">Quantitative results on cross dataset testing. ISTD pre-trained ShadowFormer and SRD pre-trained ShadowFormer are tested on the ISTD+ test set. </span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T3.4" style="width:433.6pt;height:134pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(42.1pt,-13.0pt) scale(1.24068521880008,1.24068521880008) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T3.4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T3.4.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S5.T3.4.1.1.1.1" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.1.1.1.1">Trained On</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S5.T3.4.1.1.1.2" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.1.1.2.1">Tested On</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="S5.T3.4.1.1.1.3" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.1.1.3.1">Methods</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="3" id="S5.T3.4.1.1.1.4">MAE</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S5.T3.4.1.1.1.5">CDD</td>
</tr>
<tr class="ltx_tr" id="S5.T3.4.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.2.2.1">S</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.2.2.2">NS</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.2.2.3">A</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.2.2.4">Mean</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.2.2.5">Var</td>
</tr>
<tr class="ltx_tr" id="S5.T3.4.1.3.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S5.T3.4.1.3.3.1" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.3.3.1.1">SRD</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S5.T3.4.1.3.3.2" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.3.3.2.1">ISTD+</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.4.1.3.3.3">w.o. Ours</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.3.3.4">13.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.3.3.5">3.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.3.3.6">5.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.3.3.7">55.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T3.4.1.3.3.8">43.3</td>
</tr>
<tr class="ltx_tr" id="S5.T3.4.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.4.1.4.4.1">w. Ours</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.4.4.2">6.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.4.4.3">2.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.4.4.4">3.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.4.4.5">8.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T3.4.1.4.4.6">9.4</td>
</tr>
<tr class="ltx_tr" id="S5.T3.4.1.5.5">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S5.T3.4.1.5.5.1" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.5.5.1.1">ISTD</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S5.T3.4.1.5.5.2" rowspan="2"><span class="ltx_text" id="S5.T3.4.1.5.5.2.1">ISTD+</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.4.1.5.5.3">w.o. Ours</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.5.5.4">10.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.5.5.5">6.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.5.5.6">7.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.4.1.5.5.7">11.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T3.4.1.5.5.8">17.7</td>
</tr>
<tr class="ltx_tr" id="S5.T3.4.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.1">w. Ours</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.2">6.3</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.3">2.7</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.4">3.4</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.5">1.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S5.T3.4.1.6.6.6">3.1</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F10">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="228" id="S5.F10.g1" src="extracted/5846543/pics_jpg/cross.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F10.2"><span class="ltx_text ltx_inline-block" id="S5.F10.2.1" style="font-size:90%;width:104.1pt;">(a) Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F10.2.2" style="font-size:90%;width:104.1pt;">(b) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F10.2.3" style="font-size:90%;width:104.1pt;">(c) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>+Ours</span>
<span class="ltx_text ltx_inline-block" id="S5.F10.2.4" style="font-size:90%;width:104.1pt;">(d) GT</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F10.3.1.1" style="font-size:90%;">Figure 10</span>: </span><span class="ltx_text" id="S5.F10.4.2" style="font-size:90%;">Qualitative comparison on cross dataset testing. We use ISTD pre-trained ShadowFormer and test it on the ISTD+ test set. (a) shows input image, (b) shows ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> result, (c) presents the results with refinement, and (d) presents the ground truth. We also plot the error maps on the corner.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.5 </span>Limitations</h3>
<div class="ltx_para" id="S5.SS5.p1">
<p class="ltx_p" id="S5.SS5.p1.1">Our adaptation method has several limitations that can be interesting directions for future work.
First, we do not enforce specific constraints on the penumbra shadow regions. Handling the smooth changing shadow effects on those areas is challenging for all shadow removal methods, including ours, which often leaves noticeable shadow edge artifacts (see <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.F11" title="In 5.5 Limitations ‣ 5 Experiments ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">11</span></a>). While our method focuses on fixing the color discrepancy, future research could explore mitigating edge artifacts, particularly for out-of-distribution test cases.
Second, our approach involves iterative refinement of the pre-trained model using extracted self-supervision, leading to a computational overhead of approximately 24 seconds per image. Last, we mainly focus on the supervision obtained from material-consistent edges. The remaining part of the shadow edge might also be helpful for understanding and removing the shadow.</p>
</div>
<figure class="ltx_figure" id="S5.F11">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="228" id="S5.F11.g1" src="extracted/5846543/pics_jpg/failure.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S5.F11.2"><span class="ltx_text ltx_inline-block" id="S5.F11.2.1" style="font-size:90%;width:104.1pt;">(a) Input</span>
<span class="ltx_text ltx_inline-block" id="S5.F11.2.2" style="font-size:90%;width:104.1pt;">(b) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F11.2.3" style="font-size:90%;width:104.1pt;">(c) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib26" title="">26</a>]</cite></span>
<span class="ltx_text ltx_inline-block" id="S5.F11.2.4" style="font-size:90%;width:104.1pt;">(d) Ours</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F11.4.1.1" style="font-size:90%;">Figure 11</span>: </span><span class="ltx_text ltx_font_bold" id="S5.F11.5.2" style="font-size:90%;">Limitation on shadow edges.<span class="ltx_text ltx_font_medium" id="S5.F11.5.2.1"> We show the results of SOTA methods on our test images, visible edge artifacts are caused by the limited adaptability of pre-trained models. Our refinement mainly focuses on the color discrepancy in the shadow region.</span></span></figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">We introduce a test-time self-supervised adaptation method for deep-learning shadow removal.
To gather the supervision signal, we fine-tune the image foundation model, SAM, to generate shadow-invariant segmentation masks, effectively extracting shadow edges that traverse the same material.
Pixels near these edges and patches within the same material provide valuable supervision.
We then propose an iterative adaptation approach for the pre-trained model using the collected supervision to ensure color and texture consistency.
We demonstrate that our proposed losses significantly enhance deep shadow removal, both qualitatively and quantitatively, across various challenging testing cases.
Moreover, we introduce a benchmark test set and a metric that enable the evaluation of shadow removal methods on images with complex shadows, even in the absence of shadow-free ground truth images.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography" style="font-size:90%;">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_tag_bibitem">[1]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib1.1.1" style="font-size:90%;">
Harry G. Barrow and J. Martin Tenenbaum.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib1.2.1" style="font-size:90%;">Recovering intrinsic scene characteristics from images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib1.3.1" style="font-size:90%;">Computer Vision Systems</span><span class="ltx_text" id="bib.bib1.4.2" style="font-size:90%;">, pages 3–26, 1978.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_tag_bibitem">[2]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.1.1" style="font-size:90%;">
Tianrun Chen, Lanyun Zhu, Chaotao Deng, Runlong Cao, Yan Wang, Shangzhan Zhang, Zejian Li, Lingyun Sun, Ying Zang, and Papa Mao.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.2.1" style="font-size:90%;">Sam-adapter: Adapting segment anything in underperformed scenes.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib2.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF International Conference on Computer Vision</span><span class="ltx_text" id="bib.bib2.5.3" style="font-size:90%;">, pages 3367–3375, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_tag_bibitem">[3]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib3.1.1" style="font-size:90%;">
Zipei Chen, Chengjiang Long, Ling Zhang, and Chunxia Xiao.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib3.2.1" style="font-size:90%;">Canet: A context-aware network for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib3.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib3.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF international conference on computer vision</span><span class="ltx_text" id="bib.bib3.5.3" style="font-size:90%;">, pages 4743–4752, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_tag_bibitem">[4]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.1.1" style="font-size:90%;">
M. Cimpoi, S. Maji, I. Kokkinos, S. Mohamed, , and A. Vedaldi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.2.1" style="font-size:90%;">Describing textures in the wild.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib4.4.2" style="font-size:90%;">Proceedings of the IEEE Conf. on Computer Vision and Pattern Recognition (CVPR)</span><span class="ltx_text" id="bib.bib4.5.3" style="font-size:90%;">, 2014.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_tag_bibitem">[5]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.1.1" style="font-size:90%;">
Xiaodong Cun, Chi-Man Pun, and Cheng Shi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.2.1" style="font-size:90%;">Towards ghost-free shadow removal via dual hierarchical aggregation network and shadow matting gan.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib5.4.2" style="font-size:90%;">Proceedings of the AAAI Conference on Artificial Intelligence</span><span class="ltx_text" id="bib.bib5.5.3" style="font-size:90%;">, volume 34, pages 10680–10687, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_tag_bibitem">[6]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib6.1.1" style="font-size:90%;">
Bin Ding, Chengjiang Long, Ling Zhang, and Chunxia Xiao.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib6.2.1" style="font-size:90%;">Argan: Attentive recurrent generative adversarial network for shadow detection and removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib6.3.1" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib6.4.2" style="font-size:90%;">, pages 10212–10221, 2019.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_tag_bibitem">[7]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.1.1" style="font-size:90%;">
Mark S. Drew.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.2.1" style="font-size:90%;">Recovery of chromaticity image free from shadows via illumination invariance.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib7.4.2" style="font-size:90%;">In IEEE Workshop on Color and Photometric Methods in Computer Vision, ICCV’03</span><span class="ltx_text" id="bib.bib7.5.3" style="font-size:90%;">, pages 32–39, 2003.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_tag_bibitem">[8]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib8.1.1" style="font-size:90%;">
Graham Finlayson, Mark Drew, and Cheng Lu.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib8.2.1" style="font-size:90%;">Entropy minimization for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib8.3.1" style="font-size:90%;">IJCV</span><span class="ltx_text" id="bib.bib8.4.2" style="font-size:90%;">, 2009.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_tag_bibitem">[9]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.1.1" style="font-size:90%;">
Graham Finlayson and Mark S. Drew.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.2.1" style="font-size:90%;">4-sensor camera calibration for image representation invariant to shading, shadows, lighting, and specularities.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib9.4.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib9.5.3" style="font-size:90%;">, volume 2, pages 473–480 vol.2, July 2001.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_tag_bibitem">[10]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib10.1.1" style="font-size:90%;">
Graham Finlayson, Steven D. Hordley, and Mark S. Drew.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib10.2.1" style="font-size:90%;">Removing shadows from images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib10.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib10.4.2" style="font-size:90%;">ECCV</span><span class="ltx_text" id="bib.bib10.5.3" style="font-size:90%;">, ECCV ’02, pages 823–836, London, UK, UK, 2002. Springer-Verlag.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_tag_bibitem">[11]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib11.1.1" style="font-size:90%;">
Graham D Finlayson, Steven D Hordley, Cheng Lu, and Mark S Drew.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib11.2.1" style="font-size:90%;">On the removal of shadows from images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib11.3.1" style="font-size:90%;">IEEE transactions on pattern analysis and machine intelligence</span><span class="ltx_text" id="bib.bib11.4.2" style="font-size:90%;">, 28(1):59–68, 2005.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_tag_bibitem">[12]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.1.1" style="font-size:90%;">
Lan Fu, Changqing Zhou, Qing Guo, Felix Juefei-Xu, Hongkai Yu, Wei Feng, Yang Liu, and Song Wang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.2.1" style="font-size:90%;">Auto-exposure fusion for single-image shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib12.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF conference on computer vision and pattern recognition</span><span class="ltx_text" id="bib.bib12.5.3" style="font-size:90%;">, pages 10571–10580, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_tag_bibitem">[13]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib13.1.1" style="font-size:90%;">
Lanqing Guo, Siyu Huang, Ding Liu, Hao Cheng, and Bihan Wen.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib13.2.1" style="font-size:90%;">Shadowformer: Global context helps image shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib13.3.1" style="font-size:90%;">arXiv preprint arXiv:2302.01650</span><span class="ltx_text" id="bib.bib13.4.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_tag_bibitem">[14]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib14.1.1" style="font-size:90%;">
Lanqing Guo, Chong Wang, Wenhan Yang, Siyu Huang, Yufei Wang, Hanspeter Pfister, and Bihan Wen.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib14.2.1" style="font-size:90%;">Shadowdiffusion: When degradation prior meets diffusion model for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib14.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib14.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</span><span class="ltx_text" id="bib.bib14.5.3" style="font-size:90%;">, pages 14049–14058, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_tag_bibitem">[15]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib15.1.1" style="font-size:90%;">
Lanqing Guo, Chong Wang, Wenhan Yang, Yufei Wang, and Bihan Wen.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib15.2.1" style="font-size:90%;">Boundary-aware divide and conquer: A diffusion-based solution for unsupervised shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib15.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib15.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF International Conference on Computer Vision</span><span class="ltx_text" id="bib.bib15.5.3" style="font-size:90%;">, pages 13045–13054, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_tag_bibitem">[16]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib16.1.1" style="font-size:90%;">
Ruiqi Guo, Qieyun Dai, and Derek Hoiem.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib16.2.1" style="font-size:90%;">Paired regions for shadow detection and removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib16.3.1" style="font-size:90%;">IEEE TPAMI</span><span class="ltx_text" id="bib.bib16.4.2" style="font-size:90%;">, 2012.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_tag_bibitem">[17]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.1.1" style="font-size:90%;">
Xiaowei Hu, Yitong Jiang, Chi-Wing Fu, and Pheng-Ann Heng.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.2.1" style="font-size:90%;">Mask-ShadowGAN: Learning to remove shadows from unpaired data.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib17.4.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib17.5.3" style="font-size:90%;">, 2019.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.6.1" style="font-size:90%;">to appear.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_tag_bibitem">[18]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib18.1.1" style="font-size:90%;">
Xiaowei Hu, Tianyu Wang, Chi-Wing Fu, Yitong Jiang, Qiong Wang, and Pheng-Ann Heng.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib18.2.1" style="font-size:90%;">Revisiting shadow detection: A new benchmark dataset for complex world.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib18.3.1" style="font-size:90%;">IEEE Transactions on Image Processing</span><span class="ltx_text" id="bib.bib18.4.2" style="font-size:90%;">, 30:1925–1934, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_tag_bibitem">[19]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib19.1.1" style="font-size:90%;">
Xiang Huang, Gang Hua, J. Tumblin, and L. Williams.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib19.2.1" style="font-size:90%;">What characterizes a shadow boundary under the sun and sky?
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib19.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib19.4.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib19.5.3" style="font-size:90%;">, 2011.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_tag_bibitem">[20]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib20.1.1" style="font-size:90%;">
Yeying Jin, Wenhan Yang, Wei Ye, Yuan Yuan, and Robby T Tan.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib20.2.1" style="font-size:90%;">Des3: Adaptive attention-driven self and soft shadow removal using vit similarity.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib20.3.1" style="font-size:90%;">arXiv preprint arXiv:2211.08089</span><span class="ltx_text" id="bib.bib20.4.2" style="font-size:90%;">, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_tag_bibitem">[21]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib21.1.1" style="font-size:90%;">
H. Khan, M. Bennamoun, F. Sohel, and R Togneri.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib21.2.1" style="font-size:90%;">Automatic shadow detection and removal from a single image.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib21.3.1" style="font-size:90%;">IEEE TPAMI</span><span class="ltx_text" id="bib.bib21.4.2" style="font-size:90%;">, 38(3):431–446, March 2016.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_tag_bibitem">[22]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib22.1.1" style="font-size:90%;">
Alexander Kirillov, Eric Mintun, Nikhila Ravi, Hanzi Mao, Chloe Rolland, Laura Gustafson, Tete Xiao, Spencer Whitehead, Alexander C. Berg, Wan-Yen Lo, Piotr Dollár, and Ross Girshick.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib22.2.1" style="font-size:90%;">Segment anything.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib22.3.1" style="font-size:90%;">arXiv:2304.02643</span><span class="ltx_text" id="bib.bib22.4.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_tag_bibitem">[23]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib23.1.1" style="font-size:90%;">
Hieu Le and Dimitris Samaras.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib23.2.1" style="font-size:90%;">Shadow removal via shadow image decomposition.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib23.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib23.4.2" style="font-size:90%;">The IEEE International Conference on Computer Vision (ICCV)</span><span class="ltx_text" id="bib.bib23.5.3" style="font-size:90%;">, October 2019.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_tag_bibitem">[24]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib24.1.1" style="font-size:90%;">
Hieu Le and Dimitris Samaras.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib24.2.1" style="font-size:90%;">From shadow segmentation to shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib24.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib24.4.2" style="font-size:90%;">ECCV</span><span class="ltx_text" id="bib.bib24.5.3" style="font-size:90%;">, August 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_tag_bibitem">[25]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib25.1.1" style="font-size:90%;">
Hieu Le and Dimitris Samaras.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib25.2.1" style="font-size:90%;">Physics-based shadow image decomposition for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib25.3.1" style="font-size:90%;">IEEE Transactions on Pattern Analysis and Machine Intelligence</span><span class="ltx_text" id="bib.bib25.4.2" style="font-size:90%;">, 44(12):9088–9101, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_tag_bibitem">[26]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.1.1" style="font-size:90%;">
Xiaoguang Li, Qing Guo, Rabab Abdelfattah, Di Lin, Wei Feng, Ivor Tsang, and Song Wang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.2.1" style="font-size:90%;">Leveraging inpainting for single-image shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib26.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF International Conference on Computer Vision</span><span class="ltx_text" id="bib.bib26.5.3" style="font-size:90%;">, pages 13055–13064, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_tag_bibitem">[27]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.1.1" style="font-size:90%;">
Feng Liu and Michael Gleicher.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.2.1" style="font-size:90%;">Texture-consistent shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib27.4.2" style="font-size:90%;">ECCV</span><span class="ltx_text" id="bib.bib27.5.3" style="font-size:90%;">, 2008.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_tag_bibitem">[28]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.1.1" style="font-size:90%;">
Yuhao Liu, Zhanghan Ke, Ke Xu, Fang Liu, Zhenwei Wang, and Rynson WH Lau.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.2.1" style="font-size:90%;">Recasting regional lighting for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib28.4.2" style="font-size:90%;">Proceedings of the AAAI Conference on Artificial Intelligence</span><span class="ltx_text" id="bib.bib28.5.3" style="font-size:90%;">, volume 38, pages 3810–3818, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_tag_bibitem">[29]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.1.1" style="font-size:90%;">
Kangfu Mei, Luis Figueroa, Zhe Lin, Zhihong Ding, Scott Cohen, and Vishal M Patel.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.2.1" style="font-size:90%;">Latent feature-guided diffusion models for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib29.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF Winter Conference on Applications of Computer Vision</span><span class="ltx_text" id="bib.bib29.5.3" style="font-size:90%;">, pages 4313–4322, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_tag_bibitem">[30]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib30.1.1" style="font-size:90%;">
Liangqiong Qu, Jiandong Tian, Shengfeng He, Yandong Tang, and Rynson WH Lau.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib30.2.1" style="font-size:90%;">Deshadownet: A multi-context embedding deep network for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib30.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib30.4.2" style="font-size:90%;">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition</span><span class="ltx_text" id="bib.bib30.5.3" style="font-size:90%;">, pages 4067–4075, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_tag_bibitem">[31]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib31.1.1" style="font-size:90%;">
John M. Rubin and W. A. Richards.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib31.2.1" style="font-size:90%;">Color vision and image intensities: When are changes material?
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib31.3.1" style="font-size:90%;">Biological Cybernetics</span><span class="ltx_text" id="bib.bib31.4.2" style="font-size:90%;">, 45:215–226, 1981.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_tag_bibitem">[32]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib32.1.1" style="font-size:90%;">
Yael Shor and Dani Lischinski.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib32.2.1" style="font-size:90%;">The shadow meets the mask: Pyramid-based shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib32.3.1" style="font-size:90%;">Computer Graphics Forum</span><span class="ltx_text" id="bib.bib32.4.2" style="font-size:90%;">, 27(2):577–586, Apr. 2008.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_tag_bibitem">[33]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.1.1" style="font-size:90%;">
Carole H Sudre, Wenqi Li, Tom Vercauteren, Sebastien Ourselin, and M Jorge Cardoso.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.2.1" style="font-size:90%;">Generalised dice overlap as a deep learning loss function for highly unbalanced segmentations.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib33.4.2" style="font-size:90%;">Deep Learning in Medical Image Analysis and Multimodal Learning for Clinical Decision Support: Third International Workshop, DLMIA 2017, and 7th International Workshop, ML-CDS 2017, Held in Conjunction with MICCAI 2017, Québec City, QC, Canada, September 14, Proceedings 3</span><span class="ltx_text" id="bib.bib33.5.3" style="font-size:90%;">, pages 240–248. Springer, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_tag_bibitem">[34]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.1.1" style="font-size:90%;">
Yu Sun, Xiaolong Wang, Zhuang Liu, John Miller, Alexei Efros, and Moritz Hardt.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.2.1" style="font-size:90%;">Test-time training with self-supervision for generalization under distribution shifts.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib34.4.2" style="font-size:90%;">International conference on machine learning</span><span class="ltx_text" id="bib.bib34.5.3" style="font-size:90%;">, pages 9229–9248. PMLR, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_tag_bibitem">[35]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib35.1.1" style="font-size:90%;">
Tomás F Yago Vicente, Le Hou, Chen-Ping Yu, Minh Hoai, and Dimitris Samaras.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib35.2.1" style="font-size:90%;">Large-scale training of shadow detectors with noisily-annotated shadow examples.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib35.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib35.4.2" style="font-size:90%;">Computer Vision–ECCV 2016: 14th European Conference, Amsterdam, The Netherlands, October 11-14, 2016, Proceedings, Part VI 14</span><span class="ltx_text" id="bib.bib35.5.3" style="font-size:90%;">, pages 816–832. Springer, 2016.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_tag_bibitem">[36]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib36.1.1" style="font-size:90%;">
Dequan Wang, Evan Shelhamer, Shaoteng Liu, Bruno Olshausen, and Trevor Darrell.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib36.2.1" style="font-size:90%;">Tent: Fully test-time adaptation by entropy minimization.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib36.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib36.4.2" style="font-size:90%;">International Conference on Learning Representations</span><span class="ltx_text" id="bib.bib36.5.3" style="font-size:90%;">, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_tag_bibitem">[37]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.1.1" style="font-size:90%;">
Jifeng Wang, Xiang Li, and Jian Yang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.2.1" style="font-size:90%;">Stacked conditional generative adversarial networks for jointly learning shadow detection and shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib37.4.2" style="font-size:90%;">Proceedings of the IEEE conference on computer vision and pattern recognition</span><span class="ltx_text" id="bib.bib37.5.3" style="font-size:90%;">, pages 1788–1797, 2018.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_tag_bibitem">[38]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib38.1.1" style="font-size:90%;">
Andrew P. Witkin.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib38.2.1" style="font-size:90%;">Intensity-based edge classification.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib38.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib38.4.2" style="font-size:90%;">AAAI</span><span class="ltx_text" id="bib.bib38.5.3" style="font-size:90%;">, pages 36–41. AAAI Press, 1982.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_tag_bibitem">[39]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib39.1.1" style="font-size:90%;">
Tai-Pang Wu, Chi-Keung Tang, Michael S Brown, and Heung-Yeung Shum.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib39.2.1" style="font-size:90%;">Natural shadow matting.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib39.3.1" style="font-size:90%;">ACM Transactions on Graphics (TOG)</span><span class="ltx_text" id="bib.bib39.4.2" style="font-size:90%;">, 26(2):8–es, 2007.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_tag_bibitem">[40]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.1.1" style="font-size:90%;">
Zehao Xiao, Xiantong Zhen, Shengcai Liao, and Cees G. M. Snoek.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.2.1" style="font-size:90%;">Energy-based test sample adaptation for domain generalization.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib40.4.2" style="font-size:90%;">The Eleventh International Conference on Learning Representations</span><span class="ltx_text" id="bib.bib40.5.3" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_tag_bibitem">[41]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.1.1" style="font-size:90%;">
Weiyi Xie, Nathalie Willems, Shubham Patil, Yang Li, and Mayank Kumar.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.2.1" style="font-size:90%;">Sam fewshot finetuning for anatomical segmentation in medical images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib41.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF Winter Conference on Applications of Computer Vision (WACV)</span><span class="ltx_text" id="bib.bib41.5.3" style="font-size:90%;">, pages 3253–3261, January 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_tag_bibitem">[42]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.1.1" style="font-size:90%;">
Li Xu, Feihu Qi, and Renjie Jiang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.2.1" style="font-size:90%;">Shadow removal from a single image.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib42.4.2" style="font-size:90%;">sixth international conference on intelligent systems design and applications</span><span class="ltx_text" id="bib.bib42.5.3" style="font-size:90%;">, volume 2, pages 1049–1054. IEEE, 2006.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_tag_bibitem">[43]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.1.1" style="font-size:90%;">
Han Yang, Tianyu Wang, Xiaowei Hu, and Chi-Wing Fu.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.2.1" style="font-size:90%;">Silt: Shadow-aware iterative label tuning for learning to detect shadows from noisy labels.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib43.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF International Conference on Computer Vision</span><span class="ltx_text" id="bib.bib43.5.3" style="font-size:90%;">, pages 12687–12698, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_tag_bibitem">[44]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib44.1.1" style="font-size:90%;">
Yige Yuan, Bingbing Xu, Liang Hou, Fei Sun, Huawei Shen, and Xueqi Cheng.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib44.2.1" style="font-size:90%;">Tea: Test-time energy adaptation.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib44.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib44.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</span><span class="ltx_text" id="bib.bib44.5.3" style="font-size:90%;">, pages 23901–23911, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_tag_bibitem">[45]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib45.1.1" style="font-size:90%;">
Marvin Zhang, Sergey Levine, and Chelsea Finn.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib45.2.1" style="font-size:90%;">Memo: Test time robustness via adaptation and augmentation.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib45.3.1" style="font-size:90%;">Advances in neural information processing systems</span><span class="ltx_text" id="bib.bib45.4.2" style="font-size:90%;">, 35:38629–38642, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_tag_bibitem">[46]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib46.1.1" style="font-size:90%;">
Richard Zhang, Phillip Isola, Alexei A Efros, Eli Shechtman, and Oliver Wang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib46.2.1" style="font-size:90%;">The unreasonable effectiveness of deep features as a perceptual metric.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib46.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib46.4.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib46.5.3" style="font-size:90%;">, 2018.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_tag_bibitem">[47]</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.1.1" style="font-size:90%;">
Yurui Zhu, Jie Huang, Xueyang Fu, Feng Zhao, Qibin Sun, and Zheng-Jun Zha.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.2.1" style="font-size:90%;">Bijective mapping network for shadow removal.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.3.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib47.4.2" style="font-size:90%;">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</span><span class="ltx_text" id="bib.bib47.5.3" style="font-size:90%;">, pages 5627–5636, 2022.
</span>
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<div class="ltx_para ltx_noindent" id="p1">
<p class="ltx_p" id="p1.1">In this supplementary material, we provide the following:</p>
<ol class="ltx_enumerate" id="S0.I1">
<li class="ltx_item" id="S0.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S0.I1.i1.p1">
<p class="ltx_p" id="S0.I1.i1.p1.1">Details of material-consistent shadow edge extraction.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S0.I1.i2.p1">
<p class="ltx_p" id="S0.I1.i2.p1.1">Correctness of the proposed CDD metric.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para" id="S0.I1.i3.p1">
<p class="ltx_p" id="S0.I1.i3.p1.1">Using shadow edges from shadow detection models.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span>
<div class="ltx_para" id="S0.I1.i4.p1">
<p class="ltx_p" id="S0.I1.i4.p1.1">Further details of implementation.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i5" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">5.</span>
<div class="ltx_para" id="S0.I1.i5.p1">
<p class="ltx_p" id="S0.I1.i5.p1.1">Quantitative results on ISTD+ test set.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i6" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">6.</span>
<div class="ltx_para" id="S0.I1.i6.p1">
<p class="ltx_p" id="S0.I1.i6.p1.1">More results on the cross-dataset testing.</p>
</div>
</li>
<li class="ltx_item" id="S0.I1.i7" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">7.</span>
<div class="ltx_para" id="S0.I1.i7.p1">
<p class="ltx_p" id="S0.I1.i7.p1.1">More qualitative results.</p>
</div>
</li>
</ol>
</div>
<section class="ltx_section" id="S1a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Details of Material-Consistent Shadow Edge Extraction</h2>
<div class="ltx_para" id="S1a.p1">
<p class="ltx_p" id="S1a.p1.1">We select only material-consistent shadow edges (MC-Edges) and enforce color and texture consistency on both sides of these edges on the shadow-removed outputs.
These constraints should not be enforced for shadow edges aligning with object boundaries, as both sides of those edges should exhibit different shadow-free textures and colors.
To extract MC edges, we first use the provided <math alttext="SamAutomaticMaskGenerator" class="ltx_Math" display="inline" id="S1a.p1.1.m1.1"><semantics id="S1a.p1.1.m1.1a"><mrow id="S1a.p1.1.m1.1.1" xref="S1a.p1.1.m1.1.1.cmml"><mi id="S1a.p1.1.m1.1.1.2" xref="S1a.p1.1.m1.1.1.2.cmml">S</mi><mo id="S1a.p1.1.m1.1.1.1" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.3" xref="S1a.p1.1.m1.1.1.3.cmml">a</mi><mo id="S1a.p1.1.m1.1.1.1a" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.4" xref="S1a.p1.1.m1.1.1.4.cmml">m</mi><mo id="S1a.p1.1.m1.1.1.1b" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.5" xref="S1a.p1.1.m1.1.1.5.cmml">A</mi><mo id="S1a.p1.1.m1.1.1.1c" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.6" xref="S1a.p1.1.m1.1.1.6.cmml">u</mi><mo id="S1a.p1.1.m1.1.1.1d" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.7" xref="S1a.p1.1.m1.1.1.7.cmml">t</mi><mo id="S1a.p1.1.m1.1.1.1e" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.8" xref="S1a.p1.1.m1.1.1.8.cmml">o</mi><mo id="S1a.p1.1.m1.1.1.1f" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.9" xref="S1a.p1.1.m1.1.1.9.cmml">m</mi><mo id="S1a.p1.1.m1.1.1.1g" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.10" xref="S1a.p1.1.m1.1.1.10.cmml">a</mi><mo id="S1a.p1.1.m1.1.1.1h" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.11" xref="S1a.p1.1.m1.1.1.11.cmml">t</mi><mo id="S1a.p1.1.m1.1.1.1i" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.12" xref="S1a.p1.1.m1.1.1.12.cmml">i</mi><mo id="S1a.p1.1.m1.1.1.1j" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.13" xref="S1a.p1.1.m1.1.1.13.cmml">c</mi><mo id="S1a.p1.1.m1.1.1.1k" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.14" xref="S1a.p1.1.m1.1.1.14.cmml">M</mi><mo id="S1a.p1.1.m1.1.1.1l" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.15" xref="S1a.p1.1.m1.1.1.15.cmml">a</mi><mo id="S1a.p1.1.m1.1.1.1m" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.16" xref="S1a.p1.1.m1.1.1.16.cmml">s</mi><mo id="S1a.p1.1.m1.1.1.1n" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.17" xref="S1a.p1.1.m1.1.1.17.cmml">k</mi><mo id="S1a.p1.1.m1.1.1.1o" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.18" xref="S1a.p1.1.m1.1.1.18.cmml">G</mi><mo id="S1a.p1.1.m1.1.1.1p" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.19" xref="S1a.p1.1.m1.1.1.19.cmml">e</mi><mo id="S1a.p1.1.m1.1.1.1q" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.20" xref="S1a.p1.1.m1.1.1.20.cmml">n</mi><mo id="S1a.p1.1.m1.1.1.1r" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.21" xref="S1a.p1.1.m1.1.1.21.cmml">e</mi><mo id="S1a.p1.1.m1.1.1.1s" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.22" xref="S1a.p1.1.m1.1.1.22.cmml">r</mi><mo id="S1a.p1.1.m1.1.1.1t" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.23" xref="S1a.p1.1.m1.1.1.23.cmml">a</mi><mo id="S1a.p1.1.m1.1.1.1u" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.24" xref="S1a.p1.1.m1.1.1.24.cmml">t</mi><mo id="S1a.p1.1.m1.1.1.1v" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.25" xref="S1a.p1.1.m1.1.1.25.cmml">o</mi><mo id="S1a.p1.1.m1.1.1.1w" xref="S1a.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1a.p1.1.m1.1.1.26" xref="S1a.p1.1.m1.1.1.26.cmml">r</mi></mrow><annotation-xml encoding="MathML-Content" id="S1a.p1.1.m1.1b"><apply id="S1a.p1.1.m1.1.1.cmml" xref="S1a.p1.1.m1.1.1"><times id="S1a.p1.1.m1.1.1.1.cmml" xref="S1a.p1.1.m1.1.1.1"></times><ci id="S1a.p1.1.m1.1.1.2.cmml" xref="S1a.p1.1.m1.1.1.2">𝑆</ci><ci id="S1a.p1.1.m1.1.1.3.cmml" xref="S1a.p1.1.m1.1.1.3">𝑎</ci><ci id="S1a.p1.1.m1.1.1.4.cmml" xref="S1a.p1.1.m1.1.1.4">𝑚</ci><ci id="S1a.p1.1.m1.1.1.5.cmml" xref="S1a.p1.1.m1.1.1.5">𝐴</ci><ci id="S1a.p1.1.m1.1.1.6.cmml" xref="S1a.p1.1.m1.1.1.6">𝑢</ci><ci id="S1a.p1.1.m1.1.1.7.cmml" xref="S1a.p1.1.m1.1.1.7">𝑡</ci><ci id="S1a.p1.1.m1.1.1.8.cmml" xref="S1a.p1.1.m1.1.1.8">𝑜</ci><ci id="S1a.p1.1.m1.1.1.9.cmml" xref="S1a.p1.1.m1.1.1.9">𝑚</ci><ci id="S1a.p1.1.m1.1.1.10.cmml" xref="S1a.p1.1.m1.1.1.10">𝑎</ci><ci id="S1a.p1.1.m1.1.1.11.cmml" xref="S1a.p1.1.m1.1.1.11">𝑡</ci><ci id="S1a.p1.1.m1.1.1.12.cmml" xref="S1a.p1.1.m1.1.1.12">𝑖</ci><ci id="S1a.p1.1.m1.1.1.13.cmml" xref="S1a.p1.1.m1.1.1.13">𝑐</ci><ci id="S1a.p1.1.m1.1.1.14.cmml" xref="S1a.p1.1.m1.1.1.14">𝑀</ci><ci id="S1a.p1.1.m1.1.1.15.cmml" xref="S1a.p1.1.m1.1.1.15">𝑎</ci><ci id="S1a.p1.1.m1.1.1.16.cmml" xref="S1a.p1.1.m1.1.1.16">𝑠</ci><ci id="S1a.p1.1.m1.1.1.17.cmml" xref="S1a.p1.1.m1.1.1.17">𝑘</ci><ci id="S1a.p1.1.m1.1.1.18.cmml" xref="S1a.p1.1.m1.1.1.18">𝐺</ci><ci id="S1a.p1.1.m1.1.1.19.cmml" xref="S1a.p1.1.m1.1.1.19">𝑒</ci><ci id="S1a.p1.1.m1.1.1.20.cmml" xref="S1a.p1.1.m1.1.1.20">𝑛</ci><ci id="S1a.p1.1.m1.1.1.21.cmml" xref="S1a.p1.1.m1.1.1.21">𝑒</ci><ci id="S1a.p1.1.m1.1.1.22.cmml" xref="S1a.p1.1.m1.1.1.22">𝑟</ci><ci id="S1a.p1.1.m1.1.1.23.cmml" xref="S1a.p1.1.m1.1.1.23">𝑎</ci><ci id="S1a.p1.1.m1.1.1.24.cmml" xref="S1a.p1.1.m1.1.1.24">𝑡</ci><ci id="S1a.p1.1.m1.1.1.25.cmml" xref="S1a.p1.1.m1.1.1.25">𝑜</ci><ci id="S1a.p1.1.m1.1.1.26.cmml" xref="S1a.p1.1.m1.1.1.26">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1a.p1.1.m1.1c">SamAutomaticMaskGenerator</annotation><annotation encoding="application/x-llamapun" id="S1a.p1.1.m1.1d">italic_S italic_a italic_m italic_A italic_u italic_t italic_o italic_m italic_a italic_t italic_i italic_c italic_M italic_a italic_s italic_k italic_G italic_e italic_n italic_e italic_r italic_a italic_t italic_o italic_r</annotation></semantics></math> function from the Segment Anything Model (SAM) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite> to predict material masks, and then sample edge pixels and patches when the material masks intersect with the shadow mask, details of the process is described in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#alg1" title="In 1 Details of Material-Consistent Shadow Edge Extraction ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Algorithm</span> <span class="ltx_text ltx_ref_tag">1</span></a>. More visual examples of improved material mask segmentation by our fine-tuned SAM are shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1.F1a" title="In 1 Details of Material-Consistent Shadow Edge Extraction ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="alg1.3"><span class="ltx_text" id="alg1.3.1"><span class="ltx_text ltx_font_bold" id="alg1.3.1.1">Data:</span> </span>Input shadow image <math alttext="I" class="ltx_Math" display="inline" id="alg1.1.m1.1"><semantics id="alg1.1.m1.1a"><mi id="alg1.1.m1.1.1" xref="alg1.1.m1.1.1.cmml">I</mi><annotation-xml encoding="MathML-Content" id="alg1.1.m1.1b"><ci id="alg1.1.m1.1.1.cmml" xref="alg1.1.m1.1.1">𝐼</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.1.m1.1c">I</annotation><annotation encoding="application/x-llamapun" id="alg1.1.m1.1d">italic_I</annotation></semantics></math>, shadow mask <math alttext="M" class="ltx_Math" display="inline" id="alg1.2.m2.1"><semantics id="alg1.2.m2.1a"><mi id="alg1.2.m2.1.1" xref="alg1.2.m2.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="alg1.2.m2.1b"><ci id="alg1.2.m2.1.1.cmml" xref="alg1.2.m2.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.2.m2.1c">M</annotation><annotation encoding="application/x-llamapun" id="alg1.2.m2.1d">italic_M</annotation></semantics></math>; <span class="ltx_text ltx_font_bold" id="alg1.3.2">Model:</span> Fine-tuned SAM <math alttext="f_{SAM}" class="ltx_Math" display="inline" id="alg1.3.m3.1"><semantics id="alg1.3.m3.1a"><msub id="alg1.3.m3.1.1" xref="alg1.3.m3.1.1.cmml"><mi id="alg1.3.m3.1.1.2" xref="alg1.3.m3.1.1.2.cmml">f</mi><mrow id="alg1.3.m3.1.1.3" xref="alg1.3.m3.1.1.3.cmml"><mi id="alg1.3.m3.1.1.3.2" xref="alg1.3.m3.1.1.3.2.cmml">S</mi><mo id="alg1.3.m3.1.1.3.1" xref="alg1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="alg1.3.m3.1.1.3.3" xref="alg1.3.m3.1.1.3.3.cmml">A</mi><mo id="alg1.3.m3.1.1.3.1a" xref="alg1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="alg1.3.m3.1.1.3.4" xref="alg1.3.m3.1.1.3.4.cmml">M</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.3.m3.1b"><apply id="alg1.3.m3.1.1.cmml" xref="alg1.3.m3.1.1"><csymbol cd="ambiguous" id="alg1.3.m3.1.1.1.cmml" xref="alg1.3.m3.1.1">subscript</csymbol><ci id="alg1.3.m3.1.1.2.cmml" xref="alg1.3.m3.1.1.2">𝑓</ci><apply id="alg1.3.m3.1.1.3.cmml" xref="alg1.3.m3.1.1.3"><times id="alg1.3.m3.1.1.3.1.cmml" xref="alg1.3.m3.1.1.3.1"></times><ci id="alg1.3.m3.1.1.3.2.cmml" xref="alg1.3.m3.1.1.3.2">𝑆</ci><ci id="alg1.3.m3.1.1.3.3.cmml" xref="alg1.3.m3.1.1.3.3">𝐴</ci><ci id="alg1.3.m3.1.1.3.4.cmml" xref="alg1.3.m3.1.1.3.4">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.3.m3.1c">f_{SAM}</annotation><annotation encoding="application/x-llamapun" id="alg1.3.m3.1d">italic_f start_POSTSUBSCRIPT italic_S italic_A italic_M end_POSTSUBSCRIPT</annotation></semantics></math></p>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="alg1.5"><span class="ltx_text" id="alg1.5.1"><span class="ltx_text ltx_font_bold" id="alg1.5.1.1">Result:</span> </span>Sampled shadow/shadow-free pairs, <math alttext="Pixel_{in/out}" class="ltx_Math" display="inline" id="alg1.4.m1.1"><semantics id="alg1.4.m1.1a"><mrow id="alg1.4.m1.1.1" xref="alg1.4.m1.1.1.cmml"><mi id="alg1.4.m1.1.1.2" xref="alg1.4.m1.1.1.2.cmml">P</mi><mo id="alg1.4.m1.1.1.1" xref="alg1.4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.3" xref="alg1.4.m1.1.1.3.cmml">i</mi><mo id="alg1.4.m1.1.1.1a" xref="alg1.4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.4" xref="alg1.4.m1.1.1.4.cmml">x</mi><mo id="alg1.4.m1.1.1.1b" xref="alg1.4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.5" xref="alg1.4.m1.1.1.5.cmml">e</mi><mo id="alg1.4.m1.1.1.1c" xref="alg1.4.m1.1.1.1.cmml">⁢</mo><msub id="alg1.4.m1.1.1.6" xref="alg1.4.m1.1.1.6.cmml"><mi id="alg1.4.m1.1.1.6.2" xref="alg1.4.m1.1.1.6.2.cmml">l</mi><mrow id="alg1.4.m1.1.1.6.3" xref="alg1.4.m1.1.1.6.3.cmml"><mrow id="alg1.4.m1.1.1.6.3.2" xref="alg1.4.m1.1.1.6.3.2.cmml"><mrow id="alg1.4.m1.1.1.6.3.2.2" xref="alg1.4.m1.1.1.6.3.2.2.cmml"><mi id="alg1.4.m1.1.1.6.3.2.2.2" xref="alg1.4.m1.1.1.6.3.2.2.2.cmml">i</mi><mo id="alg1.4.m1.1.1.6.3.2.2.1" xref="alg1.4.m1.1.1.6.3.2.2.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.6.3.2.2.3" xref="alg1.4.m1.1.1.6.3.2.2.3.cmml">n</mi></mrow><mo id="alg1.4.m1.1.1.6.3.2.1" xref="alg1.4.m1.1.1.6.3.2.1.cmml">/</mo><mi id="alg1.4.m1.1.1.6.3.2.3" xref="alg1.4.m1.1.1.6.3.2.3.cmml">o</mi></mrow><mo id="alg1.4.m1.1.1.6.3.1" xref="alg1.4.m1.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.6.3.3" xref="alg1.4.m1.1.1.6.3.3.cmml">u</mi><mo id="alg1.4.m1.1.1.6.3.1a" xref="alg1.4.m1.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.4.m1.1.1.6.3.4" xref="alg1.4.m1.1.1.6.3.4.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.4.m1.1b"><apply id="alg1.4.m1.1.1.cmml" xref="alg1.4.m1.1.1"><times id="alg1.4.m1.1.1.1.cmml" xref="alg1.4.m1.1.1.1"></times><ci id="alg1.4.m1.1.1.2.cmml" xref="alg1.4.m1.1.1.2">𝑃</ci><ci id="alg1.4.m1.1.1.3.cmml" xref="alg1.4.m1.1.1.3">𝑖</ci><ci id="alg1.4.m1.1.1.4.cmml" xref="alg1.4.m1.1.1.4">𝑥</ci><ci id="alg1.4.m1.1.1.5.cmml" xref="alg1.4.m1.1.1.5">𝑒</ci><apply id="alg1.4.m1.1.1.6.cmml" xref="alg1.4.m1.1.1.6"><csymbol cd="ambiguous" id="alg1.4.m1.1.1.6.1.cmml" xref="alg1.4.m1.1.1.6">subscript</csymbol><ci id="alg1.4.m1.1.1.6.2.cmml" xref="alg1.4.m1.1.1.6.2">𝑙</ci><apply id="alg1.4.m1.1.1.6.3.cmml" xref="alg1.4.m1.1.1.6.3"><times id="alg1.4.m1.1.1.6.3.1.cmml" xref="alg1.4.m1.1.1.6.3.1"></times><apply id="alg1.4.m1.1.1.6.3.2.cmml" xref="alg1.4.m1.1.1.6.3.2"><divide id="alg1.4.m1.1.1.6.3.2.1.cmml" xref="alg1.4.m1.1.1.6.3.2.1"></divide><apply id="alg1.4.m1.1.1.6.3.2.2.cmml" xref="alg1.4.m1.1.1.6.3.2.2"><times id="alg1.4.m1.1.1.6.3.2.2.1.cmml" xref="alg1.4.m1.1.1.6.3.2.2.1"></times><ci id="alg1.4.m1.1.1.6.3.2.2.2.cmml" xref="alg1.4.m1.1.1.6.3.2.2.2">𝑖</ci><ci id="alg1.4.m1.1.1.6.3.2.2.3.cmml" xref="alg1.4.m1.1.1.6.3.2.2.3">𝑛</ci></apply><ci id="alg1.4.m1.1.1.6.3.2.3.cmml" xref="alg1.4.m1.1.1.6.3.2.3">𝑜</ci></apply><ci id="alg1.4.m1.1.1.6.3.3.cmml" xref="alg1.4.m1.1.1.6.3.3">𝑢</ci><ci id="alg1.4.m1.1.1.6.3.4.cmml" xref="alg1.4.m1.1.1.6.3.4">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.4.m1.1c">Pixel_{in/out}</annotation><annotation encoding="application/x-llamapun" id="alg1.4.m1.1d">italic_P italic_i italic_x italic_e italic_l start_POSTSUBSCRIPT italic_i italic_n / italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="Patch_{in/out}" class="ltx_Math" display="inline" id="alg1.5.m2.1"><semantics id="alg1.5.m2.1a"><mrow id="alg1.5.m2.1.1" xref="alg1.5.m2.1.1.cmml"><mi id="alg1.5.m2.1.1.2" xref="alg1.5.m2.1.1.2.cmml">P</mi><mo id="alg1.5.m2.1.1.1" xref="alg1.5.m2.1.1.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.3" xref="alg1.5.m2.1.1.3.cmml">a</mi><mo id="alg1.5.m2.1.1.1a" xref="alg1.5.m2.1.1.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.4" xref="alg1.5.m2.1.1.4.cmml">t</mi><mo id="alg1.5.m2.1.1.1b" xref="alg1.5.m2.1.1.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.5" xref="alg1.5.m2.1.1.5.cmml">c</mi><mo id="alg1.5.m2.1.1.1c" xref="alg1.5.m2.1.1.1.cmml">⁢</mo><msub id="alg1.5.m2.1.1.6" xref="alg1.5.m2.1.1.6.cmml"><mi id="alg1.5.m2.1.1.6.2" xref="alg1.5.m2.1.1.6.2.cmml">h</mi><mrow id="alg1.5.m2.1.1.6.3" xref="alg1.5.m2.1.1.6.3.cmml"><mrow id="alg1.5.m2.1.1.6.3.2" xref="alg1.5.m2.1.1.6.3.2.cmml"><mrow id="alg1.5.m2.1.1.6.3.2.2" xref="alg1.5.m2.1.1.6.3.2.2.cmml"><mi id="alg1.5.m2.1.1.6.3.2.2.2" xref="alg1.5.m2.1.1.6.3.2.2.2.cmml">i</mi><mo id="alg1.5.m2.1.1.6.3.2.2.1" xref="alg1.5.m2.1.1.6.3.2.2.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.6.3.2.2.3" xref="alg1.5.m2.1.1.6.3.2.2.3.cmml">n</mi></mrow><mo id="alg1.5.m2.1.1.6.3.2.1" xref="alg1.5.m2.1.1.6.3.2.1.cmml">/</mo><mi id="alg1.5.m2.1.1.6.3.2.3" xref="alg1.5.m2.1.1.6.3.2.3.cmml">o</mi></mrow><mo id="alg1.5.m2.1.1.6.3.1" xref="alg1.5.m2.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.6.3.3" xref="alg1.5.m2.1.1.6.3.3.cmml">u</mi><mo id="alg1.5.m2.1.1.6.3.1a" xref="alg1.5.m2.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.5.m2.1.1.6.3.4" xref="alg1.5.m2.1.1.6.3.4.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.5.m2.1b"><apply id="alg1.5.m2.1.1.cmml" xref="alg1.5.m2.1.1"><times id="alg1.5.m2.1.1.1.cmml" xref="alg1.5.m2.1.1.1"></times><ci id="alg1.5.m2.1.1.2.cmml" xref="alg1.5.m2.1.1.2">𝑃</ci><ci id="alg1.5.m2.1.1.3.cmml" xref="alg1.5.m2.1.1.3">𝑎</ci><ci id="alg1.5.m2.1.1.4.cmml" xref="alg1.5.m2.1.1.4">𝑡</ci><ci id="alg1.5.m2.1.1.5.cmml" xref="alg1.5.m2.1.1.5">𝑐</ci><apply id="alg1.5.m2.1.1.6.cmml" xref="alg1.5.m2.1.1.6"><csymbol cd="ambiguous" id="alg1.5.m2.1.1.6.1.cmml" xref="alg1.5.m2.1.1.6">subscript</csymbol><ci id="alg1.5.m2.1.1.6.2.cmml" xref="alg1.5.m2.1.1.6.2">ℎ</ci><apply id="alg1.5.m2.1.1.6.3.cmml" xref="alg1.5.m2.1.1.6.3"><times id="alg1.5.m2.1.1.6.3.1.cmml" xref="alg1.5.m2.1.1.6.3.1"></times><apply id="alg1.5.m2.1.1.6.3.2.cmml" xref="alg1.5.m2.1.1.6.3.2"><divide id="alg1.5.m2.1.1.6.3.2.1.cmml" xref="alg1.5.m2.1.1.6.3.2.1"></divide><apply id="alg1.5.m2.1.1.6.3.2.2.cmml" xref="alg1.5.m2.1.1.6.3.2.2"><times id="alg1.5.m2.1.1.6.3.2.2.1.cmml" xref="alg1.5.m2.1.1.6.3.2.2.1"></times><ci id="alg1.5.m2.1.1.6.3.2.2.2.cmml" xref="alg1.5.m2.1.1.6.3.2.2.2">𝑖</ci><ci id="alg1.5.m2.1.1.6.3.2.2.3.cmml" xref="alg1.5.m2.1.1.6.3.2.2.3">𝑛</ci></apply><ci id="alg1.5.m2.1.1.6.3.2.3.cmml" xref="alg1.5.m2.1.1.6.3.2.3">𝑜</ci></apply><ci id="alg1.5.m2.1.1.6.3.3.cmml" xref="alg1.5.m2.1.1.6.3.3">𝑢</ci><ci id="alg1.5.m2.1.1.6.3.4.cmml" xref="alg1.5.m2.1.1.6.3.4">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.5.m2.1c">Patch_{in/out}</annotation><annotation encoding="application/x-llamapun" id="alg1.5.m2.1d">italic_P italic_a italic_t italic_c italic_h start_POSTSUBSCRIPT italic_i italic_n / italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math></p>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="alg1.14"><math alttext="EdgePixels" class="ltx_Math" display="inline" id="alg1.6.m1.1"><semantics id="alg1.6.m1.1a"><mrow id="alg1.6.m1.1.1" xref="alg1.6.m1.1.1.cmml"><mi id="alg1.6.m1.1.1.2" xref="alg1.6.m1.1.1.2.cmml">E</mi><mo id="alg1.6.m1.1.1.1" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.3" xref="alg1.6.m1.1.1.3.cmml">d</mi><mo id="alg1.6.m1.1.1.1a" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.4" xref="alg1.6.m1.1.1.4.cmml">g</mi><mo id="alg1.6.m1.1.1.1b" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.5" xref="alg1.6.m1.1.1.5.cmml">e</mi><mo id="alg1.6.m1.1.1.1c" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.6" xref="alg1.6.m1.1.1.6.cmml">P</mi><mo id="alg1.6.m1.1.1.1d" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.7" xref="alg1.6.m1.1.1.7.cmml">i</mi><mo id="alg1.6.m1.1.1.1e" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.8" xref="alg1.6.m1.1.1.8.cmml">x</mi><mo id="alg1.6.m1.1.1.1f" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.9" xref="alg1.6.m1.1.1.9.cmml">e</mi><mo id="alg1.6.m1.1.1.1g" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.10" xref="alg1.6.m1.1.1.10.cmml">l</mi><mo id="alg1.6.m1.1.1.1h" xref="alg1.6.m1.1.1.1.cmml">⁢</mo><mi id="alg1.6.m1.1.1.11" xref="alg1.6.m1.1.1.11.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.6.m1.1b"><apply id="alg1.6.m1.1.1.cmml" xref="alg1.6.m1.1.1"><times id="alg1.6.m1.1.1.1.cmml" xref="alg1.6.m1.1.1.1"></times><ci id="alg1.6.m1.1.1.2.cmml" xref="alg1.6.m1.1.1.2">𝐸</ci><ci id="alg1.6.m1.1.1.3.cmml" xref="alg1.6.m1.1.1.3">𝑑</ci><ci id="alg1.6.m1.1.1.4.cmml" xref="alg1.6.m1.1.1.4">𝑔</ci><ci id="alg1.6.m1.1.1.5.cmml" xref="alg1.6.m1.1.1.5">𝑒</ci><ci id="alg1.6.m1.1.1.6.cmml" xref="alg1.6.m1.1.1.6">𝑃</ci><ci id="alg1.6.m1.1.1.7.cmml" xref="alg1.6.m1.1.1.7">𝑖</ci><ci id="alg1.6.m1.1.1.8.cmml" xref="alg1.6.m1.1.1.8">𝑥</ci><ci id="alg1.6.m1.1.1.9.cmml" xref="alg1.6.m1.1.1.9">𝑒</ci><ci id="alg1.6.m1.1.1.10.cmml" xref="alg1.6.m1.1.1.10">𝑙</ci><ci id="alg1.6.m1.1.1.11.cmml" xref="alg1.6.m1.1.1.11">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.6.m1.1c">EdgePixels</annotation><annotation encoding="application/x-llamapun" id="alg1.6.m1.1d">italic_E italic_d italic_g italic_e italic_P italic_i italic_x italic_e italic_l italic_s</annotation></semantics></math> = <math alttext="\{M-erode(M)\}" class="ltx_Math" display="inline" id="alg1.7.m2.2"><semantics id="alg1.7.m2.2a"><mrow id="alg1.7.m2.2.2.1" xref="alg1.7.m2.2.2.2.cmml"><mo id="alg1.7.m2.2.2.1.2" stretchy="false" xref="alg1.7.m2.2.2.2.cmml">{</mo><mrow id="alg1.7.m2.2.2.1.1" xref="alg1.7.m2.2.2.1.1.cmml"><mi id="alg1.7.m2.2.2.1.1.2" xref="alg1.7.m2.2.2.1.1.2.cmml">M</mi><mo id="alg1.7.m2.2.2.1.1.1" xref="alg1.7.m2.2.2.1.1.1.cmml">−</mo><mrow id="alg1.7.m2.2.2.1.1.3" xref="alg1.7.m2.2.2.1.1.3.cmml"><mi id="alg1.7.m2.2.2.1.1.3.2" xref="alg1.7.m2.2.2.1.1.3.2.cmml">e</mi><mo id="alg1.7.m2.2.2.1.1.3.1" xref="alg1.7.m2.2.2.1.1.3.1.cmml">⁢</mo><mi id="alg1.7.m2.2.2.1.1.3.3" xref="alg1.7.m2.2.2.1.1.3.3.cmml">r</mi><mo id="alg1.7.m2.2.2.1.1.3.1a" xref="alg1.7.m2.2.2.1.1.3.1.cmml">⁢</mo><mi id="alg1.7.m2.2.2.1.1.3.4" xref="alg1.7.m2.2.2.1.1.3.4.cmml">o</mi><mo id="alg1.7.m2.2.2.1.1.3.1b" xref="alg1.7.m2.2.2.1.1.3.1.cmml">⁢</mo><mi id="alg1.7.m2.2.2.1.1.3.5" xref="alg1.7.m2.2.2.1.1.3.5.cmml">d</mi><mo id="alg1.7.m2.2.2.1.1.3.1c" xref="alg1.7.m2.2.2.1.1.3.1.cmml">⁢</mo><mi id="alg1.7.m2.2.2.1.1.3.6" xref="alg1.7.m2.2.2.1.1.3.6.cmml">e</mi><mo id="alg1.7.m2.2.2.1.1.3.1d" xref="alg1.7.m2.2.2.1.1.3.1.cmml">⁢</mo><mrow id="alg1.7.m2.2.2.1.1.3.7.2" xref="alg1.7.m2.2.2.1.1.3.cmml"><mo id="alg1.7.m2.2.2.1.1.3.7.2.1" stretchy="false" xref="alg1.7.m2.2.2.1.1.3.cmml">(</mo><mi id="alg1.7.m2.1.1" xref="alg1.7.m2.1.1.cmml">M</mi><mo id="alg1.7.m2.2.2.1.1.3.7.2.2" stretchy="false" xref="alg1.7.m2.2.2.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="alg1.7.m2.2.2.1.3" stretchy="false" xref="alg1.7.m2.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="alg1.7.m2.2b"><set id="alg1.7.m2.2.2.2.cmml" xref="alg1.7.m2.2.2.1"><apply id="alg1.7.m2.2.2.1.1.cmml" xref="alg1.7.m2.2.2.1.1"><minus id="alg1.7.m2.2.2.1.1.1.cmml" xref="alg1.7.m2.2.2.1.1.1"></minus><ci id="alg1.7.m2.2.2.1.1.2.cmml" xref="alg1.7.m2.2.2.1.1.2">𝑀</ci><apply id="alg1.7.m2.2.2.1.1.3.cmml" xref="alg1.7.m2.2.2.1.1.3"><times id="alg1.7.m2.2.2.1.1.3.1.cmml" xref="alg1.7.m2.2.2.1.1.3.1"></times><ci id="alg1.7.m2.2.2.1.1.3.2.cmml" xref="alg1.7.m2.2.2.1.1.3.2">𝑒</ci><ci id="alg1.7.m2.2.2.1.1.3.3.cmml" xref="alg1.7.m2.2.2.1.1.3.3">𝑟</ci><ci id="alg1.7.m2.2.2.1.1.3.4.cmml" xref="alg1.7.m2.2.2.1.1.3.4">𝑜</ci><ci id="alg1.7.m2.2.2.1.1.3.5.cmml" xref="alg1.7.m2.2.2.1.1.3.5">𝑑</ci><ci id="alg1.7.m2.2.2.1.1.3.6.cmml" xref="alg1.7.m2.2.2.1.1.3.6">𝑒</ci><ci id="alg1.7.m2.1.1.cmml" xref="alg1.7.m2.1.1">𝑀</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="alg1.7.m2.2c">\{M-erode(M)\}</annotation><annotation encoding="application/x-llamapun" id="alg1.7.m2.2d">{ italic_M - italic_e italic_r italic_o italic_d italic_e ( italic_M ) }</annotation></semantics></math> + <math alttext="\{dilate(M)-M\}" class="ltx_Math" display="inline" id="alg1.8.m3.2"><semantics id="alg1.8.m3.2a"><mrow id="alg1.8.m3.2.2.1" xref="alg1.8.m3.2.2.2.cmml"><mo id="alg1.8.m3.2.2.1.2" stretchy="false" xref="alg1.8.m3.2.2.2.cmml">{</mo><mrow id="alg1.8.m3.2.2.1.1" xref="alg1.8.m3.2.2.1.1.cmml"><mrow id="alg1.8.m3.2.2.1.1.2" xref="alg1.8.m3.2.2.1.1.2.cmml"><mi id="alg1.8.m3.2.2.1.1.2.2" xref="alg1.8.m3.2.2.1.1.2.2.cmml">d</mi><mo id="alg1.8.m3.2.2.1.1.2.1" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="alg1.8.m3.2.2.1.1.2.3" xref="alg1.8.m3.2.2.1.1.2.3.cmml">i</mi><mo id="alg1.8.m3.2.2.1.1.2.1a" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="alg1.8.m3.2.2.1.1.2.4" xref="alg1.8.m3.2.2.1.1.2.4.cmml">l</mi><mo id="alg1.8.m3.2.2.1.1.2.1b" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="alg1.8.m3.2.2.1.1.2.5" xref="alg1.8.m3.2.2.1.1.2.5.cmml">a</mi><mo id="alg1.8.m3.2.2.1.1.2.1c" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="alg1.8.m3.2.2.1.1.2.6" xref="alg1.8.m3.2.2.1.1.2.6.cmml">t</mi><mo id="alg1.8.m3.2.2.1.1.2.1d" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="alg1.8.m3.2.2.1.1.2.7" xref="alg1.8.m3.2.2.1.1.2.7.cmml">e</mi><mo id="alg1.8.m3.2.2.1.1.2.1e" xref="alg1.8.m3.2.2.1.1.2.1.cmml">⁢</mo><mrow id="alg1.8.m3.2.2.1.1.2.8.2" xref="alg1.8.m3.2.2.1.1.2.cmml"><mo id="alg1.8.m3.2.2.1.1.2.8.2.1" stretchy="false" xref="alg1.8.m3.2.2.1.1.2.cmml">(</mo><mi id="alg1.8.m3.1.1" xref="alg1.8.m3.1.1.cmml">M</mi><mo id="alg1.8.m3.2.2.1.1.2.8.2.2" stretchy="false" xref="alg1.8.m3.2.2.1.1.2.cmml">)</mo></mrow></mrow><mo id="alg1.8.m3.2.2.1.1.1" xref="alg1.8.m3.2.2.1.1.1.cmml">−</mo><mi id="alg1.8.m3.2.2.1.1.3" xref="alg1.8.m3.2.2.1.1.3.cmml">M</mi></mrow><mo id="alg1.8.m3.2.2.1.3" stretchy="false" xref="alg1.8.m3.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="alg1.8.m3.2b"><set id="alg1.8.m3.2.2.2.cmml" xref="alg1.8.m3.2.2.1"><apply id="alg1.8.m3.2.2.1.1.cmml" xref="alg1.8.m3.2.2.1.1"><minus id="alg1.8.m3.2.2.1.1.1.cmml" xref="alg1.8.m3.2.2.1.1.1"></minus><apply id="alg1.8.m3.2.2.1.1.2.cmml" xref="alg1.8.m3.2.2.1.1.2"><times id="alg1.8.m3.2.2.1.1.2.1.cmml" xref="alg1.8.m3.2.2.1.1.2.1"></times><ci id="alg1.8.m3.2.2.1.1.2.2.cmml" xref="alg1.8.m3.2.2.1.1.2.2">𝑑</ci><ci id="alg1.8.m3.2.2.1.1.2.3.cmml" xref="alg1.8.m3.2.2.1.1.2.3">𝑖</ci><ci id="alg1.8.m3.2.2.1.1.2.4.cmml" xref="alg1.8.m3.2.2.1.1.2.4">𝑙</ci><ci id="alg1.8.m3.2.2.1.1.2.5.cmml" xref="alg1.8.m3.2.2.1.1.2.5">𝑎</ci><ci id="alg1.8.m3.2.2.1.1.2.6.cmml" xref="alg1.8.m3.2.2.1.1.2.6">𝑡</ci><ci id="alg1.8.m3.2.2.1.1.2.7.cmml" xref="alg1.8.m3.2.2.1.1.2.7">𝑒</ci><ci id="alg1.8.m3.1.1.cmml" xref="alg1.8.m3.1.1">𝑀</ci></apply><ci id="alg1.8.m3.2.2.1.1.3.cmml" xref="alg1.8.m3.2.2.1.1.3">𝑀</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="alg1.8.m3.2c">\{dilate(M)-M\}</annotation><annotation encoding="application/x-llamapun" id="alg1.8.m3.2d">{ italic_d italic_i italic_l italic_a italic_t italic_e ( italic_M ) - italic_M }</annotation></semantics></math>
<br class="ltx_break"/><math alttext="SegMasks" class="ltx_Math" display="inline" id="alg1.9.m4.1"><semantics id="alg1.9.m4.1a"><mrow id="alg1.9.m4.1.1" xref="alg1.9.m4.1.1.cmml"><mi id="alg1.9.m4.1.1.2" xref="alg1.9.m4.1.1.2.cmml">S</mi><mo id="alg1.9.m4.1.1.1" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.3" xref="alg1.9.m4.1.1.3.cmml">e</mi><mo id="alg1.9.m4.1.1.1a" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.4" xref="alg1.9.m4.1.1.4.cmml">g</mi><mo id="alg1.9.m4.1.1.1b" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.5" xref="alg1.9.m4.1.1.5.cmml">M</mi><mo id="alg1.9.m4.1.1.1c" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.6" xref="alg1.9.m4.1.1.6.cmml">a</mi><mo id="alg1.9.m4.1.1.1d" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.7" xref="alg1.9.m4.1.1.7.cmml">s</mi><mo id="alg1.9.m4.1.1.1e" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.8" xref="alg1.9.m4.1.1.8.cmml">k</mi><mo id="alg1.9.m4.1.1.1f" xref="alg1.9.m4.1.1.1.cmml">⁢</mo><mi id="alg1.9.m4.1.1.9" xref="alg1.9.m4.1.1.9.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.9.m4.1b"><apply id="alg1.9.m4.1.1.cmml" xref="alg1.9.m4.1.1"><times id="alg1.9.m4.1.1.1.cmml" xref="alg1.9.m4.1.1.1"></times><ci id="alg1.9.m4.1.1.2.cmml" xref="alg1.9.m4.1.1.2">𝑆</ci><ci id="alg1.9.m4.1.1.3.cmml" xref="alg1.9.m4.1.1.3">𝑒</ci><ci id="alg1.9.m4.1.1.4.cmml" xref="alg1.9.m4.1.1.4">𝑔</ci><ci id="alg1.9.m4.1.1.5.cmml" xref="alg1.9.m4.1.1.5">𝑀</ci><ci id="alg1.9.m4.1.1.6.cmml" xref="alg1.9.m4.1.1.6">𝑎</ci><ci id="alg1.9.m4.1.1.7.cmml" xref="alg1.9.m4.1.1.7">𝑠</ci><ci id="alg1.9.m4.1.1.8.cmml" xref="alg1.9.m4.1.1.8">𝑘</ci><ci id="alg1.9.m4.1.1.9.cmml" xref="alg1.9.m4.1.1.9">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.9.m4.1c">SegMasks</annotation><annotation encoding="application/x-llamapun" id="alg1.9.m4.1d">italic_S italic_e italic_g italic_M italic_a italic_s italic_k italic_s</annotation></semantics></math> = <math alttext="MaskGenerator" class="ltx_Math" display="inline" id="alg1.10.m5.1"><semantics id="alg1.10.m5.1a"><mrow id="alg1.10.m5.1.1" xref="alg1.10.m5.1.1.cmml"><mi id="alg1.10.m5.1.1.2" xref="alg1.10.m5.1.1.2.cmml">M</mi><mo id="alg1.10.m5.1.1.1" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.3" xref="alg1.10.m5.1.1.3.cmml">a</mi><mo id="alg1.10.m5.1.1.1a" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.4" xref="alg1.10.m5.1.1.4.cmml">s</mi><mo id="alg1.10.m5.1.1.1b" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.5" xref="alg1.10.m5.1.1.5.cmml">k</mi><mo id="alg1.10.m5.1.1.1c" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.6" xref="alg1.10.m5.1.1.6.cmml">G</mi><mo id="alg1.10.m5.1.1.1d" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.7" xref="alg1.10.m5.1.1.7.cmml">e</mi><mo id="alg1.10.m5.1.1.1e" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.8" xref="alg1.10.m5.1.1.8.cmml">n</mi><mo id="alg1.10.m5.1.1.1f" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.9" xref="alg1.10.m5.1.1.9.cmml">e</mi><mo id="alg1.10.m5.1.1.1g" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.10" xref="alg1.10.m5.1.1.10.cmml">r</mi><mo id="alg1.10.m5.1.1.1h" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.11" xref="alg1.10.m5.1.1.11.cmml">a</mi><mo id="alg1.10.m5.1.1.1i" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.12" xref="alg1.10.m5.1.1.12.cmml">t</mi><mo id="alg1.10.m5.1.1.1j" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.13" xref="alg1.10.m5.1.1.13.cmml">o</mi><mo id="alg1.10.m5.1.1.1k" xref="alg1.10.m5.1.1.1.cmml">⁢</mo><mi id="alg1.10.m5.1.1.14" xref="alg1.10.m5.1.1.14.cmml">r</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.10.m5.1b"><apply id="alg1.10.m5.1.1.cmml" xref="alg1.10.m5.1.1"><times id="alg1.10.m5.1.1.1.cmml" xref="alg1.10.m5.1.1.1"></times><ci id="alg1.10.m5.1.1.2.cmml" xref="alg1.10.m5.1.1.2">𝑀</ci><ci id="alg1.10.m5.1.1.3.cmml" xref="alg1.10.m5.1.1.3">𝑎</ci><ci id="alg1.10.m5.1.1.4.cmml" xref="alg1.10.m5.1.1.4">𝑠</ci><ci id="alg1.10.m5.1.1.5.cmml" xref="alg1.10.m5.1.1.5">𝑘</ci><ci id="alg1.10.m5.1.1.6.cmml" xref="alg1.10.m5.1.1.6">𝐺</ci><ci id="alg1.10.m5.1.1.7.cmml" xref="alg1.10.m5.1.1.7">𝑒</ci><ci id="alg1.10.m5.1.1.8.cmml" xref="alg1.10.m5.1.1.8">𝑛</ci><ci id="alg1.10.m5.1.1.9.cmml" xref="alg1.10.m5.1.1.9">𝑒</ci><ci id="alg1.10.m5.1.1.10.cmml" xref="alg1.10.m5.1.1.10">𝑟</ci><ci id="alg1.10.m5.1.1.11.cmml" xref="alg1.10.m5.1.1.11">𝑎</ci><ci id="alg1.10.m5.1.1.12.cmml" xref="alg1.10.m5.1.1.12">𝑡</ci><ci id="alg1.10.m5.1.1.13.cmml" xref="alg1.10.m5.1.1.13">𝑜</ci><ci id="alg1.10.m5.1.1.14.cmml" xref="alg1.10.m5.1.1.14">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.10.m5.1c">MaskGenerator</annotation><annotation encoding="application/x-llamapun" id="alg1.10.m5.1d">italic_M italic_a italic_s italic_k italic_G italic_e italic_n italic_e italic_r italic_a italic_t italic_o italic_r</annotation></semantics></math>(<math alttext="f_{SAM}" class="ltx_Math" display="inline" id="alg1.11.m6.1"><semantics id="alg1.11.m6.1a"><msub id="alg1.11.m6.1.1" xref="alg1.11.m6.1.1.cmml"><mi id="alg1.11.m6.1.1.2" xref="alg1.11.m6.1.1.2.cmml">f</mi><mrow id="alg1.11.m6.1.1.3" xref="alg1.11.m6.1.1.3.cmml"><mi id="alg1.11.m6.1.1.3.2" xref="alg1.11.m6.1.1.3.2.cmml">S</mi><mo id="alg1.11.m6.1.1.3.1" xref="alg1.11.m6.1.1.3.1.cmml">⁢</mo><mi id="alg1.11.m6.1.1.3.3" xref="alg1.11.m6.1.1.3.3.cmml">A</mi><mo id="alg1.11.m6.1.1.3.1a" xref="alg1.11.m6.1.1.3.1.cmml">⁢</mo><mi id="alg1.11.m6.1.1.3.4" xref="alg1.11.m6.1.1.3.4.cmml">M</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.11.m6.1b"><apply id="alg1.11.m6.1.1.cmml" xref="alg1.11.m6.1.1"><csymbol cd="ambiguous" id="alg1.11.m6.1.1.1.cmml" xref="alg1.11.m6.1.1">subscript</csymbol><ci id="alg1.11.m6.1.1.2.cmml" xref="alg1.11.m6.1.1.2">𝑓</ci><apply id="alg1.11.m6.1.1.3.cmml" xref="alg1.11.m6.1.1.3"><times id="alg1.11.m6.1.1.3.1.cmml" xref="alg1.11.m6.1.1.3.1"></times><ci id="alg1.11.m6.1.1.3.2.cmml" xref="alg1.11.m6.1.1.3.2">𝑆</ci><ci id="alg1.11.m6.1.1.3.3.cmml" xref="alg1.11.m6.1.1.3.3">𝐴</ci><ci id="alg1.11.m6.1.1.3.4.cmml" xref="alg1.11.m6.1.1.3.4">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.11.m6.1c">f_{SAM}</annotation><annotation encoding="application/x-llamapun" id="alg1.11.m6.1d">italic_f start_POSTSUBSCRIPT italic_S italic_A italic_M end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="I" class="ltx_Math" display="inline" id="alg1.12.m7.1"><semantics id="alg1.12.m7.1a"><mi id="alg1.12.m7.1.1" xref="alg1.12.m7.1.1.cmml">I</mi><annotation-xml encoding="MathML-Content" id="alg1.12.m7.1b"><ci id="alg1.12.m7.1.1.cmml" xref="alg1.12.m7.1.1">𝐼</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.12.m7.1c">I</annotation><annotation encoding="application/x-llamapun" id="alg1.12.m7.1d">italic_I</annotation></semantics></math>, <math alttext="M" class="ltx_Math" display="inline" id="alg1.13.m8.1"><semantics id="alg1.13.m8.1a"><mi id="alg1.13.m8.1.1" xref="alg1.13.m8.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="alg1.13.m8.1b"><ci id="alg1.13.m8.1.1.cmml" xref="alg1.13.m8.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.13.m8.1c">M</annotation><annotation encoding="application/x-llamapun" id="alg1.13.m8.1d">italic_M</annotation></semantics></math>) 
<br class="ltx_break"/><span class="ltx_text ltx_font_bold" id="alg1.14.2">for</span> <em class="ltx_emph ltx_font_italic" id="alg1.14.1"><math alttext="i=1\rightarrow n" class="ltx_Math" display="inline" id="alg1.14.1.m1.1"><semantics id="alg1.14.1.m1.1a"><mrow id="alg1.14.1.m1.1.1" xref="alg1.14.1.m1.1.1.cmml"><mi id="alg1.14.1.m1.1.1.2" xref="alg1.14.1.m1.1.1.2.cmml">i</mi><mo id="alg1.14.1.m1.1.1.3" xref="alg1.14.1.m1.1.1.3.cmml">=</mo><mn id="alg1.14.1.m1.1.1.4" xref="alg1.14.1.m1.1.1.4.cmml">1</mn><mo id="alg1.14.1.m1.1.1.5" stretchy="false" xref="alg1.14.1.m1.1.1.5.cmml">→</mo><mi id="alg1.14.1.m1.1.1.6" xref="alg1.14.1.m1.1.1.6.cmml">n</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.14.1.m1.1b"><apply id="alg1.14.1.m1.1.1.cmml" xref="alg1.14.1.m1.1.1"><and id="alg1.14.1.m1.1.1a.cmml" xref="alg1.14.1.m1.1.1"></and><apply id="alg1.14.1.m1.1.1b.cmml" xref="alg1.14.1.m1.1.1"><eq id="alg1.14.1.m1.1.1.3.cmml" xref="alg1.14.1.m1.1.1.3"></eq><ci id="alg1.14.1.m1.1.1.2.cmml" xref="alg1.14.1.m1.1.1.2">𝑖</ci><cn id="alg1.14.1.m1.1.1.4.cmml" type="integer" xref="alg1.14.1.m1.1.1.4">1</cn></apply><apply id="alg1.14.1.m1.1.1c.cmml" xref="alg1.14.1.m1.1.1"><ci id="alg1.14.1.m1.1.1.5.cmml" xref="alg1.14.1.m1.1.1.5">→</ci><share href="https://arxiv.org/html/2409.06848v1#alg1.14.1.m1.1.1.4.cmml" id="alg1.14.1.m1.1.1d.cmml" xref="alg1.14.1.m1.1.1"></share><ci id="alg1.14.1.m1.1.1.6.cmml" xref="alg1.14.1.m1.1.1.6">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.14.1.m1.1c">i=1\rightarrow n</annotation><annotation encoding="application/x-llamapun" id="alg1.14.1.m1.1d">italic_i = 1 → italic_n</annotation></semantics></math></em> <span class="ltx_text ltx_font_bold" id="alg1.14.3">do</span></p>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<div class="ltx_listingline ltx_figure_panel" id="alg1.16">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
<span class="ltx_text ltx_font_bold" id="alg1.16.3">if</span> <em class="ltx_emph ltx_font_italic" id="alg1.16.2"><math alttext="SegMask[i]" class="ltx_Math" display="inline" id="alg1.15.1.m1.1"><semantics id="alg1.15.1.m1.1a"><mrow id="alg1.15.1.m1.1.2" xref="alg1.15.1.m1.1.2.cmml"><mi id="alg1.15.1.m1.1.2.2" xref="alg1.15.1.m1.1.2.2.cmml">S</mi><mo id="alg1.15.1.m1.1.2.1" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.3" xref="alg1.15.1.m1.1.2.3.cmml">e</mi><mo id="alg1.15.1.m1.1.2.1a" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.4" xref="alg1.15.1.m1.1.2.4.cmml">g</mi><mo id="alg1.15.1.m1.1.2.1b" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.5" xref="alg1.15.1.m1.1.2.5.cmml">M</mi><mo id="alg1.15.1.m1.1.2.1c" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.6" xref="alg1.15.1.m1.1.2.6.cmml">a</mi><mo id="alg1.15.1.m1.1.2.1d" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.7" xref="alg1.15.1.m1.1.2.7.cmml">s</mi><mo id="alg1.15.1.m1.1.2.1e" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mi id="alg1.15.1.m1.1.2.8" xref="alg1.15.1.m1.1.2.8.cmml">k</mi><mo id="alg1.15.1.m1.1.2.1f" xref="alg1.15.1.m1.1.2.1.cmml">⁢</mo><mrow id="alg1.15.1.m1.1.2.9.2" xref="alg1.15.1.m1.1.2.9.1.cmml"><mo id="alg1.15.1.m1.1.2.9.2.1" stretchy="false" xref="alg1.15.1.m1.1.2.9.1.1.cmml">[</mo><mi id="alg1.15.1.m1.1.1" xref="alg1.15.1.m1.1.1.cmml">i</mi><mo id="alg1.15.1.m1.1.2.9.2.2" stretchy="false" xref="alg1.15.1.m1.1.2.9.1.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.15.1.m1.1b"><apply id="alg1.15.1.m1.1.2.cmml" xref="alg1.15.1.m1.1.2"><times id="alg1.15.1.m1.1.2.1.cmml" xref="alg1.15.1.m1.1.2.1"></times><ci id="alg1.15.1.m1.1.2.2.cmml" xref="alg1.15.1.m1.1.2.2">𝑆</ci><ci id="alg1.15.1.m1.1.2.3.cmml" xref="alg1.15.1.m1.1.2.3">𝑒</ci><ci id="alg1.15.1.m1.1.2.4.cmml" xref="alg1.15.1.m1.1.2.4">𝑔</ci><ci id="alg1.15.1.m1.1.2.5.cmml" xref="alg1.15.1.m1.1.2.5">𝑀</ci><ci id="alg1.15.1.m1.1.2.6.cmml" xref="alg1.15.1.m1.1.2.6">𝑎</ci><ci id="alg1.15.1.m1.1.2.7.cmml" xref="alg1.15.1.m1.1.2.7">𝑠</ci><ci id="alg1.15.1.m1.1.2.8.cmml" xref="alg1.15.1.m1.1.2.8">𝑘</ci><apply id="alg1.15.1.m1.1.2.9.1.cmml" xref="alg1.15.1.m1.1.2.9.2"><csymbol cd="latexml" id="alg1.15.1.m1.1.2.9.1.1.cmml" xref="alg1.15.1.m1.1.2.9.2.1">delimited-[]</csymbol><ci id="alg1.15.1.m1.1.1.cmml" xref="alg1.15.1.m1.1.1">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.15.1.m1.1c">SegMask[i]</annotation><annotation encoding="application/x-llamapun" id="alg1.15.1.m1.1d">italic_S italic_e italic_g italic_M italic_a italic_s italic_k [ italic_i ]</annotation></semantics></math> overlaps with <math alttext="M" class="ltx_Math" display="inline" id="alg1.16.2.m2.1"><semantics id="alg1.16.2.m2.1a"><mi id="alg1.16.2.m2.1.1" xref="alg1.16.2.m2.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="alg1.16.2.m2.1b"><ci id="alg1.16.2.m2.1.1.cmml" xref="alg1.16.2.m2.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.16.2.m2.1c">M</annotation><annotation encoding="application/x-llamapun" id="alg1.16.2.m2.1d">italic_M</annotation></semantics></math></em> <span class="ltx_text ltx_font_bold" id="alg1.16.4">then</span>
</div>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_3">
<div class="ltx_block ltx_figure_panel" id="alg1.22">
<div class="ltx_listingline ltx_figure_panel" id="alg1.20">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
Get <math alttext="Pixel_{in/out}" class="ltx_Math" display="inline" id="alg1.17.m1.1"><semantics id="alg1.17.m1.1a"><mrow id="alg1.17.m1.1.1" xref="alg1.17.m1.1.1.cmml"><mi id="alg1.17.m1.1.1.2" xref="alg1.17.m1.1.1.2.cmml">P</mi><mo id="alg1.17.m1.1.1.1" xref="alg1.17.m1.1.1.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.3" xref="alg1.17.m1.1.1.3.cmml">i</mi><mo id="alg1.17.m1.1.1.1a" xref="alg1.17.m1.1.1.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.4" xref="alg1.17.m1.1.1.4.cmml">x</mi><mo id="alg1.17.m1.1.1.1b" xref="alg1.17.m1.1.1.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.5" xref="alg1.17.m1.1.1.5.cmml">e</mi><mo id="alg1.17.m1.1.1.1c" xref="alg1.17.m1.1.1.1.cmml">⁢</mo><msub id="alg1.17.m1.1.1.6" xref="alg1.17.m1.1.1.6.cmml"><mi id="alg1.17.m1.1.1.6.2" xref="alg1.17.m1.1.1.6.2.cmml">l</mi><mrow id="alg1.17.m1.1.1.6.3" xref="alg1.17.m1.1.1.6.3.cmml"><mrow id="alg1.17.m1.1.1.6.3.2" xref="alg1.17.m1.1.1.6.3.2.cmml"><mrow id="alg1.17.m1.1.1.6.3.2.2" xref="alg1.17.m1.1.1.6.3.2.2.cmml"><mi id="alg1.17.m1.1.1.6.3.2.2.2" xref="alg1.17.m1.1.1.6.3.2.2.2.cmml">i</mi><mo id="alg1.17.m1.1.1.6.3.2.2.1" xref="alg1.17.m1.1.1.6.3.2.2.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.6.3.2.2.3" xref="alg1.17.m1.1.1.6.3.2.2.3.cmml">n</mi></mrow><mo id="alg1.17.m1.1.1.6.3.2.1" xref="alg1.17.m1.1.1.6.3.2.1.cmml">/</mo><mi id="alg1.17.m1.1.1.6.3.2.3" xref="alg1.17.m1.1.1.6.3.2.3.cmml">o</mi></mrow><mo id="alg1.17.m1.1.1.6.3.1" xref="alg1.17.m1.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.6.3.3" xref="alg1.17.m1.1.1.6.3.3.cmml">u</mi><mo id="alg1.17.m1.1.1.6.3.1a" xref="alg1.17.m1.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.17.m1.1.1.6.3.4" xref="alg1.17.m1.1.1.6.3.4.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.17.m1.1b"><apply id="alg1.17.m1.1.1.cmml" xref="alg1.17.m1.1.1"><times id="alg1.17.m1.1.1.1.cmml" xref="alg1.17.m1.1.1.1"></times><ci id="alg1.17.m1.1.1.2.cmml" xref="alg1.17.m1.1.1.2">𝑃</ci><ci id="alg1.17.m1.1.1.3.cmml" xref="alg1.17.m1.1.1.3">𝑖</ci><ci id="alg1.17.m1.1.1.4.cmml" xref="alg1.17.m1.1.1.4">𝑥</ci><ci id="alg1.17.m1.1.1.5.cmml" xref="alg1.17.m1.1.1.5">𝑒</ci><apply id="alg1.17.m1.1.1.6.cmml" xref="alg1.17.m1.1.1.6"><csymbol cd="ambiguous" id="alg1.17.m1.1.1.6.1.cmml" xref="alg1.17.m1.1.1.6">subscript</csymbol><ci id="alg1.17.m1.1.1.6.2.cmml" xref="alg1.17.m1.1.1.6.2">𝑙</ci><apply id="alg1.17.m1.1.1.6.3.cmml" xref="alg1.17.m1.1.1.6.3"><times id="alg1.17.m1.1.1.6.3.1.cmml" xref="alg1.17.m1.1.1.6.3.1"></times><apply id="alg1.17.m1.1.1.6.3.2.cmml" xref="alg1.17.m1.1.1.6.3.2"><divide id="alg1.17.m1.1.1.6.3.2.1.cmml" xref="alg1.17.m1.1.1.6.3.2.1"></divide><apply id="alg1.17.m1.1.1.6.3.2.2.cmml" xref="alg1.17.m1.1.1.6.3.2.2"><times id="alg1.17.m1.1.1.6.3.2.2.1.cmml" xref="alg1.17.m1.1.1.6.3.2.2.1"></times><ci id="alg1.17.m1.1.1.6.3.2.2.2.cmml" xref="alg1.17.m1.1.1.6.3.2.2.2">𝑖</ci><ci id="alg1.17.m1.1.1.6.3.2.2.3.cmml" xref="alg1.17.m1.1.1.6.3.2.2.3">𝑛</ci></apply><ci id="alg1.17.m1.1.1.6.3.2.3.cmml" xref="alg1.17.m1.1.1.6.3.2.3">𝑜</ci></apply><ci id="alg1.17.m1.1.1.6.3.3.cmml" xref="alg1.17.m1.1.1.6.3.3">𝑢</ci><ci id="alg1.17.m1.1.1.6.3.4.cmml" xref="alg1.17.m1.1.1.6.3.4">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.17.m1.1c">Pixel_{in/out}</annotation><annotation encoding="application/x-llamapun" id="alg1.17.m1.1d">italic_P italic_i italic_x italic_e italic_l start_POSTSUBSCRIPT italic_i italic_n / italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> in <math alttext="EdgePixels\in SegMask[i]" class="ltx_Math" display="inline" id="alg1.18.m2.1"><semantics id="alg1.18.m2.1a"><mrow id="alg1.18.m2.1.2" xref="alg1.18.m2.1.2.cmml"><mrow id="alg1.18.m2.1.2.2" xref="alg1.18.m2.1.2.2.cmml"><mi id="alg1.18.m2.1.2.2.2" xref="alg1.18.m2.1.2.2.2.cmml">E</mi><mo id="alg1.18.m2.1.2.2.1" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.3" xref="alg1.18.m2.1.2.2.3.cmml">d</mi><mo id="alg1.18.m2.1.2.2.1a" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.4" xref="alg1.18.m2.1.2.2.4.cmml">g</mi><mo id="alg1.18.m2.1.2.2.1b" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.5" xref="alg1.18.m2.1.2.2.5.cmml">e</mi><mo id="alg1.18.m2.1.2.2.1c" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.6" xref="alg1.18.m2.1.2.2.6.cmml">P</mi><mo id="alg1.18.m2.1.2.2.1d" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.7" xref="alg1.18.m2.1.2.2.7.cmml">i</mi><mo id="alg1.18.m2.1.2.2.1e" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.8" xref="alg1.18.m2.1.2.2.8.cmml">x</mi><mo id="alg1.18.m2.1.2.2.1f" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.9" xref="alg1.18.m2.1.2.2.9.cmml">e</mi><mo id="alg1.18.m2.1.2.2.1g" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.10" xref="alg1.18.m2.1.2.2.10.cmml">l</mi><mo id="alg1.18.m2.1.2.2.1h" xref="alg1.18.m2.1.2.2.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.2.11" xref="alg1.18.m2.1.2.2.11.cmml">s</mi></mrow><mo id="alg1.18.m2.1.2.1" xref="alg1.18.m2.1.2.1.cmml">∈</mo><mrow id="alg1.18.m2.1.2.3" xref="alg1.18.m2.1.2.3.cmml"><mi id="alg1.18.m2.1.2.3.2" xref="alg1.18.m2.1.2.3.2.cmml">S</mi><mo id="alg1.18.m2.1.2.3.1" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.3" xref="alg1.18.m2.1.2.3.3.cmml">e</mi><mo id="alg1.18.m2.1.2.3.1a" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.4" xref="alg1.18.m2.1.2.3.4.cmml">g</mi><mo id="alg1.18.m2.1.2.3.1b" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.5" xref="alg1.18.m2.1.2.3.5.cmml">M</mi><mo id="alg1.18.m2.1.2.3.1c" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.6" xref="alg1.18.m2.1.2.3.6.cmml">a</mi><mo id="alg1.18.m2.1.2.3.1d" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.7" xref="alg1.18.m2.1.2.3.7.cmml">s</mi><mo id="alg1.18.m2.1.2.3.1e" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mi id="alg1.18.m2.1.2.3.8" xref="alg1.18.m2.1.2.3.8.cmml">k</mi><mo id="alg1.18.m2.1.2.3.1f" xref="alg1.18.m2.1.2.3.1.cmml">⁢</mo><mrow id="alg1.18.m2.1.2.3.9.2" xref="alg1.18.m2.1.2.3.9.1.cmml"><mo id="alg1.18.m2.1.2.3.9.2.1" stretchy="false" xref="alg1.18.m2.1.2.3.9.1.1.cmml">[</mo><mi id="alg1.18.m2.1.1" xref="alg1.18.m2.1.1.cmml">i</mi><mo id="alg1.18.m2.1.2.3.9.2.2" stretchy="false" xref="alg1.18.m2.1.2.3.9.1.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.18.m2.1b"><apply id="alg1.18.m2.1.2.cmml" xref="alg1.18.m2.1.2"><in id="alg1.18.m2.1.2.1.cmml" xref="alg1.18.m2.1.2.1"></in><apply id="alg1.18.m2.1.2.2.cmml" xref="alg1.18.m2.1.2.2"><times id="alg1.18.m2.1.2.2.1.cmml" xref="alg1.18.m2.1.2.2.1"></times><ci id="alg1.18.m2.1.2.2.2.cmml" xref="alg1.18.m2.1.2.2.2">𝐸</ci><ci id="alg1.18.m2.1.2.2.3.cmml" xref="alg1.18.m2.1.2.2.3">𝑑</ci><ci id="alg1.18.m2.1.2.2.4.cmml" xref="alg1.18.m2.1.2.2.4">𝑔</ci><ci id="alg1.18.m2.1.2.2.5.cmml" xref="alg1.18.m2.1.2.2.5">𝑒</ci><ci id="alg1.18.m2.1.2.2.6.cmml" xref="alg1.18.m2.1.2.2.6">𝑃</ci><ci id="alg1.18.m2.1.2.2.7.cmml" xref="alg1.18.m2.1.2.2.7">𝑖</ci><ci id="alg1.18.m2.1.2.2.8.cmml" xref="alg1.18.m2.1.2.2.8">𝑥</ci><ci id="alg1.18.m2.1.2.2.9.cmml" xref="alg1.18.m2.1.2.2.9">𝑒</ci><ci id="alg1.18.m2.1.2.2.10.cmml" xref="alg1.18.m2.1.2.2.10">𝑙</ci><ci id="alg1.18.m2.1.2.2.11.cmml" xref="alg1.18.m2.1.2.2.11">𝑠</ci></apply><apply id="alg1.18.m2.1.2.3.cmml" xref="alg1.18.m2.1.2.3"><times id="alg1.18.m2.1.2.3.1.cmml" xref="alg1.18.m2.1.2.3.1"></times><ci id="alg1.18.m2.1.2.3.2.cmml" xref="alg1.18.m2.1.2.3.2">𝑆</ci><ci id="alg1.18.m2.1.2.3.3.cmml" xref="alg1.18.m2.1.2.3.3">𝑒</ci><ci id="alg1.18.m2.1.2.3.4.cmml" xref="alg1.18.m2.1.2.3.4">𝑔</ci><ci id="alg1.18.m2.1.2.3.5.cmml" xref="alg1.18.m2.1.2.3.5">𝑀</ci><ci id="alg1.18.m2.1.2.3.6.cmml" xref="alg1.18.m2.1.2.3.6">𝑎</ci><ci id="alg1.18.m2.1.2.3.7.cmml" xref="alg1.18.m2.1.2.3.7">𝑠</ci><ci id="alg1.18.m2.1.2.3.8.cmml" xref="alg1.18.m2.1.2.3.8">𝑘</ci><apply id="alg1.18.m2.1.2.3.9.1.cmml" xref="alg1.18.m2.1.2.3.9.2"><csymbol cd="latexml" id="alg1.18.m2.1.2.3.9.1.1.cmml" xref="alg1.18.m2.1.2.3.9.2.1">delimited-[]</csymbol><ci id="alg1.18.m2.1.1.cmml" xref="alg1.18.m2.1.1">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.18.m2.1c">EdgePixels\in SegMask[i]</annotation><annotation encoding="application/x-llamapun" id="alg1.18.m2.1d">italic_E italic_d italic_g italic_e italic_P italic_i italic_x italic_e italic_l italic_s ∈ italic_S italic_e italic_g italic_M italic_a italic_s italic_k [ italic_i ]</annotation></semantics></math>
<br class="ltx_break"/>Get <math alttext="Patch_{in/out}" class="ltx_Math" display="inline" id="alg1.19.m3.1"><semantics id="alg1.19.m3.1a"><mrow id="alg1.19.m3.1.1" xref="alg1.19.m3.1.1.cmml"><mi id="alg1.19.m3.1.1.2" xref="alg1.19.m3.1.1.2.cmml">P</mi><mo id="alg1.19.m3.1.1.1" xref="alg1.19.m3.1.1.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.3" xref="alg1.19.m3.1.1.3.cmml">a</mi><mo id="alg1.19.m3.1.1.1a" xref="alg1.19.m3.1.1.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.4" xref="alg1.19.m3.1.1.4.cmml">t</mi><mo id="alg1.19.m3.1.1.1b" xref="alg1.19.m3.1.1.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.5" xref="alg1.19.m3.1.1.5.cmml">c</mi><mo id="alg1.19.m3.1.1.1c" xref="alg1.19.m3.1.1.1.cmml">⁢</mo><msub id="alg1.19.m3.1.1.6" xref="alg1.19.m3.1.1.6.cmml"><mi id="alg1.19.m3.1.1.6.2" xref="alg1.19.m3.1.1.6.2.cmml">h</mi><mrow id="alg1.19.m3.1.1.6.3" xref="alg1.19.m3.1.1.6.3.cmml"><mrow id="alg1.19.m3.1.1.6.3.2" xref="alg1.19.m3.1.1.6.3.2.cmml"><mrow id="alg1.19.m3.1.1.6.3.2.2" xref="alg1.19.m3.1.1.6.3.2.2.cmml"><mi id="alg1.19.m3.1.1.6.3.2.2.2" xref="alg1.19.m3.1.1.6.3.2.2.2.cmml">i</mi><mo id="alg1.19.m3.1.1.6.3.2.2.1" xref="alg1.19.m3.1.1.6.3.2.2.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.6.3.2.2.3" xref="alg1.19.m3.1.1.6.3.2.2.3.cmml">n</mi></mrow><mo id="alg1.19.m3.1.1.6.3.2.1" xref="alg1.19.m3.1.1.6.3.2.1.cmml">/</mo><mi id="alg1.19.m3.1.1.6.3.2.3" xref="alg1.19.m3.1.1.6.3.2.3.cmml">o</mi></mrow><mo id="alg1.19.m3.1.1.6.3.1" xref="alg1.19.m3.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.6.3.3" xref="alg1.19.m3.1.1.6.3.3.cmml">u</mi><mo id="alg1.19.m3.1.1.6.3.1a" xref="alg1.19.m3.1.1.6.3.1.cmml">⁢</mo><mi id="alg1.19.m3.1.1.6.3.4" xref="alg1.19.m3.1.1.6.3.4.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.19.m3.1b"><apply id="alg1.19.m3.1.1.cmml" xref="alg1.19.m3.1.1"><times id="alg1.19.m3.1.1.1.cmml" xref="alg1.19.m3.1.1.1"></times><ci id="alg1.19.m3.1.1.2.cmml" xref="alg1.19.m3.1.1.2">𝑃</ci><ci id="alg1.19.m3.1.1.3.cmml" xref="alg1.19.m3.1.1.3">𝑎</ci><ci id="alg1.19.m3.1.1.4.cmml" xref="alg1.19.m3.1.1.4">𝑡</ci><ci id="alg1.19.m3.1.1.5.cmml" xref="alg1.19.m3.1.1.5">𝑐</ci><apply id="alg1.19.m3.1.1.6.cmml" xref="alg1.19.m3.1.1.6"><csymbol cd="ambiguous" id="alg1.19.m3.1.1.6.1.cmml" xref="alg1.19.m3.1.1.6">subscript</csymbol><ci id="alg1.19.m3.1.1.6.2.cmml" xref="alg1.19.m3.1.1.6.2">ℎ</ci><apply id="alg1.19.m3.1.1.6.3.cmml" xref="alg1.19.m3.1.1.6.3"><times id="alg1.19.m3.1.1.6.3.1.cmml" xref="alg1.19.m3.1.1.6.3.1"></times><apply id="alg1.19.m3.1.1.6.3.2.cmml" xref="alg1.19.m3.1.1.6.3.2"><divide id="alg1.19.m3.1.1.6.3.2.1.cmml" xref="alg1.19.m3.1.1.6.3.2.1"></divide><apply id="alg1.19.m3.1.1.6.3.2.2.cmml" xref="alg1.19.m3.1.1.6.3.2.2"><times id="alg1.19.m3.1.1.6.3.2.2.1.cmml" xref="alg1.19.m3.1.1.6.3.2.2.1"></times><ci id="alg1.19.m3.1.1.6.3.2.2.2.cmml" xref="alg1.19.m3.1.1.6.3.2.2.2">𝑖</ci><ci id="alg1.19.m3.1.1.6.3.2.2.3.cmml" xref="alg1.19.m3.1.1.6.3.2.2.3">𝑛</ci></apply><ci id="alg1.19.m3.1.1.6.3.2.3.cmml" xref="alg1.19.m3.1.1.6.3.2.3">𝑜</ci></apply><ci id="alg1.19.m3.1.1.6.3.3.cmml" xref="alg1.19.m3.1.1.6.3.3">𝑢</ci><ci id="alg1.19.m3.1.1.6.3.4.cmml" xref="alg1.19.m3.1.1.6.3.4">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.19.m3.1c">Patch_{in/out}</annotation><annotation encoding="application/x-llamapun" id="alg1.19.m3.1d">italic_P italic_a italic_t italic_c italic_h start_POSTSUBSCRIPT italic_i italic_n / italic_o italic_u italic_t end_POSTSUBSCRIPT</annotation></semantics></math> in <math alttext="SegMask[i]" class="ltx_Math" display="inline" id="alg1.20.m4.1"><semantics id="alg1.20.m4.1a"><mrow id="alg1.20.m4.1.2" xref="alg1.20.m4.1.2.cmml"><mi id="alg1.20.m4.1.2.2" xref="alg1.20.m4.1.2.2.cmml">S</mi><mo id="alg1.20.m4.1.2.1" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.3" xref="alg1.20.m4.1.2.3.cmml">e</mi><mo id="alg1.20.m4.1.2.1a" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.4" xref="alg1.20.m4.1.2.4.cmml">g</mi><mo id="alg1.20.m4.1.2.1b" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.5" xref="alg1.20.m4.1.2.5.cmml">M</mi><mo id="alg1.20.m4.1.2.1c" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.6" xref="alg1.20.m4.1.2.6.cmml">a</mi><mo id="alg1.20.m4.1.2.1d" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.7" xref="alg1.20.m4.1.2.7.cmml">s</mi><mo id="alg1.20.m4.1.2.1e" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mi id="alg1.20.m4.1.2.8" xref="alg1.20.m4.1.2.8.cmml">k</mi><mo id="alg1.20.m4.1.2.1f" xref="alg1.20.m4.1.2.1.cmml">⁢</mo><mrow id="alg1.20.m4.1.2.9.2" xref="alg1.20.m4.1.2.9.1.cmml"><mo id="alg1.20.m4.1.2.9.2.1" stretchy="false" xref="alg1.20.m4.1.2.9.1.1.cmml">[</mo><mi id="alg1.20.m4.1.1" xref="alg1.20.m4.1.1.cmml">i</mi><mo id="alg1.20.m4.1.2.9.2.2" stretchy="false" xref="alg1.20.m4.1.2.9.1.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.20.m4.1b"><apply id="alg1.20.m4.1.2.cmml" xref="alg1.20.m4.1.2"><times id="alg1.20.m4.1.2.1.cmml" xref="alg1.20.m4.1.2.1"></times><ci id="alg1.20.m4.1.2.2.cmml" xref="alg1.20.m4.1.2.2">𝑆</ci><ci id="alg1.20.m4.1.2.3.cmml" xref="alg1.20.m4.1.2.3">𝑒</ci><ci id="alg1.20.m4.1.2.4.cmml" xref="alg1.20.m4.1.2.4">𝑔</ci><ci id="alg1.20.m4.1.2.5.cmml" xref="alg1.20.m4.1.2.5">𝑀</ci><ci id="alg1.20.m4.1.2.6.cmml" xref="alg1.20.m4.1.2.6">𝑎</ci><ci id="alg1.20.m4.1.2.7.cmml" xref="alg1.20.m4.1.2.7">𝑠</ci><ci id="alg1.20.m4.1.2.8.cmml" xref="alg1.20.m4.1.2.8">𝑘</ci><apply id="alg1.20.m4.1.2.9.1.cmml" xref="alg1.20.m4.1.2.9.2"><csymbol cd="latexml" id="alg1.20.m4.1.2.9.1.1.cmml" xref="alg1.20.m4.1.2.9.2.1">delimited-[]</csymbol><ci id="alg1.20.m4.1.1.cmml" xref="alg1.20.m4.1.1">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.20.m4.1c">SegMask[i]</annotation><annotation encoding="application/x-llamapun" id="alg1.20.m4.1d">italic_S italic_e italic_g italic_M italic_a italic_s italic_k [ italic_i ]</annotation></semantics></math>  

</div>
<div class="ltx_listingline" id="alg1.22.1">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
<span class="ltx_text ltx_font_bold" id="alg1.22.1.1">else</span>
</div>
</div>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<div class="ltx_block ltx_figure_panel" id="alg1.23">
<div class="ltx_listingline" id="alg1.23.1">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
continue  

</div>
<div class="ltx_listingline" id="alg1.23.2">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
</div>
</div>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<div class="ltx_listingline ltx_figure_panel" id="alg1.24">
</div>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.25.1.1">Algorithm 1</span> </span> Material-Consistent Shadow Edge Extraction</figcaption>
</figure>
<figure class="ltx_figure" id="S1.F1a">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="152" id="S1.F1a.g1" src="extracted/5846543/pics_supp/finetunesam1.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="152" id="S1.F1a.g2" src="extracted/5846543/pics_supp/finetunesam2.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S1.F1a.2"><span class="ltx_text ltx_inline-block" id="S1.F1a.2.1" style="font-size:90%;width:138.8pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S1.F1a.2.2" style="font-size:90%;width:138.8pt;">Vanilla SAM</span>
<span class="ltx_text ltx_inline-block" id="S1.F1a.2.3" style="font-size:90%;width:138.8pt;">Fine-tuned SAM</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S1.F1a.3.1.1" style="font-size:90%;">Figure 1</span>: </span><span class="ltx_text" id="S1.F1a.4.2" style="font-size:90%;">More examples of improved material-consistent mask segmentation by our fine-tuned SAM.</span></figcaption>
</figure>
<div class="ltx_para" id="S1a.p2">
<p class="ltx_p" id="S1a.p2.1">To demonstrate the effectiveness of fine-tuned SAM in extracting material-consistent shadow edge, we compare its performance to vanilla SAM on different materials. <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S1.T1" title="In 1 Details of Material-Consistent Shadow Edge Extraction ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">1</span></a> presents the percentage of edge pixels extracted by each SAM model across various materials in the ISTD+ dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>. The results indicate that our proposed method significantly outperforms vanilla SAM, successfully extracting shadow edge pixels across different material types.</p>
</div>
<figure class="ltx_table" id="S1.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S1.T1.2.1.1" style="font-size:90%;">Table 1</span>: </span><span class="ltx_text" id="S1.T1.3.2" style="font-size:90%;">Percentage of material-consistent shadow edge pixels detected (recall%) via vanilla SAM and our fine-tuned SAM.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S1.T1.4" style="width:151.8pt;height:60.6pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-36.8pt,14.7pt) scale(0.673186076274845,0.673186076274845) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S1.T1.4.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S1.T1.4.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S1.T1.4.1.1.1.1">Material Type</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.4.1.1.1.2">Vanilla SAM</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.4.1.1.1.3">Fine-tuned SAM</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S1.T1.4.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S1.T1.4.1.2.1.1">grass</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.1.2">85.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S1.T1.4.1.2.1.3">98.6</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S1.T1.4.1.3.2.1">cement</th>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.2.2">63.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S1.T1.4.1.3.2.3">96.0</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S1.T1.4.1.4.3.1">ceramic</th>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.3.2">66.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S1.T1.4.1.4.3.3">71.0</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S1.T1.4.1.5.4.1">playground</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.4.2">75.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.4.3">82.8</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_section" id="S2a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Correctness of the Proposed CDD Metric</h2>
<div class="ltx_para" id="S2a.p1">
<p class="ltx_p" id="S2a.p1.1">To justify the correctness of our proposed Color Distribution Difference (CDD) metric, we first show that the CDD value corresponds to the shadow intensity. As shown in the top row of <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S2.F2" title="In 2 Correctness of the Proposed CDD Metric ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">2</span></a>, we choose a shadow image and manually adjust the shadow intensity. We find that the weaker the shadow effect, the lower the CDD results, indicating that the CDD metric can effectively represent the quality of shadow removal.</p>
</div>
<div class="ltx_para" id="S2a.p2">
<p class="ltx_p" id="S2a.p2.1">Additionally, we show the CDD results on ground truth images from ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>. We compare the CDD values of the shadow-free images against their shadow counterparts, as shown in the bottom row of <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S2.F2" title="In 2 Correctness of the Proposed CDD Metric ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">2</span></a>. The CDD values for shadow-free images are at least two orders of magnitude lower than those for shadow images. Therefore, we believe CDD serves as a valuable metric for evaluating shadow removal performance when ground truth is unavailable.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="155" id="S2.F2.g1" src="extracted/5846543/pics_supp/cddeffect.jpg" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S2.F2.4.1.1" style="font-size:90%;">Figure 2</span>: </span><span class="ltx_text" id="S2.F2.5.2" style="font-size:90%;">Correctness of Color Distribution Difference metric. (<span class="ltx_text ltx_font_italic" id="S2.F2.5.2.1">top</span>) We manually adjust the shadow intensity from strong to weak, and the CDD values are lower when the shadow effect is weaker. (<span class="ltx_text ltx_font_italic" id="S2.F2.5.2.2">bottom</span>) We compare the CDD values of shadow images and their shadow-free counterparts, the CDD value of the shadow-free version is at least two orders of magnitude lower than the shadow version. CDD are computed using the pixels marked in the images and the values are reported in the images.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S2.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="125" id="S2.F3.g1" src="extracted/5846543/pics_supp/supdtd.jpg" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S2.F3.6.3.1" style="font-size:90%;">Figure 3</span>: </span><span class="ltx_text" id="S2.F3.4.2" style="font-size:90%;">Validation of our proposed CDD metric on DTD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib4" title="">4</a>]</cite>. We show examples from the subset. We apply a simple method to compute the CDD values on the DTD data using parallel lines in the middle (see the <math alttext="red" class="ltx_Math" display="inline" id="S2.F3.3.1.m1.1"><semantics id="S2.F3.3.1.m1.1b"><mrow id="S2.F3.3.1.m1.1.1" xref="S2.F3.3.1.m1.1.1.cmml"><mi id="S2.F3.3.1.m1.1.1.2" xref="S2.F3.3.1.m1.1.1.2.cmml">r</mi><mo id="S2.F3.3.1.m1.1.1.1" xref="S2.F3.3.1.m1.1.1.1.cmml">⁢</mo><mi id="S2.F3.3.1.m1.1.1.3" xref="S2.F3.3.1.m1.1.1.3.cmml">e</mi><mo id="S2.F3.3.1.m1.1.1.1b" xref="S2.F3.3.1.m1.1.1.1.cmml">⁢</mo><mi id="S2.F3.3.1.m1.1.1.4" xref="S2.F3.3.1.m1.1.1.4.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.F3.3.1.m1.1c"><apply id="S2.F3.3.1.m1.1.1.cmml" xref="S2.F3.3.1.m1.1.1"><times id="S2.F3.3.1.m1.1.1.1.cmml" xref="S2.F3.3.1.m1.1.1.1"></times><ci id="S2.F3.3.1.m1.1.1.2.cmml" xref="S2.F3.3.1.m1.1.1.2">𝑟</ci><ci id="S2.F3.3.1.m1.1.1.3.cmml" xref="S2.F3.3.1.m1.1.1.3">𝑒</ci><ci id="S2.F3.3.1.m1.1.1.4.cmml" xref="S2.F3.3.1.m1.1.1.4">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.3.1.m1.1d">red</annotation><annotation encoding="application/x-llamapun" id="S2.F3.3.1.m1.1e">italic_r italic_e italic_d</annotation></semantics></math> and <math alttext="green" class="ltx_Math" display="inline" id="S2.F3.4.2.m2.1"><semantics id="S2.F3.4.2.m2.1b"><mrow id="S2.F3.4.2.m2.1.1" xref="S2.F3.4.2.m2.1.1.cmml"><mi id="S2.F3.4.2.m2.1.1.2" xref="S2.F3.4.2.m2.1.1.2.cmml">g</mi><mo id="S2.F3.4.2.m2.1.1.1" xref="S2.F3.4.2.m2.1.1.1.cmml">⁢</mo><mi id="S2.F3.4.2.m2.1.1.3" xref="S2.F3.4.2.m2.1.1.3.cmml">r</mi><mo id="S2.F3.4.2.m2.1.1.1b" xref="S2.F3.4.2.m2.1.1.1.cmml">⁢</mo><mi id="S2.F3.4.2.m2.1.1.4" xref="S2.F3.4.2.m2.1.1.4.cmml">e</mi><mo id="S2.F3.4.2.m2.1.1.1c" xref="S2.F3.4.2.m2.1.1.1.cmml">⁢</mo><mi id="S2.F3.4.2.m2.1.1.5" xref="S2.F3.4.2.m2.1.1.5.cmml">e</mi><mo id="S2.F3.4.2.m2.1.1.1d" xref="S2.F3.4.2.m2.1.1.1.cmml">⁢</mo><mi id="S2.F3.4.2.m2.1.1.6" xref="S2.F3.4.2.m2.1.1.6.cmml">n</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.F3.4.2.m2.1c"><apply id="S2.F3.4.2.m2.1.1.cmml" xref="S2.F3.4.2.m2.1.1"><times id="S2.F3.4.2.m2.1.1.1.cmml" xref="S2.F3.4.2.m2.1.1.1"></times><ci id="S2.F3.4.2.m2.1.1.2.cmml" xref="S2.F3.4.2.m2.1.1.2">𝑔</ci><ci id="S2.F3.4.2.m2.1.1.3.cmml" xref="S2.F3.4.2.m2.1.1.3">𝑟</ci><ci id="S2.F3.4.2.m2.1.1.4.cmml" xref="S2.F3.4.2.m2.1.1.4">𝑒</ci><ci id="S2.F3.4.2.m2.1.1.5.cmml" xref="S2.F3.4.2.m2.1.1.5">𝑒</ci><ci id="S2.F3.4.2.m2.1.1.6.cmml" xref="S2.F3.4.2.m2.1.1.6">𝑛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.4.2.m2.1d">green</annotation><annotation encoding="application/x-llamapun" id="S2.F3.4.2.m2.1e">italic_g italic_r italic_e italic_e italic_n</annotation></semantics></math> lines in each image). We can see that this simple annotation still yields low CDD scores.</span></figcaption>
</figure>
<div class="ltx_para" id="S2a.p3">
<p class="ltx_p" id="S2a.p3.1">Finally, to validate the adequacy of our proposed CDD metric in measuring consistency alongside shadow edges, we select a subset from the DTD dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib4" title="">4</a>]</cite>, which we believe showcases more complex textures than our proposed shadow image dataset (<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S2.F3" title="In 2 Correctness of the Proposed CDD Metric ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">3</span></a>).
We evaluate the CDD score on pixels from parallel lines in the middle of the image. This result can be considered the upper bound of the ground truth CDD score for our proposed dataset.
The CDD measurement on this selected subset is 0.0022, significantly lower than the shadow removal results in the main paper (0.0157). This evaluation further demonstrates that the proposed CDD metric can effectively serve as a valuable shadow removal evaluation metric.</p>
</div>
</section>
<section class="ltx_section" id="S3a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models</h2>
<div class="ltx_para" id="S3a.p1">
<p class="ltx_p" id="S3a.p1.1">In our main paper, we conduct experiments using ground truth shadow masks sourced from established datasets <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib35" title="">35</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib18" title="">18</a>]</cite>.
These masks might not be available for ideal automated shadow removal systems used in real-world scenarios.
In this section, we show that our method can be used with shadow masks detected from a shadow detection method. We must note that shadow detection is a relatively easier task compared to shadow removal and a robust, scale-able shadow detection system is more feasible since shadow detection training data is much easier to obtain.
At some point, one can expect to get accurate shadow masks automatically, which could be directly incorporated into our system to improve shadow removal.</p>
</div>
<div class="ltx_para" id="S3a.p2">
<p class="ltx_p" id="S3a.p2.1">We use the state-of-the-art shadow detection method, SILT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib43" title="">43</a>]</cite>, to generate shadow masks for each testing image. <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.T2" title="In 3 Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">2</span></a> presents the detection performance on the two testing datasets using SILT.
Then, we compare the performance of ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> using ground truth shadow masks and these detected shadow masks in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.T3" title="In 3 Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">3</span></a>.
We find that on both the ISTD+ dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> and our proposed dataset, using detected masks results in worse shadow-removal performance compared to using ground truth masks. A typical failure case is shown in the top row of <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F4" title="In 3 Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a>.
Nevertheless, applying our method atop ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> can improve the performance in both cases, as shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.T3" title="In 3 Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">3</span></a>. The bottom row of <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S3.F4" title="In 3 Shadow-Removal Refinement Results Using Shadow Edges From Shadow Detection Models ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a> visualizes an example of how our method improves the shadow-removal result.</p>
</div>
<figure class="ltx_table" id="S3.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S3.T2.7.2.1" style="font-size:90%;">Table 2</span>: </span><span class="ltx_text" id="S3.T2.2.1" style="font-size:90%;">Shadow detection results on the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> and our proposed dataset by SILT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib43" title="">43</a>]</cite>. Following <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib43" title="">43</a>]</cite>, the performance is evaluated by the Balanced Error Rate (<math alttext="BER" class="ltx_Math" display="inline" id="S3.T2.2.1.m1.1"><semantics id="S3.T2.2.1.m1.1b"><mrow id="S3.T2.2.1.m1.1.1" xref="S3.T2.2.1.m1.1.1.cmml"><mi id="S3.T2.2.1.m1.1.1.2" xref="S3.T2.2.1.m1.1.1.2.cmml">B</mi><mo id="S3.T2.2.1.m1.1.1.1" xref="S3.T2.2.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.2.1.m1.1.1.3" xref="S3.T2.2.1.m1.1.1.3.cmml">E</mi><mo id="S3.T2.2.1.m1.1.1.1b" xref="S3.T2.2.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.2.1.m1.1.1.4" xref="S3.T2.2.1.m1.1.1.4.cmml">R</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.2.1.m1.1c"><apply id="S3.T2.2.1.m1.1.1.cmml" xref="S3.T2.2.1.m1.1.1"><times id="S3.T2.2.1.m1.1.1.1.cmml" xref="S3.T2.2.1.m1.1.1.1"></times><ci id="S3.T2.2.1.m1.1.1.2.cmml" xref="S3.T2.2.1.m1.1.1.2">𝐵</ci><ci id="S3.T2.2.1.m1.1.1.3.cmml" xref="S3.T2.2.1.m1.1.1.3">𝐸</ci><ci id="S3.T2.2.1.m1.1.1.4.cmml" xref="S3.T2.2.1.m1.1.1.4">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.2.1.m1.1d">BER</annotation><annotation encoding="application/x-llamapun" id="S3.T2.2.1.m1.1e">italic_B italic_E italic_R</annotation></semantics></math>).</span></figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T2.5">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T2.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S3.T2.5.3.4">Dataset</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.3.1.1"><math alttext="BER" class="ltx_Math" display="inline" id="S3.T2.3.1.1.m1.1"><semantics id="S3.T2.3.1.1.m1.1a"><mrow id="S3.T2.3.1.1.m1.1.1" xref="S3.T2.3.1.1.m1.1.1.cmml"><mi id="S3.T2.3.1.1.m1.1.1.2" xref="S3.T2.3.1.1.m1.1.1.2.cmml">B</mi><mo id="S3.T2.3.1.1.m1.1.1.1" xref="S3.T2.3.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.3.1.1.m1.1.1.3" xref="S3.T2.3.1.1.m1.1.1.3.cmml">E</mi><mo id="S3.T2.3.1.1.m1.1.1.1a" xref="S3.T2.3.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.3.1.1.m1.1.1.4" xref="S3.T2.3.1.1.m1.1.1.4.cmml">R</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.3.1.1.m1.1b"><apply id="S3.T2.3.1.1.m1.1.1.cmml" xref="S3.T2.3.1.1.m1.1.1"><times id="S3.T2.3.1.1.m1.1.1.1.cmml" xref="S3.T2.3.1.1.m1.1.1.1"></times><ci id="S3.T2.3.1.1.m1.1.1.2.cmml" xref="S3.T2.3.1.1.m1.1.1.2">𝐵</ci><ci id="S3.T2.3.1.1.m1.1.1.3.cmml" xref="S3.T2.3.1.1.m1.1.1.3">𝐸</ci><ci id="S3.T2.3.1.1.m1.1.1.4.cmml" xref="S3.T2.3.1.1.m1.1.1.4">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.3.1.1.m1.1c">BER</annotation><annotation encoding="application/x-llamapun" id="S3.T2.3.1.1.m1.1d">italic_B italic_E italic_R</annotation></semantics></math></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.4.2.2"><math alttext="BER_{S}" class="ltx_Math" display="inline" id="S3.T2.4.2.2.m1.1"><semantics id="S3.T2.4.2.2.m1.1a"><mrow id="S3.T2.4.2.2.m1.1.1" xref="S3.T2.4.2.2.m1.1.1.cmml"><mi id="S3.T2.4.2.2.m1.1.1.2" xref="S3.T2.4.2.2.m1.1.1.2.cmml">B</mi><mo id="S3.T2.4.2.2.m1.1.1.1" xref="S3.T2.4.2.2.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.4.2.2.m1.1.1.3" xref="S3.T2.4.2.2.m1.1.1.3.cmml">E</mi><mo id="S3.T2.4.2.2.m1.1.1.1a" xref="S3.T2.4.2.2.m1.1.1.1.cmml">⁢</mo><msub id="S3.T2.4.2.2.m1.1.1.4" xref="S3.T2.4.2.2.m1.1.1.4.cmml"><mi id="S3.T2.4.2.2.m1.1.1.4.2" xref="S3.T2.4.2.2.m1.1.1.4.2.cmml">R</mi><mi id="S3.T2.4.2.2.m1.1.1.4.3" xref="S3.T2.4.2.2.m1.1.1.4.3.cmml">S</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.4.2.2.m1.1b"><apply id="S3.T2.4.2.2.m1.1.1.cmml" xref="S3.T2.4.2.2.m1.1.1"><times id="S3.T2.4.2.2.m1.1.1.1.cmml" xref="S3.T2.4.2.2.m1.1.1.1"></times><ci id="S3.T2.4.2.2.m1.1.1.2.cmml" xref="S3.T2.4.2.2.m1.1.1.2">𝐵</ci><ci id="S3.T2.4.2.2.m1.1.1.3.cmml" xref="S3.T2.4.2.2.m1.1.1.3">𝐸</ci><apply id="S3.T2.4.2.2.m1.1.1.4.cmml" xref="S3.T2.4.2.2.m1.1.1.4"><csymbol cd="ambiguous" id="S3.T2.4.2.2.m1.1.1.4.1.cmml" xref="S3.T2.4.2.2.m1.1.1.4">subscript</csymbol><ci id="S3.T2.4.2.2.m1.1.1.4.2.cmml" xref="S3.T2.4.2.2.m1.1.1.4.2">𝑅</ci><ci id="S3.T2.4.2.2.m1.1.1.4.3.cmml" xref="S3.T2.4.2.2.m1.1.1.4.3">𝑆</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.4.2.2.m1.1c">BER_{S}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.4.2.2.m1.1d">italic_B italic_E italic_R start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math></th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.5.3.3"><math alttext="BER_{NS}" class="ltx_Math" display="inline" id="S3.T2.5.3.3.m1.1"><semantics id="S3.T2.5.3.3.m1.1a"><mrow id="S3.T2.5.3.3.m1.1.1" xref="S3.T2.5.3.3.m1.1.1.cmml"><mi id="S3.T2.5.3.3.m1.1.1.2" xref="S3.T2.5.3.3.m1.1.1.2.cmml">B</mi><mo id="S3.T2.5.3.3.m1.1.1.1" xref="S3.T2.5.3.3.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.5.3.3.m1.1.1.3" xref="S3.T2.5.3.3.m1.1.1.3.cmml">E</mi><mo id="S3.T2.5.3.3.m1.1.1.1a" xref="S3.T2.5.3.3.m1.1.1.1.cmml">⁢</mo><msub id="S3.T2.5.3.3.m1.1.1.4" xref="S3.T2.5.3.3.m1.1.1.4.cmml"><mi id="S3.T2.5.3.3.m1.1.1.4.2" xref="S3.T2.5.3.3.m1.1.1.4.2.cmml">R</mi><mrow id="S3.T2.5.3.3.m1.1.1.4.3" xref="S3.T2.5.3.3.m1.1.1.4.3.cmml"><mi id="S3.T2.5.3.3.m1.1.1.4.3.2" xref="S3.T2.5.3.3.m1.1.1.4.3.2.cmml">N</mi><mo id="S3.T2.5.3.3.m1.1.1.4.3.1" xref="S3.T2.5.3.3.m1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.T2.5.3.3.m1.1.1.4.3.3" xref="S3.T2.5.3.3.m1.1.1.4.3.3.cmml">S</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.5.3.3.m1.1b"><apply id="S3.T2.5.3.3.m1.1.1.cmml" xref="S3.T2.5.3.3.m1.1.1"><times id="S3.T2.5.3.3.m1.1.1.1.cmml" xref="S3.T2.5.3.3.m1.1.1.1"></times><ci id="S3.T2.5.3.3.m1.1.1.2.cmml" xref="S3.T2.5.3.3.m1.1.1.2">𝐵</ci><ci id="S3.T2.5.3.3.m1.1.1.3.cmml" xref="S3.T2.5.3.3.m1.1.1.3">𝐸</ci><apply id="S3.T2.5.3.3.m1.1.1.4.cmml" xref="S3.T2.5.3.3.m1.1.1.4"><csymbol cd="ambiguous" id="S3.T2.5.3.3.m1.1.1.4.1.cmml" xref="S3.T2.5.3.3.m1.1.1.4">subscript</csymbol><ci id="S3.T2.5.3.3.m1.1.1.4.2.cmml" xref="S3.T2.5.3.3.m1.1.1.4.2">𝑅</ci><apply id="S3.T2.5.3.3.m1.1.1.4.3.cmml" xref="S3.T2.5.3.3.m1.1.1.4.3"><times id="S3.T2.5.3.3.m1.1.1.4.3.1.cmml" xref="S3.T2.5.3.3.m1.1.1.4.3.1"></times><ci id="S3.T2.5.3.3.m1.1.1.4.3.2.cmml" xref="S3.T2.5.3.3.m1.1.1.4.3.2">𝑁</ci><ci id="S3.T2.5.3.3.m1.1.1.4.3.3.cmml" xref="S3.T2.5.3.3.m1.1.1.4.3.3">𝑆</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.5.3.3.m1.1c">BER_{NS}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.5.3.3.m1.1d">italic_B italic_E italic_R start_POSTSUBSCRIPT italic_N italic_S end_POSTSUBSCRIPT</annotation></semantics></math></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T2.5.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S3.T2.5.4.1.1">ISTD+</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.5.4.1.2">1.12</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.5.4.1.3">0.80</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S3.T2.5.4.1.4">1.44</td>
</tr>
<tr class="ltx_tr" id="S3.T2.5.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S3.T2.5.5.2.1">Proposed</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T2.5.5.2.2">4.05</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T2.5.5.2.3">4.02</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S3.T2.5.5.2.4">4.09</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="S3.T3">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S3.T3.2.1.1" style="font-size:90%;">Table 3</span>: </span><span class="ltx_text" id="S3.T3.3.2" style="font-size:90%;">Quantitative comparison of results using ground truth shadow mask and SILT-detected shadow mask on <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> and <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>+Ours. MAE and CDD are reported. Note that CDD is reported in 1000× the original value.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S3.T3.4" style="width:433.6pt;height:132.1pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(10.0pt,-3.1pt) scale(1.04858566104572,1.04858566104572) ;">
<table class="ltx_tabular ltx_align_middle" id="S3.T3.4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T3.4.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S3.T3.4.1.1.1.1" rowspan="3"><span class="ltx_text" id="S3.T3.4.1.1.1.1.1">Methods</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="2" id="S3.T3.4.1.1.1.2">Proposed</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="5" id="S3.T3.4.1.1.1.3">ISTD+</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="2" id="S3.T3.4.1.2.2.1">CDD</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S3.T3.4.1.2.2.2">MAE</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S3.T3.4.1.2.2.3">CDD</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.3.3">
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.1">Mean</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.4.1.3.3.2">Var</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.3">S</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.4">NS</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.5">A</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.6">Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S3.T3.4.1.3.3.7">Var</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.4.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S3.T3.4.1.4.4.1">
<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> w. GT mask</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.2">25.0</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.4.1.4.4.3">40.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.4">5.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.5">2.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.6">2.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.7">1.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S3.T3.4.1.4.4.8">2.6</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.5.5">
<td class="ltx_td ltx_align_left ltx_border_t" id="S3.T3.4.1.5.5.1">Ours w. GT mask</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.2">15.9</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.4.1.5.5.3">30.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.4">5.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.5">2.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.6">2.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.7">1.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S3.T3.4.1.5.5.8">1.6</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.6.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="S3.T3.4.1.6.6.1">
<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> w. detected mask</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.2">25.8</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.4.1.6.6.3">42.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.4">6.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.5">2.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.6">3.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.7">2.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S3.T3.4.1.6.6.8">9.8</td>
</tr>
<tr class="ltx_tr" id="S3.T3.4.1.7.7">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.1">Ours w. detected mask</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.2">19.3</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S3.T3.4.1.7.7.3">38.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.4">5.7</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.5">2.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.6">3.0</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.7">2.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S3.T3.4.1.7.7.8">8.4</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S3.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="228" id="S3.F4.g1" src="extracted/5846543/pics_supp/detected.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S3.F4.2"><span class="ltx_text ltx_inline-block" id="S3.F4.2.1" style="font-size:90%;width:104.1pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S3.F4.2.2" style="font-size:90%;width:104.1pt;">Detected mask</span>
<span class="ltx_text ltx_inline-block" id="S3.F4.2.3" style="width:104.1pt;"><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S3.F4.2.3.1.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S3.F4.2.3.2.2" style="font-size:90%;">]</span></cite></span>
<span class="ltx_text ltx_inline-block" id="S3.F4.2.4" style="font-size:90%;width:104.1pt;">Ours</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F4.3.1.1" style="font-size:90%;">Figure 4</span>: </span><span class="ltx_text" id="S3.F4.4.2" style="font-size:90%;">Examples of using SILT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib43" title="">43</a>]</cite> detected masks for shadow removal refinement. Top row shows a failure case in ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>, where the dark region is predicted as the shadow region, leading to an inaccurate shadow removal result that our refinement method cannot rectify. Bottom row shows a successful case in the proposed dataset, where an accurate shadow mask is predicted and our refinement method improves the shadow removal performance.</span></figcaption>
</figure>
</section>
<section class="ltx_section" id="S4a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Further Details of Implementation</h2>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Computation Overhead</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">Our approach iteratively refines the pre-trained model using extracted self-supervision. During testing on our proposed dataset, we update the whole model for 20 iterations per image, which results in an average of 24 seconds overhead on an NVIDIA TITAN RTX GPU.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1">We further investigate the refining performance on different numbers of iterations and different model update policies (<em class="ltx_emph ltx_font_italic" id="S4.SS1.p2.1.1">e.g</em>.<span class="ltx_text" id="S4.SS1.p2.1.2"></span> updating only the last decoder layer of ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>).
The results are shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.T4" title="In 4.1 Computation Overhead ‣ 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">4</span></a>. Breaking down the overhead, our shadow edge extraction process takes 2 seconds, and each model update iteration requires approximately 1 second.
It is evident that the number of iterations is the primary cause of our computational overhead. Additionally, we found that partially updating the model does not improve the efficiency of our refinement and leads to decreased performance.</p>
</div>
<figure class="ltx_table" id="S4.T4">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T4.2.1.1" style="font-size:90%;">Table 4</span>: </span><span class="ltx_text" id="S4.T4.3.2" style="font-size:90%;">Comparison of performance and computation overhead using different numbers of iterations and update policies. We report the CDD mean values on the full proposed test set.</span></figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S4.T4.4">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T4.4.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T4.4.1.1.1"># of Iter</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S4.T4.4.1.1.2">Update</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T4.4.1.1.3">CDD Mean</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T4.4.1.1.4">Overhead (s)</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T4.4.2.1">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.2.1.1">10</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.2.1.2">whole</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.2.1.3">17.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.4.2.1.4">13</td>
</tr>
<tr class="ltx_tr" id="S4.T4.4.3.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.3.2.1" rowspan="2"><span class="ltx_text" id="S4.T4.4.3.2.1.1">20</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.3.2.2">whole</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.3.2.3">15.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.4.3.2.4">24</td>
</tr>
<tr class="ltx_tr" id="S4.T4.4.4.3">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.4.3.1">partial</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.4.3.2">19.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.4.4.3.3">24</td>
</tr>
<tr class="ltx_tr" id="S4.T4.4.5.4">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T4.4.5.4.1">30</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T4.4.5.4.2">whole</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T4.4.5.4.3">18.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S4.T4.4.5.4.4">36</td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Number and size of sampled patches</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">In the main paper, we sample 8 patches of size <math alttext="16\times 16" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.1"><semantics id="S4.SS2.p1.1.m1.1a"><mrow id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml"><mn id="S4.SS2.p1.1.m1.1.1.2" xref="S4.SS2.p1.1.m1.1.1.2.cmml">16</mn><mo id="S4.SS2.p1.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p1.1.m1.1.1.1.cmml">×</mo><mn id="S4.SS2.p1.1.m1.1.1.3" xref="S4.SS2.p1.1.m1.1.1.3.cmml">16</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.1b"><apply id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1"><times id="S4.SS2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1.1"></times><cn id="S4.SS2.p1.1.m1.1.1.2.cmml" type="integer" xref="S4.SS2.p1.1.m1.1.1.2">16</cn><cn id="S4.SS2.p1.1.m1.1.1.3.cmml" type="integer" xref="S4.SS2.p1.1.m1.1.1.3">16</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.1c">16\times 16</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.1d">16 × 16</annotation></semantics></math> in our final configuration. Here, we experiment with different numbers and sizes of patches and compare the shadow removal performance on our proposed dataset. As shown in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.T5" title="In 4.2 Number and size of sampled patches ‣ 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">5</span></a>, these hyper-parameters do not significantly affect overall performance.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T5.8.2.1" style="font-size:90%;">Table 5</span>: </span><span class="ltx_text" id="S4.T5.2.1" style="font-size:90%;">Quantitative comparison of using different numbers and sizes of sampled patches in our final configuration. Note that CDD values are reported in <math alttext="1000\times" class="ltx_math_unparsed" display="inline" id="S4.T5.2.1.m1.1"><semantics id="S4.T5.2.1.m1.1b"><mrow id="S4.T5.2.1.m1.1c"><mn id="S4.T5.2.1.m1.1.1">1000</mn><mo id="S4.T5.2.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.T5.2.1.m1.1d">1000\times</annotation><annotation encoding="application/x-llamapun" id="S4.T5.2.1.m1.1e">1000 ×</annotation></semantics></math> the original value.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T5.6" style="width:433.6pt;height:132.1pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(79.4pt,-24.2pt) scale(1.57827059093315,1.57827059093315) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T5.6.4">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T5.6.4.4">
<th class="ltx_td ltx_nopad ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T5.3.1.1.1"><svg height="28.83" overflow="visible" version="1.1" width="136.17"><g transform="translate(0,28.83) scale(1,-1)"><path d="M 68.085,28.83 136.17,0" stroke="#000000" stroke-width="0.4"></path><path d="M 0,14.415 136.17,0" stroke="#000000" stroke-width="0.4"></path><g class="ltx_svg_fog" transform="translate(0,0)"><g transform="translate(0,9.61) scale(1, -1)"><foreignobject height="9.61" overflow="visible" width="48.85">
<span class="ltx_inline-block" id="S4.T5.3.1.1.1.pic1.1.1">
<span class="ltx_inline-block ltx_align_left" id="S4.T5.3.1.1.1.pic1.1.1.1">
<span class="ltx_p" id="S4.T5.3.1.1.1.pic1.1.1.1.1">Number</span>
</span>
</span></foreignobject></g></g><g class="ltx_svg_fog" transform="translate(112.34,19.37)"><g transform="translate(0,9.46) scale(1, -1)"><foreignobject height="9.46" overflow="visible" width="23.83">
<span class="ltx_inline-block" id="S4.T5.3.1.1.1.pic1.2.1">
<span class="ltx_inline-block ltx_align_right" id="S4.T5.3.1.1.1.pic1.2.1.1">
<span class="ltx_p" id="S4.T5.3.1.1.1.pic1.2.1.1.1">Size</span>
</span>
</span></foreignobject></g></g><g class="ltx_svg_fog" transform="translate(0,14.99)"><g transform="translate(0,13.84) scale(1, -1)"><foreignobject height="13.84" overflow="visible" width="23.83">
<span class="ltx_inline-block" id="S4.T5.3.1.1.1.pic1.3.1">
<span class="ltx_inline-block ltx_align_left" id="S4.T5.3.1.1.1.pic1.3.1.1">
<span class="ltx_p" id="S4.T5.3.1.1.1.pic1.3.1.1.1">CDD Mean/Std.</span>
</span>
</span></foreignobject></g></g></g></svg></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T5.4.2.2.2"><math alttext="8\times 8" class="ltx_Math" display="inline" id="S4.T5.4.2.2.2.m1.1"><semantics id="S4.T5.4.2.2.2.m1.1a"><mrow id="S4.T5.4.2.2.2.m1.1.1" xref="S4.T5.4.2.2.2.m1.1.1.cmml"><mn id="S4.T5.4.2.2.2.m1.1.1.2" xref="S4.T5.4.2.2.2.m1.1.1.2.cmml">8</mn><mo id="S4.T5.4.2.2.2.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.T5.4.2.2.2.m1.1.1.1.cmml">×</mo><mn id="S4.T5.4.2.2.2.m1.1.1.3" xref="S4.T5.4.2.2.2.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T5.4.2.2.2.m1.1b"><apply id="S4.T5.4.2.2.2.m1.1.1.cmml" xref="S4.T5.4.2.2.2.m1.1.1"><times id="S4.T5.4.2.2.2.m1.1.1.1.cmml" xref="S4.T5.4.2.2.2.m1.1.1.1"></times><cn id="S4.T5.4.2.2.2.m1.1.1.2.cmml" type="integer" xref="S4.T5.4.2.2.2.m1.1.1.2">8</cn><cn id="S4.T5.4.2.2.2.m1.1.1.3.cmml" type="integer" xref="S4.T5.4.2.2.2.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.4.2.2.2.m1.1c">8\times 8</annotation><annotation encoding="application/x-llamapun" id="S4.T5.4.2.2.2.m1.1d">8 × 8</annotation></semantics></math></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T5.5.3.3.3"><math alttext="16\times 16" class="ltx_Math" display="inline" id="S4.T5.5.3.3.3.m1.1"><semantics id="S4.T5.5.3.3.3.m1.1a"><mrow id="S4.T5.5.3.3.3.m1.1.1" xref="S4.T5.5.3.3.3.m1.1.1.cmml"><mn id="S4.T5.5.3.3.3.m1.1.1.2" xref="S4.T5.5.3.3.3.m1.1.1.2.cmml">16</mn><mo id="S4.T5.5.3.3.3.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.T5.5.3.3.3.m1.1.1.1.cmml">×</mo><mn id="S4.T5.5.3.3.3.m1.1.1.3" xref="S4.T5.5.3.3.3.m1.1.1.3.cmml">16</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T5.5.3.3.3.m1.1b"><apply id="S4.T5.5.3.3.3.m1.1.1.cmml" xref="S4.T5.5.3.3.3.m1.1.1"><times id="S4.T5.5.3.3.3.m1.1.1.1.cmml" xref="S4.T5.5.3.3.3.m1.1.1.1"></times><cn id="S4.T5.5.3.3.3.m1.1.1.2.cmml" type="integer" xref="S4.T5.5.3.3.3.m1.1.1.2">16</cn><cn id="S4.T5.5.3.3.3.m1.1.1.3.cmml" type="integer" xref="S4.T5.5.3.3.3.m1.1.1.3">16</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.5.3.3.3.m1.1c">16\times 16</annotation><annotation encoding="application/x-llamapun" id="S4.T5.5.3.3.3.m1.1d">16 × 16</annotation></semantics></math></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T5.6.4.4.4"><math alttext="32\times 32" class="ltx_Math" display="inline" id="S4.T5.6.4.4.4.m1.1"><semantics id="S4.T5.6.4.4.4.m1.1a"><mrow id="S4.T5.6.4.4.4.m1.1.1" xref="S4.T5.6.4.4.4.m1.1.1.cmml"><mn id="S4.T5.6.4.4.4.m1.1.1.2" xref="S4.T5.6.4.4.4.m1.1.1.2.cmml">32</mn><mo id="S4.T5.6.4.4.4.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.T5.6.4.4.4.m1.1.1.1.cmml">×</mo><mn id="S4.T5.6.4.4.4.m1.1.1.3" xref="S4.T5.6.4.4.4.m1.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T5.6.4.4.4.m1.1b"><apply id="S4.T5.6.4.4.4.m1.1.1.cmml" xref="S4.T5.6.4.4.4.m1.1.1"><times id="S4.T5.6.4.4.4.m1.1.1.1.cmml" xref="S4.T5.6.4.4.4.m1.1.1.1"></times><cn id="S4.T5.6.4.4.4.m1.1.1.2.cmml" type="integer" xref="S4.T5.6.4.4.4.m1.1.1.2">32</cn><cn id="S4.T5.6.4.4.4.m1.1.1.3.cmml" type="integer" xref="S4.T5.6.4.4.4.m1.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.6.4.4.4.m1.1c">32\times 32</annotation><annotation encoding="application/x-llamapun" id="S4.T5.6.4.4.4.m1.1d">32 × 32</annotation></semantics></math></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T5.6.4.5.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T5.6.4.5.1.1">4</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.6.4.5.1.2">15.7/29.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.6.4.5.1.3">15.7/29.1</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.6.4.5.1.4">15.7/29.1</td>
</tr>
<tr class="ltx_tr" id="S4.T5.6.4.6.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T5.6.4.6.2.1">8</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.6.4.6.2.2">15.7/29.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.6.4.6.2.3">15.7/29.1</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.6.4.6.2.4">15.7/29.0</td>
</tr>
<tr class="ltx_tr" id="S4.T5.6.4.7.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="S4.T5.6.4.7.3.1">16</th>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S4.T5.6.4.7.3.2">15.8/29.2</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S4.T5.6.4.7.3.3">15.7/29.1</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T5.6.4.7.3.4">15.7/29.1</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Test settings</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.3">We provide detailed hyper-parameter settings in SAM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite>, SID <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>, and ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.T6" title="In 4.3 Test settings ‣ 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">6</span></a>.
For SAM, we use the <math alttext="vit\_b" class="ltx_Math" display="inline" id="S4.SS3.p1.1.m1.1"><semantics id="S4.SS3.p1.1.m1.1a"><mrow id="S4.SS3.p1.1.m1.1.1" xref="S4.SS3.p1.1.m1.1.1.cmml"><mi id="S4.SS3.p1.1.m1.1.1.2" xref="S4.SS3.p1.1.m1.1.1.2.cmml">v</mi><mo id="S4.SS3.p1.1.m1.1.1.1" xref="S4.SS3.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3" xref="S4.SS3.p1.1.m1.1.1.3.cmml">i</mi><mo id="S4.SS3.p1.1.m1.1.1.1a" xref="S4.SS3.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.4" xref="S4.SS3.p1.1.m1.1.1.4.cmml">t</mi><mo id="S4.SS3.p1.1.m1.1.1.1b" xref="S4.SS3.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.5" mathvariant="normal" xref="S4.SS3.p1.1.m1.1.1.5.cmml">_</mi><mo id="S4.SS3.p1.1.m1.1.1.1c" xref="S4.SS3.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.6" xref="S4.SS3.p1.1.m1.1.1.6.cmml">b</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.1.m1.1b"><apply id="S4.SS3.p1.1.m1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1"><times id="S4.SS3.p1.1.m1.1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1.1"></times><ci id="S4.SS3.p1.1.m1.1.1.2.cmml" xref="S4.SS3.p1.1.m1.1.1.2">𝑣</ci><ci id="S4.SS3.p1.1.m1.1.1.3.cmml" xref="S4.SS3.p1.1.m1.1.1.3">𝑖</ci><ci id="S4.SS3.p1.1.m1.1.1.4.cmml" xref="S4.SS3.p1.1.m1.1.1.4">𝑡</ci><ci id="S4.SS3.p1.1.m1.1.1.5.cmml" xref="S4.SS3.p1.1.m1.1.1.5">_</ci><ci id="S4.SS3.p1.1.m1.1.1.6.cmml" xref="S4.SS3.p1.1.m1.1.1.6">𝑏</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.1.m1.1c">vit\_b</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.1.m1.1d">italic_v italic_i italic_t _ italic_b</annotation></semantics></math> model with the learning rate set to <math alttext="1e^{-4}" class="ltx_Math" display="inline" id="S4.SS3.p1.2.m2.1"><semantics id="S4.SS3.p1.2.m2.1a"><mrow id="S4.SS3.p1.2.m2.1.1" xref="S4.SS3.p1.2.m2.1.1.cmml"><mn id="S4.SS3.p1.2.m2.1.1.2" xref="S4.SS3.p1.2.m2.1.1.2.cmml">1</mn><mo id="S4.SS3.p1.2.m2.1.1.1" xref="S4.SS3.p1.2.m2.1.1.1.cmml">⁢</mo><msup id="S4.SS3.p1.2.m2.1.1.3" xref="S4.SS3.p1.2.m2.1.1.3.cmml"><mi id="S4.SS3.p1.2.m2.1.1.3.2" xref="S4.SS3.p1.2.m2.1.1.3.2.cmml">e</mi><mrow id="S4.SS3.p1.2.m2.1.1.3.3" xref="S4.SS3.p1.2.m2.1.1.3.3.cmml"><mo id="S4.SS3.p1.2.m2.1.1.3.3a" xref="S4.SS3.p1.2.m2.1.1.3.3.cmml">−</mo><mn id="S4.SS3.p1.2.m2.1.1.3.3.2" xref="S4.SS3.p1.2.m2.1.1.3.3.2.cmml">4</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.2.m2.1b"><apply id="S4.SS3.p1.2.m2.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1"><times id="S4.SS3.p1.2.m2.1.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1.1"></times><cn id="S4.SS3.p1.2.m2.1.1.2.cmml" type="integer" xref="S4.SS3.p1.2.m2.1.1.2">1</cn><apply id="S4.SS3.p1.2.m2.1.1.3.cmml" xref="S4.SS3.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S4.SS3.p1.2.m2.1.1.3.1.cmml" xref="S4.SS3.p1.2.m2.1.1.3">superscript</csymbol><ci id="S4.SS3.p1.2.m2.1.1.3.2.cmml" xref="S4.SS3.p1.2.m2.1.1.3.2">𝑒</ci><apply id="S4.SS3.p1.2.m2.1.1.3.3.cmml" xref="S4.SS3.p1.2.m2.1.1.3.3"><minus id="S4.SS3.p1.2.m2.1.1.3.3.1.cmml" xref="S4.SS3.p1.2.m2.1.1.3.3"></minus><cn id="S4.SS3.p1.2.m2.1.1.3.3.2.cmml" type="integer" xref="S4.SS3.p1.2.m2.1.1.3.3.2">4</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.2.m2.1c">1e^{-4}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.2.m2.1d">1 italic_e start_POSTSUPERSCRIPT - 4 end_POSTSUPERSCRIPT</annotation></semantics></math>. During fine-tuning, we extract 32 points per image as prompts. Enabling <math alttext="multimask\_output=True" class="ltx_Math" display="inline" id="S4.SS3.p1.3.m3.1"><semantics id="S4.SS3.p1.3.m3.1a"><mrow id="S4.SS3.p1.3.m3.1.1" xref="S4.SS3.p1.3.m3.1.1.cmml"><mrow id="S4.SS3.p1.3.m3.1.1.2" xref="S4.SS3.p1.3.m3.1.1.2.cmml"><mi id="S4.SS3.p1.3.m3.1.1.2.2" xref="S4.SS3.p1.3.m3.1.1.2.2.cmml">m</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.3" xref="S4.SS3.p1.3.m3.1.1.2.3.cmml">u</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1a" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.4" xref="S4.SS3.p1.3.m3.1.1.2.4.cmml">l</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1b" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.5" xref="S4.SS3.p1.3.m3.1.1.2.5.cmml">t</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1c" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.6" xref="S4.SS3.p1.3.m3.1.1.2.6.cmml">i</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1d" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.7" xref="S4.SS3.p1.3.m3.1.1.2.7.cmml">m</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1e" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.8" xref="S4.SS3.p1.3.m3.1.1.2.8.cmml">a</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1f" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.9" xref="S4.SS3.p1.3.m3.1.1.2.9.cmml">s</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1g" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.10" xref="S4.SS3.p1.3.m3.1.1.2.10.cmml">k</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1h" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.11" mathvariant="normal" xref="S4.SS3.p1.3.m3.1.1.2.11.cmml">_</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1i" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.12" xref="S4.SS3.p1.3.m3.1.1.2.12.cmml">o</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1j" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.13" xref="S4.SS3.p1.3.m3.1.1.2.13.cmml">u</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1k" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.14" xref="S4.SS3.p1.3.m3.1.1.2.14.cmml">t</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1l" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.15" xref="S4.SS3.p1.3.m3.1.1.2.15.cmml">p</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1m" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.16" xref="S4.SS3.p1.3.m3.1.1.2.16.cmml">u</mi><mo id="S4.SS3.p1.3.m3.1.1.2.1n" xref="S4.SS3.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.2.17" xref="S4.SS3.p1.3.m3.1.1.2.17.cmml">t</mi></mrow><mo id="S4.SS3.p1.3.m3.1.1.1" xref="S4.SS3.p1.3.m3.1.1.1.cmml">=</mo><mrow id="S4.SS3.p1.3.m3.1.1.3" xref="S4.SS3.p1.3.m3.1.1.3.cmml"><mi id="S4.SS3.p1.3.m3.1.1.3.2" xref="S4.SS3.p1.3.m3.1.1.3.2.cmml">T</mi><mo id="S4.SS3.p1.3.m3.1.1.3.1" xref="S4.SS3.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.3.3" xref="S4.SS3.p1.3.m3.1.1.3.3.cmml">r</mi><mo id="S4.SS3.p1.3.m3.1.1.3.1a" xref="S4.SS3.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.3.4" xref="S4.SS3.p1.3.m3.1.1.3.4.cmml">u</mi><mo id="S4.SS3.p1.3.m3.1.1.3.1b" xref="S4.SS3.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.3.m3.1.1.3.5" xref="S4.SS3.p1.3.m3.1.1.3.5.cmml">e</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.3.m3.1b"><apply id="S4.SS3.p1.3.m3.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1"><eq id="S4.SS3.p1.3.m3.1.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1.1"></eq><apply id="S4.SS3.p1.3.m3.1.1.2.cmml" xref="S4.SS3.p1.3.m3.1.1.2"><times id="S4.SS3.p1.3.m3.1.1.2.1.cmml" xref="S4.SS3.p1.3.m3.1.1.2.1"></times><ci id="S4.SS3.p1.3.m3.1.1.2.2.cmml" xref="S4.SS3.p1.3.m3.1.1.2.2">𝑚</ci><ci id="S4.SS3.p1.3.m3.1.1.2.3.cmml" xref="S4.SS3.p1.3.m3.1.1.2.3">𝑢</ci><ci id="S4.SS3.p1.3.m3.1.1.2.4.cmml" xref="S4.SS3.p1.3.m3.1.1.2.4">𝑙</ci><ci id="S4.SS3.p1.3.m3.1.1.2.5.cmml" xref="S4.SS3.p1.3.m3.1.1.2.5">𝑡</ci><ci id="S4.SS3.p1.3.m3.1.1.2.6.cmml" xref="S4.SS3.p1.3.m3.1.1.2.6">𝑖</ci><ci id="S4.SS3.p1.3.m3.1.1.2.7.cmml" xref="S4.SS3.p1.3.m3.1.1.2.7">𝑚</ci><ci id="S4.SS3.p1.3.m3.1.1.2.8.cmml" xref="S4.SS3.p1.3.m3.1.1.2.8">𝑎</ci><ci id="S4.SS3.p1.3.m3.1.1.2.9.cmml" xref="S4.SS3.p1.3.m3.1.1.2.9">𝑠</ci><ci id="S4.SS3.p1.3.m3.1.1.2.10.cmml" xref="S4.SS3.p1.3.m3.1.1.2.10">𝑘</ci><ci id="S4.SS3.p1.3.m3.1.1.2.11.cmml" xref="S4.SS3.p1.3.m3.1.1.2.11">_</ci><ci id="S4.SS3.p1.3.m3.1.1.2.12.cmml" xref="S4.SS3.p1.3.m3.1.1.2.12">𝑜</ci><ci id="S4.SS3.p1.3.m3.1.1.2.13.cmml" xref="S4.SS3.p1.3.m3.1.1.2.13">𝑢</ci><ci id="S4.SS3.p1.3.m3.1.1.2.14.cmml" xref="S4.SS3.p1.3.m3.1.1.2.14">𝑡</ci><ci id="S4.SS3.p1.3.m3.1.1.2.15.cmml" xref="S4.SS3.p1.3.m3.1.1.2.15">𝑝</ci><ci id="S4.SS3.p1.3.m3.1.1.2.16.cmml" xref="S4.SS3.p1.3.m3.1.1.2.16">𝑢</ci><ci id="S4.SS3.p1.3.m3.1.1.2.17.cmml" xref="S4.SS3.p1.3.m3.1.1.2.17">𝑡</ci></apply><apply id="S4.SS3.p1.3.m3.1.1.3.cmml" xref="S4.SS3.p1.3.m3.1.1.3"><times id="S4.SS3.p1.3.m3.1.1.3.1.cmml" xref="S4.SS3.p1.3.m3.1.1.3.1"></times><ci id="S4.SS3.p1.3.m3.1.1.3.2.cmml" xref="S4.SS3.p1.3.m3.1.1.3.2">𝑇</ci><ci id="S4.SS3.p1.3.m3.1.1.3.3.cmml" xref="S4.SS3.p1.3.m3.1.1.3.3">𝑟</ci><ci id="S4.SS3.p1.3.m3.1.1.3.4.cmml" xref="S4.SS3.p1.3.m3.1.1.3.4">𝑢</ci><ci id="S4.SS3.p1.3.m3.1.1.3.5.cmml" xref="S4.SS3.p1.3.m3.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.3.m3.1c">multimask\_output=True</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.3.m3.1d">italic_m italic_u italic_l italic_t italic_i italic_m italic_a italic_s italic_k _ italic_o italic_u italic_t italic_p italic_u italic_t = italic_T italic_r italic_u italic_e</annotation></semantics></math> for the mask decoder, we calculate the mean Dice loss <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib33" title="">33</a>]</cite> over three output masks per prompt.</p>
</div>
<figure class="ltx_table" id="S4.T6">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T6.4.1.1" style="font-size:90%;">Table 6</span>: </span><span class="ltx_text" id="S4.T6.5.2" style="font-size:90%;">Detailed hyper-parameter settings used in SAM<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib22" title="">22</a>]</cite>, SID<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>, and ShadowFormer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T6.2" style="width:433.6pt;height:195.9pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(57.4pt,-25.9pt) scale(1.36013684782858,1.36013684782858) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T6.2.2">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T6.2.2.3.1">
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T6.2.2.3.1.1">Hyper-parameter</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T6.2.2.3.1.2">Value</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T6.2.2.3.1.3">Hyper-parameter</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S4.T6.2.2.3.1.4">Value</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.4.2">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="2" id="S4.T6.2.2.4.2.1"><span class="ltx_text ltx_font_bold" id="S4.T6.2.2.4.2.1.1">SAM</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T6.2.2.4.2.2"><span class="ltx_text ltx_font_bold" id="S4.T6.2.2.4.2.2.1">ShadowFormer</span></td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.5.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.5.3.1">point_per_side</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.2.2.5.3.2">16</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.5.3.3">input_size</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T6.2.2.5.3.4">(640,480)</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.6.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.6.4.1">predict_iou_thres</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.2.2.6.4.2">0.90</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.6.4.3">train_ps</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T6.2.2.6.4.4">320</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.7.5">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.7.5.1">stability_score_thres</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.2.2.7.5.2">0.90</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.7.5.3">embed_dim</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T6.2.2.7.5.4">32</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.8.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.8.6.1">min_mask_region_area</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.2.2.8.6.2">500</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.2.8.6.3">win_size</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T6.2.2.8.6.4">10</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="2" id="S4.T6.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S4.T6.1.1.1.2.1">SID</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.1.1.1.3">token_projection</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T6.1.1.1.1"><math alttext="linear" class="ltx_Math" display="inline" id="S4.T6.1.1.1.1.m1.1"><semantics id="S4.T6.1.1.1.1.m1.1a"><mrow id="S4.T6.1.1.1.1.m1.1.1" xref="S4.T6.1.1.1.1.m1.1.1.cmml"><mi id="S4.T6.1.1.1.1.m1.1.1.2" xref="S4.T6.1.1.1.1.m1.1.1.2.cmml">l</mi><mo id="S4.T6.1.1.1.1.m1.1.1.1" xref="S4.T6.1.1.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.1.1.1.1.m1.1.1.3" xref="S4.T6.1.1.1.1.m1.1.1.3.cmml">i</mi><mo id="S4.T6.1.1.1.1.m1.1.1.1a" xref="S4.T6.1.1.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.1.1.1.1.m1.1.1.4" xref="S4.T6.1.1.1.1.m1.1.1.4.cmml">n</mi><mo id="S4.T6.1.1.1.1.m1.1.1.1b" xref="S4.T6.1.1.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.1.1.1.1.m1.1.1.5" xref="S4.T6.1.1.1.1.m1.1.1.5.cmml">e</mi><mo id="S4.T6.1.1.1.1.m1.1.1.1c" xref="S4.T6.1.1.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.1.1.1.1.m1.1.1.6" xref="S4.T6.1.1.1.1.m1.1.1.6.cmml">a</mi><mo id="S4.T6.1.1.1.1.m1.1.1.1d" xref="S4.T6.1.1.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.1.1.1.1.m1.1.1.7" xref="S4.T6.1.1.1.1.m1.1.1.7.cmml">r</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.T6.1.1.1.1.m1.1b"><apply id="S4.T6.1.1.1.1.m1.1.1.cmml" xref="S4.T6.1.1.1.1.m1.1.1"><times id="S4.T6.1.1.1.1.m1.1.1.1.cmml" xref="S4.T6.1.1.1.1.m1.1.1.1"></times><ci id="S4.T6.1.1.1.1.m1.1.1.2.cmml" xref="S4.T6.1.1.1.1.m1.1.1.2">𝑙</ci><ci id="S4.T6.1.1.1.1.m1.1.1.3.cmml" xref="S4.T6.1.1.1.1.m1.1.1.3">𝑖</ci><ci id="S4.T6.1.1.1.1.m1.1.1.4.cmml" xref="S4.T6.1.1.1.1.m1.1.1.4">𝑛</ci><ci id="S4.T6.1.1.1.1.m1.1.1.5.cmml" xref="S4.T6.1.1.1.1.m1.1.1.5">𝑒</ci><ci id="S4.T6.1.1.1.1.m1.1.1.6.cmml" xref="S4.T6.1.1.1.1.m1.1.1.6">𝑎</ci><ci id="S4.T6.1.1.1.1.m1.1.1.7.cmml" xref="S4.T6.1.1.1.1.m1.1.1.7">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T6.1.1.1.1.m1.1c">linear</annotation><annotation encoding="application/x-llamapun" id="S4.T6.1.1.1.1.m1.1d">italic_l italic_i italic_n italic_e italic_a italic_r</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T6.2.2.2.2">input_size</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T6.2.2.2.3">(512,512)</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T6.2.2.2.4">token_mlp</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S4.T6.2.2.2.1"><math alttext="leff" class="ltx_Math" display="inline" id="S4.T6.2.2.2.1.m1.1"><semantics id="S4.T6.2.2.2.1.m1.1a"><mrow id="S4.T6.2.2.2.1.m1.1.1" xref="S4.T6.2.2.2.1.m1.1.1.cmml"><mi id="S4.T6.2.2.2.1.m1.1.1.2" xref="S4.T6.2.2.2.1.m1.1.1.2.cmml">l</mi><mo id="S4.T6.2.2.2.1.m1.1.1.1" xref="S4.T6.2.2.2.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.2.2.2.1.m1.1.1.3" xref="S4.T6.2.2.2.1.m1.1.1.3.cmml">e</mi><mo id="S4.T6.2.2.2.1.m1.1.1.1a" xref="S4.T6.2.2.2.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.2.2.2.1.m1.1.1.4" xref="S4.T6.2.2.2.1.m1.1.1.4.cmml">f</mi><mo id="S4.T6.2.2.2.1.m1.1.1.1b" xref="S4.T6.2.2.2.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.T6.2.2.2.1.m1.1.1.5" xref="S4.T6.2.2.2.1.m1.1.1.5.cmml">f</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.T6.2.2.2.1.m1.1b"><apply id="S4.T6.2.2.2.1.m1.1.1.cmml" xref="S4.T6.2.2.2.1.m1.1.1"><times id="S4.T6.2.2.2.1.m1.1.1.1.cmml" xref="S4.T6.2.2.2.1.m1.1.1.1"></times><ci id="S4.T6.2.2.2.1.m1.1.1.2.cmml" xref="S4.T6.2.2.2.1.m1.1.1.2">𝑙</ci><ci id="S4.T6.2.2.2.1.m1.1.1.3.cmml" xref="S4.T6.2.2.2.1.m1.1.1.3">𝑒</ci><ci id="S4.T6.2.2.2.1.m1.1.1.4.cmml" xref="S4.T6.2.2.2.1.m1.1.1.4">𝑓</ci><ci id="S4.T6.2.2.2.1.m1.1.1.5.cmml" xref="S4.T6.2.2.2.1.m1.1.1.5">𝑓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T6.2.2.2.1.m1.1c">leff</annotation><annotation encoding="application/x-llamapun" id="S4.T6.2.2.2.1.m1.1d">italic_l italic_e italic_f italic_f</annotation></semantics></math></td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4 </span>MC-Edge Annotations for the ISTD+</h3>
<div class="ltx_para" id="S4.SS4.p1">
<p class="ltx_p" id="S4.SS4.p1.1">To provide CDD evaluation on the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> dataset, we annotate the MC-edges in each image in a semi-automatic manner. Among the 46 unique scenes in the ISTD+ test set, we observe that 42 do not exhibit partial shadow edges coinciding with object boundaries. For these scenes, we simply erode and dilate the original shadow mask and then perform subtraction to get the pixels near the shadow edge. In the remaining four scenes, we manually annotate the MC-edges (as depicted in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S4.F5" title="In 4.4 MC-Edge Annotations for the ISTD+ ‣ 4 Further Details of Implementation ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">5</span></a>).</p>
</div>
<figure class="ltx_figure" id="S4.F5">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F5.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="227" id="S4.F5.sf1.g1" src="extracted/5846543/pics_supp/cddanno1.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F5.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S4.F5.sf1.3.2" style="font-size:90%;">Automatic annotation</span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F5.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="227" id="S4.F5.sf2.g1" src="extracted/5846543/pics_supp/cddanno2.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F5.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S4.F5.sf2.3.2" style="font-size:90%;">Manual annotation</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F5.2.1.1" style="font-size:90%;">Figure 5</span>: </span><span class="ltx_text" id="S4.F5.3.2" style="font-size:90%;">Examples of shadow edge pixel annotation in the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>. (a) shows automatic annotation on 42 scenes using eroded and dilated shadow masks, (b) shows manual annotation of material-consistent pixels on 4 scenes where shadow edges coincide with object boundary.</span></figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S5a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Quantitative results on ISTD+ test set</h2>
<div class="ltx_para" id="S5a.p1">
<p class="ltx_p" id="S5a.p1.1">Recent improvements in shadow removal on ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> have reached saturation. The test set comprises multiple images from scenes similar to those in the training set, with shadows cast by objects outside the captured scene. SOTA methods effectively learn the mapping between shadow and shadow-free pairs, already yielding satisfactory results.
In <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S5.T7" title="In 5 Quantitative results on ISTD+ test set ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">7</span></a>, we compare our method with SOTA methods. Our method achieves performance comparable to the SOTA. Although our method improves shadow removal on several challenging cases in ISTD+, the overall performance does not significantly surpass the well-trained existing methods on simple shadow images. This further supports the need to extend shadow removal techniques to general shadow images in real-world scenarios.</p>
</div>
<figure class="ltx_table" id="S5.T7">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T7.4.2.1" style="font-size:90%;">Table 7</span>: </span><span class="ltx_text" id="S5.T7.2.1" style="font-size:90%;">Comparison with SOTA models. We compare the performance of pre-trained models and models using our adaptation method on the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> dataset. MAE and CDD are reported, note that CDD is reported in <math alttext="1000\times" class="ltx_math_unparsed" display="inline" id="S5.T7.2.1.m1.1"><semantics id="S5.T7.2.1.m1.1b"><mrow id="S5.T7.2.1.m1.1c"><mn id="S5.T7.2.1.m1.1.1">1000</mn><mo id="S5.T7.2.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S5.T7.2.1.m1.1d">1000\times</annotation><annotation encoding="application/x-llamapun" id="S5.T7.2.1.m1.1e">1000 ×</annotation></semantics></math> the original value.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T7.5" style="width:216.8pt;height:95.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-95.9pt,42.2pt) scale(0.53070943878035,0.53070943878035) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T7.5.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T7.5.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S5.T7.5.1.1.1.1" rowspan="3"><span class="ltx_text" id="S5.T7.5.1.1.1.1.1">Methods</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="5" id="S5.T7.5.1.1.1.2">ISTD+</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S5.T7.5.1.2.2.1">MAE</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S5.T7.5.1.2.2.2">CDD</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.3.3">
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.3.3.1">Shadow</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.3.3.2">NonShadow</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.3.3.3">All</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.3.3.4">Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.3.3.5">Var</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T7.5.1.4.4.1">Input</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.4.4.2">40.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.4.4.3">2.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.4.4.4">8.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.4.4.5">148.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.4.4.6">90.0</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T7.5.1.5.5.1">Inpaint4Shadow<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib26" title="">26</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.5.5.2">5.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.5.5.3">2.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.5.5.4">3.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.5.5.5">2.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.5.5.6">4.3</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T7.5.1.6.6.1">ShadowDiffusion<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.6.6.2"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.6.6.2.1">4.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.6.6.3">2.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.6.6.4"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.6.6.4.1">2.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.6.6.5">/</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.6.6.6">/</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T7.5.1.7.7.1">SP+M-Net<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.7.7.2">7.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.7.7.3">2.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.7.7.4">3.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.7.7.5">3.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.7.7.6">3.8</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T7.5.1.8.8.1">SP+M-Net+Ours</th>
<td class="ltx_td ltx_align_center" id="S5.T7.5.1.8.8.2">6.1</td>
<td class="ltx_td ltx_align_center" id="S5.T7.5.1.8.8.3">2.5</td>
<td class="ltx_td ltx_align_center" id="S5.T7.5.1.8.8.4">3.1</td>
<td class="ltx_td ltx_align_center" id="S5.T7.5.1.8.8.5">1.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T7.5.1.8.8.6">2.6</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T7.5.1.9.9.1">ShadowFormer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.9.9.2">5.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.9.9.3"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.9.9.3.1">2.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.9.9.4"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.9.9.4.1">2.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.5.1.9.9.5">1.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T7.5.1.9.9.6">2.6</td>
</tr>
<tr class="ltx_tr" id="S5.T7.5.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S5.T7.5.1.10.10.1">ShadowFormer+Ours</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.5.1.10.10.2">5.0</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.5.1.10.10.3"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.10.10.3.1">2.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.5.1.10.10.4"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.10.10.4.1">2.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.5.1.10.10.5"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.10.10.5.1">1.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T7.5.1.10.10.6"><span class="ltx_text ltx_font_bold" id="S5.T7.5.1.10.10.6.1">1.6</span></td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_section" id="S6a">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>More Results on The Cross-Dataset Testing</h2>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1 </span>Effect of <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.SS1.1.m1.1"><semantics id="S6.SS1.1.m1.1b"><msub id="S6.SS1.1.m1.1.1" xref="S6.SS1.1.m1.1.1.cmml"><mi id="S6.SS1.1.m1.1.1.2" xref="S6.SS1.1.m1.1.1.2.cmml">L</mi><mrow id="S6.SS1.1.m1.1.1.3" xref="S6.SS1.1.m1.1.1.3.cmml"><mi id="S6.SS1.1.m1.1.1.3.2" xref="S6.SS1.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.SS1.1.m1.1.1.3.1" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.3" xref="S6.SS1.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.SS1.1.m1.1.1.3.1b" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.4" xref="S6.SS1.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.SS1.1.m1.1.1.3.1c" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.5" xref="S6.SS1.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.SS1.1.m1.1.1.3.1d" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.6" xref="S6.SS1.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.SS1.1.m1.1.1.3.1e" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.7" xref="S6.SS1.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.SS1.1.m1.1.1.3.1f" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.8" xref="S6.SS1.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.SS1.1.m1.1.1.3.1g" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.9" xref="S6.SS1.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.SS1.1.m1.1.1.3.1h" xref="S6.SS1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.1.m1.1.1.3.10" xref="S6.SS1.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.SS1.1.m1.1c"><apply id="S6.SS1.1.m1.1.1.cmml" xref="S6.SS1.1.m1.1.1"><csymbol cd="ambiguous" id="S6.SS1.1.m1.1.1.1.cmml" xref="S6.SS1.1.m1.1.1">subscript</csymbol><ci id="S6.SS1.1.m1.1.1.2.cmml" xref="S6.SS1.1.m1.1.1.2">𝐿</ci><apply id="S6.SS1.1.m1.1.1.3.cmml" xref="S6.SS1.1.m1.1.1.3"><times id="S6.SS1.1.m1.1.1.3.1.cmml" xref="S6.SS1.1.m1.1.1.3.1"></times><ci id="S6.SS1.1.m1.1.1.3.2.cmml" xref="S6.SS1.1.m1.1.1.3.2">𝑛</ci><ci id="S6.SS1.1.m1.1.1.3.3.cmml" xref="S6.SS1.1.m1.1.1.3.3">𝑜</ci><ci id="S6.SS1.1.m1.1.1.3.4.cmml" xref="S6.SS1.1.m1.1.1.3.4">𝑛</ci><ci id="S6.SS1.1.m1.1.1.3.5.cmml" xref="S6.SS1.1.m1.1.1.3.5">𝑠</ci><ci id="S6.SS1.1.m1.1.1.3.6.cmml" xref="S6.SS1.1.m1.1.1.3.6">ℎ</ci><ci id="S6.SS1.1.m1.1.1.3.7.cmml" xref="S6.SS1.1.m1.1.1.3.7">𝑎</ci><ci id="S6.SS1.1.m1.1.1.3.8.cmml" xref="S6.SS1.1.m1.1.1.3.8">𝑑</ci><ci id="S6.SS1.1.m1.1.1.3.9.cmml" xref="S6.SS1.1.m1.1.1.3.9">𝑜</ci><ci id="S6.SS1.1.m1.1.1.3.10.cmml" xref="S6.SS1.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.1.m1.1d">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.1.m1.1e">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>
</h3>
<div class="ltx_para" id="S6.SS1.p1">
<p class="ltx_p" id="S6.SS1.p1.2"><math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.SS1.p1.1.m1.1"><semantics id="S6.SS1.p1.1.m1.1a"><msub id="S6.SS1.p1.1.m1.1.1" xref="S6.SS1.p1.1.m1.1.1.cmml"><mi id="S6.SS1.p1.1.m1.1.1.2" xref="S6.SS1.p1.1.m1.1.1.2.cmml">L</mi><mrow id="S6.SS1.p1.1.m1.1.1.3" xref="S6.SS1.p1.1.m1.1.1.3.cmml"><mi id="S6.SS1.p1.1.m1.1.1.3.2" xref="S6.SS1.p1.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.3" xref="S6.SS1.p1.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1a" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.4" xref="S6.SS1.p1.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1b" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.5" xref="S6.SS1.p1.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1c" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.6" xref="S6.SS1.p1.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1d" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.7" xref="S6.SS1.p1.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1e" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.8" xref="S6.SS1.p1.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1f" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.9" xref="S6.SS1.p1.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.SS1.p1.1.m1.1.1.3.1g" xref="S6.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.1.m1.1.1.3.10" xref="S6.SS1.p1.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.SS1.p1.1.m1.1b"><apply id="S6.SS1.p1.1.m1.1.1.cmml" xref="S6.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S6.SS1.p1.1.m1.1.1.1.cmml" xref="S6.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S6.SS1.p1.1.m1.1.1.2.cmml" xref="S6.SS1.p1.1.m1.1.1.2">𝐿</ci><apply id="S6.SS1.p1.1.m1.1.1.3.cmml" xref="S6.SS1.p1.1.m1.1.1.3"><times id="S6.SS1.p1.1.m1.1.1.3.1.cmml" xref="S6.SS1.p1.1.m1.1.1.3.1"></times><ci id="S6.SS1.p1.1.m1.1.1.3.2.cmml" xref="S6.SS1.p1.1.m1.1.1.3.2">𝑛</ci><ci id="S6.SS1.p1.1.m1.1.1.3.3.cmml" xref="S6.SS1.p1.1.m1.1.1.3.3">𝑜</ci><ci id="S6.SS1.p1.1.m1.1.1.3.4.cmml" xref="S6.SS1.p1.1.m1.1.1.3.4">𝑛</ci><ci id="S6.SS1.p1.1.m1.1.1.3.5.cmml" xref="S6.SS1.p1.1.m1.1.1.3.5">𝑠</ci><ci id="S6.SS1.p1.1.m1.1.1.3.6.cmml" xref="S6.SS1.p1.1.m1.1.1.3.6">ℎ</ci><ci id="S6.SS1.p1.1.m1.1.1.3.7.cmml" xref="S6.SS1.p1.1.m1.1.1.3.7">𝑎</ci><ci id="S6.SS1.p1.1.m1.1.1.3.8.cmml" xref="S6.SS1.p1.1.m1.1.1.3.8">𝑑</ci><ci id="S6.SS1.p1.1.m1.1.1.3.9.cmml" xref="S6.SS1.p1.1.m1.1.1.3.9">𝑜</ci><ci id="S6.SS1.p1.1.m1.1.1.3.10.cmml" xref="S6.SS1.p1.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p1.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math> is specifically designed to mitigate the error caused by prior models pre-trained on data pairs with light intensity inconsistencies. In <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6.T8" title="In 6.1 Effect of 𝐿_{𝑛⁢𝑜⁢𝑛⁢𝑠⁢ℎ⁢𝑎⁢𝑑⁢𝑜⁢𝑤} ‣ 6 More Results on The Cross-Dataset Testing ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">8</span></a>, we can see that our proposed method outperforms the pre-trained models, and incorporating <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.SS1.p1.2.m2.1"><semantics id="S6.SS1.p1.2.m2.1a"><msub id="S6.SS1.p1.2.m2.1.1" xref="S6.SS1.p1.2.m2.1.1.cmml"><mi id="S6.SS1.p1.2.m2.1.1.2" xref="S6.SS1.p1.2.m2.1.1.2.cmml">L</mi><mrow id="S6.SS1.p1.2.m2.1.1.3" xref="S6.SS1.p1.2.m2.1.1.3.cmml"><mi id="S6.SS1.p1.2.m2.1.1.3.2" xref="S6.SS1.p1.2.m2.1.1.3.2.cmml">n</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.3" xref="S6.SS1.p1.2.m2.1.1.3.3.cmml">o</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1a" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.4" xref="S6.SS1.p1.2.m2.1.1.3.4.cmml">n</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1b" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.5" xref="S6.SS1.p1.2.m2.1.1.3.5.cmml">s</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1c" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.6" xref="S6.SS1.p1.2.m2.1.1.3.6.cmml">h</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1d" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.7" xref="S6.SS1.p1.2.m2.1.1.3.7.cmml">a</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1e" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.8" xref="S6.SS1.p1.2.m2.1.1.3.8.cmml">d</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1f" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.9" xref="S6.SS1.p1.2.m2.1.1.3.9.cmml">o</mi><mo id="S6.SS1.p1.2.m2.1.1.3.1g" xref="S6.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S6.SS1.p1.2.m2.1.1.3.10" xref="S6.SS1.p1.2.m2.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.SS1.p1.2.m2.1b"><apply id="S6.SS1.p1.2.m2.1.1.cmml" xref="S6.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S6.SS1.p1.2.m2.1.1.1.cmml" xref="S6.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="S6.SS1.p1.2.m2.1.1.2.cmml" xref="S6.SS1.p1.2.m2.1.1.2">𝐿</ci><apply id="S6.SS1.p1.2.m2.1.1.3.cmml" xref="S6.SS1.p1.2.m2.1.1.3"><times id="S6.SS1.p1.2.m2.1.1.3.1.cmml" xref="S6.SS1.p1.2.m2.1.1.3.1"></times><ci id="S6.SS1.p1.2.m2.1.1.3.2.cmml" xref="S6.SS1.p1.2.m2.1.1.3.2">𝑛</ci><ci id="S6.SS1.p1.2.m2.1.1.3.3.cmml" xref="S6.SS1.p1.2.m2.1.1.3.3">𝑜</ci><ci id="S6.SS1.p1.2.m2.1.1.3.4.cmml" xref="S6.SS1.p1.2.m2.1.1.3.4">𝑛</ci><ci id="S6.SS1.p1.2.m2.1.1.3.5.cmml" xref="S6.SS1.p1.2.m2.1.1.3.5">𝑠</ci><ci id="S6.SS1.p1.2.m2.1.1.3.6.cmml" xref="S6.SS1.p1.2.m2.1.1.3.6">ℎ</ci><ci id="S6.SS1.p1.2.m2.1.1.3.7.cmml" xref="S6.SS1.p1.2.m2.1.1.3.7">𝑎</ci><ci id="S6.SS1.p1.2.m2.1.1.3.8.cmml" xref="S6.SS1.p1.2.m2.1.1.3.8">𝑑</ci><ci id="S6.SS1.p1.2.m2.1.1.3.9.cmml" xref="S6.SS1.p1.2.m2.1.1.3.9">𝑜</ci><ci id="S6.SS1.p1.2.m2.1.1.3.10.cmml" xref="S6.SS1.p1.2.m2.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p1.2.m2.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math> further improves the performance by correcting the non-shadow region.</p>
</div>
<figure class="ltx_table" id="S6.T8">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S6.T8.8.2.1" style="font-size:90%;">Table 8</span>: </span><span class="ltx_text" id="S6.T8.2.1" style="font-size:90%;">Quantitative results on cross dataset testing comparing the effect of <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.T8.2.1.m1.1"><semantics id="S6.T8.2.1.m1.1b"><msub id="S6.T8.2.1.m1.1.1" xref="S6.T8.2.1.m1.1.1.cmml"><mi id="S6.T8.2.1.m1.1.1.2" xref="S6.T8.2.1.m1.1.1.2.cmml">L</mi><mrow id="S6.T8.2.1.m1.1.1.3" xref="S6.T8.2.1.m1.1.1.3.cmml"><mi id="S6.T8.2.1.m1.1.1.3.2" xref="S6.T8.2.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.T8.2.1.m1.1.1.3.1" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.3" xref="S6.T8.2.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.T8.2.1.m1.1.1.3.1b" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.4" xref="S6.T8.2.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.T8.2.1.m1.1.1.3.1c" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.5" xref="S6.T8.2.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.T8.2.1.m1.1.1.3.1d" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.6" xref="S6.T8.2.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.T8.2.1.m1.1.1.3.1e" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.7" xref="S6.T8.2.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.T8.2.1.m1.1.1.3.1f" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.8" xref="S6.T8.2.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.T8.2.1.m1.1.1.3.1g" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.9" xref="S6.T8.2.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.T8.2.1.m1.1.1.3.1h" xref="S6.T8.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.2.1.m1.1.1.3.10" xref="S6.T8.2.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.T8.2.1.m1.1c"><apply id="S6.T8.2.1.m1.1.1.cmml" xref="S6.T8.2.1.m1.1.1"><csymbol cd="ambiguous" id="S6.T8.2.1.m1.1.1.1.cmml" xref="S6.T8.2.1.m1.1.1">subscript</csymbol><ci id="S6.T8.2.1.m1.1.1.2.cmml" xref="S6.T8.2.1.m1.1.1.2">𝐿</ci><apply id="S6.T8.2.1.m1.1.1.3.cmml" xref="S6.T8.2.1.m1.1.1.3"><times id="S6.T8.2.1.m1.1.1.3.1.cmml" xref="S6.T8.2.1.m1.1.1.3.1"></times><ci id="S6.T8.2.1.m1.1.1.3.2.cmml" xref="S6.T8.2.1.m1.1.1.3.2">𝑛</ci><ci id="S6.T8.2.1.m1.1.1.3.3.cmml" xref="S6.T8.2.1.m1.1.1.3.3">𝑜</ci><ci id="S6.T8.2.1.m1.1.1.3.4.cmml" xref="S6.T8.2.1.m1.1.1.3.4">𝑛</ci><ci id="S6.T8.2.1.m1.1.1.3.5.cmml" xref="S6.T8.2.1.m1.1.1.3.5">𝑠</ci><ci id="S6.T8.2.1.m1.1.1.3.6.cmml" xref="S6.T8.2.1.m1.1.1.3.6">ℎ</ci><ci id="S6.T8.2.1.m1.1.1.3.7.cmml" xref="S6.T8.2.1.m1.1.1.3.7">𝑎</ci><ci id="S6.T8.2.1.m1.1.1.3.8.cmml" xref="S6.T8.2.1.m1.1.1.3.8">𝑑</ci><ci id="S6.T8.2.1.m1.1.1.3.9.cmml" xref="S6.T8.2.1.m1.1.1.3.9">𝑜</ci><ci id="S6.T8.2.1.m1.1.1.3.10.cmml" xref="S6.T8.2.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.T8.2.1.m1.1d">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.T8.2.1.m1.1e">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>. ISTD pre-trained ShadowFormer and SRD pre-trained ShadowFormer are tested on the ISTD+ test set.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S6.T8.6" style="width:216.8pt;height:95.4pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-55.2pt,24.3pt) scale(0.662725195391354,0.662725195391354) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S6.T8.6.4">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T8.6.4.5.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S6.T8.6.4.5.1.1" rowspan="2"><span class="ltx_text" id="S6.T8.6.4.5.1.1.1">Trained On</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S6.T8.6.4.5.1.2" rowspan="2"><span class="ltx_text" id="S6.T8.6.4.5.1.2.1">Tested On</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="S6.T8.6.4.5.1.3" rowspan="2"><span class="ltx_text" id="S6.T8.6.4.5.1.3.1">Methods</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="3" id="S6.T8.6.4.5.1.4">MAE</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S6.T8.6.4.5.1.5">CDD</td>
</tr>
<tr class="ltx_tr" id="S6.T8.6.4.6.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.6.2.1">S</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.6.2.2">NS</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.6.2.3">A</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.6.2.4">Mean</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.6.4.6.2.5">Var</td>
</tr>
<tr class="ltx_tr" id="S6.T8.6.4.7.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T8.6.4.7.3.1" rowspan="3"><span class="ltx_text" id="S6.T8.6.4.7.3.1.1">SRD</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T8.6.4.7.3.2" rowspan="3"><span class="ltx_text" id="S6.T8.6.4.7.3.2.1">ISTD+</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S6.T8.6.4.7.3.3">prior model</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.7.3.4">13.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.7.3.5">3.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.7.3.6">5.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.7.3.7">55.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.6.4.7.3.8">43.3</td>
</tr>
<tr class="ltx_tr" id="S6.T8.3.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S6.T8.3.1.1.1">w.o. <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.T8.3.1.1.1.m1.1"><semantics id="S6.T8.3.1.1.1.m1.1a"><msub id="S6.T8.3.1.1.1.m1.1.1" xref="S6.T8.3.1.1.1.m1.1.1.cmml"><mi id="S6.T8.3.1.1.1.m1.1.1.2" xref="S6.T8.3.1.1.1.m1.1.1.2.cmml">L</mi><mrow id="S6.T8.3.1.1.1.m1.1.1.3" xref="S6.T8.3.1.1.1.m1.1.1.3.cmml"><mi id="S6.T8.3.1.1.1.m1.1.1.3.2" xref="S6.T8.3.1.1.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.3" xref="S6.T8.3.1.1.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1a" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.4" xref="S6.T8.3.1.1.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1b" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.5" xref="S6.T8.3.1.1.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1c" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.6" xref="S6.T8.3.1.1.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1d" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.7" xref="S6.T8.3.1.1.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1e" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.8" xref="S6.T8.3.1.1.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1f" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.9" xref="S6.T8.3.1.1.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.T8.3.1.1.1.m1.1.1.3.1g" xref="S6.T8.3.1.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.3.1.1.1.m1.1.1.3.10" xref="S6.T8.3.1.1.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.T8.3.1.1.1.m1.1b"><apply id="S6.T8.3.1.1.1.m1.1.1.cmml" xref="S6.T8.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S6.T8.3.1.1.1.m1.1.1.1.cmml" xref="S6.T8.3.1.1.1.m1.1.1">subscript</csymbol><ci id="S6.T8.3.1.1.1.m1.1.1.2.cmml" xref="S6.T8.3.1.1.1.m1.1.1.2">𝐿</ci><apply id="S6.T8.3.1.1.1.m1.1.1.3.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3"><times id="S6.T8.3.1.1.1.m1.1.1.3.1.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.1"></times><ci id="S6.T8.3.1.1.1.m1.1.1.3.2.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.2">𝑛</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.3.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.3">𝑜</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.4.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.4">𝑛</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.5.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.5">𝑠</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.6.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.6">ℎ</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.7.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.7">𝑎</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.8.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.8">𝑑</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.9.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.9">𝑜</ci><ci id="S6.T8.3.1.1.1.m1.1.1.3.10.cmml" xref="S6.T8.3.1.1.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.T8.3.1.1.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.T8.3.1.1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.3.1.1.2">6.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.3.1.1.3">2.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.3.1.1.4">3.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.3.1.1.5">15.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.3.1.1.6">13.6</td>
</tr>
<tr class="ltx_tr" id="S6.T8.4.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S6.T8.4.2.2.1">w. <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.T8.4.2.2.1.m1.1"><semantics id="S6.T8.4.2.2.1.m1.1a"><msub id="S6.T8.4.2.2.1.m1.1.1" xref="S6.T8.4.2.2.1.m1.1.1.cmml"><mi id="S6.T8.4.2.2.1.m1.1.1.2" xref="S6.T8.4.2.2.1.m1.1.1.2.cmml">L</mi><mrow id="S6.T8.4.2.2.1.m1.1.1.3" xref="S6.T8.4.2.2.1.m1.1.1.3.cmml"><mi id="S6.T8.4.2.2.1.m1.1.1.3.2" xref="S6.T8.4.2.2.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.3" xref="S6.T8.4.2.2.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1a" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.4" xref="S6.T8.4.2.2.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1b" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.5" xref="S6.T8.4.2.2.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1c" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.6" xref="S6.T8.4.2.2.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1d" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.7" xref="S6.T8.4.2.2.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1e" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.8" xref="S6.T8.4.2.2.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1f" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.9" xref="S6.T8.4.2.2.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.T8.4.2.2.1.m1.1.1.3.1g" xref="S6.T8.4.2.2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.4.2.2.1.m1.1.1.3.10" xref="S6.T8.4.2.2.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.T8.4.2.2.1.m1.1b"><apply id="S6.T8.4.2.2.1.m1.1.1.cmml" xref="S6.T8.4.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S6.T8.4.2.2.1.m1.1.1.1.cmml" xref="S6.T8.4.2.2.1.m1.1.1">subscript</csymbol><ci id="S6.T8.4.2.2.1.m1.1.1.2.cmml" xref="S6.T8.4.2.2.1.m1.1.1.2">𝐿</ci><apply id="S6.T8.4.2.2.1.m1.1.1.3.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3"><times id="S6.T8.4.2.2.1.m1.1.1.3.1.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.1"></times><ci id="S6.T8.4.2.2.1.m1.1.1.3.2.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.2">𝑛</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.3.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.3">𝑜</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.4.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.4">𝑛</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.5.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.5">𝑠</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.6.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.6">ℎ</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.7.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.7">𝑎</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.8.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.8">𝑑</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.9.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.9">𝑜</ci><ci id="S6.T8.4.2.2.1.m1.1.1.3.10.cmml" xref="S6.T8.4.2.2.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.T8.4.2.2.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.T8.4.2.2.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.4.2.2.2">6.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.4.2.2.3">2.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.4.2.2.4">3.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.4.2.2.5">8.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.4.2.2.6">9.4</td>
</tr>
<tr class="ltx_tr" id="S6.T8.6.4.8.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S6.T8.6.4.8.4.1" rowspan="3"><span class="ltx_text" id="S6.T8.6.4.8.4.1.1">ISTD</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S6.T8.6.4.8.4.2" rowspan="3"><span class="ltx_text" id="S6.T8.6.4.8.4.2.1">ISTD+</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S6.T8.6.4.8.4.3">prior model</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.8.4.4">10.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.8.4.5">6.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.8.4.6">7.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.6.4.8.4.7">11.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.6.4.8.4.8">17.7</td>
</tr>
<tr class="ltx_tr" id="S6.T8.5.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S6.T8.5.3.3.1">w.o. <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.T8.5.3.3.1.m1.1"><semantics id="S6.T8.5.3.3.1.m1.1a"><msub id="S6.T8.5.3.3.1.m1.1.1" xref="S6.T8.5.3.3.1.m1.1.1.cmml"><mi id="S6.T8.5.3.3.1.m1.1.1.2" xref="S6.T8.5.3.3.1.m1.1.1.2.cmml">L</mi><mrow id="S6.T8.5.3.3.1.m1.1.1.3" xref="S6.T8.5.3.3.1.m1.1.1.3.cmml"><mi id="S6.T8.5.3.3.1.m1.1.1.3.2" xref="S6.T8.5.3.3.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.3" xref="S6.T8.5.3.3.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1a" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.4" xref="S6.T8.5.3.3.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1b" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.5" xref="S6.T8.5.3.3.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1c" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.6" xref="S6.T8.5.3.3.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1d" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.7" xref="S6.T8.5.3.3.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1e" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.8" xref="S6.T8.5.3.3.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1f" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.9" xref="S6.T8.5.3.3.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.T8.5.3.3.1.m1.1.1.3.1g" xref="S6.T8.5.3.3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.5.3.3.1.m1.1.1.3.10" xref="S6.T8.5.3.3.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.T8.5.3.3.1.m1.1b"><apply id="S6.T8.5.3.3.1.m1.1.1.cmml" xref="S6.T8.5.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="S6.T8.5.3.3.1.m1.1.1.1.cmml" xref="S6.T8.5.3.3.1.m1.1.1">subscript</csymbol><ci id="S6.T8.5.3.3.1.m1.1.1.2.cmml" xref="S6.T8.5.3.3.1.m1.1.1.2">𝐿</ci><apply id="S6.T8.5.3.3.1.m1.1.1.3.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3"><times id="S6.T8.5.3.3.1.m1.1.1.3.1.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.1"></times><ci id="S6.T8.5.3.3.1.m1.1.1.3.2.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.2">𝑛</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.3.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.3">𝑜</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.4.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.4">𝑛</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.5.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.5">𝑠</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.6.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.6">ℎ</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.7.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.7">𝑎</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.8.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.8">𝑑</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.9.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.9">𝑜</ci><ci id="S6.T8.5.3.3.1.m1.1.1.3.10.cmml" xref="S6.T8.5.3.3.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.T8.5.3.3.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.T8.5.3.3.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.5.3.3.2">6.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.5.3.3.3">6.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.5.3.3.4">6.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T8.5.3.3.5">9.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S6.T8.5.3.3.6">15.2</td>
</tr>
<tr class="ltx_tr" id="S6.T8.6.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.1">w. <math alttext="L_{nonshadow}" class="ltx_Math" display="inline" id="S6.T8.6.4.4.1.m1.1"><semantics id="S6.T8.6.4.4.1.m1.1a"><msub id="S6.T8.6.4.4.1.m1.1.1" xref="S6.T8.6.4.4.1.m1.1.1.cmml"><mi id="S6.T8.6.4.4.1.m1.1.1.2" xref="S6.T8.6.4.4.1.m1.1.1.2.cmml">L</mi><mrow id="S6.T8.6.4.4.1.m1.1.1.3" xref="S6.T8.6.4.4.1.m1.1.1.3.cmml"><mi id="S6.T8.6.4.4.1.m1.1.1.3.2" xref="S6.T8.6.4.4.1.m1.1.1.3.2.cmml">n</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.3" xref="S6.T8.6.4.4.1.m1.1.1.3.3.cmml">o</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1a" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.4" xref="S6.T8.6.4.4.1.m1.1.1.3.4.cmml">n</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1b" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.5" xref="S6.T8.6.4.4.1.m1.1.1.3.5.cmml">s</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1c" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.6" xref="S6.T8.6.4.4.1.m1.1.1.3.6.cmml">h</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1d" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.7" xref="S6.T8.6.4.4.1.m1.1.1.3.7.cmml">a</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1e" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.8" xref="S6.T8.6.4.4.1.m1.1.1.3.8.cmml">d</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1f" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.9" xref="S6.T8.6.4.4.1.m1.1.1.3.9.cmml">o</mi><mo id="S6.T8.6.4.4.1.m1.1.1.3.1g" xref="S6.T8.6.4.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S6.T8.6.4.4.1.m1.1.1.3.10" xref="S6.T8.6.4.4.1.m1.1.1.3.10.cmml">w</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S6.T8.6.4.4.1.m1.1b"><apply id="S6.T8.6.4.4.1.m1.1.1.cmml" xref="S6.T8.6.4.4.1.m1.1.1"><csymbol cd="ambiguous" id="S6.T8.6.4.4.1.m1.1.1.1.cmml" xref="S6.T8.6.4.4.1.m1.1.1">subscript</csymbol><ci id="S6.T8.6.4.4.1.m1.1.1.2.cmml" xref="S6.T8.6.4.4.1.m1.1.1.2">𝐿</ci><apply id="S6.T8.6.4.4.1.m1.1.1.3.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3"><times id="S6.T8.6.4.4.1.m1.1.1.3.1.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.1"></times><ci id="S6.T8.6.4.4.1.m1.1.1.3.2.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.2">𝑛</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.3.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.3">𝑜</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.4.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.4">𝑛</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.5.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.5">𝑠</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.6.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.6">ℎ</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.7.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.7">𝑎</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.8.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.8">𝑑</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.9.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.9">𝑜</ci><ci id="S6.T8.6.4.4.1.m1.1.1.3.10.cmml" xref="S6.T8.6.4.4.1.m1.1.1.3.10">𝑤</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.T8.6.4.4.1.m1.1c">L_{nonshadow}</annotation><annotation encoding="application/x-llamapun" id="S6.T8.6.4.4.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n italic_o italic_n italic_s italic_h italic_a italic_d italic_o italic_w end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.2">6.3</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.3">2.7</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.4">3.4</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.5">1.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S6.T8.6.4.4.6">3.1</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2 </span>Qualitative results on SRD pre-trained model</h3>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.1">Here we show additional qualitative results of the cross-dataset testing where we use a ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> pre-trained on the SRD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib30" title="">30</a>]</cite> to test on ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> images with and without our refinement method. As depicted in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S6.F6" title="In 6.2 Qualitative results on SRD pre-trained model ‣ 6 More Results on The Cross-Dataset Testing ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">6</span></a>, the pre-trained model does not perform well on the out-of-distribution shadow images, while our refinement method significantly improves the performance.</p>
</div>
<figure class="ltx_figure" id="S6.F6">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S6.F6.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1352" id="S6.F6.sf1.g1" src="extracted/5846543/pics/srd1.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S6.F6.sf1.3.2" style="font-size:90%;">Input</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S6.F6.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1352" id="S6.F6.sf2.g1" src="extracted/5846543/pics/srd2.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S6.F6.sf2.3.2.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S6.F6.sf2.4.3.2" style="font-size:90%;">]</span></cite></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S6.F6.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1352" id="S6.F6.sf3.g1" src="extracted/5846543/pics/srd3.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S6.F6.sf3.3.2.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S6.F6.sf3.4.3.2" style="font-size:90%;">]</span></cite><span class="ltx_text" id="S6.F6.sf3.5.4" style="font-size:90%;">+Ours</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S6.F6.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1352" id="S6.F6.sf4.g1" src="extracted/5846543/pics/srd4.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.sf4.2.1.1" style="font-size:90%;">(d)</span> </span><span class="ltx_text" id="S6.F6.sf4.3.2" style="font-size:90%;">GT</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.2.1.1" style="font-size:90%;">Figure 6</span>: </span><span class="ltx_text" id="S6.F6.3.2" style="font-size:90%;">Qualitative comparison on cross dataset testing. We use the SRD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib30" title="">30</a>]</cite> pre-trained ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> and test it on the ISTD+ test set. (a) shows input image, (b) shows ShadowFormer result, (c) presents the results with refinement, and (d) presents the ground truth. We also report shadow region (S) and overall (A) MAE results.</span></figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>More Qualitative Results</h2>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">Qualitative results on refining a pre-trained diffusion-based model are provided in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7.F7" title="In 7 More Qualitative Results ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">7</span></a>.
We present the qualitative results on soft shadows and self-cast shadows in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7.F8" title="In 7 More Qualitative Results ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">8</span></a>.
We also show more qualitative results on both our proposed dataset and the ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> in <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7.F9" title="In 7 More Qualitative Results ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">9</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7.F10" title="In 7 More Qualitative Results ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">10</span></a>, and <a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#S7.F11" title="In 7 More Qualitative Results ‣ Shadow Removal Refinement via Material-Consistent Shadow Edges"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">11</span></a>.</p>
</div>
<figure class="ltx_figure" id="S7.F7">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="200" id="S7.F7.g1" src="extracted/5846543/pics_supp/diffusion1.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="200" id="S7.F7.g2" src="extracted/5846543/pics_supp/diffusion2.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S7.F7.2"><span class="ltx_text ltx_inline-block" id="S7.F7.2.1" style="font-size:90%;width:138.8pt;">Input</span>
<span class="ltx_text ltx_inline-block" id="S7.F7.2.2" style="width:138.8pt;"><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S7.F7.2.2.1.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a><span class="ltx_text" id="S7.F7.2.2.2.2" style="font-size:90%;">]</span></cite></span>
<span class="ltx_text ltx_inline-block" id="S7.F7.2.3" style="width:138.8pt;"><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S7.F7.2.3.1.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a><span class="ltx_text" id="S7.F7.2.3.2.2" style="font-size:90%;">]</span></cite><span class="ltx_text" id="S7.F7.2.3.3" style="font-size:90%;">+Ours</span></span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F7.3.1.1" style="font-size:90%;">Figure 7</span>: </span><span class="ltx_text" id="S7.F7.4.2" style="font-size:90%;">Qualitative results on our proposed dataset. (a) shows input image, (b) shows ShadowDiffusion <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib14" title="">14</a>]</cite> result, and (c) presents the results after refinement.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F8">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_square" height="603" id="S7.F8.g1" src="extracted/5846543/pics_supp/shadowtype.jpg" width="598"/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel ltx_align_center" id="S7.F8.2"><span class="ltx_text ltx_inline-block" id="S7.F8.2.1" style="font-size:90%;width:138.8pt;">(a) Input</span>
<span class="ltx_text ltx_inline-block" id="S7.F8.2.2" style="font-size:90%;width:138.8pt;">(b) ShadowFormer</span>
<span class="ltx_text ltx_inline-block" id="S7.F8.2.3" style="font-size:90%;width:138.8pt;">(c) ShadowFormer+Ours</span></p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F8.3.1.1" style="font-size:90%;">Figure 8</span>: </span><span class="ltx_text" id="S7.F8.4.2" style="font-size:90%;">Qualitative results on soft shadows and self-cast shadows. The top two rows show results on soft shadows which are easier cases for the prior model <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite>, and the bottom two rows show results on self-cast shadows which confuses the prior model. However, our method also cannot fully address the attached shadows.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F9">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F9.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F9.sf1.g1" src="extracted/5846543/pics_supp/supproposed1.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F9.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F9.sf1.3.2" style="font-size:90%;">Input</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F9.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F9.sf2.g1" src="extracted/5846543/pics_supp/supproposed4.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F9.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F9.sf2.3.2" style="font-size:90%;">ShadowFormer</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F9.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F9.sf3.g1" src="extracted/5846543/pics_supp/supproposed5.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F9.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S7.F9.sf3.3.2" style="font-size:90%;">ShadowFormer+Ours</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F9.2.1.1" style="font-size:90%;">Figure 9</span>: </span><span class="ltx_text" id="S7.F9.3.2" style="font-size:90%;">Qualitative results on our proposed dataset. (a) shows input image, (b) shows ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> result, and (c) presents the results after refinement.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F10">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F10.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F10.sf1.g1" src="extracted/5846543/pics_supp/supproposed1.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F10.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F10.sf1.3.2" style="font-size:90%;">Input</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F10.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F10.sf2.g1" src="extracted/5846543/pics_supp/supproposed2.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F10.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F10.sf2.3.2" style="font-size:90%;">SP+M-Net</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F10.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2249" id="S7.F10.sf3.g1" src="extracted/5846543/pics_supp/supproposed3.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F10.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S7.F10.sf3.3.2" style="font-size:90%;">SP+M-Net+Ours</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F10.2.1.1" style="font-size:90%;">Figure 10</span>: </span><span class="ltx_text" id="S7.F10.3.2" style="font-size:90%;">Qualitative results on our proposed dataset. (a) shows input image, (b) shows SP+M-Net <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite> result, and (c) presents the results after refinement.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F11">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F11.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2696" id="S7.F11.sf1.g1" src="extracted/5846543/pics_supp/supistd1.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F11.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F11.sf1.3.2" style="font-size:90%;">Input</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F11.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2696" id="S7.F11.sf2.g1" src="extracted/5846543/pics_supp/supistd2.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F11.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S7.F11.sf2.3.2.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S7.F11.sf2.4.3.2" style="font-size:90%;">]</span></cite></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F11.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2696" id="S7.F11.sf3.g1" src="extracted/5846543/pics_supp/supistd3.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F11.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text" id="S7.F11.sf3.3.2.1" style="font-size:90%;">[</span><a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a><span class="ltx_text" id="S7.F11.sf3.4.3.2" style="font-size:90%;">]</span></cite><span class="ltx_text" id="S7.F11.sf3.5.4" style="font-size:90%;">+Ours</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F11.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="2696" id="S7.F11.sf4.g1" src="extracted/5846543/pics_supp/supistd4.jpg" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F11.sf4.2.1.1" style="font-size:90%;">(d)</span> </span><span class="ltx_text" id="S7.F11.sf4.3.2" style="font-size:90%;">GT</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F11.2.1.1" style="font-size:90%;">Figure 11</span>: </span><span class="ltx_text" id="S7.F11.3.2" style="font-size:90%;">More qualitative results on ISTD+ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib23" title="">23</a>]</cite>. (a) shows input image, (b) shows ShadowFormer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2409.06848v1#bib.bib13" title="">13</a>]</cite> result, (c) presents the results using our refinement method, and (d) shows the ground truth.</span></figcaption>
</figure>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Sep 10 20:09:49 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
