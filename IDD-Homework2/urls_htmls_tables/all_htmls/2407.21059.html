<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks</title>
<!--Generated on Fri Jul 26 03:43:26 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="
Retrieval-augmented generation,  large language model,  modular system,  information retrieval
" lang="en" name="keywords"/>
<base href="/html/2407.21059v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S1" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">I </span><span class="ltx_text ltx_font_smallcaps">Introduction</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S2" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">II </span><span class="ltx_text ltx_font_smallcaps">Related Work</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S3" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">III </span><span class="ltx_text ltx_font_smallcaps">Framework and notation</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">IV </span><span class="ltx_text ltx_font_smallcaps">Module and Operator</span></span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS1" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-A</span> </span><span class="ltx_text ltx_font_italic">Indexing</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS1.SSS1" title="In IV-A Indexing ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-A</span>1 </span>Chunk Optimization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS1.SSS2" title="In IV-A Indexing ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-A</span>2 </span>Structure Organization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS2" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-B</span> </span><span class="ltx_text ltx_font_italic">Pre-retrieval</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS2.SSS1" title="In IV-B Pre-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-B</span>1 </span>Query Expansion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS2.SSS2" title="In IV-B Pre-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-B</span>2 </span>Query Transformation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS2.SSS3" title="In IV-B Pre-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-B</span>3 </span>Query Construction</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS3" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-C</span> </span><span class="ltx_text ltx_font_italic">Retrieval</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS3.SSS1" title="In IV-C Retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-C</span>1 </span><span class="ltx_text ltx_font_bold">Retriever Selection</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS3.SSS2" title="In IV-C Retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-C</span>2 </span>Retriever Fine-tuning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS4" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-D</span> </span><span class="ltx_text ltx_font_italic">Post-retrieval</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS4.SSS1" title="In IV-D Post-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-D</span>1 </span>Rerank</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS4.SSS2" title="In IV-D Post-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-D</span>2 </span>Compression</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS4.SSS3" title="In IV-D Post-retrieval ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-D</span>3 </span>Selection</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS5" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-E</span> </span><span class="ltx_text ltx_font_italic">Generation</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS5.SSS1" title="In IV-E Generation ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-E</span>1 </span>Generator Fine-tuning</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS5.SSS2" title="In IV-E Generation ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-E</span>2 </span>Verification</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS6" title="In IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-F</span> </span><span class="ltx_text ltx_font_italic">Orchestration</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS6.SSS1" title="In IV-F Orchestration ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-F</span>1 </span>Routing</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS6.SSS2" title="In IV-F Orchestration ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-F</span>2 </span>Scheduling</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S4.SS6.SSS3" title="In IV-F Orchestration ‣ IV Module and Operator ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">IV-F</span>3 </span>Fusion</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">V </span><span class="ltx_text ltx_font_smallcaps">RAG Flow and Flow Pattern</span></span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS1" title="In V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-A</span> </span><span class="ltx_text ltx_font_italic">Linear Pattern </span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS2" title="In V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-B</span> </span><span class="ltx_text ltx_font_italic">Conditional Pattern</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS3" title="In V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-C</span> </span><span class="ltx_text ltx_font_italic">Branching</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS4" title="In V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-D</span> </span><span class="ltx_text ltx_font_italic">Loop Pattern</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS5" title="In V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-E</span> </span><span class="ltx_text ltx_font_italic">Tuning Pattern</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS5.SSS1" title="In V-E Tuning Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-E</span>1 </span>Retriever FT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS5.SSS2" title="In V-E Tuning Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-E</span>2 </span>Generator FT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.SS5.SSS3" title="In V-E Tuning Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">V-E</span>3 </span>Dual FT</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">VI </span><span class="ltx_text ltx_font_smallcaps">Discussion</span></span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6.SS1" title="In VI Discussion ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">VI-A</span> </span><span class="ltx_text ltx_font_italic">Opportunities in Modular RAG</span></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6.SS2" title="In VI Discussion ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">VI-B</span> </span><span class="ltx_text ltx_font_italic">Compatibility with new methods</span></span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6.SS2.SSS1" title="In VI-B Compatibility with new methods ‣ VI Discussion ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">VI-B</span>1 </span>Recombination of the current modules</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6.SS2.SSS2" title="In VI-B Compatibility with new methods ‣ VI Discussion ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">VI-B</span>2 </span>New flow without adding new operators.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S6.SS2.SSS3" title="In VI-B Compatibility with new methods ‣ VI Discussion ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref"><span class="ltx_text">VI-B</span>3 </span>New flow derived from new operators.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S7" title="In Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">VII </span><span class="ltx_text ltx_font_smallcaps">Conclusion</span></span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yunfan Gao, Yun Xiong, Meng Wang, Haofen Wang
</span><span class="ltx_author_notes">
Yunfan Gao is with Shanghai Research Institute for Intelligent Autonomous Systems, Tongji University, Shanghai, 201210, China.
Yun Xiong is with Shanghai Key Laboratory of Data Science, School of Computer Science, Fudan University, Shanghai, 200438, China.
Meng Wang and Haofen Wang are with College of Design and Innovation, Tongji University, Shanghai, 20092, China.
(Corresponding author: Haofen Wang. E-mail: carter.whfcarter@gmail.com)
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id1.id1">Retrieval-augmented Generation (RAG) has markedly enhanced the capabilities of Large Language Models (LLMs) in tackling knowledge-intensive tasks. The increasing demands of application scenarios have driven the evolution of RAG, leading to the integration of advanced retrievers, LLMs and other complementary technologies, which in turn has amplified the intricacy of RAG systems. However, the rapid advancements are outpacing the foundational RAG paradigm, with many methods struggling to be unified under the process of “retrieve-then-generate”. In this context, this paper examines the limitations of the existing RAG paradigm and introduces the modular RAG framework. By decomposing complex RAG systems into independent modules and specialized operators, it facilitates a highly reconfigurable framework. Modular RAG transcends the traditional linear architecture, embracing a more advanced design that integrates routing, scheduling, and fusion mechanisms. Drawing on extensive research, this paper further identifies prevalent RAG patterns—linear, conditional, branching, and looping—and offers a comprehensive analysis of their respective implementation nuances. Modular RAG presents innovative opportunities for the conceptualization and deployment of RAG systems. Finally, the paper explores the potential emergence of new operators and paradigms, establishing a solid theoretical foundation and a practical roadmap for the continued evolution and practical deployment of RAG technologies.</p>
</div>
<div class="ltx_keywords">
<h6 class="ltx_title ltx_title_keywords">Index Terms: </h6>
Retrieval-augmented generation, large language model, modular system, information retrieval

</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">I </span><span class="ltx_text ltx_font_smallcaps" id="S1.1.1">Introduction</span>
</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large Language Models (LLMs) have demonstrated remarkable capabilities, yet they still face numerous challenges, such as hallucination and the lag in information updates <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib1" title="">1</a>]</cite>. Retrieval-augmented Generation (RAG), by accessing external knowledge bases, provides LLMs with important contextual information, significantly enhancing their performance on knowledge-intensive tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib2" title="">2</a>]</cite>. Currently, RAG, as an enhancement method, has been widely applied in various practical application scenarios, including knowledge question answering, recommendation systems, customer service, and personal assistants. <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib3" title="">3</a>, <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib4" title="">4</a>, <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib5" title="">5</a>, <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib6" title="">6</a>]</cite></p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">During the nascent stages of RAG , its core framework is constituted by indexing, retrieval, and generation, a paradigm referred to as Naive RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib7" title="">7</a>]</cite>. However, as the complexity of tasks and the demands of applications have escalated, the limitations of Naive RAG have become increasingly apparent. As depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S1.F1" title="Figure 1 ‣ I Introduction ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">1</span></a>, it predominantly hinges on the straightforward similarity of chunks, result in poor performance when confronted with complex queries and chunks with substantial variability. The primary challenges of Naive RAG include:
<em class="ltx_emph ltx_font_italic" id="S1.p2.1.1">1) Shallow Understanding of Queries.</em> The semantic similarity between a query and document chunk is not always highly consistent. Relying solely on similarity calculations for retrieval lacks an in-depth exploration of the relationship between the query and the document <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib8" title="">8</a>]</cite>.
<em class="ltx_emph ltx_font_italic" id="S1.p2.1.2">2) Retrieval Redundancy and Noise.</em> Feeding all retrieved chunks directly into LLMs is not always beneficial. Research indicates that an excess of redundant and noisy information may interfere with the LLM’s identification of key information, thereby increasing the risk of generating erroneous and hallucinated responses. <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib9" title="">9</a>]</cite></p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">To overcome the aforementioned limitations, Advanced RAG paradigm focuses on optimizing the retrieval phase, aiming to enhance retrieval efficiency and strengthen the utilization of retrieved chunks. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S1.F1" title="Figure 1 ‣ I Introduction ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">1</span></a> ,typical strategies involve pre-retrieval processing and post-retrieval processing. For instance, query rewriting is used to make the queries more clear and specific, thereby increasing the accuracy of retrieval <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib10" title="">10</a>]</cite>, and the reranking of retrieval results is employed to enhance the LLM’s ability to identify and utilize key information <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib11" title="">11</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Despite the improvements in the practicality of Advanced RAG, there remains a gap between its capabilities and real-world application requirements. On one hand, as RAG technology advances, user expectations rise, demands continue to evolve, and application settings become more complex. For instance, the integration of heterogeneous data and the new demands for system transparency, control, and maintainability. On the other hand, the growth in application demands has further propelled the evolution of RAG technology.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1028" id="S1.F1.g1" src="extracted/5756188/images/base_case.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Cases of Naive RAG and Advanced RAG.When faced with complex questions, both encounter limitations and struggle to provide satisfactory answers. Despite the fact that Advanced RAG improves retrieval accuracy through hierarchical indexing, pre-retrieval, and post-retrieval processes, these relevant documents have not been used correctly.</figcaption>
</figure>
<figure class="ltx_figure" id="S1.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1466" id="S1.F2.g1" src="extracted/5756188/images/case_modular.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Case of current Modular RAG.The system integrates diverse data and more functional components. The process is no longer confined to linear but is controlled by multiple control components for retrieval and generation, making the entire system more flexible and complex.</figcaption>
</figure>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S1.F2" title="Figure 2 ‣ I Introduction ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">2</span></a>, to achieve more accurate and efficient task execution, modern RAG systems are progressively integrating more sophisticated function, such as organizing more refined index base in the form of knowledge graphs, integrating structured data through query construction methods, and employing fine-tuning techniques to enable encoders to better adapt to domain-specific documents.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">In terms of process design, the current RAG system has surpassed the traditional linear retrieval-generation paradigm. Researchers use iterative retrieval <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib12" title="">12</a>]</cite> to obtain richer context, recursive retrieval <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib13" title="">13</a>]</cite> to handle complex queries, and adaptive retrieval <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib14" title="">14</a>]</cite> to provide overall autonomy and flexibility. This flexibility in the process significantly enhances the expressive power and adaptability of RAG systems, enabling them to better adapt to various application scenarios. However, this also makes the orchestration and scheduling of workflows more complex, posing greater challenges to system design. Specifically, RAG currently faces the following new challenges:</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.1"><span class="ltx_text ltx_font_bold" id="S1.p7.1.1">Complex data sources integration.</span> RAG are no longer confined to a single type of unstructured text data source but have expanded to include various data types, such as semi-structured data like tables and structured data like knowledge graphs <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib15" title="">15</a>]</cite>. Access to heterogeneous data from multiple sources can provide the system with a richer knowledge background, and more reliable knowledge verification capabilities <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib16" title="">16</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S1.p8">
<p class="ltx_p" id="S1.p8.1"><span class="ltx_text ltx_font_bold" id="S1.p8.1.1">New demands for system interpretability, controllability, and maintainability.</span> With the increasing complexity of systems, system maintenance and debugging have become more challenging. Additionally, when issues arise, it is essential to quickly pinpoint the specific components that require optimization.</p>
</div>
<div class="ltx_para" id="S1.p9">
<p class="ltx_p" id="S1.p9.1"><span class="ltx_text ltx_font_bold" id="S1.p9.1.1">Component selection and optimization.</span> More neural networks are involved in the RAG system, necessitating the selection of appropriate components to meet the needs of specific tasks and resource configurations. Moreover, additional components enhance the effectiveness of RAG but also bring new collaborative work requirements <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib17" title="">17</a>]</cite>. Ensuring that these models perform as intended and work efficiently together to enhance the overall system performance is crucial.</p>
</div>
<div class="ltx_para" id="S1.p10">
<p class="ltx_p" id="S1.p10.1"><span class="ltx_text ltx_font_bold" id="S1.p10.1.1">Workflow orchestration and scheduling.</span> Components may need to be executed in a specific order, processed in parallel under certain conditions, or even judged by the LLM based on different outputs. Reasonable planning of the workflow is essential for improving system efficiency and achieving the desired outcomes <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib18" title="">18</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S1.p11">
<p class="ltx_p" id="S1.p11.1">To address the design, management, and maintenance challenges posed by the increasing complexity of RAG systems, and to meet the ever-growing and diverse demands and expectations, this paper proposes Modular RAG architecture. In modern computing systems, modularization is becoming a trend. It can enhance the system’s scalability and maintainability and achieve efficient task execution through process control.</p>
</div>
<div class="ltx_para" id="S1.p12">
<p class="ltx_p" id="S1.p12.1">The Modular RAG system consists of multiple independent yet tightly coordinated modules, each responsible for handling specific functions or tasks. This architecture is divided into three levels: the top level focuses on the critical stages of RAG, where each stage is treated as an independent module. This level not only inherits the main processes from the Advanced RAG paradigm but also introduces an orchestration module to control the coordination of RAG processes. The middle level is composed of sub-modules within each module, further refining and optimizing the functions. The bottom level consists of basic units of operation—operators. Within the Modular RAG framework, RAG systems can be represented in the form of computational graphs, where nodes represent specific operators. The comparison of the three paradigms is shown in the Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S1.F3" title="Figure 3 ‣ I Introduction ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">3</span></a>. Modular RAG evolves based on the previous development of RAG. The relationships among these three paradigms are ones of inheritance and development. Advanced RAG is a special case of Modular RAG, while Naive RAG is a special case of Advanced RAG.</p>
</div>
<figure class="ltx_figure" id="S1.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="298" id="S1.F3.g1" src="extracted/5756188/images/RAG_paradigm_compare.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Comparison between three RAG paradigms. Modular RAG has evolved from previous paradigms and aligns with the current practical needs of RAG systems.</figcaption>
</figure>
<div class="ltx_para" id="S1.p13">
<p class="ltx_p" id="S1.p13.1">The advantages of Modular RAG are significant, as it enhances the flexibility and scalability of RAG systems. Users can flexibly combine different modules and operators according to the requirements of data sources and task scenarios. In summary, the contributions of this paper are as follows:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">This paper proposes a new paradigm called modular RAG, which employs a three-tier architectural design comprising modules, sub-modules, and operators to define the RAG system in a unified and structured manner. This design not only enhances the system’s flexibility and scalability but also, through the independent design of operators, strengthens the system’s maintainability and comprehensibility.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">Under the framework of Modular RAG, the orchestration of modules and operators forms the RAG Flow, which can flexibly express current RAG methods. This paper has further summarized six typical flow patterns and specific methods have been analyzed to reveal the universality of modular RAG in practical scenarios.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">The Modular RAG framework offers exceptional flexibility and extensibility. This paper delves into the new opportunities brought by Modular RAG and provides a thorough discussion on the adaptation and expansion of new methods in different application scenarios, offering guidance for future research directions and practical exploration.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">II </span><span class="ltx_text ltx_font_smallcaps" id="S2.1.1">Related Work</span>
</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">The development of RAG technology can be summarized in three stages. Initially, retrieval-augmented techniques were introduced to improve the performance of pre-trained language models on knowledge-intensive tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib19" title="">19</a>, <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib20" title="">20</a>]</cite>. In specific implementations, Retro <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib21" title="">21</a>]</cite> optimized pre-trained autoregressive models through retrieval augmentation, while Atlas <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib22" title="">22</a>]</cite> utilized a retrieval-augmented few-shot fine-tuning method, enabling language models to adapt to diverse tasks. IRCOT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib23" title="">23</a>]</cite> further enriched the reasoning process during the inference phase by combining chain-of-thought and multi-step retrieval processes. Entering the second stage, as the language processing capabilities of LLMs significantly improved, retrieval-augmented techniques began to serve as a means of supplementing additional knowledge and providing references, aiming to reduce the hallucination. For instance, RRR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib24" title="">24</a>]</cite> improved the rewriting phase, and LLMlingua <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib25" title="">25</a>]</cite> removed redundant tokens in retrieved document chunks. With the continuous progress of RAG technology, research has become more refined and focused, while also achieving innovative integration with other technologies such as graph neural networks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib26" title="">26</a>]</cite> and fine-tuning techniques <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib27" title="">27</a>]</cite>. The overall pipeline has also become more flexible, such as using LLMs to proactively determine the timing of retrieval and generation <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib14" title="">14</a>, <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib28" title="">28</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">The development of RAG technology has been accelerated by LLM technology and practical application needs. Researchers are examining and organizing the RAG framework and development pathways from different perspectives. Building upon the enhanced stages of RAG, Gao et al., <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib2" title="">2</a>]</cite> subdivided RAG into enhancement during pre-training, inference, and fine-tuning stages. Based on the main processes of RAG, relevant works on RAG were organized from the perspectives of retrieval, generation, and augmentation methods. Huang et al., <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib29" title="">29</a>]</cite> categorize RAG methods into four main classes: pre-retrieval, retrieval, post-retrieval, generation, and provide a detailed discussion of the methods and techniques within each class. Hu et al., <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib30" title="">30</a>]</cite> discuss Retrieval-Augmented Language Models (RALMs) form three key components, including retrievers, language models, augmentations, and how their interactions lead to different model structures and applications. They emphasize the importance of considering robustness, accuracy, and relevance when evaluating RALMs and propose several evaluation methods. Ding et al., <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib31" title="">31</a>]</cite> provide a comprehensive review from the perspectives of architecture, training strategies, and applications. They specifically discuss four training methods of RALMs: training-free methods, independent training methods, sequence training methods, and joint training methods, and compare their advantages and disadvantages. Zhao et al., <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib32" title="">32</a>]</cite>analyze the applications of RAG technology in various fields such as text generation, code generation, image generation, and video generation from the perspective of augmented intelligence with generative capabilities.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">The current collation of RAG systems primarily focuses on methods with a fixed process, mainly concerned with optimizing the retrieval and generation stages. However, it has not turned its attention to the new characteristics that RAG research is continuously evolving, namely the characteristics of process scheduling and functional componentization. There is currently a lack of comprehensive analysis of the overall RAG system, which has led to research on paradigms lagging behind the development of RAG technology.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">III </span><span class="ltx_text ltx_font_smallcaps" id="S3.1.1">Framework and notation</span>
</h2>
<figure class="ltx_table" id="S3.T1">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T1.16">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T1.16.17.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S3.T1.16.17.1.1">Notation</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T1.16.17.1.2">Description</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S3.T1.1.1.1"><math alttext="q" class="ltx_Math" display="inline" id="S3.T1.1.1.1.m1.1"><semantics id="S3.T1.1.1.1.m1.1a"><mi id="S3.T1.1.1.1.m1.1.1" xref="S3.T1.1.1.1.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S3.T1.1.1.1.m1.1b"><ci id="S3.T1.1.1.1.m1.1.1.cmml" xref="S3.T1.1.1.1.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.1.1.1.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="S3.T1.1.1.1.m1.1d">italic_q</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.1.2">The original query</td>
</tr>
<tr class="ltx_tr" id="S3.T1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.2.2.1"><math alttext="y" class="ltx_Math" display="inline" id="S3.T1.2.2.1.m1.1"><semantics id="S3.T1.2.2.1.m1.1a"><mi id="S3.T1.2.2.1.m1.1.1" xref="S3.T1.2.2.1.m1.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S3.T1.2.2.1.m1.1b"><ci id="S3.T1.2.2.1.m1.1.1.cmml" xref="S3.T1.2.2.1.m1.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.2.2.1.m1.1c">y</annotation><annotation encoding="application/x-llamapun" id="S3.T1.2.2.1.m1.1d">italic_y</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.2.2.2">The output of LLM</td>
</tr>
<tr class="ltx_tr" id="S3.T1.4.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.3.3.1"><math alttext="D" class="ltx_Math" display="inline" id="S3.T1.3.3.1.m1.1"><semantics id="S3.T1.3.3.1.m1.1a"><mi id="S3.T1.3.3.1.m1.1.1" xref="S3.T1.3.3.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.T1.3.3.1.m1.1b"><ci id="S3.T1.3.3.1.m1.1.1.cmml" xref="S3.T1.3.3.1.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.3.3.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.T1.3.3.1.m1.1d">italic_D</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.2">A document retrieval repository composed of chunks <math alttext="d_{i}" class="ltx_Math" display="inline" id="S3.T1.4.4.2.m1.1"><semantics id="S3.T1.4.4.2.m1.1a"><msub id="S3.T1.4.4.2.m1.1.1" xref="S3.T1.4.4.2.m1.1.1.cmml"><mi id="S3.T1.4.4.2.m1.1.1.2" xref="S3.T1.4.4.2.m1.1.1.2.cmml">d</mi><mi id="S3.T1.4.4.2.m1.1.1.3" xref="S3.T1.4.4.2.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.T1.4.4.2.m1.1b"><apply id="S3.T1.4.4.2.m1.1.1.cmml" xref="S3.T1.4.4.2.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.4.4.2.m1.1.1.1.cmml" xref="S3.T1.4.4.2.m1.1.1">subscript</csymbol><ci id="S3.T1.4.4.2.m1.1.1.2.cmml" xref="S3.T1.4.4.2.m1.1.1.2">𝑑</ci><ci id="S3.T1.4.4.2.m1.1.1.3.cmml" xref="S3.T1.4.4.2.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.4.4.2.m1.1c">d_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.4.4.2.m1.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.</td>
</tr>
<tr class="ltx_tr" id="S3.T1.7.7">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.5.5.1"><math alttext="R(q,D)" class="ltx_Math" display="inline" id="S3.T1.5.5.1.m1.2"><semantics id="S3.T1.5.5.1.m1.2a"><mrow id="S3.T1.5.5.1.m1.2.3" xref="S3.T1.5.5.1.m1.2.3.cmml"><mi id="S3.T1.5.5.1.m1.2.3.2" xref="S3.T1.5.5.1.m1.2.3.2.cmml">R</mi><mo id="S3.T1.5.5.1.m1.2.3.1" xref="S3.T1.5.5.1.m1.2.3.1.cmml">⁢</mo><mrow id="S3.T1.5.5.1.m1.2.3.3.2" xref="S3.T1.5.5.1.m1.2.3.3.1.cmml"><mo id="S3.T1.5.5.1.m1.2.3.3.2.1" stretchy="false" xref="S3.T1.5.5.1.m1.2.3.3.1.cmml">(</mo><mi id="S3.T1.5.5.1.m1.1.1" xref="S3.T1.5.5.1.m1.1.1.cmml">q</mi><mo id="S3.T1.5.5.1.m1.2.3.3.2.2" xref="S3.T1.5.5.1.m1.2.3.3.1.cmml">,</mo><mi id="S3.T1.5.5.1.m1.2.2" xref="S3.T1.5.5.1.m1.2.2.cmml">D</mi><mo id="S3.T1.5.5.1.m1.2.3.3.2.3" stretchy="false" xref="S3.T1.5.5.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.5.5.1.m1.2b"><apply id="S3.T1.5.5.1.m1.2.3.cmml" xref="S3.T1.5.5.1.m1.2.3"><times id="S3.T1.5.5.1.m1.2.3.1.cmml" xref="S3.T1.5.5.1.m1.2.3.1"></times><ci id="S3.T1.5.5.1.m1.2.3.2.cmml" xref="S3.T1.5.5.1.m1.2.3.2">𝑅</ci><interval closure="open" id="S3.T1.5.5.1.m1.2.3.3.1.cmml" xref="S3.T1.5.5.1.m1.2.3.3.2"><ci id="S3.T1.5.5.1.m1.1.1.cmml" xref="S3.T1.5.5.1.m1.1.1">𝑞</ci><ci id="S3.T1.5.5.1.m1.2.2.cmml" xref="S3.T1.5.5.1.m1.2.2">𝐷</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.5.5.1.m1.2c">R(q,D)</annotation><annotation encoding="application/x-llamapun" id="S3.T1.5.5.1.m1.2d">italic_R ( italic_q , italic_D )</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.7.7.3">Retriever,find similar chunks from <math alttext="D" class="ltx_Math" display="inline" id="S3.T1.6.6.2.m1.1"><semantics id="S3.T1.6.6.2.m1.1a"><mi id="S3.T1.6.6.2.m1.1.1" xref="S3.T1.6.6.2.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.T1.6.6.2.m1.1b"><ci id="S3.T1.6.6.2.m1.1.1.cmml" xref="S3.T1.6.6.2.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.6.6.2.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.T1.6.6.2.m1.1d">italic_D</annotation></semantics></math> based on <math alttext="q" class="ltx_Math" display="inline" id="S3.T1.7.7.3.m2.1"><semantics id="S3.T1.7.7.3.m2.1a"><mi id="S3.T1.7.7.3.m2.1.1" xref="S3.T1.7.7.3.m2.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S3.T1.7.7.3.m2.1b"><ci id="S3.T1.7.7.3.m2.1.1.cmml" xref="S3.T1.7.7.3.m2.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.7.7.3.m2.1c">q</annotation><annotation encoding="application/x-llamapun" id="S3.T1.7.7.3.m2.1d">italic_q</annotation></semantics></math>.</td>
</tr>
<tr class="ltx_tr" id="S3.T1.8.8">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.8.8.1"><math alttext="\mathcal{F}" class="ltx_Math" display="inline" id="S3.T1.8.8.1.m1.1"><semantics id="S3.T1.8.8.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.T1.8.8.1.m1.1.1" xref="S3.T1.8.8.1.m1.1.1.cmml">ℱ</mi><annotation-xml encoding="MathML-Content" id="S3.T1.8.8.1.m1.1b"><ci id="S3.T1.8.8.1.m1.1.1.cmml" xref="S3.T1.8.8.1.m1.1.1">ℱ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.8.8.1.m1.1c">\mathcal{F}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.8.8.1.m1.1d">caligraphic_F</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.8.8.2">RAG Flow</td>
</tr>
<tr class="ltx_tr" id="S3.T1.9.9">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.9.9.1"><math alttext="\mathcal{P}" class="ltx_Math" display="inline" id="S3.T1.9.9.1.m1.1"><semantics id="S3.T1.9.9.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.T1.9.9.1.m1.1.1" xref="S3.T1.9.9.1.m1.1.1.cmml">𝒫</mi><annotation-xml encoding="MathML-Content" id="S3.T1.9.9.1.m1.1b"><ci id="S3.T1.9.9.1.m1.1.1.cmml" xref="S3.T1.9.9.1.m1.1.1">𝒫</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.9.9.1.m1.1c">\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.9.9.1.m1.1d">caligraphic_P</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.2">RAG Flow pattern</td>
</tr>
<tr class="ltx_tr" id="S3.T1.10.10">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.10.10.1"><math alttext="f_{qe}" class="ltx_Math" display="inline" id="S3.T1.10.10.1.m1.1"><semantics id="S3.T1.10.10.1.m1.1a"><msub id="S3.T1.10.10.1.m1.1.1" xref="S3.T1.10.10.1.m1.1.1.cmml"><mi id="S3.T1.10.10.1.m1.1.1.2" xref="S3.T1.10.10.1.m1.1.1.2.cmml">f</mi><mrow id="S3.T1.10.10.1.m1.1.1.3" xref="S3.T1.10.10.1.m1.1.1.3.cmml"><mi id="S3.T1.10.10.1.m1.1.1.3.2" xref="S3.T1.10.10.1.m1.1.1.3.2.cmml">q</mi><mo id="S3.T1.10.10.1.m1.1.1.3.1" xref="S3.T1.10.10.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.10.10.1.m1.1.1.3.3" xref="S3.T1.10.10.1.m1.1.1.3.3.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.T1.10.10.1.m1.1b"><apply id="S3.T1.10.10.1.m1.1.1.cmml" xref="S3.T1.10.10.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.10.10.1.m1.1.1.1.cmml" xref="S3.T1.10.10.1.m1.1.1">subscript</csymbol><ci id="S3.T1.10.10.1.m1.1.1.2.cmml" xref="S3.T1.10.10.1.m1.1.1.2">𝑓</ci><apply id="S3.T1.10.10.1.m1.1.1.3.cmml" xref="S3.T1.10.10.1.m1.1.1.3"><times id="S3.T1.10.10.1.m1.1.1.3.1.cmml" xref="S3.T1.10.10.1.m1.1.1.3.1"></times><ci id="S3.T1.10.10.1.m1.1.1.3.2.cmml" xref="S3.T1.10.10.1.m1.1.1.3.2">𝑞</ci><ci id="S3.T1.10.10.1.m1.1.1.3.3.cmml" xref="S3.T1.10.10.1.m1.1.1.3.3">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.10.10.1.m1.1c">f_{qe}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.10.10.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_q italic_e end_POSTSUBSCRIPT</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.2">Query expansion function</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.11">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.11.11.1"><math alttext="f_{qc}" class="ltx_Math" display="inline" id="S3.T1.11.11.1.m1.1"><semantics id="S3.T1.11.11.1.m1.1a"><msub id="S3.T1.11.11.1.m1.1.1" xref="S3.T1.11.11.1.m1.1.1.cmml"><mi id="S3.T1.11.11.1.m1.1.1.2" xref="S3.T1.11.11.1.m1.1.1.2.cmml">f</mi><mrow id="S3.T1.11.11.1.m1.1.1.3" xref="S3.T1.11.11.1.m1.1.1.3.cmml"><mi id="S3.T1.11.11.1.m1.1.1.3.2" xref="S3.T1.11.11.1.m1.1.1.3.2.cmml">q</mi><mo id="S3.T1.11.11.1.m1.1.1.3.1" xref="S3.T1.11.11.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.11.11.1.m1.1.1.3.3" xref="S3.T1.11.11.1.m1.1.1.3.3.cmml">c</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.T1.11.11.1.m1.1b"><apply id="S3.T1.11.11.1.m1.1.1.cmml" xref="S3.T1.11.11.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.11.11.1.m1.1.1.1.cmml" xref="S3.T1.11.11.1.m1.1.1">subscript</csymbol><ci id="S3.T1.11.11.1.m1.1.1.2.cmml" xref="S3.T1.11.11.1.m1.1.1.2">𝑓</ci><apply id="S3.T1.11.11.1.m1.1.1.3.cmml" xref="S3.T1.11.11.1.m1.1.1.3"><times id="S3.T1.11.11.1.m1.1.1.3.1.cmml" xref="S3.T1.11.11.1.m1.1.1.3.1"></times><ci id="S3.T1.11.11.1.m1.1.1.3.2.cmml" xref="S3.T1.11.11.1.m1.1.1.3.2">𝑞</ci><ci id="S3.T1.11.11.1.m1.1.1.3.3.cmml" xref="S3.T1.11.11.1.m1.1.1.3.3">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.11.11.1.m1.1c">f_{qc}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.11.11.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_q italic_c end_POSTSUBSCRIPT</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.11.11.2">Query transform function</td>
</tr>
<tr class="ltx_tr" id="S3.T1.12.12">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.12.12.1"><math alttext="f_{comp}" class="ltx_Math" display="inline" id="S3.T1.12.12.1.m1.1"><semantics id="S3.T1.12.12.1.m1.1a"><msub id="S3.T1.12.12.1.m1.1.1" xref="S3.T1.12.12.1.m1.1.1.cmml"><mi id="S3.T1.12.12.1.m1.1.1.2" xref="S3.T1.12.12.1.m1.1.1.2.cmml">f</mi><mrow id="S3.T1.12.12.1.m1.1.1.3" xref="S3.T1.12.12.1.m1.1.1.3.cmml"><mi id="S3.T1.12.12.1.m1.1.1.3.2" xref="S3.T1.12.12.1.m1.1.1.3.2.cmml">c</mi><mo id="S3.T1.12.12.1.m1.1.1.3.1" xref="S3.T1.12.12.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.12.12.1.m1.1.1.3.3" xref="S3.T1.12.12.1.m1.1.1.3.3.cmml">o</mi><mo id="S3.T1.12.12.1.m1.1.1.3.1a" xref="S3.T1.12.12.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.12.12.1.m1.1.1.3.4" xref="S3.T1.12.12.1.m1.1.1.3.4.cmml">m</mi><mo id="S3.T1.12.12.1.m1.1.1.3.1b" xref="S3.T1.12.12.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.12.12.1.m1.1.1.3.5" xref="S3.T1.12.12.1.m1.1.1.3.5.cmml">p</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.T1.12.12.1.m1.1b"><apply id="S3.T1.12.12.1.m1.1.1.cmml" xref="S3.T1.12.12.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.12.12.1.m1.1.1.1.cmml" xref="S3.T1.12.12.1.m1.1.1">subscript</csymbol><ci id="S3.T1.12.12.1.m1.1.1.2.cmml" xref="S3.T1.12.12.1.m1.1.1.2">𝑓</ci><apply id="S3.T1.12.12.1.m1.1.1.3.cmml" xref="S3.T1.12.12.1.m1.1.1.3"><times id="S3.T1.12.12.1.m1.1.1.3.1.cmml" xref="S3.T1.12.12.1.m1.1.1.3.1"></times><ci id="S3.T1.12.12.1.m1.1.1.3.2.cmml" xref="S3.T1.12.12.1.m1.1.1.3.2">𝑐</ci><ci id="S3.T1.12.12.1.m1.1.1.3.3.cmml" xref="S3.T1.12.12.1.m1.1.1.3.3">𝑜</ci><ci id="S3.T1.12.12.1.m1.1.1.3.4.cmml" xref="S3.T1.12.12.1.m1.1.1.3.4">𝑚</ci><ci id="S3.T1.12.12.1.m1.1.1.3.5.cmml" xref="S3.T1.12.12.1.m1.1.1.3.5">𝑝</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.12.12.1.m1.1c">f_{comp}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.12.12.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_c italic_o italic_m italic_p end_POSTSUBSCRIPT</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.12.12.2">Chunk compression function</td>
</tr>
<tr class="ltx_tr" id="S3.T1.13.13">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.13.13.1"><math alttext="f_{sel}" class="ltx_Math" display="inline" id="S3.T1.13.13.1.m1.1"><semantics id="S3.T1.13.13.1.m1.1a"><msub id="S3.T1.13.13.1.m1.1.1" xref="S3.T1.13.13.1.m1.1.1.cmml"><mi id="S3.T1.13.13.1.m1.1.1.2" xref="S3.T1.13.13.1.m1.1.1.2.cmml">f</mi><mrow id="S3.T1.13.13.1.m1.1.1.3" xref="S3.T1.13.13.1.m1.1.1.3.cmml"><mi id="S3.T1.13.13.1.m1.1.1.3.2" xref="S3.T1.13.13.1.m1.1.1.3.2.cmml">s</mi><mo id="S3.T1.13.13.1.m1.1.1.3.1" xref="S3.T1.13.13.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.13.13.1.m1.1.1.3.3" xref="S3.T1.13.13.1.m1.1.1.3.3.cmml">e</mi><mo id="S3.T1.13.13.1.m1.1.1.3.1a" xref="S3.T1.13.13.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.T1.13.13.1.m1.1.1.3.4" xref="S3.T1.13.13.1.m1.1.1.3.4.cmml">l</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.T1.13.13.1.m1.1b"><apply id="S3.T1.13.13.1.m1.1.1.cmml" xref="S3.T1.13.13.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.13.13.1.m1.1.1.1.cmml" xref="S3.T1.13.13.1.m1.1.1">subscript</csymbol><ci id="S3.T1.13.13.1.m1.1.1.2.cmml" xref="S3.T1.13.13.1.m1.1.1.2">𝑓</ci><apply id="S3.T1.13.13.1.m1.1.1.3.cmml" xref="S3.T1.13.13.1.m1.1.1.3"><times id="S3.T1.13.13.1.m1.1.1.3.1.cmml" xref="S3.T1.13.13.1.m1.1.1.3.1"></times><ci id="S3.T1.13.13.1.m1.1.1.3.2.cmml" xref="S3.T1.13.13.1.m1.1.1.3.2">𝑠</ci><ci id="S3.T1.13.13.1.m1.1.1.3.3.cmml" xref="S3.T1.13.13.1.m1.1.1.3.3">𝑒</ci><ci id="S3.T1.13.13.1.m1.1.1.3.4.cmml" xref="S3.T1.13.13.1.m1.1.1.3.4">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.13.13.1.m1.1c">f_{sel}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.13.13.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_s italic_e italic_l end_POSTSUBSCRIPT</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.13.13.2">Chunk selection function</td>
</tr>
<tr class="ltx_tr" id="S3.T1.14.14">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.14.14.1"><math alttext="f_{r}" class="ltx_Math" display="inline" id="S3.T1.14.14.1.m1.1"><semantics id="S3.T1.14.14.1.m1.1a"><msub id="S3.T1.14.14.1.m1.1.1" xref="S3.T1.14.14.1.m1.1.1.cmml"><mi id="S3.T1.14.14.1.m1.1.1.2" xref="S3.T1.14.14.1.m1.1.1.2.cmml">f</mi><mi id="S3.T1.14.14.1.m1.1.1.3" xref="S3.T1.14.14.1.m1.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S3.T1.14.14.1.m1.1b"><apply id="S3.T1.14.14.1.m1.1.1.cmml" xref="S3.T1.14.14.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.14.14.1.m1.1.1.1.cmml" xref="S3.T1.14.14.1.m1.1.1">subscript</csymbol><ci id="S3.T1.14.14.1.m1.1.1.2.cmml" xref="S3.T1.14.14.1.m1.1.1.2">𝑓</ci><ci id="S3.T1.14.14.1.m1.1.1.3.cmml" xref="S3.T1.14.14.1.m1.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.14.14.1.m1.1c">f_{r}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.14.14.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.14.14.2">Routing function</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T1.15.15.1"><math alttext="M" class="ltx_Math" display="inline" id="S3.T1.15.15.1.m1.1"><semantics id="S3.T1.15.15.1.m1.1a"><mi id="S3.T1.15.15.1.m1.1.1" xref="S3.T1.15.15.1.m1.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S3.T1.15.15.1.m1.1b"><ci id="S3.T1.15.15.1.m1.1.1.cmml" xref="S3.T1.15.15.1.m1.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.15.15.1.m1.1c">M</annotation><annotation encoding="application/x-llamapun" id="S3.T1.15.15.1.m1.1d">italic_M</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.2">Module in modular RAG</td>
</tr>
<tr class="ltx_tr" id="S3.T1.16.16">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S3.T1.16.16.1"><math alttext="op" class="ltx_Math" display="inline" id="S3.T1.16.16.1.m1.1"><semantics id="S3.T1.16.16.1.m1.1a"><mrow id="S3.T1.16.16.1.m1.1.1" xref="S3.T1.16.16.1.m1.1.1.cmml"><mi id="S3.T1.16.16.1.m1.1.1.2" xref="S3.T1.16.16.1.m1.1.1.2.cmml">o</mi><mo id="S3.T1.16.16.1.m1.1.1.1" xref="S3.T1.16.16.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.T1.16.16.1.m1.1.1.3" xref="S3.T1.16.16.1.m1.1.1.3.cmml">p</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.16.16.1.m1.1b"><apply id="S3.T1.16.16.1.m1.1.1.cmml" xref="S3.T1.16.16.1.m1.1.1"><times id="S3.T1.16.16.1.m1.1.1.1.cmml" xref="S3.T1.16.16.1.m1.1.1.1"></times><ci id="S3.T1.16.16.1.m1.1.1.2.cmml" xref="S3.T1.16.16.1.m1.1.1.2">𝑜</ci><ci id="S3.T1.16.16.1.m1.1.1.3.cmml" xref="S3.T1.16.16.1.m1.1.1.3">𝑝</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.16.16.1.m1.1c">op</annotation><annotation encoding="application/x-llamapun" id="S3.T1.16.16.1.m1.1d">italic_o italic_p</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.16.16.2">The specific operators within the Module.</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">TABLE I: </span>Important Notation </figcaption>
</figure>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.5">For query <math alttext="Q=\{q_{i}\}" class="ltx_Math" display="inline" id="S3.p1.1.m1.1"><semantics id="S3.p1.1.m1.1a"><mrow id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.3" xref="S3.p1.1.m1.1.1.3.cmml">Q</mi><mo id="S3.p1.1.m1.1.1.2" xref="S3.p1.1.m1.1.1.2.cmml">=</mo><mrow id="S3.p1.1.m1.1.1.1.1" xref="S3.p1.1.m1.1.1.1.2.cmml"><mo id="S3.p1.1.m1.1.1.1.1.2" stretchy="false" xref="S3.p1.1.m1.1.1.1.2.cmml">{</mo><msub id="S3.p1.1.m1.1.1.1.1.1" xref="S3.p1.1.m1.1.1.1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.1.1.1.2" xref="S3.p1.1.m1.1.1.1.1.1.2.cmml">q</mi><mi id="S3.p1.1.m1.1.1.1.1.1.3" xref="S3.p1.1.m1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.1.m1.1.1.1.1.3" stretchy="false" xref="S3.p1.1.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b"><apply id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1"><eq id="S3.p1.1.m1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.2"></eq><ci id="S3.p1.1.m1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.3">𝑄</ci><set id="S3.p1.1.m1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1.1"><apply id="S3.p1.1.m1.1.1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.1.m1.1.1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1.1.1.2">𝑞</ci><ci id="S3.p1.1.m1.1.1.1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.1.1.1.3">𝑖</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">Q=\{q_{i}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.1.m1.1d">italic_Q = { italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT }</annotation></semantics></math>, a typical RAG system mainly consists of three key components. <span class="ltx_text ltx_font_bold" id="S3.p1.5.1">1) Indexing</span>. Given documents <math alttext="\mathcal{D}=\{d_{1},d_{2},\ldots,d_{n}\}" class="ltx_Math" display="inline" id="S3.p1.2.m2.4"><semantics id="S3.p1.2.m2.4a"><mrow id="S3.p1.2.m2.4.4" xref="S3.p1.2.m2.4.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p1.2.m2.4.4.5" xref="S3.p1.2.m2.4.4.5.cmml">𝒟</mi><mo id="S3.p1.2.m2.4.4.4" xref="S3.p1.2.m2.4.4.4.cmml">=</mo><mrow id="S3.p1.2.m2.4.4.3.3" xref="S3.p1.2.m2.4.4.3.4.cmml"><mo id="S3.p1.2.m2.4.4.3.3.4" stretchy="false" xref="S3.p1.2.m2.4.4.3.4.cmml">{</mo><msub id="S3.p1.2.m2.2.2.1.1.1" xref="S3.p1.2.m2.2.2.1.1.1.cmml"><mi id="S3.p1.2.m2.2.2.1.1.1.2" xref="S3.p1.2.m2.2.2.1.1.1.2.cmml">d</mi><mn id="S3.p1.2.m2.2.2.1.1.1.3" xref="S3.p1.2.m2.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S3.p1.2.m2.4.4.3.3.5" xref="S3.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S3.p1.2.m2.3.3.2.2.2" xref="S3.p1.2.m2.3.3.2.2.2.cmml"><mi id="S3.p1.2.m2.3.3.2.2.2.2" xref="S3.p1.2.m2.3.3.2.2.2.2.cmml">d</mi><mn id="S3.p1.2.m2.3.3.2.2.2.3" xref="S3.p1.2.m2.3.3.2.2.2.3.cmml">2</mn></msub><mo id="S3.p1.2.m2.4.4.3.3.6" xref="S3.p1.2.m2.4.4.3.4.cmml">,</mo><mi id="S3.p1.2.m2.1.1" mathvariant="normal" xref="S3.p1.2.m2.1.1.cmml">…</mi><mo id="S3.p1.2.m2.4.4.3.3.7" xref="S3.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S3.p1.2.m2.4.4.3.3.3" xref="S3.p1.2.m2.4.4.3.3.3.cmml"><mi id="S3.p1.2.m2.4.4.3.3.3.2" xref="S3.p1.2.m2.4.4.3.3.3.2.cmml">d</mi><mi id="S3.p1.2.m2.4.4.3.3.3.3" xref="S3.p1.2.m2.4.4.3.3.3.3.cmml">n</mi></msub><mo id="S3.p1.2.m2.4.4.3.3.8" stretchy="false" xref="S3.p1.2.m2.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.2.m2.4b"><apply id="S3.p1.2.m2.4.4.cmml" xref="S3.p1.2.m2.4.4"><eq id="S3.p1.2.m2.4.4.4.cmml" xref="S3.p1.2.m2.4.4.4"></eq><ci id="S3.p1.2.m2.4.4.5.cmml" xref="S3.p1.2.m2.4.4.5">𝒟</ci><set id="S3.p1.2.m2.4.4.3.4.cmml" xref="S3.p1.2.m2.4.4.3.3"><apply id="S3.p1.2.m2.2.2.1.1.1.cmml" xref="S3.p1.2.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.p1.2.m2.2.2.1.1.1.1.cmml" xref="S3.p1.2.m2.2.2.1.1.1">subscript</csymbol><ci id="S3.p1.2.m2.2.2.1.1.1.2.cmml" xref="S3.p1.2.m2.2.2.1.1.1.2">𝑑</ci><cn id="S3.p1.2.m2.2.2.1.1.1.3.cmml" type="integer" xref="S3.p1.2.m2.2.2.1.1.1.3">1</cn></apply><apply id="S3.p1.2.m2.3.3.2.2.2.cmml" xref="S3.p1.2.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.p1.2.m2.3.3.2.2.2.1.cmml" xref="S3.p1.2.m2.3.3.2.2.2">subscript</csymbol><ci id="S3.p1.2.m2.3.3.2.2.2.2.cmml" xref="S3.p1.2.m2.3.3.2.2.2.2">𝑑</ci><cn id="S3.p1.2.m2.3.3.2.2.2.3.cmml" type="integer" xref="S3.p1.2.m2.3.3.2.2.2.3">2</cn></apply><ci id="S3.p1.2.m2.1.1.cmml" xref="S3.p1.2.m2.1.1">…</ci><apply id="S3.p1.2.m2.4.4.3.3.3.cmml" xref="S3.p1.2.m2.4.4.3.3.3"><csymbol cd="ambiguous" id="S3.p1.2.m2.4.4.3.3.3.1.cmml" xref="S3.p1.2.m2.4.4.3.3.3">subscript</csymbol><ci id="S3.p1.2.m2.4.4.3.3.3.2.cmml" xref="S3.p1.2.m2.4.4.3.3.3.2">𝑑</ci><ci id="S3.p1.2.m2.4.4.3.3.3.3.cmml" xref="S3.p1.2.m2.4.4.3.3.3.3">𝑛</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.2.m2.4c">\mathcal{D}=\{d_{1},d_{2},\ldots,d_{n}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.2.m2.4d">caligraphic_D = { italic_d start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_d start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_d start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math> , where <math alttext="d_{i}" class="ltx_Math" display="inline" id="S3.p1.3.m3.1"><semantics id="S3.p1.3.m3.1a"><msub id="S3.p1.3.m3.1.1" xref="S3.p1.3.m3.1.1.cmml"><mi id="S3.p1.3.m3.1.1.2" xref="S3.p1.3.m3.1.1.2.cmml">d</mi><mi id="S3.p1.3.m3.1.1.3" xref="S3.p1.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.3.m3.1b"><apply id="S3.p1.3.m3.1.1.cmml" xref="S3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.1.1.1.cmml" xref="S3.p1.3.m3.1.1">subscript</csymbol><ci id="S3.p1.3.m3.1.1.2.cmml" xref="S3.p1.3.m3.1.1.2">𝑑</ci><ci id="S3.p1.3.m3.1.1.3.cmml" xref="S3.p1.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.3.m3.1c">d_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> represents the document chunk. Indexing is the process of converting <math alttext="d_{i}" class="ltx_Math" display="inline" id="S3.p1.4.m4.1"><semantics id="S3.p1.4.m4.1a"><msub id="S3.p1.4.m4.1.1" xref="S3.p1.4.m4.1.1.cmml"><mi id="S3.p1.4.m4.1.1.2" xref="S3.p1.4.m4.1.1.2.cmml">d</mi><mi id="S3.p1.4.m4.1.1.3" xref="S3.p1.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.4.m4.1b"><apply id="S3.p1.4.m4.1.1.cmml" xref="S3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.p1.4.m4.1.1.1.cmml" xref="S3.p1.4.m4.1.1">subscript</csymbol><ci id="S3.p1.4.m4.1.1.2.cmml" xref="S3.p1.4.m4.1.1.2">𝑑</ci><ci id="S3.p1.4.m4.1.1.3.cmml" xref="S3.p1.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.4.m4.1c">d_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.4.m4.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> into vectors through an embedding model <math alttext="f_{e}(\cdot)" class="ltx_Math" display="inline" id="S3.p1.5.m5.1"><semantics id="S3.p1.5.m5.1a"><mrow id="S3.p1.5.m5.1.2" xref="S3.p1.5.m5.1.2.cmml"><msub id="S3.p1.5.m5.1.2.2" xref="S3.p1.5.m5.1.2.2.cmml"><mi id="S3.p1.5.m5.1.2.2.2" xref="S3.p1.5.m5.1.2.2.2.cmml">f</mi><mi id="S3.p1.5.m5.1.2.2.3" xref="S3.p1.5.m5.1.2.2.3.cmml">e</mi></msub><mo id="S3.p1.5.m5.1.2.1" xref="S3.p1.5.m5.1.2.1.cmml">⁢</mo><mrow id="S3.p1.5.m5.1.2.3.2" xref="S3.p1.5.m5.1.2.cmml"><mo id="S3.p1.5.m5.1.2.3.2.1" stretchy="false" xref="S3.p1.5.m5.1.2.cmml">(</mo><mo id="S3.p1.5.m5.1.1" lspace="0em" rspace="0em" xref="S3.p1.5.m5.1.1.cmml">⋅</mo><mo id="S3.p1.5.m5.1.2.3.2.2" stretchy="false" xref="S3.p1.5.m5.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.5.m5.1b"><apply id="S3.p1.5.m5.1.2.cmml" xref="S3.p1.5.m5.1.2"><times id="S3.p1.5.m5.1.2.1.cmml" xref="S3.p1.5.m5.1.2.1"></times><apply id="S3.p1.5.m5.1.2.2.cmml" xref="S3.p1.5.m5.1.2.2"><csymbol cd="ambiguous" id="S3.p1.5.m5.1.2.2.1.cmml" xref="S3.p1.5.m5.1.2.2">subscript</csymbol><ci id="S3.p1.5.m5.1.2.2.2.cmml" xref="S3.p1.5.m5.1.2.2.2">𝑓</ci><ci id="S3.p1.5.m5.1.2.2.3.cmml" xref="S3.p1.5.m5.1.2.2.3">𝑒</ci></apply><ci id="S3.p1.5.m5.1.1.cmml" xref="S3.p1.5.m5.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.5.m5.1c">f_{e}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.p1.5.m5.1d">italic_f start_POSTSUBSCRIPT italic_e end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> , and then store vectors in vector database.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{I}=\{e_{1},e_{2},\ldots,e_{n}\}\quad and\quad e_{i}=f_{e}(d_{i})\in%
\mathbb{R}^{d}" class="ltx_Math" display="block" id="S3.E1.m1.3"><semantics id="S3.E1.m1.3a"><mrow id="S3.E1.m1.3.3.2" xref="S3.E1.m1.3.3.3.cmml"><mrow id="S3.E1.m1.2.2.1.1" xref="S3.E1.m1.2.2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.2.2.1.1.4" xref="S3.E1.m1.2.2.1.1.4.cmml">ℐ</mi><mo id="S3.E1.m1.2.2.1.1.3" xref="S3.E1.m1.2.2.1.1.3.cmml">=</mo><mrow id="S3.E1.m1.2.2.1.1.2.2" xref="S3.E1.m1.2.2.1.1.2.3.cmml"><mrow id="S3.E1.m1.2.2.1.1.1.1.1.3" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml"><mo id="S3.E1.m1.2.2.1.1.1.1.1.3.4" stretchy="false" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml">{</mo><msub id="S3.E1.m1.2.2.1.1.1.1.1.1.1" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1.2.cmml">e</mi><mn id="S3.E1.m1.2.2.1.1.1.1.1.1.1.3" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.E1.m1.2.2.1.1.1.1.1.3.5" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml">,</mo><msub id="S3.E1.m1.2.2.1.1.1.1.1.2.2" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2.cmml"><mi id="S3.E1.m1.2.2.1.1.1.1.1.2.2.2" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2.2.cmml">e</mi><mn id="S3.E1.m1.2.2.1.1.1.1.1.2.2.3" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2.3.cmml">2</mn></msub><mo id="S3.E1.m1.2.2.1.1.1.1.1.3.6" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml">,</mo><mi id="S3.E1.m1.1.1" mathvariant="normal" xref="S3.E1.m1.1.1.cmml">…</mi><mo id="S3.E1.m1.2.2.1.1.1.1.1.3.7" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml">,</mo><msub id="S3.E1.m1.2.2.1.1.1.1.1.3.3" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.cmml"><mi id="S3.E1.m1.2.2.1.1.1.1.1.3.3.2" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.2.cmml">e</mi><mi id="S3.E1.m1.2.2.1.1.1.1.1.3.3.3" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.3.cmml">n</mi></msub><mo id="S3.E1.m1.2.2.1.1.1.1.1.3.8" stretchy="false" xref="S3.E1.m1.2.2.1.1.1.1.1.4.cmml">}</mo></mrow><mspace id="S3.E1.m1.2.2.1.1.2.2.3" width="1em" xref="S3.E1.m1.2.2.1.1.2.3.cmml"></mspace><mrow id="S3.E1.m1.2.2.1.1.2.2.2" xref="S3.E1.m1.2.2.1.1.2.2.2.cmml"><mi id="S3.E1.m1.2.2.1.1.2.2.2.2" xref="S3.E1.m1.2.2.1.1.2.2.2.2.cmml">a</mi><mo id="S3.E1.m1.2.2.1.1.2.2.2.1" xref="S3.E1.m1.2.2.1.1.2.2.2.1.cmml">⁢</mo><mi id="S3.E1.m1.2.2.1.1.2.2.2.3" xref="S3.E1.m1.2.2.1.1.2.2.2.3.cmml">n</mi><mo id="S3.E1.m1.2.2.1.1.2.2.2.1a" xref="S3.E1.m1.2.2.1.1.2.2.2.1.cmml">⁢</mo><mi id="S3.E1.m1.2.2.1.1.2.2.2.4" xref="S3.E1.m1.2.2.1.1.2.2.2.4.cmml">d</mi></mrow></mrow></mrow><mspace id="S3.E1.m1.3.3.2.3" width="1em" xref="S3.E1.m1.3.3.3a.cmml"></mspace><mrow id="S3.E1.m1.3.3.2.2" xref="S3.E1.m1.3.3.2.2.cmml"><msub id="S3.E1.m1.3.3.2.2.3" xref="S3.E1.m1.3.3.2.2.3.cmml"><mi id="S3.E1.m1.3.3.2.2.3.2" xref="S3.E1.m1.3.3.2.2.3.2.cmml">e</mi><mi id="S3.E1.m1.3.3.2.2.3.3" xref="S3.E1.m1.3.3.2.2.3.3.cmml">i</mi></msub><mo id="S3.E1.m1.3.3.2.2.4" xref="S3.E1.m1.3.3.2.2.4.cmml">=</mo><mrow id="S3.E1.m1.3.3.2.2.1" xref="S3.E1.m1.3.3.2.2.1.cmml"><msub id="S3.E1.m1.3.3.2.2.1.3" xref="S3.E1.m1.3.3.2.2.1.3.cmml"><mi id="S3.E1.m1.3.3.2.2.1.3.2" xref="S3.E1.m1.3.3.2.2.1.3.2.cmml">f</mi><mi id="S3.E1.m1.3.3.2.2.1.3.3" xref="S3.E1.m1.3.3.2.2.1.3.3.cmml">e</mi></msub><mo id="S3.E1.m1.3.3.2.2.1.2" xref="S3.E1.m1.3.3.2.2.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.3.3.2.2.1.1.1" xref="S3.E1.m1.3.3.2.2.1.1.1.1.cmml"><mo id="S3.E1.m1.3.3.2.2.1.1.1.2" stretchy="false" xref="S3.E1.m1.3.3.2.2.1.1.1.1.cmml">(</mo><msub id="S3.E1.m1.3.3.2.2.1.1.1.1" xref="S3.E1.m1.3.3.2.2.1.1.1.1.cmml"><mi id="S3.E1.m1.3.3.2.2.1.1.1.1.2" xref="S3.E1.m1.3.3.2.2.1.1.1.1.2.cmml">d</mi><mi id="S3.E1.m1.3.3.2.2.1.1.1.1.3" xref="S3.E1.m1.3.3.2.2.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E1.m1.3.3.2.2.1.1.1.3" stretchy="false" xref="S3.E1.m1.3.3.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.3.3.2.2.5" xref="S3.E1.m1.3.3.2.2.5.cmml">∈</mo><msup id="S3.E1.m1.3.3.2.2.6" xref="S3.E1.m1.3.3.2.2.6.cmml"><mi id="S3.E1.m1.3.3.2.2.6.2" xref="S3.E1.m1.3.3.2.2.6.2.cmml">ℝ</mi><mi id="S3.E1.m1.3.3.2.2.6.3" xref="S3.E1.m1.3.3.2.2.6.3.cmml">d</mi></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.3b"><apply id="S3.E1.m1.3.3.3.cmml" xref="S3.E1.m1.3.3.2"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3a.cmml" xref="S3.E1.m1.3.3.2.3">formulae-sequence</csymbol><apply id="S3.E1.m1.2.2.1.1.cmml" xref="S3.E1.m1.2.2.1.1"><eq id="S3.E1.m1.2.2.1.1.3.cmml" xref="S3.E1.m1.2.2.1.1.3"></eq><ci id="S3.E1.m1.2.2.1.1.4.cmml" xref="S3.E1.m1.2.2.1.1.4">ℐ</ci><list id="S3.E1.m1.2.2.1.1.2.3.cmml" xref="S3.E1.m1.2.2.1.1.2.2"><set id="S3.E1.m1.2.2.1.1.1.1.1.4.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3"><apply id="S3.E1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1.2">𝑒</ci><cn id="S3.E1.m1.2.2.1.1.1.1.1.1.1.3.cmml" type="integer" xref="S3.E1.m1.2.2.1.1.1.1.1.1.1.3">1</cn></apply><apply id="S3.E1.m1.2.2.1.1.1.1.1.2.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.1.1.1.2.2.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.1.1.1.2.2.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2.2">𝑒</ci><cn id="S3.E1.m1.2.2.1.1.1.1.1.2.2.3.cmml" type="integer" xref="S3.E1.m1.2.2.1.1.1.1.1.2.2.3">2</cn></apply><ci id="S3.E1.m1.1.1.cmml" xref="S3.E1.m1.1.1">…</ci><apply id="S3.E1.m1.2.2.1.1.1.1.1.3.3.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.1.1.1.3.3.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.1.1.1.3.3.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.2">𝑒</ci><ci id="S3.E1.m1.2.2.1.1.1.1.1.3.3.3.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.3">𝑛</ci></apply></set><apply id="S3.E1.m1.2.2.1.1.2.2.2.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2"><times id="S3.E1.m1.2.2.1.1.2.2.2.1.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.1"></times><ci id="S3.E1.m1.2.2.1.1.2.2.2.2.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.2">𝑎</ci><ci id="S3.E1.m1.2.2.1.1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.3">𝑛</ci><ci id="S3.E1.m1.2.2.1.1.2.2.2.4.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.4">𝑑</ci></apply></list></apply><apply id="S3.E1.m1.3.3.2.2.cmml" xref="S3.E1.m1.3.3.2.2"><and id="S3.E1.m1.3.3.2.2a.cmml" xref="S3.E1.m1.3.3.2.2"></and><apply id="S3.E1.m1.3.3.2.2b.cmml" xref="S3.E1.m1.3.3.2.2"><eq id="S3.E1.m1.3.3.2.2.4.cmml" xref="S3.E1.m1.3.3.2.2.4"></eq><apply id="S3.E1.m1.3.3.2.2.3.cmml" xref="S3.E1.m1.3.3.2.2.3"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.2.2.3.1.cmml" xref="S3.E1.m1.3.3.2.2.3">subscript</csymbol><ci id="S3.E1.m1.3.3.2.2.3.2.cmml" xref="S3.E1.m1.3.3.2.2.3.2">𝑒</ci><ci id="S3.E1.m1.3.3.2.2.3.3.cmml" xref="S3.E1.m1.3.3.2.2.3.3">𝑖</ci></apply><apply id="S3.E1.m1.3.3.2.2.1.cmml" xref="S3.E1.m1.3.3.2.2.1"><times id="S3.E1.m1.3.3.2.2.1.2.cmml" xref="S3.E1.m1.3.3.2.2.1.2"></times><apply id="S3.E1.m1.3.3.2.2.1.3.cmml" xref="S3.E1.m1.3.3.2.2.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.2.2.1.3.1.cmml" xref="S3.E1.m1.3.3.2.2.1.3">subscript</csymbol><ci id="S3.E1.m1.3.3.2.2.1.3.2.cmml" xref="S3.E1.m1.3.3.2.2.1.3.2">𝑓</ci><ci id="S3.E1.m1.3.3.2.2.1.3.3.cmml" xref="S3.E1.m1.3.3.2.2.1.3.3">𝑒</ci></apply><apply id="S3.E1.m1.3.3.2.2.1.1.1.1.cmml" xref="S3.E1.m1.3.3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.2.2.1.1.1.1.1.cmml" xref="S3.E1.m1.3.3.2.2.1.1.1">subscript</csymbol><ci id="S3.E1.m1.3.3.2.2.1.1.1.1.2.cmml" xref="S3.E1.m1.3.3.2.2.1.1.1.1.2">𝑑</ci><ci id="S3.E1.m1.3.3.2.2.1.1.1.1.3.cmml" xref="S3.E1.m1.3.3.2.2.1.1.1.1.3">𝑖</ci></apply></apply></apply><apply id="S3.E1.m1.3.3.2.2c.cmml" xref="S3.E1.m1.3.3.2.2"><in id="S3.E1.m1.3.3.2.2.5.cmml" xref="S3.E1.m1.3.3.2.2.5"></in><share href="https://arxiv.org/html/2407.21059v1#S3.E1.m1.3.3.2.2.1.cmml" id="S3.E1.m1.3.3.2.2d.cmml" xref="S3.E1.m1.3.3.2.2"></share><apply id="S3.E1.m1.3.3.2.2.6.cmml" xref="S3.E1.m1.3.3.2.2.6"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.2.2.6.1.cmml" xref="S3.E1.m1.3.3.2.2.6">superscript</csymbol><ci id="S3.E1.m1.3.3.2.2.6.2.cmml" xref="S3.E1.m1.3.3.2.2.6.2">ℝ</ci><ci id="S3.E1.m1.3.3.2.2.6.3.cmml" xref="S3.E1.m1.3.3.2.2.6.3">𝑑</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.3c">\mathcal{I}=\{e_{1},e_{2},\ldots,e_{n}\}\quad and\quad e_{i}=f_{e}(d_{i})\in%
\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.3d">caligraphic_I = { italic_e start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_e start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_e start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT } italic_a italic_n italic_d italic_e start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_e end_POSTSUBSCRIPT ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p1.6"><span class="ltx_text ltx_font_bold" id="S3.p1.6.1">2) Retrieval </span>. Transform the query into a vector using the same encoding model, and then filter out the top <math alttext="k" class="ltx_Math" display="inline" id="S3.p1.6.m1.1"><semantics id="S3.p1.6.m1.1a"><mi id="S3.p1.6.m1.1.1" xref="S3.p1.6.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.p1.6.m1.1b"><ci id="S3.p1.6.m1.1.1.cmml" xref="S3.p1.6.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.6.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.p1.6.m1.1d">italic_k</annotation></semantics></math> document chunks that are most similar based on vector similarity.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{R}:\mathop{\mathrm{topk}}_{d_{i}\in D}\operatorname{Sim}(q,d_{i})%
\rightarrow D^{q}" class="ltx_Math" display="block" id="S3.E2.m1.3"><semantics id="S3.E2.m1.3a"><mrow id="S3.E2.m1.3.3" xref="S3.E2.m1.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.3.3.3" xref="S3.E2.m1.3.3.3.cmml">ℛ</mi><mo id="S3.E2.m1.3.3.2" lspace="0.278em" xref="S3.E2.m1.3.3.2.cmml">:</mo><mrow id="S3.E2.m1.3.3.1" xref="S3.E2.m1.3.3.1.cmml"><mrow id="S3.E2.m1.3.3.1.1" xref="S3.E2.m1.3.3.1.1.cmml"><munder id="S3.E2.m1.3.3.1.1.2" xref="S3.E2.m1.3.3.1.1.2.cmml"><mo id="S3.E2.m1.3.3.1.1.2.2" lspace="0.111em" movablelimits="false" rspace="0.167em" xref="S3.E2.m1.3.3.1.1.2.2.cmml">topk</mo><mrow id="S3.E2.m1.3.3.1.1.2.3" xref="S3.E2.m1.3.3.1.1.2.3.cmml"><msub id="S3.E2.m1.3.3.1.1.2.3.2" xref="S3.E2.m1.3.3.1.1.2.3.2.cmml"><mi id="S3.E2.m1.3.3.1.1.2.3.2.2" xref="S3.E2.m1.3.3.1.1.2.3.2.2.cmml">d</mi><mi id="S3.E2.m1.3.3.1.1.2.3.2.3" xref="S3.E2.m1.3.3.1.1.2.3.2.3.cmml">i</mi></msub><mo id="S3.E2.m1.3.3.1.1.2.3.1" xref="S3.E2.m1.3.3.1.1.2.3.1.cmml">∈</mo><mi id="S3.E2.m1.3.3.1.1.2.3.3" xref="S3.E2.m1.3.3.1.1.2.3.3.cmml">D</mi></mrow></munder><mrow id="S3.E2.m1.3.3.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.2.cmml"><mi id="S3.E2.m1.1.1" xref="S3.E2.m1.1.1.cmml">Sim</mi><mo id="S3.E2.m1.3.3.1.1.1.1a" xref="S3.E2.m1.3.3.1.1.1.2.cmml">⁡</mo><mrow id="S3.E2.m1.3.3.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.2.cmml"><mo id="S3.E2.m1.3.3.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.3.3.1.1.1.2.cmml">(</mo><mi id="S3.E2.m1.2.2" xref="S3.E2.m1.2.2.cmml">q</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.2.cmml">,</mo><msub id="S3.E2.m1.3.3.1.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.2" xref="S3.E2.m1.3.3.1.1.1.1.1.1.2.cmml">d</mi><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E2.m1.3.3.1.1.1.1.1.4" stretchy="false" xref="S3.E2.m1.3.3.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E2.m1.3.3.1.2" stretchy="false" xref="S3.E2.m1.3.3.1.2.cmml">→</mo><msup id="S3.E2.m1.3.3.1.3" xref="S3.E2.m1.3.3.1.3.cmml"><mi id="S3.E2.m1.3.3.1.3.2" xref="S3.E2.m1.3.3.1.3.2.cmml">D</mi><mi id="S3.E2.m1.3.3.1.3.3" xref="S3.E2.m1.3.3.1.3.3.cmml">q</mi></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.3b"><apply id="S3.E2.m1.3.3.cmml" xref="S3.E2.m1.3.3"><ci id="S3.E2.m1.3.3.2.cmml" xref="S3.E2.m1.3.3.2">:</ci><ci id="S3.E2.m1.3.3.3.cmml" xref="S3.E2.m1.3.3.3">ℛ</ci><apply id="S3.E2.m1.3.3.1.cmml" xref="S3.E2.m1.3.3.1"><ci id="S3.E2.m1.3.3.1.2.cmml" xref="S3.E2.m1.3.3.1.2">→</ci><apply id="S3.E2.m1.3.3.1.1.cmml" xref="S3.E2.m1.3.3.1.1"><apply id="S3.E2.m1.3.3.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.2.1.cmml" xref="S3.E2.m1.3.3.1.1.2">subscript</csymbol><ci id="S3.E2.m1.3.3.1.1.2.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2">topk</ci><apply id="S3.E2.m1.3.3.1.1.2.3.cmml" xref="S3.E2.m1.3.3.1.1.2.3"><in id="S3.E2.m1.3.3.1.1.2.3.1.cmml" xref="S3.E2.m1.3.3.1.1.2.3.1"></in><apply id="S3.E2.m1.3.3.1.1.2.3.2.cmml" xref="S3.E2.m1.3.3.1.1.2.3.2"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.2.3.2.1.cmml" xref="S3.E2.m1.3.3.1.1.2.3.2">subscript</csymbol><ci id="S3.E2.m1.3.3.1.1.2.3.2.2.cmml" xref="S3.E2.m1.3.3.1.1.2.3.2.2">𝑑</ci><ci id="S3.E2.m1.3.3.1.1.2.3.2.3.cmml" xref="S3.E2.m1.3.3.1.1.2.3.2.3">𝑖</ci></apply><ci id="S3.E2.m1.3.3.1.1.2.3.3.cmml" xref="S3.E2.m1.3.3.1.1.2.3.3">𝐷</ci></apply></apply><apply id="S3.E2.m1.3.3.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1"><ci id="S3.E2.m1.1.1.cmml" xref="S3.E2.m1.1.1">Sim</ci><ci id="S3.E2.m1.2.2.cmml" xref="S3.E2.m1.2.2">𝑞</ci><apply id="S3.E2.m1.3.3.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.2">𝑑</ci><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply><apply id="S3.E2.m1.3.3.1.3.cmml" xref="S3.E2.m1.3.3.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.3.1.cmml" xref="S3.E2.m1.3.3.1.3">superscript</csymbol><ci id="S3.E2.m1.3.3.1.3.2.cmml" xref="S3.E2.m1.3.3.1.3.2">𝐷</ci><ci id="S3.E2.m1.3.3.1.3.3.cmml" xref="S3.E2.m1.3.3.1.3.3">𝑞</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.3c">\mathcal{R}:\mathop{\mathrm{topk}}_{d_{i}\in D}\operatorname{Sim}(q,d_{i})%
\rightarrow D^{q}</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.3d">caligraphic_R : roman_topk start_POSTSUBSCRIPT italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_D end_POSTSUBSCRIPT roman_Sim ( italic_q , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) → italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p1.9"><math alttext="D^{q}=\{d_{1},d_{2},\ldots,d_{k}\}" class="ltx_Math" display="inline" id="S3.p1.7.m1.4"><semantics id="S3.p1.7.m1.4a"><mrow id="S3.p1.7.m1.4.4" xref="S3.p1.7.m1.4.4.cmml"><msup id="S3.p1.7.m1.4.4.5" xref="S3.p1.7.m1.4.4.5.cmml"><mi id="S3.p1.7.m1.4.4.5.2" xref="S3.p1.7.m1.4.4.5.2.cmml">D</mi><mi id="S3.p1.7.m1.4.4.5.3" xref="S3.p1.7.m1.4.4.5.3.cmml">q</mi></msup><mo id="S3.p1.7.m1.4.4.4" xref="S3.p1.7.m1.4.4.4.cmml">=</mo><mrow id="S3.p1.7.m1.4.4.3.3" xref="S3.p1.7.m1.4.4.3.4.cmml"><mo id="S3.p1.7.m1.4.4.3.3.4" stretchy="false" xref="S3.p1.7.m1.4.4.3.4.cmml">{</mo><msub id="S3.p1.7.m1.2.2.1.1.1" xref="S3.p1.7.m1.2.2.1.1.1.cmml"><mi id="S3.p1.7.m1.2.2.1.1.1.2" xref="S3.p1.7.m1.2.2.1.1.1.2.cmml">d</mi><mn id="S3.p1.7.m1.2.2.1.1.1.3" xref="S3.p1.7.m1.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S3.p1.7.m1.4.4.3.3.5" xref="S3.p1.7.m1.4.4.3.4.cmml">,</mo><msub id="S3.p1.7.m1.3.3.2.2.2" xref="S3.p1.7.m1.3.3.2.2.2.cmml"><mi id="S3.p1.7.m1.3.3.2.2.2.2" xref="S3.p1.7.m1.3.3.2.2.2.2.cmml">d</mi><mn id="S3.p1.7.m1.3.3.2.2.2.3" xref="S3.p1.7.m1.3.3.2.2.2.3.cmml">2</mn></msub><mo id="S3.p1.7.m1.4.4.3.3.6" xref="S3.p1.7.m1.4.4.3.4.cmml">,</mo><mi id="S3.p1.7.m1.1.1" mathvariant="normal" xref="S3.p1.7.m1.1.1.cmml">…</mi><mo id="S3.p1.7.m1.4.4.3.3.7" xref="S3.p1.7.m1.4.4.3.4.cmml">,</mo><msub id="S3.p1.7.m1.4.4.3.3.3" xref="S3.p1.7.m1.4.4.3.3.3.cmml"><mi id="S3.p1.7.m1.4.4.3.3.3.2" xref="S3.p1.7.m1.4.4.3.3.3.2.cmml">d</mi><mi id="S3.p1.7.m1.4.4.3.3.3.3" xref="S3.p1.7.m1.4.4.3.3.3.3.cmml">k</mi></msub><mo id="S3.p1.7.m1.4.4.3.3.8" stretchy="false" xref="S3.p1.7.m1.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.7.m1.4b"><apply id="S3.p1.7.m1.4.4.cmml" xref="S3.p1.7.m1.4.4"><eq id="S3.p1.7.m1.4.4.4.cmml" xref="S3.p1.7.m1.4.4.4"></eq><apply id="S3.p1.7.m1.4.4.5.cmml" xref="S3.p1.7.m1.4.4.5"><csymbol cd="ambiguous" id="S3.p1.7.m1.4.4.5.1.cmml" xref="S3.p1.7.m1.4.4.5">superscript</csymbol><ci id="S3.p1.7.m1.4.4.5.2.cmml" xref="S3.p1.7.m1.4.4.5.2">𝐷</ci><ci id="S3.p1.7.m1.4.4.5.3.cmml" xref="S3.p1.7.m1.4.4.5.3">𝑞</ci></apply><set id="S3.p1.7.m1.4.4.3.4.cmml" xref="S3.p1.7.m1.4.4.3.3"><apply id="S3.p1.7.m1.2.2.1.1.1.cmml" xref="S3.p1.7.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.p1.7.m1.2.2.1.1.1.1.cmml" xref="S3.p1.7.m1.2.2.1.1.1">subscript</csymbol><ci id="S3.p1.7.m1.2.2.1.1.1.2.cmml" xref="S3.p1.7.m1.2.2.1.1.1.2">𝑑</ci><cn id="S3.p1.7.m1.2.2.1.1.1.3.cmml" type="integer" xref="S3.p1.7.m1.2.2.1.1.1.3">1</cn></apply><apply id="S3.p1.7.m1.3.3.2.2.2.cmml" xref="S3.p1.7.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.p1.7.m1.3.3.2.2.2.1.cmml" xref="S3.p1.7.m1.3.3.2.2.2">subscript</csymbol><ci id="S3.p1.7.m1.3.3.2.2.2.2.cmml" xref="S3.p1.7.m1.3.3.2.2.2.2">𝑑</ci><cn id="S3.p1.7.m1.3.3.2.2.2.3.cmml" type="integer" xref="S3.p1.7.m1.3.3.2.2.2.3">2</cn></apply><ci id="S3.p1.7.m1.1.1.cmml" xref="S3.p1.7.m1.1.1">…</ci><apply id="S3.p1.7.m1.4.4.3.3.3.cmml" xref="S3.p1.7.m1.4.4.3.3.3"><csymbol cd="ambiguous" id="S3.p1.7.m1.4.4.3.3.3.1.cmml" xref="S3.p1.7.m1.4.4.3.3.3">subscript</csymbol><ci id="S3.p1.7.m1.4.4.3.3.3.2.cmml" xref="S3.p1.7.m1.4.4.3.3.3.2">𝑑</ci><ci id="S3.p1.7.m1.4.4.3.3.3.3.cmml" xref="S3.p1.7.m1.4.4.3.3.3.3">𝑘</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.7.m1.4c">D^{q}=\{d_{1},d_{2},\ldots,d_{k}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.7.m1.4d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = { italic_d start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_d start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_d start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT }</annotation></semantics></math> represents the relevant documents for question <math alttext="q" class="ltx_Math" display="inline" id="S3.p1.8.m2.1"><semantics id="S3.p1.8.m2.1a"><mi id="S3.p1.8.m2.1.1" xref="S3.p1.8.m2.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S3.p1.8.m2.1b"><ci id="S3.p1.8.m2.1.1.cmml" xref="S3.p1.8.m2.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.8.m2.1c">q</annotation><annotation encoding="application/x-llamapun" id="S3.p1.8.m2.1d">italic_q</annotation></semantics></math>. The similarity function <math alttext="Sim(\cdot)" class="ltx_Math" display="inline" id="S3.p1.9.m3.1"><semantics id="S3.p1.9.m3.1a"><mrow id="S3.p1.9.m3.1.2" xref="S3.p1.9.m3.1.2.cmml"><mi id="S3.p1.9.m3.1.2.2" xref="S3.p1.9.m3.1.2.2.cmml">S</mi><mo id="S3.p1.9.m3.1.2.1" xref="S3.p1.9.m3.1.2.1.cmml">⁢</mo><mi id="S3.p1.9.m3.1.2.3" xref="S3.p1.9.m3.1.2.3.cmml">i</mi><mo id="S3.p1.9.m3.1.2.1a" xref="S3.p1.9.m3.1.2.1.cmml">⁢</mo><mi id="S3.p1.9.m3.1.2.4" xref="S3.p1.9.m3.1.2.4.cmml">m</mi><mo id="S3.p1.9.m3.1.2.1b" xref="S3.p1.9.m3.1.2.1.cmml">⁢</mo><mrow id="S3.p1.9.m3.1.2.5.2" xref="S3.p1.9.m3.1.2.cmml"><mo id="S3.p1.9.m3.1.2.5.2.1" stretchy="false" xref="S3.p1.9.m3.1.2.cmml">(</mo><mo id="S3.p1.9.m3.1.1" lspace="0em" rspace="0em" xref="S3.p1.9.m3.1.1.cmml">⋅</mo><mo id="S3.p1.9.m3.1.2.5.2.2" stretchy="false" xref="S3.p1.9.m3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.9.m3.1b"><apply id="S3.p1.9.m3.1.2.cmml" xref="S3.p1.9.m3.1.2"><times id="S3.p1.9.m3.1.2.1.cmml" xref="S3.p1.9.m3.1.2.1"></times><ci id="S3.p1.9.m3.1.2.2.cmml" xref="S3.p1.9.m3.1.2.2">𝑆</ci><ci id="S3.p1.9.m3.1.2.3.cmml" xref="S3.p1.9.m3.1.2.3">𝑖</ci><ci id="S3.p1.9.m3.1.2.4.cmml" xref="S3.p1.9.m3.1.2.4">𝑚</ci><ci id="S3.p1.9.m3.1.1.cmml" xref="S3.p1.9.m3.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.9.m3.1c">Sim(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.p1.9.m3.1d">italic_S italic_i italic_m ( ⋅ )</annotation></semantics></math> commonly used are dot product or cosine similarity.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="Sim(q,d_{i})=e_{q}\cdot e_{d_{i}}\quad or\quad\frac{e_{q}\cdot e_{d_{i}}}{\|e_%
{q}\|\cdot\|e_{d_{i}}\|}" class="ltx_Math" display="block" id="S3.E3.m1.6"><semantics id="S3.E3.m1.6a"><mrow id="S3.E3.m1.6.6" xref="S3.E3.m1.6.6.cmml"><mrow id="S3.E3.m1.4.4.1" xref="S3.E3.m1.4.4.1.cmml"><mi id="S3.E3.m1.4.4.1.3" xref="S3.E3.m1.4.4.1.3.cmml">S</mi><mo id="S3.E3.m1.4.4.1.2" xref="S3.E3.m1.4.4.1.2.cmml">⁢</mo><mi id="S3.E3.m1.4.4.1.4" xref="S3.E3.m1.4.4.1.4.cmml">i</mi><mo id="S3.E3.m1.4.4.1.2a" xref="S3.E3.m1.4.4.1.2.cmml">⁢</mo><mi id="S3.E3.m1.4.4.1.5" xref="S3.E3.m1.4.4.1.5.cmml">m</mi><mo id="S3.E3.m1.4.4.1.2b" xref="S3.E3.m1.4.4.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.4.4.1.1.1" xref="S3.E3.m1.4.4.1.1.2.cmml"><mo id="S3.E3.m1.4.4.1.1.1.2" stretchy="false" xref="S3.E3.m1.4.4.1.1.2.cmml">(</mo><mi id="S3.E3.m1.3.3" xref="S3.E3.m1.3.3.cmml">q</mi><mo id="S3.E3.m1.4.4.1.1.1.3" xref="S3.E3.m1.4.4.1.1.2.cmml">,</mo><msub id="S3.E3.m1.4.4.1.1.1.1" xref="S3.E3.m1.4.4.1.1.1.1.cmml"><mi id="S3.E3.m1.4.4.1.1.1.1.2" xref="S3.E3.m1.4.4.1.1.1.1.2.cmml">d</mi><mi id="S3.E3.m1.4.4.1.1.1.1.3" xref="S3.E3.m1.4.4.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E3.m1.4.4.1.1.1.4" stretchy="false" xref="S3.E3.m1.4.4.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.6.6.4" xref="S3.E3.m1.6.6.4.cmml">=</mo><mrow id="S3.E3.m1.6.6.3.2" xref="S3.E3.m1.6.6.3.3.cmml"><mrow id="S3.E3.m1.5.5.2.1.1" xref="S3.E3.m1.5.5.2.1.1.cmml"><msub id="S3.E3.m1.5.5.2.1.1.2" xref="S3.E3.m1.5.5.2.1.1.2.cmml"><mi id="S3.E3.m1.5.5.2.1.1.2.2" xref="S3.E3.m1.5.5.2.1.1.2.2.cmml">e</mi><mi id="S3.E3.m1.5.5.2.1.1.2.3" xref="S3.E3.m1.5.5.2.1.1.2.3.cmml">q</mi></msub><mo id="S3.E3.m1.5.5.2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.E3.m1.5.5.2.1.1.1.cmml">⋅</mo><msub id="S3.E3.m1.5.5.2.1.1.3" xref="S3.E3.m1.5.5.2.1.1.3.cmml"><mi id="S3.E3.m1.5.5.2.1.1.3.2" xref="S3.E3.m1.5.5.2.1.1.3.2.cmml">e</mi><msub id="S3.E3.m1.5.5.2.1.1.3.3" xref="S3.E3.m1.5.5.2.1.1.3.3.cmml"><mi id="S3.E3.m1.5.5.2.1.1.3.3.2" xref="S3.E3.m1.5.5.2.1.1.3.3.2.cmml">d</mi><mi id="S3.E3.m1.5.5.2.1.1.3.3.3" xref="S3.E3.m1.5.5.2.1.1.3.3.3.cmml">i</mi></msub></msub></mrow><mspace id="S3.E3.m1.6.6.3.2.3" width="1em" xref="S3.E3.m1.6.6.3.3.cmml"></mspace><mrow id="S3.E3.m1.6.6.3.2.2" xref="S3.E3.m1.6.6.3.2.2.cmml"><mi id="S3.E3.m1.6.6.3.2.2.2" xref="S3.E3.m1.6.6.3.2.2.2.cmml">o</mi><mo id="S3.E3.m1.6.6.3.2.2.1" xref="S3.E3.m1.6.6.3.2.2.1.cmml">⁢</mo><mi id="S3.E3.m1.6.6.3.2.2.3" xref="S3.E3.m1.6.6.3.2.2.3.cmml">r</mi></mrow><mspace id="S3.E3.m1.6.6.3.2.4" width="1em" xref="S3.E3.m1.6.6.3.3.cmml"></mspace><mfrac id="S3.E3.m1.2.2" xref="S3.E3.m1.2.2.cmml"><mrow id="S3.E3.m1.2.2.4" xref="S3.E3.m1.2.2.4.cmml"><msub id="S3.E3.m1.2.2.4.2" xref="S3.E3.m1.2.2.4.2.cmml"><mi id="S3.E3.m1.2.2.4.2.2" xref="S3.E3.m1.2.2.4.2.2.cmml">e</mi><mi id="S3.E3.m1.2.2.4.2.3" xref="S3.E3.m1.2.2.4.2.3.cmml">q</mi></msub><mo id="S3.E3.m1.2.2.4.1" lspace="0.222em" rspace="0.222em" xref="S3.E3.m1.2.2.4.1.cmml">⋅</mo><msub id="S3.E3.m1.2.2.4.3" xref="S3.E3.m1.2.2.4.3.cmml"><mi id="S3.E3.m1.2.2.4.3.2" xref="S3.E3.m1.2.2.4.3.2.cmml">e</mi><msub id="S3.E3.m1.2.2.4.3.3" xref="S3.E3.m1.2.2.4.3.3.cmml"><mi id="S3.E3.m1.2.2.4.3.3.2" xref="S3.E3.m1.2.2.4.3.3.2.cmml">d</mi><mi id="S3.E3.m1.2.2.4.3.3.3" xref="S3.E3.m1.2.2.4.3.3.3.cmml">i</mi></msub></msub></mrow><mrow id="S3.E3.m1.2.2.2" xref="S3.E3.m1.2.2.2.cmml"><mrow id="S3.E3.m1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.2.cmml"><mo id="S3.E3.m1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.1.1.1.1.2.1.cmml">‖</mo><msub id="S3.E3.m1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.cmml"><mi id="S3.E3.m1.1.1.1.1.1.1.2" xref="S3.E3.m1.1.1.1.1.1.1.2.cmml">e</mi><mi id="S3.E3.m1.1.1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.1.1.3.cmml">q</mi></msub><mo id="S3.E3.m1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.E3.m1.1.1.1.1.2.1.cmml">‖</mo></mrow><mo id="S3.E3.m1.2.2.2.3" rspace="0.222em" xref="S3.E3.m1.2.2.2.3.cmml">⋅</mo><mrow id="S3.E3.m1.2.2.2.2.1" xref="S3.E3.m1.2.2.2.2.2.cmml"><mo id="S3.E3.m1.2.2.2.2.1.2" stretchy="false" xref="S3.E3.m1.2.2.2.2.2.1.cmml">‖</mo><msub id="S3.E3.m1.2.2.2.2.1.1" xref="S3.E3.m1.2.2.2.2.1.1.cmml"><mi id="S3.E3.m1.2.2.2.2.1.1.2" xref="S3.E3.m1.2.2.2.2.1.1.2.cmml">e</mi><msub id="S3.E3.m1.2.2.2.2.1.1.3" xref="S3.E3.m1.2.2.2.2.1.1.3.cmml"><mi id="S3.E3.m1.2.2.2.2.1.1.3.2" xref="S3.E3.m1.2.2.2.2.1.1.3.2.cmml">d</mi><mi id="S3.E3.m1.2.2.2.2.1.1.3.3" xref="S3.E3.m1.2.2.2.2.1.1.3.3.cmml">i</mi></msub></msub><mo id="S3.E3.m1.2.2.2.2.1.3" stretchy="false" xref="S3.E3.m1.2.2.2.2.2.1.cmml">‖</mo></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.6b"><apply id="S3.E3.m1.6.6.cmml" xref="S3.E3.m1.6.6"><eq id="S3.E3.m1.6.6.4.cmml" xref="S3.E3.m1.6.6.4"></eq><apply id="S3.E3.m1.4.4.1.cmml" xref="S3.E3.m1.4.4.1"><times id="S3.E3.m1.4.4.1.2.cmml" xref="S3.E3.m1.4.4.1.2"></times><ci id="S3.E3.m1.4.4.1.3.cmml" xref="S3.E3.m1.4.4.1.3">𝑆</ci><ci id="S3.E3.m1.4.4.1.4.cmml" xref="S3.E3.m1.4.4.1.4">𝑖</ci><ci id="S3.E3.m1.4.4.1.5.cmml" xref="S3.E3.m1.4.4.1.5">𝑚</ci><interval closure="open" id="S3.E3.m1.4.4.1.1.2.cmml" xref="S3.E3.m1.4.4.1.1.1"><ci id="S3.E3.m1.3.3.cmml" xref="S3.E3.m1.3.3">𝑞</ci><apply id="S3.E3.m1.4.4.1.1.1.1.cmml" xref="S3.E3.m1.4.4.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.1.1.1.1.1.cmml" xref="S3.E3.m1.4.4.1.1.1.1">subscript</csymbol><ci id="S3.E3.m1.4.4.1.1.1.1.2.cmml" xref="S3.E3.m1.4.4.1.1.1.1.2">𝑑</ci><ci id="S3.E3.m1.4.4.1.1.1.1.3.cmml" xref="S3.E3.m1.4.4.1.1.1.1.3">𝑖</ci></apply></interval></apply><list id="S3.E3.m1.6.6.3.3.cmml" xref="S3.E3.m1.6.6.3.2"><apply id="S3.E3.m1.5.5.2.1.1.cmml" xref="S3.E3.m1.5.5.2.1.1"><ci id="S3.E3.m1.5.5.2.1.1.1.cmml" xref="S3.E3.m1.5.5.2.1.1.1">⋅</ci><apply id="S3.E3.m1.5.5.2.1.1.2.cmml" xref="S3.E3.m1.5.5.2.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.5.5.2.1.1.2.1.cmml" xref="S3.E3.m1.5.5.2.1.1.2">subscript</csymbol><ci id="S3.E3.m1.5.5.2.1.1.2.2.cmml" xref="S3.E3.m1.5.5.2.1.1.2.2">𝑒</ci><ci id="S3.E3.m1.5.5.2.1.1.2.3.cmml" xref="S3.E3.m1.5.5.2.1.1.2.3">𝑞</ci></apply><apply id="S3.E3.m1.5.5.2.1.1.3.cmml" xref="S3.E3.m1.5.5.2.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.5.5.2.1.1.3.1.cmml" xref="S3.E3.m1.5.5.2.1.1.3">subscript</csymbol><ci id="S3.E3.m1.5.5.2.1.1.3.2.cmml" xref="S3.E3.m1.5.5.2.1.1.3.2">𝑒</ci><apply id="S3.E3.m1.5.5.2.1.1.3.3.cmml" xref="S3.E3.m1.5.5.2.1.1.3.3"><csymbol cd="ambiguous" id="S3.E3.m1.5.5.2.1.1.3.3.1.cmml" xref="S3.E3.m1.5.5.2.1.1.3.3">subscript</csymbol><ci id="S3.E3.m1.5.5.2.1.1.3.3.2.cmml" xref="S3.E3.m1.5.5.2.1.1.3.3.2">𝑑</ci><ci id="S3.E3.m1.5.5.2.1.1.3.3.3.cmml" xref="S3.E3.m1.5.5.2.1.1.3.3.3">𝑖</ci></apply></apply></apply><apply id="S3.E3.m1.6.6.3.2.2.cmml" xref="S3.E3.m1.6.6.3.2.2"><times id="S3.E3.m1.6.6.3.2.2.1.cmml" xref="S3.E3.m1.6.6.3.2.2.1"></times><ci id="S3.E3.m1.6.6.3.2.2.2.cmml" xref="S3.E3.m1.6.6.3.2.2.2">𝑜</ci><ci id="S3.E3.m1.6.6.3.2.2.3.cmml" xref="S3.E3.m1.6.6.3.2.2.3">𝑟</ci></apply><apply id="S3.E3.m1.2.2.cmml" xref="S3.E3.m1.2.2"><divide id="S3.E3.m1.2.2.3.cmml" xref="S3.E3.m1.2.2"></divide><apply id="S3.E3.m1.2.2.4.cmml" xref="S3.E3.m1.2.2.4"><ci id="S3.E3.m1.2.2.4.1.cmml" xref="S3.E3.m1.2.2.4.1">⋅</ci><apply id="S3.E3.m1.2.2.4.2.cmml" xref="S3.E3.m1.2.2.4.2"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.4.2.1.cmml" xref="S3.E3.m1.2.2.4.2">subscript</csymbol><ci id="S3.E3.m1.2.2.4.2.2.cmml" xref="S3.E3.m1.2.2.4.2.2">𝑒</ci><ci id="S3.E3.m1.2.2.4.2.3.cmml" xref="S3.E3.m1.2.2.4.2.3">𝑞</ci></apply><apply id="S3.E3.m1.2.2.4.3.cmml" xref="S3.E3.m1.2.2.4.3"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.4.3.1.cmml" xref="S3.E3.m1.2.2.4.3">subscript</csymbol><ci id="S3.E3.m1.2.2.4.3.2.cmml" xref="S3.E3.m1.2.2.4.3.2">𝑒</ci><apply id="S3.E3.m1.2.2.4.3.3.cmml" xref="S3.E3.m1.2.2.4.3.3"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.4.3.3.1.cmml" xref="S3.E3.m1.2.2.4.3.3">subscript</csymbol><ci id="S3.E3.m1.2.2.4.3.3.2.cmml" xref="S3.E3.m1.2.2.4.3.3.2">𝑑</ci><ci id="S3.E3.m1.2.2.4.3.3.3.cmml" xref="S3.E3.m1.2.2.4.3.3.3">𝑖</ci></apply></apply></apply><apply id="S3.E3.m1.2.2.2.cmml" xref="S3.E3.m1.2.2.2"><ci id="S3.E3.m1.2.2.2.3.cmml" xref="S3.E3.m1.2.2.2.3">⋅</ci><apply id="S3.E3.m1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.E3.m1.1.1.1.1.2.1.cmml" xref="S3.E3.m1.1.1.1.1.1.2">norm</csymbol><apply id="S3.E3.m1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E3.m1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.2">𝑒</ci><ci id="S3.E3.m1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.1.1.1.3">𝑞</ci></apply></apply><apply id="S3.E3.m1.2.2.2.2.2.cmml" xref="S3.E3.m1.2.2.2.2.1"><csymbol cd="latexml" id="S3.E3.m1.2.2.2.2.2.1.cmml" xref="S3.E3.m1.2.2.2.2.1.2">norm</csymbol><apply id="S3.E3.m1.2.2.2.2.1.1.cmml" xref="S3.E3.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.2.2.1.1.1.cmml" xref="S3.E3.m1.2.2.2.2.1.1">subscript</csymbol><ci id="S3.E3.m1.2.2.2.2.1.1.2.cmml" xref="S3.E3.m1.2.2.2.2.1.1.2">𝑒</ci><apply id="S3.E3.m1.2.2.2.2.1.1.3.cmml" xref="S3.E3.m1.2.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.2.2.1.1.3.1.cmml" xref="S3.E3.m1.2.2.2.2.1.1.3">subscript</csymbol><ci id="S3.E3.m1.2.2.2.2.1.1.3.2.cmml" xref="S3.E3.m1.2.2.2.2.1.1.3.2">𝑑</ci><ci id="S3.E3.m1.2.2.2.2.1.1.3.3.cmml" xref="S3.E3.m1.2.2.2.2.1.1.3.3">𝑖</ci></apply></apply></apply></apply></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.6c">Sim(q,d_{i})=e_{q}\cdot e_{d_{i}}\quad or\quad\frac{e_{q}\cdot e_{d_{i}}}{\|e_%
{q}\|\cdot\|e_{d_{i}}\|}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.6d">italic_S italic_i italic_m ( italic_q , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) = italic_e start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT ⋅ italic_e start_POSTSUBSCRIPT italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT italic_o italic_r divide start_ARG italic_e start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT ⋅ italic_e start_POSTSUBSCRIPT italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT end_ARG start_ARG ∥ italic_e start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT ∥ ⋅ ∥ italic_e start_POSTSUBSCRIPT italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∥ end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p1.12"><span class="ltx_text ltx_font_bold" id="S3.p1.12.1">3) Generation</span>. After getting the relevant documents. The query <math alttext="q" class="ltx_Math" display="inline" id="S3.p1.10.m1.1"><semantics id="S3.p1.10.m1.1a"><mi id="S3.p1.10.m1.1.1" xref="S3.p1.10.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S3.p1.10.m1.1b"><ci id="S3.p1.10.m1.1.1.cmml" xref="S3.p1.10.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.10.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="S3.p1.10.m1.1d">italic_q</annotation></semantics></math> and the retrieved document <math alttext="D^{q}" class="ltx_Math" display="inline" id="S3.p1.11.m2.1"><semantics id="S3.p1.11.m2.1a"><msup id="S3.p1.11.m2.1.1" xref="S3.p1.11.m2.1.1.cmml"><mi id="S3.p1.11.m2.1.1.2" xref="S3.p1.11.m2.1.1.2.cmml">D</mi><mi id="S3.p1.11.m2.1.1.3" xref="S3.p1.11.m2.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S3.p1.11.m2.1b"><apply id="S3.p1.11.m2.1.1.cmml" xref="S3.p1.11.m2.1.1"><csymbol cd="ambiguous" id="S3.p1.11.m2.1.1.1.cmml" xref="S3.p1.11.m2.1.1">superscript</csymbol><ci id="S3.p1.11.m2.1.1.2.cmml" xref="S3.p1.11.m2.1.1.2">𝐷</ci><ci id="S3.p1.11.m2.1.1.3.cmml" xref="S3.p1.11.m2.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.11.m2.1c">D^{q}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.11.m2.1d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math> chunks are inputted together to the LLM to generate the final answer, where <math alttext="[\cdot,\cdot]" class="ltx_Math" display="inline" id="S3.p1.12.m3.2"><semantics id="S3.p1.12.m3.2a"><mrow id="S3.p1.12.m3.2.3.2" xref="S3.p1.12.m3.2.3.1.cmml"><mo id="S3.p1.12.m3.2.3.2.1" stretchy="false" xref="S3.p1.12.m3.2.3.1.cmml">[</mo><mo id="S3.p1.12.m3.1.1" lspace="0em" rspace="0em" xref="S3.p1.12.m3.1.1.cmml">⋅</mo><mo id="S3.p1.12.m3.2.3.2.2" rspace="0em" xref="S3.p1.12.m3.2.3.1.cmml">,</mo><mo id="S3.p1.12.m3.2.2" lspace="0em" rspace="0em" xref="S3.p1.12.m3.2.2.cmml">⋅</mo><mo id="S3.p1.12.m3.2.3.2.3" stretchy="false" xref="S3.p1.12.m3.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.12.m3.2b"><interval closure="closed" id="S3.p1.12.m3.2.3.1.cmml" xref="S3.p1.12.m3.2.3.2"><ci id="S3.p1.12.m3.1.1.cmml" xref="S3.p1.12.m3.1.1">⋅</ci><ci id="S3.p1.12.m3.2.2.cmml" xref="S3.p1.12.m3.2.2">⋅</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.12.m3.2c">[\cdot,\cdot]</annotation><annotation encoding="application/x-llamapun" id="S3.p1.12.m3.2d">[ ⋅ , ⋅ ]</annotation></semantics></math> stands for concatenation.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="y=\mathcal{LLM}([D^{q},q])" class="ltx_Math" display="block" id="S3.E4.m1.2"><semantics id="S3.E4.m1.2a"><mrow id="S3.E4.m1.2.2" xref="S3.E4.m1.2.2.cmml"><mi id="S3.E4.m1.2.2.3" xref="S3.E4.m1.2.2.3.cmml">y</mi><mo id="S3.E4.m1.2.2.2" xref="S3.E4.m1.2.2.2.cmml">=</mo><mrow id="S3.E4.m1.2.2.1" xref="S3.E4.m1.2.2.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.2.2.1.3" xref="S3.E4.m1.2.2.1.3.cmml">ℒ</mi><mo id="S3.E4.m1.2.2.1.2" xref="S3.E4.m1.2.2.1.2.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.2.2.1.4" xref="S3.E4.m1.2.2.1.4.cmml">ℒ</mi><mo id="S3.E4.m1.2.2.1.2a" xref="S3.E4.m1.2.2.1.2.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.2.2.1.5" xref="S3.E4.m1.2.2.1.5.cmml">ℳ</mi><mo id="S3.E4.m1.2.2.1.2b" xref="S3.E4.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.E4.m1.2.2.1.1.1" xref="S3.E4.m1.2.2.1.cmml"><mo id="S3.E4.m1.2.2.1.1.1.2" stretchy="false" xref="S3.E4.m1.2.2.1.cmml">(</mo><mrow id="S3.E4.m1.2.2.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml"><mo id="S3.E4.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">[</mo><msup id="S3.E4.m1.2.2.1.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.2.2.1.1.1.1.1.1.2" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2.cmml">D</mi><mi id="S3.E4.m1.2.2.1.1.1.1.1.1.3" xref="S3.E4.m1.2.2.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="S3.E4.m1.2.2.1.1.1.1.1.3" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">,</mo><mi id="S3.E4.m1.1.1" xref="S3.E4.m1.1.1.cmml">q</mi><mo id="S3.E4.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">]</mo></mrow><mo id="S3.E4.m1.2.2.1.1.1.3" stretchy="false" xref="S3.E4.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.2b"><apply id="S3.E4.m1.2.2.cmml" xref="S3.E4.m1.2.2"><eq id="S3.E4.m1.2.2.2.cmml" xref="S3.E4.m1.2.2.2"></eq><ci id="S3.E4.m1.2.2.3.cmml" xref="S3.E4.m1.2.2.3">𝑦</ci><apply id="S3.E4.m1.2.2.1.cmml" xref="S3.E4.m1.2.2.1"><times id="S3.E4.m1.2.2.1.2.cmml" xref="S3.E4.m1.2.2.1.2"></times><ci id="S3.E4.m1.2.2.1.3.cmml" xref="S3.E4.m1.2.2.1.3">ℒ</ci><ci id="S3.E4.m1.2.2.1.4.cmml" xref="S3.E4.m1.2.2.1.4">ℒ</ci><ci id="S3.E4.m1.2.2.1.5.cmml" xref="S3.E4.m1.2.2.1.5">ℳ</ci><interval closure="closed" id="S3.E4.m1.2.2.1.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1"><apply id="S3.E4.m1.2.2.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E4.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2">𝐷</ci><ci id="S3.E4.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1.3">𝑞</ci></apply><ci id="S3.E4.m1.1.1.cmml" xref="S3.E4.m1.1.1">𝑞</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.2c">y=\mathcal{LLM}([D^{q},q])</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.2d">italic_y = caligraphic_L caligraphic_L caligraphic_M ( [ italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT , italic_q ] )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p1.13">With the evolution of RAG technology, more and more functional components are being integrated into systems. Modular RAG paradigm includes three levels, ranging from large to small:</p>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p" id="S3.p2.1"><span class="ltx_text ltx_font_bold" id="S3.p2.1.1">L1 Module</span> (<math alttext="\mathcal{M}=\{\mathcal{M}_{s}\}" class="ltx_Math" display="inline" id="S3.p2.1.m1.1"><semantics id="S3.p2.1.m1.1a"><mrow id="S3.p2.1.m1.1.1" xref="S3.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p2.1.m1.1.1.3" xref="S3.p2.1.m1.1.1.3.cmml">ℳ</mi><mo id="S3.p2.1.m1.1.1.2" xref="S3.p2.1.m1.1.1.2.cmml">=</mo><mrow id="S3.p2.1.m1.1.1.1.1" xref="S3.p2.1.m1.1.1.1.2.cmml"><mo id="S3.p2.1.m1.1.1.1.1.2" stretchy="false" xref="S3.p2.1.m1.1.1.1.2.cmml">{</mo><msub id="S3.p2.1.m1.1.1.1.1.1" xref="S3.p2.1.m1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p2.1.m1.1.1.1.1.1.2" xref="S3.p2.1.m1.1.1.1.1.1.2.cmml">ℳ</mi><mi id="S3.p2.1.m1.1.1.1.1.1.3" xref="S3.p2.1.m1.1.1.1.1.1.3.cmml">s</mi></msub><mo id="S3.p2.1.m1.1.1.1.1.3" stretchy="false" xref="S3.p2.1.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.1b"><apply id="S3.p2.1.m1.1.1.cmml" xref="S3.p2.1.m1.1.1"><eq id="S3.p2.1.m1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.2"></eq><ci id="S3.p2.1.m1.1.1.3.cmml" xref="S3.p2.1.m1.1.1.3">ℳ</ci><set id="S3.p2.1.m1.1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.1.1"><apply id="S3.p2.1.m1.1.1.1.1.1.cmml" xref="S3.p2.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p2.1.m1.1.1.1.1.1.1.cmml" xref="S3.p2.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.p2.1.m1.1.1.1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.1.1.1.2">ℳ</ci><ci id="S3.p2.1.m1.1.1.1.1.1.3.cmml" xref="S3.p2.1.m1.1.1.1.1.1.3">𝑠</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.1c">\mathcal{M}=\{\mathcal{M}_{s}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.1.m1.1d">caligraphic_M = { caligraphic_M start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT }</annotation></semantics></math>). The core process in RAG system.</p>
</div>
<div class="ltx_para" id="S3.p3">
<p class="ltx_p" id="S3.p3.1"><span class="ltx_text ltx_font_bold" id="S3.p3.1.1">L2 Sub-module</span> (<math alttext="\mathcal{M}_{s}=\{Op\}" class="ltx_Math" display="inline" id="S3.p3.1.m1.1"><semantics id="S3.p3.1.m1.1a"><mrow id="S3.p3.1.m1.1.1" xref="S3.p3.1.m1.1.1.cmml"><msub id="S3.p3.1.m1.1.1.3" xref="S3.p3.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p3.1.m1.1.1.3.2" xref="S3.p3.1.m1.1.1.3.2.cmml">ℳ</mi><mi id="S3.p3.1.m1.1.1.3.3" xref="S3.p3.1.m1.1.1.3.3.cmml">s</mi></msub><mo id="S3.p3.1.m1.1.1.2" xref="S3.p3.1.m1.1.1.2.cmml">=</mo><mrow id="S3.p3.1.m1.1.1.1.1" xref="S3.p3.1.m1.1.1.1.2.cmml"><mo id="S3.p3.1.m1.1.1.1.1.2" stretchy="false" xref="S3.p3.1.m1.1.1.1.2.cmml">{</mo><mrow id="S3.p3.1.m1.1.1.1.1.1" xref="S3.p3.1.m1.1.1.1.1.1.cmml"><mi id="S3.p3.1.m1.1.1.1.1.1.2" xref="S3.p3.1.m1.1.1.1.1.1.2.cmml">O</mi><mo id="S3.p3.1.m1.1.1.1.1.1.1" xref="S3.p3.1.m1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.p3.1.m1.1.1.1.1.1.3" xref="S3.p3.1.m1.1.1.1.1.1.3.cmml">p</mi></mrow><mo id="S3.p3.1.m1.1.1.1.1.3" stretchy="false" xref="S3.p3.1.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.1.m1.1b"><apply id="S3.p3.1.m1.1.1.cmml" xref="S3.p3.1.m1.1.1"><eq id="S3.p3.1.m1.1.1.2.cmml" xref="S3.p3.1.m1.1.1.2"></eq><apply id="S3.p3.1.m1.1.1.3.cmml" xref="S3.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.p3.1.m1.1.1.3.1.cmml" xref="S3.p3.1.m1.1.1.3">subscript</csymbol><ci id="S3.p3.1.m1.1.1.3.2.cmml" xref="S3.p3.1.m1.1.1.3.2">ℳ</ci><ci id="S3.p3.1.m1.1.1.3.3.cmml" xref="S3.p3.1.m1.1.1.3.3">𝑠</ci></apply><set id="S3.p3.1.m1.1.1.1.2.cmml" xref="S3.p3.1.m1.1.1.1.1"><apply id="S3.p3.1.m1.1.1.1.1.1.cmml" xref="S3.p3.1.m1.1.1.1.1.1"><times id="S3.p3.1.m1.1.1.1.1.1.1.cmml" xref="S3.p3.1.m1.1.1.1.1.1.1"></times><ci id="S3.p3.1.m1.1.1.1.1.1.2.cmml" xref="S3.p3.1.m1.1.1.1.1.1.2">𝑂</ci><ci id="S3.p3.1.m1.1.1.1.1.1.3.cmml" xref="S3.p3.1.m1.1.1.1.1.1.3">𝑝</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.1.m1.1c">\mathcal{M}_{s}=\{Op\}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT = { italic_O italic_p }</annotation></semantics></math>).The functional modules in module.</p>
</div>
<div class="ltx_para" id="S3.p4">
<p class="ltx_p" id="S3.p4.1"><span class="ltx_text ltx_font_bold" id="S3.p4.1.1">L3 Operator</span> (<math alttext="\mathcal{O}p=\{f_{\theta_{i}}\}" class="ltx_Math" display="inline" id="S3.p4.1.m1.1"><semantics id="S3.p4.1.m1.1a"><mrow id="S3.p4.1.m1.1.1" xref="S3.p4.1.m1.1.1.cmml"><mrow id="S3.p4.1.m1.1.1.3" xref="S3.p4.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p4.1.m1.1.1.3.2" xref="S3.p4.1.m1.1.1.3.2.cmml">𝒪</mi><mo id="S3.p4.1.m1.1.1.3.1" xref="S3.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.p4.1.m1.1.1.3.3" xref="S3.p4.1.m1.1.1.3.3.cmml">p</mi></mrow><mo id="S3.p4.1.m1.1.1.2" xref="S3.p4.1.m1.1.1.2.cmml">=</mo><mrow id="S3.p4.1.m1.1.1.1.1" xref="S3.p4.1.m1.1.1.1.2.cmml"><mo id="S3.p4.1.m1.1.1.1.1.2" stretchy="false" xref="S3.p4.1.m1.1.1.1.2.cmml">{</mo><msub id="S3.p4.1.m1.1.1.1.1.1" xref="S3.p4.1.m1.1.1.1.1.1.cmml"><mi id="S3.p4.1.m1.1.1.1.1.1.2" xref="S3.p4.1.m1.1.1.1.1.1.2.cmml">f</mi><msub id="S3.p4.1.m1.1.1.1.1.1.3" xref="S3.p4.1.m1.1.1.1.1.1.3.cmml"><mi id="S3.p4.1.m1.1.1.1.1.1.3.2" xref="S3.p4.1.m1.1.1.1.1.1.3.2.cmml">θ</mi><mi id="S3.p4.1.m1.1.1.1.1.1.3.3" xref="S3.p4.1.m1.1.1.1.1.1.3.3.cmml">i</mi></msub></msub><mo id="S3.p4.1.m1.1.1.1.1.3" stretchy="false" xref="S3.p4.1.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p4.1.m1.1b"><apply id="S3.p4.1.m1.1.1.cmml" xref="S3.p4.1.m1.1.1"><eq id="S3.p4.1.m1.1.1.2.cmml" xref="S3.p4.1.m1.1.1.2"></eq><apply id="S3.p4.1.m1.1.1.3.cmml" xref="S3.p4.1.m1.1.1.3"><times id="S3.p4.1.m1.1.1.3.1.cmml" xref="S3.p4.1.m1.1.1.3.1"></times><ci id="S3.p4.1.m1.1.1.3.2.cmml" xref="S3.p4.1.m1.1.1.3.2">𝒪</ci><ci id="S3.p4.1.m1.1.1.3.3.cmml" xref="S3.p4.1.m1.1.1.3.3">𝑝</ci></apply><set id="S3.p4.1.m1.1.1.1.2.cmml" xref="S3.p4.1.m1.1.1.1.1"><apply id="S3.p4.1.m1.1.1.1.1.1.cmml" xref="S3.p4.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p4.1.m1.1.1.1.1.1.1.cmml" xref="S3.p4.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.p4.1.m1.1.1.1.1.1.2.cmml" xref="S3.p4.1.m1.1.1.1.1.1.2">𝑓</ci><apply id="S3.p4.1.m1.1.1.1.1.1.3.cmml" xref="S3.p4.1.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.p4.1.m1.1.1.1.1.1.3.1.cmml" xref="S3.p4.1.m1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.p4.1.m1.1.1.1.1.1.3.2.cmml" xref="S3.p4.1.m1.1.1.1.1.1.3.2">𝜃</ci><ci id="S3.p4.1.m1.1.1.1.1.1.3.3.cmml" xref="S3.p4.1.m1.1.1.1.1.1.3.3">𝑖</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.1.m1.1c">\mathcal{O}p=\{f_{\theta_{i}}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.1.m1.1d">caligraphic_O italic_p = { italic_f start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT }</annotation></semantics></math>). The the specific functional implementation in a module or sub-module.
As a result, a Modular RAG system can be represented as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{G}=\{q,D,\mathcal{M},\{\mathcal{M}_{s}\},\{Op\}\}" class="ltx_Math" display="block" id="S3.E5.m1.5"><semantics id="S3.E5.m1.5a"><mrow id="S3.E5.m1.5.5" xref="S3.E5.m1.5.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.5.5.4" xref="S3.E5.m1.5.5.4.cmml">𝒢</mi><mo id="S3.E5.m1.5.5.3" xref="S3.E5.m1.5.5.3.cmml">=</mo><mrow id="S3.E5.m1.5.5.2.2" xref="S3.E5.m1.5.5.2.3.cmml"><mo id="S3.E5.m1.5.5.2.2.3" stretchy="false" xref="S3.E5.m1.5.5.2.3.cmml">{</mo><mi id="S3.E5.m1.1.1" xref="S3.E5.m1.1.1.cmml">q</mi><mo id="S3.E5.m1.5.5.2.2.4" xref="S3.E5.m1.5.5.2.3.cmml">,</mo><mi id="S3.E5.m1.2.2" xref="S3.E5.m1.2.2.cmml">D</mi><mo id="S3.E5.m1.5.5.2.2.5" xref="S3.E5.m1.5.5.2.3.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.3.3" xref="S3.E5.m1.3.3.cmml">ℳ</mi><mo id="S3.E5.m1.5.5.2.2.6" xref="S3.E5.m1.5.5.2.3.cmml">,</mo><mrow id="S3.E5.m1.4.4.1.1.1.1" xref="S3.E5.m1.4.4.1.1.1.2.cmml"><mo id="S3.E5.m1.4.4.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.4.4.1.1.1.2.cmml">{</mo><msub id="S3.E5.m1.4.4.1.1.1.1.1" xref="S3.E5.m1.4.4.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.4.4.1.1.1.1.1.2" xref="S3.E5.m1.4.4.1.1.1.1.1.2.cmml">ℳ</mi><mi id="S3.E5.m1.4.4.1.1.1.1.1.3" xref="S3.E5.m1.4.4.1.1.1.1.1.3.cmml">s</mi></msub><mo id="S3.E5.m1.4.4.1.1.1.1.3" stretchy="false" xref="S3.E5.m1.4.4.1.1.1.2.cmml">}</mo></mrow><mo id="S3.E5.m1.5.5.2.2.7" xref="S3.E5.m1.5.5.2.3.cmml">,</mo><mrow id="S3.E5.m1.5.5.2.2.2.1" xref="S3.E5.m1.5.5.2.2.2.2.cmml"><mo id="S3.E5.m1.5.5.2.2.2.1.2" stretchy="false" xref="S3.E5.m1.5.5.2.2.2.2.cmml">{</mo><mrow id="S3.E5.m1.5.5.2.2.2.1.1" xref="S3.E5.m1.5.5.2.2.2.1.1.cmml"><mi id="S3.E5.m1.5.5.2.2.2.1.1.2" xref="S3.E5.m1.5.5.2.2.2.1.1.2.cmml">O</mi><mo id="S3.E5.m1.5.5.2.2.2.1.1.1" xref="S3.E5.m1.5.5.2.2.2.1.1.1.cmml">⁢</mo><mi id="S3.E5.m1.5.5.2.2.2.1.1.3" xref="S3.E5.m1.5.5.2.2.2.1.1.3.cmml">p</mi></mrow><mo id="S3.E5.m1.5.5.2.2.2.1.3" stretchy="false" xref="S3.E5.m1.5.5.2.2.2.2.cmml">}</mo></mrow><mo id="S3.E5.m1.5.5.2.2.8" stretchy="false" xref="S3.E5.m1.5.5.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.5b"><apply id="S3.E5.m1.5.5.cmml" xref="S3.E5.m1.5.5"><eq id="S3.E5.m1.5.5.3.cmml" xref="S3.E5.m1.5.5.3"></eq><ci id="S3.E5.m1.5.5.4.cmml" xref="S3.E5.m1.5.5.4">𝒢</ci><set id="S3.E5.m1.5.5.2.3.cmml" xref="S3.E5.m1.5.5.2.2"><ci id="S3.E5.m1.1.1.cmml" xref="S3.E5.m1.1.1">𝑞</ci><ci id="S3.E5.m1.2.2.cmml" xref="S3.E5.m1.2.2">𝐷</ci><ci id="S3.E5.m1.3.3.cmml" xref="S3.E5.m1.3.3">ℳ</ci><set id="S3.E5.m1.4.4.1.1.1.2.cmml" xref="S3.E5.m1.4.4.1.1.1.1"><apply id="S3.E5.m1.4.4.1.1.1.1.1.cmml" xref="S3.E5.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E5.m1.4.4.1.1.1.1.1">subscript</csymbol><ci id="S3.E5.m1.4.4.1.1.1.1.1.2.cmml" xref="S3.E5.m1.4.4.1.1.1.1.1.2">ℳ</ci><ci id="S3.E5.m1.4.4.1.1.1.1.1.3.cmml" xref="S3.E5.m1.4.4.1.1.1.1.1.3">𝑠</ci></apply></set><set id="S3.E5.m1.5.5.2.2.2.2.cmml" xref="S3.E5.m1.5.5.2.2.2.1"><apply id="S3.E5.m1.5.5.2.2.2.1.1.cmml" xref="S3.E5.m1.5.5.2.2.2.1.1"><times id="S3.E5.m1.5.5.2.2.2.1.1.1.cmml" xref="S3.E5.m1.5.5.2.2.2.1.1.1"></times><ci id="S3.E5.m1.5.5.2.2.2.1.1.2.cmml" xref="S3.E5.m1.5.5.2.2.2.1.1.2">𝑂</ci><ci id="S3.E5.m1.5.5.2.2.2.1.1.3.cmml" xref="S3.E5.m1.5.5.2.2.2.1.1.3">𝑝</ci></apply></set></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.5c">\mathcal{G}=\{q,D,\mathcal{M},\{\mathcal{M}_{s}\},\{Op\}\}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.5d">caligraphic_G = { italic_q , italic_D , caligraphic_M , { caligraphic_M start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT } , { italic_O italic_p } }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p4.3">The arrangement between modules and operators constitutes the RAG Flow <math alttext="\mathcal{F}=(M_{\phi_{1}},\ldots,M_{\phi_{n}})" class="ltx_Math" display="inline" id="S3.p4.2.m1.3"><semantics id="S3.p4.2.m1.3a"><mrow id="S3.p4.2.m1.3.3" xref="S3.p4.2.m1.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p4.2.m1.3.3.4" xref="S3.p4.2.m1.3.3.4.cmml">ℱ</mi><mo id="S3.p4.2.m1.3.3.3" xref="S3.p4.2.m1.3.3.3.cmml">=</mo><mrow id="S3.p4.2.m1.3.3.2.2" xref="S3.p4.2.m1.3.3.2.3.cmml"><mo id="S3.p4.2.m1.3.3.2.2.3" stretchy="false" xref="S3.p4.2.m1.3.3.2.3.cmml">(</mo><msub id="S3.p4.2.m1.2.2.1.1.1" xref="S3.p4.2.m1.2.2.1.1.1.cmml"><mi id="S3.p4.2.m1.2.2.1.1.1.2" xref="S3.p4.2.m1.2.2.1.1.1.2.cmml">M</mi><msub id="S3.p4.2.m1.2.2.1.1.1.3" xref="S3.p4.2.m1.2.2.1.1.1.3.cmml"><mi id="S3.p4.2.m1.2.2.1.1.1.3.2" xref="S3.p4.2.m1.2.2.1.1.1.3.2.cmml">ϕ</mi><mn id="S3.p4.2.m1.2.2.1.1.1.3.3" xref="S3.p4.2.m1.2.2.1.1.1.3.3.cmml">1</mn></msub></msub><mo id="S3.p4.2.m1.3.3.2.2.4" xref="S3.p4.2.m1.3.3.2.3.cmml">,</mo><mi id="S3.p4.2.m1.1.1" mathvariant="normal" xref="S3.p4.2.m1.1.1.cmml">…</mi><mo id="S3.p4.2.m1.3.3.2.2.5" xref="S3.p4.2.m1.3.3.2.3.cmml">,</mo><msub id="S3.p4.2.m1.3.3.2.2.2" xref="S3.p4.2.m1.3.3.2.2.2.cmml"><mi id="S3.p4.2.m1.3.3.2.2.2.2" xref="S3.p4.2.m1.3.3.2.2.2.2.cmml">M</mi><msub id="S3.p4.2.m1.3.3.2.2.2.3" xref="S3.p4.2.m1.3.3.2.2.2.3.cmml"><mi id="S3.p4.2.m1.3.3.2.2.2.3.2" xref="S3.p4.2.m1.3.3.2.2.2.3.2.cmml">ϕ</mi><mi id="S3.p4.2.m1.3.3.2.2.2.3.3" xref="S3.p4.2.m1.3.3.2.2.2.3.3.cmml">n</mi></msub></msub><mo id="S3.p4.2.m1.3.3.2.2.6" stretchy="false" xref="S3.p4.2.m1.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p4.2.m1.3b"><apply id="S3.p4.2.m1.3.3.cmml" xref="S3.p4.2.m1.3.3"><eq id="S3.p4.2.m1.3.3.3.cmml" xref="S3.p4.2.m1.3.3.3"></eq><ci id="S3.p4.2.m1.3.3.4.cmml" xref="S3.p4.2.m1.3.3.4">ℱ</ci><vector id="S3.p4.2.m1.3.3.2.3.cmml" xref="S3.p4.2.m1.3.3.2.2"><apply id="S3.p4.2.m1.2.2.1.1.1.cmml" xref="S3.p4.2.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.p4.2.m1.2.2.1.1.1.1.cmml" xref="S3.p4.2.m1.2.2.1.1.1">subscript</csymbol><ci id="S3.p4.2.m1.2.2.1.1.1.2.cmml" xref="S3.p4.2.m1.2.2.1.1.1.2">𝑀</ci><apply id="S3.p4.2.m1.2.2.1.1.1.3.cmml" xref="S3.p4.2.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.p4.2.m1.2.2.1.1.1.3.1.cmml" xref="S3.p4.2.m1.2.2.1.1.1.3">subscript</csymbol><ci id="S3.p4.2.m1.2.2.1.1.1.3.2.cmml" xref="S3.p4.2.m1.2.2.1.1.1.3.2">italic-ϕ</ci><cn id="S3.p4.2.m1.2.2.1.1.1.3.3.cmml" type="integer" xref="S3.p4.2.m1.2.2.1.1.1.3.3">1</cn></apply></apply><ci id="S3.p4.2.m1.1.1.cmml" xref="S3.p4.2.m1.1.1">…</ci><apply id="S3.p4.2.m1.3.3.2.2.2.cmml" xref="S3.p4.2.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.p4.2.m1.3.3.2.2.2.1.cmml" xref="S3.p4.2.m1.3.3.2.2.2">subscript</csymbol><ci id="S3.p4.2.m1.3.3.2.2.2.2.cmml" xref="S3.p4.2.m1.3.3.2.2.2.2">𝑀</ci><apply id="S3.p4.2.m1.3.3.2.2.2.3.cmml" xref="S3.p4.2.m1.3.3.2.2.2.3"><csymbol cd="ambiguous" id="S3.p4.2.m1.3.3.2.2.2.3.1.cmml" xref="S3.p4.2.m1.3.3.2.2.2.3">subscript</csymbol><ci id="S3.p4.2.m1.3.3.2.2.2.3.2.cmml" xref="S3.p4.2.m1.3.3.2.2.2.3.2">italic-ϕ</ci><ci id="S3.p4.2.m1.3.3.2.2.2.3.3.cmml" xref="S3.p4.2.m1.3.3.2.2.2.3.3">𝑛</ci></apply></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.2.m1.3c">\mathcal{F}=(M_{\phi_{1}},\ldots,M_{\phi_{n}})</annotation><annotation encoding="application/x-llamapun" id="S3.p4.2.m1.3d">caligraphic_F = ( italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , … , italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT )</annotation></semantics></math>
where <math alttext="\phi" class="ltx_Math" display="inline" id="S3.p4.3.m2.1"><semantics id="S3.p4.3.m2.1a"><mi id="S3.p4.3.m2.1.1" xref="S3.p4.3.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.p4.3.m2.1b"><ci id="S3.p4.3.m2.1.1.cmml" xref="S3.p4.3.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.3.m2.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.p4.3.m2.1d">italic_ϕ</annotation></semantics></math> stands for the set of module parameters. A modular rag flow can be decomposed into a graph of sub-functions. In the simplest case,the graph is a linear chain.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="NaiveRAG:q\xrightarrow[Text-Embedding]{R(q,D)}D^{q}\xrightarrow[OpenAI/GPT-4]{%
LLM([q,D^{q}])}y" class="ltx_Math" display="block" id="S3.E6.m1.4"><semantics id="S3.E6.m1.4a"><mrow id="S3.E6.m1.4.5" xref="S3.E6.m1.4.5.cmml"><mrow id="S3.E6.m1.4.5.2" xref="S3.E6.m1.4.5.2.cmml"><mi id="S3.E6.m1.4.5.2.2" xref="S3.E6.m1.4.5.2.2.cmml">N</mi><mo id="S3.E6.m1.4.5.2.1" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.3" xref="S3.E6.m1.4.5.2.3.cmml">a</mi><mo id="S3.E6.m1.4.5.2.1a" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.4" xref="S3.E6.m1.4.5.2.4.cmml">i</mi><mo id="S3.E6.m1.4.5.2.1b" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.5" xref="S3.E6.m1.4.5.2.5.cmml">v</mi><mo id="S3.E6.m1.4.5.2.1c" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.6" xref="S3.E6.m1.4.5.2.6.cmml">e</mi><mo id="S3.E6.m1.4.5.2.1d" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.7" xref="S3.E6.m1.4.5.2.7.cmml">R</mi><mo id="S3.E6.m1.4.5.2.1e" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.8" xref="S3.E6.m1.4.5.2.8.cmml">A</mi><mo id="S3.E6.m1.4.5.2.1f" xref="S3.E6.m1.4.5.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.5.2.9" xref="S3.E6.m1.4.5.2.9.cmml">G</mi></mrow><mo id="S3.E6.m1.4.5.1" lspace="0.278em" rspace="0.278em" xref="S3.E6.m1.4.5.1.cmml">:</mo><mrow id="S3.E6.m1.4.5.3" xref="S3.E6.m1.4.5.3.cmml"><mi id="S3.E6.m1.4.5.3.2" xref="S3.E6.m1.4.5.3.2.cmml">q</mi><munderover accent="true" accentunder="true" id="S3.E6.m1.2.2" xref="S3.E6.m1.2.2.cmml"><mo id="S3.E6.m1.2.2.2.3" stretchy="false" xref="S3.E6.m1.2.2.2.3.cmml">→</mo><mrow id="S3.E6.m1.2.2.3" xref="S3.E6.m1.2.2.3.cmml"><mrow id="S3.E6.m1.2.2.3.2" xref="S3.E6.m1.2.2.3.2.cmml"><mi id="S3.E6.m1.2.2.3.2.2" mathsize="142%" xref="S3.E6.m1.2.2.3.2.2.cmml">T</mi><mo id="S3.E6.m1.2.2.3.2.1" xref="S3.E6.m1.2.2.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.2.3" mathsize="142%" xref="S3.E6.m1.2.2.3.2.3.cmml">e</mi><mo id="S3.E6.m1.2.2.3.2.1a" xref="S3.E6.m1.2.2.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.2.4" mathsize="142%" xref="S3.E6.m1.2.2.3.2.4.cmml">x</mi><mo id="S3.E6.m1.2.2.3.2.1b" xref="S3.E6.m1.2.2.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.2.5" mathsize="142%" xref="S3.E6.m1.2.2.3.2.5.cmml">t</mi></mrow><mo id="S3.E6.m1.2.2.3.1" mathsize="142%" xref="S3.E6.m1.2.2.3.1.cmml">−</mo><mrow id="S3.E6.m1.2.2.3.3" xref="S3.E6.m1.2.2.3.3.cmml"><mi id="S3.E6.m1.2.2.3.3.2" mathsize="142%" xref="S3.E6.m1.2.2.3.3.2.cmml">E</mi><mo id="S3.E6.m1.2.2.3.3.1" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.3" mathsize="142%" xref="S3.E6.m1.2.2.3.3.3.cmml">m</mi><mo id="S3.E6.m1.2.2.3.3.1a" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.4" mathsize="142%" xref="S3.E6.m1.2.2.3.3.4.cmml">b</mi><mo id="S3.E6.m1.2.2.3.3.1b" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.5" mathsize="142%" xref="S3.E6.m1.2.2.3.3.5.cmml">e</mi><mo id="S3.E6.m1.2.2.3.3.1c" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.6" mathsize="142%" xref="S3.E6.m1.2.2.3.3.6.cmml">d</mi><mo id="S3.E6.m1.2.2.3.3.1d" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.7" mathsize="142%" xref="S3.E6.m1.2.2.3.3.7.cmml">d</mi><mo id="S3.E6.m1.2.2.3.3.1e" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.8" mathsize="142%" xref="S3.E6.m1.2.2.3.3.8.cmml">i</mi><mo id="S3.E6.m1.2.2.3.3.1f" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.9" mathsize="142%" xref="S3.E6.m1.2.2.3.3.9.cmml">n</mi><mo id="S3.E6.m1.2.2.3.3.1g" xref="S3.E6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S3.E6.m1.2.2.3.3.10" mathsize="142%" xref="S3.E6.m1.2.2.3.3.10.cmml">g</mi></mrow></mrow><mrow id="S3.E6.m1.2.2.2.2" xref="S3.E6.m1.2.2.2.2.cmml"><mi id="S3.E6.m1.2.2.2.2.4" xref="S3.E6.m1.2.2.2.2.4.cmml">R</mi><mo id="S3.E6.m1.2.2.2.2.3" xref="S3.E6.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="S3.E6.m1.2.2.2.2.5.2" xref="S3.E6.m1.2.2.2.2.5.1.cmml"><mo id="S3.E6.m1.2.2.2.2.5.2.1" stretchy="false" xref="S3.E6.m1.2.2.2.2.5.1.cmml">(</mo><mi id="S3.E6.m1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.cmml">q</mi><mo id="S3.E6.m1.2.2.2.2.5.2.2" xref="S3.E6.m1.2.2.2.2.5.1.cmml">,</mo><mi id="S3.E6.m1.2.2.2.2.2" xref="S3.E6.m1.2.2.2.2.2.cmml">D</mi><mo id="S3.E6.m1.2.2.2.2.5.2.3" stretchy="false" xref="S3.E6.m1.2.2.2.2.5.1.cmml">)</mo></mrow></mrow></munderover><msup id="S3.E6.m1.4.5.3.3" xref="S3.E6.m1.4.5.3.3.cmml"><mi id="S3.E6.m1.4.5.3.3.2" xref="S3.E6.m1.4.5.3.3.2.cmml">D</mi><mi id="S3.E6.m1.4.5.3.3.3" xref="S3.E6.m1.4.5.3.3.3.cmml">q</mi></msup><munderover accent="true" accentunder="true" id="S3.E6.m1.4.4" xref="S3.E6.m1.4.4.cmml"><mo id="S3.E6.m1.4.4.2.3" stretchy="false" xref="S3.E6.m1.4.4.2.3.cmml">→</mo><mrow id="S3.E6.m1.4.4.3" xref="S3.E6.m1.4.4.3.cmml"><mrow id="S3.E6.m1.4.4.3.2" xref="S3.E6.m1.4.4.3.2.cmml"><mrow id="S3.E6.m1.4.4.3.2.2" xref="S3.E6.m1.4.4.3.2.2.cmml"><mrow id="S3.E6.m1.4.4.3.2.2.2" xref="S3.E6.m1.4.4.3.2.2.2.cmml"><mi id="S3.E6.m1.4.4.3.2.2.2.2" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.2.cmml">O</mi><mo id="S3.E6.m1.4.4.3.2.2.2.1" xref="S3.E6.m1.4.4.3.2.2.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.2.2.3" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.3.cmml">p</mi><mo id="S3.E6.m1.4.4.3.2.2.2.1a" xref="S3.E6.m1.4.4.3.2.2.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.2.2.4" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.4.cmml">e</mi><mo id="S3.E6.m1.4.4.3.2.2.2.1b" xref="S3.E6.m1.4.4.3.2.2.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.2.2.5" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.5.cmml">n</mi><mo id="S3.E6.m1.4.4.3.2.2.2.1c" xref="S3.E6.m1.4.4.3.2.2.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.2.2.6" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.6.cmml">A</mi><mo id="S3.E6.m1.4.4.3.2.2.2.1d" xref="S3.E6.m1.4.4.3.2.2.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.2.2.7" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.2.7.cmml">I</mi></mrow><mo id="S3.E6.m1.4.4.3.2.2.1" maxsize="142%" minsize="142%" stretchy="true" symmetric="true" xref="S3.E6.m1.4.4.3.2.2.1.cmml">/</mo><mi id="S3.E6.m1.4.4.3.2.2.3" mathsize="142%" xref="S3.E6.m1.4.4.3.2.2.3.cmml">G</mi></mrow><mo id="S3.E6.m1.4.4.3.2.1" xref="S3.E6.m1.4.4.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.3" mathsize="142%" xref="S3.E6.m1.4.4.3.2.3.cmml">P</mi><mo id="S3.E6.m1.4.4.3.2.1a" xref="S3.E6.m1.4.4.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.4" mathsize="142%" xref="S3.E6.m1.4.4.3.2.4.cmml">T</mi></mrow><mo id="S3.E6.m1.4.4.3.1" mathsize="142%" xref="S3.E6.m1.4.4.3.1.cmml">−</mo><mn id="S3.E6.m1.4.4.3.3" mathsize="142%" xref="S3.E6.m1.4.4.3.3.cmml">4</mn></mrow><mrow id="S3.E6.m1.4.4.2.2" xref="S3.E6.m1.4.4.2.2.cmml"><mi id="S3.E6.m1.4.4.2.2.4" xref="S3.E6.m1.4.4.2.2.4.cmml">L</mi><mo id="S3.E6.m1.4.4.2.2.3" xref="S3.E6.m1.4.4.2.2.3.cmml">⁢</mo><mi id="S3.E6.m1.4.4.2.2.5" xref="S3.E6.m1.4.4.2.2.5.cmml">L</mi><mo id="S3.E6.m1.4.4.2.2.3a" xref="S3.E6.m1.4.4.2.2.3.cmml">⁢</mo><mi id="S3.E6.m1.4.4.2.2.6" xref="S3.E6.m1.4.4.2.2.6.cmml">M</mi><mo id="S3.E6.m1.4.4.2.2.3b" xref="S3.E6.m1.4.4.2.2.3.cmml">⁢</mo><mrow id="S3.E6.m1.4.4.2.2.2.1" xref="S3.E6.m1.4.4.2.2.cmml"><mo id="S3.E6.m1.4.4.2.2.2.1.2" stretchy="false" xref="S3.E6.m1.4.4.2.2.cmml">(</mo><mrow id="S3.E6.m1.4.4.2.2.2.1.1.1" xref="S3.E6.m1.4.4.2.2.2.1.1.2.cmml"><mo id="S3.E6.m1.4.4.2.2.2.1.1.1.2" stretchy="false" xref="S3.E6.m1.4.4.2.2.2.1.1.2.cmml">[</mo><mi id="S3.E6.m1.3.3.1.1.1" xref="S3.E6.m1.3.3.1.1.1.cmml">q</mi><mo id="S3.E6.m1.4.4.2.2.2.1.1.1.3" xref="S3.E6.m1.4.4.2.2.2.1.1.2.cmml">,</mo><msup id="S3.E6.m1.4.4.2.2.2.1.1.1.1" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1.cmml"><mi id="S3.E6.m1.4.4.2.2.2.1.1.1.1.2" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1.2.cmml">D</mi><mi id="S3.E6.m1.4.4.2.2.2.1.1.1.1.3" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1.3.cmml">q</mi></msup><mo id="S3.E6.m1.4.4.2.2.2.1.1.1.4" stretchy="false" xref="S3.E6.m1.4.4.2.2.2.1.1.2.cmml">]</mo></mrow><mo id="S3.E6.m1.4.4.2.2.2.1.3" stretchy="false" xref="S3.E6.m1.4.4.2.2.cmml">)</mo></mrow></mrow></munderover><mi id="S3.E6.m1.4.5.3.4" xref="S3.E6.m1.4.5.3.4.cmml">y</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.4b"><apply id="S3.E6.m1.4.5.cmml" xref="S3.E6.m1.4.5"><ci id="S3.E6.m1.4.5.1.cmml" xref="S3.E6.m1.4.5.1">:</ci><apply id="S3.E6.m1.4.5.2.cmml" xref="S3.E6.m1.4.5.2"><times id="S3.E6.m1.4.5.2.1.cmml" xref="S3.E6.m1.4.5.2.1"></times><ci id="S3.E6.m1.4.5.2.2.cmml" xref="S3.E6.m1.4.5.2.2">𝑁</ci><ci id="S3.E6.m1.4.5.2.3.cmml" xref="S3.E6.m1.4.5.2.3">𝑎</ci><ci id="S3.E6.m1.4.5.2.4.cmml" xref="S3.E6.m1.4.5.2.4">𝑖</ci><ci id="S3.E6.m1.4.5.2.5.cmml" xref="S3.E6.m1.4.5.2.5">𝑣</ci><ci id="S3.E6.m1.4.5.2.6.cmml" xref="S3.E6.m1.4.5.2.6">𝑒</ci><ci id="S3.E6.m1.4.5.2.7.cmml" xref="S3.E6.m1.4.5.2.7">𝑅</ci><ci id="S3.E6.m1.4.5.2.8.cmml" xref="S3.E6.m1.4.5.2.8">𝐴</ci><ci id="S3.E6.m1.4.5.2.9.cmml" xref="S3.E6.m1.4.5.2.9">𝐺</ci></apply><apply id="S3.E6.m1.4.5.3.cmml" xref="S3.E6.m1.4.5.3"><and id="S3.E6.m1.4.5.3a.cmml" xref="S3.E6.m1.4.5.3"></and><apply id="S3.E6.m1.4.5.3b.cmml" xref="S3.E6.m1.4.5.3"><apply id="S3.E6.m1.2.2.cmml" xref="S3.E6.m1.2.2"><apply id="S3.E6.m1.2.2.3.cmml" xref="S3.E6.m1.2.2.3"><minus id="S3.E6.m1.2.2.3.1.cmml" xref="S3.E6.m1.2.2.3.1"></minus><apply id="S3.E6.m1.2.2.3.2.cmml" xref="S3.E6.m1.2.2.3.2"><times id="S3.E6.m1.2.2.3.2.1.cmml" xref="S3.E6.m1.2.2.3.2.1"></times><ci id="S3.E6.m1.2.2.3.2.2.cmml" xref="S3.E6.m1.2.2.3.2.2">𝑇</ci><ci id="S3.E6.m1.2.2.3.2.3.cmml" xref="S3.E6.m1.2.2.3.2.3">𝑒</ci><ci id="S3.E6.m1.2.2.3.2.4.cmml" xref="S3.E6.m1.2.2.3.2.4">𝑥</ci><ci id="S3.E6.m1.2.2.3.2.5.cmml" xref="S3.E6.m1.2.2.3.2.5">𝑡</ci></apply><apply id="S3.E6.m1.2.2.3.3.cmml" xref="S3.E6.m1.2.2.3.3"><times id="S3.E6.m1.2.2.3.3.1.cmml" xref="S3.E6.m1.2.2.3.3.1"></times><ci id="S3.E6.m1.2.2.3.3.2.cmml" xref="S3.E6.m1.2.2.3.3.2">𝐸</ci><ci id="S3.E6.m1.2.2.3.3.3.cmml" xref="S3.E6.m1.2.2.3.3.3">𝑚</ci><ci id="S3.E6.m1.2.2.3.3.4.cmml" xref="S3.E6.m1.2.2.3.3.4">𝑏</ci><ci id="S3.E6.m1.2.2.3.3.5.cmml" xref="S3.E6.m1.2.2.3.3.5">𝑒</ci><ci id="S3.E6.m1.2.2.3.3.6.cmml" xref="S3.E6.m1.2.2.3.3.6">𝑑</ci><ci id="S3.E6.m1.2.2.3.3.7.cmml" xref="S3.E6.m1.2.2.3.3.7">𝑑</ci><ci id="S3.E6.m1.2.2.3.3.8.cmml" xref="S3.E6.m1.2.2.3.3.8">𝑖</ci><ci id="S3.E6.m1.2.2.3.3.9.cmml" xref="S3.E6.m1.2.2.3.3.9">𝑛</ci><ci id="S3.E6.m1.2.2.3.3.10.cmml" xref="S3.E6.m1.2.2.3.3.10">𝑔</ci></apply></apply><apply id="S3.E6.m1.2.2.2.cmml" xref="S3.E6.m1.2.2"><apply id="S3.E6.m1.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2"><times id="S3.E6.m1.2.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2.3"></times><ci id="S3.E6.m1.2.2.2.2.4.cmml" xref="S3.E6.m1.2.2.2.2.4">𝑅</ci><interval closure="open" id="S3.E6.m1.2.2.2.2.5.1.cmml" xref="S3.E6.m1.2.2.2.2.5.2"><ci id="S3.E6.m1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1">𝑞</ci><ci id="S3.E6.m1.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2">𝐷</ci></interval></apply><ci id="S3.E6.m1.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.3">→</ci></apply></apply><ci id="S3.E6.m1.4.5.3.2.cmml" xref="S3.E6.m1.4.5.3.2">𝑞</ci><apply id="S3.E6.m1.4.5.3.3.cmml" xref="S3.E6.m1.4.5.3.3"><csymbol cd="ambiguous" id="S3.E6.m1.4.5.3.3.1.cmml" xref="S3.E6.m1.4.5.3.3">superscript</csymbol><ci id="S3.E6.m1.4.5.3.3.2.cmml" xref="S3.E6.m1.4.5.3.3.2">𝐷</ci><ci id="S3.E6.m1.4.5.3.3.3.cmml" xref="S3.E6.m1.4.5.3.3.3">𝑞</ci></apply></apply><apply id="S3.E6.m1.4.5.3c.cmml" xref="S3.E6.m1.4.5.3"><apply id="S3.E6.m1.4.4.cmml" xref="S3.E6.m1.4.4"><apply id="S3.E6.m1.4.4.3.cmml" xref="S3.E6.m1.4.4.3"><minus id="S3.E6.m1.4.4.3.1.cmml" xref="S3.E6.m1.4.4.3.1"></minus><apply id="S3.E6.m1.4.4.3.2.cmml" xref="S3.E6.m1.4.4.3.2"><times id="S3.E6.m1.4.4.3.2.1.cmml" xref="S3.E6.m1.4.4.3.2.1"></times><apply id="S3.E6.m1.4.4.3.2.2.cmml" xref="S3.E6.m1.4.4.3.2.2"><divide id="S3.E6.m1.4.4.3.2.2.1.cmml" xref="S3.E6.m1.4.4.3.2.2.1"></divide><apply id="S3.E6.m1.4.4.3.2.2.2.cmml" xref="S3.E6.m1.4.4.3.2.2.2"><times id="S3.E6.m1.4.4.3.2.2.2.1.cmml" xref="S3.E6.m1.4.4.3.2.2.2.1"></times><ci id="S3.E6.m1.4.4.3.2.2.2.2.cmml" xref="S3.E6.m1.4.4.3.2.2.2.2">𝑂</ci><ci id="S3.E6.m1.4.4.3.2.2.2.3.cmml" xref="S3.E6.m1.4.4.3.2.2.2.3">𝑝</ci><ci id="S3.E6.m1.4.4.3.2.2.2.4.cmml" xref="S3.E6.m1.4.4.3.2.2.2.4">𝑒</ci><ci id="S3.E6.m1.4.4.3.2.2.2.5.cmml" xref="S3.E6.m1.4.4.3.2.2.2.5">𝑛</ci><ci id="S3.E6.m1.4.4.3.2.2.2.6.cmml" xref="S3.E6.m1.4.4.3.2.2.2.6">𝐴</ci><ci id="S3.E6.m1.4.4.3.2.2.2.7.cmml" xref="S3.E6.m1.4.4.3.2.2.2.7">𝐼</ci></apply><ci id="S3.E6.m1.4.4.3.2.2.3.cmml" xref="S3.E6.m1.4.4.3.2.2.3">𝐺</ci></apply><ci id="S3.E6.m1.4.4.3.2.3.cmml" xref="S3.E6.m1.4.4.3.2.3">𝑃</ci><ci id="S3.E6.m1.4.4.3.2.4.cmml" xref="S3.E6.m1.4.4.3.2.4">𝑇</ci></apply><cn id="S3.E6.m1.4.4.3.3.cmml" type="integer" xref="S3.E6.m1.4.4.3.3">4</cn></apply><apply id="S3.E6.m1.4.4.2.cmml" xref="S3.E6.m1.4.4"><apply id="S3.E6.m1.4.4.2.2.cmml" xref="S3.E6.m1.4.4.2.2"><times id="S3.E6.m1.4.4.2.2.3.cmml" xref="S3.E6.m1.4.4.2.2.3"></times><ci id="S3.E6.m1.4.4.2.2.4.cmml" xref="S3.E6.m1.4.4.2.2.4">𝐿</ci><ci id="S3.E6.m1.4.4.2.2.5.cmml" xref="S3.E6.m1.4.4.2.2.5">𝐿</ci><ci id="S3.E6.m1.4.4.2.2.6.cmml" xref="S3.E6.m1.4.4.2.2.6">𝑀</ci><interval closure="closed" id="S3.E6.m1.4.4.2.2.2.1.1.2.cmml" xref="S3.E6.m1.4.4.2.2.2.1.1.1"><ci id="S3.E6.m1.3.3.1.1.1.cmml" xref="S3.E6.m1.3.3.1.1.1">𝑞</ci><apply id="S3.E6.m1.4.4.2.2.2.1.1.1.1.cmml" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.2.2.2.1.1.1.1.1.cmml" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1">superscript</csymbol><ci id="S3.E6.m1.4.4.2.2.2.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1.2">𝐷</ci><ci id="S3.E6.m1.4.4.2.2.2.1.1.1.1.3.cmml" xref="S3.E6.m1.4.4.2.2.2.1.1.1.1.3">𝑞</ci></apply></interval></apply><ci id="S3.E6.m1.4.4.2.3.cmml" xref="S3.E6.m1.4.4.2.3">→</ci></apply></apply><share href="https://arxiv.org/html/2407.21059v1#S3.E6.m1.4.5.3.3.cmml" id="S3.E6.m1.4.5.3d.cmml" xref="S3.E6.m1.4.5.3"></share><ci id="S3.E6.m1.4.5.3.4.cmml" xref="S3.E6.m1.4.5.3.4">𝑦</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.4c">NaiveRAG:q\xrightarrow[Text-Embedding]{R(q,D)}D^{q}\xrightarrow[OpenAI/GPT-4]{%
LLM([q,D^{q}])}y</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.4d">italic_N italic_a italic_i italic_v italic_e italic_R italic_A italic_G : italic_q start_ARROW start_UNDERACCENT italic_T italic_e italic_x italic_t - italic_E italic_m italic_b italic_e italic_d italic_d italic_i italic_n italic_g end_UNDERACCENT start_ARROW start_OVERACCENT italic_R ( italic_q , italic_D ) end_OVERACCENT → end_ARROW end_ARROW italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_ARROW start_UNDERACCENT italic_O italic_p italic_e italic_n italic_A italic_I / italic_G italic_P italic_T - 4 end_UNDERACCENT start_ARROW start_OVERACCENT italic_L italic_L italic_M ( [ italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ] ) end_OVERACCENT → end_ARROW end_ARROW italic_y</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">IV </span><span class="ltx_text ltx_font_smallcaps" id="S4.1.1">Module and Operator</span>
</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">This chapter will specifically introduce modules and operators under the Modular RAG framework. Based on the current stage of RAG development, we have established six main modules: Indexing, Pre-retrieval, Retrieval, Post-retrieval, Generation, and Orchestration.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS1.5.1.1">IV-A</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS1.6.2">Indexing</span>
</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">Indexing is the process of split document into manageable chunks and it is a key step in organizing a system. Indexing faces three main challenges.
<span class="ltx_text ltx_font_bold" id="S4.SS1.p1.1.1">1) Incomplete content representation</span>.The semantic information of chunks is influenced by the segmentation method, resulting in the loss or submergence of important information within longer contexts.
<span class="ltx_text ltx_font_bold" id="S4.SS1.p1.1.2">2) Inaccurate chunk similarity search</span>. As data volume increases, noise in retrieval grows, leading to frequent matching with erroneous data, making the retrieval system fragile and unreliable.
<span class="ltx_text ltx_font_bold" id="S4.SS1.p1.1.3">3) Unclear reference trajectory.</span> The retrieved chunks may originate from any document, devoid of citation trails, potentially resulting in the presence of chunks from multiple different documents that, despite being semantically similar, contain content on entirely different topics.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS1.SSS1.5.1.1">IV-A</span>1 </span>Chunk Optimization</h4>
<div class="ltx_para" id="S4.SS1.SSS1.p1">
<p class="ltx_p" id="S4.SS1.SSS1.p1.3">The size of the chunks and the overlap between the chunks play a crucial role in the overall effectiveness of the RAG system. Given a chunk <math alttext="d_{i}" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p1.1.m1.1"><semantics id="S4.SS1.SSS1.p1.1.m1.1a"><msub id="S4.SS1.SSS1.p1.1.m1.1.1" xref="S4.SS1.SSS1.p1.1.m1.1.1.cmml"><mi id="S4.SS1.SSS1.p1.1.m1.1.1.2" xref="S4.SS1.SSS1.p1.1.m1.1.1.2.cmml">d</mi><mi id="S4.SS1.SSS1.p1.1.m1.1.1.3" xref="S4.SS1.SSS1.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.1.m1.1b"><apply id="S4.SS1.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS1.SSS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.1.m1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS1.p1.1.m1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.1.m1.1.1.2">𝑑</ci><ci id="S4.SS1.SSS1.p1.1.m1.1.1.3.cmml" xref="S4.SS1.SSS1.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.1.m1.1c">d_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p1.1.m1.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, its chunk size is denoted as <math alttext="L_{i}=|d_{i}|" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p1.2.m2.1"><semantics id="S4.SS1.SSS1.p1.2.m2.1a"><mrow id="S4.SS1.SSS1.p1.2.m2.1.1" xref="S4.SS1.SSS1.p1.2.m2.1.1.cmml"><msub id="S4.SS1.SSS1.p1.2.m2.1.1.3" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.cmml"><mi id="S4.SS1.SSS1.p1.2.m2.1.1.3.2" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.2.cmml">L</mi><mi id="S4.SS1.SSS1.p1.2.m2.1.1.3.3" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.3.cmml">i</mi></msub><mo id="S4.SS1.SSS1.p1.2.m2.1.1.2" xref="S4.SS1.SSS1.p1.2.m2.1.1.2.cmml">=</mo><mrow id="S4.SS1.SSS1.p1.2.m2.1.1.1.1" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.2.cmml"><mo id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.2" stretchy="false" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.2.1.cmml">|</mo><msub id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.cmml"><mi id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.2" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.2.cmml">d</mi><mi id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.3" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.3" stretchy="false" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.2.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.2.m2.1b"><apply id="S4.SS1.SSS1.p1.2.m2.1.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1"><eq id="S4.SS1.SSS1.p1.2.m2.1.1.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.2"></eq><apply id="S4.SS1.SSS1.p1.2.m2.1.1.3.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.2.m2.1.1.3.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.3">subscript</csymbol><ci id="S4.SS1.SSS1.p1.2.m2.1.1.3.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.2">𝐿</ci><ci id="S4.SS1.SSS1.p1.2.m2.1.1.3.3.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.3">𝑖</ci></apply><apply id="S4.SS1.SSS1.p1.2.m2.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1"><abs id="S4.SS1.SSS1.p1.2.m2.1.1.1.2.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.2"></abs><apply id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.2">𝑑</ci><ci id="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.3.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.2.m2.1c">L_{i}=|d_{i}|</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p1.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = | italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT |</annotation></semantics></math>, and the overlap is denoted as <math alttext="L^{o}_{i}=|d_{i}\cap d_{i+1}|" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p1.3.m3.1"><semantics id="S4.SS1.SSS1.p1.3.m3.1a"><mrow id="S4.SS1.SSS1.p1.3.m3.1.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.cmml"><msubsup id="S4.SS1.SSS1.p1.3.m3.1.1.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.cmml"><mi id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.2.2.cmml">L</mi><mi id="S4.SS1.SSS1.p1.3.m3.1.1.3.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.3.cmml">i</mi><mi id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.2.3.cmml">o</mi></msubsup><mo id="S4.SS1.SSS1.p1.3.m3.1.1.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.2.cmml">=</mo><mrow id="S4.SS1.SSS1.p1.3.m3.1.1.1.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.2.cmml"><mo id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.2" stretchy="false" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.2.1.cmml">|</mo><mrow id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.cmml"><msub id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.cmml"><mi id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.2.cmml">d</mi><mi id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.3.cmml">i</mi></msub><mo id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.1.cmml">∩</mo><msub id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.cmml"><mi id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.2.cmml">d</mi><mrow id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.cmml"><mi id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.2" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.1.cmml">+</mo><mn id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.3" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></msub></mrow><mo id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.3" stretchy="false" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.2.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.3.m3.1b"><apply id="S4.SS1.SSS1.p1.3.m3.1.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1"><eq id="S4.SS1.SSS1.p1.3.m3.1.1.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.2"></eq><apply id="S4.SS1.SSS1.p1.3.m3.1.1.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.3.m3.1.1.3.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3">subscript</csymbol><apply id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3">superscript</csymbol><ci id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.2.2">𝐿</ci><ci id="S4.SS1.SSS1.p1.3.m3.1.1.3.2.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.2.3">𝑜</ci></apply><ci id="S4.SS1.SSS1.p1.3.m3.1.1.3.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.3.3">𝑖</ci></apply><apply id="S4.SS1.SSS1.p1.3.m3.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1"><abs id="S4.SS1.SSS1.p1.3.m3.1.1.1.2.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.2"></abs><apply id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1"><intersect id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.1"></intersect><apply id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2">subscript</csymbol><ci id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.2">𝑑</ci><ci id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3">subscript</csymbol><ci id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.2">𝑑</ci><apply id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3"><plus id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.1"></plus><ci id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.2.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.2">𝑖</ci><cn id="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.3.cmml" type="integer" xref="S4.SS1.SSS1.p1.3.m3.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.3.m3.1c">L^{o}_{i}=|d_{i}\cap d_{i+1}|</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p1.3.m3.1d">italic_L start_POSTSUPERSCRIPT italic_o end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = | italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∩ italic_d start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT |</annotation></semantics></math>. Larger chunks can capture more context, but they also generate more noise, requiring longer processing time and higher costs. While smaller chunks may not fully convey the necessary context, they do have less noise <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib17" title="">17</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p2">
<p class="ltx_p" id="S4.SS1.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS1.p2.1.1">Sliding Window</span> using overlapping chunks in a sliding window enhances semantic transitions. However, it has limitations such as imprecise context size control, potential truncation of words or sentences, and lacking semantic considerations.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p3">
<p class="ltx_p" id="S4.SS1.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS1.p3.1.1">Metadata Attachment.</span> Chunks can be enriched with metadata like page number, file name, author, timestamp, summary, or relevant questions. This metadata allows for filtered retrieval, narrowing the search scope.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p4">
<p class="ltx_p" id="S4.SS1.SSS1.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS1.p4.1.1">Small-to-Big <cite class="ltx_cite ltx_citemacro_cite"><span class="ltx_text ltx_font_medium" id="S4.SS1.SSS1.p4.1.1.1.1">[</span><a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib33" title="">33</a><span class="ltx_text ltx_font_medium" id="S4.SS1.SSS1.p4.1.1.2.2">]</span></cite></span> separate the chunks used for retrieval from those used for synthesis. Smaller chunks enhance retrieval accuracy, while larger chunks provide more context. One approach is to retrieve smaller summarized chunks and reference their parent larger chunks. Alternatively, individual sentences could be retrieved along with their surrounding text.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS1.SSS2.5.1.1">IV-A</span>2 </span>Structure Organization</h4>
<div class="ltx_para" id="S4.SS1.SSS2.p1">
<p class="ltx_p" id="S4.SS1.SSS2.p1.1">One effective method for enhancing information retrieval is to establish a hierarchical structure for the documents. By constructing chunks structure, RAG system can expedite the retrieval and processing of pertinent data.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p2">
<p class="ltx_p" id="S4.SS1.SSS2.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS2.p2.1.1">Hierarchical Index</span>. In the hierarchical structure of documents, nodes are arranged in parent-child relationships, with chunks linked to them. Data summaries are stored at each node, aiding in the swift traversal of data and assisting the RAG system in determining which chunks to extract. This approach can also mitigate the illusion caused by chunk extraction issues. The methods for constructing a structured index primarily include: 1) Structural awareness based on paragraph and sentence segmentation in docs. 2) Content awareness based on inherent structure in PDF, HTML, and Latex. 3) Semantic awareness based on semantic recognition and segmentation of text.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p3">
<p class="ltx_p" id="S4.SS1.SSS2.p3.4"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS2.p3.4.1">KG Index</span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib34" title="">34</a>]</cite>. Using Knowledge Graphs (KGs) to structure documents helps maintain consistency by clarifying connections between concepts and entities, reducing the risk of mismatch errors. KGs also transform information retrieval into instructions intelligible to language models, improving retrieval accuracy and enabling contextually coherent responses. This enhances the overall efficiency of the RAG system. For example, organizing a corpus in the format of graph <math alttext="G=\{\mathcal{V},\mathcal{E},\mathcal{X}\}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.1.m1.3"><semantics id="S4.SS1.SSS2.p3.1.m1.3a"><mrow id="S4.SS1.SSS2.p3.1.m1.3.4" xref="S4.SS1.SSS2.p3.1.m1.3.4.cmml"><mi id="S4.SS1.SSS2.p3.1.m1.3.4.2" xref="S4.SS1.SSS2.p3.1.m1.3.4.2.cmml">G</mi><mo id="S4.SS1.SSS2.p3.1.m1.3.4.1" xref="S4.SS1.SSS2.p3.1.m1.3.4.1.cmml">=</mo><mrow id="S4.SS1.SSS2.p3.1.m1.3.4.3.2" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml"><mo id="S4.SS1.SSS2.p3.1.m1.3.4.3.2.1" stretchy="false" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml">{</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.1.m1.1.1" xref="S4.SS1.SSS2.p3.1.m1.1.1.cmml">𝒱</mi><mo id="S4.SS1.SSS2.p3.1.m1.3.4.3.2.2" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.1.m1.2.2" xref="S4.SS1.SSS2.p3.1.m1.2.2.cmml">ℰ</mi><mo id="S4.SS1.SSS2.p3.1.m1.3.4.3.2.3" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.1.m1.3.3" xref="S4.SS1.SSS2.p3.1.m1.3.3.cmml">𝒳</mi><mo id="S4.SS1.SSS2.p3.1.m1.3.4.3.2.4" stretchy="false" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.1.m1.3b"><apply id="S4.SS1.SSS2.p3.1.m1.3.4.cmml" xref="S4.SS1.SSS2.p3.1.m1.3.4"><eq id="S4.SS1.SSS2.p3.1.m1.3.4.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.3.4.1"></eq><ci id="S4.SS1.SSS2.p3.1.m1.3.4.2.cmml" xref="S4.SS1.SSS2.p3.1.m1.3.4.2">𝐺</ci><set id="S4.SS1.SSS2.p3.1.m1.3.4.3.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.3.4.3.2"><ci id="S4.SS1.SSS2.p3.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1">𝒱</ci><ci id="S4.SS1.SSS2.p3.1.m1.2.2.cmml" xref="S4.SS1.SSS2.p3.1.m1.2.2">ℰ</ci><ci id="S4.SS1.SSS2.p3.1.m1.3.3.cmml" xref="S4.SS1.SSS2.p3.1.m1.3.3">𝒳</ci></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.1.m1.3c">G=\{\mathcal{V},\mathcal{E},\mathcal{X}\}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.1.m1.3d">italic_G = { caligraphic_V , caligraphic_E , caligraphic_X }</annotation></semantics></math>, where node <math alttext="V=\{v_{i}\}^{n}_{i=1}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.2.m2.1"><semantics id="S4.SS1.SSS2.p3.2.m2.1a"><mrow id="S4.SS1.SSS2.p3.2.m2.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.cmml"><mi id="S4.SS1.SSS2.p3.2.m2.1.1.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.3.cmml">V</mi><mo id="S4.SS1.SSS2.p3.2.m2.1.1.2" xref="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml">=</mo><msubsup id="S4.SS1.SSS2.p3.2.m2.1.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.cmml"><mrow id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.2.cmml"><mo id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.2" stretchy="false" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.2.cmml">{</mo><msub id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.cmml"><mi id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.2" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.2.cmml">v</mi><mi id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.3" stretchy="false" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S4.SS1.SSS2.p3.2.m2.1.1.1.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.cmml"><mi id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.2" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.2.cmml">i</mi><mo id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.1.cmml">=</mo><mn id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.3.cmml">1</mn></mrow><mi id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.3.cmml">n</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.2.m2.1b"><apply id="S4.SS1.SSS2.p3.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1"><eq id="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.2"></eq><ci id="S4.SS1.SSS2.p3.2.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.3">𝑉</ci><apply id="S4.SS1.SSS2.p3.2.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.2.m2.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1">subscript</csymbol><apply id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1">superscript</csymbol><set id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1"><apply id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.2">𝑣</ci><ci id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.1.1.1.3">𝑖</ci></apply></set><ci id="S4.SS1.SSS2.p3.2.m2.1.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.1.3">𝑛</ci></apply><apply id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3"><eq id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.1"></eq><ci id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.2">𝑖</ci><cn id="S4.SS1.SSS2.p3.2.m2.1.1.1.3.3.cmml" type="integer" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.2.m2.1c">V=\{v_{i}\}^{n}_{i=1}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.2.m2.1d">italic_V = { italic_v start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT } start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT</annotation></semantics></math> represent document structures (e.g.passage, pages, table) , edge <math alttext="\mathcal{E}\subset\mathcal{V}\times\mathcal{V}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.3.m3.1"><semantics id="S4.SS1.SSS2.p3.3.m3.1a"><mrow id="S4.SS1.SSS2.p3.3.m3.1.1" xref="S4.SS1.SSS2.p3.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.3.m3.1.1.2" xref="S4.SS1.SSS2.p3.3.m3.1.1.2.cmml">ℰ</mi><mo id="S4.SS1.SSS2.p3.3.m3.1.1.1" xref="S4.SS1.SSS2.p3.3.m3.1.1.1.cmml">⊂</mo><mrow id="S4.SS1.SSS2.p3.3.m3.1.1.3" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.3.m3.1.1.3.2" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.2.cmml">𝒱</mi><mo id="S4.SS1.SSS2.p3.3.m3.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.1.cmml">×</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.3.m3.1.1.3.3" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.3.cmml">𝒱</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.3.m3.1b"><apply id="S4.SS1.SSS2.p3.3.m3.1.1.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1"><subset id="S4.SS1.SSS2.p3.3.m3.1.1.1.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.1"></subset><ci id="S4.SS1.SSS2.p3.3.m3.1.1.2.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.2">ℰ</ci><apply id="S4.SS1.SSS2.p3.3.m3.1.1.3.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.3"><times id="S4.SS1.SSS2.p3.3.m3.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.1"></times><ci id="S4.SS1.SSS2.p3.3.m3.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.2">𝒱</ci><ci id="S4.SS1.SSS2.p3.3.m3.1.1.3.3.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.3">𝒱</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.3.m3.1c">\mathcal{E}\subset\mathcal{V}\times\mathcal{V}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.3.m3.1d">caligraphic_E ⊂ caligraphic_V × caligraphic_V</annotation></semantics></math> represent semantic or lexical similarity and belonging relations, and node features <math alttext="\mathcal{X}=\{\mathcal{X}_{i}\}^{n}_{i=1}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.4.m4.1"><semantics id="S4.SS1.SSS2.p3.4.m4.1a"><mrow id="S4.SS1.SSS2.p3.4.m4.1.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.4.m4.1.1.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.3.cmml">𝒳</mi><mo id="S4.SS1.SSS2.p3.4.m4.1.1.2" xref="S4.SS1.SSS2.p3.4.m4.1.1.2.cmml">=</mo><msubsup id="S4.SS1.SSS2.p3.4.m4.1.1.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.cmml"><mrow id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.2.cmml"><mo id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.2" stretchy="false" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.2.cmml">{</mo><msub id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.2" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.2.cmml">𝒳</mi><mi id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.3" stretchy="false" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S4.SS1.SSS2.p3.4.m4.1.1.1.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.cmml"><mi id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.2" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.2.cmml">i</mi><mo id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.1.cmml">=</mo><mn id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.3.cmml">1</mn></mrow><mi id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.3.cmml">n</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.4.m4.1b"><apply id="S4.SS1.SSS2.p3.4.m4.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1"><eq id="S4.SS1.SSS2.p3.4.m4.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.2"></eq><ci id="S4.SS1.SSS2.p3.4.m4.1.1.3.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.3">𝒳</ci><apply id="S4.SS1.SSS2.p3.4.m4.1.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.4.m4.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1">subscript</csymbol><apply id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1">superscript</csymbol><set id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1"><apply id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.2">𝒳</ci><ci id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.1.1.1.3">𝑖</ci></apply></set><ci id="S4.SS1.SSS2.p3.4.m4.1.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.1.3">𝑛</ci></apply><apply id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3"><eq id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.1"></eq><ci id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.2">𝑖</ci><cn id="S4.SS1.SSS2.p3.4.m4.1.1.1.3.3.cmml" type="integer" xref="S4.SS1.SSS2.p3.4.m4.1.1.1.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.4.m4.1c">\mathcal{X}=\{\mathcal{X}_{i}\}^{n}_{i=1}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.4.m4.1d">caligraphic_X = { caligraphic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT } start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT</annotation></semantics></math> represent text or markdown content for passage.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS2.5.1.1">IV-B</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS2.6.2">Pre-retrieval</span>
</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">One of the primary challenges with Naive RAG is its direct reliance on the user’s original query as the basis for retrieval. Formulating a precise and clear question is difficult, and imprudent queries result in subpar retrieval effectiveness. The primary challenges in this module include: <span class="ltx_text ltx_font_bold" id="S4.SS2.p1.1.1">1) Poorly worded queries</span>. The question itself is complex, and the language is not well-organized. <span class="ltx_text ltx_font_bold" id="S4.SS2.p1.1.2">2) Language complexity and ambiguity.</span> Language models often struggle when dealing with specialized vocabulary or ambiguous abbreviations with multiple meanings. For instance, they may not discern whether <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.1.3">LLM</span> refers to <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.1.4">Large Language Model</span> or a <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.1.5">Master of Laws</span> in a legal context.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS2.SSS1.5.1.1">IV-B</span>1 </span>Query Expansion </h4>
<div class="ltx_para" id="S4.SS2.SSS1.p1">
<p class="ltx_p" id="S4.SS2.SSS1.p1.1">Expanding a single query into multiple queries enriches the content of the query, providing further context to address any lack of specific nuances, thereby ensuring the optimal relevance of the generated answers.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f_{qe}(q)=\{q_{1},q_{2},\ldots,q_{n}\}\quad\forall q_{i}\in\{q_{1},q_{2},%
\ldots,q_{n}\},q_{i}\notin Q" class="ltx_Math" display="block" id="S4.E7.m1.5"><semantics id="S4.E7.m1.5a"><mrow id="S4.E7.m1.5.5.2" xref="S4.E7.m1.5.5.3.cmml"><mrow id="S4.E7.m1.4.4.1.1" xref="S4.E7.m1.4.4.1.1.cmml"><mrow id="S4.E7.m1.4.4.1.1.5" xref="S4.E7.m1.4.4.1.1.5.cmml"><msub id="S4.E7.m1.4.4.1.1.5.2" xref="S4.E7.m1.4.4.1.1.5.2.cmml"><mi id="S4.E7.m1.4.4.1.1.5.2.2" xref="S4.E7.m1.4.4.1.1.5.2.2.cmml">f</mi><mrow id="S4.E7.m1.4.4.1.1.5.2.3" xref="S4.E7.m1.4.4.1.1.5.2.3.cmml"><mi id="S4.E7.m1.4.4.1.1.5.2.3.2" xref="S4.E7.m1.4.4.1.1.5.2.3.2.cmml">q</mi><mo id="S4.E7.m1.4.4.1.1.5.2.3.1" xref="S4.E7.m1.4.4.1.1.5.2.3.1.cmml">⁢</mo><mi id="S4.E7.m1.4.4.1.1.5.2.3.3" xref="S4.E7.m1.4.4.1.1.5.2.3.3.cmml">e</mi></mrow></msub><mo id="S4.E7.m1.4.4.1.1.5.1" xref="S4.E7.m1.4.4.1.1.5.1.cmml">⁢</mo><mrow id="S4.E7.m1.4.4.1.1.5.3.2" xref="S4.E7.m1.4.4.1.1.5.cmml"><mo id="S4.E7.m1.4.4.1.1.5.3.2.1" stretchy="false" xref="S4.E7.m1.4.4.1.1.5.cmml">(</mo><mi id="S4.E7.m1.1.1" xref="S4.E7.m1.1.1.cmml">q</mi><mo id="S4.E7.m1.4.4.1.1.5.3.2.2" stretchy="false" xref="S4.E7.m1.4.4.1.1.5.cmml">)</mo></mrow></mrow><mo id="S4.E7.m1.4.4.1.1.4" xref="S4.E7.m1.4.4.1.1.4.cmml">=</mo><mrow id="S4.E7.m1.4.4.1.1.3.3" xref="S4.E7.m1.4.4.1.1.3.4.cmml"><mo id="S4.E7.m1.4.4.1.1.3.3.4" stretchy="false" xref="S4.E7.m1.4.4.1.1.3.4.cmml">{</mo><msub id="S4.E7.m1.4.4.1.1.1.1.1" xref="S4.E7.m1.4.4.1.1.1.1.1.cmml"><mi id="S4.E7.m1.4.4.1.1.1.1.1.2" xref="S4.E7.m1.4.4.1.1.1.1.1.2.cmml">q</mi><mn id="S4.E7.m1.4.4.1.1.1.1.1.3" xref="S4.E7.m1.4.4.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S4.E7.m1.4.4.1.1.3.3.5" xref="S4.E7.m1.4.4.1.1.3.4.cmml">,</mo><msub id="S4.E7.m1.4.4.1.1.2.2.2" xref="S4.E7.m1.4.4.1.1.2.2.2.cmml"><mi id="S4.E7.m1.4.4.1.1.2.2.2.2" xref="S4.E7.m1.4.4.1.1.2.2.2.2.cmml">q</mi><mn id="S4.E7.m1.4.4.1.1.2.2.2.3" xref="S4.E7.m1.4.4.1.1.2.2.2.3.cmml">2</mn></msub><mo id="S4.E7.m1.4.4.1.1.3.3.6" xref="S4.E7.m1.4.4.1.1.3.4.cmml">,</mo><mi id="S4.E7.m1.2.2" mathvariant="normal" xref="S4.E7.m1.2.2.cmml">…</mi><mo id="S4.E7.m1.4.4.1.1.3.3.7" xref="S4.E7.m1.4.4.1.1.3.4.cmml">,</mo><msub id="S4.E7.m1.4.4.1.1.3.3.3" xref="S4.E7.m1.4.4.1.1.3.3.3.cmml"><mi id="S4.E7.m1.4.4.1.1.3.3.3.2" xref="S4.E7.m1.4.4.1.1.3.3.3.2.cmml">q</mi><mi id="S4.E7.m1.4.4.1.1.3.3.3.3" xref="S4.E7.m1.4.4.1.1.3.3.3.3.cmml">n</mi></msub><mo id="S4.E7.m1.4.4.1.1.3.3.8" stretchy="false" xref="S4.E7.m1.4.4.1.1.3.4.cmml">}</mo></mrow></mrow><mspace id="S4.E7.m1.5.5.2.3" width="1.167em" xref="S4.E7.m1.5.5.3a.cmml"></mspace><mrow id="S4.E7.m1.5.5.2.2.2" xref="S4.E7.m1.5.5.2.2.3.cmml"><mrow id="S4.E7.m1.5.5.2.2.1.1" xref="S4.E7.m1.5.5.2.2.1.1.cmml"><mrow id="S4.E7.m1.5.5.2.2.1.1.5" xref="S4.E7.m1.5.5.2.2.1.1.5.cmml"><mo id="S4.E7.m1.5.5.2.2.1.1.5.1" rspace="0.167em" xref="S4.E7.m1.5.5.2.2.1.1.5.1.cmml">∀</mo><msub id="S4.E7.m1.5.5.2.2.1.1.5.2" xref="S4.E7.m1.5.5.2.2.1.1.5.2.cmml"><mi id="S4.E7.m1.5.5.2.2.1.1.5.2.2" xref="S4.E7.m1.5.5.2.2.1.1.5.2.2.cmml">q</mi><mi id="S4.E7.m1.5.5.2.2.1.1.5.2.3" xref="S4.E7.m1.5.5.2.2.1.1.5.2.3.cmml">i</mi></msub></mrow><mo id="S4.E7.m1.5.5.2.2.1.1.4" xref="S4.E7.m1.5.5.2.2.1.1.4.cmml">∈</mo><mrow id="S4.E7.m1.5.5.2.2.1.1.3.3" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml"><mo id="S4.E7.m1.5.5.2.2.1.1.3.3.4" stretchy="false" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml">{</mo><msub id="S4.E7.m1.5.5.2.2.1.1.1.1.1" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1.cmml"><mi id="S4.E7.m1.5.5.2.2.1.1.1.1.1.2" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1.2.cmml">q</mi><mn id="S4.E7.m1.5.5.2.2.1.1.1.1.1.3" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S4.E7.m1.5.5.2.2.1.1.3.3.5" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml">,</mo><msub id="S4.E7.m1.5.5.2.2.1.1.2.2.2" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2.cmml"><mi id="S4.E7.m1.5.5.2.2.1.1.2.2.2.2" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2.2.cmml">q</mi><mn id="S4.E7.m1.5.5.2.2.1.1.2.2.2.3" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2.3.cmml">2</mn></msub><mo id="S4.E7.m1.5.5.2.2.1.1.3.3.6" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml">,</mo><mi id="S4.E7.m1.3.3" mathvariant="normal" xref="S4.E7.m1.3.3.cmml">…</mi><mo id="S4.E7.m1.5.5.2.2.1.1.3.3.7" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml">,</mo><msub id="S4.E7.m1.5.5.2.2.1.1.3.3.3" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3.cmml"><mi id="S4.E7.m1.5.5.2.2.1.1.3.3.3.2" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3.2.cmml">q</mi><mi id="S4.E7.m1.5.5.2.2.1.1.3.3.3.3" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3.3.cmml">n</mi></msub><mo id="S4.E7.m1.5.5.2.2.1.1.3.3.8" stretchy="false" xref="S4.E7.m1.5.5.2.2.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S4.E7.m1.5.5.2.2.2.3" xref="S4.E7.m1.5.5.2.2.3a.cmml">,</mo><mrow id="S4.E7.m1.5.5.2.2.2.2" xref="S4.E7.m1.5.5.2.2.2.2.cmml"><msub id="S4.E7.m1.5.5.2.2.2.2.2" xref="S4.E7.m1.5.5.2.2.2.2.2.cmml"><mi id="S4.E7.m1.5.5.2.2.2.2.2.2" xref="S4.E7.m1.5.5.2.2.2.2.2.2.cmml">q</mi><mi id="S4.E7.m1.5.5.2.2.2.2.2.3" xref="S4.E7.m1.5.5.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S4.E7.m1.5.5.2.2.2.2.1" xref="S4.E7.m1.5.5.2.2.2.2.1.cmml">∉</mo><mi id="S4.E7.m1.5.5.2.2.2.2.3" xref="S4.E7.m1.5.5.2.2.2.2.3.cmml">Q</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E7.m1.5b"><apply id="S4.E7.m1.5.5.3.cmml" xref="S4.E7.m1.5.5.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.3a.cmml" xref="S4.E7.m1.5.5.2.3">formulae-sequence</csymbol><apply id="S4.E7.m1.4.4.1.1.cmml" xref="S4.E7.m1.4.4.1.1"><eq id="S4.E7.m1.4.4.1.1.4.cmml" xref="S4.E7.m1.4.4.1.1.4"></eq><apply id="S4.E7.m1.4.4.1.1.5.cmml" xref="S4.E7.m1.4.4.1.1.5"><times id="S4.E7.m1.4.4.1.1.5.1.cmml" xref="S4.E7.m1.4.4.1.1.5.1"></times><apply id="S4.E7.m1.4.4.1.1.5.2.cmml" xref="S4.E7.m1.4.4.1.1.5.2"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.1.5.2.1.cmml" xref="S4.E7.m1.4.4.1.1.5.2">subscript</csymbol><ci id="S4.E7.m1.4.4.1.1.5.2.2.cmml" xref="S4.E7.m1.4.4.1.1.5.2.2">𝑓</ci><apply id="S4.E7.m1.4.4.1.1.5.2.3.cmml" xref="S4.E7.m1.4.4.1.1.5.2.3"><times id="S4.E7.m1.4.4.1.1.5.2.3.1.cmml" xref="S4.E7.m1.4.4.1.1.5.2.3.1"></times><ci id="S4.E7.m1.4.4.1.1.5.2.3.2.cmml" xref="S4.E7.m1.4.4.1.1.5.2.3.2">𝑞</ci><ci id="S4.E7.m1.4.4.1.1.5.2.3.3.cmml" xref="S4.E7.m1.4.4.1.1.5.2.3.3">𝑒</ci></apply></apply><ci id="S4.E7.m1.1.1.cmml" xref="S4.E7.m1.1.1">𝑞</ci></apply><set id="S4.E7.m1.4.4.1.1.3.4.cmml" xref="S4.E7.m1.4.4.1.1.3.3"><apply id="S4.E7.m1.4.4.1.1.1.1.1.cmml" xref="S4.E7.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.1.1.1.1.1.cmml" xref="S4.E7.m1.4.4.1.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.4.4.1.1.1.1.1.2.cmml" xref="S4.E7.m1.4.4.1.1.1.1.1.2">𝑞</ci><cn id="S4.E7.m1.4.4.1.1.1.1.1.3.cmml" type="integer" xref="S4.E7.m1.4.4.1.1.1.1.1.3">1</cn></apply><apply id="S4.E7.m1.4.4.1.1.2.2.2.cmml" xref="S4.E7.m1.4.4.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.1.2.2.2.1.cmml" xref="S4.E7.m1.4.4.1.1.2.2.2">subscript</csymbol><ci id="S4.E7.m1.4.4.1.1.2.2.2.2.cmml" xref="S4.E7.m1.4.4.1.1.2.2.2.2">𝑞</ci><cn id="S4.E7.m1.4.4.1.1.2.2.2.3.cmml" type="integer" xref="S4.E7.m1.4.4.1.1.2.2.2.3">2</cn></apply><ci id="S4.E7.m1.2.2.cmml" xref="S4.E7.m1.2.2">…</ci><apply id="S4.E7.m1.4.4.1.1.3.3.3.cmml" xref="S4.E7.m1.4.4.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.1.3.3.3.1.cmml" xref="S4.E7.m1.4.4.1.1.3.3.3">subscript</csymbol><ci id="S4.E7.m1.4.4.1.1.3.3.3.2.cmml" xref="S4.E7.m1.4.4.1.1.3.3.3.2">𝑞</ci><ci id="S4.E7.m1.4.4.1.1.3.3.3.3.cmml" xref="S4.E7.m1.4.4.1.1.3.3.3.3">𝑛</ci></apply></set></apply><apply id="S4.E7.m1.5.5.2.2.3.cmml" xref="S4.E7.m1.5.5.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.3a.cmml" xref="S4.E7.m1.5.5.2.2.2.3">formulae-sequence</csymbol><apply id="S4.E7.m1.5.5.2.2.1.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1"><in id="S4.E7.m1.5.5.2.2.1.1.4.cmml" xref="S4.E7.m1.5.5.2.2.1.1.4"></in><apply id="S4.E7.m1.5.5.2.2.1.1.5.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5"><csymbol cd="latexml" id="S4.E7.m1.5.5.2.2.1.1.5.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5.1">for-all</csymbol><apply id="S4.E7.m1.5.5.2.2.1.1.5.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.1.1.5.2.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5.2">subscript</csymbol><ci id="S4.E7.m1.5.5.2.2.1.1.5.2.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5.2.2">𝑞</ci><ci id="S4.E7.m1.5.5.2.2.1.1.5.2.3.cmml" xref="S4.E7.m1.5.5.2.2.1.1.5.2.3">𝑖</ci></apply></apply><set id="S4.E7.m1.5.5.2.2.1.1.3.4.cmml" xref="S4.E7.m1.5.5.2.2.1.1.3.3"><apply id="S4.E7.m1.5.5.2.2.1.1.1.1.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.1.1.1.1.1.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.5.5.2.2.1.1.1.1.1.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1.2">𝑞</ci><cn id="S4.E7.m1.5.5.2.2.1.1.1.1.1.3.cmml" type="integer" xref="S4.E7.m1.5.5.2.2.1.1.1.1.1.3">1</cn></apply><apply id="S4.E7.m1.5.5.2.2.1.1.2.2.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.1.1.2.2.2.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2">subscript</csymbol><ci id="S4.E7.m1.5.5.2.2.1.1.2.2.2.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2.2">𝑞</ci><cn id="S4.E7.m1.5.5.2.2.1.1.2.2.2.3.cmml" type="integer" xref="S4.E7.m1.5.5.2.2.1.1.2.2.2.3">2</cn></apply><ci id="S4.E7.m1.3.3.cmml" xref="S4.E7.m1.3.3">…</ci><apply id="S4.E7.m1.5.5.2.2.1.1.3.3.3.cmml" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.1.1.3.3.3.1.cmml" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3">subscript</csymbol><ci id="S4.E7.m1.5.5.2.2.1.1.3.3.3.2.cmml" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3.2">𝑞</ci><ci id="S4.E7.m1.5.5.2.2.1.1.3.3.3.3.cmml" xref="S4.E7.m1.5.5.2.2.1.1.3.3.3.3">𝑛</ci></apply></set></apply><apply id="S4.E7.m1.5.5.2.2.2.2.cmml" xref="S4.E7.m1.5.5.2.2.2.2"><notin id="S4.E7.m1.5.5.2.2.2.2.1.cmml" xref="S4.E7.m1.5.5.2.2.2.2.1"></notin><apply id="S4.E7.m1.5.5.2.2.2.2.2.cmml" xref="S4.E7.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.2.2.2.2.1.cmml" xref="S4.E7.m1.5.5.2.2.2.2.2">subscript</csymbol><ci id="S4.E7.m1.5.5.2.2.2.2.2.2.cmml" xref="S4.E7.m1.5.5.2.2.2.2.2.2">𝑞</ci><ci id="S4.E7.m1.5.5.2.2.2.2.2.3.cmml" xref="S4.E7.m1.5.5.2.2.2.2.2.3">𝑖</ci></apply><ci id="S4.E7.m1.5.5.2.2.2.2.3.cmml" xref="S4.E7.m1.5.5.2.2.2.2.3">𝑄</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E7.m1.5c">f_{qe}(q)=\{q_{1},q_{2},\ldots,q_{n}\}\quad\forall q_{i}\in\{q_{1},q_{2},%
\ldots,q_{n}\},q_{i}\notin Q</annotation><annotation encoding="application/x-llamapun" id="S4.E7.m1.5d">italic_f start_POSTSUBSCRIPT italic_q italic_e end_POSTSUBSCRIPT ( italic_q ) = { italic_q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_q start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT } ∀ italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ { italic_q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_q start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT } , italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∉ italic_Q</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S4.SS2.SSS1.p2">
<p class="ltx_p" id="S4.SS2.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.SSS1.p2.1.1">Multi-Query</span> uses prompt engineering to expand queries via LLMs, allowing for parallel execution. These expansions are meticulously designed to ensure diversity and coverage. However, this approach can dilute the user’s original intent. To mitigate this, the model can be instructed to assign greater weight to the original query.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS1.p3">
<p class="ltx_p" id="S4.SS2.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.SSS1.p3.1.1">Sub-Query</span>. By decomposing and planning for complex problems, multiple sub-problems are generated. Specifically, least-to-most prompting <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib35" title="">35</a>]</cite> can be employed to decompose the complex problem into a series of simpler sub-problems. Depending on the structure of the original problem, the generated sub-problems can be executed in parallel or sequentially. Another approach  involves the use of the Chain-of-Verification (CoVe) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib36" title="">36</a>]</cite>. The expanded queries undergo validation by LLM to achieve the effect of reducing hallucinations.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS2.SSS2.5.1.1">IV-B</span>2 </span>Query Transformation</h4>
<div class="ltx_para" id="S4.SS2.SSS2.p1">
<p class="ltx_p" id="S4.SS2.SSS2.p1.1">Retrieve and generate based on a transformed query instead of the user’s original query.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f_{qt}(q)=q^{\prime}" class="ltx_Math" display="block" id="S4.E8.m1.1"><semantics id="S4.E8.m1.1a"><mrow id="S4.E8.m1.1.2" xref="S4.E8.m1.1.2.cmml"><mrow id="S4.E8.m1.1.2.2" xref="S4.E8.m1.1.2.2.cmml"><msub id="S4.E8.m1.1.2.2.2" xref="S4.E8.m1.1.2.2.2.cmml"><mi id="S4.E8.m1.1.2.2.2.2" xref="S4.E8.m1.1.2.2.2.2.cmml">f</mi><mrow id="S4.E8.m1.1.2.2.2.3" xref="S4.E8.m1.1.2.2.2.3.cmml"><mi id="S4.E8.m1.1.2.2.2.3.2" xref="S4.E8.m1.1.2.2.2.3.2.cmml">q</mi><mo id="S4.E8.m1.1.2.2.2.3.1" xref="S4.E8.m1.1.2.2.2.3.1.cmml">⁢</mo><mi id="S4.E8.m1.1.2.2.2.3.3" xref="S4.E8.m1.1.2.2.2.3.3.cmml">t</mi></mrow></msub><mo id="S4.E8.m1.1.2.2.1" xref="S4.E8.m1.1.2.2.1.cmml">⁢</mo><mrow id="S4.E8.m1.1.2.2.3.2" xref="S4.E8.m1.1.2.2.cmml"><mo id="S4.E8.m1.1.2.2.3.2.1" stretchy="false" xref="S4.E8.m1.1.2.2.cmml">(</mo><mi id="S4.E8.m1.1.1" xref="S4.E8.m1.1.1.cmml">q</mi><mo id="S4.E8.m1.1.2.2.3.2.2" stretchy="false" xref="S4.E8.m1.1.2.2.cmml">)</mo></mrow></mrow><mo id="S4.E8.m1.1.2.1" xref="S4.E8.m1.1.2.1.cmml">=</mo><msup id="S4.E8.m1.1.2.3" xref="S4.E8.m1.1.2.3.cmml"><mi id="S4.E8.m1.1.2.3.2" xref="S4.E8.m1.1.2.3.2.cmml">q</mi><mo id="S4.E8.m1.1.2.3.3" xref="S4.E8.m1.1.2.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.E8.m1.1b"><apply id="S4.E8.m1.1.2.cmml" xref="S4.E8.m1.1.2"><eq id="S4.E8.m1.1.2.1.cmml" xref="S4.E8.m1.1.2.1"></eq><apply id="S4.E8.m1.1.2.2.cmml" xref="S4.E8.m1.1.2.2"><times id="S4.E8.m1.1.2.2.1.cmml" xref="S4.E8.m1.1.2.2.1"></times><apply id="S4.E8.m1.1.2.2.2.cmml" xref="S4.E8.m1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E8.m1.1.2.2.2.1.cmml" xref="S4.E8.m1.1.2.2.2">subscript</csymbol><ci id="S4.E8.m1.1.2.2.2.2.cmml" xref="S4.E8.m1.1.2.2.2.2">𝑓</ci><apply id="S4.E8.m1.1.2.2.2.3.cmml" xref="S4.E8.m1.1.2.2.2.3"><times id="S4.E8.m1.1.2.2.2.3.1.cmml" xref="S4.E8.m1.1.2.2.2.3.1"></times><ci id="S4.E8.m1.1.2.2.2.3.2.cmml" xref="S4.E8.m1.1.2.2.2.3.2">𝑞</ci><ci id="S4.E8.m1.1.2.2.2.3.3.cmml" xref="S4.E8.m1.1.2.2.2.3.3">𝑡</ci></apply></apply><ci id="S4.E8.m1.1.1.cmml" xref="S4.E8.m1.1.1">𝑞</ci></apply><apply id="S4.E8.m1.1.2.3.cmml" xref="S4.E8.m1.1.2.3"><csymbol cd="ambiguous" id="S4.E8.m1.1.2.3.1.cmml" xref="S4.E8.m1.1.2.3">superscript</csymbol><ci id="S4.E8.m1.1.2.3.2.cmml" xref="S4.E8.m1.1.2.3.2">𝑞</ci><ci id="S4.E8.m1.1.2.3.3.cmml" xref="S4.E8.m1.1.2.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E8.m1.1c">f_{qt}(q)=q^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.E8.m1.1d">italic_f start_POSTSUBSCRIPT italic_q italic_t end_POSTSUBSCRIPT ( italic_q ) = italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p2">
<p class="ltx_p" id="S4.SS2.SSS2.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.SSS2.p2.1.1">Rewrite</span>. Original queries often fall short for retrieval in real-world scenarios. To address this, LLMs can be prompted to rewrite. Specialized smaller models can also be employed for this purpose <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib24" title="">24</a>]</cite>. The implementation of the query rewrite method in Taobao has significantly improved recall effectiveness for long-tail queries, leading to an increase in GMV <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib10" title="">10</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p3">
<p class="ltx_p" id="S4.SS2.SSS2.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.SSS2.p3.1.1">HyDE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib37" title="">37</a>]</cite>.</span> In order to bridge the semantic gap between questions and answers, it constructs hypothetical documents (assumed answers) when responding to queries instead of directly searching the query. It focuses on embedding similarity from answer to answer rather than seeking embedding similarity for the problem or query. In addition, it also includes reverse HyDE, which generate hypothetical query for each chunks and focuses on retrieval from query to query.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p4">
<p class="ltx_p" id="S4.SS2.SSS2.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.SSS2.p4.1.1">Step-back Prompting <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib38" title="">38</a>]</cite></span>. The original query is abstracted into a high-level concept question (step-back question). In the RAG system, both the step-back question and the original query are used for retrieval, and their results are combined to generate the language model’s answer.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS2.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS2.SSS3.5.1.1">IV-B</span>3 </span>Query Construction</h4>
<div class="ltx_para" id="S4.SS2.SSS3.p1">
<p class="ltx_p" id="S4.SS2.SSS3.p1.1">In addition to text data, an increasing amount of structured data, such as tables and graph data, is being integrated into RAG systems. To accommodate various data types, it is necessary to restructure the user’s query. This involve converting the query into another query language to access alternative data sources, with common methods including Text-to-SQL or Text-to-Cypher . In many scenarios, structured query languages (e.g., SQL, Cypher) are often used in conjunction with semantic information and metadata to construct more complex queries.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f_{qc}(q)=q^{*},q^{*}\in Q^{*}=\{SQL,Cypher,\dots\}" class="ltx_Math" display="block" id="S4.E9.m1.4"><semantics id="S4.E9.m1.4a"><mrow id="S4.E9.m1.4.4.2" xref="S4.E9.m1.4.4.3.cmml"><mrow id="S4.E9.m1.3.3.1.1" xref="S4.E9.m1.3.3.1.1.cmml"><mrow id="S4.E9.m1.3.3.1.1.2" xref="S4.E9.m1.3.3.1.1.2.cmml"><msub id="S4.E9.m1.3.3.1.1.2.2" xref="S4.E9.m1.3.3.1.1.2.2.cmml"><mi id="S4.E9.m1.3.3.1.1.2.2.2" xref="S4.E9.m1.3.3.1.1.2.2.2.cmml">f</mi><mrow id="S4.E9.m1.3.3.1.1.2.2.3" xref="S4.E9.m1.3.3.1.1.2.2.3.cmml"><mi id="S4.E9.m1.3.3.1.1.2.2.3.2" xref="S4.E9.m1.3.3.1.1.2.2.3.2.cmml">q</mi><mo id="S4.E9.m1.3.3.1.1.2.2.3.1" xref="S4.E9.m1.3.3.1.1.2.2.3.1.cmml">⁢</mo><mi id="S4.E9.m1.3.3.1.1.2.2.3.3" xref="S4.E9.m1.3.3.1.1.2.2.3.3.cmml">c</mi></mrow></msub><mo id="S4.E9.m1.3.3.1.1.2.1" xref="S4.E9.m1.3.3.1.1.2.1.cmml">⁢</mo><mrow id="S4.E9.m1.3.3.1.1.2.3.2" xref="S4.E9.m1.3.3.1.1.2.cmml"><mo id="S4.E9.m1.3.3.1.1.2.3.2.1" stretchy="false" xref="S4.E9.m1.3.3.1.1.2.cmml">(</mo><mi id="S4.E9.m1.1.1" xref="S4.E9.m1.1.1.cmml">q</mi><mo id="S4.E9.m1.3.3.1.1.2.3.2.2" stretchy="false" xref="S4.E9.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E9.m1.3.3.1.1.1" xref="S4.E9.m1.3.3.1.1.1.cmml">=</mo><msup id="S4.E9.m1.3.3.1.1.3" xref="S4.E9.m1.3.3.1.1.3.cmml"><mi id="S4.E9.m1.3.3.1.1.3.2" xref="S4.E9.m1.3.3.1.1.3.2.cmml">q</mi><mo id="S4.E9.m1.3.3.1.1.3.3" xref="S4.E9.m1.3.3.1.1.3.3.cmml">∗</mo></msup></mrow><mo id="S4.E9.m1.4.4.2.3" xref="S4.E9.m1.4.4.3a.cmml">,</mo><mrow id="S4.E9.m1.4.4.2.2" xref="S4.E9.m1.4.4.2.2.cmml"><msup id="S4.E9.m1.4.4.2.2.4" xref="S4.E9.m1.4.4.2.2.4.cmml"><mi id="S4.E9.m1.4.4.2.2.4.2" xref="S4.E9.m1.4.4.2.2.4.2.cmml">q</mi><mo id="S4.E9.m1.4.4.2.2.4.3" xref="S4.E9.m1.4.4.2.2.4.3.cmml">∗</mo></msup><mo id="S4.E9.m1.4.4.2.2.5" xref="S4.E9.m1.4.4.2.2.5.cmml">∈</mo><msup id="S4.E9.m1.4.4.2.2.6" xref="S4.E9.m1.4.4.2.2.6.cmml"><mi id="S4.E9.m1.4.4.2.2.6.2" xref="S4.E9.m1.4.4.2.2.6.2.cmml">Q</mi><mo id="S4.E9.m1.4.4.2.2.6.3" xref="S4.E9.m1.4.4.2.2.6.3.cmml">∗</mo></msup><mo id="S4.E9.m1.4.4.2.2.7" xref="S4.E9.m1.4.4.2.2.7.cmml">=</mo><mrow id="S4.E9.m1.4.4.2.2.2.2" xref="S4.E9.m1.4.4.2.2.2.3.cmml"><mo id="S4.E9.m1.4.4.2.2.2.2.3" stretchy="false" xref="S4.E9.m1.4.4.2.2.2.3.cmml">{</mo><mrow id="S4.E9.m1.4.4.2.2.1.1.1" xref="S4.E9.m1.4.4.2.2.1.1.1.cmml"><mi id="S4.E9.m1.4.4.2.2.1.1.1.2" xref="S4.E9.m1.4.4.2.2.1.1.1.2.cmml">S</mi><mo id="S4.E9.m1.4.4.2.2.1.1.1.1" xref="S4.E9.m1.4.4.2.2.1.1.1.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.1.1.1.3" xref="S4.E9.m1.4.4.2.2.1.1.1.3.cmml">Q</mi><mo id="S4.E9.m1.4.4.2.2.1.1.1.1a" xref="S4.E9.m1.4.4.2.2.1.1.1.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.1.1.1.4" xref="S4.E9.m1.4.4.2.2.1.1.1.4.cmml">L</mi></mrow><mo id="S4.E9.m1.4.4.2.2.2.2.4" xref="S4.E9.m1.4.4.2.2.2.3.cmml">,</mo><mrow id="S4.E9.m1.4.4.2.2.2.2.2" xref="S4.E9.m1.4.4.2.2.2.2.2.cmml"><mi id="S4.E9.m1.4.4.2.2.2.2.2.2" xref="S4.E9.m1.4.4.2.2.2.2.2.2.cmml">C</mi><mo id="S4.E9.m1.4.4.2.2.2.2.2.1" xref="S4.E9.m1.4.4.2.2.2.2.2.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.2.2.2.3" xref="S4.E9.m1.4.4.2.2.2.2.2.3.cmml">y</mi><mo id="S4.E9.m1.4.4.2.2.2.2.2.1a" xref="S4.E9.m1.4.4.2.2.2.2.2.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.2.2.2.4" xref="S4.E9.m1.4.4.2.2.2.2.2.4.cmml">p</mi><mo id="S4.E9.m1.4.4.2.2.2.2.2.1b" xref="S4.E9.m1.4.4.2.2.2.2.2.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.2.2.2.5" xref="S4.E9.m1.4.4.2.2.2.2.2.5.cmml">h</mi><mo id="S4.E9.m1.4.4.2.2.2.2.2.1c" xref="S4.E9.m1.4.4.2.2.2.2.2.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.2.2.2.6" xref="S4.E9.m1.4.4.2.2.2.2.2.6.cmml">e</mi><mo id="S4.E9.m1.4.4.2.2.2.2.2.1d" xref="S4.E9.m1.4.4.2.2.2.2.2.1.cmml">⁢</mo><mi id="S4.E9.m1.4.4.2.2.2.2.2.7" xref="S4.E9.m1.4.4.2.2.2.2.2.7.cmml">r</mi></mrow><mo id="S4.E9.m1.4.4.2.2.2.2.5" xref="S4.E9.m1.4.4.2.2.2.3.cmml">,</mo><mi id="S4.E9.m1.2.2" mathvariant="normal" xref="S4.E9.m1.2.2.cmml">…</mi><mo id="S4.E9.m1.4.4.2.2.2.2.6" stretchy="false" xref="S4.E9.m1.4.4.2.2.2.3.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E9.m1.4b"><apply id="S4.E9.m1.4.4.3.cmml" xref="S4.E9.m1.4.4.2"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.3a.cmml" xref="S4.E9.m1.4.4.2.3">formulae-sequence</csymbol><apply id="S4.E9.m1.3.3.1.1.cmml" xref="S4.E9.m1.3.3.1.1"><eq id="S4.E9.m1.3.3.1.1.1.cmml" xref="S4.E9.m1.3.3.1.1.1"></eq><apply id="S4.E9.m1.3.3.1.1.2.cmml" xref="S4.E9.m1.3.3.1.1.2"><times id="S4.E9.m1.3.3.1.1.2.1.cmml" xref="S4.E9.m1.3.3.1.1.2.1"></times><apply id="S4.E9.m1.3.3.1.1.2.2.cmml" xref="S4.E9.m1.3.3.1.1.2.2"><csymbol cd="ambiguous" id="S4.E9.m1.3.3.1.1.2.2.1.cmml" xref="S4.E9.m1.3.3.1.1.2.2">subscript</csymbol><ci id="S4.E9.m1.3.3.1.1.2.2.2.cmml" xref="S4.E9.m1.3.3.1.1.2.2.2">𝑓</ci><apply id="S4.E9.m1.3.3.1.1.2.2.3.cmml" xref="S4.E9.m1.3.3.1.1.2.2.3"><times id="S4.E9.m1.3.3.1.1.2.2.3.1.cmml" xref="S4.E9.m1.3.3.1.1.2.2.3.1"></times><ci id="S4.E9.m1.3.3.1.1.2.2.3.2.cmml" xref="S4.E9.m1.3.3.1.1.2.2.3.2">𝑞</ci><ci id="S4.E9.m1.3.3.1.1.2.2.3.3.cmml" xref="S4.E9.m1.3.3.1.1.2.2.3.3">𝑐</ci></apply></apply><ci id="S4.E9.m1.1.1.cmml" xref="S4.E9.m1.1.1">𝑞</ci></apply><apply id="S4.E9.m1.3.3.1.1.3.cmml" xref="S4.E9.m1.3.3.1.1.3"><csymbol cd="ambiguous" id="S4.E9.m1.3.3.1.1.3.1.cmml" xref="S4.E9.m1.3.3.1.1.3">superscript</csymbol><ci id="S4.E9.m1.3.3.1.1.3.2.cmml" xref="S4.E9.m1.3.3.1.1.3.2">𝑞</ci><times id="S4.E9.m1.3.3.1.1.3.3.cmml" xref="S4.E9.m1.3.3.1.1.3.3"></times></apply></apply><apply id="S4.E9.m1.4.4.2.2.cmml" xref="S4.E9.m1.4.4.2.2"><and id="S4.E9.m1.4.4.2.2a.cmml" xref="S4.E9.m1.4.4.2.2"></and><apply id="S4.E9.m1.4.4.2.2b.cmml" xref="S4.E9.m1.4.4.2.2"><in id="S4.E9.m1.4.4.2.2.5.cmml" xref="S4.E9.m1.4.4.2.2.5"></in><apply id="S4.E9.m1.4.4.2.2.4.cmml" xref="S4.E9.m1.4.4.2.2.4"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.2.2.4.1.cmml" xref="S4.E9.m1.4.4.2.2.4">superscript</csymbol><ci id="S4.E9.m1.4.4.2.2.4.2.cmml" xref="S4.E9.m1.4.4.2.2.4.2">𝑞</ci><times id="S4.E9.m1.4.4.2.2.4.3.cmml" xref="S4.E9.m1.4.4.2.2.4.3"></times></apply><apply id="S4.E9.m1.4.4.2.2.6.cmml" xref="S4.E9.m1.4.4.2.2.6"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.2.2.6.1.cmml" xref="S4.E9.m1.4.4.2.2.6">superscript</csymbol><ci id="S4.E9.m1.4.4.2.2.6.2.cmml" xref="S4.E9.m1.4.4.2.2.6.2">𝑄</ci><times id="S4.E9.m1.4.4.2.2.6.3.cmml" xref="S4.E9.m1.4.4.2.2.6.3"></times></apply></apply><apply id="S4.E9.m1.4.4.2.2c.cmml" xref="S4.E9.m1.4.4.2.2"><eq id="S4.E9.m1.4.4.2.2.7.cmml" xref="S4.E9.m1.4.4.2.2.7"></eq><share href="https://arxiv.org/html/2407.21059v1#S4.E9.m1.4.4.2.2.6.cmml" id="S4.E9.m1.4.4.2.2d.cmml" xref="S4.E9.m1.4.4.2.2"></share><set id="S4.E9.m1.4.4.2.2.2.3.cmml" xref="S4.E9.m1.4.4.2.2.2.2"><apply id="S4.E9.m1.4.4.2.2.1.1.1.cmml" xref="S4.E9.m1.4.4.2.2.1.1.1"><times id="S4.E9.m1.4.4.2.2.1.1.1.1.cmml" xref="S4.E9.m1.4.4.2.2.1.1.1.1"></times><ci id="S4.E9.m1.4.4.2.2.1.1.1.2.cmml" xref="S4.E9.m1.4.4.2.2.1.1.1.2">𝑆</ci><ci id="S4.E9.m1.4.4.2.2.1.1.1.3.cmml" xref="S4.E9.m1.4.4.2.2.1.1.1.3">𝑄</ci><ci id="S4.E9.m1.4.4.2.2.1.1.1.4.cmml" xref="S4.E9.m1.4.4.2.2.1.1.1.4">𝐿</ci></apply><apply id="S4.E9.m1.4.4.2.2.2.2.2.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2"><times id="S4.E9.m1.4.4.2.2.2.2.2.1.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.1"></times><ci id="S4.E9.m1.4.4.2.2.2.2.2.2.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.2">𝐶</ci><ci id="S4.E9.m1.4.4.2.2.2.2.2.3.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.3">𝑦</ci><ci id="S4.E9.m1.4.4.2.2.2.2.2.4.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.4">𝑝</ci><ci id="S4.E9.m1.4.4.2.2.2.2.2.5.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.5">ℎ</ci><ci id="S4.E9.m1.4.4.2.2.2.2.2.6.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.6">𝑒</ci><ci id="S4.E9.m1.4.4.2.2.2.2.2.7.cmml" xref="S4.E9.m1.4.4.2.2.2.2.2.7">𝑟</ci></apply><ci id="S4.E9.m1.2.2.cmml" xref="S4.E9.m1.2.2">…</ci></set></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E9.m1.4c">f_{qc}(q)=q^{*},q^{*}\in Q^{*}=\{SQL,Cypher,\dots\}</annotation><annotation encoding="application/x-llamapun" id="S4.E9.m1.4d">italic_f start_POSTSUBSCRIPT italic_q italic_c end_POSTSUBSCRIPT ( italic_q ) = italic_q start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT , italic_q start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∈ italic_Q start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT = { italic_S italic_Q italic_L , italic_C italic_y italic_p italic_h italic_e italic_r , … }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS3.5.1.1">IV-C</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS3.6.2">Retrieval</span>
</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1">The retrieval process is pivotal in RAG systems. By leveraging powerful embedding models, queries and text can be efficiently represented in latent spaces, which facilitates the establishment of semantic similarity between questions and documents, thereby enhancing retrieval. Three main considerations that need to be addressed include retrieval efficiency, quality, and the alignment of tasks, data and models.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS3.SSS1.5.1.1">IV-C</span>1 </span><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS1.6.2">Retriever Selection</span>
</h4>
<div class="ltx_para" id="S4.SS3.SSS1.p1">
<p class="ltx_p" id="S4.SS3.SSS1.p1.1">With the widespread adoption of RAG technology, the development of embedding models has been in full swing. In addition to traditional models based on statistics and pre-trained models based on the encoder structure, embedding models fine-tuned on LLMs have also demonstrated powerful capabilities <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib39" title="">39</a>]</cite>. However, they often come with more parameters, leading to weaker inference and retrieval efficiency. Therefore, it is crucial to select the appropriate retriever based on different task scenarios.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p2">
<p class="ltx_p" id="S4.SS3.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS1.p2.1.1">Sparse Retriever</span> uses statistical methods to convert queries and documents into sparse vectors. Its advantage lies in its efficiency in handling large datasets, focusing only on non-zero elements. However, it may be less effective than dense vectors in capturing complex semantics. Common methods include TF-IDF and BM25.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p3">
<p class="ltx_p" id="S4.SS3.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS1.p3.1.1">Dense Retriever</span> employs pre-trained language models (PLMs) to provide dense representations of queries and documents. Despite higher computational and storage costs, it offers more complex semantic representations. Typical models include BERT structure PLMs, like ColBERT, and multi-task fine-tuned models like BGE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib40" title="">40</a>]</cite> and GTE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib41" title="">41</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p4">
<p class="ltx_p" id="S4.SS3.SSS1.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS1.p4.1.1">Hybrid Retriever</span> is to use both sparse and dense retrievers simultaneously. Two embedding techniques complement each other to enhance retrieval effectiveness. Sparse retriever can provide initial screening results. Additionally, sparse models enhance the zero-shot retrieval capabilities of dense models, particularly in handling queries with rare entities, thereby increasing system robustness.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS3.SSS2.5.1.1">IV-C</span>2 </span>Retriever Fine-tuning</h4>
<div class="ltx_para" id="S4.SS3.SSS2.p1">
<p class="ltx_p" id="S4.SS3.SSS2.p1.1">In cases where the context may diverge from  pre-trained corpus, particularly in highly specialized fields like healthcare, law, and other domains abundant in proprietary terminology. While this adjustment demands additional effort, it can substantially enhance retrieval efficiency and domain alignment.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p2">
<p class="ltx_p" id="S4.SS3.SSS2.p2.6"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS2.p2.6.1">Supervised Fine-Tuning (SFT).</span> Fine-tuning a retrieval model based on labeled domain data is typically done using contrastive learning. This involves reducing the distance between positive samples while increasing the distance between negative samples. The commonly used loss calculation is shown in the following:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\mathcal{D}_{R})=-\frac{1}{T}\sum_{i=1}^{T}\log\frac{e^{(sim(q_{i}%
,d_{i}^{+}))}}{e^{(sim(q_{i},d_{i}^{+}))}+\sum_{j=1}^{N}e^{(sim(q_{i},d_{i}^{-%
}))}}" class="ltx_Math" display="block" id="S4.E10.m1.4"><semantics id="S4.E10.m1.4a"><mrow id="S4.E10.m1.4.4" xref="S4.E10.m1.4.4.cmml"><mrow id="S4.E10.m1.4.4.1" xref="S4.E10.m1.4.4.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.4.4.1.3" xref="S4.E10.m1.4.4.1.3.cmml">ℒ</mi><mo id="S4.E10.m1.4.4.1.2" xref="S4.E10.m1.4.4.1.2.cmml">⁢</mo><mrow id="S4.E10.m1.4.4.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.cmml"><mo id="S4.E10.m1.4.4.1.1.1.2" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.cmml">(</mo><msub id="S4.E10.m1.4.4.1.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.4.4.1.1.1.1.2" xref="S4.E10.m1.4.4.1.1.1.1.2.cmml">𝒟</mi><mi id="S4.E10.m1.4.4.1.1.1.1.3" xref="S4.E10.m1.4.4.1.1.1.1.3.cmml">R</mi></msub><mo id="S4.E10.m1.4.4.1.1.1.3" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.4.4.2" xref="S4.E10.m1.4.4.2.cmml">=</mo><mrow id="S4.E10.m1.4.4.3" xref="S4.E10.m1.4.4.3.cmml"><mo id="S4.E10.m1.4.4.3a" xref="S4.E10.m1.4.4.3.cmml">−</mo><mrow id="S4.E10.m1.4.4.3.2" xref="S4.E10.m1.4.4.3.2.cmml"><mfrac id="S4.E10.m1.4.4.3.2.2" xref="S4.E10.m1.4.4.3.2.2.cmml"><mn id="S4.E10.m1.4.4.3.2.2.2" xref="S4.E10.m1.4.4.3.2.2.2.cmml">1</mn><mi id="S4.E10.m1.4.4.3.2.2.3" xref="S4.E10.m1.4.4.3.2.2.3.cmml">T</mi></mfrac><mo id="S4.E10.m1.4.4.3.2.1" xref="S4.E10.m1.4.4.3.2.1.cmml">⁢</mo><mrow id="S4.E10.m1.4.4.3.2.3" xref="S4.E10.m1.4.4.3.2.3.cmml"><munderover id="S4.E10.m1.4.4.3.2.3.1" xref="S4.E10.m1.4.4.3.2.3.1.cmml"><mo id="S4.E10.m1.4.4.3.2.3.1.2.2" movablelimits="false" xref="S4.E10.m1.4.4.3.2.3.1.2.2.cmml">∑</mo><mrow id="S4.E10.m1.4.4.3.2.3.1.2.3" xref="S4.E10.m1.4.4.3.2.3.1.2.3.cmml"><mi id="S4.E10.m1.4.4.3.2.3.1.2.3.2" xref="S4.E10.m1.4.4.3.2.3.1.2.3.2.cmml">i</mi><mo id="S4.E10.m1.4.4.3.2.3.1.2.3.1" xref="S4.E10.m1.4.4.3.2.3.1.2.3.1.cmml">=</mo><mn id="S4.E10.m1.4.4.3.2.3.1.2.3.3" xref="S4.E10.m1.4.4.3.2.3.1.2.3.3.cmml">1</mn></mrow><mi id="S4.E10.m1.4.4.3.2.3.1.3" xref="S4.E10.m1.4.4.3.2.3.1.3.cmml">T</mi></munderover><mrow id="S4.E10.m1.4.4.3.2.3.2" xref="S4.E10.m1.4.4.3.2.3.2.cmml"><mi id="S4.E10.m1.4.4.3.2.3.2.1" xref="S4.E10.m1.4.4.3.2.3.2.1.cmml">log</mi><mo id="S4.E10.m1.4.4.3.2.3.2a" lspace="0.167em" xref="S4.E10.m1.4.4.3.2.3.2.cmml">⁡</mo><mfrac id="S4.E10.m1.3.3" xref="S4.E10.m1.3.3.cmml"><msup id="S4.E10.m1.1.1.1" xref="S4.E10.m1.1.1.1.cmml"><mi id="S4.E10.m1.1.1.1.3" xref="S4.E10.m1.1.1.1.3.cmml">e</mi><mrow id="S4.E10.m1.1.1.1.1.1.1" xref="S4.E10.m1.1.1.1.1.1.1.1.cmml"><mo id="S4.E10.m1.1.1.1.1.1.1.2" stretchy="false" xref="S4.E10.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E10.m1.1.1.1.1.1.1.1" xref="S4.E10.m1.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.1.1.1.1.1.1.1.4" xref="S4.E10.m1.1.1.1.1.1.1.1.4.cmml">s</mi><mo id="S4.E10.m1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.1.1.1.1.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.1.1.1.1.1.1.1.5" xref="S4.E10.m1.1.1.1.1.1.1.1.5.cmml">i</mi><mo id="S4.E10.m1.1.1.1.1.1.1.1.3a" xref="S4.E10.m1.1.1.1.1.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.1.1.1.1.1.1.1.6" xref="S4.E10.m1.1.1.1.1.1.1.1.6.cmml">m</mi><mo id="S4.E10.m1.1.1.1.1.1.1.1.3b" xref="S4.E10.m1.1.1.1.1.1.1.1.3.cmml">⁢</mo><mrow id="S4.E10.m1.1.1.1.1.1.1.1.2.2" xref="S4.E10.m1.1.1.1.1.1.1.1.2.3.cmml"><mo id="S4.E10.m1.1.1.1.1.1.1.1.2.2.3" stretchy="false" xref="S4.E10.m1.1.1.1.1.1.1.1.2.3.cmml">(</mo><msub id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">q</mi><mi id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E10.m1.1.1.1.1.1.1.1.2.2.4" xref="S4.E10.m1.1.1.1.1.1.1.1.2.3.cmml">,</mo><msubsup id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.cmml"><mi id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.2" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.2.cmml">d</mi><mi id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.3" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.3.cmml">i</mi><mo id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.3" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.3.cmml">+</mo></msubsup><mo id="S4.E10.m1.1.1.1.1.1.1.1.2.2.5" stretchy="false" xref="S4.E10.m1.1.1.1.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.1.1.1.1.1.1.3" stretchy="false" xref="S4.E10.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></msup><mrow id="S4.E10.m1.3.3.3" xref="S4.E10.m1.3.3.3.cmml"><msup id="S4.E10.m1.3.3.3.4" xref="S4.E10.m1.3.3.3.4.cmml"><mi id="S4.E10.m1.3.3.3.4.2" xref="S4.E10.m1.3.3.3.4.2.cmml">e</mi><mrow id="S4.E10.m1.2.2.2.1.1.1" xref="S4.E10.m1.2.2.2.1.1.1.1.cmml"><mo id="S4.E10.m1.2.2.2.1.1.1.2" stretchy="false" xref="S4.E10.m1.2.2.2.1.1.1.1.cmml">(</mo><mrow id="S4.E10.m1.2.2.2.1.1.1.1" xref="S4.E10.m1.2.2.2.1.1.1.1.cmml"><mi id="S4.E10.m1.2.2.2.1.1.1.1.4" xref="S4.E10.m1.2.2.2.1.1.1.1.4.cmml">s</mi><mo id="S4.E10.m1.2.2.2.1.1.1.1.3" xref="S4.E10.m1.2.2.2.1.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.2.2.2.1.1.1.1.5" xref="S4.E10.m1.2.2.2.1.1.1.1.5.cmml">i</mi><mo id="S4.E10.m1.2.2.2.1.1.1.1.3a" xref="S4.E10.m1.2.2.2.1.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.2.2.2.1.1.1.1.6" xref="S4.E10.m1.2.2.2.1.1.1.1.6.cmml">m</mi><mo id="S4.E10.m1.2.2.2.1.1.1.1.3b" xref="S4.E10.m1.2.2.2.1.1.1.1.3.cmml">⁢</mo><mrow id="S4.E10.m1.2.2.2.1.1.1.1.2.2" xref="S4.E10.m1.2.2.2.1.1.1.1.2.3.cmml"><mo id="S4.E10.m1.2.2.2.1.1.1.1.2.2.3" stretchy="false" xref="S4.E10.m1.2.2.2.1.1.1.1.2.3.cmml">(</mo><msub id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.2" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.2.cmml">q</mi><mi id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.3" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E10.m1.2.2.2.1.1.1.1.2.2.4" xref="S4.E10.m1.2.2.2.1.1.1.1.2.3.cmml">,</mo><msubsup id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.cmml"><mi id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.2" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.2.cmml">d</mi><mi id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.3" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.3.cmml">i</mi><mo id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.3" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.3.cmml">+</mo></msubsup><mo id="S4.E10.m1.2.2.2.1.1.1.1.2.2.5" stretchy="false" xref="S4.E10.m1.2.2.2.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.2.2.2.1.1.1.3" stretchy="false" xref="S4.E10.m1.2.2.2.1.1.1.1.cmml">)</mo></mrow></msup><mo id="S4.E10.m1.3.3.3.3" rspace="0.055em" xref="S4.E10.m1.3.3.3.3.cmml">+</mo><mrow id="S4.E10.m1.3.3.3.5" xref="S4.E10.m1.3.3.3.5.cmml"><msubsup id="S4.E10.m1.3.3.3.5.1" xref="S4.E10.m1.3.3.3.5.1.cmml"><mo id="S4.E10.m1.3.3.3.5.1.2.2" xref="S4.E10.m1.3.3.3.5.1.2.2.cmml">∑</mo><mrow id="S4.E10.m1.3.3.3.5.1.2.3" xref="S4.E10.m1.3.3.3.5.1.2.3.cmml"><mi id="S4.E10.m1.3.3.3.5.1.2.3.2" xref="S4.E10.m1.3.3.3.5.1.2.3.2.cmml">j</mi><mo id="S4.E10.m1.3.3.3.5.1.2.3.1" xref="S4.E10.m1.3.3.3.5.1.2.3.1.cmml">=</mo><mn id="S4.E10.m1.3.3.3.5.1.2.3.3" xref="S4.E10.m1.3.3.3.5.1.2.3.3.cmml">1</mn></mrow><mi id="S4.E10.m1.3.3.3.5.1.3" xref="S4.E10.m1.3.3.3.5.1.3.cmml">N</mi></msubsup><msup id="S4.E10.m1.3.3.3.5.2" xref="S4.E10.m1.3.3.3.5.2.cmml"><mi id="S4.E10.m1.3.3.3.5.2.2" xref="S4.E10.m1.3.3.3.5.2.2.cmml">e</mi><mrow id="S4.E10.m1.3.3.3.2.1.1" xref="S4.E10.m1.3.3.3.2.1.1.1.cmml"><mo id="S4.E10.m1.3.3.3.2.1.1.2" stretchy="false" xref="S4.E10.m1.3.3.3.2.1.1.1.cmml">(</mo><mrow id="S4.E10.m1.3.3.3.2.1.1.1" xref="S4.E10.m1.3.3.3.2.1.1.1.cmml"><mi id="S4.E10.m1.3.3.3.2.1.1.1.4" xref="S4.E10.m1.3.3.3.2.1.1.1.4.cmml">s</mi><mo id="S4.E10.m1.3.3.3.2.1.1.1.3" xref="S4.E10.m1.3.3.3.2.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.3.3.3.2.1.1.1.5" xref="S4.E10.m1.3.3.3.2.1.1.1.5.cmml">i</mi><mo id="S4.E10.m1.3.3.3.2.1.1.1.3a" xref="S4.E10.m1.3.3.3.2.1.1.1.3.cmml">⁢</mo><mi id="S4.E10.m1.3.3.3.2.1.1.1.6" xref="S4.E10.m1.3.3.3.2.1.1.1.6.cmml">m</mi><mo id="S4.E10.m1.3.3.3.2.1.1.1.3b" xref="S4.E10.m1.3.3.3.2.1.1.1.3.cmml">⁢</mo><mrow id="S4.E10.m1.3.3.3.2.1.1.1.2.2" xref="S4.E10.m1.3.3.3.2.1.1.1.2.3.cmml"><mo id="S4.E10.m1.3.3.3.2.1.1.1.2.2.3" stretchy="false" xref="S4.E10.m1.3.3.3.2.1.1.1.2.3.cmml">(</mo><msub id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.2" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.2.cmml">q</mi><mi id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.3" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E10.m1.3.3.3.2.1.1.1.2.2.4" xref="S4.E10.m1.3.3.3.2.1.1.1.2.3.cmml">,</mo><msubsup id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.cmml"><mi id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.2" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.2.cmml">d</mi><mi id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.3" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.3.cmml">i</mi><mo id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.3" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.3.cmml">−</mo></msubsup><mo id="S4.E10.m1.3.3.3.2.1.1.1.2.2.5" stretchy="false" xref="S4.E10.m1.3.3.3.2.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.3.3.3.2.1.1.3" stretchy="false" xref="S4.E10.m1.3.3.3.2.1.1.1.cmml">)</mo></mrow></msup></mrow></mrow></mfrac></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E10.m1.4b"><apply id="S4.E10.m1.4.4.cmml" xref="S4.E10.m1.4.4"><eq id="S4.E10.m1.4.4.2.cmml" xref="S4.E10.m1.4.4.2"></eq><apply id="S4.E10.m1.4.4.1.cmml" xref="S4.E10.m1.4.4.1"><times id="S4.E10.m1.4.4.1.2.cmml" xref="S4.E10.m1.4.4.1.2"></times><ci id="S4.E10.m1.4.4.1.3.cmml" xref="S4.E10.m1.4.4.1.3">ℒ</ci><apply id="S4.E10.m1.4.4.1.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.1.1.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1">subscript</csymbol><ci id="S4.E10.m1.4.4.1.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.1.2">𝒟</ci><ci id="S4.E10.m1.4.4.1.1.1.1.3.cmml" xref="S4.E10.m1.4.4.1.1.1.1.3">𝑅</ci></apply></apply><apply id="S4.E10.m1.4.4.3.cmml" xref="S4.E10.m1.4.4.3"><minus id="S4.E10.m1.4.4.3.1.cmml" xref="S4.E10.m1.4.4.3"></minus><apply id="S4.E10.m1.4.4.3.2.cmml" xref="S4.E10.m1.4.4.3.2"><times id="S4.E10.m1.4.4.3.2.1.cmml" xref="S4.E10.m1.4.4.3.2.1"></times><apply id="S4.E10.m1.4.4.3.2.2.cmml" xref="S4.E10.m1.4.4.3.2.2"><divide id="S4.E10.m1.4.4.3.2.2.1.cmml" xref="S4.E10.m1.4.4.3.2.2"></divide><cn id="S4.E10.m1.4.4.3.2.2.2.cmml" type="integer" xref="S4.E10.m1.4.4.3.2.2.2">1</cn><ci id="S4.E10.m1.4.4.3.2.2.3.cmml" xref="S4.E10.m1.4.4.3.2.2.3">𝑇</ci></apply><apply id="S4.E10.m1.4.4.3.2.3.cmml" xref="S4.E10.m1.4.4.3.2.3"><apply id="S4.E10.m1.4.4.3.2.3.1.cmml" xref="S4.E10.m1.4.4.3.2.3.1"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.3.2.3.1.1.cmml" xref="S4.E10.m1.4.4.3.2.3.1">superscript</csymbol><apply id="S4.E10.m1.4.4.3.2.3.1.2.cmml" xref="S4.E10.m1.4.4.3.2.3.1"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.3.2.3.1.2.1.cmml" xref="S4.E10.m1.4.4.3.2.3.1">subscript</csymbol><sum id="S4.E10.m1.4.4.3.2.3.1.2.2.cmml" xref="S4.E10.m1.4.4.3.2.3.1.2.2"></sum><apply id="S4.E10.m1.4.4.3.2.3.1.2.3.cmml" xref="S4.E10.m1.4.4.3.2.3.1.2.3"><eq id="S4.E10.m1.4.4.3.2.3.1.2.3.1.cmml" xref="S4.E10.m1.4.4.3.2.3.1.2.3.1"></eq><ci id="S4.E10.m1.4.4.3.2.3.1.2.3.2.cmml" xref="S4.E10.m1.4.4.3.2.3.1.2.3.2">𝑖</ci><cn id="S4.E10.m1.4.4.3.2.3.1.2.3.3.cmml" type="integer" xref="S4.E10.m1.4.4.3.2.3.1.2.3.3">1</cn></apply></apply><ci id="S4.E10.m1.4.4.3.2.3.1.3.cmml" xref="S4.E10.m1.4.4.3.2.3.1.3">𝑇</ci></apply><apply id="S4.E10.m1.4.4.3.2.3.2.cmml" xref="S4.E10.m1.4.4.3.2.3.2"><log id="S4.E10.m1.4.4.3.2.3.2.1.cmml" xref="S4.E10.m1.4.4.3.2.3.2.1"></log><apply id="S4.E10.m1.3.3.cmml" xref="S4.E10.m1.3.3"><divide id="S4.E10.m1.3.3.4.cmml" xref="S4.E10.m1.3.3"></divide><apply id="S4.E10.m1.1.1.1.cmml" xref="S4.E10.m1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.2.cmml" xref="S4.E10.m1.1.1.1">superscript</csymbol><ci id="S4.E10.m1.1.1.1.3.cmml" xref="S4.E10.m1.1.1.1.3">𝑒</ci><apply id="S4.E10.m1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1"><times id="S4.E10.m1.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.3"></times><ci id="S4.E10.m1.1.1.1.1.1.1.1.4.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.4">𝑠</ci><ci id="S4.E10.m1.1.1.1.1.1.1.1.5.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.5">𝑖</ci><ci id="S4.E10.m1.1.1.1.1.1.1.1.6.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.6">𝑚</ci><interval closure="open" id="S4.E10.m1.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2"><apply id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.2">𝑞</ci><ci id="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2">superscript</csymbol><apply id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.2">𝑑</ci><ci id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.2.3">𝑖</ci></apply><plus id="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2.2.2.3"></plus></apply></interval></apply></apply><apply id="S4.E10.m1.3.3.3.cmml" xref="S4.E10.m1.3.3.3"><plus id="S4.E10.m1.3.3.3.3.cmml" xref="S4.E10.m1.3.3.3.3"></plus><apply id="S4.E10.m1.3.3.3.4.cmml" xref="S4.E10.m1.3.3.3.4"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.4.1.cmml" xref="S4.E10.m1.3.3.3.4">superscript</csymbol><ci id="S4.E10.m1.3.3.3.4.2.cmml" xref="S4.E10.m1.3.3.3.4.2">𝑒</ci><apply id="S4.E10.m1.2.2.2.1.1.1.1.cmml" xref="S4.E10.m1.2.2.2.1.1.1"><times id="S4.E10.m1.2.2.2.1.1.1.1.3.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.3"></times><ci id="S4.E10.m1.2.2.2.1.1.1.1.4.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.4">𝑠</ci><ci id="S4.E10.m1.2.2.2.1.1.1.1.5.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.5">𝑖</ci><ci id="S4.E10.m1.2.2.2.1.1.1.1.6.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.6">𝑚</ci><interval closure="open" id="S4.E10.m1.2.2.2.1.1.1.1.2.3.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2"><apply id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.2">𝑞</ci><ci id="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.1.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2">superscript</csymbol><apply id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.1.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2">subscript</csymbol><ci id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.2">𝑑</ci><ci id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.2.3">𝑖</ci></apply><plus id="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.1.1.1.1.2.2.2.3"></plus></apply></interval></apply></apply><apply id="S4.E10.m1.3.3.3.5.cmml" xref="S4.E10.m1.3.3.3.5"><apply id="S4.E10.m1.3.3.3.5.1.cmml" xref="S4.E10.m1.3.3.3.5.1"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.5.1.1.cmml" xref="S4.E10.m1.3.3.3.5.1">superscript</csymbol><apply id="S4.E10.m1.3.3.3.5.1.2.cmml" xref="S4.E10.m1.3.3.3.5.1"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.5.1.2.1.cmml" xref="S4.E10.m1.3.3.3.5.1">subscript</csymbol><sum id="S4.E10.m1.3.3.3.5.1.2.2.cmml" xref="S4.E10.m1.3.3.3.5.1.2.2"></sum><apply id="S4.E10.m1.3.3.3.5.1.2.3.cmml" xref="S4.E10.m1.3.3.3.5.1.2.3"><eq id="S4.E10.m1.3.3.3.5.1.2.3.1.cmml" xref="S4.E10.m1.3.3.3.5.1.2.3.1"></eq><ci id="S4.E10.m1.3.3.3.5.1.2.3.2.cmml" xref="S4.E10.m1.3.3.3.5.1.2.3.2">𝑗</ci><cn id="S4.E10.m1.3.3.3.5.1.2.3.3.cmml" type="integer" xref="S4.E10.m1.3.3.3.5.1.2.3.3">1</cn></apply></apply><ci id="S4.E10.m1.3.3.3.5.1.3.cmml" xref="S4.E10.m1.3.3.3.5.1.3">𝑁</ci></apply><apply id="S4.E10.m1.3.3.3.5.2.cmml" xref="S4.E10.m1.3.3.3.5.2"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.5.2.1.cmml" xref="S4.E10.m1.3.3.3.5.2">superscript</csymbol><ci id="S4.E10.m1.3.3.3.5.2.2.cmml" xref="S4.E10.m1.3.3.3.5.2.2">𝑒</ci><apply id="S4.E10.m1.3.3.3.2.1.1.1.cmml" xref="S4.E10.m1.3.3.3.2.1.1"><times id="S4.E10.m1.3.3.3.2.1.1.1.3.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.3"></times><ci id="S4.E10.m1.3.3.3.2.1.1.1.4.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.4">𝑠</ci><ci id="S4.E10.m1.3.3.3.2.1.1.1.5.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.5">𝑖</ci><ci id="S4.E10.m1.3.3.3.2.1.1.1.6.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.6">𝑚</ci><interval closure="open" id="S4.E10.m1.3.3.3.2.1.1.1.2.3.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2"><apply id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.2">𝑞</ci><ci id="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.1.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2">superscript</csymbol><apply id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.1.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2">subscript</csymbol><ci id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.2.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.2">𝑑</ci><ci id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.3.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.2.3">𝑖</ci></apply><minus id="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.3.cmml" xref="S4.E10.m1.3.3.3.2.1.1.1.2.2.2.3"></minus></apply></interval></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E10.m1.4c">\mathcal{L}(\mathcal{D}_{R})=-\frac{1}{T}\sum_{i=1}^{T}\log\frac{e^{(sim(q_{i}%
,d_{i}^{+}))}}{e^{(sim(q_{i},d_{i}^{+}))}+\sum_{j=1}^{N}e^{(sim(q_{i},d_{i}^{-%
}))}}</annotation><annotation encoding="application/x-llamapun" id="S4.E10.m1.4d">caligraphic_L ( caligraphic_D start_POSTSUBSCRIPT italic_R end_POSTSUBSCRIPT ) = - divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT roman_log divide start_ARG italic_e start_POSTSUPERSCRIPT ( italic_s italic_i italic_m ( italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) ) end_POSTSUPERSCRIPT end_ARG start_ARG italic_e start_POSTSUPERSCRIPT ( italic_s italic_i italic_m ( italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) ) end_POSTSUPERSCRIPT + ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT italic_e start_POSTSUPERSCRIPT ( italic_s italic_i italic_m ( italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT ) ) end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS3.SSS2.p2.5">where <math alttext="d_{i}^{+}" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p2.1.m1.1"><semantics id="S4.SS3.SSS2.p2.1.m1.1a"><msubsup id="S4.SS3.SSS2.p2.1.m1.1.1" xref="S4.SS3.SSS2.p2.1.m1.1.1.cmml"><mi id="S4.SS3.SSS2.p2.1.m1.1.1.2.2" xref="S4.SS3.SSS2.p2.1.m1.1.1.2.2.cmml">d</mi><mi id="S4.SS3.SSS2.p2.1.m1.1.1.2.3" xref="S4.SS3.SSS2.p2.1.m1.1.1.2.3.cmml">i</mi><mo id="S4.SS3.SSS2.p2.1.m1.1.1.3" xref="S4.SS3.SSS2.p2.1.m1.1.1.3.cmml">+</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p2.1.m1.1b"><apply id="S4.SS3.SSS2.p2.1.m1.1.1.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p2.1.m1.1.1.1.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1">superscript</csymbol><apply id="S4.SS3.SSS2.p2.1.m1.1.1.2.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p2.1.m1.1.1.2.1.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.SSS2.p2.1.m1.1.1.2.2.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1.2.2">𝑑</ci><ci id="S4.SS3.SSS2.p2.1.m1.1.1.2.3.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1.2.3">𝑖</ci></apply><plus id="S4.SS3.SSS2.p2.1.m1.1.1.3.cmml" xref="S4.SS3.SSS2.p2.1.m1.1.1.3"></plus></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p2.1.m1.1c">d_{i}^{+}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p2.1.m1.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT</annotation></semantics></math> is the positive sample document corresponding to the i-th query, <math alttext="d_{i}^{-}" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p2.2.m2.1"><semantics id="S4.SS3.SSS2.p2.2.m2.1a"><msubsup id="S4.SS3.SSS2.p2.2.m2.1.1" xref="S4.SS3.SSS2.p2.2.m2.1.1.cmml"><mi id="S4.SS3.SSS2.p2.2.m2.1.1.2.2" xref="S4.SS3.SSS2.p2.2.m2.1.1.2.2.cmml">d</mi><mi id="S4.SS3.SSS2.p2.2.m2.1.1.2.3" xref="S4.SS3.SSS2.p2.2.m2.1.1.2.3.cmml">i</mi><mo id="S4.SS3.SSS2.p2.2.m2.1.1.3" xref="S4.SS3.SSS2.p2.2.m2.1.1.3.cmml">−</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p2.2.m2.1b"><apply id="S4.SS3.SSS2.p2.2.m2.1.1.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p2.2.m2.1.1.1.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1">superscript</csymbol><apply id="S4.SS3.SSS2.p2.2.m2.1.1.2.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p2.2.m2.1.1.2.1.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS3.SSS2.p2.2.m2.1.1.2.2.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1.2.2">𝑑</ci><ci id="S4.SS3.SSS2.p2.2.m2.1.1.2.3.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1.2.3">𝑖</ci></apply><minus id="S4.SS3.SSS2.p2.2.m2.1.1.3.cmml" xref="S4.SS3.SSS2.p2.2.m2.1.1.3"></minus></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p2.2.m2.1c">d_{i}^{-}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p2.2.m2.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT</annotation></semantics></math> is several negative sample, <math alttext="T" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p2.3.m3.1"><semantics id="S4.SS3.SSS2.p2.3.m3.1a"><mi id="S4.SS3.SSS2.p2.3.m3.1.1" xref="S4.SS3.SSS2.p2.3.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p2.3.m3.1b"><ci id="S4.SS3.SSS2.p2.3.m3.1.1.cmml" xref="S4.SS3.SSS2.p2.3.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p2.3.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p2.3.m3.1d">italic_T</annotation></semantics></math> is the total number of queries, <math alttext="N" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p2.4.m4.1"><semantics id="S4.SS3.SSS2.p2.4.m4.1a"><mi id="S4.SS3.SSS2.p2.4.m4.1.1" xref="S4.SS3.SSS2.p2.4.m4.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p2.4.m4.1b"><ci id="S4.SS3.SSS2.p2.4.m4.1.1.cmml" xref="S4.SS3.SSS2.p2.4.m4.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p2.4.m4.1c">N</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p2.4.m4.1d">italic_N</annotation></semantics></math> is the number of negative samples, and <math alttext="\mathcal{D}_{R}" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p2.5.m5.1"><semantics id="S4.SS3.SSS2.p2.5.m5.1a"><msub id="S4.SS3.SSS2.p2.5.m5.1.1" xref="S4.SS3.SSS2.p2.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.SSS2.p2.5.m5.1.1.2" xref="S4.SS3.SSS2.p2.5.m5.1.1.2.cmml">𝒟</mi><mi id="S4.SS3.SSS2.p2.5.m5.1.1.3" xref="S4.SS3.SSS2.p2.5.m5.1.1.3.cmml">R</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p2.5.m5.1b"><apply id="S4.SS3.SSS2.p2.5.m5.1.1.cmml" xref="S4.SS3.SSS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p2.5.m5.1.1.1.cmml" xref="S4.SS3.SSS2.p2.5.m5.1.1">subscript</csymbol><ci id="S4.SS3.SSS2.p2.5.m5.1.1.2.cmml" xref="S4.SS3.SSS2.p2.5.m5.1.1.2">𝒟</ci><ci id="S4.SS3.SSS2.p2.5.m5.1.1.3.cmml" xref="S4.SS3.SSS2.p2.5.m5.1.1.3">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p2.5.m5.1c">\mathcal{D}_{R}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p2.5.m5.1d">caligraphic_D start_POSTSUBSCRIPT italic_R end_POSTSUBSCRIPT</annotation></semantics></math> is the fine-tuning dataset.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p3">
<p class="ltx_p" id="S4.SS3.SSS2.p3.6"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS2.p3.6.1">LM-supervised Retriever (LSR)</span>. In contrast to directly constructing a fine-tuning dataset from the dataset, LSR utilizes the LM-generated results as supervisory signals to fine-tune the embedding model during the RAG process.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P_{LSR}(d|q,y)=\frac{e^{P_{LM}(y|d,q)/\beta}}{\sum_{d^{\prime}\in D}{e^{P_{LM}%
(y|d,q)/\beta)}}}" class="ltx_math_unparsed" display="block" id="S4.E11.m1.8"><semantics id="S4.E11.m1.8a"><mrow id="S4.E11.m1.8.8"><mrow id="S4.E11.m1.8.8.1"><msub id="S4.E11.m1.8.8.1.3"><mi id="S4.E11.m1.8.8.1.3.2">P</mi><mrow id="S4.E11.m1.8.8.1.3.3"><mi id="S4.E11.m1.8.8.1.3.3.2">L</mi><mo id="S4.E11.m1.8.8.1.3.3.1">⁢</mo><mi id="S4.E11.m1.8.8.1.3.3.3">S</mi><mo id="S4.E11.m1.8.8.1.3.3.1a">⁢</mo><mi id="S4.E11.m1.8.8.1.3.3.4">R</mi></mrow></msub><mo id="S4.E11.m1.8.8.1.2">⁢</mo><mrow id="S4.E11.m1.8.8.1.1.1"><mo id="S4.E11.m1.8.8.1.1.1.2" stretchy="false">(</mo><mrow id="S4.E11.m1.8.8.1.1.1.1"><mi id="S4.E11.m1.8.8.1.1.1.1.2">d</mi><mo fence="false" id="S4.E11.m1.8.8.1.1.1.1.1">|</mo><mrow id="S4.E11.m1.8.8.1.1.1.1.3.2"><mi id="S4.E11.m1.6.6">q</mi><mo id="S4.E11.m1.8.8.1.1.1.1.3.2.1">,</mo><mi id="S4.E11.m1.7.7">y</mi></mrow></mrow><mo id="S4.E11.m1.8.8.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mo id="S4.E11.m1.8.8.2">=</mo><mfrac id="S4.E11.m1.5.5"><msup id="S4.E11.m1.3.3.3"><mi id="S4.E11.m1.3.3.3.5">e</mi><mrow id="S4.E11.m1.3.3.3.3.3"><mrow id="S4.E11.m1.3.3.3.3.3.3"><msub id="S4.E11.m1.3.3.3.3.3.3.3"><mi id="S4.E11.m1.3.3.3.3.3.3.3.2">P</mi><mrow id="S4.E11.m1.3.3.3.3.3.3.3.3"><mi id="S4.E11.m1.3.3.3.3.3.3.3.3.2">L</mi><mo id="S4.E11.m1.3.3.3.3.3.3.3.3.1">⁢</mo><mi id="S4.E11.m1.3.3.3.3.3.3.3.3.3">M</mi></mrow></msub><mo id="S4.E11.m1.3.3.3.3.3.3.2">⁢</mo><mrow id="S4.E11.m1.3.3.3.3.3.3.1.1"><mo id="S4.E11.m1.3.3.3.3.3.3.1.1.2" stretchy="false">(</mo><mrow id="S4.E11.m1.3.3.3.3.3.3.1.1.1"><mi id="S4.E11.m1.3.3.3.3.3.3.1.1.1.2">y</mi><mo fence="false" id="S4.E11.m1.3.3.3.3.3.3.1.1.1.1">|</mo><mrow id="S4.E11.m1.3.3.3.3.3.3.1.1.1.3.2"><mi id="S4.E11.m1.1.1.1.1.1.1">d</mi><mo id="S4.E11.m1.3.3.3.3.3.3.1.1.1.3.2.1">,</mo><mi id="S4.E11.m1.2.2.2.2.2.2">q</mi></mrow></mrow><mo id="S4.E11.m1.3.3.3.3.3.3.1.1.3" stretchy="false">)</mo></mrow></mrow><mo id="S4.E11.m1.3.3.3.3.3.4">/</mo><mi id="S4.E11.m1.3.3.3.3.3.5">β</mi></mrow></msup><mrow id="S4.E11.m1.5.5.5"><msub id="S4.E11.m1.5.5.5.3"><mo id="S4.E11.m1.5.5.5.3.2">∑</mo><mrow id="S4.E11.m1.5.5.5.3.3"><msup id="S4.E11.m1.5.5.5.3.3.2"><mi id="S4.E11.m1.5.5.5.3.3.2.2">d</mi><mo id="S4.E11.m1.5.5.5.3.3.2.3">′</mo></msup><mo id="S4.E11.m1.5.5.5.3.3.1">∈</mo><mi id="S4.E11.m1.5.5.5.3.3.3">D</mi></mrow></msub><msup id="S4.E11.m1.5.5.5.4"><mi id="S4.E11.m1.5.5.5.4.2">e</mi><mrow id="S4.E11.m1.5.5.5.2.2"><msub id="S4.E11.m1.5.5.5.2.2.3"><mi id="S4.E11.m1.5.5.5.2.2.3.2">P</mi><mrow id="S4.E11.m1.5.5.5.2.2.3.3"><mi id="S4.E11.m1.5.5.5.2.2.3.3.2">L</mi><mo id="S4.E11.m1.5.5.5.2.2.3.3.1">⁢</mo><mi id="S4.E11.m1.5.5.5.2.2.3.3.3">M</mi></mrow></msub><mrow id="S4.E11.m1.5.5.5.2.2.4"><mo id="S4.E11.m1.5.5.5.2.2.4.1" stretchy="false">(</mo><mi id="S4.E11.m1.5.5.5.2.2.4.2">y</mi><mo fence="false" id="S4.E11.m1.5.5.5.2.2.4.3" rspace="0.167em" stretchy="false">|</mo><mi id="S4.E11.m1.4.4.4.1.1.1">d</mi><mo id="S4.E11.m1.5.5.5.2.2.4.4">,</mo><mi id="S4.E11.m1.5.5.5.2.2.2">q</mi><mo id="S4.E11.m1.5.5.5.2.2.4.5" stretchy="false">)</mo></mrow><mo id="S4.E11.m1.5.5.5.2.2.5">/</mo><mi id="S4.E11.m1.5.5.5.2.2.6">β</mi><mo id="S4.E11.m1.5.5.5.2.2.7" stretchy="false">)</mo></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex" id="S4.E11.m1.8b">P_{LSR}(d|q,y)=\frac{e^{P_{LM}(y|d,q)/\beta}}{\sum_{d^{\prime}\in D}{e^{P_{LM}%
(y|d,q)/\beta)}}}</annotation><annotation encoding="application/x-llamapun" id="S4.E11.m1.8c">italic_P start_POSTSUBSCRIPT italic_L italic_S italic_R end_POSTSUBSCRIPT ( italic_d | italic_q , italic_y ) = divide start_ARG italic_e start_POSTSUPERSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_y | italic_d , italic_q ) / italic_β end_POSTSUPERSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ italic_D end_POSTSUBSCRIPT italic_e start_POSTSUPERSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_y | italic_d , italic_q ) / italic_β ) end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS3.SSS2.p3.5"><math alttext="P_{LM}(y|d,q)" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p3.1.m1.3"><semantics id="S4.SS3.SSS2.p3.1.m1.3a"><mrow id="S4.SS3.SSS2.p3.1.m1.3.3" xref="S4.SS3.SSS2.p3.1.m1.3.3.cmml"><msub id="S4.SS3.SSS2.p3.1.m1.3.3.3" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.cmml"><mi id="S4.SS3.SSS2.p3.1.m1.3.3.3.2" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.2.cmml">P</mi><mrow id="S4.SS3.SSS2.p3.1.m1.3.3.3.3" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.cmml"><mi id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.2" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.2.cmml">L</mi><mo id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.1" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.1.cmml">⁢</mo><mi id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.3" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.3.cmml">M</mi></mrow></msub><mo id="S4.SS3.SSS2.p3.1.m1.3.3.2" xref="S4.SS3.SSS2.p3.1.m1.3.3.2.cmml">⁢</mo><mrow id="S4.SS3.SSS2.p3.1.m1.3.3.1.1" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.cmml"><mo id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.2" stretchy="false" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.cmml">(</mo><mrow id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.cmml"><mi id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.2" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.2.cmml">y</mi><mo fence="false" id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.1" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.1.cmml">|</mo><mrow id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.2" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.1.cmml"><mi id="S4.SS3.SSS2.p3.1.m1.1.1" xref="S4.SS3.SSS2.p3.1.m1.1.1.cmml">d</mi><mo id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.2.1" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.1.cmml">,</mo><mi id="S4.SS3.SSS2.p3.1.m1.2.2" xref="S4.SS3.SSS2.p3.1.m1.2.2.cmml">q</mi></mrow></mrow><mo id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.3" stretchy="false" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p3.1.m1.3b"><apply id="S4.SS3.SSS2.p3.1.m1.3.3.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3"><times id="S4.SS3.SSS2.p3.1.m1.3.3.2.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.2"></times><apply id="S4.SS3.SSS2.p3.1.m1.3.3.3.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3"><csymbol cd="ambiguous" id="S4.SS3.SSS2.p3.1.m1.3.3.3.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3">subscript</csymbol><ci id="S4.SS3.SSS2.p3.1.m1.3.3.3.2.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.2">𝑃</ci><apply id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3"><times id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.1"></times><ci id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.2.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.2">𝐿</ci><ci id="S4.SS3.SSS2.p3.1.m1.3.3.3.3.3.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.3.3.3">𝑀</ci></apply></apply><apply id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1"><csymbol cd="latexml" id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.1">conditional</csymbol><ci id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.2.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.2">𝑦</ci><list id="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.3.3.1.1.1.3.2"><ci id="S4.SS3.SSS2.p3.1.m1.1.1.cmml" xref="S4.SS3.SSS2.p3.1.m1.1.1">𝑑</ci><ci id="S4.SS3.SSS2.p3.1.m1.2.2.cmml" xref="S4.SS3.SSS2.p3.1.m1.2.2">𝑞</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.1.m1.3c">P_{LM}(y|d,q)</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.1.m1.3d">italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_y | italic_d , italic_q )</annotation></semantics></math> is LM probability of the ground truth output <math alttext="y" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p3.2.m2.1"><semantics id="S4.SS3.SSS2.p3.2.m2.1a"><mi id="S4.SS3.SSS2.p3.2.m2.1.1" xref="S4.SS3.SSS2.p3.2.m2.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p3.2.m2.1b"><ci id="S4.SS3.SSS2.p3.2.m2.1.1.cmml" xref="S4.SS3.SSS2.p3.2.m2.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.2.m2.1c">y</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.2.m2.1d">italic_y</annotation></semantics></math> given the input context <math alttext="d" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p3.3.m3.1"><semantics id="S4.SS3.SSS2.p3.3.m3.1a"><mi id="S4.SS3.SSS2.p3.3.m3.1.1" xref="S4.SS3.SSS2.p3.3.m3.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p3.3.m3.1b"><ci id="S4.SS3.SSS2.p3.3.m3.1.1.cmml" xref="S4.SS3.SSS2.p3.3.m3.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.3.m3.1c">d</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.3.m3.1d">italic_d</annotation></semantics></math> and query <math alttext="q" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p3.4.m4.1"><semantics id="S4.SS3.SSS2.p3.4.m4.1a"><mi id="S4.SS3.SSS2.p3.4.m4.1.1" xref="S4.SS3.SSS2.p3.4.m4.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p3.4.m4.1b"><ci id="S4.SS3.SSS2.p3.4.m4.1.1.cmml" xref="S4.SS3.SSS2.p3.4.m4.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.4.m4.1c">q</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.4.m4.1d">italic_q</annotation></semantics></math>, and <math alttext="\beta" class="ltx_Math" display="inline" id="S4.SS3.SSS2.p3.5.m5.1"><semantics id="S4.SS3.SSS2.p3.5.m5.1a"><mi id="S4.SS3.SSS2.p3.5.m5.1.1" xref="S4.SS3.SSS2.p3.5.m5.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS2.p3.5.m5.1b"><ci id="S4.SS3.SSS2.p3.5.m5.1.1.cmml" xref="S4.SS3.SSS2.p3.5.m5.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.5.m5.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.5.m5.1d">italic_β</annotation></semantics></math> is a hyperparamter.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p4">
<p class="ltx_p" id="S4.SS3.SSS2.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.SSS2.p4.1.1">Adapter.</span> At times, fine-tuning a large retriever can be costly, especially when dealing with retrievers based on LLMs like gte-Qwen. In such cases, it can mitigate this by incorporating an adapter module and conducting fine-tuning. Another benefit of adding an adapter is the ability to achieve better alignment with specific downstream tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib42" title="">42</a>]</cite>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS4.5.1.1">IV-D</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS4.6.2">Post-retrieval</span>
</h3>
<div class="ltx_para" id="S4.SS4.p1">
<p class="ltx_p" id="S4.SS4.p1.1">Feeding all retrieved chunks directly into the LLM is not an optimal choice. Post-processing the chunks can aid in better leveraging the contextual information. The primary challenges include:
<span class="ltx_text ltx_font_bold" id="S4.SS4.p1.1.1">1) Lost in the middle</span>. Like humans, LLM tends to remember only the beginning or the end of long texts, while forgetting the middle portion <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib43" title="">43</a>]</cite>.
<span class="ltx_text ltx_font_bold" id="S4.SS4.p1.1.2">2) Noise/anti-fact chunks</span>. Retrieved noisy or factually contradictory documents can impact the final retrieval generation <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib44" title="">44</a>]</cite>. 
<span class="ltx_text ltx_font_bold" id="S4.SS4.p1.1.3">3) Context Window</span>. Despite retrieving a substantial amount of relevant content, the limitation on the length of contextual information in large models prevents the inclusion of all this content.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS4.SSS1.5.1.1">IV-D</span>1 </span>Rerank</h4>
<div class="ltx_para" id="S4.SS4.SSS1.p1">
<p class="ltx_p" id="S4.SS4.SSS1.p1.2">Rerank the retrieved chunks without altering their content or length, to enhance the visibility of the more crucial document chunks. Given the retrieved set <math alttext="D^{q}" class="ltx_Math" display="inline" id="S4.SS4.SSS1.p1.1.m1.1"><semantics id="S4.SS4.SSS1.p1.1.m1.1a"><msup id="S4.SS4.SSS1.p1.1.m1.1.1" xref="S4.SS4.SSS1.p1.1.m1.1.1.cmml"><mi id="S4.SS4.SSS1.p1.1.m1.1.1.2" xref="S4.SS4.SSS1.p1.1.m1.1.1.2.cmml">D</mi><mi id="S4.SS4.SSS1.p1.1.m1.1.1.3" xref="S4.SS4.SSS1.p1.1.m1.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS1.p1.1.m1.1b"><apply id="S4.SS4.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS4.SSS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS1.p1.1.m1.1.1.1.cmml" xref="S4.SS4.SSS1.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS4.SSS1.p1.1.m1.1.1.2.cmml" xref="S4.SS4.SSS1.p1.1.m1.1.1.2">𝐷</ci><ci id="S4.SS4.SSS1.p1.1.m1.1.1.3.cmml" xref="S4.SS4.SSS1.p1.1.m1.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS1.p1.1.m1.1c">D^{q}</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS1.p1.1.m1.1d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math> and a re-ranking method <math alttext="f_{rerank}" class="ltx_Math" display="inline" id="S4.SS4.SSS1.p1.2.m2.1"><semantics id="S4.SS4.SSS1.p1.2.m2.1a"><msub id="S4.SS4.SSS1.p1.2.m2.1.1" xref="S4.SS4.SSS1.p1.2.m2.1.1.cmml"><mi id="S4.SS4.SSS1.p1.2.m2.1.1.2" xref="S4.SS4.SSS1.p1.2.m2.1.1.2.cmml">f</mi><mrow id="S4.SS4.SSS1.p1.2.m2.1.1.3" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.cmml"><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.2" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.2.cmml">r</mi><mo id="S4.SS4.SSS1.p1.2.m2.1.1.3.1" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.3" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.3.cmml">e</mi><mo id="S4.SS4.SSS1.p1.2.m2.1.1.3.1a" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.4" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.4.cmml">r</mi><mo id="S4.SS4.SSS1.p1.2.m2.1.1.3.1b" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.5" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.5.cmml">a</mi><mo id="S4.SS4.SSS1.p1.2.m2.1.1.3.1c" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.6" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.6.cmml">n</mi><mo id="S4.SS4.SSS1.p1.2.m2.1.1.3.1d" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS1.p1.2.m2.1.1.3.7" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.7.cmml">k</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS1.p1.2.m2.1b"><apply id="S4.SS4.SSS1.p1.2.m2.1.1.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS1.p1.2.m2.1.1.1.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS4.SSS1.p1.2.m2.1.1.2.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.2">𝑓</ci><apply id="S4.SS4.SSS1.p1.2.m2.1.1.3.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3"><times id="S4.SS4.SSS1.p1.2.m2.1.1.3.1.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.1"></times><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.2.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.2">𝑟</ci><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.3.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.3">𝑒</ci><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.4.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.4">𝑟</ci><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.5.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.5">𝑎</ci><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.6.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.6">𝑛</ci><ci id="S4.SS4.SSS1.p1.2.m2.1.1.3.7.cmml" xref="S4.SS4.SSS1.p1.2.m2.1.1.3.7">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS1.p1.2.m2.1c">f_{rerank}</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS1.p1.2.m2.1d">italic_f start_POSTSUBSCRIPT italic_r italic_e italic_r italic_a italic_n italic_k end_POSTSUBSCRIPT</annotation></semantics></math> to obtain the re-ranked set:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="D^{q}_{r}=f_{rerank}(q,D^{q})=\{d_{1}^{\prime},d_{2}^{\prime},\ldots,d_{k}^{%
\prime}\}\\
\text{where}f(d^{\prime}_{1})\geq f(d^{\prime}_{2})\geq\ldots\geq f(d^{\prime}%
_{k})." class="ltx_Math" display="block" id="S4.E12.m1.58"><semantics id="S4.E12.m1.58a"><mtable displaystyle="true" id="S4.E12.m1.58.58.6" rowspacing="0pt"><mtr id="S4.E12.m1.58.58.6a"><mtd class="ltx_align_left" columnalign="left" id="S4.E12.m1.58.58.6b"><mrow id="S4.E12.m1.57.57.5.56.32.32"><msubsup id="S4.E12.m1.57.57.5.56.32.32.34"><mi id="S4.E12.m1.1.1.1.1.1.1" xref="S4.E12.m1.1.1.1.1.1.1.cmml">D</mi><mi id="S4.E12.m1.3.3.3.3.3.3.1" xref="S4.E12.m1.3.3.3.3.3.3.1.cmml">r</mi><mi id="S4.E12.m1.2.2.2.2.2.2.1" xref="S4.E12.m1.2.2.2.2.2.2.1.cmml">q</mi></msubsup><mo id="S4.E12.m1.4.4.4.4.4.4" xref="S4.E12.m1.4.4.4.4.4.4.cmml">=</mo><mrow id="S4.E12.m1.54.54.2.53.29.29.29"><msub id="S4.E12.m1.54.54.2.53.29.29.29.3"><mi id="S4.E12.m1.5.5.5.5.5.5" xref="S4.E12.m1.5.5.5.5.5.5.cmml">f</mi><mrow id="S4.E12.m1.6.6.6.6.6.6.1" xref="S4.E12.m1.6.6.6.6.6.6.1.cmml"><mi id="S4.E12.m1.6.6.6.6.6.6.1.2" xref="S4.E12.m1.6.6.6.6.6.6.1.2.cmml">r</mi><mo id="S4.E12.m1.6.6.6.6.6.6.1.1" xref="S4.E12.m1.6.6.6.6.6.6.1.1.cmml">⁢</mo><mi id="S4.E12.m1.6.6.6.6.6.6.1.3" xref="S4.E12.m1.6.6.6.6.6.6.1.3.cmml">e</mi><mo id="S4.E12.m1.6.6.6.6.6.6.1.1a" xref="S4.E12.m1.6.6.6.6.6.6.1.1.cmml">⁢</mo><mi id="S4.E12.m1.6.6.6.6.6.6.1.4" xref="S4.E12.m1.6.6.6.6.6.6.1.4.cmml">r</mi><mo id="S4.E12.m1.6.6.6.6.6.6.1.1b" xref="S4.E12.m1.6.6.6.6.6.6.1.1.cmml">⁢</mo><mi id="S4.E12.m1.6.6.6.6.6.6.1.5" xref="S4.E12.m1.6.6.6.6.6.6.1.5.cmml">a</mi><mo id="S4.E12.m1.6.6.6.6.6.6.1.1c" xref="S4.E12.m1.6.6.6.6.6.6.1.1.cmml">⁢</mo><mi id="S4.E12.m1.6.6.6.6.6.6.1.6" xref="S4.E12.m1.6.6.6.6.6.6.1.6.cmml">n</mi><mo id="S4.E12.m1.6.6.6.6.6.6.1.1d" xref="S4.E12.m1.6.6.6.6.6.6.1.1.cmml">⁢</mo><mi id="S4.E12.m1.6.6.6.6.6.6.1.7" xref="S4.E12.m1.6.6.6.6.6.6.1.7.cmml">k</mi></mrow></msub><mo id="S4.E12.m1.54.54.2.53.29.29.29.2" xref="S4.E12.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="S4.E12.m1.54.54.2.53.29.29.29.1.1"><mo id="S4.E12.m1.7.7.7.7.7.7" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">(</mo><mi id="S4.E12.m1.8.8.8.8.8.8" xref="S4.E12.m1.8.8.8.8.8.8.cmml">q</mi><mo id="S4.E12.m1.9.9.9.9.9.9" xref="S4.E12.m1.53.53.1.1.1.cmml">,</mo><msup id="S4.E12.m1.54.54.2.53.29.29.29.1.1.1"><mi id="S4.E12.m1.10.10.10.10.10.10" xref="S4.E12.m1.10.10.10.10.10.10.cmml">D</mi><mi id="S4.E12.m1.11.11.11.11.11.11.1" xref="S4.E12.m1.11.11.11.11.11.11.1.cmml">q</mi></msup><mo id="S4.E12.m1.12.12.12.12.12.12" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E12.m1.13.13.13.13.13.13" xref="S4.E12.m1.13.13.13.13.13.13.cmml">=</mo><mrow id="S4.E12.m1.57.57.5.56.32.32.32.3"><mo id="S4.E12.m1.14.14.14.14.14.14" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">{</mo><msubsup id="S4.E12.m1.55.55.3.54.30.30.30.1.1"><mi id="S4.E12.m1.15.15.15.15.15.15" xref="S4.E12.m1.15.15.15.15.15.15.cmml">d</mi><mn id="S4.E12.m1.16.16.16.16.16.16.1" xref="S4.E12.m1.16.16.16.16.16.16.1.cmml">1</mn><mo id="S4.E12.m1.17.17.17.17.17.17.1" xref="S4.E12.m1.17.17.17.17.17.17.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.18.18.18.18.18.18" xref="S4.E12.m1.53.53.1.1.1.cmml">,</mo><msubsup id="S4.E12.m1.56.56.4.55.31.31.31.2.2"><mi id="S4.E12.m1.19.19.19.19.19.19" xref="S4.E12.m1.19.19.19.19.19.19.cmml">d</mi><mn id="S4.E12.m1.20.20.20.20.20.20.1" xref="S4.E12.m1.20.20.20.20.20.20.1.cmml">2</mn><mo id="S4.E12.m1.21.21.21.21.21.21.1" xref="S4.E12.m1.21.21.21.21.21.21.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.22.22.22.22.22.22" xref="S4.E12.m1.53.53.1.1.1.cmml">,</mo><mi id="S4.E12.m1.23.23.23.23.23.23" mathvariant="normal" xref="S4.E12.m1.23.23.23.23.23.23.cmml">…</mi><mo id="S4.E12.m1.24.24.24.24.24.24" xref="S4.E12.m1.53.53.1.1.1.cmml">,</mo><msubsup id="S4.E12.m1.57.57.5.56.32.32.32.3.3"><mi id="S4.E12.m1.25.25.25.25.25.25" xref="S4.E12.m1.25.25.25.25.25.25.cmml">d</mi><mi id="S4.E12.m1.26.26.26.26.26.26.1" xref="S4.E12.m1.26.26.26.26.26.26.1.cmml">k</mi><mo id="S4.E12.m1.27.27.27.27.27.27.1" xref="S4.E12.m1.27.27.27.27.27.27.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.28.28.28.28.28.28" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">}</mo></mrow></mrow></mtd></mtr><mtr id="S4.E12.m1.58.58.6c"><mtd class="ltx_align_right" columnalign="right" id="S4.E12.m1.58.58.6d"><mrow id="S4.E12.m1.58.58.6.57.25.25.25"><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1"><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.1"><mtext id="S4.E12.m1.29.29.29.1.1.1" xref="S4.E12.m1.29.29.29.1.1.1a.cmml">where</mtext><mo id="S4.E12.m1.58.58.6.57.25.25.25.1.1.2" xref="S4.E12.m1.53.53.1.1.1.cmml">⁢</mo><mi id="S4.E12.m1.30.30.30.2.2.2" xref="S4.E12.m1.30.30.30.2.2.2.cmml">f</mi><mo id="S4.E12.m1.58.58.6.57.25.25.25.1.1.2a" xref="S4.E12.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.1.1.1"><mo id="S4.E12.m1.31.31.31.3.3.3" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">(</mo><msubsup id="S4.E12.m1.58.58.6.57.25.25.25.1.1.1.1.1"><mi id="S4.E12.m1.32.32.32.4.4.4" xref="S4.E12.m1.32.32.32.4.4.4.cmml">d</mi><mn id="S4.E12.m1.34.34.34.6.6.6.1" xref="S4.E12.m1.34.34.34.6.6.6.1.cmml">1</mn><mo id="S4.E12.m1.33.33.33.5.5.5.1" xref="S4.E12.m1.33.33.33.5.5.5.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.35.35.35.7.7.7" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E12.m1.36.36.36.8.8.8" xref="S4.E12.m1.36.36.36.8.8.8.cmml">≥</mo><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.2"><mi id="S4.E12.m1.37.37.37.9.9.9" xref="S4.E12.m1.37.37.37.9.9.9.cmml">f</mi><mo id="S4.E12.m1.58.58.6.57.25.25.25.1.2.2" xref="S4.E12.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.2.1.1"><mo id="S4.E12.m1.38.38.38.10.10.10" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">(</mo><msubsup id="S4.E12.m1.58.58.6.57.25.25.25.1.2.1.1.1"><mi id="S4.E12.m1.39.39.39.11.11.11" xref="S4.E12.m1.39.39.39.11.11.11.cmml">d</mi><mn id="S4.E12.m1.41.41.41.13.13.13.1" xref="S4.E12.m1.41.41.41.13.13.13.1.cmml">2</mn><mo id="S4.E12.m1.40.40.40.12.12.12.1" xref="S4.E12.m1.40.40.40.12.12.12.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.42.42.42.14.14.14" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E12.m1.43.43.43.15.15.15" xref="S4.E12.m1.43.43.43.15.15.15.cmml">≥</mo><mi id="S4.E12.m1.44.44.44.16.16.16" mathvariant="normal" xref="S4.E12.m1.44.44.44.16.16.16.cmml">…</mi><mo id="S4.E12.m1.45.45.45.17.17.17" xref="S4.E12.m1.45.45.45.17.17.17.cmml">≥</mo><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.3"><mi id="S4.E12.m1.46.46.46.18.18.18" xref="S4.E12.m1.46.46.46.18.18.18.cmml">f</mi><mo id="S4.E12.m1.58.58.6.57.25.25.25.1.3.2" xref="S4.E12.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="S4.E12.m1.58.58.6.57.25.25.25.1.3.1.1"><mo id="S4.E12.m1.47.47.47.19.19.19" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">(</mo><msubsup id="S4.E12.m1.58.58.6.57.25.25.25.1.3.1.1.1"><mi id="S4.E12.m1.48.48.48.20.20.20" xref="S4.E12.m1.48.48.48.20.20.20.cmml">d</mi><mi id="S4.E12.m1.50.50.50.22.22.22.1" xref="S4.E12.m1.50.50.50.22.22.22.1.cmml">k</mi><mo id="S4.E12.m1.49.49.49.21.21.21.1" xref="S4.E12.m1.49.49.49.21.21.21.1.cmml">′</mo></msubsup><mo id="S4.E12.m1.51.51.51.23.23.23" stretchy="false" xref="S4.E12.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S4.E12.m1.52.52.52.24.24.24" lspace="0em" xref="S4.E12.m1.53.53.1.1.1.cmml">.</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S4.E12.m1.58b"><apply id="S4.E12.m1.53.53.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><and id="S4.E12.m1.53.53.1.1.1a.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></and><apply id="S4.E12.m1.53.53.1.1.1b.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><eq id="S4.E12.m1.4.4.4.4.4.4.cmml" xref="S4.E12.m1.4.4.4.4.4.4"></eq><apply id="S4.E12.m1.53.53.1.1.1.9.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.9.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.9.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.9.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><ci id="S4.E12.m1.1.1.1.1.1.1.cmml" xref="S4.E12.m1.1.1.1.1.1.1">𝐷</ci><ci id="S4.E12.m1.2.2.2.2.2.2.1.cmml" xref="S4.E12.m1.2.2.2.2.2.2.1">𝑞</ci></apply><ci id="S4.E12.m1.3.3.3.3.3.3.1.cmml" xref="S4.E12.m1.3.3.3.3.3.3.1">𝑟</ci></apply><apply id="S4.E12.m1.53.53.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><times id="S4.E12.m1.53.53.1.1.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></times><apply id="S4.E12.m1.53.53.1.1.1.1.3.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.1.3.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><ci id="S4.E12.m1.5.5.5.5.5.5.cmml" xref="S4.E12.m1.5.5.5.5.5.5">𝑓</ci><apply id="S4.E12.m1.6.6.6.6.6.6.1.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1"><times id="S4.E12.m1.6.6.6.6.6.6.1.1.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.1"></times><ci id="S4.E12.m1.6.6.6.6.6.6.1.2.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.2">𝑟</ci><ci id="S4.E12.m1.6.6.6.6.6.6.1.3.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.3">𝑒</ci><ci id="S4.E12.m1.6.6.6.6.6.6.1.4.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.4">𝑟</ci><ci id="S4.E12.m1.6.6.6.6.6.6.1.5.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.5">𝑎</ci><ci id="S4.E12.m1.6.6.6.6.6.6.1.6.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.6">𝑛</ci><ci id="S4.E12.m1.6.6.6.6.6.6.1.7.cmml" xref="S4.E12.m1.6.6.6.6.6.6.1.7">𝑘</ci></apply></apply><interval closure="open" id="S4.E12.m1.53.53.1.1.1.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><ci id="S4.E12.m1.8.8.8.8.8.8.cmml" xref="S4.E12.m1.8.8.8.8.8.8">𝑞</ci><apply id="S4.E12.m1.53.53.1.1.1.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.1.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><ci id="S4.E12.m1.10.10.10.10.10.10.cmml" xref="S4.E12.m1.10.10.10.10.10.10">𝐷</ci><ci id="S4.E12.m1.11.11.11.11.11.11.1.cmml" xref="S4.E12.m1.11.11.11.11.11.11.1">𝑞</ci></apply></interval></apply></apply><apply id="S4.E12.m1.53.53.1.1.1c.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><eq id="S4.E12.m1.13.13.13.13.13.13.cmml" xref="S4.E12.m1.13.13.13.13.13.13"></eq><share href="https://arxiv.org/html/2407.21059v1#S4.E12.m1.53.53.1.1.1.1.cmml" id="S4.E12.m1.53.53.1.1.1d.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></share><apply id="S4.E12.m1.53.53.1.1.1.5.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><times id="S4.E12.m1.53.53.1.1.1.5.5.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></times><set id="S4.E12.m1.53.53.1.1.1.4.3.4.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><apply id="S4.E12.m1.53.53.1.1.1.2.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.2.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.2.1.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.2.1.1.1.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><ci id="S4.E12.m1.15.15.15.15.15.15.cmml" xref="S4.E12.m1.15.15.15.15.15.15">𝑑</ci><cn id="S4.E12.m1.16.16.16.16.16.16.1.cmml" type="integer" xref="S4.E12.m1.16.16.16.16.16.16.1">1</cn></apply><ci id="S4.E12.m1.17.17.17.17.17.17.1.cmml" xref="S4.E12.m1.17.17.17.17.17.17.1">′</ci></apply><apply id="S4.E12.m1.53.53.1.1.1.3.2.2.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.3.2.2.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.3.2.2.2.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.3.2.2.2.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><ci id="S4.E12.m1.19.19.19.19.19.19.cmml" xref="S4.E12.m1.19.19.19.19.19.19">𝑑</ci><cn id="S4.E12.m1.20.20.20.20.20.20.1.cmml" type="integer" xref="S4.E12.m1.20.20.20.20.20.20.1">2</cn></apply><ci id="S4.E12.m1.21.21.21.21.21.21.1.cmml" xref="S4.E12.m1.21.21.21.21.21.21.1">′</ci></apply><ci id="S4.E12.m1.23.23.23.23.23.23.cmml" xref="S4.E12.m1.23.23.23.23.23.23">…</ci><apply id="S4.E12.m1.53.53.1.1.1.4.3.3.3.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.4.3.3.3.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.4.3.3.3.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.4.3.3.3.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><ci id="S4.E12.m1.25.25.25.25.25.25.cmml" xref="S4.E12.m1.25.25.25.25.25.25">𝑑</ci><ci id="S4.E12.m1.26.26.26.26.26.26.1.cmml" xref="S4.E12.m1.26.26.26.26.26.26.1">𝑘</ci></apply><ci id="S4.E12.m1.27.27.27.27.27.27.1.cmml" xref="S4.E12.m1.27.27.27.27.27.27.1">′</ci></apply></set><ci id="S4.E12.m1.29.29.29.1.1.1a.cmml" xref="S4.E12.m1.29.29.29.1.1.1"><mtext id="S4.E12.m1.29.29.29.1.1.1.cmml" xref="S4.E12.m1.29.29.29.1.1.1">where</mtext></ci><ci id="S4.E12.m1.30.30.30.2.2.2.cmml" xref="S4.E12.m1.30.30.30.2.2.2">𝑓</ci><apply id="S4.E12.m1.53.53.1.1.1.5.4.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.5.4.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.5.4.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.5.4.1.1.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><ci id="S4.E12.m1.32.32.32.4.4.4.cmml" xref="S4.E12.m1.32.32.32.4.4.4">𝑑</ci><ci id="S4.E12.m1.33.33.33.5.5.5.1.cmml" xref="S4.E12.m1.33.33.33.5.5.5.1">′</ci></apply><cn id="S4.E12.m1.34.34.34.6.6.6.1.cmml" type="integer" xref="S4.E12.m1.34.34.34.6.6.6.1">1</cn></apply></apply></apply><apply id="S4.E12.m1.53.53.1.1.1e.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><geq id="S4.E12.m1.36.36.36.8.8.8.cmml" xref="S4.E12.m1.36.36.36.8.8.8"></geq><share href="https://arxiv.org/html/2407.21059v1#S4.E12.m1.53.53.1.1.1.5.cmml" id="S4.E12.m1.53.53.1.1.1f.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></share><apply id="S4.E12.m1.53.53.1.1.1.6.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><times id="S4.E12.m1.53.53.1.1.1.6.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></times><ci id="S4.E12.m1.37.37.37.9.9.9.cmml" xref="S4.E12.m1.37.37.37.9.9.9">𝑓</ci><apply id="S4.E12.m1.53.53.1.1.1.6.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.6.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.6.1.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.6.1.1.1.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><ci id="S4.E12.m1.39.39.39.11.11.11.cmml" xref="S4.E12.m1.39.39.39.11.11.11">𝑑</ci><ci id="S4.E12.m1.40.40.40.12.12.12.1.cmml" xref="S4.E12.m1.40.40.40.12.12.12.1">′</ci></apply><cn id="S4.E12.m1.41.41.41.13.13.13.1.cmml" type="integer" xref="S4.E12.m1.41.41.41.13.13.13.1">2</cn></apply></apply></apply><apply id="S4.E12.m1.53.53.1.1.1g.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><geq id="S4.E12.m1.43.43.43.15.15.15.cmml" xref="S4.E12.m1.43.43.43.15.15.15"></geq><share href="https://arxiv.org/html/2407.21059v1#S4.E12.m1.53.53.1.1.1.6.cmml" id="S4.E12.m1.53.53.1.1.1h.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></share><ci id="S4.E12.m1.44.44.44.16.16.16.cmml" xref="S4.E12.m1.44.44.44.16.16.16">…</ci></apply><apply id="S4.E12.m1.53.53.1.1.1i.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><geq id="S4.E12.m1.45.45.45.17.17.17.cmml" xref="S4.E12.m1.45.45.45.17.17.17"></geq><share href="https://arxiv.org/html/2407.21059v1#S4.E12.m1.53.53.1.1.1.14.cmml" id="S4.E12.m1.53.53.1.1.1j.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></share><apply id="S4.E12.m1.53.53.1.1.1.7.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><times id="S4.E12.m1.53.53.1.1.1.7.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"></times><ci id="S4.E12.m1.46.46.46.18.18.18.cmml" xref="S4.E12.m1.46.46.46.18.18.18">𝑓</ci><apply id="S4.E12.m1.53.53.1.1.1.7.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.7.1.1.1.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">subscript</csymbol><apply id="S4.E12.m1.53.53.1.1.1.7.1.1.1.2.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2"><csymbol cd="ambiguous" id="S4.E12.m1.53.53.1.1.1.7.1.1.1.2.1.cmml" xref="S4.E12.m1.54.54.2.53.29.29.29.2">superscript</csymbol><ci id="S4.E12.m1.48.48.48.20.20.20.cmml" xref="S4.E12.m1.48.48.48.20.20.20">𝑑</ci><ci id="S4.E12.m1.49.49.49.21.21.21.1.cmml" xref="S4.E12.m1.49.49.49.21.21.21.1">′</ci></apply><ci id="S4.E12.m1.50.50.50.22.22.22.1.cmml" xref="S4.E12.m1.50.50.50.22.22.22.1">𝑘</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E12.m1.58c">D^{q}_{r}=f_{rerank}(q,D^{q})=\{d_{1}^{\prime},d_{2}^{\prime},\ldots,d_{k}^{%
\prime}\}\\
\text{where}f(d^{\prime}_{1})\geq f(d^{\prime}_{2})\geq\ldots\geq f(d^{\prime}%
_{k}).</annotation><annotation encoding="application/x-llamapun" id="S4.E12.m1.58d">start_ROW start_CELL italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_r italic_e italic_r italic_a italic_n italic_k end_POSTSUBSCRIPT ( italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ) = { italic_d start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_d start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , … , italic_d start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT } end_CELL end_ROW start_ROW start_CELL where italic_f ( italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ≥ italic_f ( italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ≥ … ≥ italic_f ( italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(12)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p2">
<p class="ltx_p" id="S4.SS4.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p2.1.1">Rule-base rerank.</span> Metrics are calculated to rerank chunks according to certain rules. Common metrics include: diversity, relevance and MRR (Maximal Marginal Relevance) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib45" title="">45</a>]</cite>. The idea is to reduce redundancy and increase result diversity. MMR selects phrases for the final key phrase list based on a combined criterion of query relevance and information novelty.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p3">
<p class="ltx_p" id="S4.SS4.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p3.1.1">Model-base rerank.</span> Utilize a language model to reorder the document chunks, commonly based on the relevance between the chunks and the query. Rerank models have become an important component of RAG systems, and relevant model technologies are also being iteratively upgraded. The scope reordering has also been extended to multimodal data such as tables and images <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib46" title="">46</a>]</cite>.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS4.SSS2.5.1.1">IV-D</span>2 </span>Compression</h4>
<div class="ltx_para" id="S4.SS4.SSS2.p1">
<p class="ltx_p" id="S4.SS4.SSS2.p1.1">A common misconception in the RAG process is the belief that retrieving as many relevant documents as possible and concatenating them to form a lengthy retrieval prompt is beneficial. However, excessive context can introduce more noise, diminishing the LLM’s perception of key information. A common approach to address this is to compress and select the retrieved content.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E13">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="D^{q}_{c}=f_{comp}(q,D^{q}),\quad\text{where}|d_{i}^{q_{c}}|&lt;|d_{i}^{q}|\quad%
\forall d_{i}^{q}\in D^{q}" class="ltx_Math" display="block" id="S4.E13.m1.3"><semantics id="S4.E13.m1.3a"><mrow id="S4.E13.m1.3.3.2" xref="S4.E13.m1.3.3.3.cmml"><mrow id="S4.E13.m1.2.2.1.1" xref="S4.E13.m1.2.2.1.1.cmml"><msubsup id="S4.E13.m1.2.2.1.1.3" xref="S4.E13.m1.2.2.1.1.3.cmml"><mi id="S4.E13.m1.2.2.1.1.3.2.2" xref="S4.E13.m1.2.2.1.1.3.2.2.cmml">D</mi><mi id="S4.E13.m1.2.2.1.1.3.3" xref="S4.E13.m1.2.2.1.1.3.3.cmml">c</mi><mi id="S4.E13.m1.2.2.1.1.3.2.3" xref="S4.E13.m1.2.2.1.1.3.2.3.cmml">q</mi></msubsup><mo id="S4.E13.m1.2.2.1.1.2" xref="S4.E13.m1.2.2.1.1.2.cmml">=</mo><mrow id="S4.E13.m1.2.2.1.1.1" xref="S4.E13.m1.2.2.1.1.1.cmml"><msub id="S4.E13.m1.2.2.1.1.1.3" xref="S4.E13.m1.2.2.1.1.1.3.cmml"><mi id="S4.E13.m1.2.2.1.1.1.3.2" xref="S4.E13.m1.2.2.1.1.1.3.2.cmml">f</mi><mrow id="S4.E13.m1.2.2.1.1.1.3.3" xref="S4.E13.m1.2.2.1.1.1.3.3.cmml"><mi id="S4.E13.m1.2.2.1.1.1.3.3.2" xref="S4.E13.m1.2.2.1.1.1.3.3.2.cmml">c</mi><mo id="S4.E13.m1.2.2.1.1.1.3.3.1" xref="S4.E13.m1.2.2.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E13.m1.2.2.1.1.1.3.3.3" xref="S4.E13.m1.2.2.1.1.1.3.3.3.cmml">o</mi><mo id="S4.E13.m1.2.2.1.1.1.3.3.1a" xref="S4.E13.m1.2.2.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E13.m1.2.2.1.1.1.3.3.4" xref="S4.E13.m1.2.2.1.1.1.3.3.4.cmml">m</mi><mo id="S4.E13.m1.2.2.1.1.1.3.3.1b" xref="S4.E13.m1.2.2.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E13.m1.2.2.1.1.1.3.3.5" xref="S4.E13.m1.2.2.1.1.1.3.3.5.cmml">p</mi></mrow></msub><mo id="S4.E13.m1.2.2.1.1.1.2" xref="S4.E13.m1.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S4.E13.m1.2.2.1.1.1.1.1" xref="S4.E13.m1.2.2.1.1.1.1.2.cmml"><mo id="S4.E13.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="S4.E13.m1.2.2.1.1.1.1.2.cmml">(</mo><mi id="S4.E13.m1.1.1" xref="S4.E13.m1.1.1.cmml">q</mi><mo id="S4.E13.m1.2.2.1.1.1.1.1.3" xref="S4.E13.m1.2.2.1.1.1.1.2.cmml">,</mo><msup id="S4.E13.m1.2.2.1.1.1.1.1.1" xref="S4.E13.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S4.E13.m1.2.2.1.1.1.1.1.1.2" xref="S4.E13.m1.2.2.1.1.1.1.1.1.2.cmml">D</mi><mi id="S4.E13.m1.2.2.1.1.1.1.1.1.3" xref="S4.E13.m1.2.2.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="S4.E13.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="S4.E13.m1.2.2.1.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S4.E13.m1.3.3.2.3" rspace="1.167em" xref="S4.E13.m1.3.3.3a.cmml">,</mo><mrow id="S4.E13.m1.3.3.2.2.2" xref="S4.E13.m1.3.3.2.2.3.cmml"><mrow id="S4.E13.m1.3.3.2.2.1.1" xref="S4.E13.m1.3.3.2.2.1.1.cmml"><mrow id="S4.E13.m1.3.3.2.2.1.1.1" xref="S4.E13.m1.3.3.2.2.1.1.1.cmml"><mtext id="S4.E13.m1.3.3.2.2.1.1.1.3" xref="S4.E13.m1.3.3.2.2.1.1.1.3a.cmml">where</mtext><mo id="S4.E13.m1.3.3.2.2.1.1.1.2" xref="S4.E13.m1.3.3.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S4.E13.m1.3.3.2.2.1.1.1.1.1" xref="S4.E13.m1.3.3.2.2.1.1.1.1.2.cmml"><mo id="S4.E13.m1.3.3.2.2.1.1.1.1.1.2" stretchy="false" xref="S4.E13.m1.3.3.2.2.1.1.1.1.2.1.cmml">|</mo><msubsup id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.cmml"><mi id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.2" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.2.cmml">d</mi><mi id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.3" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.3.cmml">i</mi><msub id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.cmml"><mi id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.2" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.2.cmml">q</mi><mi id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.3" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.3.cmml">c</mi></msub></msubsup><mo id="S4.E13.m1.3.3.2.2.1.1.1.1.1.3" stretchy="false" xref="S4.E13.m1.3.3.2.2.1.1.1.1.2.1.cmml">|</mo></mrow></mrow><mo id="S4.E13.m1.3.3.2.2.1.1.3" xref="S4.E13.m1.3.3.2.2.1.1.3.cmml">&lt;</mo><mrow id="S4.E13.m1.3.3.2.2.1.1.2.1" xref="S4.E13.m1.3.3.2.2.1.1.2.2.cmml"><mo id="S4.E13.m1.3.3.2.2.1.1.2.1.2" stretchy="false" xref="S4.E13.m1.3.3.2.2.1.1.2.2.1.cmml">|</mo><msubsup id="S4.E13.m1.3.3.2.2.1.1.2.1.1" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.cmml"><mi id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.2" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.2.cmml">d</mi><mi id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.3" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.3.cmml">i</mi><mi id="S4.E13.m1.3.3.2.2.1.1.2.1.1.3" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.3.cmml">q</mi></msubsup><mo id="S4.E13.m1.3.3.2.2.1.1.2.1.3" stretchy="false" xref="S4.E13.m1.3.3.2.2.1.1.2.2.1.cmml">|</mo></mrow></mrow><mspace id="S4.E13.m1.3.3.2.2.2.3" width="1.167em" xref="S4.E13.m1.3.3.2.2.3a.cmml"></mspace><mrow id="S4.E13.m1.3.3.2.2.2.2" xref="S4.E13.m1.3.3.2.2.2.2.cmml"><mrow id="S4.E13.m1.3.3.2.2.2.2.2" xref="S4.E13.m1.3.3.2.2.2.2.2.cmml"><mo id="S4.E13.m1.3.3.2.2.2.2.2.1" rspace="0.167em" xref="S4.E13.m1.3.3.2.2.2.2.2.1.cmml">∀</mo><msubsup id="S4.E13.m1.3.3.2.2.2.2.2.2" xref="S4.E13.m1.3.3.2.2.2.2.2.2.cmml"><mi id="S4.E13.m1.3.3.2.2.2.2.2.2.2.2" xref="S4.E13.m1.3.3.2.2.2.2.2.2.2.2.cmml">d</mi><mi id="S4.E13.m1.3.3.2.2.2.2.2.2.2.3" xref="S4.E13.m1.3.3.2.2.2.2.2.2.2.3.cmml">i</mi><mi id="S4.E13.m1.3.3.2.2.2.2.2.2.3" xref="S4.E13.m1.3.3.2.2.2.2.2.2.3.cmml">q</mi></msubsup></mrow><mo id="S4.E13.m1.3.3.2.2.2.2.1" xref="S4.E13.m1.3.3.2.2.2.2.1.cmml">∈</mo><msup id="S4.E13.m1.3.3.2.2.2.2.3" xref="S4.E13.m1.3.3.2.2.2.2.3.cmml"><mi id="S4.E13.m1.3.3.2.2.2.2.3.2" xref="S4.E13.m1.3.3.2.2.2.2.3.2.cmml">D</mi><mi id="S4.E13.m1.3.3.2.2.2.2.3.3" xref="S4.E13.m1.3.3.2.2.2.2.3.3.cmml">q</mi></msup></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E13.m1.3b"><apply id="S4.E13.m1.3.3.3.cmml" xref="S4.E13.m1.3.3.2"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.3a.cmml" xref="S4.E13.m1.3.3.2.3">formulae-sequence</csymbol><apply id="S4.E13.m1.2.2.1.1.cmml" xref="S4.E13.m1.2.2.1.1"><eq id="S4.E13.m1.2.2.1.1.2.cmml" xref="S4.E13.m1.2.2.1.1.2"></eq><apply id="S4.E13.m1.2.2.1.1.3.cmml" xref="S4.E13.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S4.E13.m1.2.2.1.1.3.1.cmml" xref="S4.E13.m1.2.2.1.1.3">subscript</csymbol><apply id="S4.E13.m1.2.2.1.1.3.2.cmml" xref="S4.E13.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S4.E13.m1.2.2.1.1.3.2.1.cmml" xref="S4.E13.m1.2.2.1.1.3">superscript</csymbol><ci id="S4.E13.m1.2.2.1.1.3.2.2.cmml" xref="S4.E13.m1.2.2.1.1.3.2.2">𝐷</ci><ci id="S4.E13.m1.2.2.1.1.3.2.3.cmml" xref="S4.E13.m1.2.2.1.1.3.2.3">𝑞</ci></apply><ci id="S4.E13.m1.2.2.1.1.3.3.cmml" xref="S4.E13.m1.2.2.1.1.3.3">𝑐</ci></apply><apply id="S4.E13.m1.2.2.1.1.1.cmml" xref="S4.E13.m1.2.2.1.1.1"><times id="S4.E13.m1.2.2.1.1.1.2.cmml" xref="S4.E13.m1.2.2.1.1.1.2"></times><apply id="S4.E13.m1.2.2.1.1.1.3.cmml" xref="S4.E13.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S4.E13.m1.2.2.1.1.1.3.1.cmml" xref="S4.E13.m1.2.2.1.1.1.3">subscript</csymbol><ci id="S4.E13.m1.2.2.1.1.1.3.2.cmml" xref="S4.E13.m1.2.2.1.1.1.3.2">𝑓</ci><apply id="S4.E13.m1.2.2.1.1.1.3.3.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3"><times id="S4.E13.m1.2.2.1.1.1.3.3.1.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3.1"></times><ci id="S4.E13.m1.2.2.1.1.1.3.3.2.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3.2">𝑐</ci><ci id="S4.E13.m1.2.2.1.1.1.3.3.3.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3.3">𝑜</ci><ci id="S4.E13.m1.2.2.1.1.1.3.3.4.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3.4">𝑚</ci><ci id="S4.E13.m1.2.2.1.1.1.3.3.5.cmml" xref="S4.E13.m1.2.2.1.1.1.3.3.5">𝑝</ci></apply></apply><interval closure="open" id="S4.E13.m1.2.2.1.1.1.1.2.cmml" xref="S4.E13.m1.2.2.1.1.1.1.1"><ci id="S4.E13.m1.1.1.cmml" xref="S4.E13.m1.1.1">𝑞</ci><apply id="S4.E13.m1.2.2.1.1.1.1.1.1.cmml" xref="S4.E13.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E13.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E13.m1.2.2.1.1.1.1.1.1">superscript</csymbol><ci id="S4.E13.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S4.E13.m1.2.2.1.1.1.1.1.1.2">𝐷</ci><ci id="S4.E13.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S4.E13.m1.2.2.1.1.1.1.1.1.3">𝑞</ci></apply></interval></apply></apply><apply id="S4.E13.m1.3.3.2.2.3.cmml" xref="S4.E13.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.3a.cmml" xref="S4.E13.m1.3.3.2.2.2.3">formulae-sequence</csymbol><apply id="S4.E13.m1.3.3.2.2.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1"><lt id="S4.E13.m1.3.3.2.2.1.1.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.3"></lt><apply id="S4.E13.m1.3.3.2.2.1.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1"><times id="S4.E13.m1.3.3.2.2.1.1.1.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.2"></times><ci id="S4.E13.m1.3.3.2.2.1.1.1.3a.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.3"><mtext id="S4.E13.m1.3.3.2.2.1.1.1.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.3">where</mtext></ci><apply id="S4.E13.m1.3.3.2.2.1.1.1.1.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1"><abs id="S4.E13.m1.3.3.2.2.1.1.1.1.2.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.2"></abs><apply id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.2">𝑑</ci><ci id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.2">𝑞</ci><ci id="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.1.1.1.1.3.3">𝑐</ci></apply></apply></apply></apply><apply id="S4.E13.m1.3.3.2.2.1.1.2.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1"><abs id="S4.E13.m1.3.3.2.2.1.1.2.2.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.2"></abs><apply id="S4.E13.m1.3.3.2.2.1.1.2.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.1.1.2.1.1.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1">superscript</csymbol><apply id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.1.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1">subscript</csymbol><ci id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.2.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.2">𝑑</ci><ci id="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.2.3">𝑖</ci></apply><ci id="S4.E13.m1.3.3.2.2.1.1.2.1.1.3.cmml" xref="S4.E13.m1.3.3.2.2.1.1.2.1.1.3">𝑞</ci></apply></apply></apply><apply id="S4.E13.m1.3.3.2.2.2.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2"><in id="S4.E13.m1.3.3.2.2.2.2.1.cmml" xref="S4.E13.m1.3.3.2.2.2.2.1"></in><apply id="S4.E13.m1.3.3.2.2.2.2.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2"><csymbol cd="latexml" id="S4.E13.m1.3.3.2.2.2.2.2.1.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.1">for-all</csymbol><apply id="S4.E13.m1.3.3.2.2.2.2.2.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.2.2.2.2.1.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2">superscript</csymbol><apply id="S4.E13.m1.3.3.2.2.2.2.2.2.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.2.2.2.2.2.1.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2">subscript</csymbol><ci id="S4.E13.m1.3.3.2.2.2.2.2.2.2.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2.2.2">𝑑</ci><ci id="S4.E13.m1.3.3.2.2.2.2.2.2.2.3.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2.2.3">𝑖</ci></apply><ci id="S4.E13.m1.3.3.2.2.2.2.2.2.3.cmml" xref="S4.E13.m1.3.3.2.2.2.2.2.2.3">𝑞</ci></apply></apply><apply id="S4.E13.m1.3.3.2.2.2.2.3.cmml" xref="S4.E13.m1.3.3.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.E13.m1.3.3.2.2.2.2.3.1.cmml" xref="S4.E13.m1.3.3.2.2.2.2.3">superscript</csymbol><ci id="S4.E13.m1.3.3.2.2.2.2.3.2.cmml" xref="S4.E13.m1.3.3.2.2.2.2.3.2">𝐷</ci><ci id="S4.E13.m1.3.3.2.2.2.2.3.3.cmml" xref="S4.E13.m1.3.3.2.2.2.2.3.3">𝑞</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E13.m1.3c">D^{q}_{c}=f_{comp}(q,D^{q}),\quad\text{where}|d_{i}^{q_{c}}|&lt;|d_{i}^{q}|\quad%
\forall d_{i}^{q}\in D^{q}</annotation><annotation encoding="application/x-llamapun" id="S4.E13.m1.3d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_c italic_o italic_m italic_p end_POSTSUBSCRIPT ( italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ) , where | italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_q start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT end_POSTSUPERSCRIPT | &lt; | italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT | ∀ italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ∈ italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(13)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S4.SS4.SSS2.p2">
<p class="ltx_p" id="S4.SS4.SSS2.p2.1"><span class="ltx_text ltx_font_bold ltx_font_italic" id="S4.SS4.SSS2.p2.1.1">(Long)LLMLingua</span> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib47" title="">47</a>]</cite>. By utilizing aligned and trained small language models, such as GPT-2 Small or LLaMA-7B, the detection and removal of unimportant tokens from the prompt is achieved, transforming it into a form that is challenging for humans to comprehend but well understood by LLMs. This approach presents a direct and practical method for prompt compression, eliminating the need for additional training of LLMs while balancing language integrity and compression ratio.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS4.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS4.SSS3.5.1.1">IV-D</span>3 </span>Selection</h4>
<div class="ltx_para" id="S4.SS4.SSS3.p1">
<p class="ltx_p" id="S4.SS4.SSS3.p1.7">Unlike compressing the content of document chunks, Selection directly removes irrelevant chunks.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E14">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="D^{q}_{s}=f_{sel}(D^{q})=\{d_{i}\in D\mid\neg P(d_{i})\}" class="ltx_Math" display="block" id="S4.E14.m1.3"><semantics id="S4.E14.m1.3a"><mrow id="S4.E14.m1.3.3" xref="S4.E14.m1.3.3.cmml"><msubsup id="S4.E14.m1.3.3.5" xref="S4.E14.m1.3.3.5.cmml"><mi id="S4.E14.m1.3.3.5.2.2" xref="S4.E14.m1.3.3.5.2.2.cmml">D</mi><mi id="S4.E14.m1.3.3.5.3" xref="S4.E14.m1.3.3.5.3.cmml">s</mi><mi id="S4.E14.m1.3.3.5.2.3" xref="S4.E14.m1.3.3.5.2.3.cmml">q</mi></msubsup><mo id="S4.E14.m1.3.3.6" xref="S4.E14.m1.3.3.6.cmml">=</mo><mrow id="S4.E14.m1.1.1.1" xref="S4.E14.m1.1.1.1.cmml"><msub id="S4.E14.m1.1.1.1.3" xref="S4.E14.m1.1.1.1.3.cmml"><mi id="S4.E14.m1.1.1.1.3.2" xref="S4.E14.m1.1.1.1.3.2.cmml">f</mi><mrow id="S4.E14.m1.1.1.1.3.3" xref="S4.E14.m1.1.1.1.3.3.cmml"><mi id="S4.E14.m1.1.1.1.3.3.2" xref="S4.E14.m1.1.1.1.3.3.2.cmml">s</mi><mo id="S4.E14.m1.1.1.1.3.3.1" xref="S4.E14.m1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E14.m1.1.1.1.3.3.3" xref="S4.E14.m1.1.1.1.3.3.3.cmml">e</mi><mo id="S4.E14.m1.1.1.1.3.3.1a" xref="S4.E14.m1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E14.m1.1.1.1.3.3.4" xref="S4.E14.m1.1.1.1.3.3.4.cmml">l</mi></mrow></msub><mo id="S4.E14.m1.1.1.1.2" xref="S4.E14.m1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E14.m1.1.1.1.1.1" xref="S4.E14.m1.1.1.1.1.1.1.cmml"><mo id="S4.E14.m1.1.1.1.1.1.2" stretchy="false" xref="S4.E14.m1.1.1.1.1.1.1.cmml">(</mo><msup id="S4.E14.m1.1.1.1.1.1.1" xref="S4.E14.m1.1.1.1.1.1.1.cmml"><mi id="S4.E14.m1.1.1.1.1.1.1.2" xref="S4.E14.m1.1.1.1.1.1.1.2.cmml">D</mi><mi id="S4.E14.m1.1.1.1.1.1.1.3" xref="S4.E14.m1.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="S4.E14.m1.1.1.1.1.1.3" stretchy="false" xref="S4.E14.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E14.m1.3.3.7" xref="S4.E14.m1.3.3.7.cmml">=</mo><mrow id="S4.E14.m1.3.3.3.2" xref="S4.E14.m1.3.3.3.3.cmml"><mo id="S4.E14.m1.3.3.3.2.3" stretchy="false" xref="S4.E14.m1.3.3.3.3.1.cmml">{</mo><mrow id="S4.E14.m1.2.2.2.1.1" xref="S4.E14.m1.2.2.2.1.1.cmml"><msub id="S4.E14.m1.2.2.2.1.1.2" xref="S4.E14.m1.2.2.2.1.1.2.cmml"><mi id="S4.E14.m1.2.2.2.1.1.2.2" xref="S4.E14.m1.2.2.2.1.1.2.2.cmml">d</mi><mi id="S4.E14.m1.2.2.2.1.1.2.3" xref="S4.E14.m1.2.2.2.1.1.2.3.cmml">i</mi></msub><mo id="S4.E14.m1.2.2.2.1.1.1" xref="S4.E14.m1.2.2.2.1.1.1.cmml">∈</mo><mi id="S4.E14.m1.2.2.2.1.1.3" xref="S4.E14.m1.2.2.2.1.1.3.cmml">D</mi></mrow><mo fence="true" id="S4.E14.m1.3.3.3.2.4" lspace="0em" rspace="0.167em" xref="S4.E14.m1.3.3.3.3.1.cmml">∣</mo><mrow id="S4.E14.m1.3.3.3.2.2" xref="S4.E14.m1.3.3.3.2.2.cmml"><mo id="S4.E14.m1.3.3.3.2.2.2" rspace="0.167em" xref="S4.E14.m1.3.3.3.2.2.2.cmml">¬</mo><mrow id="S4.E14.m1.3.3.3.2.2.1" xref="S4.E14.m1.3.3.3.2.2.1.cmml"><mi id="S4.E14.m1.3.3.3.2.2.1.3" xref="S4.E14.m1.3.3.3.2.2.1.3.cmml">P</mi><mo id="S4.E14.m1.3.3.3.2.2.1.2" xref="S4.E14.m1.3.3.3.2.2.1.2.cmml">⁢</mo><mrow id="S4.E14.m1.3.3.3.2.2.1.1.1" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.cmml"><mo id="S4.E14.m1.3.3.3.2.2.1.1.1.2" stretchy="false" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.cmml">(</mo><msub id="S4.E14.m1.3.3.3.2.2.1.1.1.1" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.cmml"><mi id="S4.E14.m1.3.3.3.2.2.1.1.1.1.2" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.2.cmml">d</mi><mi id="S4.E14.m1.3.3.3.2.2.1.1.1.1.3" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E14.m1.3.3.3.2.2.1.1.1.3" stretchy="false" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S4.E14.m1.3.3.3.2.5" stretchy="false" xref="S4.E14.m1.3.3.3.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E14.m1.3b"><apply id="S4.E14.m1.3.3.cmml" xref="S4.E14.m1.3.3"><and id="S4.E14.m1.3.3a.cmml" xref="S4.E14.m1.3.3"></and><apply id="S4.E14.m1.3.3b.cmml" xref="S4.E14.m1.3.3"><eq id="S4.E14.m1.3.3.6.cmml" xref="S4.E14.m1.3.3.6"></eq><apply id="S4.E14.m1.3.3.5.cmml" xref="S4.E14.m1.3.3.5"><csymbol cd="ambiguous" id="S4.E14.m1.3.3.5.1.cmml" xref="S4.E14.m1.3.3.5">subscript</csymbol><apply id="S4.E14.m1.3.3.5.2.cmml" xref="S4.E14.m1.3.3.5"><csymbol cd="ambiguous" id="S4.E14.m1.3.3.5.2.1.cmml" xref="S4.E14.m1.3.3.5">superscript</csymbol><ci id="S4.E14.m1.3.3.5.2.2.cmml" xref="S4.E14.m1.3.3.5.2.2">𝐷</ci><ci id="S4.E14.m1.3.3.5.2.3.cmml" xref="S4.E14.m1.3.3.5.2.3">𝑞</ci></apply><ci id="S4.E14.m1.3.3.5.3.cmml" xref="S4.E14.m1.3.3.5.3">𝑠</ci></apply><apply id="S4.E14.m1.1.1.1.cmml" xref="S4.E14.m1.1.1.1"><times id="S4.E14.m1.1.1.1.2.cmml" xref="S4.E14.m1.1.1.1.2"></times><apply id="S4.E14.m1.1.1.1.3.cmml" xref="S4.E14.m1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E14.m1.1.1.1.3.1.cmml" xref="S4.E14.m1.1.1.1.3">subscript</csymbol><ci id="S4.E14.m1.1.1.1.3.2.cmml" xref="S4.E14.m1.1.1.1.3.2">𝑓</ci><apply id="S4.E14.m1.1.1.1.3.3.cmml" xref="S4.E14.m1.1.1.1.3.3"><times id="S4.E14.m1.1.1.1.3.3.1.cmml" xref="S4.E14.m1.1.1.1.3.3.1"></times><ci id="S4.E14.m1.1.1.1.3.3.2.cmml" xref="S4.E14.m1.1.1.1.3.3.2">𝑠</ci><ci id="S4.E14.m1.1.1.1.3.3.3.cmml" xref="S4.E14.m1.1.1.1.3.3.3">𝑒</ci><ci id="S4.E14.m1.1.1.1.3.3.4.cmml" xref="S4.E14.m1.1.1.1.3.3.4">𝑙</ci></apply></apply><apply id="S4.E14.m1.1.1.1.1.1.1.cmml" xref="S4.E14.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E14.m1.1.1.1.1.1.1.1.cmml" xref="S4.E14.m1.1.1.1.1.1">superscript</csymbol><ci id="S4.E14.m1.1.1.1.1.1.1.2.cmml" xref="S4.E14.m1.1.1.1.1.1.1.2">𝐷</ci><ci id="S4.E14.m1.1.1.1.1.1.1.3.cmml" xref="S4.E14.m1.1.1.1.1.1.1.3">𝑞</ci></apply></apply></apply><apply id="S4.E14.m1.3.3c.cmml" xref="S4.E14.m1.3.3"><eq id="S4.E14.m1.3.3.7.cmml" xref="S4.E14.m1.3.3.7"></eq><share href="https://arxiv.org/html/2407.21059v1#S4.E14.m1.1.1.1.cmml" id="S4.E14.m1.3.3d.cmml" xref="S4.E14.m1.3.3"></share><apply id="S4.E14.m1.3.3.3.3.cmml" xref="S4.E14.m1.3.3.3.2"><csymbol cd="latexml" id="S4.E14.m1.3.3.3.3.1.cmml" xref="S4.E14.m1.3.3.3.2.3">conditional-set</csymbol><apply id="S4.E14.m1.2.2.2.1.1.cmml" xref="S4.E14.m1.2.2.2.1.1"><in id="S4.E14.m1.2.2.2.1.1.1.cmml" xref="S4.E14.m1.2.2.2.1.1.1"></in><apply id="S4.E14.m1.2.2.2.1.1.2.cmml" xref="S4.E14.m1.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S4.E14.m1.2.2.2.1.1.2.1.cmml" xref="S4.E14.m1.2.2.2.1.1.2">subscript</csymbol><ci id="S4.E14.m1.2.2.2.1.1.2.2.cmml" xref="S4.E14.m1.2.2.2.1.1.2.2">𝑑</ci><ci id="S4.E14.m1.2.2.2.1.1.2.3.cmml" xref="S4.E14.m1.2.2.2.1.1.2.3">𝑖</ci></apply><ci id="S4.E14.m1.2.2.2.1.1.3.cmml" xref="S4.E14.m1.2.2.2.1.1.3">𝐷</ci></apply><apply id="S4.E14.m1.3.3.3.2.2.cmml" xref="S4.E14.m1.3.3.3.2.2"><not id="S4.E14.m1.3.3.3.2.2.2.cmml" xref="S4.E14.m1.3.3.3.2.2.2"></not><apply id="S4.E14.m1.3.3.3.2.2.1.cmml" xref="S4.E14.m1.3.3.3.2.2.1"><times id="S4.E14.m1.3.3.3.2.2.1.2.cmml" xref="S4.E14.m1.3.3.3.2.2.1.2"></times><ci id="S4.E14.m1.3.3.3.2.2.1.3.cmml" xref="S4.E14.m1.3.3.3.2.2.1.3">𝑃</ci><apply id="S4.E14.m1.3.3.3.2.2.1.1.1.1.cmml" xref="S4.E14.m1.3.3.3.2.2.1.1.1"><csymbol cd="ambiguous" id="S4.E14.m1.3.3.3.2.2.1.1.1.1.1.cmml" xref="S4.E14.m1.3.3.3.2.2.1.1.1">subscript</csymbol><ci id="S4.E14.m1.3.3.3.2.2.1.1.1.1.2.cmml" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.2">𝑑</ci><ci id="S4.E14.m1.3.3.3.2.2.1.1.1.1.3.cmml" xref="S4.E14.m1.3.3.3.2.2.1.1.1.1.3">𝑖</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E14.m1.3c">D^{q}_{s}=f_{sel}(D^{q})=\{d_{i}\in D\mid\neg P(d_{i})\}</annotation><annotation encoding="application/x-llamapun" id="S4.E14.m1.3d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_s italic_e italic_l end_POSTSUBSCRIPT ( italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ) = { italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_D ∣ ¬ italic_P ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(14)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS4.SSS3.p1.6">Where <math alttext="f_{sel}" class="ltx_Math" display="inline" id="S4.SS4.SSS3.p1.1.m1.1"><semantics id="S4.SS4.SSS3.p1.1.m1.1a"><msub id="S4.SS4.SSS3.p1.1.m1.1.1" xref="S4.SS4.SSS3.p1.1.m1.1.1.cmml"><mi id="S4.SS4.SSS3.p1.1.m1.1.1.2" xref="S4.SS4.SSS3.p1.1.m1.1.1.2.cmml">f</mi><mrow id="S4.SS4.SSS3.p1.1.m1.1.1.3" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.cmml"><mi id="S4.SS4.SSS3.p1.1.m1.1.1.3.2" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.2.cmml">s</mi><mo id="S4.SS4.SSS3.p1.1.m1.1.1.3.1" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS3.p1.1.m1.1.1.3.3" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.3.cmml">e</mi><mo id="S4.SS4.SSS3.p1.1.m1.1.1.3.1a" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS4.SSS3.p1.1.m1.1.1.3.4" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.4.cmml">l</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS3.p1.1.m1.1b"><apply id="S4.SS4.SSS3.p1.1.m1.1.1.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS3.p1.1.m1.1.1.1.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS4.SSS3.p1.1.m1.1.1.2.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.2">𝑓</ci><apply id="S4.SS4.SSS3.p1.1.m1.1.1.3.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.3"><times id="S4.SS4.SSS3.p1.1.m1.1.1.3.1.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.1"></times><ci id="S4.SS4.SSS3.p1.1.m1.1.1.3.2.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.2">𝑠</ci><ci id="S4.SS4.SSS3.p1.1.m1.1.1.3.3.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.3">𝑒</ci><ci id="S4.SS4.SSS3.p1.1.m1.1.1.3.4.cmml" xref="S4.SS4.SSS3.p1.1.m1.1.1.3.4">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.1.m1.1c">f_{sel}</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_s italic_e italic_l end_POSTSUBSCRIPT</annotation></semantics></math> is the function for deletion operation and <math alttext="P(d_{i})" class="ltx_Math" display="inline" id="S4.SS4.SSS3.p1.2.m2.1"><semantics id="S4.SS4.SSS3.p1.2.m2.1a"><mrow id="S4.SS4.SSS3.p1.2.m2.1.1" xref="S4.SS4.SSS3.p1.2.m2.1.1.cmml"><mi id="S4.SS4.SSS3.p1.2.m2.1.1.3" xref="S4.SS4.SSS3.p1.2.m2.1.1.3.cmml">P</mi><mo id="S4.SS4.SSS3.p1.2.m2.1.1.2" xref="S4.SS4.SSS3.p1.2.m2.1.1.2.cmml">⁢</mo><mrow id="S4.SS4.SSS3.p1.2.m2.1.1.1.1" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.cmml"><mo id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.2" stretchy="false" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.cmml">(</mo><msub id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.cmml"><mi id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.2" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.2.cmml">d</mi><mi id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.3" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.3" stretchy="false" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS3.p1.2.m2.1b"><apply id="S4.SS4.SSS3.p1.2.m2.1.1.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1"><times id="S4.SS4.SSS3.p1.2.m2.1.1.2.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.2"></times><ci id="S4.SS4.SSS3.p1.2.m2.1.1.3.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.3">𝑃</ci><apply id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.1.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1">subscript</csymbol><ci id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.2.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.2">𝑑</ci><ci id="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.3.cmml" xref="S4.SS4.SSS3.p1.2.m2.1.1.1.1.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.2.m2.1c">P(d_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.2.m2.1d">italic_P ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> is a conditional predicate indicating that document (<math alttext="d_{i})" class="ltx_math_unparsed" display="inline" id="S4.SS4.SSS3.p1.3.m3.1"><semantics id="S4.SS4.SSS3.p1.3.m3.1a"><mrow id="S4.SS4.SSS3.p1.3.m3.1b"><msub id="S4.SS4.SSS3.p1.3.m3.1.1"><mi id="S4.SS4.SSS3.p1.3.m3.1.1.2">d</mi><mi id="S4.SS4.SSS3.p1.3.m3.1.1.3">i</mi></msub><mo id="S4.SS4.SSS3.p1.3.m3.1.2" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.3.m3.1c">d_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> satisfies a certain condition. If document (<math alttext="d_{i}" class="ltx_Math" display="inline" id="S4.SS4.SSS3.p1.4.m4.1"><semantics id="S4.SS4.SSS3.p1.4.m4.1a"><msub id="S4.SS4.SSS3.p1.4.m4.1.1" xref="S4.SS4.SSS3.p1.4.m4.1.1.cmml"><mi id="S4.SS4.SSS3.p1.4.m4.1.1.2" xref="S4.SS4.SSS3.p1.4.m4.1.1.2.cmml">d</mi><mi id="S4.SS4.SSS3.p1.4.m4.1.1.3" xref="S4.SS4.SSS3.p1.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS3.p1.4.m4.1b"><apply id="S4.SS4.SSS3.p1.4.m4.1.1.cmml" xref="S4.SS4.SSS3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS3.p1.4.m4.1.1.1.cmml" xref="S4.SS4.SSS3.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS4.SSS3.p1.4.m4.1.1.2.cmml" xref="S4.SS4.SSS3.p1.4.m4.1.1.2">𝑑</ci><ci id="S4.SS4.SSS3.p1.4.m4.1.1.3.cmml" xref="S4.SS4.SSS3.p1.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.4.m4.1c">d_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.4.m4.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>) satisfies (<math alttext="P(d_{i}" class="ltx_math_unparsed" display="inline" id="S4.SS4.SSS3.p1.5.m5.1"><semantics id="S4.SS4.SSS3.p1.5.m5.1a"><mrow id="S4.SS4.SSS3.p1.5.m5.1b"><mi id="S4.SS4.SSS3.p1.5.m5.1.1">P</mi><mrow id="S4.SS4.SSS3.p1.5.m5.1.2"><mo id="S4.SS4.SSS3.p1.5.m5.1.2.1" stretchy="false">(</mo><msub id="S4.SS4.SSS3.p1.5.m5.1.2.2"><mi id="S4.SS4.SSS3.p1.5.m5.1.2.2.2">d</mi><mi id="S4.SS4.SSS3.p1.5.m5.1.2.2.3">i</mi></msub></mrow></mrow><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.5.m5.1c">P(d_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.5.m5.1d">italic_P ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>)), it will be deleted. Conversely, documents for which (<math alttext="\neg P(d_{i})" class="ltx_Math" display="inline" id="S4.SS4.SSS3.p1.6.m6.1"><semantics id="S4.SS4.SSS3.p1.6.m6.1a"><mrow id="S4.SS4.SSS3.p1.6.m6.1.1" xref="S4.SS4.SSS3.p1.6.m6.1.1.cmml"><mo id="S4.SS4.SSS3.p1.6.m6.1.1.2" rspace="0.167em" xref="S4.SS4.SSS3.p1.6.m6.1.1.2.cmml">¬</mo><mrow id="S4.SS4.SSS3.p1.6.m6.1.1.1" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.cmml"><mi id="S4.SS4.SSS3.p1.6.m6.1.1.1.3" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.3.cmml">P</mi><mo id="S4.SS4.SSS3.p1.6.m6.1.1.1.2" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.2.cmml">⁢</mo><mrow id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.cmml"><mo id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.2" stretchy="false" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.cmml">(</mo><msub id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.cmml"><mi id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.2" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.2.cmml">d</mi><mi id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.3" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.3" stretchy="false" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS4.SSS3.p1.6.m6.1b"><apply id="S4.SS4.SSS3.p1.6.m6.1.1.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1"><not id="S4.SS4.SSS3.p1.6.m6.1.1.2.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.2"></not><apply id="S4.SS4.SSS3.p1.6.m6.1.1.1.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1"><times id="S4.SS4.SSS3.p1.6.m6.1.1.1.2.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.2"></times><ci id="S4.SS4.SSS3.p1.6.m6.1.1.1.3.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.3">𝑃</ci><apply id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.1.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1">subscript</csymbol><ci id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.2.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.2">𝑑</ci><ci id="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.3.cmml" xref="S4.SS4.SSS3.p1.6.m6.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS4.SSS3.p1.6.m6.1c">\neg P(d_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.SS4.SSS3.p1.6.m6.1d">¬ italic_P ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>) is true will be retained.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS3.p2">
<p class="ltx_p" id="S4.SS4.SSS3.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS3.p2.1.1">Selective Context</span>. By identifying and removing redundant content in the input context, the input is refined, thus improving the language model’s reasoning efficiency. In practice, selective context assesses the information content of lexical units based on the self-information computed by the base language model. By retaining content with higher self-information, this method offers a more concise and efficient textual representation, without compromising their performance across diverse applications. However, it overlooks the interdependence between compressed content and the alignment between the targeted language model and the small language model utilized for prompting compression <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib48" title="">48</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS3.p3">
<p class="ltx_p" id="S4.SS4.SSS3.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS3.p3.1.1">LLM-Critique</span>. Another straightforward and effective approach involves having the LLM evaluate the retrieved content before generating the final answer. This allows the LLM to filter out documents with poor relevance through LLM critique. For instance, in Chatlaw <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib49" title="">49</a>]</cite>, the LLM is prompted to self-suggestion on the referenced legal provisions to assess their relevance.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS5.5.1.1">IV-E</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS5.6.2">Generation</span>
</h3>
<div class="ltx_para" id="S4.SS5.p1">
<p class="ltx_p" id="S4.SS5.p1.1">Utilize the LLM to generate answers based on the user’s query and the retrieved contextual information. Select an appropriate model based on the task requirements, considering factors such as the need for fine-tuning, inference efficiency, and privacy protection.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS5.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS5.SSS1.5.1.1">IV-E</span>1 </span>Generator Fine-tuning</h4>
<div class="ltx_para" id="S4.SS5.SSS1.p1">
<p class="ltx_p" id="S4.SS5.SSS1.p1.1">In addition to direct LLM usage, targeted fine-tuning based on the scenario and data characteristics can yield better results. This is also one of the greatest advantages of using an on-premise setup LLMs.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS1.p2">
<p class="ltx_p" id="S4.SS5.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS5.SSS1.p2.1.1">Instruct-Tuning</span>. When LLMs lack data in a specific domain, additional knowledge can be provided to the LLM through fine-tuning. General fine-tuning dataset can also be used as an initial step. Another benefit of fine-tuning is the ability to adjust the model’s input and output. For example, it can enable LLM to adapt to specific data formats and generate responses in a particular style as instructed <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib50" title="">50</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS1.p3">
<p class="ltx_p" id="S4.SS5.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS5.SSS1.p3.1.1">Reinforcement learning</span>. Aligning LLM outputs with human or retriever preferences through reinforcement learning is a potential approach <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib51" title="">51</a>]</cite>. For instance, manually annotating the final generated answers and then providing feedback through reinforcement learning. In addition to aligning with human preferences, it is also possible to align with the preferences of fine-tuned models and retrievers.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS1.p4">
<p class="ltx_p" id="S4.SS5.SSS1.p4.5"><span class="ltx_text ltx_font_bold" id="S4.SS5.SSS1.p4.5.1">Dual Fine-tuing</span> Fine-tuning both generator and retriever simultaneously to align their preferences. A typical approach, such as RA-DIT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib27" title="">27</a>]</cite>, aligns the scoring functions between retriever and generator using KL divergence. Retrieval likelihood of each retrieved document d is calculated as :</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E15">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P_{R}(d|q)=\frac{e^{(sim(d,q))}/\gamma}{\sum_{d\in\mathcal{D}q}e^{(sim(d,q)/%
\gamma}}" class="ltx_math_unparsed" display="block" id="S4.E15.m1.6"><semantics id="S4.E15.m1.6a"><mrow id="S4.E15.m1.6.6"><mrow id="S4.E15.m1.6.6.1"><msub id="S4.E15.m1.6.6.1.3"><mi id="S4.E15.m1.6.6.1.3.2">P</mi><mi id="S4.E15.m1.6.6.1.3.3">R</mi></msub><mo id="S4.E15.m1.6.6.1.2">⁢</mo><mrow id="S4.E15.m1.6.6.1.1.1"><mo id="S4.E15.m1.6.6.1.1.1.2" stretchy="false">(</mo><mrow id="S4.E15.m1.6.6.1.1.1.1"><mi id="S4.E15.m1.6.6.1.1.1.1.2">d</mi><mo fence="false" id="S4.E15.m1.6.6.1.1.1.1.1">|</mo><mi id="S4.E15.m1.6.6.1.1.1.1.3">q</mi></mrow><mo id="S4.E15.m1.6.6.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mo id="S4.E15.m1.6.6.2">=</mo><mfrac id="S4.E15.m1.5.5"><mrow id="S4.E15.m1.3.3.3"><msup id="S4.E15.m1.3.3.3.5"><mi id="S4.E15.m1.3.3.3.5.2">e</mi><mrow id="S4.E15.m1.3.3.3.3.3.3"><mo id="S4.E15.m1.3.3.3.3.3.3.2" stretchy="false">(</mo><mrow id="S4.E15.m1.3.3.3.3.3.3.1"><mi id="S4.E15.m1.3.3.3.3.3.3.1.2">s</mi><mo id="S4.E15.m1.3.3.3.3.3.3.1.1">⁢</mo><mi id="S4.E15.m1.3.3.3.3.3.3.1.3">i</mi><mo id="S4.E15.m1.3.3.3.3.3.3.1.1a">⁢</mo><mi id="S4.E15.m1.3.3.3.3.3.3.1.4">m</mi><mo id="S4.E15.m1.3.3.3.3.3.3.1.1b">⁢</mo><mrow id="S4.E15.m1.3.3.3.3.3.3.1.5.2"><mo id="S4.E15.m1.3.3.3.3.3.3.1.5.2.1" stretchy="false">(</mo><mi id="S4.E15.m1.1.1.1.1.1.1">d</mi><mo id="S4.E15.m1.3.3.3.3.3.3.1.5.2.2">,</mo><mi id="S4.E15.m1.2.2.2.2.2.2">q</mi><mo id="S4.E15.m1.3.3.3.3.3.3.1.5.2.3" stretchy="false">)</mo></mrow></mrow><mo id="S4.E15.m1.3.3.3.3.3.3.3" stretchy="false">)</mo></mrow></msup><mo id="S4.E15.m1.3.3.3.4">/</mo><mi id="S4.E15.m1.3.3.3.6">γ</mi></mrow><mrow id="S4.E15.m1.5.5.5"><msub id="S4.E15.m1.5.5.5.3"><mo id="S4.E15.m1.5.5.5.3.2">∑</mo><mrow id="S4.E15.m1.5.5.5.3.3"><mi id="S4.E15.m1.5.5.5.3.3.2">d</mi><mo id="S4.E15.m1.5.5.5.3.3.1">∈</mo><mrow id="S4.E15.m1.5.5.5.3.3.3"><mi class="ltx_font_mathcaligraphic" id="S4.E15.m1.5.5.5.3.3.3.2">𝒟</mi><mo id="S4.E15.m1.5.5.5.3.3.3.1">⁢</mo><mi id="S4.E15.m1.5.5.5.3.3.3.3">q</mi></mrow></mrow></msub><msup id="S4.E15.m1.5.5.5.4"><mi id="S4.E15.m1.5.5.5.4.2">e</mi><mrow id="S4.E15.m1.5.5.5.2.2"><mo id="S4.E15.m1.5.5.5.2.2.3" stretchy="false">(</mo><mi id="S4.E15.m1.5.5.5.2.2.4">s</mi><mi id="S4.E15.m1.5.5.5.2.2.5">i</mi><mi id="S4.E15.m1.5.5.5.2.2.6">m</mi><mrow id="S4.E15.m1.5.5.5.2.2.7"><mo id="S4.E15.m1.5.5.5.2.2.7.1" stretchy="false">(</mo><mi id="S4.E15.m1.4.4.4.1.1.1">d</mi><mo id="S4.E15.m1.5.5.5.2.2.7.2">,</mo><mi id="S4.E15.m1.5.5.5.2.2.2">q</mi><mo id="S4.E15.m1.5.5.5.2.2.7.3" stretchy="false">)</mo></mrow><mo id="S4.E15.m1.5.5.5.2.2.8">/</mo><mi id="S4.E15.m1.5.5.5.2.2.9">γ</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex" id="S4.E15.m1.6b">P_{R}(d|q)=\frac{e^{(sim(d,q))}/\gamma}{\sum_{d\in\mathcal{D}q}e^{(sim(d,q)/%
\gamma}}</annotation><annotation encoding="application/x-llamapun" id="S4.E15.m1.6c">italic_P start_POSTSUBSCRIPT italic_R end_POSTSUBSCRIPT ( italic_d | italic_q ) = divide start_ARG italic_e start_POSTSUPERSCRIPT ( italic_s italic_i italic_m ( italic_d , italic_q ) ) end_POSTSUPERSCRIPT / italic_γ end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_d ∈ caligraphic_D italic_q end_POSTSUBSCRIPT italic_e start_POSTSUPERSCRIPT ( italic_s italic_i italic_m ( italic_d , italic_q ) / italic_γ end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(15)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS5.SSS1.p4.4"><math alttext="P_{LM}(y|d,q)" class="ltx_Math" display="inline" id="S4.SS5.SSS1.p4.1.m1.3"><semantics id="S4.SS5.SSS1.p4.1.m1.3a"><mrow id="S4.SS5.SSS1.p4.1.m1.3.3" xref="S4.SS5.SSS1.p4.1.m1.3.3.cmml"><msub id="S4.SS5.SSS1.p4.1.m1.3.3.3" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.cmml"><mi id="S4.SS5.SSS1.p4.1.m1.3.3.3.2" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.2.cmml">P</mi><mrow id="S4.SS5.SSS1.p4.1.m1.3.3.3.3" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.cmml"><mi id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.2" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.2.cmml">L</mi><mo id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.1" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.1.cmml">⁢</mo><mi id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.3" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.3.cmml">M</mi></mrow></msub><mo id="S4.SS5.SSS1.p4.1.m1.3.3.2" xref="S4.SS5.SSS1.p4.1.m1.3.3.2.cmml">⁢</mo><mrow id="S4.SS5.SSS1.p4.1.m1.3.3.1.1" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.cmml"><mo id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.2" stretchy="false" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.cmml">(</mo><mrow id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.cmml"><mi id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.2" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.2.cmml">y</mi><mo fence="false" id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.1" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.1.cmml">|</mo><mrow id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.2" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.1.cmml"><mi id="S4.SS5.SSS1.p4.1.m1.1.1" xref="S4.SS5.SSS1.p4.1.m1.1.1.cmml">d</mi><mo id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.2.1" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.1.cmml">,</mo><mi id="S4.SS5.SSS1.p4.1.m1.2.2" xref="S4.SS5.SSS1.p4.1.m1.2.2.cmml">q</mi></mrow></mrow><mo id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.3" stretchy="false" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS5.SSS1.p4.1.m1.3b"><apply id="S4.SS5.SSS1.p4.1.m1.3.3.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3"><times id="S4.SS5.SSS1.p4.1.m1.3.3.2.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.2"></times><apply id="S4.SS5.SSS1.p4.1.m1.3.3.3.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3"><csymbol cd="ambiguous" id="S4.SS5.SSS1.p4.1.m1.3.3.3.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3">subscript</csymbol><ci id="S4.SS5.SSS1.p4.1.m1.3.3.3.2.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.2">𝑃</ci><apply id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3"><times id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.1"></times><ci id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.2.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.2">𝐿</ci><ci id="S4.SS5.SSS1.p4.1.m1.3.3.3.3.3.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.3.3.3">𝑀</ci></apply></apply><apply id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1"><csymbol cd="latexml" id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.1">conditional</csymbol><ci id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.2.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.2">𝑦</ci><list id="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.3.3.1.1.1.3.2"><ci id="S4.SS5.SSS1.p4.1.m1.1.1.cmml" xref="S4.SS5.SSS1.p4.1.m1.1.1">𝑑</ci><ci id="S4.SS5.SSS1.p4.1.m1.2.2.cmml" xref="S4.SS5.SSS1.p4.1.m1.2.2">𝑞</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS5.SSS1.p4.1.m1.3c">P_{LM}(y|d,q)</annotation><annotation encoding="application/x-llamapun" id="S4.SS5.SSS1.p4.1.m1.3d">italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_y | italic_d , italic_q )</annotation></semantics></math> is the LM probability of the ground truth output y given the input context <math alttext="d" class="ltx_Math" display="inline" id="S4.SS5.SSS1.p4.2.m2.1"><semantics id="S4.SS5.SSS1.p4.2.m2.1a"><mi id="S4.SS5.SSS1.p4.2.m2.1.1" xref="S4.SS5.SSS1.p4.2.m2.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S4.SS5.SSS1.p4.2.m2.1b"><ci id="S4.SS5.SSS1.p4.2.m2.1.1.cmml" xref="S4.SS5.SSS1.p4.2.m2.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS5.SSS1.p4.2.m2.1c">d</annotation><annotation encoding="application/x-llamapun" id="S4.SS5.SSS1.p4.2.m2.1d">italic_d</annotation></semantics></math>, question <math alttext="q" class="ltx_Math" display="inline" id="S4.SS5.SSS1.p4.3.m3.1"><semantics id="S4.SS5.SSS1.p4.3.m3.1a"><mi id="S4.SS5.SSS1.p4.3.m3.1.1" xref="S4.SS5.SSS1.p4.3.m3.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S4.SS5.SSS1.p4.3.m3.1b"><ci id="S4.SS5.SSS1.p4.3.m3.1.1.cmml" xref="S4.SS5.SSS1.p4.3.m3.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS5.SSS1.p4.3.m3.1c">q</annotation><annotation encoding="application/x-llamapun" id="S4.SS5.SSS1.p4.3.m3.1d">italic_q</annotation></semantics></math>, and <math alttext="\gamma" class="ltx_Math" display="inline" id="S4.SS5.SSS1.p4.4.m4.1"><semantics id="S4.SS5.SSS1.p4.4.m4.1a"><mi id="S4.SS5.SSS1.p4.4.m4.1.1" xref="S4.SS5.SSS1.p4.4.m4.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S4.SS5.SSS1.p4.4.m4.1b"><ci id="S4.SS5.SSS1.p4.4.m4.1.1.cmml" xref="S4.SS5.SSS1.p4.4.m4.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS5.SSS1.p4.4.m4.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S4.SS5.SSS1.p4.4.m4.1d">italic_γ</annotation></semantics></math> is a hyperparamter. The overall loss is calculated as:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E16">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}=\frac{1}{|T|}\sum_{i=1}^{T}KL(P_{R}(d|q)||P_{LSR}(d|q,y|))" class="ltx_math_unparsed" display="block" id="S4.E16.m1.3"><semantics id="S4.E16.m1.3a"><mrow id="S4.E16.m1.3b"><mi class="ltx_font_mathcaligraphic" id="S4.E16.m1.3.4">ℒ</mi><mo id="S4.E16.m1.3.5">=</mo><mfrac id="S4.E16.m1.1.1"><mn id="S4.E16.m1.1.1.3">1</mn><mrow id="S4.E16.m1.1.1.1.3"><mo id="S4.E16.m1.1.1.1.3.1" stretchy="false">|</mo><mi id="S4.E16.m1.1.1.1.1">T</mi><mo id="S4.E16.m1.1.1.1.3.2" stretchy="false">|</mo></mrow></mfrac><munderover id="S4.E16.m1.3.6"><mo id="S4.E16.m1.3.6.2.2" movablelimits="false">∑</mo><mrow id="S4.E16.m1.3.6.2.3"><mi id="S4.E16.m1.3.6.2.3.2">i</mi><mo id="S4.E16.m1.3.6.2.3.1">=</mo><mn id="S4.E16.m1.3.6.2.3.3">1</mn></mrow><mi id="S4.E16.m1.3.6.3">T</mi></munderover><mi id="S4.E16.m1.3.7">K</mi><mi id="S4.E16.m1.3.8">L</mi><mrow id="S4.E16.m1.3.9"><mo id="S4.E16.m1.3.9.1" stretchy="false">(</mo><msub id="S4.E16.m1.3.9.2"><mi id="S4.E16.m1.3.9.2.2">P</mi><mi id="S4.E16.m1.3.9.2.3">R</mi></msub><mrow id="S4.E16.m1.3.9.3"><mo id="S4.E16.m1.3.9.3.1" stretchy="false">(</mo><mi id="S4.E16.m1.3.9.3.2">d</mi><mo fence="false" id="S4.E16.m1.3.9.3.3" rspace="0.167em" stretchy="false">|</mo><mi id="S4.E16.m1.3.9.3.4">q</mi><mo id="S4.E16.m1.3.9.3.5" stretchy="false">)</mo></mrow><mo fence="false" id="S4.E16.m1.3.9.4" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S4.E16.m1.3.9.5" rspace="0.167em" stretchy="false">|</mo><msub id="S4.E16.m1.3.9.6"><mi id="S4.E16.m1.3.9.6.2">P</mi><mrow id="S4.E16.m1.3.9.6.3"><mi id="S4.E16.m1.3.9.6.3.2">L</mi><mo id="S4.E16.m1.3.9.6.3.1">⁢</mo><mi id="S4.E16.m1.3.9.6.3.3">S</mi><mo id="S4.E16.m1.3.9.6.3.1a">⁢</mo><mi id="S4.E16.m1.3.9.6.3.4">R</mi></mrow></msub><mrow id="S4.E16.m1.3.9.7"><mo id="S4.E16.m1.3.9.7.1" stretchy="false">(</mo><mi id="S4.E16.m1.3.9.7.2">d</mi><mo fence="false" id="S4.E16.m1.3.9.7.3" rspace="0.167em" stretchy="false">|</mo><mi id="S4.E16.m1.2.2">q</mi><mo id="S4.E16.m1.3.9.7.4">,</mo><mi id="S4.E16.m1.3.3">y</mi><mo fence="false" id="S4.E16.m1.3.9.7.5" rspace="0.167em" stretchy="false">|</mo><mo id="S4.E16.m1.3.9.7.6" stretchy="false">)</mo></mrow><mo id="S4.E16.m1.3.9.8" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S4.E16.m1.3c">\mathcal{L}=\frac{1}{|T|}\sum_{i=1}^{T}KL(P_{R}(d|q)||P_{LSR}(d|q,y|))</annotation><annotation encoding="application/x-llamapun" id="S4.E16.m1.3d">caligraphic_L = divide start_ARG 1 end_ARG start_ARG | italic_T | end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT italic_K italic_L ( italic_P start_POSTSUBSCRIPT italic_R end_POSTSUBSCRIPT ( italic_d | italic_q ) | | italic_P start_POSTSUBSCRIPT italic_L italic_S italic_R end_POSTSUBSCRIPT ( italic_d | italic_q , italic_y | ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(16)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS5.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS5.SSS2.5.1.1">IV-E</span>2 </span>Verification </h4>
<div class="ltx_para" id="S4.SS5.SSS2.p1">
<p class="ltx_p" id="S4.SS5.SSS2.p1.1">Although RAG enhances the reliability of LLM-generated answers, in many scenarios, it requires to minimize the probability of hallucinations. Therefore, it can filter out responses that do not meet the required standards through additional verification module. Common verification methods include knowledge-base and model-base .</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E17">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="y^{k}=f_{verify}(q,D^{q},y)" class="ltx_Math" display="block" id="S4.E17.m1.3"><semantics id="S4.E17.m1.3a"><mrow id="S4.E17.m1.3.3" xref="S4.E17.m1.3.3.cmml"><msup id="S4.E17.m1.3.3.3" xref="S4.E17.m1.3.3.3.cmml"><mi id="S4.E17.m1.3.3.3.2" xref="S4.E17.m1.3.3.3.2.cmml">y</mi><mi id="S4.E17.m1.3.3.3.3" xref="S4.E17.m1.3.3.3.3.cmml">k</mi></msup><mo id="S4.E17.m1.3.3.2" xref="S4.E17.m1.3.3.2.cmml">=</mo><mrow id="S4.E17.m1.3.3.1" xref="S4.E17.m1.3.3.1.cmml"><msub id="S4.E17.m1.3.3.1.3" xref="S4.E17.m1.3.3.1.3.cmml"><mi id="S4.E17.m1.3.3.1.3.2" xref="S4.E17.m1.3.3.1.3.2.cmml">f</mi><mrow id="S4.E17.m1.3.3.1.3.3" xref="S4.E17.m1.3.3.1.3.3.cmml"><mi id="S4.E17.m1.3.3.1.3.3.2" xref="S4.E17.m1.3.3.1.3.3.2.cmml">v</mi><mo id="S4.E17.m1.3.3.1.3.3.1" xref="S4.E17.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="S4.E17.m1.3.3.1.3.3.3" xref="S4.E17.m1.3.3.1.3.3.3.cmml">e</mi><mo id="S4.E17.m1.3.3.1.3.3.1a" xref="S4.E17.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="S4.E17.m1.3.3.1.3.3.4" xref="S4.E17.m1.3.3.1.3.3.4.cmml">r</mi><mo id="S4.E17.m1.3.3.1.3.3.1b" xref="S4.E17.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="S4.E17.m1.3.3.1.3.3.5" xref="S4.E17.m1.3.3.1.3.3.5.cmml">i</mi><mo id="S4.E17.m1.3.3.1.3.3.1c" xref="S4.E17.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="S4.E17.m1.3.3.1.3.3.6" xref="S4.E17.m1.3.3.1.3.3.6.cmml">f</mi><mo id="S4.E17.m1.3.3.1.3.3.1d" xref="S4.E17.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="S4.E17.m1.3.3.1.3.3.7" xref="S4.E17.m1.3.3.1.3.3.7.cmml">y</mi></mrow></msub><mo id="S4.E17.m1.3.3.1.2" xref="S4.E17.m1.3.3.1.2.cmml">⁢</mo><mrow id="S4.E17.m1.3.3.1.1.1" xref="S4.E17.m1.3.3.1.1.2.cmml"><mo id="S4.E17.m1.3.3.1.1.1.2" stretchy="false" xref="S4.E17.m1.3.3.1.1.2.cmml">(</mo><mi id="S4.E17.m1.1.1" xref="S4.E17.m1.1.1.cmml">q</mi><mo id="S4.E17.m1.3.3.1.1.1.3" xref="S4.E17.m1.3.3.1.1.2.cmml">,</mo><msup id="S4.E17.m1.3.3.1.1.1.1" xref="S4.E17.m1.3.3.1.1.1.1.cmml"><mi id="S4.E17.m1.3.3.1.1.1.1.2" xref="S4.E17.m1.3.3.1.1.1.1.2.cmml">D</mi><mi id="S4.E17.m1.3.3.1.1.1.1.3" xref="S4.E17.m1.3.3.1.1.1.1.3.cmml">q</mi></msup><mo id="S4.E17.m1.3.3.1.1.1.4" xref="S4.E17.m1.3.3.1.1.2.cmml">,</mo><mi id="S4.E17.m1.2.2" xref="S4.E17.m1.2.2.cmml">y</mi><mo id="S4.E17.m1.3.3.1.1.1.5" stretchy="false" xref="S4.E17.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E17.m1.3b"><apply id="S4.E17.m1.3.3.cmml" xref="S4.E17.m1.3.3"><eq id="S4.E17.m1.3.3.2.cmml" xref="S4.E17.m1.3.3.2"></eq><apply id="S4.E17.m1.3.3.3.cmml" xref="S4.E17.m1.3.3.3"><csymbol cd="ambiguous" id="S4.E17.m1.3.3.3.1.cmml" xref="S4.E17.m1.3.3.3">superscript</csymbol><ci id="S4.E17.m1.3.3.3.2.cmml" xref="S4.E17.m1.3.3.3.2">𝑦</ci><ci id="S4.E17.m1.3.3.3.3.cmml" xref="S4.E17.m1.3.3.3.3">𝑘</ci></apply><apply id="S4.E17.m1.3.3.1.cmml" xref="S4.E17.m1.3.3.1"><times id="S4.E17.m1.3.3.1.2.cmml" xref="S4.E17.m1.3.3.1.2"></times><apply id="S4.E17.m1.3.3.1.3.cmml" xref="S4.E17.m1.3.3.1.3"><csymbol cd="ambiguous" id="S4.E17.m1.3.3.1.3.1.cmml" xref="S4.E17.m1.3.3.1.3">subscript</csymbol><ci id="S4.E17.m1.3.3.1.3.2.cmml" xref="S4.E17.m1.3.3.1.3.2">𝑓</ci><apply id="S4.E17.m1.3.3.1.3.3.cmml" xref="S4.E17.m1.3.3.1.3.3"><times id="S4.E17.m1.3.3.1.3.3.1.cmml" xref="S4.E17.m1.3.3.1.3.3.1"></times><ci id="S4.E17.m1.3.3.1.3.3.2.cmml" xref="S4.E17.m1.3.3.1.3.3.2">𝑣</ci><ci id="S4.E17.m1.3.3.1.3.3.3.cmml" xref="S4.E17.m1.3.3.1.3.3.3">𝑒</ci><ci id="S4.E17.m1.3.3.1.3.3.4.cmml" xref="S4.E17.m1.3.3.1.3.3.4">𝑟</ci><ci id="S4.E17.m1.3.3.1.3.3.5.cmml" xref="S4.E17.m1.3.3.1.3.3.5">𝑖</ci><ci id="S4.E17.m1.3.3.1.3.3.6.cmml" xref="S4.E17.m1.3.3.1.3.3.6">𝑓</ci><ci id="S4.E17.m1.3.3.1.3.3.7.cmml" xref="S4.E17.m1.3.3.1.3.3.7">𝑦</ci></apply></apply><vector id="S4.E17.m1.3.3.1.1.2.cmml" xref="S4.E17.m1.3.3.1.1.1"><ci id="S4.E17.m1.1.1.cmml" xref="S4.E17.m1.1.1">𝑞</ci><apply id="S4.E17.m1.3.3.1.1.1.1.cmml" xref="S4.E17.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S4.E17.m1.3.3.1.1.1.1.1.cmml" xref="S4.E17.m1.3.3.1.1.1.1">superscript</csymbol><ci id="S4.E17.m1.3.3.1.1.1.1.2.cmml" xref="S4.E17.m1.3.3.1.1.1.1.2">𝐷</ci><ci id="S4.E17.m1.3.3.1.1.1.1.3.cmml" xref="S4.E17.m1.3.3.1.1.1.1.3">𝑞</ci></apply><ci id="S4.E17.m1.2.2.cmml" xref="S4.E17.m1.2.2">𝑦</ci></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E17.m1.3c">y^{k}=f_{verify}(q,D^{q},y)</annotation><annotation encoding="application/x-llamapun" id="S4.E17.m1.3d">italic_y start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT = italic_f start_POSTSUBSCRIPT italic_v italic_e italic_r italic_i italic_f italic_y end_POSTSUBSCRIPT ( italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT , italic_y )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(17)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS5.SSS2.p1.2"><span class="ltx_text ltx_font_bold" id="S4.SS5.SSS2.p1.2.1">Knowledge-base verification</span> refers to directly validating the responses generated by LLMs through external knowledge. Generally, it extracts specific statements or triplets from response first. Then, relevant evidence is retrieved from verified knowledge base such as Wikipedia or specific knowledge graphs. Finally, each statement is incrementally compared with the evidence to determine whether the statement is supported, refuted, or if there is insufficient information <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib52" title="">52</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS2.p2">
<p class="ltx_p" id="S4.SS5.SSS2.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS5.SSS2.p2.1.1">Model-based verification</span> refers to using a small language model to verify the responses generated by LLMs <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib53" title="">53</a>]</cite>. Given the input question, the retrieved knowledge, and the generated answer, a small language model is trained to determine whether the generated answer correctly reflects the retrieved knowledge. This process is framed as a multiple-choice question, where the verifier needs to judge whether the answer reflects <span class="ltx_text ltx_font_italic" id="S4.SS5.SSS2.p2.1.2">correct answer</span> . If the generated answer does not correctly reflect the retrieved knowledge, the answer can be iteratively regenerated until the verifier confirms that the answer is correct.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS6">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S4.SS6.5.1.1">IV-F</span> </span><span class="ltx_text ltx_font_italic" id="S4.SS6.6.2">Orchestration</span>
</h3>
<div class="ltx_para" id="S4.SS6.p1">
<p class="ltx_p" id="S4.SS6.p1.1">Orchestration pertains to the control modules that govern the RAG process. Unlike the traditional, rigid approach of a fixed process, RAG now incorporates decision-making at pivotal junctures and dynamically selects subsequent steps contingent upon the previous outcomes. This adaptive and modular capability is a hallmark of modular RAG, distinguishing it from the more simplistic Naive and Advance RAG paradigm.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS6.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS6.SSS1.5.1.1">IV-F</span>1 </span>Routing</h4>
<div class="ltx_para" id="S4.SS6.SSS1.p1">
<p class="ltx_p" id="S4.SS6.SSS1.p1.2">In response to diverse queries, the RAG system routes to specific pipelines tailored for different scenario, a feature essential for a versatile RAG architecture designed to handle a wide array of situations. A decision-making mechanism is necessary to ascertain which modules will be engaged, based on the input from the model or supplementary metadata. Different routes are employed for distinct prompts or components.
This routing mechanism is executed through a function, denoted as <math alttext="f_{r}(\cdot)" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p1.1.m1.1"><semantics id="S4.SS6.SSS1.p1.1.m1.1a"><mrow id="S4.SS6.SSS1.p1.1.m1.1.2" xref="S4.SS6.SSS1.p1.1.m1.1.2.cmml"><msub id="S4.SS6.SSS1.p1.1.m1.1.2.2" xref="S4.SS6.SSS1.p1.1.m1.1.2.2.cmml"><mi id="S4.SS6.SSS1.p1.1.m1.1.2.2.2" xref="S4.SS6.SSS1.p1.1.m1.1.2.2.2.cmml">f</mi><mi id="S4.SS6.SSS1.p1.1.m1.1.2.2.3" xref="S4.SS6.SSS1.p1.1.m1.1.2.2.3.cmml">r</mi></msub><mo id="S4.SS6.SSS1.p1.1.m1.1.2.1" xref="S4.SS6.SSS1.p1.1.m1.1.2.1.cmml">⁢</mo><mrow id="S4.SS6.SSS1.p1.1.m1.1.2.3.2" xref="S4.SS6.SSS1.p1.1.m1.1.2.cmml"><mo id="S4.SS6.SSS1.p1.1.m1.1.2.3.2.1" stretchy="false" xref="S4.SS6.SSS1.p1.1.m1.1.2.cmml">(</mo><mo id="S4.SS6.SSS1.p1.1.m1.1.1" lspace="0em" rspace="0em" xref="S4.SS6.SSS1.p1.1.m1.1.1.cmml">⋅</mo><mo id="S4.SS6.SSS1.p1.1.m1.1.2.3.2.2" stretchy="false" xref="S4.SS6.SSS1.p1.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p1.1.m1.1b"><apply id="S4.SS6.SSS1.p1.1.m1.1.2.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2"><times id="S4.SS6.SSS1.p1.1.m1.1.2.1.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2.1"></times><apply id="S4.SS6.SSS1.p1.1.m1.1.2.2.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2.2"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p1.1.m1.1.2.2.1.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2.2">subscript</csymbol><ci id="S4.SS6.SSS1.p1.1.m1.1.2.2.2.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2.2.2">𝑓</ci><ci id="S4.SS6.SSS1.p1.1.m1.1.2.2.3.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.2.2.3">𝑟</ci></apply><ci id="S4.SS6.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS6.SSS1.p1.1.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p1.1.m1.1c">f_{r}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p1.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math>, which assigns a score <math alttext="\alpha_{i}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p1.2.m2.1"><semantics id="S4.SS6.SSS1.p1.2.m2.1a"><msub id="S4.SS6.SSS1.p1.2.m2.1.1" xref="S4.SS6.SSS1.p1.2.m2.1.1.cmml"><mi id="S4.SS6.SSS1.p1.2.m2.1.1.2" xref="S4.SS6.SSS1.p1.2.m2.1.1.2.cmml">α</mi><mi id="S4.SS6.SSS1.p1.2.m2.1.1.3" xref="S4.SS6.SSS1.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p1.2.m2.1b"><apply id="S4.SS6.SSS1.p1.2.m2.1.1.cmml" xref="S4.SS6.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p1.2.m2.1.1.1.cmml" xref="S4.SS6.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p1.2.m2.1.1.2.cmml" xref="S4.SS6.SSS1.p1.2.m2.1.1.2">𝛼</ci><ci id="S4.SS6.SSS1.p1.2.m2.1.1.3.cmml" xref="S4.SS6.SSS1.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p1.2.m2.1c">\alpha_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p1.2.m2.1d">italic_α start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to each module. These scores dictate the selection of the active subset of modules. Mathematically, the routing function is represented as:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E18">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f_{r}:Q\rightarrow\mathcal{F}" class="ltx_Math" display="block" id="S4.E18.m1.1"><semantics id="S4.E18.m1.1a"><mrow id="S4.E18.m1.1.1" xref="S4.E18.m1.1.1.cmml"><msub id="S4.E18.m1.1.1.2" xref="S4.E18.m1.1.1.2.cmml"><mi id="S4.E18.m1.1.1.2.2" xref="S4.E18.m1.1.1.2.2.cmml">f</mi><mi id="S4.E18.m1.1.1.2.3" xref="S4.E18.m1.1.1.2.3.cmml">r</mi></msub><mo id="S4.E18.m1.1.1.1" lspace="0.278em" rspace="0.278em" xref="S4.E18.m1.1.1.1.cmml">:</mo><mrow id="S4.E18.m1.1.1.3" xref="S4.E18.m1.1.1.3.cmml"><mi id="S4.E18.m1.1.1.3.2" xref="S4.E18.m1.1.1.3.2.cmml">Q</mi><mo id="S4.E18.m1.1.1.3.1" stretchy="false" xref="S4.E18.m1.1.1.3.1.cmml">→</mo><mi class="ltx_font_mathcaligraphic" id="S4.E18.m1.1.1.3.3" xref="S4.E18.m1.1.1.3.3.cmml">ℱ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E18.m1.1b"><apply id="S4.E18.m1.1.1.cmml" xref="S4.E18.m1.1.1"><ci id="S4.E18.m1.1.1.1.cmml" xref="S4.E18.m1.1.1.1">:</ci><apply id="S4.E18.m1.1.1.2.cmml" xref="S4.E18.m1.1.1.2"><csymbol cd="ambiguous" id="S4.E18.m1.1.1.2.1.cmml" xref="S4.E18.m1.1.1.2">subscript</csymbol><ci id="S4.E18.m1.1.1.2.2.cmml" xref="S4.E18.m1.1.1.2.2">𝑓</ci><ci id="S4.E18.m1.1.1.2.3.cmml" xref="S4.E18.m1.1.1.2.3">𝑟</ci></apply><apply id="S4.E18.m1.1.1.3.cmml" xref="S4.E18.m1.1.1.3"><ci id="S4.E18.m1.1.1.3.1.cmml" xref="S4.E18.m1.1.1.3.1">→</ci><ci id="S4.E18.m1.1.1.3.2.cmml" xref="S4.E18.m1.1.1.3.2">𝑄</ci><ci id="S4.E18.m1.1.1.3.3.cmml" xref="S4.E18.m1.1.1.3.3">ℱ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E18.m1.1c">f_{r}:Q\rightarrow\mathcal{F}</annotation><annotation encoding="application/x-llamapun" id="S4.E18.m1.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT : italic_Q → caligraphic_F</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(18)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS1.p1.3">where <math alttext="f_{r}(\cdot)" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p1.3.m1.1"><semantics id="S4.SS6.SSS1.p1.3.m1.1a"><mrow id="S4.SS6.SSS1.p1.3.m1.1.2" xref="S4.SS6.SSS1.p1.3.m1.1.2.cmml"><msub id="S4.SS6.SSS1.p1.3.m1.1.2.2" xref="S4.SS6.SSS1.p1.3.m1.1.2.2.cmml"><mi id="S4.SS6.SSS1.p1.3.m1.1.2.2.2" xref="S4.SS6.SSS1.p1.3.m1.1.2.2.2.cmml">f</mi><mi id="S4.SS6.SSS1.p1.3.m1.1.2.2.3" xref="S4.SS6.SSS1.p1.3.m1.1.2.2.3.cmml">r</mi></msub><mo id="S4.SS6.SSS1.p1.3.m1.1.2.1" xref="S4.SS6.SSS1.p1.3.m1.1.2.1.cmml">⁢</mo><mrow id="S4.SS6.SSS1.p1.3.m1.1.2.3.2" xref="S4.SS6.SSS1.p1.3.m1.1.2.cmml"><mo id="S4.SS6.SSS1.p1.3.m1.1.2.3.2.1" stretchy="false" xref="S4.SS6.SSS1.p1.3.m1.1.2.cmml">(</mo><mo id="S4.SS6.SSS1.p1.3.m1.1.1" lspace="0em" rspace="0em" xref="S4.SS6.SSS1.p1.3.m1.1.1.cmml">⋅</mo><mo id="S4.SS6.SSS1.p1.3.m1.1.2.3.2.2" stretchy="false" xref="S4.SS6.SSS1.p1.3.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p1.3.m1.1b"><apply id="S4.SS6.SSS1.p1.3.m1.1.2.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2"><times id="S4.SS6.SSS1.p1.3.m1.1.2.1.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2.1"></times><apply id="S4.SS6.SSS1.p1.3.m1.1.2.2.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2.2"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p1.3.m1.1.2.2.1.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2.2">subscript</csymbol><ci id="S4.SS6.SSS1.p1.3.m1.1.2.2.2.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2.2.2">𝑓</ci><ci id="S4.SS6.SSS1.p1.3.m1.1.2.2.3.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.2.2.3">𝑟</ci></apply><ci id="S4.SS6.SSS1.p1.3.m1.1.1.cmml" xref="S4.SS6.SSS1.p1.3.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p1.3.m1.1c">f_{r}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p1.3.m1.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> maps the identified query to its corresponding RAG flow.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS1.p2">
<p class="ltx_p" id="S4.SS6.SSS1.p2.5"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS1.p2.5.1">Metadata routing</span> involves extracting key terms, or entities, from the query, applying a filtration process that uses these keywords and associated metadata within the chunks to refine the routing parameters. For a specific RAG flow, denoted as <math alttext="F_{i}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.1.m1.1"><semantics id="S4.SS6.SSS1.p2.1.m1.1a"><msub id="S4.SS6.SSS1.p2.1.m1.1.1" xref="S4.SS6.SSS1.p2.1.m1.1.1.cmml"><mi id="S4.SS6.SSS1.p2.1.m1.1.1.2" xref="S4.SS6.SSS1.p2.1.m1.1.1.2.cmml">F</mi><mi id="S4.SS6.SSS1.p2.1.m1.1.1.3" xref="S4.SS6.SSS1.p2.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.1.m1.1b"><apply id="S4.SS6.SSS1.p2.1.m1.1.1.cmml" xref="S4.SS6.SSS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.1.m1.1.1.1.cmml" xref="S4.SS6.SSS1.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p2.1.m1.1.1.2.cmml" xref="S4.SS6.SSS1.p2.1.m1.1.1.2">𝐹</ci><ci id="S4.SS6.SSS1.p2.1.m1.1.1.3.cmml" xref="S4.SS6.SSS1.p2.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.1.m1.1c">F_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.1.m1.1d">italic_F start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, the pre-defined routing keywords are represented as the set <math alttext="\mathcal{K}_{i}=\{k_{i1},k_{i2},\ldots,k_{in}\}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.2.m2.4"><semantics id="S4.SS6.SSS1.p2.2.m2.4a"><mrow id="S4.SS6.SSS1.p2.2.m2.4.4" xref="S4.SS6.SSS1.p2.2.m2.4.4.cmml"><msub id="S4.SS6.SSS1.p2.2.m2.4.4.5" xref="S4.SS6.SSS1.p2.2.m2.4.4.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS6.SSS1.p2.2.m2.4.4.5.2" xref="S4.SS6.SSS1.p2.2.m2.4.4.5.2.cmml">𝒦</mi><mi id="S4.SS6.SSS1.p2.2.m2.4.4.5.3" xref="S4.SS6.SSS1.p2.2.m2.4.4.5.3.cmml">i</mi></msub><mo id="S4.SS6.SSS1.p2.2.m2.4.4.4" xref="S4.SS6.SSS1.p2.2.m2.4.4.4.cmml">=</mo><mrow id="S4.SS6.SSS1.p2.2.m2.4.4.3.3" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml"><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.4" stretchy="false" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml">{</mo><msub id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.2" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.2.cmml">k</mi><mrow id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.2" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.2.cmml">i</mi><mo id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.1" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.1.cmml">⁢</mo><mn id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.3" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.3.cmml">1</mn></mrow></msub><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.5" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml">,</mo><msub id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.2" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.2.cmml">k</mi><mrow id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.2" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.2.cmml">i</mi><mo id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.1" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.1.cmml">⁢</mo><mn id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.3" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.3.cmml">2</mn></mrow></msub><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.6" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml">,</mo><mi id="S4.SS6.SSS1.p2.2.m2.1.1" mathvariant="normal" xref="S4.SS6.SSS1.p2.2.m2.1.1.cmml">…</mi><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.7" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml">,</mo><msub id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.2" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.2.cmml">k</mi><mrow id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.cmml"><mi id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.2" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.2.cmml">i</mi><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.1" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.1.cmml">⁢</mo><mi id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.3" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.3.cmml">n</mi></mrow></msub><mo id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.8" stretchy="false" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.2.m2.4b"><apply id="S4.SS6.SSS1.p2.2.m2.4.4.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4"><eq id="S4.SS6.SSS1.p2.2.m2.4.4.4.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.4"></eq><apply id="S4.SS6.SSS1.p2.2.m2.4.4.5.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.5"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.2.m2.4.4.5.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.5">subscript</csymbol><ci id="S4.SS6.SSS1.p2.2.m2.4.4.5.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.5.2">𝒦</ci><ci id="S4.SS6.SSS1.p2.2.m2.4.4.5.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.5.3">𝑖</ci></apply><set id="S4.SS6.SSS1.p2.2.m2.4.4.3.4.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3"><apply id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.2">𝑘</ci><apply id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3"><times id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.1"></times><ci id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.2">𝑖</ci><cn id="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.3.cmml" type="integer" xref="S4.SS6.SSS1.p2.2.m2.2.2.1.1.1.3.3">1</cn></apply></apply><apply id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2">subscript</csymbol><ci id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.2">𝑘</ci><apply id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3"><times id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.1"></times><ci id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.2">𝑖</ci><cn id="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.3.cmml" type="integer" xref="S4.SS6.SSS1.p2.2.m2.3.3.2.2.2.3.3">2</cn></apply></apply><ci id="S4.SS6.SSS1.p2.2.m2.1.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.1.1">…</ci><apply id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3">subscript</csymbol><ci id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.2">𝑘</ci><apply id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3"><times id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.1.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.1"></times><ci id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.2.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.2">𝑖</ci><ci id="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.3.cmml" xref="S4.SS6.SSS1.p2.2.m2.4.4.3.3.3.3.3">𝑛</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.2.m2.4c">\mathcal{K}_{i}=\{k_{i1},k_{i2},\ldots,k_{in}\}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.2.m2.4d">caligraphic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = { italic_k start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT , italic_k start_POSTSUBSCRIPT italic_i 2 end_POSTSUBSCRIPT , … , italic_k start_POSTSUBSCRIPT italic_i italic_n end_POSTSUBSCRIPT }</annotation></semantics></math>. The keyword identified within the query <math alttext="q_{i}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.3.m3.1"><semantics id="S4.SS6.SSS1.p2.3.m3.1a"><msub id="S4.SS6.SSS1.p2.3.m3.1.1" xref="S4.SS6.SSS1.p2.3.m3.1.1.cmml"><mi id="S4.SS6.SSS1.p2.3.m3.1.1.2" xref="S4.SS6.SSS1.p2.3.m3.1.1.2.cmml">q</mi><mi id="S4.SS6.SSS1.p2.3.m3.1.1.3" xref="S4.SS6.SSS1.p2.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.3.m3.1b"><apply id="S4.SS6.SSS1.p2.3.m3.1.1.cmml" xref="S4.SS6.SSS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.3.m3.1.1.1.cmml" xref="S4.SS6.SSS1.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p2.3.m3.1.1.2.cmml" xref="S4.SS6.SSS1.p2.3.m3.1.1.2">𝑞</ci><ci id="S4.SS6.SSS1.p2.3.m3.1.1.3.cmml" xref="S4.SS6.SSS1.p2.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.3.m3.1c">q_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.3.m3.1d">italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is designated as <math alttext="K^{\prime}_{i}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.4.m4.1"><semantics id="S4.SS6.SSS1.p2.4.m4.1a"><msubsup id="S4.SS6.SSS1.p2.4.m4.1.1" xref="S4.SS6.SSS1.p2.4.m4.1.1.cmml"><mi id="S4.SS6.SSS1.p2.4.m4.1.1.2.2" xref="S4.SS6.SSS1.p2.4.m4.1.1.2.2.cmml">K</mi><mi id="S4.SS6.SSS1.p2.4.m4.1.1.3" xref="S4.SS6.SSS1.p2.4.m4.1.1.3.cmml">i</mi><mo id="S4.SS6.SSS1.p2.4.m4.1.1.2.3" xref="S4.SS6.SSS1.p2.4.m4.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.4.m4.1b"><apply id="S4.SS6.SSS1.p2.4.m4.1.1.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.4.m4.1.1.1.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1">subscript</csymbol><apply id="S4.SS6.SSS1.p2.4.m4.1.1.2.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.4.m4.1.1.2.1.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1">superscript</csymbol><ci id="S4.SS6.SSS1.p2.4.m4.1.1.2.2.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1.2.2">𝐾</ci><ci id="S4.SS6.SSS1.p2.4.m4.1.1.2.3.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1.2.3">′</ci></apply><ci id="S4.SS6.SSS1.p2.4.m4.1.1.3.cmml" xref="S4.SS6.SSS1.p2.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.4.m4.1c">K^{\prime}_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.4.m4.1d">italic_K start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. The matching process for the query <math alttext="q" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.5.m5.1"><semantics id="S4.SS6.SSS1.p2.5.m5.1a"><mi id="S4.SS6.SSS1.p2.5.m5.1.1" xref="S4.SS6.SSS1.p2.5.m5.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.5.m5.1b"><ci id="S4.SS6.SSS1.p2.5.m5.1.1.cmml" xref="S4.SS6.SSS1.p2.5.m5.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.5.m5.1c">q</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.5.m5.1d">italic_q</annotation></semantics></math> is quantified by the key score equation:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E19">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{score}_{\text{key}}(q_{i},F_{j})=\frac{1}{|K^{\prime}_{j}|}|\mathcal{K}_%
{i}\cap K^{\prime}_{j}|" class="ltx_Math" display="block" id="S4.E19.m1.4"><semantics id="S4.E19.m1.4a"><mrow id="S4.E19.m1.4.4" xref="S4.E19.m1.4.4.cmml"><mrow id="S4.E19.m1.3.3.2" xref="S4.E19.m1.3.3.2.cmml"><msub id="S4.E19.m1.3.3.2.4" xref="S4.E19.m1.3.3.2.4.cmml"><mtext id="S4.E19.m1.3.3.2.4.2" xref="S4.E19.m1.3.3.2.4.2a.cmml">score</mtext><mtext id="S4.E19.m1.3.3.2.4.3" xref="S4.E19.m1.3.3.2.4.3a.cmml">key</mtext></msub><mo id="S4.E19.m1.3.3.2.3" xref="S4.E19.m1.3.3.2.3.cmml">⁢</mo><mrow id="S4.E19.m1.3.3.2.2.2" xref="S4.E19.m1.3.3.2.2.3.cmml"><mo id="S4.E19.m1.3.3.2.2.2.3" stretchy="false" xref="S4.E19.m1.3.3.2.2.3.cmml">(</mo><msub id="S4.E19.m1.2.2.1.1.1.1" xref="S4.E19.m1.2.2.1.1.1.1.cmml"><mi id="S4.E19.m1.2.2.1.1.1.1.2" xref="S4.E19.m1.2.2.1.1.1.1.2.cmml">q</mi><mi id="S4.E19.m1.2.2.1.1.1.1.3" xref="S4.E19.m1.2.2.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E19.m1.3.3.2.2.2.4" xref="S4.E19.m1.3.3.2.2.3.cmml">,</mo><msub id="S4.E19.m1.3.3.2.2.2.2" xref="S4.E19.m1.3.3.2.2.2.2.cmml"><mi id="S4.E19.m1.3.3.2.2.2.2.2" xref="S4.E19.m1.3.3.2.2.2.2.2.cmml">F</mi><mi id="S4.E19.m1.3.3.2.2.2.2.3" xref="S4.E19.m1.3.3.2.2.2.2.3.cmml">j</mi></msub><mo id="S4.E19.m1.3.3.2.2.2.5" stretchy="false" xref="S4.E19.m1.3.3.2.2.3.cmml">)</mo></mrow></mrow><mo id="S4.E19.m1.4.4.4" xref="S4.E19.m1.4.4.4.cmml">=</mo><mrow id="S4.E19.m1.4.4.3" xref="S4.E19.m1.4.4.3.cmml"><mfrac id="S4.E19.m1.1.1" xref="S4.E19.m1.1.1.cmml"><mn id="S4.E19.m1.1.1.3" xref="S4.E19.m1.1.1.3.cmml">1</mn><mrow id="S4.E19.m1.1.1.1.1" xref="S4.E19.m1.1.1.1.2.cmml"><mo id="S4.E19.m1.1.1.1.1.2" stretchy="false" xref="S4.E19.m1.1.1.1.2.1.cmml">|</mo><msubsup id="S4.E19.m1.1.1.1.1.1" xref="S4.E19.m1.1.1.1.1.1.cmml"><mi id="S4.E19.m1.1.1.1.1.1.2.2" xref="S4.E19.m1.1.1.1.1.1.2.2.cmml">K</mi><mi id="S4.E19.m1.1.1.1.1.1.3" xref="S4.E19.m1.1.1.1.1.1.3.cmml">j</mi><mo id="S4.E19.m1.1.1.1.1.1.2.3" xref="S4.E19.m1.1.1.1.1.1.2.3.cmml">′</mo></msubsup><mo id="S4.E19.m1.1.1.1.1.3" stretchy="false" xref="S4.E19.m1.1.1.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S4.E19.m1.4.4.3.2" xref="S4.E19.m1.4.4.3.2.cmml">⁢</mo><mrow id="S4.E19.m1.4.4.3.1.1" xref="S4.E19.m1.4.4.3.1.2.cmml"><mo id="S4.E19.m1.4.4.3.1.1.2" stretchy="false" xref="S4.E19.m1.4.4.3.1.2.1.cmml">|</mo><mrow id="S4.E19.m1.4.4.3.1.1.1" xref="S4.E19.m1.4.4.3.1.1.1.cmml"><msub id="S4.E19.m1.4.4.3.1.1.1.2" xref="S4.E19.m1.4.4.3.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E19.m1.4.4.3.1.1.1.2.2" xref="S4.E19.m1.4.4.3.1.1.1.2.2.cmml">𝒦</mi><mi id="S4.E19.m1.4.4.3.1.1.1.2.3" xref="S4.E19.m1.4.4.3.1.1.1.2.3.cmml">i</mi></msub><mo id="S4.E19.m1.4.4.3.1.1.1.1" xref="S4.E19.m1.4.4.3.1.1.1.1.cmml">∩</mo><msubsup id="S4.E19.m1.4.4.3.1.1.1.3" xref="S4.E19.m1.4.4.3.1.1.1.3.cmml"><mi id="S4.E19.m1.4.4.3.1.1.1.3.2.2" xref="S4.E19.m1.4.4.3.1.1.1.3.2.2.cmml">K</mi><mi id="S4.E19.m1.4.4.3.1.1.1.3.3" xref="S4.E19.m1.4.4.3.1.1.1.3.3.cmml">j</mi><mo id="S4.E19.m1.4.4.3.1.1.1.3.2.3" xref="S4.E19.m1.4.4.3.1.1.1.3.2.3.cmml">′</mo></msubsup></mrow><mo id="S4.E19.m1.4.4.3.1.1.3" stretchy="false" xref="S4.E19.m1.4.4.3.1.2.1.cmml">|</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E19.m1.4b"><apply id="S4.E19.m1.4.4.cmml" xref="S4.E19.m1.4.4"><eq id="S4.E19.m1.4.4.4.cmml" xref="S4.E19.m1.4.4.4"></eq><apply id="S4.E19.m1.3.3.2.cmml" xref="S4.E19.m1.3.3.2"><times id="S4.E19.m1.3.3.2.3.cmml" xref="S4.E19.m1.3.3.2.3"></times><apply id="S4.E19.m1.3.3.2.4.cmml" xref="S4.E19.m1.3.3.2.4"><csymbol cd="ambiguous" id="S4.E19.m1.3.3.2.4.1.cmml" xref="S4.E19.m1.3.3.2.4">subscript</csymbol><ci id="S4.E19.m1.3.3.2.4.2a.cmml" xref="S4.E19.m1.3.3.2.4.2"><mtext id="S4.E19.m1.3.3.2.4.2.cmml" xref="S4.E19.m1.3.3.2.4.2">score</mtext></ci><ci id="S4.E19.m1.3.3.2.4.3a.cmml" xref="S4.E19.m1.3.3.2.4.3"><mtext id="S4.E19.m1.3.3.2.4.3.cmml" mathsize="70%" xref="S4.E19.m1.3.3.2.4.3">key</mtext></ci></apply><interval closure="open" id="S4.E19.m1.3.3.2.2.3.cmml" xref="S4.E19.m1.3.3.2.2.2"><apply id="S4.E19.m1.2.2.1.1.1.1.cmml" xref="S4.E19.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.E19.m1.2.2.1.1.1.1.1.cmml" xref="S4.E19.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S4.E19.m1.2.2.1.1.1.1.2.cmml" xref="S4.E19.m1.2.2.1.1.1.1.2">𝑞</ci><ci id="S4.E19.m1.2.2.1.1.1.1.3.cmml" xref="S4.E19.m1.2.2.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E19.m1.3.3.2.2.2.2.cmml" xref="S4.E19.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S4.E19.m1.3.3.2.2.2.2.1.cmml" xref="S4.E19.m1.3.3.2.2.2.2">subscript</csymbol><ci id="S4.E19.m1.3.3.2.2.2.2.2.cmml" xref="S4.E19.m1.3.3.2.2.2.2.2">𝐹</ci><ci id="S4.E19.m1.3.3.2.2.2.2.3.cmml" xref="S4.E19.m1.3.3.2.2.2.2.3">𝑗</ci></apply></interval></apply><apply id="S4.E19.m1.4.4.3.cmml" xref="S4.E19.m1.4.4.3"><times id="S4.E19.m1.4.4.3.2.cmml" xref="S4.E19.m1.4.4.3.2"></times><apply id="S4.E19.m1.1.1.cmml" xref="S4.E19.m1.1.1"><divide id="S4.E19.m1.1.1.2.cmml" xref="S4.E19.m1.1.1"></divide><cn id="S4.E19.m1.1.1.3.cmml" type="integer" xref="S4.E19.m1.1.1.3">1</cn><apply id="S4.E19.m1.1.1.1.2.cmml" xref="S4.E19.m1.1.1.1.1"><abs id="S4.E19.m1.1.1.1.2.1.cmml" xref="S4.E19.m1.1.1.1.1.2"></abs><apply id="S4.E19.m1.1.1.1.1.1.cmml" xref="S4.E19.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E19.m1.1.1.1.1.1.1.cmml" xref="S4.E19.m1.1.1.1.1.1">subscript</csymbol><apply id="S4.E19.m1.1.1.1.1.1.2.cmml" xref="S4.E19.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E19.m1.1.1.1.1.1.2.1.cmml" xref="S4.E19.m1.1.1.1.1.1">superscript</csymbol><ci id="S4.E19.m1.1.1.1.1.1.2.2.cmml" xref="S4.E19.m1.1.1.1.1.1.2.2">𝐾</ci><ci id="S4.E19.m1.1.1.1.1.1.2.3.cmml" xref="S4.E19.m1.1.1.1.1.1.2.3">′</ci></apply><ci id="S4.E19.m1.1.1.1.1.1.3.cmml" xref="S4.E19.m1.1.1.1.1.1.3">𝑗</ci></apply></apply></apply><apply id="S4.E19.m1.4.4.3.1.2.cmml" xref="S4.E19.m1.4.4.3.1.1"><abs id="S4.E19.m1.4.4.3.1.2.1.cmml" xref="S4.E19.m1.4.4.3.1.1.2"></abs><apply id="S4.E19.m1.4.4.3.1.1.1.cmml" xref="S4.E19.m1.4.4.3.1.1.1"><intersect id="S4.E19.m1.4.4.3.1.1.1.1.cmml" xref="S4.E19.m1.4.4.3.1.1.1.1"></intersect><apply id="S4.E19.m1.4.4.3.1.1.1.2.cmml" xref="S4.E19.m1.4.4.3.1.1.1.2"><csymbol cd="ambiguous" id="S4.E19.m1.4.4.3.1.1.1.2.1.cmml" xref="S4.E19.m1.4.4.3.1.1.1.2">subscript</csymbol><ci id="S4.E19.m1.4.4.3.1.1.1.2.2.cmml" xref="S4.E19.m1.4.4.3.1.1.1.2.2">𝒦</ci><ci id="S4.E19.m1.4.4.3.1.1.1.2.3.cmml" xref="S4.E19.m1.4.4.3.1.1.1.2.3">𝑖</ci></apply><apply id="S4.E19.m1.4.4.3.1.1.1.3.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3"><csymbol cd="ambiguous" id="S4.E19.m1.4.4.3.1.1.1.3.1.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3">subscript</csymbol><apply id="S4.E19.m1.4.4.3.1.1.1.3.2.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3"><csymbol cd="ambiguous" id="S4.E19.m1.4.4.3.1.1.1.3.2.1.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3">superscript</csymbol><ci id="S4.E19.m1.4.4.3.1.1.1.3.2.2.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3.2.2">𝐾</ci><ci id="S4.E19.m1.4.4.3.1.1.1.3.2.3.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3.2.3">′</ci></apply><ci id="S4.E19.m1.4.4.3.1.1.1.3.3.cmml" xref="S4.E19.m1.4.4.3.1.1.1.3.3">𝑗</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E19.m1.4c">\text{score}_{\text{key}}(q_{i},F_{j})=\frac{1}{|K^{\prime}_{j}|}|\mathcal{K}_%
{i}\cap K^{\prime}_{j}|</annotation><annotation encoding="application/x-llamapun" id="S4.E19.m1.4d">score start_POSTSUBSCRIPT key end_POSTSUBSCRIPT ( italic_q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) = divide start_ARG 1 end_ARG start_ARG | italic_K start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT | end_ARG | caligraphic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∩ italic_K start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT |</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(19)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS1.p2.7">This equation calculates the overlap between the pre-defined keywords and those identified in the query, normalized by the count of keywords in <math alttext="K^{\prime}_{j}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.6.m1.1"><semantics id="S4.SS6.SSS1.p2.6.m1.1a"><msubsup id="S4.SS6.SSS1.p2.6.m1.1.1" xref="S4.SS6.SSS1.p2.6.m1.1.1.cmml"><mi id="S4.SS6.SSS1.p2.6.m1.1.1.2.2" xref="S4.SS6.SSS1.p2.6.m1.1.1.2.2.cmml">K</mi><mi id="S4.SS6.SSS1.p2.6.m1.1.1.3" xref="S4.SS6.SSS1.p2.6.m1.1.1.3.cmml">j</mi><mo id="S4.SS6.SSS1.p2.6.m1.1.1.2.3" xref="S4.SS6.SSS1.p2.6.m1.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.6.m1.1b"><apply id="S4.SS6.SSS1.p2.6.m1.1.1.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.6.m1.1.1.1.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1">subscript</csymbol><apply id="S4.SS6.SSS1.p2.6.m1.1.1.2.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.6.m1.1.1.2.1.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1">superscript</csymbol><ci id="S4.SS6.SSS1.p2.6.m1.1.1.2.2.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1.2.2">𝐾</ci><ci id="S4.SS6.SSS1.p2.6.m1.1.1.2.3.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1.2.3">′</ci></apply><ci id="S4.SS6.SSS1.p2.6.m1.1.1.3.cmml" xref="S4.SS6.SSS1.p2.6.m1.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.6.m1.1c">K^{\prime}_{j}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.6.m1.1d">italic_K start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>. The final step is to determine the most relevant flow for the query <math alttext="q" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.7.m2.1"><semantics id="S4.SS6.SSS1.p2.7.m2.1a"><mi id="S4.SS6.SSS1.p2.7.m2.1.1" xref="S4.SS6.SSS1.p2.7.m2.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.7.m2.1b"><ci id="S4.SS6.SSS1.p2.7.m2.1.1.cmml" xref="S4.SS6.SSS1.p2.7.m2.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.7.m2.1c">q</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.7.m2.1d">italic_q</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E20">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="F_{i}(q)=\text{argmax}_{F_{j}\in\mathcal{F}}\text{score}(q,F_{j})" class="ltx_Math" display="block" id="S4.E20.m1.3"><semantics id="S4.E20.m1.3a"><mrow id="S4.E20.m1.3.3" xref="S4.E20.m1.3.3.cmml"><mrow id="S4.E20.m1.3.3.3" xref="S4.E20.m1.3.3.3.cmml"><msub id="S4.E20.m1.3.3.3.2" xref="S4.E20.m1.3.3.3.2.cmml"><mi id="S4.E20.m1.3.3.3.2.2" xref="S4.E20.m1.3.3.3.2.2.cmml">F</mi><mi id="S4.E20.m1.3.3.3.2.3" xref="S4.E20.m1.3.3.3.2.3.cmml">i</mi></msub><mo id="S4.E20.m1.3.3.3.1" xref="S4.E20.m1.3.3.3.1.cmml">⁢</mo><mrow id="S4.E20.m1.3.3.3.3.2" xref="S4.E20.m1.3.3.3.cmml"><mo id="S4.E20.m1.3.3.3.3.2.1" stretchy="false" xref="S4.E20.m1.3.3.3.cmml">(</mo><mi id="S4.E20.m1.1.1" xref="S4.E20.m1.1.1.cmml">q</mi><mo id="S4.E20.m1.3.3.3.3.2.2" stretchy="false" xref="S4.E20.m1.3.3.3.cmml">)</mo></mrow></mrow><mo id="S4.E20.m1.3.3.2" xref="S4.E20.m1.3.3.2.cmml">=</mo><mrow id="S4.E20.m1.3.3.1" xref="S4.E20.m1.3.3.1.cmml"><msub id="S4.E20.m1.3.3.1.3" xref="S4.E20.m1.3.3.1.3.cmml"><mtext id="S4.E20.m1.3.3.1.3.2" xref="S4.E20.m1.3.3.1.3.2a.cmml">argmax</mtext><mrow id="S4.E20.m1.3.3.1.3.3" xref="S4.E20.m1.3.3.1.3.3.cmml"><msub id="S4.E20.m1.3.3.1.3.3.2" xref="S4.E20.m1.3.3.1.3.3.2.cmml"><mi id="S4.E20.m1.3.3.1.3.3.2.2" xref="S4.E20.m1.3.3.1.3.3.2.2.cmml">F</mi><mi id="S4.E20.m1.3.3.1.3.3.2.3" xref="S4.E20.m1.3.3.1.3.3.2.3.cmml">j</mi></msub><mo id="S4.E20.m1.3.3.1.3.3.1" xref="S4.E20.m1.3.3.1.3.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S4.E20.m1.3.3.1.3.3.3" xref="S4.E20.m1.3.3.1.3.3.3.cmml">ℱ</mi></mrow></msub><mo id="S4.E20.m1.3.3.1.2" xref="S4.E20.m1.3.3.1.2.cmml">⁢</mo><mtext id="S4.E20.m1.3.3.1.4" xref="S4.E20.m1.3.3.1.4a.cmml">score</mtext><mo id="S4.E20.m1.3.3.1.2a" xref="S4.E20.m1.3.3.1.2.cmml">⁢</mo><mrow id="S4.E20.m1.3.3.1.1.1" xref="S4.E20.m1.3.3.1.1.2.cmml"><mo id="S4.E20.m1.3.3.1.1.1.2" stretchy="false" xref="S4.E20.m1.3.3.1.1.2.cmml">(</mo><mi id="S4.E20.m1.2.2" xref="S4.E20.m1.2.2.cmml">q</mi><mo id="S4.E20.m1.3.3.1.1.1.3" xref="S4.E20.m1.3.3.1.1.2.cmml">,</mo><msub id="S4.E20.m1.3.3.1.1.1.1" xref="S4.E20.m1.3.3.1.1.1.1.cmml"><mi id="S4.E20.m1.3.3.1.1.1.1.2" xref="S4.E20.m1.3.3.1.1.1.1.2.cmml">F</mi><mi id="S4.E20.m1.3.3.1.1.1.1.3" xref="S4.E20.m1.3.3.1.1.1.1.3.cmml">j</mi></msub><mo id="S4.E20.m1.3.3.1.1.1.4" stretchy="false" xref="S4.E20.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E20.m1.3b"><apply id="S4.E20.m1.3.3.cmml" xref="S4.E20.m1.3.3"><eq id="S4.E20.m1.3.3.2.cmml" xref="S4.E20.m1.3.3.2"></eq><apply id="S4.E20.m1.3.3.3.cmml" xref="S4.E20.m1.3.3.3"><times id="S4.E20.m1.3.3.3.1.cmml" xref="S4.E20.m1.3.3.3.1"></times><apply id="S4.E20.m1.3.3.3.2.cmml" xref="S4.E20.m1.3.3.3.2"><csymbol cd="ambiguous" id="S4.E20.m1.3.3.3.2.1.cmml" xref="S4.E20.m1.3.3.3.2">subscript</csymbol><ci id="S4.E20.m1.3.3.3.2.2.cmml" xref="S4.E20.m1.3.3.3.2.2">𝐹</ci><ci id="S4.E20.m1.3.3.3.2.3.cmml" xref="S4.E20.m1.3.3.3.2.3">𝑖</ci></apply><ci id="S4.E20.m1.1.1.cmml" xref="S4.E20.m1.1.1">𝑞</ci></apply><apply id="S4.E20.m1.3.3.1.cmml" xref="S4.E20.m1.3.3.1"><times id="S4.E20.m1.3.3.1.2.cmml" xref="S4.E20.m1.3.3.1.2"></times><apply id="S4.E20.m1.3.3.1.3.cmml" xref="S4.E20.m1.3.3.1.3"><csymbol cd="ambiguous" id="S4.E20.m1.3.3.1.3.1.cmml" xref="S4.E20.m1.3.3.1.3">subscript</csymbol><ci id="S4.E20.m1.3.3.1.3.2a.cmml" xref="S4.E20.m1.3.3.1.3.2"><mtext id="S4.E20.m1.3.3.1.3.2.cmml" xref="S4.E20.m1.3.3.1.3.2">argmax</mtext></ci><apply id="S4.E20.m1.3.3.1.3.3.cmml" xref="S4.E20.m1.3.3.1.3.3"><in id="S4.E20.m1.3.3.1.3.3.1.cmml" xref="S4.E20.m1.3.3.1.3.3.1"></in><apply id="S4.E20.m1.3.3.1.3.3.2.cmml" xref="S4.E20.m1.3.3.1.3.3.2"><csymbol cd="ambiguous" id="S4.E20.m1.3.3.1.3.3.2.1.cmml" xref="S4.E20.m1.3.3.1.3.3.2">subscript</csymbol><ci id="S4.E20.m1.3.3.1.3.3.2.2.cmml" xref="S4.E20.m1.3.3.1.3.3.2.2">𝐹</ci><ci id="S4.E20.m1.3.3.1.3.3.2.3.cmml" xref="S4.E20.m1.3.3.1.3.3.2.3">𝑗</ci></apply><ci id="S4.E20.m1.3.3.1.3.3.3.cmml" xref="S4.E20.m1.3.3.1.3.3.3">ℱ</ci></apply></apply><ci id="S4.E20.m1.3.3.1.4a.cmml" xref="S4.E20.m1.3.3.1.4"><mtext id="S4.E20.m1.3.3.1.4.cmml" xref="S4.E20.m1.3.3.1.4">score</mtext></ci><interval closure="open" id="S4.E20.m1.3.3.1.1.2.cmml" xref="S4.E20.m1.3.3.1.1.1"><ci id="S4.E20.m1.2.2.cmml" xref="S4.E20.m1.2.2">𝑞</ci><apply id="S4.E20.m1.3.3.1.1.1.1.cmml" xref="S4.E20.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S4.E20.m1.3.3.1.1.1.1.1.cmml" xref="S4.E20.m1.3.3.1.1.1.1">subscript</csymbol><ci id="S4.E20.m1.3.3.1.1.1.1.2.cmml" xref="S4.E20.m1.3.3.1.1.1.1.2">𝐹</ci><ci id="S4.E20.m1.3.3.1.1.1.1.3.cmml" xref="S4.E20.m1.3.3.1.1.1.1.3">𝑗</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E20.m1.3c">F_{i}(q)=\text{argmax}_{F_{j}\in\mathcal{F}}\text{score}(q,F_{j})</annotation><annotation encoding="application/x-llamapun" id="S4.E20.m1.3d">italic_F start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_q ) = argmax start_POSTSUBSCRIPT italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ caligraphic_F end_POSTSUBSCRIPT score ( italic_q , italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(20)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS1.p2.9"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS1.p2.9.1">Semantic routing</span> routes to different modules based on the semantic information of the query. Given a pre-defined intent <math alttext="\Theta=\{\theta_{1},\theta_{2},\ldots,\theta_{n}\}" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p2.8.m1.4"><semantics id="S4.SS6.SSS1.p2.8.m1.4a"><mrow id="S4.SS6.SSS1.p2.8.m1.4.4" xref="S4.SS6.SSS1.p2.8.m1.4.4.cmml"><mi id="S4.SS6.SSS1.p2.8.m1.4.4.5" mathvariant="normal" xref="S4.SS6.SSS1.p2.8.m1.4.4.5.cmml">Θ</mi><mo id="S4.SS6.SSS1.p2.8.m1.4.4.4" xref="S4.SS6.SSS1.p2.8.m1.4.4.4.cmml">=</mo><mrow id="S4.SS6.SSS1.p2.8.m1.4.4.3.3" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml"><mo id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.4" stretchy="false" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml">{</mo><msub id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.cmml"><mi id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.2" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.2.cmml">θ</mi><mn id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.3" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.5" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml">,</mo><msub id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.cmml"><mi id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.2" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.2.cmml">θ</mi><mn id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.3" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.3.cmml">2</mn></msub><mo id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.6" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml">,</mo><mi id="S4.SS6.SSS1.p2.8.m1.1.1" mathvariant="normal" xref="S4.SS6.SSS1.p2.8.m1.1.1.cmml">…</mi><mo id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.7" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml">,</mo><msub id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.cmml"><mi id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.2" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.2.cmml">θ</mi><mi id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.3" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.3.cmml">n</mi></msub><mo id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.8" stretchy="false" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p2.8.m1.4b"><apply id="S4.SS6.SSS1.p2.8.m1.4.4.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4"><eq id="S4.SS6.SSS1.p2.8.m1.4.4.4.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.4"></eq><ci id="S4.SS6.SSS1.p2.8.m1.4.4.5.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.5">Θ</ci><set id="S4.SS6.SSS1.p2.8.m1.4.4.3.4.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3"><apply id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.cmml" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.1.cmml" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.2.cmml" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.2">𝜃</ci><cn id="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.3.cmml" type="integer" xref="S4.SS6.SSS1.p2.8.m1.2.2.1.1.1.3">1</cn></apply><apply id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.cmml" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.1.cmml" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2">subscript</csymbol><ci id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.2.cmml" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.2">𝜃</ci><cn id="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.3.cmml" type="integer" xref="S4.SS6.SSS1.p2.8.m1.3.3.2.2.2.3">2</cn></apply><ci id="S4.SS6.SSS1.p2.8.m1.1.1.cmml" xref="S4.SS6.SSS1.p2.8.m1.1.1">…</ci><apply id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.1.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3">subscript</csymbol><ci id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.2.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.2">𝜃</ci><ci id="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.3.cmml" xref="S4.SS6.SSS1.p2.8.m1.4.4.3.3.3.3">𝑛</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.8.m1.4c">\Theta=\{\theta_{1},\theta_{2},\ldots,\theta_{n}\}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.8.m1.4d">roman_Θ = { italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_θ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_θ start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math>, the possibility of intent for query q is <math alttext="P_{\Theta}(\theta|q)=\frac{e^{P_{LM}(\theta|q)}}{\sum_{\theta\in\Theta}{e^{P_{%
LM}(\theta|q))}}}" class="ltx_math_unparsed" display="inline" id="S4.SS6.SSS1.p2.9.m2.2"><semantics id="S4.SS6.SSS1.p2.9.m2.2a"><mrow id="S4.SS6.SSS1.p2.9.m2.2.2"><mrow id="S4.SS6.SSS1.p2.9.m2.2.2.1"><msub id="S4.SS6.SSS1.p2.9.m2.2.2.1.3"><mi id="S4.SS6.SSS1.p2.9.m2.2.2.1.3.2">P</mi><mi id="S4.SS6.SSS1.p2.9.m2.2.2.1.3.3" mathvariant="normal">Θ</mi></msub><mo id="S4.SS6.SSS1.p2.9.m2.2.2.1.2">⁢</mo><mrow id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1"><mo id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.2" stretchy="false">(</mo><mrow id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.1"><mi id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.1.2">θ</mi><mo fence="false" id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.1.1">|</mo><mi id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.1.3">q</mi></mrow><mo id="S4.SS6.SSS1.p2.9.m2.2.2.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mo id="S4.SS6.SSS1.p2.9.m2.2.2.2">=</mo><mfrac id="S4.SS6.SSS1.p2.9.m2.1.1"><msup id="S4.SS6.SSS1.p2.9.m2.1.1.1"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.3">e</mi><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1"><msub id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3.2">P</mi><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3.3"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3.3.2">L</mi><mo id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3.3.1">⁢</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.3.3.3">M</mi></mrow></msub><mo id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.2">⁢</mo><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1"><mo id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.2" stretchy="false">(</mo><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.1"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.1.2">θ</mi><mo fence="false" id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.1.1">|</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.1.3">q</mi></mrow><mo id="S4.SS6.SSS1.p2.9.m2.1.1.1.1.1.1.1.3" stretchy="false">)</mo></mrow></mrow></msup><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.3"><mstyle displaystyle="false" id="S4.SS6.SSS1.p2.9.m2.1.1.3.1"><msub id="S4.SS6.SSS1.p2.9.m2.1.1.3.1a"><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.1.2">∑</mo><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.3.1.3"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.1.3.2">θ</mi><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.1.3.1">∈</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.1.3.3" mathvariant="normal">Θ</mi></mrow></msub></mstyle><msup id="S4.SS6.SSS1.p2.9.m2.1.1.3.2"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.2">e</mi><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3"><msub id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1.2">P</mi><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1.3"><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1.3.2">L</mi><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1.3.1">⁢</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.1.3.3">M</mi></mrow></msub><mrow id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2"><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2.1" stretchy="false">(</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2.2">θ</mi><mo fence="false" id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2.3" rspace="0.167em" stretchy="false">|</mo><mi id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2.4">q</mi><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.2.5" stretchy="false">)</mo></mrow><mo id="S4.SS6.SSS1.p2.9.m2.1.1.3.2.3.3" stretchy="false">)</mo></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p2.9.m2.2b">P_{\Theta}(\theta|q)=\frac{e^{P_{LM}(\theta|q)}}{\sum_{\theta\in\Theta}{e^{P_{%
LM}(\theta|q))}}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p2.9.m2.2c">italic_P start_POSTSUBSCRIPT roman_Θ end_POSTSUBSCRIPT ( italic_θ | italic_q ) = divide start_ARG italic_e start_POSTSUPERSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_θ | italic_q ) end_POSTSUPERSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT italic_e start_POSTSUPERSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_M end_POSTSUBSCRIPT ( italic_θ | italic_q ) ) end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math>. Routing to specific RAG flow is determined by the semantic score:</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS1.p3">
<table class="ltx_equation ltx_eqn_table" id="S4.E21">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="socre_{semantic}(q,F_{j})=argmax_{\theta_{j}\in\Theta}P(\Theta)" class="ltx_Math" display="block" id="S4.E21.m1.3"><semantics id="S4.E21.m1.3a"><mrow id="S4.E21.m1.3.3" xref="S4.E21.m1.3.3.cmml"><mrow id="S4.E21.m1.3.3.1" xref="S4.E21.m1.3.3.1.cmml"><mi id="S4.E21.m1.3.3.1.3" xref="S4.E21.m1.3.3.1.3.cmml">s</mi><mo id="S4.E21.m1.3.3.1.2" xref="S4.E21.m1.3.3.1.2.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.4" xref="S4.E21.m1.3.3.1.4.cmml">o</mi><mo id="S4.E21.m1.3.3.1.2a" xref="S4.E21.m1.3.3.1.2.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.5" xref="S4.E21.m1.3.3.1.5.cmml">c</mi><mo id="S4.E21.m1.3.3.1.2b" xref="S4.E21.m1.3.3.1.2.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.6" xref="S4.E21.m1.3.3.1.6.cmml">r</mi><mo id="S4.E21.m1.3.3.1.2c" xref="S4.E21.m1.3.3.1.2.cmml">⁢</mo><msub id="S4.E21.m1.3.3.1.7" xref="S4.E21.m1.3.3.1.7.cmml"><mi id="S4.E21.m1.3.3.1.7.2" xref="S4.E21.m1.3.3.1.7.2.cmml">e</mi><mrow id="S4.E21.m1.3.3.1.7.3" xref="S4.E21.m1.3.3.1.7.3.cmml"><mi id="S4.E21.m1.3.3.1.7.3.2" xref="S4.E21.m1.3.3.1.7.3.2.cmml">s</mi><mo id="S4.E21.m1.3.3.1.7.3.1" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.3" xref="S4.E21.m1.3.3.1.7.3.3.cmml">e</mi><mo id="S4.E21.m1.3.3.1.7.3.1a" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.4" xref="S4.E21.m1.3.3.1.7.3.4.cmml">m</mi><mo id="S4.E21.m1.3.3.1.7.3.1b" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.5" xref="S4.E21.m1.3.3.1.7.3.5.cmml">a</mi><mo id="S4.E21.m1.3.3.1.7.3.1c" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.6" xref="S4.E21.m1.3.3.1.7.3.6.cmml">n</mi><mo id="S4.E21.m1.3.3.1.7.3.1d" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.7" xref="S4.E21.m1.3.3.1.7.3.7.cmml">t</mi><mo id="S4.E21.m1.3.3.1.7.3.1e" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.8" xref="S4.E21.m1.3.3.1.7.3.8.cmml">i</mi><mo id="S4.E21.m1.3.3.1.7.3.1f" xref="S4.E21.m1.3.3.1.7.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.1.7.3.9" xref="S4.E21.m1.3.3.1.7.3.9.cmml">c</mi></mrow></msub><mo id="S4.E21.m1.3.3.1.2d" xref="S4.E21.m1.3.3.1.2.cmml">⁢</mo><mrow id="S4.E21.m1.3.3.1.1.1" xref="S4.E21.m1.3.3.1.1.2.cmml"><mo id="S4.E21.m1.3.3.1.1.1.2" stretchy="false" xref="S4.E21.m1.3.3.1.1.2.cmml">(</mo><mi id="S4.E21.m1.1.1" xref="S4.E21.m1.1.1.cmml">q</mi><mo id="S4.E21.m1.3.3.1.1.1.3" xref="S4.E21.m1.3.3.1.1.2.cmml">,</mo><msub id="S4.E21.m1.3.3.1.1.1.1" xref="S4.E21.m1.3.3.1.1.1.1.cmml"><mi id="S4.E21.m1.3.3.1.1.1.1.2" xref="S4.E21.m1.3.3.1.1.1.1.2.cmml">F</mi><mi id="S4.E21.m1.3.3.1.1.1.1.3" xref="S4.E21.m1.3.3.1.1.1.1.3.cmml">j</mi></msub><mo id="S4.E21.m1.3.3.1.1.1.4" stretchy="false" xref="S4.E21.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E21.m1.3.3.2" xref="S4.E21.m1.3.3.2.cmml">=</mo><mrow id="S4.E21.m1.3.3.3" xref="S4.E21.m1.3.3.3.cmml"><mi id="S4.E21.m1.3.3.3.2" xref="S4.E21.m1.3.3.3.2.cmml">a</mi><mo id="S4.E21.m1.3.3.3.1" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.3.3" xref="S4.E21.m1.3.3.3.3.cmml">r</mi><mo id="S4.E21.m1.3.3.3.1a" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.3.4" xref="S4.E21.m1.3.3.3.4.cmml">g</mi><mo id="S4.E21.m1.3.3.3.1b" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.3.5" xref="S4.E21.m1.3.3.3.5.cmml">m</mi><mo id="S4.E21.m1.3.3.3.1c" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.3.6" xref="S4.E21.m1.3.3.3.6.cmml">a</mi><mo id="S4.E21.m1.3.3.3.1d" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><msub id="S4.E21.m1.3.3.3.7" xref="S4.E21.m1.3.3.3.7.cmml"><mi id="S4.E21.m1.3.3.3.7.2" xref="S4.E21.m1.3.3.3.7.2.cmml">x</mi><mrow id="S4.E21.m1.3.3.3.7.3" xref="S4.E21.m1.3.3.3.7.3.cmml"><msub id="S4.E21.m1.3.3.3.7.3.2" xref="S4.E21.m1.3.3.3.7.3.2.cmml"><mi id="S4.E21.m1.3.3.3.7.3.2.2" xref="S4.E21.m1.3.3.3.7.3.2.2.cmml">θ</mi><mi id="S4.E21.m1.3.3.3.7.3.2.3" xref="S4.E21.m1.3.3.3.7.3.2.3.cmml">j</mi></msub><mo id="S4.E21.m1.3.3.3.7.3.1" xref="S4.E21.m1.3.3.3.7.3.1.cmml">∈</mo><mi id="S4.E21.m1.3.3.3.7.3.3" mathvariant="normal" xref="S4.E21.m1.3.3.3.7.3.3.cmml">Θ</mi></mrow></msub><mo id="S4.E21.m1.3.3.3.1e" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mi id="S4.E21.m1.3.3.3.8" xref="S4.E21.m1.3.3.3.8.cmml">P</mi><mo id="S4.E21.m1.3.3.3.1f" xref="S4.E21.m1.3.3.3.1.cmml">⁢</mo><mrow id="S4.E21.m1.3.3.3.9.2" xref="S4.E21.m1.3.3.3.cmml"><mo id="S4.E21.m1.3.3.3.9.2.1" stretchy="false" xref="S4.E21.m1.3.3.3.cmml">(</mo><mi id="S4.E21.m1.2.2" mathvariant="normal" xref="S4.E21.m1.2.2.cmml">Θ</mi><mo id="S4.E21.m1.3.3.3.9.2.2" stretchy="false" xref="S4.E21.m1.3.3.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E21.m1.3b"><apply id="S4.E21.m1.3.3.cmml" xref="S4.E21.m1.3.3"><eq id="S4.E21.m1.3.3.2.cmml" xref="S4.E21.m1.3.3.2"></eq><apply id="S4.E21.m1.3.3.1.cmml" xref="S4.E21.m1.3.3.1"><times id="S4.E21.m1.3.3.1.2.cmml" xref="S4.E21.m1.3.3.1.2"></times><ci id="S4.E21.m1.3.3.1.3.cmml" xref="S4.E21.m1.3.3.1.3">𝑠</ci><ci id="S4.E21.m1.3.3.1.4.cmml" xref="S4.E21.m1.3.3.1.4">𝑜</ci><ci id="S4.E21.m1.3.3.1.5.cmml" xref="S4.E21.m1.3.3.1.5">𝑐</ci><ci id="S4.E21.m1.3.3.1.6.cmml" xref="S4.E21.m1.3.3.1.6">𝑟</ci><apply id="S4.E21.m1.3.3.1.7.cmml" xref="S4.E21.m1.3.3.1.7"><csymbol cd="ambiguous" id="S4.E21.m1.3.3.1.7.1.cmml" xref="S4.E21.m1.3.3.1.7">subscript</csymbol><ci id="S4.E21.m1.3.3.1.7.2.cmml" xref="S4.E21.m1.3.3.1.7.2">𝑒</ci><apply id="S4.E21.m1.3.3.1.7.3.cmml" xref="S4.E21.m1.3.3.1.7.3"><times id="S4.E21.m1.3.3.1.7.3.1.cmml" xref="S4.E21.m1.3.3.1.7.3.1"></times><ci id="S4.E21.m1.3.3.1.7.3.2.cmml" xref="S4.E21.m1.3.3.1.7.3.2">𝑠</ci><ci id="S4.E21.m1.3.3.1.7.3.3.cmml" xref="S4.E21.m1.3.3.1.7.3.3">𝑒</ci><ci id="S4.E21.m1.3.3.1.7.3.4.cmml" xref="S4.E21.m1.3.3.1.7.3.4">𝑚</ci><ci id="S4.E21.m1.3.3.1.7.3.5.cmml" xref="S4.E21.m1.3.3.1.7.3.5">𝑎</ci><ci id="S4.E21.m1.3.3.1.7.3.6.cmml" xref="S4.E21.m1.3.3.1.7.3.6">𝑛</ci><ci id="S4.E21.m1.3.3.1.7.3.7.cmml" xref="S4.E21.m1.3.3.1.7.3.7">𝑡</ci><ci id="S4.E21.m1.3.3.1.7.3.8.cmml" xref="S4.E21.m1.3.3.1.7.3.8">𝑖</ci><ci id="S4.E21.m1.3.3.1.7.3.9.cmml" xref="S4.E21.m1.3.3.1.7.3.9">𝑐</ci></apply></apply><interval closure="open" id="S4.E21.m1.3.3.1.1.2.cmml" xref="S4.E21.m1.3.3.1.1.1"><ci id="S4.E21.m1.1.1.cmml" xref="S4.E21.m1.1.1">𝑞</ci><apply id="S4.E21.m1.3.3.1.1.1.1.cmml" xref="S4.E21.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S4.E21.m1.3.3.1.1.1.1.1.cmml" xref="S4.E21.m1.3.3.1.1.1.1">subscript</csymbol><ci id="S4.E21.m1.3.3.1.1.1.1.2.cmml" xref="S4.E21.m1.3.3.1.1.1.1.2">𝐹</ci><ci id="S4.E21.m1.3.3.1.1.1.1.3.cmml" xref="S4.E21.m1.3.3.1.1.1.1.3">𝑗</ci></apply></interval></apply><apply id="S4.E21.m1.3.3.3.cmml" xref="S4.E21.m1.3.3.3"><times id="S4.E21.m1.3.3.3.1.cmml" xref="S4.E21.m1.3.3.3.1"></times><ci id="S4.E21.m1.3.3.3.2.cmml" xref="S4.E21.m1.3.3.3.2">𝑎</ci><ci id="S4.E21.m1.3.3.3.3.cmml" xref="S4.E21.m1.3.3.3.3">𝑟</ci><ci id="S4.E21.m1.3.3.3.4.cmml" xref="S4.E21.m1.3.3.3.4">𝑔</ci><ci id="S4.E21.m1.3.3.3.5.cmml" xref="S4.E21.m1.3.3.3.5">𝑚</ci><ci id="S4.E21.m1.3.3.3.6.cmml" xref="S4.E21.m1.3.3.3.6">𝑎</ci><apply id="S4.E21.m1.3.3.3.7.cmml" xref="S4.E21.m1.3.3.3.7"><csymbol cd="ambiguous" id="S4.E21.m1.3.3.3.7.1.cmml" xref="S4.E21.m1.3.3.3.7">subscript</csymbol><ci id="S4.E21.m1.3.3.3.7.2.cmml" xref="S4.E21.m1.3.3.3.7.2">𝑥</ci><apply id="S4.E21.m1.3.3.3.7.3.cmml" xref="S4.E21.m1.3.3.3.7.3"><in id="S4.E21.m1.3.3.3.7.3.1.cmml" xref="S4.E21.m1.3.3.3.7.3.1"></in><apply id="S4.E21.m1.3.3.3.7.3.2.cmml" xref="S4.E21.m1.3.3.3.7.3.2"><csymbol cd="ambiguous" id="S4.E21.m1.3.3.3.7.3.2.1.cmml" xref="S4.E21.m1.3.3.3.7.3.2">subscript</csymbol><ci id="S4.E21.m1.3.3.3.7.3.2.2.cmml" xref="S4.E21.m1.3.3.3.7.3.2.2">𝜃</ci><ci id="S4.E21.m1.3.3.3.7.3.2.3.cmml" xref="S4.E21.m1.3.3.3.7.3.2.3">𝑗</ci></apply><ci id="S4.E21.m1.3.3.3.7.3.3.cmml" xref="S4.E21.m1.3.3.3.7.3.3">Θ</ci></apply></apply><ci id="S4.E21.m1.3.3.3.8.cmml" xref="S4.E21.m1.3.3.3.8">𝑃</ci><ci id="S4.E21.m1.2.2.cmml" xref="S4.E21.m1.2.2">Θ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E21.m1.3c">socre_{semantic}(q,F_{j})=argmax_{\theta_{j}\in\Theta}P(\Theta)</annotation><annotation encoding="application/x-llamapun" id="S4.E21.m1.3d">italic_s italic_o italic_c italic_r italic_e start_POSTSUBSCRIPT italic_s italic_e italic_m italic_a italic_n italic_t italic_i italic_c end_POSTSUBSCRIPT ( italic_q , italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) = italic_a italic_r italic_g italic_m italic_a italic_x start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ roman_Θ end_POSTSUBSCRIPT italic_P ( roman_Θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(21)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS1.p3.2">The function <math alttext="\delta(\cdot)" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p3.1.m1.1"><semantics id="S4.SS6.SSS1.p3.1.m1.1a"><mrow id="S4.SS6.SSS1.p3.1.m1.1.2" xref="S4.SS6.SSS1.p3.1.m1.1.2.cmml"><mi id="S4.SS6.SSS1.p3.1.m1.1.2.2" xref="S4.SS6.SSS1.p3.1.m1.1.2.2.cmml">δ</mi><mo id="S4.SS6.SSS1.p3.1.m1.1.2.1" xref="S4.SS6.SSS1.p3.1.m1.1.2.1.cmml">⁢</mo><mrow id="S4.SS6.SSS1.p3.1.m1.1.2.3.2" xref="S4.SS6.SSS1.p3.1.m1.1.2.cmml"><mo id="S4.SS6.SSS1.p3.1.m1.1.2.3.2.1" stretchy="false" xref="S4.SS6.SSS1.p3.1.m1.1.2.cmml">(</mo><mo id="S4.SS6.SSS1.p3.1.m1.1.1" lspace="0em" rspace="0em" xref="S4.SS6.SSS1.p3.1.m1.1.1.cmml">⋅</mo><mo id="S4.SS6.SSS1.p3.1.m1.1.2.3.2.2" stretchy="false" xref="S4.SS6.SSS1.p3.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p3.1.m1.1b"><apply id="S4.SS6.SSS1.p3.1.m1.1.2.cmml" xref="S4.SS6.SSS1.p3.1.m1.1.2"><times id="S4.SS6.SSS1.p3.1.m1.1.2.1.cmml" xref="S4.SS6.SSS1.p3.1.m1.1.2.1"></times><ci id="S4.SS6.SSS1.p3.1.m1.1.2.2.cmml" xref="S4.SS6.SSS1.p3.1.m1.1.2.2">𝛿</ci><ci id="S4.SS6.SSS1.p3.1.m1.1.1.cmml" xref="S4.SS6.SSS1.p3.1.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p3.1.m1.1c">\delta(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p3.1.m1.1d">italic_δ ( ⋅ )</annotation></semantics></math> serves as a mapping function that assigns an intent to a distinct RAG flow <math alttext="\mathcal{F}_{i}=\delta(\theta_{i})" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p3.2.m2.1"><semantics id="S4.SS6.SSS1.p3.2.m2.1a"><mrow id="S4.SS6.SSS1.p3.2.m2.1.1" xref="S4.SS6.SSS1.p3.2.m2.1.1.cmml"><msub id="S4.SS6.SSS1.p3.2.m2.1.1.3" xref="S4.SS6.SSS1.p3.2.m2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS6.SSS1.p3.2.m2.1.1.3.2" xref="S4.SS6.SSS1.p3.2.m2.1.1.3.2.cmml">ℱ</mi><mi id="S4.SS6.SSS1.p3.2.m2.1.1.3.3" xref="S4.SS6.SSS1.p3.2.m2.1.1.3.3.cmml">i</mi></msub><mo id="S4.SS6.SSS1.p3.2.m2.1.1.2" xref="S4.SS6.SSS1.p3.2.m2.1.1.2.cmml">=</mo><mrow id="S4.SS6.SSS1.p3.2.m2.1.1.1" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.cmml"><mi id="S4.SS6.SSS1.p3.2.m2.1.1.1.3" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.3.cmml">δ</mi><mo id="S4.SS6.SSS1.p3.2.m2.1.1.1.2" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.2.cmml">⁢</mo><mrow id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.cmml"><mo id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.2" stretchy="false" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.cmml">(</mo><msub id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.cmml"><mi id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.2" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.2.cmml">θ</mi><mi id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.3" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.3" stretchy="false" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p3.2.m2.1b"><apply id="S4.SS6.SSS1.p3.2.m2.1.1.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1"><eq id="S4.SS6.SSS1.p3.2.m2.1.1.2.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.2"></eq><apply id="S4.SS6.SSS1.p3.2.m2.1.1.3.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p3.2.m2.1.1.3.1.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.3">subscript</csymbol><ci id="S4.SS6.SSS1.p3.2.m2.1.1.3.2.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.3.2">ℱ</ci><ci id="S4.SS6.SSS1.p3.2.m2.1.1.3.3.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.3.3">𝑖</ci></apply><apply id="S4.SS6.SSS1.p3.2.m2.1.1.1.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1"><times id="S4.SS6.SSS1.p3.2.m2.1.1.1.2.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.2"></times><ci id="S4.SS6.SSS1.p3.2.m2.1.1.1.3.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.3">𝛿</ci><apply id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.1.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.2.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.2">𝜃</ci><ci id="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.3.cmml" xref="S4.SS6.SSS1.p3.2.m2.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p3.2.m2.1c">\mathcal{F}_{i}=\delta(\theta_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p3.2.m2.1d">caligraphic_F start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_δ ( italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math></p>
</div>
<div class="ltx_para" id="S4.SS6.SSS1.p4">
<p class="ltx_p" id="S4.SS6.SSS1.p4.2"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS1.p4.2.1">Hybrid Routing</span> can be implemented to improve query routing by integrating both semantic analysis and metadata-based approaches, which can be defined as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E22">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\alpha_{i}=a\cdot score_{key}(q,F_{j})+(1-\alpha)\cdot max_{\theta_{j}\in%
\Theta}socre_{semantic}(q,F_{j})" class="ltx_Math" display="block" id="S4.E22.m1.5"><semantics id="S4.E22.m1.5a"><mrow id="S4.E22.m1.5.5" xref="S4.E22.m1.5.5.cmml"><msub id="S4.E22.m1.5.5.5" xref="S4.E22.m1.5.5.5.cmml"><mi id="S4.E22.m1.5.5.5.2" xref="S4.E22.m1.5.5.5.2.cmml">α</mi><mi id="S4.E22.m1.5.5.5.3" xref="S4.E22.m1.5.5.5.3.cmml">i</mi></msub><mo id="S4.E22.m1.5.5.4" xref="S4.E22.m1.5.5.4.cmml">=</mo><mrow id="S4.E22.m1.5.5.3" xref="S4.E22.m1.5.5.3.cmml"><mrow id="S4.E22.m1.3.3.1.1" xref="S4.E22.m1.3.3.1.1.cmml"><mrow id="S4.E22.m1.3.3.1.1.3" xref="S4.E22.m1.3.3.1.1.3.cmml"><mi id="S4.E22.m1.3.3.1.1.3.2" xref="S4.E22.m1.3.3.1.1.3.2.cmml">a</mi><mo id="S4.E22.m1.3.3.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S4.E22.m1.3.3.1.1.3.1.cmml">⋅</mo><mi id="S4.E22.m1.3.3.1.1.3.3" xref="S4.E22.m1.3.3.1.1.3.3.cmml">s</mi></mrow><mo id="S4.E22.m1.3.3.1.1.2" xref="S4.E22.m1.3.3.1.1.2.cmml">⁢</mo><mi id="S4.E22.m1.3.3.1.1.4" xref="S4.E22.m1.3.3.1.1.4.cmml">c</mi><mo id="S4.E22.m1.3.3.1.1.2a" xref="S4.E22.m1.3.3.1.1.2.cmml">⁢</mo><mi id="S4.E22.m1.3.3.1.1.5" xref="S4.E22.m1.3.3.1.1.5.cmml">o</mi><mo id="S4.E22.m1.3.3.1.1.2b" xref="S4.E22.m1.3.3.1.1.2.cmml">⁢</mo><mi id="S4.E22.m1.3.3.1.1.6" xref="S4.E22.m1.3.3.1.1.6.cmml">r</mi><mo id="S4.E22.m1.3.3.1.1.2c" xref="S4.E22.m1.3.3.1.1.2.cmml">⁢</mo><msub id="S4.E22.m1.3.3.1.1.7" xref="S4.E22.m1.3.3.1.1.7.cmml"><mi id="S4.E22.m1.3.3.1.1.7.2" xref="S4.E22.m1.3.3.1.1.7.2.cmml">e</mi><mrow id="S4.E22.m1.3.3.1.1.7.3" xref="S4.E22.m1.3.3.1.1.7.3.cmml"><mi id="S4.E22.m1.3.3.1.1.7.3.2" xref="S4.E22.m1.3.3.1.1.7.3.2.cmml">k</mi><mo id="S4.E22.m1.3.3.1.1.7.3.1" xref="S4.E22.m1.3.3.1.1.7.3.1.cmml">⁢</mo><mi id="S4.E22.m1.3.3.1.1.7.3.3" xref="S4.E22.m1.3.3.1.1.7.3.3.cmml">e</mi><mo id="S4.E22.m1.3.3.1.1.7.3.1a" xref="S4.E22.m1.3.3.1.1.7.3.1.cmml">⁢</mo><mi id="S4.E22.m1.3.3.1.1.7.3.4" xref="S4.E22.m1.3.3.1.1.7.3.4.cmml">y</mi></mrow></msub><mo id="S4.E22.m1.3.3.1.1.2d" xref="S4.E22.m1.3.3.1.1.2.cmml">⁢</mo><mrow id="S4.E22.m1.3.3.1.1.1.1" xref="S4.E22.m1.3.3.1.1.1.2.cmml"><mo id="S4.E22.m1.3.3.1.1.1.1.2" stretchy="false" xref="S4.E22.m1.3.3.1.1.1.2.cmml">(</mo><mi id="S4.E22.m1.1.1" xref="S4.E22.m1.1.1.cmml">q</mi><mo id="S4.E22.m1.3.3.1.1.1.1.3" xref="S4.E22.m1.3.3.1.1.1.2.cmml">,</mo><msub id="S4.E22.m1.3.3.1.1.1.1.1" xref="S4.E22.m1.3.3.1.1.1.1.1.cmml"><mi id="S4.E22.m1.3.3.1.1.1.1.1.2" xref="S4.E22.m1.3.3.1.1.1.1.1.2.cmml">F</mi><mi id="S4.E22.m1.3.3.1.1.1.1.1.3" xref="S4.E22.m1.3.3.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S4.E22.m1.3.3.1.1.1.1.4" stretchy="false" xref="S4.E22.m1.3.3.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E22.m1.5.5.3.4" xref="S4.E22.m1.5.5.3.4.cmml">+</mo><mrow id="S4.E22.m1.5.5.3.3" xref="S4.E22.m1.5.5.3.3.cmml"><mrow id="S4.E22.m1.4.4.2.2.1" xref="S4.E22.m1.4.4.2.2.1.cmml"><mrow id="S4.E22.m1.4.4.2.2.1.1.1" xref="S4.E22.m1.4.4.2.2.1.1.1.1.cmml"><mo id="S4.E22.m1.4.4.2.2.1.1.1.2" stretchy="false" xref="S4.E22.m1.4.4.2.2.1.1.1.1.cmml">(</mo><mrow id="S4.E22.m1.4.4.2.2.1.1.1.1" xref="S4.E22.m1.4.4.2.2.1.1.1.1.cmml"><mn id="S4.E22.m1.4.4.2.2.1.1.1.1.2" xref="S4.E22.m1.4.4.2.2.1.1.1.1.2.cmml">1</mn><mo id="S4.E22.m1.4.4.2.2.1.1.1.1.1" xref="S4.E22.m1.4.4.2.2.1.1.1.1.1.cmml">−</mo><mi id="S4.E22.m1.4.4.2.2.1.1.1.1.3" xref="S4.E22.m1.4.4.2.2.1.1.1.1.3.cmml">α</mi></mrow><mo id="S4.E22.m1.4.4.2.2.1.1.1.3" rspace="0.055em" stretchy="false" xref="S4.E22.m1.4.4.2.2.1.1.1.1.cmml">)</mo></mrow><mo id="S4.E22.m1.4.4.2.2.1.2" rspace="0.222em" xref="S4.E22.m1.4.4.2.2.1.2.cmml">⋅</mo><mi id="S4.E22.m1.4.4.2.2.1.3" xref="S4.E22.m1.4.4.2.2.1.3.cmml">m</mi></mrow><mo id="S4.E22.m1.5.5.3.3.3" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.4" xref="S4.E22.m1.5.5.3.3.4.cmml">a</mi><mo id="S4.E22.m1.5.5.3.3.3a" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><msub id="S4.E22.m1.5.5.3.3.5" xref="S4.E22.m1.5.5.3.3.5.cmml"><mi id="S4.E22.m1.5.5.3.3.5.2" xref="S4.E22.m1.5.5.3.3.5.2.cmml">x</mi><mrow id="S4.E22.m1.5.5.3.3.5.3" xref="S4.E22.m1.5.5.3.3.5.3.cmml"><msub id="S4.E22.m1.5.5.3.3.5.3.2" xref="S4.E22.m1.5.5.3.3.5.3.2.cmml"><mi id="S4.E22.m1.5.5.3.3.5.3.2.2" xref="S4.E22.m1.5.5.3.3.5.3.2.2.cmml">θ</mi><mi id="S4.E22.m1.5.5.3.3.5.3.2.3" xref="S4.E22.m1.5.5.3.3.5.3.2.3.cmml">j</mi></msub><mo id="S4.E22.m1.5.5.3.3.5.3.1" xref="S4.E22.m1.5.5.3.3.5.3.1.cmml">∈</mo><mi id="S4.E22.m1.5.5.3.3.5.3.3" mathvariant="normal" xref="S4.E22.m1.5.5.3.3.5.3.3.cmml">Θ</mi></mrow></msub><mo id="S4.E22.m1.5.5.3.3.3b" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.6" xref="S4.E22.m1.5.5.3.3.6.cmml">s</mi><mo id="S4.E22.m1.5.5.3.3.3c" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.7" xref="S4.E22.m1.5.5.3.3.7.cmml">o</mi><mo id="S4.E22.m1.5.5.3.3.3d" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.8" xref="S4.E22.m1.5.5.3.3.8.cmml">c</mi><mo id="S4.E22.m1.5.5.3.3.3e" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.9" xref="S4.E22.m1.5.5.3.3.9.cmml">r</mi><mo id="S4.E22.m1.5.5.3.3.3f" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><msub id="S4.E22.m1.5.5.3.3.10" xref="S4.E22.m1.5.5.3.3.10.cmml"><mi id="S4.E22.m1.5.5.3.3.10.2" xref="S4.E22.m1.5.5.3.3.10.2.cmml">e</mi><mrow id="S4.E22.m1.5.5.3.3.10.3" xref="S4.E22.m1.5.5.3.3.10.3.cmml"><mi id="S4.E22.m1.5.5.3.3.10.3.2" xref="S4.E22.m1.5.5.3.3.10.3.2.cmml">s</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.3" xref="S4.E22.m1.5.5.3.3.10.3.3.cmml">e</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1a" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.4" xref="S4.E22.m1.5.5.3.3.10.3.4.cmml">m</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1b" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.5" xref="S4.E22.m1.5.5.3.3.10.3.5.cmml">a</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1c" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.6" xref="S4.E22.m1.5.5.3.3.10.3.6.cmml">n</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1d" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.7" xref="S4.E22.m1.5.5.3.3.10.3.7.cmml">t</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1e" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.8" xref="S4.E22.m1.5.5.3.3.10.3.8.cmml">i</mi><mo id="S4.E22.m1.5.5.3.3.10.3.1f" xref="S4.E22.m1.5.5.3.3.10.3.1.cmml">⁢</mo><mi id="S4.E22.m1.5.5.3.3.10.3.9" xref="S4.E22.m1.5.5.3.3.10.3.9.cmml">c</mi></mrow></msub><mo id="S4.E22.m1.5.5.3.3.3g" xref="S4.E22.m1.5.5.3.3.3.cmml">⁢</mo><mrow id="S4.E22.m1.5.5.3.3.2.1" xref="S4.E22.m1.5.5.3.3.2.2.cmml"><mo id="S4.E22.m1.5.5.3.3.2.1.2" stretchy="false" xref="S4.E22.m1.5.5.3.3.2.2.cmml">(</mo><mi id="S4.E22.m1.2.2" xref="S4.E22.m1.2.2.cmml">q</mi><mo id="S4.E22.m1.5.5.3.3.2.1.3" xref="S4.E22.m1.5.5.3.3.2.2.cmml">,</mo><msub id="S4.E22.m1.5.5.3.3.2.1.1" xref="S4.E22.m1.5.5.3.3.2.1.1.cmml"><mi id="S4.E22.m1.5.5.3.3.2.1.1.2" xref="S4.E22.m1.5.5.3.3.2.1.1.2.cmml">F</mi><mi id="S4.E22.m1.5.5.3.3.2.1.1.3" xref="S4.E22.m1.5.5.3.3.2.1.1.3.cmml">j</mi></msub><mo id="S4.E22.m1.5.5.3.3.2.1.4" stretchy="false" xref="S4.E22.m1.5.5.3.3.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E22.m1.5b"><apply id="S4.E22.m1.5.5.cmml" xref="S4.E22.m1.5.5"><eq id="S4.E22.m1.5.5.4.cmml" xref="S4.E22.m1.5.5.4"></eq><apply id="S4.E22.m1.5.5.5.cmml" xref="S4.E22.m1.5.5.5"><csymbol cd="ambiguous" id="S4.E22.m1.5.5.5.1.cmml" xref="S4.E22.m1.5.5.5">subscript</csymbol><ci id="S4.E22.m1.5.5.5.2.cmml" xref="S4.E22.m1.5.5.5.2">𝛼</ci><ci id="S4.E22.m1.5.5.5.3.cmml" xref="S4.E22.m1.5.5.5.3">𝑖</ci></apply><apply id="S4.E22.m1.5.5.3.cmml" xref="S4.E22.m1.5.5.3"><plus id="S4.E22.m1.5.5.3.4.cmml" xref="S4.E22.m1.5.5.3.4"></plus><apply id="S4.E22.m1.3.3.1.1.cmml" xref="S4.E22.m1.3.3.1.1"><times id="S4.E22.m1.3.3.1.1.2.cmml" xref="S4.E22.m1.3.3.1.1.2"></times><apply id="S4.E22.m1.3.3.1.1.3.cmml" xref="S4.E22.m1.3.3.1.1.3"><ci id="S4.E22.m1.3.3.1.1.3.1.cmml" xref="S4.E22.m1.3.3.1.1.3.1">⋅</ci><ci id="S4.E22.m1.3.3.1.1.3.2.cmml" xref="S4.E22.m1.3.3.1.1.3.2">𝑎</ci><ci id="S4.E22.m1.3.3.1.1.3.3.cmml" xref="S4.E22.m1.3.3.1.1.3.3">𝑠</ci></apply><ci id="S4.E22.m1.3.3.1.1.4.cmml" xref="S4.E22.m1.3.3.1.1.4">𝑐</ci><ci id="S4.E22.m1.3.3.1.1.5.cmml" xref="S4.E22.m1.3.3.1.1.5">𝑜</ci><ci id="S4.E22.m1.3.3.1.1.6.cmml" xref="S4.E22.m1.3.3.1.1.6">𝑟</ci><apply id="S4.E22.m1.3.3.1.1.7.cmml" xref="S4.E22.m1.3.3.1.1.7"><csymbol cd="ambiguous" id="S4.E22.m1.3.3.1.1.7.1.cmml" xref="S4.E22.m1.3.3.1.1.7">subscript</csymbol><ci id="S4.E22.m1.3.3.1.1.7.2.cmml" xref="S4.E22.m1.3.3.1.1.7.2">𝑒</ci><apply id="S4.E22.m1.3.3.1.1.7.3.cmml" xref="S4.E22.m1.3.3.1.1.7.3"><times id="S4.E22.m1.3.3.1.1.7.3.1.cmml" xref="S4.E22.m1.3.3.1.1.7.3.1"></times><ci id="S4.E22.m1.3.3.1.1.7.3.2.cmml" xref="S4.E22.m1.3.3.1.1.7.3.2">𝑘</ci><ci id="S4.E22.m1.3.3.1.1.7.3.3.cmml" xref="S4.E22.m1.3.3.1.1.7.3.3">𝑒</ci><ci id="S4.E22.m1.3.3.1.1.7.3.4.cmml" xref="S4.E22.m1.3.3.1.1.7.3.4">𝑦</ci></apply></apply><interval closure="open" id="S4.E22.m1.3.3.1.1.1.2.cmml" xref="S4.E22.m1.3.3.1.1.1.1"><ci id="S4.E22.m1.1.1.cmml" xref="S4.E22.m1.1.1">𝑞</ci><apply id="S4.E22.m1.3.3.1.1.1.1.1.cmml" xref="S4.E22.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E22.m1.3.3.1.1.1.1.1.1.cmml" xref="S4.E22.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="S4.E22.m1.3.3.1.1.1.1.1.2.cmml" xref="S4.E22.m1.3.3.1.1.1.1.1.2">𝐹</ci><ci id="S4.E22.m1.3.3.1.1.1.1.1.3.cmml" xref="S4.E22.m1.3.3.1.1.1.1.1.3">𝑗</ci></apply></interval></apply><apply id="S4.E22.m1.5.5.3.3.cmml" xref="S4.E22.m1.5.5.3.3"><times id="S4.E22.m1.5.5.3.3.3.cmml" xref="S4.E22.m1.5.5.3.3.3"></times><apply id="S4.E22.m1.4.4.2.2.1.cmml" xref="S4.E22.m1.4.4.2.2.1"><ci id="S4.E22.m1.4.4.2.2.1.2.cmml" xref="S4.E22.m1.4.4.2.2.1.2">⋅</ci><apply id="S4.E22.m1.4.4.2.2.1.1.1.1.cmml" xref="S4.E22.m1.4.4.2.2.1.1.1"><minus id="S4.E22.m1.4.4.2.2.1.1.1.1.1.cmml" xref="S4.E22.m1.4.4.2.2.1.1.1.1.1"></minus><cn id="S4.E22.m1.4.4.2.2.1.1.1.1.2.cmml" type="integer" xref="S4.E22.m1.4.4.2.2.1.1.1.1.2">1</cn><ci id="S4.E22.m1.4.4.2.2.1.1.1.1.3.cmml" xref="S4.E22.m1.4.4.2.2.1.1.1.1.3">𝛼</ci></apply><ci id="S4.E22.m1.4.4.2.2.1.3.cmml" xref="S4.E22.m1.4.4.2.2.1.3">𝑚</ci></apply><ci id="S4.E22.m1.5.5.3.3.4.cmml" xref="S4.E22.m1.5.5.3.3.4">𝑎</ci><apply id="S4.E22.m1.5.5.3.3.5.cmml" xref="S4.E22.m1.5.5.3.3.5"><csymbol cd="ambiguous" id="S4.E22.m1.5.5.3.3.5.1.cmml" xref="S4.E22.m1.5.5.3.3.5">subscript</csymbol><ci id="S4.E22.m1.5.5.3.3.5.2.cmml" xref="S4.E22.m1.5.5.3.3.5.2">𝑥</ci><apply id="S4.E22.m1.5.5.3.3.5.3.cmml" xref="S4.E22.m1.5.5.3.3.5.3"><in id="S4.E22.m1.5.5.3.3.5.3.1.cmml" xref="S4.E22.m1.5.5.3.3.5.3.1"></in><apply id="S4.E22.m1.5.5.3.3.5.3.2.cmml" xref="S4.E22.m1.5.5.3.3.5.3.2"><csymbol cd="ambiguous" id="S4.E22.m1.5.5.3.3.5.3.2.1.cmml" xref="S4.E22.m1.5.5.3.3.5.3.2">subscript</csymbol><ci id="S4.E22.m1.5.5.3.3.5.3.2.2.cmml" xref="S4.E22.m1.5.5.3.3.5.3.2.2">𝜃</ci><ci id="S4.E22.m1.5.5.3.3.5.3.2.3.cmml" xref="S4.E22.m1.5.5.3.3.5.3.2.3">𝑗</ci></apply><ci id="S4.E22.m1.5.5.3.3.5.3.3.cmml" xref="S4.E22.m1.5.5.3.3.5.3.3">Θ</ci></apply></apply><ci id="S4.E22.m1.5.5.3.3.6.cmml" xref="S4.E22.m1.5.5.3.3.6">𝑠</ci><ci id="S4.E22.m1.5.5.3.3.7.cmml" xref="S4.E22.m1.5.5.3.3.7">𝑜</ci><ci id="S4.E22.m1.5.5.3.3.8.cmml" xref="S4.E22.m1.5.5.3.3.8">𝑐</ci><ci id="S4.E22.m1.5.5.3.3.9.cmml" xref="S4.E22.m1.5.5.3.3.9">𝑟</ci><apply id="S4.E22.m1.5.5.3.3.10.cmml" xref="S4.E22.m1.5.5.3.3.10"><csymbol cd="ambiguous" id="S4.E22.m1.5.5.3.3.10.1.cmml" xref="S4.E22.m1.5.5.3.3.10">subscript</csymbol><ci id="S4.E22.m1.5.5.3.3.10.2.cmml" xref="S4.E22.m1.5.5.3.3.10.2">𝑒</ci><apply id="S4.E22.m1.5.5.3.3.10.3.cmml" xref="S4.E22.m1.5.5.3.3.10.3"><times id="S4.E22.m1.5.5.3.3.10.3.1.cmml" xref="S4.E22.m1.5.5.3.3.10.3.1"></times><ci id="S4.E22.m1.5.5.3.3.10.3.2.cmml" xref="S4.E22.m1.5.5.3.3.10.3.2">𝑠</ci><ci id="S4.E22.m1.5.5.3.3.10.3.3.cmml" xref="S4.E22.m1.5.5.3.3.10.3.3">𝑒</ci><ci id="S4.E22.m1.5.5.3.3.10.3.4.cmml" xref="S4.E22.m1.5.5.3.3.10.3.4">𝑚</ci><ci id="S4.E22.m1.5.5.3.3.10.3.5.cmml" xref="S4.E22.m1.5.5.3.3.10.3.5">𝑎</ci><ci id="S4.E22.m1.5.5.3.3.10.3.6.cmml" xref="S4.E22.m1.5.5.3.3.10.3.6">𝑛</ci><ci id="S4.E22.m1.5.5.3.3.10.3.7.cmml" xref="S4.E22.m1.5.5.3.3.10.3.7">𝑡</ci><ci id="S4.E22.m1.5.5.3.3.10.3.8.cmml" xref="S4.E22.m1.5.5.3.3.10.3.8">𝑖</ci><ci id="S4.E22.m1.5.5.3.3.10.3.9.cmml" xref="S4.E22.m1.5.5.3.3.10.3.9">𝑐</ci></apply></apply><interval closure="open" id="S4.E22.m1.5.5.3.3.2.2.cmml" xref="S4.E22.m1.5.5.3.3.2.1"><ci id="S4.E22.m1.2.2.cmml" xref="S4.E22.m1.2.2">𝑞</ci><apply id="S4.E22.m1.5.5.3.3.2.1.1.cmml" xref="S4.E22.m1.5.5.3.3.2.1.1"><csymbol cd="ambiguous" id="S4.E22.m1.5.5.3.3.2.1.1.1.cmml" xref="S4.E22.m1.5.5.3.3.2.1.1">subscript</csymbol><ci id="S4.E22.m1.5.5.3.3.2.1.1.2.cmml" xref="S4.E22.m1.5.5.3.3.2.1.1.2">𝐹</ci><ci id="S4.E22.m1.5.5.3.3.2.1.1.3.cmml" xref="S4.E22.m1.5.5.3.3.2.1.1.3">𝑗</ci></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E22.m1.5c">\alpha_{i}=a\cdot score_{key}(q,F_{j})+(1-\alpha)\cdot max_{\theta_{j}\in%
\Theta}socre_{semantic}(q,F_{j})</annotation><annotation encoding="application/x-llamapun" id="S4.E22.m1.5d">italic_α start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_a ⋅ italic_s italic_c italic_o italic_r italic_e start_POSTSUBSCRIPT italic_k italic_e italic_y end_POSTSUBSCRIPT ( italic_q , italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) + ( 1 - italic_α ) ⋅ italic_m italic_a italic_x start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ roman_Θ end_POSTSUBSCRIPT italic_s italic_o italic_c italic_r italic_e start_POSTSUBSCRIPT italic_s italic_e italic_m italic_a italic_n italic_t italic_i italic_c end_POSTSUBSCRIPT ( italic_q , italic_F start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS1.p4.1"><math alttext="a" class="ltx_Math" display="inline" id="S4.SS6.SSS1.p4.1.m1.1"><semantics id="S4.SS6.SSS1.p4.1.m1.1a"><mi id="S4.SS6.SSS1.p4.1.m1.1.1" xref="S4.SS6.SSS1.p4.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS1.p4.1.m1.1b"><ci id="S4.SS6.SSS1.p4.1.m1.1.1.cmml" xref="S4.SS6.SSS1.p4.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS1.p4.1.m1.1c">a</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS1.p4.1.m1.1d">italic_a</annotation></semantics></math> is a weighting factor that balances the contribution of the key-based score and the semantic score.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS6.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS6.SSS2.5.1.1">IV-F</span>2 </span>Scheduling</h4>
<div class="ltx_para" id="S4.SS6.SSS2.p1">
<p class="ltx_p" id="S4.SS6.SSS2.p1.1">The RAG system evolves in complexity and adaptability, with the ability to manage processes through a sophisticated scheduling module. The scheduling module plays a crucial role in the modular RAG , identifying critical junctures that require external data retrieval, assessing the adequacy of the responses, and deciding on the necessity for further investigation. It is commonly utilized in scenarios that involve recursive, iterative, and adaptive retrieval, ensuring that the system makes informed decisions on when to cease generation or initiate a new retrieval loop.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS2.p2">
<p class="ltx_p" id="S4.SS6.SSS2.p2.5"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS2.p2.5.1">Rule judge.</span> The subsequent steps are dictated by a set of established rules. Typically, the system evaluates the quality of generated answers through scoring mechanisms. The decision to proceed or halt the process is contingent upon whether these scores surpass certain predetermined thresholds, often related to the confidence levels of individual tokens, which can be defined as follow:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="y_{t}=\begin{cases}\hat{s}_{t}\quad\text{ if all tokens of }\hat{s}_{t}\text{ %
have probs}\geq\tau\\
s_{t}=LM([D_{q_{t}},x,y_{&lt;t}])\quad\text{ otherwise}\end{cases}" class="ltx_Math" display="block" id="S4.Ex1.m1.2"><semantics id="S4.Ex1.m1.2a"><mrow id="S4.Ex1.m1.2.3" xref="S4.Ex1.m1.2.3.cmml"><msub id="S4.Ex1.m1.2.3.2" xref="S4.Ex1.m1.2.3.2.cmml"><mi id="S4.Ex1.m1.2.3.2.2" xref="S4.Ex1.m1.2.3.2.2.cmml">y</mi><mi id="S4.Ex1.m1.2.3.2.3" xref="S4.Ex1.m1.2.3.2.3.cmml">t</mi></msub><mo id="S4.Ex1.m1.2.3.1" xref="S4.Ex1.m1.2.3.1.cmml">=</mo><mrow id="S4.Ex1.m1.2.2" xref="S4.Ex1.m1.2.3.3.1.cmml"><mo id="S4.Ex1.m1.2.2.3" xref="S4.Ex1.m1.2.3.3.1.1.cmml">{</mo><mtable columnspacing="5pt" displaystyle="true" id="S4.Ex1.m1.2.2.2" rowspacing="0pt" xref="S4.Ex1.m1.2.3.3.1.cmml"><mtr id="S4.Ex1.m1.2.2.2a" xref="S4.Ex1.m1.2.3.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex1.m1.2.2.2b" xref="S4.Ex1.m1.2.3.3.1.cmml"><mrow id="S4.Ex1.m1.1.1.1.1.1.1" xref="S4.Ex1.m1.1.1.1.1.1.1.cmml"><mrow id="S4.Ex1.m1.1.1.1.1.1.1.2.2" xref="S4.Ex1.m1.1.1.1.1.1.1.2.3.cmml"><msub id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.2" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.2.cmml">s</mi><mo id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.1" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mi id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.3" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.3.cmml">t</mi></msub><mspace id="S4.Ex1.m1.1.1.1.1.1.1.2.2.3" width="1em" xref="S4.Ex1.m1.1.1.1.1.1.1.2.3.cmml"></mspace><mrow id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.cmml"><mtext id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2a.cmml"> if all tokens of </mtext><mo id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1.cmml">⁢</mo><msub id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.cmml"><mover accent="true" id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.cmml"><mi id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.2" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.2.cmml">s</mi><mo id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.1" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.1.cmml">^</mo></mover><mi id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.3" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.3.cmml">t</mi></msub><mo id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1a" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1.cmml">⁢</mo><mtext id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4a.cmml"> have probs</mtext></mrow></mrow><mo id="S4.Ex1.m1.1.1.1.1.1.1.3" xref="S4.Ex1.m1.1.1.1.1.1.1.3.cmml">≥</mo><mi id="S4.Ex1.m1.1.1.1.1.1.1.4" xref="S4.Ex1.m1.1.1.1.1.1.1.4.cmml">τ</mi></mrow></mtd><mtd id="S4.Ex1.m1.2.2.2c" xref="S4.Ex1.m1.2.3.3.1.1.cmml"></mtd></mtr><mtr id="S4.Ex1.m1.2.2.2d" xref="S4.Ex1.m1.2.3.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S4.Ex1.m1.2.2.2e" xref="S4.Ex1.m1.2.3.3.1.cmml"><mrow id="S4.Ex1.m1.2.2.2.2.1.1" xref="S4.Ex1.m1.2.2.2.2.1.1.cmml"><msub id="S4.Ex1.m1.2.2.2.2.1.1.5" xref="S4.Ex1.m1.2.2.2.2.1.1.5.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.5.2" xref="S4.Ex1.m1.2.2.2.2.1.1.5.2.cmml">s</mi><mi id="S4.Ex1.m1.2.2.2.2.1.1.5.3" xref="S4.Ex1.m1.2.2.2.2.1.1.5.3.cmml">t</mi></msub><mo id="S4.Ex1.m1.2.2.2.2.1.1.4" xref="S4.Ex1.m1.2.2.2.2.1.1.4.cmml">=</mo><mrow id="S4.Ex1.m1.2.2.2.2.1.1.3.1" xref="S4.Ex1.m1.2.2.2.2.1.1.3.2.cmml"><mrow id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.3" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.3.cmml">L</mi><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2.cmml">⁢</mo><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.4" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.4.cmml">M</mi><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2a" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2.cmml">⁢</mo><mrow id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.cmml"><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.2" stretchy="false" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.cmml">(</mo><mrow id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml"><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.3" stretchy="false" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml">[</mo><msub id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.2.cmml">D</mi><msub id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.2.cmml">q</mi><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.3" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.3.cmml">t</mi></msub></msub><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.4" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml">,</mo><mi id="S4.Ex1.m1.2.2.2.2.1.1.1" xref="S4.Ex1.m1.2.2.2.2.1.1.1.cmml">x</mi><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.5" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml">,</mo><msub id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.2.cmml">y</mi><mrow id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.cmml"><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.2" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.2.cmml"></mi><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.1" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.1.cmml">&lt;</mo><mi id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.3" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.3.cmml">t</mi></mrow></msub><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.6" stretchy="false" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml">]</mo></mrow><mo id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.3" stretchy="false" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.cmml">)</mo></mrow></mrow><mspace id="S4.Ex1.m1.2.2.2.2.1.1.3.1.2" width="1em" xref="S4.Ex1.m1.2.2.2.2.1.1.3.2.cmml"></mspace><mtext id="S4.Ex1.m1.2.2.2.2.1.1.2" xref="S4.Ex1.m1.2.2.2.2.1.1.2a.cmml"> otherwise</mtext></mrow></mrow></mtd><mtd id="S4.Ex1.m1.2.2.2f" xref="S4.Ex1.m1.2.3.3.1.1.cmml"></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex1.m1.2b"><apply id="S4.Ex1.m1.2.3.cmml" xref="S4.Ex1.m1.2.3"><eq id="S4.Ex1.m1.2.3.1.cmml" xref="S4.Ex1.m1.2.3.1"></eq><apply id="S4.Ex1.m1.2.3.2.cmml" xref="S4.Ex1.m1.2.3.2"><csymbol cd="ambiguous" id="S4.Ex1.m1.2.3.2.1.cmml" xref="S4.Ex1.m1.2.3.2">subscript</csymbol><ci id="S4.Ex1.m1.2.3.2.2.cmml" xref="S4.Ex1.m1.2.3.2.2">𝑦</ci><ci id="S4.Ex1.m1.2.3.2.3.cmml" xref="S4.Ex1.m1.2.3.2.3">𝑡</ci></apply><apply id="S4.Ex1.m1.2.3.3.1.cmml" xref="S4.Ex1.m1.2.2"><csymbol cd="latexml" id="S4.Ex1.m1.2.3.3.1.1.cmml" xref="S4.Ex1.m1.2.2.3">cases</csymbol><apply id="S4.Ex1.m1.1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1"><geq id="S4.Ex1.m1.1.1.1.1.1.1.3.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.3"></geq><list id="S4.Ex1.m1.1.1.1.1.1.1.2.3.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2"><apply id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2"><ci id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.2.2">𝑠</ci></apply><ci id="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.1.1.1.3">𝑡</ci></apply><apply id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2"><times id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.1"></times><ci id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2a.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2"><mtext id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.2"> if all tokens of </mtext></ci><apply id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3">subscript</csymbol><apply id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2"><ci id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.1">^</ci><ci id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.2.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.2.2">𝑠</ci></apply><ci id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.3.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.3.3">𝑡</ci></apply><ci id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4a.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4"><mtext id="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.2.2.2.4"> have probs</mtext></ci></apply></list><ci id="S4.Ex1.m1.1.1.1.1.1.1.4.cmml" xref="S4.Ex1.m1.1.1.1.1.1.1.4">𝜏</ci></apply><ci id="S4.Ex1.m1.2.3.3.1.3a.cmml" xref="S4.Ex1.m1.2.2"><mtext class="ltx_mathvariant_italic" id="S4.Ex1.m1.2.3.3.1.3.cmml" xref="S4.Ex1.m1.2.2.3">otherwise</mtext></ci><apply id="S4.Ex1.m1.2.2.2.2.1.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1"><eq id="S4.Ex1.m1.2.2.2.2.1.1.4.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.4"></eq><apply id="S4.Ex1.m1.2.2.2.2.1.1.5.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.5"><csymbol cd="ambiguous" id="S4.Ex1.m1.2.2.2.2.1.1.5.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.5">subscript</csymbol><ci id="S4.Ex1.m1.2.2.2.2.1.1.5.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.5.2">𝑠</ci><ci id="S4.Ex1.m1.2.2.2.2.1.1.5.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.5.3">𝑡</ci></apply><list id="S4.Ex1.m1.2.2.2.2.1.1.3.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1"><apply id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1"><times id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.2"></times><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.3">𝐿</ci><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.4.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.4">𝑀</ci><list id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2"><apply id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.2">𝐷</ci><apply id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.2">𝑞</ci><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply><ci id="S4.Ex1.m1.2.2.2.2.1.1.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.1">𝑥</ci><apply id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2">subscript</csymbol><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.2">𝑦</ci><apply id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3"><lt id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.1.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.1"></lt><csymbol cd="latexml" id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.2">absent</csymbol><ci id="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.3.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.3.1.1.1.1.1.2.2.3.3">𝑡</ci></apply></apply></list></apply><ci id="S4.Ex1.m1.2.2.2.2.1.1.2a.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.2"><mtext id="S4.Ex1.m1.2.2.2.2.1.1.2.cmml" xref="S4.Ex1.m1.2.2.2.2.1.1.2"> otherwise</mtext></ci></list></apply><ci id="S4.Ex1.m1.2.3.3.1.5a.cmml" xref="S4.Ex1.m1.2.2"><mtext class="ltx_mathvariant_italic" id="S4.Ex1.m1.2.3.3.1.5.cmml" xref="S4.Ex1.m1.2.2.3">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex1.m1.2c">y_{t}=\begin{cases}\hat{s}_{t}\quad\text{ if all tokens of }\hat{s}_{t}\text{ %
have probs}\geq\tau\\
s_{t}=LM([D_{q_{t}},x,y_{&lt;t}])\quad\text{ otherwise}\end{cases}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex1.m1.2d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = { start_ROW start_CELL over^ start_ARG italic_s end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT if all tokens of over^ start_ARG italic_s end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT have probs ≥ italic_τ end_CELL start_CELL end_CELL end_ROW start_ROW start_CELL italic_s start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = italic_L italic_M ( [ italic_D start_POSTSUBSCRIPT italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT end_POSTSUBSCRIPT , italic_x , italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ] ) otherwise end_CELL start_CELL end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS2.p2.4">Here, <math alttext="\hat{s}_{t}" class="ltx_Math" display="inline" id="S4.SS6.SSS2.p2.1.m1.1"><semantics id="S4.SS6.SSS2.p2.1.m1.1a"><msub id="S4.SS6.SSS2.p2.1.m1.1.1" xref="S4.SS6.SSS2.p2.1.m1.1.1.cmml"><mover accent="true" id="S4.SS6.SSS2.p2.1.m1.1.1.2" xref="S4.SS6.SSS2.p2.1.m1.1.1.2.cmml"><mi id="S4.SS6.SSS2.p2.1.m1.1.1.2.2" xref="S4.SS6.SSS2.p2.1.m1.1.1.2.2.cmml">s</mi><mo id="S4.SS6.SSS2.p2.1.m1.1.1.2.1" xref="S4.SS6.SSS2.p2.1.m1.1.1.2.1.cmml">^</mo></mover><mi id="S4.SS6.SSS2.p2.1.m1.1.1.3" xref="S4.SS6.SSS2.p2.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS2.p2.1.m1.1b"><apply id="S4.SS6.SSS2.p2.1.m1.1.1.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS2.p2.1.m1.1.1.1.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1">subscript</csymbol><apply id="S4.SS6.SSS2.p2.1.m1.1.1.2.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1.2"><ci id="S4.SS6.SSS2.p2.1.m1.1.1.2.1.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1.2.1">^</ci><ci id="S4.SS6.SSS2.p2.1.m1.1.1.2.2.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1.2.2">𝑠</ci></apply><ci id="S4.SS6.SSS2.p2.1.m1.1.1.3.cmml" xref="S4.SS6.SSS2.p2.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS2.p2.1.m1.1c">\hat{s}_{t}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS2.p2.1.m1.1d">over^ start_ARG italic_s end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> represents the tentative answer, and <math alttext="s_{t}" class="ltx_Math" display="inline" id="S4.SS6.SSS2.p2.2.m2.1"><semantics id="S4.SS6.SSS2.p2.2.m2.1a"><msub id="S4.SS6.SSS2.p2.2.m2.1.1" xref="S4.SS6.SSS2.p2.2.m2.1.1.cmml"><mi id="S4.SS6.SSS2.p2.2.m2.1.1.2" xref="S4.SS6.SSS2.p2.2.m2.1.1.2.cmml">s</mi><mi id="S4.SS6.SSS2.p2.2.m2.1.1.3" xref="S4.SS6.SSS2.p2.2.m2.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS2.p2.2.m2.1b"><apply id="S4.SS6.SSS2.p2.2.m2.1.1.cmml" xref="S4.SS6.SSS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS2.p2.2.m2.1.1.1.cmml" xref="S4.SS6.SSS2.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS6.SSS2.p2.2.m2.1.1.2.cmml" xref="S4.SS6.SSS2.p2.2.m2.1.1.2">𝑠</ci><ci id="S4.SS6.SSS2.p2.2.m2.1.1.3.cmml" xref="S4.SS6.SSS2.p2.2.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS2.p2.2.m2.1c">s_{t}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS2.p2.2.m2.1d">italic_s start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is the output from the language model. The condition for accepting <math alttext="\hat{s}_{t}" class="ltx_Math" display="inline" id="S4.SS6.SSS2.p2.3.m3.1"><semantics id="S4.SS6.SSS2.p2.3.m3.1a"><msub id="S4.SS6.SSS2.p2.3.m3.1.1" xref="S4.SS6.SSS2.p2.3.m3.1.1.cmml"><mover accent="true" id="S4.SS6.SSS2.p2.3.m3.1.1.2" xref="S4.SS6.SSS2.p2.3.m3.1.1.2.cmml"><mi id="S4.SS6.SSS2.p2.3.m3.1.1.2.2" xref="S4.SS6.SSS2.p2.3.m3.1.1.2.2.cmml">s</mi><mo id="S4.SS6.SSS2.p2.3.m3.1.1.2.1" xref="S4.SS6.SSS2.p2.3.m3.1.1.2.1.cmml">^</mo></mover><mi id="S4.SS6.SSS2.p2.3.m3.1.1.3" xref="S4.SS6.SSS2.p2.3.m3.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS2.p2.3.m3.1b"><apply id="S4.SS6.SSS2.p2.3.m3.1.1.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS6.SSS2.p2.3.m3.1.1.1.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1">subscript</csymbol><apply id="S4.SS6.SSS2.p2.3.m3.1.1.2.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1.2"><ci id="S4.SS6.SSS2.p2.3.m3.1.1.2.1.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1.2.1">^</ci><ci id="S4.SS6.SSS2.p2.3.m3.1.1.2.2.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1.2.2">𝑠</ci></apply><ci id="S4.SS6.SSS2.p2.3.m3.1.1.3.cmml" xref="S4.SS6.SSS2.p2.3.m3.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS2.p2.3.m3.1c">\hat{s}_{t}</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS2.p2.3.m3.1d">over^ start_ARG italic_s end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is that all tokens within it must have associated probabilities greater than or equal to the threshold <math alttext="\tau" class="ltx_Math" display="inline" id="S4.SS6.SSS2.p2.4.m4.1"><semantics id="S4.SS6.SSS2.p2.4.m4.1a"><mi id="S4.SS6.SSS2.p2.4.m4.1.1" xref="S4.SS6.SSS2.p2.4.m4.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS2.p2.4.m4.1b"><ci id="S4.SS6.SSS2.p2.4.m4.1.1.cmml" xref="S4.SS6.SSS2.p2.4.m4.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS2.p2.4.m4.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS2.p2.4.m4.1d">italic_τ</annotation></semantics></math>. If this condition is not met, the system reverts to generating a new answer.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS2.p3">
<p class="ltx_p" id="S4.SS6.SSS2.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS2.p3.1.1">LLM judge.</span> The LLM independently determines the subsequent course of action. Two primary approaches facilitate this capability. The first method leverages LLM ’s in-context learning capability, and make judgments through prompt engineering. A significant advantage of this method is the elimination of model fine-tuning. Nonetheless, the format of the judgment output is contingent upon the LLM’s adherence to the provided instructions.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS2.p4">
<p class="ltx_p" id="S4.SS6.SSS2.p4.1">The second approach involves the LLM generating specific tokens that initiate targeted actions through fine-tuning. This technique, with roots in the Toolformer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib50" title="">50</a>]</cite>, has been integrated into frameworks like Self-RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib28" title="">28</a>]</cite>. This allows for a more direct control mechanism over the LLM’s actions, enhancing the system’s responsiveness to specific triggers within the conversational context. However, it requires generating a large number of compliant instruction sets to fine-tune LLM.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS2.p5">
<p class="ltx_p" id="S4.SS6.SSS2.p5.1"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS2.p5.1.1">Knowledge-guide scheduling</span>. Beyond the confines of rule-based methods and the complete reliance on LLMs for process control, a more adaptable intermediate approach emerges with knowledge-guided scheduling <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib26" title="">26</a>]</cite>. These methods harness the power of knowledge graphs, to steer the retrieval and generation processes. Specifically, it involves extracting information relevant to the question from a knowledge graph and constructing a reasoning chain. This reasoning chain consists of a series of logically interconnected nodes, each containing critical information for the problem-solving process. Based on the information from the nodes in this reasoning chain, information retrieval and content generation can be performed separately. By integrating this approach, it enhance not only the efficacy and precision of problem-solving but also the clarity of the explanations provided.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS6.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S4.SS6.SSS3.5.1.1">IV-F</span>3 </span>Fusion</h4>
<div class="ltx_para" id="S4.SS6.SSS3.p1">
<p class="ltx_p" id="S4.SS6.SSS3.p1.1">As RAG process has evolved beyond a linear pipeline, it frequently necessitates broadening the retrieval scope or enhancing diversity by exploring multiple pipelines. Consequently, after the expansion into various branches, the fusion module effectively integrates the information, ensuring a comprehensive and coherent response. The fusion module’s reliance is not just for merging answers but also for ensuring that the final output is both rich in content and reflective of the multifaceted nature of the inquiry.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS3.p2">
<p class="ltx_p" id="S4.SS6.SSS3.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS3.p2.1.1">LLM fusion</span>.One of the most straightforward methods for multi-branch aggregation is to leverage the powerful capabilities of LLMs to analyze and integrate information from different branches. However, this approach also faces some challenges, particularly when dealing with long answers that exceeds the LLM’s context window limitation. To mitigate this issue, it is common practice to first summarize each branch’s answer, extracting the key information before inputting it into the LLM, thus ensuring that the most important content is retained even within length constraints.</p>
</div>
<div class="ltx_para" id="S4.SS6.SSS3.p3">
<p class="ltx_p" id="S4.SS6.SSS3.p3.4"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS3.p3.4.1">Weighted ensemble </span> is based on the weighted values of different tokens generated from multiple branches, leading to the comprehensive selection of the final output. This approach can be calculated as :</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E23">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p(y|q,D^{q})=\sum_{d\in D^{q}}p(y|d,q)\cdot\lambda(d,q)" class="ltx_Math" display="block" id="S4.E23.m1.7"><semantics id="S4.E23.m1.7a"><mrow id="S4.E23.m1.7.7" xref="S4.E23.m1.7.7.cmml"><mrow id="S4.E23.m1.6.6.1" xref="S4.E23.m1.6.6.1.cmml"><mi id="S4.E23.m1.6.6.1.3" xref="S4.E23.m1.6.6.1.3.cmml">p</mi><mo id="S4.E23.m1.6.6.1.2" xref="S4.E23.m1.6.6.1.2.cmml">⁢</mo><mrow id="S4.E23.m1.6.6.1.1.1" xref="S4.E23.m1.6.6.1.1.1.1.cmml"><mo id="S4.E23.m1.6.6.1.1.1.2" stretchy="false" xref="S4.E23.m1.6.6.1.1.1.1.cmml">(</mo><mrow id="S4.E23.m1.6.6.1.1.1.1" xref="S4.E23.m1.6.6.1.1.1.1.cmml"><mi id="S4.E23.m1.6.6.1.1.1.1.3" xref="S4.E23.m1.6.6.1.1.1.1.3.cmml">y</mi><mo fence="false" id="S4.E23.m1.6.6.1.1.1.1.2" xref="S4.E23.m1.6.6.1.1.1.1.2.cmml">|</mo><mrow id="S4.E23.m1.6.6.1.1.1.1.1.1" xref="S4.E23.m1.6.6.1.1.1.1.1.2.cmml"><mi id="S4.E23.m1.1.1" xref="S4.E23.m1.1.1.cmml">q</mi><mo id="S4.E23.m1.6.6.1.1.1.1.1.1.2" xref="S4.E23.m1.6.6.1.1.1.1.1.2.cmml">,</mo><msup id="S4.E23.m1.6.6.1.1.1.1.1.1.1" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1.cmml"><mi id="S4.E23.m1.6.6.1.1.1.1.1.1.1.2" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1.2.cmml">D</mi><mi id="S4.E23.m1.6.6.1.1.1.1.1.1.1.3" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1.3.cmml">q</mi></msup></mrow></mrow><mo id="S4.E23.m1.6.6.1.1.1.3" stretchy="false" xref="S4.E23.m1.6.6.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E23.m1.7.7.3" rspace="0.111em" xref="S4.E23.m1.7.7.3.cmml">=</mo><mrow id="S4.E23.m1.7.7.2" xref="S4.E23.m1.7.7.2.cmml"><munder id="S4.E23.m1.7.7.2.2" xref="S4.E23.m1.7.7.2.2.cmml"><mo id="S4.E23.m1.7.7.2.2.2" movablelimits="false" xref="S4.E23.m1.7.7.2.2.2.cmml">∑</mo><mrow id="S4.E23.m1.7.7.2.2.3" xref="S4.E23.m1.7.7.2.2.3.cmml"><mi id="S4.E23.m1.7.7.2.2.3.2" xref="S4.E23.m1.7.7.2.2.3.2.cmml">d</mi><mo id="S4.E23.m1.7.7.2.2.3.1" xref="S4.E23.m1.7.7.2.2.3.1.cmml">∈</mo><msup id="S4.E23.m1.7.7.2.2.3.3" xref="S4.E23.m1.7.7.2.2.3.3.cmml"><mi id="S4.E23.m1.7.7.2.2.3.3.2" xref="S4.E23.m1.7.7.2.2.3.3.2.cmml">D</mi><mi id="S4.E23.m1.7.7.2.2.3.3.3" xref="S4.E23.m1.7.7.2.2.3.3.3.cmml">q</mi></msup></mrow></munder><mrow id="S4.E23.m1.7.7.2.1" xref="S4.E23.m1.7.7.2.1.cmml"><mrow id="S4.E23.m1.7.7.2.1.1" xref="S4.E23.m1.7.7.2.1.1.cmml"><mrow id="S4.E23.m1.7.7.2.1.1.1" xref="S4.E23.m1.7.7.2.1.1.1.cmml"><mi id="S4.E23.m1.7.7.2.1.1.1.3" xref="S4.E23.m1.7.7.2.1.1.1.3.cmml">p</mi><mo id="S4.E23.m1.7.7.2.1.1.1.2" xref="S4.E23.m1.7.7.2.1.1.1.2.cmml">⁢</mo><mrow id="S4.E23.m1.7.7.2.1.1.1.1.1" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.cmml"><mo id="S4.E23.m1.7.7.2.1.1.1.1.1.2" stretchy="false" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E23.m1.7.7.2.1.1.1.1.1.1" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.cmml"><mi id="S4.E23.m1.7.7.2.1.1.1.1.1.1.2" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="S4.E23.m1.7.7.2.1.1.1.1.1.1.1" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.1.cmml">|</mo><mrow id="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.2" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.1.cmml"><mi id="S4.E23.m1.2.2" xref="S4.E23.m1.2.2.cmml">d</mi><mo id="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.2.1" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.1.cmml">,</mo><mi id="S4.E23.m1.3.3" xref="S4.E23.m1.3.3.cmml">q</mi></mrow></mrow><mo id="S4.E23.m1.7.7.2.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E23.m1.7.7.2.1.1.2" rspace="0.222em" xref="S4.E23.m1.7.7.2.1.1.2.cmml">⋅</mo><mi id="S4.E23.m1.7.7.2.1.1.3" xref="S4.E23.m1.7.7.2.1.1.3.cmml">λ</mi></mrow><mo id="S4.E23.m1.7.7.2.1.2" xref="S4.E23.m1.7.7.2.1.2.cmml">⁢</mo><mrow id="S4.E23.m1.7.7.2.1.3.2" xref="S4.E23.m1.7.7.2.1.3.1.cmml"><mo id="S4.E23.m1.7.7.2.1.3.2.1" stretchy="false" xref="S4.E23.m1.7.7.2.1.3.1.cmml">(</mo><mi id="S4.E23.m1.4.4" xref="S4.E23.m1.4.4.cmml">d</mi><mo id="S4.E23.m1.7.7.2.1.3.2.2" xref="S4.E23.m1.7.7.2.1.3.1.cmml">,</mo><mi id="S4.E23.m1.5.5" xref="S4.E23.m1.5.5.cmml">q</mi><mo id="S4.E23.m1.7.7.2.1.3.2.3" stretchy="false" xref="S4.E23.m1.7.7.2.1.3.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E23.m1.7b"><apply id="S4.E23.m1.7.7.cmml" xref="S4.E23.m1.7.7"><eq id="S4.E23.m1.7.7.3.cmml" xref="S4.E23.m1.7.7.3"></eq><apply id="S4.E23.m1.6.6.1.cmml" xref="S4.E23.m1.6.6.1"><times id="S4.E23.m1.6.6.1.2.cmml" xref="S4.E23.m1.6.6.1.2"></times><ci id="S4.E23.m1.6.6.1.3.cmml" xref="S4.E23.m1.6.6.1.3">𝑝</ci><apply id="S4.E23.m1.6.6.1.1.1.1.cmml" xref="S4.E23.m1.6.6.1.1.1"><csymbol cd="latexml" id="S4.E23.m1.6.6.1.1.1.1.2.cmml" xref="S4.E23.m1.6.6.1.1.1.1.2">conditional</csymbol><ci id="S4.E23.m1.6.6.1.1.1.1.3.cmml" xref="S4.E23.m1.6.6.1.1.1.1.3">𝑦</ci><list id="S4.E23.m1.6.6.1.1.1.1.1.2.cmml" xref="S4.E23.m1.6.6.1.1.1.1.1.1"><ci id="S4.E23.m1.1.1.cmml" xref="S4.E23.m1.1.1">𝑞</ci><apply id="S4.E23.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E23.m1.6.6.1.1.1.1.1.1.1.1.cmml" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1">superscript</csymbol><ci id="S4.E23.m1.6.6.1.1.1.1.1.1.1.2.cmml" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1.2">𝐷</ci><ci id="S4.E23.m1.6.6.1.1.1.1.1.1.1.3.cmml" xref="S4.E23.m1.6.6.1.1.1.1.1.1.1.3">𝑞</ci></apply></list></apply></apply><apply id="S4.E23.m1.7.7.2.cmml" xref="S4.E23.m1.7.7.2"><apply id="S4.E23.m1.7.7.2.2.cmml" xref="S4.E23.m1.7.7.2.2"><csymbol cd="ambiguous" id="S4.E23.m1.7.7.2.2.1.cmml" xref="S4.E23.m1.7.7.2.2">subscript</csymbol><sum id="S4.E23.m1.7.7.2.2.2.cmml" xref="S4.E23.m1.7.7.2.2.2"></sum><apply id="S4.E23.m1.7.7.2.2.3.cmml" xref="S4.E23.m1.7.7.2.2.3"><in id="S4.E23.m1.7.7.2.2.3.1.cmml" xref="S4.E23.m1.7.7.2.2.3.1"></in><ci id="S4.E23.m1.7.7.2.2.3.2.cmml" xref="S4.E23.m1.7.7.2.2.3.2">𝑑</ci><apply id="S4.E23.m1.7.7.2.2.3.3.cmml" xref="S4.E23.m1.7.7.2.2.3.3"><csymbol cd="ambiguous" id="S4.E23.m1.7.7.2.2.3.3.1.cmml" xref="S4.E23.m1.7.7.2.2.3.3">superscript</csymbol><ci id="S4.E23.m1.7.7.2.2.3.3.2.cmml" xref="S4.E23.m1.7.7.2.2.3.3.2">𝐷</ci><ci id="S4.E23.m1.7.7.2.2.3.3.3.cmml" xref="S4.E23.m1.7.7.2.2.3.3.3">𝑞</ci></apply></apply></apply><apply id="S4.E23.m1.7.7.2.1.cmml" xref="S4.E23.m1.7.7.2.1"><times id="S4.E23.m1.7.7.2.1.2.cmml" xref="S4.E23.m1.7.7.2.1.2"></times><apply id="S4.E23.m1.7.7.2.1.1.cmml" xref="S4.E23.m1.7.7.2.1.1"><ci id="S4.E23.m1.7.7.2.1.1.2.cmml" xref="S4.E23.m1.7.7.2.1.1.2">⋅</ci><apply id="S4.E23.m1.7.7.2.1.1.1.cmml" xref="S4.E23.m1.7.7.2.1.1.1"><times id="S4.E23.m1.7.7.2.1.1.1.2.cmml" xref="S4.E23.m1.7.7.2.1.1.1.2"></times><ci id="S4.E23.m1.7.7.2.1.1.1.3.cmml" xref="S4.E23.m1.7.7.2.1.1.1.3">𝑝</ci><apply id="S4.E23.m1.7.7.2.1.1.1.1.1.1.cmml" xref="S4.E23.m1.7.7.2.1.1.1.1.1"><csymbol cd="latexml" id="S4.E23.m1.7.7.2.1.1.1.1.1.1.1.cmml" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.1">conditional</csymbol><ci id="S4.E23.m1.7.7.2.1.1.1.1.1.1.2.cmml" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.2">𝑦</ci><list id="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.1.cmml" xref="S4.E23.m1.7.7.2.1.1.1.1.1.1.3.2"><ci id="S4.E23.m1.2.2.cmml" xref="S4.E23.m1.2.2">𝑑</ci><ci id="S4.E23.m1.3.3.cmml" xref="S4.E23.m1.3.3">𝑞</ci></list></apply></apply><ci id="S4.E23.m1.7.7.2.1.1.3.cmml" xref="S4.E23.m1.7.7.2.1.1.3">𝜆</ci></apply><interval closure="open" id="S4.E23.m1.7.7.2.1.3.1.cmml" xref="S4.E23.m1.7.7.2.1.3.2"><ci id="S4.E23.m1.4.4.cmml" xref="S4.E23.m1.4.4">𝑑</ci><ci id="S4.E23.m1.5.5.cmml" xref="S4.E23.m1.5.5">𝑞</ci></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E23.m1.7c">p(y|q,D^{q})=\sum_{d\in D^{q}}p(y|d,q)\cdot\lambda(d,q)</annotation><annotation encoding="application/x-llamapun" id="S4.E23.m1.7d">italic_p ( italic_y | italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_d ∈ italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT end_POSTSUBSCRIPT italic_p ( italic_y | italic_d , italic_q ) ⋅ italic_λ ( italic_d , italic_q )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(23)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS3.p3.3">The weight <math alttext="\lambda(d,q)" class="ltx_Math" display="inline" id="S4.SS6.SSS3.p3.1.m1.2"><semantics id="S4.SS6.SSS3.p3.1.m1.2a"><mrow id="S4.SS6.SSS3.p3.1.m1.2.3" xref="S4.SS6.SSS3.p3.1.m1.2.3.cmml"><mi id="S4.SS6.SSS3.p3.1.m1.2.3.2" xref="S4.SS6.SSS3.p3.1.m1.2.3.2.cmml">λ</mi><mo id="S4.SS6.SSS3.p3.1.m1.2.3.1" xref="S4.SS6.SSS3.p3.1.m1.2.3.1.cmml">⁢</mo><mrow id="S4.SS6.SSS3.p3.1.m1.2.3.3.2" xref="S4.SS6.SSS3.p3.1.m1.2.3.3.1.cmml"><mo id="S4.SS6.SSS3.p3.1.m1.2.3.3.2.1" stretchy="false" xref="S4.SS6.SSS3.p3.1.m1.2.3.3.1.cmml">(</mo><mi id="S4.SS6.SSS3.p3.1.m1.1.1" xref="S4.SS6.SSS3.p3.1.m1.1.1.cmml">d</mi><mo id="S4.SS6.SSS3.p3.1.m1.2.3.3.2.2" xref="S4.SS6.SSS3.p3.1.m1.2.3.3.1.cmml">,</mo><mi id="S4.SS6.SSS3.p3.1.m1.2.2" xref="S4.SS6.SSS3.p3.1.m1.2.2.cmml">q</mi><mo id="S4.SS6.SSS3.p3.1.m1.2.3.3.2.3" stretchy="false" xref="S4.SS6.SSS3.p3.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS3.p3.1.m1.2b"><apply id="S4.SS6.SSS3.p3.1.m1.2.3.cmml" xref="S4.SS6.SSS3.p3.1.m1.2.3"><times id="S4.SS6.SSS3.p3.1.m1.2.3.1.cmml" xref="S4.SS6.SSS3.p3.1.m1.2.3.1"></times><ci id="S4.SS6.SSS3.p3.1.m1.2.3.2.cmml" xref="S4.SS6.SSS3.p3.1.m1.2.3.2">𝜆</ci><interval closure="open" id="S4.SS6.SSS3.p3.1.m1.2.3.3.1.cmml" xref="S4.SS6.SSS3.p3.1.m1.2.3.3.2"><ci id="S4.SS6.SSS3.p3.1.m1.1.1.cmml" xref="S4.SS6.SSS3.p3.1.m1.1.1">𝑑</ci><ci id="S4.SS6.SSS3.p3.1.m1.2.2.cmml" xref="S4.SS6.SSS3.p3.1.m1.2.2">𝑞</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS3.p3.1.m1.2c">\lambda(d,q)</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS3.p3.1.m1.2d">italic_λ ( italic_d , italic_q )</annotation></semantics></math> is determined by the similarity score between the document <math alttext="d" class="ltx_Math" display="inline" id="S4.SS6.SSS3.p3.2.m2.1"><semantics id="S4.SS6.SSS3.p3.2.m2.1a"><mi id="S4.SS6.SSS3.p3.2.m2.1.1" xref="S4.SS6.SSS3.p3.2.m2.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS3.p3.2.m2.1b"><ci id="S4.SS6.SSS3.p3.2.m2.1.1.cmml" xref="S4.SS6.SSS3.p3.2.m2.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS3.p3.2.m2.1c">d</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS3.p3.2.m2.1d">italic_d</annotation></semantics></math> and the input query <math alttext="q" class="ltx_Math" display="inline" id="S4.SS6.SSS3.p3.3.m3.1"><semantics id="S4.SS6.SSS3.p3.3.m3.1a"><mi id="S4.SS6.SSS3.p3.3.m3.1.1" xref="S4.SS6.SSS3.p3.3.m3.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S4.SS6.SSS3.p3.3.m3.1b"><ci id="S4.SS6.SSS3.p3.3.m3.1.1.cmml" xref="S4.SS6.SSS3.p3.3.m3.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS6.SSS3.p3.3.m3.1c">q</annotation><annotation encoding="application/x-llamapun" id="S4.SS6.SSS3.p3.3.m3.1d">italic_q</annotation></semantics></math>. This weight is calculated using the softmax function, which ensures that the weights are normalized and sum up to one.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E24">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\lambda(d,q)=\frac{e^{s(d,q)}}{\sum_{d\in D^{q}}e^{s(d,q)}}" class="ltx_Math" display="block" id="S4.E24.m1.6"><semantics id="S4.E24.m1.6a"><mrow id="S4.E24.m1.6.7" xref="S4.E24.m1.6.7.cmml"><mrow id="S4.E24.m1.6.7.2" xref="S4.E24.m1.6.7.2.cmml"><mi id="S4.E24.m1.6.7.2.2" xref="S4.E24.m1.6.7.2.2.cmml">λ</mi><mo id="S4.E24.m1.6.7.2.1" xref="S4.E24.m1.6.7.2.1.cmml">⁢</mo><mrow id="S4.E24.m1.6.7.2.3.2" xref="S4.E24.m1.6.7.2.3.1.cmml"><mo id="S4.E24.m1.6.7.2.3.2.1" stretchy="false" xref="S4.E24.m1.6.7.2.3.1.cmml">(</mo><mi id="S4.E24.m1.5.5" xref="S4.E24.m1.5.5.cmml">d</mi><mo id="S4.E24.m1.6.7.2.3.2.2" xref="S4.E24.m1.6.7.2.3.1.cmml">,</mo><mi id="S4.E24.m1.6.6" xref="S4.E24.m1.6.6.cmml">q</mi><mo id="S4.E24.m1.6.7.2.3.2.3" stretchy="false" xref="S4.E24.m1.6.7.2.3.1.cmml">)</mo></mrow></mrow><mo id="S4.E24.m1.6.7.1" xref="S4.E24.m1.6.7.1.cmml">=</mo><mfrac id="S4.E24.m1.4.4" xref="S4.E24.m1.4.4.cmml"><msup id="S4.E24.m1.2.2.2" xref="S4.E24.m1.2.2.2.cmml"><mi id="S4.E24.m1.2.2.2.4" xref="S4.E24.m1.2.2.2.4.cmml">e</mi><mrow id="S4.E24.m1.2.2.2.2.2" xref="S4.E24.m1.2.2.2.2.2.cmml"><mi id="S4.E24.m1.2.2.2.2.2.4" xref="S4.E24.m1.2.2.2.2.2.4.cmml">s</mi><mo id="S4.E24.m1.2.2.2.2.2.3" xref="S4.E24.m1.2.2.2.2.2.3.cmml">⁢</mo><mrow id="S4.E24.m1.2.2.2.2.2.5.2" xref="S4.E24.m1.2.2.2.2.2.5.1.cmml"><mo id="S4.E24.m1.2.2.2.2.2.5.2.1" stretchy="false" xref="S4.E24.m1.2.2.2.2.2.5.1.cmml">(</mo><mi id="S4.E24.m1.1.1.1.1.1.1" xref="S4.E24.m1.1.1.1.1.1.1.cmml">d</mi><mo id="S4.E24.m1.2.2.2.2.2.5.2.2" xref="S4.E24.m1.2.2.2.2.2.5.1.cmml">,</mo><mi id="S4.E24.m1.2.2.2.2.2.2" xref="S4.E24.m1.2.2.2.2.2.2.cmml">q</mi><mo id="S4.E24.m1.2.2.2.2.2.5.2.3" stretchy="false" xref="S4.E24.m1.2.2.2.2.2.5.1.cmml">)</mo></mrow></mrow></msup><mrow id="S4.E24.m1.4.4.4" xref="S4.E24.m1.4.4.4.cmml"><msub id="S4.E24.m1.4.4.4.3" xref="S4.E24.m1.4.4.4.3.cmml"><mo id="S4.E24.m1.4.4.4.3.2" xref="S4.E24.m1.4.4.4.3.2.cmml">∑</mo><mrow id="S4.E24.m1.4.4.4.3.3" xref="S4.E24.m1.4.4.4.3.3.cmml"><mi id="S4.E24.m1.4.4.4.3.3.2" xref="S4.E24.m1.4.4.4.3.3.2.cmml">d</mi><mo id="S4.E24.m1.4.4.4.3.3.1" xref="S4.E24.m1.4.4.4.3.3.1.cmml">∈</mo><msup id="S4.E24.m1.4.4.4.3.3.3" xref="S4.E24.m1.4.4.4.3.3.3.cmml"><mi id="S4.E24.m1.4.4.4.3.3.3.2" xref="S4.E24.m1.4.4.4.3.3.3.2.cmml">D</mi><mi id="S4.E24.m1.4.4.4.3.3.3.3" xref="S4.E24.m1.4.4.4.3.3.3.3.cmml">q</mi></msup></mrow></msub><msup id="S4.E24.m1.4.4.4.4" xref="S4.E24.m1.4.4.4.4.cmml"><mi id="S4.E24.m1.4.4.4.4.2" xref="S4.E24.m1.4.4.4.4.2.cmml">e</mi><mrow id="S4.E24.m1.4.4.4.2.2" xref="S4.E24.m1.4.4.4.2.2.cmml"><mi id="S4.E24.m1.4.4.4.2.2.4" xref="S4.E24.m1.4.4.4.2.2.4.cmml">s</mi><mo id="S4.E24.m1.4.4.4.2.2.3" xref="S4.E24.m1.4.4.4.2.2.3.cmml">⁢</mo><mrow id="S4.E24.m1.4.4.4.2.2.5.2" xref="S4.E24.m1.4.4.4.2.2.5.1.cmml"><mo id="S4.E24.m1.4.4.4.2.2.5.2.1" stretchy="false" xref="S4.E24.m1.4.4.4.2.2.5.1.cmml">(</mo><mi id="S4.E24.m1.3.3.3.1.1.1" xref="S4.E24.m1.3.3.3.1.1.1.cmml">d</mi><mo id="S4.E24.m1.4.4.4.2.2.5.2.2" xref="S4.E24.m1.4.4.4.2.2.5.1.cmml">,</mo><mi id="S4.E24.m1.4.4.4.2.2.2" xref="S4.E24.m1.4.4.4.2.2.2.cmml">q</mi><mo id="S4.E24.m1.4.4.4.2.2.5.2.3" stretchy="false" xref="S4.E24.m1.4.4.4.2.2.5.1.cmml">)</mo></mrow></mrow></msup></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.E24.m1.6b"><apply id="S4.E24.m1.6.7.cmml" xref="S4.E24.m1.6.7"><eq id="S4.E24.m1.6.7.1.cmml" xref="S4.E24.m1.6.7.1"></eq><apply id="S4.E24.m1.6.7.2.cmml" xref="S4.E24.m1.6.7.2"><times id="S4.E24.m1.6.7.2.1.cmml" xref="S4.E24.m1.6.7.2.1"></times><ci id="S4.E24.m1.6.7.2.2.cmml" xref="S4.E24.m1.6.7.2.2">𝜆</ci><interval closure="open" id="S4.E24.m1.6.7.2.3.1.cmml" xref="S4.E24.m1.6.7.2.3.2"><ci id="S4.E24.m1.5.5.cmml" xref="S4.E24.m1.5.5">𝑑</ci><ci id="S4.E24.m1.6.6.cmml" xref="S4.E24.m1.6.6">𝑞</ci></interval></apply><apply id="S4.E24.m1.4.4.cmml" xref="S4.E24.m1.4.4"><divide id="S4.E24.m1.4.4.5.cmml" xref="S4.E24.m1.4.4"></divide><apply id="S4.E24.m1.2.2.2.cmml" xref="S4.E24.m1.2.2.2"><csymbol cd="ambiguous" id="S4.E24.m1.2.2.2.3.cmml" xref="S4.E24.m1.2.2.2">superscript</csymbol><ci id="S4.E24.m1.2.2.2.4.cmml" xref="S4.E24.m1.2.2.2.4">𝑒</ci><apply id="S4.E24.m1.2.2.2.2.2.cmml" xref="S4.E24.m1.2.2.2.2.2"><times id="S4.E24.m1.2.2.2.2.2.3.cmml" xref="S4.E24.m1.2.2.2.2.2.3"></times><ci id="S4.E24.m1.2.2.2.2.2.4.cmml" xref="S4.E24.m1.2.2.2.2.2.4">𝑠</ci><interval closure="open" id="S4.E24.m1.2.2.2.2.2.5.1.cmml" xref="S4.E24.m1.2.2.2.2.2.5.2"><ci id="S4.E24.m1.1.1.1.1.1.1.cmml" xref="S4.E24.m1.1.1.1.1.1.1">𝑑</ci><ci id="S4.E24.m1.2.2.2.2.2.2.cmml" xref="S4.E24.m1.2.2.2.2.2.2">𝑞</ci></interval></apply></apply><apply id="S4.E24.m1.4.4.4.cmml" xref="S4.E24.m1.4.4.4"><apply id="S4.E24.m1.4.4.4.3.cmml" xref="S4.E24.m1.4.4.4.3"><csymbol cd="ambiguous" id="S4.E24.m1.4.4.4.3.1.cmml" xref="S4.E24.m1.4.4.4.3">subscript</csymbol><sum id="S4.E24.m1.4.4.4.3.2.cmml" xref="S4.E24.m1.4.4.4.3.2"></sum><apply id="S4.E24.m1.4.4.4.3.3.cmml" xref="S4.E24.m1.4.4.4.3.3"><in id="S4.E24.m1.4.4.4.3.3.1.cmml" xref="S4.E24.m1.4.4.4.3.3.1"></in><ci id="S4.E24.m1.4.4.4.3.3.2.cmml" xref="S4.E24.m1.4.4.4.3.3.2">𝑑</ci><apply id="S4.E24.m1.4.4.4.3.3.3.cmml" xref="S4.E24.m1.4.4.4.3.3.3"><csymbol cd="ambiguous" id="S4.E24.m1.4.4.4.3.3.3.1.cmml" xref="S4.E24.m1.4.4.4.3.3.3">superscript</csymbol><ci id="S4.E24.m1.4.4.4.3.3.3.2.cmml" xref="S4.E24.m1.4.4.4.3.3.3.2">𝐷</ci><ci id="S4.E24.m1.4.4.4.3.3.3.3.cmml" xref="S4.E24.m1.4.4.4.3.3.3.3">𝑞</ci></apply></apply></apply><apply id="S4.E24.m1.4.4.4.4.cmml" xref="S4.E24.m1.4.4.4.4"><csymbol cd="ambiguous" id="S4.E24.m1.4.4.4.4.1.cmml" xref="S4.E24.m1.4.4.4.4">superscript</csymbol><ci id="S4.E24.m1.4.4.4.4.2.cmml" xref="S4.E24.m1.4.4.4.4.2">𝑒</ci><apply id="S4.E24.m1.4.4.4.2.2.cmml" xref="S4.E24.m1.4.4.4.2.2"><times id="S4.E24.m1.4.4.4.2.2.3.cmml" xref="S4.E24.m1.4.4.4.2.2.3"></times><ci id="S4.E24.m1.4.4.4.2.2.4.cmml" xref="S4.E24.m1.4.4.4.2.2.4">𝑠</ci><interval closure="open" id="S4.E24.m1.4.4.4.2.2.5.1.cmml" xref="S4.E24.m1.4.4.4.2.2.5.2"><ci id="S4.E24.m1.3.3.3.1.1.1.cmml" xref="S4.E24.m1.3.3.3.1.1.1">𝑑</ci><ci id="S4.E24.m1.4.4.4.2.2.2.cmml" xref="S4.E24.m1.4.4.4.2.2.2">𝑞</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E24.m1.6c">\lambda(d,q)=\frac{e^{s(d,q)}}{\sum_{d\in D^{q}}e^{s(d,q)}}</annotation><annotation encoding="application/x-llamapun" id="S4.E24.m1.6d">italic_λ ( italic_d , italic_q ) = divide start_ARG italic_e start_POSTSUPERSCRIPT italic_s ( italic_d , italic_q ) end_POSTSUPERSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_d ∈ italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT end_POSTSUBSCRIPT italic_e start_POSTSUPERSCRIPT italic_s ( italic_d , italic_q ) end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(24)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS6.SSS3.p3.5"><span class="ltx_text ltx_font_bold" id="S4.SS6.SSS3.p3.5.1">RRF (Reciprocal Rank Fusion)</span> is an ensemble technique that synthesizes multiple retrieval result rankings into a cohesive, unified list <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib54" title="">54</a>]</cite>. It employs a tailored weighted averaging approach to enhance collective predictive performance and ranking precision. The method’s strength is its dynamic weight assignment, which is informed by the interplay among branches. RRF is especially potent in scenarios characterized by model or source heterogeneity, where it can markedly amplify the accuracy of predictions.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">V </span><span class="ltx_text ltx_font_smallcaps" id="S5.1.1">RAG Flow and Flow Pattern</span>
</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.2">The collaboration between operators forms the workflow of the module, which we refer to as RAG flow <math alttext="\mathcal{F}=(M_{\phi_{1}},\ldots,M_{\phi_{n}})" class="ltx_Math" display="inline" id="S5.p1.1.m1.3"><semantics id="S5.p1.1.m1.3a"><mrow id="S5.p1.1.m1.3.3" xref="S5.p1.1.m1.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.p1.1.m1.3.3.4" xref="S5.p1.1.m1.3.3.4.cmml">ℱ</mi><mo id="S5.p1.1.m1.3.3.3" xref="S5.p1.1.m1.3.3.3.cmml">=</mo><mrow id="S5.p1.1.m1.3.3.2.2" xref="S5.p1.1.m1.3.3.2.3.cmml"><mo id="S5.p1.1.m1.3.3.2.2.3" stretchy="false" xref="S5.p1.1.m1.3.3.2.3.cmml">(</mo><msub id="S5.p1.1.m1.2.2.1.1.1" xref="S5.p1.1.m1.2.2.1.1.1.cmml"><mi id="S5.p1.1.m1.2.2.1.1.1.2" xref="S5.p1.1.m1.2.2.1.1.1.2.cmml">M</mi><msub id="S5.p1.1.m1.2.2.1.1.1.3" xref="S5.p1.1.m1.2.2.1.1.1.3.cmml"><mi id="S5.p1.1.m1.2.2.1.1.1.3.2" xref="S5.p1.1.m1.2.2.1.1.1.3.2.cmml">ϕ</mi><mn id="S5.p1.1.m1.2.2.1.1.1.3.3" xref="S5.p1.1.m1.2.2.1.1.1.3.3.cmml">1</mn></msub></msub><mo id="S5.p1.1.m1.3.3.2.2.4" xref="S5.p1.1.m1.3.3.2.3.cmml">,</mo><mi id="S5.p1.1.m1.1.1" mathvariant="normal" xref="S5.p1.1.m1.1.1.cmml">…</mi><mo id="S5.p1.1.m1.3.3.2.2.5" xref="S5.p1.1.m1.3.3.2.3.cmml">,</mo><msub id="S5.p1.1.m1.3.3.2.2.2" xref="S5.p1.1.m1.3.3.2.2.2.cmml"><mi id="S5.p1.1.m1.3.3.2.2.2.2" xref="S5.p1.1.m1.3.3.2.2.2.2.cmml">M</mi><msub id="S5.p1.1.m1.3.3.2.2.2.3" xref="S5.p1.1.m1.3.3.2.2.2.3.cmml"><mi id="S5.p1.1.m1.3.3.2.2.2.3.2" xref="S5.p1.1.m1.3.3.2.2.2.3.2.cmml">ϕ</mi><mi id="S5.p1.1.m1.3.3.2.2.2.3.3" xref="S5.p1.1.m1.3.3.2.2.2.3.3.cmml">n</mi></msub></msub><mo id="S5.p1.1.m1.3.3.2.2.6" stretchy="false" xref="S5.p1.1.m1.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.p1.1.m1.3b"><apply id="S5.p1.1.m1.3.3.cmml" xref="S5.p1.1.m1.3.3"><eq id="S5.p1.1.m1.3.3.3.cmml" xref="S5.p1.1.m1.3.3.3"></eq><ci id="S5.p1.1.m1.3.3.4.cmml" xref="S5.p1.1.m1.3.3.4">ℱ</ci><vector id="S5.p1.1.m1.3.3.2.3.cmml" xref="S5.p1.1.m1.3.3.2.2"><apply id="S5.p1.1.m1.2.2.1.1.1.cmml" xref="S5.p1.1.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S5.p1.1.m1.2.2.1.1.1.1.cmml" xref="S5.p1.1.m1.2.2.1.1.1">subscript</csymbol><ci id="S5.p1.1.m1.2.2.1.1.1.2.cmml" xref="S5.p1.1.m1.2.2.1.1.1.2">𝑀</ci><apply id="S5.p1.1.m1.2.2.1.1.1.3.cmml" xref="S5.p1.1.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.p1.1.m1.2.2.1.1.1.3.1.cmml" xref="S5.p1.1.m1.2.2.1.1.1.3">subscript</csymbol><ci id="S5.p1.1.m1.2.2.1.1.1.3.2.cmml" xref="S5.p1.1.m1.2.2.1.1.1.3.2">italic-ϕ</ci><cn id="S5.p1.1.m1.2.2.1.1.1.3.3.cmml" type="integer" xref="S5.p1.1.m1.2.2.1.1.1.3.3">1</cn></apply></apply><ci id="S5.p1.1.m1.1.1.cmml" xref="S5.p1.1.m1.1.1">…</ci><apply id="S5.p1.1.m1.3.3.2.2.2.cmml" xref="S5.p1.1.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S5.p1.1.m1.3.3.2.2.2.1.cmml" xref="S5.p1.1.m1.3.3.2.2.2">subscript</csymbol><ci id="S5.p1.1.m1.3.3.2.2.2.2.cmml" xref="S5.p1.1.m1.3.3.2.2.2.2">𝑀</ci><apply id="S5.p1.1.m1.3.3.2.2.2.3.cmml" xref="S5.p1.1.m1.3.3.2.2.2.3"><csymbol cd="ambiguous" id="S5.p1.1.m1.3.3.2.2.2.3.1.cmml" xref="S5.p1.1.m1.3.3.2.2.2.3">subscript</csymbol><ci id="S5.p1.1.m1.3.3.2.2.2.3.2.cmml" xref="S5.p1.1.m1.3.3.2.2.2.3.2">italic-ϕ</ci><ci id="S5.p1.1.m1.3.3.2.2.2.3.3.cmml" xref="S5.p1.1.m1.3.3.2.2.2.3.3">𝑛</ci></apply></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.1.m1.3c">\mathcal{F}=(M_{\phi_{1}},\ldots,M_{\phi_{n}})</annotation><annotation encoding="application/x-llamapun" id="S5.p1.1.m1.3d">caligraphic_F = ( italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , … , italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT )</annotation></semantics></math>, where <math alttext="\phi" class="ltx_Math" display="inline" id="S5.p1.2.m2.1"><semantics id="S5.p1.2.m2.1a"><mi id="S5.p1.2.m2.1.1" xref="S5.p1.2.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S5.p1.2.m2.1b"><ci id="S5.p1.2.m2.1.1.cmml" xref="S5.p1.2.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.2.m2.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S5.p1.2.m2.1d">italic_ϕ</annotation></semantics></math> stands for the set of module parameters. A modular rag flow can be decomposed into a graph of sub-functions. Through control logic, the operators can execute in a predetermined pipeline, while also performing conditional, branching or looping when necessary. In the simplest case. the graph is a linear chain.</p>
</div>
<div class="ltx_para" id="S5.p2">
<p class="ltx_p" id="S5.p2.2">After conducting an in-depth analysis of current RAG methods, we have identified a set of common RAG flow patterns, denoted as <math alttext="\mathcal{P}" class="ltx_Math" display="inline" id="S5.p2.1.m1.1"><semantics id="S5.p2.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S5.p2.1.m1.1.1" xref="S5.p2.1.m1.1.1.cmml">𝒫</mi><annotation-xml encoding="MathML-Content" id="S5.p2.1.m1.1b"><ci id="S5.p2.1.m1.1.1.cmml" xref="S5.p2.1.m1.1.1">𝒫</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p2.1.m1.1c">\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S5.p2.1.m1.1d">caligraphic_P</annotation></semantics></math>. These patterns transcend various application domains and demonstrate a high level of consistency and reusability, revealing the prevalent structures and behaviors in process design. A RAG flow pattern can be defined as <math alttext="\mathcal{P}=\{M_{\phi_{1}}:\{\mathcal{O}p_{1}\}\rightarrow M_{\phi_{2}}:\{%
\mathcal{O}p_{2}\}\rightarrow\ldots\rightarrow M_{\phi_{n}}:\{\mathcal{O}p_{n}\}\}" class="ltx_Math" display="inline" id="S5.p2.2.m2.2"><semantics id="S5.p2.2.m2.2a"><mrow id="S5.p2.2.m2.2.2" xref="S5.p2.2.m2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.2.2.4" xref="S5.p2.2.m2.2.2.4.cmml">𝒫</mi><mo id="S5.p2.2.m2.2.2.3" xref="S5.p2.2.m2.2.2.3.cmml">=</mo><mrow id="S5.p2.2.m2.2.2.2.2" xref="S5.p2.2.m2.2.2.2.3.cmml"><mo id="S5.p2.2.m2.2.2.2.2.3" stretchy="false" xref="S5.p2.2.m2.2.2.2.3.1.cmml">{</mo><msub id="S5.p2.2.m2.1.1.1.1.1" xref="S5.p2.2.m2.1.1.1.1.1.cmml"><mi id="S5.p2.2.m2.1.1.1.1.1.2" xref="S5.p2.2.m2.1.1.1.1.1.2.cmml">M</mi><msub id="S5.p2.2.m2.1.1.1.1.1.3" xref="S5.p2.2.m2.1.1.1.1.1.3.cmml"><mi id="S5.p2.2.m2.1.1.1.1.1.3.2" xref="S5.p2.2.m2.1.1.1.1.1.3.2.cmml">ϕ</mi><mn id="S5.p2.2.m2.1.1.1.1.1.3.3" xref="S5.p2.2.m2.1.1.1.1.1.3.3.cmml">1</mn></msub></msub><mo id="S5.p2.2.m2.2.2.2.2.4" lspace="0.278em" rspace="0.278em" xref="S5.p2.2.m2.2.2.2.3.1.cmml">:</mo><mrow id="S5.p2.2.m2.2.2.2.2.2" xref="S5.p2.2.m2.2.2.2.2.2.cmml"><mrow id="S5.p2.2.m2.2.2.2.2.2.1" xref="S5.p2.2.m2.2.2.2.2.2.1.cmml"><mrow id="S5.p2.2.m2.2.2.2.2.2.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.1.1.2.cmml"><mo id="S5.p2.2.m2.2.2.2.2.2.1.1.1.2" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.1.1.2.cmml">{</mo><mrow id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.2" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.2.cmml">𝒪</mi><mo id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.1.cmml">⁢</mo><msub id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.2" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.2.cmml">p</mi><mn id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.3" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.3.cmml">1</mn></msub></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.1.1.1.3" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.1.1.2.cmml">}</mo></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.1.2" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.1.2.cmml">→</mo><msub id="S5.p2.2.m2.2.2.2.2.2.1.3" xref="S5.p2.2.m2.2.2.2.2.2.1.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.1.3.2" xref="S5.p2.2.m2.2.2.2.2.2.1.3.2.cmml">M</mi><msub id="S5.p2.2.m2.2.2.2.2.2.1.3.3" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.1.3.3.2" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3.2.cmml">ϕ</mi><mn id="S5.p2.2.m2.2.2.2.2.2.1.3.3.3" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3.3.cmml">2</mn></msub></msub></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.5" lspace="0.278em" rspace="0.278em" xref="S5.p2.2.m2.2.2.2.2.2.5.cmml">:</mo><mrow id="S5.p2.2.m2.2.2.2.2.2.2" xref="S5.p2.2.m2.2.2.2.2.2.2.cmml"><mrow id="S5.p2.2.m2.2.2.2.2.2.2.1.1" xref="S5.p2.2.m2.2.2.2.2.2.2.1.2.cmml"><mo id="S5.p2.2.m2.2.2.2.2.2.2.1.1.2" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.2.1.2.cmml">{</mo><mrow id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.2" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.2.cmml">𝒪</mi><mo id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.1.cmml">⁢</mo><msub id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.2" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.2.cmml">p</mi><mn id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.3" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.3.cmml">2</mn></msub></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.2.1.1.3" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.2.1.2.cmml">}</mo></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.2.3" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.2.3.cmml">→</mo><mi id="S5.p2.2.m2.2.2.2.2.2.2.4" mathvariant="normal" xref="S5.p2.2.m2.2.2.2.2.2.2.4.cmml">…</mi><mo id="S5.p2.2.m2.2.2.2.2.2.2.5" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.2.5.cmml">→</mo><msub id="S5.p2.2.m2.2.2.2.2.2.2.6" xref="S5.p2.2.m2.2.2.2.2.2.2.6.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.2.6.2" xref="S5.p2.2.m2.2.2.2.2.2.2.6.2.cmml">M</mi><msub id="S5.p2.2.m2.2.2.2.2.2.2.6.3" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.2.6.3.2" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3.2.cmml">ϕ</mi><mi id="S5.p2.2.m2.2.2.2.2.2.2.6.3.3" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3.3.cmml">n</mi></msub></msub></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.6" lspace="0.278em" rspace="0.278em" xref="S5.p2.2.m2.2.2.2.2.2.6.cmml">:</mo><mrow id="S5.p2.2.m2.2.2.2.2.2.3.1" xref="S5.p2.2.m2.2.2.2.2.2.3.2.cmml"><mo id="S5.p2.2.m2.2.2.2.2.2.3.1.2" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.3.2.cmml">{</mo><mrow id="S5.p2.2.m2.2.2.2.2.2.3.1.1" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.2.2.2.2.2.3.1.1.2" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.2.cmml">𝒪</mi><mo id="S5.p2.2.m2.2.2.2.2.2.3.1.1.1" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.1.cmml">⁢</mo><msub id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.cmml"><mi id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.2" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.2.cmml">p</mi><mi id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.3" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.3.cmml">n</mi></msub></mrow><mo id="S5.p2.2.m2.2.2.2.2.2.3.1.3" stretchy="false" xref="S5.p2.2.m2.2.2.2.2.2.3.2.cmml">}</mo></mrow></mrow><mo id="S5.p2.2.m2.2.2.2.2.5" stretchy="false" xref="S5.p2.2.m2.2.2.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.p2.2.m2.2b"><apply id="S5.p2.2.m2.2.2.cmml" xref="S5.p2.2.m2.2.2"><eq id="S5.p2.2.m2.2.2.3.cmml" xref="S5.p2.2.m2.2.2.3"></eq><ci id="S5.p2.2.m2.2.2.4.cmml" xref="S5.p2.2.m2.2.2.4">𝒫</ci><apply id="S5.p2.2.m2.2.2.2.3.cmml" xref="S5.p2.2.m2.2.2.2.2"><csymbol cd="latexml" id="S5.p2.2.m2.2.2.2.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.3">conditional-set</csymbol><apply id="S5.p2.2.m2.1.1.1.1.1.cmml" xref="S5.p2.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.p2.2.m2.1.1.1.1.1.1.cmml" xref="S5.p2.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S5.p2.2.m2.1.1.1.1.1.2.cmml" xref="S5.p2.2.m2.1.1.1.1.1.2">𝑀</ci><apply id="S5.p2.2.m2.1.1.1.1.1.3.cmml" xref="S5.p2.2.m2.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.1.1.1.1.1.3.1.cmml" xref="S5.p2.2.m2.1.1.1.1.1.3">subscript</csymbol><ci id="S5.p2.2.m2.1.1.1.1.1.3.2.cmml" xref="S5.p2.2.m2.1.1.1.1.1.3.2">italic-ϕ</ci><cn id="S5.p2.2.m2.1.1.1.1.1.3.3.cmml" type="integer" xref="S5.p2.2.m2.1.1.1.1.1.3.3">1</cn></apply></apply><apply id="S5.p2.2.m2.2.2.2.2.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2"><and id="S5.p2.2.m2.2.2.2.2.2a.cmml" xref="S5.p2.2.m2.2.2.2.2.2"></and><apply id="S5.p2.2.m2.2.2.2.2.2b.cmml" xref="S5.p2.2.m2.2.2.2.2.2"><ci id="S5.p2.2.m2.2.2.2.2.2.5.cmml" xref="S5.p2.2.m2.2.2.2.2.2.5">:</ci><apply id="S5.p2.2.m2.2.2.2.2.2.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1"><ci id="S5.p2.2.m2.2.2.2.2.2.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.2">→</ci><set id="S5.p2.2.m2.2.2.2.2.2.1.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1"><apply id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1"><times id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.1"></times><ci id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.2">𝒪</ci><apply id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.2">𝑝</ci><cn id="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.3.cmml" type="integer" xref="S5.p2.2.m2.2.2.2.2.2.1.1.1.1.3.3">1</cn></apply></apply></set><apply id="S5.p2.2.m2.2.2.2.2.2.1.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.1.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.1.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3.2">𝑀</ci><apply id="S5.p2.2.m2.2.2.2.2.2.1.3.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.1.3.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.1.3.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3.2">italic-ϕ</ci><cn id="S5.p2.2.m2.2.2.2.2.2.1.3.3.3.cmml" type="integer" xref="S5.p2.2.m2.2.2.2.2.2.1.3.3.3">2</cn></apply></apply></apply><apply id="S5.p2.2.m2.2.2.2.2.2.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2"><and id="S5.p2.2.m2.2.2.2.2.2.2a.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2"></and><apply id="S5.p2.2.m2.2.2.2.2.2.2b.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2"><ci id="S5.p2.2.m2.2.2.2.2.2.2.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.3">→</ci><set id="S5.p2.2.m2.2.2.2.2.2.2.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1"><apply id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1"><times id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.1"></times><ci id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.2">𝒪</ci><apply id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.2">𝑝</ci><cn id="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.3.cmml" type="integer" xref="S5.p2.2.m2.2.2.2.2.2.2.1.1.1.3.3">2</cn></apply></apply></set><ci id="S5.p2.2.m2.2.2.2.2.2.2.4.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.4">…</ci></apply><apply id="S5.p2.2.m2.2.2.2.2.2.2c.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2"><ci id="S5.p2.2.m2.2.2.2.2.2.2.5.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.5">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.p2.2.m2.2.2.2.2.2.2.4.cmml" id="S5.p2.2.m2.2.2.2.2.2.2d.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2"></share><apply id="S5.p2.2.m2.2.2.2.2.2.2.6.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.2.6.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.2.6.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6.2">𝑀</ci><apply id="S5.p2.2.m2.2.2.2.2.2.2.6.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.2.6.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.2.6.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3.2">italic-ϕ</ci><ci id="S5.p2.2.m2.2.2.2.2.2.2.6.3.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.2.6.3.3">𝑛</ci></apply></apply></apply></apply></apply><apply id="S5.p2.2.m2.2.2.2.2.2c.cmml" xref="S5.p2.2.m2.2.2.2.2.2"><ci id="S5.p2.2.m2.2.2.2.2.2.6.cmml" xref="S5.p2.2.m2.2.2.2.2.2.6">:</ci><share href="https://arxiv.org/html/2407.21059v1#S5.p2.2.m2.2.2.2.2.2.2.cmml" id="S5.p2.2.m2.2.2.2.2.2d.cmml" xref="S5.p2.2.m2.2.2.2.2.2"></share><set id="S5.p2.2.m2.2.2.2.2.2.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1"><apply id="S5.p2.2.m2.2.2.2.2.2.3.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1"><times id="S5.p2.2.m2.2.2.2.2.2.3.1.1.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.1"></times><ci id="S5.p2.2.m2.2.2.2.2.2.3.1.1.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.2">𝒪</ci><apply id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3"><csymbol cd="ambiguous" id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.1.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3">subscript</csymbol><ci id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.2.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.2">𝑝</ci><ci id="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.3.cmml" xref="S5.p2.2.m2.2.2.2.2.2.3.1.1.3.3">𝑛</ci></apply></apply></set></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p2.2.m2.2c">\mathcal{P}=\{M_{\phi_{1}}:\{\mathcal{O}p_{1}\}\rightarrow M_{\phi_{2}}:\{%
\mathcal{O}p_{2}\}\rightarrow\ldots\rightarrow M_{\phi_{n}}:\{\mathcal{O}p_{n}\}\}</annotation><annotation encoding="application/x-llamapun" id="S5.p2.2.m2.2d">caligraphic_P = { italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT : { caligraphic_O italic_p start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT } → italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_POSTSUBSCRIPT : { caligraphic_O italic_p start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT } → … → italic_M start_POSTSUBSCRIPT italic_ϕ start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT : { caligraphic_O italic_p start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT } }</annotation></semantics></math></p>
</div>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S5.SS1.5.1.1">V-A</span> </span><span class="ltx_text ltx_font_italic" id="S5.SS1.6.2">Linear Pattern </span>
</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.2">The modules in the modular RAG system are organized in a linear way, and can be described as Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg1" title="Algorithm 1 ‣ V-A Linear Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E25">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{P}_{linear}=\{M_{1}\rightarrow M_{2}\rightarrow\ldots\rightarrow M_{n}\}" class="ltx_Math" display="block" id="S5.E25.m1.1"><semantics id="S5.E25.m1.1a"><mrow id="S5.E25.m1.1.1" xref="S5.E25.m1.1.1.cmml"><msub id="S5.E25.m1.1.1.3" xref="S5.E25.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E25.m1.1.1.3.2" xref="S5.E25.m1.1.1.3.2.cmml">𝒫</mi><mrow id="S5.E25.m1.1.1.3.3" xref="S5.E25.m1.1.1.3.3.cmml"><mi id="S5.E25.m1.1.1.3.3.2" xref="S5.E25.m1.1.1.3.3.2.cmml">l</mi><mo id="S5.E25.m1.1.1.3.3.1" xref="S5.E25.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.E25.m1.1.1.3.3.3" xref="S5.E25.m1.1.1.3.3.3.cmml">i</mi><mo id="S5.E25.m1.1.1.3.3.1a" xref="S5.E25.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.E25.m1.1.1.3.3.4" xref="S5.E25.m1.1.1.3.3.4.cmml">n</mi><mo id="S5.E25.m1.1.1.3.3.1b" xref="S5.E25.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.E25.m1.1.1.3.3.5" xref="S5.E25.m1.1.1.3.3.5.cmml">e</mi><mo id="S5.E25.m1.1.1.3.3.1c" xref="S5.E25.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.E25.m1.1.1.3.3.6" xref="S5.E25.m1.1.1.3.3.6.cmml">a</mi><mo id="S5.E25.m1.1.1.3.3.1d" xref="S5.E25.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.E25.m1.1.1.3.3.7" xref="S5.E25.m1.1.1.3.3.7.cmml">r</mi></mrow></msub><mo id="S5.E25.m1.1.1.2" xref="S5.E25.m1.1.1.2.cmml">=</mo><mrow id="S5.E25.m1.1.1.1.1" xref="S5.E25.m1.1.1.1.2.cmml"><mo id="S5.E25.m1.1.1.1.1.2" stretchy="false" xref="S5.E25.m1.1.1.1.2.cmml">{</mo><mrow id="S5.E25.m1.1.1.1.1.1" xref="S5.E25.m1.1.1.1.1.1.cmml"><msub id="S5.E25.m1.1.1.1.1.1.2" xref="S5.E25.m1.1.1.1.1.1.2.cmml"><mi id="S5.E25.m1.1.1.1.1.1.2.2" xref="S5.E25.m1.1.1.1.1.1.2.2.cmml">M</mi><mn id="S5.E25.m1.1.1.1.1.1.2.3" xref="S5.E25.m1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S5.E25.m1.1.1.1.1.1.3" stretchy="false" xref="S5.E25.m1.1.1.1.1.1.3.cmml">→</mo><msub id="S5.E25.m1.1.1.1.1.1.4" xref="S5.E25.m1.1.1.1.1.1.4.cmml"><mi id="S5.E25.m1.1.1.1.1.1.4.2" xref="S5.E25.m1.1.1.1.1.1.4.2.cmml">M</mi><mn id="S5.E25.m1.1.1.1.1.1.4.3" xref="S5.E25.m1.1.1.1.1.1.4.3.cmml">2</mn></msub><mo id="S5.E25.m1.1.1.1.1.1.5" stretchy="false" xref="S5.E25.m1.1.1.1.1.1.5.cmml">→</mo><mi id="S5.E25.m1.1.1.1.1.1.6" mathvariant="normal" xref="S5.E25.m1.1.1.1.1.1.6.cmml">…</mi><mo id="S5.E25.m1.1.1.1.1.1.7" stretchy="false" xref="S5.E25.m1.1.1.1.1.1.7.cmml">→</mo><msub id="S5.E25.m1.1.1.1.1.1.8" xref="S5.E25.m1.1.1.1.1.1.8.cmml"><mi id="S5.E25.m1.1.1.1.1.1.8.2" xref="S5.E25.m1.1.1.1.1.1.8.2.cmml">M</mi><mi id="S5.E25.m1.1.1.1.1.1.8.3" xref="S5.E25.m1.1.1.1.1.1.8.3.cmml">n</mi></msub></mrow><mo id="S5.E25.m1.1.1.1.1.3" stretchy="false" xref="S5.E25.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E25.m1.1b"><apply id="S5.E25.m1.1.1.cmml" xref="S5.E25.m1.1.1"><eq id="S5.E25.m1.1.1.2.cmml" xref="S5.E25.m1.1.1.2"></eq><apply id="S5.E25.m1.1.1.3.cmml" xref="S5.E25.m1.1.1.3"><csymbol cd="ambiguous" id="S5.E25.m1.1.1.3.1.cmml" xref="S5.E25.m1.1.1.3">subscript</csymbol><ci id="S5.E25.m1.1.1.3.2.cmml" xref="S5.E25.m1.1.1.3.2">𝒫</ci><apply id="S5.E25.m1.1.1.3.3.cmml" xref="S5.E25.m1.1.1.3.3"><times id="S5.E25.m1.1.1.3.3.1.cmml" xref="S5.E25.m1.1.1.3.3.1"></times><ci id="S5.E25.m1.1.1.3.3.2.cmml" xref="S5.E25.m1.1.1.3.3.2">𝑙</ci><ci id="S5.E25.m1.1.1.3.3.3.cmml" xref="S5.E25.m1.1.1.3.3.3">𝑖</ci><ci id="S5.E25.m1.1.1.3.3.4.cmml" xref="S5.E25.m1.1.1.3.3.4">𝑛</ci><ci id="S5.E25.m1.1.1.3.3.5.cmml" xref="S5.E25.m1.1.1.3.3.5">𝑒</ci><ci id="S5.E25.m1.1.1.3.3.6.cmml" xref="S5.E25.m1.1.1.3.3.6">𝑎</ci><ci id="S5.E25.m1.1.1.3.3.7.cmml" xref="S5.E25.m1.1.1.3.3.7">𝑟</ci></apply></apply><set id="S5.E25.m1.1.1.1.2.cmml" xref="S5.E25.m1.1.1.1.1"><apply id="S5.E25.m1.1.1.1.1.1.cmml" xref="S5.E25.m1.1.1.1.1.1"><and id="S5.E25.m1.1.1.1.1.1a.cmml" xref="S5.E25.m1.1.1.1.1.1"></and><apply id="S5.E25.m1.1.1.1.1.1b.cmml" xref="S5.E25.m1.1.1.1.1.1"><ci id="S5.E25.m1.1.1.1.1.1.3.cmml" xref="S5.E25.m1.1.1.1.1.1.3">→</ci><apply id="S5.E25.m1.1.1.1.1.1.2.cmml" xref="S5.E25.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.E25.m1.1.1.1.1.1.2.1.cmml" xref="S5.E25.m1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.E25.m1.1.1.1.1.1.2.2.cmml" xref="S5.E25.m1.1.1.1.1.1.2.2">𝑀</ci><cn id="S5.E25.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="S5.E25.m1.1.1.1.1.1.2.3">1</cn></apply><apply id="S5.E25.m1.1.1.1.1.1.4.cmml" xref="S5.E25.m1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S5.E25.m1.1.1.1.1.1.4.1.cmml" xref="S5.E25.m1.1.1.1.1.1.4">subscript</csymbol><ci id="S5.E25.m1.1.1.1.1.1.4.2.cmml" xref="S5.E25.m1.1.1.1.1.1.4.2">𝑀</ci><cn id="S5.E25.m1.1.1.1.1.1.4.3.cmml" type="integer" xref="S5.E25.m1.1.1.1.1.1.4.3">2</cn></apply></apply><apply id="S5.E25.m1.1.1.1.1.1c.cmml" xref="S5.E25.m1.1.1.1.1.1"><ci id="S5.E25.m1.1.1.1.1.1.5.cmml" xref="S5.E25.m1.1.1.1.1.1.5">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.E25.m1.1.1.1.1.1.4.cmml" id="S5.E25.m1.1.1.1.1.1d.cmml" xref="S5.E25.m1.1.1.1.1.1"></share><ci id="S5.E25.m1.1.1.1.1.1.6.cmml" xref="S5.E25.m1.1.1.1.1.1.6">…</ci></apply><apply id="S5.E25.m1.1.1.1.1.1e.cmml" xref="S5.E25.m1.1.1.1.1.1"><ci id="S5.E25.m1.1.1.1.1.1.7.cmml" xref="S5.E25.m1.1.1.1.1.1.7">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.E25.m1.1.1.1.1.1.6.cmml" id="S5.E25.m1.1.1.1.1.1f.cmml" xref="S5.E25.m1.1.1.1.1.1"></share><apply id="S5.E25.m1.1.1.1.1.1.8.cmml" xref="S5.E25.m1.1.1.1.1.1.8"><csymbol cd="ambiguous" id="S5.E25.m1.1.1.1.1.1.8.1.cmml" xref="S5.E25.m1.1.1.1.1.1.8">subscript</csymbol><ci id="S5.E25.m1.1.1.1.1.1.8.2.cmml" xref="S5.E25.m1.1.1.1.1.1.8.2">𝑀</ci><ci id="S5.E25.m1.1.1.1.1.1.8.3.cmml" xref="S5.E25.m1.1.1.1.1.1.8.3">𝑛</ci></apply></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E25.m1.1c">\mathcal{P}_{linear}=\{M_{1}\rightarrow M_{2}\rightarrow\ldots\rightarrow M_{n}\}</annotation><annotation encoding="application/x-llamapun" id="S5.E25.m1.1d">caligraphic_P start_POSTSUBSCRIPT italic_l italic_i italic_n italic_e italic_a italic_r end_POSTSUBSCRIPT = { italic_M start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT → … → italic_M start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(25)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p1.1">The linear flow pattern is the simplest and most commonly used pattern. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F4" title="Figure 4 ‣ V-A Linear Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">4</span></a>, the full linear RAG flow pattern mainly includes pre-retrieval processing, retrieval, post-retrieval processing, and generation modules.
<math alttext="\mathcal{P}_{linear_{full}}=\{M_{\text{indexing}}\rightarrow M_{\text{pre-%
retrieval}}\rightarrow M_{\text{retrieval}}\rightarrow M_{\text{post-retrieval%
}}\rightarrow M_{\text{generate}}\}" class="ltx_Math" display="inline" id="S5.SS1.p1.1.m1.1"><semantics id="S5.SS1.p1.1.m1.1a"><mrow id="S5.SS1.p1.1.m1.1.1" xref="S5.SS1.p1.1.m1.1.1.cmml"><msub id="S5.SS1.p1.1.m1.1.1.3" xref="S5.SS1.p1.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS1.p1.1.m1.1.1.3.2" xref="S5.SS1.p1.1.m1.1.1.3.2.cmml">𝒫</mi><mrow id="S5.SS1.p1.1.m1.1.1.3.3" xref="S5.SS1.p1.1.m1.1.1.3.3.cmml"><mi id="S5.SS1.p1.1.m1.1.1.3.3.2" xref="S5.SS1.p1.1.m1.1.1.3.3.2.cmml">l</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.1" xref="S5.SS1.p1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.3" xref="S5.SS1.p1.1.m1.1.1.3.3.3.cmml">i</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.1a" xref="S5.SS1.p1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.4" xref="S5.SS1.p1.1.m1.1.1.3.3.4.cmml">n</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.1b" xref="S5.SS1.p1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.5" xref="S5.SS1.p1.1.m1.1.1.3.3.5.cmml">e</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.1c" xref="S5.SS1.p1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.6" xref="S5.SS1.p1.1.m1.1.1.3.3.6.cmml">a</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.1d" xref="S5.SS1.p1.1.m1.1.1.3.3.1.cmml">⁢</mo><msub id="S5.SS1.p1.1.m1.1.1.3.3.7" xref="S5.SS1.p1.1.m1.1.1.3.3.7.cmml"><mi id="S5.SS1.p1.1.m1.1.1.3.3.7.2" xref="S5.SS1.p1.1.m1.1.1.3.3.7.2.cmml">r</mi><mrow id="S5.SS1.p1.1.m1.1.1.3.3.7.3" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.cmml"><mi id="S5.SS1.p1.1.m1.1.1.3.3.7.3.2" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.2.cmml">f</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.7.3.1" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.7.3.3" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.3.cmml">u</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.7.3.1a" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.7.3.4" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.4.cmml">l</mi><mo id="S5.SS1.p1.1.m1.1.1.3.3.7.3.1b" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.1.cmml">⁢</mo><mi id="S5.SS1.p1.1.m1.1.1.3.3.7.3.5" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.5.cmml">l</mi></mrow></msub></mrow></msub><mo id="S5.SS1.p1.1.m1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.2.cmml">=</mo><mrow id="S5.SS1.p1.1.m1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.2.cmml"><mo id="S5.SS1.p1.1.m1.1.1.1.1.2" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.2.cmml">{</mo><mrow id="S5.SS1.p1.1.m1.1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.1.1.cmml"><msub id="S5.SS1.p1.1.m1.1.1.1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.2.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.2.cmml">M</mi><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.2.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.3a.cmml">indexing</mtext></msub><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.3" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.3.cmml">→</mo><msub id="S5.SS1.p1.1.m1.1.1.1.1.1.4" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.4.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.2.cmml">M</mi><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.4.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.3a.cmml">pre-retrieval</mtext></msub><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.5" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.5.cmml">→</mo><msub id="S5.SS1.p1.1.m1.1.1.1.1.1.6" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.6.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.2.cmml">M</mi><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.6.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.3a.cmml">retrieval</mtext></msub><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.7" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.7.cmml">→</mo><msub id="S5.SS1.p1.1.m1.1.1.1.1.1.8" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.8.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.2.cmml">M</mi><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.8.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.3a.cmml">post-retrieval</mtext></msub><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.9" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.9.cmml">→</mo><msub id="S5.SS1.p1.1.m1.1.1.1.1.1.10" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.10.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.2.cmml">M</mi><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.10.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.3a.cmml">generate</mtext></msub></mrow><mo id="S5.SS1.p1.1.m1.1.1.1.1.3" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.1.m1.1b"><apply id="S5.SS1.p1.1.m1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1"><eq id="S5.SS1.p1.1.m1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.2"></eq><apply id="S5.SS1.p1.1.m1.1.1.3.cmml" xref="S5.SS1.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.3.1.cmml" xref="S5.SS1.p1.1.m1.1.1.3">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.3.2.cmml" xref="S5.SS1.p1.1.m1.1.1.3.2">𝒫</ci><apply id="S5.SS1.p1.1.m1.1.1.3.3.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3"><times id="S5.SS1.p1.1.m1.1.1.3.3.1.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.1"></times><ci id="S5.SS1.p1.1.m1.1.1.3.3.2.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.2">𝑙</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.3.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.3">𝑖</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.4.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.4">𝑛</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.5.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.5">𝑒</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.6.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.6">𝑎</ci><apply id="S5.SS1.p1.1.m1.1.1.3.3.7.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.3.3.7.1.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.3.3.7.2.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.2">𝑟</ci><apply id="S5.SS1.p1.1.m1.1.1.3.3.7.3.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3"><times id="S5.SS1.p1.1.m1.1.1.3.3.7.3.1.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.1"></times><ci id="S5.SS1.p1.1.m1.1.1.3.3.7.3.2.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.2">𝑓</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.7.3.3.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.3">𝑢</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.7.3.4.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.4">𝑙</ci><ci id="S5.SS1.p1.1.m1.1.1.3.3.7.3.5.cmml" xref="S5.SS1.p1.1.m1.1.1.3.3.7.3.5">𝑙</ci></apply></apply></apply></apply><set id="S5.SS1.p1.1.m1.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1"><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><and id="S5.SS1.p1.1.m1.1.1.1.1.1a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"></and><apply id="S5.SS1.p1.1.m1.1.1.1.1.1b.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.3.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.3">→</ci><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.2.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.2.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.2">𝑀</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.2.3a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.3"><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.2.3.cmml" mathsize="70%" xref="S5.SS1.p1.1.m1.1.1.1.1.1.2.3">indexing</mtext></ci></apply><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.4.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.4.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.4.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.2">𝑀</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.4.3a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.3"><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.4.3.cmml" mathsize="70%" xref="S5.SS1.p1.1.m1.1.1.1.1.1.4.3">pre-retrieval</mtext></ci></apply></apply><apply id="S5.SS1.p1.1.m1.1.1.1.1.1c.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.5.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.5">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.SS1.p1.1.m1.1.1.1.1.1.4.cmml" id="S5.SS1.p1.1.m1.1.1.1.1.1d.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"></share><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.6.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.6.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.6.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.2">𝑀</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.6.3a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.3"><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.6.3.cmml" mathsize="70%" xref="S5.SS1.p1.1.m1.1.1.1.1.1.6.3">retrieval</mtext></ci></apply></apply><apply id="S5.SS1.p1.1.m1.1.1.1.1.1e.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.7.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.7">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.SS1.p1.1.m1.1.1.1.1.1.6.cmml" id="S5.SS1.p1.1.m1.1.1.1.1.1f.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"></share><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.8.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.8.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.8.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.2">𝑀</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.8.3a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.3"><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.8.3.cmml" mathsize="70%" xref="S5.SS1.p1.1.m1.1.1.1.1.1.8.3">post-retrieval</mtext></ci></apply></apply><apply id="S5.SS1.p1.1.m1.1.1.1.1.1g.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.9.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.9">→</ci><share href="https://arxiv.org/html/2407.21059v1#S5.SS1.p1.1.m1.1.1.1.1.1.8.cmml" id="S5.SS1.p1.1.m1.1.1.1.1.1h.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"></share><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.10.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.10.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.10.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.2">𝑀</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.10.3a.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.3"><mtext id="S5.SS1.p1.1.m1.1.1.1.1.1.10.3.cmml" mathsize="70%" xref="S5.SS1.p1.1.m1.1.1.1.1.1.10.3">generate</mtext></ci></apply></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.1.m1.1c">\mathcal{P}_{linear_{full}}=\{M_{\text{indexing}}\rightarrow M_{\text{pre-%
retrieval}}\rightarrow M_{\text{retrieval}}\rightarrow M_{\text{post-retrieval%
}}\rightarrow M_{\text{generate}}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.1.m1.1d">caligraphic_P start_POSTSUBSCRIPT italic_l italic_i italic_n italic_e italic_a italic_r start_POSTSUBSCRIPT italic_f italic_u italic_l italic_l end_POSTSUBSCRIPT end_POSTSUBSCRIPT = { italic_M start_POSTSUBSCRIPT indexing end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT pre-retrieval end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT retrieval end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT post-retrieval end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT generate end_POSTSUBSCRIPT }</annotation></semantics></math>. If there are no pre-retrieval and post-retrieval modules, it follows the Naive RAG paradigm.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.2.1.1">Algorithm 1</span> </span> Linear RAG Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg1.3">
<div class="ltx_listingline" id="alg1.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="q" class="ltx_Math" display="inline" id="alg1.l0.m1.1"><semantics id="alg1.l0.m1.1a"><mi id="alg1.l0.m1.1.1" xref="alg1.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg1.l0.m1.1b"><ci id="alg1.l0.m1.1.1.cmml" xref="alg1.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m1.1d">italic_q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg1.l0.m2.1"><semantics id="alg1.l0.m2.1a"><mi id="alg1.l0.m2.1.1" xref="alg1.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg1.l0.m2.1b"><ci id="alg1.l0.m2.1.1.cmml" xref="alg1.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m2.1d">italic_D</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg1.l0.m3.1"><semantics id="alg1.l0.m3.1a"><mi id="alg1.l0.m3.1.1" xref="alg1.l0.m3.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg1.l0.m3.1b"><ci id="alg1.l0.m3.1.1.cmml" xref="alg1.l0.m3.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m3.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m3.1d">italic_R</annotation></semantics></math>, language model <math alttext="LLM" class="ltx_Math" display="inline" id="alg1.l0.m4.1"><semantics id="alg1.l0.m4.1a"><mrow id="alg1.l0.m4.1.1" xref="alg1.l0.m4.1.1.cmml"><mi id="alg1.l0.m4.1.1.2" xref="alg1.l0.m4.1.1.2.cmml">L</mi><mo id="alg1.l0.m4.1.1.1" xref="alg1.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg1.l0.m4.1.1.3" xref="alg1.l0.m4.1.1.3.cmml">L</mi><mo id="alg1.l0.m4.1.1.1a" xref="alg1.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg1.l0.m4.1.1.4" xref="alg1.l0.m4.1.1.4.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0.m4.1b"><apply id="alg1.l0.m4.1.1.cmml" xref="alg1.l0.m4.1.1"><times id="alg1.l0.m4.1.1.1.cmml" xref="alg1.l0.m4.1.1.1"></times><ci id="alg1.l0.m4.1.1.2.cmml" xref="alg1.l0.m4.1.1.2">𝐿</ci><ci id="alg1.l0.m4.1.1.3.cmml" xref="alg1.l0.m4.1.1.3">𝐿</ci><ci id="alg1.l0.m4.1.1.4.cmml" xref="alg1.l0.m4.1.1.4">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m4.1c">LLM</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m4.1d">italic_L italic_L italic_M</annotation></semantics></math>, pre-processing function <math alttext="f_{pre}" class="ltx_Math" display="inline" id="alg1.l0.m5.1"><semantics id="alg1.l0.m5.1a"><msub id="alg1.l0.m5.1.1" xref="alg1.l0.m5.1.1.cmml"><mi id="alg1.l0.m5.1.1.2" xref="alg1.l0.m5.1.1.2.cmml">f</mi><mrow id="alg1.l0.m5.1.1.3" xref="alg1.l0.m5.1.1.3.cmml"><mi id="alg1.l0.m5.1.1.3.2" xref="alg1.l0.m5.1.1.3.2.cmml">p</mi><mo id="alg1.l0.m5.1.1.3.1" xref="alg1.l0.m5.1.1.3.1.cmml">⁢</mo><mi id="alg1.l0.m5.1.1.3.3" xref="alg1.l0.m5.1.1.3.3.cmml">r</mi><mo id="alg1.l0.m5.1.1.3.1a" xref="alg1.l0.m5.1.1.3.1.cmml">⁢</mo><mi id="alg1.l0.m5.1.1.3.4" xref="alg1.l0.m5.1.1.3.4.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.l0.m5.1b"><apply id="alg1.l0.m5.1.1.cmml" xref="alg1.l0.m5.1.1"><csymbol cd="ambiguous" id="alg1.l0.m5.1.1.1.cmml" xref="alg1.l0.m5.1.1">subscript</csymbol><ci id="alg1.l0.m5.1.1.2.cmml" xref="alg1.l0.m5.1.1.2">𝑓</ci><apply id="alg1.l0.m5.1.1.3.cmml" xref="alg1.l0.m5.1.1.3"><times id="alg1.l0.m5.1.1.3.1.cmml" xref="alg1.l0.m5.1.1.3.1"></times><ci id="alg1.l0.m5.1.1.3.2.cmml" xref="alg1.l0.m5.1.1.3.2">𝑝</ci><ci id="alg1.l0.m5.1.1.3.3.cmml" xref="alg1.l0.m5.1.1.3.3">𝑟</ci><ci id="alg1.l0.m5.1.1.3.4.cmml" xref="alg1.l0.m5.1.1.3.4">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m5.1c">f_{pre}</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m5.1d">italic_f start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT</annotation></semantics></math>, post-processing function <math alttext="f_{post}" class="ltx_Math" display="inline" id="alg1.l0.m6.1"><semantics id="alg1.l0.m6.1a"><msub id="alg1.l0.m6.1.1" xref="alg1.l0.m6.1.1.cmml"><mi id="alg1.l0.m6.1.1.2" xref="alg1.l0.m6.1.1.2.cmml">f</mi><mrow id="alg1.l0.m6.1.1.3" xref="alg1.l0.m6.1.1.3.cmml"><mi id="alg1.l0.m6.1.1.3.2" xref="alg1.l0.m6.1.1.3.2.cmml">p</mi><mo id="alg1.l0.m6.1.1.3.1" xref="alg1.l0.m6.1.1.3.1.cmml">⁢</mo><mi id="alg1.l0.m6.1.1.3.3" xref="alg1.l0.m6.1.1.3.3.cmml">o</mi><mo id="alg1.l0.m6.1.1.3.1a" xref="alg1.l0.m6.1.1.3.1.cmml">⁢</mo><mi id="alg1.l0.m6.1.1.3.4" xref="alg1.l0.m6.1.1.3.4.cmml">s</mi><mo id="alg1.l0.m6.1.1.3.1b" xref="alg1.l0.m6.1.1.3.1.cmml">⁢</mo><mi id="alg1.l0.m6.1.1.3.5" xref="alg1.l0.m6.1.1.3.5.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.l0.m6.1b"><apply id="alg1.l0.m6.1.1.cmml" xref="alg1.l0.m6.1.1"><csymbol cd="ambiguous" id="alg1.l0.m6.1.1.1.cmml" xref="alg1.l0.m6.1.1">subscript</csymbol><ci id="alg1.l0.m6.1.1.2.cmml" xref="alg1.l0.m6.1.1.2">𝑓</ci><apply id="alg1.l0.m6.1.1.3.cmml" xref="alg1.l0.m6.1.1.3"><times id="alg1.l0.m6.1.1.3.1.cmml" xref="alg1.l0.m6.1.1.3.1"></times><ci id="alg1.l0.m6.1.1.3.2.cmml" xref="alg1.l0.m6.1.1.3.2">𝑝</ci><ci id="alg1.l0.m6.1.1.3.3.cmml" xref="alg1.l0.m6.1.1.3.3">𝑜</ci><ci id="alg1.l0.m6.1.1.3.4.cmml" xref="alg1.l0.m6.1.1.3.4">𝑠</ci><ci id="alg1.l0.m6.1.1.3.5.cmml" xref="alg1.l0.m6.1.1.3.5">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m6.1c">f_{post}</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m6.1d">italic_f start_POSTSUBSCRIPT italic_p italic_o italic_s italic_t end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg1.l0a.m1.1"><semantics id="alg1.l0a.m1.1a"><mover accent="true" id="alg1.l0a.m1.1.1" xref="alg1.l0a.m1.1.1.cmml"><mi id="alg1.l0a.m1.1.1.2" xref="alg1.l0a.m1.1.1.2.cmml">y</mi><mo id="alg1.l0a.m1.1.1.1" xref="alg1.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg1.l0a.m1.1b"><apply id="alg1.l0a.m1.1.1.cmml" xref="alg1.l0a.m1.1.1"><ci id="alg1.l0a.m1.1.1.1.cmml" xref="alg1.l0a.m1.1.1.1">^</ci><ci id="alg1.l0a.m1.1.1.2.cmml" xref="alg1.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg1.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="q^{\prime}\leftarrow f_{pre}(q)" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><mrow id="alg1.l2.m1.1.2" xref="alg1.l2.m1.1.2.cmml"><msup id="alg1.l2.m1.1.2.2" xref="alg1.l2.m1.1.2.2.cmml"><mi id="alg1.l2.m1.1.2.2.2" xref="alg1.l2.m1.1.2.2.2.cmml">q</mi><mo id="alg1.l2.m1.1.2.2.3" xref="alg1.l2.m1.1.2.2.3.cmml">′</mo></msup><mo id="alg1.l2.m1.1.2.1" stretchy="false" xref="alg1.l2.m1.1.2.1.cmml">←</mo><mrow id="alg1.l2.m1.1.2.3" xref="alg1.l2.m1.1.2.3.cmml"><msub id="alg1.l2.m1.1.2.3.2" xref="alg1.l2.m1.1.2.3.2.cmml"><mi id="alg1.l2.m1.1.2.3.2.2" xref="alg1.l2.m1.1.2.3.2.2.cmml">f</mi><mrow id="alg1.l2.m1.1.2.3.2.3" xref="alg1.l2.m1.1.2.3.2.3.cmml"><mi id="alg1.l2.m1.1.2.3.2.3.2" xref="alg1.l2.m1.1.2.3.2.3.2.cmml">p</mi><mo id="alg1.l2.m1.1.2.3.2.3.1" xref="alg1.l2.m1.1.2.3.2.3.1.cmml">⁢</mo><mi id="alg1.l2.m1.1.2.3.2.3.3" xref="alg1.l2.m1.1.2.3.2.3.3.cmml">r</mi><mo id="alg1.l2.m1.1.2.3.2.3.1a" xref="alg1.l2.m1.1.2.3.2.3.1.cmml">⁢</mo><mi id="alg1.l2.m1.1.2.3.2.3.4" xref="alg1.l2.m1.1.2.3.2.3.4.cmml">e</mi></mrow></msub><mo id="alg1.l2.m1.1.2.3.1" xref="alg1.l2.m1.1.2.3.1.cmml">⁢</mo><mrow id="alg1.l2.m1.1.2.3.3.2" xref="alg1.l2.m1.1.2.3.cmml"><mo id="alg1.l2.m1.1.2.3.3.2.1" stretchy="false" xref="alg1.l2.m1.1.2.3.cmml">(</mo><mi id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml">q</mi><mo id="alg1.l2.m1.1.2.3.3.2.2" stretchy="false" xref="alg1.l2.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><apply id="alg1.l2.m1.1.2.cmml" xref="alg1.l2.m1.1.2"><ci id="alg1.l2.m1.1.2.1.cmml" xref="alg1.l2.m1.1.2.1">←</ci><apply id="alg1.l2.m1.1.2.2.cmml" xref="alg1.l2.m1.1.2.2"><csymbol cd="ambiguous" id="alg1.l2.m1.1.2.2.1.cmml" xref="alg1.l2.m1.1.2.2">superscript</csymbol><ci id="alg1.l2.m1.1.2.2.2.cmml" xref="alg1.l2.m1.1.2.2.2">𝑞</ci><ci id="alg1.l2.m1.1.2.2.3.cmml" xref="alg1.l2.m1.1.2.2.3">′</ci></apply><apply id="alg1.l2.m1.1.2.3.cmml" xref="alg1.l2.m1.1.2.3"><times id="alg1.l2.m1.1.2.3.1.cmml" xref="alg1.l2.m1.1.2.3.1"></times><apply id="alg1.l2.m1.1.2.3.2.cmml" xref="alg1.l2.m1.1.2.3.2"><csymbol cd="ambiguous" id="alg1.l2.m1.1.2.3.2.1.cmml" xref="alg1.l2.m1.1.2.3.2">subscript</csymbol><ci id="alg1.l2.m1.1.2.3.2.2.cmml" xref="alg1.l2.m1.1.2.3.2.2">𝑓</ci><apply id="alg1.l2.m1.1.2.3.2.3.cmml" xref="alg1.l2.m1.1.2.3.2.3"><times id="alg1.l2.m1.1.2.3.2.3.1.cmml" xref="alg1.l2.m1.1.2.3.2.3.1"></times><ci id="alg1.l2.m1.1.2.3.2.3.2.cmml" xref="alg1.l2.m1.1.2.3.2.3.2">𝑝</ci><ci id="alg1.l2.m1.1.2.3.2.3.3.cmml" xref="alg1.l2.m1.1.2.3.2.3.3">𝑟</ci><ci id="alg1.l2.m1.1.2.3.2.3.4.cmml" xref="alg1.l2.m1.1.2.3.2.3.4">𝑒</ci></apply></apply><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">q^{\prime}\leftarrow f_{pre}(q)</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_f start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT ( italic_q )</annotation></semantics></math> // Pre-process the original query

</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="D^{q^{\prime}}\leftarrow R(q^{\prime},D)" class="ltx_Math" display="inline" id="alg1.l3.m1.2"><semantics id="alg1.l3.m1.2a"><mrow id="alg1.l3.m1.2.2" xref="alg1.l3.m1.2.2.cmml"><msup id="alg1.l3.m1.2.2.3" xref="alg1.l3.m1.2.2.3.cmml"><mi id="alg1.l3.m1.2.2.3.2" xref="alg1.l3.m1.2.2.3.2.cmml">D</mi><msup id="alg1.l3.m1.2.2.3.3" xref="alg1.l3.m1.2.2.3.3.cmml"><mi id="alg1.l3.m1.2.2.3.3.2" xref="alg1.l3.m1.2.2.3.3.2.cmml">q</mi><mo id="alg1.l3.m1.2.2.3.3.3" xref="alg1.l3.m1.2.2.3.3.3.cmml">′</mo></msup></msup><mo id="alg1.l3.m1.2.2.2" stretchy="false" xref="alg1.l3.m1.2.2.2.cmml">←</mo><mrow id="alg1.l3.m1.2.2.1" xref="alg1.l3.m1.2.2.1.cmml"><mi id="alg1.l3.m1.2.2.1.3" xref="alg1.l3.m1.2.2.1.3.cmml">R</mi><mo id="alg1.l3.m1.2.2.1.2" xref="alg1.l3.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg1.l3.m1.2.2.1.1.1" xref="alg1.l3.m1.2.2.1.1.2.cmml"><mo id="alg1.l3.m1.2.2.1.1.1.2" stretchy="false" xref="alg1.l3.m1.2.2.1.1.2.cmml">(</mo><msup id="alg1.l3.m1.2.2.1.1.1.1" xref="alg1.l3.m1.2.2.1.1.1.1.cmml"><mi id="alg1.l3.m1.2.2.1.1.1.1.2" xref="alg1.l3.m1.2.2.1.1.1.1.2.cmml">q</mi><mo id="alg1.l3.m1.2.2.1.1.1.1.3" xref="alg1.l3.m1.2.2.1.1.1.1.3.cmml">′</mo></msup><mo id="alg1.l3.m1.2.2.1.1.1.3" xref="alg1.l3.m1.2.2.1.1.2.cmml">,</mo><mi id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml">D</mi><mo id="alg1.l3.m1.2.2.1.1.1.4" stretchy="false" xref="alg1.l3.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.2b"><apply id="alg1.l3.m1.2.2.cmml" xref="alg1.l3.m1.2.2"><ci id="alg1.l3.m1.2.2.2.cmml" xref="alg1.l3.m1.2.2.2">←</ci><apply id="alg1.l3.m1.2.2.3.cmml" xref="alg1.l3.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l3.m1.2.2.3.1.cmml" xref="alg1.l3.m1.2.2.3">superscript</csymbol><ci id="alg1.l3.m1.2.2.3.2.cmml" xref="alg1.l3.m1.2.2.3.2">𝐷</ci><apply id="alg1.l3.m1.2.2.3.3.cmml" xref="alg1.l3.m1.2.2.3.3"><csymbol cd="ambiguous" id="alg1.l3.m1.2.2.3.3.1.cmml" xref="alg1.l3.m1.2.2.3.3">superscript</csymbol><ci id="alg1.l3.m1.2.2.3.3.2.cmml" xref="alg1.l3.m1.2.2.3.3.2">𝑞</ci><ci id="alg1.l3.m1.2.2.3.3.3.cmml" xref="alg1.l3.m1.2.2.3.3.3">′</ci></apply></apply><apply id="alg1.l3.m1.2.2.1.cmml" xref="alg1.l3.m1.2.2.1"><times id="alg1.l3.m1.2.2.1.2.cmml" xref="alg1.l3.m1.2.2.1.2"></times><ci id="alg1.l3.m1.2.2.1.3.cmml" xref="alg1.l3.m1.2.2.1.3">𝑅</ci><interval closure="open" id="alg1.l3.m1.2.2.1.1.2.cmml" xref="alg1.l3.m1.2.2.1.1.1"><apply id="alg1.l3.m1.2.2.1.1.1.1.cmml" xref="alg1.l3.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l3.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l3.m1.2.2.1.1.1.1">superscript</csymbol><ci id="alg1.l3.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l3.m1.2.2.1.1.1.1.2">𝑞</ci><ci id="alg1.l3.m1.2.2.1.1.1.1.3.cmml" xref="alg1.l3.m1.2.2.1.1.1.1.3">′</ci></apply><ci id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.2c">D^{q^{\prime}}\leftarrow R(q^{\prime},D)</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.2d">italic_D start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT ← italic_R ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D )</annotation></semantics></math> // Retrieve documents related to the pre-processed query

</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l4.1.1.1" style="font-size:80%;">4:</span></span>  <math alttext="\hat{D}^{q^{\prime}}\leftarrow f_{post}(q^{\prime},D^{q^{\prime}})" class="ltx_Math" display="inline" id="alg1.l4.m1.2"><semantics id="alg1.l4.m1.2a"><mrow id="alg1.l4.m1.2.2" xref="alg1.l4.m1.2.2.cmml"><msup id="alg1.l4.m1.2.2.4" xref="alg1.l4.m1.2.2.4.cmml"><mover accent="true" id="alg1.l4.m1.2.2.4.2" xref="alg1.l4.m1.2.2.4.2.cmml"><mi id="alg1.l4.m1.2.2.4.2.2" xref="alg1.l4.m1.2.2.4.2.2.cmml">D</mi><mo id="alg1.l4.m1.2.2.4.2.1" xref="alg1.l4.m1.2.2.4.2.1.cmml">^</mo></mover><msup id="alg1.l4.m1.2.2.4.3" xref="alg1.l4.m1.2.2.4.3.cmml"><mi id="alg1.l4.m1.2.2.4.3.2" xref="alg1.l4.m1.2.2.4.3.2.cmml">q</mi><mo id="alg1.l4.m1.2.2.4.3.3" xref="alg1.l4.m1.2.2.4.3.3.cmml">′</mo></msup></msup><mo id="alg1.l4.m1.2.2.3" stretchy="false" xref="alg1.l4.m1.2.2.3.cmml">←</mo><mrow id="alg1.l4.m1.2.2.2" xref="alg1.l4.m1.2.2.2.cmml"><msub id="alg1.l4.m1.2.2.2.4" xref="alg1.l4.m1.2.2.2.4.cmml"><mi id="alg1.l4.m1.2.2.2.4.2" xref="alg1.l4.m1.2.2.2.4.2.cmml">f</mi><mrow id="alg1.l4.m1.2.2.2.4.3" xref="alg1.l4.m1.2.2.2.4.3.cmml"><mi id="alg1.l4.m1.2.2.2.4.3.2" xref="alg1.l4.m1.2.2.2.4.3.2.cmml">p</mi><mo id="alg1.l4.m1.2.2.2.4.3.1" xref="alg1.l4.m1.2.2.2.4.3.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.4.3.3" xref="alg1.l4.m1.2.2.2.4.3.3.cmml">o</mi><mo id="alg1.l4.m1.2.2.2.4.3.1a" xref="alg1.l4.m1.2.2.2.4.3.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.4.3.4" xref="alg1.l4.m1.2.2.2.4.3.4.cmml">s</mi><mo id="alg1.l4.m1.2.2.2.4.3.1b" xref="alg1.l4.m1.2.2.2.4.3.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.4.3.5" xref="alg1.l4.m1.2.2.2.4.3.5.cmml">t</mi></mrow></msub><mo id="alg1.l4.m1.2.2.2.3" xref="alg1.l4.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg1.l4.m1.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.3.cmml"><mo id="alg1.l4.m1.2.2.2.2.2.3" stretchy="false" xref="alg1.l4.m1.2.2.2.2.3.cmml">(</mo><msup id="alg1.l4.m1.1.1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l4.m1.1.1.1.1.1.1.2" xref="alg1.l4.m1.1.1.1.1.1.1.2.cmml">q</mi><mo id="alg1.l4.m1.1.1.1.1.1.1.3" xref="alg1.l4.m1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg1.l4.m1.2.2.2.2.2.4" xref="alg1.l4.m1.2.2.2.2.3.cmml">,</mo><msup id="alg1.l4.m1.2.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.2.cmml"><mi id="alg1.l4.m1.2.2.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.2.2.cmml">D</mi><msup id="alg1.l4.m1.2.2.2.2.2.2.3" xref="alg1.l4.m1.2.2.2.2.2.2.3.cmml"><mi id="alg1.l4.m1.2.2.2.2.2.2.3.2" xref="alg1.l4.m1.2.2.2.2.2.2.3.2.cmml">q</mi><mo id="alg1.l4.m1.2.2.2.2.2.2.3.3" xref="alg1.l4.m1.2.2.2.2.2.2.3.3.cmml">′</mo></msup></msup><mo id="alg1.l4.m1.2.2.2.2.2.5" stretchy="false" xref="alg1.l4.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.2b"><apply id="alg1.l4.m1.2.2.cmml" xref="alg1.l4.m1.2.2"><ci id="alg1.l4.m1.2.2.3.cmml" xref="alg1.l4.m1.2.2.3">←</ci><apply id="alg1.l4.m1.2.2.4.cmml" xref="alg1.l4.m1.2.2.4"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.4.1.cmml" xref="alg1.l4.m1.2.2.4">superscript</csymbol><apply id="alg1.l4.m1.2.2.4.2.cmml" xref="alg1.l4.m1.2.2.4.2"><ci id="alg1.l4.m1.2.2.4.2.1.cmml" xref="alg1.l4.m1.2.2.4.2.1">^</ci><ci id="alg1.l4.m1.2.2.4.2.2.cmml" xref="alg1.l4.m1.2.2.4.2.2">𝐷</ci></apply><apply id="alg1.l4.m1.2.2.4.3.cmml" xref="alg1.l4.m1.2.2.4.3"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.4.3.1.cmml" xref="alg1.l4.m1.2.2.4.3">superscript</csymbol><ci id="alg1.l4.m1.2.2.4.3.2.cmml" xref="alg1.l4.m1.2.2.4.3.2">𝑞</ci><ci id="alg1.l4.m1.2.2.4.3.3.cmml" xref="alg1.l4.m1.2.2.4.3.3">′</ci></apply></apply><apply id="alg1.l4.m1.2.2.2.cmml" xref="alg1.l4.m1.2.2.2"><times id="alg1.l4.m1.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.3"></times><apply id="alg1.l4.m1.2.2.2.4.cmml" xref="alg1.l4.m1.2.2.2.4"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.2.4.1.cmml" xref="alg1.l4.m1.2.2.2.4">subscript</csymbol><ci id="alg1.l4.m1.2.2.2.4.2.cmml" xref="alg1.l4.m1.2.2.2.4.2">𝑓</ci><apply id="alg1.l4.m1.2.2.2.4.3.cmml" xref="alg1.l4.m1.2.2.2.4.3"><times id="alg1.l4.m1.2.2.2.4.3.1.cmml" xref="alg1.l4.m1.2.2.2.4.3.1"></times><ci id="alg1.l4.m1.2.2.2.4.3.2.cmml" xref="alg1.l4.m1.2.2.2.4.3.2">𝑝</ci><ci id="alg1.l4.m1.2.2.2.4.3.3.cmml" xref="alg1.l4.m1.2.2.2.4.3.3">𝑜</ci><ci id="alg1.l4.m1.2.2.2.4.3.4.cmml" xref="alg1.l4.m1.2.2.2.4.3.4">𝑠</ci><ci id="alg1.l4.m1.2.2.2.4.3.5.cmml" xref="alg1.l4.m1.2.2.2.4.3.5">𝑡</ci></apply></apply><interval closure="open" id="alg1.l4.m1.2.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2.2"><apply id="alg1.l4.m1.1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1.1">superscript</csymbol><ci id="alg1.l4.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg1.l4.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.1.1.1.3">′</ci></apply><apply id="alg1.l4.m1.2.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.2.2.2.2.1.cmml" xref="alg1.l4.m1.2.2.2.2.2.2">superscript</csymbol><ci id="alg1.l4.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2.2.2">𝐷</ci><apply id="alg1.l4.m1.2.2.2.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.2.2.2.2.3.1.cmml" xref="alg1.l4.m1.2.2.2.2.2.2.3">superscript</csymbol><ci id="alg1.l4.m1.2.2.2.2.2.2.3.2.cmml" xref="alg1.l4.m1.2.2.2.2.2.2.3.2">𝑞</ci><ci id="alg1.l4.m1.2.2.2.2.2.2.3.3.cmml" xref="alg1.l4.m1.2.2.2.2.2.2.3.3">′</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.2c">\hat{D}^{q^{\prime}}\leftarrow f_{post}(q^{\prime},D^{q^{\prime}})</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.2d">over^ start_ARG italic_D end_ARG start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT ← italic_f start_POSTSUBSCRIPT italic_p italic_o italic_s italic_t end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT )</annotation></semantics></math> // Post-process the retrieved documents

</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l5.1.1.1" style="font-size:80%;">5:</span></span>  <math alttext="\hat{y}\leftarrow LLM([q,\hat{D}^{q^{\prime}}])" class="ltx_Math" display="inline" id="alg1.l5.m1.2"><semantics id="alg1.l5.m1.2a"><mrow id="alg1.l5.m1.2.2" xref="alg1.l5.m1.2.2.cmml"><mover accent="true" id="alg1.l5.m1.2.2.3" xref="alg1.l5.m1.2.2.3.cmml"><mi id="alg1.l5.m1.2.2.3.2" xref="alg1.l5.m1.2.2.3.2.cmml">y</mi><mo id="alg1.l5.m1.2.2.3.1" xref="alg1.l5.m1.2.2.3.1.cmml">^</mo></mover><mo id="alg1.l5.m1.2.2.2" stretchy="false" xref="alg1.l5.m1.2.2.2.cmml">←</mo><mrow id="alg1.l5.m1.2.2.1" xref="alg1.l5.m1.2.2.1.cmml"><mi id="alg1.l5.m1.2.2.1.3" xref="alg1.l5.m1.2.2.1.3.cmml">L</mi><mo id="alg1.l5.m1.2.2.1.2" xref="alg1.l5.m1.2.2.1.2.cmml">⁢</mo><mi id="alg1.l5.m1.2.2.1.4" xref="alg1.l5.m1.2.2.1.4.cmml">L</mi><mo id="alg1.l5.m1.2.2.1.2a" xref="alg1.l5.m1.2.2.1.2.cmml">⁢</mo><mi id="alg1.l5.m1.2.2.1.5" xref="alg1.l5.m1.2.2.1.5.cmml">M</mi><mo id="alg1.l5.m1.2.2.1.2b" xref="alg1.l5.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg1.l5.m1.2.2.1.1.1" xref="alg1.l5.m1.2.2.1.cmml"><mo id="alg1.l5.m1.2.2.1.1.1.2" stretchy="false" xref="alg1.l5.m1.2.2.1.cmml">(</mo><mrow id="alg1.l5.m1.2.2.1.1.1.1.1" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml"><mo id="alg1.l5.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml">[</mo><mi id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml">q</mi><mo id="alg1.l5.m1.2.2.1.1.1.1.1.3" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml">,</mo><msup id="alg1.l5.m1.2.2.1.1.1.1.1.1" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l5.m1.2.2.1.1.1.1.1.1.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.cmml"><mi id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2.cmml">D</mi><mo id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><msup id="alg1.l5.m1.2.2.1.1.1.1.1.1.3" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.cmml"><mi id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2.cmml">q</mi><mo id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.cmml">′</mo></msup></msup><mo id="alg1.l5.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml">]</mo></mrow><mo id="alg1.l5.m1.2.2.1.1.1.3" stretchy="false" xref="alg1.l5.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.2b"><apply id="alg1.l5.m1.2.2.cmml" xref="alg1.l5.m1.2.2"><ci id="alg1.l5.m1.2.2.2.cmml" xref="alg1.l5.m1.2.2.2">←</ci><apply id="alg1.l5.m1.2.2.3.cmml" xref="alg1.l5.m1.2.2.3"><ci id="alg1.l5.m1.2.2.3.1.cmml" xref="alg1.l5.m1.2.2.3.1">^</ci><ci id="alg1.l5.m1.2.2.3.2.cmml" xref="alg1.l5.m1.2.2.3.2">𝑦</ci></apply><apply id="alg1.l5.m1.2.2.1.cmml" xref="alg1.l5.m1.2.2.1"><times id="alg1.l5.m1.2.2.1.2.cmml" xref="alg1.l5.m1.2.2.1.2"></times><ci id="alg1.l5.m1.2.2.1.3.cmml" xref="alg1.l5.m1.2.2.1.3">𝐿</ci><ci id="alg1.l5.m1.2.2.1.4.cmml" xref="alg1.l5.m1.2.2.1.4">𝐿</ci><ci id="alg1.l5.m1.2.2.1.5.cmml" xref="alg1.l5.m1.2.2.1.5">𝑀</ci><interval closure="closed" id="alg1.l5.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1"><ci id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1">𝑞</ci><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2"><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2">𝐷</ci></apply><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3">superscript</csymbol><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2">𝑞</ci><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3">′</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.2c">\hat{y}\leftarrow LLM([q,\hat{D}^{q^{\prime}}])</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.2d">over^ start_ARG italic_y end_ARG ← italic_L italic_L italic_M ( [ italic_q , over^ start_ARG italic_D end_ARG start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT ] )</annotation></semantics></math> // Generate output using the language model with the original query and post-processed documents

</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l6.1.1.1" style="font-size:80%;">6:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l6.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg1.l6.m1.1"><semantics id="alg1.l6.m1.1a"><mover accent="true" id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml"><mi id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml">y</mi><mo id="alg1.l6.m1.1.1.1" xref="alg1.l6.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1"><ci id="alg1.l6.m1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1">^</ci><ci id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math> // Return the final output

</div>
</div>
</figure>
<figure class="ltx_figure" id="S5.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="102" id="S5.F4.g1" src="extracted/5756188/images/Seq_Pattern.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>Linear RAG flow pattern. Each module is processed in a fixed sequential order. </figcaption>
</figure>
<figure class="ltx_figure" id="S5.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="127" id="S5.F5.g1" src="extracted/5756188/images/rrr.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span>RRR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib24" title="">24</a>]</cite> is a typical linear flow that introduces a learnable query rewrite module before retrieval. This module employs reinforcement based on the output results of the LLM.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1">Common linear RAG flow involves a query transform module (such as rewrite or HyDE operators) at the pre-retrieval stage and utilize rerank at the post-retrieval stage. Rewrite-Retrieve-Read (RRR) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib24" title="">24</a>]</cite> is a typical linear structure. As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F5" title="Figure 5 ‣ V-A Linear Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">5</span></a>, the query rewrite module <math alttext="f_{rewrite}" class="ltx_Math" display="inline" id="S5.SS1.p2.1.m1.1"><semantics id="S5.SS1.p2.1.m1.1a"><msub id="S5.SS1.p2.1.m1.1.1" xref="S5.SS1.p2.1.m1.1.1.cmml"><mi id="S5.SS1.p2.1.m1.1.1.2" xref="S5.SS1.p2.1.m1.1.1.2.cmml">f</mi><mrow id="S5.SS1.p2.1.m1.1.1.3" xref="S5.SS1.p2.1.m1.1.1.3.cmml"><mi id="S5.SS1.p2.1.m1.1.1.3.2" xref="S5.SS1.p2.1.m1.1.1.3.2.cmml">r</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.3" xref="S5.SS1.p2.1.m1.1.1.3.3.cmml">e</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1a" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.4" xref="S5.SS1.p2.1.m1.1.1.3.4.cmml">w</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1b" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.5" xref="S5.SS1.p2.1.m1.1.1.3.5.cmml">r</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1c" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.6" xref="S5.SS1.p2.1.m1.1.1.3.6.cmml">i</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1d" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.7" xref="S5.SS1.p2.1.m1.1.1.3.7.cmml">t</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1e" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.8" xref="S5.SS1.p2.1.m1.1.1.3.8.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.1.m1.1b"><apply id="S5.SS1.p2.1.m1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.1.m1.1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS1.p2.1.m1.1.1.2.cmml" xref="S5.SS1.p2.1.m1.1.1.2">𝑓</ci><apply id="S5.SS1.p2.1.m1.1.1.3.cmml" xref="S5.SS1.p2.1.m1.1.1.3"><times id="S5.SS1.p2.1.m1.1.1.3.1.cmml" xref="S5.SS1.p2.1.m1.1.1.3.1"></times><ci id="S5.SS1.p2.1.m1.1.1.3.2.cmml" xref="S5.SS1.p2.1.m1.1.1.3.2">𝑟</ci><ci id="S5.SS1.p2.1.m1.1.1.3.3.cmml" xref="S5.SS1.p2.1.m1.1.1.3.3">𝑒</ci><ci id="S5.SS1.p2.1.m1.1.1.3.4.cmml" xref="S5.SS1.p2.1.m1.1.1.3.4">𝑤</ci><ci id="S5.SS1.p2.1.m1.1.1.3.5.cmml" xref="S5.SS1.p2.1.m1.1.1.3.5">𝑟</ci><ci id="S5.SS1.p2.1.m1.1.1.3.6.cmml" xref="S5.SS1.p2.1.m1.1.1.3.6">𝑖</ci><ci id="S5.SS1.p2.1.m1.1.1.3.7.cmml" xref="S5.SS1.p2.1.m1.1.1.3.7">𝑡</ci><ci id="S5.SS1.p2.1.m1.1.1.3.8.cmml" xref="S5.SS1.p2.1.m1.1.1.3.8">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.1.m1.1c">f_{rewrite}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.1.m1.1d">italic_f start_POSTSUBSCRIPT italic_r italic_e italic_w italic_r italic_i italic_t italic_e end_POSTSUBSCRIPT</annotation></semantics></math> is a smaller trainable language model fine-tuned on T5-large, and in the context of reinforcement learning, the optimization of the rewriter is formalized as a Markov decision process, with the final output of the LLM serving as the reward. The retriever utilizes a sparse encoding model, BM25.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S5.SS2.5.1.1">V-B</span> </span><span class="ltx_text ltx_font_italic" id="S5.SS2.6.2">Conditional Pattern</span>
</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.5">The RAG flow with conditional structure involves selecting different RAG pipeline based on different conditions, as illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F6" title="Figure 6 ‣ V-B Conditional Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">6</span></a>. A detailed definition is shown in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg2" title="Algorithm 2 ‣ V-B Conditional Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">2</span></a>. Typically, pipleline selection is accomplished through a routing module that determines the next module in the flow.</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E26">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{P}_{\text{conditional}}=\{M_{i}\xrightarrow[]{f_{r}}M_{j}\lor M_{k}\}" class="ltx_Math" display="block" id="S5.E26.m1.1"><semantics id="S5.E26.m1.1a"><mrow id="S5.E26.m1.1.1" xref="S5.E26.m1.1.1.cmml"><msub id="S5.E26.m1.1.1.3" xref="S5.E26.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E26.m1.1.1.3.2" xref="S5.E26.m1.1.1.3.2.cmml">𝒫</mi><mtext id="S5.E26.m1.1.1.3.3" xref="S5.E26.m1.1.1.3.3a.cmml">conditional</mtext></msub><mo id="S5.E26.m1.1.1.2" xref="S5.E26.m1.1.1.2.cmml">=</mo><mrow id="S5.E26.m1.1.1.1.1" xref="S5.E26.m1.1.1.1.2.cmml"><mo id="S5.E26.m1.1.1.1.1.2" stretchy="false" xref="S5.E26.m1.1.1.1.2.cmml">{</mo><mrow id="S5.E26.m1.1.1.1.1.1" xref="S5.E26.m1.1.1.1.1.1.cmml"><msub id="S5.E26.m1.1.1.1.1.1.2" xref="S5.E26.m1.1.1.1.1.1.2.cmml"><mi id="S5.E26.m1.1.1.1.1.1.2.2" xref="S5.E26.m1.1.1.1.1.1.2.2.cmml">M</mi><mi id="S5.E26.m1.1.1.1.1.1.2.3" xref="S5.E26.m1.1.1.1.1.1.2.3.cmml">i</mi></msub><mover accent="true" id="S5.E26.m1.1.1.1.1.1.1" xref="S5.E26.m1.1.1.1.1.1.1.cmml"><mo id="S5.E26.m1.1.1.1.1.1.1.2" stretchy="false" xref="S5.E26.m1.1.1.1.1.1.1.2.cmml">→</mo><msub id="S5.E26.m1.1.1.1.1.1.1.1" xref="S5.E26.m1.1.1.1.1.1.1.1.cmml"><mi id="S5.E26.m1.1.1.1.1.1.1.1.2" xref="S5.E26.m1.1.1.1.1.1.1.1.2.cmml">f</mi><mi id="S5.E26.m1.1.1.1.1.1.1.1.3" xref="S5.E26.m1.1.1.1.1.1.1.1.3.cmml">r</mi></msub></mover><mrow id="S5.E26.m1.1.1.1.1.1.3" xref="S5.E26.m1.1.1.1.1.1.3.cmml"><msub id="S5.E26.m1.1.1.1.1.1.3.2" xref="S5.E26.m1.1.1.1.1.1.3.2.cmml"><mi id="S5.E26.m1.1.1.1.1.1.3.2.2" xref="S5.E26.m1.1.1.1.1.1.3.2.2.cmml">M</mi><mi id="S5.E26.m1.1.1.1.1.1.3.2.3" xref="S5.E26.m1.1.1.1.1.1.3.2.3.cmml">j</mi></msub><mo id="S5.E26.m1.1.1.1.1.1.3.1" xref="S5.E26.m1.1.1.1.1.1.3.1.cmml">∨</mo><msub id="S5.E26.m1.1.1.1.1.1.3.3" xref="S5.E26.m1.1.1.1.1.1.3.3.cmml"><mi id="S5.E26.m1.1.1.1.1.1.3.3.2" xref="S5.E26.m1.1.1.1.1.1.3.3.2.cmml">M</mi><mi id="S5.E26.m1.1.1.1.1.1.3.3.3" xref="S5.E26.m1.1.1.1.1.1.3.3.3.cmml">k</mi></msub></mrow></mrow><mo id="S5.E26.m1.1.1.1.1.3" stretchy="false" xref="S5.E26.m1.1.1.1.2.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E26.m1.1b"><apply id="S5.E26.m1.1.1.cmml" xref="S5.E26.m1.1.1"><eq id="S5.E26.m1.1.1.2.cmml" xref="S5.E26.m1.1.1.2"></eq><apply id="S5.E26.m1.1.1.3.cmml" xref="S5.E26.m1.1.1.3"><csymbol cd="ambiguous" id="S5.E26.m1.1.1.3.1.cmml" xref="S5.E26.m1.1.1.3">subscript</csymbol><ci id="S5.E26.m1.1.1.3.2.cmml" xref="S5.E26.m1.1.1.3.2">𝒫</ci><ci id="S5.E26.m1.1.1.3.3a.cmml" xref="S5.E26.m1.1.1.3.3"><mtext id="S5.E26.m1.1.1.3.3.cmml" mathsize="70%" xref="S5.E26.m1.1.1.3.3">conditional</mtext></ci></apply><set id="S5.E26.m1.1.1.1.2.cmml" xref="S5.E26.m1.1.1.1.1"><apply id="S5.E26.m1.1.1.1.1.1.cmml" xref="S5.E26.m1.1.1.1.1.1"><apply id="S5.E26.m1.1.1.1.1.1.1.cmml" xref="S5.E26.m1.1.1.1.1.1.1"><apply id="S5.E26.m1.1.1.1.1.1.1.1.cmml" xref="S5.E26.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.E26.m1.1.1.1.1.1.1.1.1.cmml" xref="S5.E26.m1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S5.E26.m1.1.1.1.1.1.1.1.2.cmml" xref="S5.E26.m1.1.1.1.1.1.1.1.2">𝑓</ci><ci id="S5.E26.m1.1.1.1.1.1.1.1.3.cmml" xref="S5.E26.m1.1.1.1.1.1.1.1.3">𝑟</ci></apply><ci id="S5.E26.m1.1.1.1.1.1.1.2.cmml" xref="S5.E26.m1.1.1.1.1.1.1.2">→</ci></apply><apply id="S5.E26.m1.1.1.1.1.1.2.cmml" xref="S5.E26.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.E26.m1.1.1.1.1.1.2.1.cmml" xref="S5.E26.m1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.E26.m1.1.1.1.1.1.2.2.cmml" xref="S5.E26.m1.1.1.1.1.1.2.2">𝑀</ci><ci id="S5.E26.m1.1.1.1.1.1.2.3.cmml" xref="S5.E26.m1.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S5.E26.m1.1.1.1.1.1.3.cmml" xref="S5.E26.m1.1.1.1.1.1.3"><or id="S5.E26.m1.1.1.1.1.1.3.1.cmml" xref="S5.E26.m1.1.1.1.1.1.3.1"></or><apply id="S5.E26.m1.1.1.1.1.1.3.2.cmml" xref="S5.E26.m1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S5.E26.m1.1.1.1.1.1.3.2.1.cmml" xref="S5.E26.m1.1.1.1.1.1.3.2">subscript</csymbol><ci id="S5.E26.m1.1.1.1.1.1.3.2.2.cmml" xref="S5.E26.m1.1.1.1.1.1.3.2.2">𝑀</ci><ci id="S5.E26.m1.1.1.1.1.1.3.2.3.cmml" xref="S5.E26.m1.1.1.1.1.1.3.2.3">𝑗</ci></apply><apply id="S5.E26.m1.1.1.1.1.1.3.3.cmml" xref="S5.E26.m1.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S5.E26.m1.1.1.1.1.1.3.3.1.cmml" xref="S5.E26.m1.1.1.1.1.1.3.3">subscript</csymbol><ci id="S5.E26.m1.1.1.1.1.1.3.3.2.cmml" xref="S5.E26.m1.1.1.1.1.1.3.3.2">𝑀</ci><ci id="S5.E26.m1.1.1.1.1.1.3.3.3.cmml" xref="S5.E26.m1.1.1.1.1.1.3.3.3">𝑘</ci></apply></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E26.m1.1c">\mathcal{P}_{\text{conditional}}=\{M_{i}\xrightarrow[]{f_{r}}M_{j}\lor M_{k}\}</annotation><annotation encoding="application/x-llamapun" id="S5.E26.m1.1d">caligraphic_P start_POSTSUBSCRIPT conditional end_POSTSUBSCRIPT = { italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_ARROW start_OVERACCENT italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_OVERACCENT → end_ARROW italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∨ italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(26)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS2.p1.4">Where <math alttext="\xrightarrow[]{f_{r}}" class="ltx_Math" display="inline" id="S5.SS2.p1.1.m1.1"><semantics id="S5.SS2.p1.1.m1.1a"><mover accent="true" id="S5.SS2.p1.1.m1.1.1" xref="S5.SS2.p1.1.m1.1.1.cmml"><mo id="S5.SS2.p1.1.m1.1.1.2" stretchy="false" xref="S5.SS2.p1.1.m1.1.1.2.cmml">→</mo><msub id="S5.SS2.p1.1.m1.1.1.1" xref="S5.SS2.p1.1.m1.1.1.1.cmml"><mi id="S5.SS2.p1.1.m1.1.1.1.2" xref="S5.SS2.p1.1.m1.1.1.1.2.cmml">f</mi><mi id="S5.SS2.p1.1.m1.1.1.1.3" xref="S5.SS2.p1.1.m1.1.1.1.3.cmml">r</mi></msub></mover><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.1.m1.1b"><apply id="S5.SS2.p1.1.m1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1"><apply id="S5.SS2.p1.1.m1.1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.1.m1.1.1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1.1">subscript</csymbol><ci id="S5.SS2.p1.1.m1.1.1.1.2.cmml" xref="S5.SS2.p1.1.m1.1.1.1.2">𝑓</ci><ci id="S5.SS2.p1.1.m1.1.1.1.3.cmml" xref="S5.SS2.p1.1.m1.1.1.1.3">𝑟</ci></apply><ci id="S5.SS2.p1.1.m1.1.1.2.cmml" xref="S5.SS2.p1.1.m1.1.1.2">→</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">\xrightarrow[]{f_{r}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.1.m1.1d">start_ARROW start_OVERACCENT italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_OVERACCENT → end_ARROW</annotation></semantics></math> represents that based on routing function <math alttext="f_{r}(\cdot)" class="ltx_Math" display="inline" id="S5.SS2.p1.2.m2.1"><semantics id="S5.SS2.p1.2.m2.1a"><mrow id="S5.SS2.p1.2.m2.1.2" xref="S5.SS2.p1.2.m2.1.2.cmml"><msub id="S5.SS2.p1.2.m2.1.2.2" xref="S5.SS2.p1.2.m2.1.2.2.cmml"><mi id="S5.SS2.p1.2.m2.1.2.2.2" xref="S5.SS2.p1.2.m2.1.2.2.2.cmml">f</mi><mi id="S5.SS2.p1.2.m2.1.2.2.3" xref="S5.SS2.p1.2.m2.1.2.2.3.cmml">r</mi></msub><mo id="S5.SS2.p1.2.m2.1.2.1" xref="S5.SS2.p1.2.m2.1.2.1.cmml">⁢</mo><mrow id="S5.SS2.p1.2.m2.1.2.3.2" xref="S5.SS2.p1.2.m2.1.2.cmml"><mo id="S5.SS2.p1.2.m2.1.2.3.2.1" stretchy="false" xref="S5.SS2.p1.2.m2.1.2.cmml">(</mo><mo id="S5.SS2.p1.2.m2.1.1" lspace="0em" rspace="0em" xref="S5.SS2.p1.2.m2.1.1.cmml">⋅</mo><mo id="S5.SS2.p1.2.m2.1.2.3.2.2" stretchy="false" xref="S5.SS2.p1.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.2.m2.1b"><apply id="S5.SS2.p1.2.m2.1.2.cmml" xref="S5.SS2.p1.2.m2.1.2"><times id="S5.SS2.p1.2.m2.1.2.1.cmml" xref="S5.SS2.p1.2.m2.1.2.1"></times><apply id="S5.SS2.p1.2.m2.1.2.2.cmml" xref="S5.SS2.p1.2.m2.1.2.2"><csymbol cd="ambiguous" id="S5.SS2.p1.2.m2.1.2.2.1.cmml" xref="S5.SS2.p1.2.m2.1.2.2">subscript</csymbol><ci id="S5.SS2.p1.2.m2.1.2.2.2.cmml" xref="S5.SS2.p1.2.m2.1.2.2.2">𝑓</ci><ci id="S5.SS2.p1.2.m2.1.2.2.3.cmml" xref="S5.SS2.p1.2.m2.1.2.2.3">𝑟</ci></apply><ci id="S5.SS2.p1.2.m2.1.1.cmml" xref="S5.SS2.p1.2.m2.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.2.m2.1c">f_{r}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.2.m2.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math>, the flow can go to module <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS2.p1.3.m3.1"><semantics id="S5.SS2.p1.3.m3.1a"><msub id="S5.SS2.p1.3.m3.1.1" xref="S5.SS2.p1.3.m3.1.1.cmml"><mi id="S5.SS2.p1.3.m3.1.1.2" xref="S5.SS2.p1.3.m3.1.1.2.cmml">M</mi><mi id="S5.SS2.p1.3.m3.1.1.3" xref="S5.SS2.p1.3.m3.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.3.m3.1b"><apply id="S5.SS2.p1.3.m3.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.p1.3.m3.1.1.2.cmml" xref="S5.SS2.p1.3.m3.1.1.2">𝑀</ci><ci id="S5.SS2.p1.3.m3.1.1.3.cmml" xref="S5.SS2.p1.3.m3.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.3.m3.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.3.m3.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> or <math alttext="M_{k}" class="ltx_Math" display="inline" id="S5.SS2.p1.4.m4.1"><semantics id="S5.SS2.p1.4.m4.1a"><msub id="S5.SS2.p1.4.m4.1.1" xref="S5.SS2.p1.4.m4.1.1.cmml"><mi id="S5.SS2.p1.4.m4.1.1.2" xref="S5.SS2.p1.4.m4.1.1.2.cmml">M</mi><mi id="S5.SS2.p1.4.m4.1.1.3" xref="S5.SS2.p1.4.m4.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.4.m4.1b"><apply id="S5.SS2.p1.4.m4.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.1.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p1.4.m4.1.1.2.cmml" xref="S5.SS2.p1.4.m4.1.1.2">𝑀</ci><ci id="S5.SS2.p1.4.m4.1.1.3.cmml" xref="S5.SS2.p1.4.m4.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.4.m4.1c">M_{k}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.4.m4.1d">italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.2.1.1">Algorithm 2</span> </span> Conditional RAG Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg2.3">
<div class="ltx_listingline" id="alg2.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="q" class="ltx_Math" display="inline" id="alg2.l0.m1.1"><semantics id="alg2.l0.m1.1a"><mi id="alg2.l0.m1.1.1" xref="alg2.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg2.l0.m1.1b"><ci id="alg2.l0.m1.1.1.cmml" xref="alg2.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m1.1d">italic_q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg2.l0.m2.1"><semantics id="alg2.l0.m2.1a"><mi id="alg2.l0.m2.1.1" xref="alg2.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg2.l0.m2.1b"><ci id="alg2.l0.m2.1.1.cmml" xref="alg2.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m2.1d">italic_D</annotation></semantics></math>, language model <math alttext="LM" class="ltx_Math" display="inline" id="alg2.l0.m3.1"><semantics id="alg2.l0.m3.1a"><mrow id="alg2.l0.m3.1.1" xref="alg2.l0.m3.1.1.cmml"><mi id="alg2.l0.m3.1.1.2" xref="alg2.l0.m3.1.1.2.cmml">L</mi><mo id="alg2.l0.m3.1.1.1" xref="alg2.l0.m3.1.1.1.cmml">⁢</mo><mi id="alg2.l0.m3.1.1.3" xref="alg2.l0.m3.1.1.3.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0.m3.1b"><apply id="alg2.l0.m3.1.1.cmml" xref="alg2.l0.m3.1.1"><times id="alg2.l0.m3.1.1.1.cmml" xref="alg2.l0.m3.1.1.1"></times><ci id="alg2.l0.m3.1.1.2.cmml" xref="alg2.l0.m3.1.1.2">𝐿</ci><ci id="alg2.l0.m3.1.1.3.cmml" xref="alg2.l0.m3.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m3.1c">LM</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m3.1d">italic_L italic_M</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg2.l0.m4.1"><semantics id="alg2.l0.m4.1a"><mi id="alg2.l0.m4.1.1" xref="alg2.l0.m4.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg2.l0.m4.1b"><ci id="alg2.l0.m4.1.1.cmml" xref="alg2.l0.m4.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m4.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m4.1d">italic_R</annotation></semantics></math>, routing function <math alttext="f_{r}" class="ltx_Math" display="inline" id="alg2.l0.m5.1"><semantics id="alg2.l0.m5.1a"><msub id="alg2.l0.m5.1.1" xref="alg2.l0.m5.1.1.cmml"><mi id="alg2.l0.m5.1.1.2" xref="alg2.l0.m5.1.1.2.cmml">f</mi><mi id="alg2.l0.m5.1.1.3" xref="alg2.l0.m5.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.l0.m5.1b"><apply id="alg2.l0.m5.1.1.cmml" xref="alg2.l0.m5.1.1"><csymbol cd="ambiguous" id="alg2.l0.m5.1.1.1.cmml" xref="alg2.l0.m5.1.1">subscript</csymbol><ci id="alg2.l0.m5.1.1.2.cmml" xref="alg2.l0.m5.1.1.2">𝑓</ci><ci id="alg2.l0.m5.1.1.3.cmml" xref="alg2.l0.m5.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m5.1c">f_{r}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m5.1d">italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg2.l0a.m1.1"><semantics id="alg2.l0a.m1.1a"><mover accent="true" id="alg2.l0a.m1.1.1" xref="alg2.l0a.m1.1.1.cmml"><mi id="alg2.l0a.m1.1.1.2" xref="alg2.l0a.m1.1.1.2.cmml">y</mi><mo id="alg2.l0a.m1.1.1.1" xref="alg2.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg2.l0a.m1.1b"><apply id="alg2.l0a.m1.1.1.cmml" xref="alg2.l0a.m1.1.1"><ci id="alg2.l0a.m1.1.1.1.cmml" xref="alg2.l0a.m1.1.1.1">^</ci><ci id="alg2.l0a.m1.1.1.2.cmml" xref="alg2.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg2.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="q^{\prime}\leftarrow\text{QueryTransform}(q)" class="ltx_Math" display="inline" id="alg2.l2.m1.1"><semantics id="alg2.l2.m1.1a"><mrow id="alg2.l2.m1.1.2" xref="alg2.l2.m1.1.2.cmml"><msup id="alg2.l2.m1.1.2.2" xref="alg2.l2.m1.1.2.2.cmml"><mi id="alg2.l2.m1.1.2.2.2" xref="alg2.l2.m1.1.2.2.2.cmml">q</mi><mo id="alg2.l2.m1.1.2.2.3" xref="alg2.l2.m1.1.2.2.3.cmml">′</mo></msup><mo id="alg2.l2.m1.1.2.1" stretchy="false" xref="alg2.l2.m1.1.2.1.cmml">←</mo><mrow id="alg2.l2.m1.1.2.3" xref="alg2.l2.m1.1.2.3.cmml"><mtext id="alg2.l2.m1.1.2.3.2" xref="alg2.l2.m1.1.2.3.2a.cmml">QueryTransform</mtext><mo id="alg2.l2.m1.1.2.3.1" xref="alg2.l2.m1.1.2.3.1.cmml">⁢</mo><mrow id="alg2.l2.m1.1.2.3.3.2" xref="alg2.l2.m1.1.2.3.cmml"><mo id="alg2.l2.m1.1.2.3.3.2.1" stretchy="false" xref="alg2.l2.m1.1.2.3.cmml">(</mo><mi id="alg2.l2.m1.1.1" xref="alg2.l2.m1.1.1.cmml">q</mi><mo id="alg2.l2.m1.1.2.3.3.2.2" stretchy="false" xref="alg2.l2.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l2.m1.1b"><apply id="alg2.l2.m1.1.2.cmml" xref="alg2.l2.m1.1.2"><ci id="alg2.l2.m1.1.2.1.cmml" xref="alg2.l2.m1.1.2.1">←</ci><apply id="alg2.l2.m1.1.2.2.cmml" xref="alg2.l2.m1.1.2.2"><csymbol cd="ambiguous" id="alg2.l2.m1.1.2.2.1.cmml" xref="alg2.l2.m1.1.2.2">superscript</csymbol><ci id="alg2.l2.m1.1.2.2.2.cmml" xref="alg2.l2.m1.1.2.2.2">𝑞</ci><ci id="alg2.l2.m1.1.2.2.3.cmml" xref="alg2.l2.m1.1.2.2.3">′</ci></apply><apply id="alg2.l2.m1.1.2.3.cmml" xref="alg2.l2.m1.1.2.3"><times id="alg2.l2.m1.1.2.3.1.cmml" xref="alg2.l2.m1.1.2.3.1"></times><ci id="alg2.l2.m1.1.2.3.2a.cmml" xref="alg2.l2.m1.1.2.3.2"><mtext id="alg2.l2.m1.1.2.3.2.cmml" xref="alg2.l2.m1.1.2.3.2">QueryTransform</mtext></ci><ci id="alg2.l2.m1.1.1.cmml" xref="alg2.l2.m1.1.1">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l2.m1.1c">q^{\prime}\leftarrow\text{QueryTransform}(q)</annotation><annotation encoding="application/x-llamapun" id="alg2.l2.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← QueryTransform ( italic_q )</annotation></semantics></math> // Pre-process the initial query if needed

</div>
<div class="ltx_listingline" id="alg2.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="D^{\prime}\leftarrow R(q^{\prime},D)" class="ltx_Math" display="inline" id="alg2.l3.m1.2"><semantics id="alg2.l3.m1.2a"><mrow id="alg2.l3.m1.2.2" xref="alg2.l3.m1.2.2.cmml"><msup id="alg2.l3.m1.2.2.3" xref="alg2.l3.m1.2.2.3.cmml"><mi id="alg2.l3.m1.2.2.3.2" xref="alg2.l3.m1.2.2.3.2.cmml">D</mi><mo id="alg2.l3.m1.2.2.3.3" xref="alg2.l3.m1.2.2.3.3.cmml">′</mo></msup><mo id="alg2.l3.m1.2.2.2" stretchy="false" xref="alg2.l3.m1.2.2.2.cmml">←</mo><mrow id="alg2.l3.m1.2.2.1" xref="alg2.l3.m1.2.2.1.cmml"><mi id="alg2.l3.m1.2.2.1.3" xref="alg2.l3.m1.2.2.1.3.cmml">R</mi><mo id="alg2.l3.m1.2.2.1.2" xref="alg2.l3.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg2.l3.m1.2.2.1.1.1" xref="alg2.l3.m1.2.2.1.1.2.cmml"><mo id="alg2.l3.m1.2.2.1.1.1.2" stretchy="false" xref="alg2.l3.m1.2.2.1.1.2.cmml">(</mo><msup id="alg2.l3.m1.2.2.1.1.1.1" xref="alg2.l3.m1.2.2.1.1.1.1.cmml"><mi id="alg2.l3.m1.2.2.1.1.1.1.2" xref="alg2.l3.m1.2.2.1.1.1.1.2.cmml">q</mi><mo id="alg2.l3.m1.2.2.1.1.1.1.3" xref="alg2.l3.m1.2.2.1.1.1.1.3.cmml">′</mo></msup><mo id="alg2.l3.m1.2.2.1.1.1.3" xref="alg2.l3.m1.2.2.1.1.2.cmml">,</mo><mi id="alg2.l3.m1.1.1" xref="alg2.l3.m1.1.1.cmml">D</mi><mo id="alg2.l3.m1.2.2.1.1.1.4" stretchy="false" xref="alg2.l3.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l3.m1.2b"><apply id="alg2.l3.m1.2.2.cmml" xref="alg2.l3.m1.2.2"><ci id="alg2.l3.m1.2.2.2.cmml" xref="alg2.l3.m1.2.2.2">←</ci><apply id="alg2.l3.m1.2.2.3.cmml" xref="alg2.l3.m1.2.2.3"><csymbol cd="ambiguous" id="alg2.l3.m1.2.2.3.1.cmml" xref="alg2.l3.m1.2.2.3">superscript</csymbol><ci id="alg2.l3.m1.2.2.3.2.cmml" xref="alg2.l3.m1.2.2.3.2">𝐷</ci><ci id="alg2.l3.m1.2.2.3.3.cmml" xref="alg2.l3.m1.2.2.3.3">′</ci></apply><apply id="alg2.l3.m1.2.2.1.cmml" xref="alg2.l3.m1.2.2.1"><times id="alg2.l3.m1.2.2.1.2.cmml" xref="alg2.l3.m1.2.2.1.2"></times><ci id="alg2.l3.m1.2.2.1.3.cmml" xref="alg2.l3.m1.2.2.1.3">𝑅</ci><interval closure="open" id="alg2.l3.m1.2.2.1.1.2.cmml" xref="alg2.l3.m1.2.2.1.1.1"><apply id="alg2.l3.m1.2.2.1.1.1.1.cmml" xref="alg2.l3.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l3.m1.2.2.1.1.1.1.1.cmml" xref="alg2.l3.m1.2.2.1.1.1.1">superscript</csymbol><ci id="alg2.l3.m1.2.2.1.1.1.1.2.cmml" xref="alg2.l3.m1.2.2.1.1.1.1.2">𝑞</ci><ci id="alg2.l3.m1.2.2.1.1.1.1.3.cmml" xref="alg2.l3.m1.2.2.1.1.1.1.3">′</ci></apply><ci id="alg2.l3.m1.1.1.cmml" xref="alg2.l3.m1.1.1">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3.m1.2c">D^{\prime}\leftarrow R(q^{\prime},D)</annotation><annotation encoding="application/x-llamapun" id="alg2.l3.m1.2d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_R ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D )</annotation></semantics></math> // Retrieve or update documents related to the query

</div>
<div class="ltx_listingline" id="alg2.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l4.1.1.1" style="font-size:80%;">4:</span></span>  <math alttext="M_{\text{next}}\leftarrow f_{r}(q^{\prime},D^{\prime})" class="ltx_Math" display="inline" id="alg2.l4.m1.2"><semantics id="alg2.l4.m1.2a"><mrow id="alg2.l4.m1.2.2" xref="alg2.l4.m1.2.2.cmml"><msub id="alg2.l4.m1.2.2.4" xref="alg2.l4.m1.2.2.4.cmml"><mi id="alg2.l4.m1.2.2.4.2" xref="alg2.l4.m1.2.2.4.2.cmml">M</mi><mtext id="alg2.l4.m1.2.2.4.3" xref="alg2.l4.m1.2.2.4.3a.cmml">next</mtext></msub><mo id="alg2.l4.m1.2.2.3" stretchy="false" xref="alg2.l4.m1.2.2.3.cmml">←</mo><mrow id="alg2.l4.m1.2.2.2" xref="alg2.l4.m1.2.2.2.cmml"><msub id="alg2.l4.m1.2.2.2.4" xref="alg2.l4.m1.2.2.2.4.cmml"><mi id="alg2.l4.m1.2.2.2.4.2" xref="alg2.l4.m1.2.2.2.4.2.cmml">f</mi><mi id="alg2.l4.m1.2.2.2.4.3" xref="alg2.l4.m1.2.2.2.4.3.cmml">r</mi></msub><mo id="alg2.l4.m1.2.2.2.3" xref="alg2.l4.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg2.l4.m1.2.2.2.2.2" xref="alg2.l4.m1.2.2.2.2.3.cmml"><mo id="alg2.l4.m1.2.2.2.2.2.3" stretchy="false" xref="alg2.l4.m1.2.2.2.2.3.cmml">(</mo><msup id="alg2.l4.m1.1.1.1.1.1.1" xref="alg2.l4.m1.1.1.1.1.1.1.cmml"><mi id="alg2.l4.m1.1.1.1.1.1.1.2" xref="alg2.l4.m1.1.1.1.1.1.1.2.cmml">q</mi><mo id="alg2.l4.m1.1.1.1.1.1.1.3" xref="alg2.l4.m1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg2.l4.m1.2.2.2.2.2.4" xref="alg2.l4.m1.2.2.2.2.3.cmml">,</mo><msup id="alg2.l4.m1.2.2.2.2.2.2" xref="alg2.l4.m1.2.2.2.2.2.2.cmml"><mi id="alg2.l4.m1.2.2.2.2.2.2.2" xref="alg2.l4.m1.2.2.2.2.2.2.2.cmml">D</mi><mo id="alg2.l4.m1.2.2.2.2.2.2.3" xref="alg2.l4.m1.2.2.2.2.2.2.3.cmml">′</mo></msup><mo id="alg2.l4.m1.2.2.2.2.2.5" stretchy="false" xref="alg2.l4.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l4.m1.2b"><apply id="alg2.l4.m1.2.2.cmml" xref="alg2.l4.m1.2.2"><ci id="alg2.l4.m1.2.2.3.cmml" xref="alg2.l4.m1.2.2.3">←</ci><apply id="alg2.l4.m1.2.2.4.cmml" xref="alg2.l4.m1.2.2.4"><csymbol cd="ambiguous" id="alg2.l4.m1.2.2.4.1.cmml" xref="alg2.l4.m1.2.2.4">subscript</csymbol><ci id="alg2.l4.m1.2.2.4.2.cmml" xref="alg2.l4.m1.2.2.4.2">𝑀</ci><ci id="alg2.l4.m1.2.2.4.3a.cmml" xref="alg2.l4.m1.2.2.4.3"><mtext id="alg2.l4.m1.2.2.4.3.cmml" mathsize="70%" xref="alg2.l4.m1.2.2.4.3">next</mtext></ci></apply><apply id="alg2.l4.m1.2.2.2.cmml" xref="alg2.l4.m1.2.2.2"><times id="alg2.l4.m1.2.2.2.3.cmml" xref="alg2.l4.m1.2.2.2.3"></times><apply id="alg2.l4.m1.2.2.2.4.cmml" xref="alg2.l4.m1.2.2.2.4"><csymbol cd="ambiguous" id="alg2.l4.m1.2.2.2.4.1.cmml" xref="alg2.l4.m1.2.2.2.4">subscript</csymbol><ci id="alg2.l4.m1.2.2.2.4.2.cmml" xref="alg2.l4.m1.2.2.2.4.2">𝑓</ci><ci id="alg2.l4.m1.2.2.2.4.3.cmml" xref="alg2.l4.m1.2.2.2.4.3">𝑟</ci></apply><interval closure="open" id="alg2.l4.m1.2.2.2.2.3.cmml" xref="alg2.l4.m1.2.2.2.2.2"><apply id="alg2.l4.m1.1.1.1.1.1.1.cmml" xref="alg2.l4.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l4.m1.1.1.1.1.1.1.1.cmml" xref="alg2.l4.m1.1.1.1.1.1.1">superscript</csymbol><ci id="alg2.l4.m1.1.1.1.1.1.1.2.cmml" xref="alg2.l4.m1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg2.l4.m1.1.1.1.1.1.1.3.cmml" xref="alg2.l4.m1.1.1.1.1.1.1.3">′</ci></apply><apply id="alg2.l4.m1.2.2.2.2.2.2.cmml" xref="alg2.l4.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg2.l4.m1.2.2.2.2.2.2.1.cmml" xref="alg2.l4.m1.2.2.2.2.2.2">superscript</csymbol><ci id="alg2.l4.m1.2.2.2.2.2.2.2.cmml" xref="alg2.l4.m1.2.2.2.2.2.2.2">𝐷</ci><ci id="alg2.l4.m1.2.2.2.2.2.2.3.cmml" xref="alg2.l4.m1.2.2.2.2.2.2.3">′</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m1.2c">M_{\text{next}}\leftarrow f_{r}(q^{\prime},D^{\prime})</annotation><annotation encoding="application/x-llamapun" id="alg2.l4.m1.2d">italic_M start_POSTSUBSCRIPT next end_POSTSUBSCRIPT ← italic_f start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT )</annotation></semantics></math> // Determine the next module using the routing function

</div>
<div class="ltx_listingline" id="alg2.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l5.1.1.1" style="font-size:80%;">5:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l5.2">if</span> <math alttext="M_{\text{next}}=M_{j}" class="ltx_Math" display="inline" id="alg2.l5.m1.1"><semantics id="alg2.l5.m1.1a"><mrow id="alg2.l5.m1.1.1" xref="alg2.l5.m1.1.1.cmml"><msub id="alg2.l5.m1.1.1.2" xref="alg2.l5.m1.1.1.2.cmml"><mi id="alg2.l5.m1.1.1.2.2" xref="alg2.l5.m1.1.1.2.2.cmml">M</mi><mtext id="alg2.l5.m1.1.1.2.3" xref="alg2.l5.m1.1.1.2.3a.cmml">next</mtext></msub><mo id="alg2.l5.m1.1.1.1" xref="alg2.l5.m1.1.1.1.cmml">=</mo><msub id="alg2.l5.m1.1.1.3" xref="alg2.l5.m1.1.1.3.cmml"><mi id="alg2.l5.m1.1.1.3.2" xref="alg2.l5.m1.1.1.3.2.cmml">M</mi><mi id="alg2.l5.m1.1.1.3.3" xref="alg2.l5.m1.1.1.3.3.cmml">j</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m1.1b"><apply id="alg2.l5.m1.1.1.cmml" xref="alg2.l5.m1.1.1"><eq id="alg2.l5.m1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1"></eq><apply id="alg2.l5.m1.1.1.2.cmml" xref="alg2.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l5.m1.1.1.2.1.cmml" xref="alg2.l5.m1.1.1.2">subscript</csymbol><ci id="alg2.l5.m1.1.1.2.2.cmml" xref="alg2.l5.m1.1.1.2.2">𝑀</ci><ci id="alg2.l5.m1.1.1.2.3a.cmml" xref="alg2.l5.m1.1.1.2.3"><mtext id="alg2.l5.m1.1.1.2.3.cmml" mathsize="70%" xref="alg2.l5.m1.1.1.2.3">next</mtext></ci></apply><apply id="alg2.l5.m1.1.1.3.cmml" xref="alg2.l5.m1.1.1.3"><csymbol cd="ambiguous" id="alg2.l5.m1.1.1.3.1.cmml" xref="alg2.l5.m1.1.1.3">subscript</csymbol><ci id="alg2.l5.m1.1.1.3.2.cmml" xref="alg2.l5.m1.1.1.3.2">𝑀</ci><ci id="alg2.l5.m1.1.1.3.3.cmml" xref="alg2.l5.m1.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m1.1c">M_{\text{next}}=M_{j}</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m1.1d">italic_M start_POSTSUBSCRIPT next end_POSTSUBSCRIPT = italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l5.3">then</span>
</div>
<div class="ltx_listingline" id="alg2.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l6.1.1.1" style="font-size:80%;">6:</span></span>     <math alttext="\hat{y}\leftarrow M_{j}(q^{\prime},D^{\prime})" class="ltx_Math" display="inline" id="alg2.l6.m1.2"><semantics id="alg2.l6.m1.2a"><mrow id="alg2.l6.m1.2.2" xref="alg2.l6.m1.2.2.cmml"><mover accent="true" id="alg2.l6.m1.2.2.4" xref="alg2.l6.m1.2.2.4.cmml"><mi id="alg2.l6.m1.2.2.4.2" xref="alg2.l6.m1.2.2.4.2.cmml">y</mi><mo id="alg2.l6.m1.2.2.4.1" xref="alg2.l6.m1.2.2.4.1.cmml">^</mo></mover><mo id="alg2.l6.m1.2.2.3" stretchy="false" xref="alg2.l6.m1.2.2.3.cmml">←</mo><mrow id="alg2.l6.m1.2.2.2" xref="alg2.l6.m1.2.2.2.cmml"><msub id="alg2.l6.m1.2.2.2.4" xref="alg2.l6.m1.2.2.2.4.cmml"><mi id="alg2.l6.m1.2.2.2.4.2" xref="alg2.l6.m1.2.2.2.4.2.cmml">M</mi><mi id="alg2.l6.m1.2.2.2.4.3" xref="alg2.l6.m1.2.2.2.4.3.cmml">j</mi></msub><mo id="alg2.l6.m1.2.2.2.3" xref="alg2.l6.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg2.l6.m1.2.2.2.2.2" xref="alg2.l6.m1.2.2.2.2.3.cmml"><mo id="alg2.l6.m1.2.2.2.2.2.3" stretchy="false" xref="alg2.l6.m1.2.2.2.2.3.cmml">(</mo><msup id="alg2.l6.m1.1.1.1.1.1.1" xref="alg2.l6.m1.1.1.1.1.1.1.cmml"><mi id="alg2.l6.m1.1.1.1.1.1.1.2" xref="alg2.l6.m1.1.1.1.1.1.1.2.cmml">q</mi><mo id="alg2.l6.m1.1.1.1.1.1.1.3" xref="alg2.l6.m1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg2.l6.m1.2.2.2.2.2.4" xref="alg2.l6.m1.2.2.2.2.3.cmml">,</mo><msup id="alg2.l6.m1.2.2.2.2.2.2" xref="alg2.l6.m1.2.2.2.2.2.2.cmml"><mi id="alg2.l6.m1.2.2.2.2.2.2.2" xref="alg2.l6.m1.2.2.2.2.2.2.2.cmml">D</mi><mo id="alg2.l6.m1.2.2.2.2.2.2.3" xref="alg2.l6.m1.2.2.2.2.2.2.3.cmml">′</mo></msup><mo id="alg2.l6.m1.2.2.2.2.2.5" stretchy="false" xref="alg2.l6.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l6.m1.2b"><apply id="alg2.l6.m1.2.2.cmml" xref="alg2.l6.m1.2.2"><ci id="alg2.l6.m1.2.2.3.cmml" xref="alg2.l6.m1.2.2.3">←</ci><apply id="alg2.l6.m1.2.2.4.cmml" xref="alg2.l6.m1.2.2.4"><ci id="alg2.l6.m1.2.2.4.1.cmml" xref="alg2.l6.m1.2.2.4.1">^</ci><ci id="alg2.l6.m1.2.2.4.2.cmml" xref="alg2.l6.m1.2.2.4.2">𝑦</ci></apply><apply id="alg2.l6.m1.2.2.2.cmml" xref="alg2.l6.m1.2.2.2"><times id="alg2.l6.m1.2.2.2.3.cmml" xref="alg2.l6.m1.2.2.2.3"></times><apply id="alg2.l6.m1.2.2.2.4.cmml" xref="alg2.l6.m1.2.2.2.4"><csymbol cd="ambiguous" id="alg2.l6.m1.2.2.2.4.1.cmml" xref="alg2.l6.m1.2.2.2.4">subscript</csymbol><ci id="alg2.l6.m1.2.2.2.4.2.cmml" xref="alg2.l6.m1.2.2.2.4.2">𝑀</ci><ci id="alg2.l6.m1.2.2.2.4.3.cmml" xref="alg2.l6.m1.2.2.2.4.3">𝑗</ci></apply><interval closure="open" id="alg2.l6.m1.2.2.2.2.3.cmml" xref="alg2.l6.m1.2.2.2.2.2"><apply id="alg2.l6.m1.1.1.1.1.1.1.cmml" xref="alg2.l6.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l6.m1.1.1.1.1.1.1.1.cmml" xref="alg2.l6.m1.1.1.1.1.1.1">superscript</csymbol><ci id="alg2.l6.m1.1.1.1.1.1.1.2.cmml" xref="alg2.l6.m1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg2.l6.m1.1.1.1.1.1.1.3.cmml" xref="alg2.l6.m1.1.1.1.1.1.1.3">′</ci></apply><apply id="alg2.l6.m1.2.2.2.2.2.2.cmml" xref="alg2.l6.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg2.l6.m1.2.2.2.2.2.2.1.cmml" xref="alg2.l6.m1.2.2.2.2.2.2">superscript</csymbol><ci id="alg2.l6.m1.2.2.2.2.2.2.2.cmml" xref="alg2.l6.m1.2.2.2.2.2.2.2">𝐷</ci><ci id="alg2.l6.m1.2.2.2.2.2.2.3.cmml" xref="alg2.l6.m1.2.2.2.2.2.2.3">′</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.m1.2c">\hat{y}\leftarrow M_{j}(q^{\prime},D^{\prime})</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.m1.2d">over^ start_ARG italic_y end_ARG ← italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT )</annotation></semantics></math> // Execute module <math alttext="M_{j}" class="ltx_Math" display="inline" id="alg2.l6.m2.1"><semantics id="alg2.l6.m2.1a"><msub id="alg2.l6.m2.1.1" xref="alg2.l6.m2.1.1.cmml"><mi id="alg2.l6.m2.1.1.2" xref="alg2.l6.m2.1.1.2.cmml">M</mi><mi id="alg2.l6.m2.1.1.3" xref="alg2.l6.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.l6.m2.1b"><apply id="alg2.l6.m2.1.1.cmml" xref="alg2.l6.m2.1.1"><csymbol cd="ambiguous" id="alg2.l6.m2.1.1.1.cmml" xref="alg2.l6.m2.1.1">subscript</csymbol><ci id="alg2.l6.m2.1.1.2.cmml" xref="alg2.l6.m2.1.1.2">𝑀</ci><ci id="alg2.l6.m2.1.1.3.cmml" xref="alg2.l6.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.m2.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.m2.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l7.1.1.1" style="font-size:80%;">7:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l7.2">else</span> <span class="ltx_text ltx_font_bold" id="alg2.l7.3">if</span> <math alttext="M_{\text{next}}=M_{k}" class="ltx_Math" display="inline" id="alg2.l7.m1.1"><semantics id="alg2.l7.m1.1a"><mrow id="alg2.l7.m1.1.1" xref="alg2.l7.m1.1.1.cmml"><msub id="alg2.l7.m1.1.1.2" xref="alg2.l7.m1.1.1.2.cmml"><mi id="alg2.l7.m1.1.1.2.2" xref="alg2.l7.m1.1.1.2.2.cmml">M</mi><mtext id="alg2.l7.m1.1.1.2.3" xref="alg2.l7.m1.1.1.2.3a.cmml">next</mtext></msub><mo id="alg2.l7.m1.1.1.1" xref="alg2.l7.m1.1.1.1.cmml">=</mo><msub id="alg2.l7.m1.1.1.3" xref="alg2.l7.m1.1.1.3.cmml"><mi id="alg2.l7.m1.1.1.3.2" xref="alg2.l7.m1.1.1.3.2.cmml">M</mi><mi id="alg2.l7.m1.1.1.3.3" xref="alg2.l7.m1.1.1.3.3.cmml">k</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m1.1b"><apply id="alg2.l7.m1.1.1.cmml" xref="alg2.l7.m1.1.1"><eq id="alg2.l7.m1.1.1.1.cmml" xref="alg2.l7.m1.1.1.1"></eq><apply id="alg2.l7.m1.1.1.2.cmml" xref="alg2.l7.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l7.m1.1.1.2.1.cmml" xref="alg2.l7.m1.1.1.2">subscript</csymbol><ci id="alg2.l7.m1.1.1.2.2.cmml" xref="alg2.l7.m1.1.1.2.2">𝑀</ci><ci id="alg2.l7.m1.1.1.2.3a.cmml" xref="alg2.l7.m1.1.1.2.3"><mtext id="alg2.l7.m1.1.1.2.3.cmml" mathsize="70%" xref="alg2.l7.m1.1.1.2.3">next</mtext></ci></apply><apply id="alg2.l7.m1.1.1.3.cmml" xref="alg2.l7.m1.1.1.3"><csymbol cd="ambiguous" id="alg2.l7.m1.1.1.3.1.cmml" xref="alg2.l7.m1.1.1.3">subscript</csymbol><ci id="alg2.l7.m1.1.1.3.2.cmml" xref="alg2.l7.m1.1.1.3.2">𝑀</ci><ci id="alg2.l7.m1.1.1.3.3.cmml" xref="alg2.l7.m1.1.1.3.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m1.1c">M_{\text{next}}=M_{k}</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m1.1d">italic_M start_POSTSUBSCRIPT next end_POSTSUBSCRIPT = italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l7.4">then</span>
</div>
<div class="ltx_listingline" id="alg2.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l8.1.1.1" style="font-size:80%;">8:</span></span>     <math alttext="\hat{y}\leftarrow M_{k}(q^{\prime},D^{\prime})" class="ltx_Math" display="inline" id="alg2.l8.m1.2"><semantics id="alg2.l8.m1.2a"><mrow id="alg2.l8.m1.2.2" xref="alg2.l8.m1.2.2.cmml"><mover accent="true" id="alg2.l8.m1.2.2.4" xref="alg2.l8.m1.2.2.4.cmml"><mi id="alg2.l8.m1.2.2.4.2" xref="alg2.l8.m1.2.2.4.2.cmml">y</mi><mo id="alg2.l8.m1.2.2.4.1" xref="alg2.l8.m1.2.2.4.1.cmml">^</mo></mover><mo id="alg2.l8.m1.2.2.3" stretchy="false" xref="alg2.l8.m1.2.2.3.cmml">←</mo><mrow id="alg2.l8.m1.2.2.2" xref="alg2.l8.m1.2.2.2.cmml"><msub id="alg2.l8.m1.2.2.2.4" xref="alg2.l8.m1.2.2.2.4.cmml"><mi id="alg2.l8.m1.2.2.2.4.2" xref="alg2.l8.m1.2.2.2.4.2.cmml">M</mi><mi id="alg2.l8.m1.2.2.2.4.3" xref="alg2.l8.m1.2.2.2.4.3.cmml">k</mi></msub><mo id="alg2.l8.m1.2.2.2.3" xref="alg2.l8.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg2.l8.m1.2.2.2.2.2" xref="alg2.l8.m1.2.2.2.2.3.cmml"><mo id="alg2.l8.m1.2.2.2.2.2.3" stretchy="false" xref="alg2.l8.m1.2.2.2.2.3.cmml">(</mo><msup id="alg2.l8.m1.1.1.1.1.1.1" xref="alg2.l8.m1.1.1.1.1.1.1.cmml"><mi id="alg2.l8.m1.1.1.1.1.1.1.2" xref="alg2.l8.m1.1.1.1.1.1.1.2.cmml">q</mi><mo id="alg2.l8.m1.1.1.1.1.1.1.3" xref="alg2.l8.m1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg2.l8.m1.2.2.2.2.2.4" xref="alg2.l8.m1.2.2.2.2.3.cmml">,</mo><msup id="alg2.l8.m1.2.2.2.2.2.2" xref="alg2.l8.m1.2.2.2.2.2.2.cmml"><mi id="alg2.l8.m1.2.2.2.2.2.2.2" xref="alg2.l8.m1.2.2.2.2.2.2.2.cmml">D</mi><mo id="alg2.l8.m1.2.2.2.2.2.2.3" xref="alg2.l8.m1.2.2.2.2.2.2.3.cmml">′</mo></msup><mo id="alg2.l8.m1.2.2.2.2.2.5" stretchy="false" xref="alg2.l8.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l8.m1.2b"><apply id="alg2.l8.m1.2.2.cmml" xref="alg2.l8.m1.2.2"><ci id="alg2.l8.m1.2.2.3.cmml" xref="alg2.l8.m1.2.2.3">←</ci><apply id="alg2.l8.m1.2.2.4.cmml" xref="alg2.l8.m1.2.2.4"><ci id="alg2.l8.m1.2.2.4.1.cmml" xref="alg2.l8.m1.2.2.4.1">^</ci><ci id="alg2.l8.m1.2.2.4.2.cmml" xref="alg2.l8.m1.2.2.4.2">𝑦</ci></apply><apply id="alg2.l8.m1.2.2.2.cmml" xref="alg2.l8.m1.2.2.2"><times id="alg2.l8.m1.2.2.2.3.cmml" xref="alg2.l8.m1.2.2.2.3"></times><apply id="alg2.l8.m1.2.2.2.4.cmml" xref="alg2.l8.m1.2.2.2.4"><csymbol cd="ambiguous" id="alg2.l8.m1.2.2.2.4.1.cmml" xref="alg2.l8.m1.2.2.2.4">subscript</csymbol><ci id="alg2.l8.m1.2.2.2.4.2.cmml" xref="alg2.l8.m1.2.2.2.4.2">𝑀</ci><ci id="alg2.l8.m1.2.2.2.4.3.cmml" xref="alg2.l8.m1.2.2.2.4.3">𝑘</ci></apply><interval closure="open" id="alg2.l8.m1.2.2.2.2.3.cmml" xref="alg2.l8.m1.2.2.2.2.2"><apply id="alg2.l8.m1.1.1.1.1.1.1.cmml" xref="alg2.l8.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l8.m1.1.1.1.1.1.1.1.cmml" xref="alg2.l8.m1.1.1.1.1.1.1">superscript</csymbol><ci id="alg2.l8.m1.1.1.1.1.1.1.2.cmml" xref="alg2.l8.m1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg2.l8.m1.1.1.1.1.1.1.3.cmml" xref="alg2.l8.m1.1.1.1.1.1.1.3">′</ci></apply><apply id="alg2.l8.m1.2.2.2.2.2.2.cmml" xref="alg2.l8.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg2.l8.m1.2.2.2.2.2.2.1.cmml" xref="alg2.l8.m1.2.2.2.2.2.2">superscript</csymbol><ci id="alg2.l8.m1.2.2.2.2.2.2.2.cmml" xref="alg2.l8.m1.2.2.2.2.2.2.2">𝐷</ci><ci id="alg2.l8.m1.2.2.2.2.2.2.3.cmml" xref="alg2.l8.m1.2.2.2.2.2.2.3">′</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l8.m1.2c">\hat{y}\leftarrow M_{k}(q^{\prime},D^{\prime})</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m1.2d">over^ start_ARG italic_y end_ARG ← italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT )</annotation></semantics></math> <math alttext="M_{k}" class="ltx_Math" display="inline" id="alg2.l8.m2.1"><semantics id="alg2.l8.m2.1a"><msub id="alg2.l8.m2.1.1" xref="alg2.l8.m2.1.1.cmml"><mi id="alg2.l8.m2.1.1.2" xref="alg2.l8.m2.1.1.2.cmml">M</mi><mi id="alg2.l8.m2.1.1.3" xref="alg2.l8.m2.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.l8.m2.1b"><apply id="alg2.l8.m2.1.1.cmml" xref="alg2.l8.m2.1.1"><csymbol cd="ambiguous" id="alg2.l8.m2.1.1.1.cmml" xref="alg2.l8.m2.1.1">subscript</csymbol><ci id="alg2.l8.m2.1.1.2.cmml" xref="alg2.l8.m2.1.1.2">𝑀</ci><ci id="alg2.l8.m2.1.1.3.cmml" xref="alg2.l8.m2.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l8.m2.1c">M_{k}</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m2.1d">italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l9.1.1.1" style="font-size:80%;">9:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l9.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l9.3">if</span>
</div>
<div class="ltx_listingline" id="alg2.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l10.1.1.1" style="font-size:80%;">10:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l10.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg2.l10.m1.1"><semantics id="alg2.l10.m1.1a"><mover accent="true" id="alg2.l10.m1.1.1" xref="alg2.l10.m1.1.1.cmml"><mi id="alg2.l10.m1.1.1.2" xref="alg2.l10.m1.1.1.2.cmml">y</mi><mo id="alg2.l10.m1.1.1.1" xref="alg2.l10.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg2.l10.m1.1b"><apply id="alg2.l10.m1.1.1.cmml" xref="alg2.l10.m1.1.1"><ci id="alg2.l10.m1.1.1.1.cmml" xref="alg2.l10.m1.1.1.1">^</ci><ci id="alg2.l10.m1.1.1.2.cmml" xref="alg2.l10.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l10.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg2.l10.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<figure class="ltx_figure" id="S5.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="232" id="S5.F6.g1" src="extracted/5756188/images/conditional.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6: </span>The conditional flow pattern. There is a routing module that controls which RAG flow the query is directed to. Typically, different flows are used for various configurations to meet the general requirements of the RAG system.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS2.p2">
<p class="ltx_p" id="S5.SS2.p2.1">Pipeline selection is determined by the nature of the question, directing different flows tailored to specific scenarios. For example, the tolerance for responses generated by LLMs varies across questions related to serious issues, political matters, or entertainment topics. These routing flow often diverge in terms of retrieval sources, retrieval processes, configurations, models, and prompts.</p>
</div>
<figure class="ltx_figure" id="S5.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="189" id="S5.F7.g1" src="extracted/5756188/images/pre_banch.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7: </span>Pre-retrieval branching flow pattern.Each branch performs retrieval and generation separately, and then they are aggregated at the end.</figcaption>
</figure>
<figure class="ltx_figure" id="S5.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="188" id="S5.F8.g1" src="extracted/5756188/images/post_branch.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 8: </span>Post-retrieval branching flow pattern.Only one retrieval performed, and then generation is carried out separately for each retrieved document chunks, followed by aggregation.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S5.SS3.5.1.1">V-C</span> </span><span class="ltx_text ltx_font_italic" id="S5.SS3.6.2">Branching</span>
</h3>
<div class="ltx_para" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.7">In many cases, the RAG flow system may have multiple parallel running branches , usually to increase the diversity of generated results. Assuming multiple branches <math alttext="b_{i}" class="ltx_Math" display="inline" id="S5.SS3.p1.1.m1.1"><semantics id="S5.SS3.p1.1.m1.1a"><msub id="S5.SS3.p1.1.m1.1.1" xref="S5.SS3.p1.1.m1.1.1.cmml"><mi id="S5.SS3.p1.1.m1.1.1.2" xref="S5.SS3.p1.1.m1.1.1.2.cmml">b</mi><mi id="S5.SS3.p1.1.m1.1.1.3" xref="S5.SS3.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.1.m1.1b"><apply id="S5.SS3.p1.1.m1.1.1.cmml" xref="S5.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p1.1.m1.1.1.1.cmml" xref="S5.SS3.p1.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.p1.1.m1.1.1.2.cmml" xref="S5.SS3.p1.1.m1.1.1.2">𝑏</ci><ci id="S5.SS3.p1.1.m1.1.1.3.cmml" xref="S5.SS3.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.1.m1.1c">b_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.1.m1.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> are generated in module <math alttext="B=M_{\text{split}}(\cdot)=\{b_{1},b_{2},\ldots,b_{m}\}" class="ltx_Math" display="inline" id="S5.SS3.p1.2.m2.5"><semantics id="S5.SS3.p1.2.m2.5a"><mrow id="S5.SS3.p1.2.m2.5.5" xref="S5.SS3.p1.2.m2.5.5.cmml"><mi id="S5.SS3.p1.2.m2.5.5.5" xref="S5.SS3.p1.2.m2.5.5.5.cmml">B</mi><mo id="S5.SS3.p1.2.m2.5.5.6" xref="S5.SS3.p1.2.m2.5.5.6.cmml">=</mo><mrow id="S5.SS3.p1.2.m2.5.5.7" xref="S5.SS3.p1.2.m2.5.5.7.cmml"><msub id="S5.SS3.p1.2.m2.5.5.7.2" xref="S5.SS3.p1.2.m2.5.5.7.2.cmml"><mi id="S5.SS3.p1.2.m2.5.5.7.2.2" xref="S5.SS3.p1.2.m2.5.5.7.2.2.cmml">M</mi><mtext id="S5.SS3.p1.2.m2.5.5.7.2.3" xref="S5.SS3.p1.2.m2.5.5.7.2.3a.cmml">split</mtext></msub><mo id="S5.SS3.p1.2.m2.5.5.7.1" xref="S5.SS3.p1.2.m2.5.5.7.1.cmml">⁢</mo><mrow id="S5.SS3.p1.2.m2.5.5.7.3.2" xref="S5.SS3.p1.2.m2.5.5.7.cmml"><mo id="S5.SS3.p1.2.m2.5.5.7.3.2.1" stretchy="false" xref="S5.SS3.p1.2.m2.5.5.7.cmml">(</mo><mo id="S5.SS3.p1.2.m2.1.1" lspace="0em" rspace="0em" xref="S5.SS3.p1.2.m2.1.1.cmml">⋅</mo><mo id="S5.SS3.p1.2.m2.5.5.7.3.2.2" stretchy="false" xref="S5.SS3.p1.2.m2.5.5.7.cmml">)</mo></mrow></mrow><mo id="S5.SS3.p1.2.m2.5.5.8" xref="S5.SS3.p1.2.m2.5.5.8.cmml">=</mo><mrow id="S5.SS3.p1.2.m2.5.5.3.3" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml"><mo id="S5.SS3.p1.2.m2.5.5.3.3.4" stretchy="false" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml">{</mo><msub id="S5.SS3.p1.2.m2.3.3.1.1.1" xref="S5.SS3.p1.2.m2.3.3.1.1.1.cmml"><mi id="S5.SS3.p1.2.m2.3.3.1.1.1.2" xref="S5.SS3.p1.2.m2.3.3.1.1.1.2.cmml">b</mi><mn id="S5.SS3.p1.2.m2.3.3.1.1.1.3" xref="S5.SS3.p1.2.m2.3.3.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p1.2.m2.5.5.3.3.5" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml">,</mo><msub id="S5.SS3.p1.2.m2.4.4.2.2.2" xref="S5.SS3.p1.2.m2.4.4.2.2.2.cmml"><mi id="S5.SS3.p1.2.m2.4.4.2.2.2.2" xref="S5.SS3.p1.2.m2.4.4.2.2.2.2.cmml">b</mi><mn id="S5.SS3.p1.2.m2.4.4.2.2.2.3" xref="S5.SS3.p1.2.m2.4.4.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p1.2.m2.5.5.3.3.6" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml">,</mo><mi id="S5.SS3.p1.2.m2.2.2" mathvariant="normal" xref="S5.SS3.p1.2.m2.2.2.cmml">…</mi><mo id="S5.SS3.p1.2.m2.5.5.3.3.7" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml">,</mo><msub id="S5.SS3.p1.2.m2.5.5.3.3.3" xref="S5.SS3.p1.2.m2.5.5.3.3.3.cmml"><mi id="S5.SS3.p1.2.m2.5.5.3.3.3.2" xref="S5.SS3.p1.2.m2.5.5.3.3.3.2.cmml">b</mi><mi id="S5.SS3.p1.2.m2.5.5.3.3.3.3" xref="S5.SS3.p1.2.m2.5.5.3.3.3.3.cmml">m</mi></msub><mo id="S5.SS3.p1.2.m2.5.5.3.3.8" stretchy="false" xref="S5.SS3.p1.2.m2.5.5.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.2.m2.5b"><apply id="S5.SS3.p1.2.m2.5.5.cmml" xref="S5.SS3.p1.2.m2.5.5"><and id="S5.SS3.p1.2.m2.5.5a.cmml" xref="S5.SS3.p1.2.m2.5.5"></and><apply id="S5.SS3.p1.2.m2.5.5b.cmml" xref="S5.SS3.p1.2.m2.5.5"><eq id="S5.SS3.p1.2.m2.5.5.6.cmml" xref="S5.SS3.p1.2.m2.5.5.6"></eq><ci id="S5.SS3.p1.2.m2.5.5.5.cmml" xref="S5.SS3.p1.2.m2.5.5.5">𝐵</ci><apply id="S5.SS3.p1.2.m2.5.5.7.cmml" xref="S5.SS3.p1.2.m2.5.5.7"><times id="S5.SS3.p1.2.m2.5.5.7.1.cmml" xref="S5.SS3.p1.2.m2.5.5.7.1"></times><apply id="S5.SS3.p1.2.m2.5.5.7.2.cmml" xref="S5.SS3.p1.2.m2.5.5.7.2"><csymbol cd="ambiguous" id="S5.SS3.p1.2.m2.5.5.7.2.1.cmml" xref="S5.SS3.p1.2.m2.5.5.7.2">subscript</csymbol><ci id="S5.SS3.p1.2.m2.5.5.7.2.2.cmml" xref="S5.SS3.p1.2.m2.5.5.7.2.2">𝑀</ci><ci id="S5.SS3.p1.2.m2.5.5.7.2.3a.cmml" xref="S5.SS3.p1.2.m2.5.5.7.2.3"><mtext id="S5.SS3.p1.2.m2.5.5.7.2.3.cmml" mathsize="70%" xref="S5.SS3.p1.2.m2.5.5.7.2.3">split</mtext></ci></apply><ci id="S5.SS3.p1.2.m2.1.1.cmml" xref="S5.SS3.p1.2.m2.1.1">⋅</ci></apply></apply><apply id="S5.SS3.p1.2.m2.5.5c.cmml" xref="S5.SS3.p1.2.m2.5.5"><eq id="S5.SS3.p1.2.m2.5.5.8.cmml" xref="S5.SS3.p1.2.m2.5.5.8"></eq><share href="https://arxiv.org/html/2407.21059v1#S5.SS3.p1.2.m2.5.5.7.cmml" id="S5.SS3.p1.2.m2.5.5d.cmml" xref="S5.SS3.p1.2.m2.5.5"></share><set id="S5.SS3.p1.2.m2.5.5.3.4.cmml" xref="S5.SS3.p1.2.m2.5.5.3.3"><apply id="S5.SS3.p1.2.m2.3.3.1.1.1.cmml" xref="S5.SS3.p1.2.m2.3.3.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p1.2.m2.3.3.1.1.1.1.cmml" xref="S5.SS3.p1.2.m2.3.3.1.1.1">subscript</csymbol><ci id="S5.SS3.p1.2.m2.3.3.1.1.1.2.cmml" xref="S5.SS3.p1.2.m2.3.3.1.1.1.2">𝑏</ci><cn id="S5.SS3.p1.2.m2.3.3.1.1.1.3.cmml" type="integer" xref="S5.SS3.p1.2.m2.3.3.1.1.1.3">1</cn></apply><apply id="S5.SS3.p1.2.m2.4.4.2.2.2.cmml" xref="S5.SS3.p1.2.m2.4.4.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p1.2.m2.4.4.2.2.2.1.cmml" xref="S5.SS3.p1.2.m2.4.4.2.2.2">subscript</csymbol><ci id="S5.SS3.p1.2.m2.4.4.2.2.2.2.cmml" xref="S5.SS3.p1.2.m2.4.4.2.2.2.2">𝑏</ci><cn id="S5.SS3.p1.2.m2.4.4.2.2.2.3.cmml" type="integer" xref="S5.SS3.p1.2.m2.4.4.2.2.2.3">2</cn></apply><ci id="S5.SS3.p1.2.m2.2.2.cmml" xref="S5.SS3.p1.2.m2.2.2">…</ci><apply id="S5.SS3.p1.2.m2.5.5.3.3.3.cmml" xref="S5.SS3.p1.2.m2.5.5.3.3.3"><csymbol cd="ambiguous" id="S5.SS3.p1.2.m2.5.5.3.3.3.1.cmml" xref="S5.SS3.p1.2.m2.5.5.3.3.3">subscript</csymbol><ci id="S5.SS3.p1.2.m2.5.5.3.3.3.2.cmml" xref="S5.SS3.p1.2.m2.5.5.3.3.3.2">𝑏</ci><ci id="S5.SS3.p1.2.m2.5.5.3.3.3.3.cmml" xref="S5.SS3.p1.2.m2.5.5.3.3.3.3">𝑚</ci></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.2.m2.5c">B=M_{\text{split}}(\cdot)=\{b_{1},b_{2},\ldots,b_{m}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.2.m2.5d">italic_B = italic_M start_POSTSUBSCRIPT split end_POSTSUBSCRIPT ( ⋅ ) = { italic_b start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_b start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT }</annotation></semantics></math>. For each branch <math alttext="b_{i}\in B" class="ltx_Math" display="inline" id="S5.SS3.p1.3.m3.1"><semantics id="S5.SS3.p1.3.m3.1a"><mrow id="S5.SS3.p1.3.m3.1.1" xref="S5.SS3.p1.3.m3.1.1.cmml"><msub id="S5.SS3.p1.3.m3.1.1.2" xref="S5.SS3.p1.3.m3.1.1.2.cmml"><mi id="S5.SS3.p1.3.m3.1.1.2.2" xref="S5.SS3.p1.3.m3.1.1.2.2.cmml">b</mi><mi id="S5.SS3.p1.3.m3.1.1.2.3" xref="S5.SS3.p1.3.m3.1.1.2.3.cmml">i</mi></msub><mo id="S5.SS3.p1.3.m3.1.1.1" xref="S5.SS3.p1.3.m3.1.1.1.cmml">∈</mo><mi id="S5.SS3.p1.3.m3.1.1.3" xref="S5.SS3.p1.3.m3.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.3.m3.1b"><apply id="S5.SS3.p1.3.m3.1.1.cmml" xref="S5.SS3.p1.3.m3.1.1"><in id="S5.SS3.p1.3.m3.1.1.1.cmml" xref="S5.SS3.p1.3.m3.1.1.1"></in><apply id="S5.SS3.p1.3.m3.1.1.2.cmml" xref="S5.SS3.p1.3.m3.1.1.2"><csymbol cd="ambiguous" id="S5.SS3.p1.3.m3.1.1.2.1.cmml" xref="S5.SS3.p1.3.m3.1.1.2">subscript</csymbol><ci id="S5.SS3.p1.3.m3.1.1.2.2.cmml" xref="S5.SS3.p1.3.m3.1.1.2.2">𝑏</ci><ci id="S5.SS3.p1.3.m3.1.1.2.3.cmml" xref="S5.SS3.p1.3.m3.1.1.2.3">𝑖</ci></apply><ci id="S5.SS3.p1.3.m3.1.1.3.cmml" xref="S5.SS3.p1.3.m3.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.3.m3.1c">b_{i}\in B</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.3.m3.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_B</annotation></semantics></math>, the same or different RAG processes can be executed, passing through multiple processing modules <math alttext="\{M_{1},M_{2},\ldots,M_{k}\}" class="ltx_Math" display="inline" id="S5.SS3.p1.4.m4.4"><semantics id="S5.SS3.p1.4.m4.4a"><mrow id="S5.SS3.p1.4.m4.4.4.3" xref="S5.SS3.p1.4.m4.4.4.4.cmml"><mo id="S5.SS3.p1.4.m4.4.4.3.4" stretchy="false" xref="S5.SS3.p1.4.m4.4.4.4.cmml">{</mo><msub id="S5.SS3.p1.4.m4.2.2.1.1" xref="S5.SS3.p1.4.m4.2.2.1.1.cmml"><mi id="S5.SS3.p1.4.m4.2.2.1.1.2" xref="S5.SS3.p1.4.m4.2.2.1.1.2.cmml">M</mi><mn id="S5.SS3.p1.4.m4.2.2.1.1.3" xref="S5.SS3.p1.4.m4.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p1.4.m4.4.4.3.5" xref="S5.SS3.p1.4.m4.4.4.4.cmml">,</mo><msub id="S5.SS3.p1.4.m4.3.3.2.2" xref="S5.SS3.p1.4.m4.3.3.2.2.cmml"><mi id="S5.SS3.p1.4.m4.3.3.2.2.2" xref="S5.SS3.p1.4.m4.3.3.2.2.2.cmml">M</mi><mn id="S5.SS3.p1.4.m4.3.3.2.2.3" xref="S5.SS3.p1.4.m4.3.3.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p1.4.m4.4.4.3.6" xref="S5.SS3.p1.4.m4.4.4.4.cmml">,</mo><mi id="S5.SS3.p1.4.m4.1.1" mathvariant="normal" xref="S5.SS3.p1.4.m4.1.1.cmml">…</mi><mo id="S5.SS3.p1.4.m4.4.4.3.7" xref="S5.SS3.p1.4.m4.4.4.4.cmml">,</mo><msub id="S5.SS3.p1.4.m4.4.4.3.3" xref="S5.SS3.p1.4.m4.4.4.3.3.cmml"><mi id="S5.SS3.p1.4.m4.4.4.3.3.2" xref="S5.SS3.p1.4.m4.4.4.3.3.2.cmml">M</mi><mi id="S5.SS3.p1.4.m4.4.4.3.3.3" xref="S5.SS3.p1.4.m4.4.4.3.3.3.cmml">k</mi></msub><mo id="S5.SS3.p1.4.m4.4.4.3.8" stretchy="false" xref="S5.SS3.p1.4.m4.4.4.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.4.m4.4b"><set id="S5.SS3.p1.4.m4.4.4.4.cmml" xref="S5.SS3.p1.4.m4.4.4.3"><apply id="S5.SS3.p1.4.m4.2.2.1.1.cmml" xref="S5.SS3.p1.4.m4.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p1.4.m4.2.2.1.1.1.cmml" xref="S5.SS3.p1.4.m4.2.2.1.1">subscript</csymbol><ci id="S5.SS3.p1.4.m4.2.2.1.1.2.cmml" xref="S5.SS3.p1.4.m4.2.2.1.1.2">𝑀</ci><cn id="S5.SS3.p1.4.m4.2.2.1.1.3.cmml" type="integer" xref="S5.SS3.p1.4.m4.2.2.1.1.3">1</cn></apply><apply id="S5.SS3.p1.4.m4.3.3.2.2.cmml" xref="S5.SS3.p1.4.m4.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS3.p1.4.m4.3.3.2.2.1.cmml" xref="S5.SS3.p1.4.m4.3.3.2.2">subscript</csymbol><ci id="S5.SS3.p1.4.m4.3.3.2.2.2.cmml" xref="S5.SS3.p1.4.m4.3.3.2.2.2">𝑀</ci><cn id="S5.SS3.p1.4.m4.3.3.2.2.3.cmml" type="integer" xref="S5.SS3.p1.4.m4.3.3.2.2.3">2</cn></apply><ci id="S5.SS3.p1.4.m4.1.1.cmml" xref="S5.SS3.p1.4.m4.1.1">…</ci><apply id="S5.SS3.p1.4.m4.4.4.3.3.cmml" xref="S5.SS3.p1.4.m4.4.4.3.3"><csymbol cd="ambiguous" id="S5.SS3.p1.4.m4.4.4.3.3.1.cmml" xref="S5.SS3.p1.4.m4.4.4.3.3">subscript</csymbol><ci id="S5.SS3.p1.4.m4.4.4.3.3.2.cmml" xref="S5.SS3.p1.4.m4.4.4.3.3.2">𝑀</ci><ci id="S5.SS3.p1.4.m4.4.4.3.3.3.cmml" xref="S5.SS3.p1.4.m4.4.4.3.3.3">𝑘</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.4.m4.4c">\{M_{1},M_{2},\ldots,M_{k}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.4.m4.4d">{ italic_M start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT }</annotation></semantics></math> to obtain branch output result <math alttext="p_{i}=M_{ik}(\ldots M_{i2}(M_{i1}(b_{i}))\ldots)" class="ltx_Math" display="inline" id="S5.SS3.p1.5.m5.1"><semantics id="S5.SS3.p1.5.m5.1a"><mrow id="S5.SS3.p1.5.m5.1.1" xref="S5.SS3.p1.5.m5.1.1.cmml"><msub id="S5.SS3.p1.5.m5.1.1.3" xref="S5.SS3.p1.5.m5.1.1.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.3.2" xref="S5.SS3.p1.5.m5.1.1.3.2.cmml">p</mi><mi id="S5.SS3.p1.5.m5.1.1.3.3" xref="S5.SS3.p1.5.m5.1.1.3.3.cmml">i</mi></msub><mo id="S5.SS3.p1.5.m5.1.1.2" xref="S5.SS3.p1.5.m5.1.1.2.cmml">=</mo><mrow id="S5.SS3.p1.5.m5.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.cmml"><msub id="S5.SS3.p1.5.m5.1.1.1.3" xref="S5.SS3.p1.5.m5.1.1.1.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.3.2" xref="S5.SS3.p1.5.m5.1.1.1.3.2.cmml">M</mi><mrow id="S5.SS3.p1.5.m5.1.1.1.3.3" xref="S5.SS3.p1.5.m5.1.1.1.3.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.3.3.2" xref="S5.SS3.p1.5.m5.1.1.1.3.3.2.cmml">i</mi><mo id="S5.SS3.p1.5.m5.1.1.1.3.3.1" xref="S5.SS3.p1.5.m5.1.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS3.p1.5.m5.1.1.1.3.3.3" xref="S5.SS3.p1.5.m5.1.1.1.3.3.3.cmml">k</mi></mrow></msub><mo id="S5.SS3.p1.5.m5.1.1.1.2" xref="S5.SS3.p1.5.m5.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.cmml"><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.3" mathvariant="normal" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.3.cmml">…</mi><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.2.cmml">⁢</mo><msub id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.2.cmml">M</mi><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.2.cmml">i</mi><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.1.cmml">⁢</mo><mn id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.3.cmml">2</mn></mrow></msub><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.2a" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.cmml"><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.cmml"><msub id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.2.cmml">M</mi><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mn id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></msub><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">b</mi><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.1.2b" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.2.cmml">⁢</mo><mi id="S5.SS3.p1.5.m5.1.1.1.1.1.1.5" mathvariant="normal" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.5.cmml">…</mi></mrow><mo id="S5.SS3.p1.5.m5.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.5.m5.1b"><apply id="S5.SS3.p1.5.m5.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1"><eq id="S5.SS3.p1.5.m5.1.1.2.cmml" xref="S5.SS3.p1.5.m5.1.1.2"></eq><apply id="S5.SS3.p1.5.m5.1.1.3.cmml" xref="S5.SS3.p1.5.m5.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p1.5.m5.1.1.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.3">subscript</csymbol><ci id="S5.SS3.p1.5.m5.1.1.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.3.2">𝑝</ci><ci id="S5.SS3.p1.5.m5.1.1.3.3.cmml" xref="S5.SS3.p1.5.m5.1.1.3.3">𝑖</ci></apply><apply id="S5.SS3.p1.5.m5.1.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1"><times id="S5.SS3.p1.5.m5.1.1.1.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.2"></times><apply id="S5.SS3.p1.5.m5.1.1.1.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p1.5.m5.1.1.1.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3">subscript</csymbol><ci id="S5.SS3.p1.5.m5.1.1.1.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3.2">𝑀</ci><apply id="S5.SS3.p1.5.m5.1.1.1.3.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3.3"><times id="S5.SS3.p1.5.m5.1.1.1.3.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3.3.1"></times><ci id="S5.SS3.p1.5.m5.1.1.1.3.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3.3.2">𝑖</ci><ci id="S5.SS3.p1.5.m5.1.1.1.3.3.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.3.3.3">𝑘</ci></apply></apply><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1"><times id="S5.SS3.p1.5.m5.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.2"></times><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.3">…</ci><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4">subscript</csymbol><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.2">𝑀</ci><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3"><times id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.1"></times><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.2">𝑖</ci><cn id="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.3.cmml" type="integer" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.4.3.3">2</cn></apply></apply><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1"><times id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.2"></times><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.2">𝑀</ci><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3"><times id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.1"></times><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply><apply id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑏</ci><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><ci id="S5.SS3.p1.5.m5.1.1.1.1.1.1.5.cmml" xref="S5.SS3.p1.5.m5.1.1.1.1.1.1.5">…</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.5.m5.1c">p_{i}=M_{ik}(\ldots M_{i2}(M_{i1}(b_{i}))\ldots)</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.5.m5.1d">italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_M start_POSTSUBSCRIPT italic_i italic_k end_POSTSUBSCRIPT ( … italic_M start_POSTSUBSCRIPT italic_i 2 end_POSTSUBSCRIPT ( italic_M start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT ( italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ) … )</annotation></semantics></math>. The results of multiple branches are aggregated using an aggregation function to obtain intermediate output results. <math alttext="\hat{O}=M_{\text{merge}}(\{p_{i}\mid b_{i}\in B\})" class="ltx_Math" display="inline" id="S5.SS3.p1.6.m6.1"><semantics id="S5.SS3.p1.6.m6.1a"><mrow id="S5.SS3.p1.6.m6.1.1" xref="S5.SS3.p1.6.m6.1.1.cmml"><mover accent="true" id="S5.SS3.p1.6.m6.1.1.3" xref="S5.SS3.p1.6.m6.1.1.3.cmml"><mi id="S5.SS3.p1.6.m6.1.1.3.2" xref="S5.SS3.p1.6.m6.1.1.3.2.cmml">O</mi><mo id="S5.SS3.p1.6.m6.1.1.3.1" xref="S5.SS3.p1.6.m6.1.1.3.1.cmml">^</mo></mover><mo id="S5.SS3.p1.6.m6.1.1.2" xref="S5.SS3.p1.6.m6.1.1.2.cmml">=</mo><mrow id="S5.SS3.p1.6.m6.1.1.1" xref="S5.SS3.p1.6.m6.1.1.1.cmml"><msub id="S5.SS3.p1.6.m6.1.1.1.3" xref="S5.SS3.p1.6.m6.1.1.1.3.cmml"><mi id="S5.SS3.p1.6.m6.1.1.1.3.2" xref="S5.SS3.p1.6.m6.1.1.1.3.2.cmml">M</mi><mtext id="S5.SS3.p1.6.m6.1.1.1.3.3" xref="S5.SS3.p1.6.m6.1.1.1.3.3a.cmml">merge</mtext></msub><mo id="S5.SS3.p1.6.m6.1.1.1.2" xref="S5.SS3.p1.6.m6.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p1.6.m6.1.1.1.1.1" xref="S5.SS3.p1.6.m6.1.1.1.cmml"><mo id="S5.SS3.p1.6.m6.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p1.6.m6.1.1.1.cmml">(</mo><mrow id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.cmml"><mo id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.3" stretchy="false" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.1.cmml">{</mo><msub id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.cmml"><mi id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.2" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.2.cmml">p</mi><mi id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.3" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo fence="true" id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.4" lspace="0em" rspace="0em" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.1.cmml">∣</mo><mrow id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.cmml"><msub id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.cmml"><mi id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.2" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.2.cmml">b</mi><mi id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.3" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.1" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.1.cmml">∈</mo><mi id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.3" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.3.cmml">B</mi></mrow><mo id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.5" stretchy="false" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.1.cmml">}</mo></mrow><mo id="S5.SS3.p1.6.m6.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p1.6.m6.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.6.m6.1b"><apply id="S5.SS3.p1.6.m6.1.1.cmml" xref="S5.SS3.p1.6.m6.1.1"><eq id="S5.SS3.p1.6.m6.1.1.2.cmml" xref="S5.SS3.p1.6.m6.1.1.2"></eq><apply id="S5.SS3.p1.6.m6.1.1.3.cmml" xref="S5.SS3.p1.6.m6.1.1.3"><ci id="S5.SS3.p1.6.m6.1.1.3.1.cmml" xref="S5.SS3.p1.6.m6.1.1.3.1">^</ci><ci id="S5.SS3.p1.6.m6.1.1.3.2.cmml" xref="S5.SS3.p1.6.m6.1.1.3.2">𝑂</ci></apply><apply id="S5.SS3.p1.6.m6.1.1.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1"><times id="S5.SS3.p1.6.m6.1.1.1.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.2"></times><apply id="S5.SS3.p1.6.m6.1.1.1.3.cmml" xref="S5.SS3.p1.6.m6.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p1.6.m6.1.1.1.3.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.3">subscript</csymbol><ci id="S5.SS3.p1.6.m6.1.1.1.3.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.3.2">𝑀</ci><ci id="S5.SS3.p1.6.m6.1.1.1.3.3a.cmml" xref="S5.SS3.p1.6.m6.1.1.1.3.3"><mtext id="S5.SS3.p1.6.m6.1.1.1.3.3.cmml" mathsize="70%" xref="S5.SS3.p1.6.m6.1.1.1.3.3">merge</mtext></ci></apply><apply id="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2"><csymbol cd="latexml" id="S5.SS3.p1.6.m6.1.1.1.1.1.1.3.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.3">conditional-set</csymbol><apply id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.2">𝑝</ci><ci id="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2"><in id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.1"></in><apply id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.1.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.2.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.2">𝑏</ci><ci id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.3.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.2.3">𝑖</ci></apply><ci id="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.3.cmml" xref="S5.SS3.p1.6.m6.1.1.1.1.1.1.2.2.3">𝐵</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.6.m6.1c">\hat{O}=M_{\text{merge}}(\{p_{i}\mid b_{i}\in B\})</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.6.m6.1d">over^ start_ARG italic_O end_ARG = italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( { italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∣ italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_B } )</annotation></semantics></math>. However, aggregation is not necessarily the end of the RAG flow, as it can continue to connect to other modules, <math alttext="M_{jn}(\ldots M_{j2}(M_{j1}(\hat{O}))\ldots)" class="ltx_Math" display="inline" id="S5.SS3.p1.7.m7.2"><semantics id="S5.SS3.p1.7.m7.2a"><mrow id="S5.SS3.p1.7.m7.2.2" xref="S5.SS3.p1.7.m7.2.2.cmml"><msub id="S5.SS3.p1.7.m7.2.2.3" xref="S5.SS3.p1.7.m7.2.2.3.cmml"><mi id="S5.SS3.p1.7.m7.2.2.3.2" xref="S5.SS3.p1.7.m7.2.2.3.2.cmml">M</mi><mrow id="S5.SS3.p1.7.m7.2.2.3.3" xref="S5.SS3.p1.7.m7.2.2.3.3.cmml"><mi id="S5.SS3.p1.7.m7.2.2.3.3.2" xref="S5.SS3.p1.7.m7.2.2.3.3.2.cmml">j</mi><mo id="S5.SS3.p1.7.m7.2.2.3.3.1" xref="S5.SS3.p1.7.m7.2.2.3.3.1.cmml">⁢</mo><mi id="S5.SS3.p1.7.m7.2.2.3.3.3" xref="S5.SS3.p1.7.m7.2.2.3.3.3.cmml">n</mi></mrow></msub><mo id="S5.SS3.p1.7.m7.2.2.2" xref="S5.SS3.p1.7.m7.2.2.2.cmml">⁢</mo><mrow id="S5.SS3.p1.7.m7.2.2.1.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.cmml"><mo id="S5.SS3.p1.7.m7.2.2.1.1.2" stretchy="false" xref="S5.SS3.p1.7.m7.2.2.1.1.1.cmml">(</mo><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.cmml"><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.3" mathvariant="normal" xref="S5.SS3.p1.7.m7.2.2.1.1.1.3.cmml">…</mi><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.2.cmml">⁢</mo><msub id="S5.SS3.p1.7.m7.2.2.1.1.1.4" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.cmml"><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.4.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.2.cmml">M</mi><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.cmml"><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.2.cmml">j</mi><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.1.cmml">⁢</mo><mn id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.3" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.3.cmml">2</mn></mrow></msub><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.2a" xref="S5.SS3.p1.7.m7.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.cmml"><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.cmml"><msub id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.cmml"><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.2.cmml">M</mi><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.cmml"><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.2" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.2.cmml">j</mi><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.1.cmml">⁢</mo><mn id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.3" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.1" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.3.2" xref="S5.SS3.p1.7.m7.1.1.cmml"><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.3.2.1" stretchy="false" xref="S5.SS3.p1.7.m7.1.1.cmml">(</mo><mover accent="true" id="S5.SS3.p1.7.m7.1.1" xref="S5.SS3.p1.7.m7.1.1.cmml"><mi id="S5.SS3.p1.7.m7.1.1.2" xref="S5.SS3.p1.7.m7.1.1.2.cmml">O</mi><mo id="S5.SS3.p1.7.m7.1.1.1" xref="S5.SS3.p1.7.m7.1.1.1.cmml">^</mo></mover><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.3.2.2" stretchy="false" xref="S5.SS3.p1.7.m7.1.1.cmml">)</mo></mrow></mrow><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.SS3.p1.7.m7.2.2.1.1.1.2b" xref="S5.SS3.p1.7.m7.2.2.1.1.1.2.cmml">⁢</mo><mi id="S5.SS3.p1.7.m7.2.2.1.1.1.5" mathvariant="normal" xref="S5.SS3.p1.7.m7.2.2.1.1.1.5.cmml">…</mi></mrow><mo id="S5.SS3.p1.7.m7.2.2.1.1.3" stretchy="false" xref="S5.SS3.p1.7.m7.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.7.m7.2b"><apply id="S5.SS3.p1.7.m7.2.2.cmml" xref="S5.SS3.p1.7.m7.2.2"><times id="S5.SS3.p1.7.m7.2.2.2.cmml" xref="S5.SS3.p1.7.m7.2.2.2"></times><apply id="S5.SS3.p1.7.m7.2.2.3.cmml" xref="S5.SS3.p1.7.m7.2.2.3"><csymbol cd="ambiguous" id="S5.SS3.p1.7.m7.2.2.3.1.cmml" xref="S5.SS3.p1.7.m7.2.2.3">subscript</csymbol><ci id="S5.SS3.p1.7.m7.2.2.3.2.cmml" xref="S5.SS3.p1.7.m7.2.2.3.2">𝑀</ci><apply id="S5.SS3.p1.7.m7.2.2.3.3.cmml" xref="S5.SS3.p1.7.m7.2.2.3.3"><times id="S5.SS3.p1.7.m7.2.2.3.3.1.cmml" xref="S5.SS3.p1.7.m7.2.2.3.3.1"></times><ci id="S5.SS3.p1.7.m7.2.2.3.3.2.cmml" xref="S5.SS3.p1.7.m7.2.2.3.3.2">𝑗</ci><ci id="S5.SS3.p1.7.m7.2.2.3.3.3.cmml" xref="S5.SS3.p1.7.m7.2.2.3.3.3">𝑛</ci></apply></apply><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1"><times id="S5.SS3.p1.7.m7.2.2.1.1.1.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.2"></times><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.3.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.3">…</ci><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.4.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4"><csymbol cd="ambiguous" id="S5.SS3.p1.7.m7.2.2.1.1.1.4.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4">subscript</csymbol><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.4.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.2">𝑀</ci><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3"><times id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.1"></times><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.2">𝑗</ci><cn id="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.3.cmml" type="integer" xref="S5.SS3.p1.7.m7.2.2.1.1.1.4.3.3">2</cn></apply></apply><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1"><times id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.1"></times><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.2">𝑀</ci><apply id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3"><times id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.1"></times><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.2.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.2">𝑗</ci><cn id="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.2.3.3">1</cn></apply></apply><apply id="S5.SS3.p1.7.m7.1.1.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.1.1.1.3.2"><ci id="S5.SS3.p1.7.m7.1.1.1.cmml" xref="S5.SS3.p1.7.m7.1.1.1">^</ci><ci id="S5.SS3.p1.7.m7.1.1.2.cmml" xref="S5.SS3.p1.7.m7.1.1.2">𝑂</ci></apply></apply><ci id="S5.SS3.p1.7.m7.2.2.1.1.1.5.cmml" xref="S5.SS3.p1.7.m7.2.2.1.1.1.5">…</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.7.m7.2c">M_{jn}(\ldots M_{j2}(M_{j1}(\hat{O}))\ldots)</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.7.m7.2d">italic_M start_POSTSUBSCRIPT italic_j italic_n end_POSTSUBSCRIPT ( … italic_M start_POSTSUBSCRIPT italic_j 2 end_POSTSUBSCRIPT ( italic_M start_POSTSUBSCRIPT italic_j 1 end_POSTSUBSCRIPT ( over^ start_ARG italic_O end_ARG ) ) … )</annotation></semantics></math>. For example, after aggregating multiple model responses, they can continue through a validation module. Therefore, the entire branch flow pattern can be represented as:</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E27">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}\mathcal{P}_{branch}=&amp;M_{jn}(\ldots M_{j1}(M_{\text{merge}}(\{M_{%
ik}\\
&amp;(\ldots M_{i1}(b_{i})\ldots)\mid b_{i}\in M_{\text{split}}(q)\}))\ldots)\end{split}" class="ltx_Math" display="block" id="S5.E27.m1.41"><semantics id="S5.E27.m1.41a"><mtable columnspacing="0pt" displaystyle="true" id="S5.E27.m1.40.40" rowspacing="0pt" xref="S5.E27.m1.41.41.1.cmml"><mtr id="S5.E27.m1.40.40a" xref="S5.E27.m1.41.41.1.cmml"><mtd class="ltx_align_right" columnalign="right" id="S5.E27.m1.40.40b" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.3.3.3.3.3" xref="S5.E27.m1.41.41.1.cmml"><msub id="S5.E27.m1.3.3.3.3.3.4" xref="S5.E27.m1.41.41.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E27.m1.1.1.1.1.1.1" xref="S5.E27.m1.1.1.1.1.1.1.cmml">𝒫</mi><mrow id="S5.E27.m1.2.2.2.2.2.2.1" xref="S5.E27.m1.2.2.2.2.2.2.1.cmml"><mi id="S5.E27.m1.2.2.2.2.2.2.1.2" xref="S5.E27.m1.2.2.2.2.2.2.1.2.cmml">b</mi><mo id="S5.E27.m1.2.2.2.2.2.2.1.1" xref="S5.E27.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.2.2.2.2.2.2.1.3" xref="S5.E27.m1.2.2.2.2.2.2.1.3.cmml">r</mi><mo id="S5.E27.m1.2.2.2.2.2.2.1.1a" xref="S5.E27.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.2.2.2.2.2.2.1.4" xref="S5.E27.m1.2.2.2.2.2.2.1.4.cmml">a</mi><mo id="S5.E27.m1.2.2.2.2.2.2.1.1b" xref="S5.E27.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.2.2.2.2.2.2.1.5" xref="S5.E27.m1.2.2.2.2.2.2.1.5.cmml">n</mi><mo id="S5.E27.m1.2.2.2.2.2.2.1.1c" xref="S5.E27.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.2.2.2.2.2.2.1.6" xref="S5.E27.m1.2.2.2.2.2.2.1.6.cmml">c</mi><mo id="S5.E27.m1.2.2.2.2.2.2.1.1d" xref="S5.E27.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.2.2.2.2.2.2.1.7" xref="S5.E27.m1.2.2.2.2.2.2.1.7.cmml">h</mi></mrow></msub><mo id="S5.E27.m1.3.3.3.3.3.3" xref="S5.E27.m1.3.3.3.3.3.3.cmml">=</mo><mi id="S5.E27.m1.3.3.3.3.3.5" xref="S5.E27.m1.41.41.1.cmml"></mi></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E27.m1.40.40c" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.16.16.16.16.13" xref="S5.E27.m1.41.41.1.cmml"><msub id="S5.E27.m1.16.16.16.16.13.14" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.4.4.4.4.1.1" xref="S5.E27.m1.4.4.4.4.1.1.cmml">M</mi><mrow id="S5.E27.m1.5.5.5.5.2.2.1" xref="S5.E27.m1.5.5.5.5.2.2.1.cmml"><mi id="S5.E27.m1.5.5.5.5.2.2.1.2" xref="S5.E27.m1.5.5.5.5.2.2.1.2.cmml">j</mi><mo id="S5.E27.m1.5.5.5.5.2.2.1.1" xref="S5.E27.m1.5.5.5.5.2.2.1.1.cmml">⁢</mo><mi id="S5.E27.m1.5.5.5.5.2.2.1.3" xref="S5.E27.m1.5.5.5.5.2.2.1.3.cmml">n</mi></mrow></msub><mrow id="S5.E27.m1.16.16.16.16.13.15" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.6.6.6.6.3.3" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><mi id="S5.E27.m1.7.7.7.7.4.4" mathvariant="normal" xref="S5.E27.m1.7.7.7.7.4.4.cmml">…</mi><msub id="S5.E27.m1.16.16.16.16.13.15.1" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.8.8.8.8.5.5" xref="S5.E27.m1.8.8.8.8.5.5.cmml">M</mi><mrow id="S5.E27.m1.9.9.9.9.6.6.1" xref="S5.E27.m1.9.9.9.9.6.6.1.cmml"><mi id="S5.E27.m1.9.9.9.9.6.6.1.2" xref="S5.E27.m1.9.9.9.9.6.6.1.2.cmml">j</mi><mo id="S5.E27.m1.9.9.9.9.6.6.1.1" xref="S5.E27.m1.9.9.9.9.6.6.1.1.cmml">⁢</mo><mn id="S5.E27.m1.9.9.9.9.6.6.1.3" xref="S5.E27.m1.9.9.9.9.6.6.1.3.cmml">1</mn></mrow></msub><mrow id="S5.E27.m1.16.16.16.16.13.15.2" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.10.10.10.10.7.7" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><msub id="S5.E27.m1.16.16.16.16.13.15.2.1" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.11.11.11.11.8.8" xref="S5.E27.m1.11.11.11.11.8.8.cmml">M</mi><mtext id="S5.E27.m1.12.12.12.12.9.9.1" xref="S5.E27.m1.12.12.12.12.9.9.1a.cmml">merge</mtext></msub><mrow id="S5.E27.m1.16.16.16.16.13.15.2.2" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.13.13.13.13.10.10" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><mrow id="S5.E27.m1.16.16.16.16.13.15.2.2.1" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.14.14.14.14.11.11" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">{</mo><msub id="S5.E27.m1.16.16.16.16.13.15.2.2.1.1" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.15.15.15.15.12.12" xref="S5.E27.m1.15.15.15.15.12.12.cmml">M</mi><mrow id="S5.E27.m1.16.16.16.16.13.13.1" xref="S5.E27.m1.16.16.16.16.13.13.1.cmml"><mi id="S5.E27.m1.16.16.16.16.13.13.1.2" xref="S5.E27.m1.16.16.16.16.13.13.1.2.cmml">i</mi><mo id="S5.E27.m1.16.16.16.16.13.13.1.1" xref="S5.E27.m1.16.16.16.16.13.13.1.1.cmml">⁢</mo><mi id="S5.E27.m1.16.16.16.16.13.13.1.3" xref="S5.E27.m1.16.16.16.16.13.13.1.3.cmml">k</mi></mrow></msub></mrow></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S5.E27.m1.40.40d" xref="S5.E27.m1.41.41.1.cmml"><mtd id="S5.E27.m1.40.40e" xref="S5.E27.m1.41.41.1.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E27.m1.40.40f" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.40.40.40.24.24" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.40.40.40.24.24.25" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.40.40.40.24.24.25.1" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.40.40.40.24.24.25.1.1" xref="S5.E27.m1.41.41.1.cmml"><mrow id="S5.E27.m1.40.40.40.24.24.25.1.1.1" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.17.17.17.1.1.1" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><mi id="S5.E27.m1.18.18.18.2.2.2" mathvariant="normal" xref="S5.E27.m1.18.18.18.2.2.2.cmml">…</mi><msub id="S5.E27.m1.40.40.40.24.24.25.1.1.1.1" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.19.19.19.3.3.3" xref="S5.E27.m1.19.19.19.3.3.3.cmml">M</mi><mrow id="S5.E27.m1.20.20.20.4.4.4.1" xref="S5.E27.m1.20.20.20.4.4.4.1.cmml"><mi id="S5.E27.m1.20.20.20.4.4.4.1.2" xref="S5.E27.m1.20.20.20.4.4.4.1.2.cmml">i</mi><mo id="S5.E27.m1.20.20.20.4.4.4.1.1" xref="S5.E27.m1.20.20.20.4.4.4.1.1.cmml">⁢</mo><mn id="S5.E27.m1.20.20.20.4.4.4.1.3" xref="S5.E27.m1.20.20.20.4.4.4.1.3.cmml">1</mn></mrow></msub><mrow id="S5.E27.m1.40.40.40.24.24.25.1.1.1.2" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.21.21.21.5.5.5" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><msub id="S5.E27.m1.40.40.40.24.24.25.1.1.1.2.1" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.22.22.22.6.6.6" xref="S5.E27.m1.22.22.22.6.6.6.cmml">b</mi><mi id="S5.E27.m1.23.23.23.7.7.7.1" xref="S5.E27.m1.23.23.23.7.7.7.1.cmml">i</mi></msub><mo id="S5.E27.m1.24.24.24.8.8.8" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow><mi id="S5.E27.m1.25.25.25.9.9.9" mathvariant="normal" xref="S5.E27.m1.25.25.25.9.9.9.cmml">…</mi><mo id="S5.E27.m1.26.26.26.10.10.10" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow><mo id="S5.E27.m1.27.27.27.11.11.11" lspace="0em" rspace="0.167em" xref="S5.E27.m1.41.41.1.cmml">∣</mo><msub id="S5.E27.m1.40.40.40.24.24.25.1.1.2" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.28.28.28.12.12.12" xref="S5.E27.m1.28.28.28.12.12.12.cmml">b</mi><mi id="S5.E27.m1.29.29.29.13.13.13.1" xref="S5.E27.m1.29.29.29.13.13.13.1.cmml">i</mi></msub><mo id="S5.E27.m1.30.30.30.14.14.14" xref="S5.E27.m1.30.30.30.14.14.14.cmml">∈</mo><msub id="S5.E27.m1.40.40.40.24.24.25.1.1.3" xref="S5.E27.m1.41.41.1.cmml"><mi id="S5.E27.m1.31.31.31.15.15.15" xref="S5.E27.m1.31.31.31.15.15.15.cmml">M</mi><mtext id="S5.E27.m1.32.32.32.16.16.16.1" xref="S5.E27.m1.32.32.32.16.16.16.1a.cmml">split</mtext></msub><mrow id="S5.E27.m1.40.40.40.24.24.25.1.1.4" xref="S5.E27.m1.41.41.1.cmml"><mo id="S5.E27.m1.33.33.33.17.17.17" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">(</mo><mi id="S5.E27.m1.34.34.34.18.18.18" xref="S5.E27.m1.34.34.34.18.18.18.cmml">q</mi><mo id="S5.E27.m1.35.35.35.19.19.19" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow><mo id="S5.E27.m1.36.36.36.20.20.20" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">}</mo></mrow><mo id="S5.E27.m1.37.37.37.21.21.21" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow><mo id="S5.E27.m1.38.38.38.22.22.22" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow><mi id="S5.E27.m1.39.39.39.23.23.23" mathvariant="normal" xref="S5.E27.m1.39.39.39.23.23.23.cmml">…</mi><mo id="S5.E27.m1.40.40.40.24.24.24" stretchy="false" xref="S5.E27.m1.41.41.1.cmml">)</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S5.E27.m1.41b"><apply id="S5.E27.m1.41.41.1.cmml" xref="S5.E27.m1.40.40"><eq id="S5.E27.m1.3.3.3.3.3.3.cmml" xref="S5.E27.m1.3.3.3.3.3.3"></eq><apply id="S5.E27.m1.41.41.1.3.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.3.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.1.1.1.1.1.1">𝒫</ci><apply id="S5.E27.m1.2.2.2.2.2.2.1.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1"><times id="S5.E27.m1.2.2.2.2.2.2.1.1.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.1"></times><ci id="S5.E27.m1.2.2.2.2.2.2.1.2.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.2">𝑏</ci><ci id="S5.E27.m1.2.2.2.2.2.2.1.3.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.3">𝑟</ci><ci id="S5.E27.m1.2.2.2.2.2.2.1.4.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.4">𝑎</ci><ci id="S5.E27.m1.2.2.2.2.2.2.1.5.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.5">𝑛</ci><ci id="S5.E27.m1.2.2.2.2.2.2.1.6.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.6">𝑐</ci><ci id="S5.E27.m1.2.2.2.2.2.2.1.7.cmml" xref="S5.E27.m1.2.2.2.2.2.2.1.7">ℎ</ci></apply></apply><apply id="S5.E27.m1.41.41.1.1.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.2.cmml" xref="S5.E27.m1.40.40"></times><apply id="S5.E27.m1.41.41.1.1.3.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.3.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.4.4.4.4.1.1.cmml" xref="S5.E27.m1.4.4.4.4.1.1">𝑀</ci><apply id="S5.E27.m1.5.5.5.5.2.2.1.cmml" xref="S5.E27.m1.5.5.5.5.2.2.1"><times id="S5.E27.m1.5.5.5.5.2.2.1.1.cmml" xref="S5.E27.m1.5.5.5.5.2.2.1.1"></times><ci id="S5.E27.m1.5.5.5.5.2.2.1.2.cmml" xref="S5.E27.m1.5.5.5.5.2.2.1.2">𝑗</ci><ci id="S5.E27.m1.5.5.5.5.2.2.1.3.cmml" xref="S5.E27.m1.5.5.5.5.2.2.1.3">𝑛</ci></apply></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.1.1.1.2.cmml" xref="S5.E27.m1.40.40"></times><ci id="S5.E27.m1.7.7.7.7.4.4.cmml" xref="S5.E27.m1.7.7.7.7.4.4">…</ci><apply id="S5.E27.m1.41.41.1.1.1.1.1.4.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.4.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.8.8.8.8.5.5.cmml" xref="S5.E27.m1.8.8.8.8.5.5">𝑀</ci><apply id="S5.E27.m1.9.9.9.9.6.6.1.cmml" xref="S5.E27.m1.9.9.9.9.6.6.1"><times id="S5.E27.m1.9.9.9.9.6.6.1.1.cmml" xref="S5.E27.m1.9.9.9.9.6.6.1.1"></times><ci id="S5.E27.m1.9.9.9.9.6.6.1.2.cmml" xref="S5.E27.m1.9.9.9.9.6.6.1.2">𝑗</ci><cn id="S5.E27.m1.9.9.9.9.6.6.1.3.cmml" type="integer" xref="S5.E27.m1.9.9.9.9.6.6.1.3">1</cn></apply></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E27.m1.40.40"></times><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.3.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.11.11.11.11.8.8.cmml" xref="S5.E27.m1.11.11.11.11.8.8">𝑀</ci><ci id="S5.E27.m1.12.12.12.12.9.9.1a.cmml" xref="S5.E27.m1.12.12.12.12.9.9.1"><mtext id="S5.E27.m1.12.12.12.12.9.9.1.cmml" mathsize="70%" xref="S5.E27.m1.12.12.12.12.9.9.1">merge</mtext></ci></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E27.m1.40.40"><csymbol cd="latexml" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S5.E27.m1.40.40">conditional-set</csymbol><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E27.m1.40.40"></times><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.15.15.15.15.12.12.cmml" xref="S5.E27.m1.15.15.15.15.12.12">𝑀</ci><apply id="S5.E27.m1.16.16.16.16.13.13.1.cmml" xref="S5.E27.m1.16.16.16.16.13.13.1"><times id="S5.E27.m1.16.16.16.16.13.13.1.1.cmml" xref="S5.E27.m1.16.16.16.16.13.13.1.1"></times><ci id="S5.E27.m1.16.16.16.16.13.13.1.2.cmml" xref="S5.E27.m1.16.16.16.16.13.13.1.2">𝑖</ci><ci id="S5.E27.m1.16.16.16.16.13.13.1.3.cmml" xref="S5.E27.m1.16.16.16.16.13.13.1.3">𝑘</ci></apply></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E27.m1.40.40"></times><ci id="S5.E27.m1.18.18.18.2.2.2.cmml" xref="S5.E27.m1.18.18.18.2.2.2">…</ci><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.4.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.4.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.19.19.19.3.3.3.cmml" xref="S5.E27.m1.19.19.19.3.3.3">𝑀</ci><apply id="S5.E27.m1.20.20.20.4.4.4.1.cmml" xref="S5.E27.m1.20.20.20.4.4.4.1"><times id="S5.E27.m1.20.20.20.4.4.4.1.1.cmml" xref="S5.E27.m1.20.20.20.4.4.4.1.1"></times><ci id="S5.E27.m1.20.20.20.4.4.4.1.2.cmml" xref="S5.E27.m1.20.20.20.4.4.4.1.2">𝑖</ci><cn id="S5.E27.m1.20.20.20.4.4.4.1.3.cmml" type="integer" xref="S5.E27.m1.20.20.20.4.4.4.1.3">1</cn></apply></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.22.22.22.6.6.6.cmml" xref="S5.E27.m1.22.22.22.6.6.6">𝑏</ci><ci id="S5.E27.m1.23.23.23.7.7.7.1.cmml" xref="S5.E27.m1.23.23.23.7.7.7.1">𝑖</ci></apply><ci id="S5.E27.m1.25.25.25.9.9.9.cmml" xref="S5.E27.m1.25.25.25.9.9.9">…</ci></apply></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S5.E27.m1.40.40"><in id="S5.E27.m1.30.30.30.14.14.14.cmml" xref="S5.E27.m1.30.30.30.14.14.14"></in><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.28.28.28.12.12.12.cmml" xref="S5.E27.m1.28.28.28.12.12.12">𝑏</ci><ci id="S5.E27.m1.29.29.29.13.13.13.1.cmml" xref="S5.E27.m1.29.29.29.13.13.13.1">𝑖</ci></apply><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S5.E27.m1.40.40"><times id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.3.1.cmml" xref="S5.E27.m1.40.40"></times><apply id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.3.2.cmml" xref="S5.E27.m1.40.40"><csymbol cd="ambiguous" id="S5.E27.m1.41.41.1.1.1.1.1.1.1.1.1.1.1.2.2.3.2.1.cmml" xref="S5.E27.m1.40.40">subscript</csymbol><ci id="S5.E27.m1.31.31.31.15.15.15.cmml" xref="S5.E27.m1.31.31.31.15.15.15">𝑀</ci><ci id="S5.E27.m1.32.32.32.16.16.16.1a.cmml" xref="S5.E27.m1.32.32.32.16.16.16.1"><mtext id="S5.E27.m1.32.32.32.16.16.16.1.cmml" mathsize="70%" xref="S5.E27.m1.32.32.32.16.16.16.1">split</mtext></ci></apply><ci id="S5.E27.m1.34.34.34.18.18.18.cmml" xref="S5.E27.m1.34.34.34.18.18.18">𝑞</ci></apply></apply></apply></apply><ci id="S5.E27.m1.39.39.39.23.23.23.cmml" xref="S5.E27.m1.39.39.39.23.23.23">…</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E27.m1.41c">\begin{split}\mathcal{P}_{branch}=&amp;M_{jn}(\ldots M_{j1}(M_{\text{merge}}(\{M_{%
ik}\\
&amp;(\ldots M_{i1}(b_{i})\ldots)\mid b_{i}\in M_{\text{split}}(q)\}))\ldots)\end{split}</annotation><annotation encoding="application/x-llamapun" id="S5.E27.m1.41d">start_ROW start_CELL caligraphic_P start_POSTSUBSCRIPT italic_b italic_r italic_a italic_n italic_c italic_h end_POSTSUBSCRIPT = end_CELL start_CELL italic_M start_POSTSUBSCRIPT italic_j italic_n end_POSTSUBSCRIPT ( … italic_M start_POSTSUBSCRIPT italic_j 1 end_POSTSUBSCRIPT ( italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( { italic_M start_POSTSUBSCRIPT italic_i italic_k end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL ( … italic_M start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT ( italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) … ) ∣ italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_M start_POSTSUBSCRIPT split end_POSTSUBSCRIPT ( italic_q ) } ) ) … ) end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(27)</span></td>
</tr></tbody>
</table>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg3.2.1.1">Algorithm 3</span> </span> Pre-retrieval Branching Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg3.3">
<div class="ltx_listingline" id="alg3.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="q" class="ltx_Math" display="inline" id="alg3.l0.m1.1"><semantics id="alg3.l0.m1.1a"><mi id="alg3.l0.m1.1.1" xref="alg3.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg3.l0.m1.1b"><ci id="alg3.l0.m1.1.1.cmml" xref="alg3.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m1.1d">italic_q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg3.l0.m2.1"><semantics id="alg3.l0.m2.1a"><mi id="alg3.l0.m2.1.1" xref="alg3.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg3.l0.m2.1b"><ci id="alg3.l0.m2.1.1.cmml" xref="alg3.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m2.1d">italic_D</annotation></semantics></math>, query expand module <math alttext="M_{\text{expand}}" class="ltx_Math" display="inline" id="alg3.l0.m3.1"><semantics id="alg3.l0.m3.1a"><msub id="alg3.l0.m3.1.1" xref="alg3.l0.m3.1.1.cmml"><mi id="alg3.l0.m3.1.1.2" xref="alg3.l0.m3.1.1.2.cmml">M</mi><mtext id="alg3.l0.m3.1.1.3" xref="alg3.l0.m3.1.1.3a.cmml">expand</mtext></msub><annotation-xml encoding="MathML-Content" id="alg3.l0.m3.1b"><apply id="alg3.l0.m3.1.1.cmml" xref="alg3.l0.m3.1.1"><csymbol cd="ambiguous" id="alg3.l0.m3.1.1.1.cmml" xref="alg3.l0.m3.1.1">subscript</csymbol><ci id="alg3.l0.m3.1.1.2.cmml" xref="alg3.l0.m3.1.1.2">𝑀</ci><ci id="alg3.l0.m3.1.1.3a.cmml" xref="alg3.l0.m3.1.1.3"><mtext id="alg3.l0.m3.1.1.3.cmml" mathsize="70%" xref="alg3.l0.m3.1.1.3">expand</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m3.1c">M_{\text{expand}}</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m3.1d">italic_M start_POSTSUBSCRIPT expand end_POSTSUBSCRIPT</annotation></semantics></math>, retriever <math alttext="M_{\text{retrieve}}" class="ltx_Math" display="inline" id="alg3.l0.m4.1"><semantics id="alg3.l0.m4.1a"><msub id="alg3.l0.m4.1.1" xref="alg3.l0.m4.1.1.cmml"><mi id="alg3.l0.m4.1.1.2" xref="alg3.l0.m4.1.1.2.cmml">M</mi><mtext id="alg3.l0.m4.1.1.3" xref="alg3.l0.m4.1.1.3a.cmml">retrieve</mtext></msub><annotation-xml encoding="MathML-Content" id="alg3.l0.m4.1b"><apply id="alg3.l0.m4.1.1.cmml" xref="alg3.l0.m4.1.1"><csymbol cd="ambiguous" id="alg3.l0.m4.1.1.1.cmml" xref="alg3.l0.m4.1.1">subscript</csymbol><ci id="alg3.l0.m4.1.1.2.cmml" xref="alg3.l0.m4.1.1.2">𝑀</ci><ci id="alg3.l0.m4.1.1.3a.cmml" xref="alg3.l0.m4.1.1.3"><mtext id="alg3.l0.m4.1.1.3.cmml" mathsize="70%" xref="alg3.l0.m4.1.1.3">retrieve</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m4.1c">M_{\text{retrieve}}</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m4.1d">italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT</annotation></semantics></math>, language model <math alttext="LLM" class="ltx_Math" display="inline" id="alg3.l0.m5.1"><semantics id="alg3.l0.m5.1a"><mrow id="alg3.l0.m5.1.1" xref="alg3.l0.m5.1.1.cmml"><mi id="alg3.l0.m5.1.1.2" xref="alg3.l0.m5.1.1.2.cmml">L</mi><mo id="alg3.l0.m5.1.1.1" xref="alg3.l0.m5.1.1.1.cmml">⁢</mo><mi id="alg3.l0.m5.1.1.3" xref="alg3.l0.m5.1.1.3.cmml">L</mi><mo id="alg3.l0.m5.1.1.1a" xref="alg3.l0.m5.1.1.1.cmml">⁢</mo><mi id="alg3.l0.m5.1.1.4" xref="alg3.l0.m5.1.1.4.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l0.m5.1b"><apply id="alg3.l0.m5.1.1.cmml" xref="alg3.l0.m5.1.1"><times id="alg3.l0.m5.1.1.1.cmml" xref="alg3.l0.m5.1.1.1"></times><ci id="alg3.l0.m5.1.1.2.cmml" xref="alg3.l0.m5.1.1.2">𝐿</ci><ci id="alg3.l0.m5.1.1.3.cmml" xref="alg3.l0.m5.1.1.3">𝐿</ci><ci id="alg3.l0.m5.1.1.4.cmml" xref="alg3.l0.m5.1.1.4">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m5.1c">LLM</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m5.1d">italic_L italic_L italic_M</annotation></semantics></math>, merge module <math alttext="M_{\text{merge}}" class="ltx_Math" display="inline" id="alg3.l0.m6.1"><semantics id="alg3.l0.m6.1a"><msub id="alg3.l0.m6.1.1" xref="alg3.l0.m6.1.1.cmml"><mi id="alg3.l0.m6.1.1.2" xref="alg3.l0.m6.1.1.2.cmml">M</mi><mtext id="alg3.l0.m6.1.1.3" xref="alg3.l0.m6.1.1.3a.cmml">merge</mtext></msub><annotation-xml encoding="MathML-Content" id="alg3.l0.m6.1b"><apply id="alg3.l0.m6.1.1.cmml" xref="alg3.l0.m6.1.1"><csymbol cd="ambiguous" id="alg3.l0.m6.1.1.1.cmml" xref="alg3.l0.m6.1.1">subscript</csymbol><ci id="alg3.l0.m6.1.1.2.cmml" xref="alg3.l0.m6.1.1.2">𝑀</ci><ci id="alg3.l0.m6.1.1.3a.cmml" xref="alg3.l0.m6.1.1.3"><mtext id="alg3.l0.m6.1.1.3.cmml" mathsize="70%" xref="alg3.l0.m6.1.1.3">merge</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m6.1c">M_{\text{merge}}</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m6.1d">italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg3.l0a.m1.1"><semantics id="alg3.l0a.m1.1a"><mover accent="true" id="alg3.l0a.m1.1.1" xref="alg3.l0a.m1.1.1.cmml"><mi id="alg3.l0a.m1.1.1.2" xref="alg3.l0a.m1.1.1.2.cmml">y</mi><mo id="alg3.l0a.m1.1.1.1" xref="alg3.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg3.l0a.m1.1b"><apply id="alg3.l0a.m1.1.1.cmml" xref="alg3.l0a.m1.1.1"><ci id="alg3.l0a.m1.1.1.1.cmml" xref="alg3.l0a.m1.1.1.1">^</ci><ci id="alg3.l0a.m1.1.1.2.cmml" xref="alg3.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg3.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg3.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="Q^{\prime}\leftarrow M_{\text{expand}}(q)" class="ltx_Math" display="inline" id="alg3.l2.m1.1"><semantics id="alg3.l2.m1.1a"><mrow id="alg3.l2.m1.1.2" xref="alg3.l2.m1.1.2.cmml"><msup id="alg3.l2.m1.1.2.2" xref="alg3.l2.m1.1.2.2.cmml"><mi id="alg3.l2.m1.1.2.2.2" xref="alg3.l2.m1.1.2.2.2.cmml">Q</mi><mo id="alg3.l2.m1.1.2.2.3" xref="alg3.l2.m1.1.2.2.3.cmml">′</mo></msup><mo id="alg3.l2.m1.1.2.1" stretchy="false" xref="alg3.l2.m1.1.2.1.cmml">←</mo><mrow id="alg3.l2.m1.1.2.3" xref="alg3.l2.m1.1.2.3.cmml"><msub id="alg3.l2.m1.1.2.3.2" xref="alg3.l2.m1.1.2.3.2.cmml"><mi id="alg3.l2.m1.1.2.3.2.2" xref="alg3.l2.m1.1.2.3.2.2.cmml">M</mi><mtext id="alg3.l2.m1.1.2.3.2.3" xref="alg3.l2.m1.1.2.3.2.3a.cmml">expand</mtext></msub><mo id="alg3.l2.m1.1.2.3.1" xref="alg3.l2.m1.1.2.3.1.cmml">⁢</mo><mrow id="alg3.l2.m1.1.2.3.3.2" xref="alg3.l2.m1.1.2.3.cmml"><mo id="alg3.l2.m1.1.2.3.3.2.1" stretchy="false" xref="alg3.l2.m1.1.2.3.cmml">(</mo><mi id="alg3.l2.m1.1.1" xref="alg3.l2.m1.1.1.cmml">q</mi><mo id="alg3.l2.m1.1.2.3.3.2.2" stretchy="false" xref="alg3.l2.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l2.m1.1b"><apply id="alg3.l2.m1.1.2.cmml" xref="alg3.l2.m1.1.2"><ci id="alg3.l2.m1.1.2.1.cmml" xref="alg3.l2.m1.1.2.1">←</ci><apply id="alg3.l2.m1.1.2.2.cmml" xref="alg3.l2.m1.1.2.2"><csymbol cd="ambiguous" id="alg3.l2.m1.1.2.2.1.cmml" xref="alg3.l2.m1.1.2.2">superscript</csymbol><ci id="alg3.l2.m1.1.2.2.2.cmml" xref="alg3.l2.m1.1.2.2.2">𝑄</ci><ci id="alg3.l2.m1.1.2.2.3.cmml" xref="alg3.l2.m1.1.2.2.3">′</ci></apply><apply id="alg3.l2.m1.1.2.3.cmml" xref="alg3.l2.m1.1.2.3"><times id="alg3.l2.m1.1.2.3.1.cmml" xref="alg3.l2.m1.1.2.3.1"></times><apply id="alg3.l2.m1.1.2.3.2.cmml" xref="alg3.l2.m1.1.2.3.2"><csymbol cd="ambiguous" id="alg3.l2.m1.1.2.3.2.1.cmml" xref="alg3.l2.m1.1.2.3.2">subscript</csymbol><ci id="alg3.l2.m1.1.2.3.2.2.cmml" xref="alg3.l2.m1.1.2.3.2.2">𝑀</ci><ci id="alg3.l2.m1.1.2.3.2.3a.cmml" xref="alg3.l2.m1.1.2.3.2.3"><mtext id="alg3.l2.m1.1.2.3.2.3.cmml" mathsize="70%" xref="alg3.l2.m1.1.2.3.2.3">expand</mtext></ci></apply><ci id="alg3.l2.m1.1.1.cmml" xref="alg3.l2.m1.1.1">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l2.m1.1c">Q^{\prime}\leftarrow M_{\text{expand}}(q)</annotation><annotation encoding="application/x-llamapun" id="alg3.l2.m1.1d">italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_M start_POSTSUBSCRIPT expand end_POSTSUBSCRIPT ( italic_q )</annotation></semantics></math> // Expand the original query to multiple sub-queries

</div>
<div class="ltx_listingline" id="alg3.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l3.1.1.1" style="font-size:80%;">3:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l3.2">for all</span> <math alttext="q^{\prime}_{i}\in Q^{\prime}" class="ltx_Math" display="inline" id="alg3.l3.m1.1"><semantics id="alg3.l3.m1.1a"><mrow id="alg3.l3.m1.1.1" xref="alg3.l3.m1.1.1.cmml"><msubsup id="alg3.l3.m1.1.1.2" xref="alg3.l3.m1.1.1.2.cmml"><mi id="alg3.l3.m1.1.1.2.2.2" xref="alg3.l3.m1.1.1.2.2.2.cmml">q</mi><mi id="alg3.l3.m1.1.1.2.3" xref="alg3.l3.m1.1.1.2.3.cmml">i</mi><mo id="alg3.l3.m1.1.1.2.2.3" xref="alg3.l3.m1.1.1.2.2.3.cmml">′</mo></msubsup><mo id="alg3.l3.m1.1.1.1" xref="alg3.l3.m1.1.1.1.cmml">∈</mo><msup id="alg3.l3.m1.1.1.3" xref="alg3.l3.m1.1.1.3.cmml"><mi id="alg3.l3.m1.1.1.3.2" xref="alg3.l3.m1.1.1.3.2.cmml">Q</mi><mo id="alg3.l3.m1.1.1.3.3" xref="alg3.l3.m1.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg3.l3.m1.1b"><apply id="alg3.l3.m1.1.1.cmml" xref="alg3.l3.m1.1.1"><in id="alg3.l3.m1.1.1.1.cmml" xref="alg3.l3.m1.1.1.1"></in><apply id="alg3.l3.m1.1.1.2.cmml" xref="alg3.l3.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l3.m1.1.1.2.1.cmml" xref="alg3.l3.m1.1.1.2">subscript</csymbol><apply id="alg3.l3.m1.1.1.2.2.cmml" xref="alg3.l3.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l3.m1.1.1.2.2.1.cmml" xref="alg3.l3.m1.1.1.2">superscript</csymbol><ci id="alg3.l3.m1.1.1.2.2.2.cmml" xref="alg3.l3.m1.1.1.2.2.2">𝑞</ci><ci id="alg3.l3.m1.1.1.2.2.3.cmml" xref="alg3.l3.m1.1.1.2.2.3">′</ci></apply><ci id="alg3.l3.m1.1.1.2.3.cmml" xref="alg3.l3.m1.1.1.2.3">𝑖</ci></apply><apply id="alg3.l3.m1.1.1.3.cmml" xref="alg3.l3.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l3.m1.1.1.3.1.cmml" xref="alg3.l3.m1.1.1.3">superscript</csymbol><ci id="alg3.l3.m1.1.1.3.2.cmml" xref="alg3.l3.m1.1.1.3.2">𝑄</ci><ci id="alg3.l3.m1.1.1.3.3.cmml" xref="alg3.l3.m1.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l3.m1.1c">q^{\prime}_{i}\in Q^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg3.l3.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg3.l3.3">do</span>
</div>
<div class="ltx_listingline" id="alg3.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l4.1.1.1" style="font-size:80%;">4:</span></span>     <math alttext="D^{\prime}_{i}\leftarrow M_{\text{retrieve}}(q^{\prime}_{i},D)" class="ltx_Math" display="inline" id="alg3.l4.m1.2"><semantics id="alg3.l4.m1.2a"><mrow id="alg3.l4.m1.2.2" xref="alg3.l4.m1.2.2.cmml"><msubsup id="alg3.l4.m1.2.2.3" xref="alg3.l4.m1.2.2.3.cmml"><mi id="alg3.l4.m1.2.2.3.2.2" xref="alg3.l4.m1.2.2.3.2.2.cmml">D</mi><mi id="alg3.l4.m1.2.2.3.3" xref="alg3.l4.m1.2.2.3.3.cmml">i</mi><mo id="alg3.l4.m1.2.2.3.2.3" xref="alg3.l4.m1.2.2.3.2.3.cmml">′</mo></msubsup><mo id="alg3.l4.m1.2.2.2" stretchy="false" xref="alg3.l4.m1.2.2.2.cmml">←</mo><mrow id="alg3.l4.m1.2.2.1" xref="alg3.l4.m1.2.2.1.cmml"><msub id="alg3.l4.m1.2.2.1.3" xref="alg3.l4.m1.2.2.1.3.cmml"><mi id="alg3.l4.m1.2.2.1.3.2" xref="alg3.l4.m1.2.2.1.3.2.cmml">M</mi><mtext id="alg3.l4.m1.2.2.1.3.3" xref="alg3.l4.m1.2.2.1.3.3a.cmml">retrieve</mtext></msub><mo id="alg3.l4.m1.2.2.1.2" xref="alg3.l4.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg3.l4.m1.2.2.1.1.1" xref="alg3.l4.m1.2.2.1.1.2.cmml"><mo id="alg3.l4.m1.2.2.1.1.1.2" stretchy="false" xref="alg3.l4.m1.2.2.1.1.2.cmml">(</mo><msubsup id="alg3.l4.m1.2.2.1.1.1.1" xref="alg3.l4.m1.2.2.1.1.1.1.cmml"><mi id="alg3.l4.m1.2.2.1.1.1.1.2.2" xref="alg3.l4.m1.2.2.1.1.1.1.2.2.cmml">q</mi><mi id="alg3.l4.m1.2.2.1.1.1.1.3" xref="alg3.l4.m1.2.2.1.1.1.1.3.cmml">i</mi><mo id="alg3.l4.m1.2.2.1.1.1.1.2.3" xref="alg3.l4.m1.2.2.1.1.1.1.2.3.cmml">′</mo></msubsup><mo id="alg3.l4.m1.2.2.1.1.1.3" xref="alg3.l4.m1.2.2.1.1.2.cmml">,</mo><mi id="alg3.l4.m1.1.1" xref="alg3.l4.m1.1.1.cmml">D</mi><mo id="alg3.l4.m1.2.2.1.1.1.4" stretchy="false" xref="alg3.l4.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l4.m1.2b"><apply id="alg3.l4.m1.2.2.cmml" xref="alg3.l4.m1.2.2"><ci id="alg3.l4.m1.2.2.2.cmml" xref="alg3.l4.m1.2.2.2">←</ci><apply id="alg3.l4.m1.2.2.3.cmml" xref="alg3.l4.m1.2.2.3"><csymbol cd="ambiguous" id="alg3.l4.m1.2.2.3.1.cmml" xref="alg3.l4.m1.2.2.3">subscript</csymbol><apply id="alg3.l4.m1.2.2.3.2.cmml" xref="alg3.l4.m1.2.2.3"><csymbol cd="ambiguous" id="alg3.l4.m1.2.2.3.2.1.cmml" xref="alg3.l4.m1.2.2.3">superscript</csymbol><ci id="alg3.l4.m1.2.2.3.2.2.cmml" xref="alg3.l4.m1.2.2.3.2.2">𝐷</ci><ci id="alg3.l4.m1.2.2.3.2.3.cmml" xref="alg3.l4.m1.2.2.3.2.3">′</ci></apply><ci id="alg3.l4.m1.2.2.3.3.cmml" xref="alg3.l4.m1.2.2.3.3">𝑖</ci></apply><apply id="alg3.l4.m1.2.2.1.cmml" xref="alg3.l4.m1.2.2.1"><times id="alg3.l4.m1.2.2.1.2.cmml" xref="alg3.l4.m1.2.2.1.2"></times><apply id="alg3.l4.m1.2.2.1.3.cmml" xref="alg3.l4.m1.2.2.1.3"><csymbol cd="ambiguous" id="alg3.l4.m1.2.2.1.3.1.cmml" xref="alg3.l4.m1.2.2.1.3">subscript</csymbol><ci id="alg3.l4.m1.2.2.1.3.2.cmml" xref="alg3.l4.m1.2.2.1.3.2">𝑀</ci><ci id="alg3.l4.m1.2.2.1.3.3a.cmml" xref="alg3.l4.m1.2.2.1.3.3"><mtext id="alg3.l4.m1.2.2.1.3.3.cmml" mathsize="70%" xref="alg3.l4.m1.2.2.1.3.3">retrieve</mtext></ci></apply><interval closure="open" id="alg3.l4.m1.2.2.1.1.2.cmml" xref="alg3.l4.m1.2.2.1.1.1"><apply id="alg3.l4.m1.2.2.1.1.1.1.cmml" xref="alg3.l4.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l4.m1.2.2.1.1.1.1.1.cmml" xref="alg3.l4.m1.2.2.1.1.1.1">subscript</csymbol><apply id="alg3.l4.m1.2.2.1.1.1.1.2.cmml" xref="alg3.l4.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l4.m1.2.2.1.1.1.1.2.1.cmml" xref="alg3.l4.m1.2.2.1.1.1.1">superscript</csymbol><ci id="alg3.l4.m1.2.2.1.1.1.1.2.2.cmml" xref="alg3.l4.m1.2.2.1.1.1.1.2.2">𝑞</ci><ci id="alg3.l4.m1.2.2.1.1.1.1.2.3.cmml" xref="alg3.l4.m1.2.2.1.1.1.1.2.3">′</ci></apply><ci id="alg3.l4.m1.2.2.1.1.1.1.3.cmml" xref="alg3.l4.m1.2.2.1.1.1.1.3">𝑖</ci></apply><ci id="alg3.l4.m1.1.1.cmml" xref="alg3.l4.m1.1.1">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l4.m1.2c">D^{\prime}_{i}\leftarrow M_{\text{retrieve}}(q^{\prime}_{i},D)</annotation><annotation encoding="application/x-llamapun" id="alg3.l4.m1.2d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_D )</annotation></semantics></math> // Retrieve documents for each sub-query

</div>
<div class="ltx_listingline" id="alg3.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l5.1.1.1" style="font-size:80%;">5:</span></span>     <math alttext="G_{i}\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg3.l5.m1.1"><semantics id="alg3.l5.m1.1a"><mrow id="alg3.l5.m1.1.1" xref="alg3.l5.m1.1.1.cmml"><msub id="alg3.l5.m1.1.1.2" xref="alg3.l5.m1.1.1.2.cmml"><mi id="alg3.l5.m1.1.1.2.2" xref="alg3.l5.m1.1.1.2.2.cmml">G</mi><mi id="alg3.l5.m1.1.1.2.3" xref="alg3.l5.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg3.l5.m1.1.1.1" stretchy="false" xref="alg3.l5.m1.1.1.1.cmml">←</mo><mi id="alg3.l5.m1.1.1.3" mathvariant="normal" xref="alg3.l5.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l5.m1.1b"><apply id="alg3.l5.m1.1.1.cmml" xref="alg3.l5.m1.1.1"><ci id="alg3.l5.m1.1.1.1.cmml" xref="alg3.l5.m1.1.1.1">←</ci><apply id="alg3.l5.m1.1.1.2.cmml" xref="alg3.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l5.m1.1.1.2.1.cmml" xref="alg3.l5.m1.1.1.2">subscript</csymbol><ci id="alg3.l5.m1.1.1.2.2.cmml" xref="alg3.l5.m1.1.1.2.2">𝐺</ci><ci id="alg3.l5.m1.1.1.2.3.cmml" xref="alg3.l5.m1.1.1.2.3">𝑖</ci></apply><emptyset id="alg3.l5.m1.1.1.3.cmml" xref="alg3.l5.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l5.m1.1c">G_{i}\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg3.l5.m1.1d">italic_G start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← ∅</annotation></semantics></math> // Initialize an empty set for generated results of the sub-query

</div>
<div class="ltx_listingline" id="alg3.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l6.1.1.1" style="font-size:80%;">6:</span></span>     <span class="ltx_text ltx_font_bold" id="alg3.l6.2">for all</span> <math alttext="d^{\prime}_{ij}\in D^{\prime}_{i}" class="ltx_Math" display="inline" id="alg3.l6.m1.1"><semantics id="alg3.l6.m1.1a"><mrow id="alg3.l6.m1.1.1" xref="alg3.l6.m1.1.1.cmml"><msubsup id="alg3.l6.m1.1.1.2" xref="alg3.l6.m1.1.1.2.cmml"><mi id="alg3.l6.m1.1.1.2.2.2" xref="alg3.l6.m1.1.1.2.2.2.cmml">d</mi><mrow id="alg3.l6.m1.1.1.2.3" xref="alg3.l6.m1.1.1.2.3.cmml"><mi id="alg3.l6.m1.1.1.2.3.2" xref="alg3.l6.m1.1.1.2.3.2.cmml">i</mi><mo id="alg3.l6.m1.1.1.2.3.1" xref="alg3.l6.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg3.l6.m1.1.1.2.3.3" xref="alg3.l6.m1.1.1.2.3.3.cmml">j</mi></mrow><mo id="alg3.l6.m1.1.1.2.2.3" xref="alg3.l6.m1.1.1.2.2.3.cmml">′</mo></msubsup><mo id="alg3.l6.m1.1.1.1" xref="alg3.l6.m1.1.1.1.cmml">∈</mo><msubsup id="alg3.l6.m1.1.1.3" xref="alg3.l6.m1.1.1.3.cmml"><mi id="alg3.l6.m1.1.1.3.2.2" xref="alg3.l6.m1.1.1.3.2.2.cmml">D</mi><mi id="alg3.l6.m1.1.1.3.3" xref="alg3.l6.m1.1.1.3.3.cmml">i</mi><mo id="alg3.l6.m1.1.1.3.2.3" xref="alg3.l6.m1.1.1.3.2.3.cmml">′</mo></msubsup></mrow><annotation-xml encoding="MathML-Content" id="alg3.l6.m1.1b"><apply id="alg3.l6.m1.1.1.cmml" xref="alg3.l6.m1.1.1"><in id="alg3.l6.m1.1.1.1.cmml" xref="alg3.l6.m1.1.1.1"></in><apply id="alg3.l6.m1.1.1.2.cmml" xref="alg3.l6.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.2.1.cmml" xref="alg3.l6.m1.1.1.2">subscript</csymbol><apply id="alg3.l6.m1.1.1.2.2.cmml" xref="alg3.l6.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.2.2.1.cmml" xref="alg3.l6.m1.1.1.2">superscript</csymbol><ci id="alg3.l6.m1.1.1.2.2.2.cmml" xref="alg3.l6.m1.1.1.2.2.2">𝑑</ci><ci id="alg3.l6.m1.1.1.2.2.3.cmml" xref="alg3.l6.m1.1.1.2.2.3">′</ci></apply><apply id="alg3.l6.m1.1.1.2.3.cmml" xref="alg3.l6.m1.1.1.2.3"><times id="alg3.l6.m1.1.1.2.3.1.cmml" xref="alg3.l6.m1.1.1.2.3.1"></times><ci id="alg3.l6.m1.1.1.2.3.2.cmml" xref="alg3.l6.m1.1.1.2.3.2">𝑖</ci><ci id="alg3.l6.m1.1.1.2.3.3.cmml" xref="alg3.l6.m1.1.1.2.3.3">𝑗</ci></apply></apply><apply id="alg3.l6.m1.1.1.3.cmml" xref="alg3.l6.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.3.1.cmml" xref="alg3.l6.m1.1.1.3">subscript</csymbol><apply id="alg3.l6.m1.1.1.3.2.cmml" xref="alg3.l6.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.3.2.1.cmml" xref="alg3.l6.m1.1.1.3">superscript</csymbol><ci id="alg3.l6.m1.1.1.3.2.2.cmml" xref="alg3.l6.m1.1.1.3.2.2">𝐷</ci><ci id="alg3.l6.m1.1.1.3.2.3.cmml" xref="alg3.l6.m1.1.1.3.2.3">′</ci></apply><ci id="alg3.l6.m1.1.1.3.3.cmml" xref="alg3.l6.m1.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l6.m1.1c">d^{\prime}_{ij}\in D^{\prime}_{i}</annotation><annotation encoding="application/x-llamapun" id="alg3.l6.m1.1d">italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ∈ italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg3.l6.3">do</span>
</div>
<div class="ltx_listingline" id="alg3.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l7.1.1.1" style="font-size:80%;">7:</span></span>        <math alttext="y_{ij}\leftarrow LLM([q^{\prime}_{i},d^{\prime}_{ij}])" class="ltx_Math" display="inline" id="alg3.l7.m1.1"><semantics id="alg3.l7.m1.1a"><mrow id="alg3.l7.m1.1.1" xref="alg3.l7.m1.1.1.cmml"><msub id="alg3.l7.m1.1.1.3" xref="alg3.l7.m1.1.1.3.cmml"><mi id="alg3.l7.m1.1.1.3.2" xref="alg3.l7.m1.1.1.3.2.cmml">y</mi><mrow id="alg3.l7.m1.1.1.3.3" xref="alg3.l7.m1.1.1.3.3.cmml"><mi id="alg3.l7.m1.1.1.3.3.2" xref="alg3.l7.m1.1.1.3.3.2.cmml">i</mi><mo id="alg3.l7.m1.1.1.3.3.1" xref="alg3.l7.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg3.l7.m1.1.1.3.3.3" xref="alg3.l7.m1.1.1.3.3.3.cmml">j</mi></mrow></msub><mo id="alg3.l7.m1.1.1.2" stretchy="false" xref="alg3.l7.m1.1.1.2.cmml">←</mo><mrow id="alg3.l7.m1.1.1.1" xref="alg3.l7.m1.1.1.1.cmml"><mi id="alg3.l7.m1.1.1.1.3" xref="alg3.l7.m1.1.1.1.3.cmml">L</mi><mo id="alg3.l7.m1.1.1.1.2" xref="alg3.l7.m1.1.1.1.2.cmml">⁢</mo><mi id="alg3.l7.m1.1.1.1.4" xref="alg3.l7.m1.1.1.1.4.cmml">L</mi><mo id="alg3.l7.m1.1.1.1.2a" xref="alg3.l7.m1.1.1.1.2.cmml">⁢</mo><mi id="alg3.l7.m1.1.1.1.5" xref="alg3.l7.m1.1.1.1.5.cmml">M</mi><mo id="alg3.l7.m1.1.1.1.2b" xref="alg3.l7.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg3.l7.m1.1.1.1.1.1" xref="alg3.l7.m1.1.1.1.cmml"><mo id="alg3.l7.m1.1.1.1.1.1.2" stretchy="false" xref="alg3.l7.m1.1.1.1.cmml">(</mo><mrow id="alg3.l7.m1.1.1.1.1.1.1.2" xref="alg3.l7.m1.1.1.1.1.1.1.3.cmml"><mo id="alg3.l7.m1.1.1.1.1.1.1.2.3" stretchy="false" xref="alg3.l7.m1.1.1.1.1.1.1.3.cmml">[</mo><msubsup id="alg3.l7.m1.1.1.1.1.1.1.1.1" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.cmml"><mi id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.2" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.2.2.cmml">q</mi><mi id="alg3.l7.m1.1.1.1.1.1.1.1.1.3" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.3.cmml">i</mi><mo id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.3" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.2.3.cmml">′</mo></msubsup><mo id="alg3.l7.m1.1.1.1.1.1.1.2.4" xref="alg3.l7.m1.1.1.1.1.1.1.3.cmml">,</mo><msubsup id="alg3.l7.m1.1.1.1.1.1.1.2.2" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.cmml"><mi id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.2" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.2.2.cmml">d</mi><mrow id="alg3.l7.m1.1.1.1.1.1.1.2.2.3" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.cmml"><mi id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.2" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.2.cmml">i</mi><mo id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.1" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.1.cmml">⁢</mo><mi id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.3" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.3.cmml">j</mi></mrow><mo id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.3" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.2.3.cmml">′</mo></msubsup><mo id="alg3.l7.m1.1.1.1.1.1.1.2.5" stretchy="false" xref="alg3.l7.m1.1.1.1.1.1.1.3.cmml">]</mo></mrow><mo id="alg3.l7.m1.1.1.1.1.1.3" stretchy="false" xref="alg3.l7.m1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l7.m1.1b"><apply id="alg3.l7.m1.1.1.cmml" xref="alg3.l7.m1.1.1"><ci id="alg3.l7.m1.1.1.2.cmml" xref="alg3.l7.m1.1.1.2">←</ci><apply id="alg3.l7.m1.1.1.3.cmml" xref="alg3.l7.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.3.1.cmml" xref="alg3.l7.m1.1.1.3">subscript</csymbol><ci id="alg3.l7.m1.1.1.3.2.cmml" xref="alg3.l7.m1.1.1.3.2">𝑦</ci><apply id="alg3.l7.m1.1.1.3.3.cmml" xref="alg3.l7.m1.1.1.3.3"><times id="alg3.l7.m1.1.1.3.3.1.cmml" xref="alg3.l7.m1.1.1.3.3.1"></times><ci id="alg3.l7.m1.1.1.3.3.2.cmml" xref="alg3.l7.m1.1.1.3.3.2">𝑖</ci><ci id="alg3.l7.m1.1.1.3.3.3.cmml" xref="alg3.l7.m1.1.1.3.3.3">𝑗</ci></apply></apply><apply id="alg3.l7.m1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1"><times id="alg3.l7.m1.1.1.1.2.cmml" xref="alg3.l7.m1.1.1.1.2"></times><ci id="alg3.l7.m1.1.1.1.3.cmml" xref="alg3.l7.m1.1.1.1.3">𝐿</ci><ci id="alg3.l7.m1.1.1.1.4.cmml" xref="alg3.l7.m1.1.1.1.4">𝐿</ci><ci id="alg3.l7.m1.1.1.1.5.cmml" xref="alg3.l7.m1.1.1.1.5">𝑀</ci><interval closure="closed" id="alg3.l7.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2"><apply id="alg3.l7.m1.1.1.1.1.1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.1.1.1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.2.2">𝑞</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.1.1.2.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.2.3">′</ci></apply><ci id="alg3.l7.m1.1.1.1.1.1.1.1.1.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="alg3.l7.m1.1.1.1.1.1.1.2.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.1.1.1.2.2.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2">subscript</csymbol><apply id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2">superscript</csymbol><ci id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.2.2">𝑑</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.2.2.2.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.2.3">′</ci></apply><apply id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3"><times id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.1"></times><ci id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.2">𝑖</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.2.2.3.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2.2.3.3">𝑗</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l7.m1.1c">y_{ij}\leftarrow LLM([q^{\prime}_{i},d^{\prime}_{ij}])</annotation><annotation encoding="application/x-llamapun" id="alg3.l7.m1.1d">italic_y start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ← italic_L italic_L italic_M ( [ italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ] )</annotation></semantics></math> // Generate results for each document of the sub-query

</div>
<div class="ltx_listingline" id="alg3.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l8.1.1.1" style="font-size:80%;">8:</span></span>        <math alttext="O_{i}\leftarrow O_{i}\cup\{y_{ij}\}" class="ltx_Math" display="inline" id="alg3.l8.m1.1"><semantics id="alg3.l8.m1.1a"><mrow id="alg3.l8.m1.1.1" xref="alg3.l8.m1.1.1.cmml"><msub id="alg3.l8.m1.1.1.3" xref="alg3.l8.m1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.3.2" xref="alg3.l8.m1.1.1.3.2.cmml">O</mi><mi id="alg3.l8.m1.1.1.3.3" xref="alg3.l8.m1.1.1.3.3.cmml">i</mi></msub><mo id="alg3.l8.m1.1.1.2" stretchy="false" xref="alg3.l8.m1.1.1.2.cmml">←</mo><mrow id="alg3.l8.m1.1.1.1" xref="alg3.l8.m1.1.1.1.cmml"><msub id="alg3.l8.m1.1.1.1.3" xref="alg3.l8.m1.1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.1.3.2" xref="alg3.l8.m1.1.1.1.3.2.cmml">O</mi><mi id="alg3.l8.m1.1.1.1.3.3" xref="alg3.l8.m1.1.1.1.3.3.cmml">i</mi></msub><mo id="alg3.l8.m1.1.1.1.2" xref="alg3.l8.m1.1.1.1.2.cmml">∪</mo><mrow id="alg3.l8.m1.1.1.1.1.1" xref="alg3.l8.m1.1.1.1.1.2.cmml"><mo id="alg3.l8.m1.1.1.1.1.1.2" stretchy="false" xref="alg3.l8.m1.1.1.1.1.2.cmml">{</mo><msub id="alg3.l8.m1.1.1.1.1.1.1" xref="alg3.l8.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l8.m1.1.1.1.1.1.1.2" xref="alg3.l8.m1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg3.l8.m1.1.1.1.1.1.1.3" xref="alg3.l8.m1.1.1.1.1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.1.1.1.1.3.2" xref="alg3.l8.m1.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="alg3.l8.m1.1.1.1.1.1.1.3.1" xref="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="alg3.l8.m1.1.1.1.1.1.1.3.3" xref="alg3.l8.m1.1.1.1.1.1.1.3.3.cmml">j</mi></mrow></msub><mo id="alg3.l8.m1.1.1.1.1.1.3" stretchy="false" xref="alg3.l8.m1.1.1.1.1.2.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l8.m1.1b"><apply id="alg3.l8.m1.1.1.cmml" xref="alg3.l8.m1.1.1"><ci id="alg3.l8.m1.1.1.2.cmml" xref="alg3.l8.m1.1.1.2">←</ci><apply id="alg3.l8.m1.1.1.3.cmml" xref="alg3.l8.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l8.m1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.3">subscript</csymbol><ci id="alg3.l8.m1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.3.2">𝑂</ci><ci id="alg3.l8.m1.1.1.3.3.cmml" xref="alg3.l8.m1.1.1.3.3">𝑖</ci></apply><apply id="alg3.l8.m1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1"><union id="alg3.l8.m1.1.1.1.2.cmml" xref="alg3.l8.m1.1.1.1.2"></union><apply id="alg3.l8.m1.1.1.1.3.cmml" xref="alg3.l8.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg3.l8.m1.1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.1.3">subscript</csymbol><ci id="alg3.l8.m1.1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.1.3.2">𝑂</ci><ci id="alg3.l8.m1.1.1.1.3.3.cmml" xref="alg3.l8.m1.1.1.1.3.3">𝑖</ci></apply><set id="alg3.l8.m1.1.1.1.1.2.cmml" xref="alg3.l8.m1.1.1.1.1.1"><apply id="alg3.l8.m1.1.1.1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l8.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg3.l8.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg3.l8.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3"><times id="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.1"></times><ci id="alg3.l8.m1.1.1.1.1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="alg3.l8.m1.1.1.1.1.1.1.3.3.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.3">𝑗</ci></apply></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l8.m1.1c">O_{i}\leftarrow O_{i}\cup\{y_{ij}\}</annotation><annotation encoding="application/x-llamapun" id="alg3.l8.m1.1d">italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∪ { italic_y start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT }</annotation></semantics></math> // Add generated results to the set

</div>
<div class="ltx_listingline" id="alg3.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l9.1.1.1" style="font-size:80%;">9:</span></span>     <span class="ltx_text ltx_font_bold" id="alg3.l9.2">end</span> <span class="ltx_text ltx_font_bold" id="alg3.l9.3">for</span>
</div>
<div class="ltx_listingline" id="alg3.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l10.1.1.1" style="font-size:80%;">10:</span></span>     <math alttext="\hat{y}\leftarrow M_{\text{merge}}(O_{i})" class="ltx_Math" display="inline" id="alg3.l10.m1.1"><semantics id="alg3.l10.m1.1a"><mrow id="alg3.l10.m1.1.1" xref="alg3.l10.m1.1.1.cmml"><mover accent="true" id="alg3.l10.m1.1.1.3" xref="alg3.l10.m1.1.1.3.cmml"><mi id="alg3.l10.m1.1.1.3.2" xref="alg3.l10.m1.1.1.3.2.cmml">y</mi><mo id="alg3.l10.m1.1.1.3.1" xref="alg3.l10.m1.1.1.3.1.cmml">^</mo></mover><mo id="alg3.l10.m1.1.1.2" stretchy="false" xref="alg3.l10.m1.1.1.2.cmml">←</mo><mrow id="alg3.l10.m1.1.1.1" xref="alg3.l10.m1.1.1.1.cmml"><msub id="alg3.l10.m1.1.1.1.3" xref="alg3.l10.m1.1.1.1.3.cmml"><mi id="alg3.l10.m1.1.1.1.3.2" xref="alg3.l10.m1.1.1.1.3.2.cmml">M</mi><mtext id="alg3.l10.m1.1.1.1.3.3" xref="alg3.l10.m1.1.1.1.3.3a.cmml">merge</mtext></msub><mo id="alg3.l10.m1.1.1.1.2" xref="alg3.l10.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg3.l10.m1.1.1.1.1.1" xref="alg3.l10.m1.1.1.1.1.1.1.cmml"><mo id="alg3.l10.m1.1.1.1.1.1.2" stretchy="false" xref="alg3.l10.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg3.l10.m1.1.1.1.1.1.1" xref="alg3.l10.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l10.m1.1.1.1.1.1.1.2" xref="alg3.l10.m1.1.1.1.1.1.1.2.cmml">O</mi><mi id="alg3.l10.m1.1.1.1.1.1.1.3" xref="alg3.l10.m1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="alg3.l10.m1.1.1.1.1.1.3" stretchy="false" xref="alg3.l10.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l10.m1.1b"><apply id="alg3.l10.m1.1.1.cmml" xref="alg3.l10.m1.1.1"><ci id="alg3.l10.m1.1.1.2.cmml" xref="alg3.l10.m1.1.1.2">←</ci><apply id="alg3.l10.m1.1.1.3.cmml" xref="alg3.l10.m1.1.1.3"><ci id="alg3.l10.m1.1.1.3.1.cmml" xref="alg3.l10.m1.1.1.3.1">^</ci><ci id="alg3.l10.m1.1.1.3.2.cmml" xref="alg3.l10.m1.1.1.3.2">𝑦</ci></apply><apply id="alg3.l10.m1.1.1.1.cmml" xref="alg3.l10.m1.1.1.1"><times id="alg3.l10.m1.1.1.1.2.cmml" xref="alg3.l10.m1.1.1.1.2"></times><apply id="alg3.l10.m1.1.1.1.3.cmml" xref="alg3.l10.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg3.l10.m1.1.1.1.3.1.cmml" xref="alg3.l10.m1.1.1.1.3">subscript</csymbol><ci id="alg3.l10.m1.1.1.1.3.2.cmml" xref="alg3.l10.m1.1.1.1.3.2">𝑀</ci><ci id="alg3.l10.m1.1.1.1.3.3a.cmml" xref="alg3.l10.m1.1.1.1.3.3"><mtext id="alg3.l10.m1.1.1.1.3.3.cmml" mathsize="70%" xref="alg3.l10.m1.1.1.1.3.3">merge</mtext></ci></apply><apply id="alg3.l10.m1.1.1.1.1.1.1.cmml" xref="alg3.l10.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l10.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l10.m1.1.1.1.1.1">subscript</csymbol><ci id="alg3.l10.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l10.m1.1.1.1.1.1.1.2">𝑂</ci><ci id="alg3.l10.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l10.m1.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l10.m1.1c">\hat{y}\leftarrow M_{\text{merge}}(O_{i})</annotation><annotation encoding="application/x-llamapun" id="alg3.l10.m1.1d">over^ start_ARG italic_y end_ARG ← italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> // Merge generated results of the sub-query into the final result

</div>
<div class="ltx_listingline" id="alg3.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l11.1.1.1" style="font-size:80%;">11:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l11.2">end</span> <span class="ltx_text ltx_font_bold" id="alg3.l11.3">for</span>
</div>
<div class="ltx_listingline" id="alg3.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l12.1.1.1" style="font-size:80%;">12:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l12.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg3.l12.m1.1"><semantics id="alg3.l12.m1.1a"><mover accent="true" id="alg3.l12.m1.1.1" xref="alg3.l12.m1.1.1.cmml"><mi id="alg3.l12.m1.1.1.2" xref="alg3.l12.m1.1.1.2.cmml">y</mi><mo id="alg3.l12.m1.1.1.1" xref="alg3.l12.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg3.l12.m1.1b"><apply id="alg3.l12.m1.1.1.cmml" xref="alg3.l12.m1.1.1"><ci id="alg3.l12.m1.1.1.1.cmml" xref="alg3.l12.m1.1.1.1">^</ci><ci id="alg3.l12.m1.1.1.2.cmml" xref="alg3.l12.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l12.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg3.l12.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
<br class="ltx_break ltx_break"/>
</figure>
<div class="ltx_para" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.1">The RAG flow with a branching structure differs from the conditional approach in that it involves multiple parallel branches, as opposed to selecting one branch from multiple options in the conditional approach. Structurally, it can be categorized into two types, which are depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F7" title="Figure 7 ‣ V-B Conditional Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">7</span></a> and Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F8" title="Figure 8 ‣ V-B Conditional Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">8</span></a>.</p>
</div>
<div class="ltx_para" id="S5.SS3.p3">
<p class="ltx_p" id="S5.SS3.p3.10"><span class="ltx_text ltx_font_bold" id="S5.SS3.p3.10.1">Pre-Retrieval Branching </span>(Multi-Query, Parallel Retrieval)<span class="ltx_text ltx_font_bold" id="S5.SS3.p3.10.2">.</span> As shown in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg3" title="Algorithm 3 ‣ V-C Branching ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">3</span></a>, the process involves initially taking a query <math alttext="q" class="ltx_Math" display="inline" id="S5.SS3.p3.1.m1.1"><semantics id="S5.SS3.p3.1.m1.1a"><mi id="S5.SS3.p3.1.m1.1.1" xref="S5.SS3.p3.1.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.1.m1.1b"><ci id="S5.SS3.p3.1.m1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.1.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.1.m1.1d">italic_q</annotation></semantics></math> and expanding it through a module <math alttext="M_{\text{expand}}" class="ltx_Math" display="inline" id="S5.SS3.p3.2.m2.1"><semantics id="S5.SS3.p3.2.m2.1a"><msub id="S5.SS3.p3.2.m2.1.1" xref="S5.SS3.p3.2.m2.1.1.cmml"><mi id="S5.SS3.p3.2.m2.1.1.2" xref="S5.SS3.p3.2.m2.1.1.2.cmml">M</mi><mtext id="S5.SS3.p3.2.m2.1.1.3" xref="S5.SS3.p3.2.m2.1.1.3a.cmml">expand</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.2.m2.1b"><apply id="S5.SS3.p3.2.m2.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.2.m2.1.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.p3.2.m2.1.1.2.cmml" xref="S5.SS3.p3.2.m2.1.1.2">𝑀</ci><ci id="S5.SS3.p3.2.m2.1.1.3a.cmml" xref="S5.SS3.p3.2.m2.1.1.3"><mtext id="S5.SS3.p3.2.m2.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p3.2.m2.1.1.3">expand</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.2.m2.1c">M_{\text{expand}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.2.m2.1d">italic_M start_POSTSUBSCRIPT expand end_POSTSUBSCRIPT</annotation></semantics></math> to generate multiple sub-queries <math alttext="Q^{\prime}" class="ltx_Math" display="inline" id="S5.SS3.p3.3.m3.1"><semantics id="S5.SS3.p3.3.m3.1a"><msup id="S5.SS3.p3.3.m3.1.1" xref="S5.SS3.p3.3.m3.1.1.cmml"><mi id="S5.SS3.p3.3.m3.1.1.2" xref="S5.SS3.p3.3.m3.1.1.2.cmml">Q</mi><mo id="S5.SS3.p3.3.m3.1.1.3" xref="S5.SS3.p3.3.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.3.m3.1b"><apply id="S5.SS3.p3.3.m3.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.3.m3.1.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1">superscript</csymbol><ci id="S5.SS3.p3.3.m3.1.1.2.cmml" xref="S5.SS3.p3.3.m3.1.1.2">𝑄</ci><ci id="S5.SS3.p3.3.m3.1.1.3.cmml" xref="S5.SS3.p3.3.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.3.m3.1c">Q^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.3.m3.1d">italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>. Each sub-query <math alttext="q^{\prime}_{i}" class="ltx_Math" display="inline" id="S5.SS3.p3.4.m4.1"><semantics id="S5.SS3.p3.4.m4.1a"><msubsup id="S5.SS3.p3.4.m4.1.1" xref="S5.SS3.p3.4.m4.1.1.cmml"><mi id="S5.SS3.p3.4.m4.1.1.2.2" xref="S5.SS3.p3.4.m4.1.1.2.2.cmml">q</mi><mi id="S5.SS3.p3.4.m4.1.1.3" xref="S5.SS3.p3.4.m4.1.1.3.cmml">i</mi><mo id="S5.SS3.p3.4.m4.1.1.2.3" xref="S5.SS3.p3.4.m4.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.4.m4.1b"><apply id="S5.SS3.p3.4.m4.1.1.cmml" xref="S5.SS3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.1.1.1.cmml" xref="S5.SS3.p3.4.m4.1.1">subscript</csymbol><apply id="S5.SS3.p3.4.m4.1.1.2.cmml" xref="S5.SS3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.1.1.2.1.cmml" xref="S5.SS3.p3.4.m4.1.1">superscript</csymbol><ci id="S5.SS3.p3.4.m4.1.1.2.2.cmml" xref="S5.SS3.p3.4.m4.1.1.2.2">𝑞</ci><ci id="S5.SS3.p3.4.m4.1.1.2.3.cmml" xref="S5.SS3.p3.4.m4.1.1.2.3">′</ci></apply><ci id="S5.SS3.p3.4.m4.1.1.3.cmml" xref="S5.SS3.p3.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.4.m4.1c">q^{\prime}_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.4.m4.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is then used to retrieve relevant documents via <math alttext="M_{\text{retrieve}}" class="ltx_Math" display="inline" id="S5.SS3.p3.5.m5.1"><semantics id="S5.SS3.p3.5.m5.1a"><msub id="S5.SS3.p3.5.m5.1.1" xref="S5.SS3.p3.5.m5.1.1.cmml"><mi id="S5.SS3.p3.5.m5.1.1.2" xref="S5.SS3.p3.5.m5.1.1.2.cmml">M</mi><mtext id="S5.SS3.p3.5.m5.1.1.3" xref="S5.SS3.p3.5.m5.1.1.3a.cmml">retrieve</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.5.m5.1b"><apply id="S5.SS3.p3.5.m5.1.1.cmml" xref="S5.SS3.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.5.m5.1.1.1.cmml" xref="S5.SS3.p3.5.m5.1.1">subscript</csymbol><ci id="S5.SS3.p3.5.m5.1.1.2.cmml" xref="S5.SS3.p3.5.m5.1.1.2">𝑀</ci><ci id="S5.SS3.p3.5.m5.1.1.3a.cmml" xref="S5.SS3.p3.5.m5.1.1.3"><mtext id="S5.SS3.p3.5.m5.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p3.5.m5.1.1.3">retrieve</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.5.m5.1c">M_{\text{retrieve}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.5.m5.1d">italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT</annotation></semantics></math>, forming document sets <math alttext="D^{\prime}_{i}" class="ltx_Math" display="inline" id="S5.SS3.p3.6.m6.1"><semantics id="S5.SS3.p3.6.m6.1a"><msubsup id="S5.SS3.p3.6.m6.1.1" xref="S5.SS3.p3.6.m6.1.1.cmml"><mi id="S5.SS3.p3.6.m6.1.1.2.2" xref="S5.SS3.p3.6.m6.1.1.2.2.cmml">D</mi><mi id="S5.SS3.p3.6.m6.1.1.3" xref="S5.SS3.p3.6.m6.1.1.3.cmml">i</mi><mo id="S5.SS3.p3.6.m6.1.1.2.3" xref="S5.SS3.p3.6.m6.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.6.m6.1b"><apply id="S5.SS3.p3.6.m6.1.1.cmml" xref="S5.SS3.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.6.m6.1.1.1.cmml" xref="S5.SS3.p3.6.m6.1.1">subscript</csymbol><apply id="S5.SS3.p3.6.m6.1.1.2.cmml" xref="S5.SS3.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.6.m6.1.1.2.1.cmml" xref="S5.SS3.p3.6.m6.1.1">superscript</csymbol><ci id="S5.SS3.p3.6.m6.1.1.2.2.cmml" xref="S5.SS3.p3.6.m6.1.1.2.2">𝐷</ci><ci id="S5.SS3.p3.6.m6.1.1.2.3.cmml" xref="S5.SS3.p3.6.m6.1.1.2.3">′</ci></apply><ci id="S5.SS3.p3.6.m6.1.1.3.cmml" xref="S5.SS3.p3.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.6.m6.1c">D^{\prime}_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.6.m6.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. These document sets, along with the corresponding sub-queries, are fed into a generation module <math alttext="M_{\text{generate}}" class="ltx_Math" display="inline" id="S5.SS3.p3.7.m7.1"><semantics id="S5.SS3.p3.7.m7.1a"><msub id="S5.SS3.p3.7.m7.1.1" xref="S5.SS3.p3.7.m7.1.1.cmml"><mi id="S5.SS3.p3.7.m7.1.1.2" xref="S5.SS3.p3.7.m7.1.1.2.cmml">M</mi><mtext id="S5.SS3.p3.7.m7.1.1.3" xref="S5.SS3.p3.7.m7.1.1.3a.cmml">generate</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.7.m7.1b"><apply id="S5.SS3.p3.7.m7.1.1.cmml" xref="S5.SS3.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.7.m7.1.1.1.cmml" xref="S5.SS3.p3.7.m7.1.1">subscript</csymbol><ci id="S5.SS3.p3.7.m7.1.1.2.cmml" xref="S5.SS3.p3.7.m7.1.1.2">𝑀</ci><ci id="S5.SS3.p3.7.m7.1.1.3a.cmml" xref="S5.SS3.p3.7.m7.1.1.3"><mtext id="S5.SS3.p3.7.m7.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p3.7.m7.1.1.3">generate</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.7.m7.1c">M_{\text{generate}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.7.m7.1d">italic_M start_POSTSUBSCRIPT generate end_POSTSUBSCRIPT</annotation></semantics></math> to produce a set of answers <math alttext="G_{i}" class="ltx_Math" display="inline" id="S5.SS3.p3.8.m8.1"><semantics id="S5.SS3.p3.8.m8.1a"><msub id="S5.SS3.p3.8.m8.1.1" xref="S5.SS3.p3.8.m8.1.1.cmml"><mi id="S5.SS3.p3.8.m8.1.1.2" xref="S5.SS3.p3.8.m8.1.1.2.cmml">G</mi><mi id="S5.SS3.p3.8.m8.1.1.3" xref="S5.SS3.p3.8.m8.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.8.m8.1b"><apply id="S5.SS3.p3.8.m8.1.1.cmml" xref="S5.SS3.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.8.m8.1.1.1.cmml" xref="S5.SS3.p3.8.m8.1.1">subscript</csymbol><ci id="S5.SS3.p3.8.m8.1.1.2.cmml" xref="S5.SS3.p3.8.m8.1.1.2">𝐺</ci><ci id="S5.SS3.p3.8.m8.1.1.3.cmml" xref="S5.SS3.p3.8.m8.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.8.m8.1c">G_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.8.m8.1d">italic_G start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. Ultimately, all these generated answers are combined using a merging module <math alttext="M_{\text{merge}}" class="ltx_Math" display="inline" id="S5.SS3.p3.9.m9.1"><semantics id="S5.SS3.p3.9.m9.1a"><msub id="S5.SS3.p3.9.m9.1.1" xref="S5.SS3.p3.9.m9.1.1.cmml"><mi id="S5.SS3.p3.9.m9.1.1.2" xref="S5.SS3.p3.9.m9.1.1.2.cmml">M</mi><mtext id="S5.SS3.p3.9.m9.1.1.3" xref="S5.SS3.p3.9.m9.1.1.3a.cmml">merge</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.9.m9.1b"><apply id="S5.SS3.p3.9.m9.1.1.cmml" xref="S5.SS3.p3.9.m9.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.9.m9.1.1.1.cmml" xref="S5.SS3.p3.9.m9.1.1">subscript</csymbol><ci id="S5.SS3.p3.9.m9.1.1.2.cmml" xref="S5.SS3.p3.9.m9.1.1.2">𝑀</ci><ci id="S5.SS3.p3.9.m9.1.1.3a.cmml" xref="S5.SS3.p3.9.m9.1.1.3"><mtext id="S5.SS3.p3.9.m9.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p3.9.m9.1.1.3">merge</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.9.m9.1c">M_{\text{merge}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.9.m9.1d">italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT</annotation></semantics></math> to form the final result <math alttext="y" class="ltx_Math" display="inline" id="S5.SS3.p3.10.m10.1"><semantics id="S5.SS3.p3.10.m10.1a"><mi id="S5.SS3.p3.10.m10.1.1" xref="S5.SS3.p3.10.m10.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.10.m10.1b"><ci id="S5.SS3.p3.10.m10.1.1.cmml" xref="S5.SS3.p3.10.m10.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.10.m10.1c">y</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.10.m10.1d">italic_y</annotation></semantics></math>. This entire flow can be mathematically represented as:</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E28">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}\mathcal{P}_{branch_{pre}}=&amp;M_{\text{merge}}(_{q^{\prime}_{i}\in M%
_{\text{expand}}(q)}\{M_{\text{generate}}(q^{\prime}_{i},d^{\prime}_{ij})\mid%
\\
&amp;d^{\prime}_{ij}\in M_{\text{retrieve}}(q^{\prime}_{i})\})\end{split}" class="ltx_math_unparsed" display="block" id="S5.E28.m1.33"><semantics id="S5.E28.m1.33a"><mtable columnspacing="0pt" displaystyle="true" id="S5.E28.m1.33.33" rowspacing="0pt"><mtr id="S5.E28.m1.33.33a"><mtd class="ltx_align_right" columnalign="right" id="S5.E28.m1.33.33b"><mrow id="S5.E28.m1.3.3.3.3.3"><msub id="S5.E28.m1.3.3.3.3.3.4"><mi class="ltx_font_mathcaligraphic" id="S5.E28.m1.1.1.1.1.1.1">𝒫</mi><mrow id="S5.E28.m1.2.2.2.2.2.2.1"><mi id="S5.E28.m1.2.2.2.2.2.2.1.2">b</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.1">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.3">r</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.1a">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.4">a</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.1b">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.5">n</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.1c">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.6">c</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.1d">⁢</mo><msub id="S5.E28.m1.2.2.2.2.2.2.1.7"><mi id="S5.E28.m1.2.2.2.2.2.2.1.7.2">h</mi><mrow id="S5.E28.m1.2.2.2.2.2.2.1.7.3"><mi id="S5.E28.m1.2.2.2.2.2.2.1.7.3.2">p</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.7.3.1">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.7.3.3">r</mi><mo id="S5.E28.m1.2.2.2.2.2.2.1.7.3.1a">⁢</mo><mi id="S5.E28.m1.2.2.2.2.2.2.1.7.3.4">e</mi></mrow></msub></mrow></msub><mo id="S5.E28.m1.3.3.3.3.3.3">=</mo><mi id="S5.E28.m1.3.3.3.3.3.5"></mi></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E28.m1.33.33c"><mrow id="S5.E28.m1.20.20.20.20.17"><msub id="S5.E28.m1.20.20.20.20.17.18"><mi id="S5.E28.m1.4.4.4.4.1.1">M</mi><mtext id="S5.E28.m1.5.5.5.5.2.2.1">merge</mtext></msub><mrow id="S5.E28.m1.20.20.20.20.17.19"><msub id="S5.E28.m1.20.20.20.20.17.19.1"><mo id="S5.E28.m1.6.6.6.6.3.3" stretchy="false">(</mo><mrow id="S5.E28.m1.7.7.7.7.4.4.1"><msubsup id="S5.E28.m1.7.7.7.7.4.4.1.3"><mi id="S5.E28.m1.7.7.7.7.4.4.1.3.2.2">q</mi><mi id="S5.E28.m1.7.7.7.7.4.4.1.3.3">i</mi><mo id="S5.E28.m1.7.7.7.7.4.4.1.3.2.3">′</mo></msubsup><mo id="S5.E28.m1.7.7.7.7.4.4.1.2">∈</mo><mrow id="S5.E28.m1.7.7.7.7.4.4.1.4"><msub id="S5.E28.m1.7.7.7.7.4.4.1.4.2"><mi id="S5.E28.m1.7.7.7.7.4.4.1.4.2.2">M</mi><mtext id="S5.E28.m1.7.7.7.7.4.4.1.4.2.3">expand</mtext></msub><mo id="S5.E28.m1.7.7.7.7.4.4.1.4.1">⁢</mo><mrow id="S5.E28.m1.7.7.7.7.4.4.1.4.3.2"><mo id="S5.E28.m1.7.7.7.7.4.4.1.4.3.2.1" stretchy="false">(</mo><mi id="S5.E28.m1.7.7.7.7.4.4.1.1">q</mi><mo id="S5.E28.m1.7.7.7.7.4.4.1.4.3.2.2" stretchy="false">)</mo></mrow></mrow></mrow></msub><mrow id="S5.E28.m1.20.20.20.20.17.19.2"><mo id="S5.E28.m1.8.8.8.8.5.5" stretchy="false">{</mo><msub id="S5.E28.m1.20.20.20.20.17.19.2.1"><mi id="S5.E28.m1.9.9.9.9.6.6">M</mi><mtext id="S5.E28.m1.10.10.10.10.7.7.1">generate</mtext></msub><mrow id="S5.E28.m1.20.20.20.20.17.19.2.2"><mo id="S5.E28.m1.11.11.11.11.8.8" stretchy="false">(</mo><msubsup id="S5.E28.m1.20.20.20.20.17.19.2.2.1"><mi id="S5.E28.m1.12.12.12.12.9.9">q</mi><mi id="S5.E28.m1.14.14.14.14.11.11.1">i</mi><mo id="S5.E28.m1.13.13.13.13.10.10.1">′</mo></msubsup><mo id="S5.E28.m1.15.15.15.15.12.12">,</mo><msubsup id="S5.E28.m1.20.20.20.20.17.19.2.2.2"><mi id="S5.E28.m1.16.16.16.16.13.13">d</mi><mrow id="S5.E28.m1.18.18.18.18.15.15.1"><mi id="S5.E28.m1.18.18.18.18.15.15.1.2">i</mi><mo id="S5.E28.m1.18.18.18.18.15.15.1.1">⁢</mo><mi id="S5.E28.m1.18.18.18.18.15.15.1.3">j</mi></mrow><mo id="S5.E28.m1.17.17.17.17.14.14.1">′</mo></msubsup><mo id="S5.E28.m1.19.19.19.19.16.16" stretchy="false">)</mo></mrow><mo id="S5.E28.m1.20.20.20.20.17.17" lspace="0em">∣</mo></mrow></mrow></mrow></mtd></mtr><mtr id="S5.E28.m1.33.33d"><mtd id="S5.E28.m1.33.33e"></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E28.m1.33.33f"><mrow id="S5.E28.m1.33.33.33.13.13"><mrow id="S5.E28.m1.33.33.33.13.13.14"><msubsup id="S5.E28.m1.33.33.33.13.13.14.1"><mi id="S5.E28.m1.21.21.21.1.1.1">d</mi><mrow id="S5.E28.m1.23.23.23.3.3.3.1"><mi id="S5.E28.m1.23.23.23.3.3.3.1.2">i</mi><mo id="S5.E28.m1.23.23.23.3.3.3.1.1">⁢</mo><mi id="S5.E28.m1.23.23.23.3.3.3.1.3">j</mi></mrow><mo id="S5.E28.m1.22.22.22.2.2.2.1">′</mo></msubsup><mo id="S5.E28.m1.24.24.24.4.4.4">∈</mo><msub id="S5.E28.m1.33.33.33.13.13.14.2"><mi id="S5.E28.m1.25.25.25.5.5.5">M</mi><mtext id="S5.E28.m1.26.26.26.6.6.6.1">retrieve</mtext></msub><mrow id="S5.E28.m1.33.33.33.13.13.14.3"><mo id="S5.E28.m1.27.27.27.7.7.7" stretchy="false">(</mo><msubsup id="S5.E28.m1.33.33.33.13.13.14.3.1"><mi id="S5.E28.m1.28.28.28.8.8.8">q</mi><mi id="S5.E28.m1.30.30.30.10.10.10.1">i</mi><mo id="S5.E28.m1.29.29.29.9.9.9.1">′</mo></msubsup><mo id="S5.E28.m1.31.31.31.11.11.11" stretchy="false">)</mo></mrow><mo id="S5.E28.m1.32.32.32.12.12.12" stretchy="false">}</mo></mrow><mo id="S5.E28.m1.33.33.33.13.13.13" stretchy="false">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex" id="S5.E28.m1.33b">\begin{split}\mathcal{P}_{branch_{pre}}=&amp;M_{\text{merge}}(_{q^{\prime}_{i}\in M%
_{\text{expand}}(q)}\{M_{\text{generate}}(q^{\prime}_{i},d^{\prime}_{ij})\mid%
\\
&amp;d^{\prime}_{ij}\in M_{\text{retrieve}}(q^{\prime}_{i})\})\end{split}</annotation><annotation encoding="application/x-llamapun" id="S5.E28.m1.33c">start_ROW start_CELL caligraphic_P start_POSTSUBSCRIPT italic_b italic_r italic_a italic_n italic_c italic_h start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT end_POSTSUBSCRIPT = end_CELL start_CELL italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( start_POSTSUBSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_M start_POSTSUBSCRIPT expand end_POSTSUBSCRIPT ( italic_q ) end_POSTSUBSCRIPT { italic_M start_POSTSUBSCRIPT generate end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ) ∣ end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ∈ italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) } ) end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(28)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S5.SS3.p4">
<p class="ltx_p" id="S5.SS3.p4.12"><span class="ltx_text ltx_font_bold" id="S5.SS3.p4.12.1">Post-Retrieval Branching</span> (Single Query, Parallel Generation). As shown in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg4" title="Algorithm 4 ‣ V-C Branching ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">4</span></a>, in the post-retrieval branching pattern, the process starts with a single query <math alttext="q" class="ltx_Math" display="inline" id="S5.SS3.p4.1.m1.1"><semantics id="S5.SS3.p4.1.m1.1a"><mi id="S5.SS3.p4.1.m1.1.1" xref="S5.SS3.p4.1.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.1.m1.1b"><ci id="S5.SS3.p4.1.m1.1.1.cmml" xref="S5.SS3.p4.1.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.1.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.1.m1.1d">italic_q</annotation></semantics></math> which is used to retrieve multiple document chunks through a retrieval module <math alttext="M_{\text{retrieve}}" class="ltx_Math" display="inline" id="S5.SS3.p4.2.m2.1"><semantics id="S5.SS3.p4.2.m2.1a"><msub id="S5.SS3.p4.2.m2.1.1" xref="S5.SS3.p4.2.m2.1.1.cmml"><mi id="S5.SS3.p4.2.m2.1.1.2" xref="S5.SS3.p4.2.m2.1.1.2.cmml">M</mi><mtext id="S5.SS3.p4.2.m2.1.1.3" xref="S5.SS3.p4.2.m2.1.1.3a.cmml">retrieve</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.2.m2.1b"><apply id="S5.SS3.p4.2.m2.1.1.cmml" xref="S5.SS3.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.2.m2.1.1.1.cmml" xref="S5.SS3.p4.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.p4.2.m2.1.1.2.cmml" xref="S5.SS3.p4.2.m2.1.1.2">𝑀</ci><ci id="S5.SS3.p4.2.m2.1.1.3a.cmml" xref="S5.SS3.p4.2.m2.1.1.3"><mtext id="S5.SS3.p4.2.m2.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p4.2.m2.1.1.3">retrieve</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.2.m2.1c">M_{\text{retrieve}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.2.m2.1d">italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT</annotation></semantics></math>, resulting in a set of documents <math alttext="D^{q}" class="ltx_Math" display="inline" id="S5.SS3.p4.3.m3.1"><semantics id="S5.SS3.p4.3.m3.1a"><msup id="S5.SS3.p4.3.m3.1.1" xref="S5.SS3.p4.3.m3.1.1.cmml"><mi id="S5.SS3.p4.3.m3.1.1.2" xref="S5.SS3.p4.3.m3.1.1.2.cmml">D</mi><mi id="S5.SS3.p4.3.m3.1.1.3" xref="S5.SS3.p4.3.m3.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.3.m3.1b"><apply id="S5.SS3.p4.3.m3.1.1.cmml" xref="S5.SS3.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.3.m3.1.1.1.cmml" xref="S5.SS3.p4.3.m3.1.1">superscript</csymbol><ci id="S5.SS3.p4.3.m3.1.1.2.cmml" xref="S5.SS3.p4.3.m3.1.1.2">𝐷</ci><ci id="S5.SS3.p4.3.m3.1.1.3.cmml" xref="S5.SS3.p4.3.m3.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.3.m3.1c">D^{q}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.3.m3.1d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>. Each document <math alttext="d^{q}_{i}" class="ltx_Math" display="inline" id="S5.SS3.p4.4.m4.1"><semantics id="S5.SS3.p4.4.m4.1a"><msubsup id="S5.SS3.p4.4.m4.1.1" xref="S5.SS3.p4.4.m4.1.1.cmml"><mi id="S5.SS3.p4.4.m4.1.1.2.2" xref="S5.SS3.p4.4.m4.1.1.2.2.cmml">d</mi><mi id="S5.SS3.p4.4.m4.1.1.3" xref="S5.SS3.p4.4.m4.1.1.3.cmml">i</mi><mi id="S5.SS3.p4.4.m4.1.1.2.3" xref="S5.SS3.p4.4.m4.1.1.2.3.cmml">q</mi></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.4.m4.1b"><apply id="S5.SS3.p4.4.m4.1.1.cmml" xref="S5.SS3.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.4.m4.1.1.1.cmml" xref="S5.SS3.p4.4.m4.1.1">subscript</csymbol><apply id="S5.SS3.p4.4.m4.1.1.2.cmml" xref="S5.SS3.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.4.m4.1.1.2.1.cmml" xref="S5.SS3.p4.4.m4.1.1">superscript</csymbol><ci id="S5.SS3.p4.4.m4.1.1.2.2.cmml" xref="S5.SS3.p4.4.m4.1.1.2.2">𝑑</ci><ci id="S5.SS3.p4.4.m4.1.1.2.3.cmml" xref="S5.SS3.p4.4.m4.1.1.2.3">𝑞</ci></apply><ci id="S5.SS3.p4.4.m4.1.1.3.cmml" xref="S5.SS3.p4.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.4.m4.1c">d^{q}_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.4.m4.1d">italic_d start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> from this set is then independently processed by a generation module <math alttext="M_{\text{generate}}" class="ltx_Math" display="inline" id="S5.SS3.p4.5.m5.1"><semantics id="S5.SS3.p4.5.m5.1a"><msub id="S5.SS3.p4.5.m5.1.1" xref="S5.SS3.p4.5.m5.1.1.cmml"><mi id="S5.SS3.p4.5.m5.1.1.2" xref="S5.SS3.p4.5.m5.1.1.2.cmml">M</mi><mtext id="S5.SS3.p4.5.m5.1.1.3" xref="S5.SS3.p4.5.m5.1.1.3a.cmml">generate</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.5.m5.1b"><apply id="S5.SS3.p4.5.m5.1.1.cmml" xref="S5.SS3.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.5.m5.1.1.1.cmml" xref="S5.SS3.p4.5.m5.1.1">subscript</csymbol><ci id="S5.SS3.p4.5.m5.1.1.2.cmml" xref="S5.SS3.p4.5.m5.1.1.2">𝑀</ci><ci id="S5.SS3.p4.5.m5.1.1.3a.cmml" xref="S5.SS3.p4.5.m5.1.1.3"><mtext id="S5.SS3.p4.5.m5.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p4.5.m5.1.1.3">generate</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.5.m5.1c">M_{\text{generate}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.5.m5.1d">italic_M start_POSTSUBSCRIPT generate end_POSTSUBSCRIPT</annotation></semantics></math> to produce a set of generated results <math alttext="G" class="ltx_Math" display="inline" id="S5.SS3.p4.6.m6.1"><semantics id="S5.SS3.p4.6.m6.1a"><mi id="S5.SS3.p4.6.m6.1.1" xref="S5.SS3.p4.6.m6.1.1.cmml">G</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.6.m6.1b"><ci id="S5.SS3.p4.6.m6.1.1.cmml" xref="S5.SS3.p4.6.m6.1.1">𝐺</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.6.m6.1c">G</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.6.m6.1d">italic_G</annotation></semantics></math>. These results are subsequently merged using a merge module <math alttext="M_{\text{merge}}" class="ltx_Math" display="inline" id="S5.SS3.p4.7.m7.1"><semantics id="S5.SS3.p4.7.m7.1a"><msub id="S5.SS3.p4.7.m7.1.1" xref="S5.SS3.p4.7.m7.1.1.cmml"><mi id="S5.SS3.p4.7.m7.1.1.2" xref="S5.SS3.p4.7.m7.1.1.2.cmml">M</mi><mtext id="S5.SS3.p4.7.m7.1.1.3" xref="S5.SS3.p4.7.m7.1.1.3a.cmml">merge</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.7.m7.1b"><apply id="S5.SS3.p4.7.m7.1.1.cmml" xref="S5.SS3.p4.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.7.m7.1.1.1.cmml" xref="S5.SS3.p4.7.m7.1.1">subscript</csymbol><ci id="S5.SS3.p4.7.m7.1.1.2.cmml" xref="S5.SS3.p4.7.m7.1.1.2">𝑀</ci><ci id="S5.SS3.p4.7.m7.1.1.3a.cmml" xref="S5.SS3.p4.7.m7.1.1.3"><mtext id="S5.SS3.p4.7.m7.1.1.3.cmml" mathsize="70%" xref="S5.SS3.p4.7.m7.1.1.3">merge</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.7.m7.1c">M_{\text{merge}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.7.m7.1d">italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT</annotation></semantics></math> to form the final result <math alttext="y" class="ltx_Math" display="inline" id="S5.SS3.p4.8.m8.1"><semantics id="S5.SS3.p4.8.m8.1a"><mi id="S5.SS3.p4.8.m8.1.1" xref="S5.SS3.p4.8.m8.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.8.m8.1b"><ci id="S5.SS3.p4.8.m8.1.1.cmml" xref="S5.SS3.p4.8.m8.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.8.m8.1c">y</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.8.m8.1d">italic_y</annotation></semantics></math>. The process can be succinctly represented as <math alttext="y=M_{\text{merge}}(O_{i})" class="ltx_Math" display="inline" id="S5.SS3.p4.9.m9.1"><semantics id="S5.SS3.p4.9.m9.1a"><mrow id="S5.SS3.p4.9.m9.1.1" xref="S5.SS3.p4.9.m9.1.1.cmml"><mi id="S5.SS3.p4.9.m9.1.1.3" xref="S5.SS3.p4.9.m9.1.1.3.cmml">y</mi><mo id="S5.SS3.p4.9.m9.1.1.2" xref="S5.SS3.p4.9.m9.1.1.2.cmml">=</mo><mrow id="S5.SS3.p4.9.m9.1.1.1" xref="S5.SS3.p4.9.m9.1.1.1.cmml"><msub id="S5.SS3.p4.9.m9.1.1.1.3" xref="S5.SS3.p4.9.m9.1.1.1.3.cmml"><mi id="S5.SS3.p4.9.m9.1.1.1.3.2" xref="S5.SS3.p4.9.m9.1.1.1.3.2.cmml">M</mi><mtext id="S5.SS3.p4.9.m9.1.1.1.3.3" xref="S5.SS3.p4.9.m9.1.1.1.3.3a.cmml">merge</mtext></msub><mo id="S5.SS3.p4.9.m9.1.1.1.2" xref="S5.SS3.p4.9.m9.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p4.9.m9.1.1.1.1.1" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.cmml"><mo id="S5.SS3.p4.9.m9.1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.cmml">(</mo><msub id="S5.SS3.p4.9.m9.1.1.1.1.1.1" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.cmml"><mi id="S5.SS3.p4.9.m9.1.1.1.1.1.1.2" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.2.cmml">O</mi><mi id="S5.SS3.p4.9.m9.1.1.1.1.1.1.3" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S5.SS3.p4.9.m9.1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.9.m9.1b"><apply id="S5.SS3.p4.9.m9.1.1.cmml" xref="S5.SS3.p4.9.m9.1.1"><eq id="S5.SS3.p4.9.m9.1.1.2.cmml" xref="S5.SS3.p4.9.m9.1.1.2"></eq><ci id="S5.SS3.p4.9.m9.1.1.3.cmml" xref="S5.SS3.p4.9.m9.1.1.3">𝑦</ci><apply id="S5.SS3.p4.9.m9.1.1.1.cmml" xref="S5.SS3.p4.9.m9.1.1.1"><times id="S5.SS3.p4.9.m9.1.1.1.2.cmml" xref="S5.SS3.p4.9.m9.1.1.1.2"></times><apply id="S5.SS3.p4.9.m9.1.1.1.3.cmml" xref="S5.SS3.p4.9.m9.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p4.9.m9.1.1.1.3.1.cmml" xref="S5.SS3.p4.9.m9.1.1.1.3">subscript</csymbol><ci id="S5.SS3.p4.9.m9.1.1.1.3.2.cmml" xref="S5.SS3.p4.9.m9.1.1.1.3.2">𝑀</ci><ci id="S5.SS3.p4.9.m9.1.1.1.3.3a.cmml" xref="S5.SS3.p4.9.m9.1.1.1.3.3"><mtext id="S5.SS3.p4.9.m9.1.1.1.3.3.cmml" mathsize="70%" xref="S5.SS3.p4.9.m9.1.1.1.3.3">merge</mtext></ci></apply><apply id="S5.SS3.p4.9.m9.1.1.1.1.1.1.cmml" xref="S5.SS3.p4.9.m9.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.9.m9.1.1.1.1.1.1.1.cmml" xref="S5.SS3.p4.9.m9.1.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p4.9.m9.1.1.1.1.1.1.2.cmml" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.2">𝑂</ci><ci id="S5.SS3.p4.9.m9.1.1.1.1.1.1.3.cmml" xref="S5.SS3.p4.9.m9.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.9.m9.1c">y=M_{\text{merge}}(O_{i})</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.9.m9.1d">italic_y = italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>, where <math alttext="O_{i}" class="ltx_Math" display="inline" id="S5.SS3.p4.10.m10.1"><semantics id="S5.SS3.p4.10.m10.1a"><msub id="S5.SS3.p4.10.m10.1.1" xref="S5.SS3.p4.10.m10.1.1.cmml"><mi id="S5.SS3.p4.10.m10.1.1.2" xref="S5.SS3.p4.10.m10.1.1.2.cmml">O</mi><mi id="S5.SS3.p4.10.m10.1.1.3" xref="S5.SS3.p4.10.m10.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.10.m10.1b"><apply id="S5.SS3.p4.10.m10.1.1.cmml" xref="S5.SS3.p4.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.10.m10.1.1.1.cmml" xref="S5.SS3.p4.10.m10.1.1">subscript</csymbol><ci id="S5.SS3.p4.10.m10.1.1.2.cmml" xref="S5.SS3.p4.10.m10.1.1.2">𝑂</ci><ci id="S5.SS3.p4.10.m10.1.1.3.cmml" xref="S5.SS3.p4.10.m10.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.10.m10.1c">O_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.10.m10.1d">italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the collection of all generated results from each document <math alttext="d^{q}_{i}" class="ltx_Math" display="inline" id="S5.SS3.p4.11.m11.1"><semantics id="S5.SS3.p4.11.m11.1a"><msubsup id="S5.SS3.p4.11.m11.1.1" xref="S5.SS3.p4.11.m11.1.1.cmml"><mi id="S5.SS3.p4.11.m11.1.1.2.2" xref="S5.SS3.p4.11.m11.1.1.2.2.cmml">d</mi><mi id="S5.SS3.p4.11.m11.1.1.3" xref="S5.SS3.p4.11.m11.1.1.3.cmml">i</mi><mi id="S5.SS3.p4.11.m11.1.1.2.3" xref="S5.SS3.p4.11.m11.1.1.2.3.cmml">q</mi></msubsup><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.11.m11.1b"><apply id="S5.SS3.p4.11.m11.1.1.cmml" xref="S5.SS3.p4.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.11.m11.1.1.1.cmml" xref="S5.SS3.p4.11.m11.1.1">subscript</csymbol><apply id="S5.SS3.p4.11.m11.1.1.2.cmml" xref="S5.SS3.p4.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.11.m11.1.1.2.1.cmml" xref="S5.SS3.p4.11.m11.1.1">superscript</csymbol><ci id="S5.SS3.p4.11.m11.1.1.2.2.cmml" xref="S5.SS3.p4.11.m11.1.1.2.2">𝑑</ci><ci id="S5.SS3.p4.11.m11.1.1.2.3.cmml" xref="S5.SS3.p4.11.m11.1.1.2.3">𝑞</ci></apply><ci id="S5.SS3.p4.11.m11.1.1.3.cmml" xref="S5.SS3.p4.11.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.11.m11.1c">d^{q}_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.11.m11.1d">italic_d start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> in <math alttext="D^{q}" class="ltx_Math" display="inline" id="S5.SS3.p4.12.m12.1"><semantics id="S5.SS3.p4.12.m12.1a"><msup id="S5.SS3.p4.12.m12.1.1" xref="S5.SS3.p4.12.m12.1.1.cmml"><mi id="S5.SS3.p4.12.m12.1.1.2" xref="S5.SS3.p4.12.m12.1.1.2.cmml">D</mi><mi id="S5.SS3.p4.12.m12.1.1.3" xref="S5.SS3.p4.12.m12.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS3.p4.12.m12.1b"><apply id="S5.SS3.p4.12.m12.1.1.cmml" xref="S5.SS3.p4.12.m12.1.1"><csymbol cd="ambiguous" id="S5.SS3.p4.12.m12.1.1.1.cmml" xref="S5.SS3.p4.12.m12.1.1">superscript</csymbol><ci id="S5.SS3.p4.12.m12.1.1.2.cmml" xref="S5.SS3.p4.12.m12.1.1.2">𝐷</ci><ci id="S5.SS3.p4.12.m12.1.1.3.cmml" xref="S5.SS3.p4.12.m12.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p4.12.m12.1c">D^{q}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p4.12.m12.1d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>.
Therefore, the entire process can be represented as:</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E29">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{P}_{branch_{post}}=M_{\text{merge}}(\{M_{\text{generate}}(d^{q}_{i})%
\mid d^{q}_{i}\in M_{\text{retrieve}}(q)\})" class="ltx_Math" display="block" id="S5.E29.m1.2"><semantics id="S5.E29.m1.2a"><mrow id="S5.E29.m1.2.2" xref="S5.E29.m1.2.2.cmml"><msub id="S5.E29.m1.2.2.3" xref="S5.E29.m1.2.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E29.m1.2.2.3.2" xref="S5.E29.m1.2.2.3.2.cmml">𝒫</mi><mrow id="S5.E29.m1.2.2.3.3" xref="S5.E29.m1.2.2.3.3.cmml"><mi id="S5.E29.m1.2.2.3.3.2" xref="S5.E29.m1.2.2.3.3.2.cmml">b</mi><mo id="S5.E29.m1.2.2.3.3.1" xref="S5.E29.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.3" xref="S5.E29.m1.2.2.3.3.3.cmml">r</mi><mo id="S5.E29.m1.2.2.3.3.1a" xref="S5.E29.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.4" xref="S5.E29.m1.2.2.3.3.4.cmml">a</mi><mo id="S5.E29.m1.2.2.3.3.1b" xref="S5.E29.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.5" xref="S5.E29.m1.2.2.3.3.5.cmml">n</mi><mo id="S5.E29.m1.2.2.3.3.1c" xref="S5.E29.m1.2.2.3.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.6" xref="S5.E29.m1.2.2.3.3.6.cmml">c</mi><mo id="S5.E29.m1.2.2.3.3.1d" xref="S5.E29.m1.2.2.3.3.1.cmml">⁢</mo><msub id="S5.E29.m1.2.2.3.3.7" xref="S5.E29.m1.2.2.3.3.7.cmml"><mi id="S5.E29.m1.2.2.3.3.7.2" xref="S5.E29.m1.2.2.3.3.7.2.cmml">h</mi><mrow id="S5.E29.m1.2.2.3.3.7.3" xref="S5.E29.m1.2.2.3.3.7.3.cmml"><mi id="S5.E29.m1.2.2.3.3.7.3.2" xref="S5.E29.m1.2.2.3.3.7.3.2.cmml">p</mi><mo id="S5.E29.m1.2.2.3.3.7.3.1" xref="S5.E29.m1.2.2.3.3.7.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.7.3.3" xref="S5.E29.m1.2.2.3.3.7.3.3.cmml">o</mi><mo id="S5.E29.m1.2.2.3.3.7.3.1a" xref="S5.E29.m1.2.2.3.3.7.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.7.3.4" xref="S5.E29.m1.2.2.3.3.7.3.4.cmml">s</mi><mo id="S5.E29.m1.2.2.3.3.7.3.1b" xref="S5.E29.m1.2.2.3.3.7.3.1.cmml">⁢</mo><mi id="S5.E29.m1.2.2.3.3.7.3.5" xref="S5.E29.m1.2.2.3.3.7.3.5.cmml">t</mi></mrow></msub></mrow></msub><mo id="S5.E29.m1.2.2.2" xref="S5.E29.m1.2.2.2.cmml">=</mo><mrow id="S5.E29.m1.2.2.1" xref="S5.E29.m1.2.2.1.cmml"><msub id="S5.E29.m1.2.2.1.3" xref="S5.E29.m1.2.2.1.3.cmml"><mi id="S5.E29.m1.2.2.1.3.2" xref="S5.E29.m1.2.2.1.3.2.cmml">M</mi><mtext id="S5.E29.m1.2.2.1.3.3" xref="S5.E29.m1.2.2.1.3.3a.cmml">merge</mtext></msub><mo id="S5.E29.m1.2.2.1.2" xref="S5.E29.m1.2.2.1.2.cmml">⁢</mo><mrow id="S5.E29.m1.2.2.1.1.1" xref="S5.E29.m1.2.2.1.cmml"><mo id="S5.E29.m1.2.2.1.1.1.2" stretchy="false" xref="S5.E29.m1.2.2.1.cmml">(</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.2" xref="S5.E29.m1.2.2.1.1.1.1.3.cmml"><mo id="S5.E29.m1.2.2.1.1.1.1.2.3" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.3.1.cmml">{</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.1.1" xref="S5.E29.m1.2.2.1.1.1.1.1.1.cmml"><msub id="S5.E29.m1.2.2.1.1.1.1.1.1.3" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.cmml"><mi id="S5.E29.m1.2.2.1.1.1.1.1.1.3.2" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.2.cmml">M</mi><mtext id="S5.E29.m1.2.2.1.1.1.1.1.1.3.3" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.3a.cmml">generate</mtext></msub><mo id="S5.E29.m1.2.2.1.1.1.1.1.1.2" xref="S5.E29.m1.2.2.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mo id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.cmml">(</mo><msubsup id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.2" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.2.cmml">d</mi><mi id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.3" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml">i</mi><mi id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.3" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.3.cmml">q</mi></msubsup><mo id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo fence="true" id="S5.E29.m1.2.2.1.1.1.1.2.4" lspace="0em" rspace="0em" xref="S5.E29.m1.2.2.1.1.1.1.3.1.cmml">∣</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.2.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.cmml"><msubsup id="S5.E29.m1.2.2.1.1.1.1.2.2.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.cmml"><mi id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.2.cmml">d</mi><mi id="S5.E29.m1.2.2.1.1.1.1.2.2.2.3" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.3.cmml">i</mi><mi id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.3" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.3.cmml">q</mi></msubsup><mo id="S5.E29.m1.2.2.1.1.1.1.2.2.1" xref="S5.E29.m1.2.2.1.1.1.1.2.2.1.cmml">∈</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.2.2.3" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.cmml"><msub id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.cmml"><mi id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.2.cmml">M</mi><mtext id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3a.cmml">retrieve</mtext></msub><mo id="S5.E29.m1.2.2.1.1.1.1.2.2.3.1" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.1.cmml">⁢</mo><mrow id="S5.E29.m1.2.2.1.1.1.1.2.2.3.3.2" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.cmml"><mo id="S5.E29.m1.2.2.1.1.1.1.2.2.3.3.2.1" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.cmml">(</mo><mi id="S5.E29.m1.1.1" xref="S5.E29.m1.1.1.cmml">q</mi><mo id="S5.E29.m1.2.2.1.1.1.1.2.2.3.3.2.2" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S5.E29.m1.2.2.1.1.1.1.2.5" stretchy="false" xref="S5.E29.m1.2.2.1.1.1.1.3.1.cmml">}</mo></mrow><mo id="S5.E29.m1.2.2.1.1.1.3" stretchy="false" xref="S5.E29.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E29.m1.2b"><apply id="S5.E29.m1.2.2.cmml" xref="S5.E29.m1.2.2"><eq id="S5.E29.m1.2.2.2.cmml" xref="S5.E29.m1.2.2.2"></eq><apply id="S5.E29.m1.2.2.3.cmml" xref="S5.E29.m1.2.2.3"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.3.1.cmml" xref="S5.E29.m1.2.2.3">subscript</csymbol><ci id="S5.E29.m1.2.2.3.2.cmml" xref="S5.E29.m1.2.2.3.2">𝒫</ci><apply id="S5.E29.m1.2.2.3.3.cmml" xref="S5.E29.m1.2.2.3.3"><times id="S5.E29.m1.2.2.3.3.1.cmml" xref="S5.E29.m1.2.2.3.3.1"></times><ci id="S5.E29.m1.2.2.3.3.2.cmml" xref="S5.E29.m1.2.2.3.3.2">𝑏</ci><ci id="S5.E29.m1.2.2.3.3.3.cmml" xref="S5.E29.m1.2.2.3.3.3">𝑟</ci><ci id="S5.E29.m1.2.2.3.3.4.cmml" xref="S5.E29.m1.2.2.3.3.4">𝑎</ci><ci id="S5.E29.m1.2.2.3.3.5.cmml" xref="S5.E29.m1.2.2.3.3.5">𝑛</ci><ci id="S5.E29.m1.2.2.3.3.6.cmml" xref="S5.E29.m1.2.2.3.3.6">𝑐</ci><apply id="S5.E29.m1.2.2.3.3.7.cmml" xref="S5.E29.m1.2.2.3.3.7"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.3.3.7.1.cmml" xref="S5.E29.m1.2.2.3.3.7">subscript</csymbol><ci id="S5.E29.m1.2.2.3.3.7.2.cmml" xref="S5.E29.m1.2.2.3.3.7.2">ℎ</ci><apply id="S5.E29.m1.2.2.3.3.7.3.cmml" xref="S5.E29.m1.2.2.3.3.7.3"><times id="S5.E29.m1.2.2.3.3.7.3.1.cmml" xref="S5.E29.m1.2.2.3.3.7.3.1"></times><ci id="S5.E29.m1.2.2.3.3.7.3.2.cmml" xref="S5.E29.m1.2.2.3.3.7.3.2">𝑝</ci><ci id="S5.E29.m1.2.2.3.3.7.3.3.cmml" xref="S5.E29.m1.2.2.3.3.7.3.3">𝑜</ci><ci id="S5.E29.m1.2.2.3.3.7.3.4.cmml" xref="S5.E29.m1.2.2.3.3.7.3.4">𝑠</ci><ci id="S5.E29.m1.2.2.3.3.7.3.5.cmml" xref="S5.E29.m1.2.2.3.3.7.3.5">𝑡</ci></apply></apply></apply></apply><apply id="S5.E29.m1.2.2.1.cmml" xref="S5.E29.m1.2.2.1"><times id="S5.E29.m1.2.2.1.2.cmml" xref="S5.E29.m1.2.2.1.2"></times><apply id="S5.E29.m1.2.2.1.3.cmml" xref="S5.E29.m1.2.2.1.3"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.3.1.cmml" xref="S5.E29.m1.2.2.1.3">subscript</csymbol><ci id="S5.E29.m1.2.2.1.3.2.cmml" xref="S5.E29.m1.2.2.1.3.2">𝑀</ci><ci id="S5.E29.m1.2.2.1.3.3a.cmml" xref="S5.E29.m1.2.2.1.3.3"><mtext id="S5.E29.m1.2.2.1.3.3.cmml" mathsize="70%" xref="S5.E29.m1.2.2.1.3.3">merge</mtext></ci></apply><apply id="S5.E29.m1.2.2.1.1.1.1.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2"><csymbol cd="latexml" id="S5.E29.m1.2.2.1.1.1.1.3.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.3">conditional-set</csymbol><apply id="S5.E29.m1.2.2.1.1.1.1.1.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1"><times id="S5.E29.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.2"></times><apply id="S5.E29.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S5.E29.m1.2.2.1.1.1.1.1.1.3.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.2">𝑀</ci><ci id="S5.E29.m1.2.2.1.1.1.1.1.1.3.3a.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.3"><mtext id="S5.E29.m1.2.2.1.1.1.1.1.1.3.3.cmml" mathsize="70%" xref="S5.E29.m1.2.2.1.1.1.1.1.1.3.3">generate</mtext></ci></apply><apply id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.2">𝑑</ci><ci id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.2.3">𝑞</ci></apply><ci id="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><apply id="S5.E29.m1.2.2.1.1.1.1.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2"><in id="S5.E29.m1.2.2.1.1.1.1.2.2.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.1"></in><apply id="S5.E29.m1.2.2.1.1.1.1.2.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.2.2.2.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2">subscript</csymbol><apply id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2">superscript</csymbol><ci id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.2">𝑑</ci><ci id="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.2.3">𝑞</ci></apply><ci id="S5.E29.m1.2.2.1.1.1.1.2.2.2.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.2.3">𝑖</ci></apply><apply id="S5.E29.m1.2.2.1.1.1.1.2.2.3.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3"><times id="S5.E29.m1.2.2.1.1.1.1.2.2.3.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.1"></times><apply id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2"><csymbol cd="ambiguous" id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.1.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2">subscript</csymbol><ci id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.2.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.2">𝑀</ci><ci id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3a.cmml" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3"><mtext id="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3.cmml" mathsize="70%" xref="S5.E29.m1.2.2.1.1.1.1.2.2.3.2.3">retrieve</mtext></ci></apply><ci id="S5.E29.m1.1.1.cmml" xref="S5.E29.m1.1.1">𝑞</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E29.m1.2c">\mathcal{P}_{branch_{post}}=M_{\text{merge}}(\{M_{\text{generate}}(d^{q}_{i})%
\mid d^{q}_{i}\in M_{\text{retrieve}}(q)\})</annotation><annotation encoding="application/x-llamapun" id="S5.E29.m1.2d">caligraphic_P start_POSTSUBSCRIPT italic_b italic_r italic_a italic_n italic_c italic_h start_POSTSUBSCRIPT italic_p italic_o italic_s italic_t end_POSTSUBSCRIPT end_POSTSUBSCRIPT = italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( { italic_M start_POSTSUBSCRIPT generate end_POSTSUBSCRIPT ( italic_d start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ∣ italic_d start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_M start_POSTSUBSCRIPT retrieve end_POSTSUBSCRIPT ( italic_q ) } )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(29)</span></td>
</tr></tbody>
</table>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg4.2.1.1">Algorithm 4</span> </span> Post-retrieval Branching Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg4.3">
<div class="ltx_listingline" id="alg4.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="q" class="ltx_Math" display="inline" id="alg4.l0.m1.1"><semantics id="alg4.l0.m1.1a"><mi id="alg4.l0.m1.1.1" xref="alg4.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg4.l0.m1.1b"><ci id="alg4.l0.m1.1.1.cmml" xref="alg4.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m1.1d">italic_q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg4.l0.m2.1"><semantics id="alg4.l0.m2.1a"><mi id="alg4.l0.m2.1.1" xref="alg4.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg4.l0.m2.1b"><ci id="alg4.l0.m2.1.1.cmml" xref="alg4.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m2.1d">italic_D</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg4.l0.m3.1"><semantics id="alg4.l0.m3.1a"><mi id="alg4.l0.m3.1.1" xref="alg4.l0.m3.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg4.l0.m3.1b"><ci id="alg4.l0.m3.1.1.cmml" xref="alg4.l0.m3.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m3.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m3.1d">italic_R</annotation></semantics></math>, language model <math alttext="LLM" class="ltx_Math" display="inline" id="alg4.l0.m4.1"><semantics id="alg4.l0.m4.1a"><mrow id="alg4.l0.m4.1.1" xref="alg4.l0.m4.1.1.cmml"><mi id="alg4.l0.m4.1.1.2" xref="alg4.l0.m4.1.1.2.cmml">L</mi><mo id="alg4.l0.m4.1.1.1" xref="alg4.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg4.l0.m4.1.1.3" xref="alg4.l0.m4.1.1.3.cmml">L</mi><mo id="alg4.l0.m4.1.1.1a" xref="alg4.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg4.l0.m4.1.1.4" xref="alg4.l0.m4.1.1.4.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg4.l0.m4.1b"><apply id="alg4.l0.m4.1.1.cmml" xref="alg4.l0.m4.1.1"><times id="alg4.l0.m4.1.1.1.cmml" xref="alg4.l0.m4.1.1.1"></times><ci id="alg4.l0.m4.1.1.2.cmml" xref="alg4.l0.m4.1.1.2">𝐿</ci><ci id="alg4.l0.m4.1.1.3.cmml" xref="alg4.l0.m4.1.1.3">𝐿</ci><ci id="alg4.l0.m4.1.1.4.cmml" xref="alg4.l0.m4.1.1.4">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m4.1c">LLM</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m4.1d">italic_L italic_L italic_M</annotation></semantics></math>, merge module <math alttext="M_{\text{merge}}" class="ltx_Math" display="inline" id="alg4.l0.m5.1"><semantics id="alg4.l0.m5.1a"><msub id="alg4.l0.m5.1.1" xref="alg4.l0.m5.1.1.cmml"><mi id="alg4.l0.m5.1.1.2" xref="alg4.l0.m5.1.1.2.cmml">M</mi><mtext id="alg4.l0.m5.1.1.3" xref="alg4.l0.m5.1.1.3a.cmml">merge</mtext></msub><annotation-xml encoding="MathML-Content" id="alg4.l0.m5.1b"><apply id="alg4.l0.m5.1.1.cmml" xref="alg4.l0.m5.1.1"><csymbol cd="ambiguous" id="alg4.l0.m5.1.1.1.cmml" xref="alg4.l0.m5.1.1">subscript</csymbol><ci id="alg4.l0.m5.1.1.2.cmml" xref="alg4.l0.m5.1.1.2">𝑀</ci><ci id="alg4.l0.m5.1.1.3a.cmml" xref="alg4.l0.m5.1.1.3"><mtext id="alg4.l0.m5.1.1.3.cmml" mathsize="70%" xref="alg4.l0.m5.1.1.3">merge</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m5.1c">M_{\text{merge}}</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m5.1d">italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg4.l0a.m1.1"><semantics id="alg4.l0a.m1.1a"><mover accent="true" id="alg4.l0a.m1.1.1" xref="alg4.l0a.m1.1.1.cmml"><mi id="alg4.l0a.m1.1.1.2" xref="alg4.l0a.m1.1.1.2.cmml">y</mi><mo id="alg4.l0a.m1.1.1.1" xref="alg4.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg4.l0a.m1.1b"><apply id="alg4.l0a.m1.1.1.cmml" xref="alg4.l0a.m1.1.1"><ci id="alg4.l0a.m1.1.1.1.cmml" xref="alg4.l0a.m1.1.1.1">^</ci><ci id="alg4.l0a.m1.1.1.2.cmml" xref="alg4.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg4.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg4.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="q^{\prime}\leftarrow f_{pre}(q)" class="ltx_Math" display="inline" id="alg4.l2.m1.1"><semantics id="alg4.l2.m1.1a"><mrow id="alg4.l2.m1.1.2" xref="alg4.l2.m1.1.2.cmml"><msup id="alg4.l2.m1.1.2.2" xref="alg4.l2.m1.1.2.2.cmml"><mi id="alg4.l2.m1.1.2.2.2" xref="alg4.l2.m1.1.2.2.2.cmml">q</mi><mo id="alg4.l2.m1.1.2.2.3" xref="alg4.l2.m1.1.2.2.3.cmml">′</mo></msup><mo id="alg4.l2.m1.1.2.1" stretchy="false" xref="alg4.l2.m1.1.2.1.cmml">←</mo><mrow id="alg4.l2.m1.1.2.3" xref="alg4.l2.m1.1.2.3.cmml"><msub id="alg4.l2.m1.1.2.3.2" xref="alg4.l2.m1.1.2.3.2.cmml"><mi id="alg4.l2.m1.1.2.3.2.2" xref="alg4.l2.m1.1.2.3.2.2.cmml">f</mi><mrow id="alg4.l2.m1.1.2.3.2.3" xref="alg4.l2.m1.1.2.3.2.3.cmml"><mi id="alg4.l2.m1.1.2.3.2.3.2" xref="alg4.l2.m1.1.2.3.2.3.2.cmml">p</mi><mo id="alg4.l2.m1.1.2.3.2.3.1" xref="alg4.l2.m1.1.2.3.2.3.1.cmml">⁢</mo><mi id="alg4.l2.m1.1.2.3.2.3.3" xref="alg4.l2.m1.1.2.3.2.3.3.cmml">r</mi><mo id="alg4.l2.m1.1.2.3.2.3.1a" xref="alg4.l2.m1.1.2.3.2.3.1.cmml">⁢</mo><mi id="alg4.l2.m1.1.2.3.2.3.4" xref="alg4.l2.m1.1.2.3.2.3.4.cmml">e</mi></mrow></msub><mo id="alg4.l2.m1.1.2.3.1" xref="alg4.l2.m1.1.2.3.1.cmml">⁢</mo><mrow id="alg4.l2.m1.1.2.3.3.2" xref="alg4.l2.m1.1.2.3.cmml"><mo id="alg4.l2.m1.1.2.3.3.2.1" stretchy="false" xref="alg4.l2.m1.1.2.3.cmml">(</mo><mi id="alg4.l2.m1.1.1" xref="alg4.l2.m1.1.1.cmml">q</mi><mo id="alg4.l2.m1.1.2.3.3.2.2" stretchy="false" xref="alg4.l2.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg4.l2.m1.1b"><apply id="alg4.l2.m1.1.2.cmml" xref="alg4.l2.m1.1.2"><ci id="alg4.l2.m1.1.2.1.cmml" xref="alg4.l2.m1.1.2.1">←</ci><apply id="alg4.l2.m1.1.2.2.cmml" xref="alg4.l2.m1.1.2.2"><csymbol cd="ambiguous" id="alg4.l2.m1.1.2.2.1.cmml" xref="alg4.l2.m1.1.2.2">superscript</csymbol><ci id="alg4.l2.m1.1.2.2.2.cmml" xref="alg4.l2.m1.1.2.2.2">𝑞</ci><ci id="alg4.l2.m1.1.2.2.3.cmml" xref="alg4.l2.m1.1.2.2.3">′</ci></apply><apply id="alg4.l2.m1.1.2.3.cmml" xref="alg4.l2.m1.1.2.3"><times id="alg4.l2.m1.1.2.3.1.cmml" xref="alg4.l2.m1.1.2.3.1"></times><apply id="alg4.l2.m1.1.2.3.2.cmml" xref="alg4.l2.m1.1.2.3.2"><csymbol cd="ambiguous" id="alg4.l2.m1.1.2.3.2.1.cmml" xref="alg4.l2.m1.1.2.3.2">subscript</csymbol><ci id="alg4.l2.m1.1.2.3.2.2.cmml" xref="alg4.l2.m1.1.2.3.2.2">𝑓</ci><apply id="alg4.l2.m1.1.2.3.2.3.cmml" xref="alg4.l2.m1.1.2.3.2.3"><times id="alg4.l2.m1.1.2.3.2.3.1.cmml" xref="alg4.l2.m1.1.2.3.2.3.1"></times><ci id="alg4.l2.m1.1.2.3.2.3.2.cmml" xref="alg4.l2.m1.1.2.3.2.3.2">𝑝</ci><ci id="alg4.l2.m1.1.2.3.2.3.3.cmml" xref="alg4.l2.m1.1.2.3.2.3.3">𝑟</ci><ci id="alg4.l2.m1.1.2.3.2.3.4.cmml" xref="alg4.l2.m1.1.2.3.2.3.4">𝑒</ci></apply></apply><ci id="alg4.l2.m1.1.1.cmml" xref="alg4.l2.m1.1.1">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l2.m1.1c">q^{\prime}\leftarrow f_{pre}(q)</annotation><annotation encoding="application/x-llamapun" id="alg4.l2.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_f start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT ( italic_q )</annotation></semantics></math> // Pre-process the original query

</div>
<div class="ltx_listingline" id="alg4.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="D^{q^{\prime}}\leftarrow R(q^{\prime},D)" class="ltx_Math" display="inline" id="alg4.l3.m1.2"><semantics id="alg4.l3.m1.2a"><mrow id="alg4.l3.m1.2.2" xref="alg4.l3.m1.2.2.cmml"><msup id="alg4.l3.m1.2.2.3" xref="alg4.l3.m1.2.2.3.cmml"><mi id="alg4.l3.m1.2.2.3.2" xref="alg4.l3.m1.2.2.3.2.cmml">D</mi><msup id="alg4.l3.m1.2.2.3.3" xref="alg4.l3.m1.2.2.3.3.cmml"><mi id="alg4.l3.m1.2.2.3.3.2" xref="alg4.l3.m1.2.2.3.3.2.cmml">q</mi><mo id="alg4.l3.m1.2.2.3.3.3" xref="alg4.l3.m1.2.2.3.3.3.cmml">′</mo></msup></msup><mo id="alg4.l3.m1.2.2.2" stretchy="false" xref="alg4.l3.m1.2.2.2.cmml">←</mo><mrow id="alg4.l3.m1.2.2.1" xref="alg4.l3.m1.2.2.1.cmml"><mi id="alg4.l3.m1.2.2.1.3" xref="alg4.l3.m1.2.2.1.3.cmml">R</mi><mo id="alg4.l3.m1.2.2.1.2" xref="alg4.l3.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg4.l3.m1.2.2.1.1.1" xref="alg4.l3.m1.2.2.1.1.2.cmml"><mo id="alg4.l3.m1.2.2.1.1.1.2" stretchy="false" xref="alg4.l3.m1.2.2.1.1.2.cmml">(</mo><msup id="alg4.l3.m1.2.2.1.1.1.1" xref="alg4.l3.m1.2.2.1.1.1.1.cmml"><mi id="alg4.l3.m1.2.2.1.1.1.1.2" xref="alg4.l3.m1.2.2.1.1.1.1.2.cmml">q</mi><mo id="alg4.l3.m1.2.2.1.1.1.1.3" xref="alg4.l3.m1.2.2.1.1.1.1.3.cmml">′</mo></msup><mo id="alg4.l3.m1.2.2.1.1.1.3" xref="alg4.l3.m1.2.2.1.1.2.cmml">,</mo><mi id="alg4.l3.m1.1.1" xref="alg4.l3.m1.1.1.cmml">D</mi><mo id="alg4.l3.m1.2.2.1.1.1.4" stretchy="false" xref="alg4.l3.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg4.l3.m1.2b"><apply id="alg4.l3.m1.2.2.cmml" xref="alg4.l3.m1.2.2"><ci id="alg4.l3.m1.2.2.2.cmml" xref="alg4.l3.m1.2.2.2">←</ci><apply id="alg4.l3.m1.2.2.3.cmml" xref="alg4.l3.m1.2.2.3"><csymbol cd="ambiguous" id="alg4.l3.m1.2.2.3.1.cmml" xref="alg4.l3.m1.2.2.3">superscript</csymbol><ci id="alg4.l3.m1.2.2.3.2.cmml" xref="alg4.l3.m1.2.2.3.2">𝐷</ci><apply id="alg4.l3.m1.2.2.3.3.cmml" xref="alg4.l3.m1.2.2.3.3"><csymbol cd="ambiguous" id="alg4.l3.m1.2.2.3.3.1.cmml" xref="alg4.l3.m1.2.2.3.3">superscript</csymbol><ci id="alg4.l3.m1.2.2.3.3.2.cmml" xref="alg4.l3.m1.2.2.3.3.2">𝑞</ci><ci id="alg4.l3.m1.2.2.3.3.3.cmml" xref="alg4.l3.m1.2.2.3.3.3">′</ci></apply></apply><apply id="alg4.l3.m1.2.2.1.cmml" xref="alg4.l3.m1.2.2.1"><times id="alg4.l3.m1.2.2.1.2.cmml" xref="alg4.l3.m1.2.2.1.2"></times><ci id="alg4.l3.m1.2.2.1.3.cmml" xref="alg4.l3.m1.2.2.1.3">𝑅</ci><interval closure="open" id="alg4.l3.m1.2.2.1.1.2.cmml" xref="alg4.l3.m1.2.2.1.1.1"><apply id="alg4.l3.m1.2.2.1.1.1.1.cmml" xref="alg4.l3.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg4.l3.m1.2.2.1.1.1.1.1.cmml" xref="alg4.l3.m1.2.2.1.1.1.1">superscript</csymbol><ci id="alg4.l3.m1.2.2.1.1.1.1.2.cmml" xref="alg4.l3.m1.2.2.1.1.1.1.2">𝑞</ci><ci id="alg4.l3.m1.2.2.1.1.1.1.3.cmml" xref="alg4.l3.m1.2.2.1.1.1.1.3">′</ci></apply><ci id="alg4.l3.m1.1.1.cmml" xref="alg4.l3.m1.1.1">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l3.m1.2c">D^{q^{\prime}}\leftarrow R(q^{\prime},D)</annotation><annotation encoding="application/x-llamapun" id="alg4.l3.m1.2d">italic_D start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT ← italic_R ( italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_D )</annotation></semantics></math> // Retrieve a set of documents based on the pre-processed query

</div>
<div class="ltx_listingline" id="alg4.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l4.1.1.1" style="font-size:80%;">4:</span></span>  <math alttext="G\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg4.l4.m1.1"><semantics id="alg4.l4.m1.1a"><mrow id="alg4.l4.m1.1.1" xref="alg4.l4.m1.1.1.cmml"><mi id="alg4.l4.m1.1.1.2" xref="alg4.l4.m1.1.1.2.cmml">G</mi><mo id="alg4.l4.m1.1.1.1" stretchy="false" xref="alg4.l4.m1.1.1.1.cmml">←</mo><mi id="alg4.l4.m1.1.1.3" mathvariant="normal" xref="alg4.l4.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg4.l4.m1.1b"><apply id="alg4.l4.m1.1.1.cmml" xref="alg4.l4.m1.1.1"><ci id="alg4.l4.m1.1.1.1.cmml" xref="alg4.l4.m1.1.1.1">←</ci><ci id="alg4.l4.m1.1.1.2.cmml" xref="alg4.l4.m1.1.1.2">𝐺</ci><emptyset id="alg4.l4.m1.1.1.3.cmml" xref="alg4.l4.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l4.m1.1c">G\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg4.l4.m1.1d">italic_G ← ∅</annotation></semantics></math> // Initialize an empty set to store generated results

</div>
<div class="ltx_listingline" id="alg4.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l5.1.1.1" style="font-size:80%;">5:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l5.2">for all</span> <math alttext="d_{i}\in D^{q^{\prime}}" class="ltx_Math" display="inline" id="alg4.l5.m1.1"><semantics id="alg4.l5.m1.1a"><mrow id="alg4.l5.m1.1.1" xref="alg4.l5.m1.1.1.cmml"><msub id="alg4.l5.m1.1.1.2" xref="alg4.l5.m1.1.1.2.cmml"><mi id="alg4.l5.m1.1.1.2.2" xref="alg4.l5.m1.1.1.2.2.cmml">d</mi><mi id="alg4.l5.m1.1.1.2.3" xref="alg4.l5.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg4.l5.m1.1.1.1" xref="alg4.l5.m1.1.1.1.cmml">∈</mo><msup id="alg4.l5.m1.1.1.3" xref="alg4.l5.m1.1.1.3.cmml"><mi id="alg4.l5.m1.1.1.3.2" xref="alg4.l5.m1.1.1.3.2.cmml">D</mi><msup id="alg4.l5.m1.1.1.3.3" xref="alg4.l5.m1.1.1.3.3.cmml"><mi id="alg4.l5.m1.1.1.3.3.2" xref="alg4.l5.m1.1.1.3.3.2.cmml">q</mi><mo id="alg4.l5.m1.1.1.3.3.3" xref="alg4.l5.m1.1.1.3.3.3.cmml">′</mo></msup></msup></mrow><annotation-xml encoding="MathML-Content" id="alg4.l5.m1.1b"><apply id="alg4.l5.m1.1.1.cmml" xref="alg4.l5.m1.1.1"><in id="alg4.l5.m1.1.1.1.cmml" xref="alg4.l5.m1.1.1.1"></in><apply id="alg4.l5.m1.1.1.2.cmml" xref="alg4.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg4.l5.m1.1.1.2.1.cmml" xref="alg4.l5.m1.1.1.2">subscript</csymbol><ci id="alg4.l5.m1.1.1.2.2.cmml" xref="alg4.l5.m1.1.1.2.2">𝑑</ci><ci id="alg4.l5.m1.1.1.2.3.cmml" xref="alg4.l5.m1.1.1.2.3">𝑖</ci></apply><apply id="alg4.l5.m1.1.1.3.cmml" xref="alg4.l5.m1.1.1.3"><csymbol cd="ambiguous" id="alg4.l5.m1.1.1.3.1.cmml" xref="alg4.l5.m1.1.1.3">superscript</csymbol><ci id="alg4.l5.m1.1.1.3.2.cmml" xref="alg4.l5.m1.1.1.3.2">𝐷</ci><apply id="alg4.l5.m1.1.1.3.3.cmml" xref="alg4.l5.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg4.l5.m1.1.1.3.3.1.cmml" xref="alg4.l5.m1.1.1.3.3">superscript</csymbol><ci id="alg4.l5.m1.1.1.3.3.2.cmml" xref="alg4.l5.m1.1.1.3.3.2">𝑞</ci><ci id="alg4.l5.m1.1.1.3.3.3.cmml" xref="alg4.l5.m1.1.1.3.3.3">′</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l5.m1.1c">d_{i}\in D^{q^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="alg4.l5.m1.1d">italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_D start_POSTSUPERSCRIPT italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg4.l5.3">do</span>
</div>
<div class="ltx_listingline" id="alg4.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l6.1.1.1" style="font-size:80%;">6:</span></span>     <math alttext="y_{i}\leftarrow LLM([q,d_{i}])" class="ltx_Math" display="inline" id="alg4.l6.m1.2"><semantics id="alg4.l6.m1.2a"><mrow id="alg4.l6.m1.2.2" xref="alg4.l6.m1.2.2.cmml"><msub id="alg4.l6.m1.2.2.3" xref="alg4.l6.m1.2.2.3.cmml"><mi id="alg4.l6.m1.2.2.3.2" xref="alg4.l6.m1.2.2.3.2.cmml">y</mi><mi id="alg4.l6.m1.2.2.3.3" xref="alg4.l6.m1.2.2.3.3.cmml">i</mi></msub><mo id="alg4.l6.m1.2.2.2" stretchy="false" xref="alg4.l6.m1.2.2.2.cmml">←</mo><mrow id="alg4.l6.m1.2.2.1" xref="alg4.l6.m1.2.2.1.cmml"><mi id="alg4.l6.m1.2.2.1.3" xref="alg4.l6.m1.2.2.1.3.cmml">L</mi><mo id="alg4.l6.m1.2.2.1.2" xref="alg4.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg4.l6.m1.2.2.1.4" xref="alg4.l6.m1.2.2.1.4.cmml">L</mi><mo id="alg4.l6.m1.2.2.1.2a" xref="alg4.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg4.l6.m1.2.2.1.5" xref="alg4.l6.m1.2.2.1.5.cmml">M</mi><mo id="alg4.l6.m1.2.2.1.2b" xref="alg4.l6.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg4.l6.m1.2.2.1.1.1" xref="alg4.l6.m1.2.2.1.cmml"><mo id="alg4.l6.m1.2.2.1.1.1.2" stretchy="false" xref="alg4.l6.m1.2.2.1.cmml">(</mo><mrow id="alg4.l6.m1.2.2.1.1.1.1.1" xref="alg4.l6.m1.2.2.1.1.1.1.2.cmml"><mo id="alg4.l6.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="alg4.l6.m1.2.2.1.1.1.1.2.cmml">[</mo><mi id="alg4.l6.m1.1.1" xref="alg4.l6.m1.1.1.cmml">q</mi><mo id="alg4.l6.m1.2.2.1.1.1.1.1.3" xref="alg4.l6.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg4.l6.m1.2.2.1.1.1.1.1.1" xref="alg4.l6.m1.2.2.1.1.1.1.1.1.cmml"><mi id="alg4.l6.m1.2.2.1.1.1.1.1.1.2" xref="alg4.l6.m1.2.2.1.1.1.1.1.1.2.cmml">d</mi><mi id="alg4.l6.m1.2.2.1.1.1.1.1.1.3" xref="alg4.l6.m1.2.2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="alg4.l6.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="alg4.l6.m1.2.2.1.1.1.1.2.cmml">]</mo></mrow><mo id="alg4.l6.m1.2.2.1.1.1.3" stretchy="false" xref="alg4.l6.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg4.l6.m1.2b"><apply id="alg4.l6.m1.2.2.cmml" xref="alg4.l6.m1.2.2"><ci id="alg4.l6.m1.2.2.2.cmml" xref="alg4.l6.m1.2.2.2">←</ci><apply id="alg4.l6.m1.2.2.3.cmml" xref="alg4.l6.m1.2.2.3"><csymbol cd="ambiguous" id="alg4.l6.m1.2.2.3.1.cmml" xref="alg4.l6.m1.2.2.3">subscript</csymbol><ci id="alg4.l6.m1.2.2.3.2.cmml" xref="alg4.l6.m1.2.2.3.2">𝑦</ci><ci id="alg4.l6.m1.2.2.3.3.cmml" xref="alg4.l6.m1.2.2.3.3">𝑖</ci></apply><apply id="alg4.l6.m1.2.2.1.cmml" xref="alg4.l6.m1.2.2.1"><times id="alg4.l6.m1.2.2.1.2.cmml" xref="alg4.l6.m1.2.2.1.2"></times><ci id="alg4.l6.m1.2.2.1.3.cmml" xref="alg4.l6.m1.2.2.1.3">𝐿</ci><ci id="alg4.l6.m1.2.2.1.4.cmml" xref="alg4.l6.m1.2.2.1.4">𝐿</ci><ci id="alg4.l6.m1.2.2.1.5.cmml" xref="alg4.l6.m1.2.2.1.5">𝑀</ci><interval closure="closed" id="alg4.l6.m1.2.2.1.1.1.1.2.cmml" xref="alg4.l6.m1.2.2.1.1.1.1.1"><ci id="alg4.l6.m1.1.1.cmml" xref="alg4.l6.m1.1.1">𝑞</ci><apply id="alg4.l6.m1.2.2.1.1.1.1.1.1.cmml" xref="alg4.l6.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg4.l6.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg4.l6.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="alg4.l6.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg4.l6.m1.2.2.1.1.1.1.1.1.2">𝑑</ci><ci id="alg4.l6.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg4.l6.m1.2.2.1.1.1.1.1.1.3">𝑖</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l6.m1.2c">y_{i}\leftarrow LLM([q,d_{i}])</annotation><annotation encoding="application/x-llamapun" id="alg4.l6.m1.2d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_L italic_L italic_M ( [ italic_q , italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] )</annotation></semantics></math> // Generate results independently for each document chunk using the language model

</div>
<div class="ltx_listingline" id="alg4.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l7.1.1.1" style="font-size:80%;">7:</span></span>     <math alttext="O_{i}\leftarrow O_{i}\cup\{y_{i}\}" class="ltx_Math" display="inline" id="alg4.l7.m1.1"><semantics id="alg4.l7.m1.1a"><mrow id="alg4.l7.m1.1.1" xref="alg4.l7.m1.1.1.cmml"><msub id="alg4.l7.m1.1.1.3" xref="alg4.l7.m1.1.1.3.cmml"><mi id="alg4.l7.m1.1.1.3.2" xref="alg4.l7.m1.1.1.3.2.cmml">O</mi><mi id="alg4.l7.m1.1.1.3.3" xref="alg4.l7.m1.1.1.3.3.cmml">i</mi></msub><mo id="alg4.l7.m1.1.1.2" stretchy="false" xref="alg4.l7.m1.1.1.2.cmml">←</mo><mrow id="alg4.l7.m1.1.1.1" xref="alg4.l7.m1.1.1.1.cmml"><msub id="alg4.l7.m1.1.1.1.3" xref="alg4.l7.m1.1.1.1.3.cmml"><mi id="alg4.l7.m1.1.1.1.3.2" xref="alg4.l7.m1.1.1.1.3.2.cmml">O</mi><mi id="alg4.l7.m1.1.1.1.3.3" xref="alg4.l7.m1.1.1.1.3.3.cmml">i</mi></msub><mo id="alg4.l7.m1.1.1.1.2" xref="alg4.l7.m1.1.1.1.2.cmml">∪</mo><mrow id="alg4.l7.m1.1.1.1.1.1" xref="alg4.l7.m1.1.1.1.1.2.cmml"><mo id="alg4.l7.m1.1.1.1.1.1.2" stretchy="false" xref="alg4.l7.m1.1.1.1.1.2.cmml">{</mo><msub id="alg4.l7.m1.1.1.1.1.1.1" xref="alg4.l7.m1.1.1.1.1.1.1.cmml"><mi id="alg4.l7.m1.1.1.1.1.1.1.2" xref="alg4.l7.m1.1.1.1.1.1.1.2.cmml">y</mi><mi id="alg4.l7.m1.1.1.1.1.1.1.3" xref="alg4.l7.m1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="alg4.l7.m1.1.1.1.1.1.3" stretchy="false" xref="alg4.l7.m1.1.1.1.1.2.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg4.l7.m1.1b"><apply id="alg4.l7.m1.1.1.cmml" xref="alg4.l7.m1.1.1"><ci id="alg4.l7.m1.1.1.2.cmml" xref="alg4.l7.m1.1.1.2">←</ci><apply id="alg4.l7.m1.1.1.3.cmml" xref="alg4.l7.m1.1.1.3"><csymbol cd="ambiguous" id="alg4.l7.m1.1.1.3.1.cmml" xref="alg4.l7.m1.1.1.3">subscript</csymbol><ci id="alg4.l7.m1.1.1.3.2.cmml" xref="alg4.l7.m1.1.1.3.2">𝑂</ci><ci id="alg4.l7.m1.1.1.3.3.cmml" xref="alg4.l7.m1.1.1.3.3">𝑖</ci></apply><apply id="alg4.l7.m1.1.1.1.cmml" xref="alg4.l7.m1.1.1.1"><union id="alg4.l7.m1.1.1.1.2.cmml" xref="alg4.l7.m1.1.1.1.2"></union><apply id="alg4.l7.m1.1.1.1.3.cmml" xref="alg4.l7.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg4.l7.m1.1.1.1.3.1.cmml" xref="alg4.l7.m1.1.1.1.3">subscript</csymbol><ci id="alg4.l7.m1.1.1.1.3.2.cmml" xref="alg4.l7.m1.1.1.1.3.2">𝑂</ci><ci id="alg4.l7.m1.1.1.1.3.3.cmml" xref="alg4.l7.m1.1.1.1.3.3">𝑖</ci></apply><set id="alg4.l7.m1.1.1.1.1.2.cmml" xref="alg4.l7.m1.1.1.1.1.1"><apply id="alg4.l7.m1.1.1.1.1.1.1.cmml" xref="alg4.l7.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg4.l7.m1.1.1.1.1.1.1.1.cmml" xref="alg4.l7.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg4.l7.m1.1.1.1.1.1.1.2.cmml" xref="alg4.l7.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="alg4.l7.m1.1.1.1.1.1.1.3.cmml" xref="alg4.l7.m1.1.1.1.1.1.1.3">𝑖</ci></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l7.m1.1c">O_{i}\leftarrow O_{i}\cup\{y_{i}\}</annotation><annotation encoding="application/x-llamapun" id="alg4.l7.m1.1d">italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∪ { italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT }</annotation></semantics></math> // Add the generated result to the set of results

</div>
<div class="ltx_listingline" id="alg4.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l8.1.1.1" style="font-size:80%;">8:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l8.2">end</span> <span class="ltx_text ltx_font_bold" id="alg4.l8.3">for</span>
</div>
<div class="ltx_listingline" id="alg4.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l9.1.1.1" style="font-size:80%;">9:</span></span>  <math alttext="\hat{y}\leftarrow M_{\text{merge}}(O_{i})" class="ltx_Math" display="inline" id="alg4.l9.m1.1"><semantics id="alg4.l9.m1.1a"><mrow id="alg4.l9.m1.1.1" xref="alg4.l9.m1.1.1.cmml"><mover accent="true" id="alg4.l9.m1.1.1.3" xref="alg4.l9.m1.1.1.3.cmml"><mi id="alg4.l9.m1.1.1.3.2" xref="alg4.l9.m1.1.1.3.2.cmml">y</mi><mo id="alg4.l9.m1.1.1.3.1" xref="alg4.l9.m1.1.1.3.1.cmml">^</mo></mover><mo id="alg4.l9.m1.1.1.2" stretchy="false" xref="alg4.l9.m1.1.1.2.cmml">←</mo><mrow id="alg4.l9.m1.1.1.1" xref="alg4.l9.m1.1.1.1.cmml"><msub id="alg4.l9.m1.1.1.1.3" xref="alg4.l9.m1.1.1.1.3.cmml"><mi id="alg4.l9.m1.1.1.1.3.2" xref="alg4.l9.m1.1.1.1.3.2.cmml">M</mi><mtext id="alg4.l9.m1.1.1.1.3.3" xref="alg4.l9.m1.1.1.1.3.3a.cmml">merge</mtext></msub><mo id="alg4.l9.m1.1.1.1.2" xref="alg4.l9.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg4.l9.m1.1.1.1.1.1" xref="alg4.l9.m1.1.1.1.1.1.1.cmml"><mo id="alg4.l9.m1.1.1.1.1.1.2" stretchy="false" xref="alg4.l9.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg4.l9.m1.1.1.1.1.1.1" xref="alg4.l9.m1.1.1.1.1.1.1.cmml"><mi id="alg4.l9.m1.1.1.1.1.1.1.2" xref="alg4.l9.m1.1.1.1.1.1.1.2.cmml">O</mi><mi id="alg4.l9.m1.1.1.1.1.1.1.3" xref="alg4.l9.m1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="alg4.l9.m1.1.1.1.1.1.3" stretchy="false" xref="alg4.l9.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg4.l9.m1.1b"><apply id="alg4.l9.m1.1.1.cmml" xref="alg4.l9.m1.1.1"><ci id="alg4.l9.m1.1.1.2.cmml" xref="alg4.l9.m1.1.1.2">←</ci><apply id="alg4.l9.m1.1.1.3.cmml" xref="alg4.l9.m1.1.1.3"><ci id="alg4.l9.m1.1.1.3.1.cmml" xref="alg4.l9.m1.1.1.3.1">^</ci><ci id="alg4.l9.m1.1.1.3.2.cmml" xref="alg4.l9.m1.1.1.3.2">𝑦</ci></apply><apply id="alg4.l9.m1.1.1.1.cmml" xref="alg4.l9.m1.1.1.1"><times id="alg4.l9.m1.1.1.1.2.cmml" xref="alg4.l9.m1.1.1.1.2"></times><apply id="alg4.l9.m1.1.1.1.3.cmml" xref="alg4.l9.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg4.l9.m1.1.1.1.3.1.cmml" xref="alg4.l9.m1.1.1.1.3">subscript</csymbol><ci id="alg4.l9.m1.1.1.1.3.2.cmml" xref="alg4.l9.m1.1.1.1.3.2">𝑀</ci><ci id="alg4.l9.m1.1.1.1.3.3a.cmml" xref="alg4.l9.m1.1.1.1.3.3"><mtext id="alg4.l9.m1.1.1.1.3.3.cmml" mathsize="70%" xref="alg4.l9.m1.1.1.1.3.3">merge</mtext></ci></apply><apply id="alg4.l9.m1.1.1.1.1.1.1.cmml" xref="alg4.l9.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg4.l9.m1.1.1.1.1.1.1.1.cmml" xref="alg4.l9.m1.1.1.1.1.1">subscript</csymbol><ci id="alg4.l9.m1.1.1.1.1.1.1.2.cmml" xref="alg4.l9.m1.1.1.1.1.1.1.2">𝑂</ci><ci id="alg4.l9.m1.1.1.1.1.1.1.3.cmml" xref="alg4.l9.m1.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l9.m1.1c">\hat{y}\leftarrow M_{\text{merge}}(O_{i})</annotation><annotation encoding="application/x-llamapun" id="alg4.l9.m1.1d">over^ start_ARG italic_y end_ARG ← italic_M start_POSTSUBSCRIPT merge end_POSTSUBSCRIPT ( italic_O start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> // Merge all generated results using the merge function

</div>
<div class="ltx_listingline" id="alg4.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l10.1.1.1" style="font-size:80%;">10:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l10.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg4.l10.m1.1"><semantics id="alg4.l10.m1.1a"><mover accent="true" id="alg4.l10.m1.1.1" xref="alg4.l10.m1.1.1.cmml"><mi id="alg4.l10.m1.1.1.2" xref="alg4.l10.m1.1.1.2.cmml">y</mi><mo id="alg4.l10.m1.1.1.1" xref="alg4.l10.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg4.l10.m1.1b"><apply id="alg4.l10.m1.1.1.cmml" xref="alg4.l10.m1.1.1"><ci id="alg4.l10.m1.1.1.1.cmml" xref="alg4.l10.m1.1.1.1">^</ci><ci id="alg4.l10.m1.1.1.2.cmml" xref="alg4.l10.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg4.l10.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg4.l10.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S5.SS3.p5">
<p class="ltx_p" id="S5.SS3.p5.1">REPLUG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib55" title="">55</a>]</cite> embodies a classic post-retrieval branching structure, wherein the probability of each token is predicted for each branch. Through weighted possibility ensemble, the different branches are aggregated, and the final generation result is used to fine-tune the retriever, known as Contriever, through feedback.</p>
</div>
<figure class="ltx_figure" id="S5.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="245" id="S5.F9.g1" src="extracted/5756188/images/Replug.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 9: </span>The RAG flow in REPLUG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib55" title="">55</a>]</cite>, which follows a typical post-retrieval branching pattern. Each retrieved chunks undergoes parallel generation, and then they are aggregated using a weighted probability ensemble. </figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S5.SS4.5.1.1">V-D</span> </span><span class="ltx_text ltx_font_italic" id="S5.SS4.6.2">Loop Pattern</span>
</h3>
<div class="ltx_para" id="S5.SS4.p1">
<p class="ltx_p" id="S5.SS4.p1.23">The RAG flow with a loop structure, as an important characteristic of Modular RAG, involves interdependent retrieval and generation steps. It typically includes a scheduling module for flow control. The modular RAG system can be abstracted as a directed graph <math alttext="G=(V,E)" class="ltx_Math" display="inline" id="S5.SS4.p1.1.m1.2"><semantics id="S5.SS4.p1.1.m1.2a"><mrow id="S5.SS4.p1.1.m1.2.3" xref="S5.SS4.p1.1.m1.2.3.cmml"><mi id="S5.SS4.p1.1.m1.2.3.2" xref="S5.SS4.p1.1.m1.2.3.2.cmml">G</mi><mo id="S5.SS4.p1.1.m1.2.3.1" xref="S5.SS4.p1.1.m1.2.3.1.cmml">=</mo><mrow id="S5.SS4.p1.1.m1.2.3.3.2" xref="S5.SS4.p1.1.m1.2.3.3.1.cmml"><mo id="S5.SS4.p1.1.m1.2.3.3.2.1" stretchy="false" xref="S5.SS4.p1.1.m1.2.3.3.1.cmml">(</mo><mi id="S5.SS4.p1.1.m1.1.1" xref="S5.SS4.p1.1.m1.1.1.cmml">V</mi><mo id="S5.SS4.p1.1.m1.2.3.3.2.2" xref="S5.SS4.p1.1.m1.2.3.3.1.cmml">,</mo><mi id="S5.SS4.p1.1.m1.2.2" xref="S5.SS4.p1.1.m1.2.2.cmml">E</mi><mo id="S5.SS4.p1.1.m1.2.3.3.2.3" stretchy="false" xref="S5.SS4.p1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.1.m1.2b"><apply id="S5.SS4.p1.1.m1.2.3.cmml" xref="S5.SS4.p1.1.m1.2.3"><eq id="S5.SS4.p1.1.m1.2.3.1.cmml" xref="S5.SS4.p1.1.m1.2.3.1"></eq><ci id="S5.SS4.p1.1.m1.2.3.2.cmml" xref="S5.SS4.p1.1.m1.2.3.2">𝐺</ci><interval closure="open" id="S5.SS4.p1.1.m1.2.3.3.1.cmml" xref="S5.SS4.p1.1.m1.2.3.3.2"><ci id="S5.SS4.p1.1.m1.1.1.cmml" xref="S5.SS4.p1.1.m1.1.1">𝑉</ci><ci id="S5.SS4.p1.1.m1.2.2.cmml" xref="S5.SS4.p1.1.m1.2.2">𝐸</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.1.m1.2c">G=(V,E)</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.1.m1.2d">italic_G = ( italic_V , italic_E )</annotation></semantics></math>, where <math alttext="V" class="ltx_Math" display="inline" id="S5.SS4.p1.2.m2.1"><semantics id="S5.SS4.p1.2.m2.1a"><mi id="S5.SS4.p1.2.m2.1.1" xref="S5.SS4.p1.2.m2.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.2.m2.1b"><ci id="S5.SS4.p1.2.m2.1.1.cmml" xref="S5.SS4.p1.2.m2.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.2.m2.1c">V</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.2.m2.1d">italic_V</annotation></semantics></math> is the set of vertices representing the various modules <math alttext="M_{i}" class="ltx_Math" display="inline" id="S5.SS4.p1.3.m3.1"><semantics id="S5.SS4.p1.3.m3.1a"><msub id="S5.SS4.p1.3.m3.1.1" xref="S5.SS4.p1.3.m3.1.1.cmml"><mi id="S5.SS4.p1.3.m3.1.1.2" xref="S5.SS4.p1.3.m3.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.3.m3.1.1.3" xref="S5.SS4.p1.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.3.m3.1b"><apply id="S5.SS4.p1.3.m3.1.1.cmml" xref="S5.SS4.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.3.m3.1.1.1.cmml" xref="S5.SS4.p1.3.m3.1.1">subscript</csymbol><ci id="S5.SS4.p1.3.m3.1.1.2.cmml" xref="S5.SS4.p1.3.m3.1.1.2">𝑀</ci><ci id="S5.SS4.p1.3.m3.1.1.3.cmml" xref="S5.SS4.p1.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.3.m3.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.3.m3.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> in the system, and <math alttext="E" class="ltx_Math" display="inline" id="S5.SS4.p1.4.m4.1"><semantics id="S5.SS4.p1.4.m4.1a"><mi id="S5.SS4.p1.4.m4.1.1" xref="S5.SS4.p1.4.m4.1.1.cmml">E</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.4.m4.1b"><ci id="S5.SS4.p1.4.m4.1.1.cmml" xref="S5.SS4.p1.4.m4.1.1">𝐸</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.4.m4.1c">E</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.4.m4.1d">italic_E</annotation></semantics></math> is the set of edges representing the control flow or data flow between modules. If there is a vertex sequence <math alttext="M_{i_{1}},M_{i_{2}},...,M_{i_{n}}" class="ltx_Math" display="inline" id="S5.SS4.p1.5.m5.4"><semantics id="S5.SS4.p1.5.m5.4a"><mrow id="S5.SS4.p1.5.m5.4.4.3" xref="S5.SS4.p1.5.m5.4.4.4.cmml"><msub id="S5.SS4.p1.5.m5.2.2.1.1" xref="S5.SS4.p1.5.m5.2.2.1.1.cmml"><mi id="S5.SS4.p1.5.m5.2.2.1.1.2" xref="S5.SS4.p1.5.m5.2.2.1.1.2.cmml">M</mi><msub id="S5.SS4.p1.5.m5.2.2.1.1.3" xref="S5.SS4.p1.5.m5.2.2.1.1.3.cmml"><mi id="S5.SS4.p1.5.m5.2.2.1.1.3.2" xref="S5.SS4.p1.5.m5.2.2.1.1.3.2.cmml">i</mi><mn id="S5.SS4.p1.5.m5.2.2.1.1.3.3" xref="S5.SS4.p1.5.m5.2.2.1.1.3.3.cmml">1</mn></msub></msub><mo id="S5.SS4.p1.5.m5.4.4.3.4" xref="S5.SS4.p1.5.m5.4.4.4.cmml">,</mo><msub id="S5.SS4.p1.5.m5.3.3.2.2" xref="S5.SS4.p1.5.m5.3.3.2.2.cmml"><mi id="S5.SS4.p1.5.m5.3.3.2.2.2" xref="S5.SS4.p1.5.m5.3.3.2.2.2.cmml">M</mi><msub id="S5.SS4.p1.5.m5.3.3.2.2.3" xref="S5.SS4.p1.5.m5.3.3.2.2.3.cmml"><mi id="S5.SS4.p1.5.m5.3.3.2.2.3.2" xref="S5.SS4.p1.5.m5.3.3.2.2.3.2.cmml">i</mi><mn id="S5.SS4.p1.5.m5.3.3.2.2.3.3" xref="S5.SS4.p1.5.m5.3.3.2.2.3.3.cmml">2</mn></msub></msub><mo id="S5.SS4.p1.5.m5.4.4.3.5" xref="S5.SS4.p1.5.m5.4.4.4.cmml">,</mo><mi id="S5.SS4.p1.5.m5.1.1" mathvariant="normal" xref="S5.SS4.p1.5.m5.1.1.cmml">…</mi><mo id="S5.SS4.p1.5.m5.4.4.3.6" xref="S5.SS4.p1.5.m5.4.4.4.cmml">,</mo><msub id="S5.SS4.p1.5.m5.4.4.3.3" xref="S5.SS4.p1.5.m5.4.4.3.3.cmml"><mi id="S5.SS4.p1.5.m5.4.4.3.3.2" xref="S5.SS4.p1.5.m5.4.4.3.3.2.cmml">M</mi><msub id="S5.SS4.p1.5.m5.4.4.3.3.3" xref="S5.SS4.p1.5.m5.4.4.3.3.3.cmml"><mi id="S5.SS4.p1.5.m5.4.4.3.3.3.2" xref="S5.SS4.p1.5.m5.4.4.3.3.3.2.cmml">i</mi><mi id="S5.SS4.p1.5.m5.4.4.3.3.3.3" xref="S5.SS4.p1.5.m5.4.4.3.3.3.3.cmml">n</mi></msub></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.5.m5.4b"><list id="S5.SS4.p1.5.m5.4.4.4.cmml" xref="S5.SS4.p1.5.m5.4.4.3"><apply id="S5.SS4.p1.5.m5.2.2.1.1.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.2.2.1.1.1.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1">subscript</csymbol><ci id="S5.SS4.p1.5.m5.2.2.1.1.2.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1.2">𝑀</ci><apply id="S5.SS4.p1.5.m5.2.2.1.1.3.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1.3"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.2.2.1.1.3.1.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1.3">subscript</csymbol><ci id="S5.SS4.p1.5.m5.2.2.1.1.3.2.cmml" xref="S5.SS4.p1.5.m5.2.2.1.1.3.2">𝑖</ci><cn id="S5.SS4.p1.5.m5.2.2.1.1.3.3.cmml" type="integer" xref="S5.SS4.p1.5.m5.2.2.1.1.3.3">1</cn></apply></apply><apply id="S5.SS4.p1.5.m5.3.3.2.2.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.3.3.2.2.1.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2">subscript</csymbol><ci id="S5.SS4.p1.5.m5.3.3.2.2.2.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2.2">𝑀</ci><apply id="S5.SS4.p1.5.m5.3.3.2.2.3.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2.3"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.3.3.2.2.3.1.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2.3">subscript</csymbol><ci id="S5.SS4.p1.5.m5.3.3.2.2.3.2.cmml" xref="S5.SS4.p1.5.m5.3.3.2.2.3.2">𝑖</ci><cn id="S5.SS4.p1.5.m5.3.3.2.2.3.3.cmml" type="integer" xref="S5.SS4.p1.5.m5.3.3.2.2.3.3">2</cn></apply></apply><ci id="S5.SS4.p1.5.m5.1.1.cmml" xref="S5.SS4.p1.5.m5.1.1">…</ci><apply id="S5.SS4.p1.5.m5.4.4.3.3.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.4.4.3.3.1.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3">subscript</csymbol><ci id="S5.SS4.p1.5.m5.4.4.3.3.2.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3.2">𝑀</ci><apply id="S5.SS4.p1.5.m5.4.4.3.3.3.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3.3"><csymbol cd="ambiguous" id="S5.SS4.p1.5.m5.4.4.3.3.3.1.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3.3">subscript</csymbol><ci id="S5.SS4.p1.5.m5.4.4.3.3.3.2.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3.3.2">𝑖</ci><ci id="S5.SS4.p1.5.m5.4.4.3.3.3.3.cmml" xref="S5.SS4.p1.5.m5.4.4.3.3.3.3">𝑛</ci></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.5.m5.4c">M_{i_{1}},M_{i_{2}},...,M_{i_{n}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.5.m5.4d">italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , … , italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> such that <math alttext="M_{i_{n}}" class="ltx_Math" display="inline" id="S5.SS4.p1.6.m6.1"><semantics id="S5.SS4.p1.6.m6.1a"><msub id="S5.SS4.p1.6.m6.1.1" xref="S5.SS4.p1.6.m6.1.1.cmml"><mi id="S5.SS4.p1.6.m6.1.1.2" xref="S5.SS4.p1.6.m6.1.1.2.cmml">M</mi><msub id="S5.SS4.p1.6.m6.1.1.3" xref="S5.SS4.p1.6.m6.1.1.3.cmml"><mi id="S5.SS4.p1.6.m6.1.1.3.2" xref="S5.SS4.p1.6.m6.1.1.3.2.cmml">i</mi><mi id="S5.SS4.p1.6.m6.1.1.3.3" xref="S5.SS4.p1.6.m6.1.1.3.3.cmml">n</mi></msub></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.6.m6.1b"><apply id="S5.SS4.p1.6.m6.1.1.cmml" xref="S5.SS4.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.6.m6.1.1.1.cmml" xref="S5.SS4.p1.6.m6.1.1">subscript</csymbol><ci id="S5.SS4.p1.6.m6.1.1.2.cmml" xref="S5.SS4.p1.6.m6.1.1.2">𝑀</ci><apply id="S5.SS4.p1.6.m6.1.1.3.cmml" xref="S5.SS4.p1.6.m6.1.1.3"><csymbol cd="ambiguous" id="S5.SS4.p1.6.m6.1.1.3.1.cmml" xref="S5.SS4.p1.6.m6.1.1.3">subscript</csymbol><ci id="S5.SS4.p1.6.m6.1.1.3.2.cmml" xref="S5.SS4.p1.6.m6.1.1.3.2">𝑖</ci><ci id="S5.SS4.p1.6.m6.1.1.3.3.cmml" xref="S5.SS4.p1.6.m6.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.6.m6.1c">M_{i_{n}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.6.m6.1d">italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> can reach <math alttext="M_{i_{1}}" class="ltx_Math" display="inline" id="S5.SS4.p1.7.m7.1"><semantics id="S5.SS4.p1.7.m7.1a"><msub id="S5.SS4.p1.7.m7.1.1" xref="S5.SS4.p1.7.m7.1.1.cmml"><mi id="S5.SS4.p1.7.m7.1.1.2" xref="S5.SS4.p1.7.m7.1.1.2.cmml">M</mi><msub id="S5.SS4.p1.7.m7.1.1.3" xref="S5.SS4.p1.7.m7.1.1.3.cmml"><mi id="S5.SS4.p1.7.m7.1.1.3.2" xref="S5.SS4.p1.7.m7.1.1.3.2.cmml">i</mi><mn id="S5.SS4.p1.7.m7.1.1.3.3" xref="S5.SS4.p1.7.m7.1.1.3.3.cmml">1</mn></msub></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.7.m7.1b"><apply id="S5.SS4.p1.7.m7.1.1.cmml" xref="S5.SS4.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.7.m7.1.1.1.cmml" xref="S5.SS4.p1.7.m7.1.1">subscript</csymbol><ci id="S5.SS4.p1.7.m7.1.1.2.cmml" xref="S5.SS4.p1.7.m7.1.1.2">𝑀</ci><apply id="S5.SS4.p1.7.m7.1.1.3.cmml" xref="S5.SS4.p1.7.m7.1.1.3"><csymbol cd="ambiguous" id="S5.SS4.p1.7.m7.1.1.3.1.cmml" xref="S5.SS4.p1.7.m7.1.1.3">subscript</csymbol><ci id="S5.SS4.p1.7.m7.1.1.3.2.cmml" xref="S5.SS4.p1.7.m7.1.1.3.2">𝑖</ci><cn id="S5.SS4.p1.7.m7.1.1.3.3.cmml" type="integer" xref="S5.SS4.p1.7.m7.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.7.m7.1c">M_{i_{1}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.7.m7.1d">italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> (i.e., <math alttext="M_{i_{n}}\rightarrow M_{i_{1}}" class="ltx_Math" display="inline" id="S5.SS4.p1.8.m8.1"><semantics id="S5.SS4.p1.8.m8.1a"><mrow id="S5.SS4.p1.8.m8.1.1" xref="S5.SS4.p1.8.m8.1.1.cmml"><msub id="S5.SS4.p1.8.m8.1.1.2" xref="S5.SS4.p1.8.m8.1.1.2.cmml"><mi id="S5.SS4.p1.8.m8.1.1.2.2" xref="S5.SS4.p1.8.m8.1.1.2.2.cmml">M</mi><msub id="S5.SS4.p1.8.m8.1.1.2.3" xref="S5.SS4.p1.8.m8.1.1.2.3.cmml"><mi id="S5.SS4.p1.8.m8.1.1.2.3.2" xref="S5.SS4.p1.8.m8.1.1.2.3.2.cmml">i</mi><mi id="S5.SS4.p1.8.m8.1.1.2.3.3" xref="S5.SS4.p1.8.m8.1.1.2.3.3.cmml">n</mi></msub></msub><mo id="S5.SS4.p1.8.m8.1.1.1" stretchy="false" xref="S5.SS4.p1.8.m8.1.1.1.cmml">→</mo><msub id="S5.SS4.p1.8.m8.1.1.3" xref="S5.SS4.p1.8.m8.1.1.3.cmml"><mi id="S5.SS4.p1.8.m8.1.1.3.2" xref="S5.SS4.p1.8.m8.1.1.3.2.cmml">M</mi><msub id="S5.SS4.p1.8.m8.1.1.3.3" xref="S5.SS4.p1.8.m8.1.1.3.3.cmml"><mi id="S5.SS4.p1.8.m8.1.1.3.3.2" xref="S5.SS4.p1.8.m8.1.1.3.3.2.cmml">i</mi><mn id="S5.SS4.p1.8.m8.1.1.3.3.3" xref="S5.SS4.p1.8.m8.1.1.3.3.3.cmml">1</mn></msub></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.8.m8.1b"><apply id="S5.SS4.p1.8.m8.1.1.cmml" xref="S5.SS4.p1.8.m8.1.1"><ci id="S5.SS4.p1.8.m8.1.1.1.cmml" xref="S5.SS4.p1.8.m8.1.1.1">→</ci><apply id="S5.SS4.p1.8.m8.1.1.2.cmml" xref="S5.SS4.p1.8.m8.1.1.2"><csymbol cd="ambiguous" id="S5.SS4.p1.8.m8.1.1.2.1.cmml" xref="S5.SS4.p1.8.m8.1.1.2">subscript</csymbol><ci id="S5.SS4.p1.8.m8.1.1.2.2.cmml" xref="S5.SS4.p1.8.m8.1.1.2.2">𝑀</ci><apply id="S5.SS4.p1.8.m8.1.1.2.3.cmml" xref="S5.SS4.p1.8.m8.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS4.p1.8.m8.1.1.2.3.1.cmml" xref="S5.SS4.p1.8.m8.1.1.2.3">subscript</csymbol><ci id="S5.SS4.p1.8.m8.1.1.2.3.2.cmml" xref="S5.SS4.p1.8.m8.1.1.2.3.2">𝑖</ci><ci id="S5.SS4.p1.8.m8.1.1.2.3.3.cmml" xref="S5.SS4.p1.8.m8.1.1.2.3.3">𝑛</ci></apply></apply><apply id="S5.SS4.p1.8.m8.1.1.3.cmml" xref="S5.SS4.p1.8.m8.1.1.3"><csymbol cd="ambiguous" id="S5.SS4.p1.8.m8.1.1.3.1.cmml" xref="S5.SS4.p1.8.m8.1.1.3">subscript</csymbol><ci id="S5.SS4.p1.8.m8.1.1.3.2.cmml" xref="S5.SS4.p1.8.m8.1.1.3.2">𝑀</ci><apply id="S5.SS4.p1.8.m8.1.1.3.3.cmml" xref="S5.SS4.p1.8.m8.1.1.3.3"><csymbol cd="ambiguous" id="S5.SS4.p1.8.m8.1.1.3.3.1.cmml" xref="S5.SS4.p1.8.m8.1.1.3.3">subscript</csymbol><ci id="S5.SS4.p1.8.m8.1.1.3.3.2.cmml" xref="S5.SS4.p1.8.m8.1.1.3.3.2">𝑖</ci><cn id="S5.SS4.p1.8.m8.1.1.3.3.3.cmml" type="integer" xref="S5.SS4.p1.8.m8.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.8.m8.1c">M_{i_{n}}\rightarrow M_{i_{1}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.8.m8.1d">italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT → italic_M start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math>), then this RAG system forms a loop. If <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS4.p1.9.m9.1"><semantics id="S5.SS4.p1.9.m9.1a"><msub id="S5.SS4.p1.9.m9.1.1" xref="S5.SS4.p1.9.m9.1.1.cmml"><mi id="S5.SS4.p1.9.m9.1.1.2" xref="S5.SS4.p1.9.m9.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.9.m9.1.1.3" xref="S5.SS4.p1.9.m9.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.9.m9.1b"><apply id="S5.SS4.p1.9.m9.1.1.cmml" xref="S5.SS4.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.9.m9.1.1.1.cmml" xref="S5.SS4.p1.9.m9.1.1">subscript</csymbol><ci id="S5.SS4.p1.9.m9.1.1.2.cmml" xref="S5.SS4.p1.9.m9.1.1.2">𝑀</ci><ci id="S5.SS4.p1.9.m9.1.1.3.cmml" xref="S5.SS4.p1.9.m9.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.9.m9.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.9.m9.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is the successor module of <math alttext="M_{i}" class="ltx_Math" display="inline" id="S5.SS4.p1.10.m10.1"><semantics id="S5.SS4.p1.10.m10.1a"><msub id="S5.SS4.p1.10.m10.1.1" xref="S5.SS4.p1.10.m10.1.1.cmml"><mi id="S5.SS4.p1.10.m10.1.1.2" xref="S5.SS4.p1.10.m10.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.10.m10.1.1.3" xref="S5.SS4.p1.10.m10.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.10.m10.1b"><apply id="S5.SS4.p1.10.m10.1.1.cmml" xref="S5.SS4.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.10.m10.1.1.1.cmml" xref="S5.SS4.p1.10.m10.1.1">subscript</csymbol><ci id="S5.SS4.p1.10.m10.1.1.2.cmml" xref="S5.SS4.p1.10.m10.1.1.2">𝑀</ci><ci id="S5.SS4.p1.10.m10.1.1.3.cmml" xref="S5.SS4.p1.10.m10.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.10.m10.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.10.m10.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="M_{i}" class="ltx_Math" display="inline" id="S5.SS4.p1.11.m11.1"><semantics id="S5.SS4.p1.11.m11.1a"><msub id="S5.SS4.p1.11.m11.1.1" xref="S5.SS4.p1.11.m11.1.1.cmml"><mi id="S5.SS4.p1.11.m11.1.1.2" xref="S5.SS4.p1.11.m11.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.11.m11.1.1.3" xref="S5.SS4.p1.11.m11.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.11.m11.1b"><apply id="S5.SS4.p1.11.m11.1.1.cmml" xref="S5.SS4.p1.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.11.m11.1.1.1.cmml" xref="S5.SS4.p1.11.m11.1.1">subscript</csymbol><ci id="S5.SS4.p1.11.m11.1.1.2.cmml" xref="S5.SS4.p1.11.m11.1.1.2">𝑀</ci><ci id="S5.SS4.p1.11.m11.1.1.3.cmml" xref="S5.SS4.p1.11.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.11.m11.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.11.m11.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> decides whether to return to <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS4.p1.12.m12.1"><semantics id="S5.SS4.p1.12.m12.1a"><msub id="S5.SS4.p1.12.m12.1.1" xref="S5.SS4.p1.12.m12.1.1.cmml"><mi id="S5.SS4.p1.12.m12.1.1.2" xref="S5.SS4.p1.12.m12.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.12.m12.1.1.3" xref="S5.SS4.p1.12.m12.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.12.m12.1b"><apply id="S5.SS4.p1.12.m12.1.1.cmml" xref="S5.SS4.p1.12.m12.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.12.m12.1.1.1.cmml" xref="S5.SS4.p1.12.m12.1.1">subscript</csymbol><ci id="S5.SS4.p1.12.m12.1.1.2.cmml" xref="S5.SS4.p1.12.m12.1.1.2">𝑀</ci><ci id="S5.SS4.p1.12.m12.1.1.3.cmml" xref="S5.SS4.p1.12.m12.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.12.m12.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.12.m12.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> or a previous module <math alttext="M_{k}" class="ltx_Math" display="inline" id="S5.SS4.p1.13.m13.1"><semantics id="S5.SS4.p1.13.m13.1a"><msub id="S5.SS4.p1.13.m13.1.1" xref="S5.SS4.p1.13.m13.1.1.cmml"><mi id="S5.SS4.p1.13.m13.1.1.2" xref="S5.SS4.p1.13.m13.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.13.m13.1.1.3" xref="S5.SS4.p1.13.m13.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.13.m13.1b"><apply id="S5.SS4.p1.13.m13.1.1.cmml" xref="S5.SS4.p1.13.m13.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.13.m13.1.1.1.cmml" xref="S5.SS4.p1.13.m13.1.1">subscript</csymbol><ci id="S5.SS4.p1.13.m13.1.1.2.cmml" xref="S5.SS4.p1.13.m13.1.1.2">𝑀</ci><ci id="S5.SS4.p1.13.m13.1.1.3.cmml" xref="S5.SS4.p1.13.m13.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.13.m13.1c">M_{k}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.13.m13.1d">italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> through a Judge module, it can be represented as: <math alttext="M_{i}\xrightarrow{\text{Judge}}M_{j}\quad\text{or}\quad M_{i}\xrightarrow{%
\text{Judge}}M_{k}" class="ltx_Math" display="inline" id="S5.SS4.p1.14.m14.3"><semantics id="S5.SS4.p1.14.m14.3a"><mrow id="S5.SS4.p1.14.m14.3.3.2" xref="S5.SS4.p1.14.m14.3.3.3.cmml"><mrow id="S5.SS4.p1.14.m14.2.2.1.1" xref="S5.SS4.p1.14.m14.2.2.1.1.cmml"><msub id="S5.SS4.p1.14.m14.2.2.1.1.3" xref="S5.SS4.p1.14.m14.2.2.1.1.3.cmml"><mi id="S5.SS4.p1.14.m14.2.2.1.1.3.2" xref="S5.SS4.p1.14.m14.2.2.1.1.3.2.cmml">M</mi><mi id="S5.SS4.p1.14.m14.2.2.1.1.3.3" xref="S5.SS4.p1.14.m14.2.2.1.1.3.3.cmml">i</mi></msub><mover accent="true" id="S5.SS4.p1.14.m14.2.2.1.1.2" xref="S5.SS4.p1.14.m14.2.2.1.1.2.cmml"><mo id="S5.SS4.p1.14.m14.2.2.1.1.2.2" stretchy="false" xref="S5.SS4.p1.14.m14.2.2.1.1.2.2.cmml">→</mo><mtext id="S5.SS4.p1.14.m14.2.2.1.1.2.1" xref="S5.SS4.p1.14.m14.2.2.1.1.2.1a.cmml">Judge</mtext></mover><mrow id="S5.SS4.p1.14.m14.2.2.1.1.1.1" xref="S5.SS4.p1.14.m14.2.2.1.1.1.2.cmml"><msub id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.cmml"><mi id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.2" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.3" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.3.cmml">j</mi></msub><mspace id="S5.SS4.p1.14.m14.2.2.1.1.1.1.2" width="1em" xref="S5.SS4.p1.14.m14.2.2.1.1.1.2.cmml"></mspace><mtext id="S5.SS4.p1.14.m14.1.1" xref="S5.SS4.p1.14.m14.1.1a.cmml">or</mtext></mrow></mrow><mspace id="S5.SS4.p1.14.m14.3.3.2.3" width="1em" xref="S5.SS4.p1.14.m14.3.3.3a.cmml"></mspace><mrow id="S5.SS4.p1.14.m14.3.3.2.2" xref="S5.SS4.p1.14.m14.3.3.2.2.cmml"><msub id="S5.SS4.p1.14.m14.3.3.2.2.2" xref="S5.SS4.p1.14.m14.3.3.2.2.2.cmml"><mi id="S5.SS4.p1.14.m14.3.3.2.2.2.2" xref="S5.SS4.p1.14.m14.3.3.2.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.14.m14.3.3.2.2.2.3" xref="S5.SS4.p1.14.m14.3.3.2.2.2.3.cmml">i</mi></msub><mover accent="true" id="S5.SS4.p1.14.m14.3.3.2.2.1" xref="S5.SS4.p1.14.m14.3.3.2.2.1.cmml"><mo id="S5.SS4.p1.14.m14.3.3.2.2.1.2" stretchy="false" xref="S5.SS4.p1.14.m14.3.3.2.2.1.2.cmml">→</mo><mtext id="S5.SS4.p1.14.m14.3.3.2.2.1.1" xref="S5.SS4.p1.14.m14.3.3.2.2.1.1a.cmml">Judge</mtext></mover><msub id="S5.SS4.p1.14.m14.3.3.2.2.3" xref="S5.SS4.p1.14.m14.3.3.2.2.3.cmml"><mi id="S5.SS4.p1.14.m14.3.3.2.2.3.2" xref="S5.SS4.p1.14.m14.3.3.2.2.3.2.cmml">M</mi><mi id="S5.SS4.p1.14.m14.3.3.2.2.3.3" xref="S5.SS4.p1.14.m14.3.3.2.2.3.3.cmml">k</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.14.m14.3b"><apply id="S5.SS4.p1.14.m14.3.3.3.cmml" xref="S5.SS4.p1.14.m14.3.3.2"><csymbol cd="ambiguous" id="S5.SS4.p1.14.m14.3.3.3a.cmml" xref="S5.SS4.p1.14.m14.3.3.2.3">formulae-sequence</csymbol><apply id="S5.SS4.p1.14.m14.2.2.1.1.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1"><apply id="S5.SS4.p1.14.m14.2.2.1.1.2.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.2"><ci id="S5.SS4.p1.14.m14.2.2.1.1.2.1a.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.2.1"><mtext id="S5.SS4.p1.14.m14.2.2.1.1.2.1.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.2.1">Judge</mtext></ci><ci id="S5.SS4.p1.14.m14.2.2.1.1.2.2.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.2.2">→</ci></apply><apply id="S5.SS4.p1.14.m14.2.2.1.1.3.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.3"><csymbol cd="ambiguous" id="S5.SS4.p1.14.m14.2.2.1.1.3.1.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.3">subscript</csymbol><ci id="S5.SS4.p1.14.m14.2.2.1.1.3.2.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.3.2">𝑀</ci><ci id="S5.SS4.p1.14.m14.2.2.1.1.3.3.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.3.3">𝑖</ci></apply><list id="S5.SS4.p1.14.m14.2.2.1.1.1.2.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1"><apply id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.1.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1">subscript</csymbol><ci id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.2.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.2">𝑀</ci><ci id="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.3.cmml" xref="S5.SS4.p1.14.m14.2.2.1.1.1.1.1.3">𝑗</ci></apply><ci id="S5.SS4.p1.14.m14.1.1a.cmml" xref="S5.SS4.p1.14.m14.1.1"><mtext id="S5.SS4.p1.14.m14.1.1.cmml" xref="S5.SS4.p1.14.m14.1.1">or</mtext></ci></list></apply><apply id="S5.SS4.p1.14.m14.3.3.2.2.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2"><apply id="S5.SS4.p1.14.m14.3.3.2.2.1.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.1"><ci id="S5.SS4.p1.14.m14.3.3.2.2.1.1a.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.1.1"><mtext id="S5.SS4.p1.14.m14.3.3.2.2.1.1.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.1.1">Judge</mtext></ci><ci id="S5.SS4.p1.14.m14.3.3.2.2.1.2.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.1.2">→</ci></apply><apply id="S5.SS4.p1.14.m14.3.3.2.2.2.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.14.m14.3.3.2.2.2.1.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.2">subscript</csymbol><ci id="S5.SS4.p1.14.m14.3.3.2.2.2.2.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.2.2">𝑀</ci><ci id="S5.SS4.p1.14.m14.3.3.2.2.2.3.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.2.3">𝑖</ci></apply><apply id="S5.SS4.p1.14.m14.3.3.2.2.3.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.3"><csymbol cd="ambiguous" id="S5.SS4.p1.14.m14.3.3.2.2.3.1.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.3">subscript</csymbol><ci id="S5.SS4.p1.14.m14.3.3.2.2.3.2.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.3.2">𝑀</ci><ci id="S5.SS4.p1.14.m14.3.3.2.2.3.3.cmml" xref="S5.SS4.p1.14.m14.3.3.2.2.3.3">𝑘</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.14.m14.3c">M_{i}\xrightarrow{\text{Judge}}M_{j}\quad\text{or}\quad M_{i}\xrightarrow{%
\text{Judge}}M_{k}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.14.m14.3d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_ARROW overJudge → end_ARROW italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT or italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_ARROW overJudge → end_ARROW italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> where <math alttext="M_{k}" class="ltx_Math" display="inline" id="S5.SS4.p1.15.m15.1"><semantics id="S5.SS4.p1.15.m15.1a"><msub id="S5.SS4.p1.15.m15.1.1" xref="S5.SS4.p1.15.m15.1.1.cmml"><mi id="S5.SS4.p1.15.m15.1.1.2" xref="S5.SS4.p1.15.m15.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.15.m15.1.1.3" xref="S5.SS4.p1.15.m15.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.15.m15.1b"><apply id="S5.SS4.p1.15.m15.1.1.cmml" xref="S5.SS4.p1.15.m15.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.15.m15.1.1.1.cmml" xref="S5.SS4.p1.15.m15.1.1">subscript</csymbol><ci id="S5.SS4.p1.15.m15.1.1.2.cmml" xref="S5.SS4.p1.15.m15.1.1.2">𝑀</ci><ci id="S5.SS4.p1.15.m15.1.1.3.cmml" xref="S5.SS4.p1.15.m15.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.15.m15.1c">M_{k}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.15.m15.1d">italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> is the predecessor module of <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS4.p1.16.m16.1"><semantics id="S5.SS4.p1.16.m16.1a"><msub id="S5.SS4.p1.16.m16.1.1" xref="S5.SS4.p1.16.m16.1.1.cmml"><mi id="S5.SS4.p1.16.m16.1.1.2" xref="S5.SS4.p1.16.m16.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.16.m16.1.1.3" xref="S5.SS4.p1.16.m16.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.16.m16.1b"><apply id="S5.SS4.p1.16.m16.1.1.cmml" xref="S5.SS4.p1.16.m16.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.16.m16.1.1.1.cmml" xref="S5.SS4.p1.16.m16.1.1">subscript</csymbol><ci id="S5.SS4.p1.16.m16.1.1.2.cmml" xref="S5.SS4.p1.16.m16.1.1.2">𝑀</ci><ci id="S5.SS4.p1.16.m16.1.1.3.cmml" xref="S5.SS4.p1.16.m16.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.16.m16.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.16.m16.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>. If <math alttext="M_{i}" class="ltx_Math" display="inline" id="S5.SS4.p1.17.m17.1"><semantics id="S5.SS4.p1.17.m17.1a"><msub id="S5.SS4.p1.17.m17.1.1" xref="S5.SS4.p1.17.m17.1.1.cmml"><mi id="S5.SS4.p1.17.m17.1.1.2" xref="S5.SS4.p1.17.m17.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.17.m17.1.1.3" xref="S5.SS4.p1.17.m17.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.17.m17.1b"><apply id="S5.SS4.p1.17.m17.1.1.cmml" xref="S5.SS4.p1.17.m17.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.17.m17.1.1.1.cmml" xref="S5.SS4.p1.17.m17.1.1">subscript</csymbol><ci id="S5.SS4.p1.17.m17.1.1.2.cmml" xref="S5.SS4.p1.17.m17.1.1.2">𝑀</ci><ci id="S5.SS4.p1.17.m17.1.1.3.cmml" xref="S5.SS4.p1.17.m17.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.17.m17.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.17.m17.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> return to <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS4.p1.18.m18.1"><semantics id="S5.SS4.p1.18.m18.1a"><msub id="S5.SS4.p1.18.m18.1.1" xref="S5.SS4.p1.18.m18.1.1.cmml"><mi id="S5.SS4.p1.18.m18.1.1.2" xref="S5.SS4.p1.18.m18.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.18.m18.1.1.3" xref="S5.SS4.p1.18.m18.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.18.m18.1b"><apply id="S5.SS4.p1.18.m18.1.1.cmml" xref="S5.SS4.p1.18.m18.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.18.m18.1.1.1.cmml" xref="S5.SS4.p1.18.m18.1.1">subscript</csymbol><ci id="S5.SS4.p1.18.m18.1.1.2.cmml" xref="S5.SS4.p1.18.m18.1.1.2">𝑀</ci><ci id="S5.SS4.p1.18.m18.1.1.3.cmml" xref="S5.SS4.p1.18.m18.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.18.m18.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.18.m18.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>, it can be represented as:
<math alttext="\exists\text{Judge}(M_{i},M_{j})\quad\text{s.t.}\quad(M_{i},M_{j})\in E\quad" class="ltx_Math" display="inline" id="S5.SS4.p1.19.m19.2"><semantics id="S5.SS4.p1.19.m19.2a"><mrow id="S5.SS4.p1.19.m19.2.2.1" xref="S5.SS4.p1.19.m19.2.2.1.1.cmml"><mrow id="S5.SS4.p1.19.m19.2.2.1.1" xref="S5.SS4.p1.19.m19.2.2.1.1.cmml"><mrow id="S5.SS4.p1.19.m19.2.2.1.1.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.2.3.cmml"><mrow id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.cmml"><mo id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.3" rspace="0.167em" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.3.cmml">∃</mo><mrow id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.cmml"><mtext id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4a.cmml">Judge</mtext><mo id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.3" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.3.cmml">⁢</mo><mrow id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.3.cmml"><mo id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.3" stretchy="false" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.3.cmml">(</mo><msub id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.2" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.3" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.4" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.3.cmml">,</mo><msub id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.cmml"><mi id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.3" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.3.cmml">j</mi></msub><mo id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.5" stretchy="false" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mspace id="S5.SS4.p1.19.m19.2.2.1.1.2.2.3" width="1em" xref="S5.SS4.p1.19.m19.2.2.1.1.2.3.cmml"></mspace><mtext id="S5.SS4.p1.19.m19.1.1" xref="S5.SS4.p1.19.m19.1.1a.cmml">s.t.</mtext><mspace id="S5.SS4.p1.19.m19.2.2.1.1.2.2.4" width="1em" xref="S5.SS4.p1.19.m19.2.2.1.1.2.3.cmml"></mspace><mrow id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.3.cmml"><mo id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.3" stretchy="false" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.3.cmml">(</mo><msub id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.cmml"><mi id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.2" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.3" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.3.cmml">i</mi></msub><mo id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.4" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.3.cmml">,</mo><msub id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.cmml"><mi id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.2" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.3" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.3.cmml">j</mi></msub><mo id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.5" stretchy="false" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="S5.SS4.p1.19.m19.2.2.1.1.3" xref="S5.SS4.p1.19.m19.2.2.1.1.3.cmml">∈</mo><mi id="S5.SS4.p1.19.m19.2.2.1.1.4" xref="S5.SS4.p1.19.m19.2.2.1.1.4.cmml">E</mi></mrow><mspace id="S5.SS4.p1.19.m19.2.2.1.2" width="1em" xref="S5.SS4.p1.19.m19.2.2.1.1.cmml"></mspace></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.19.m19.2b"><apply id="S5.SS4.p1.19.m19.2.2.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1"><in id="S5.SS4.p1.19.m19.2.2.1.1.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.3"></in><list id="S5.SS4.p1.19.m19.2.2.1.1.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2"><apply id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1"><exists id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.3"></exists><apply id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2"><times id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.3"></times><ci id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4a.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4"><mtext id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.4">Judge</mtext></ci><interval closure="open" id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2"><apply id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.2">𝑀</ci><ci id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2">subscript</csymbol><ci id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.2">𝑀</ci><ci id="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.1.1.1.2.2.2.2.3">𝑗</ci></apply></interval></apply></apply><ci id="S5.SS4.p1.19.m19.1.1a.cmml" xref="S5.SS4.p1.19.m19.1.1"><mtext id="S5.SS4.p1.19.m19.1.1.cmml" xref="S5.SS4.p1.19.m19.1.1">s.t.</mtext></ci><interval closure="open" id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2"><apply id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1">subscript</csymbol><ci id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.2">𝑀</ci><ci id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.1.1.3">𝑖</ci></apply><apply id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.1.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2">subscript</csymbol><ci id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.2.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.2">𝑀</ci><ci id="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.3.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.2.2.2.2.2.3">𝑗</ci></apply></interval></list><ci id="S5.SS4.p1.19.m19.2.2.1.1.4.cmml" xref="S5.SS4.p1.19.m19.2.2.1.1.4">𝐸</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.19.m19.2c">\exists\text{Judge}(M_{i},M_{j})\quad\text{s.t.}\quad(M_{i},M_{j})\in E\quad</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.19.m19.2d">∃ Judge ( italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) s.t. ( italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) ∈ italic_E</annotation></semantics></math> and <math alttext="\text{Judge}(M_{i},M_{j})=\text{true}" class="ltx_Math" display="inline" id="S5.SS4.p1.20.m20.2"><semantics id="S5.SS4.p1.20.m20.2a"><mrow id="S5.SS4.p1.20.m20.2.2" xref="S5.SS4.p1.20.m20.2.2.cmml"><mrow id="S5.SS4.p1.20.m20.2.2.2" xref="S5.SS4.p1.20.m20.2.2.2.cmml"><mtext id="S5.SS4.p1.20.m20.2.2.2.4" xref="S5.SS4.p1.20.m20.2.2.2.4a.cmml">Judge</mtext><mo id="S5.SS4.p1.20.m20.2.2.2.3" xref="S5.SS4.p1.20.m20.2.2.2.3.cmml">⁢</mo><mrow id="S5.SS4.p1.20.m20.2.2.2.2.2" xref="S5.SS4.p1.20.m20.2.2.2.2.3.cmml"><mo id="S5.SS4.p1.20.m20.2.2.2.2.2.3" stretchy="false" xref="S5.SS4.p1.20.m20.2.2.2.2.3.cmml">(</mo><msub id="S5.SS4.p1.20.m20.1.1.1.1.1.1" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1.cmml"><mi id="S5.SS4.p1.20.m20.1.1.1.1.1.1.2" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.20.m20.1.1.1.1.1.1.3" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S5.SS4.p1.20.m20.2.2.2.2.2.4" xref="S5.SS4.p1.20.m20.2.2.2.2.3.cmml">,</mo><msub id="S5.SS4.p1.20.m20.2.2.2.2.2.2" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2.cmml"><mi id="S5.SS4.p1.20.m20.2.2.2.2.2.2.2" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.20.m20.2.2.2.2.2.2.3" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2.3.cmml">j</mi></msub><mo id="S5.SS4.p1.20.m20.2.2.2.2.2.5" stretchy="false" xref="S5.SS4.p1.20.m20.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="S5.SS4.p1.20.m20.2.2.3" xref="S5.SS4.p1.20.m20.2.2.3.cmml">=</mo><mtext id="S5.SS4.p1.20.m20.2.2.4" xref="S5.SS4.p1.20.m20.2.2.4a.cmml">true</mtext></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.20.m20.2b"><apply id="S5.SS4.p1.20.m20.2.2.cmml" xref="S5.SS4.p1.20.m20.2.2"><eq id="S5.SS4.p1.20.m20.2.2.3.cmml" xref="S5.SS4.p1.20.m20.2.2.3"></eq><apply id="S5.SS4.p1.20.m20.2.2.2.cmml" xref="S5.SS4.p1.20.m20.2.2.2"><times id="S5.SS4.p1.20.m20.2.2.2.3.cmml" xref="S5.SS4.p1.20.m20.2.2.2.3"></times><ci id="S5.SS4.p1.20.m20.2.2.2.4a.cmml" xref="S5.SS4.p1.20.m20.2.2.2.4"><mtext id="S5.SS4.p1.20.m20.2.2.2.4.cmml" xref="S5.SS4.p1.20.m20.2.2.2.4">Judge</mtext></ci><interval closure="open" id="S5.SS4.p1.20.m20.2.2.2.2.3.cmml" xref="S5.SS4.p1.20.m20.2.2.2.2.2"><apply id="S5.SS4.p1.20.m20.1.1.1.1.1.1.cmml" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.20.m20.1.1.1.1.1.1.1.cmml" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1">subscript</csymbol><ci id="S5.SS4.p1.20.m20.1.1.1.1.1.1.2.cmml" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1.2">𝑀</ci><ci id="S5.SS4.p1.20.m20.1.1.1.1.1.1.3.cmml" xref="S5.SS4.p1.20.m20.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S5.SS4.p1.20.m20.2.2.2.2.2.2.cmml" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.20.m20.2.2.2.2.2.2.1.cmml" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2">subscript</csymbol><ci id="S5.SS4.p1.20.m20.2.2.2.2.2.2.2.cmml" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2.2">𝑀</ci><ci id="S5.SS4.p1.20.m20.2.2.2.2.2.2.3.cmml" xref="S5.SS4.p1.20.m20.2.2.2.2.2.2.3">𝑗</ci></apply></interval></apply><ci id="S5.SS4.p1.20.m20.2.2.4a.cmml" xref="S5.SS4.p1.20.m20.2.2.4"><mtext id="S5.SS4.p1.20.m20.2.2.4.cmml" xref="S5.SS4.p1.20.m20.2.2.4">true</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.20.m20.2c">\text{Judge}(M_{i},M_{j})=\text{true}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.20.m20.2d">Judge ( italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) = true</annotation></semantics></math>. If the Judge module not to return to any previous module, it can be represented as:
<math alttext="\forall M_{i}\in V,\quad\text{Judge}(M_{i},M_{j})=\text{false}" class="ltx_Math" display="inline" id="S5.SS4.p1.21.m21.2"><semantics id="S5.SS4.p1.21.m21.2a"><mrow id="S5.SS4.p1.21.m21.2.2.2" xref="S5.SS4.p1.21.m21.2.2.3.cmml"><mrow id="S5.SS4.p1.21.m21.1.1.1.1" xref="S5.SS4.p1.21.m21.1.1.1.1.cmml"><mrow id="S5.SS4.p1.21.m21.1.1.1.1.2" xref="S5.SS4.p1.21.m21.1.1.1.1.2.cmml"><mo id="S5.SS4.p1.21.m21.1.1.1.1.2.1" rspace="0.167em" xref="S5.SS4.p1.21.m21.1.1.1.1.2.1.cmml">∀</mo><msub id="S5.SS4.p1.21.m21.1.1.1.1.2.2" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2.cmml"><mi id="S5.SS4.p1.21.m21.1.1.1.1.2.2.2" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.21.m21.1.1.1.1.2.2.3" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2.3.cmml">i</mi></msub></mrow><mo id="S5.SS4.p1.21.m21.1.1.1.1.1" xref="S5.SS4.p1.21.m21.1.1.1.1.1.cmml">∈</mo><mi id="S5.SS4.p1.21.m21.1.1.1.1.3" xref="S5.SS4.p1.21.m21.1.1.1.1.3.cmml">V</mi></mrow><mo id="S5.SS4.p1.21.m21.2.2.2.3" rspace="1.167em" xref="S5.SS4.p1.21.m21.2.2.3a.cmml">,</mo><mrow id="S5.SS4.p1.21.m21.2.2.2.2" xref="S5.SS4.p1.21.m21.2.2.2.2.cmml"><mrow id="S5.SS4.p1.21.m21.2.2.2.2.2" xref="S5.SS4.p1.21.m21.2.2.2.2.2.cmml"><mtext id="S5.SS4.p1.21.m21.2.2.2.2.2.4" xref="S5.SS4.p1.21.m21.2.2.2.2.2.4a.cmml">Judge</mtext><mo id="S5.SS4.p1.21.m21.2.2.2.2.2.3" xref="S5.SS4.p1.21.m21.2.2.2.2.2.3.cmml">⁢</mo><mrow id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.3.cmml"><mo id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.3" stretchy="false" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.3.cmml">(</mo><msub id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.cmml"><mi id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.2" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.3" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.3.cmml">i</mi></msub><mo id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.4" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.3.cmml">,</mo><msub id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.cmml"><mi id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.2" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.2.cmml">M</mi><mi id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.3" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.3.cmml">j</mi></msub><mo id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.5" stretchy="false" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="S5.SS4.p1.21.m21.2.2.2.2.3" xref="S5.SS4.p1.21.m21.2.2.2.2.3.cmml">=</mo><mtext id="S5.SS4.p1.21.m21.2.2.2.2.4" xref="S5.SS4.p1.21.m21.2.2.2.2.4a.cmml">false</mtext></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.21.m21.2b"><apply id="S5.SS4.p1.21.m21.2.2.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.21.m21.2.2.3a.cmml" xref="S5.SS4.p1.21.m21.2.2.2.3">formulae-sequence</csymbol><apply id="S5.SS4.p1.21.m21.1.1.1.1.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1"><in id="S5.SS4.p1.21.m21.1.1.1.1.1.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.1"></in><apply id="S5.SS4.p1.21.m21.1.1.1.1.2.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2"><csymbol cd="latexml" id="S5.SS4.p1.21.m21.1.1.1.1.2.1.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2.1">for-all</csymbol><apply id="S5.SS4.p1.21.m21.1.1.1.1.2.2.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.21.m21.1.1.1.1.2.2.1.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2">subscript</csymbol><ci id="S5.SS4.p1.21.m21.1.1.1.1.2.2.2.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2.2">𝑀</ci><ci id="S5.SS4.p1.21.m21.1.1.1.1.2.2.3.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.2.2.3">𝑖</ci></apply></apply><ci id="S5.SS4.p1.21.m21.1.1.1.1.3.cmml" xref="S5.SS4.p1.21.m21.1.1.1.1.3">𝑉</ci></apply><apply id="S5.SS4.p1.21.m21.2.2.2.2.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2"><eq id="S5.SS4.p1.21.m21.2.2.2.2.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.3"></eq><apply id="S5.SS4.p1.21.m21.2.2.2.2.2.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2"><times id="S5.SS4.p1.21.m21.2.2.2.2.2.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.3"></times><ci id="S5.SS4.p1.21.m21.2.2.2.2.2.4a.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.4"><mtext id="S5.SS4.p1.21.m21.2.2.2.2.2.4.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.4">Judge</mtext></ci><interval closure="open" id="S5.SS4.p1.21.m21.2.2.2.2.2.2.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2"><apply id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.1.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1">subscript</csymbol><ci id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.2.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.2">𝑀</ci><ci id="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.1.1.1.1.3">𝑖</ci></apply><apply id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.1.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2">subscript</csymbol><ci id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.2.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.2">𝑀</ci><ci id="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.3.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.2.2.2.2.3">𝑗</ci></apply></interval></apply><ci id="S5.SS4.p1.21.m21.2.2.2.2.4a.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.4"><mtext id="S5.SS4.p1.21.m21.2.2.2.2.4.cmml" xref="S5.SS4.p1.21.m21.2.2.2.2.4">false</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.21.m21.2c">\forall M_{i}\in V,\quad\text{Judge}(M_{i},M_{j})=\text{false}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.21.m21.2d">∀ italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_V , Judge ( italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) = false</annotation></semantics></math> for all <math alttext="M_{j}" class="ltx_Math" display="inline" id="S5.SS4.p1.22.m22.1"><semantics id="S5.SS4.p1.22.m22.1a"><msub id="S5.SS4.p1.22.m22.1.1" xref="S5.SS4.p1.22.m22.1.1.cmml"><mi id="S5.SS4.p1.22.m22.1.1.2" xref="S5.SS4.p1.22.m22.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.22.m22.1.1.3" xref="S5.SS4.p1.22.m22.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.22.m22.1b"><apply id="S5.SS4.p1.22.m22.1.1.cmml" xref="S5.SS4.p1.22.m22.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.22.m22.1.1.1.cmml" xref="S5.SS4.p1.22.m22.1.1">subscript</csymbol><ci id="S5.SS4.p1.22.m22.1.1.2.cmml" xref="S5.SS4.p1.22.m22.1.1.2">𝑀</ci><ci id="S5.SS4.p1.22.m22.1.1.3.cmml" xref="S5.SS4.p1.22.m22.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.22.m22.1c">M_{j}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.22.m22.1d">italic_M start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> that are predecessors of <math alttext="M_{i}" class="ltx_Math" display="inline" id="S5.SS4.p1.23.m23.1"><semantics id="S5.SS4.p1.23.m23.1a"><msub id="S5.SS4.p1.23.m23.1.1" xref="S5.SS4.p1.23.m23.1.1.cmml"><mi id="S5.SS4.p1.23.m23.1.1.2" xref="S5.SS4.p1.23.m23.1.1.2.cmml">M</mi><mi id="S5.SS4.p1.23.m23.1.1.3" xref="S5.SS4.p1.23.m23.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.23.m23.1b"><apply id="S5.SS4.p1.23.m23.1.1.cmml" xref="S5.SS4.p1.23.m23.1.1"><csymbol cd="ambiguous" id="S5.SS4.p1.23.m23.1.1.1.cmml" xref="S5.SS4.p1.23.m23.1.1">subscript</csymbol><ci id="S5.SS4.p1.23.m23.1.1.2.cmml" xref="S5.SS4.p1.23.m23.1.1.2">𝑀</ci><ci id="S5.SS4.p1.23.m23.1.1.3.cmml" xref="S5.SS4.p1.23.m23.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.23.m23.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.23.m23.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. Loop pattern can be further categorized into iterative, recursive, and adaptive (active) retrieval approaches.</p>
</div>
<figure class="ltx_figure" id="S5.F10"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="522" id="S5.F10.g1" src="extracted/5756188/images/Loop.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 10: </span>Loop flow pattern. Typically, a RAG system performs multiple rounds of retrieval and generation. It can be categorized into three forms: iterative, recursive, and adaptive.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS4.p2">
<p class="ltx_p" id="S5.SS4.p2.13"><span class="ltx_text ltx_font_bold" id="S5.SS4.p2.13.1">Iterative retrieval</span>
At times, a single retrieval and generation may not effectively address complex questions requiring extensive knowledge. Therefore, an iterative approach can be used in RAG (see Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg5" title="Algorithm 5 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">5</span></a>), typically involving a fixed number of iterations for retrieval. At step <math alttext="t" class="ltx_Math" display="inline" id="S5.SS4.p2.1.m1.1"><semantics id="S5.SS4.p2.1.m1.1a"><mi id="S5.SS4.p2.1.m1.1.1" xref="S5.SS4.p2.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.1.m1.1b"><ci id="S5.SS4.p2.1.m1.1.1.cmml" xref="S5.SS4.p2.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.1.m1.1c">t</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.1.m1.1d">italic_t</annotation></semantics></math>, given the query <math alttext="q_{t}" class="ltx_Math" display="inline" id="S5.SS4.p2.2.m2.1"><semantics id="S5.SS4.p2.2.m2.1a"><msub id="S5.SS4.p2.2.m2.1.1" xref="S5.SS4.p2.2.m2.1.1.cmml"><mi id="S5.SS4.p2.2.m2.1.1.2" xref="S5.SS4.p2.2.m2.1.1.2.cmml">q</mi><mi id="S5.SS4.p2.2.m2.1.1.3" xref="S5.SS4.p2.2.m2.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.2.m2.1b"><apply id="S5.SS4.p2.2.m2.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.2.m2.1.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS4.p2.2.m2.1.1.2.cmml" xref="S5.SS4.p2.2.m2.1.1.2">𝑞</ci><ci id="S5.SS4.p2.2.m2.1.1.3.cmml" xref="S5.SS4.p2.2.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.2.m2.1c">q_{t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.2.m2.1d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> and the previous output sequence <math alttext="y_{&lt;t}=[y_{0},\ldots,y_{t-1}]" class="ltx_Math" display="inline" id="S5.SS4.p2.3.m3.3"><semantics id="S5.SS4.p2.3.m3.3a"><mrow id="S5.SS4.p2.3.m3.3.3" xref="S5.SS4.p2.3.m3.3.3.cmml"><msub id="S5.SS4.p2.3.m3.3.3.4" xref="S5.SS4.p2.3.m3.3.3.4.cmml"><mi id="S5.SS4.p2.3.m3.3.3.4.2" xref="S5.SS4.p2.3.m3.3.3.4.2.cmml">y</mi><mrow id="S5.SS4.p2.3.m3.3.3.4.3" xref="S5.SS4.p2.3.m3.3.3.4.3.cmml"><mi id="S5.SS4.p2.3.m3.3.3.4.3.2" xref="S5.SS4.p2.3.m3.3.3.4.3.2.cmml"></mi><mo id="S5.SS4.p2.3.m3.3.3.4.3.1" xref="S5.SS4.p2.3.m3.3.3.4.3.1.cmml">&lt;</mo><mi id="S5.SS4.p2.3.m3.3.3.4.3.3" xref="S5.SS4.p2.3.m3.3.3.4.3.3.cmml">t</mi></mrow></msub><mo id="S5.SS4.p2.3.m3.3.3.3" xref="S5.SS4.p2.3.m3.3.3.3.cmml">=</mo><mrow id="S5.SS4.p2.3.m3.3.3.2.2" xref="S5.SS4.p2.3.m3.3.3.2.3.cmml"><mo id="S5.SS4.p2.3.m3.3.3.2.2.3" stretchy="false" xref="S5.SS4.p2.3.m3.3.3.2.3.cmml">[</mo><msub id="S5.SS4.p2.3.m3.2.2.1.1.1" xref="S5.SS4.p2.3.m3.2.2.1.1.1.cmml"><mi id="S5.SS4.p2.3.m3.2.2.1.1.1.2" xref="S5.SS4.p2.3.m3.2.2.1.1.1.2.cmml">y</mi><mn id="S5.SS4.p2.3.m3.2.2.1.1.1.3" xref="S5.SS4.p2.3.m3.2.2.1.1.1.3.cmml">0</mn></msub><mo id="S5.SS4.p2.3.m3.3.3.2.2.4" xref="S5.SS4.p2.3.m3.3.3.2.3.cmml">,</mo><mi id="S5.SS4.p2.3.m3.1.1" mathvariant="normal" xref="S5.SS4.p2.3.m3.1.1.cmml">…</mi><mo id="S5.SS4.p2.3.m3.3.3.2.2.5" xref="S5.SS4.p2.3.m3.3.3.2.3.cmml">,</mo><msub id="S5.SS4.p2.3.m3.3.3.2.2.2" xref="S5.SS4.p2.3.m3.3.3.2.2.2.cmml"><mi id="S5.SS4.p2.3.m3.3.3.2.2.2.2" xref="S5.SS4.p2.3.m3.3.3.2.2.2.2.cmml">y</mi><mrow id="S5.SS4.p2.3.m3.3.3.2.2.2.3" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.cmml"><mi id="S5.SS4.p2.3.m3.3.3.2.2.2.3.2" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.2.cmml">t</mi><mo id="S5.SS4.p2.3.m3.3.3.2.2.2.3.1" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.1.cmml">−</mo><mn id="S5.SS4.p2.3.m3.3.3.2.2.2.3.3" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.3.cmml">1</mn></mrow></msub><mo id="S5.SS4.p2.3.m3.3.3.2.2.6" stretchy="false" xref="S5.SS4.p2.3.m3.3.3.2.3.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.3.m3.3b"><apply id="S5.SS4.p2.3.m3.3.3.cmml" xref="S5.SS4.p2.3.m3.3.3"><eq id="S5.SS4.p2.3.m3.3.3.3.cmml" xref="S5.SS4.p2.3.m3.3.3.3"></eq><apply id="S5.SS4.p2.3.m3.3.3.4.cmml" xref="S5.SS4.p2.3.m3.3.3.4"><csymbol cd="ambiguous" id="S5.SS4.p2.3.m3.3.3.4.1.cmml" xref="S5.SS4.p2.3.m3.3.3.4">subscript</csymbol><ci id="S5.SS4.p2.3.m3.3.3.4.2.cmml" xref="S5.SS4.p2.3.m3.3.3.4.2">𝑦</ci><apply id="S5.SS4.p2.3.m3.3.3.4.3.cmml" xref="S5.SS4.p2.3.m3.3.3.4.3"><lt id="S5.SS4.p2.3.m3.3.3.4.3.1.cmml" xref="S5.SS4.p2.3.m3.3.3.4.3.1"></lt><csymbol cd="latexml" id="S5.SS4.p2.3.m3.3.3.4.3.2.cmml" xref="S5.SS4.p2.3.m3.3.3.4.3.2">absent</csymbol><ci id="S5.SS4.p2.3.m3.3.3.4.3.3.cmml" xref="S5.SS4.p2.3.m3.3.3.4.3.3">𝑡</ci></apply></apply><list id="S5.SS4.p2.3.m3.3.3.2.3.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2"><apply id="S5.SS4.p2.3.m3.2.2.1.1.1.cmml" xref="S5.SS4.p2.3.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.3.m3.2.2.1.1.1.1.cmml" xref="S5.SS4.p2.3.m3.2.2.1.1.1">subscript</csymbol><ci id="S5.SS4.p2.3.m3.2.2.1.1.1.2.cmml" xref="S5.SS4.p2.3.m3.2.2.1.1.1.2">𝑦</ci><cn id="S5.SS4.p2.3.m3.2.2.1.1.1.3.cmml" type="integer" xref="S5.SS4.p2.3.m3.2.2.1.1.1.3">0</cn></apply><ci id="S5.SS4.p2.3.m3.1.1.cmml" xref="S5.SS4.p2.3.m3.1.1">…</ci><apply id="S5.SS4.p2.3.m3.3.3.2.2.2.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2"><csymbol cd="ambiguous" id="S5.SS4.p2.3.m3.3.3.2.2.2.1.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2">subscript</csymbol><ci id="S5.SS4.p2.3.m3.3.3.2.2.2.2.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2.2">𝑦</ci><apply id="S5.SS4.p2.3.m3.3.3.2.2.2.3.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3"><minus id="S5.SS4.p2.3.m3.3.3.2.2.2.3.1.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.1"></minus><ci id="S5.SS4.p2.3.m3.3.3.2.2.2.3.2.cmml" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.2">𝑡</ci><cn id="S5.SS4.p2.3.m3.3.3.2.2.2.3.3.cmml" type="integer" xref="S5.SS4.p2.3.m3.3.3.2.2.2.3.3">1</cn></apply></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.3.m3.3c">y_{&lt;t}=[y_{0},\ldots,y_{t-1}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.3.m3.3d">italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT = [ italic_y start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT ]</annotation></semantics></math> , iterations proceed under the condition that <math alttext="t" class="ltx_Math" display="inline" id="S5.SS4.p2.4.m4.1"><semantics id="S5.SS4.p2.4.m4.1a"><mi id="S5.SS4.p2.4.m4.1.1" xref="S5.SS4.p2.4.m4.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.4.m4.1b"><ci id="S5.SS4.p2.4.m4.1.1.cmml" xref="S5.SS4.p2.4.m4.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.4.m4.1c">t</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.4.m4.1d">italic_t</annotation></semantics></math> is less than the maximum allowed iterations <math alttext="T" class="ltx_Math" display="inline" id="S5.SS4.p2.5.m5.1"><semantics id="S5.SS4.p2.5.m5.1a"><mi id="S5.SS4.p2.5.m5.1.1" xref="S5.SS4.p2.5.m5.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.5.m5.1b"><ci id="S5.SS4.p2.5.m5.1.1.cmml" xref="S5.SS4.p2.5.m5.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.5.m5.1c">T</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.5.m5.1d">italic_T</annotation></semantics></math>. In each loop, it retrieves a document chunks <math alttext="D_{t-1}" class="ltx_Math" display="inline" id="S5.SS4.p2.6.m6.1"><semantics id="S5.SS4.p2.6.m6.1a"><msub id="S5.SS4.p2.6.m6.1.1" xref="S5.SS4.p2.6.m6.1.1.cmml"><mi id="S5.SS4.p2.6.m6.1.1.2" xref="S5.SS4.p2.6.m6.1.1.2.cmml">D</mi><mrow id="S5.SS4.p2.6.m6.1.1.3" xref="S5.SS4.p2.6.m6.1.1.3.cmml"><mi id="S5.SS4.p2.6.m6.1.1.3.2" xref="S5.SS4.p2.6.m6.1.1.3.2.cmml">t</mi><mo id="S5.SS4.p2.6.m6.1.1.3.1" xref="S5.SS4.p2.6.m6.1.1.3.1.cmml">−</mo><mn id="S5.SS4.p2.6.m6.1.1.3.3" xref="S5.SS4.p2.6.m6.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.6.m6.1b"><apply id="S5.SS4.p2.6.m6.1.1.cmml" xref="S5.SS4.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.6.m6.1.1.1.cmml" xref="S5.SS4.p2.6.m6.1.1">subscript</csymbol><ci id="S5.SS4.p2.6.m6.1.1.2.cmml" xref="S5.SS4.p2.6.m6.1.1.2">𝐷</ci><apply id="S5.SS4.p2.6.m6.1.1.3.cmml" xref="S5.SS4.p2.6.m6.1.1.3"><minus id="S5.SS4.p2.6.m6.1.1.3.1.cmml" xref="S5.SS4.p2.6.m6.1.1.3.1"></minus><ci id="S5.SS4.p2.6.m6.1.1.3.2.cmml" xref="S5.SS4.p2.6.m6.1.1.3.2">𝑡</ci><cn id="S5.SS4.p2.6.m6.1.1.3.3.cmml" type="integer" xref="S5.SS4.p2.6.m6.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.6.m6.1c">D_{t-1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.6.m6.1d">italic_D start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT</annotation></semantics></math> using the last output <math alttext="y_{t-1}" class="ltx_Math" display="inline" id="S5.SS4.p2.7.m7.1"><semantics id="S5.SS4.p2.7.m7.1a"><msub id="S5.SS4.p2.7.m7.1.1" xref="S5.SS4.p2.7.m7.1.1.cmml"><mi id="S5.SS4.p2.7.m7.1.1.2" xref="S5.SS4.p2.7.m7.1.1.2.cmml">y</mi><mrow id="S5.SS4.p2.7.m7.1.1.3" xref="S5.SS4.p2.7.m7.1.1.3.cmml"><mi id="S5.SS4.p2.7.m7.1.1.3.2" xref="S5.SS4.p2.7.m7.1.1.3.2.cmml">t</mi><mo id="S5.SS4.p2.7.m7.1.1.3.1" xref="S5.SS4.p2.7.m7.1.1.3.1.cmml">−</mo><mn id="S5.SS4.p2.7.m7.1.1.3.3" xref="S5.SS4.p2.7.m7.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.7.m7.1b"><apply id="S5.SS4.p2.7.m7.1.1.cmml" xref="S5.SS4.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.7.m7.1.1.1.cmml" xref="S5.SS4.p2.7.m7.1.1">subscript</csymbol><ci id="S5.SS4.p2.7.m7.1.1.2.cmml" xref="S5.SS4.p2.7.m7.1.1.2">𝑦</ci><apply id="S5.SS4.p2.7.m7.1.1.3.cmml" xref="S5.SS4.p2.7.m7.1.1.3"><minus id="S5.SS4.p2.7.m7.1.1.3.1.cmml" xref="S5.SS4.p2.7.m7.1.1.3.1"></minus><ci id="S5.SS4.p2.7.m7.1.1.3.2.cmml" xref="S5.SS4.p2.7.m7.1.1.3.2">𝑡</ci><cn id="S5.SS4.p2.7.m7.1.1.3.3.cmml" type="integer" xref="S5.SS4.p2.7.m7.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.7.m7.1c">y_{t-1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.7.m7.1d">italic_y start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT</annotation></semantics></math> and the current query <math alttext="q_{t}" class="ltx_Math" display="inline" id="S5.SS4.p2.8.m8.1"><semantics id="S5.SS4.p2.8.m8.1a"><msub id="S5.SS4.p2.8.m8.1.1" xref="S5.SS4.p2.8.m8.1.1.cmml"><mi id="S5.SS4.p2.8.m8.1.1.2" xref="S5.SS4.p2.8.m8.1.1.2.cmml">q</mi><mi id="S5.SS4.p2.8.m8.1.1.3" xref="S5.SS4.p2.8.m8.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.8.m8.1b"><apply id="S5.SS4.p2.8.m8.1.1.cmml" xref="S5.SS4.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.8.m8.1.1.1.cmml" xref="S5.SS4.p2.8.m8.1.1">subscript</csymbol><ci id="S5.SS4.p2.8.m8.1.1.2.cmml" xref="S5.SS4.p2.8.m8.1.1.2">𝑞</ci><ci id="S5.SS4.p2.8.m8.1.1.3.cmml" xref="S5.SS4.p2.8.m8.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.8.m8.1c">q_{t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.8.m8.1d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>. Subsequently, a new output <math alttext="y_{t}" class="ltx_Math" display="inline" id="S5.SS4.p2.9.m9.1"><semantics id="S5.SS4.p2.9.m9.1a"><msub id="S5.SS4.p2.9.m9.1.1" xref="S5.SS4.p2.9.m9.1.1.cmml"><mi id="S5.SS4.p2.9.m9.1.1.2" xref="S5.SS4.p2.9.m9.1.1.2.cmml">y</mi><mi id="S5.SS4.p2.9.m9.1.1.3" xref="S5.SS4.p2.9.m9.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.9.m9.1b"><apply id="S5.SS4.p2.9.m9.1.1.cmml" xref="S5.SS4.p2.9.m9.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.9.m9.1.1.1.cmml" xref="S5.SS4.p2.9.m9.1.1">subscript</csymbol><ci id="S5.SS4.p2.9.m9.1.1.2.cmml" xref="S5.SS4.p2.9.m9.1.1.2">𝑦</ci><ci id="S5.SS4.p2.9.m9.1.1.3.cmml" xref="S5.SS4.p2.9.m9.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.9.m9.1c">y_{t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.9.m9.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is generated. The continuation of the iteration is determined by a Judge module, which makes its decision based on the <math alttext="y_{t}" class="ltx_Math" display="inline" id="S5.SS4.p2.10.m10.1"><semantics id="S5.SS4.p2.10.m10.1a"><msub id="S5.SS4.p2.10.m10.1.1" xref="S5.SS4.p2.10.m10.1.1.cmml"><mi id="S5.SS4.p2.10.m10.1.1.2" xref="S5.SS4.p2.10.m10.1.1.2.cmml">y</mi><mi id="S5.SS4.p2.10.m10.1.1.3" xref="S5.SS4.p2.10.m10.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.10.m10.1b"><apply id="S5.SS4.p2.10.m10.1.1.cmml" xref="S5.SS4.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.10.m10.1.1.1.cmml" xref="S5.SS4.p2.10.m10.1.1">subscript</csymbol><ci id="S5.SS4.p2.10.m10.1.1.2.cmml" xref="S5.SS4.p2.10.m10.1.1.2">𝑦</ci><ci id="S5.SS4.p2.10.m10.1.1.3.cmml" xref="S5.SS4.p2.10.m10.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.10.m10.1c">y_{t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.10.m10.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="y_{&lt;t}" class="ltx_Math" display="inline" id="S5.SS4.p2.11.m11.1"><semantics id="S5.SS4.p2.11.m11.1a"><msub id="S5.SS4.p2.11.m11.1.1" xref="S5.SS4.p2.11.m11.1.1.cmml"><mi id="S5.SS4.p2.11.m11.1.1.2" xref="S5.SS4.p2.11.m11.1.1.2.cmml">y</mi><mrow id="S5.SS4.p2.11.m11.1.1.3" xref="S5.SS4.p2.11.m11.1.1.3.cmml"><mi id="S5.SS4.p2.11.m11.1.1.3.2" xref="S5.SS4.p2.11.m11.1.1.3.2.cmml"></mi><mo id="S5.SS4.p2.11.m11.1.1.3.1" xref="S5.SS4.p2.11.m11.1.1.3.1.cmml">&lt;</mo><mi id="S5.SS4.p2.11.m11.1.1.3.3" xref="S5.SS4.p2.11.m11.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.11.m11.1b"><apply id="S5.SS4.p2.11.m11.1.1.cmml" xref="S5.SS4.p2.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.11.m11.1.1.1.cmml" xref="S5.SS4.p2.11.m11.1.1">subscript</csymbol><ci id="S5.SS4.p2.11.m11.1.1.2.cmml" xref="S5.SS4.p2.11.m11.1.1.2">𝑦</ci><apply id="S5.SS4.p2.11.m11.1.1.3.cmml" xref="S5.SS4.p2.11.m11.1.1.3"><lt id="S5.SS4.p2.11.m11.1.1.3.1.cmml" xref="S5.SS4.p2.11.m11.1.1.3.1"></lt><csymbol cd="latexml" id="S5.SS4.p2.11.m11.1.1.3.2.cmml" xref="S5.SS4.p2.11.m11.1.1.3.2">absent</csymbol><ci id="S5.SS4.p2.11.m11.1.1.3.3.cmml" xref="S5.SS4.p2.11.m11.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.11.m11.1c">y_{&lt;t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.11.m11.1d">italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="q_{t}" class="ltx_Math" display="inline" id="S5.SS4.p2.12.m12.1"><semantics id="S5.SS4.p2.12.m12.1a"><msub id="S5.SS4.p2.12.m12.1.1" xref="S5.SS4.p2.12.m12.1.1.cmml"><mi id="S5.SS4.p2.12.m12.1.1.2" xref="S5.SS4.p2.12.m12.1.1.2.cmml">q</mi><mi id="S5.SS4.p2.12.m12.1.1.3" xref="S5.SS4.p2.12.m12.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.12.m12.1b"><apply id="S5.SS4.p2.12.m12.1.1.cmml" xref="S5.SS4.p2.12.m12.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.12.m12.1.1.1.cmml" xref="S5.SS4.p2.12.m12.1.1">subscript</csymbol><ci id="S5.SS4.p2.12.m12.1.1.2.cmml" xref="S5.SS4.p2.12.m12.1.1.2">𝑞</ci><ci id="S5.SS4.p2.12.m12.1.1.3.cmml" xref="S5.SS4.p2.12.m12.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.12.m12.1c">q_{t}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.12.m12.1d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, and the <math alttext="D_{t-1}" class="ltx_Math" display="inline" id="S5.SS4.p2.13.m13.1"><semantics id="S5.SS4.p2.13.m13.1a"><msub id="S5.SS4.p2.13.m13.1.1" xref="S5.SS4.p2.13.m13.1.1.cmml"><mi id="S5.SS4.p2.13.m13.1.1.2" xref="S5.SS4.p2.13.m13.1.1.2.cmml">D</mi><mrow id="S5.SS4.p2.13.m13.1.1.3" xref="S5.SS4.p2.13.m13.1.1.3.cmml"><mi id="S5.SS4.p2.13.m13.1.1.3.2" xref="S5.SS4.p2.13.m13.1.1.3.2.cmml">t</mi><mo id="S5.SS4.p2.13.m13.1.1.3.1" xref="S5.SS4.p2.13.m13.1.1.3.1.cmml">−</mo><mn id="S5.SS4.p2.13.m13.1.1.3.3" xref="S5.SS4.p2.13.m13.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.13.m13.1b"><apply id="S5.SS4.p2.13.m13.1.1.cmml" xref="S5.SS4.p2.13.m13.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.13.m13.1.1.1.cmml" xref="S5.SS4.p2.13.m13.1.1">subscript</csymbol><ci id="S5.SS4.p2.13.m13.1.1.2.cmml" xref="S5.SS4.p2.13.m13.1.1.2">𝐷</ci><apply id="S5.SS4.p2.13.m13.1.1.3.cmml" xref="S5.SS4.p2.13.m13.1.1.3"><minus id="S5.SS4.p2.13.m13.1.1.3.1.cmml" xref="S5.SS4.p2.13.m13.1.1.3.1"></minus><ci id="S5.SS4.p2.13.m13.1.1.3.2.cmml" xref="S5.SS4.p2.13.m13.1.1.3.2">𝑡</ci><cn id="S5.SS4.p2.13.m13.1.1.3.3.cmml" type="integer" xref="S5.SS4.p2.13.m13.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.13.m13.1c">D_{t-1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.13.m13.1d">italic_D start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg5.2.1.1">Algorithm 5</span> </span> Iterative RAG Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg5.3">
<div class="ltx_listingline" id="alg5.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="q" class="ltx_Math" display="inline" id="alg5.l0.m1.1"><semantics id="alg5.l0.m1.1a"><mi id="alg5.l0.m1.1.1" xref="alg5.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg5.l0.m1.1b"><ci id="alg5.l0.m1.1.1.cmml" xref="alg5.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m1.1d">italic_q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg5.l0.m2.1"><semantics id="alg5.l0.m2.1a"><mi id="alg5.l0.m2.1.1" xref="alg5.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg5.l0.m2.1b"><ci id="alg5.l0.m2.1.1.cmml" xref="alg5.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m2.1d">italic_D</annotation></semantics></math>, maximum iterative times <math alttext="T" class="ltx_Math" display="inline" id="alg5.l0.m3.1"><semantics id="alg5.l0.m3.1a"><mi id="alg5.l0.m3.1.1" xref="alg5.l0.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="alg5.l0.m3.1b"><ci id="alg5.l0.m3.1.1.cmml" xref="alg5.l0.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m3.1d">italic_T</annotation></semantics></math>, language model <math alttext="LLM" class="ltx_Math" display="inline" id="alg5.l0.m4.1"><semantics id="alg5.l0.m4.1a"><mrow id="alg5.l0.m4.1.1" xref="alg5.l0.m4.1.1.cmml"><mi id="alg5.l0.m4.1.1.2" xref="alg5.l0.m4.1.1.2.cmml">L</mi><mo id="alg5.l0.m4.1.1.1" xref="alg5.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg5.l0.m4.1.1.3" xref="alg5.l0.m4.1.1.3.cmml">L</mi><mo id="alg5.l0.m4.1.1.1a" xref="alg5.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg5.l0.m4.1.1.4" xref="alg5.l0.m4.1.1.4.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg5.l0.m4.1b"><apply id="alg5.l0.m4.1.1.cmml" xref="alg5.l0.m4.1.1"><times id="alg5.l0.m4.1.1.1.cmml" xref="alg5.l0.m4.1.1.1"></times><ci id="alg5.l0.m4.1.1.2.cmml" xref="alg5.l0.m4.1.1.2">𝐿</ci><ci id="alg5.l0.m4.1.1.3.cmml" xref="alg5.l0.m4.1.1.3">𝐿</ci><ci id="alg5.l0.m4.1.1.4.cmml" xref="alg5.l0.m4.1.1.4">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m4.1c">LLM</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m4.1d">italic_L italic_L italic_M</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg5.l0.m5.1"><semantics id="alg5.l0.m5.1a"><mi id="alg5.l0.m5.1.1" xref="alg5.l0.m5.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg5.l0.m5.1b"><ci id="alg5.l0.m5.1.1.cmml" xref="alg5.l0.m5.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m5.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m5.1d">italic_R</annotation></semantics></math>, initial output <math alttext="y_{&lt;1}=\emptyset" class="ltx_Math" display="inline" id="alg5.l0.m6.1"><semantics id="alg5.l0.m6.1a"><mrow id="alg5.l0.m6.1.1" xref="alg5.l0.m6.1.1.cmml"><msub id="alg5.l0.m6.1.1.2" xref="alg5.l0.m6.1.1.2.cmml"><mi id="alg5.l0.m6.1.1.2.2" xref="alg5.l0.m6.1.1.2.2.cmml">y</mi><mrow id="alg5.l0.m6.1.1.2.3" xref="alg5.l0.m6.1.1.2.3.cmml"><mi id="alg5.l0.m6.1.1.2.3.2" xref="alg5.l0.m6.1.1.2.3.2.cmml"></mi><mo id="alg5.l0.m6.1.1.2.3.1" xref="alg5.l0.m6.1.1.2.3.1.cmml">&lt;</mo><mn id="alg5.l0.m6.1.1.2.3.3" xref="alg5.l0.m6.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="alg5.l0.m6.1.1.1" xref="alg5.l0.m6.1.1.1.cmml">=</mo><mi id="alg5.l0.m6.1.1.3" mathvariant="normal" xref="alg5.l0.m6.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg5.l0.m6.1b"><apply id="alg5.l0.m6.1.1.cmml" xref="alg5.l0.m6.1.1"><eq id="alg5.l0.m6.1.1.1.cmml" xref="alg5.l0.m6.1.1.1"></eq><apply id="alg5.l0.m6.1.1.2.cmml" xref="alg5.l0.m6.1.1.2"><csymbol cd="ambiguous" id="alg5.l0.m6.1.1.2.1.cmml" xref="alg5.l0.m6.1.1.2">subscript</csymbol><ci id="alg5.l0.m6.1.1.2.2.cmml" xref="alg5.l0.m6.1.1.2.2">𝑦</ci><apply id="alg5.l0.m6.1.1.2.3.cmml" xref="alg5.l0.m6.1.1.2.3"><lt id="alg5.l0.m6.1.1.2.3.1.cmml" xref="alg5.l0.m6.1.1.2.3.1"></lt><csymbol cd="latexml" id="alg5.l0.m6.1.1.2.3.2.cmml" xref="alg5.l0.m6.1.1.2.3.2">absent</csymbol><cn id="alg5.l0.m6.1.1.2.3.3.cmml" type="integer" xref="alg5.l0.m6.1.1.2.3.3">1</cn></apply></apply><emptyset id="alg5.l0.m6.1.1.3.cmml" xref="alg5.l0.m6.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0.m6.1c">y_{&lt;1}=\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg5.l0.m6.1d">italic_y start_POSTSUBSCRIPT &lt; 1 end_POSTSUBSCRIPT = ∅</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg5.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg5.l0a.m1.1"><semantics id="alg5.l0a.m1.1a"><mover accent="true" id="alg5.l0a.m1.1.1" xref="alg5.l0a.m1.1.1.cmml"><mi id="alg5.l0a.m1.1.1.2" xref="alg5.l0a.m1.1.1.2.cmml">y</mi><mo id="alg5.l0a.m1.1.1.1" xref="alg5.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg5.l0a.m1.1b"><apply id="alg5.l0a.m1.1.1.cmml" xref="alg5.l0a.m1.1.1"><ci id="alg5.l0a.m1.1.1.1.cmml" xref="alg5.l0a.m1.1.1.1">^</ci><ci id="alg5.l0a.m1.1.1.2.cmml" xref="alg5.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg5.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg5.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg5.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="q_{t}\leftarrow q" class="ltx_Math" display="inline" id="alg5.l2.m1.1"><semantics id="alg5.l2.m1.1a"><mrow id="alg5.l2.m1.1.1" xref="alg5.l2.m1.1.1.cmml"><msub id="alg5.l2.m1.1.1.2" xref="alg5.l2.m1.1.1.2.cmml"><mi id="alg5.l2.m1.1.1.2.2" xref="alg5.l2.m1.1.1.2.2.cmml">q</mi><mi id="alg5.l2.m1.1.1.2.3" xref="alg5.l2.m1.1.1.2.3.cmml">t</mi></msub><mo id="alg5.l2.m1.1.1.1" stretchy="false" xref="alg5.l2.m1.1.1.1.cmml">←</mo><mi id="alg5.l2.m1.1.1.3" xref="alg5.l2.m1.1.1.3.cmml">q</mi></mrow><annotation-xml encoding="MathML-Content" id="alg5.l2.m1.1b"><apply id="alg5.l2.m1.1.1.cmml" xref="alg5.l2.m1.1.1"><ci id="alg5.l2.m1.1.1.1.cmml" xref="alg5.l2.m1.1.1.1">←</ci><apply id="alg5.l2.m1.1.1.2.cmml" xref="alg5.l2.m1.1.1.2"><csymbol cd="ambiguous" id="alg5.l2.m1.1.1.2.1.cmml" xref="alg5.l2.m1.1.1.2">subscript</csymbol><ci id="alg5.l2.m1.1.1.2.2.cmml" xref="alg5.l2.m1.1.1.2.2">𝑞</ci><ci id="alg5.l2.m1.1.1.2.3.cmml" xref="alg5.l2.m1.1.1.2.3">𝑡</ci></apply><ci id="alg5.l2.m1.1.1.3.cmml" xref="alg5.l2.m1.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l2.m1.1c">q_{t}\leftarrow q</annotation><annotation encoding="application/x-llamapun" id="alg5.l2.m1.1d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_q</annotation></semantics></math> // Initialize query for the first iteration

</div>
<div class="ltx_listingline" id="alg5.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="y_{&lt;1}\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg5.l3.m1.1"><semantics id="alg5.l3.m1.1a"><mrow id="alg5.l3.m1.1.1" xref="alg5.l3.m1.1.1.cmml"><msub id="alg5.l3.m1.1.1.2" xref="alg5.l3.m1.1.1.2.cmml"><mi id="alg5.l3.m1.1.1.2.2" xref="alg5.l3.m1.1.1.2.2.cmml">y</mi><mrow id="alg5.l3.m1.1.1.2.3" xref="alg5.l3.m1.1.1.2.3.cmml"><mi id="alg5.l3.m1.1.1.2.3.2" xref="alg5.l3.m1.1.1.2.3.2.cmml"></mi><mo id="alg5.l3.m1.1.1.2.3.1" xref="alg5.l3.m1.1.1.2.3.1.cmml">&lt;</mo><mn id="alg5.l3.m1.1.1.2.3.3" xref="alg5.l3.m1.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="alg5.l3.m1.1.1.1" stretchy="false" xref="alg5.l3.m1.1.1.1.cmml">←</mo><mi id="alg5.l3.m1.1.1.3" mathvariant="normal" xref="alg5.l3.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg5.l3.m1.1b"><apply id="alg5.l3.m1.1.1.cmml" xref="alg5.l3.m1.1.1"><ci id="alg5.l3.m1.1.1.1.cmml" xref="alg5.l3.m1.1.1.1">←</ci><apply id="alg5.l3.m1.1.1.2.cmml" xref="alg5.l3.m1.1.1.2"><csymbol cd="ambiguous" id="alg5.l3.m1.1.1.2.1.cmml" xref="alg5.l3.m1.1.1.2">subscript</csymbol><ci id="alg5.l3.m1.1.1.2.2.cmml" xref="alg5.l3.m1.1.1.2.2">𝑦</ci><apply id="alg5.l3.m1.1.1.2.3.cmml" xref="alg5.l3.m1.1.1.2.3"><lt id="alg5.l3.m1.1.1.2.3.1.cmml" xref="alg5.l3.m1.1.1.2.3.1"></lt><csymbol cd="latexml" id="alg5.l3.m1.1.1.2.3.2.cmml" xref="alg5.l3.m1.1.1.2.3.2">absent</csymbol><cn id="alg5.l3.m1.1.1.2.3.3.cmml" type="integer" xref="alg5.l3.m1.1.1.2.3.3">1</cn></apply></apply><emptyset id="alg5.l3.m1.1.1.3.cmml" xref="alg5.l3.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l3.m1.1c">y_{&lt;1}\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg5.l3.m1.1d">italic_y start_POSTSUBSCRIPT &lt; 1 end_POSTSUBSCRIPT ← ∅</annotation></semantics></math> // Initialize previous outputs as empty

</div>
<div class="ltx_listingline" id="alg5.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l4.1.1.1" style="font-size:80%;">4:</span></span>  <math alttext="t\leftarrow 1" class="ltx_Math" display="inline" id="alg5.l4.m1.1"><semantics id="alg5.l4.m1.1a"><mrow id="alg5.l4.m1.1.1" xref="alg5.l4.m1.1.1.cmml"><mi id="alg5.l4.m1.1.1.2" xref="alg5.l4.m1.1.1.2.cmml">t</mi><mo id="alg5.l4.m1.1.1.1" stretchy="false" xref="alg5.l4.m1.1.1.1.cmml">←</mo><mn id="alg5.l4.m1.1.1.3" xref="alg5.l4.m1.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg5.l4.m1.1b"><apply id="alg5.l4.m1.1.1.cmml" xref="alg5.l4.m1.1.1"><ci id="alg5.l4.m1.1.1.1.cmml" xref="alg5.l4.m1.1.1.1">←</ci><ci id="alg5.l4.m1.1.1.2.cmml" xref="alg5.l4.m1.1.1.2">𝑡</ci><cn id="alg5.l4.m1.1.1.3.cmml" type="integer" xref="alg5.l4.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l4.m1.1c">t\leftarrow 1</annotation><annotation encoding="application/x-llamapun" id="alg5.l4.m1.1d">italic_t ← 1</annotation></semantics></math> // Initialize iteration step

</div>
<div class="ltx_listingline" id="alg5.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l5.1.1.1" style="font-size:80%;">5:</span></span>  <span class="ltx_text ltx_font_bold" id="alg5.l5.2">while</span> <math alttext="t\leq T" class="ltx_Math" display="inline" id="alg5.l5.m1.1"><semantics id="alg5.l5.m1.1a"><mrow id="alg5.l5.m1.1.1" xref="alg5.l5.m1.1.1.cmml"><mi id="alg5.l5.m1.1.1.2" xref="alg5.l5.m1.1.1.2.cmml">t</mi><mo id="alg5.l5.m1.1.1.1" xref="alg5.l5.m1.1.1.1.cmml">≤</mo><mi id="alg5.l5.m1.1.1.3" xref="alg5.l5.m1.1.1.3.cmml">T</mi></mrow><annotation-xml encoding="MathML-Content" id="alg5.l5.m1.1b"><apply id="alg5.l5.m1.1.1.cmml" xref="alg5.l5.m1.1.1"><leq id="alg5.l5.m1.1.1.1.cmml" xref="alg5.l5.m1.1.1.1"></leq><ci id="alg5.l5.m1.1.1.2.cmml" xref="alg5.l5.m1.1.1.2">𝑡</ci><ci id="alg5.l5.m1.1.1.3.cmml" xref="alg5.l5.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l5.m1.1c">t\leq T</annotation><annotation encoding="application/x-llamapun" id="alg5.l5.m1.1d">italic_t ≤ italic_T</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg5.l5.3">do</span>
</div>
<div class="ltx_listingline" id="alg5.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l6.1.1.1" style="font-size:80%;">6:</span></span>     <math alttext="q_{t}\leftarrow\text{QueryTransform}(y_{&lt;t-1},q_{t-1})" class="ltx_Math" display="inline" id="alg5.l6.m1.2"><semantics id="alg5.l6.m1.2a"><mrow id="alg5.l6.m1.2.2" xref="alg5.l6.m1.2.2.cmml"><msub id="alg5.l6.m1.2.2.4" xref="alg5.l6.m1.2.2.4.cmml"><mi id="alg5.l6.m1.2.2.4.2" xref="alg5.l6.m1.2.2.4.2.cmml">q</mi><mi id="alg5.l6.m1.2.2.4.3" xref="alg5.l6.m1.2.2.4.3.cmml">t</mi></msub><mo id="alg5.l6.m1.2.2.3" stretchy="false" xref="alg5.l6.m1.2.2.3.cmml">←</mo><mrow id="alg5.l6.m1.2.2.2" xref="alg5.l6.m1.2.2.2.cmml"><mtext id="alg5.l6.m1.2.2.2.4" xref="alg5.l6.m1.2.2.2.4a.cmml">QueryTransform</mtext><mo id="alg5.l6.m1.2.2.2.3" xref="alg5.l6.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg5.l6.m1.2.2.2.2.2" xref="alg5.l6.m1.2.2.2.2.3.cmml"><mo id="alg5.l6.m1.2.2.2.2.2.3" stretchy="false" xref="alg5.l6.m1.2.2.2.2.3.cmml">(</mo><msub id="alg5.l6.m1.1.1.1.1.1.1" xref="alg5.l6.m1.1.1.1.1.1.1.cmml"><mi id="alg5.l6.m1.1.1.1.1.1.1.2" xref="alg5.l6.m1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg5.l6.m1.1.1.1.1.1.1.3" xref="alg5.l6.m1.1.1.1.1.1.1.3.cmml"><mi id="alg5.l6.m1.1.1.1.1.1.1.3.2" xref="alg5.l6.m1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg5.l6.m1.1.1.1.1.1.1.3.1" xref="alg5.l6.m1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mrow id="alg5.l6.m1.1.1.1.1.1.1.3.3" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.cmml"><mi id="alg5.l6.m1.1.1.1.1.1.1.3.3.2" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="alg5.l6.m1.1.1.1.1.1.1.3.3.1" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg5.l6.m1.1.1.1.1.1.1.3.3.3" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg5.l6.m1.2.2.2.2.2.4" xref="alg5.l6.m1.2.2.2.2.3.cmml">,</mo><msub id="alg5.l6.m1.2.2.2.2.2.2" xref="alg5.l6.m1.2.2.2.2.2.2.cmml"><mi id="alg5.l6.m1.2.2.2.2.2.2.2" xref="alg5.l6.m1.2.2.2.2.2.2.2.cmml">q</mi><mrow id="alg5.l6.m1.2.2.2.2.2.2.3" xref="alg5.l6.m1.2.2.2.2.2.2.3.cmml"><mi id="alg5.l6.m1.2.2.2.2.2.2.3.2" xref="alg5.l6.m1.2.2.2.2.2.2.3.2.cmml">t</mi><mo id="alg5.l6.m1.2.2.2.2.2.2.3.1" xref="alg5.l6.m1.2.2.2.2.2.2.3.1.cmml">−</mo><mn id="alg5.l6.m1.2.2.2.2.2.2.3.3" xref="alg5.l6.m1.2.2.2.2.2.2.3.3.cmml">1</mn></mrow></msub><mo id="alg5.l6.m1.2.2.2.2.2.5" stretchy="false" xref="alg5.l6.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg5.l6.m1.2b"><apply id="alg5.l6.m1.2.2.cmml" xref="alg5.l6.m1.2.2"><ci id="alg5.l6.m1.2.2.3.cmml" xref="alg5.l6.m1.2.2.3">←</ci><apply id="alg5.l6.m1.2.2.4.cmml" xref="alg5.l6.m1.2.2.4"><csymbol cd="ambiguous" id="alg5.l6.m1.2.2.4.1.cmml" xref="alg5.l6.m1.2.2.4">subscript</csymbol><ci id="alg5.l6.m1.2.2.4.2.cmml" xref="alg5.l6.m1.2.2.4.2">𝑞</ci><ci id="alg5.l6.m1.2.2.4.3.cmml" xref="alg5.l6.m1.2.2.4.3">𝑡</ci></apply><apply id="alg5.l6.m1.2.2.2.cmml" xref="alg5.l6.m1.2.2.2"><times id="alg5.l6.m1.2.2.2.3.cmml" xref="alg5.l6.m1.2.2.2.3"></times><ci id="alg5.l6.m1.2.2.2.4a.cmml" xref="alg5.l6.m1.2.2.2.4"><mtext id="alg5.l6.m1.2.2.2.4.cmml" xref="alg5.l6.m1.2.2.2.4">QueryTransform</mtext></ci><interval closure="open" id="alg5.l6.m1.2.2.2.2.3.cmml" xref="alg5.l6.m1.2.2.2.2.2"><apply id="alg5.l6.m1.1.1.1.1.1.1.cmml" xref="alg5.l6.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg5.l6.m1.1.1.1.1.1.1.1.cmml" xref="alg5.l6.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg5.l6.m1.1.1.1.1.1.1.2.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg5.l6.m1.1.1.1.1.1.1.3.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3"><lt id="alg5.l6.m1.1.1.1.1.1.1.3.1.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="alg5.l6.m1.1.1.1.1.1.1.3.2.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3.2">absent</csymbol><apply id="alg5.l6.m1.1.1.1.1.1.1.3.3.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3.3"><minus id="alg5.l6.m1.1.1.1.1.1.1.3.3.1.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.1"></minus><ci id="alg5.l6.m1.1.1.1.1.1.1.3.3.2.cmml" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.2">𝑡</ci><cn id="alg5.l6.m1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg5.l6.m1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="alg5.l6.m1.2.2.2.2.2.2.cmml" xref="alg5.l6.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg5.l6.m1.2.2.2.2.2.2.1.cmml" xref="alg5.l6.m1.2.2.2.2.2.2">subscript</csymbol><ci id="alg5.l6.m1.2.2.2.2.2.2.2.cmml" xref="alg5.l6.m1.2.2.2.2.2.2.2">𝑞</ci><apply id="alg5.l6.m1.2.2.2.2.2.2.3.cmml" xref="alg5.l6.m1.2.2.2.2.2.2.3"><minus id="alg5.l6.m1.2.2.2.2.2.2.3.1.cmml" xref="alg5.l6.m1.2.2.2.2.2.2.3.1"></minus><ci id="alg5.l6.m1.2.2.2.2.2.2.3.2.cmml" xref="alg5.l6.m1.2.2.2.2.2.2.3.2">𝑡</ci><cn id="alg5.l6.m1.2.2.2.2.2.2.3.3.cmml" type="integer" xref="alg5.l6.m1.2.2.2.2.2.2.3.3">1</cn></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l6.m1.2c">q_{t}\leftarrow\text{QueryTransform}(y_{&lt;t-1},q_{t-1})</annotation><annotation encoding="application/x-llamapun" id="alg5.l6.m1.2d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← QueryTransform ( italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> // Generate query based on previous output and original query

</div>
<div class="ltx_listingline" id="alg5.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l7.1.1.1" style="font-size:80%;">7:</span></span>     <math alttext="D_{t}\leftarrow R(y_{t-1}||q_{t},D)" class="ltx_math_unparsed" display="inline" id="alg5.l7.m1.1"><semantics id="alg5.l7.m1.1a"><mrow id="alg5.l7.m1.1b"><msub id="alg5.l7.m1.1.2"><mi id="alg5.l7.m1.1.2.2">D</mi><mi id="alg5.l7.m1.1.2.3">t</mi></msub><mo id="alg5.l7.m1.1.3" stretchy="false">←</mo><mi id="alg5.l7.m1.1.4">R</mi><mrow id="alg5.l7.m1.1.5"><mo id="alg5.l7.m1.1.5.1" stretchy="false">(</mo><msub id="alg5.l7.m1.1.5.2"><mi id="alg5.l7.m1.1.5.2.2">y</mi><mrow id="alg5.l7.m1.1.5.2.3"><mi id="alg5.l7.m1.1.5.2.3.2">t</mi><mo id="alg5.l7.m1.1.5.2.3.1">−</mo><mn id="alg5.l7.m1.1.5.2.3.3">1</mn></mrow></msub><mo fence="false" id="alg5.l7.m1.1.5.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="alg5.l7.m1.1.5.4" rspace="0.167em" stretchy="false">|</mo><msub id="alg5.l7.m1.1.5.5"><mi id="alg5.l7.m1.1.5.5.2">q</mi><mi id="alg5.l7.m1.1.5.5.3">t</mi></msub><mo id="alg5.l7.m1.1.5.6">,</mo><mi id="alg5.l7.m1.1.1">D</mi><mo id="alg5.l7.m1.1.5.7" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg5.l7.m1.1c">D_{t}\leftarrow R(y_{t-1}||q_{t},D)</annotation><annotation encoding="application/x-llamapun" id="alg5.l7.m1.1d">italic_D start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_R ( italic_y start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT | | italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_D )</annotation></semantics></math> // Retrieve or update documents related to the current query

</div>
<div class="ltx_listingline" id="alg5.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l8.1.1.1" style="font-size:80%;">8:</span></span>     <math alttext="y_{t}\leftarrow LLM([y_{&lt;t-1},q_{t},D_{t}])" class="ltx_Math" display="inline" id="alg5.l8.m1.1"><semantics id="alg5.l8.m1.1a"><mrow id="alg5.l8.m1.1.1" xref="alg5.l8.m1.1.1.cmml"><msub id="alg5.l8.m1.1.1.3" xref="alg5.l8.m1.1.1.3.cmml"><mi id="alg5.l8.m1.1.1.3.2" xref="alg5.l8.m1.1.1.3.2.cmml">y</mi><mi id="alg5.l8.m1.1.1.3.3" xref="alg5.l8.m1.1.1.3.3.cmml">t</mi></msub><mo id="alg5.l8.m1.1.1.2" stretchy="false" xref="alg5.l8.m1.1.1.2.cmml">←</mo><mrow id="alg5.l8.m1.1.1.1" xref="alg5.l8.m1.1.1.1.cmml"><mi id="alg5.l8.m1.1.1.1.3" xref="alg5.l8.m1.1.1.1.3.cmml">L</mi><mo id="alg5.l8.m1.1.1.1.2" xref="alg5.l8.m1.1.1.1.2.cmml">⁢</mo><mi id="alg5.l8.m1.1.1.1.4" xref="alg5.l8.m1.1.1.1.4.cmml">L</mi><mo id="alg5.l8.m1.1.1.1.2a" xref="alg5.l8.m1.1.1.1.2.cmml">⁢</mo><mi id="alg5.l8.m1.1.1.1.5" xref="alg5.l8.m1.1.1.1.5.cmml">M</mi><mo id="alg5.l8.m1.1.1.1.2b" xref="alg5.l8.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg5.l8.m1.1.1.1.1.1" xref="alg5.l8.m1.1.1.1.cmml"><mo id="alg5.l8.m1.1.1.1.1.1.2" stretchy="false" xref="alg5.l8.m1.1.1.1.cmml">(</mo><mrow id="alg5.l8.m1.1.1.1.1.1.1.3" xref="alg5.l8.m1.1.1.1.1.1.1.4.cmml"><mo id="alg5.l8.m1.1.1.1.1.1.1.3.4" stretchy="false" xref="alg5.l8.m1.1.1.1.1.1.1.4.cmml">[</mo><msub id="alg5.l8.m1.1.1.1.1.1.1.1.1" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.cmml"><mi id="alg5.l8.m1.1.1.1.1.1.1.1.1.2" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg5.l8.m1.1.1.1.1.1.1.1.1.3" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.cmml"><mi id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.2" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.1" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mrow id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.2" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.1" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.3" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg5.l8.m1.1.1.1.1.1.1.3.5" xref="alg5.l8.m1.1.1.1.1.1.1.4.cmml">,</mo><msub id="alg5.l8.m1.1.1.1.1.1.1.2.2" xref="alg5.l8.m1.1.1.1.1.1.1.2.2.cmml"><mi id="alg5.l8.m1.1.1.1.1.1.1.2.2.2" xref="alg5.l8.m1.1.1.1.1.1.1.2.2.2.cmml">q</mi><mi id="alg5.l8.m1.1.1.1.1.1.1.2.2.3" xref="alg5.l8.m1.1.1.1.1.1.1.2.2.3.cmml">t</mi></msub><mo id="alg5.l8.m1.1.1.1.1.1.1.3.6" xref="alg5.l8.m1.1.1.1.1.1.1.4.cmml">,</mo><msub id="alg5.l8.m1.1.1.1.1.1.1.3.3" xref="alg5.l8.m1.1.1.1.1.1.1.3.3.cmml"><mi id="alg5.l8.m1.1.1.1.1.1.1.3.3.2" xref="alg5.l8.m1.1.1.1.1.1.1.3.3.2.cmml">D</mi><mi id="alg5.l8.m1.1.1.1.1.1.1.3.3.3" xref="alg5.l8.m1.1.1.1.1.1.1.3.3.3.cmml">t</mi></msub><mo id="alg5.l8.m1.1.1.1.1.1.1.3.7" stretchy="false" xref="alg5.l8.m1.1.1.1.1.1.1.4.cmml">]</mo></mrow><mo id="alg5.l8.m1.1.1.1.1.1.3" stretchy="false" xref="alg5.l8.m1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg5.l8.m1.1b"><apply id="alg5.l8.m1.1.1.cmml" xref="alg5.l8.m1.1.1"><ci id="alg5.l8.m1.1.1.2.cmml" xref="alg5.l8.m1.1.1.2">←</ci><apply id="alg5.l8.m1.1.1.3.cmml" xref="alg5.l8.m1.1.1.3"><csymbol cd="ambiguous" id="alg5.l8.m1.1.1.3.1.cmml" xref="alg5.l8.m1.1.1.3">subscript</csymbol><ci id="alg5.l8.m1.1.1.3.2.cmml" xref="alg5.l8.m1.1.1.3.2">𝑦</ci><ci id="alg5.l8.m1.1.1.3.3.cmml" xref="alg5.l8.m1.1.1.3.3">𝑡</ci></apply><apply id="alg5.l8.m1.1.1.1.cmml" xref="alg5.l8.m1.1.1.1"><times id="alg5.l8.m1.1.1.1.2.cmml" xref="alg5.l8.m1.1.1.1.2"></times><ci id="alg5.l8.m1.1.1.1.3.cmml" xref="alg5.l8.m1.1.1.1.3">𝐿</ci><ci id="alg5.l8.m1.1.1.1.4.cmml" xref="alg5.l8.m1.1.1.1.4">𝐿</ci><ci id="alg5.l8.m1.1.1.1.5.cmml" xref="alg5.l8.m1.1.1.1.5">𝑀</ci><list id="alg5.l8.m1.1.1.1.1.1.1.4.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.3"><apply id="alg5.l8.m1.1.1.1.1.1.1.1.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg5.l8.m1.1.1.1.1.1.1.1.1.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg5.l8.m1.1.1.1.1.1.1.1.1.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3"><lt id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.2">absent</csymbol><apply id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3"><minus id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.1"></minus><ci id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.2">𝑡</ci><cn id="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg5.l8.m1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="alg5.l8.m1.1.1.1.1.1.1.2.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="alg5.l8.m1.1.1.1.1.1.1.2.2.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="alg5.l8.m1.1.1.1.1.1.1.2.2.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.2.2.2">𝑞</ci><ci id="alg5.l8.m1.1.1.1.1.1.1.2.2.3.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.2.2.3">𝑡</ci></apply><apply id="alg5.l8.m1.1.1.1.1.1.1.3.3.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="alg5.l8.m1.1.1.1.1.1.1.3.3.1.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.3.3">subscript</csymbol><ci id="alg5.l8.m1.1.1.1.1.1.1.3.3.2.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.3.3.2">𝐷</ci><ci id="alg5.l8.m1.1.1.1.1.1.1.3.3.3.cmml" xref="alg5.l8.m1.1.1.1.1.1.1.3.3.3">𝑡</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l8.m1.1c">y_{t}\leftarrow LLM([y_{&lt;t-1},q_{t},D_{t}])</annotation><annotation encoding="application/x-llamapun" id="alg5.l8.m1.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_L italic_L italic_M ( [ italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ] )</annotation></semantics></math> // Generate output using the language model

</div>
<div class="ltx_listingline" id="alg5.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l9.1.1.1" style="font-size:80%;">9:</span></span>     <math alttext="y_{&lt;t}\leftarrow[y_{&lt;t-1},y_{t}]" class="ltx_Math" display="inline" id="alg5.l9.m1.2"><semantics id="alg5.l9.m1.2a"><mrow id="alg5.l9.m1.2.2" xref="alg5.l9.m1.2.2.cmml"><msub id="alg5.l9.m1.2.2.4" xref="alg5.l9.m1.2.2.4.cmml"><mi id="alg5.l9.m1.2.2.4.2" xref="alg5.l9.m1.2.2.4.2.cmml">y</mi><mrow id="alg5.l9.m1.2.2.4.3" xref="alg5.l9.m1.2.2.4.3.cmml"><mi id="alg5.l9.m1.2.2.4.3.2" xref="alg5.l9.m1.2.2.4.3.2.cmml"></mi><mo id="alg5.l9.m1.2.2.4.3.1" xref="alg5.l9.m1.2.2.4.3.1.cmml">&lt;</mo><mi id="alg5.l9.m1.2.2.4.3.3" xref="alg5.l9.m1.2.2.4.3.3.cmml">t</mi></mrow></msub><mo id="alg5.l9.m1.2.2.3" stretchy="false" xref="alg5.l9.m1.2.2.3.cmml">←</mo><mrow id="alg5.l9.m1.2.2.2.2" xref="alg5.l9.m1.2.2.2.3.cmml"><mo id="alg5.l9.m1.2.2.2.2.3" stretchy="false" xref="alg5.l9.m1.2.2.2.3.cmml">[</mo><msub id="alg5.l9.m1.1.1.1.1.1" xref="alg5.l9.m1.1.1.1.1.1.cmml"><mi id="alg5.l9.m1.1.1.1.1.1.2" xref="alg5.l9.m1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg5.l9.m1.1.1.1.1.1.3" xref="alg5.l9.m1.1.1.1.1.1.3.cmml"><mi id="alg5.l9.m1.1.1.1.1.1.3.2" xref="alg5.l9.m1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg5.l9.m1.1.1.1.1.1.3.1" xref="alg5.l9.m1.1.1.1.1.1.3.1.cmml">&lt;</mo><mrow id="alg5.l9.m1.1.1.1.1.1.3.3" xref="alg5.l9.m1.1.1.1.1.1.3.3.cmml"><mi id="alg5.l9.m1.1.1.1.1.1.3.3.2" xref="alg5.l9.m1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="alg5.l9.m1.1.1.1.1.1.3.3.1" xref="alg5.l9.m1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg5.l9.m1.1.1.1.1.1.3.3.3" xref="alg5.l9.m1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg5.l9.m1.2.2.2.2.4" xref="alg5.l9.m1.2.2.2.3.cmml">,</mo><msub id="alg5.l9.m1.2.2.2.2.2" xref="alg5.l9.m1.2.2.2.2.2.cmml"><mi id="alg5.l9.m1.2.2.2.2.2.2" xref="alg5.l9.m1.2.2.2.2.2.2.cmml">y</mi><mi id="alg5.l9.m1.2.2.2.2.2.3" xref="alg5.l9.m1.2.2.2.2.2.3.cmml">t</mi></msub><mo id="alg5.l9.m1.2.2.2.2.5" stretchy="false" xref="alg5.l9.m1.2.2.2.3.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg5.l9.m1.2b"><apply id="alg5.l9.m1.2.2.cmml" xref="alg5.l9.m1.2.2"><ci id="alg5.l9.m1.2.2.3.cmml" xref="alg5.l9.m1.2.2.3">←</ci><apply id="alg5.l9.m1.2.2.4.cmml" xref="alg5.l9.m1.2.2.4"><csymbol cd="ambiguous" id="alg5.l9.m1.2.2.4.1.cmml" xref="alg5.l9.m1.2.2.4">subscript</csymbol><ci id="alg5.l9.m1.2.2.4.2.cmml" xref="alg5.l9.m1.2.2.4.2">𝑦</ci><apply id="alg5.l9.m1.2.2.4.3.cmml" xref="alg5.l9.m1.2.2.4.3"><lt id="alg5.l9.m1.2.2.4.3.1.cmml" xref="alg5.l9.m1.2.2.4.3.1"></lt><csymbol cd="latexml" id="alg5.l9.m1.2.2.4.3.2.cmml" xref="alg5.l9.m1.2.2.4.3.2">absent</csymbol><ci id="alg5.l9.m1.2.2.4.3.3.cmml" xref="alg5.l9.m1.2.2.4.3.3">𝑡</ci></apply></apply><interval closure="closed" id="alg5.l9.m1.2.2.2.3.cmml" xref="alg5.l9.m1.2.2.2.2"><apply id="alg5.l9.m1.1.1.1.1.1.cmml" xref="alg5.l9.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg5.l9.m1.1.1.1.1.1.1.cmml" xref="alg5.l9.m1.1.1.1.1.1">subscript</csymbol><ci id="alg5.l9.m1.1.1.1.1.1.2.cmml" xref="alg5.l9.m1.1.1.1.1.1.2">𝑦</ci><apply id="alg5.l9.m1.1.1.1.1.1.3.cmml" xref="alg5.l9.m1.1.1.1.1.1.3"><lt id="alg5.l9.m1.1.1.1.1.1.3.1.cmml" xref="alg5.l9.m1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="alg5.l9.m1.1.1.1.1.1.3.2.cmml" xref="alg5.l9.m1.1.1.1.1.1.3.2">absent</csymbol><apply id="alg5.l9.m1.1.1.1.1.1.3.3.cmml" xref="alg5.l9.m1.1.1.1.1.1.3.3"><minus id="alg5.l9.m1.1.1.1.1.1.3.3.1.cmml" xref="alg5.l9.m1.1.1.1.1.1.3.3.1"></minus><ci id="alg5.l9.m1.1.1.1.1.1.3.3.2.cmml" xref="alg5.l9.m1.1.1.1.1.1.3.3.2">𝑡</ci><cn id="alg5.l9.m1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg5.l9.m1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="alg5.l9.m1.2.2.2.2.2.cmml" xref="alg5.l9.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg5.l9.m1.2.2.2.2.2.1.cmml" xref="alg5.l9.m1.2.2.2.2.2">subscript</csymbol><ci id="alg5.l9.m1.2.2.2.2.2.2.cmml" xref="alg5.l9.m1.2.2.2.2.2.2">𝑦</ci><ci id="alg5.l9.m1.2.2.2.2.2.3.cmml" xref="alg5.l9.m1.2.2.2.2.2.3">𝑡</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l9.m1.2c">y_{&lt;t}\leftarrow[y_{&lt;t-1},y_{t}]</annotation><annotation encoding="application/x-llamapun" id="alg5.l9.m1.2d">italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ← [ italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ]</annotation></semantics></math> // Update the list of previous outputs

</div>
<div class="ltx_listingline" id="alg5.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l10.1.1.1" style="font-size:80%;">10:</span></span>     <span class="ltx_text ltx_font_bold" id="alg5.l10.2">if</span> <math alttext="\text{Judge}(y_{t},q)=\text{false}" class="ltx_Math" display="inline" id="alg5.l10.m1.2"><semantics id="alg5.l10.m1.2a"><mrow id="alg5.l10.m1.2.2" xref="alg5.l10.m1.2.2.cmml"><mrow id="alg5.l10.m1.2.2.1" xref="alg5.l10.m1.2.2.1.cmml"><mtext id="alg5.l10.m1.2.2.1.3" xref="alg5.l10.m1.2.2.1.3a.cmml">Judge</mtext><mo id="alg5.l10.m1.2.2.1.2" xref="alg5.l10.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg5.l10.m1.2.2.1.1.1" xref="alg5.l10.m1.2.2.1.1.2.cmml"><mo id="alg5.l10.m1.2.2.1.1.1.2" stretchy="false" xref="alg5.l10.m1.2.2.1.1.2.cmml">(</mo><msub id="alg5.l10.m1.2.2.1.1.1.1" xref="alg5.l10.m1.2.2.1.1.1.1.cmml"><mi id="alg5.l10.m1.2.2.1.1.1.1.2" xref="alg5.l10.m1.2.2.1.1.1.1.2.cmml">y</mi><mi id="alg5.l10.m1.2.2.1.1.1.1.3" xref="alg5.l10.m1.2.2.1.1.1.1.3.cmml">t</mi></msub><mo id="alg5.l10.m1.2.2.1.1.1.3" xref="alg5.l10.m1.2.2.1.1.2.cmml">,</mo><mi id="alg5.l10.m1.1.1" xref="alg5.l10.m1.1.1.cmml">q</mi><mo id="alg5.l10.m1.2.2.1.1.1.4" stretchy="false" xref="alg5.l10.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow><mo id="alg5.l10.m1.2.2.2" xref="alg5.l10.m1.2.2.2.cmml">=</mo><mtext id="alg5.l10.m1.2.2.3" xref="alg5.l10.m1.2.2.3a.cmml">false</mtext></mrow><annotation-xml encoding="MathML-Content" id="alg5.l10.m1.2b"><apply id="alg5.l10.m1.2.2.cmml" xref="alg5.l10.m1.2.2"><eq id="alg5.l10.m1.2.2.2.cmml" xref="alg5.l10.m1.2.2.2"></eq><apply id="alg5.l10.m1.2.2.1.cmml" xref="alg5.l10.m1.2.2.1"><times id="alg5.l10.m1.2.2.1.2.cmml" xref="alg5.l10.m1.2.2.1.2"></times><ci id="alg5.l10.m1.2.2.1.3a.cmml" xref="alg5.l10.m1.2.2.1.3"><mtext id="alg5.l10.m1.2.2.1.3.cmml" xref="alg5.l10.m1.2.2.1.3">Judge</mtext></ci><interval closure="open" id="alg5.l10.m1.2.2.1.1.2.cmml" xref="alg5.l10.m1.2.2.1.1.1"><apply id="alg5.l10.m1.2.2.1.1.1.1.cmml" xref="alg5.l10.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg5.l10.m1.2.2.1.1.1.1.1.cmml" xref="alg5.l10.m1.2.2.1.1.1.1">subscript</csymbol><ci id="alg5.l10.m1.2.2.1.1.1.1.2.cmml" xref="alg5.l10.m1.2.2.1.1.1.1.2">𝑦</ci><ci id="alg5.l10.m1.2.2.1.1.1.1.3.cmml" xref="alg5.l10.m1.2.2.1.1.1.1.3">𝑡</ci></apply><ci id="alg5.l10.m1.1.1.cmml" xref="alg5.l10.m1.1.1">𝑞</ci></interval></apply><ci id="alg5.l10.m1.2.2.3a.cmml" xref="alg5.l10.m1.2.2.3"><mtext id="alg5.l10.m1.2.2.3.cmml" xref="alg5.l10.m1.2.2.3">false</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l10.m1.2c">\text{Judge}(y_{t},q)=\text{false}</annotation><annotation encoding="application/x-llamapun" id="alg5.l10.m1.2d">Judge ( italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_q ) = false</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg5.l10.3">then</span>
</div>
<div class="ltx_listingline" id="alg5.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l11.1.1.1" style="font-size:80%;">11:</span></span>        break

</div>
<div class="ltx_listingline" id="alg5.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l12.1.1.1" style="font-size:80%;">12:</span></span>     <span class="ltx_text ltx_font_bold" id="alg5.l12.2">end</span> <span class="ltx_text ltx_font_bold" id="alg5.l12.3">if</span>
</div>
<div class="ltx_listingline" id="alg5.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l13.1.1.1" style="font-size:80%;">13:</span></span>     <math alttext="t\leftarrow t+1" class="ltx_Math" display="inline" id="alg5.l13.m1.1"><semantics id="alg5.l13.m1.1a"><mrow id="alg5.l13.m1.1.1" xref="alg5.l13.m1.1.1.cmml"><mi id="alg5.l13.m1.1.1.2" xref="alg5.l13.m1.1.1.2.cmml">t</mi><mo id="alg5.l13.m1.1.1.1" stretchy="false" xref="alg5.l13.m1.1.1.1.cmml">←</mo><mrow id="alg5.l13.m1.1.1.3" xref="alg5.l13.m1.1.1.3.cmml"><mi id="alg5.l13.m1.1.1.3.2" xref="alg5.l13.m1.1.1.3.2.cmml">t</mi><mo id="alg5.l13.m1.1.1.3.1" xref="alg5.l13.m1.1.1.3.1.cmml">+</mo><mn id="alg5.l13.m1.1.1.3.3" xref="alg5.l13.m1.1.1.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg5.l13.m1.1b"><apply id="alg5.l13.m1.1.1.cmml" xref="alg5.l13.m1.1.1"><ci id="alg5.l13.m1.1.1.1.cmml" xref="alg5.l13.m1.1.1.1">←</ci><ci id="alg5.l13.m1.1.1.2.cmml" xref="alg5.l13.m1.1.1.2">𝑡</ci><apply id="alg5.l13.m1.1.1.3.cmml" xref="alg5.l13.m1.1.1.3"><plus id="alg5.l13.m1.1.1.3.1.cmml" xref="alg5.l13.m1.1.1.3.1"></plus><ci id="alg5.l13.m1.1.1.3.2.cmml" xref="alg5.l13.m1.1.1.3.2">𝑡</ci><cn id="alg5.l13.m1.1.1.3.3.cmml" type="integer" xref="alg5.l13.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l13.m1.1c">t\leftarrow t+1</annotation><annotation encoding="application/x-llamapun" id="alg5.l13.m1.1d">italic_t ← italic_t + 1</annotation></semantics></math> // Increment iteration step

</div>
<div class="ltx_listingline" id="alg5.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l14.1.1.1" style="font-size:80%;">14:</span></span>  <span class="ltx_text ltx_font_bold" id="alg5.l14.2">end</span> <span class="ltx_text ltx_font_bold" id="alg5.l14.3">while</span>
</div>
<div class="ltx_listingline" id="alg5.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l15.1.1.1" style="font-size:80%;">15:</span></span>  <math alttext="y_{final}=\text{synthesizeOutput}(y_{\leq t})" class="ltx_Math" display="inline" id="alg5.l15.m1.1"><semantics id="alg5.l15.m1.1a"><mrow id="alg5.l15.m1.1.1" xref="alg5.l15.m1.1.1.cmml"><msub id="alg5.l15.m1.1.1.3" xref="alg5.l15.m1.1.1.3.cmml"><mi id="alg5.l15.m1.1.1.3.2" xref="alg5.l15.m1.1.1.3.2.cmml">y</mi><mrow id="alg5.l15.m1.1.1.3.3" xref="alg5.l15.m1.1.1.3.3.cmml"><mi id="alg5.l15.m1.1.1.3.3.2" xref="alg5.l15.m1.1.1.3.3.2.cmml">f</mi><mo id="alg5.l15.m1.1.1.3.3.1" xref="alg5.l15.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg5.l15.m1.1.1.3.3.3" xref="alg5.l15.m1.1.1.3.3.3.cmml">i</mi><mo id="alg5.l15.m1.1.1.3.3.1a" xref="alg5.l15.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg5.l15.m1.1.1.3.3.4" xref="alg5.l15.m1.1.1.3.3.4.cmml">n</mi><mo id="alg5.l15.m1.1.1.3.3.1b" xref="alg5.l15.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg5.l15.m1.1.1.3.3.5" xref="alg5.l15.m1.1.1.3.3.5.cmml">a</mi><mo id="alg5.l15.m1.1.1.3.3.1c" xref="alg5.l15.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg5.l15.m1.1.1.3.3.6" xref="alg5.l15.m1.1.1.3.3.6.cmml">l</mi></mrow></msub><mo id="alg5.l15.m1.1.1.2" xref="alg5.l15.m1.1.1.2.cmml">=</mo><mrow id="alg5.l15.m1.1.1.1" xref="alg5.l15.m1.1.1.1.cmml"><mtext id="alg5.l15.m1.1.1.1.3" xref="alg5.l15.m1.1.1.1.3a.cmml">synthesizeOutput</mtext><mo id="alg5.l15.m1.1.1.1.2" xref="alg5.l15.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg5.l15.m1.1.1.1.1.1" xref="alg5.l15.m1.1.1.1.1.1.1.cmml"><mo id="alg5.l15.m1.1.1.1.1.1.2" stretchy="false" xref="alg5.l15.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg5.l15.m1.1.1.1.1.1.1" xref="alg5.l15.m1.1.1.1.1.1.1.cmml"><mi id="alg5.l15.m1.1.1.1.1.1.1.2" xref="alg5.l15.m1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg5.l15.m1.1.1.1.1.1.1.3" xref="alg5.l15.m1.1.1.1.1.1.1.3.cmml"><mi id="alg5.l15.m1.1.1.1.1.1.1.3.2" xref="alg5.l15.m1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg5.l15.m1.1.1.1.1.1.1.3.1" xref="alg5.l15.m1.1.1.1.1.1.1.3.1.cmml">≤</mo><mi id="alg5.l15.m1.1.1.1.1.1.1.3.3" xref="alg5.l15.m1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub><mo id="alg5.l15.m1.1.1.1.1.1.3" stretchy="false" xref="alg5.l15.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg5.l15.m1.1b"><apply id="alg5.l15.m1.1.1.cmml" xref="alg5.l15.m1.1.1"><eq id="alg5.l15.m1.1.1.2.cmml" xref="alg5.l15.m1.1.1.2"></eq><apply id="alg5.l15.m1.1.1.3.cmml" xref="alg5.l15.m1.1.1.3"><csymbol cd="ambiguous" id="alg5.l15.m1.1.1.3.1.cmml" xref="alg5.l15.m1.1.1.3">subscript</csymbol><ci id="alg5.l15.m1.1.1.3.2.cmml" xref="alg5.l15.m1.1.1.3.2">𝑦</ci><apply id="alg5.l15.m1.1.1.3.3.cmml" xref="alg5.l15.m1.1.1.3.3"><times id="alg5.l15.m1.1.1.3.3.1.cmml" xref="alg5.l15.m1.1.1.3.3.1"></times><ci id="alg5.l15.m1.1.1.3.3.2.cmml" xref="alg5.l15.m1.1.1.3.3.2">𝑓</ci><ci id="alg5.l15.m1.1.1.3.3.3.cmml" xref="alg5.l15.m1.1.1.3.3.3">𝑖</ci><ci id="alg5.l15.m1.1.1.3.3.4.cmml" xref="alg5.l15.m1.1.1.3.3.4">𝑛</ci><ci id="alg5.l15.m1.1.1.3.3.5.cmml" xref="alg5.l15.m1.1.1.3.3.5">𝑎</ci><ci id="alg5.l15.m1.1.1.3.3.6.cmml" xref="alg5.l15.m1.1.1.3.3.6">𝑙</ci></apply></apply><apply id="alg5.l15.m1.1.1.1.cmml" xref="alg5.l15.m1.1.1.1"><times id="alg5.l15.m1.1.1.1.2.cmml" xref="alg5.l15.m1.1.1.1.2"></times><ci id="alg5.l15.m1.1.1.1.3a.cmml" xref="alg5.l15.m1.1.1.1.3"><mtext id="alg5.l15.m1.1.1.1.3.cmml" xref="alg5.l15.m1.1.1.1.3">synthesizeOutput</mtext></ci><apply id="alg5.l15.m1.1.1.1.1.1.1.cmml" xref="alg5.l15.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg5.l15.m1.1.1.1.1.1.1.1.cmml" xref="alg5.l15.m1.1.1.1.1.1">subscript</csymbol><ci id="alg5.l15.m1.1.1.1.1.1.1.2.cmml" xref="alg5.l15.m1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg5.l15.m1.1.1.1.1.1.1.3.cmml" xref="alg5.l15.m1.1.1.1.1.1.1.3"><leq id="alg5.l15.m1.1.1.1.1.1.1.3.1.cmml" xref="alg5.l15.m1.1.1.1.1.1.1.3.1"></leq><csymbol cd="latexml" id="alg5.l15.m1.1.1.1.1.1.1.3.2.cmml" xref="alg5.l15.m1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="alg5.l15.m1.1.1.1.1.1.1.3.3.cmml" xref="alg5.l15.m1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l15.m1.1c">y_{final}=\text{synthesizeOutput}(y_{\leq t})</annotation><annotation encoding="application/x-llamapun" id="alg5.l15.m1.1d">italic_y start_POSTSUBSCRIPT italic_f italic_i italic_n italic_a italic_l end_POSTSUBSCRIPT = synthesizeOutput ( italic_y start_POSTSUBSCRIPT ≤ italic_t end_POSTSUBSCRIPT )</annotation></semantics></math> // Synthesize final output from the list of outputs

</div>
<div class="ltx_listingline" id="alg5.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg5.l16.1.1.1" style="font-size:80%;">16:</span></span>  <span class="ltx_text ltx_font_bold" id="alg5.l16.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg5.l16.m1.1"><semantics id="alg5.l16.m1.1a"><mover accent="true" id="alg5.l16.m1.1.1" xref="alg5.l16.m1.1.1.cmml"><mi id="alg5.l16.m1.1.1.2" xref="alg5.l16.m1.1.1.2.cmml">y</mi><mo id="alg5.l16.m1.1.1.1" xref="alg5.l16.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg5.l16.m1.1b"><apply id="alg5.l16.m1.1.1.cmml" xref="alg5.l16.m1.1.1"><ci id="alg5.l16.m1.1.1.1.cmml" xref="alg5.l16.m1.1.1.1">^</ci><ci id="alg5.l16.m1.1.1.2.cmml" xref="alg5.l16.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg5.l16.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg5.l16.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<figure class="ltx_figure" id="S5.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="182" id="S5.F11.g1" src="extracted/5756188/images/Iter_retgen.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 11: </span>ITER-RETGEN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib56" title="">56</a>]</cite> is a typical iterative structure. Multiple rounds of retrieval and generation are performed within the limit of the maximum number of iterations. </figcaption>
</figure>
<div class="ltx_para" id="S5.SS4.p3">
<p class="ltx_p" id="S5.SS4.p3.1">An exemplary case of iterative retrieval is ITER-RETGEN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib56" title="">56</a>]</cite> (Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F11" title="Figure 11 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">11</span></a>), which iterates retrieval-augmented generation and generation-augmented retrieval. Retrieval-augmented generation outputs a response to a task input based on all retrieved knowledge. In each iteration, ITER-RETGEN leverages the model output from the previous iteration as a specific context to help retrieve more relevant knowledge. Termination of the loop is determined by a predefined number of iterations.</p>
</div>
<div class="ltx_para" id="S5.SS4.p4">
<p class="ltx_p" id="S5.SS4.p4.1"><span class="ltx_text ltx_font_bold" id="S5.SS4.p4.1.1">Recursive retrieval</span>
The characteristic feature of recursive retrieval (see Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg6" title="Algorithm 6 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">6</span></a>), as opposed to iterative retrieval, is its clear dependency on the previous step and its continuous deepening of retrieval. Typically, it follows a tree-like structure and there is a clear termination mechanism as an exit condition for recursive retrieval. In RAG systems, recursive retrieval usually involves query transform, relying on the newly rewritten query for each retrieval.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg6.2.1.1">Algorithm 6</span> </span> Recursive RAG Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg6.3">
<div class="ltx_listingline" id="alg6.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l0.1.1.1" style="font-size:80%;">0:</span></span>  initial query <math alttext="q" class="ltx_Math" display="inline" id="alg6.l0.m1.1"><semantics id="alg6.l0.m1.1a"><mi id="alg6.l0.m1.1.1" xref="alg6.l0.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg6.l0.m1.1b"><ci id="alg6.l0.m1.1.1.cmml" xref="alg6.l0.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg6.l0.m1.1d">italic_q</annotation></semantics></math>, document <math alttext="D" class="ltx_Math" display="inline" id="alg6.l0.m2.1"><semantics id="alg6.l0.m2.1a"><mi id="alg6.l0.m2.1.1" xref="alg6.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg6.l0.m2.1b"><ci id="alg6.l0.m2.1.1.cmml" xref="alg6.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg6.l0.m2.1d">italic_D</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg6.l0.m3.1"><semantics id="alg6.l0.m3.1a"><mi id="alg6.l0.m3.1.1" xref="alg6.l0.m3.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg6.l0.m3.1b"><ci id="alg6.l0.m3.1.1.cmml" xref="alg6.l0.m3.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0.m3.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg6.l0.m3.1d">italic_R</annotation></semantics></math>, language model <math alttext="LM" class="ltx_Math" display="inline" id="alg6.l0.m4.1"><semantics id="alg6.l0.m4.1a"><mrow id="alg6.l0.m4.1.1" xref="alg6.l0.m4.1.1.cmml"><mi id="alg6.l0.m4.1.1.2" xref="alg6.l0.m4.1.1.2.cmml">L</mi><mo id="alg6.l0.m4.1.1.1" xref="alg6.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg6.l0.m4.1.1.3" xref="alg6.l0.m4.1.1.3.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg6.l0.m4.1b"><apply id="alg6.l0.m4.1.1.cmml" xref="alg6.l0.m4.1.1"><times id="alg6.l0.m4.1.1.1.cmml" xref="alg6.l0.m4.1.1.1"></times><ci id="alg6.l0.m4.1.1.2.cmml" xref="alg6.l0.m4.1.1.2">𝐿</ci><ci id="alg6.l0.m4.1.1.3.cmml" xref="alg6.l0.m4.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0.m4.1c">LM</annotation><annotation encoding="application/x-llamapun" id="alg6.l0.m4.1d">italic_L italic_M</annotation></semantics></math>, maximum recursive depth <math alttext="K_{max}" class="ltx_Math" display="inline" id="alg6.l0.m5.1"><semantics id="alg6.l0.m5.1a"><msub id="alg6.l0.m5.1.1" xref="alg6.l0.m5.1.1.cmml"><mi id="alg6.l0.m5.1.1.2" xref="alg6.l0.m5.1.1.2.cmml">K</mi><mrow id="alg6.l0.m5.1.1.3" xref="alg6.l0.m5.1.1.3.cmml"><mi id="alg6.l0.m5.1.1.3.2" xref="alg6.l0.m5.1.1.3.2.cmml">m</mi><mo id="alg6.l0.m5.1.1.3.1" xref="alg6.l0.m5.1.1.3.1.cmml">⁢</mo><mi id="alg6.l0.m5.1.1.3.3" xref="alg6.l0.m5.1.1.3.3.cmml">a</mi><mo id="alg6.l0.m5.1.1.3.1a" xref="alg6.l0.m5.1.1.3.1.cmml">⁢</mo><mi id="alg6.l0.m5.1.1.3.4" xref="alg6.l0.m5.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg6.l0.m5.1b"><apply id="alg6.l0.m5.1.1.cmml" xref="alg6.l0.m5.1.1"><csymbol cd="ambiguous" id="alg6.l0.m5.1.1.1.cmml" xref="alg6.l0.m5.1.1">subscript</csymbol><ci id="alg6.l0.m5.1.1.2.cmml" xref="alg6.l0.m5.1.1.2">𝐾</ci><apply id="alg6.l0.m5.1.1.3.cmml" xref="alg6.l0.m5.1.1.3"><times id="alg6.l0.m5.1.1.3.1.cmml" xref="alg6.l0.m5.1.1.3.1"></times><ci id="alg6.l0.m5.1.1.3.2.cmml" xref="alg6.l0.m5.1.1.3.2">𝑚</ci><ci id="alg6.l0.m5.1.1.3.3.cmml" xref="alg6.l0.m5.1.1.3.3">𝑎</ci><ci id="alg6.l0.m5.1.1.3.4.cmml" xref="alg6.l0.m5.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0.m5.1c">K_{max}</annotation><annotation encoding="application/x-llamapun" id="alg6.l0.m5.1d">italic_K start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg6.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg6.l0a.m1.1"><semantics id="alg6.l0a.m1.1a"><mover accent="true" id="alg6.l0a.m1.1.1" xref="alg6.l0a.m1.1.1.cmml"><mi id="alg6.l0a.m1.1.1.2" xref="alg6.l0a.m1.1.1.2.cmml">y</mi><mo id="alg6.l0a.m1.1.1.1" xref="alg6.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg6.l0a.m1.1b"><apply id="alg6.l0a.m1.1.1.cmml" xref="alg6.l0a.m1.1.1"><ci id="alg6.l0a.m1.1.1.1.cmml" xref="alg6.l0a.m1.1.1.1">^</ci><ci id="alg6.l0a.m1.1.1.2.cmml" xref="alg6.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg6.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg6.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg6.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="\quad Q\leftarrow\{q\}" class="ltx_Math" display="inline" id="alg6.l2.m1.1"><semantics id="alg6.l2.m1.1a"><mrow id="alg6.l2.m1.1.2" xref="alg6.l2.m1.1.2.cmml"><mi id="alg6.l2.m1.1.2.2" xref="alg6.l2.m1.1.2.2.cmml">Q</mi><mo id="alg6.l2.m1.1.2.1" stretchy="false" xref="alg6.l2.m1.1.2.1.cmml">←</mo><mrow id="alg6.l2.m1.1.2.3.2" xref="alg6.l2.m1.1.2.3.1.cmml"><mo id="alg6.l2.m1.1.2.3.2.1" stretchy="false" xref="alg6.l2.m1.1.2.3.1.cmml">{</mo><mi id="alg6.l2.m1.1.1" xref="alg6.l2.m1.1.1.cmml">q</mi><mo id="alg6.l2.m1.1.2.3.2.2" stretchy="false" xref="alg6.l2.m1.1.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l2.m1.1b"><apply id="alg6.l2.m1.1.2.cmml" xref="alg6.l2.m1.1.2"><ci id="alg6.l2.m1.1.2.1.cmml" xref="alg6.l2.m1.1.2.1">←</ci><ci id="alg6.l2.m1.1.2.2.cmml" xref="alg6.l2.m1.1.2.2">𝑄</ci><set id="alg6.l2.m1.1.2.3.1.cmml" xref="alg6.l2.m1.1.2.3.2"><ci id="alg6.l2.m1.1.1.cmml" xref="alg6.l2.m1.1.1">𝑞</ci></set></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l2.m1.1c">\quad Q\leftarrow\{q\}</annotation><annotation encoding="application/x-llamapun" id="alg6.l2.m1.1d">italic_Q ← { italic_q }</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg6.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="\quad k\leftarrow 0" class="ltx_Math" display="inline" id="alg6.l3.m1.1"><semantics id="alg6.l3.m1.1a"><mrow id="alg6.l3.m1.1.1" xref="alg6.l3.m1.1.1.cmml"><mi id="alg6.l3.m1.1.1.2" xref="alg6.l3.m1.1.1.2.cmml">k</mi><mo id="alg6.l3.m1.1.1.1" stretchy="false" xref="alg6.l3.m1.1.1.1.cmml">←</mo><mn id="alg6.l3.m1.1.1.3" xref="alg6.l3.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="alg6.l3.m1.1b"><apply id="alg6.l3.m1.1.1.cmml" xref="alg6.l3.m1.1.1"><ci id="alg6.l3.m1.1.1.1.cmml" xref="alg6.l3.m1.1.1.1">←</ci><ci id="alg6.l3.m1.1.1.2.cmml" xref="alg6.l3.m1.1.1.2">𝑘</ci><cn id="alg6.l3.m1.1.1.3.cmml" type="integer" xref="alg6.l3.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l3.m1.1c">\quad k\leftarrow 0</annotation><annotation encoding="application/x-llamapun" id="alg6.l3.m1.1d">italic_k ← 0</annotation></semantics></math> // Initialize recursion depth

</div>
<div class="ltx_listingline" id="alg6.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l4.1.1.1" style="font-size:80%;">4:</span></span>  <span class="ltx_text ltx_font_bold" id="alg6.l4.2">while</span> <math alttext="Q\neq\emptyset" class="ltx_Math" display="inline" id="alg6.l4.m1.1"><semantics id="alg6.l4.m1.1a"><mrow id="alg6.l4.m1.1.1" xref="alg6.l4.m1.1.1.cmml"><mi id="alg6.l4.m1.1.1.2" xref="alg6.l4.m1.1.1.2.cmml">Q</mi><mo id="alg6.l4.m1.1.1.1" xref="alg6.l4.m1.1.1.1.cmml">≠</mo><mi id="alg6.l4.m1.1.1.3" mathvariant="normal" xref="alg6.l4.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg6.l4.m1.1b"><apply id="alg6.l4.m1.1.1.cmml" xref="alg6.l4.m1.1.1"><neq id="alg6.l4.m1.1.1.1.cmml" xref="alg6.l4.m1.1.1.1"></neq><ci id="alg6.l4.m1.1.1.2.cmml" xref="alg6.l4.m1.1.1.2">𝑄</ci><emptyset id="alg6.l4.m1.1.1.3.cmml" xref="alg6.l4.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l4.m1.1c">Q\neq\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg6.l4.m1.1d">italic_Q ≠ ∅</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l4.3">and</span> <math alttext="k&lt;K_{max}" class="ltx_Math" display="inline" id="alg6.l4.m2.1"><semantics id="alg6.l4.m2.1a"><mrow id="alg6.l4.m2.1.1" xref="alg6.l4.m2.1.1.cmml"><mi id="alg6.l4.m2.1.1.2" xref="alg6.l4.m2.1.1.2.cmml">k</mi><mo id="alg6.l4.m2.1.1.1" xref="alg6.l4.m2.1.1.1.cmml">&lt;</mo><msub id="alg6.l4.m2.1.1.3" xref="alg6.l4.m2.1.1.3.cmml"><mi id="alg6.l4.m2.1.1.3.2" xref="alg6.l4.m2.1.1.3.2.cmml">K</mi><mrow id="alg6.l4.m2.1.1.3.3" xref="alg6.l4.m2.1.1.3.3.cmml"><mi id="alg6.l4.m2.1.1.3.3.2" xref="alg6.l4.m2.1.1.3.3.2.cmml">m</mi><mo id="alg6.l4.m2.1.1.3.3.1" xref="alg6.l4.m2.1.1.3.3.1.cmml">⁢</mo><mi id="alg6.l4.m2.1.1.3.3.3" xref="alg6.l4.m2.1.1.3.3.3.cmml">a</mi><mo id="alg6.l4.m2.1.1.3.3.1a" xref="alg6.l4.m2.1.1.3.3.1.cmml">⁢</mo><mi id="alg6.l4.m2.1.1.3.3.4" xref="alg6.l4.m2.1.1.3.3.4.cmml">x</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg6.l4.m2.1b"><apply id="alg6.l4.m2.1.1.cmml" xref="alg6.l4.m2.1.1"><lt id="alg6.l4.m2.1.1.1.cmml" xref="alg6.l4.m2.1.1.1"></lt><ci id="alg6.l4.m2.1.1.2.cmml" xref="alg6.l4.m2.1.1.2">𝑘</ci><apply id="alg6.l4.m2.1.1.3.cmml" xref="alg6.l4.m2.1.1.3"><csymbol cd="ambiguous" id="alg6.l4.m2.1.1.3.1.cmml" xref="alg6.l4.m2.1.1.3">subscript</csymbol><ci id="alg6.l4.m2.1.1.3.2.cmml" xref="alg6.l4.m2.1.1.3.2">𝐾</ci><apply id="alg6.l4.m2.1.1.3.3.cmml" xref="alg6.l4.m2.1.1.3.3"><times id="alg6.l4.m2.1.1.3.3.1.cmml" xref="alg6.l4.m2.1.1.3.3.1"></times><ci id="alg6.l4.m2.1.1.3.3.2.cmml" xref="alg6.l4.m2.1.1.3.3.2">𝑚</ci><ci id="alg6.l4.m2.1.1.3.3.3.cmml" xref="alg6.l4.m2.1.1.3.3.3">𝑎</ci><ci id="alg6.l4.m2.1.1.3.3.4.cmml" xref="alg6.l4.m2.1.1.3.3.4">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l4.m2.1c">k&lt;K_{max}</annotation><annotation encoding="application/x-llamapun" id="alg6.l4.m2.1d">italic_k &lt; italic_K start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l4.4">do</span>
</div>
<div class="ltx_listingline" id="alg6.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l5.1.1.1" style="font-size:80%;">5:</span></span>     <math alttext="Q^{\prime}\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg6.l5.m1.1"><semantics id="alg6.l5.m1.1a"><mrow id="alg6.l5.m1.1.1" xref="alg6.l5.m1.1.1.cmml"><msup id="alg6.l5.m1.1.1.2" xref="alg6.l5.m1.1.1.2.cmml"><mi id="alg6.l5.m1.1.1.2.2" xref="alg6.l5.m1.1.1.2.2.cmml">Q</mi><mo id="alg6.l5.m1.1.1.2.3" xref="alg6.l5.m1.1.1.2.3.cmml">′</mo></msup><mo id="alg6.l5.m1.1.1.1" stretchy="false" xref="alg6.l5.m1.1.1.1.cmml">←</mo><mi id="alg6.l5.m1.1.1.3" mathvariant="normal" xref="alg6.l5.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg6.l5.m1.1b"><apply id="alg6.l5.m1.1.1.cmml" xref="alg6.l5.m1.1.1"><ci id="alg6.l5.m1.1.1.1.cmml" xref="alg6.l5.m1.1.1.1">←</ci><apply id="alg6.l5.m1.1.1.2.cmml" xref="alg6.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg6.l5.m1.1.1.2.1.cmml" xref="alg6.l5.m1.1.1.2">superscript</csymbol><ci id="alg6.l5.m1.1.1.2.2.cmml" xref="alg6.l5.m1.1.1.2.2">𝑄</ci><ci id="alg6.l5.m1.1.1.2.3.cmml" xref="alg6.l5.m1.1.1.2.3">′</ci></apply><emptyset id="alg6.l5.m1.1.1.3.cmml" xref="alg6.l5.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l5.m1.1c">Q^{\prime}\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg6.l5.m1.1d">italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← ∅</annotation></semantics></math> // To store queries for the next recursion level

</div>
<div class="ltx_listingline" id="alg6.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l6.1.1.1" style="font-size:80%;">6:</span></span>     <span class="ltx_text ltx_font_bold" id="alg6.l6.2">for all</span> <math alttext="q\in Q" class="ltx_Math" display="inline" id="alg6.l6.m1.1"><semantics id="alg6.l6.m1.1a"><mrow id="alg6.l6.m1.1.1" xref="alg6.l6.m1.1.1.cmml"><mi id="alg6.l6.m1.1.1.2" xref="alg6.l6.m1.1.1.2.cmml">q</mi><mo id="alg6.l6.m1.1.1.1" xref="alg6.l6.m1.1.1.1.cmml">∈</mo><mi id="alg6.l6.m1.1.1.3" xref="alg6.l6.m1.1.1.3.cmml">Q</mi></mrow><annotation-xml encoding="MathML-Content" id="alg6.l6.m1.1b"><apply id="alg6.l6.m1.1.1.cmml" xref="alg6.l6.m1.1.1"><in id="alg6.l6.m1.1.1.1.cmml" xref="alg6.l6.m1.1.1.1"></in><ci id="alg6.l6.m1.1.1.2.cmml" xref="alg6.l6.m1.1.1.2">𝑞</ci><ci id="alg6.l6.m1.1.1.3.cmml" xref="alg6.l6.m1.1.1.3">𝑄</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l6.m1.1c">q\in Q</annotation><annotation encoding="application/x-llamapun" id="alg6.l6.m1.1d">italic_q ∈ italic_Q</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l6.3">do</span>
</div>
<div class="ltx_listingline" id="alg6.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l7.1.1.1" style="font-size:80%;">7:</span></span>        <math alttext="D^{q}\leftarrow R(q,D)" class="ltx_Math" display="inline" id="alg6.l7.m1.2"><semantics id="alg6.l7.m1.2a"><mrow id="alg6.l7.m1.2.3" xref="alg6.l7.m1.2.3.cmml"><msup id="alg6.l7.m1.2.3.2" xref="alg6.l7.m1.2.3.2.cmml"><mi id="alg6.l7.m1.2.3.2.2" xref="alg6.l7.m1.2.3.2.2.cmml">D</mi><mi id="alg6.l7.m1.2.3.2.3" xref="alg6.l7.m1.2.3.2.3.cmml">q</mi></msup><mo id="alg6.l7.m1.2.3.1" stretchy="false" xref="alg6.l7.m1.2.3.1.cmml">←</mo><mrow id="alg6.l7.m1.2.3.3" xref="alg6.l7.m1.2.3.3.cmml"><mi id="alg6.l7.m1.2.3.3.2" xref="alg6.l7.m1.2.3.3.2.cmml">R</mi><mo id="alg6.l7.m1.2.3.3.1" xref="alg6.l7.m1.2.3.3.1.cmml">⁢</mo><mrow id="alg6.l7.m1.2.3.3.3.2" xref="alg6.l7.m1.2.3.3.3.1.cmml"><mo id="alg6.l7.m1.2.3.3.3.2.1" stretchy="false" xref="alg6.l7.m1.2.3.3.3.1.cmml">(</mo><mi id="alg6.l7.m1.1.1" xref="alg6.l7.m1.1.1.cmml">q</mi><mo id="alg6.l7.m1.2.3.3.3.2.2" xref="alg6.l7.m1.2.3.3.3.1.cmml">,</mo><mi id="alg6.l7.m1.2.2" xref="alg6.l7.m1.2.2.cmml">D</mi><mo id="alg6.l7.m1.2.3.3.3.2.3" stretchy="false" xref="alg6.l7.m1.2.3.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l7.m1.2b"><apply id="alg6.l7.m1.2.3.cmml" xref="alg6.l7.m1.2.3"><ci id="alg6.l7.m1.2.3.1.cmml" xref="alg6.l7.m1.2.3.1">←</ci><apply id="alg6.l7.m1.2.3.2.cmml" xref="alg6.l7.m1.2.3.2"><csymbol cd="ambiguous" id="alg6.l7.m1.2.3.2.1.cmml" xref="alg6.l7.m1.2.3.2">superscript</csymbol><ci id="alg6.l7.m1.2.3.2.2.cmml" xref="alg6.l7.m1.2.3.2.2">𝐷</ci><ci id="alg6.l7.m1.2.3.2.3.cmml" xref="alg6.l7.m1.2.3.2.3">𝑞</ci></apply><apply id="alg6.l7.m1.2.3.3.cmml" xref="alg6.l7.m1.2.3.3"><times id="alg6.l7.m1.2.3.3.1.cmml" xref="alg6.l7.m1.2.3.3.1"></times><ci id="alg6.l7.m1.2.3.3.2.cmml" xref="alg6.l7.m1.2.3.3.2">𝑅</ci><interval closure="open" id="alg6.l7.m1.2.3.3.3.1.cmml" xref="alg6.l7.m1.2.3.3.3.2"><ci id="alg6.l7.m1.1.1.cmml" xref="alg6.l7.m1.1.1">𝑞</ci><ci id="alg6.l7.m1.2.2.cmml" xref="alg6.l7.m1.2.2">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l7.m1.2c">D^{q}\leftarrow R(q,D)</annotation><annotation encoding="application/x-llamapun" id="alg6.l7.m1.2d">italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ← italic_R ( italic_q , italic_D )</annotation></semantics></math> // Retrieve or update documents related to the current query

</div>
<div class="ltx_listingline" id="alg6.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l8.1.1.1" style="font-size:80%;">8:</span></span>        <math alttext="Y\leftarrow LM([q,D^{q}])" class="ltx_Math" display="inline" id="alg6.l8.m1.2"><semantics id="alg6.l8.m1.2a"><mrow id="alg6.l8.m1.2.2" xref="alg6.l8.m1.2.2.cmml"><mi id="alg6.l8.m1.2.2.3" xref="alg6.l8.m1.2.2.3.cmml">Y</mi><mo id="alg6.l8.m1.2.2.2" stretchy="false" xref="alg6.l8.m1.2.2.2.cmml">←</mo><mrow id="alg6.l8.m1.2.2.1" xref="alg6.l8.m1.2.2.1.cmml"><mi id="alg6.l8.m1.2.2.1.3" xref="alg6.l8.m1.2.2.1.3.cmml">L</mi><mo id="alg6.l8.m1.2.2.1.2" xref="alg6.l8.m1.2.2.1.2.cmml">⁢</mo><mi id="alg6.l8.m1.2.2.1.4" xref="alg6.l8.m1.2.2.1.4.cmml">M</mi><mo id="alg6.l8.m1.2.2.1.2a" xref="alg6.l8.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg6.l8.m1.2.2.1.1.1" xref="alg6.l8.m1.2.2.1.cmml"><mo id="alg6.l8.m1.2.2.1.1.1.2" stretchy="false" xref="alg6.l8.m1.2.2.1.cmml">(</mo><mrow id="alg6.l8.m1.2.2.1.1.1.1.1" xref="alg6.l8.m1.2.2.1.1.1.1.2.cmml"><mo id="alg6.l8.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="alg6.l8.m1.2.2.1.1.1.1.2.cmml">[</mo><mi id="alg6.l8.m1.1.1" xref="alg6.l8.m1.1.1.cmml">q</mi><mo id="alg6.l8.m1.2.2.1.1.1.1.1.3" xref="alg6.l8.m1.2.2.1.1.1.1.2.cmml">,</mo><msup id="alg6.l8.m1.2.2.1.1.1.1.1.1" xref="alg6.l8.m1.2.2.1.1.1.1.1.1.cmml"><mi id="alg6.l8.m1.2.2.1.1.1.1.1.1.2" xref="alg6.l8.m1.2.2.1.1.1.1.1.1.2.cmml">D</mi><mi id="alg6.l8.m1.2.2.1.1.1.1.1.1.3" xref="alg6.l8.m1.2.2.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="alg6.l8.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="alg6.l8.m1.2.2.1.1.1.1.2.cmml">]</mo></mrow><mo id="alg6.l8.m1.2.2.1.1.1.3" stretchy="false" xref="alg6.l8.m1.2.2.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l8.m1.2b"><apply id="alg6.l8.m1.2.2.cmml" xref="alg6.l8.m1.2.2"><ci id="alg6.l8.m1.2.2.2.cmml" xref="alg6.l8.m1.2.2.2">←</ci><ci id="alg6.l8.m1.2.2.3.cmml" xref="alg6.l8.m1.2.2.3">𝑌</ci><apply id="alg6.l8.m1.2.2.1.cmml" xref="alg6.l8.m1.2.2.1"><times id="alg6.l8.m1.2.2.1.2.cmml" xref="alg6.l8.m1.2.2.1.2"></times><ci id="alg6.l8.m1.2.2.1.3.cmml" xref="alg6.l8.m1.2.2.1.3">𝐿</ci><ci id="alg6.l8.m1.2.2.1.4.cmml" xref="alg6.l8.m1.2.2.1.4">𝑀</ci><interval closure="closed" id="alg6.l8.m1.2.2.1.1.1.1.2.cmml" xref="alg6.l8.m1.2.2.1.1.1.1.1"><ci id="alg6.l8.m1.1.1.cmml" xref="alg6.l8.m1.1.1">𝑞</ci><apply id="alg6.l8.m1.2.2.1.1.1.1.1.1.cmml" xref="alg6.l8.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg6.l8.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg6.l8.m1.2.2.1.1.1.1.1.1">superscript</csymbol><ci id="alg6.l8.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg6.l8.m1.2.2.1.1.1.1.1.1.2">𝐷</ci><ci id="alg6.l8.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg6.l8.m1.2.2.1.1.1.1.1.1.3">𝑞</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l8.m1.2c">Y\leftarrow LM([q,D^{q}])</annotation><annotation encoding="application/x-llamapun" id="alg6.l8.m1.2d">italic_Y ← italic_L italic_M ( [ italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ] )</annotation></semantics></math> // Generate outputs using the language model

</div>
<div class="ltx_listingline" id="alg6.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l9.1.1.1" style="font-size:80%;">9:</span></span>        <math alttext="Q^{\prime\prime}\leftarrow\text{deriveNewQueries}(q,D^{q},Y)" class="ltx_Math" display="inline" id="alg6.l9.m1.3"><semantics id="alg6.l9.m1.3a"><mrow id="alg6.l9.m1.3.3" xref="alg6.l9.m1.3.3.cmml"><msup id="alg6.l9.m1.3.3.3" xref="alg6.l9.m1.3.3.3.cmml"><mi id="alg6.l9.m1.3.3.3.2" xref="alg6.l9.m1.3.3.3.2.cmml">Q</mi><mo id="alg6.l9.m1.3.3.3.3" xref="alg6.l9.m1.3.3.3.3.cmml">′′</mo></msup><mo id="alg6.l9.m1.3.3.2" stretchy="false" xref="alg6.l9.m1.3.3.2.cmml">←</mo><mrow id="alg6.l9.m1.3.3.1" xref="alg6.l9.m1.3.3.1.cmml"><mtext id="alg6.l9.m1.3.3.1.3" xref="alg6.l9.m1.3.3.1.3a.cmml">deriveNewQueries</mtext><mo id="alg6.l9.m1.3.3.1.2" xref="alg6.l9.m1.3.3.1.2.cmml">⁢</mo><mrow id="alg6.l9.m1.3.3.1.1.1" xref="alg6.l9.m1.3.3.1.1.2.cmml"><mo id="alg6.l9.m1.3.3.1.1.1.2" stretchy="false" xref="alg6.l9.m1.3.3.1.1.2.cmml">(</mo><mi id="alg6.l9.m1.1.1" xref="alg6.l9.m1.1.1.cmml">q</mi><mo id="alg6.l9.m1.3.3.1.1.1.3" xref="alg6.l9.m1.3.3.1.1.2.cmml">,</mo><msup id="alg6.l9.m1.3.3.1.1.1.1" xref="alg6.l9.m1.3.3.1.1.1.1.cmml"><mi id="alg6.l9.m1.3.3.1.1.1.1.2" xref="alg6.l9.m1.3.3.1.1.1.1.2.cmml">D</mi><mi id="alg6.l9.m1.3.3.1.1.1.1.3" xref="alg6.l9.m1.3.3.1.1.1.1.3.cmml">q</mi></msup><mo id="alg6.l9.m1.3.3.1.1.1.4" xref="alg6.l9.m1.3.3.1.1.2.cmml">,</mo><mi id="alg6.l9.m1.2.2" xref="alg6.l9.m1.2.2.cmml">Y</mi><mo id="alg6.l9.m1.3.3.1.1.1.5" stretchy="false" xref="alg6.l9.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l9.m1.3b"><apply id="alg6.l9.m1.3.3.cmml" xref="alg6.l9.m1.3.3"><ci id="alg6.l9.m1.3.3.2.cmml" xref="alg6.l9.m1.3.3.2">←</ci><apply id="alg6.l9.m1.3.3.3.cmml" xref="alg6.l9.m1.3.3.3"><csymbol cd="ambiguous" id="alg6.l9.m1.3.3.3.1.cmml" xref="alg6.l9.m1.3.3.3">superscript</csymbol><ci id="alg6.l9.m1.3.3.3.2.cmml" xref="alg6.l9.m1.3.3.3.2">𝑄</ci><ci id="alg6.l9.m1.3.3.3.3.cmml" xref="alg6.l9.m1.3.3.3.3">′′</ci></apply><apply id="alg6.l9.m1.3.3.1.cmml" xref="alg6.l9.m1.3.3.1"><times id="alg6.l9.m1.3.3.1.2.cmml" xref="alg6.l9.m1.3.3.1.2"></times><ci id="alg6.l9.m1.3.3.1.3a.cmml" xref="alg6.l9.m1.3.3.1.3"><mtext id="alg6.l9.m1.3.3.1.3.cmml" xref="alg6.l9.m1.3.3.1.3">deriveNewQueries</mtext></ci><vector id="alg6.l9.m1.3.3.1.1.2.cmml" xref="alg6.l9.m1.3.3.1.1.1"><ci id="alg6.l9.m1.1.1.cmml" xref="alg6.l9.m1.1.1">𝑞</ci><apply id="alg6.l9.m1.3.3.1.1.1.1.cmml" xref="alg6.l9.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="alg6.l9.m1.3.3.1.1.1.1.1.cmml" xref="alg6.l9.m1.3.3.1.1.1.1">superscript</csymbol><ci id="alg6.l9.m1.3.3.1.1.1.1.2.cmml" xref="alg6.l9.m1.3.3.1.1.1.1.2">𝐷</ci><ci id="alg6.l9.m1.3.3.1.1.1.1.3.cmml" xref="alg6.l9.m1.3.3.1.1.1.1.3">𝑞</ci></apply><ci id="alg6.l9.m1.2.2.cmml" xref="alg6.l9.m1.2.2">𝑌</ci></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l9.m1.3c">Q^{\prime\prime}\leftarrow\text{deriveNewQueries}(q,D^{q},Y)</annotation><annotation encoding="application/x-llamapun" id="alg6.l9.m1.3d">italic_Q start_POSTSUPERSCRIPT ′ ′ end_POSTSUPERSCRIPT ← deriveNewQueries ( italic_q , italic_D start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT , italic_Y )</annotation></semantics></math> // Derive new queries from generated outputs

</div>
<div class="ltx_listingline" id="alg6.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l10.1.1.1" style="font-size:80%;">10:</span></span>        <span class="ltx_text ltx_font_bold" id="alg6.l10.2">for all</span> <math alttext="q^{\prime}\in Q^{\prime\prime}" class="ltx_Math" display="inline" id="alg6.l10.m1.1"><semantics id="alg6.l10.m1.1a"><mrow id="alg6.l10.m1.1.1" xref="alg6.l10.m1.1.1.cmml"><msup id="alg6.l10.m1.1.1.2" xref="alg6.l10.m1.1.1.2.cmml"><mi id="alg6.l10.m1.1.1.2.2" xref="alg6.l10.m1.1.1.2.2.cmml">q</mi><mo id="alg6.l10.m1.1.1.2.3" xref="alg6.l10.m1.1.1.2.3.cmml">′</mo></msup><mo id="alg6.l10.m1.1.1.1" xref="alg6.l10.m1.1.1.1.cmml">∈</mo><msup id="alg6.l10.m1.1.1.3" xref="alg6.l10.m1.1.1.3.cmml"><mi id="alg6.l10.m1.1.1.3.2" xref="alg6.l10.m1.1.1.3.2.cmml">Q</mi><mo id="alg6.l10.m1.1.1.3.3" xref="alg6.l10.m1.1.1.3.3.cmml">′′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg6.l10.m1.1b"><apply id="alg6.l10.m1.1.1.cmml" xref="alg6.l10.m1.1.1"><in id="alg6.l10.m1.1.1.1.cmml" xref="alg6.l10.m1.1.1.1"></in><apply id="alg6.l10.m1.1.1.2.cmml" xref="alg6.l10.m1.1.1.2"><csymbol cd="ambiguous" id="alg6.l10.m1.1.1.2.1.cmml" xref="alg6.l10.m1.1.1.2">superscript</csymbol><ci id="alg6.l10.m1.1.1.2.2.cmml" xref="alg6.l10.m1.1.1.2.2">𝑞</ci><ci id="alg6.l10.m1.1.1.2.3.cmml" xref="alg6.l10.m1.1.1.2.3">′</ci></apply><apply id="alg6.l10.m1.1.1.3.cmml" xref="alg6.l10.m1.1.1.3"><csymbol cd="ambiguous" id="alg6.l10.m1.1.1.3.1.cmml" xref="alg6.l10.m1.1.1.3">superscript</csymbol><ci id="alg6.l10.m1.1.1.3.2.cmml" xref="alg6.l10.m1.1.1.3.2">𝑄</ci><ci id="alg6.l10.m1.1.1.3.3.cmml" xref="alg6.l10.m1.1.1.3.3">′′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l10.m1.1c">q^{\prime}\in Q^{\prime\prime}</annotation><annotation encoding="application/x-llamapun" id="alg6.l10.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ italic_Q start_POSTSUPERSCRIPT ′ ′ end_POSTSUPERSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l10.3">do</span>
</div>
<div class="ltx_listingline" id="alg6.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l11.1.1.1" style="font-size:80%;">11:</span></span>           <span class="ltx_text ltx_font_bold" id="alg6.l11.2">if</span> <math alttext="q^{\prime}\notin Q^{\prime}" class="ltx_Math" display="inline" id="alg6.l11.m1.1"><semantics id="alg6.l11.m1.1a"><mrow id="alg6.l11.m1.1.1" xref="alg6.l11.m1.1.1.cmml"><msup id="alg6.l11.m1.1.1.2" xref="alg6.l11.m1.1.1.2.cmml"><mi id="alg6.l11.m1.1.1.2.2" xref="alg6.l11.m1.1.1.2.2.cmml">q</mi><mo id="alg6.l11.m1.1.1.2.3" xref="alg6.l11.m1.1.1.2.3.cmml">′</mo></msup><mo id="alg6.l11.m1.1.1.1" xref="alg6.l11.m1.1.1.1.cmml">∉</mo><msup id="alg6.l11.m1.1.1.3" xref="alg6.l11.m1.1.1.3.cmml"><mi id="alg6.l11.m1.1.1.3.2" xref="alg6.l11.m1.1.1.3.2.cmml">Q</mi><mo id="alg6.l11.m1.1.1.3.3" xref="alg6.l11.m1.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg6.l11.m1.1b"><apply id="alg6.l11.m1.1.1.cmml" xref="alg6.l11.m1.1.1"><notin id="alg6.l11.m1.1.1.1.cmml" xref="alg6.l11.m1.1.1.1"></notin><apply id="alg6.l11.m1.1.1.2.cmml" xref="alg6.l11.m1.1.1.2"><csymbol cd="ambiguous" id="alg6.l11.m1.1.1.2.1.cmml" xref="alg6.l11.m1.1.1.2">superscript</csymbol><ci id="alg6.l11.m1.1.1.2.2.cmml" xref="alg6.l11.m1.1.1.2.2">𝑞</ci><ci id="alg6.l11.m1.1.1.2.3.cmml" xref="alg6.l11.m1.1.1.2.3">′</ci></apply><apply id="alg6.l11.m1.1.1.3.cmml" xref="alg6.l11.m1.1.1.3"><csymbol cd="ambiguous" id="alg6.l11.m1.1.1.3.1.cmml" xref="alg6.l11.m1.1.1.3">superscript</csymbol><ci id="alg6.l11.m1.1.1.3.2.cmml" xref="alg6.l11.m1.1.1.3.2">𝑄</ci><ci id="alg6.l11.m1.1.1.3.3.cmml" xref="alg6.l11.m1.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l11.m1.1c">q^{\prime}\notin Q^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg6.l11.m1.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∉ italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l11.3">and</span> <math alttext="q^{\prime}\notin Q" class="ltx_Math" display="inline" id="alg6.l11.m2.1"><semantics id="alg6.l11.m2.1a"><mrow id="alg6.l11.m2.1.1" xref="alg6.l11.m2.1.1.cmml"><msup id="alg6.l11.m2.1.1.2" xref="alg6.l11.m2.1.1.2.cmml"><mi id="alg6.l11.m2.1.1.2.2" xref="alg6.l11.m2.1.1.2.2.cmml">q</mi><mo id="alg6.l11.m2.1.1.2.3" xref="alg6.l11.m2.1.1.2.3.cmml">′</mo></msup><mo id="alg6.l11.m2.1.1.1" xref="alg6.l11.m2.1.1.1.cmml">∉</mo><mi id="alg6.l11.m2.1.1.3" xref="alg6.l11.m2.1.1.3.cmml">Q</mi></mrow><annotation-xml encoding="MathML-Content" id="alg6.l11.m2.1b"><apply id="alg6.l11.m2.1.1.cmml" xref="alg6.l11.m2.1.1"><notin id="alg6.l11.m2.1.1.1.cmml" xref="alg6.l11.m2.1.1.1"></notin><apply id="alg6.l11.m2.1.1.2.cmml" xref="alg6.l11.m2.1.1.2"><csymbol cd="ambiguous" id="alg6.l11.m2.1.1.2.1.cmml" xref="alg6.l11.m2.1.1.2">superscript</csymbol><ci id="alg6.l11.m2.1.1.2.2.cmml" xref="alg6.l11.m2.1.1.2.2">𝑞</ci><ci id="alg6.l11.m2.1.1.2.3.cmml" xref="alg6.l11.m2.1.1.2.3">′</ci></apply><ci id="alg6.l11.m2.1.1.3.cmml" xref="alg6.l11.m2.1.1.3">𝑄</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l11.m2.1c">q^{\prime}\notin Q</annotation><annotation encoding="application/x-llamapun" id="alg6.l11.m2.1d">italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∉ italic_Q</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg6.l11.4">then</span>
</div>
<div class="ltx_listingline" id="alg6.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l12.1.1.1" style="font-size:80%;">12:</span></span>              <math alttext="Q^{\prime}\leftarrow Q^{\prime}\cup\{q^{\prime}\}" class="ltx_Math" display="inline" id="alg6.l12.m1.1"><semantics id="alg6.l12.m1.1a"><mrow id="alg6.l12.m1.1.1" xref="alg6.l12.m1.1.1.cmml"><msup id="alg6.l12.m1.1.1.3" xref="alg6.l12.m1.1.1.3.cmml"><mi id="alg6.l12.m1.1.1.3.2" xref="alg6.l12.m1.1.1.3.2.cmml">Q</mi><mo id="alg6.l12.m1.1.1.3.3" xref="alg6.l12.m1.1.1.3.3.cmml">′</mo></msup><mo id="alg6.l12.m1.1.1.2" stretchy="false" xref="alg6.l12.m1.1.1.2.cmml">←</mo><mrow id="alg6.l12.m1.1.1.1" xref="alg6.l12.m1.1.1.1.cmml"><msup id="alg6.l12.m1.1.1.1.3" xref="alg6.l12.m1.1.1.1.3.cmml"><mi id="alg6.l12.m1.1.1.1.3.2" xref="alg6.l12.m1.1.1.1.3.2.cmml">Q</mi><mo id="alg6.l12.m1.1.1.1.3.3" xref="alg6.l12.m1.1.1.1.3.3.cmml">′</mo></msup><mo id="alg6.l12.m1.1.1.1.2" xref="alg6.l12.m1.1.1.1.2.cmml">∪</mo><mrow id="alg6.l12.m1.1.1.1.1.1" xref="alg6.l12.m1.1.1.1.1.2.cmml"><mo id="alg6.l12.m1.1.1.1.1.1.2" stretchy="false" xref="alg6.l12.m1.1.1.1.1.2.cmml">{</mo><msup id="alg6.l12.m1.1.1.1.1.1.1" xref="alg6.l12.m1.1.1.1.1.1.1.cmml"><mi id="alg6.l12.m1.1.1.1.1.1.1.2" xref="alg6.l12.m1.1.1.1.1.1.1.2.cmml">q</mi><mo id="alg6.l12.m1.1.1.1.1.1.1.3" xref="alg6.l12.m1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg6.l12.m1.1.1.1.1.1.3" stretchy="false" xref="alg6.l12.m1.1.1.1.1.2.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l12.m1.1b"><apply id="alg6.l12.m1.1.1.cmml" xref="alg6.l12.m1.1.1"><ci id="alg6.l12.m1.1.1.2.cmml" xref="alg6.l12.m1.1.1.2">←</ci><apply id="alg6.l12.m1.1.1.3.cmml" xref="alg6.l12.m1.1.1.3"><csymbol cd="ambiguous" id="alg6.l12.m1.1.1.3.1.cmml" xref="alg6.l12.m1.1.1.3">superscript</csymbol><ci id="alg6.l12.m1.1.1.3.2.cmml" xref="alg6.l12.m1.1.1.3.2">𝑄</ci><ci id="alg6.l12.m1.1.1.3.3.cmml" xref="alg6.l12.m1.1.1.3.3">′</ci></apply><apply id="alg6.l12.m1.1.1.1.cmml" xref="alg6.l12.m1.1.1.1"><union id="alg6.l12.m1.1.1.1.2.cmml" xref="alg6.l12.m1.1.1.1.2"></union><apply id="alg6.l12.m1.1.1.1.3.cmml" xref="alg6.l12.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg6.l12.m1.1.1.1.3.1.cmml" xref="alg6.l12.m1.1.1.1.3">superscript</csymbol><ci id="alg6.l12.m1.1.1.1.3.2.cmml" xref="alg6.l12.m1.1.1.1.3.2">𝑄</ci><ci id="alg6.l12.m1.1.1.1.3.3.cmml" xref="alg6.l12.m1.1.1.1.3.3">′</ci></apply><set id="alg6.l12.m1.1.1.1.1.2.cmml" xref="alg6.l12.m1.1.1.1.1.1"><apply id="alg6.l12.m1.1.1.1.1.1.1.cmml" xref="alg6.l12.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg6.l12.m1.1.1.1.1.1.1.1.cmml" xref="alg6.l12.m1.1.1.1.1.1.1">superscript</csymbol><ci id="alg6.l12.m1.1.1.1.1.1.1.2.cmml" xref="alg6.l12.m1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg6.l12.m1.1.1.1.1.1.1.3.cmml" xref="alg6.l12.m1.1.1.1.1.1.1.3">′</ci></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l12.m1.1c">Q^{\prime}\leftarrow Q^{\prime}\cup\{q^{\prime}\}</annotation><annotation encoding="application/x-llamapun" id="alg6.l12.m1.1d">italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∪ { italic_q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT }</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg6.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l13.1.1.1" style="font-size:80%;">13:</span></span>           <span class="ltx_text ltx_font_bold" id="alg6.l13.2">end</span> <span class="ltx_text ltx_font_bold" id="alg6.l13.3">if</span>
</div>
<div class="ltx_listingline" id="alg6.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l14.1.1.1" style="font-size:80%;">14:</span></span>        <span class="ltx_text ltx_font_bold" id="alg6.l14.2">end</span> <span class="ltx_text ltx_font_bold" id="alg6.l14.3">for</span>
</div>
<div class="ltx_listingline" id="alg6.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l15.1.1.1" style="font-size:80%;">15:</span></span>     <span class="ltx_text ltx_font_bold" id="alg6.l15.2">end</span> <span class="ltx_text ltx_font_bold" id="alg6.l15.3">for</span>
</div>
<div class="ltx_listingline" id="alg6.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l16.1.1.1" style="font-size:80%;">16:</span></span>     <math alttext="Q\leftarrow Q^{\prime}" class="ltx_Math" display="inline" id="alg6.l16.m1.1"><semantics id="alg6.l16.m1.1a"><mrow id="alg6.l16.m1.1.1" xref="alg6.l16.m1.1.1.cmml"><mi id="alg6.l16.m1.1.1.2" xref="alg6.l16.m1.1.1.2.cmml">Q</mi><mo id="alg6.l16.m1.1.1.1" stretchy="false" xref="alg6.l16.m1.1.1.1.cmml">←</mo><msup id="alg6.l16.m1.1.1.3" xref="alg6.l16.m1.1.1.3.cmml"><mi id="alg6.l16.m1.1.1.3.2" xref="alg6.l16.m1.1.1.3.2.cmml">Q</mi><mo id="alg6.l16.m1.1.1.3.3" xref="alg6.l16.m1.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg6.l16.m1.1b"><apply id="alg6.l16.m1.1.1.cmml" xref="alg6.l16.m1.1.1"><ci id="alg6.l16.m1.1.1.1.cmml" xref="alg6.l16.m1.1.1.1">←</ci><ci id="alg6.l16.m1.1.1.2.cmml" xref="alg6.l16.m1.1.1.2">𝑄</ci><apply id="alg6.l16.m1.1.1.3.cmml" xref="alg6.l16.m1.1.1.3"><csymbol cd="ambiguous" id="alg6.l16.m1.1.1.3.1.cmml" xref="alg6.l16.m1.1.1.3">superscript</csymbol><ci id="alg6.l16.m1.1.1.3.2.cmml" xref="alg6.l16.m1.1.1.3.2">𝑄</ci><ci id="alg6.l16.m1.1.1.3.3.cmml" xref="alg6.l16.m1.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l16.m1.1c">Q\leftarrow Q^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg6.l16.m1.1d">italic_Q ← italic_Q start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> // Update the set of queries for the next recursion

</div>
<div class="ltx_listingline" id="alg6.l17">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l17.1.1.1" style="font-size:80%;">17:</span></span>     <math alttext="k\leftarrow k+1" class="ltx_Math" display="inline" id="alg6.l17.m1.1"><semantics id="alg6.l17.m1.1a"><mrow id="alg6.l17.m1.1.1" xref="alg6.l17.m1.1.1.cmml"><mi id="alg6.l17.m1.1.1.2" xref="alg6.l17.m1.1.1.2.cmml">k</mi><mo id="alg6.l17.m1.1.1.1" stretchy="false" xref="alg6.l17.m1.1.1.1.cmml">←</mo><mrow id="alg6.l17.m1.1.1.3" xref="alg6.l17.m1.1.1.3.cmml"><mi id="alg6.l17.m1.1.1.3.2" xref="alg6.l17.m1.1.1.3.2.cmml">k</mi><mo id="alg6.l17.m1.1.1.3.1" xref="alg6.l17.m1.1.1.3.1.cmml">+</mo><mn id="alg6.l17.m1.1.1.3.3" xref="alg6.l17.m1.1.1.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l17.m1.1b"><apply id="alg6.l17.m1.1.1.cmml" xref="alg6.l17.m1.1.1"><ci id="alg6.l17.m1.1.1.1.cmml" xref="alg6.l17.m1.1.1.1">←</ci><ci id="alg6.l17.m1.1.1.2.cmml" xref="alg6.l17.m1.1.1.2">𝑘</ci><apply id="alg6.l17.m1.1.1.3.cmml" xref="alg6.l17.m1.1.1.3"><plus id="alg6.l17.m1.1.1.3.1.cmml" xref="alg6.l17.m1.1.1.3.1"></plus><ci id="alg6.l17.m1.1.1.3.2.cmml" xref="alg6.l17.m1.1.1.3.2">𝑘</ci><cn id="alg6.l17.m1.1.1.3.3.cmml" type="integer" xref="alg6.l17.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l17.m1.1c">k\leftarrow k+1</annotation><annotation encoding="application/x-llamapun" id="alg6.l17.m1.1d">italic_k ← italic_k + 1</annotation></semantics></math> // Increment recursion depth

</div>
<div class="ltx_listingline" id="alg6.l18">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l18.1.1.1" style="font-size:80%;">18:</span></span>  <span class="ltx_text ltx_font_bold" id="alg6.l18.2">end</span> <span class="ltx_text ltx_font_bold" id="alg6.l18.3">while</span>
</div>
<div class="ltx_listingline" id="alg6.l19">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l19.1.1.1" style="font-size:80%;">19:</span></span>  <math alttext="\hat{y}=\text{synthesizeOutput}(Y)" class="ltx_Math" display="inline" id="alg6.l19.m1.1"><semantics id="alg6.l19.m1.1a"><mrow id="alg6.l19.m1.1.2" xref="alg6.l19.m1.1.2.cmml"><mover accent="true" id="alg6.l19.m1.1.2.2" xref="alg6.l19.m1.1.2.2.cmml"><mi id="alg6.l19.m1.1.2.2.2" xref="alg6.l19.m1.1.2.2.2.cmml">y</mi><mo id="alg6.l19.m1.1.2.2.1" xref="alg6.l19.m1.1.2.2.1.cmml">^</mo></mover><mo id="alg6.l19.m1.1.2.1" xref="alg6.l19.m1.1.2.1.cmml">=</mo><mrow id="alg6.l19.m1.1.2.3" xref="alg6.l19.m1.1.2.3.cmml"><mtext id="alg6.l19.m1.1.2.3.2" xref="alg6.l19.m1.1.2.3.2a.cmml">synthesizeOutput</mtext><mo id="alg6.l19.m1.1.2.3.1" xref="alg6.l19.m1.1.2.3.1.cmml">⁢</mo><mrow id="alg6.l19.m1.1.2.3.3.2" xref="alg6.l19.m1.1.2.3.cmml"><mo id="alg6.l19.m1.1.2.3.3.2.1" stretchy="false" xref="alg6.l19.m1.1.2.3.cmml">(</mo><mi id="alg6.l19.m1.1.1" xref="alg6.l19.m1.1.1.cmml">Y</mi><mo id="alg6.l19.m1.1.2.3.3.2.2" stretchy="false" xref="alg6.l19.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg6.l19.m1.1b"><apply id="alg6.l19.m1.1.2.cmml" xref="alg6.l19.m1.1.2"><eq id="alg6.l19.m1.1.2.1.cmml" xref="alg6.l19.m1.1.2.1"></eq><apply id="alg6.l19.m1.1.2.2.cmml" xref="alg6.l19.m1.1.2.2"><ci id="alg6.l19.m1.1.2.2.1.cmml" xref="alg6.l19.m1.1.2.2.1">^</ci><ci id="alg6.l19.m1.1.2.2.2.cmml" xref="alg6.l19.m1.1.2.2.2">𝑦</ci></apply><apply id="alg6.l19.m1.1.2.3.cmml" xref="alg6.l19.m1.1.2.3"><times id="alg6.l19.m1.1.2.3.1.cmml" xref="alg6.l19.m1.1.2.3.1"></times><ci id="alg6.l19.m1.1.2.3.2a.cmml" xref="alg6.l19.m1.1.2.3.2"><mtext id="alg6.l19.m1.1.2.3.2.cmml" xref="alg6.l19.m1.1.2.3.2">synthesizeOutput</mtext></ci><ci id="alg6.l19.m1.1.1.cmml" xref="alg6.l19.m1.1.1">𝑌</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l19.m1.1c">\hat{y}=\text{synthesizeOutput}(Y)</annotation><annotation encoding="application/x-llamapun" id="alg6.l19.m1.1d">over^ start_ARG italic_y end_ARG = synthesizeOutput ( italic_Y )</annotation></semantics></math> // Synthesize final output from generated outputs

</div>
<div class="ltx_listingline" id="alg6.l20">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg6.l20.1.1.1" style="font-size:80%;">20:</span></span>  <span class="ltx_text ltx_font_bold" id="alg6.l20.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg6.l20.m1.1"><semantics id="alg6.l20.m1.1a"><mover accent="true" id="alg6.l20.m1.1.1" xref="alg6.l20.m1.1.1.cmml"><mi id="alg6.l20.m1.1.1.2" xref="alg6.l20.m1.1.1.2.cmml">y</mi><mo id="alg6.l20.m1.1.1.1" xref="alg6.l20.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg6.l20.m1.1b"><apply id="alg6.l20.m1.1.1.cmml" xref="alg6.l20.m1.1.1"><ci id="alg6.l20.m1.1.1.1.cmml" xref="alg6.l20.m1.1.1.1">^</ci><ci id="alg6.l20.m1.1.1.2.cmml" xref="alg6.l20.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg6.l20.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg6.l20.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S5.SS4.p5">
<p class="ltx_p" id="S5.SS4.p5.1">A typical implementation of recursive retrieval, such as ToC <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib13" title="">13</a>]</cite> (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F12" title="Figure 12 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">12</span></a> ), involves recursively executing RAC (Recursive Augmented Clarification) to gradually insert sub-nodes into the clarification tree from the initial ambiguous question (AQ). At each expansion step, paragraph re-ranking is performed based on the current query to generate a disambiguous Question (DQ). The exploration of the tree concludes upon reaching the maximum number of valid nodes or the maximum depth. Once the clarification tree is constructed, ToC gathers all valid nodes and generates a comprehensive long-text answer to address AQ.</p>
</div>
<figure class="ltx_figure" id="S5.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="105" id="S5.F12.g1" src="extracted/5756188/images/ToC.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 12: </span>RAG flow of ToC <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib13" title="">13</a>]</cite>. A typical characteristic of this process is that each recursive retrieval uses the new query generated from the previous step, thereby progressively deepening analysis of the original complex query.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS4.p6">
<p class="ltx_p" id="S5.SS4.p6.1"><span class="ltx_text ltx_font_bold" id="S5.SS4.p6.1.1">Adaptive (Active) retrieval</span>
With the advancement of RAG, there has been a gradual shift beyond passive retrieval to the emergence of adaptive retrieval (see Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#alg7" title="Algorithm 7 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">7</span></a>) , also known as active retrieval, which is partly attributed to the powerful capabilities of LLM. This shares a core concept with LLM Agent <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib57" title="">57</a>]</cite>. RAG systems can actively determine the timing of retrieval and decide when to conclude the entire process and produce the final result. Based on the criteria for judgment, this can be further categorized into Prompt-base and Tuning-base approaches.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg7">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg7.2.1.1">Algorithm 7</span> </span> Active RAG Flow Pattern</figcaption>
<div class="ltx_listing ltx_listing" id="alg7.3">
<div class="ltx_listingline" id="alg7.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l0.1.1.1" style="font-size:80%;">0:</span></span>  original query <math alttext="Q" class="ltx_Math" display="inline" id="alg7.l0.m1.1"><semantics id="alg7.l0.m1.1a"><mi id="alg7.l0.m1.1.1" xref="alg7.l0.m1.1.1.cmml">Q</mi><annotation-xml encoding="MathML-Content" id="alg7.l0.m1.1b"><ci id="alg7.l0.m1.1.1.cmml" xref="alg7.l0.m1.1.1">𝑄</ci></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0.m1.1c">Q</annotation><annotation encoding="application/x-llamapun" id="alg7.l0.m1.1d">italic_Q</annotation></semantics></math>, documents <math alttext="D" class="ltx_Math" display="inline" id="alg7.l0.m2.1"><semantics id="alg7.l0.m2.1a"><mi id="alg7.l0.m2.1.1" xref="alg7.l0.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg7.l0.m2.1b"><ci id="alg7.l0.m2.1.1.cmml" xref="alg7.l0.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg7.l0.m2.1d">italic_D</annotation></semantics></math>, maximum iterative times <math alttext="T" class="ltx_Math" display="inline" id="alg7.l0.m3.1"><semantics id="alg7.l0.m3.1a"><mi id="alg7.l0.m3.1.1" xref="alg7.l0.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="alg7.l0.m3.1b"><ci id="alg7.l0.m3.1.1.cmml" xref="alg7.l0.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="alg7.l0.m3.1d">italic_T</annotation></semantics></math>, language model <math alttext="LLM" class="ltx_Math" display="inline" id="alg7.l0.m4.1"><semantics id="alg7.l0.m4.1a"><mrow id="alg7.l0.m4.1.1" xref="alg7.l0.m4.1.1.cmml"><mi id="alg7.l0.m4.1.1.2" xref="alg7.l0.m4.1.1.2.cmml">L</mi><mo id="alg7.l0.m4.1.1.1" xref="alg7.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg7.l0.m4.1.1.3" xref="alg7.l0.m4.1.1.3.cmml">L</mi><mo id="alg7.l0.m4.1.1.1a" xref="alg7.l0.m4.1.1.1.cmml">⁢</mo><mi id="alg7.l0.m4.1.1.4" xref="alg7.l0.m4.1.1.4.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg7.l0.m4.1b"><apply id="alg7.l0.m4.1.1.cmml" xref="alg7.l0.m4.1.1"><times id="alg7.l0.m4.1.1.1.cmml" xref="alg7.l0.m4.1.1.1"></times><ci id="alg7.l0.m4.1.1.2.cmml" xref="alg7.l0.m4.1.1.2">𝐿</ci><ci id="alg7.l0.m4.1.1.3.cmml" xref="alg7.l0.m4.1.1.3">𝐿</ci><ci id="alg7.l0.m4.1.1.4.cmml" xref="alg7.l0.m4.1.1.4">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0.m4.1c">LLM</annotation><annotation encoding="application/x-llamapun" id="alg7.l0.m4.1d">italic_L italic_L italic_M</annotation></semantics></math>, retriever <math alttext="R" class="ltx_Math" display="inline" id="alg7.l0.m5.1"><semantics id="alg7.l0.m5.1a"><mi id="alg7.l0.m5.1.1" xref="alg7.l0.m5.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg7.l0.m5.1b"><ci id="alg7.l0.m5.1.1.cmml" xref="alg7.l0.m5.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0.m5.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg7.l0.m5.1d">italic_R</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg7.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l0a.1.1.1" style="font-size:80%;">0:</span></span>  final output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg7.l0a.m1.1"><semantics id="alg7.l0a.m1.1a"><mover accent="true" id="alg7.l0a.m1.1.1" xref="alg7.l0a.m1.1.1.cmml"><mi id="alg7.l0a.m1.1.1.2" xref="alg7.l0a.m1.1.1.2.cmml">y</mi><mo id="alg7.l0a.m1.1.1.1" xref="alg7.l0a.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg7.l0a.m1.1b"><apply id="alg7.l0a.m1.1.1.cmml" xref="alg7.l0a.m1.1.1"><ci id="alg7.l0a.m1.1.1.1.cmml" xref="alg7.l0a.m1.1.1.1">^</ci><ci id="alg7.l0a.m1.1.1.2.cmml" xref="alg7.l0a.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l0a.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg7.l0a.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg7.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l1.1.1.1" style="font-size:80%;">1:</span></span>  Initialize:

</div>
<div class="ltx_listingline" id="alg7.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="t\leftarrow 1" class="ltx_Math" display="inline" id="alg7.l2.m1.1"><semantics id="alg7.l2.m1.1a"><mrow id="alg7.l2.m1.1.1" xref="alg7.l2.m1.1.1.cmml"><mi id="alg7.l2.m1.1.1.2" xref="alg7.l2.m1.1.1.2.cmml">t</mi><mo id="alg7.l2.m1.1.1.1" stretchy="false" xref="alg7.l2.m1.1.1.1.cmml">←</mo><mn id="alg7.l2.m1.1.1.3" xref="alg7.l2.m1.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg7.l2.m1.1b"><apply id="alg7.l2.m1.1.1.cmml" xref="alg7.l2.m1.1.1"><ci id="alg7.l2.m1.1.1.1.cmml" xref="alg7.l2.m1.1.1.1">←</ci><ci id="alg7.l2.m1.1.1.2.cmml" xref="alg7.l2.m1.1.1.2">𝑡</ci><cn id="alg7.l2.m1.1.1.3.cmml" type="integer" xref="alg7.l2.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l2.m1.1c">t\leftarrow 1</annotation><annotation encoding="application/x-llamapun" id="alg7.l2.m1.1d">italic_t ← 1</annotation></semantics></math> // Initialize loop step

</div>
<div class="ltx_listingline" id="alg7.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="q_{t}\leftarrow q" class="ltx_Math" display="inline" id="alg7.l3.m1.1"><semantics id="alg7.l3.m1.1a"><mrow id="alg7.l3.m1.1.1" xref="alg7.l3.m1.1.1.cmml"><msub id="alg7.l3.m1.1.1.2" xref="alg7.l3.m1.1.1.2.cmml"><mi id="alg7.l3.m1.1.1.2.2" xref="alg7.l3.m1.1.1.2.2.cmml">q</mi><mi id="alg7.l3.m1.1.1.2.3" xref="alg7.l3.m1.1.1.2.3.cmml">t</mi></msub><mo id="alg7.l3.m1.1.1.1" stretchy="false" xref="alg7.l3.m1.1.1.1.cmml">←</mo><mi id="alg7.l3.m1.1.1.3" xref="alg7.l3.m1.1.1.3.cmml">q</mi></mrow><annotation-xml encoding="MathML-Content" id="alg7.l3.m1.1b"><apply id="alg7.l3.m1.1.1.cmml" xref="alg7.l3.m1.1.1"><ci id="alg7.l3.m1.1.1.1.cmml" xref="alg7.l3.m1.1.1.1">←</ci><apply id="alg7.l3.m1.1.1.2.cmml" xref="alg7.l3.m1.1.1.2"><csymbol cd="ambiguous" id="alg7.l3.m1.1.1.2.1.cmml" xref="alg7.l3.m1.1.1.2">subscript</csymbol><ci id="alg7.l3.m1.1.1.2.2.cmml" xref="alg7.l3.m1.1.1.2.2">𝑞</ci><ci id="alg7.l3.m1.1.1.2.3.cmml" xref="alg7.l3.m1.1.1.2.3">𝑡</ci></apply><ci id="alg7.l3.m1.1.1.3.cmml" xref="alg7.l3.m1.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l3.m1.1c">q_{t}\leftarrow q</annotation><annotation encoding="application/x-llamapun" id="alg7.l3.m1.1d">italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_q</annotation></semantics></math> // Initialize query for the first iteration

</div>
<div class="ltx_listingline" id="alg7.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l4.1.1.1" style="font-size:80%;">4:</span></span>  <math alttext="y_{&lt;1}\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg7.l4.m1.1"><semantics id="alg7.l4.m1.1a"><mrow id="alg7.l4.m1.1.1" xref="alg7.l4.m1.1.1.cmml"><msub id="alg7.l4.m1.1.1.2" xref="alg7.l4.m1.1.1.2.cmml"><mi id="alg7.l4.m1.1.1.2.2" xref="alg7.l4.m1.1.1.2.2.cmml">y</mi><mrow id="alg7.l4.m1.1.1.2.3" xref="alg7.l4.m1.1.1.2.3.cmml"><mi id="alg7.l4.m1.1.1.2.3.2" xref="alg7.l4.m1.1.1.2.3.2.cmml"></mi><mo id="alg7.l4.m1.1.1.2.3.1" xref="alg7.l4.m1.1.1.2.3.1.cmml">&lt;</mo><mn id="alg7.l4.m1.1.1.2.3.3" xref="alg7.l4.m1.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="alg7.l4.m1.1.1.1" stretchy="false" xref="alg7.l4.m1.1.1.1.cmml">←</mo><mi id="alg7.l4.m1.1.1.3" mathvariant="normal" xref="alg7.l4.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg7.l4.m1.1b"><apply id="alg7.l4.m1.1.1.cmml" xref="alg7.l4.m1.1.1"><ci id="alg7.l4.m1.1.1.1.cmml" xref="alg7.l4.m1.1.1.1">←</ci><apply id="alg7.l4.m1.1.1.2.cmml" xref="alg7.l4.m1.1.1.2"><csymbol cd="ambiguous" id="alg7.l4.m1.1.1.2.1.cmml" xref="alg7.l4.m1.1.1.2">subscript</csymbol><ci id="alg7.l4.m1.1.1.2.2.cmml" xref="alg7.l4.m1.1.1.2.2">𝑦</ci><apply id="alg7.l4.m1.1.1.2.3.cmml" xref="alg7.l4.m1.1.1.2.3"><lt id="alg7.l4.m1.1.1.2.3.1.cmml" xref="alg7.l4.m1.1.1.2.3.1"></lt><csymbol cd="latexml" id="alg7.l4.m1.1.1.2.3.2.cmml" xref="alg7.l4.m1.1.1.2.3.2">absent</csymbol><cn id="alg7.l4.m1.1.1.2.3.3.cmml" type="integer" xref="alg7.l4.m1.1.1.2.3.3">1</cn></apply></apply><emptyset id="alg7.l4.m1.1.1.3.cmml" xref="alg7.l4.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l4.m1.1c">y_{&lt;1}\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg7.l4.m1.1d">italic_y start_POSTSUBSCRIPT &lt; 1 end_POSTSUBSCRIPT ← ∅</annotation></semantics></math> // Initialize previous outputs as empty

</div>
<div class="ltx_listingline" id="alg7.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l5.1.1.1" style="font-size:80%;">5:</span></span>  <span class="ltx_text ltx_font_bold" id="alg7.l5.2">while</span> <math alttext="t\leq T" class="ltx_Math" display="inline" id="alg7.l5.m1.1"><semantics id="alg7.l5.m1.1a"><mrow id="alg7.l5.m1.1.1" xref="alg7.l5.m1.1.1.cmml"><mi id="alg7.l5.m1.1.1.2" xref="alg7.l5.m1.1.1.2.cmml">t</mi><mo id="alg7.l5.m1.1.1.1" xref="alg7.l5.m1.1.1.1.cmml">≤</mo><mi id="alg7.l5.m1.1.1.3" xref="alg7.l5.m1.1.1.3.cmml">T</mi></mrow><annotation-xml encoding="MathML-Content" id="alg7.l5.m1.1b"><apply id="alg7.l5.m1.1.1.cmml" xref="alg7.l5.m1.1.1"><leq id="alg7.l5.m1.1.1.1.cmml" xref="alg7.l5.m1.1.1.1"></leq><ci id="alg7.l5.m1.1.1.2.cmml" xref="alg7.l5.m1.1.1.2">𝑡</ci><ci id="alg7.l5.m1.1.1.3.cmml" xref="alg7.l5.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l5.m1.1c">t\leq T</annotation><annotation encoding="application/x-llamapun" id="alg7.l5.m1.1d">italic_t ≤ italic_T</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg7.l5.3">do</span>
</div>
<div class="ltx_listingline" id="alg7.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l6.1.1.1" style="font-size:80%;">6:</span></span>     <math alttext="Q_{t}\leftarrow\text{QueryTransform}(y_{&lt;t-1},q_{t-1})" class="ltx_Math" display="inline" id="alg7.l6.m1.2"><semantics id="alg7.l6.m1.2a"><mrow id="alg7.l6.m1.2.2" xref="alg7.l6.m1.2.2.cmml"><msub id="alg7.l6.m1.2.2.4" xref="alg7.l6.m1.2.2.4.cmml"><mi id="alg7.l6.m1.2.2.4.2" xref="alg7.l6.m1.2.2.4.2.cmml">Q</mi><mi id="alg7.l6.m1.2.2.4.3" xref="alg7.l6.m1.2.2.4.3.cmml">t</mi></msub><mo id="alg7.l6.m1.2.2.3" stretchy="false" xref="alg7.l6.m1.2.2.3.cmml">←</mo><mrow id="alg7.l6.m1.2.2.2" xref="alg7.l6.m1.2.2.2.cmml"><mtext id="alg7.l6.m1.2.2.2.4" xref="alg7.l6.m1.2.2.2.4a.cmml">QueryTransform</mtext><mo id="alg7.l6.m1.2.2.2.3" xref="alg7.l6.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg7.l6.m1.2.2.2.2.2" xref="alg7.l6.m1.2.2.2.2.3.cmml"><mo id="alg7.l6.m1.2.2.2.2.2.3" stretchy="false" xref="alg7.l6.m1.2.2.2.2.3.cmml">(</mo><msub id="alg7.l6.m1.1.1.1.1.1.1" xref="alg7.l6.m1.1.1.1.1.1.1.cmml"><mi id="alg7.l6.m1.1.1.1.1.1.1.2" xref="alg7.l6.m1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg7.l6.m1.1.1.1.1.1.1.3" xref="alg7.l6.m1.1.1.1.1.1.1.3.cmml"><mi id="alg7.l6.m1.1.1.1.1.1.1.3.2" xref="alg7.l6.m1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg7.l6.m1.1.1.1.1.1.1.3.1" xref="alg7.l6.m1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mrow id="alg7.l6.m1.1.1.1.1.1.1.3.3" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.cmml"><mi id="alg7.l6.m1.1.1.1.1.1.1.3.3.2" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="alg7.l6.m1.1.1.1.1.1.1.3.3.1" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg7.l6.m1.1.1.1.1.1.1.3.3.3" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg7.l6.m1.2.2.2.2.2.4" xref="alg7.l6.m1.2.2.2.2.3.cmml">,</mo><msub id="alg7.l6.m1.2.2.2.2.2.2" xref="alg7.l6.m1.2.2.2.2.2.2.cmml"><mi id="alg7.l6.m1.2.2.2.2.2.2.2" xref="alg7.l6.m1.2.2.2.2.2.2.2.cmml">q</mi><mrow id="alg7.l6.m1.2.2.2.2.2.2.3" xref="alg7.l6.m1.2.2.2.2.2.2.3.cmml"><mi id="alg7.l6.m1.2.2.2.2.2.2.3.2" xref="alg7.l6.m1.2.2.2.2.2.2.3.2.cmml">t</mi><mo id="alg7.l6.m1.2.2.2.2.2.2.3.1" xref="alg7.l6.m1.2.2.2.2.2.2.3.1.cmml">−</mo><mn id="alg7.l6.m1.2.2.2.2.2.2.3.3" xref="alg7.l6.m1.2.2.2.2.2.2.3.3.cmml">1</mn></mrow></msub><mo id="alg7.l6.m1.2.2.2.2.2.5" stretchy="false" xref="alg7.l6.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l6.m1.2b"><apply id="alg7.l6.m1.2.2.cmml" xref="alg7.l6.m1.2.2"><ci id="alg7.l6.m1.2.2.3.cmml" xref="alg7.l6.m1.2.2.3">←</ci><apply id="alg7.l6.m1.2.2.4.cmml" xref="alg7.l6.m1.2.2.4"><csymbol cd="ambiguous" id="alg7.l6.m1.2.2.4.1.cmml" xref="alg7.l6.m1.2.2.4">subscript</csymbol><ci id="alg7.l6.m1.2.2.4.2.cmml" xref="alg7.l6.m1.2.2.4.2">𝑄</ci><ci id="alg7.l6.m1.2.2.4.3.cmml" xref="alg7.l6.m1.2.2.4.3">𝑡</ci></apply><apply id="alg7.l6.m1.2.2.2.cmml" xref="alg7.l6.m1.2.2.2"><times id="alg7.l6.m1.2.2.2.3.cmml" xref="alg7.l6.m1.2.2.2.3"></times><ci id="alg7.l6.m1.2.2.2.4a.cmml" xref="alg7.l6.m1.2.2.2.4"><mtext id="alg7.l6.m1.2.2.2.4.cmml" xref="alg7.l6.m1.2.2.2.4">QueryTransform</mtext></ci><interval closure="open" id="alg7.l6.m1.2.2.2.2.3.cmml" xref="alg7.l6.m1.2.2.2.2.2"><apply id="alg7.l6.m1.1.1.1.1.1.1.cmml" xref="alg7.l6.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l6.m1.1.1.1.1.1.1.1.cmml" xref="alg7.l6.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l6.m1.1.1.1.1.1.1.2.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg7.l6.m1.1.1.1.1.1.1.3.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3"><lt id="alg7.l6.m1.1.1.1.1.1.1.3.1.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="alg7.l6.m1.1.1.1.1.1.1.3.2.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3.2">absent</csymbol><apply id="alg7.l6.m1.1.1.1.1.1.1.3.3.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3.3"><minus id="alg7.l6.m1.1.1.1.1.1.1.3.3.1.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.1"></minus><ci id="alg7.l6.m1.1.1.1.1.1.1.3.3.2.cmml" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.2">𝑡</ci><cn id="alg7.l6.m1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg7.l6.m1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="alg7.l6.m1.2.2.2.2.2.2.cmml" xref="alg7.l6.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg7.l6.m1.2.2.2.2.2.2.1.cmml" xref="alg7.l6.m1.2.2.2.2.2.2">subscript</csymbol><ci id="alg7.l6.m1.2.2.2.2.2.2.2.cmml" xref="alg7.l6.m1.2.2.2.2.2.2.2">𝑞</ci><apply id="alg7.l6.m1.2.2.2.2.2.2.3.cmml" xref="alg7.l6.m1.2.2.2.2.2.2.3"><minus id="alg7.l6.m1.2.2.2.2.2.2.3.1.cmml" xref="alg7.l6.m1.2.2.2.2.2.2.3.1"></minus><ci id="alg7.l6.m1.2.2.2.2.2.2.3.2.cmml" xref="alg7.l6.m1.2.2.2.2.2.2.3.2">𝑡</ci><cn id="alg7.l6.m1.2.2.2.2.2.2.3.3.cmml" type="integer" xref="alg7.l6.m1.2.2.2.2.2.2.3.3">1</cn></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l6.m1.2c">Q_{t}\leftarrow\text{QueryTransform}(y_{&lt;t-1},q_{t-1})</annotation><annotation encoding="application/x-llamapun" id="alg7.l6.m1.2d">italic_Q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← QueryTransform ( italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> // Derive new query from previous output and query

</div>
<div class="ltx_listingline" id="alg7.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l7.1.1.1" style="font-size:80%;">7:</span></span>     <span class="ltx_text ltx_font_bold" id="alg7.l7.2">if</span> <math alttext="\text{Evaluate}(Q_{t},y_{&lt;t-1})" class="ltx_Math" display="inline" id="alg7.l7.m1.2"><semantics id="alg7.l7.m1.2a"><mrow id="alg7.l7.m1.2.2" xref="alg7.l7.m1.2.2.cmml"><mtext id="alg7.l7.m1.2.2.4" xref="alg7.l7.m1.2.2.4a.cmml">Evaluate</mtext><mo id="alg7.l7.m1.2.2.3" xref="alg7.l7.m1.2.2.3.cmml">⁢</mo><mrow id="alg7.l7.m1.2.2.2.2" xref="alg7.l7.m1.2.2.2.3.cmml"><mo id="alg7.l7.m1.2.2.2.2.3" stretchy="false" xref="alg7.l7.m1.2.2.2.3.cmml">(</mo><msub id="alg7.l7.m1.1.1.1.1.1" xref="alg7.l7.m1.1.1.1.1.1.cmml"><mi id="alg7.l7.m1.1.1.1.1.1.2" xref="alg7.l7.m1.1.1.1.1.1.2.cmml">Q</mi><mi id="alg7.l7.m1.1.1.1.1.1.3" xref="alg7.l7.m1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="alg7.l7.m1.2.2.2.2.4" xref="alg7.l7.m1.2.2.2.3.cmml">,</mo><msub id="alg7.l7.m1.2.2.2.2.2" xref="alg7.l7.m1.2.2.2.2.2.cmml"><mi id="alg7.l7.m1.2.2.2.2.2.2" xref="alg7.l7.m1.2.2.2.2.2.2.cmml">y</mi><mrow id="alg7.l7.m1.2.2.2.2.2.3" xref="alg7.l7.m1.2.2.2.2.2.3.cmml"><mi id="alg7.l7.m1.2.2.2.2.2.3.2" xref="alg7.l7.m1.2.2.2.2.2.3.2.cmml"></mi><mo id="alg7.l7.m1.2.2.2.2.2.3.1" xref="alg7.l7.m1.2.2.2.2.2.3.1.cmml">&lt;</mo><mrow id="alg7.l7.m1.2.2.2.2.2.3.3" xref="alg7.l7.m1.2.2.2.2.2.3.3.cmml"><mi id="alg7.l7.m1.2.2.2.2.2.3.3.2" xref="alg7.l7.m1.2.2.2.2.2.3.3.2.cmml">t</mi><mo id="alg7.l7.m1.2.2.2.2.2.3.3.1" xref="alg7.l7.m1.2.2.2.2.2.3.3.1.cmml">−</mo><mn id="alg7.l7.m1.2.2.2.2.2.3.3.3" xref="alg7.l7.m1.2.2.2.2.2.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg7.l7.m1.2.2.2.2.5" stretchy="false" xref="alg7.l7.m1.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l7.m1.2b"><apply id="alg7.l7.m1.2.2.cmml" xref="alg7.l7.m1.2.2"><times id="alg7.l7.m1.2.2.3.cmml" xref="alg7.l7.m1.2.2.3"></times><ci id="alg7.l7.m1.2.2.4a.cmml" xref="alg7.l7.m1.2.2.4"><mtext id="alg7.l7.m1.2.2.4.cmml" xref="alg7.l7.m1.2.2.4">Evaluate</mtext></ci><interval closure="open" id="alg7.l7.m1.2.2.2.3.cmml" xref="alg7.l7.m1.2.2.2.2"><apply id="alg7.l7.m1.1.1.1.1.1.cmml" xref="alg7.l7.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l7.m1.1.1.1.1.1.1.cmml" xref="alg7.l7.m1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l7.m1.1.1.1.1.1.2.cmml" xref="alg7.l7.m1.1.1.1.1.1.2">𝑄</ci><ci id="alg7.l7.m1.1.1.1.1.1.3.cmml" xref="alg7.l7.m1.1.1.1.1.1.3">𝑡</ci></apply><apply id="alg7.l7.m1.2.2.2.2.2.cmml" xref="alg7.l7.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg7.l7.m1.2.2.2.2.2.1.cmml" xref="alg7.l7.m1.2.2.2.2.2">subscript</csymbol><ci id="alg7.l7.m1.2.2.2.2.2.2.cmml" xref="alg7.l7.m1.2.2.2.2.2.2">𝑦</ci><apply id="alg7.l7.m1.2.2.2.2.2.3.cmml" xref="alg7.l7.m1.2.2.2.2.2.3"><lt id="alg7.l7.m1.2.2.2.2.2.3.1.cmml" xref="alg7.l7.m1.2.2.2.2.2.3.1"></lt><csymbol cd="latexml" id="alg7.l7.m1.2.2.2.2.2.3.2.cmml" xref="alg7.l7.m1.2.2.2.2.2.3.2">absent</csymbol><apply id="alg7.l7.m1.2.2.2.2.2.3.3.cmml" xref="alg7.l7.m1.2.2.2.2.2.3.3"><minus id="alg7.l7.m1.2.2.2.2.2.3.3.1.cmml" xref="alg7.l7.m1.2.2.2.2.2.3.3.1"></minus><ci id="alg7.l7.m1.2.2.2.2.2.3.3.2.cmml" xref="alg7.l7.m1.2.2.2.2.2.3.3.2">𝑡</ci><cn id="alg7.l7.m1.2.2.2.2.2.3.3.3.cmml" type="integer" xref="alg7.l7.m1.2.2.2.2.2.3.3.3">1</cn></apply></apply></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l7.m1.2c">\text{Evaluate}(Q_{t},y_{&lt;t-1})</annotation><annotation encoding="application/x-llamapun" id="alg7.l7.m1.2d">Evaluate ( italic_Q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg7.l7.3">then</span>
</div>
<div class="ltx_listingline" id="alg7.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l8.1.1.1" style="font-size:80%;">8:</span></span>        <math alttext="D_{t}\leftarrow R(q_{t},D)" class="ltx_Math" display="inline" id="alg7.l8.m1.2"><semantics id="alg7.l8.m1.2a"><mrow id="alg7.l8.m1.2.2" xref="alg7.l8.m1.2.2.cmml"><msub id="alg7.l8.m1.2.2.3" xref="alg7.l8.m1.2.2.3.cmml"><mi id="alg7.l8.m1.2.2.3.2" xref="alg7.l8.m1.2.2.3.2.cmml">D</mi><mi id="alg7.l8.m1.2.2.3.3" xref="alg7.l8.m1.2.2.3.3.cmml">t</mi></msub><mo id="alg7.l8.m1.2.2.2" stretchy="false" xref="alg7.l8.m1.2.2.2.cmml">←</mo><mrow id="alg7.l8.m1.2.2.1" xref="alg7.l8.m1.2.2.1.cmml"><mi id="alg7.l8.m1.2.2.1.3" xref="alg7.l8.m1.2.2.1.3.cmml">R</mi><mo id="alg7.l8.m1.2.2.1.2" xref="alg7.l8.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg7.l8.m1.2.2.1.1.1" xref="alg7.l8.m1.2.2.1.1.2.cmml"><mo id="alg7.l8.m1.2.2.1.1.1.2" stretchy="false" xref="alg7.l8.m1.2.2.1.1.2.cmml">(</mo><msub id="alg7.l8.m1.2.2.1.1.1.1" xref="alg7.l8.m1.2.2.1.1.1.1.cmml"><mi id="alg7.l8.m1.2.2.1.1.1.1.2" xref="alg7.l8.m1.2.2.1.1.1.1.2.cmml">q</mi><mi id="alg7.l8.m1.2.2.1.1.1.1.3" xref="alg7.l8.m1.2.2.1.1.1.1.3.cmml">t</mi></msub><mo id="alg7.l8.m1.2.2.1.1.1.3" xref="alg7.l8.m1.2.2.1.1.2.cmml">,</mo><mi id="alg7.l8.m1.1.1" xref="alg7.l8.m1.1.1.cmml">D</mi><mo id="alg7.l8.m1.2.2.1.1.1.4" stretchy="false" xref="alg7.l8.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l8.m1.2b"><apply id="alg7.l8.m1.2.2.cmml" xref="alg7.l8.m1.2.2"><ci id="alg7.l8.m1.2.2.2.cmml" xref="alg7.l8.m1.2.2.2">←</ci><apply id="alg7.l8.m1.2.2.3.cmml" xref="alg7.l8.m1.2.2.3"><csymbol cd="ambiguous" id="alg7.l8.m1.2.2.3.1.cmml" xref="alg7.l8.m1.2.2.3">subscript</csymbol><ci id="alg7.l8.m1.2.2.3.2.cmml" xref="alg7.l8.m1.2.2.3.2">𝐷</ci><ci id="alg7.l8.m1.2.2.3.3.cmml" xref="alg7.l8.m1.2.2.3.3">𝑡</ci></apply><apply id="alg7.l8.m1.2.2.1.cmml" xref="alg7.l8.m1.2.2.1"><times id="alg7.l8.m1.2.2.1.2.cmml" xref="alg7.l8.m1.2.2.1.2"></times><ci id="alg7.l8.m1.2.2.1.3.cmml" xref="alg7.l8.m1.2.2.1.3">𝑅</ci><interval closure="open" id="alg7.l8.m1.2.2.1.1.2.cmml" xref="alg7.l8.m1.2.2.1.1.1"><apply id="alg7.l8.m1.2.2.1.1.1.1.cmml" xref="alg7.l8.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l8.m1.2.2.1.1.1.1.1.cmml" xref="alg7.l8.m1.2.2.1.1.1.1">subscript</csymbol><ci id="alg7.l8.m1.2.2.1.1.1.1.2.cmml" xref="alg7.l8.m1.2.2.1.1.1.1.2">𝑞</ci><ci id="alg7.l8.m1.2.2.1.1.1.1.3.cmml" xref="alg7.l8.m1.2.2.1.1.1.1.3">𝑡</ci></apply><ci id="alg7.l8.m1.1.1.cmml" xref="alg7.l8.m1.1.1">𝐷</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l8.m1.2c">D_{t}\leftarrow R(q_{t},D)</annotation><annotation encoding="application/x-llamapun" id="alg7.l8.m1.2d">italic_D start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_R ( italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_D )</annotation></semantics></math> // Retrieve documents based on the new query

</div>
<div class="ltx_listingline" id="alg7.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l9.1.1.1" style="font-size:80%;">9:</span></span>        <math alttext="y_{t}\leftarrow LLM([q_{t},D_{t}])" class="ltx_Math" display="inline" id="alg7.l9.m1.1"><semantics id="alg7.l9.m1.1a"><mrow id="alg7.l9.m1.1.1" xref="alg7.l9.m1.1.1.cmml"><msub id="alg7.l9.m1.1.1.3" xref="alg7.l9.m1.1.1.3.cmml"><mi id="alg7.l9.m1.1.1.3.2" xref="alg7.l9.m1.1.1.3.2.cmml">y</mi><mi id="alg7.l9.m1.1.1.3.3" xref="alg7.l9.m1.1.1.3.3.cmml">t</mi></msub><mo id="alg7.l9.m1.1.1.2" stretchy="false" xref="alg7.l9.m1.1.1.2.cmml">←</mo><mrow id="alg7.l9.m1.1.1.1" xref="alg7.l9.m1.1.1.1.cmml"><mi id="alg7.l9.m1.1.1.1.3" xref="alg7.l9.m1.1.1.1.3.cmml">L</mi><mo id="alg7.l9.m1.1.1.1.2" xref="alg7.l9.m1.1.1.1.2.cmml">⁢</mo><mi id="alg7.l9.m1.1.1.1.4" xref="alg7.l9.m1.1.1.1.4.cmml">L</mi><mo id="alg7.l9.m1.1.1.1.2a" xref="alg7.l9.m1.1.1.1.2.cmml">⁢</mo><mi id="alg7.l9.m1.1.1.1.5" xref="alg7.l9.m1.1.1.1.5.cmml">M</mi><mo id="alg7.l9.m1.1.1.1.2b" xref="alg7.l9.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg7.l9.m1.1.1.1.1.1" xref="alg7.l9.m1.1.1.1.cmml"><mo id="alg7.l9.m1.1.1.1.1.1.2" stretchy="false" xref="alg7.l9.m1.1.1.1.cmml">(</mo><mrow id="alg7.l9.m1.1.1.1.1.1.1.2" xref="alg7.l9.m1.1.1.1.1.1.1.3.cmml"><mo id="alg7.l9.m1.1.1.1.1.1.1.2.3" stretchy="false" xref="alg7.l9.m1.1.1.1.1.1.1.3.cmml">[</mo><msub id="alg7.l9.m1.1.1.1.1.1.1.1.1" xref="alg7.l9.m1.1.1.1.1.1.1.1.1.cmml"><mi id="alg7.l9.m1.1.1.1.1.1.1.1.1.2" xref="alg7.l9.m1.1.1.1.1.1.1.1.1.2.cmml">q</mi><mi id="alg7.l9.m1.1.1.1.1.1.1.1.1.3" xref="alg7.l9.m1.1.1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="alg7.l9.m1.1.1.1.1.1.1.2.4" xref="alg7.l9.m1.1.1.1.1.1.1.3.cmml">,</mo><msub id="alg7.l9.m1.1.1.1.1.1.1.2.2" xref="alg7.l9.m1.1.1.1.1.1.1.2.2.cmml"><mi id="alg7.l9.m1.1.1.1.1.1.1.2.2.2" xref="alg7.l9.m1.1.1.1.1.1.1.2.2.2.cmml">D</mi><mi id="alg7.l9.m1.1.1.1.1.1.1.2.2.3" xref="alg7.l9.m1.1.1.1.1.1.1.2.2.3.cmml">t</mi></msub><mo id="alg7.l9.m1.1.1.1.1.1.1.2.5" stretchy="false" xref="alg7.l9.m1.1.1.1.1.1.1.3.cmml">]</mo></mrow><mo id="alg7.l9.m1.1.1.1.1.1.3" stretchy="false" xref="alg7.l9.m1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l9.m1.1b"><apply id="alg7.l9.m1.1.1.cmml" xref="alg7.l9.m1.1.1"><ci id="alg7.l9.m1.1.1.2.cmml" xref="alg7.l9.m1.1.1.2">←</ci><apply id="alg7.l9.m1.1.1.3.cmml" xref="alg7.l9.m1.1.1.3"><csymbol cd="ambiguous" id="alg7.l9.m1.1.1.3.1.cmml" xref="alg7.l9.m1.1.1.3">subscript</csymbol><ci id="alg7.l9.m1.1.1.3.2.cmml" xref="alg7.l9.m1.1.1.3.2">𝑦</ci><ci id="alg7.l9.m1.1.1.3.3.cmml" xref="alg7.l9.m1.1.1.3.3">𝑡</ci></apply><apply id="alg7.l9.m1.1.1.1.cmml" xref="alg7.l9.m1.1.1.1"><times id="alg7.l9.m1.1.1.1.2.cmml" xref="alg7.l9.m1.1.1.1.2"></times><ci id="alg7.l9.m1.1.1.1.3.cmml" xref="alg7.l9.m1.1.1.1.3">𝐿</ci><ci id="alg7.l9.m1.1.1.1.4.cmml" xref="alg7.l9.m1.1.1.1.4">𝐿</ci><ci id="alg7.l9.m1.1.1.1.5.cmml" xref="alg7.l9.m1.1.1.1.5">𝑀</ci><interval closure="closed" id="alg7.l9.m1.1.1.1.1.1.1.3.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.2"><apply id="alg7.l9.m1.1.1.1.1.1.1.1.1.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l9.m1.1.1.1.1.1.1.1.1.1.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l9.m1.1.1.1.1.1.1.1.1.2.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.1.1.2">𝑞</ci><ci id="alg7.l9.m1.1.1.1.1.1.1.1.1.3.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.1.1.3">𝑡</ci></apply><apply id="alg7.l9.m1.1.1.1.1.1.1.2.2.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="alg7.l9.m1.1.1.1.1.1.1.2.2.1.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="alg7.l9.m1.1.1.1.1.1.1.2.2.2.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.2.2.2">𝐷</ci><ci id="alg7.l9.m1.1.1.1.1.1.1.2.2.3.cmml" xref="alg7.l9.m1.1.1.1.1.1.1.2.2.3">𝑡</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l9.m1.1c">y_{t}\leftarrow LLM([q_{t},D_{t}])</annotation><annotation encoding="application/x-llamapun" id="alg7.l9.m1.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← italic_L italic_L italic_M ( [ italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ] )</annotation></semantics></math> // Generate output using the language model

</div>
<div class="ltx_listingline" id="alg7.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l10.1.1.1" style="font-size:80%;">10:</span></span>     <span class="ltx_text ltx_font_bold" id="alg7.l10.2">else</span>
</div>
<div class="ltx_listingline" id="alg7.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l11.1.1.1" style="font-size:80%;">11:</span></span>        <math alttext="y_{t}\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg7.l11.m1.1"><semantics id="alg7.l11.m1.1a"><mrow id="alg7.l11.m1.1.1" xref="alg7.l11.m1.1.1.cmml"><msub id="alg7.l11.m1.1.1.2" xref="alg7.l11.m1.1.1.2.cmml"><mi id="alg7.l11.m1.1.1.2.2" xref="alg7.l11.m1.1.1.2.2.cmml">y</mi><mi id="alg7.l11.m1.1.1.2.3" xref="alg7.l11.m1.1.1.2.3.cmml">t</mi></msub><mo id="alg7.l11.m1.1.1.1" stretchy="false" xref="alg7.l11.m1.1.1.1.cmml">←</mo><mi id="alg7.l11.m1.1.1.3" mathvariant="normal" xref="alg7.l11.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg7.l11.m1.1b"><apply id="alg7.l11.m1.1.1.cmml" xref="alg7.l11.m1.1.1"><ci id="alg7.l11.m1.1.1.1.cmml" xref="alg7.l11.m1.1.1.1">←</ci><apply id="alg7.l11.m1.1.1.2.cmml" xref="alg7.l11.m1.1.1.2"><csymbol cd="ambiguous" id="alg7.l11.m1.1.1.2.1.cmml" xref="alg7.l11.m1.1.1.2">subscript</csymbol><ci id="alg7.l11.m1.1.1.2.2.cmml" xref="alg7.l11.m1.1.1.2.2">𝑦</ci><ci id="alg7.l11.m1.1.1.2.3.cmml" xref="alg7.l11.m1.1.1.2.3">𝑡</ci></apply><emptyset id="alg7.l11.m1.1.1.3.cmml" xref="alg7.l11.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l11.m1.1c">y_{t}\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg7.l11.m1.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← ∅</annotation></semantics></math> // Set output as empty if query evaluation is false

</div>
<div class="ltx_listingline" id="alg7.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l12.1.1.1" style="font-size:80%;">12:</span></span>     <span class="ltx_text ltx_font_bold" id="alg7.l12.2">end</span> <span class="ltx_text ltx_font_bold" id="alg7.l12.3">if</span>
</div>
<div class="ltx_listingline" id="alg7.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l13.1.1.1" style="font-size:80%;">13:</span></span>     <math alttext="y_{&lt;t}\leftarrow[y_{&lt;t-1},y_{t}]" class="ltx_Math" display="inline" id="alg7.l13.m1.2"><semantics id="alg7.l13.m1.2a"><mrow id="alg7.l13.m1.2.2" xref="alg7.l13.m1.2.2.cmml"><msub id="alg7.l13.m1.2.2.4" xref="alg7.l13.m1.2.2.4.cmml"><mi id="alg7.l13.m1.2.2.4.2" xref="alg7.l13.m1.2.2.4.2.cmml">y</mi><mrow id="alg7.l13.m1.2.2.4.3" xref="alg7.l13.m1.2.2.4.3.cmml"><mi id="alg7.l13.m1.2.2.4.3.2" xref="alg7.l13.m1.2.2.4.3.2.cmml"></mi><mo id="alg7.l13.m1.2.2.4.3.1" xref="alg7.l13.m1.2.2.4.3.1.cmml">&lt;</mo><mi id="alg7.l13.m1.2.2.4.3.3" xref="alg7.l13.m1.2.2.4.3.3.cmml">t</mi></mrow></msub><mo id="alg7.l13.m1.2.2.3" stretchy="false" xref="alg7.l13.m1.2.2.3.cmml">←</mo><mrow id="alg7.l13.m1.2.2.2.2" xref="alg7.l13.m1.2.2.2.3.cmml"><mo id="alg7.l13.m1.2.2.2.2.3" stretchy="false" xref="alg7.l13.m1.2.2.2.3.cmml">[</mo><msub id="alg7.l13.m1.1.1.1.1.1" xref="alg7.l13.m1.1.1.1.1.1.cmml"><mi id="alg7.l13.m1.1.1.1.1.1.2" xref="alg7.l13.m1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg7.l13.m1.1.1.1.1.1.3" xref="alg7.l13.m1.1.1.1.1.1.3.cmml"><mi id="alg7.l13.m1.1.1.1.1.1.3.2" xref="alg7.l13.m1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg7.l13.m1.1.1.1.1.1.3.1" xref="alg7.l13.m1.1.1.1.1.1.3.1.cmml">&lt;</mo><mrow id="alg7.l13.m1.1.1.1.1.1.3.3" xref="alg7.l13.m1.1.1.1.1.1.3.3.cmml"><mi id="alg7.l13.m1.1.1.1.1.1.3.3.2" xref="alg7.l13.m1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="alg7.l13.m1.1.1.1.1.1.3.3.1" xref="alg7.l13.m1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg7.l13.m1.1.1.1.1.1.3.3.3" xref="alg7.l13.m1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg7.l13.m1.2.2.2.2.4" xref="alg7.l13.m1.2.2.2.3.cmml">,</mo><msub id="alg7.l13.m1.2.2.2.2.2" xref="alg7.l13.m1.2.2.2.2.2.cmml"><mi id="alg7.l13.m1.2.2.2.2.2.2" xref="alg7.l13.m1.2.2.2.2.2.2.cmml">y</mi><mi id="alg7.l13.m1.2.2.2.2.2.3" xref="alg7.l13.m1.2.2.2.2.2.3.cmml">t</mi></msub><mo id="alg7.l13.m1.2.2.2.2.5" stretchy="false" xref="alg7.l13.m1.2.2.2.3.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l13.m1.2b"><apply id="alg7.l13.m1.2.2.cmml" xref="alg7.l13.m1.2.2"><ci id="alg7.l13.m1.2.2.3.cmml" xref="alg7.l13.m1.2.2.3">←</ci><apply id="alg7.l13.m1.2.2.4.cmml" xref="alg7.l13.m1.2.2.4"><csymbol cd="ambiguous" id="alg7.l13.m1.2.2.4.1.cmml" xref="alg7.l13.m1.2.2.4">subscript</csymbol><ci id="alg7.l13.m1.2.2.4.2.cmml" xref="alg7.l13.m1.2.2.4.2">𝑦</ci><apply id="alg7.l13.m1.2.2.4.3.cmml" xref="alg7.l13.m1.2.2.4.3"><lt id="alg7.l13.m1.2.2.4.3.1.cmml" xref="alg7.l13.m1.2.2.4.3.1"></lt><csymbol cd="latexml" id="alg7.l13.m1.2.2.4.3.2.cmml" xref="alg7.l13.m1.2.2.4.3.2">absent</csymbol><ci id="alg7.l13.m1.2.2.4.3.3.cmml" xref="alg7.l13.m1.2.2.4.3.3">𝑡</ci></apply></apply><interval closure="closed" id="alg7.l13.m1.2.2.2.3.cmml" xref="alg7.l13.m1.2.2.2.2"><apply id="alg7.l13.m1.1.1.1.1.1.cmml" xref="alg7.l13.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l13.m1.1.1.1.1.1.1.cmml" xref="alg7.l13.m1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l13.m1.1.1.1.1.1.2.cmml" xref="alg7.l13.m1.1.1.1.1.1.2">𝑦</ci><apply id="alg7.l13.m1.1.1.1.1.1.3.cmml" xref="alg7.l13.m1.1.1.1.1.1.3"><lt id="alg7.l13.m1.1.1.1.1.1.3.1.cmml" xref="alg7.l13.m1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="alg7.l13.m1.1.1.1.1.1.3.2.cmml" xref="alg7.l13.m1.1.1.1.1.1.3.2">absent</csymbol><apply id="alg7.l13.m1.1.1.1.1.1.3.3.cmml" xref="alg7.l13.m1.1.1.1.1.1.3.3"><minus id="alg7.l13.m1.1.1.1.1.1.3.3.1.cmml" xref="alg7.l13.m1.1.1.1.1.1.3.3.1"></minus><ci id="alg7.l13.m1.1.1.1.1.1.3.3.2.cmml" xref="alg7.l13.m1.1.1.1.1.1.3.3.2">𝑡</ci><cn id="alg7.l13.m1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg7.l13.m1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="alg7.l13.m1.2.2.2.2.2.cmml" xref="alg7.l13.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg7.l13.m1.2.2.2.2.2.1.cmml" xref="alg7.l13.m1.2.2.2.2.2">subscript</csymbol><ci id="alg7.l13.m1.2.2.2.2.2.2.cmml" xref="alg7.l13.m1.2.2.2.2.2.2">𝑦</ci><ci id="alg7.l13.m1.2.2.2.2.2.3.cmml" xref="alg7.l13.m1.2.2.2.2.2.3">𝑡</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l13.m1.2c">y_{&lt;t}\leftarrow[y_{&lt;t-1},y_{t}]</annotation><annotation encoding="application/x-llamapun" id="alg7.l13.m1.2d">italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ← [ italic_y start_POSTSUBSCRIPT &lt; italic_t - 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ]</annotation></semantics></math> // Update the list of previous outputs

</div>
<div class="ltx_listingline" id="alg7.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l14.1.1.1" style="font-size:80%;">14:</span></span>     <span class="ltx_text ltx_font_bold" id="alg7.l14.2">if</span> <math alttext="\text{isOutputAcceptable}(y_{t},y_{&lt;t},q_{t})=\text{false}" class="ltx_Math" display="inline" id="alg7.l14.m1.3"><semantics id="alg7.l14.m1.3a"><mrow id="alg7.l14.m1.3.3" xref="alg7.l14.m1.3.3.cmml"><mrow id="alg7.l14.m1.3.3.3" xref="alg7.l14.m1.3.3.3.cmml"><mtext id="alg7.l14.m1.3.3.3.5" xref="alg7.l14.m1.3.3.3.5a.cmml">isOutputAcceptable</mtext><mo id="alg7.l14.m1.3.3.3.4" xref="alg7.l14.m1.3.3.3.4.cmml">⁢</mo><mrow id="alg7.l14.m1.3.3.3.3.3" xref="alg7.l14.m1.3.3.3.3.4.cmml"><mo id="alg7.l14.m1.3.3.3.3.3.4" stretchy="false" xref="alg7.l14.m1.3.3.3.3.4.cmml">(</mo><msub id="alg7.l14.m1.1.1.1.1.1.1" xref="alg7.l14.m1.1.1.1.1.1.1.cmml"><mi id="alg7.l14.m1.1.1.1.1.1.1.2" xref="alg7.l14.m1.1.1.1.1.1.1.2.cmml">y</mi><mi id="alg7.l14.m1.1.1.1.1.1.1.3" xref="alg7.l14.m1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="alg7.l14.m1.3.3.3.3.3.5" xref="alg7.l14.m1.3.3.3.3.4.cmml">,</mo><msub id="alg7.l14.m1.2.2.2.2.2.2" xref="alg7.l14.m1.2.2.2.2.2.2.cmml"><mi id="alg7.l14.m1.2.2.2.2.2.2.2" xref="alg7.l14.m1.2.2.2.2.2.2.2.cmml">y</mi><mrow id="alg7.l14.m1.2.2.2.2.2.2.3" xref="alg7.l14.m1.2.2.2.2.2.2.3.cmml"><mi id="alg7.l14.m1.2.2.2.2.2.2.3.2" xref="alg7.l14.m1.2.2.2.2.2.2.3.2.cmml"></mi><mo id="alg7.l14.m1.2.2.2.2.2.2.3.1" xref="alg7.l14.m1.2.2.2.2.2.2.3.1.cmml">&lt;</mo><mi id="alg7.l14.m1.2.2.2.2.2.2.3.3" xref="alg7.l14.m1.2.2.2.2.2.2.3.3.cmml">t</mi></mrow></msub><mo id="alg7.l14.m1.3.3.3.3.3.6" xref="alg7.l14.m1.3.3.3.3.4.cmml">,</mo><msub id="alg7.l14.m1.3.3.3.3.3.3" xref="alg7.l14.m1.3.3.3.3.3.3.cmml"><mi id="alg7.l14.m1.3.3.3.3.3.3.2" xref="alg7.l14.m1.3.3.3.3.3.3.2.cmml">q</mi><mi id="alg7.l14.m1.3.3.3.3.3.3.3" xref="alg7.l14.m1.3.3.3.3.3.3.3.cmml">t</mi></msub><mo id="alg7.l14.m1.3.3.3.3.3.7" stretchy="false" xref="alg7.l14.m1.3.3.3.3.4.cmml">)</mo></mrow></mrow><mo id="alg7.l14.m1.3.3.4" xref="alg7.l14.m1.3.3.4.cmml">=</mo><mtext id="alg7.l14.m1.3.3.5" xref="alg7.l14.m1.3.3.5a.cmml">false</mtext></mrow><annotation-xml encoding="MathML-Content" id="alg7.l14.m1.3b"><apply id="alg7.l14.m1.3.3.cmml" xref="alg7.l14.m1.3.3"><eq id="alg7.l14.m1.3.3.4.cmml" xref="alg7.l14.m1.3.3.4"></eq><apply id="alg7.l14.m1.3.3.3.cmml" xref="alg7.l14.m1.3.3.3"><times id="alg7.l14.m1.3.3.3.4.cmml" xref="alg7.l14.m1.3.3.3.4"></times><ci id="alg7.l14.m1.3.3.3.5a.cmml" xref="alg7.l14.m1.3.3.3.5"><mtext id="alg7.l14.m1.3.3.3.5.cmml" xref="alg7.l14.m1.3.3.3.5">isOutputAcceptable</mtext></ci><vector id="alg7.l14.m1.3.3.3.3.4.cmml" xref="alg7.l14.m1.3.3.3.3.3"><apply id="alg7.l14.m1.1.1.1.1.1.1.cmml" xref="alg7.l14.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l14.m1.1.1.1.1.1.1.1.cmml" xref="alg7.l14.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l14.m1.1.1.1.1.1.1.2.cmml" xref="alg7.l14.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="alg7.l14.m1.1.1.1.1.1.1.3.cmml" xref="alg7.l14.m1.1.1.1.1.1.1.3">𝑡</ci></apply><apply id="alg7.l14.m1.2.2.2.2.2.2.cmml" xref="alg7.l14.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg7.l14.m1.2.2.2.2.2.2.1.cmml" xref="alg7.l14.m1.2.2.2.2.2.2">subscript</csymbol><ci id="alg7.l14.m1.2.2.2.2.2.2.2.cmml" xref="alg7.l14.m1.2.2.2.2.2.2.2">𝑦</ci><apply id="alg7.l14.m1.2.2.2.2.2.2.3.cmml" xref="alg7.l14.m1.2.2.2.2.2.2.3"><lt id="alg7.l14.m1.2.2.2.2.2.2.3.1.cmml" xref="alg7.l14.m1.2.2.2.2.2.2.3.1"></lt><csymbol cd="latexml" id="alg7.l14.m1.2.2.2.2.2.2.3.2.cmml" xref="alg7.l14.m1.2.2.2.2.2.2.3.2">absent</csymbol><ci id="alg7.l14.m1.2.2.2.2.2.2.3.3.cmml" xref="alg7.l14.m1.2.2.2.2.2.2.3.3">𝑡</ci></apply></apply><apply id="alg7.l14.m1.3.3.3.3.3.3.cmml" xref="alg7.l14.m1.3.3.3.3.3.3"><csymbol cd="ambiguous" id="alg7.l14.m1.3.3.3.3.3.3.1.cmml" xref="alg7.l14.m1.3.3.3.3.3.3">subscript</csymbol><ci id="alg7.l14.m1.3.3.3.3.3.3.2.cmml" xref="alg7.l14.m1.3.3.3.3.3.3.2">𝑞</ci><ci id="alg7.l14.m1.3.3.3.3.3.3.3.cmml" xref="alg7.l14.m1.3.3.3.3.3.3.3">𝑡</ci></apply></vector></apply><ci id="alg7.l14.m1.3.3.5a.cmml" xref="alg7.l14.m1.3.3.5"><mtext id="alg7.l14.m1.3.3.5.cmml" xref="alg7.l14.m1.3.3.5">false</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l14.m1.3c">\text{isOutputAcceptable}(y_{t},y_{&lt;t},q_{t})=\text{false}</annotation><annotation encoding="application/x-llamapun" id="alg7.l14.m1.3d">isOutputAcceptable ( italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT , italic_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) = false</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg7.l14.3">then</span>
</div>
<div class="ltx_listingline" id="alg7.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l15.1.1.1" style="font-size:80%;">15:</span></span>        break // Break if the output is not acceptable

</div>
<div class="ltx_listingline" id="alg7.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l16.1.1.1" style="font-size:80%;">16:</span></span>     <span class="ltx_text ltx_font_bold" id="alg7.l16.2">end</span> <span class="ltx_text ltx_font_bold" id="alg7.l16.3">if</span>
</div>
<div class="ltx_listingline" id="alg7.l17">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l17.1.1.1" style="font-size:80%;">17:</span></span>     <math alttext="t\leftarrow t+1" class="ltx_Math" display="inline" id="alg7.l17.m1.1"><semantics id="alg7.l17.m1.1a"><mrow id="alg7.l17.m1.1.1" xref="alg7.l17.m1.1.1.cmml"><mi id="alg7.l17.m1.1.1.2" xref="alg7.l17.m1.1.1.2.cmml">t</mi><mo id="alg7.l17.m1.1.1.1" stretchy="false" xref="alg7.l17.m1.1.1.1.cmml">←</mo><mrow id="alg7.l17.m1.1.1.3" xref="alg7.l17.m1.1.1.3.cmml"><mi id="alg7.l17.m1.1.1.3.2" xref="alg7.l17.m1.1.1.3.2.cmml">t</mi><mo id="alg7.l17.m1.1.1.3.1" xref="alg7.l17.m1.1.1.3.1.cmml">+</mo><mn id="alg7.l17.m1.1.1.3.3" xref="alg7.l17.m1.1.1.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l17.m1.1b"><apply id="alg7.l17.m1.1.1.cmml" xref="alg7.l17.m1.1.1"><ci id="alg7.l17.m1.1.1.1.cmml" xref="alg7.l17.m1.1.1.1">←</ci><ci id="alg7.l17.m1.1.1.2.cmml" xref="alg7.l17.m1.1.1.2">𝑡</ci><apply id="alg7.l17.m1.1.1.3.cmml" xref="alg7.l17.m1.1.1.3"><plus id="alg7.l17.m1.1.1.3.1.cmml" xref="alg7.l17.m1.1.1.3.1"></plus><ci id="alg7.l17.m1.1.1.3.2.cmml" xref="alg7.l17.m1.1.1.3.2">𝑡</ci><cn id="alg7.l17.m1.1.1.3.3.cmml" type="integer" xref="alg7.l17.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l17.m1.1c">t\leftarrow t+1</annotation><annotation encoding="application/x-llamapun" id="alg7.l17.m1.1d">italic_t ← italic_t + 1</annotation></semantics></math> // Increment iteration step

</div>
<div class="ltx_listingline" id="alg7.l18">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l18.1.1.1" style="font-size:80%;">18:</span></span>  <span class="ltx_text ltx_font_bold" id="alg7.l18.2">end</span> <span class="ltx_text ltx_font_bold" id="alg7.l18.3">while</span>
</div>
<div class="ltx_listingline" id="alg7.l19">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l19.1.1.1" style="font-size:80%;">19:</span></span>  <math alttext="\hat{y}=\text{synthesizeOutput}(y_{\leq t})" class="ltx_Math" display="inline" id="alg7.l19.m1.1"><semantics id="alg7.l19.m1.1a"><mrow id="alg7.l19.m1.1.1" xref="alg7.l19.m1.1.1.cmml"><mover accent="true" id="alg7.l19.m1.1.1.3" xref="alg7.l19.m1.1.1.3.cmml"><mi id="alg7.l19.m1.1.1.3.2" xref="alg7.l19.m1.1.1.3.2.cmml">y</mi><mo id="alg7.l19.m1.1.1.3.1" xref="alg7.l19.m1.1.1.3.1.cmml">^</mo></mover><mo id="alg7.l19.m1.1.1.2" xref="alg7.l19.m1.1.1.2.cmml">=</mo><mrow id="alg7.l19.m1.1.1.1" xref="alg7.l19.m1.1.1.1.cmml"><mtext id="alg7.l19.m1.1.1.1.3" xref="alg7.l19.m1.1.1.1.3a.cmml">synthesizeOutput</mtext><mo id="alg7.l19.m1.1.1.1.2" xref="alg7.l19.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg7.l19.m1.1.1.1.1.1" xref="alg7.l19.m1.1.1.1.1.1.1.cmml"><mo id="alg7.l19.m1.1.1.1.1.1.2" stretchy="false" xref="alg7.l19.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg7.l19.m1.1.1.1.1.1.1" xref="alg7.l19.m1.1.1.1.1.1.1.cmml"><mi id="alg7.l19.m1.1.1.1.1.1.1.2" xref="alg7.l19.m1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="alg7.l19.m1.1.1.1.1.1.1.3" xref="alg7.l19.m1.1.1.1.1.1.1.3.cmml"><mi id="alg7.l19.m1.1.1.1.1.1.1.3.2" xref="alg7.l19.m1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="alg7.l19.m1.1.1.1.1.1.1.3.1" xref="alg7.l19.m1.1.1.1.1.1.1.3.1.cmml">≤</mo><mi id="alg7.l19.m1.1.1.1.1.1.1.3.3" xref="alg7.l19.m1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub><mo id="alg7.l19.m1.1.1.1.1.1.3" stretchy="false" xref="alg7.l19.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg7.l19.m1.1b"><apply id="alg7.l19.m1.1.1.cmml" xref="alg7.l19.m1.1.1"><eq id="alg7.l19.m1.1.1.2.cmml" xref="alg7.l19.m1.1.1.2"></eq><apply id="alg7.l19.m1.1.1.3.cmml" xref="alg7.l19.m1.1.1.3"><ci id="alg7.l19.m1.1.1.3.1.cmml" xref="alg7.l19.m1.1.1.3.1">^</ci><ci id="alg7.l19.m1.1.1.3.2.cmml" xref="alg7.l19.m1.1.1.3.2">𝑦</ci></apply><apply id="alg7.l19.m1.1.1.1.cmml" xref="alg7.l19.m1.1.1.1"><times id="alg7.l19.m1.1.1.1.2.cmml" xref="alg7.l19.m1.1.1.1.2"></times><ci id="alg7.l19.m1.1.1.1.3a.cmml" xref="alg7.l19.m1.1.1.1.3"><mtext id="alg7.l19.m1.1.1.1.3.cmml" xref="alg7.l19.m1.1.1.1.3">synthesizeOutput</mtext></ci><apply id="alg7.l19.m1.1.1.1.1.1.1.cmml" xref="alg7.l19.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg7.l19.m1.1.1.1.1.1.1.1.cmml" xref="alg7.l19.m1.1.1.1.1.1">subscript</csymbol><ci id="alg7.l19.m1.1.1.1.1.1.1.2.cmml" xref="alg7.l19.m1.1.1.1.1.1.1.2">𝑦</ci><apply id="alg7.l19.m1.1.1.1.1.1.1.3.cmml" xref="alg7.l19.m1.1.1.1.1.1.1.3"><leq id="alg7.l19.m1.1.1.1.1.1.1.3.1.cmml" xref="alg7.l19.m1.1.1.1.1.1.1.3.1"></leq><csymbol cd="latexml" id="alg7.l19.m1.1.1.1.1.1.1.3.2.cmml" xref="alg7.l19.m1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="alg7.l19.m1.1.1.1.1.1.1.3.3.cmml" xref="alg7.l19.m1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l19.m1.1c">\hat{y}=\text{synthesizeOutput}(y_{\leq t})</annotation><annotation encoding="application/x-llamapun" id="alg7.l19.m1.1d">over^ start_ARG italic_y end_ARG = synthesizeOutput ( italic_y start_POSTSUBSCRIPT ≤ italic_t end_POSTSUBSCRIPT )</annotation></semantics></math> // Synthesize final output from the list of outputs

</div>
<div class="ltx_listingline" id="alg7.l20">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg7.l20.1.1.1" style="font-size:80%;">20:</span></span>  <span class="ltx_text ltx_font_bold" id="alg7.l20.2">return</span>  <math alttext="\hat{y}" class="ltx_Math" display="inline" id="alg7.l20.m1.1"><semantics id="alg7.l20.m1.1a"><mover accent="true" id="alg7.l20.m1.1.1" xref="alg7.l20.m1.1.1.cmml"><mi id="alg7.l20.m1.1.1.2" xref="alg7.l20.m1.1.1.2.cmml">y</mi><mo id="alg7.l20.m1.1.1.1" xref="alg7.l20.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="alg7.l20.m1.1b"><apply id="alg7.l20.m1.1.1.cmml" xref="alg7.l20.m1.1.1"><ci id="alg7.l20.m1.1.1.1.cmml" xref="alg7.l20.m1.1.1.1">^</ci><ci id="alg7.l20.m1.1.1.2.cmml" xref="alg7.l20.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg7.l20.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="alg7.l20.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S5.SS4.p7">
<p class="ltx_p" id="S5.SS4.p7.1"><span class="ltx_text ltx_font_bold" id="S5.SS4.p7.1.1">Prompt-base.</span> The prompt-base approach involves controlling the flow using Prompt Engineering to direct LLM. A typical implementation example is FLARE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib14" title="">14</a>]</cite>. Its core concept is that LLMs should only retrieve when essential knowledge is lacking, to avoid unnecessary or inappropriate retrieval in an enhanced LM. FLARE iteratively generates the next provisional sentence and checks for the presence of low-probability tokens. If found, the system retrieves relevant documents and regenerates the sentence.</p>
</div>
<figure class="ltx_figure" id="S5.F13"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="153" id="S5.F13.g1" src="extracted/5756188/images/Flare.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 13: </span>RAG flow of FLARE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib14" title="">14</a>]</cite>. The generated provisional answer will undergo confidence assessment. If it does not meet the required confidence level, the process will return to the retrieval stage and generate anew. The assessment criteria are implemented through prompt </figcaption>
</figure>
<div class="ltx_para" id="S5.SS4.p8">
<p class="ltx_p" id="S5.SS4.p8.1"><span class="ltx_text ltx_font_bold" id="S5.SS4.p8.1.1">Tuning-base. </span>The tuning-based approach involves fine-tuning LLM to generate special tokens, thereby triggering retrieval or generation. This concept can be traced back to Toolformer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib50" title="">50</a>]</cite>, where the generation of specific content assists in invoking tools. In RAG systems, this approach is used to control both retrieval and generation steps. A typical case is Self-RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib28" title="">28</a>]</cite>(see Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F14" title="Figure 14 ‣ V-D Loop Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">14</span></a>). Given an input prompt and the preceding generation result, first predict whether the special token <span class="ltx_text ltx_font_italic" id="S5.SS4.p8.1.2">Retrieve</span> is helpful for enhancing the continued generation through retrieval. Then, if retrieval is needed, the model generates a <span class="ltx_text ltx_font_italic" id="S5.SS4.p8.1.3">critique</span> token to evaluate the retrieved passage’s relevance. and a <span class="ltx_text ltx_font_italic" id="S5.SS4.p8.1.4">critique</span> token to evaluate if the information in the response is supported by the retrieved passage. Finally, a <span class="ltx_text ltx_font_italic" id="S5.SS4.p8.1.5">critique</span> token evaluates the overall utility of the response and selects the optimal result as the final output.</p>
</div>
<figure class="ltx_figure" id="S5.F14"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="279" id="S5.F14.g1" src="extracted/5756188/images/Self-RAG.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 14: </span>RAG flow of SELF-RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib28" title="">28</a>]</cite>. First, it prompt GPT-4 to obtain a suitable instruct fine-tuning dataset to fine-tune the deployed open-source LLM. This allows the model to output four specific tokens during generation, which are used to control the RAG process.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S5.SS5.5.1.1">V-E</span> </span><span class="ltx_text ltx_font_italic" id="S5.SS5.6.2">Tuning Pattern</span>
</h3>
<div class="ltx_para" id="S5.SS5.p1">
<p class="ltx_p" id="S5.SS5.p1.1">RAG is continuously integrating with more LLM-related technologies. In Modular RAG, many components are composed of trainable language models. Through fine-tuning, the performance of the components and the compatibility with the overall flow can be further optimized. This section will introduce three main patterns of fine-tuning stages, namely retriever fine-tuning, generator fine-tuning, and dual fine-tuning.</p>
</div>
<section class="ltx_subsubsection" id="S5.SS5.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S5.SS5.SSS1.5.1.1">V-E</span>1 </span>Retriever FT</h4>
<div class="ltx_para" id="S5.SS5.SSS1.p1">
<p class="ltx_p" id="S5.SS5.SSS1.p1.1">In the RAG flow, common methods for fine-tuning the retriever is shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F15" title="Figure 15 ‣ V-E1 Retriever FT ‣ V-E Tuning Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">15</span></a> ,which include:</p>
<ul class="ltx_itemize" id="S5.I1">
<li class="ltx_item" id="S5.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I1.i1.p1">
<p class="ltx_p" id="S5.I1.i1.p1.1">Direct supervised fine-tuning of the retriever. Constructing a specialized dataset for retrieval and fine-tuning the dense retriever. For example, using open-source retrieval datasets or constructing one based on domain-specific data.</p>
</div>
</li>
<li class="ltx_item" id="S5.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I1.i2.p1">
<p class="ltx_p" id="S5.I1.i2.p1.1">Adding trainable adapter modules. Sometimes, direct fine-tuning of the API-base embedding model (e.g., OpenAI Ada-002 and Cohere) is not feasible. Incorporating an adapter module can enhance the representation of your data. Additionally, the adapter module facilitates better alignment with downstream tasks, whether for task-specific (e.g., PRCA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib42" title="">42</a>]</cite>) or general purposes (e.g., AAR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib58" title="">58</a>]</cite>).</p>
</div>
</li>
<li class="ltx_item" id="S5.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I1.i3.p1">
<p class="ltx_p" id="S5.I1.i3.p1.1">LM-supervised Retrieval (LSR). Fine-tuning the retriever based on the results generated by LLM.</p>
</div>
</li>
<li class="ltx_item" id="S5.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I1.i4.p1">
<p class="ltx_p" id="S5.I1.i4.p1.1">LLM Reward RL. Still using the LLM output results as the supervisory signal. Employing reinforcement learning to align the retriever with the generator. The whole retrieval process is disassembled in the form of a generative Markov chain.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_figure" id="S5.F15"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="234" id="S5.F15.g1" src="extracted/5756188/images/RetriverFT-521.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 15: </span>Retriever fine-tuning pattern, mainly includes direct SFT, adding trainable adapter, LM-supervised retrieval and LLM Reward RL.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S5.SS5.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S5.SS5.SSS2.5.1.1">V-E</span>2 </span>Generator FT</h4>
<div class="ltx_para" id="S5.SS5.SSS2.p1">
<p class="ltx_p" id="S5.SS5.SSS2.p1.1">The primary methods for fine-tuning a generator in RAG flow is shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#S5.F16" title="Figure 16 ‣ V-E2 Generator FT ‣ V-E Tuning Pattern ‣ V RAG Flow and Flow Pattern ‣ Modular RAG: Transforming RAG Systems into LEGO-like Reconfigurable Frameworks"><span class="ltx_text ltx_ref_tag">16</span></a>, which include:</p>
<ul class="ltx_itemize" id="S5.I2">
<li class="ltx_item" id="S5.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I2.i1.p1">
<p class="ltx_p" id="S5.I2.i1.p1.1">Direct supervised fine-tuning<span class="ltx_text ltx_font_bold" id="S5.I2.i1.p1.1.1">.</span> Fine-tuning through an external dataset can supplement the generator with additional knowledge. Another benefit is the ability to customize input and output formats. By setting the Q&amp;A format, LLM can understand specific data formats and output according to instructions.</p>
</div>
</li>
<li class="ltx_item" id="S5.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I2.i2.p1">
<p class="ltx_p" id="S5.I2.i2.p1.1">Distillation<span class="ltx_text ltx_font_bold" id="S5.I2.i2.p1.1.1">.</span> When using on-premise deployment of open-source models, a simple and effective Optimization method is to use GPT-4 to batch construct fine-tuning data to enhance the capabilities of the open-source model.</p>
</div>
</li>
<li class="ltx_item" id="S5.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S5.I2.i3.p1">
<p class="ltx_p" id="S5.I2.i3.p1.1">RL from LLM/human feedback. Reinforcement learning based on feedback from the final generated answers. In addition to using human evaluations, powerful LLMs can also serve as an evaluative judge.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_figure" id="S5.F16"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="210" id="S5.F16.g1" src="extracted/5756188/images/GeneratorFT.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 16: </span>Generator fine-tuning pattern, The main methods include SFT, distillation and RL from LLM/human feedback.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S5.SS5.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S5.SS5.SSS3.5.1.1">V-E</span>3 </span>Dual FT</h4>
<div class="ltx_para" id="S5.SS5.SSS3.p1">
<p class="ltx_p" id="S5.SS5.SSS3.p1.1">In the RAG system, fine-tuning both the retriever and the generator simultaneously is a unique feature of the RAG system. It is important to note that the emphasis of system fine-tuning is on the coordination between the retriever and the generator. An exemplary implementation is RA-DIT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib27" title="">27</a>]</cite>, which fine-tunes both the LLM and the retriever. The LM-ft component updates the LLM to maximize the likelihood of the correct answer given the retrieval-augmented instructions while the R-ft component updates the retriever to minimize the KL-Divergence between the retriever score distribution and the LLM preference.</p>
</div>
<figure class="ltx_figure" id="S5.F17"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="122" id="S5.F17.g1" src="extracted/5756188/images/DualFT.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 17: </span>Dual fine-tuning pattern. In this mode, both the retriever and generator participate in fine-tuning, and their preferences will be aligned.</figcaption>
</figure>
</section>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">VI </span><span class="ltx_text ltx_font_smallcaps" id="S6.1.1">Discussion</span>
</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">In this chapter, we explore the innovative horizons opened by the modular RAG paradigm. We examine its compatibility with cutting-edge methodologies in the progression of RAG technology, emphasizing its scalability. It not only fosters a fertile ground for model innovation but also paves the way for seamless adaptation to the dynamic requirements of various applications.</p>
</div>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S6.SS1.5.1.1">VI-A</span> </span><span class="ltx_text ltx_font_italic" id="S6.SS1.6.2">Opportunities in Modular RAG</span>
</h3>
<div class="ltx_para" id="S6.SS1.p1">
<p class="ltx_p" id="S6.SS1.p1.1">The benefits of Modular RAG are evident, providing a fresh and comprehensive perspective on existing RAG-related work. Through modular organization, relevant technologies and methods are clearly summarized.</p>
</div>
<div class="ltx_para" id="S6.SS1.p2">
<p class="ltx_p" id="S6.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S6.SS1.p2.1.1">From a research perspective.</span> Modular RAG is highly scalable, it empowers researchers to introduce innovative modules and operators, leveraging a deep understanding of RAG’s evolving landscape. This flexibility enables the exploration of new theoretical and practical dimensions in the field.</p>
</div>
<div class="ltx_para" id="S6.SS1.p3">
<p class="ltx_p" id="S6.SS1.p3.1"><span class="ltx_text ltx_font_bold" id="S6.SS1.p3.1.1">From an application perspective</span>. The modularity of RAG systems simplifies their design and implementation. Users can tailor RAG flows to fit their specific data, use cases, and downstream tasks, enhancing the adaptability of the system to diverse requirements. Developers can draw from existing flow architectures and innovate by defining new flows and patterns that are tailored to various application contexts and domains. This approach not only streamlines the development process but also enriches the functionality and versatility of RAG applications.</p>
</div>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection"><span class="ltx_text" id="S6.SS2.5.1.1">VI-B</span> </span><span class="ltx_text ltx_font_italic" id="S6.SS2.6.2">Compatibility with new methods</span>
</h3>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.1">Modular RAG paradigm demonstrates exceptional compatibility with new developments. To gain a deeper understanding of this, we list three typical scalability cases, which clearly shows that Modular RAG paradigm provides robust support and flexibility for the innovation and development of RAG technology.</p>
</div>
<section class="ltx_subsubsection" id="S6.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S6.SS2.SSS1.5.1.1">VI-B</span>1 </span>Recombination of the current modules</h4>
<div class="ltx_para" id="S6.SS2.SSS1.p1">
<p class="ltx_p" id="S6.SS2.SSS1.p1.1">In this scenario, no new modules or operators are proposed; rather, specific problems are addressed through the combination of existing modules.DR-RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib59" title="">59</a>]</cite> employs a two-stage retrieval strategy and classifier selection mechanism, incorporating a branching retrieval structure. In the first stage, retrieving chunks relevant to the query. In the second stage, the query is combined individually with each chunk retrieved in the first stage, and a parallel secondary retrieval is conducted. The retrieved content is then input into a classifier to filter out the most relevant dynamic documents. This ensures that the retrieved documents are highly relevant to the query while reducing redundant information. DR-RAG improved retrieval method significantly enhances the accuracy and efficiency of answers, bolstering RAG’s performance in multi-hop question-answering scenarios.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S6.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S6.SS2.SSS2.5.1.1">VI-B</span>2 </span>New flow without adding new operators.</h4>
<div class="ltx_para" id="S6.SS2.SSS2.p1">
<p class="ltx_p" id="S6.SS2.SSS2.p1.1">This refers to redesigning the processes for retrieval and generation to address more complex scenarios without proposing new modules. The core idea of PlanRAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib18" title="">18</a>]</cite> lies in its introduction of a preliminary planning stage, a crucial step that occurs before retrieval and generation. Initially, the system employs a judge module to assess whether the current context necessitates the formulation of a new plan or adjustments to an existing one. When encountering a problem for the first time, the system initiates the planning process, while in subsequent interactions, it decides whether to execute re-planning based on previous plans and retrieved data.</p>
</div>
<div class="ltx_para" id="S6.SS2.SSS2.p2">
<p class="ltx_p" id="S6.SS2.SSS2.p2.1">Next, the system devises an execution plan tailored to the query, treating this process as a logical decomposition of complex queries. Specifically, PlanRAG uses a query expansion module to extend and refine the query. For each derived sub-query, the system conducts targeted retrieval. Following retrieval, another judge module evaluates the current results to decide whether further retrieval is required or if it should return to the planning stage for re-planning. Through this strategy, PlanRAG is able to handle complex decision-making problems that require multi-step data analysis more efficiently.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S6.SS2.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection"><span class="ltx_text" id="S6.SS2.SSS3.5.1.1">VI-B</span>3 </span>New flow derived from new operators.</h4>
<div class="ltx_para" id="S6.SS2.SSS3.p1">
<p class="ltx_p" id="S6.SS2.SSS3.p1.1">New operators often introduce novel flow design, exemplified by Multi-Head RAG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2407.21059v1#bib.bib60" title="">60</a>]</cite>. Existing RAG solutions do not focus on queries that may require retrieving multiple documents with significantly different content. Such queries are common but difficult to handle because embeddings of these documents may be far apart in the embedding space. Multi-Head RAG  addresses this by designing a new retriever that uses the activations of the multi-head attention layers of the Transformer, rather than the decoder layers, as keys for retrieving multifaceted documents. Different attention heads can learn to capture different aspects of the data. By using the corresponding activation results, embeddings that represent different aspects of the data items and the query can be generated, thereby enhancing the retrieval accuracy for complex queries.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">VII </span><span class="ltx_text ltx_font_smallcaps" id="S7.1.1">Conclusion</span>
</h2>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">RAG is emerging as a pivotal technology for LLM applications. As technological landscapes evolve and the intricacies of application requirements escalate, RAG systems are being enhanced by integrating a diverse suite of technologies, thereby achieving a higher level of complexity and functionality. This paper introduces the innovative paradigm of Modular RAG. This approach systematically disassembles the complex architecture of RAG systems into well-defined, discrete functional modules. Each module is meticulously characterized by its specific operational functions, ensuring clarity and precision. Therefore, the entire system is composed of those modules and operators, akin to Lego bricks. By conducting an in-depth analysis of numerous studies, the paper also distills common RAG design patterns and scrutinizes key case studies to illustrate these patterns in practice.</p>
</div>
<div class="ltx_para" id="S7.p2">
<p class="ltx_p" id="S7.p2.1">Modular RAG not only offers a structured framework for the design and application of RAG systems but also enables a scenario-based customization of these systems. The modularity inherent in this design facilitates ease of tracking and debugging, significantly enhancing the maintainability and scalability of RAG systems. Furthermore, Modular RAG opens up new avenues for the future progression of RAG technology. It encourages the innovation of novel functional modules and the crafting of innovative workflows, thereby driving forward the frontiers of RAG systems.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_tag_bibitem">[1]</span>
<span class="ltx_bibblock">
Y. Zhang, Y. Li, L. Cui, D. Cai, L. Liu, T. Fu, X. Huang, E. Zhao, Y. Zhang, Y. Chen <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">et al.</em>, “Siren’s song in the ai ocean: A survey on hallucination in large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib1.2.2">arXiv preprint arXiv:2309.01219</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_tag_bibitem">[2]</span>
<span class="ltx_bibblock">
Y. Gao, Y. Xiong, X. Gao, K. Jia, J. Pan, Y. Bi, Y. Dai, J. Sun, and H. Wang, “Retrieval-augmented generation for large language models: A survey,” <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">arXiv preprint arXiv:2312.10997</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_tag_bibitem">[3]</span>
<span class="ltx_bibblock">
Z. Xu, M. J. Cruz, M. Guevara, T. Wang, M. Deshpande, X. Wang, and Z. Li, “Retrieval-augmented generation with knowledge graphs for customer service question answering,” in <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Proceedings of the 47th International ACM SIGIR Conference on Research and Development in Information Retrieval</em>, 2024, pp. 2905–2909.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_tag_bibitem">[4]</span>
<span class="ltx_bibblock">
C. Zhang, S. Wu, H. Zhang, T. Xu, Y. Gao, Y. Hu, and E. Chen, “Notellm: A retrievable large language model for note recommendation,” in <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Companion Proceedings of the ACM on Web Conference 2024</em>, 2024, pp. 170–179.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_tag_bibitem">[5]</span>
<span class="ltx_bibblock">
R. Anantha, T. Bethi, D. Vodianik, and S. Chappidi, “Context tuning for retrieval augmented generation,” <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">arXiv preprint arXiv:2312.05708</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_tag_bibitem">[6]</span>
<span class="ltx_bibblock">
Y. Gao, T. Sheng, Y. Xiang, Y. Xiong, H. Wang, and J. Zhang, “Chat-rec: Towards interactive and explainable llms-augmented recommender system,” <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">arXiv preprint arXiv:2303.14524</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_tag_bibitem">[7]</span>
<span class="ltx_bibblock">
J. Liu, “Building production-ready rag applications,” <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.ai.engineer/summit/schedule/building-production-ready-rag-applications" title="">https://www.ai.engineer/summit/schedule/building-production-ready-rag-applications</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_tag_bibitem">[8]</span>
<span class="ltx_bibblock">
D. S. Asudani, N. K. Nagwani, and P. Singh, “Impact of word embedding models on text analytics in deep learning environment: a review,” <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">Artificial intelligence review</em>, vol. 56, no. 9, pp. 10 345–10 425, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_tag_bibitem">[9]</span>
<span class="ltx_bibblock">
F. Cuconasu, G. Trappolini, F. Siciliano, S. Filice, C. Campagnano, Y. Maarek, N. Tonellotto, and F. Silvestri, “The power of noise: Redefining retrieval for rag systems,” <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:2401.14887</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_tag_bibitem">[10]</span>
<span class="ltx_bibblock">
W. Peng, G. Li, Y. Jiang, Z. Wang, D. Ou, X. Zeng, E. Chen <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">et al.</em>, “Large language model based long-tail query rewriting in taobao search,” <em class="ltx_emph ltx_font_italic" id="bib.bib10.2.2">arXiv preprint arXiv:2311.03758</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_tag_bibitem">[11]</span>
<span class="ltx_bibblock">
Y. Xi, J. Lin, W. Liu, X. Dai, W. Zhang, R. Zhang, R. Tang, and Y. Yu, “A bird’s-eye view of reranking: from list level to page level,” in <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Proceedings of the Sixteenth ACM International Conference on Web Search and Data Mining</em>, 2023, pp. 1075–1083.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_tag_bibitem">[12]</span>
<span class="ltx_bibblock">
Z. Feng, X. Feng, D. Zhao, M. Yang, and B. Qin, “Retrieval-generation synergy augmented large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">arXiv preprint arXiv:2310.05149</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_tag_bibitem">[13]</span>
<span class="ltx_bibblock">
G. Kim, S. Kim, B. Jeon, J. Park, and J. Kang, “Tree of clarifications: Answering ambiguous questions with retrieval-augmented large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">arXiv preprint arXiv:2310.14696</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_tag_bibitem">[14]</span>
<span class="ltx_bibblock">
Z. Jiang, F. F. Xu, L. Gao, Z. Sun, Q. Liu, J. Dwivedi-Yu, Y. Yang, J. Callan, and G. Neubig, “Active retrieval augmented generation,” <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2305.06983</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_tag_bibitem">[15]</span>
<span class="ltx_bibblock">
D. Edge, H. Trinh, N. Cheng, J. Bradley, A. Chao, A. Mody, S. Truitt, and J. Larson, “From local to global: A graph rag approach to query-focused summarization,” <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">arXiv preprint arXiv:2404.16130</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_tag_bibitem">[16]</span>
<span class="ltx_bibblock">
Q. Leng, K. Uhlenhuth, and A. Polyzotis, “Best practices for llm evaluation of rag applications,” <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.databricks.com/blog/LLM-auto-eval-best-practices-RAG" title="">https://www.databricks.com/blog/LLM-auto-eval-best-practices-RAG</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_tag_bibitem">[17]</span>
<span class="ltx_bibblock">
X. Wang, Z. Wang, X. Gao, F. Zhang, Y. Wu, Z. Xu, T. Shi, Z. Wang, S. Li, Q. Qian <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">et al.</em>, “Searching for best practices in retrieval-augmented generation,” <em class="ltx_emph ltx_font_italic" id="bib.bib17.2.2">arXiv preprint arXiv:2407.01219</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_tag_bibitem">[18]</span>
<span class="ltx_bibblock">
M. Lee, S. An, and M.-S. Kim, “Planrag: A plan-then-retrieval augmented generation for generative large language models as decision makers,” <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">arXiv preprint arXiv:2406.12430</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_tag_bibitem">[19]</span>
<span class="ltx_bibblock">
D. Arora, A. Kini, S. R. Chowdhury, N. Natarajan, G. Sinha, and A. Sharma, “Gar-meets-rag paradigm for zero-shot information retrieval,” <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">arXiv preprint arXiv:2310.20158</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_tag_bibitem">[20]</span>
<span class="ltx_bibblock">
P. Lewis, E. Perez, A. Piktus, F. Petroni, V. Karpukhin, N. Goyal, H. Küttler, M. Lewis, W.-t. Yih, T. Rocktäschel <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">et al.</em>, “Retrieval-augmented generation for knowledge-intensive nlp tasks,” <em class="ltx_emph ltx_font_italic" id="bib.bib20.2.2">Advances in Neural Information Processing Systems</em>, vol. 33, pp. 9459–9474, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_tag_bibitem">[21]</span>
<span class="ltx_bibblock">
S. Borgeaud, A. Mensch, J. Hoffmann, T. Cai, E. Rutherford, K. Millican, G. B. Van Den Driessche, J.-B. Lespiau, B. Damoc, A. Clark <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">et al.</em>, “Improving language models by retrieving from trillions of tokens,” in <em class="ltx_emph ltx_font_italic" id="bib.bib21.2.2">International conference on machine learning</em>.   PMLR, 2022, pp. 2206–2240.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_tag_bibitem">[22]</span>
<span class="ltx_bibblock">
G. Izacard, P. Lewis, M. Lomeli, L. Hosseini, F. Petroni, T. Schick, J. Dwivedi-Yu, A. Joulin, S. Riedel, and E. Grave, “Few-shot learning with retrieval augmented language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2208.03299</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_tag_bibitem">[23]</span>
<span class="ltx_bibblock">
H. Trivedi, N. Balasubramanian, T. Khot, and A. Sabharwal, “Interleaving retrieval with chain-of-thought reasoning for knowledge-intensive multi-step questions,” <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint arXiv:2212.10509</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_tag_bibitem">[24]</span>
<span class="ltx_bibblock">
X. Ma, Y. Gong, P. He, H. Zhao, and N. Duan, “Query rewriting for retrieval-augmented large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">arXiv preprint arXiv:2305.14283</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_tag_bibitem">[25]</span>
<span class="ltx_bibblock">
N. Anderson, C. Wilson, and S. D. Richardson, “Lingua: Addressing scenarios for live interpretation and automatic dubbing,” in <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Proceedings of the 15th Biennial Conference of the Association for Machine Translation in the Americas (Volume 2: Users and Providers Track and Government Track)</em>, J. Campbell, S. Larocca, J. Marciano, K. Savenkov, and A. Yanishevsky, Eds.   Orlando, USA: Association for Machine Translation in the Americas, Sep. 2022, pp. 202–209. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.amta-upg.14" title="">https://aclanthology.org/2022.amta-upg.14</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_tag_bibitem">[26]</span>
<span class="ltx_bibblock">
L. Luo, Y.-F. Li, G. Haffari, and S. Pan, “Reasoning on graphs: Faithful and interpretable large language model reasoning,” <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">arXiv preprint arXiv:2310.01061</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_tag_bibitem">[27]</span>
<span class="ltx_bibblock">
X. V. Lin, X. Chen, M. Chen, W. Shi, M. Lomeli, R. James, P. Rodriguez, J. Kahn, G. Szilvasy, M. Lewis <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">et al.</em>, “Ra-dit: Retrieval-augmented dual instruction tuning,” <em class="ltx_emph ltx_font_italic" id="bib.bib27.2.2">arXiv preprint arXiv:2310.01352</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_tag_bibitem">[28]</span>
<span class="ltx_bibblock">
A. Asai, Z. Wu, Y. Wang, A. Sil, and H. Hajishirzi, “Self-rag: Learning to retrieve, generate, and critique through self-reflection,” <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">arXiv preprint arXiv:2310.11511</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_tag_bibitem">[29]</span>
<span class="ltx_bibblock">
Y. Huang and J. Huang, “A survey on retrieval-augmented text generation for large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">arXiv preprint arXiv:2404.10981</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_tag_bibitem">[30]</span>
<span class="ltx_bibblock">
Y. Hu and Y. Lu, “Rag and rau: A survey on retrieval-augmented language model in natural language processing,” <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">arXiv preprint arXiv:2404.19543</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_tag_bibitem">[31]</span>
<span class="ltx_bibblock">
Y. Ding, W. Fan, L. Ning, S. Wang, H. Li, D. Yin, T.-S. Chua, and Q. Li, “A survey on rag meets llms: Towards retrieval-augmented large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">arXiv preprint arXiv:2405.06211</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_tag_bibitem">[32]</span>
<span class="ltx_bibblock">
P. Zhao, H. Zhang, Q. Yu, Z. Wang, Y. Geng, F. Fu, L. Yang, W. Zhang, and B. Cui, “Retrieval-augmented generation for ai-generated content: A survey,” <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">arXiv preprint arXiv:2402.19473</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_tag_bibitem">[33]</span>
<span class="ltx_bibblock">
S. Yang, “Advanced rag 01: Small-to-big retrieval,” <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://towardsdatascience.com/advanced-rag-01-small-to-big-retrieval-172181b396d4" title="">https://towardsdatascience.com/advanced-rag-01-small-to-big-retrieval-172181b396d4</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_tag_bibitem">[34]</span>
<span class="ltx_bibblock">
Y. Wang, N. Lipka, R. A. Rossi, A. Siu, R. Zhang, and T. Derr, “Knowledge graph prompting for multi-document question answering,” <em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2308.11730</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_tag_bibitem">[35]</span>
<span class="ltx_bibblock">
D. Zhou, N. Schärli, L. Hou, J. Wei, N. Scales, X. Wang, D. Schuurmans, C. Cui, O. Bousquet, Q. Le <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">et al.</em>, “Least-to-most prompting enables complex reasoning in large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib35.2.2">arXiv preprint arXiv:2205.10625</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_tag_bibitem">[36]</span>
<span class="ltx_bibblock">
S. Dhuliawala, M. Komeili, J. Xu, R. Raileanu, X. Li, A. Celikyilmaz, and J. Weston, “Chain-of-verification reduces hallucination in large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">arXiv preprint arXiv:2309.11495</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_tag_bibitem">[37]</span>
<span class="ltx_bibblock">
L. Gao, X. Ma, J. Lin, and J. Callan, “Precise zero-shot dense retrieval without relevance labels,” <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">arXiv preprint arXiv:2212.10496</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_tag_bibitem">[38]</span>
<span class="ltx_bibblock">
H. S. Zheng, S. Mishra, X. Chen, H.-T. Cheng, E. H. Chi, Q. V. Le, and D. Zhou, “Take a step back: Evoking reasoning via abstraction in large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">arXiv preprint arXiv:2310.06117</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_tag_bibitem">[39]</span>
<span class="ltx_bibblock">
H. Cao, “Recent advances in text embedding: A comprehensive review of top-performing methods on the mteb benchmark,” <em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">arXiv preprint arXiv:2406.01607</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_tag_bibitem">[40]</span>
<span class="ltx_bibblock">
BAAI, “Flagembedding,” <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/FlagOpen/FlagEmbedding" title="">https://github.com/FlagOpen/FlagEmbedding</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_tag_bibitem">[41]</span>
<span class="ltx_bibblock">
Z. Li, X. Zhang, Y. Zhang, D. Long, P. Xie, and M. Zhang, “Towards general text embeddings with multi-stage contrastive learning,” <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">arXiv preprint arXiv:2308.03281</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_tag_bibitem">[42]</span>
<span class="ltx_bibblock">
H. Yang, Z. Li, Y. Zhang, J. Wang, N. Cheng, M. Li, and J. Xiao, “Prca: Fitting black-box large language models for retrieval question answering via pluggable reward-driven contextual adapter,” <em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">arXiv preprint arXiv:2310.18347</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_tag_bibitem">[43]</span>
<span class="ltx_bibblock">
N. F. Liu, K. Lin, J. Hewitt, A. Paranjape, M. Bevilacqua, F. Petroni, and P. Liang, “Lost in the middle: How language models use long contexts,” <em class="ltx_emph ltx_font_italic" id="bib.bib43.1.1">arXiv preprint arXiv:2307.03172</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_tag_bibitem">[44]</span>
<span class="ltx_bibblock">
Y. Lyu, Z. Li, S. Niu, F. Xiong, B. Tang, W. Wang, H. Wu, H. Liu, T. Xu, and E. Chen, “Crud-rag: A comprehensive chinese benchmark for retrieval-augmented generation of large language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:2401.17043</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_tag_bibitem">[45]</span>
<span class="ltx_bibblock">
L. Xia, J. Xu, Y. Lan, J. Guo, and X. Cheng, “Learning maximal marginal relevance model via directly optimizing diversity evaluation measures,” in <em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">Proceedings of the 38th international ACM SIGIR conference on research and development in information retrieval</em>, 2015, pp. 113–122.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_tag_bibitem">[46]</span>
<span class="ltx_bibblock">
Cohere, “Say goodbye to irrelevant search results: Cohere rerank is here,” <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://txt.cohere.com/rerank/" title="">https://txt.cohere.com/rerank/</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_tag_bibitem">[47]</span>
<span class="ltx_bibblock">
H. Jiang, Q. Wu, X. Luo, D. Li, C.-Y. Lin, Y. Yang, and L. Qiu, “Longllmlingua: Accelerating and enhancing llms in long context scenarios via prompt compression,” <em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">arXiv preprint arXiv:2310.06839</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_tag_bibitem">[48]</span>
<span class="ltx_bibblock">
R. Litman, O. Anschel, S. Tsiper, R. Litman, S. Mazor, and R. Manmatha, “Scatter: selective context attentional scene text recognizer,” in <em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">proceedings of the IEEE/CVF conference on computer vision and pattern recognition</em>, 2020, pp. 11 962–11 972.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_tag_bibitem">[49]</span>
<span class="ltx_bibblock">
J. Cui, Z. Li, Y. Yan, B. Chen, and L. Yuan, “Chatlaw: Open-source legal large language model with integrated external knowledge bases,” <em class="ltx_emph ltx_font_italic" id="bib.bib49.1.1">arXiv preprint arXiv:2306.16092</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_tag_bibitem">[50]</span>
<span class="ltx_bibblock">
T. Schick, J. Dwivedi-Yu, R. Dessì, R. Raileanu, M. Lomeli, L. Zettlemoyer, N. Cancedda, and T. Scialom, “Toolformer: Language models can teach themselves to use tools,” <em class="ltx_emph ltx_font_italic" id="bib.bib50.1.1">arXiv preprint arXiv:2302.04761</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_tag_bibitem">[51]</span>
<span class="ltx_bibblock">
L. Ouyang, J. Wu, X. Jiang, D. Almeida, C. Wainwright, P. Mishkin, C. Zhang, S. Agarwal, K. Slama, A. Ray <em class="ltx_emph ltx_font_italic" id="bib.bib51.1.1">et al.</em>, “Training language models to follow instructions with human feedback,” <em class="ltx_emph ltx_font_italic" id="bib.bib51.2.2">Advances in neural information processing systems</em>, vol. 35, pp. 27 730–27 744, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_tag_bibitem">[52]</span>
<span class="ltx_bibblock">
S. J. Semnani, V. Z. Yao, H. C. Zhang, and M. S. Lam, “Wikichat: Stopping the hallucination of large language model chatbots by few-shot grounding on wikipedia,” <em class="ltx_emph ltx_font_italic" id="bib.bib52.1.1">arXiv preprint arXiv:2305.14292</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_tag_bibitem">[53]</span>
<span class="ltx_bibblock">
J. Baek, S. Jeong, M. Kang, J. C. Park, and S. J. Hwang, “Knowledge-augmented language model verification,” <em class="ltx_emph ltx_font_italic" id="bib.bib53.1.1">arXiv preprint arXiv:2310.12836</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_tag_bibitem">[54]</span>
<span class="ltx_bibblock">
G. V. Cormack, C. L. Clarke, and S. Buettcher, “Reciprocal rank fusion outperforms condorcet and individual rank learning methods,” in <em class="ltx_emph ltx_font_italic" id="bib.bib54.1.1">Proceedings of the 32nd international ACM SIGIR conference on Research and development in information retrieval</em>, 2009, pp. 758–759.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_tag_bibitem">[55]</span>
<span class="ltx_bibblock">
W. Shi, S. Min, M. Yasunaga, M. Seo, R. James, M. Lewis, L. Zettlemoyer, and W.-t. Yih, “Replug: Retrieval-augmented black-box language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib55.1.1">arXiv preprint arXiv:2301.12652</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_tag_bibitem">[56]</span>
<span class="ltx_bibblock">
Z. Shao, Y. Gong, Y. Shen, M. Huang, N. Duan, and W. Chen, “Enhancing retrieval-augmented large language models with iterative retrieval-generation synergy,” <em class="ltx_emph ltx_font_italic" id="bib.bib56.1.1">arXiv preprint arXiv:2305.15294</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_tag_bibitem">[57]</span>
<span class="ltx_bibblock">
S. Hong, X. Zheng, J. Chen, Y. Cheng, J. Wang, C. Zhang, Z. Wang, S. K. S. Yau, Z. Lin, L. Zhou <em class="ltx_emph ltx_font_italic" id="bib.bib57.1.1">et al.</em>, “Metagpt: Meta programming for multi-agent collaborative framework,” <em class="ltx_emph ltx_font_italic" id="bib.bib57.2.2">arXiv preprint arXiv:2308.00352</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_tag_bibitem">[58]</span>
<span class="ltx_bibblock">
Z. Yu, C. Xiong, S. Yu, and Z. Liu, “Augmentation-adapted retriever improves generalization of language models as generic plug-in,” <em class="ltx_emph ltx_font_italic" id="bib.bib58.1.1">arXiv preprint arXiv:2305.17331</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_tag_bibitem">[59]</span>
<span class="ltx_bibblock">
Z. Hei, W. Wei, W. Ou, J. Qiao, J. Jiao, Z. Zhu, and G. Song, “Dr-rag: Applying dynamic document relevance to retrieval-augmented generation for question-answering,” <em class="ltx_emph ltx_font_italic" id="bib.bib59.1.1">arXiv preprint arXiv:2406.07348</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib60">
<span class="ltx_tag ltx_tag_bibitem">[60]</span>
<span class="ltx_bibblock">
M. Besta, A. Kubicek, R. Niggli, R. Gerstenberger, L. Weitzendorf, M. Chi, P. Iff, J. Gajda, P. Nyczyk, J. Müller <em class="ltx_emph ltx_font_italic" id="bib.bib60.1.1">et al.</em>, “Multi-head rag: Solving multi-aspect problems with llms,” <em class="ltx_emph ltx_font_italic" id="bib.bib60.2.2">arXiv preprint arXiv:2406.05085</em>, 2024.

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Jul 26 03:43:26 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
