<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>[2407.00113] Personalized Federated Continual Learning via Multi-granularity Prompt</title><meta property="og:description" content="Personalized Federated Continual Learning (PFCL) is a new practical scenario that poses greater challenges in sharing and personalizing knowledge. PFCL not only relies on knowledge fusion for server aggregation at the …">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Personalized Federated Continual Learning via Multi-granularity Prompt">
<meta name="twitter:image:src" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta name="twitter:image:alt" content="ar5iv logo">
<meta property="og:title" content="Personalized Federated Continual Learning via Multi-granularity Prompt">
<meta property="og:site_name" content="ar5iv">
<meta property="og:image" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ar5iv.labs.arxiv.org/html/2407.00113">

<!--Generated on Mon Aug  5 18:12:44 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" lang="en" content="Federated Continual Learning; Personalized FL; Multi-granularity Prompt; Spatial-Temporal Catastrophic Forgetting">

<script>
  function detectColorScheme(){
    var theme="light";
    var current_theme = localStorage.getItem("ar5iv_theme");
    if(current_theme){
      if(current_theme == "dark"){
        theme = "dark";
      } }
    else if(!window.matchMedia) { return false; }
    else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
      theme = "dark"; }
    if (theme=="dark") {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.setAttribute("data-theme", "light"); } }

  detectColorScheme();

  function toggleColorScheme(){
    var current_theme = localStorage.getItem("ar5iv_theme");
    if (current_theme) {
      if (current_theme == "light") {
        localStorage.setItem("ar5iv_theme", "dark"); }
      else {
        localStorage.setItem("ar5iv_theme", "light"); } }
    else {
        localStorage.setItem("ar5iv_theme", "dark"); }
    detectColorScheme(); }
</script>
<link media="all" rel="stylesheet" href="/assets/ar5iv-fonts.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv-site.0.2.2.css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Personalized Federated Continual Learning via Multi-granularity Prompt</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hao Yu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0009-0007-0705-4756" title="ORCID identifier" class="ltx_ref">0009-0007-0705-4756</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id1.1.id1" class="ltx_text ltx_affiliation_institution">School of Computing and Artificial Intelligence, Southwestern University of Finance and Economics</span><span id="id2.2.id2" class="ltx_text ltx_affiliation_city">Chengdu</span><span id="id3.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:yuhao2033@163.com">yuhao2033@163.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Xin Yang
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0000-0002-0406-6774" title="ORCID identifier" class="ltx_ref">0000-0002-0406-6774</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id4.1.id1" class="ltx_text ltx_affiliation_institution">School of Computing and Artificial Intelligence, Southwestern University of Finance and Economics</span><span id="id5.2.id2" class="ltx_text ltx_affiliation_city">Chengdu</span><span id="id6.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:yangxin@swufe.edu.cn">yangxin@swufe.edu.cn</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Xin Gao
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0009-0007-8265-898X" title="ORCID identifier" class="ltx_ref">0009-0007-8265-898X</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id7.1.id1" class="ltx_text ltx_affiliation_institution">School of Computing and Artificial Intelligence, Southwestern University of Finance and Economics</span><span id="id8.2.id2" class="ltx_text ltx_affiliation_city">Chengdu</span><span id="id9.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:xingaocs@hotmail.com">xingaocs@hotmail.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yan Kang
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0000-0002-2016-9503" title="ORCID identifier" class="ltx_ref">0000-0002-2016-9503</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id10.1.id1" class="ltx_text ltx_affiliation_institution">Webank</span><span id="id11.2.id2" class="ltx_text ltx_affiliation_city">Shenzhen</span><span id="id12.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:kangyan2003@gmail.com">kangyan2003@gmail.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hao Wang
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0000-0001-9492-3807" title="ORCID identifier" class="ltx_ref">0000-0001-9492-3807</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id13.1.id1" class="ltx_text ltx_affiliation_institution">College of Computer Science,
<br class="ltx_break">Sichuan University</span><span id="id14.2.id2" class="ltx_text ltx_affiliation_city">Chengdu</span><span id="id15.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:cshaowang@gmail.com">cshaowang@gmail.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Junbo Zhang
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0000-0001-5947-1374" title="ORCID identifier" class="ltx_ref">0000-0001-5947-1374</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id16.1.id1" class="ltx_text ltx_affiliation_institution">JD Intelligent Cities Research</span><span id="id17.2.id2" class="ltx_text ltx_affiliation_institution">JD iCity, JD Technology</span><span id="id18.3.id3" class="ltx_text ltx_affiliation_city">Beijing</span><span id="id19.4.id4" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:msjunbozhang@outlook.com">msjunbozhang@outlook.com</a>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Tianrui Li
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_orcid"><a target="_blank" href="https://orcid.org/0000-0003-2581-840X" title="ORCID identifier" class="ltx_ref">0000-0003-2581-840X</a></span>

<span class="ltx_contact ltx_role_affiliation"><span id="id20.1.id1" class="ltx_text ltx_affiliation_institution">School of Computing and Artificial Intelligence, Southwest Jiaotong University</span><span id="id21.2.id2" class="ltx_text ltx_affiliation_city">Chengdu</span><span id="id22.3.id3" class="ltx_text ltx_affiliation_country">China</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:trli@swjtu.edu.cn">trli@swjtu.edu.cn</a>
</span></span></span>
</div>
<div class="ltx_dates">(2024)</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p id="id23.id1" class="ltx_p">Personalized Federated Continual Learning (PFCL) is a new practical scenario that poses greater challenges in sharing and personalizing knowledge. PFCL not only relies on knowledge fusion for server aggregation at the global spatial-temporal perspective but also needs model improvement for each client according to the local requirements. Existing methods, whether in Personalized Federated Learning (PFL) or Federated Continual Learning (FCL), have overlooked the multi-granularity representation of knowledge, which can be utilized to overcome Spatial-Temporal Catastrophic Forgetting (STCF) and adopt generalized knowledge to itself by coarse-to-fine human cognitive mechanisms. Moreover, it allows more effectively to personalized shared knowledge, thus serving its own purpose. To this end, we propose a novel concept called multi-granularity prompt, i.e., <span id="id23.id1.1" class="ltx_text ltx_font_italic">coarse-grained global prompt</span> acquired through the common model learning process, and <span id="id23.id1.2" class="ltx_text ltx_font_italic">fine-grained local prompt</span> used to personalize the generalized representation. The former focuses on efficiently transferring shared global knowledge without spatial forgetting, and the latter emphasizes specific learning of personalized local knowledge to overcome temporal forgetting.
In addition, we design a <span id="id23.id1.3" class="ltx_text ltx_font_italic">selective prompt fusion</span> mechanism for aggregating knowledge of global prompts distilled from different clients. By the exclusive fusion of coarse-grained knowledge, we achieve the transmission and refinement of common knowledge among clients, further enhancing the performance of personalization. Extensive experiments demonstrate the effectiveness of the proposed method in addressing STCF as well as improving personalized performance. Our code now is available at <a target="_blank" href="https://github.com/SkyOfBeginning/FedMGP" title="" class="ltx_ref ltx_href">https://github.com/SkyOfBeginning/FedMGP</a>.</p>
</div>
<div class="ltx_keywords">Federated Continual Learning; Personalized FL; Multi-granularity Prompt; Spatial-Temporal Catastrophic Forgetting
</div>
<span id="id1" class="ltx_note ltx_note_frontmatter ltx_role_journalyear"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2024</span></span></span><span id="id2" class="ltx_note ltx_note_frontmatter ltx_role_copyright"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>acmlicensed</span></span></span><span id="id3" class="ltx_note ltx_note_frontmatter ltx_role_conference"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>Proceedings of the 30th ACM SIGKDD Conference on Knowledge Discovery and Data Mining; August 25–29, 2024; Barcelona, Spain</span></span></span><span id="id4" class="ltx_note ltx_note_frontmatter ltx_role_booktitle"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">booktitle: </span>Proceedings of the 30th ACM SIGKDD Conference on Knowledge Discovery and Data Mining (KDD ’24), August 25–29, 2024, Barcelona, Spain</span></span></span><span id="id5" class="ltx_note ltx_note_frontmatter ltx_role_doi"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>10.1145/3637528.3671948</span></span></span><span id="id6" class="ltx_note ltx_note_frontmatter ltx_role_isbn"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>979-8-4007-0490-1/24/08</span></span></span><span id="id7" class="ltx_note ltx_note_frontmatter ltx_role_ccs"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Distributed algorithms</span></span></span>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>

<div id="S1.p1" class="ltx_para">
<p id="S1.p1.1" class="ltx_p">Federated Continual Learning (FCL) is a new practical paradigm aiming at fusing knowledge from different times and spaces without catastrophic forgetting in dynamic Federated Learning (FL) settings <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>. Moreover, Personalized Federated Learning (PFL) tries to fuse implicit common knowledge extracted from various clients and personalize the generalized knowledge for better performance on the client side <cite class="ltx_cite ltx_citemacro_citep">(Tan et al<span class="ltx_text">.</span>, <a href="#bib.bib38" title="" class="ltx_ref">2022</a>)</cite>.
However, to better accommodate diverse local requirements in highly heterogeneous FCL scenarios, personalization solutions are necessary for leveraging knowledge fused from different spatial and temporal perspectives. Therefore, Personalized Federated Continual Learning (PFCL) is proposed as a combination of PFL and FCL with broader application scenarios.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p id="S1.p2.1" class="ltx_p">PFCL is more challenging than static PFL because of the higher requirements for handling heterogeneous knowledge. On the one hand, it implies accumulating knowledge against spatial-temporal catastrophic forgetting (STCF), which is the main issue of FCL.
On the other hand, it also needs to achieve effective extraction and fusion of client-specific and invariant knowledge, ensuring local personalization post the integration of shared knowledge. This is the primary goal of PFL.
Both issues can be solved by the multi-granularity representation of knowledge. Therefore, we can effectively address these issues by constructing a multi-granularity knowledge space, as illustrated in <a href="#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Fig. 1</span></a>. Existing methods have not taken this way into account.</p>
</div>
<figure id="S1.F1" class="ltx_figure"><img src="/html/2407.00113/assets/x1.png" id="S1.F1.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="226" height="125" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S1.F1.2.1.1" class="ltx_text" style="font-size:90%;">Figure 1</span>. </span><span id="S1.F1.3.2" class="ltx_text" style="font-size:90%;">An illustration of constructing a multi-granularity knowledge space in PFCL. By dividing local knowledge into coarse-grained knowledge and fine-grained knowledge, better aggregation of common representations can be achieved on the server side. On the local side, fine-grained knowledge is used to personalize the generalized representation. The two different levels of knowledge can accumulate over time.</span></figcaption>
</figure>
<div id="S1.p3" class="ltx_para">
<p id="S1.p3.1" class="ltx_p">The key to personalization lies in the accurate isolation of knowledge, namely, turning local knowledge into client-invariant and client-specific knowledge. By introducing a multi-granularity knowledge space, it is easy to decompose knowledge into coarse-grained, representing common aspects, and fine-grained, representing specific aspects, during the training stage to fulfill the requirements of personalization.
Moreover, on the server side, we consolidate client-invariant knowledge while maintaining the distinctiveness of client-specific knowledge with the exclusive fusion of coarse-grained representations.</p>
</div>
<div id="S1.p4" class="ltx_para">
<p id="S1.p4.1" class="ltx_p">For STCF, the knowledge learned by the deep network is overly fine-grained, making it highly susceptible to degradation in performance, such as the weighted average of parameters, leading to serious forgetting. In contrast, this multi-granularity knowledge representation exhibits stronger robustness against forgetting. On the one hand, using coarse-grained representation for temporal-spatial invariant knowledge makes it easier to transfer and fuse knowledge across time and space. On the other hand, utilizing fine-grained representation captures time-specific and space-specific knowledge, thereby achieving better personalization.</p>
</div>
<div id="S1.p5" class="ltx_para">
<p id="S1.p5.1" class="ltx_p">Inspired by the human cognitive process <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>, knowledge transfer is based on shared cognition, such as a common language. In this work, we construct a multi-granularity knowledge space by utilizing prompts of different granularity, namely <span id="S1.p5.1.1" class="ltx_text ltx_font_italic">coarse-grained global prompts</span> and <span id="S1.p5.1.2" class="ltx_text ltx_font_italic">fine-grained local prompts</span>, with a pre-trained Vision Transformer (ViT) <cite class="ltx_cite ltx_citemacro_citep">(Dosovitskiy et al<span class="ltx_text">.</span>, <a href="#bib.bib9" title="" class="ltx_ref">2020</a>)</cite>. Specifically, we employ the pre-trained ViT as the shared public cognition. We train coarse-grained prompts operating at the input without altering internal parameters to represent temporal-spatial invariant knowledge. Subsequently, leveraging the frozen coarse-grained prompts, we train class-wise fine-grained prompts that directly interact with the multi-head self-attention layer as temporal-spatial specific knowledge. This fine-tuning process enhances the model’s ability to adapt to local tasks. This coarse-to-fine cognitive approach also aligns with the human cognitive process, where attention is initially directed toward outlines before focusing on details. Finally, we design a selective prompt fusion mechanism on the server side. This novel prompt fusion approach further mitigates spatial forgetting caused by aggregation. The contributions of this paper are summarized as follows:</p>
</div>
<div id="S1.p6" class="ltx_para">
<ul id="S1.I1" class="ltx_itemize">
<li id="S1.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i1.p1" class="ltx_para">
<p id="S1.I1.i1.p1.1" class="ltx_p">We formally define a new personalized federated learning scenario called PFCL, which imposes higher demands on knowledge processing while preventing spatial-temporal forgetting. For the first time, we construct a multi-granularity knowledge space in this scenario, effectively addressing these challenges.</p>
</div>
</li>
<li id="S1.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i2.p1" class="ltx_para">
<p id="S1.I1.i2.p1.1" class="ltx_p">We propose a novel method called Federated Multi-Granularity Prompt (FedMGP), which introduces two distinct prompt levels to represent coarse-grained and fine-grained knowledge, respectively. It effectively overcomes STCF while meeting the requirements for personalization.</p>
</div>
</li>
<li id="S1.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i3.p1" class="ltx_para">
<p id="S1.I1.i3.p1.1" class="ltx_p">Extensive experiments demonstrate that our method achieves state-of-the-art performance in two different scenarios of federated continual learning. Moreover, our approach exhibits superior performance in personalizing and retaining temporal and spatial knowledge.</p>
</div>
</li>
</ul>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Related Work</h2>

<section id="S2.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1. </span>Multi-Granularity Computing</h3>

<div id="S2.SS1.p1" class="ltx_para">
<p id="S2.SS1.p1.1" class="ltx_p">Multi-granularity computing addresses the challenge of tackling the coexistence of data with different granularities <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib47" title="" class="ltx_ref">2022b</a>, <a href="#bib.bib46" title="" class="ltx_ref">a</a>)</cite>. Extracting multi-granularity knowledge benefits our understanding of materials and their intrinsic properties.</p>
</div>
<div id="S2.SS1.p2" class="ltx_para">
<p id="S2.SS1.p2.1" class="ltx_p">VL-PET <cite class="ltx_cite ltx_citemacro_citep">(Hu et al<span class="ltx_text">.</span>, <a href="#bib.bib14" title="" class="ltx_ref">2023</a>)</cite> designs a multi-granularity controlled mechanism to impose control on modular modifications of the pre-trained language model at coarse and fine granularities. <cite class="ltx_cite ltx_citemacro_citep">(Chen et al<span class="ltx_text">.</span>, <a href="#bib.bib6" title="" class="ltx_ref">2023</a>)</cite> constructs a question-answering dataset with yearly, monthly, and daily-grained data and proposes MultiQA to address temporally multi-granularity question-answering. <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib47" title="" class="ltx_ref">2022b</a>)</cite> adopts the sequential three-way decision method to extract knowledge of different granularities in open-topic classification tasks.
<cite class="ltx_cite ltx_citemacro_citep">(Xiao et al<span class="ltx_text">.</span>, <a href="#bib.bib43" title="" class="ltx_ref">2018</a>)</cite> decouples the objects of group re-identification tasks into individual, subgroup, and entire group granularities to handle the dynamic changes in group layout and member variations. <cite class="ltx_cite ltx_citemacro_citep">(Pan et al<span class="ltx_text">.</span>, <a href="#bib.bib33" title="" class="ltx_ref">2021</a>)</cite> introduces granular computing in FL and achieves automatic neural architecture search to adapt the different information granularity across clients. <cite class="ltx_cite ltx_citemacro_citep">(Ma et al<span class="ltx_text">.</span>, <a href="#bib.bib29" title="" class="ltx_ref">2022</a>)</cite> achieves a fine-grained knowledge fusion with layer-wised aggregation. PartialFed <cite class="ltx_cite ltx_citemacro_citep">(Sun et al<span class="ltx_text">.</span>, <a href="#bib.bib36" title="" class="ltx_ref">2021</a>)</cite> transfers cross-domain knowledge of adaptive granularity among clients by automatically switching the learning strategy. <cite class="ltx_cite ltx_citemacro_citep">(Cai et al<span class="ltx_text">.</span>, <a href="#bib.bib4" title="" class="ltx_ref">2022</a>)</cite> utilizes bi-directional guidance with a prior attention mechanism to transfer coarse-grained and fine-grained knowledge among multi-scale local models in an extremely heterogeneous federated system. <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a href="#bib.bib27" title="" class="ltx_ref">2020</a>)</cite> proposes a hierarchical FL framework to reduce the communication overhead, conducting model aggregation at two granularities.</p>
</div>
<div id="S2.SS1.p3" class="ltx_para">
<p id="S2.SS1.p3.1" class="ltx_p">Currently, the core concept of multi-granularity cognition has been gradually embraced by the general public and is progressively being applied to scenarios involving spatial-temporal changes. For the traffic accident predictions, given the dynamic nature of road networks and expanding urban areas, it is challenging when the spatial-temporal granularity of forecasting improves due to the rarity of accident records and the complexity of long-term future dependencies. To address these challenges, <cite class="ltx_cite ltx_citemacro_citep">(Zhou et al<span class="ltx_text">.</span>, <a href="#bib.bib51" title="" class="ltx_ref">2020</a>)</cite> propose a unified framework named RiskSeq, which is designed to foresee sparse urban accidents with finer granularities and multiple steps from a spatial-temporal perspective. This approach aims to enhance the accuracy and detail of accident predictions, thereby improving the efficiency of police force allocation and traffic management strategies. For the traffic flow predictions, not only should it consider the temporal dependencies that exist between different nodes in the network, but also the spatial correlations between nodes. <cite class="ltx_cite ltx_citemacro_citep">(Fang et al<span class="ltx_text">.</span>, <a href="#bib.bib11" title="" class="ltx_ref">2019</a>)</cite> propose a Global Spatial-Temporal Network (GSTNet), which is composed of multiple spatial-temporal blocks, in order to capture the global dynamic spatial-temporal correlations.</p>
</div>
<div id="S2.SS1.p4" class="ltx_para">
<p id="S2.SS1.p4.1" class="ltx_p">However, there is currently very limited research involving multi-granularity knowledge transfer in federated learning, and there is almost no research on using multi-granularity knowledge to address the spatial-temporal catastrophic forgetting in FCL. In this paper, we retain fine-grained knowledge in the local prompts and coarse-grained knowledge in the global prompts to achieve spatial-temporal knowledge fusion across tasks and clients.</p>
</div>
</section>
<section id="S2.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2. </span>Prompt-Based Continual Learning</h3>

<div id="S2.SS2.p1" class="ltx_para">
<p id="S2.SS2.p1.1" class="ltx_p">Continual Learning (CL) aims to overcome catastrophic forgetting of the previous knowledge after training on new data in non-stationary task streams <cite class="ltx_cite ltx_citemacro_citep">(De Lange et al<span class="ltx_text">.</span>, <a href="#bib.bib7" title="" class="ltx_ref">2021</a>)</cite>. Various CL techniques <cite class="ltx_cite ltx_citemacro_citep">(Masana et al<span class="ltx_text">.</span>, <a href="#bib.bib31" title="" class="ltx_ref">2022</a>; Li et al<span class="ltx_text">.</span>, <a href="#bib.bib22" title="" class="ltx_ref">2023b</a>; Mai et al<span class="ltx_text">.</span>, <a href="#bib.bib30" title="" class="ltx_ref">2022</a>)</cite> have been proposed to alleviate catastrophic forgetting and achieve knowledge transfer across tasks, including regularization, rehearsal, parameter isolation, and knowledge distillation.</p>
</div>
<div id="S2.SS2.p2" class="ltx_para">
<p id="S2.SS2.p2.1" class="ltx_p">Recent works introduce prompt learning to CL to achieve more efficient exemplar-free CL <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib42" title="" class="ltx_ref">2022b</a>, <a href="#bib.bib41" title="" class="ltx_ref">a</a>; Smith et al<span class="ltx_text">.</span>, <a href="#bib.bib35" title="" class="ltx_ref">2023</a>)</cite>. Prompt learning is a novel transfer learning technique applied to adapt general knowledge of pre-trained large language or vision models to downstream tasks by optimizing prompts <cite class="ltx_cite ltx_citemacro_citep">(Lester et al<span class="ltx_text">.</span>, <a href="#bib.bib21" title="" class="ltx_ref">2021</a>; Jia et al<span class="ltx_text">.</span>, <a href="#bib.bib15" title="" class="ltx_ref">2022</a>; Zhou et al<span class="ltx_text">.</span>, <a href="#bib.bib50" title="" class="ltx_ref">2022</a>; Kang et al<span class="ltx_text">.</span>, <a href="#bib.bib16" title="" class="ltx_ref">2023a</a>)</cite>. CoOp <cite class="ltx_cite ltx_citemacro_citep">(Zhou et al<span class="ltx_text">.</span>, <a href="#bib.bib50" title="" class="ltx_ref">2022</a>)</cite> integrates learnable prompts in the vision-language model to facilitate end-to-end learning where the design of task-specific prompts is fully automated.
L2P <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib42" title="" class="ltx_ref">2022b</a>)</cite> applies learnable task-specific prompts to mitigate forgetting and even outperforms exemplar-based methods in accuracy and efficiency. DualPrompt <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib41" title="" class="ltx_ref">2022a</a>)</cite> decouples the learnable prompts into general and expert prompts, encoding task-invariant and task-specific knowledge, respectively. CODA <cite class="ltx_cite ltx_citemacro_citep">(Smith et al<span class="ltx_text">.</span>, <a href="#bib.bib35" title="" class="ltx_ref">2023</a>)</cite> replaces key-value pairs in the prompt selection strategy with an attention-based end-to-end scheme. Pro-KT <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib26" title="" class="ltx_ref">2023a</a>)</cite> attaches complementary prompts to a pre-trained large model to efficiently transfer task-aware and task-specific knowledge. LGCL <cite class="ltx_cite ltx_citemacro_citep">(Khan et al<span class="ltx_text">.</span>, <a href="#bib.bib18" title="" class="ltx_ref">2023</a>)</cite> mitigates forgetting in extremely heterogeneous task streams, where the class set of each task is disjoint, by improving the key lookup of the prompt pool and mapping the output feature to class-level language representation.</p>
</div>
<div id="S2.SS2.p3" class="ltx_para">
<p id="S2.SS2.p3.1" class="ltx_p">In this paper, we design a local prompt and a global prompt mechanism to extract and encode coarse-grained and fine-grained knowledge, achieving spatial-temporal knowledge transfer.</p>
</div>
</section>
<section id="S2.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3. </span>Personalized Federated Learning</h3>

<div id="S2.SS3.p1" class="ltx_para">
<p id="S2.SS3.p1.1" class="ltx_p">Personalized Federated Learning (PFL) focuses on training customized models to accommodate various preferences and requirements of clients in heterogeneous FL. Existing works on PFL can be categorized into data-based and model-based approaches <cite class="ltx_cite ltx_citemacro_citep">(Tan et al<span class="ltx_text">.</span>, <a href="#bib.bib38" title="" class="ltx_ref">2022</a>)</cite>.</p>
</div>
<div id="S2.SS3.p2" class="ltx_para">
<p id="S2.SS3.p2.1" class="ltx_p">Per-FedAvg <cite class="ltx_cite ltx_citemacro_citep">(Fallah et al<span class="ltx_text">.</span>, <a href="#bib.bib10" title="" class="ltx_ref">2020</a>)</cite> designs a Model-Agnostic Meta-Learning (MAML) framework to find a generalized global model. It trains personalized local models derived from the shared global model. pFedMe <cite class="ltx_cite ltx_citemacro_citep">(T Dinh et al<span class="ltx_text">.</span>, <a href="#bib.bib37" title="" class="ltx_ref">2020</a>)</cite> integrates L2-norm regularization in the loss function to adaptively control the balance between personalization and generalization in federated MAML. Ditto <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib23" title="" class="ltx_ref">2021</a>)</cite> adds a regularization term in the local objectives as the loss function of the local adaptation process but aggregates the models before the local adaptation to strike a balance of personalization and generalization. FedSteg <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib45" title="" class="ltx_ref">2020</a>)</cite> enables domain adaptation from the shared global model to personalized local models by adding a correlation alignment layer before the softmax layer. FedPer <cite class="ltx_cite ltx_citemacro_citep">(Arivazhagan et al<span class="ltx_text">.</span>, <a href="#bib.bib2" title="" class="ltx_ref">2019</a>; Pillutla et al<span class="ltx_text">.</span>, <a href="#bib.bib34" title="" class="ltx_ref">2022</a>)</cite> decouples the model into base layers and personalized layers and aggregates the shallow base layers to capture generic knowledge while retaining the deep personalized layers locally to maintain personalized knowledge. FedMSplit <cite class="ltx_cite ltx_citemacro_citep">(Chen and Zhang, <a href="#bib.bib5" title="" class="ltx_ref">2022</a>)</cite> adopts multi-task learning to fit related but personalized models for clients. FedCE <cite class="ltx_cite ltx_citemacro_citep">(Cai et al<span class="ltx_text">.</span>, <a href="#bib.bib3" title="" class="ltx_ref">2023</a>)</cite> clusters the clients into several groups based on the similarity of local data distributions and trains multiple global models for each group. FedCP<cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a href="#bib.bib49" title="" class="ltx_ref">2023</a>)</cite> proposes an auxiliary Conditional Policy Network to achieve more fine-grained personalization with sample-wise feature separation.
<cite class="ltx_cite ltx_citemacro_citep">(Vahidian et al<span class="ltx_text">.</span>, <a href="#bib.bib39" title="" class="ltx_ref">2023</a>)</cite> conducts clustering by analyzing the principal angles of local data in the subspaces and delays the training stage until the clustering is accomplished. These works do not explicitly explore the multi-granular knowledge in the processes of generalization and personalization.</p>
</div>
<div id="S2.SS3.p3" class="ltx_para">
<p id="S2.SS3.p3.1" class="ltx_p">Some recent works incorporated prompting learning methods into PFL. pFedPG <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib44" title="" class="ltx_ref">2023</a>)</cite> utilizes personalized prompt generation globally and personalized prompt adaptation locally to achieve PFL under heterogeneous data. pFedPrompt <cite class="ltx_cite ltx_citemacro_citep">(Guo et al<span class="ltx_text">.</span>, <a href="#bib.bib12" title="" class="ltx_ref">2023</a>)</cite> extracts user consensus from linguistic space and adapts to local characteristics in visual space in a non-parametric manner.</p>
</div>
<div id="S2.SS3.p4" class="ltx_para">
<p id="S2.SS3.p4.1" class="ltx_p">However, extracting and fusing spatial-temporal multi-granular knowledge via prompting to overcome catastrophic forgetting and data heterogeneity has not yet been implemented in PFCL.</p>
</div>
</section>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>Problem Definition</h2>

<section id="S3.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Personalized Federated Continual Learning</h3>

<div id="S3.SS1.p1" class="ltx_para">
<p id="S3.SS1.p1.1" class="ltx_p">The primary goal of PFCL is to accumulate and fuse knowledge from different times and spaces. Clients employ suitable personalized strategies to make the received generalized knowledge better adapted to the characteristics of local data and effectively meet the requirements of local tasks. However, due to FCL itself, PFCL is also susceptible to severe spatial-temporal catastrophic forgetting.</p>
</div>
<div id="S3.SS1.p2" class="ltx_para">
<p id="S3.SS1.p2.1" class="ltx_p">Therefore, PFCL has <span id="S3.SS1.p2.1.1" class="ltx_text ltx_font_italic">three main objectives</span>. The first is to form more generalized knowledge during server knowledge fusion, avoiding spatial catastrophic forgetting caused by heterogeneous data. The second is for clients to adopt appropriate strategies to overcome temporal forgetting resulting from continual learning. The third is for clients to employ suitable personalization strategies, ensuring that the received generalized global model better adapts to the local task requirements and characteristics of local data.</p>
</div>
<div id="S3.SS1.p3" class="ltx_para">
<p id="S3.SS1.p3.1" class="ltx_p">Now, we extend the traditional FL to PFCL.</p>
<ul id="S3.I1" class="ltx_itemize">
<li id="S3.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S3.I1.i1.p1" class="ltx_para">
<p id="S3.I1.i1.p1.13" class="ltx_p">Given <math id="S3.I1.i1.p1.1.m1.1" class="ltx_Math" alttext="a" display="inline"><semantics id="S3.I1.i1.p1.1.m1.1a"><mi id="S3.I1.i1.p1.1.m1.1.1" xref="S3.I1.i1.p1.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.1.m1.1b"><ci id="S3.I1.i1.p1.1.m1.1.1.cmml" xref="S3.I1.i1.p1.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.1.m1.1c">a</annotation></semantics></math> clients (denoted as <math id="S3.I1.i1.p1.2.m2.4" class="ltx_Math" alttext="\mathcal{A}=\{A_{1},A_{2},\ldots,A_{a}\}" display="inline"><semantics id="S3.I1.i1.p1.2.m2.4a"><mrow id="S3.I1.i1.p1.2.m2.4.4" xref="S3.I1.i1.p1.2.m2.4.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.2.m2.4.4.5" xref="S3.I1.i1.p1.2.m2.4.4.5.cmml">𝒜</mi><mo id="S3.I1.i1.p1.2.m2.4.4.4" xref="S3.I1.i1.p1.2.m2.4.4.4.cmml">=</mo><mrow id="S3.I1.i1.p1.2.m2.4.4.3.3" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml"><mo stretchy="false" id="S3.I1.i1.p1.2.m2.4.4.3.3.4" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml">{</mo><msub id="S3.I1.i1.p1.2.m2.2.2.1.1.1" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1.cmml"><mi id="S3.I1.i1.p1.2.m2.2.2.1.1.1.2" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1.2.cmml">A</mi><mn id="S3.I1.i1.p1.2.m2.2.2.1.1.1.3" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S3.I1.i1.p1.2.m2.4.4.3.3.5" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S3.I1.i1.p1.2.m2.3.3.2.2.2" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2.cmml"><mi id="S3.I1.i1.p1.2.m2.3.3.2.2.2.2" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2.2.cmml">A</mi><mn id="S3.I1.i1.p1.2.m2.3.3.2.2.2.3" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2.3.cmml">2</mn></msub><mo id="S3.I1.i1.p1.2.m2.4.4.3.3.6" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml">,</mo><mi mathvariant="normal" id="S3.I1.i1.p1.2.m2.1.1" xref="S3.I1.i1.p1.2.m2.1.1.cmml">…</mi><mo id="S3.I1.i1.p1.2.m2.4.4.3.3.7" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S3.I1.i1.p1.2.m2.4.4.3.3.3" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3.cmml"><mi id="S3.I1.i1.p1.2.m2.4.4.3.3.3.2" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3.2.cmml">A</mi><mi id="S3.I1.i1.p1.2.m2.4.4.3.3.3.3" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3.3.cmml">a</mi></msub><mo stretchy="false" id="S3.I1.i1.p1.2.m2.4.4.3.3.8" xref="S3.I1.i1.p1.2.m2.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.2.m2.4b"><apply id="S3.I1.i1.p1.2.m2.4.4.cmml" xref="S3.I1.i1.p1.2.m2.4.4"><eq id="S3.I1.i1.p1.2.m2.4.4.4.cmml" xref="S3.I1.i1.p1.2.m2.4.4.4"></eq><ci id="S3.I1.i1.p1.2.m2.4.4.5.cmml" xref="S3.I1.i1.p1.2.m2.4.4.5">𝒜</ci><set id="S3.I1.i1.p1.2.m2.4.4.3.4.cmml" xref="S3.I1.i1.p1.2.m2.4.4.3.3"><apply id="S3.I1.i1.p1.2.m2.2.2.1.1.1.cmml" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.2.m2.2.2.1.1.1.1.cmml" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.2.m2.2.2.1.1.1.2.cmml" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1.2">𝐴</ci><cn type="integer" id="S3.I1.i1.p1.2.m2.2.2.1.1.1.3.cmml" xref="S3.I1.i1.p1.2.m2.2.2.1.1.1.3">1</cn></apply><apply id="S3.I1.i1.p1.2.m2.3.3.2.2.2.cmml" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.2.m2.3.3.2.2.2.1.cmml" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2">subscript</csymbol><ci id="S3.I1.i1.p1.2.m2.3.3.2.2.2.2.cmml" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2.2">𝐴</ci><cn type="integer" id="S3.I1.i1.p1.2.m2.3.3.2.2.2.3.cmml" xref="S3.I1.i1.p1.2.m2.3.3.2.2.2.3">2</cn></apply><ci id="S3.I1.i1.p1.2.m2.1.1.cmml" xref="S3.I1.i1.p1.2.m2.1.1">…</ci><apply id="S3.I1.i1.p1.2.m2.4.4.3.3.3.cmml" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.2.m2.4.4.3.3.3.1.cmml" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3">subscript</csymbol><ci id="S3.I1.i1.p1.2.m2.4.4.3.3.3.2.cmml" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3.2">𝐴</ci><ci id="S3.I1.i1.p1.2.m2.4.4.3.3.3.3.cmml" xref="S3.I1.i1.p1.2.m2.4.4.3.3.3.3">𝑎</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.2.m2.4c">\mathcal{A}=\{A_{1},A_{2},\ldots,A_{a}\}</annotation></semantics></math>), and a central server (denoted as <math id="S3.I1.i1.p1.3.m3.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S3.I1.i1.p1.3.m3.1a"><mi id="S3.I1.i1.p1.3.m3.1.1" xref="S3.I1.i1.p1.3.m3.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.3.m3.1b"><ci id="S3.I1.i1.p1.3.m3.1.1.cmml" xref="S3.I1.i1.p1.3.m3.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.3.m3.1c">S</annotation></semantics></math>), each client <math id="S3.I1.i1.p1.4.m4.2" class="ltx_Math" alttext="\{A_{i},1\leq i\leq a\}" display="inline"><semantics id="S3.I1.i1.p1.4.m4.2a"><mrow id="S3.I1.i1.p1.4.m4.2.2.1" xref="S3.I1.i1.p1.4.m4.2.2.2.cmml"><mo stretchy="false" id="S3.I1.i1.p1.4.m4.2.2.1.2" xref="S3.I1.i1.p1.4.m4.2.2.2.cmml">{</mo><mrow id="S3.I1.i1.p1.4.m4.2.2.1.1" xref="S3.I1.i1.p1.4.m4.2.2.1.1.cmml"><mrow id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.2.cmml"><msub id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.cmml"><mi id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.2" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.2.cmml">A</mi><mi id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.3" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.2" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.2.cmml">,</mo><mn id="S3.I1.i1.p1.4.m4.1.1" xref="S3.I1.i1.p1.4.m4.1.1.cmml">1</mn></mrow><mo id="S3.I1.i1.p1.4.m4.2.2.1.1.3" xref="S3.I1.i1.p1.4.m4.2.2.1.1.3.cmml">≤</mo><mi id="S3.I1.i1.p1.4.m4.2.2.1.1.4" xref="S3.I1.i1.p1.4.m4.2.2.1.1.4.cmml">i</mi><mo id="S3.I1.i1.p1.4.m4.2.2.1.1.5" xref="S3.I1.i1.p1.4.m4.2.2.1.1.5.cmml">≤</mo><mi id="S3.I1.i1.p1.4.m4.2.2.1.1.6" xref="S3.I1.i1.p1.4.m4.2.2.1.1.6.cmml">a</mi></mrow><mo stretchy="false" id="S3.I1.i1.p1.4.m4.2.2.1.3" xref="S3.I1.i1.p1.4.m4.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.4.m4.2b"><set id="S3.I1.i1.p1.4.m4.2.2.2.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1"><apply id="S3.I1.i1.p1.4.m4.2.2.1.1.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1"><and id="S3.I1.i1.p1.4.m4.2.2.1.1a.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1"></and><apply id="S3.I1.i1.p1.4.m4.2.2.1.1b.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1"><leq id="S3.I1.i1.p1.4.m4.2.2.1.1.3.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.3"></leq><list id="S3.I1.i1.p1.4.m4.2.2.1.1.1.2.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1"><apply id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.1.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.2.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.2">𝐴</ci><ci id="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.3.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.1.1.1.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i1.p1.4.m4.1.1.cmml" xref="S3.I1.i1.p1.4.m4.1.1">1</cn></list><ci id="S3.I1.i1.p1.4.m4.2.2.1.1.4.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.4">𝑖</ci></apply><apply id="S3.I1.i1.p1.4.m4.2.2.1.1c.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1"><leq id="S3.I1.i1.p1.4.m4.2.2.1.1.5.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.5"></leq><share href="#S3.I1.i1.p1.4.m4.2.2.1.1.4.cmml" id="S3.I1.i1.p1.4.m4.2.2.1.1d.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1"></share><ci id="S3.I1.i1.p1.4.m4.2.2.1.1.6.cmml" xref="S3.I1.i1.p1.4.m4.2.2.1.1.6">𝑎</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.4.m4.2c">\{A_{i},1\leq i\leq a\}</annotation></semantics></math> has its unique task sequence <math id="S3.I1.i1.p1.5.m5.1" class="ltx_Math" alttext="\mathcal{T}_{i}" display="inline"><semantics id="S3.I1.i1.p1.5.m5.1a"><msub id="S3.I1.i1.p1.5.m5.1.1" xref="S3.I1.i1.p1.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.5.m5.1.1.2" xref="S3.I1.i1.p1.5.m5.1.1.2.cmml">𝒯</mi><mi id="S3.I1.i1.p1.5.m5.1.1.3" xref="S3.I1.i1.p1.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.5.m5.1b"><apply id="S3.I1.i1.p1.5.m5.1.1.cmml" xref="S3.I1.i1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.5.m5.1.1.1.cmml" xref="S3.I1.i1.p1.5.m5.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.5.m5.1.1.2.cmml" xref="S3.I1.i1.p1.5.m5.1.1.2">𝒯</ci><ci id="S3.I1.i1.p1.5.m5.1.1.3.cmml" xref="S3.I1.i1.p1.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.5.m5.1c">\mathcal{T}_{i}</annotation></semantics></math>, where each task encompasses different classes. The task sequence of client <math id="S3.I1.i1.p1.6.m6.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.I1.i1.p1.6.m6.1a"><msub id="S3.I1.i1.p1.6.m6.1.1" xref="S3.I1.i1.p1.6.m6.1.1.cmml"><mi id="S3.I1.i1.p1.6.m6.1.1.2" xref="S3.I1.i1.p1.6.m6.1.1.2.cmml">A</mi><mi id="S3.I1.i1.p1.6.m6.1.1.3" xref="S3.I1.i1.p1.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.6.m6.1b"><apply id="S3.I1.i1.p1.6.m6.1.1.cmml" xref="S3.I1.i1.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.6.m6.1.1.1.cmml" xref="S3.I1.i1.p1.6.m6.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.6.m6.1.1.2.cmml" xref="S3.I1.i1.p1.6.m6.1.1.2">𝐴</ci><ci id="S3.I1.i1.p1.6.m6.1.1.3.cmml" xref="S3.I1.i1.p1.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.6.m6.1c">A_{i}</annotation></semantics></math> is denoted as <math id="S3.I1.i1.p1.7.m7.4" class="ltx_Math" alttext="\mathcal{T}_{i}=\{T_{i}^{1},T_{i}^{2},\ldots,T_{i}^{n_{i}}\}" display="inline"><semantics id="S3.I1.i1.p1.7.m7.4a"><mrow id="S3.I1.i1.p1.7.m7.4.4" xref="S3.I1.i1.p1.7.m7.4.4.cmml"><msub id="S3.I1.i1.p1.7.m7.4.4.5" xref="S3.I1.i1.p1.7.m7.4.4.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.7.m7.4.4.5.2" xref="S3.I1.i1.p1.7.m7.4.4.5.2.cmml">𝒯</mi><mi id="S3.I1.i1.p1.7.m7.4.4.5.3" xref="S3.I1.i1.p1.7.m7.4.4.5.3.cmml">i</mi></msub><mo id="S3.I1.i1.p1.7.m7.4.4.4" xref="S3.I1.i1.p1.7.m7.4.4.4.cmml">=</mo><mrow id="S3.I1.i1.p1.7.m7.4.4.3.3" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml"><mo stretchy="false" id="S3.I1.i1.p1.7.m7.4.4.3.3.4" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml">{</mo><msubsup id="S3.I1.i1.p1.7.m7.2.2.1.1.1" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.cmml"><mi id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.2" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.2.cmml">T</mi><mi id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.3" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.3.cmml">i</mi><mn id="S3.I1.i1.p1.7.m7.2.2.1.1.1.3" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.3.cmml">1</mn></msubsup><mo id="S3.I1.i1.p1.7.m7.4.4.3.3.5" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml">,</mo><msubsup id="S3.I1.i1.p1.7.m7.3.3.2.2.2" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.cmml"><mi id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.2" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.2.cmml">T</mi><mi id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.3" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.3.cmml">i</mi><mn id="S3.I1.i1.p1.7.m7.3.3.2.2.2.3" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.3.cmml">2</mn></msubsup><mo id="S3.I1.i1.p1.7.m7.4.4.3.3.6" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml">,</mo><mi mathvariant="normal" id="S3.I1.i1.p1.7.m7.1.1" xref="S3.I1.i1.p1.7.m7.1.1.cmml">…</mi><mo id="S3.I1.i1.p1.7.m7.4.4.3.3.7" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml">,</mo><msubsup id="S3.I1.i1.p1.7.m7.4.4.3.3.3" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.cmml"><mi id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.2" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.2.cmml">T</mi><mi id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.3" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.3.cmml">i</mi><msub id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.cmml"><mi id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.2" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.2.cmml">n</mi><mi id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.3" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.3.cmml">i</mi></msub></msubsup><mo stretchy="false" id="S3.I1.i1.p1.7.m7.4.4.3.3.8" xref="S3.I1.i1.p1.7.m7.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.7.m7.4b"><apply id="S3.I1.i1.p1.7.m7.4.4.cmml" xref="S3.I1.i1.p1.7.m7.4.4"><eq id="S3.I1.i1.p1.7.m7.4.4.4.cmml" xref="S3.I1.i1.p1.7.m7.4.4.4"></eq><apply id="S3.I1.i1.p1.7.m7.4.4.5.cmml" xref="S3.I1.i1.p1.7.m7.4.4.5"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.4.4.5.1.cmml" xref="S3.I1.i1.p1.7.m7.4.4.5">subscript</csymbol><ci id="S3.I1.i1.p1.7.m7.4.4.5.2.cmml" xref="S3.I1.i1.p1.7.m7.4.4.5.2">𝒯</ci><ci id="S3.I1.i1.p1.7.m7.4.4.5.3.cmml" xref="S3.I1.i1.p1.7.m7.4.4.5.3">𝑖</ci></apply><set id="S3.I1.i1.p1.7.m7.4.4.3.4.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3"><apply id="S3.I1.i1.p1.7.m7.2.2.1.1.1.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.2.2.1.1.1.1.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1">superscript</csymbol><apply id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.1.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.2.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.2">𝑇</ci><ci id="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.3.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i1.p1.7.m7.2.2.1.1.1.3.cmml" xref="S3.I1.i1.p1.7.m7.2.2.1.1.1.3">1</cn></apply><apply id="S3.I1.i1.p1.7.m7.3.3.2.2.2.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.3.3.2.2.2.1.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2">superscript</csymbol><apply id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.1.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2">subscript</csymbol><ci id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.2.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.2">𝑇</ci><ci id="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.3.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i1.p1.7.m7.3.3.2.2.2.3.cmml" xref="S3.I1.i1.p1.7.m7.3.3.2.2.2.3">2</cn></apply><ci id="S3.I1.i1.p1.7.m7.1.1.cmml" xref="S3.I1.i1.p1.7.m7.1.1">…</ci><apply id="S3.I1.i1.p1.7.m7.4.4.3.3.3.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.4.4.3.3.3.1.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3">superscript</csymbol><apply id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.1.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3">subscript</csymbol><ci id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.2.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.2">𝑇</ci><ci id="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.3.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.2.3">𝑖</ci></apply><apply id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.1.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3">subscript</csymbol><ci id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.2.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.2">𝑛</ci><ci id="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.3.cmml" xref="S3.I1.i1.p1.7.m7.4.4.3.3.3.3.3">𝑖</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.7.m7.4c">\mathcal{T}_{i}=\{T_{i}^{1},T_{i}^{2},\ldots,T_{i}^{n_{i}}\}</annotation></semantics></math>, where <math id="S3.I1.i1.p1.8.m8.1" class="ltx_Math" alttext="n_{i}" display="inline"><semantics id="S3.I1.i1.p1.8.m8.1a"><msub id="S3.I1.i1.p1.8.m8.1.1" xref="S3.I1.i1.p1.8.m8.1.1.cmml"><mi id="S3.I1.i1.p1.8.m8.1.1.2" xref="S3.I1.i1.p1.8.m8.1.1.2.cmml">n</mi><mi id="S3.I1.i1.p1.8.m8.1.1.3" xref="S3.I1.i1.p1.8.m8.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.8.m8.1b"><apply id="S3.I1.i1.p1.8.m8.1.1.cmml" xref="S3.I1.i1.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.8.m8.1.1.1.cmml" xref="S3.I1.i1.p1.8.m8.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.8.m8.1.1.2.cmml" xref="S3.I1.i1.p1.8.m8.1.1.2">𝑛</ci><ci id="S3.I1.i1.p1.8.m8.1.1.3.cmml" xref="S3.I1.i1.p1.8.m8.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.8.m8.1c">n_{i}</annotation></semantics></math> represents the total number of tasks on client <math id="S3.I1.i1.p1.9.m9.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.I1.i1.p1.9.m9.1a"><msub id="S3.I1.i1.p1.9.m9.1.1" xref="S3.I1.i1.p1.9.m9.1.1.cmml"><mi id="S3.I1.i1.p1.9.m9.1.1.2" xref="S3.I1.i1.p1.9.m9.1.1.2.cmml">A</mi><mi id="S3.I1.i1.p1.9.m9.1.1.3" xref="S3.I1.i1.p1.9.m9.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.9.m9.1b"><apply id="S3.I1.i1.p1.9.m9.1.1.cmml" xref="S3.I1.i1.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.9.m9.1.1.1.cmml" xref="S3.I1.i1.p1.9.m9.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.9.m9.1.1.2.cmml" xref="S3.I1.i1.p1.9.m9.1.1.2">𝐴</ci><ci id="S3.I1.i1.p1.9.m9.1.1.3.cmml" xref="S3.I1.i1.p1.9.m9.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.9.m9.1c">A_{i}</annotation></semantics></math>. The <math id="S3.I1.i1.p1.10.m10.1" class="ltx_Math" alttext="k" display="inline"><semantics id="S3.I1.i1.p1.10.m10.1a"><mi id="S3.I1.i1.p1.10.m10.1.1" xref="S3.I1.i1.p1.10.m10.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.10.m10.1b"><ci id="S3.I1.i1.p1.10.m10.1.1.cmml" xref="S3.I1.i1.p1.10.m10.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.10.m10.1c">k</annotation></semantics></math>-th task of <math id="S3.I1.i1.p1.11.m11.1" class="ltx_Math" alttext="\mathcal{T}_{i}" display="inline"><semantics id="S3.I1.i1.p1.11.m11.1a"><msub id="S3.I1.i1.p1.11.m11.1.1" xref="S3.I1.i1.p1.11.m11.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.11.m11.1.1.2" xref="S3.I1.i1.p1.11.m11.1.1.2.cmml">𝒯</mi><mi id="S3.I1.i1.p1.11.m11.1.1.3" xref="S3.I1.i1.p1.11.m11.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.11.m11.1b"><apply id="S3.I1.i1.p1.11.m11.1.1.cmml" xref="S3.I1.i1.p1.11.m11.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.11.m11.1.1.1.cmml" xref="S3.I1.i1.p1.11.m11.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.11.m11.1.1.2.cmml" xref="S3.I1.i1.p1.11.m11.1.1.2">𝒯</ci><ci id="S3.I1.i1.p1.11.m11.1.1.3.cmml" xref="S3.I1.i1.p1.11.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.11.m11.1c">\mathcal{T}_{i}</annotation></semantics></math> contains <math id="S3.I1.i1.p1.12.m12.1" class="ltx_Math" alttext="\left|\mathcal{C}_{i}^{k}\right|" display="inline"><semantics id="S3.I1.i1.p1.12.m12.1a"><mrow id="S3.I1.i1.p1.12.m12.1.1.1" xref="S3.I1.i1.p1.12.m12.1.1.2.cmml"><mo id="S3.I1.i1.p1.12.m12.1.1.1.2" xref="S3.I1.i1.p1.12.m12.1.1.2.1.cmml">|</mo><msubsup id="S3.I1.i1.p1.12.m12.1.1.1.1" xref="S3.I1.i1.p1.12.m12.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.12.m12.1.1.1.1.2.2" xref="S3.I1.i1.p1.12.m12.1.1.1.1.2.2.cmml">𝒞</mi><mi id="S3.I1.i1.p1.12.m12.1.1.1.1.2.3" xref="S3.I1.i1.p1.12.m12.1.1.1.1.2.3.cmml">i</mi><mi id="S3.I1.i1.p1.12.m12.1.1.1.1.3" xref="S3.I1.i1.p1.12.m12.1.1.1.1.3.cmml">k</mi></msubsup><mo id="S3.I1.i1.p1.12.m12.1.1.1.3" xref="S3.I1.i1.p1.12.m12.1.1.2.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.12.m12.1b"><apply id="S3.I1.i1.p1.12.m12.1.1.2.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1"><abs id="S3.I1.i1.p1.12.m12.1.1.2.1.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.2"></abs><apply id="S3.I1.i1.p1.12.m12.1.1.1.1.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.12.m12.1.1.1.1.1.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1">superscript</csymbol><apply id="S3.I1.i1.p1.12.m12.1.1.1.1.2.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.12.m12.1.1.1.1.2.1.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.12.m12.1.1.1.1.2.2.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1.2.2">𝒞</ci><ci id="S3.I1.i1.p1.12.m12.1.1.1.1.2.3.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1.2.3">𝑖</ci></apply><ci id="S3.I1.i1.p1.12.m12.1.1.1.1.3.cmml" xref="S3.I1.i1.p1.12.m12.1.1.1.1.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.12.m12.1c">\left|\mathcal{C}_{i}^{k}\right|</annotation></semantics></math> classes, and <math id="S3.I1.i1.p1.13.m13.2" class="ltx_Math" alttext="\mathcal{C}_{i}=\{\mathcal{C}_{i}^{1}\cup\mathcal{C}_{i}^{2}\cup\ldots,\cup\mathcal{C}_{i}^{n_{i}}\}" display="inline"><semantics id="S3.I1.i1.p1.13.m13.2a"><mrow id="S3.I1.i1.p1.13.m13.2.2" xref="S3.I1.i1.p1.13.m13.2.2.cmml"><msub id="S3.I1.i1.p1.13.m13.2.2.4" xref="S3.I1.i1.p1.13.m13.2.2.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.13.m13.2.2.4.2" xref="S3.I1.i1.p1.13.m13.2.2.4.2.cmml">𝒞</mi><mi id="S3.I1.i1.p1.13.m13.2.2.4.3" xref="S3.I1.i1.p1.13.m13.2.2.4.3.cmml">i</mi></msub><mo id="S3.I1.i1.p1.13.m13.2.2.3" xref="S3.I1.i1.p1.13.m13.2.2.3.cmml">=</mo><mrow id="S3.I1.i1.p1.13.m13.2.2.2.2" xref="S3.I1.i1.p1.13.m13.2.2.2.3.cmml"><mo stretchy="false" id="S3.I1.i1.p1.13.m13.2.2.2.2.3" xref="S3.I1.i1.p1.13.m13.2.2.2.3.cmml">{</mo><mrow id="S3.I1.i1.p1.13.m13.1.1.1.1.1" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.cmml"><msubsup id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.2" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.2.cmml">𝒞</mi><mi id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.3" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.3.cmml">i</mi><mn id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.3" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.3.cmml">1</mn></msubsup><mo id="S3.I1.i1.p1.13.m13.1.1.1.1.1.1" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.1.cmml">∪</mo><msubsup id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.2" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.2.cmml">𝒞</mi><mi id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.3" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.3.cmml">i</mi><mn id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.3" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.3.cmml">2</mn></msubsup><mo id="S3.I1.i1.p1.13.m13.1.1.1.1.1.1a" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.1.cmml">∪</mo><mi mathvariant="normal" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.4" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.4.cmml">…</mi></mrow><mo id="S3.I1.i1.p1.13.m13.2.2.2.2.4" xref="S3.I1.i1.p1.13.m13.2.2.2.3.cmml">,</mo><mrow id="S3.I1.i1.p1.13.m13.2.2.2.2.2" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.cmml"><mo lspace="0em" rspace="0em" id="S3.I1.i1.p1.13.m13.2.2.2.2.2a" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.cmml">∪</mo><msubsup id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.2" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.2.cmml">𝒞</mi><mi id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.3" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.3.cmml">i</mi><msub id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.cmml"><mi id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.2" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.2.cmml">n</mi><mi id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.3" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.3.cmml">i</mi></msub></msubsup></mrow><mo stretchy="false" id="S3.I1.i1.p1.13.m13.2.2.2.2.5" xref="S3.I1.i1.p1.13.m13.2.2.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.13.m13.2b"><apply id="S3.I1.i1.p1.13.m13.2.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2"><eq id="S3.I1.i1.p1.13.m13.2.2.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.3"></eq><apply id="S3.I1.i1.p1.13.m13.2.2.4.cmml" xref="S3.I1.i1.p1.13.m13.2.2.4"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.2.2.4.1.cmml" xref="S3.I1.i1.p1.13.m13.2.2.4">subscript</csymbol><ci id="S3.I1.i1.p1.13.m13.2.2.4.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.4.2">𝒞</ci><ci id="S3.I1.i1.p1.13.m13.2.2.4.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.4.3">𝑖</ci></apply><set id="S3.I1.i1.p1.13.m13.2.2.2.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2"><apply id="S3.I1.i1.p1.13.m13.1.1.1.1.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1"><union id="S3.I1.i1.p1.13.m13.1.1.1.1.1.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.1"></union><apply id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2">superscript</csymbol><apply id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2">subscript</csymbol><ci id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.2.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.2">𝒞</ci><ci id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.3.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.3.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.2.3">1</cn></apply><apply id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3">superscript</csymbol><apply id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.1.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3">subscript</csymbol><ci id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.2.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.2">𝒞</ci><ci id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.3.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.3.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.3.3">2</cn></apply><ci id="S3.I1.i1.p1.13.m13.1.1.1.1.1.4.cmml" xref="S3.I1.i1.p1.13.m13.1.1.1.1.1.4">…</ci></apply><apply id="S3.I1.i1.p1.13.m13.2.2.2.2.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2"><union id="S3.I1.i1.p1.13.m13.2.2.2.2.2.1.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2"></union><apply id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.1.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2">superscript</csymbol><apply id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.1.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2">subscript</csymbol><ci id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.2">𝒞</ci><ci id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.2.3">𝑖</ci></apply><apply id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.1.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3">subscript</csymbol><ci id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.2.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.2">𝑛</ci><ci id="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.3.cmml" xref="S3.I1.i1.p1.13.m13.2.2.2.2.2.2.3.3">𝑖</ci></apply></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.13.m13.2c">\mathcal{C}_{i}=\{\mathcal{C}_{i}^{1}\cup\mathcal{C}_{i}^{2}\cup\ldots,\cup\mathcal{C}_{i}^{n_{i}}\}</annotation></semantics></math>.</p>
</div>
</li>
<li id="S3.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S3.I1.i2.p1" class="ltx_para">
<p id="S3.I1.i2.p1.11" class="ltx_p">During the training of task <math id="S3.I1.i2.p1.1.m1.1" class="ltx_Math" alttext="r" display="inline"><semantics id="S3.I1.i2.p1.1.m1.1a"><mi id="S3.I1.i2.p1.1.m1.1.1" xref="S3.I1.i2.p1.1.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.1.m1.1b"><ci id="S3.I1.i2.p1.1.m1.1.1.cmml" xref="S3.I1.i2.p1.1.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.1.m1.1c">r</annotation></semantics></math>, the global model on the server already possesses the knowledge of <math id="S3.I1.i2.p1.2.m2.1" class="ltx_Math" alttext="T_{i}^{1}" display="inline"><semantics id="S3.I1.i2.p1.2.m2.1a"><msubsup id="S3.I1.i2.p1.2.m2.1.1" xref="S3.I1.i2.p1.2.m2.1.1.cmml"><mi id="S3.I1.i2.p1.2.m2.1.1.2.2" xref="S3.I1.i2.p1.2.m2.1.1.2.2.cmml">T</mi><mi id="S3.I1.i2.p1.2.m2.1.1.2.3" xref="S3.I1.i2.p1.2.m2.1.1.2.3.cmml">i</mi><mn id="S3.I1.i2.p1.2.m2.1.1.3" xref="S3.I1.i2.p1.2.m2.1.1.3.cmml">1</mn></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.2.m2.1b"><apply id="S3.I1.i2.p1.2.m2.1.1.cmml" xref="S3.I1.i2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.2.m2.1.1.1.cmml" xref="S3.I1.i2.p1.2.m2.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.2.m2.1.1.2.cmml" xref="S3.I1.i2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.2.m2.1.1.2.1.cmml" xref="S3.I1.i2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.2.m2.1.1.2.2.cmml" xref="S3.I1.i2.p1.2.m2.1.1.2.2">𝑇</ci><ci id="S3.I1.i2.p1.2.m2.1.1.2.3.cmml" xref="S3.I1.i2.p1.2.m2.1.1.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i2.p1.2.m2.1.1.3.cmml" xref="S3.I1.i2.p1.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.2.m2.1c">T_{i}^{1}</annotation></semantics></math> to <math id="S3.I1.i2.p1.3.m3.1" class="ltx_Math" alttext="T_{i}^{r-1}" display="inline"><semantics id="S3.I1.i2.p1.3.m3.1a"><msubsup id="S3.I1.i2.p1.3.m3.1.1" xref="S3.I1.i2.p1.3.m3.1.1.cmml"><mi id="S3.I1.i2.p1.3.m3.1.1.2.2" xref="S3.I1.i2.p1.3.m3.1.1.2.2.cmml">T</mi><mi id="S3.I1.i2.p1.3.m3.1.1.2.3" xref="S3.I1.i2.p1.3.m3.1.1.2.3.cmml">i</mi><mrow id="S3.I1.i2.p1.3.m3.1.1.3" xref="S3.I1.i2.p1.3.m3.1.1.3.cmml"><mi id="S3.I1.i2.p1.3.m3.1.1.3.2" xref="S3.I1.i2.p1.3.m3.1.1.3.2.cmml">r</mi><mo id="S3.I1.i2.p1.3.m3.1.1.3.1" xref="S3.I1.i2.p1.3.m3.1.1.3.1.cmml">−</mo><mn id="S3.I1.i2.p1.3.m3.1.1.3.3" xref="S3.I1.i2.p1.3.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.3.m3.1b"><apply id="S3.I1.i2.p1.3.m3.1.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.3.m3.1.1.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.3.m3.1.1.2.cmml" xref="S3.I1.i2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.3.m3.1.1.2.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.3.m3.1.1.2.2.cmml" xref="S3.I1.i2.p1.3.m3.1.1.2.2">𝑇</ci><ci id="S3.I1.i2.p1.3.m3.1.1.2.3.cmml" xref="S3.I1.i2.p1.3.m3.1.1.2.3">𝑖</ci></apply><apply id="S3.I1.i2.p1.3.m3.1.1.3.cmml" xref="S3.I1.i2.p1.3.m3.1.1.3"><minus id="S3.I1.i2.p1.3.m3.1.1.3.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1.3.1"></minus><ci id="S3.I1.i2.p1.3.m3.1.1.3.2.cmml" xref="S3.I1.i2.p1.3.m3.1.1.3.2">𝑟</ci><cn type="integer" id="S3.I1.i2.p1.3.m3.1.1.3.3.cmml" xref="S3.I1.i2.p1.3.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.3.m3.1c">T_{i}^{r-1}</annotation></semantics></math> from client <math id="S3.I1.i2.p1.4.m4.2" class="ltx_Math" alttext="\{A_{i},1\leq i\leq a\}" display="inline"><semantics id="S3.I1.i2.p1.4.m4.2a"><mrow id="S3.I1.i2.p1.4.m4.2.2.1" xref="S3.I1.i2.p1.4.m4.2.2.2.cmml"><mo stretchy="false" id="S3.I1.i2.p1.4.m4.2.2.1.2" xref="S3.I1.i2.p1.4.m4.2.2.2.cmml">{</mo><mrow id="S3.I1.i2.p1.4.m4.2.2.1.1" xref="S3.I1.i2.p1.4.m4.2.2.1.1.cmml"><mrow id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.2.cmml"><msub id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.cmml"><mi id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.2" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.2.cmml">A</mi><mi id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.3" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.2" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.2.cmml">,</mo><mn id="S3.I1.i2.p1.4.m4.1.1" xref="S3.I1.i2.p1.4.m4.1.1.cmml">1</mn></mrow><mo id="S3.I1.i2.p1.4.m4.2.2.1.1.3" xref="S3.I1.i2.p1.4.m4.2.2.1.1.3.cmml">≤</mo><mi id="S3.I1.i2.p1.4.m4.2.2.1.1.4" xref="S3.I1.i2.p1.4.m4.2.2.1.1.4.cmml">i</mi><mo id="S3.I1.i2.p1.4.m4.2.2.1.1.5" xref="S3.I1.i2.p1.4.m4.2.2.1.1.5.cmml">≤</mo><mi id="S3.I1.i2.p1.4.m4.2.2.1.1.6" xref="S3.I1.i2.p1.4.m4.2.2.1.1.6.cmml">a</mi></mrow><mo stretchy="false" id="S3.I1.i2.p1.4.m4.2.2.1.3" xref="S3.I1.i2.p1.4.m4.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.4.m4.2b"><set id="S3.I1.i2.p1.4.m4.2.2.2.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1"><apply id="S3.I1.i2.p1.4.m4.2.2.1.1.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1"><and id="S3.I1.i2.p1.4.m4.2.2.1.1a.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1"></and><apply id="S3.I1.i2.p1.4.m4.2.2.1.1b.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1"><leq id="S3.I1.i2.p1.4.m4.2.2.1.1.3.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.3"></leq><list id="S3.I1.i2.p1.4.m4.2.2.1.1.1.2.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1"><apply id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.1.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.2.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.2">𝐴</ci><ci id="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.3.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.1.1.1.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i2.p1.4.m4.1.1.cmml" xref="S3.I1.i2.p1.4.m4.1.1">1</cn></list><ci id="S3.I1.i2.p1.4.m4.2.2.1.1.4.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.4">𝑖</ci></apply><apply id="S3.I1.i2.p1.4.m4.2.2.1.1c.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1"><leq id="S3.I1.i2.p1.4.m4.2.2.1.1.5.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.5"></leq><share href="#S3.I1.i2.p1.4.m4.2.2.1.1.4.cmml" id="S3.I1.i2.p1.4.m4.2.2.1.1d.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1"></share><ci id="S3.I1.i2.p1.4.m4.2.2.1.1.6.cmml" xref="S3.I1.i2.p1.4.m4.2.2.1.1.6">𝑎</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.4.m4.2c">\{A_{i},1\leq i\leq a\}</annotation></semantics></math>. The server <math id="S3.I1.i2.p1.5.m5.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S3.I1.i2.p1.5.m5.1a"><mi id="S3.I1.i2.p1.5.m5.1.1" xref="S3.I1.i2.p1.5.m5.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.5.m5.1b"><ci id="S3.I1.i2.p1.5.m5.1.1.cmml" xref="S3.I1.i2.p1.5.m5.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.5.m5.1c">S</annotation></semantics></math> then distributes it back to clients.
After personalizing the received global model <math id="S3.I1.i2.p1.6.m6.1" class="ltx_Math" alttext="\theta_{g}^{r-1}" display="inline"><semantics id="S3.I1.i2.p1.6.m6.1a"><msubsup id="S3.I1.i2.p1.6.m6.1.1" xref="S3.I1.i2.p1.6.m6.1.1.cmml"><mi id="S3.I1.i2.p1.6.m6.1.1.2.2" xref="S3.I1.i2.p1.6.m6.1.1.2.2.cmml">θ</mi><mi id="S3.I1.i2.p1.6.m6.1.1.2.3" xref="S3.I1.i2.p1.6.m6.1.1.2.3.cmml">g</mi><mrow id="S3.I1.i2.p1.6.m6.1.1.3" xref="S3.I1.i2.p1.6.m6.1.1.3.cmml"><mi id="S3.I1.i2.p1.6.m6.1.1.3.2" xref="S3.I1.i2.p1.6.m6.1.1.3.2.cmml">r</mi><mo id="S3.I1.i2.p1.6.m6.1.1.3.1" xref="S3.I1.i2.p1.6.m6.1.1.3.1.cmml">−</mo><mn id="S3.I1.i2.p1.6.m6.1.1.3.3" xref="S3.I1.i2.p1.6.m6.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.6.m6.1b"><apply id="S3.I1.i2.p1.6.m6.1.1.cmml" xref="S3.I1.i2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.6.m6.1.1.1.cmml" xref="S3.I1.i2.p1.6.m6.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.6.m6.1.1.2.cmml" xref="S3.I1.i2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.6.m6.1.1.2.1.cmml" xref="S3.I1.i2.p1.6.m6.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.6.m6.1.1.2.2.cmml" xref="S3.I1.i2.p1.6.m6.1.1.2.2">𝜃</ci><ci id="S3.I1.i2.p1.6.m6.1.1.2.3.cmml" xref="S3.I1.i2.p1.6.m6.1.1.2.3">𝑔</ci></apply><apply id="S3.I1.i2.p1.6.m6.1.1.3.cmml" xref="S3.I1.i2.p1.6.m6.1.1.3"><minus id="S3.I1.i2.p1.6.m6.1.1.3.1.cmml" xref="S3.I1.i2.p1.6.m6.1.1.3.1"></minus><ci id="S3.I1.i2.p1.6.m6.1.1.3.2.cmml" xref="S3.I1.i2.p1.6.m6.1.1.3.2">𝑟</ci><cn type="integer" id="S3.I1.i2.p1.6.m6.1.1.3.3.cmml" xref="S3.I1.i2.p1.6.m6.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.6.m6.1c">\theta_{g}^{r-1}</annotation></semantics></math>, the client <math id="S3.I1.i2.p1.7.m7.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.I1.i2.p1.7.m7.1a"><msub id="S3.I1.i2.p1.7.m7.1.1" xref="S3.I1.i2.p1.7.m7.1.1.cmml"><mi id="S3.I1.i2.p1.7.m7.1.1.2" xref="S3.I1.i2.p1.7.m7.1.1.2.cmml">A</mi><mi id="S3.I1.i2.p1.7.m7.1.1.3" xref="S3.I1.i2.p1.7.m7.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.7.m7.1b"><apply id="S3.I1.i2.p1.7.m7.1.1.cmml" xref="S3.I1.i2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.7.m7.1.1.1.cmml" xref="S3.I1.i2.p1.7.m7.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.7.m7.1.1.2.cmml" xref="S3.I1.i2.p1.7.m7.1.1.2">𝐴</ci><ci id="S3.I1.i2.p1.7.m7.1.1.3.cmml" xref="S3.I1.i2.p1.7.m7.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.7.m7.1c">A_{i}</annotation></semantics></math> continually trains it on <math id="S3.I1.i2.p1.8.m8.1" class="ltx_Math" alttext="T_{i}^{r}" display="inline"><semantics id="S3.I1.i2.p1.8.m8.1a"><msubsup id="S3.I1.i2.p1.8.m8.1.1" xref="S3.I1.i2.p1.8.m8.1.1.cmml"><mi id="S3.I1.i2.p1.8.m8.1.1.2.2" xref="S3.I1.i2.p1.8.m8.1.1.2.2.cmml">T</mi><mi id="S3.I1.i2.p1.8.m8.1.1.2.3" xref="S3.I1.i2.p1.8.m8.1.1.2.3.cmml">i</mi><mi id="S3.I1.i2.p1.8.m8.1.1.3" xref="S3.I1.i2.p1.8.m8.1.1.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.8.m8.1b"><apply id="S3.I1.i2.p1.8.m8.1.1.cmml" xref="S3.I1.i2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.8.m8.1.1.1.cmml" xref="S3.I1.i2.p1.8.m8.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.8.m8.1.1.2.cmml" xref="S3.I1.i2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.8.m8.1.1.2.1.cmml" xref="S3.I1.i2.p1.8.m8.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.8.m8.1.1.2.2.cmml" xref="S3.I1.i2.p1.8.m8.1.1.2.2">𝑇</ci><ci id="S3.I1.i2.p1.8.m8.1.1.2.3.cmml" xref="S3.I1.i2.p1.8.m8.1.1.2.3">𝑖</ci></apply><ci id="S3.I1.i2.p1.8.m8.1.1.3.cmml" xref="S3.I1.i2.p1.8.m8.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.8.m8.1c">T_{i}^{r}</annotation></semantics></math> as the initial model to get the new local model <math id="S3.I1.i2.p1.9.m9.1" class="ltx_Math" alttext="\theta_{i}^{r}" display="inline"><semantics id="S3.I1.i2.p1.9.m9.1a"><msubsup id="S3.I1.i2.p1.9.m9.1.1" xref="S3.I1.i2.p1.9.m9.1.1.cmml"><mi id="S3.I1.i2.p1.9.m9.1.1.2.2" xref="S3.I1.i2.p1.9.m9.1.1.2.2.cmml">θ</mi><mi id="S3.I1.i2.p1.9.m9.1.1.2.3" xref="S3.I1.i2.p1.9.m9.1.1.2.3.cmml">i</mi><mi id="S3.I1.i2.p1.9.m9.1.1.3" xref="S3.I1.i2.p1.9.m9.1.1.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.9.m9.1b"><apply id="S3.I1.i2.p1.9.m9.1.1.cmml" xref="S3.I1.i2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.9.m9.1.1.1.cmml" xref="S3.I1.i2.p1.9.m9.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.9.m9.1.1.2.cmml" xref="S3.I1.i2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.9.m9.1.1.2.1.cmml" xref="S3.I1.i2.p1.9.m9.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.9.m9.1.1.2.2.cmml" xref="S3.I1.i2.p1.9.m9.1.1.2.2">𝜃</ci><ci id="S3.I1.i2.p1.9.m9.1.1.2.3.cmml" xref="S3.I1.i2.p1.9.m9.1.1.2.3">𝑖</ci></apply><ci id="S3.I1.i2.p1.9.m9.1.1.3.cmml" xref="S3.I1.i2.p1.9.m9.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.9.m9.1c">\theta_{i}^{r}</annotation></semantics></math>. The local model <math id="S3.I1.i2.p1.10.m10.1" class="ltx_Math" alttext="\theta_{i}^{r}" display="inline"><semantics id="S3.I1.i2.p1.10.m10.1a"><msubsup id="S3.I1.i2.p1.10.m10.1.1" xref="S3.I1.i2.p1.10.m10.1.1.cmml"><mi id="S3.I1.i2.p1.10.m10.1.1.2.2" xref="S3.I1.i2.p1.10.m10.1.1.2.2.cmml">θ</mi><mi id="S3.I1.i2.p1.10.m10.1.1.2.3" xref="S3.I1.i2.p1.10.m10.1.1.2.3.cmml">i</mi><mi id="S3.I1.i2.p1.10.m10.1.1.3" xref="S3.I1.i2.p1.10.m10.1.1.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.10.m10.1b"><apply id="S3.I1.i2.p1.10.m10.1.1.cmml" xref="S3.I1.i2.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.10.m10.1.1.1.cmml" xref="S3.I1.i2.p1.10.m10.1.1">superscript</csymbol><apply id="S3.I1.i2.p1.10.m10.1.1.2.cmml" xref="S3.I1.i2.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.10.m10.1.1.2.1.cmml" xref="S3.I1.i2.p1.10.m10.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.10.m10.1.1.2.2.cmml" xref="S3.I1.i2.p1.10.m10.1.1.2.2">𝜃</ci><ci id="S3.I1.i2.p1.10.m10.1.1.2.3.cmml" xref="S3.I1.i2.p1.10.m10.1.1.2.3">𝑖</ci></apply><ci id="S3.I1.i2.p1.10.m10.1.1.3.cmml" xref="S3.I1.i2.p1.10.m10.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.10.m10.1c">\theta_{i}^{r}</annotation></semantics></math> should perform well in classifying classes from the set <math id="S3.I1.i2.p1.11.m11.2" class="ltx_Math" alttext="\{\mathcal{C}_{i}^{1}\cup\mathcal{C}_{i}^{2}\cup\ldots,\cup\mathcal{C}_{i}^{r}\}" display="inline"><semantics id="S3.I1.i2.p1.11.m11.2a"><mrow id="S3.I1.i2.p1.11.m11.2.2.2" xref="S3.I1.i2.p1.11.m11.2.2.3.cmml"><mo stretchy="false" id="S3.I1.i2.p1.11.m11.2.2.2.3" xref="S3.I1.i2.p1.11.m11.2.2.3.cmml">{</mo><mrow id="S3.I1.i2.p1.11.m11.1.1.1.1" xref="S3.I1.i2.p1.11.m11.1.1.1.1.cmml"><msubsup id="S3.I1.i2.p1.11.m11.1.1.1.1.2" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.2" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.2.cmml">𝒞</mi><mi id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.3" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.3.cmml">i</mi><mn id="S3.I1.i2.p1.11.m11.1.1.1.1.2.3" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.3.cmml">1</mn></msubsup><mo id="S3.I1.i2.p1.11.m11.1.1.1.1.1" xref="S3.I1.i2.p1.11.m11.1.1.1.1.1.cmml">∪</mo><msubsup id="S3.I1.i2.p1.11.m11.1.1.1.1.3" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.2" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.2.cmml">𝒞</mi><mi id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.3" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.3.cmml">i</mi><mn id="S3.I1.i2.p1.11.m11.1.1.1.1.3.3" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.3.cmml">2</mn></msubsup><mo id="S3.I1.i2.p1.11.m11.1.1.1.1.1a" xref="S3.I1.i2.p1.11.m11.1.1.1.1.1.cmml">∪</mo><mi mathvariant="normal" id="S3.I1.i2.p1.11.m11.1.1.1.1.4" xref="S3.I1.i2.p1.11.m11.1.1.1.1.4.cmml">…</mi></mrow><mo id="S3.I1.i2.p1.11.m11.2.2.2.4" xref="S3.I1.i2.p1.11.m11.2.2.3.cmml">,</mo><mrow id="S3.I1.i2.p1.11.m11.2.2.2.2" xref="S3.I1.i2.p1.11.m11.2.2.2.2.cmml"><mo lspace="0em" rspace="0em" id="S3.I1.i2.p1.11.m11.2.2.2.2a" xref="S3.I1.i2.p1.11.m11.2.2.2.2.cmml">∪</mo><msubsup id="S3.I1.i2.p1.11.m11.2.2.2.2.2" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.2" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.2.cmml">𝒞</mi><mi id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.3" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.3.cmml">i</mi><mi id="S3.I1.i2.p1.11.m11.2.2.2.2.2.3" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.3.cmml">r</mi></msubsup></mrow><mo stretchy="false" id="S3.I1.i2.p1.11.m11.2.2.2.5" xref="S3.I1.i2.p1.11.m11.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.11.m11.2b"><set id="S3.I1.i2.p1.11.m11.2.2.3.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2"><apply id="S3.I1.i2.p1.11.m11.1.1.1.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1"><union id="S3.I1.i2.p1.11.m11.1.1.1.1.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.1"></union><apply id="S3.I1.i2.p1.11.m11.1.1.1.1.2.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.1.1.1.1.2.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2">superscript</csymbol><apply id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2">subscript</csymbol><ci id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.2.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.2">𝒞</ci><ci id="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.3.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i2.p1.11.m11.1.1.1.1.2.3.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.2.3">1</cn></apply><apply id="S3.I1.i2.p1.11.m11.1.1.1.1.3.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.1.1.1.1.3.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3">superscript</csymbol><apply id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.1.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3">subscript</csymbol><ci id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.2.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.2">𝒞</ci><ci id="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.3.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.2.3">𝑖</ci></apply><cn type="integer" id="S3.I1.i2.p1.11.m11.1.1.1.1.3.3.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.3.3">2</cn></apply><ci id="S3.I1.i2.p1.11.m11.1.1.1.1.4.cmml" xref="S3.I1.i2.p1.11.m11.1.1.1.1.4">…</ci></apply><apply id="S3.I1.i2.p1.11.m11.2.2.2.2.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2"><union id="S3.I1.i2.p1.11.m11.2.2.2.2.1.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2"></union><apply id="S3.I1.i2.p1.11.m11.2.2.2.2.2.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.2.2.2.2.2.1.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2">superscript</csymbol><apply id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.1.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2">subscript</csymbol><ci id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.2.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.2">𝒞</ci><ci id="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.3.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.2.3">𝑖</ci></apply><ci id="S3.I1.i2.p1.11.m11.2.2.2.2.2.3.cmml" xref="S3.I1.i2.p1.11.m11.2.2.2.2.2.3">𝑟</ci></apply></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.11.m11.2c">\{\mathcal{C}_{i}^{1}\cup\mathcal{C}_{i}^{2}\cup\ldots,\cup\mathcal{C}_{i}^{r}\}</annotation></semantics></math>.</p>
</div>
</li>
<li id="S3.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S3.I1.i3.p1" class="ltx_para">
<p id="S3.I1.i3.p1.2" class="ltx_p">Finally, the server collects the local models from clients who participate in FCL and obtains a new global model <math id="S3.I1.i3.p1.1.m1.1" class="ltx_Math" alttext="\theta_{g}^{r}" display="inline"><semantics id="S3.I1.i3.p1.1.m1.1a"><msubsup id="S3.I1.i3.p1.1.m1.1.1" xref="S3.I1.i3.p1.1.m1.1.1.cmml"><mi id="S3.I1.i3.p1.1.m1.1.1.2.2" xref="S3.I1.i3.p1.1.m1.1.1.2.2.cmml">θ</mi><mi id="S3.I1.i3.p1.1.m1.1.1.2.3" xref="S3.I1.i3.p1.1.m1.1.1.2.3.cmml">g</mi><mi id="S3.I1.i3.p1.1.m1.1.1.3" xref="S3.I1.i3.p1.1.m1.1.1.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i3.p1.1.m1.1b"><apply id="S3.I1.i3.p1.1.m1.1.1.cmml" xref="S3.I1.i3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.I1.i3.p1.1.m1.1.1.1.cmml" xref="S3.I1.i3.p1.1.m1.1.1">superscript</csymbol><apply id="S3.I1.i3.p1.1.m1.1.1.2.cmml" xref="S3.I1.i3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.I1.i3.p1.1.m1.1.1.2.1.cmml" xref="S3.I1.i3.p1.1.m1.1.1">subscript</csymbol><ci id="S3.I1.i3.p1.1.m1.1.1.2.2.cmml" xref="S3.I1.i3.p1.1.m1.1.1.2.2">𝜃</ci><ci id="S3.I1.i3.p1.1.m1.1.1.2.3.cmml" xref="S3.I1.i3.p1.1.m1.1.1.2.3">𝑔</ci></apply><ci id="S3.I1.i3.p1.1.m1.1.1.3.cmml" xref="S3.I1.i3.p1.1.m1.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i3.p1.1.m1.1c">\theta_{g}^{r}</annotation></semantics></math>, which has more generalized knowledge of learned tasks from all clients. Clients need to adopt appropriate strategies to personalize the global model <math id="S3.I1.i3.p1.2.m2.1" class="ltx_Math" alttext="\theta_{g}^{r}" display="inline"><semantics id="S3.I1.i3.p1.2.m2.1a"><msubsup id="S3.I1.i3.p1.2.m2.1.1" xref="S3.I1.i3.p1.2.m2.1.1.cmml"><mi id="S3.I1.i3.p1.2.m2.1.1.2.2" xref="S3.I1.i3.p1.2.m2.1.1.2.2.cmml">θ</mi><mi id="S3.I1.i3.p1.2.m2.1.1.2.3" xref="S3.I1.i3.p1.2.m2.1.1.2.3.cmml">g</mi><mi id="S3.I1.i3.p1.2.m2.1.1.3" xref="S3.I1.i3.p1.2.m2.1.1.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.I1.i3.p1.2.m2.1b"><apply id="S3.I1.i3.p1.2.m2.1.1.cmml" xref="S3.I1.i3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.I1.i3.p1.2.m2.1.1.1.cmml" xref="S3.I1.i3.p1.2.m2.1.1">superscript</csymbol><apply id="S3.I1.i3.p1.2.m2.1.1.2.cmml" xref="S3.I1.i3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.I1.i3.p1.2.m2.1.1.2.1.cmml" xref="S3.I1.i3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.I1.i3.p1.2.m2.1.1.2.2.cmml" xref="S3.I1.i3.p1.2.m2.1.1.2.2">𝜃</ci><ci id="S3.I1.i3.p1.2.m2.1.1.2.3.cmml" xref="S3.I1.i3.p1.2.m2.1.1.2.3">𝑔</ci></apply><ci id="S3.I1.i3.p1.2.m2.1.1.3.cmml" xref="S3.I1.i3.p1.2.m2.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i3.p1.2.m2.1c">\theta_{g}^{r}</annotation></semantics></math>, enabling it to perform better locally.</p>
</div>
</li>
</ul>
</div>
<div id="S3.SS1.p4" class="ltx_para">
<p id="S3.SS1.p4.1" class="ltx_p">According to the similarity of task sequences among clients, FCL can be initially divided into two scenarios: synchronous FCL and asynchronous FCL <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>. We will discuss it in detail in <a href="#S5.SS1.SSS2" title="5.1.2. Baselines and Backbones ‣ 5.1. Experimental Setup ‣ 5. Experiments ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 5.1.2</span></a>.</p>
</div>
</section>
<section id="S3.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Spatial-Temporal Catastrophic Forgetting</h3>

<div id="S3.SS2.p1" class="ltx_para">
<p id="S3.SS2.p1.1" class="ltx_p">Catastrophic Forgetting is a fundamental challenge in CL, which refers to a phenomenon that a model would forget the knowledge learned on old tasks when training on new tasks <cite class="ltx_cite ltx_citemacro_citep">(De Lange et al<span class="ltx_text">.</span>, <a href="#bib.bib7" title="" class="ltx_ref">2021</a>)</cite>. The reason for catastrophic forgetting is that the well-learned network parameters on the old tasks are overwritten during training on the new tasks <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>.</p>
</div>
<div id="S3.SS2.p2" class="ltx_para">
<p id="S3.SS2.p2.1" class="ltx_p">In the FCL setting, catastrophic forgetting exists as well.
In a real-world scenario, data reaches clients consecutively through task streams <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib25" title="" class="ltx_ref">2024</a>)</cite>, causing temporal catastrophic forgetting. At the aggregation stage, the central server collects local models and aggregates them into one global model. Then, the server distributes the global model back to clients.
Local models are trained with different training data. Aggregating them leads to the overwriting of certain task-specific crucial parameters, consequently causing a decline in the performance of the global model on local-specific tasks.
Adopting the global model consolidated such conflict knowledge exacerbates the temporal catastrophic forgetting of each client’s previous tasks.</p>
</div>
<div id="S3.SS2.p3" class="ltx_para">
<p id="S3.SS2.p3.1" class="ltx_p">The fundamental reason for STCF is that the knowledge represented by the model’s parameters is too fine-grained, leading to a lack of robustness against minor variations. Therefore, it is necessary to represent knowledge in a multi-granularity way. Splitting it into coarse-grained spatial-temporal-invariant knowledge and fine-grained spatial-temporal-specific knowledge and handling them separately can effectively overcome STCF.</p>
</div>
<div id="S3.SS2.p4" class="ltx_para">
<p id="S3.SS2.p4.1" class="ltx_p">We design <span id="S3.SS2.p4.1.1" class="ltx_text ltx_font_bold">Temporal Knowledge Retention</span> to measure the effectiveness of temporal knowledge transfer and <span id="S3.SS2.p4.1.2" class="ltx_text ltx_font_bold">Spatial Knowledge Retention</span> to measure the effectiveness of spatial knowledge transfer in PFCL.</p>
</div>
<div id="S3.SS2.p5" class="ltx_para">
<p id="S3.SS2.p5.1" class="ltx_p"><span id="S3.SS2.p5.1.1" class="ltx_text ltx_font_italic">Definition 1. <span id="S3.SS2.p5.1.1.1" class="ltx_text ltx_font_bold">(Temporal Knowledge Retention)</span></span> Given a federated learning system with <math id="S3.SS2.p5.1.m1.1" class="ltx_Math" alttext="a" display="inline"><semantics id="S3.SS2.p5.1.m1.1a"><mi id="S3.SS2.p5.1.m1.1.1" xref="S3.SS2.p5.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.1.m1.1b"><ci id="S3.SS2.p5.1.m1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.1.m1.1c">a</annotation></semantics></math> clients, the temporal knowledge retention is defined as:</p>
</div>
<div id="S3.SS2.p6" class="ltx_para">
<table id="S3.E1" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S3.E1.m1.5" class="ltx_Math" alttext="KR_{t}=\frac{1}{a}\sum_{i=1}^{a}\frac{Acc(\theta^{r}_{i};T^{0}_{i})}{Acc(\theta^{0}_{i};T^{0}_{i})}," display="block"><semantics id="S3.E1.m1.5a"><mrow id="S3.E1.m1.5.5.1" xref="S3.E1.m1.5.5.1.1.cmml"><mrow id="S3.E1.m1.5.5.1.1" xref="S3.E1.m1.5.5.1.1.cmml"><mrow id="S3.E1.m1.5.5.1.1.2" xref="S3.E1.m1.5.5.1.1.2.cmml"><mi id="S3.E1.m1.5.5.1.1.2.2" xref="S3.E1.m1.5.5.1.1.2.2.cmml">K</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.5.5.1.1.2.1" xref="S3.E1.m1.5.5.1.1.2.1.cmml">​</mo><msub id="S3.E1.m1.5.5.1.1.2.3" xref="S3.E1.m1.5.5.1.1.2.3.cmml"><mi id="S3.E1.m1.5.5.1.1.2.3.2" xref="S3.E1.m1.5.5.1.1.2.3.2.cmml">R</mi><mi id="S3.E1.m1.5.5.1.1.2.3.3" xref="S3.E1.m1.5.5.1.1.2.3.3.cmml">t</mi></msub></mrow><mo id="S3.E1.m1.5.5.1.1.1" xref="S3.E1.m1.5.5.1.1.1.cmml">=</mo><mrow id="S3.E1.m1.5.5.1.1.3" xref="S3.E1.m1.5.5.1.1.3.cmml"><mfrac id="S3.E1.m1.5.5.1.1.3.2" xref="S3.E1.m1.5.5.1.1.3.2.cmml"><mn id="S3.E1.m1.5.5.1.1.3.2.2" xref="S3.E1.m1.5.5.1.1.3.2.2.cmml">1</mn><mi id="S3.E1.m1.5.5.1.1.3.2.3" xref="S3.E1.m1.5.5.1.1.3.2.3.cmml">a</mi></mfrac><mo lspace="0em" rspace="0em" id="S3.E1.m1.5.5.1.1.3.1" xref="S3.E1.m1.5.5.1.1.3.1.cmml">​</mo><mrow id="S3.E1.m1.5.5.1.1.3.3" xref="S3.E1.m1.5.5.1.1.3.3.cmml"><munderover id="S3.E1.m1.5.5.1.1.3.3.1" xref="S3.E1.m1.5.5.1.1.3.3.1.cmml"><mo movablelimits="false" id="S3.E1.m1.5.5.1.1.3.3.1.2.2" xref="S3.E1.m1.5.5.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S3.E1.m1.5.5.1.1.3.3.1.2.3" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.cmml"><mi id="S3.E1.m1.5.5.1.1.3.3.1.2.3.2" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S3.E1.m1.5.5.1.1.3.3.1.2.3.1" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S3.E1.m1.5.5.1.1.3.3.1.2.3.3" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E1.m1.5.5.1.1.3.3.1.3" xref="S3.E1.m1.5.5.1.1.3.3.1.3.cmml">a</mi></munderover><mfrac id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml"><mrow id="S3.E1.m1.2.2.2" xref="S3.E1.m1.2.2.2.cmml"><mi id="S3.E1.m1.2.2.2.4" xref="S3.E1.m1.2.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.2.2.2.3" xref="S3.E1.m1.2.2.2.3.cmml">​</mo><mi id="S3.E1.m1.2.2.2.5" xref="S3.E1.m1.2.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.2.2.2.3a" xref="S3.E1.m1.2.2.2.3.cmml">​</mo><mi id="S3.E1.m1.2.2.2.6" xref="S3.E1.m1.2.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.2.2.2.3b" xref="S3.E1.m1.2.2.2.3.cmml">​</mo><mrow id="S3.E1.m1.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.3.cmml"><mo stretchy="false" id="S3.E1.m1.2.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.3.cmml">(</mo><msubsup id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.1.1.1.1.1.1.2.2" xref="S3.E1.m1.1.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.E1.m1.1.1.1.1.1.1.3" xref="S3.E1.m1.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.E1.m1.1.1.1.1.1.1.2.3" xref="S3.E1.m1.1.1.1.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.E1.m1.2.2.2.2.2.4" xref="S3.E1.m1.2.2.2.2.3.cmml">;</mo><msubsup id="S3.E1.m1.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.cmml"><mi id="S3.E1.m1.2.2.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.E1.m1.2.2.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.2.2.3.cmml">i</mi><mn id="S3.E1.m1.2.2.2.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.2.2.2.3.cmml">0</mn></msubsup><mo stretchy="false" id="S3.E1.m1.2.2.2.2.2.5" xref="S3.E1.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow><mrow id="S3.E1.m1.4.4.4" xref="S3.E1.m1.4.4.4.cmml"><mi id="S3.E1.m1.4.4.4.4" xref="S3.E1.m1.4.4.4.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.4.4.4.3" xref="S3.E1.m1.4.4.4.3.cmml">​</mo><mi id="S3.E1.m1.4.4.4.5" xref="S3.E1.m1.4.4.4.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.4.4.4.3a" xref="S3.E1.m1.4.4.4.3.cmml">​</mo><mi id="S3.E1.m1.4.4.4.6" xref="S3.E1.m1.4.4.4.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E1.m1.4.4.4.3b" xref="S3.E1.m1.4.4.4.3.cmml">​</mo><mrow id="S3.E1.m1.4.4.4.2.2" xref="S3.E1.m1.4.4.4.2.3.cmml"><mo stretchy="false" id="S3.E1.m1.4.4.4.2.2.3" xref="S3.E1.m1.4.4.4.2.3.cmml">(</mo><msubsup id="S3.E1.m1.3.3.3.1.1.1" xref="S3.E1.m1.3.3.3.1.1.1.cmml"><mi id="S3.E1.m1.3.3.3.1.1.1.2.2" xref="S3.E1.m1.3.3.3.1.1.1.2.2.cmml">θ</mi><mi id="S3.E1.m1.3.3.3.1.1.1.3" xref="S3.E1.m1.3.3.3.1.1.1.3.cmml">i</mi><mn id="S3.E1.m1.3.3.3.1.1.1.2.3" xref="S3.E1.m1.3.3.3.1.1.1.2.3.cmml">0</mn></msubsup><mo id="S3.E1.m1.4.4.4.2.2.4" xref="S3.E1.m1.4.4.4.2.3.cmml">;</mo><msubsup id="S3.E1.m1.4.4.4.2.2.2" xref="S3.E1.m1.4.4.4.2.2.2.cmml"><mi id="S3.E1.m1.4.4.4.2.2.2.2.2" xref="S3.E1.m1.4.4.4.2.2.2.2.2.cmml">T</mi><mi id="S3.E1.m1.4.4.4.2.2.2.3" xref="S3.E1.m1.4.4.4.2.2.2.3.cmml">i</mi><mn id="S3.E1.m1.4.4.4.2.2.2.2.3" xref="S3.E1.m1.4.4.4.2.2.2.2.3.cmml">0</mn></msubsup><mo stretchy="false" id="S3.E1.m1.4.4.4.2.2.5" xref="S3.E1.m1.4.4.4.2.3.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="S3.E1.m1.5.5.1.2" xref="S3.E1.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.5b"><apply id="S3.E1.m1.5.5.1.1.cmml" xref="S3.E1.m1.5.5.1"><eq id="S3.E1.m1.5.5.1.1.1.cmml" xref="S3.E1.m1.5.5.1.1.1"></eq><apply id="S3.E1.m1.5.5.1.1.2.cmml" xref="S3.E1.m1.5.5.1.1.2"><times id="S3.E1.m1.5.5.1.1.2.1.cmml" xref="S3.E1.m1.5.5.1.1.2.1"></times><ci id="S3.E1.m1.5.5.1.1.2.2.cmml" xref="S3.E1.m1.5.5.1.1.2.2">𝐾</ci><apply id="S3.E1.m1.5.5.1.1.2.3.cmml" xref="S3.E1.m1.5.5.1.1.2.3"><csymbol cd="ambiguous" id="S3.E1.m1.5.5.1.1.2.3.1.cmml" xref="S3.E1.m1.5.5.1.1.2.3">subscript</csymbol><ci id="S3.E1.m1.5.5.1.1.2.3.2.cmml" xref="S3.E1.m1.5.5.1.1.2.3.2">𝑅</ci><ci id="S3.E1.m1.5.5.1.1.2.3.3.cmml" xref="S3.E1.m1.5.5.1.1.2.3.3">𝑡</ci></apply></apply><apply id="S3.E1.m1.5.5.1.1.3.cmml" xref="S3.E1.m1.5.5.1.1.3"><times id="S3.E1.m1.5.5.1.1.3.1.cmml" xref="S3.E1.m1.5.5.1.1.3.1"></times><apply id="S3.E1.m1.5.5.1.1.3.2.cmml" xref="S3.E1.m1.5.5.1.1.3.2"><divide id="S3.E1.m1.5.5.1.1.3.2.1.cmml" xref="S3.E1.m1.5.5.1.1.3.2"></divide><cn type="integer" id="S3.E1.m1.5.5.1.1.3.2.2.cmml" xref="S3.E1.m1.5.5.1.1.3.2.2">1</cn><ci id="S3.E1.m1.5.5.1.1.3.2.3.cmml" xref="S3.E1.m1.5.5.1.1.3.2.3">𝑎</ci></apply><apply id="S3.E1.m1.5.5.1.1.3.3.cmml" xref="S3.E1.m1.5.5.1.1.3.3"><apply id="S3.E1.m1.5.5.1.1.3.3.1.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E1.m1.5.5.1.1.3.3.1.1.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1">superscript</csymbol><apply id="S3.E1.m1.5.5.1.1.3.3.1.2.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E1.m1.5.5.1.1.3.3.1.2.1.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1">subscript</csymbol><sum id="S3.E1.m1.5.5.1.1.3.3.1.2.2.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.2.2"></sum><apply id="S3.E1.m1.5.5.1.1.3.3.1.2.3.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3"><eq id="S3.E1.m1.5.5.1.1.3.3.1.2.3.1.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.1"></eq><ci id="S3.E1.m1.5.5.1.1.3.3.1.2.3.2.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.2">𝑖</ci><cn type="integer" id="S3.E1.m1.5.5.1.1.3.3.1.2.3.3.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E1.m1.5.5.1.1.3.3.1.3.cmml" xref="S3.E1.m1.5.5.1.1.3.3.1.3">𝑎</ci></apply><apply id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4"><divide id="S3.E1.m1.4.4.5.cmml" xref="S3.E1.m1.4.4"></divide><apply id="S3.E1.m1.2.2.2.cmml" xref="S3.E1.m1.2.2.2"><times id="S3.E1.m1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.3"></times><ci id="S3.E1.m1.2.2.2.4.cmml" xref="S3.E1.m1.2.2.2.4">𝐴</ci><ci id="S3.E1.m1.2.2.2.5.cmml" xref="S3.E1.m1.2.2.2.5">𝑐</ci><ci id="S3.E1.m1.2.2.2.6.cmml" xref="S3.E1.m1.2.2.2.6">𝑐</ci><list id="S3.E1.m1.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2"><apply id="S3.E1.m1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E1.m1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.2.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E1.m1.1.1.1.1.1.1.2.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.2.2">𝜃</ci><ci id="S3.E1.m1.1.1.1.1.1.1.2.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.2.3">𝑟</ci></apply><ci id="S3.E1.m1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E1.m1.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.2.2.2.2.1.cmml" xref="S3.E1.m1.2.2.2.2.2.2">subscript</csymbol><apply id="S3.E1.m1.2.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.2.2.2.2.2.1.cmml" xref="S3.E1.m1.2.2.2.2.2.2">superscript</csymbol><ci id="S3.E1.m1.2.2.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2.2.2">𝑇</ci><cn type="integer" id="S3.E1.m1.2.2.2.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2.2.2.3">0</cn></apply><ci id="S3.E1.m1.2.2.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2.2.3">𝑖</ci></apply></list></apply><apply id="S3.E1.m1.4.4.4.cmml" xref="S3.E1.m1.4.4.4"><times id="S3.E1.m1.4.4.4.3.cmml" xref="S3.E1.m1.4.4.4.3"></times><ci id="S3.E1.m1.4.4.4.4.cmml" xref="S3.E1.m1.4.4.4.4">𝐴</ci><ci id="S3.E1.m1.4.4.4.5.cmml" xref="S3.E1.m1.4.4.4.5">𝑐</ci><ci id="S3.E1.m1.4.4.4.6.cmml" xref="S3.E1.m1.4.4.4.6">𝑐</ci><list id="S3.E1.m1.4.4.4.2.3.cmml" xref="S3.E1.m1.4.4.4.2.2"><apply id="S3.E1.m1.3.3.3.1.1.1.cmml" xref="S3.E1.m1.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3.1.1.1.1.cmml" xref="S3.E1.m1.3.3.3.1.1.1">subscript</csymbol><apply id="S3.E1.m1.3.3.3.1.1.1.2.cmml" xref="S3.E1.m1.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3.1.1.1.2.1.cmml" xref="S3.E1.m1.3.3.3.1.1.1">superscript</csymbol><ci id="S3.E1.m1.3.3.3.1.1.1.2.2.cmml" xref="S3.E1.m1.3.3.3.1.1.1.2.2">𝜃</ci><cn type="integer" id="S3.E1.m1.3.3.3.1.1.1.2.3.cmml" xref="S3.E1.m1.3.3.3.1.1.1.2.3">0</cn></apply><ci id="S3.E1.m1.3.3.3.1.1.1.3.cmml" xref="S3.E1.m1.3.3.3.1.1.1.3">𝑖</ci></apply><apply id="S3.E1.m1.4.4.4.2.2.2.cmml" xref="S3.E1.m1.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.2.2.2.1.cmml" xref="S3.E1.m1.4.4.4.2.2.2">subscript</csymbol><apply id="S3.E1.m1.4.4.4.2.2.2.2.cmml" xref="S3.E1.m1.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.2.2.2.2.1.cmml" xref="S3.E1.m1.4.4.4.2.2.2">superscript</csymbol><ci id="S3.E1.m1.4.4.4.2.2.2.2.2.cmml" xref="S3.E1.m1.4.4.4.2.2.2.2.2">𝑇</ci><cn type="integer" id="S3.E1.m1.4.4.4.2.2.2.2.3.cmml" xref="S3.E1.m1.4.4.4.2.2.2.2.3">0</cn></apply><ci id="S3.E1.m1.4.4.4.2.2.2.3.cmml" xref="S3.E1.m1.4.4.4.2.2.2.3">𝑖</ci></apply></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.5c">KR_{t}=\frac{1}{a}\sum_{i=1}^{a}\frac{Acc(\theta^{r}_{i};T^{0}_{i})}{Acc(\theta^{0}_{i};T^{0}_{i})},</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S3.SS2.p6.7" class="ltx_p">where <math id="S3.SS2.p6.1.m1.2" class="ltx_Math" alttext="Acc(\theta^{r}_{i};T^{0}_{i})" display="inline"><semantics id="S3.SS2.p6.1.m1.2a"><mrow id="S3.SS2.p6.1.m1.2.2" xref="S3.SS2.p6.1.m1.2.2.cmml"><mi id="S3.SS2.p6.1.m1.2.2.4" xref="S3.SS2.p6.1.m1.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.1.m1.2.2.3" xref="S3.SS2.p6.1.m1.2.2.3.cmml">​</mo><mi id="S3.SS2.p6.1.m1.2.2.5" xref="S3.SS2.p6.1.m1.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.1.m1.2.2.3a" xref="S3.SS2.p6.1.m1.2.2.3.cmml">​</mo><mi id="S3.SS2.p6.1.m1.2.2.6" xref="S3.SS2.p6.1.m1.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.1.m1.2.2.3b" xref="S3.SS2.p6.1.m1.2.2.3.cmml">​</mo><mrow id="S3.SS2.p6.1.m1.2.2.2.2" xref="S3.SS2.p6.1.m1.2.2.2.3.cmml"><mo stretchy="false" id="S3.SS2.p6.1.m1.2.2.2.2.3" xref="S3.SS2.p6.1.m1.2.2.2.3.cmml">(</mo><msubsup id="S3.SS2.p6.1.m1.1.1.1.1.1" xref="S3.SS2.p6.1.m1.1.1.1.1.1.cmml"><mi id="S3.SS2.p6.1.m1.1.1.1.1.1.2.2" xref="S3.SS2.p6.1.m1.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p6.1.m1.1.1.1.1.1.3" xref="S3.SS2.p6.1.m1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.SS2.p6.1.m1.1.1.1.1.1.2.3" xref="S3.SS2.p6.1.m1.1.1.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.SS2.p6.1.m1.2.2.2.2.4" xref="S3.SS2.p6.1.m1.2.2.2.3.cmml">;</mo><msubsup id="S3.SS2.p6.1.m1.2.2.2.2.2" xref="S3.SS2.p6.1.m1.2.2.2.2.2.cmml"><mi id="S3.SS2.p6.1.m1.2.2.2.2.2.2.2" xref="S3.SS2.p6.1.m1.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.SS2.p6.1.m1.2.2.2.2.2.3" xref="S3.SS2.p6.1.m1.2.2.2.2.2.3.cmml">i</mi><mn id="S3.SS2.p6.1.m1.2.2.2.2.2.2.3" xref="S3.SS2.p6.1.m1.2.2.2.2.2.2.3.cmml">0</mn></msubsup><mo stretchy="false" id="S3.SS2.p6.1.m1.2.2.2.2.5" xref="S3.SS2.p6.1.m1.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.1.m1.2b"><apply id="S3.SS2.p6.1.m1.2.2.cmml" xref="S3.SS2.p6.1.m1.2.2"><times id="S3.SS2.p6.1.m1.2.2.3.cmml" xref="S3.SS2.p6.1.m1.2.2.3"></times><ci id="S3.SS2.p6.1.m1.2.2.4.cmml" xref="S3.SS2.p6.1.m1.2.2.4">𝐴</ci><ci id="S3.SS2.p6.1.m1.2.2.5.cmml" xref="S3.SS2.p6.1.m1.2.2.5">𝑐</ci><ci id="S3.SS2.p6.1.m1.2.2.6.cmml" xref="S3.SS2.p6.1.m1.2.2.6">𝑐</ci><list id="S3.SS2.p6.1.m1.2.2.2.3.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2"><apply id="S3.SS2.p6.1.m1.1.1.1.1.1.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.1.m1.1.1.1.1.1.1.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1">subscript</csymbol><apply id="S3.SS2.p6.1.m1.1.1.1.1.1.2.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.1.m1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.p6.1.m1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1.2.2">𝜃</ci><ci id="S3.SS2.p6.1.m1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p6.1.m1.1.1.1.1.1.3.cmml" xref="S3.SS2.p6.1.m1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS2.p6.1.m1.2.2.2.2.2.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p6.1.m1.2.2.2.2.2.1.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2">subscript</csymbol><apply id="S3.SS2.p6.1.m1.2.2.2.2.2.2.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p6.1.m1.2.2.2.2.2.2.1.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2">superscript</csymbol><ci id="S3.SS2.p6.1.m1.2.2.2.2.2.2.2.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2.2.2">𝑇</ci><cn type="integer" id="S3.SS2.p6.1.m1.2.2.2.2.2.2.3.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2.2.3">0</cn></apply><ci id="S3.SS2.p6.1.m1.2.2.2.2.2.3.cmml" xref="S3.SS2.p6.1.m1.2.2.2.2.2.3">𝑖</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.1.m1.2c">Acc(\theta^{r}_{i};T^{0}_{i})</annotation></semantics></math> denotes the test accuracy of client <math id="S3.SS2.p6.2.m2.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.SS2.p6.2.m2.1a"><msub id="S3.SS2.p6.2.m2.1.1" xref="S3.SS2.p6.2.m2.1.1.cmml"><mi id="S3.SS2.p6.2.m2.1.1.2" xref="S3.SS2.p6.2.m2.1.1.2.cmml">A</mi><mi id="S3.SS2.p6.2.m2.1.1.3" xref="S3.SS2.p6.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.2.m2.1b"><apply id="S3.SS2.p6.2.m2.1.1.cmml" xref="S3.SS2.p6.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.2.m2.1.1.1.cmml" xref="S3.SS2.p6.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p6.2.m2.1.1.2.cmml" xref="S3.SS2.p6.2.m2.1.1.2">𝐴</ci><ci id="S3.SS2.p6.2.m2.1.1.3.cmml" xref="S3.SS2.p6.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.2.m2.1c">A_{i}</annotation></semantics></math>’s local model at <math id="S3.SS2.p6.3.m3.1" class="ltx_Math" alttext="r" display="inline"><semantics id="S3.SS2.p6.3.m3.1a"><mi id="S3.SS2.p6.3.m3.1.1" xref="S3.SS2.p6.3.m3.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.3.m3.1b"><ci id="S3.SS2.p6.3.m3.1.1.cmml" xref="S3.SS2.p6.3.m3.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.3.m3.1c">r</annotation></semantics></math>-th round on the <math id="S3.SS2.p6.4.m4.1" class="ltx_Math" alttext="0" display="inline"><semantics id="S3.SS2.p6.4.m4.1a"><mn id="S3.SS2.p6.4.m4.1.1" xref="S3.SS2.p6.4.m4.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.4.m4.1b"><cn type="integer" id="S3.SS2.p6.4.m4.1.1.cmml" xref="S3.SS2.p6.4.m4.1.1">0</cn></annotation-xml></semantics></math>-th task and <math id="S3.SS2.p6.5.m5.2" class="ltx_Math" alttext="Acc(\theta^{0}_{i};T^{0}_{i})" display="inline"><semantics id="S3.SS2.p6.5.m5.2a"><mrow id="S3.SS2.p6.5.m5.2.2" xref="S3.SS2.p6.5.m5.2.2.cmml"><mi id="S3.SS2.p6.5.m5.2.2.4" xref="S3.SS2.p6.5.m5.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.5.m5.2.2.3" xref="S3.SS2.p6.5.m5.2.2.3.cmml">​</mo><mi id="S3.SS2.p6.5.m5.2.2.5" xref="S3.SS2.p6.5.m5.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.5.m5.2.2.3a" xref="S3.SS2.p6.5.m5.2.2.3.cmml">​</mo><mi id="S3.SS2.p6.5.m5.2.2.6" xref="S3.SS2.p6.5.m5.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p6.5.m5.2.2.3b" xref="S3.SS2.p6.5.m5.2.2.3.cmml">​</mo><mrow id="S3.SS2.p6.5.m5.2.2.2.2" xref="S3.SS2.p6.5.m5.2.2.2.3.cmml"><mo stretchy="false" id="S3.SS2.p6.5.m5.2.2.2.2.3" xref="S3.SS2.p6.5.m5.2.2.2.3.cmml">(</mo><msubsup id="S3.SS2.p6.5.m5.1.1.1.1.1" xref="S3.SS2.p6.5.m5.1.1.1.1.1.cmml"><mi id="S3.SS2.p6.5.m5.1.1.1.1.1.2.2" xref="S3.SS2.p6.5.m5.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p6.5.m5.1.1.1.1.1.3" xref="S3.SS2.p6.5.m5.1.1.1.1.1.3.cmml">i</mi><mn id="S3.SS2.p6.5.m5.1.1.1.1.1.2.3" xref="S3.SS2.p6.5.m5.1.1.1.1.1.2.3.cmml">0</mn></msubsup><mo id="S3.SS2.p6.5.m5.2.2.2.2.4" xref="S3.SS2.p6.5.m5.2.2.2.3.cmml">;</mo><msubsup id="S3.SS2.p6.5.m5.2.2.2.2.2" xref="S3.SS2.p6.5.m5.2.2.2.2.2.cmml"><mi id="S3.SS2.p6.5.m5.2.2.2.2.2.2.2" xref="S3.SS2.p6.5.m5.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.SS2.p6.5.m5.2.2.2.2.2.3" xref="S3.SS2.p6.5.m5.2.2.2.2.2.3.cmml">i</mi><mn id="S3.SS2.p6.5.m5.2.2.2.2.2.2.3" xref="S3.SS2.p6.5.m5.2.2.2.2.2.2.3.cmml">0</mn></msubsup><mo stretchy="false" id="S3.SS2.p6.5.m5.2.2.2.2.5" xref="S3.SS2.p6.5.m5.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.5.m5.2b"><apply id="S3.SS2.p6.5.m5.2.2.cmml" xref="S3.SS2.p6.5.m5.2.2"><times id="S3.SS2.p6.5.m5.2.2.3.cmml" xref="S3.SS2.p6.5.m5.2.2.3"></times><ci id="S3.SS2.p6.5.m5.2.2.4.cmml" xref="S3.SS2.p6.5.m5.2.2.4">𝐴</ci><ci id="S3.SS2.p6.5.m5.2.2.5.cmml" xref="S3.SS2.p6.5.m5.2.2.5">𝑐</ci><ci id="S3.SS2.p6.5.m5.2.2.6.cmml" xref="S3.SS2.p6.5.m5.2.2.6">𝑐</ci><list id="S3.SS2.p6.5.m5.2.2.2.3.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2"><apply id="S3.SS2.p6.5.m5.1.1.1.1.1.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.5.m5.1.1.1.1.1.1.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1">subscript</csymbol><apply id="S3.SS2.p6.5.m5.1.1.1.1.1.2.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.5.m5.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.p6.5.m5.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1.2.2">𝜃</ci><cn type="integer" id="S3.SS2.p6.5.m5.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1.2.3">0</cn></apply><ci id="S3.SS2.p6.5.m5.1.1.1.1.1.3.cmml" xref="S3.SS2.p6.5.m5.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS2.p6.5.m5.2.2.2.2.2.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p6.5.m5.2.2.2.2.2.1.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2">subscript</csymbol><apply id="S3.SS2.p6.5.m5.2.2.2.2.2.2.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p6.5.m5.2.2.2.2.2.2.1.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2">superscript</csymbol><ci id="S3.SS2.p6.5.m5.2.2.2.2.2.2.2.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2.2.2">𝑇</ci><cn type="integer" id="S3.SS2.p6.5.m5.2.2.2.2.2.2.3.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2.2.3">0</cn></apply><ci id="S3.SS2.p6.5.m5.2.2.2.2.2.3.cmml" xref="S3.SS2.p6.5.m5.2.2.2.2.2.3">𝑖</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.5.m5.2c">Acc(\theta^{0}_{i};T^{0}_{i})</annotation></semantics></math> denotes the test accuracy of client <math id="S3.SS2.p6.6.m6.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.SS2.p6.6.m6.1a"><msub id="S3.SS2.p6.6.m6.1.1" xref="S3.SS2.p6.6.m6.1.1.cmml"><mi id="S3.SS2.p6.6.m6.1.1.2" xref="S3.SS2.p6.6.m6.1.1.2.cmml">A</mi><mi id="S3.SS2.p6.6.m6.1.1.3" xref="S3.SS2.p6.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.6.m6.1b"><apply id="S3.SS2.p6.6.m6.1.1.cmml" xref="S3.SS2.p6.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p6.6.m6.1.1.1.cmml" xref="S3.SS2.p6.6.m6.1.1">subscript</csymbol><ci id="S3.SS2.p6.6.m6.1.1.2.cmml" xref="S3.SS2.p6.6.m6.1.1.2">𝐴</ci><ci id="S3.SS2.p6.6.m6.1.1.3.cmml" xref="S3.SS2.p6.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.6.m6.1c">A_{i}</annotation></semantics></math>’s local model at the initial round on the <math id="S3.SS2.p6.7.m7.1" class="ltx_Math" alttext="0" display="inline"><semantics id="S3.SS2.p6.7.m7.1a"><mn id="S3.SS2.p6.7.m7.1.1" xref="S3.SS2.p6.7.m7.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.7.m7.1b"><cn type="integer" id="S3.SS2.p6.7.m7.1.1.cmml" xref="S3.SS2.p6.7.m7.1.1">0</cn></annotation-xml></semantics></math>-th task.</p>
</div>
<div id="S3.SS2.p7" class="ltx_para">
<p id="S3.SS2.p7.1" class="ltx_p"><span id="S3.SS2.p7.1.1" class="ltx_text ltx_font_italic">Definition 2. <span id="S3.SS2.p7.1.1.1" class="ltx_text ltx_font_bold">(Spatial Knowledge Retention)</span></span> Given a federated learning system with <math id="S3.SS2.p7.1.m1.1" class="ltx_Math" alttext="a" display="inline"><semantics id="S3.SS2.p7.1.m1.1a"><mi id="S3.SS2.p7.1.m1.1.1" xref="S3.SS2.p7.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.1.m1.1b"><ci id="S3.SS2.p7.1.m1.1.1.cmml" xref="S3.SS2.p7.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.1.m1.1c">a</annotation></semantics></math> clients, the spatial knowledge retention is defined as:</p>
<table id="S3.E2" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S3.E2.m1.5" class="ltx_Math" alttext="KR_{s}=\frac{1}{a}\sum_{i=1}^{a}\frac{Acc(\theta^{r}_{g};T^{r}_{i})}{Acc(\theta^{r}_{i};T^{r}_{i})}," display="block"><semantics id="S3.E2.m1.5a"><mrow id="S3.E2.m1.5.5.1" xref="S3.E2.m1.5.5.1.1.cmml"><mrow id="S3.E2.m1.5.5.1.1" xref="S3.E2.m1.5.5.1.1.cmml"><mrow id="S3.E2.m1.5.5.1.1.2" xref="S3.E2.m1.5.5.1.1.2.cmml"><mi id="S3.E2.m1.5.5.1.1.2.2" xref="S3.E2.m1.5.5.1.1.2.2.cmml">K</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.5.5.1.1.2.1" xref="S3.E2.m1.5.5.1.1.2.1.cmml">​</mo><msub id="S3.E2.m1.5.5.1.1.2.3" xref="S3.E2.m1.5.5.1.1.2.3.cmml"><mi id="S3.E2.m1.5.5.1.1.2.3.2" xref="S3.E2.m1.5.5.1.1.2.3.2.cmml">R</mi><mi id="S3.E2.m1.5.5.1.1.2.3.3" xref="S3.E2.m1.5.5.1.1.2.3.3.cmml">s</mi></msub></mrow><mo id="S3.E2.m1.5.5.1.1.1" xref="S3.E2.m1.5.5.1.1.1.cmml">=</mo><mrow id="S3.E2.m1.5.5.1.1.3" xref="S3.E2.m1.5.5.1.1.3.cmml"><mfrac id="S3.E2.m1.5.5.1.1.3.2" xref="S3.E2.m1.5.5.1.1.3.2.cmml"><mn id="S3.E2.m1.5.5.1.1.3.2.2" xref="S3.E2.m1.5.5.1.1.3.2.2.cmml">1</mn><mi id="S3.E2.m1.5.5.1.1.3.2.3" xref="S3.E2.m1.5.5.1.1.3.2.3.cmml">a</mi></mfrac><mo lspace="0em" rspace="0em" id="S3.E2.m1.5.5.1.1.3.1" xref="S3.E2.m1.5.5.1.1.3.1.cmml">​</mo><mrow id="S3.E2.m1.5.5.1.1.3.3" xref="S3.E2.m1.5.5.1.1.3.3.cmml"><munderover id="S3.E2.m1.5.5.1.1.3.3.1" xref="S3.E2.m1.5.5.1.1.3.3.1.cmml"><mo movablelimits="false" id="S3.E2.m1.5.5.1.1.3.3.1.2.2" xref="S3.E2.m1.5.5.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S3.E2.m1.5.5.1.1.3.3.1.2.3" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.cmml"><mi id="S3.E2.m1.5.5.1.1.3.3.1.2.3.2" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S3.E2.m1.5.5.1.1.3.3.1.2.3.1" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S3.E2.m1.5.5.1.1.3.3.1.2.3.3" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E2.m1.5.5.1.1.3.3.1.3" xref="S3.E2.m1.5.5.1.1.3.3.1.3.cmml">a</mi></munderover><mfrac id="S3.E2.m1.4.4" xref="S3.E2.m1.4.4.cmml"><mrow id="S3.E2.m1.2.2.2" xref="S3.E2.m1.2.2.2.cmml"><mi id="S3.E2.m1.2.2.2.4" xref="S3.E2.m1.2.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.2.2.2.3" xref="S3.E2.m1.2.2.2.3.cmml">​</mo><mi id="S3.E2.m1.2.2.2.5" xref="S3.E2.m1.2.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.2.2.2.3a" xref="S3.E2.m1.2.2.2.3.cmml">​</mo><mi id="S3.E2.m1.2.2.2.6" xref="S3.E2.m1.2.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.2.2.2.3b" xref="S3.E2.m1.2.2.2.3.cmml">​</mo><mrow id="S3.E2.m1.2.2.2.2.2" xref="S3.E2.m1.2.2.2.2.3.cmml"><mo stretchy="false" id="S3.E2.m1.2.2.2.2.2.3" xref="S3.E2.m1.2.2.2.2.3.cmml">(</mo><msubsup id="S3.E2.m1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.1.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.E2.m1.1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.3.cmml">g</mi><mi id="S3.E2.m1.1.1.1.1.1.1.2.3" xref="S3.E2.m1.1.1.1.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.E2.m1.2.2.2.2.2.4" xref="S3.E2.m1.2.2.2.2.3.cmml">;</mo><msubsup id="S3.E2.m1.2.2.2.2.2.2" xref="S3.E2.m1.2.2.2.2.2.2.cmml"><mi id="S3.E2.m1.2.2.2.2.2.2.2.2" xref="S3.E2.m1.2.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.E2.m1.2.2.2.2.2.2.3" xref="S3.E2.m1.2.2.2.2.2.2.3.cmml">i</mi><mi id="S3.E2.m1.2.2.2.2.2.2.2.3" xref="S3.E2.m1.2.2.2.2.2.2.2.3.cmml">r</mi></msubsup><mo stretchy="false" id="S3.E2.m1.2.2.2.2.2.5" xref="S3.E2.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow><mrow id="S3.E2.m1.4.4.4" xref="S3.E2.m1.4.4.4.cmml"><mi id="S3.E2.m1.4.4.4.4" xref="S3.E2.m1.4.4.4.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.4.4.4.3" xref="S3.E2.m1.4.4.4.3.cmml">​</mo><mi id="S3.E2.m1.4.4.4.5" xref="S3.E2.m1.4.4.4.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.4.4.4.3a" xref="S3.E2.m1.4.4.4.3.cmml">​</mo><mi id="S3.E2.m1.4.4.4.6" xref="S3.E2.m1.4.4.4.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.E2.m1.4.4.4.3b" xref="S3.E2.m1.4.4.4.3.cmml">​</mo><mrow id="S3.E2.m1.4.4.4.2.2" xref="S3.E2.m1.4.4.4.2.3.cmml"><mo stretchy="false" id="S3.E2.m1.4.4.4.2.2.3" xref="S3.E2.m1.4.4.4.2.3.cmml">(</mo><msubsup id="S3.E2.m1.3.3.3.1.1.1" xref="S3.E2.m1.3.3.3.1.1.1.cmml"><mi id="S3.E2.m1.3.3.3.1.1.1.2.2" xref="S3.E2.m1.3.3.3.1.1.1.2.2.cmml">θ</mi><mi id="S3.E2.m1.3.3.3.1.1.1.3" xref="S3.E2.m1.3.3.3.1.1.1.3.cmml">i</mi><mi id="S3.E2.m1.3.3.3.1.1.1.2.3" xref="S3.E2.m1.3.3.3.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.E2.m1.4.4.4.2.2.4" xref="S3.E2.m1.4.4.4.2.3.cmml">;</mo><msubsup id="S3.E2.m1.4.4.4.2.2.2" xref="S3.E2.m1.4.4.4.2.2.2.cmml"><mi id="S3.E2.m1.4.4.4.2.2.2.2.2" xref="S3.E2.m1.4.4.4.2.2.2.2.2.cmml">T</mi><mi id="S3.E2.m1.4.4.4.2.2.2.3" xref="S3.E2.m1.4.4.4.2.2.2.3.cmml">i</mi><mi id="S3.E2.m1.4.4.4.2.2.2.2.3" xref="S3.E2.m1.4.4.4.2.2.2.2.3.cmml">r</mi></msubsup><mo stretchy="false" id="S3.E2.m1.4.4.4.2.2.5" xref="S3.E2.m1.4.4.4.2.3.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="S3.E2.m1.5.5.1.2" xref="S3.E2.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.5b"><apply id="S3.E2.m1.5.5.1.1.cmml" xref="S3.E2.m1.5.5.1"><eq id="S3.E2.m1.5.5.1.1.1.cmml" xref="S3.E2.m1.5.5.1.1.1"></eq><apply id="S3.E2.m1.5.5.1.1.2.cmml" xref="S3.E2.m1.5.5.1.1.2"><times id="S3.E2.m1.5.5.1.1.2.1.cmml" xref="S3.E2.m1.5.5.1.1.2.1"></times><ci id="S3.E2.m1.5.5.1.1.2.2.cmml" xref="S3.E2.m1.5.5.1.1.2.2">𝐾</ci><apply id="S3.E2.m1.5.5.1.1.2.3.cmml" xref="S3.E2.m1.5.5.1.1.2.3"><csymbol cd="ambiguous" id="S3.E2.m1.5.5.1.1.2.3.1.cmml" xref="S3.E2.m1.5.5.1.1.2.3">subscript</csymbol><ci id="S3.E2.m1.5.5.1.1.2.3.2.cmml" xref="S3.E2.m1.5.5.1.1.2.3.2">𝑅</ci><ci id="S3.E2.m1.5.5.1.1.2.3.3.cmml" xref="S3.E2.m1.5.5.1.1.2.3.3">𝑠</ci></apply></apply><apply id="S3.E2.m1.5.5.1.1.3.cmml" xref="S3.E2.m1.5.5.1.1.3"><times id="S3.E2.m1.5.5.1.1.3.1.cmml" xref="S3.E2.m1.5.5.1.1.3.1"></times><apply id="S3.E2.m1.5.5.1.1.3.2.cmml" xref="S3.E2.m1.5.5.1.1.3.2"><divide id="S3.E2.m1.5.5.1.1.3.2.1.cmml" xref="S3.E2.m1.5.5.1.1.3.2"></divide><cn type="integer" id="S3.E2.m1.5.5.1.1.3.2.2.cmml" xref="S3.E2.m1.5.5.1.1.3.2.2">1</cn><ci id="S3.E2.m1.5.5.1.1.3.2.3.cmml" xref="S3.E2.m1.5.5.1.1.3.2.3">𝑎</ci></apply><apply id="S3.E2.m1.5.5.1.1.3.3.cmml" xref="S3.E2.m1.5.5.1.1.3.3"><apply id="S3.E2.m1.5.5.1.1.3.3.1.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E2.m1.5.5.1.1.3.3.1.1.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1">superscript</csymbol><apply id="S3.E2.m1.5.5.1.1.3.3.1.2.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E2.m1.5.5.1.1.3.3.1.2.1.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1">subscript</csymbol><sum id="S3.E2.m1.5.5.1.1.3.3.1.2.2.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.2.2"></sum><apply id="S3.E2.m1.5.5.1.1.3.3.1.2.3.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3"><eq id="S3.E2.m1.5.5.1.1.3.3.1.2.3.1.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.1"></eq><ci id="S3.E2.m1.5.5.1.1.3.3.1.2.3.2.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.2">𝑖</ci><cn type="integer" id="S3.E2.m1.5.5.1.1.3.3.1.2.3.3.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E2.m1.5.5.1.1.3.3.1.3.cmml" xref="S3.E2.m1.5.5.1.1.3.3.1.3">𝑎</ci></apply><apply id="S3.E2.m1.4.4.cmml" xref="S3.E2.m1.4.4"><divide id="S3.E2.m1.4.4.5.cmml" xref="S3.E2.m1.4.4"></divide><apply id="S3.E2.m1.2.2.2.cmml" xref="S3.E2.m1.2.2.2"><times id="S3.E2.m1.2.2.2.3.cmml" xref="S3.E2.m1.2.2.2.3"></times><ci id="S3.E2.m1.2.2.2.4.cmml" xref="S3.E2.m1.2.2.2.4">𝐴</ci><ci id="S3.E2.m1.2.2.2.5.cmml" xref="S3.E2.m1.2.2.2.5">𝑐</ci><ci id="S3.E2.m1.2.2.2.6.cmml" xref="S3.E2.m1.2.2.2.6">𝑐</ci><list id="S3.E2.m1.2.2.2.2.3.cmml" xref="S3.E2.m1.2.2.2.2.2"><apply id="S3.E2.m1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E2.m1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.2.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.2.2">𝜃</ci><ci id="S3.E2.m1.1.1.1.1.1.1.2.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.2.3">𝑟</ci></apply><ci id="S3.E2.m1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.3">𝑔</ci></apply><apply id="S3.E2.m1.2.2.2.2.2.2.cmml" xref="S3.E2.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.2.2.2.2.2.2.1.cmml" xref="S3.E2.m1.2.2.2.2.2.2">subscript</csymbol><apply id="S3.E2.m1.2.2.2.2.2.2.2.cmml" xref="S3.E2.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.2.2.2.2.2.2.2.1.cmml" xref="S3.E2.m1.2.2.2.2.2.2">superscript</csymbol><ci id="S3.E2.m1.2.2.2.2.2.2.2.2.cmml" xref="S3.E2.m1.2.2.2.2.2.2.2.2">𝑇</ci><ci id="S3.E2.m1.2.2.2.2.2.2.2.3.cmml" xref="S3.E2.m1.2.2.2.2.2.2.2.3">𝑟</ci></apply><ci id="S3.E2.m1.2.2.2.2.2.2.3.cmml" xref="S3.E2.m1.2.2.2.2.2.2.3">𝑖</ci></apply></list></apply><apply id="S3.E2.m1.4.4.4.cmml" xref="S3.E2.m1.4.4.4"><times id="S3.E2.m1.4.4.4.3.cmml" xref="S3.E2.m1.4.4.4.3"></times><ci id="S3.E2.m1.4.4.4.4.cmml" xref="S3.E2.m1.4.4.4.4">𝐴</ci><ci id="S3.E2.m1.4.4.4.5.cmml" xref="S3.E2.m1.4.4.4.5">𝑐</ci><ci id="S3.E2.m1.4.4.4.6.cmml" xref="S3.E2.m1.4.4.4.6">𝑐</ci><list id="S3.E2.m1.4.4.4.2.3.cmml" xref="S3.E2.m1.4.4.4.2.2"><apply id="S3.E2.m1.3.3.3.1.1.1.cmml" xref="S3.E2.m1.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.3.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.1.1.1">subscript</csymbol><apply id="S3.E2.m1.3.3.3.1.1.1.2.cmml" xref="S3.E2.m1.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.3.1.1.1.2.1.cmml" xref="S3.E2.m1.3.3.3.1.1.1">superscript</csymbol><ci id="S3.E2.m1.3.3.3.1.1.1.2.2.cmml" xref="S3.E2.m1.3.3.3.1.1.1.2.2">𝜃</ci><ci id="S3.E2.m1.3.3.3.1.1.1.2.3.cmml" xref="S3.E2.m1.3.3.3.1.1.1.2.3">𝑟</ci></apply><ci id="S3.E2.m1.3.3.3.1.1.1.3.cmml" xref="S3.E2.m1.3.3.3.1.1.1.3">𝑖</ci></apply><apply id="S3.E2.m1.4.4.4.2.2.2.cmml" xref="S3.E2.m1.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.4.2.2.2.1.cmml" xref="S3.E2.m1.4.4.4.2.2.2">subscript</csymbol><apply id="S3.E2.m1.4.4.4.2.2.2.2.cmml" xref="S3.E2.m1.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.4.2.2.2.2.1.cmml" xref="S3.E2.m1.4.4.4.2.2.2">superscript</csymbol><ci id="S3.E2.m1.4.4.4.2.2.2.2.2.cmml" xref="S3.E2.m1.4.4.4.2.2.2.2.2">𝑇</ci><ci id="S3.E2.m1.4.4.4.2.2.2.2.3.cmml" xref="S3.E2.m1.4.4.4.2.2.2.2.3">𝑟</ci></apply><ci id="S3.E2.m1.4.4.4.2.2.2.3.cmml" xref="S3.E2.m1.4.4.4.2.2.2.3">𝑖</ci></apply></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.5c">KR_{s}=\frac{1}{a}\sum_{i=1}^{a}\frac{Acc(\theta^{r}_{g};T^{r}_{i})}{Acc(\theta^{r}_{i};T^{r}_{i})},</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S3.SS2.p7.8" class="ltx_p">where <math id="S3.SS2.p7.2.m1.2" class="ltx_Math" alttext="Acc(\theta^{r}_{g};T^{r}_{i})" display="inline"><semantics id="S3.SS2.p7.2.m1.2a"><mrow id="S3.SS2.p7.2.m1.2.2" xref="S3.SS2.p7.2.m1.2.2.cmml"><mi id="S3.SS2.p7.2.m1.2.2.4" xref="S3.SS2.p7.2.m1.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.2.m1.2.2.3" xref="S3.SS2.p7.2.m1.2.2.3.cmml">​</mo><mi id="S3.SS2.p7.2.m1.2.2.5" xref="S3.SS2.p7.2.m1.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.2.m1.2.2.3a" xref="S3.SS2.p7.2.m1.2.2.3.cmml">​</mo><mi id="S3.SS2.p7.2.m1.2.2.6" xref="S3.SS2.p7.2.m1.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.2.m1.2.2.3b" xref="S3.SS2.p7.2.m1.2.2.3.cmml">​</mo><mrow id="S3.SS2.p7.2.m1.2.2.2.2" xref="S3.SS2.p7.2.m1.2.2.2.3.cmml"><mo stretchy="false" id="S3.SS2.p7.2.m1.2.2.2.2.3" xref="S3.SS2.p7.2.m1.2.2.2.3.cmml">(</mo><msubsup id="S3.SS2.p7.2.m1.1.1.1.1.1" xref="S3.SS2.p7.2.m1.1.1.1.1.1.cmml"><mi id="S3.SS2.p7.2.m1.1.1.1.1.1.2.2" xref="S3.SS2.p7.2.m1.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p7.2.m1.1.1.1.1.1.3" xref="S3.SS2.p7.2.m1.1.1.1.1.1.3.cmml">g</mi><mi id="S3.SS2.p7.2.m1.1.1.1.1.1.2.3" xref="S3.SS2.p7.2.m1.1.1.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.SS2.p7.2.m1.2.2.2.2.4" xref="S3.SS2.p7.2.m1.2.2.2.3.cmml">;</mo><msubsup id="S3.SS2.p7.2.m1.2.2.2.2.2" xref="S3.SS2.p7.2.m1.2.2.2.2.2.cmml"><mi id="S3.SS2.p7.2.m1.2.2.2.2.2.2.2" xref="S3.SS2.p7.2.m1.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.SS2.p7.2.m1.2.2.2.2.2.3" xref="S3.SS2.p7.2.m1.2.2.2.2.2.3.cmml">i</mi><mi id="S3.SS2.p7.2.m1.2.2.2.2.2.2.3" xref="S3.SS2.p7.2.m1.2.2.2.2.2.2.3.cmml">r</mi></msubsup><mo stretchy="false" id="S3.SS2.p7.2.m1.2.2.2.2.5" xref="S3.SS2.p7.2.m1.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.2.m1.2b"><apply id="S3.SS2.p7.2.m1.2.2.cmml" xref="S3.SS2.p7.2.m1.2.2"><times id="S3.SS2.p7.2.m1.2.2.3.cmml" xref="S3.SS2.p7.2.m1.2.2.3"></times><ci id="S3.SS2.p7.2.m1.2.2.4.cmml" xref="S3.SS2.p7.2.m1.2.2.4">𝐴</ci><ci id="S3.SS2.p7.2.m1.2.2.5.cmml" xref="S3.SS2.p7.2.m1.2.2.5">𝑐</ci><ci id="S3.SS2.p7.2.m1.2.2.6.cmml" xref="S3.SS2.p7.2.m1.2.2.6">𝑐</ci><list id="S3.SS2.p7.2.m1.2.2.2.3.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2"><apply id="S3.SS2.p7.2.m1.1.1.1.1.1.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.2.m1.1.1.1.1.1.1.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1">subscript</csymbol><apply id="S3.SS2.p7.2.m1.1.1.1.1.1.2.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.2.m1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.p7.2.m1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1.2.2">𝜃</ci><ci id="S3.SS2.p7.2.m1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.2.m1.1.1.1.1.1.3.cmml" xref="S3.SS2.p7.2.m1.1.1.1.1.1.3">𝑔</ci></apply><apply id="S3.SS2.p7.2.m1.2.2.2.2.2.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p7.2.m1.2.2.2.2.2.1.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2">subscript</csymbol><apply id="S3.SS2.p7.2.m1.2.2.2.2.2.2.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p7.2.m1.2.2.2.2.2.2.1.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2">superscript</csymbol><ci id="S3.SS2.p7.2.m1.2.2.2.2.2.2.2.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2.2.2">𝑇</ci><ci id="S3.SS2.p7.2.m1.2.2.2.2.2.2.3.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.2.m1.2.2.2.2.2.3.cmml" xref="S3.SS2.p7.2.m1.2.2.2.2.2.3">𝑖</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.2.m1.2c">Acc(\theta^{r}_{g};T^{r}_{i})</annotation></semantics></math> denotes the accuracy of the global model <math id="S3.SS2.p7.3.m2.1" class="ltx_Math" alttext="\theta^{r}_{g}" display="inline"><semantics id="S3.SS2.p7.3.m2.1a"><msubsup id="S3.SS2.p7.3.m2.1.1" xref="S3.SS2.p7.3.m2.1.1.cmml"><mi id="S3.SS2.p7.3.m2.1.1.2.2" xref="S3.SS2.p7.3.m2.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p7.3.m2.1.1.3" xref="S3.SS2.p7.3.m2.1.1.3.cmml">g</mi><mi id="S3.SS2.p7.3.m2.1.1.2.3" xref="S3.SS2.p7.3.m2.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.3.m2.1b"><apply id="S3.SS2.p7.3.m2.1.1.cmml" xref="S3.SS2.p7.3.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.3.m2.1.1.1.cmml" xref="S3.SS2.p7.3.m2.1.1">subscript</csymbol><apply id="S3.SS2.p7.3.m2.1.1.2.cmml" xref="S3.SS2.p7.3.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.3.m2.1.1.2.1.cmml" xref="S3.SS2.p7.3.m2.1.1">superscript</csymbol><ci id="S3.SS2.p7.3.m2.1.1.2.2.cmml" xref="S3.SS2.p7.3.m2.1.1.2.2">𝜃</ci><ci id="S3.SS2.p7.3.m2.1.1.2.3.cmml" xref="S3.SS2.p7.3.m2.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.3.m2.1.1.3.cmml" xref="S3.SS2.p7.3.m2.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.3.m2.1c">\theta^{r}_{g}</annotation></semantics></math> on the current local task <math id="S3.SS2.p7.4.m3.1" class="ltx_Math" alttext="T^{r}_{i}" display="inline"><semantics id="S3.SS2.p7.4.m3.1a"><msubsup id="S3.SS2.p7.4.m3.1.1" xref="S3.SS2.p7.4.m3.1.1.cmml"><mi id="S3.SS2.p7.4.m3.1.1.2.2" xref="S3.SS2.p7.4.m3.1.1.2.2.cmml">T</mi><mi id="S3.SS2.p7.4.m3.1.1.3" xref="S3.SS2.p7.4.m3.1.1.3.cmml">i</mi><mi id="S3.SS2.p7.4.m3.1.1.2.3" xref="S3.SS2.p7.4.m3.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.4.m3.1b"><apply id="S3.SS2.p7.4.m3.1.1.cmml" xref="S3.SS2.p7.4.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.4.m3.1.1.1.cmml" xref="S3.SS2.p7.4.m3.1.1">subscript</csymbol><apply id="S3.SS2.p7.4.m3.1.1.2.cmml" xref="S3.SS2.p7.4.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.4.m3.1.1.2.1.cmml" xref="S3.SS2.p7.4.m3.1.1">superscript</csymbol><ci id="S3.SS2.p7.4.m3.1.1.2.2.cmml" xref="S3.SS2.p7.4.m3.1.1.2.2">𝑇</ci><ci id="S3.SS2.p7.4.m3.1.1.2.3.cmml" xref="S3.SS2.p7.4.m3.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.4.m3.1.1.3.cmml" xref="S3.SS2.p7.4.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.4.m3.1c">T^{r}_{i}</annotation></semantics></math> at client <math id="S3.SS2.p7.5.m4.1" class="ltx_Math" alttext="A_{i}" display="inline"><semantics id="S3.SS2.p7.5.m4.1a"><msub id="S3.SS2.p7.5.m4.1.1" xref="S3.SS2.p7.5.m4.1.1.cmml"><mi id="S3.SS2.p7.5.m4.1.1.2" xref="S3.SS2.p7.5.m4.1.1.2.cmml">A</mi><mi id="S3.SS2.p7.5.m4.1.1.3" xref="S3.SS2.p7.5.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.5.m4.1b"><apply id="S3.SS2.p7.5.m4.1.1.cmml" xref="S3.SS2.p7.5.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.5.m4.1.1.1.cmml" xref="S3.SS2.p7.5.m4.1.1">subscript</csymbol><ci id="S3.SS2.p7.5.m4.1.1.2.cmml" xref="S3.SS2.p7.5.m4.1.1.2">𝐴</ci><ci id="S3.SS2.p7.5.m4.1.1.3.cmml" xref="S3.SS2.p7.5.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.5.m4.1c">A_{i}</annotation></semantics></math> and <math id="S3.SS2.p7.6.m5.2" class="ltx_Math" alttext="Acc(\theta^{r}_{i};T^{r}_{i})" display="inline"><semantics id="S3.SS2.p7.6.m5.2a"><mrow id="S3.SS2.p7.6.m5.2.2" xref="S3.SS2.p7.6.m5.2.2.cmml"><mi id="S3.SS2.p7.6.m5.2.2.4" xref="S3.SS2.p7.6.m5.2.2.4.cmml">A</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.6.m5.2.2.3" xref="S3.SS2.p7.6.m5.2.2.3.cmml">​</mo><mi id="S3.SS2.p7.6.m5.2.2.5" xref="S3.SS2.p7.6.m5.2.2.5.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.6.m5.2.2.3a" xref="S3.SS2.p7.6.m5.2.2.3.cmml">​</mo><mi id="S3.SS2.p7.6.m5.2.2.6" xref="S3.SS2.p7.6.m5.2.2.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="S3.SS2.p7.6.m5.2.2.3b" xref="S3.SS2.p7.6.m5.2.2.3.cmml">​</mo><mrow id="S3.SS2.p7.6.m5.2.2.2.2" xref="S3.SS2.p7.6.m5.2.2.2.3.cmml"><mo stretchy="false" id="S3.SS2.p7.6.m5.2.2.2.2.3" xref="S3.SS2.p7.6.m5.2.2.2.3.cmml">(</mo><msubsup id="S3.SS2.p7.6.m5.1.1.1.1.1" xref="S3.SS2.p7.6.m5.1.1.1.1.1.cmml"><mi id="S3.SS2.p7.6.m5.1.1.1.1.1.2.2" xref="S3.SS2.p7.6.m5.1.1.1.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p7.6.m5.1.1.1.1.1.3" xref="S3.SS2.p7.6.m5.1.1.1.1.1.3.cmml">i</mi><mi id="S3.SS2.p7.6.m5.1.1.1.1.1.2.3" xref="S3.SS2.p7.6.m5.1.1.1.1.1.2.3.cmml">r</mi></msubsup><mo id="S3.SS2.p7.6.m5.2.2.2.2.4" xref="S3.SS2.p7.6.m5.2.2.2.3.cmml">;</mo><msubsup id="S3.SS2.p7.6.m5.2.2.2.2.2" xref="S3.SS2.p7.6.m5.2.2.2.2.2.cmml"><mi id="S3.SS2.p7.6.m5.2.2.2.2.2.2.2" xref="S3.SS2.p7.6.m5.2.2.2.2.2.2.2.cmml">T</mi><mi id="S3.SS2.p7.6.m5.2.2.2.2.2.3" xref="S3.SS2.p7.6.m5.2.2.2.2.2.3.cmml">i</mi><mi id="S3.SS2.p7.6.m5.2.2.2.2.2.2.3" xref="S3.SS2.p7.6.m5.2.2.2.2.2.2.3.cmml">r</mi></msubsup><mo stretchy="false" id="S3.SS2.p7.6.m5.2.2.2.2.5" xref="S3.SS2.p7.6.m5.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.6.m5.2b"><apply id="S3.SS2.p7.6.m5.2.2.cmml" xref="S3.SS2.p7.6.m5.2.2"><times id="S3.SS2.p7.6.m5.2.2.3.cmml" xref="S3.SS2.p7.6.m5.2.2.3"></times><ci id="S3.SS2.p7.6.m5.2.2.4.cmml" xref="S3.SS2.p7.6.m5.2.2.4">𝐴</ci><ci id="S3.SS2.p7.6.m5.2.2.5.cmml" xref="S3.SS2.p7.6.m5.2.2.5">𝑐</ci><ci id="S3.SS2.p7.6.m5.2.2.6.cmml" xref="S3.SS2.p7.6.m5.2.2.6">𝑐</ci><list id="S3.SS2.p7.6.m5.2.2.2.3.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2"><apply id="S3.SS2.p7.6.m5.1.1.1.1.1.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.6.m5.1.1.1.1.1.1.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1">subscript</csymbol><apply id="S3.SS2.p7.6.m5.1.1.1.1.1.2.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.6.m5.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.p7.6.m5.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1.2.2">𝜃</ci><ci id="S3.SS2.p7.6.m5.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.6.m5.1.1.1.1.1.3.cmml" xref="S3.SS2.p7.6.m5.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS2.p7.6.m5.2.2.2.2.2.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p7.6.m5.2.2.2.2.2.1.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2">subscript</csymbol><apply id="S3.SS2.p7.6.m5.2.2.2.2.2.2.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p7.6.m5.2.2.2.2.2.2.1.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2">superscript</csymbol><ci id="S3.SS2.p7.6.m5.2.2.2.2.2.2.2.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2.2.2">𝑇</ci><ci id="S3.SS2.p7.6.m5.2.2.2.2.2.2.3.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.6.m5.2.2.2.2.2.3.cmml" xref="S3.SS2.p7.6.m5.2.2.2.2.2.3">𝑖</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.6.m5.2c">Acc(\theta^{r}_{i};T^{r}_{i})</annotation></semantics></math> denotes the accuracy of the local model <math id="S3.SS2.p7.7.m6.1" class="ltx_Math" alttext="\theta^{r}_{i}" display="inline"><semantics id="S3.SS2.p7.7.m6.1a"><msubsup id="S3.SS2.p7.7.m6.1.1" xref="S3.SS2.p7.7.m6.1.1.cmml"><mi id="S3.SS2.p7.7.m6.1.1.2.2" xref="S3.SS2.p7.7.m6.1.1.2.2.cmml">θ</mi><mi id="S3.SS2.p7.7.m6.1.1.3" xref="S3.SS2.p7.7.m6.1.1.3.cmml">i</mi><mi id="S3.SS2.p7.7.m6.1.1.2.3" xref="S3.SS2.p7.7.m6.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.7.m6.1b"><apply id="S3.SS2.p7.7.m6.1.1.cmml" xref="S3.SS2.p7.7.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.7.m6.1.1.1.cmml" xref="S3.SS2.p7.7.m6.1.1">subscript</csymbol><apply id="S3.SS2.p7.7.m6.1.1.2.cmml" xref="S3.SS2.p7.7.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.7.m6.1.1.2.1.cmml" xref="S3.SS2.p7.7.m6.1.1">superscript</csymbol><ci id="S3.SS2.p7.7.m6.1.1.2.2.cmml" xref="S3.SS2.p7.7.m6.1.1.2.2">𝜃</ci><ci id="S3.SS2.p7.7.m6.1.1.2.3.cmml" xref="S3.SS2.p7.7.m6.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.7.m6.1.1.3.cmml" xref="S3.SS2.p7.7.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.7.m6.1c">\theta^{r}_{i}</annotation></semantics></math> on its current local task <math id="S3.SS2.p7.8.m7.1" class="ltx_Math" alttext="T^{r}_{i}" display="inline"><semantics id="S3.SS2.p7.8.m7.1a"><msubsup id="S3.SS2.p7.8.m7.1.1" xref="S3.SS2.p7.8.m7.1.1.cmml"><mi id="S3.SS2.p7.8.m7.1.1.2.2" xref="S3.SS2.p7.8.m7.1.1.2.2.cmml">T</mi><mi id="S3.SS2.p7.8.m7.1.1.3" xref="S3.SS2.p7.8.m7.1.1.3.cmml">i</mi><mi id="S3.SS2.p7.8.m7.1.1.2.3" xref="S3.SS2.p7.8.m7.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.8.m7.1b"><apply id="S3.SS2.p7.8.m7.1.1.cmml" xref="S3.SS2.p7.8.m7.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.8.m7.1.1.1.cmml" xref="S3.SS2.p7.8.m7.1.1">subscript</csymbol><apply id="S3.SS2.p7.8.m7.1.1.2.cmml" xref="S3.SS2.p7.8.m7.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.8.m7.1.1.2.1.cmml" xref="S3.SS2.p7.8.m7.1.1">superscript</csymbol><ci id="S3.SS2.p7.8.m7.1.1.2.2.cmml" xref="S3.SS2.p7.8.m7.1.1.2.2">𝑇</ci><ci id="S3.SS2.p7.8.m7.1.1.2.3.cmml" xref="S3.SS2.p7.8.m7.1.1.2.3">𝑟</ci></apply><ci id="S3.SS2.p7.8.m7.1.1.3.cmml" xref="S3.SS2.p7.8.m7.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.8.m7.1c">T^{r}_{i}</annotation></semantics></math>.</p>
</div>
</section>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Multi-granularity Prompt</h2>

<div id="S4.p1" class="ltx_para">
<p id="S4.p1.1" class="ltx_p">In this section, we elaborate on our proposed Federated Multi-Granularity Prompt (FedMGP), which introduces a multi-granularity knowledge space into PFCL for the first time to better address personalized requirements and spatial-temporal forgetting.</p>
</div>
<div id="S4.p2" class="ltx_para">
<p id="S4.p2.1" class="ltx_p">Specifically, on the client, we design prompts at two granularity levels for knowledge representation, namely <span id="S4.p2.1.1" class="ltx_text ltx_font_italic">Coarse-grained Global Prompt</span> (<span id="S4.p2.1.2" class="ltx_text ltx_font_bold">see <a href="#S4.SS1" title="4.1. Coarse-grained Global Prompt ‣ 4. Multi-granularity Prompt ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 4.1</span></a></span>) and <span id="S4.p2.1.3" class="ltx_text ltx_font_italic">Fine-grained Local Prompt</span> (<span id="S4.p2.1.4" class="ltx_text ltx_font_bold">see <a href="#S4.SS2" title="4.2. Fine-grained Local Prompts ‣ 4. Multi-granularity Prompt ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 4.2</span></a></span>).
Global prompts represent coarse-grained common knowledge, while local prompts, built upon global prompts, represent class-wise fine-grained knowledge. Only fusing the coarse-grained common knowledge facilitates the formation of generalized knowledge and avoids spatial forgetting caused by aggregating fine-grained knowledge. Local prompts based on global prompts aim to personalize the generalized knowledge from the server while preventing temporal forgetting due to class increments.</p>
</div>
<div id="S4.p3" class="ltx_para">
<p id="S4.p3.1" class="ltx_p">On the server side, we devise a new approach for fusing global prompts called <span id="S4.p3.1.1" class="ltx_text ltx_font_italic">Selective Prompt Fusion</span> (<span id="S4.p3.1.2" class="ltx_text ltx_font_bold">see <a href="#S4.SS3" title="4.3. Selective Prompt Fusion ‣ 4. Multi-granularity Prompt ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 4.3</span></a></span>) without spatial forgetting. Aggregating only coarse-grained knowledge not only enhances aggregation speed but also provides further improvements in privacy protection.</p>
</div>
<div id="S4.p4" class="ltx_para">
<p id="S4.p4.1" class="ltx_p">The overall framework of the proposed method is shown in <a href="#S4.F2" title="Figure 2 ‣ 4. Multi-granularity Prompt ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Fig. 2</span></a>, and the algorithm is summarized in <a href="#algorithm1" title="Algorithm 1 ‣ 4. Multi-granularity Prompt ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">algorithm 1</span></a>.</p>
</div>
<figure id="S4.F2" class="ltx_figure"><img src="/html/2407.00113/assets/x2.png" id="S4.F2.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="196" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S4.F2.4.1.1" class="ltx_text" style="font-size:90%;">Figure 2</span>. </span><span id="S4.F2.5.2" class="ltx_text" style="font-size:90%;">An overview of the proposed FedMGP. Two granularities of prompts are used to capture both temporal-spatial invariant knowledge and specific knowledge. The <span id="S4.F2.5.2.1" class="ltx_text ltx_font_italic">coarse-grained global prompt</span> is trained through a shared ViT model, acting on the embedding layer. The <span id="S4.F2.5.2.2" class="ltx_text ltx_font_italic">fine-grained local prompt</span> is built upon the coarse-grained prompt by introducing additional parameters in the MSA layer, enabling the model to better adapt to local data. Moreover, selective prompt fusion is employed to aggregate global prompts on the server side, forming generalized knowledge.</span></figcaption>
</figure>
<figure id="algorithm1" class="ltx_float ltx_algorithm">
<div id="algorithm1.48" class="ltx_listing ltx_lst_numbers_left ltx_listing">
<div id="algorithm1.4.4" class="ltx_listingline">

<span id="algorithm1.4.4.1" class="ltx_text"><span id="algorithm1.4.4.1.1" class="ltx_text ltx_font_bold">Input:</span> </span><math id="algorithm1.1.1.m1.1" class="ltx_Math" alttext="a" display="inline"><semantics id="algorithm1.1.1.m1.1a"><mi id="algorithm1.1.1.m1.1.1" xref="algorithm1.1.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="algorithm1.1.1.m1.1b"><ci id="algorithm1.1.1.m1.1.1.cmml" xref="algorithm1.1.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.1.1.m1.1c">a</annotation></semantics></math> clients <math id="algorithm1.2.2.m2.1" class="ltx_Math" alttext="\mathcal{A}=\{A_{i}\}_{i=1}^{a}" display="inline"><semantics id="algorithm1.2.2.m2.1a"><mrow id="algorithm1.2.2.m2.1.1" xref="algorithm1.2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.2.2.m2.1.1.3" xref="algorithm1.2.2.m2.1.1.3.cmml">𝒜</mi><mo id="algorithm1.2.2.m2.1.1.2" xref="algorithm1.2.2.m2.1.1.2.cmml">=</mo><msubsup id="algorithm1.2.2.m2.1.1.1" xref="algorithm1.2.2.m2.1.1.1.cmml"><mrow id="algorithm1.2.2.m2.1.1.1.1.1.1" xref="algorithm1.2.2.m2.1.1.1.1.1.2.cmml"><mo stretchy="false" id="algorithm1.2.2.m2.1.1.1.1.1.1.2" xref="algorithm1.2.2.m2.1.1.1.1.1.2.cmml">{</mo><msub id="algorithm1.2.2.m2.1.1.1.1.1.1.1" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1.cmml"><mi id="algorithm1.2.2.m2.1.1.1.1.1.1.1.2" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1.2.cmml">A</mi><mi id="algorithm1.2.2.m2.1.1.1.1.1.1.1.3" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo stretchy="false" id="algorithm1.2.2.m2.1.1.1.1.1.1.3" xref="algorithm1.2.2.m2.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="algorithm1.2.2.m2.1.1.1.1.3" xref="algorithm1.2.2.m2.1.1.1.1.3.cmml"><mi id="algorithm1.2.2.m2.1.1.1.1.3.2" xref="algorithm1.2.2.m2.1.1.1.1.3.2.cmml">i</mi><mo id="algorithm1.2.2.m2.1.1.1.1.3.1" xref="algorithm1.2.2.m2.1.1.1.1.3.1.cmml">=</mo><mn id="algorithm1.2.2.m2.1.1.1.1.3.3" xref="algorithm1.2.2.m2.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="algorithm1.2.2.m2.1.1.1.3" xref="algorithm1.2.2.m2.1.1.1.3.cmml">a</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.2.2.m2.1b"><apply id="algorithm1.2.2.m2.1.1.cmml" xref="algorithm1.2.2.m2.1.1"><eq id="algorithm1.2.2.m2.1.1.2.cmml" xref="algorithm1.2.2.m2.1.1.2"></eq><ci id="algorithm1.2.2.m2.1.1.3.cmml" xref="algorithm1.2.2.m2.1.1.3">𝒜</ci><apply id="algorithm1.2.2.m2.1.1.1.cmml" xref="algorithm1.2.2.m2.1.1.1"><csymbol cd="ambiguous" id="algorithm1.2.2.m2.1.1.1.2.cmml" xref="algorithm1.2.2.m2.1.1.1">superscript</csymbol><apply id="algorithm1.2.2.m2.1.1.1.1.cmml" xref="algorithm1.2.2.m2.1.1.1"><csymbol cd="ambiguous" id="algorithm1.2.2.m2.1.1.1.1.2.cmml" xref="algorithm1.2.2.m2.1.1.1">subscript</csymbol><set id="algorithm1.2.2.m2.1.1.1.1.1.2.cmml" xref="algorithm1.2.2.m2.1.1.1.1.1.1"><apply id="algorithm1.2.2.m2.1.1.1.1.1.1.1.cmml" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.2.2.m2.1.1.1.1.1.1.1.1.cmml" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1">subscript</csymbol><ci id="algorithm1.2.2.m2.1.1.1.1.1.1.1.2.cmml" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1.2">𝐴</ci><ci id="algorithm1.2.2.m2.1.1.1.1.1.1.1.3.cmml" xref="algorithm1.2.2.m2.1.1.1.1.1.1.1.3">𝑖</ci></apply></set><apply id="algorithm1.2.2.m2.1.1.1.1.3.cmml" xref="algorithm1.2.2.m2.1.1.1.1.3"><eq id="algorithm1.2.2.m2.1.1.1.1.3.1.cmml" xref="algorithm1.2.2.m2.1.1.1.1.3.1"></eq><ci id="algorithm1.2.2.m2.1.1.1.1.3.2.cmml" xref="algorithm1.2.2.m2.1.1.1.1.3.2">𝑖</ci><cn type="integer" id="algorithm1.2.2.m2.1.1.1.1.3.3.cmml" xref="algorithm1.2.2.m2.1.1.1.1.3.3">1</cn></apply></apply><ci id="algorithm1.2.2.m2.1.1.1.3.cmml" xref="algorithm1.2.2.m2.1.1.1.3">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.2.2.m2.1c">\mathcal{A}=\{A_{i}\}_{i=1}^{a}</annotation></semantics></math> with their own task sequence <math id="algorithm1.3.3.m3.1" class="ltx_Math" alttext="\mathcal{T}_{i}=\{T_{i}^{n}\}_{n=1}^{N}" display="inline"><semantics id="algorithm1.3.3.m3.1a"><mrow id="algorithm1.3.3.m3.1.1" xref="algorithm1.3.3.m3.1.1.cmml"><msub id="algorithm1.3.3.m3.1.1.3" xref="algorithm1.3.3.m3.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.3.3.m3.1.1.3.2" xref="algorithm1.3.3.m3.1.1.3.2.cmml">𝒯</mi><mi id="algorithm1.3.3.m3.1.1.3.3" xref="algorithm1.3.3.m3.1.1.3.3.cmml">i</mi></msub><mo id="algorithm1.3.3.m3.1.1.2" xref="algorithm1.3.3.m3.1.1.2.cmml">=</mo><msubsup id="algorithm1.3.3.m3.1.1.1" xref="algorithm1.3.3.m3.1.1.1.cmml"><mrow id="algorithm1.3.3.m3.1.1.1.1.1.1" xref="algorithm1.3.3.m3.1.1.1.1.1.2.cmml"><mo stretchy="false" id="algorithm1.3.3.m3.1.1.1.1.1.1.2" xref="algorithm1.3.3.m3.1.1.1.1.1.2.cmml">{</mo><msubsup id="algorithm1.3.3.m3.1.1.1.1.1.1.1" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.cmml"><mi id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.2" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.2.cmml">T</mi><mi id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.3" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.3.cmml">i</mi><mi id="algorithm1.3.3.m3.1.1.1.1.1.1.1.3" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.3.cmml">n</mi></msubsup><mo stretchy="false" id="algorithm1.3.3.m3.1.1.1.1.1.1.3" xref="algorithm1.3.3.m3.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="algorithm1.3.3.m3.1.1.1.1.3" xref="algorithm1.3.3.m3.1.1.1.1.3.cmml"><mi id="algorithm1.3.3.m3.1.1.1.1.3.2" xref="algorithm1.3.3.m3.1.1.1.1.3.2.cmml">n</mi><mo id="algorithm1.3.3.m3.1.1.1.1.3.1" xref="algorithm1.3.3.m3.1.1.1.1.3.1.cmml">=</mo><mn id="algorithm1.3.3.m3.1.1.1.1.3.3" xref="algorithm1.3.3.m3.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="algorithm1.3.3.m3.1.1.1.3" xref="algorithm1.3.3.m3.1.1.1.3.cmml">N</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.3.3.m3.1b"><apply id="algorithm1.3.3.m3.1.1.cmml" xref="algorithm1.3.3.m3.1.1"><eq id="algorithm1.3.3.m3.1.1.2.cmml" xref="algorithm1.3.3.m3.1.1.2"></eq><apply id="algorithm1.3.3.m3.1.1.3.cmml" xref="algorithm1.3.3.m3.1.1.3"><csymbol cd="ambiguous" id="algorithm1.3.3.m3.1.1.3.1.cmml" xref="algorithm1.3.3.m3.1.1.3">subscript</csymbol><ci id="algorithm1.3.3.m3.1.1.3.2.cmml" xref="algorithm1.3.3.m3.1.1.3.2">𝒯</ci><ci id="algorithm1.3.3.m3.1.1.3.3.cmml" xref="algorithm1.3.3.m3.1.1.3.3">𝑖</ci></apply><apply id="algorithm1.3.3.m3.1.1.1.cmml" xref="algorithm1.3.3.m3.1.1.1"><csymbol cd="ambiguous" id="algorithm1.3.3.m3.1.1.1.2.cmml" xref="algorithm1.3.3.m3.1.1.1">superscript</csymbol><apply id="algorithm1.3.3.m3.1.1.1.1.cmml" xref="algorithm1.3.3.m3.1.1.1"><csymbol cd="ambiguous" id="algorithm1.3.3.m3.1.1.1.1.2.cmml" xref="algorithm1.3.3.m3.1.1.1">subscript</csymbol><set id="algorithm1.3.3.m3.1.1.1.1.1.2.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1"><apply id="algorithm1.3.3.m3.1.1.1.1.1.1.1.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.3.3.m3.1.1.1.1.1.1.1.1.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1">superscript</csymbol><apply id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.1.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1">subscript</csymbol><ci id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.2.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.2">𝑇</ci><ci id="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.3.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.2.3">𝑖</ci></apply><ci id="algorithm1.3.3.m3.1.1.1.1.1.1.1.3.cmml" xref="algorithm1.3.3.m3.1.1.1.1.1.1.1.3">𝑛</ci></apply></set><apply id="algorithm1.3.3.m3.1.1.1.1.3.cmml" xref="algorithm1.3.3.m3.1.1.1.1.3"><eq id="algorithm1.3.3.m3.1.1.1.1.3.1.cmml" xref="algorithm1.3.3.m3.1.1.1.1.3.1"></eq><ci id="algorithm1.3.3.m3.1.1.1.1.3.2.cmml" xref="algorithm1.3.3.m3.1.1.1.1.3.2">𝑛</ci><cn type="integer" id="algorithm1.3.3.m3.1.1.1.1.3.3.cmml" xref="algorithm1.3.3.m3.1.1.1.1.3.3">1</cn></apply></apply><ci id="algorithm1.3.3.m3.1.1.1.3.cmml" xref="algorithm1.3.3.m3.1.1.1.3">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.3.3.m3.1c">\mathcal{T}_{i}=\{T_{i}^{n}\}_{n=1}^{N}</annotation></semantics></math>, a pre-trained frozen ViT <math id="algorithm1.4.4.m4.1" class="ltx_Math" alttext="\mathcal{V}" display="inline"><semantics id="algorithm1.4.4.m4.1a"><mi class="ltx_font_mathcaligraphic" id="algorithm1.4.4.m4.1.1" xref="algorithm1.4.4.m4.1.1.cmml">𝒱</mi><annotation-xml encoding="MathML-Content" id="algorithm1.4.4.m4.1b"><ci id="algorithm1.4.4.m4.1.1.cmml" xref="algorithm1.4.4.m4.1.1">𝒱</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.4.4.m4.1c">\mathcal{V}</annotation></semantics></math> without classification head.
</div>
<div id="algorithm1.7.7" class="ltx_listingline">
<span id="algorithm1.7.7.1" class="ltx_text"><span id="algorithm1.7.7.1.1" class="ltx_text ltx_font_bold">Output:</span> </span>Fused global prompt pool <math id="algorithm1.5.5.m1.1" class="ltx_Math" alttext="\mathcal{P}_{G}" display="inline"><semantics id="algorithm1.5.5.m1.1a"><msub id="algorithm1.5.5.m1.1.1" xref="algorithm1.5.5.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.5.5.m1.1.1.2" xref="algorithm1.5.5.m1.1.1.2.cmml">𝒫</mi><mi id="algorithm1.5.5.m1.1.1.3" xref="algorithm1.5.5.m1.1.1.3.cmml">G</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.5.5.m1.1b"><apply id="algorithm1.5.5.m1.1.1.cmml" xref="algorithm1.5.5.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.5.5.m1.1.1.1.cmml" xref="algorithm1.5.5.m1.1.1">subscript</csymbol><ci id="algorithm1.5.5.m1.1.1.2.cmml" xref="algorithm1.5.5.m1.1.1.2">𝒫</ci><ci id="algorithm1.5.5.m1.1.1.3.cmml" xref="algorithm1.5.5.m1.1.1.3">𝐺</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.5.5.m1.1c">\mathcal{P}_{G}</annotation></semantics></math>, local prompt pool <math id="algorithm1.6.6.m2.1" class="ltx_Math" alttext="{P}_{l}=\{{P}_{l}^{i}\}_{i=1}^{a}" display="inline"><semantics id="algorithm1.6.6.m2.1a"><mrow id="algorithm1.6.6.m2.1.1" xref="algorithm1.6.6.m2.1.1.cmml"><msub id="algorithm1.6.6.m2.1.1.3" xref="algorithm1.6.6.m2.1.1.3.cmml"><mi id="algorithm1.6.6.m2.1.1.3.2" xref="algorithm1.6.6.m2.1.1.3.2.cmml">P</mi><mi id="algorithm1.6.6.m2.1.1.3.3" xref="algorithm1.6.6.m2.1.1.3.3.cmml">l</mi></msub><mo id="algorithm1.6.6.m2.1.1.2" xref="algorithm1.6.6.m2.1.1.2.cmml">=</mo><msubsup id="algorithm1.6.6.m2.1.1.1" xref="algorithm1.6.6.m2.1.1.1.cmml"><mrow id="algorithm1.6.6.m2.1.1.1.1.1.1" xref="algorithm1.6.6.m2.1.1.1.1.1.2.cmml"><mo stretchy="false" id="algorithm1.6.6.m2.1.1.1.1.1.1.2" xref="algorithm1.6.6.m2.1.1.1.1.1.2.cmml">{</mo><msubsup id="algorithm1.6.6.m2.1.1.1.1.1.1.1" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.cmml"><mi id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.2" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.2.cmml">P</mi><mi id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.3" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.3.cmml">l</mi><mi id="algorithm1.6.6.m2.1.1.1.1.1.1.1.3" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.3.cmml">i</mi></msubsup><mo stretchy="false" id="algorithm1.6.6.m2.1.1.1.1.1.1.3" xref="algorithm1.6.6.m2.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="algorithm1.6.6.m2.1.1.1.1.3" xref="algorithm1.6.6.m2.1.1.1.1.3.cmml"><mi id="algorithm1.6.6.m2.1.1.1.1.3.2" xref="algorithm1.6.6.m2.1.1.1.1.3.2.cmml">i</mi><mo id="algorithm1.6.6.m2.1.1.1.1.3.1" xref="algorithm1.6.6.m2.1.1.1.1.3.1.cmml">=</mo><mn id="algorithm1.6.6.m2.1.1.1.1.3.3" xref="algorithm1.6.6.m2.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="algorithm1.6.6.m2.1.1.1.3" xref="algorithm1.6.6.m2.1.1.1.3.cmml">a</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.6.6.m2.1b"><apply id="algorithm1.6.6.m2.1.1.cmml" xref="algorithm1.6.6.m2.1.1"><eq id="algorithm1.6.6.m2.1.1.2.cmml" xref="algorithm1.6.6.m2.1.1.2"></eq><apply id="algorithm1.6.6.m2.1.1.3.cmml" xref="algorithm1.6.6.m2.1.1.3"><csymbol cd="ambiguous" id="algorithm1.6.6.m2.1.1.3.1.cmml" xref="algorithm1.6.6.m2.1.1.3">subscript</csymbol><ci id="algorithm1.6.6.m2.1.1.3.2.cmml" xref="algorithm1.6.6.m2.1.1.3.2">𝑃</ci><ci id="algorithm1.6.6.m2.1.1.3.3.cmml" xref="algorithm1.6.6.m2.1.1.3.3">𝑙</ci></apply><apply id="algorithm1.6.6.m2.1.1.1.cmml" xref="algorithm1.6.6.m2.1.1.1"><csymbol cd="ambiguous" id="algorithm1.6.6.m2.1.1.1.2.cmml" xref="algorithm1.6.6.m2.1.1.1">superscript</csymbol><apply id="algorithm1.6.6.m2.1.1.1.1.cmml" xref="algorithm1.6.6.m2.1.1.1"><csymbol cd="ambiguous" id="algorithm1.6.6.m2.1.1.1.1.2.cmml" xref="algorithm1.6.6.m2.1.1.1">subscript</csymbol><set id="algorithm1.6.6.m2.1.1.1.1.1.2.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1"><apply id="algorithm1.6.6.m2.1.1.1.1.1.1.1.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.6.6.m2.1.1.1.1.1.1.1.1.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1">superscript</csymbol><apply id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.1.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1">subscript</csymbol><ci id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.2.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.2">𝑃</ci><ci id="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.3.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.6.6.m2.1.1.1.1.1.1.1.3.cmml" xref="algorithm1.6.6.m2.1.1.1.1.1.1.1.3">𝑖</ci></apply></set><apply id="algorithm1.6.6.m2.1.1.1.1.3.cmml" xref="algorithm1.6.6.m2.1.1.1.1.3"><eq id="algorithm1.6.6.m2.1.1.1.1.3.1.cmml" xref="algorithm1.6.6.m2.1.1.1.1.3.1"></eq><ci id="algorithm1.6.6.m2.1.1.1.1.3.2.cmml" xref="algorithm1.6.6.m2.1.1.1.1.3.2">𝑖</ci><cn type="integer" id="algorithm1.6.6.m2.1.1.1.1.3.3.cmml" xref="algorithm1.6.6.m2.1.1.1.1.3.3">1</cn></apply></apply><ci id="algorithm1.6.6.m2.1.1.1.3.cmml" xref="algorithm1.6.6.m2.1.1.1.3">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.6.6.m2.1c">{P}_{l}=\{{P}_{l}^{i}\}_{i=1}^{a}</annotation></semantics></math> of all clients and local classification head <math id="algorithm1.7.7.m3.1" class="ltx_Math" alttext="\mathcal{}{H}_{l}=\{{H}_{l}^{i}\}_{i=1}^{a}" display="inline"><semantics id="algorithm1.7.7.m3.1a"><mrow id="algorithm1.7.7.m3.1.1" xref="algorithm1.7.7.m3.1.1.cmml"><msub id="algorithm1.7.7.m3.1.1.3" xref="algorithm1.7.7.m3.1.1.3.cmml"><mi id="algorithm1.7.7.m3.1.1.3.2" xref="algorithm1.7.7.m3.1.1.3.2.cmml">H</mi><mi id="algorithm1.7.7.m3.1.1.3.3" xref="algorithm1.7.7.m3.1.1.3.3.cmml">l</mi></msub><mo id="algorithm1.7.7.m3.1.1.2" xref="algorithm1.7.7.m3.1.1.2.cmml">=</mo><msubsup id="algorithm1.7.7.m3.1.1.1" xref="algorithm1.7.7.m3.1.1.1.cmml"><mrow id="algorithm1.7.7.m3.1.1.1.1.1.1" xref="algorithm1.7.7.m3.1.1.1.1.1.2.cmml"><mo stretchy="false" id="algorithm1.7.7.m3.1.1.1.1.1.1.2" xref="algorithm1.7.7.m3.1.1.1.1.1.2.cmml">{</mo><msubsup id="algorithm1.7.7.m3.1.1.1.1.1.1.1" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.cmml"><mi id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.2" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.2.cmml">H</mi><mi id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.3" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.3.cmml">l</mi><mi id="algorithm1.7.7.m3.1.1.1.1.1.1.1.3" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.3.cmml">i</mi></msubsup><mo stretchy="false" id="algorithm1.7.7.m3.1.1.1.1.1.1.3" xref="algorithm1.7.7.m3.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="algorithm1.7.7.m3.1.1.1.1.3" xref="algorithm1.7.7.m3.1.1.1.1.3.cmml"><mi id="algorithm1.7.7.m3.1.1.1.1.3.2" xref="algorithm1.7.7.m3.1.1.1.1.3.2.cmml">i</mi><mo id="algorithm1.7.7.m3.1.1.1.1.3.1" xref="algorithm1.7.7.m3.1.1.1.1.3.1.cmml">=</mo><mn id="algorithm1.7.7.m3.1.1.1.1.3.3" xref="algorithm1.7.7.m3.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="algorithm1.7.7.m3.1.1.1.3" xref="algorithm1.7.7.m3.1.1.1.3.cmml">a</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.7.7.m3.1b"><apply id="algorithm1.7.7.m3.1.1.cmml" xref="algorithm1.7.7.m3.1.1"><eq id="algorithm1.7.7.m3.1.1.2.cmml" xref="algorithm1.7.7.m3.1.1.2"></eq><apply id="algorithm1.7.7.m3.1.1.3.cmml" xref="algorithm1.7.7.m3.1.1.3"><csymbol cd="ambiguous" id="algorithm1.7.7.m3.1.1.3.1.cmml" xref="algorithm1.7.7.m3.1.1.3">subscript</csymbol><ci id="algorithm1.7.7.m3.1.1.3.2.cmml" xref="algorithm1.7.7.m3.1.1.3.2">𝐻</ci><ci id="algorithm1.7.7.m3.1.1.3.3.cmml" xref="algorithm1.7.7.m3.1.1.3.3">𝑙</ci></apply><apply id="algorithm1.7.7.m3.1.1.1.cmml" xref="algorithm1.7.7.m3.1.1.1"><csymbol cd="ambiguous" id="algorithm1.7.7.m3.1.1.1.2.cmml" xref="algorithm1.7.7.m3.1.1.1">superscript</csymbol><apply id="algorithm1.7.7.m3.1.1.1.1.cmml" xref="algorithm1.7.7.m3.1.1.1"><csymbol cd="ambiguous" id="algorithm1.7.7.m3.1.1.1.1.2.cmml" xref="algorithm1.7.7.m3.1.1.1">subscript</csymbol><set id="algorithm1.7.7.m3.1.1.1.1.1.2.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1"><apply id="algorithm1.7.7.m3.1.1.1.1.1.1.1.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.7.7.m3.1.1.1.1.1.1.1.1.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1">superscript</csymbol><apply id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.1.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1">subscript</csymbol><ci id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.2.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.2">𝐻</ci><ci id="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.3.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.7.7.m3.1.1.1.1.1.1.1.3.cmml" xref="algorithm1.7.7.m3.1.1.1.1.1.1.1.3">𝑖</ci></apply></set><apply id="algorithm1.7.7.m3.1.1.1.1.3.cmml" xref="algorithm1.7.7.m3.1.1.1.1.3"><eq id="algorithm1.7.7.m3.1.1.1.1.3.1.cmml" xref="algorithm1.7.7.m3.1.1.1.1.3.1"></eq><ci id="algorithm1.7.7.m3.1.1.1.1.3.2.cmml" xref="algorithm1.7.7.m3.1.1.1.1.3.2">𝑖</ci><cn type="integer" id="algorithm1.7.7.m3.1.1.1.1.3.3.cmml" xref="algorithm1.7.7.m3.1.1.1.1.3.3">1</cn></apply></apply><ci id="algorithm1.7.7.m3.1.1.1.3.cmml" xref="algorithm1.7.7.m3.1.1.1.3">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.7.7.m3.1c">\mathcal{}{H}_{l}=\{{H}_{l}^{i}\}_{i=1}^{a}</annotation></semantics></math>. 
</div>
<div id="algorithm1.48.49" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span>

</div>
<div id="algorithm1.48.50" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span>Initialization;
</div>
<div id="algorithm1.8.8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span>
<span id="algorithm1.8.8.2" class="ltx_text ltx_font_bold">while</span> <em id="algorithm1.8.8.1" class="ltx_emph ltx_font_italic">task number n <math id="algorithm1.8.8.1.m1.1" class="ltx_Math" alttext="\leq" display="inline"><semantics id="algorithm1.8.8.1.m1.1a"><mo id="algorithm1.8.8.1.m1.1.1" xref="algorithm1.8.8.1.m1.1.1.cmml">≤</mo><annotation-xml encoding="MathML-Content" id="algorithm1.8.8.1.m1.1b"><leq id="algorithm1.8.8.1.m1.1.1.cmml" xref="algorithm1.8.8.1.m1.1.1"></leq></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.8.8.1.m1.1c">\leq</annotation></semantics></math> N</em> <span id="algorithm1.8.8.3" class="ltx_text ltx_font_bold">do</span>
</div>
<div id="algorithm1.9.9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
<span id="algorithm1.9.9.2" class="ltx_text ltx_font_bold">for</span> <em id="algorithm1.9.9.1" class="ltx_emph ltx_font_italic">each client <math id="algorithm1.9.9.1.m1.2" class="ltx_Math" alttext="A_{i},1\leq i\leq a" display="inline"><semantics id="algorithm1.9.9.1.m1.2a"><mrow id="algorithm1.9.9.1.m1.2.2" xref="algorithm1.9.9.1.m1.2.2.cmml"><mrow id="algorithm1.9.9.1.m1.2.2.1.1" xref="algorithm1.9.9.1.m1.2.2.1.2.cmml"><msub id="algorithm1.9.9.1.m1.2.2.1.1.1" xref="algorithm1.9.9.1.m1.2.2.1.1.1.cmml"><mi id="algorithm1.9.9.1.m1.2.2.1.1.1.2" xref="algorithm1.9.9.1.m1.2.2.1.1.1.2.cmml">A</mi><mi id="algorithm1.9.9.1.m1.2.2.1.1.1.3" xref="algorithm1.9.9.1.m1.2.2.1.1.1.3.cmml">i</mi></msub><mo id="algorithm1.9.9.1.m1.2.2.1.1.2" xref="algorithm1.9.9.1.m1.2.2.1.2.cmml">,</mo><mn id="algorithm1.9.9.1.m1.1.1" xref="algorithm1.9.9.1.m1.1.1.cmml">1</mn></mrow><mo id="algorithm1.9.9.1.m1.2.2.3" xref="algorithm1.9.9.1.m1.2.2.3.cmml">≤</mo><mi id="algorithm1.9.9.1.m1.2.2.4" xref="algorithm1.9.9.1.m1.2.2.4.cmml">i</mi><mo id="algorithm1.9.9.1.m1.2.2.5" xref="algorithm1.9.9.1.m1.2.2.5.cmml">≤</mo><mi id="algorithm1.9.9.1.m1.2.2.6" xref="algorithm1.9.9.1.m1.2.2.6.cmml">a</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.9.9.1.m1.2b"><apply id="algorithm1.9.9.1.m1.2.2.cmml" xref="algorithm1.9.9.1.m1.2.2"><and id="algorithm1.9.9.1.m1.2.2a.cmml" xref="algorithm1.9.9.1.m1.2.2"></and><apply id="algorithm1.9.9.1.m1.2.2b.cmml" xref="algorithm1.9.9.1.m1.2.2"><leq id="algorithm1.9.9.1.m1.2.2.3.cmml" xref="algorithm1.9.9.1.m1.2.2.3"></leq><list id="algorithm1.9.9.1.m1.2.2.1.2.cmml" xref="algorithm1.9.9.1.m1.2.2.1.1"><apply id="algorithm1.9.9.1.m1.2.2.1.1.1.cmml" xref="algorithm1.9.9.1.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="algorithm1.9.9.1.m1.2.2.1.1.1.1.cmml" xref="algorithm1.9.9.1.m1.2.2.1.1.1">subscript</csymbol><ci id="algorithm1.9.9.1.m1.2.2.1.1.1.2.cmml" xref="algorithm1.9.9.1.m1.2.2.1.1.1.2">𝐴</ci><ci id="algorithm1.9.9.1.m1.2.2.1.1.1.3.cmml" xref="algorithm1.9.9.1.m1.2.2.1.1.1.3">𝑖</ci></apply><cn type="integer" id="algorithm1.9.9.1.m1.1.1.cmml" xref="algorithm1.9.9.1.m1.1.1">1</cn></list><ci id="algorithm1.9.9.1.m1.2.2.4.cmml" xref="algorithm1.9.9.1.m1.2.2.4">𝑖</ci></apply><apply id="algorithm1.9.9.1.m1.2.2c.cmml" xref="algorithm1.9.9.1.m1.2.2"><leq id="algorithm1.9.9.1.m1.2.2.5.cmml" xref="algorithm1.9.9.1.m1.2.2.5"></leq><share href="#algorithm1.9.9.1.m1.2.2.4.cmml" id="algorithm1.9.9.1.m1.2.2d.cmml" xref="algorithm1.9.9.1.m1.2.2"></share><ci id="algorithm1.9.9.1.m1.2.2.6.cmml" xref="algorithm1.9.9.1.m1.2.2.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.9.9.1.m1.2c">A_{i},1\leq i\leq a</annotation></semantics></math></em> <span id="algorithm1.9.9.3" class="ltx_text ltx_font_bold">do</span>
</div>
<div id="algorithm1.12.12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
<math id="algorithm1.10.10.m1.1" class="ltx_Math" alttext="\mathcal{V}_{g}^{i}" display="inline"><semantics id="algorithm1.10.10.m1.1a"><msubsup id="algorithm1.10.10.m1.1.1" xref="algorithm1.10.10.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.10.10.m1.1.1.2.2" xref="algorithm1.10.10.m1.1.1.2.2.cmml">𝒱</mi><mi id="algorithm1.10.10.m1.1.1.2.3" xref="algorithm1.10.10.m1.1.1.2.3.cmml">g</mi><mi id="algorithm1.10.10.m1.1.1.3" xref="algorithm1.10.10.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="algorithm1.10.10.m1.1b"><apply id="algorithm1.10.10.m1.1.1.cmml" xref="algorithm1.10.10.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.10.10.m1.1.1.1.cmml" xref="algorithm1.10.10.m1.1.1">superscript</csymbol><apply id="algorithm1.10.10.m1.1.1.2.cmml" xref="algorithm1.10.10.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.10.10.m1.1.1.2.1.cmml" xref="algorithm1.10.10.m1.1.1">subscript</csymbol><ci id="algorithm1.10.10.m1.1.1.2.2.cmml" xref="algorithm1.10.10.m1.1.1.2.2">𝒱</ci><ci id="algorithm1.10.10.m1.1.1.2.3.cmml" xref="algorithm1.10.10.m1.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.10.10.m1.1.1.3.cmml" xref="algorithm1.10.10.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.10.10.m1.1c">\mathcal{V}_{g}^{i}</annotation></semantics></math> <math id="algorithm1.11.11.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.11.11.m2.1a"><mo stretchy="false" id="algorithm1.11.11.m2.1.1" xref="algorithm1.11.11.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.11.11.m2.1b"><ci id="algorithm1.11.11.m2.1.1.cmml" xref="algorithm1.11.11.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.11.11.m2.1c">\leftarrow</annotation></semantics></math> LoadGHead(<math id="algorithm1.12.12.m3.2" class="ltx_Math" alttext="{H}_{g}^{i},\mathcal{V}" display="inline"><semantics id="algorithm1.12.12.m3.2a"><mrow id="algorithm1.12.12.m3.2.2.1" xref="algorithm1.12.12.m3.2.2.2.cmml"><msubsup id="algorithm1.12.12.m3.2.2.1.1" xref="algorithm1.12.12.m3.2.2.1.1.cmml"><mi id="algorithm1.12.12.m3.2.2.1.1.2.2" xref="algorithm1.12.12.m3.2.2.1.1.2.2.cmml">H</mi><mi id="algorithm1.12.12.m3.2.2.1.1.2.3" xref="algorithm1.12.12.m3.2.2.1.1.2.3.cmml">g</mi><mi id="algorithm1.12.12.m3.2.2.1.1.3" xref="algorithm1.12.12.m3.2.2.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.12.12.m3.2.2.1.2" xref="algorithm1.12.12.m3.2.2.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="algorithm1.12.12.m3.1.1" xref="algorithm1.12.12.m3.1.1.cmml">𝒱</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.12.12.m3.2b"><list id="algorithm1.12.12.m3.2.2.2.cmml" xref="algorithm1.12.12.m3.2.2.1"><apply id="algorithm1.12.12.m3.2.2.1.1.cmml" xref="algorithm1.12.12.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.12.12.m3.2.2.1.1.1.cmml" xref="algorithm1.12.12.m3.2.2.1.1">superscript</csymbol><apply id="algorithm1.12.12.m3.2.2.1.1.2.cmml" xref="algorithm1.12.12.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.12.12.m3.2.2.1.1.2.1.cmml" xref="algorithm1.12.12.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.12.12.m3.2.2.1.1.2.2.cmml" xref="algorithm1.12.12.m3.2.2.1.1.2.2">𝐻</ci><ci id="algorithm1.12.12.m3.2.2.1.1.2.3.cmml" xref="algorithm1.12.12.m3.2.2.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.12.12.m3.2.2.1.1.3.cmml" xref="algorithm1.12.12.m3.2.2.1.1.3">𝑖</ci></apply><ci id="algorithm1.12.12.m3.1.1.cmml" xref="algorithm1.12.12.m3.1.1">𝒱</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.12.12.m3.2c">{H}_{g}^{i},\mathcal{V}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.51" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.48.52" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.48.52.1" class="ltx_text ltx_font_bold">Training global prompts:</span>

</div>
<div id="algorithm1.13.13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.13.13.2" class="ltx_text ltx_font_bold">for</span> <em id="algorithm1.13.13.1" class="ltx_emph ltx_font_italic">each <math id="algorithm1.13.13.1.m1.2" class="ltx_Math" alttext="\{x,y\}\in T_{i}^{n}" display="inline"><semantics id="algorithm1.13.13.1.m1.2a"><mrow id="algorithm1.13.13.1.m1.2.3" xref="algorithm1.13.13.1.m1.2.3.cmml"><mrow id="algorithm1.13.13.1.m1.2.3.2.2" xref="algorithm1.13.13.1.m1.2.3.2.1.cmml"><mo stretchy="false" id="algorithm1.13.13.1.m1.2.3.2.2.1" xref="algorithm1.13.13.1.m1.2.3.2.1.cmml">{</mo><mi id="algorithm1.13.13.1.m1.1.1" xref="algorithm1.13.13.1.m1.1.1.cmml">x</mi><mo id="algorithm1.13.13.1.m1.2.3.2.2.2" xref="algorithm1.13.13.1.m1.2.3.2.1.cmml">,</mo><mi id="algorithm1.13.13.1.m1.2.2" xref="algorithm1.13.13.1.m1.2.2.cmml">y</mi><mo stretchy="false" id="algorithm1.13.13.1.m1.2.3.2.2.3" xref="algorithm1.13.13.1.m1.2.3.2.1.cmml">}</mo></mrow><mo id="algorithm1.13.13.1.m1.2.3.1" xref="algorithm1.13.13.1.m1.2.3.1.cmml">∈</mo><msubsup id="algorithm1.13.13.1.m1.2.3.3" xref="algorithm1.13.13.1.m1.2.3.3.cmml"><mi id="algorithm1.13.13.1.m1.2.3.3.2.2" xref="algorithm1.13.13.1.m1.2.3.3.2.2.cmml">T</mi><mi id="algorithm1.13.13.1.m1.2.3.3.2.3" xref="algorithm1.13.13.1.m1.2.3.3.2.3.cmml">i</mi><mi id="algorithm1.13.13.1.m1.2.3.3.3" xref="algorithm1.13.13.1.m1.2.3.3.3.cmml">n</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.13.13.1.m1.2b"><apply id="algorithm1.13.13.1.m1.2.3.cmml" xref="algorithm1.13.13.1.m1.2.3"><in id="algorithm1.13.13.1.m1.2.3.1.cmml" xref="algorithm1.13.13.1.m1.2.3.1"></in><set id="algorithm1.13.13.1.m1.2.3.2.1.cmml" xref="algorithm1.13.13.1.m1.2.3.2.2"><ci id="algorithm1.13.13.1.m1.1.1.cmml" xref="algorithm1.13.13.1.m1.1.1">𝑥</ci><ci id="algorithm1.13.13.1.m1.2.2.cmml" xref="algorithm1.13.13.1.m1.2.2">𝑦</ci></set><apply id="algorithm1.13.13.1.m1.2.3.3.cmml" xref="algorithm1.13.13.1.m1.2.3.3"><csymbol cd="ambiguous" id="algorithm1.13.13.1.m1.2.3.3.1.cmml" xref="algorithm1.13.13.1.m1.2.3.3">superscript</csymbol><apply id="algorithm1.13.13.1.m1.2.3.3.2.cmml" xref="algorithm1.13.13.1.m1.2.3.3"><csymbol cd="ambiguous" id="algorithm1.13.13.1.m1.2.3.3.2.1.cmml" xref="algorithm1.13.13.1.m1.2.3.3">subscript</csymbol><ci id="algorithm1.13.13.1.m1.2.3.3.2.2.cmml" xref="algorithm1.13.13.1.m1.2.3.3.2.2">𝑇</ci><ci id="algorithm1.13.13.1.m1.2.3.3.2.3.cmml" xref="algorithm1.13.13.1.m1.2.3.3.2.3">𝑖</ci></apply><ci id="algorithm1.13.13.1.m1.2.3.3.3.cmml" xref="algorithm1.13.13.1.m1.2.3.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.13.13.1.m1.2c">\{x,y\}\in T_{i}^{n}</annotation></semantics></math></em> <span id="algorithm1.13.13.3" class="ltx_text ltx_font_bold">do</span>
</div>
<div id="algorithm1.16.16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   
<math id="algorithm1.14.14.m1.1" class="ltx_Math" alttext="E" display="inline"><semantics id="algorithm1.14.14.m1.1a"><mi id="algorithm1.14.14.m1.1.1" xref="algorithm1.14.14.m1.1.1.cmml">E</mi><annotation-xml encoding="MathML-Content" id="algorithm1.14.14.m1.1b"><ci id="algorithm1.14.14.m1.1.1.cmml" xref="algorithm1.14.14.m1.1.1">𝐸</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.14.14.m1.1c">E</annotation></semantics></math> <math id="algorithm1.15.15.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.15.15.m2.1a"><mo stretchy="false" id="algorithm1.15.15.m2.1.1" xref="algorithm1.15.15.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.15.15.m2.1b"><ci id="algorithm1.15.15.m2.1.1.cmml" xref="algorithm1.15.15.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.15.15.m2.1c">\leftarrow</annotation></semantics></math> EmbeddingLayer(<math id="algorithm1.16.16.m3.1" class="ltx_Math" alttext="x" display="inline"><semantics id="algorithm1.16.16.m3.1a"><mi id="algorithm1.16.16.m3.1.1" xref="algorithm1.16.16.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="algorithm1.16.16.m3.1b"><ci id="algorithm1.16.16.m3.1.1.cmml" xref="algorithm1.16.16.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.16.16.m3.1c">x</annotation></semantics></math>);
</div>
<div id="algorithm1.48.53" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.19.19" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.17.17.m1.2" class="ltx_Math" alttext="\{{K}_{g},P_{g}\}" display="inline"><semantics id="algorithm1.17.17.m1.2a"><mrow id="algorithm1.17.17.m1.2.2.2" xref="algorithm1.17.17.m1.2.2.3.cmml"><mo stretchy="false" id="algorithm1.17.17.m1.2.2.2.3" xref="algorithm1.17.17.m1.2.2.3.cmml">{</mo><msub id="algorithm1.17.17.m1.1.1.1.1" xref="algorithm1.17.17.m1.1.1.1.1.cmml"><mi id="algorithm1.17.17.m1.1.1.1.1.2" xref="algorithm1.17.17.m1.1.1.1.1.2.cmml">K</mi><mi id="algorithm1.17.17.m1.1.1.1.1.3" xref="algorithm1.17.17.m1.1.1.1.1.3.cmml">g</mi></msub><mo id="algorithm1.17.17.m1.2.2.2.4" xref="algorithm1.17.17.m1.2.2.3.cmml">,</mo><msub id="algorithm1.17.17.m1.2.2.2.2" xref="algorithm1.17.17.m1.2.2.2.2.cmml"><mi id="algorithm1.17.17.m1.2.2.2.2.2" xref="algorithm1.17.17.m1.2.2.2.2.2.cmml">P</mi><mi id="algorithm1.17.17.m1.2.2.2.2.3" xref="algorithm1.17.17.m1.2.2.2.2.3.cmml">g</mi></msub><mo stretchy="false" id="algorithm1.17.17.m1.2.2.2.5" xref="algorithm1.17.17.m1.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.17.17.m1.2b"><set id="algorithm1.17.17.m1.2.2.3.cmml" xref="algorithm1.17.17.m1.2.2.2"><apply id="algorithm1.17.17.m1.1.1.1.1.cmml" xref="algorithm1.17.17.m1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.17.17.m1.1.1.1.1.1.cmml" xref="algorithm1.17.17.m1.1.1.1.1">subscript</csymbol><ci id="algorithm1.17.17.m1.1.1.1.1.2.cmml" xref="algorithm1.17.17.m1.1.1.1.1.2">𝐾</ci><ci id="algorithm1.17.17.m1.1.1.1.1.3.cmml" xref="algorithm1.17.17.m1.1.1.1.1.3">𝑔</ci></apply><apply id="algorithm1.17.17.m1.2.2.2.2.cmml" xref="algorithm1.17.17.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.17.17.m1.2.2.2.2.1.cmml" xref="algorithm1.17.17.m1.2.2.2.2">subscript</csymbol><ci id="algorithm1.17.17.m1.2.2.2.2.2.cmml" xref="algorithm1.17.17.m1.2.2.2.2.2">𝑃</ci><ci id="algorithm1.17.17.m1.2.2.2.2.3.cmml" xref="algorithm1.17.17.m1.2.2.2.2.3">𝑔</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.17.17.m1.2c">\{{K}_{g},P_{g}\}</annotation></semantics></math> <math id="algorithm1.18.18.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.18.18.m2.1a"><mo stretchy="false" id="algorithm1.18.18.m2.1.1" xref="algorithm1.18.18.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.18.18.m2.1b"><ci id="algorithm1.18.18.m2.1.1.cmml" xref="algorithm1.18.18.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.18.18.m2.1c">\leftarrow</annotation></semantics></math> GlobalQueryFunction(<math id="algorithm1.19.19.m3.3" class="ltx_Math" alttext="{P}_{g}^{i},E,\mathcal{V}" display="inline"><semantics id="algorithm1.19.19.m3.3a"><mrow id="algorithm1.19.19.m3.3.3.1" xref="algorithm1.19.19.m3.3.3.2.cmml"><msubsup id="algorithm1.19.19.m3.3.3.1.1" xref="algorithm1.19.19.m3.3.3.1.1.cmml"><mi id="algorithm1.19.19.m3.3.3.1.1.2.2" xref="algorithm1.19.19.m3.3.3.1.1.2.2.cmml">P</mi><mi id="algorithm1.19.19.m3.3.3.1.1.2.3" xref="algorithm1.19.19.m3.3.3.1.1.2.3.cmml">g</mi><mi id="algorithm1.19.19.m3.3.3.1.1.3" xref="algorithm1.19.19.m3.3.3.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.19.19.m3.3.3.1.2" xref="algorithm1.19.19.m3.3.3.2.cmml">,</mo><mi id="algorithm1.19.19.m3.1.1" xref="algorithm1.19.19.m3.1.1.cmml">E</mi><mo id="algorithm1.19.19.m3.3.3.1.3" xref="algorithm1.19.19.m3.3.3.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="algorithm1.19.19.m3.2.2" xref="algorithm1.19.19.m3.2.2.cmml">𝒱</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.19.19.m3.3b"><list id="algorithm1.19.19.m3.3.3.2.cmml" xref="algorithm1.19.19.m3.3.3.1"><apply id="algorithm1.19.19.m3.3.3.1.1.cmml" xref="algorithm1.19.19.m3.3.3.1.1"><csymbol cd="ambiguous" id="algorithm1.19.19.m3.3.3.1.1.1.cmml" xref="algorithm1.19.19.m3.3.3.1.1">superscript</csymbol><apply id="algorithm1.19.19.m3.3.3.1.1.2.cmml" xref="algorithm1.19.19.m3.3.3.1.1"><csymbol cd="ambiguous" id="algorithm1.19.19.m3.3.3.1.1.2.1.cmml" xref="algorithm1.19.19.m3.3.3.1.1">subscript</csymbol><ci id="algorithm1.19.19.m3.3.3.1.1.2.2.cmml" xref="algorithm1.19.19.m3.3.3.1.1.2.2">𝑃</ci><ci id="algorithm1.19.19.m3.3.3.1.1.2.3.cmml" xref="algorithm1.19.19.m3.3.3.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.19.19.m3.3.3.1.1.3.cmml" xref="algorithm1.19.19.m3.3.3.1.1.3">𝑖</ci></apply><ci id="algorithm1.19.19.m3.1.1.cmml" xref="algorithm1.19.19.m3.1.1">𝐸</ci><ci id="algorithm1.19.19.m3.2.2.cmml" xref="algorithm1.19.19.m3.2.2">𝒱</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.19.19.m3.3c">{P}_{g}^{i},E,\mathcal{V}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.54" class="ltx_listingline">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>    <span id="algorithm1.48.54.1" class="ltx_text ltx_font_typewriter">// </span><span id="algorithm1.48.54.2" class="ltx_text ltx_font_typewriter">Key-value pair. </span>
</div>
<div id="algorithm1.48.55" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.22.22" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.20.20.m1.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="algorithm1.20.20.m1.1a"><msup id="algorithm1.20.20.m1.1.1" xref="algorithm1.20.20.m1.1.1.cmml"><mi id="algorithm1.20.20.m1.1.1.2" xref="algorithm1.20.20.m1.1.1.2.cmml">E</mi><mo id="algorithm1.20.20.m1.1.1.3" xref="algorithm1.20.20.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="algorithm1.20.20.m1.1b"><apply id="algorithm1.20.20.m1.1.1.cmml" xref="algorithm1.20.20.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.20.20.m1.1.1.1.cmml" xref="algorithm1.20.20.m1.1.1">superscript</csymbol><ci id="algorithm1.20.20.m1.1.1.2.cmml" xref="algorithm1.20.20.m1.1.1.2">𝐸</ci><ci id="algorithm1.20.20.m1.1.1.3.cmml" xref="algorithm1.20.20.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.20.20.m1.1c">E^{\prime}</annotation></semantics></math> <math id="algorithm1.21.21.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.21.21.m2.1a"><mo stretchy="false" id="algorithm1.21.21.m2.1.1" xref="algorithm1.21.21.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.21.21.m2.1b"><ci id="algorithm1.21.21.m2.1.1.cmml" xref="algorithm1.21.21.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.21.21.m2.1c">\leftarrow</annotation></semantics></math> AppendGP(<math id="algorithm1.22.22.m3.2" class="ltx_Math" alttext="E,P_{g}" display="inline"><semantics id="algorithm1.22.22.m3.2a"><mrow id="algorithm1.22.22.m3.2.2.1" xref="algorithm1.22.22.m3.2.2.2.cmml"><mi id="algorithm1.22.22.m3.1.1" xref="algorithm1.22.22.m3.1.1.cmml">E</mi><mo id="algorithm1.22.22.m3.2.2.1.2" xref="algorithm1.22.22.m3.2.2.2.cmml">,</mo><msub id="algorithm1.22.22.m3.2.2.1.1" xref="algorithm1.22.22.m3.2.2.1.1.cmml"><mi id="algorithm1.22.22.m3.2.2.1.1.2" xref="algorithm1.22.22.m3.2.2.1.1.2.cmml">P</mi><mi id="algorithm1.22.22.m3.2.2.1.1.3" xref="algorithm1.22.22.m3.2.2.1.1.3.cmml">g</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.22.22.m3.2b"><list id="algorithm1.22.22.m3.2.2.2.cmml" xref="algorithm1.22.22.m3.2.2.1"><ci id="algorithm1.22.22.m3.1.1.cmml" xref="algorithm1.22.22.m3.1.1">𝐸</ci><apply id="algorithm1.22.22.m3.2.2.1.1.cmml" xref="algorithm1.22.22.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.22.22.m3.2.2.1.1.1.cmml" xref="algorithm1.22.22.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.22.22.m3.2.2.1.1.2.cmml" xref="algorithm1.22.22.m3.2.2.1.1.2">𝑃</ci><ci id="algorithm1.22.22.m3.2.2.1.1.3.cmml" xref="algorithm1.22.22.m3.2.2.1.1.3">𝑔</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.22.22.m3.2c">E,P_{g}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.56" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.25.25" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.23.23.m1.1" class="ltx_Math" alttext="L_{g}" display="inline"><semantics id="algorithm1.23.23.m1.1a"><msub id="algorithm1.23.23.m1.1.1" xref="algorithm1.23.23.m1.1.1.cmml"><mi id="algorithm1.23.23.m1.1.1.2" xref="algorithm1.23.23.m1.1.1.2.cmml">L</mi><mi id="algorithm1.23.23.m1.1.1.3" xref="algorithm1.23.23.m1.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.23.23.m1.1b"><apply id="algorithm1.23.23.m1.1.1.cmml" xref="algorithm1.23.23.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.23.23.m1.1.1.1.cmml" xref="algorithm1.23.23.m1.1.1">subscript</csymbol><ci id="algorithm1.23.23.m1.1.1.2.cmml" xref="algorithm1.23.23.m1.1.1.2">𝐿</ci><ci id="algorithm1.23.23.m1.1.1.3.cmml" xref="algorithm1.23.23.m1.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.23.23.m1.1c">L_{g}</annotation></semantics></math> <math id="algorithm1.24.24.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.24.24.m2.1a"><mo stretchy="false" id="algorithm1.24.24.m2.1.1" xref="algorithm1.24.24.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.24.24.m2.1b"><ci id="algorithm1.24.24.m2.1.1.cmml" xref="algorithm1.24.24.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.24.24.m2.1c">\leftarrow</annotation></semantics></math> Classify(<math id="algorithm1.25.25.m3.3" class="ltx_Math" alttext="\mathcal{V}_{g}^{i},E^{\prime},Y" display="inline"><semantics id="algorithm1.25.25.m3.3a"><mrow id="algorithm1.25.25.m3.3.3.2" xref="algorithm1.25.25.m3.3.3.3.cmml"><msubsup id="algorithm1.25.25.m3.2.2.1.1" xref="algorithm1.25.25.m3.2.2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.25.25.m3.2.2.1.1.2.2" xref="algorithm1.25.25.m3.2.2.1.1.2.2.cmml">𝒱</mi><mi id="algorithm1.25.25.m3.2.2.1.1.2.3" xref="algorithm1.25.25.m3.2.2.1.1.2.3.cmml">g</mi><mi id="algorithm1.25.25.m3.2.2.1.1.3" xref="algorithm1.25.25.m3.2.2.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.25.25.m3.3.3.2.3" xref="algorithm1.25.25.m3.3.3.3.cmml">,</mo><msup id="algorithm1.25.25.m3.3.3.2.2" xref="algorithm1.25.25.m3.3.3.2.2.cmml"><mi id="algorithm1.25.25.m3.3.3.2.2.2" xref="algorithm1.25.25.m3.3.3.2.2.2.cmml">E</mi><mo id="algorithm1.25.25.m3.3.3.2.2.3" xref="algorithm1.25.25.m3.3.3.2.2.3.cmml">′</mo></msup><mo id="algorithm1.25.25.m3.3.3.2.4" xref="algorithm1.25.25.m3.3.3.3.cmml">,</mo><mi id="algorithm1.25.25.m3.1.1" xref="algorithm1.25.25.m3.1.1.cmml">Y</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.25.25.m3.3b"><list id="algorithm1.25.25.m3.3.3.3.cmml" xref="algorithm1.25.25.m3.3.3.2"><apply id="algorithm1.25.25.m3.2.2.1.1.cmml" xref="algorithm1.25.25.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.25.25.m3.2.2.1.1.1.cmml" xref="algorithm1.25.25.m3.2.2.1.1">superscript</csymbol><apply id="algorithm1.25.25.m3.2.2.1.1.2.cmml" xref="algorithm1.25.25.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.25.25.m3.2.2.1.1.2.1.cmml" xref="algorithm1.25.25.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.25.25.m3.2.2.1.1.2.2.cmml" xref="algorithm1.25.25.m3.2.2.1.1.2.2">𝒱</ci><ci id="algorithm1.25.25.m3.2.2.1.1.2.3.cmml" xref="algorithm1.25.25.m3.2.2.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.25.25.m3.2.2.1.1.3.cmml" xref="algorithm1.25.25.m3.2.2.1.1.3">𝑖</ci></apply><apply id="algorithm1.25.25.m3.3.3.2.2.cmml" xref="algorithm1.25.25.m3.3.3.2.2"><csymbol cd="ambiguous" id="algorithm1.25.25.m3.3.3.2.2.1.cmml" xref="algorithm1.25.25.m3.3.3.2.2">superscript</csymbol><ci id="algorithm1.25.25.m3.3.3.2.2.2.cmml" xref="algorithm1.25.25.m3.3.3.2.2.2">𝐸</ci><ci id="algorithm1.25.25.m3.3.3.2.2.3.cmml" xref="algorithm1.25.25.m3.3.3.2.2.3">′</ci></apply><ci id="algorithm1.25.25.m3.1.1.cmml" xref="algorithm1.25.25.m3.1.1">𝑌</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.25.25.m3.3c">\mathcal{V}_{g}^{i},E^{\prime},Y</annotation></semantics></math>) ;
</div>
<div id="algorithm1.26.26" class="ltx_listingline">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>    <span id="algorithm1.26.26.2" class="ltx_text ltx_font_typewriter">// </span><span id="algorithm1.26.26.1" class="ltx_text ltx_font_typewriter">Classification loss with <math id="algorithm1.26.26.1.m1.1" class="ltx_Math" alttext="\mathcal{V}_{g}^{i}" display="inline"><semantics id="algorithm1.26.26.1.m1.1a"><msubsup id="algorithm1.26.26.1.m1.1.1" xref="algorithm1.26.26.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.26.26.1.m1.1.1.2.2" xref="algorithm1.26.26.1.m1.1.1.2.2.cmml">𝒱</mi><mi id="algorithm1.26.26.1.m1.1.1.2.3" xref="algorithm1.26.26.1.m1.1.1.2.3.cmml">g</mi><mi id="algorithm1.26.26.1.m1.1.1.3" xref="algorithm1.26.26.1.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="algorithm1.26.26.1.m1.1b"><apply id="algorithm1.26.26.1.m1.1.1.cmml" xref="algorithm1.26.26.1.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.26.26.1.m1.1.1.1.cmml" xref="algorithm1.26.26.1.m1.1.1">superscript</csymbol><apply id="algorithm1.26.26.1.m1.1.1.2.cmml" xref="algorithm1.26.26.1.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.26.26.1.m1.1.1.2.1.cmml" xref="algorithm1.26.26.1.m1.1.1">subscript</csymbol><ci id="algorithm1.26.26.1.m1.1.1.2.2.cmml" xref="algorithm1.26.26.1.m1.1.1.2.2">𝒱</ci><ci id="algorithm1.26.26.1.m1.1.1.2.3.cmml" xref="algorithm1.26.26.1.m1.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.26.26.1.m1.1.1.3.cmml" xref="algorithm1.26.26.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.26.26.1.m1.1c">\mathcal{V}_{g}^{i}</annotation></semantics></math>. </span>
</div>
<div id="algorithm1.48.57" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.27.27" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   Optimize(<math id="algorithm1.27.27.m1.4" class="ltx_Math" alttext="L_{g},{H}_{g}^{i},{K}_{g},P_{g}" display="inline"><semantics id="algorithm1.27.27.m1.4a"><mrow id="algorithm1.27.27.m1.4.4.4" xref="algorithm1.27.27.m1.4.4.5.cmml"><msub id="algorithm1.27.27.m1.1.1.1.1" xref="algorithm1.27.27.m1.1.1.1.1.cmml"><mi id="algorithm1.27.27.m1.1.1.1.1.2" xref="algorithm1.27.27.m1.1.1.1.1.2.cmml">L</mi><mi id="algorithm1.27.27.m1.1.1.1.1.3" xref="algorithm1.27.27.m1.1.1.1.1.3.cmml">g</mi></msub><mo id="algorithm1.27.27.m1.4.4.4.5" xref="algorithm1.27.27.m1.4.4.5.cmml">,</mo><msubsup id="algorithm1.27.27.m1.2.2.2.2" xref="algorithm1.27.27.m1.2.2.2.2.cmml"><mi id="algorithm1.27.27.m1.2.2.2.2.2.2" xref="algorithm1.27.27.m1.2.2.2.2.2.2.cmml">H</mi><mi id="algorithm1.27.27.m1.2.2.2.2.2.3" xref="algorithm1.27.27.m1.2.2.2.2.2.3.cmml">g</mi><mi id="algorithm1.27.27.m1.2.2.2.2.3" xref="algorithm1.27.27.m1.2.2.2.2.3.cmml">i</mi></msubsup><mo id="algorithm1.27.27.m1.4.4.4.6" xref="algorithm1.27.27.m1.4.4.5.cmml">,</mo><msub id="algorithm1.27.27.m1.3.3.3.3" xref="algorithm1.27.27.m1.3.3.3.3.cmml"><mi id="algorithm1.27.27.m1.3.3.3.3.2" xref="algorithm1.27.27.m1.3.3.3.3.2.cmml">K</mi><mi id="algorithm1.27.27.m1.3.3.3.3.3" xref="algorithm1.27.27.m1.3.3.3.3.3.cmml">g</mi></msub><mo id="algorithm1.27.27.m1.4.4.4.7" xref="algorithm1.27.27.m1.4.4.5.cmml">,</mo><msub id="algorithm1.27.27.m1.4.4.4.4" xref="algorithm1.27.27.m1.4.4.4.4.cmml"><mi id="algorithm1.27.27.m1.4.4.4.4.2" xref="algorithm1.27.27.m1.4.4.4.4.2.cmml">P</mi><mi id="algorithm1.27.27.m1.4.4.4.4.3" xref="algorithm1.27.27.m1.4.4.4.4.3.cmml">g</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.27.27.m1.4b"><list id="algorithm1.27.27.m1.4.4.5.cmml" xref="algorithm1.27.27.m1.4.4.4"><apply id="algorithm1.27.27.m1.1.1.1.1.cmml" xref="algorithm1.27.27.m1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.27.27.m1.1.1.1.1.1.cmml" xref="algorithm1.27.27.m1.1.1.1.1">subscript</csymbol><ci id="algorithm1.27.27.m1.1.1.1.1.2.cmml" xref="algorithm1.27.27.m1.1.1.1.1.2">𝐿</ci><ci id="algorithm1.27.27.m1.1.1.1.1.3.cmml" xref="algorithm1.27.27.m1.1.1.1.1.3">𝑔</ci></apply><apply id="algorithm1.27.27.m1.2.2.2.2.cmml" xref="algorithm1.27.27.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.27.27.m1.2.2.2.2.1.cmml" xref="algorithm1.27.27.m1.2.2.2.2">superscript</csymbol><apply id="algorithm1.27.27.m1.2.2.2.2.2.cmml" xref="algorithm1.27.27.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.27.27.m1.2.2.2.2.2.1.cmml" xref="algorithm1.27.27.m1.2.2.2.2">subscript</csymbol><ci id="algorithm1.27.27.m1.2.2.2.2.2.2.cmml" xref="algorithm1.27.27.m1.2.2.2.2.2.2">𝐻</ci><ci id="algorithm1.27.27.m1.2.2.2.2.2.3.cmml" xref="algorithm1.27.27.m1.2.2.2.2.2.3">𝑔</ci></apply><ci id="algorithm1.27.27.m1.2.2.2.2.3.cmml" xref="algorithm1.27.27.m1.2.2.2.2.3">𝑖</ci></apply><apply id="algorithm1.27.27.m1.3.3.3.3.cmml" xref="algorithm1.27.27.m1.3.3.3.3"><csymbol cd="ambiguous" id="algorithm1.27.27.m1.3.3.3.3.1.cmml" xref="algorithm1.27.27.m1.3.3.3.3">subscript</csymbol><ci id="algorithm1.27.27.m1.3.3.3.3.2.cmml" xref="algorithm1.27.27.m1.3.3.3.3.2">𝐾</ci><ci id="algorithm1.27.27.m1.3.3.3.3.3.cmml" xref="algorithm1.27.27.m1.3.3.3.3.3">𝑔</ci></apply><apply id="algorithm1.27.27.m1.4.4.4.4.cmml" xref="algorithm1.27.27.m1.4.4.4.4"><csymbol cd="ambiguous" id="algorithm1.27.27.m1.4.4.4.4.1.cmml" xref="algorithm1.27.27.m1.4.4.4.4">subscript</csymbol><ci id="algorithm1.27.27.m1.4.4.4.4.2.cmml" xref="algorithm1.27.27.m1.4.4.4.4.2">𝑃</ci><ci id="algorithm1.27.27.m1.4.4.4.4.3.cmml" xref="algorithm1.27.27.m1.4.4.4.4.3">𝑔</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.27.27.m1.4c">L_{g},{H}_{g}^{i},{K}_{g},P_{g}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.58" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.48.59" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.48.59.1" class="ltx_text ltx_font_bold">Freeze global prompts;</span>

</div>
<div id="algorithm1.48.60" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.48.60.1" class="ltx_text ltx_font_bold">Training local prompts:</span>

</div>
<div id="algorithm1.28.28" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.28.28.2" class="ltx_text ltx_font_bold">for</span> <em id="algorithm1.28.28.1" class="ltx_emph ltx_font_italic">each <math id="algorithm1.28.28.1.m1.2" class="ltx_Math" alttext="\{x,y\}\in T_{i}^{n}" display="inline"><semantics id="algorithm1.28.28.1.m1.2a"><mrow id="algorithm1.28.28.1.m1.2.3" xref="algorithm1.28.28.1.m1.2.3.cmml"><mrow id="algorithm1.28.28.1.m1.2.3.2.2" xref="algorithm1.28.28.1.m1.2.3.2.1.cmml"><mo stretchy="false" id="algorithm1.28.28.1.m1.2.3.2.2.1" xref="algorithm1.28.28.1.m1.2.3.2.1.cmml">{</mo><mi id="algorithm1.28.28.1.m1.1.1" xref="algorithm1.28.28.1.m1.1.1.cmml">x</mi><mo id="algorithm1.28.28.1.m1.2.3.2.2.2" xref="algorithm1.28.28.1.m1.2.3.2.1.cmml">,</mo><mi id="algorithm1.28.28.1.m1.2.2" xref="algorithm1.28.28.1.m1.2.2.cmml">y</mi><mo stretchy="false" id="algorithm1.28.28.1.m1.2.3.2.2.3" xref="algorithm1.28.28.1.m1.2.3.2.1.cmml">}</mo></mrow><mo id="algorithm1.28.28.1.m1.2.3.1" xref="algorithm1.28.28.1.m1.2.3.1.cmml">∈</mo><msubsup id="algorithm1.28.28.1.m1.2.3.3" xref="algorithm1.28.28.1.m1.2.3.3.cmml"><mi id="algorithm1.28.28.1.m1.2.3.3.2.2" xref="algorithm1.28.28.1.m1.2.3.3.2.2.cmml">T</mi><mi id="algorithm1.28.28.1.m1.2.3.3.2.3" xref="algorithm1.28.28.1.m1.2.3.3.2.3.cmml">i</mi><mi id="algorithm1.28.28.1.m1.2.3.3.3" xref="algorithm1.28.28.1.m1.2.3.3.3.cmml">n</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.28.28.1.m1.2b"><apply id="algorithm1.28.28.1.m1.2.3.cmml" xref="algorithm1.28.28.1.m1.2.3"><in id="algorithm1.28.28.1.m1.2.3.1.cmml" xref="algorithm1.28.28.1.m1.2.3.1"></in><set id="algorithm1.28.28.1.m1.2.3.2.1.cmml" xref="algorithm1.28.28.1.m1.2.3.2.2"><ci id="algorithm1.28.28.1.m1.1.1.cmml" xref="algorithm1.28.28.1.m1.1.1">𝑥</ci><ci id="algorithm1.28.28.1.m1.2.2.cmml" xref="algorithm1.28.28.1.m1.2.2">𝑦</ci></set><apply id="algorithm1.28.28.1.m1.2.3.3.cmml" xref="algorithm1.28.28.1.m1.2.3.3"><csymbol cd="ambiguous" id="algorithm1.28.28.1.m1.2.3.3.1.cmml" xref="algorithm1.28.28.1.m1.2.3.3">superscript</csymbol><apply id="algorithm1.28.28.1.m1.2.3.3.2.cmml" xref="algorithm1.28.28.1.m1.2.3.3"><csymbol cd="ambiguous" id="algorithm1.28.28.1.m1.2.3.3.2.1.cmml" xref="algorithm1.28.28.1.m1.2.3.3">subscript</csymbol><ci id="algorithm1.28.28.1.m1.2.3.3.2.2.cmml" xref="algorithm1.28.28.1.m1.2.3.3.2.2">𝑇</ci><ci id="algorithm1.28.28.1.m1.2.3.3.2.3.cmml" xref="algorithm1.28.28.1.m1.2.3.3.2.3">𝑖</ci></apply><ci id="algorithm1.28.28.1.m1.2.3.3.3.cmml" xref="algorithm1.28.28.1.m1.2.3.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.28.28.1.m1.2c">\{x,y\}\in T_{i}^{n}</annotation></semantics></math></em> <span id="algorithm1.28.28.3" class="ltx_text ltx_font_bold">do</span>
</div>
<div id="algorithm1.48.61" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">22</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.31.31" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">23</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.29.29.m1.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="algorithm1.29.29.m1.1a"><msup id="algorithm1.29.29.m1.1.1" xref="algorithm1.29.29.m1.1.1.cmml"><mi id="algorithm1.29.29.m1.1.1.2" xref="algorithm1.29.29.m1.1.1.2.cmml">E</mi><mo id="algorithm1.29.29.m1.1.1.3" xref="algorithm1.29.29.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="algorithm1.29.29.m1.1b"><apply id="algorithm1.29.29.m1.1.1.cmml" xref="algorithm1.29.29.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.29.29.m1.1.1.1.cmml" xref="algorithm1.29.29.m1.1.1">superscript</csymbol><ci id="algorithm1.29.29.m1.1.1.2.cmml" xref="algorithm1.29.29.m1.1.1.2">𝐸</ci><ci id="algorithm1.29.29.m1.1.1.3.cmml" xref="algorithm1.29.29.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.29.29.m1.1c">E^{\prime}</annotation></semantics></math> <math id="algorithm1.30.30.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.30.30.m2.1a"><mo stretchy="false" id="algorithm1.30.30.m2.1.1" xref="algorithm1.30.30.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.30.30.m2.1b"><ci id="algorithm1.30.30.m2.1.1.cmml" xref="algorithm1.30.30.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.30.30.m2.1c">\leftarrow</annotation></semantics></math> GetGlobalPrompt(<math id="algorithm1.31.31.m3.3" class="ltx_Math" alttext="x,\mathcal{P}_{g}^{i},\mathcal{V}" display="inline"><semantics id="algorithm1.31.31.m3.3a"><mrow id="algorithm1.31.31.m3.3.3.1" xref="algorithm1.31.31.m3.3.3.2.cmml"><mi id="algorithm1.31.31.m3.1.1" xref="algorithm1.31.31.m3.1.1.cmml">x</mi><mo id="algorithm1.31.31.m3.3.3.1.2" xref="algorithm1.31.31.m3.3.3.2.cmml">,</mo><msubsup id="algorithm1.31.31.m3.3.3.1.1" xref="algorithm1.31.31.m3.3.3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.31.31.m3.3.3.1.1.2.2" xref="algorithm1.31.31.m3.3.3.1.1.2.2.cmml">𝒫</mi><mi id="algorithm1.31.31.m3.3.3.1.1.2.3" xref="algorithm1.31.31.m3.3.3.1.1.2.3.cmml">g</mi><mi id="algorithm1.31.31.m3.3.3.1.1.3" xref="algorithm1.31.31.m3.3.3.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.31.31.m3.3.3.1.3" xref="algorithm1.31.31.m3.3.3.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="algorithm1.31.31.m3.2.2" xref="algorithm1.31.31.m3.2.2.cmml">𝒱</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.31.31.m3.3b"><list id="algorithm1.31.31.m3.3.3.2.cmml" xref="algorithm1.31.31.m3.3.3.1"><ci id="algorithm1.31.31.m3.1.1.cmml" xref="algorithm1.31.31.m3.1.1">𝑥</ci><apply id="algorithm1.31.31.m3.3.3.1.1.cmml" xref="algorithm1.31.31.m3.3.3.1.1"><csymbol cd="ambiguous" id="algorithm1.31.31.m3.3.3.1.1.1.cmml" xref="algorithm1.31.31.m3.3.3.1.1">superscript</csymbol><apply id="algorithm1.31.31.m3.3.3.1.1.2.cmml" xref="algorithm1.31.31.m3.3.3.1.1"><csymbol cd="ambiguous" id="algorithm1.31.31.m3.3.3.1.1.2.1.cmml" xref="algorithm1.31.31.m3.3.3.1.1">subscript</csymbol><ci id="algorithm1.31.31.m3.3.3.1.1.2.2.cmml" xref="algorithm1.31.31.m3.3.3.1.1.2.2">𝒫</ci><ci id="algorithm1.31.31.m3.3.3.1.1.2.3.cmml" xref="algorithm1.31.31.m3.3.3.1.1.2.3">𝑔</ci></apply><ci id="algorithm1.31.31.m3.3.3.1.1.3.cmml" xref="algorithm1.31.31.m3.3.3.1.1.3">𝑖</ci></apply><ci id="algorithm1.31.31.m3.2.2.cmml" xref="algorithm1.31.31.m3.2.2">𝒱</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.31.31.m3.3c">x,\mathcal{P}_{g}^{i},\mathcal{V}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.62" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">24</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.34.34" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">25</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.32.32.m1.2" class="ltx_Math" alttext="\{{K}_{l},P_{l}\}" display="inline"><semantics id="algorithm1.32.32.m1.2a"><mrow id="algorithm1.32.32.m1.2.2.2" xref="algorithm1.32.32.m1.2.2.3.cmml"><mo stretchy="false" id="algorithm1.32.32.m1.2.2.2.3" xref="algorithm1.32.32.m1.2.2.3.cmml">{</mo><msub id="algorithm1.32.32.m1.1.1.1.1" xref="algorithm1.32.32.m1.1.1.1.1.cmml"><mi id="algorithm1.32.32.m1.1.1.1.1.2" xref="algorithm1.32.32.m1.1.1.1.1.2.cmml">K</mi><mi id="algorithm1.32.32.m1.1.1.1.1.3" xref="algorithm1.32.32.m1.1.1.1.1.3.cmml">l</mi></msub><mo id="algorithm1.32.32.m1.2.2.2.4" xref="algorithm1.32.32.m1.2.2.3.cmml">,</mo><msub id="algorithm1.32.32.m1.2.2.2.2" xref="algorithm1.32.32.m1.2.2.2.2.cmml"><mi id="algorithm1.32.32.m1.2.2.2.2.2" xref="algorithm1.32.32.m1.2.2.2.2.2.cmml">P</mi><mi id="algorithm1.32.32.m1.2.2.2.2.3" xref="algorithm1.32.32.m1.2.2.2.2.3.cmml">l</mi></msub><mo stretchy="false" id="algorithm1.32.32.m1.2.2.2.5" xref="algorithm1.32.32.m1.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.32.32.m1.2b"><set id="algorithm1.32.32.m1.2.2.3.cmml" xref="algorithm1.32.32.m1.2.2.2"><apply id="algorithm1.32.32.m1.1.1.1.1.cmml" xref="algorithm1.32.32.m1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.32.32.m1.1.1.1.1.1.cmml" xref="algorithm1.32.32.m1.1.1.1.1">subscript</csymbol><ci id="algorithm1.32.32.m1.1.1.1.1.2.cmml" xref="algorithm1.32.32.m1.1.1.1.1.2">𝐾</ci><ci id="algorithm1.32.32.m1.1.1.1.1.3.cmml" xref="algorithm1.32.32.m1.1.1.1.1.3">𝑙</ci></apply><apply id="algorithm1.32.32.m1.2.2.2.2.cmml" xref="algorithm1.32.32.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.32.32.m1.2.2.2.2.1.cmml" xref="algorithm1.32.32.m1.2.2.2.2">subscript</csymbol><ci id="algorithm1.32.32.m1.2.2.2.2.2.cmml" xref="algorithm1.32.32.m1.2.2.2.2.2">𝑃</ci><ci id="algorithm1.32.32.m1.2.2.2.2.3.cmml" xref="algorithm1.32.32.m1.2.2.2.2.3">𝑙</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.32.32.m1.2c">\{{K}_{l},P_{l}\}</annotation></semantics></math> <math id="algorithm1.33.33.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.33.33.m2.1a"><mo stretchy="false" id="algorithm1.33.33.m2.1.1" xref="algorithm1.33.33.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.33.33.m2.1b"><ci id="algorithm1.33.33.m2.1.1.cmml" xref="algorithm1.33.33.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.33.33.m2.1c">\leftarrow</annotation></semantics></math> LocalQueryFunction(<math id="algorithm1.34.34.m3.3" class="ltx_Math" alttext="\mathcal{P}_{l}^{i},E^{\prime},\mathcal{V}" display="inline"><semantics id="algorithm1.34.34.m3.3a"><mrow id="algorithm1.34.34.m3.3.3.2" xref="algorithm1.34.34.m3.3.3.3.cmml"><msubsup id="algorithm1.34.34.m3.2.2.1.1" xref="algorithm1.34.34.m3.2.2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.34.34.m3.2.2.1.1.2.2" xref="algorithm1.34.34.m3.2.2.1.1.2.2.cmml">𝒫</mi><mi id="algorithm1.34.34.m3.2.2.1.1.2.3" xref="algorithm1.34.34.m3.2.2.1.1.2.3.cmml">l</mi><mi id="algorithm1.34.34.m3.2.2.1.1.3" xref="algorithm1.34.34.m3.2.2.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.34.34.m3.3.3.2.3" xref="algorithm1.34.34.m3.3.3.3.cmml">,</mo><msup id="algorithm1.34.34.m3.3.3.2.2" xref="algorithm1.34.34.m3.3.3.2.2.cmml"><mi id="algorithm1.34.34.m3.3.3.2.2.2" xref="algorithm1.34.34.m3.3.3.2.2.2.cmml">E</mi><mo id="algorithm1.34.34.m3.3.3.2.2.3" xref="algorithm1.34.34.m3.3.3.2.2.3.cmml">′</mo></msup><mo id="algorithm1.34.34.m3.3.3.2.4" xref="algorithm1.34.34.m3.3.3.3.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="algorithm1.34.34.m3.1.1" xref="algorithm1.34.34.m3.1.1.cmml">𝒱</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.34.34.m3.3b"><list id="algorithm1.34.34.m3.3.3.3.cmml" xref="algorithm1.34.34.m3.3.3.2"><apply id="algorithm1.34.34.m3.2.2.1.1.cmml" xref="algorithm1.34.34.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.34.34.m3.2.2.1.1.1.cmml" xref="algorithm1.34.34.m3.2.2.1.1">superscript</csymbol><apply id="algorithm1.34.34.m3.2.2.1.1.2.cmml" xref="algorithm1.34.34.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.34.34.m3.2.2.1.1.2.1.cmml" xref="algorithm1.34.34.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.34.34.m3.2.2.1.1.2.2.cmml" xref="algorithm1.34.34.m3.2.2.1.1.2.2">𝒫</ci><ci id="algorithm1.34.34.m3.2.2.1.1.2.3.cmml" xref="algorithm1.34.34.m3.2.2.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.34.34.m3.2.2.1.1.3.cmml" xref="algorithm1.34.34.m3.2.2.1.1.3">𝑖</ci></apply><apply id="algorithm1.34.34.m3.3.3.2.2.cmml" xref="algorithm1.34.34.m3.3.3.2.2"><csymbol cd="ambiguous" id="algorithm1.34.34.m3.3.3.2.2.1.cmml" xref="algorithm1.34.34.m3.3.3.2.2">superscript</csymbol><ci id="algorithm1.34.34.m3.3.3.2.2.2.cmml" xref="algorithm1.34.34.m3.3.3.2.2.2">𝐸</ci><ci id="algorithm1.34.34.m3.3.3.2.2.3.cmml" xref="algorithm1.34.34.m3.3.3.2.2.3">′</ci></apply><ci id="algorithm1.34.34.m3.1.1.cmml" xref="algorithm1.34.34.m3.1.1">𝒱</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.34.34.m3.3c">\mathcal{P}_{l}^{i},E^{\prime},\mathcal{V}</annotation></semantics></math>);

</div>
<div id="algorithm1.38.38" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">26</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.35.35.m1.1" class="ltx_Math" alttext="\mathcal{V}_{l}^{i}" display="inline"><semantics id="algorithm1.35.35.m1.1a"><msubsup id="algorithm1.35.35.m1.1.1" xref="algorithm1.35.35.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.35.35.m1.1.1.2.2" xref="algorithm1.35.35.m1.1.1.2.2.cmml">𝒱</mi><mi id="algorithm1.35.35.m1.1.1.2.3" xref="algorithm1.35.35.m1.1.1.2.3.cmml">l</mi><mi id="algorithm1.35.35.m1.1.1.3" xref="algorithm1.35.35.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="algorithm1.35.35.m1.1b"><apply id="algorithm1.35.35.m1.1.1.cmml" xref="algorithm1.35.35.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.35.35.m1.1.1.1.cmml" xref="algorithm1.35.35.m1.1.1">superscript</csymbol><apply id="algorithm1.35.35.m1.1.1.2.cmml" xref="algorithm1.35.35.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.35.35.m1.1.1.2.1.cmml" xref="algorithm1.35.35.m1.1.1">subscript</csymbol><ci id="algorithm1.35.35.m1.1.1.2.2.cmml" xref="algorithm1.35.35.m1.1.1.2.2">𝒱</ci><ci id="algorithm1.35.35.m1.1.1.2.3.cmml" xref="algorithm1.35.35.m1.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.35.35.m1.1.1.3.cmml" xref="algorithm1.35.35.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.35.35.m1.1c">\mathcal{V}_{l}^{i}</annotation></semantics></math> <math id="algorithm1.36.36.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.36.36.m2.1a"><mo stretchy="false" id="algorithm1.36.36.m2.1.1" xref="algorithm1.36.36.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.36.36.m2.1b"><ci id="algorithm1.36.36.m2.1.1.cmml" xref="algorithm1.36.36.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.36.36.m2.1c">\leftarrow</annotation></semantics></math> LoadLocalPrompt&amp;Head(<math id="algorithm1.37.37.m3.2" class="ltx_Math" alttext="{H}_{l}^{i},\mathcal{V}" display="inline"><semantics id="algorithm1.37.37.m3.2a"><mrow id="algorithm1.37.37.m3.2.2.1" xref="algorithm1.37.37.m3.2.2.2.cmml"><msubsup id="algorithm1.37.37.m3.2.2.1.1" xref="algorithm1.37.37.m3.2.2.1.1.cmml"><mi id="algorithm1.37.37.m3.2.2.1.1.2.2" xref="algorithm1.37.37.m3.2.2.1.1.2.2.cmml">H</mi><mi id="algorithm1.37.37.m3.2.2.1.1.2.3" xref="algorithm1.37.37.m3.2.2.1.1.2.3.cmml">l</mi><mi id="algorithm1.37.37.m3.2.2.1.1.3" xref="algorithm1.37.37.m3.2.2.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.37.37.m3.2.2.1.2" xref="algorithm1.37.37.m3.2.2.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="algorithm1.37.37.m3.1.1" xref="algorithm1.37.37.m3.1.1.cmml">𝒱</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.37.37.m3.2b"><list id="algorithm1.37.37.m3.2.2.2.cmml" xref="algorithm1.37.37.m3.2.2.1"><apply id="algorithm1.37.37.m3.2.2.1.1.cmml" xref="algorithm1.37.37.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.37.37.m3.2.2.1.1.1.cmml" xref="algorithm1.37.37.m3.2.2.1.1">superscript</csymbol><apply id="algorithm1.37.37.m3.2.2.1.1.2.cmml" xref="algorithm1.37.37.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.37.37.m3.2.2.1.1.2.1.cmml" xref="algorithm1.37.37.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.37.37.m3.2.2.1.1.2.2.cmml" xref="algorithm1.37.37.m3.2.2.1.1.2.2">𝐻</ci><ci id="algorithm1.37.37.m3.2.2.1.1.2.3.cmml" xref="algorithm1.37.37.m3.2.2.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.37.37.m3.2.2.1.1.3.cmml" xref="algorithm1.37.37.m3.2.2.1.1.3">𝑖</ci></apply><ci id="algorithm1.37.37.m3.1.1.cmml" xref="algorithm1.37.37.m3.1.1">𝒱</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.37.37.m3.2c">{H}_{l}^{i},\mathcal{V}</annotation></semantics></math>,<math id="algorithm1.38.38.m4.1" class="ltx_Math" alttext="P_{l}" display="inline"><semantics id="algorithm1.38.38.m4.1a"><msub id="algorithm1.38.38.m4.1.1" xref="algorithm1.38.38.m4.1.1.cmml"><mi id="algorithm1.38.38.m4.1.1.2" xref="algorithm1.38.38.m4.1.1.2.cmml">P</mi><mi id="algorithm1.38.38.m4.1.1.3" xref="algorithm1.38.38.m4.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.38.38.m4.1b"><apply id="algorithm1.38.38.m4.1.1.cmml" xref="algorithm1.38.38.m4.1.1"><csymbol cd="ambiguous" id="algorithm1.38.38.m4.1.1.1.cmml" xref="algorithm1.38.38.m4.1.1">subscript</csymbol><ci id="algorithm1.38.38.m4.1.1.2.cmml" xref="algorithm1.38.38.m4.1.1.2">𝑃</ci><ci id="algorithm1.38.38.m4.1.1.3.cmml" xref="algorithm1.38.38.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.38.38.m4.1c">P_{l}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.63" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">27</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.41.41" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">28</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.39.39.m1.1" class="ltx_Math" alttext="L_{l}" display="inline"><semantics id="algorithm1.39.39.m1.1a"><msub id="algorithm1.39.39.m1.1.1" xref="algorithm1.39.39.m1.1.1.cmml"><mi id="algorithm1.39.39.m1.1.1.2" xref="algorithm1.39.39.m1.1.1.2.cmml">L</mi><mi id="algorithm1.39.39.m1.1.1.3" xref="algorithm1.39.39.m1.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.39.39.m1.1b"><apply id="algorithm1.39.39.m1.1.1.cmml" xref="algorithm1.39.39.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.39.39.m1.1.1.1.cmml" xref="algorithm1.39.39.m1.1.1">subscript</csymbol><ci id="algorithm1.39.39.m1.1.1.2.cmml" xref="algorithm1.39.39.m1.1.1.2">𝐿</ci><ci id="algorithm1.39.39.m1.1.1.3.cmml" xref="algorithm1.39.39.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.39.39.m1.1c">L_{l}</annotation></semantics></math> <math id="algorithm1.40.40.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.40.40.m2.1a"><mo stretchy="false" id="algorithm1.40.40.m2.1.1" xref="algorithm1.40.40.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.40.40.m2.1b"><ci id="algorithm1.40.40.m2.1.1.cmml" xref="algorithm1.40.40.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.40.40.m2.1c">\leftarrow</annotation></semantics></math> Classify(<math id="algorithm1.41.41.m3.3" class="ltx_Math" alttext="\mathcal{V}_{l}^{i},E^{\prime},Y" display="inline"><semantics id="algorithm1.41.41.m3.3a"><mrow id="algorithm1.41.41.m3.3.3.2" xref="algorithm1.41.41.m3.3.3.3.cmml"><msubsup id="algorithm1.41.41.m3.2.2.1.1" xref="algorithm1.41.41.m3.2.2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.41.41.m3.2.2.1.1.2.2" xref="algorithm1.41.41.m3.2.2.1.1.2.2.cmml">𝒱</mi><mi id="algorithm1.41.41.m3.2.2.1.1.2.3" xref="algorithm1.41.41.m3.2.2.1.1.2.3.cmml">l</mi><mi id="algorithm1.41.41.m3.2.2.1.1.3" xref="algorithm1.41.41.m3.2.2.1.1.3.cmml">i</mi></msubsup><mo id="algorithm1.41.41.m3.3.3.2.3" xref="algorithm1.41.41.m3.3.3.3.cmml">,</mo><msup id="algorithm1.41.41.m3.3.3.2.2" xref="algorithm1.41.41.m3.3.3.2.2.cmml"><mi id="algorithm1.41.41.m3.3.3.2.2.2" xref="algorithm1.41.41.m3.3.3.2.2.2.cmml">E</mi><mo id="algorithm1.41.41.m3.3.3.2.2.3" xref="algorithm1.41.41.m3.3.3.2.2.3.cmml">′</mo></msup><mo id="algorithm1.41.41.m3.3.3.2.4" xref="algorithm1.41.41.m3.3.3.3.cmml">,</mo><mi id="algorithm1.41.41.m3.1.1" xref="algorithm1.41.41.m3.1.1.cmml">Y</mi></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.41.41.m3.3b"><list id="algorithm1.41.41.m3.3.3.3.cmml" xref="algorithm1.41.41.m3.3.3.2"><apply id="algorithm1.41.41.m3.2.2.1.1.cmml" xref="algorithm1.41.41.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.41.41.m3.2.2.1.1.1.cmml" xref="algorithm1.41.41.m3.2.2.1.1">superscript</csymbol><apply id="algorithm1.41.41.m3.2.2.1.1.2.cmml" xref="algorithm1.41.41.m3.2.2.1.1"><csymbol cd="ambiguous" id="algorithm1.41.41.m3.2.2.1.1.2.1.cmml" xref="algorithm1.41.41.m3.2.2.1.1">subscript</csymbol><ci id="algorithm1.41.41.m3.2.2.1.1.2.2.cmml" xref="algorithm1.41.41.m3.2.2.1.1.2.2">𝒱</ci><ci id="algorithm1.41.41.m3.2.2.1.1.2.3.cmml" xref="algorithm1.41.41.m3.2.2.1.1.2.3">𝑙</ci></apply><ci id="algorithm1.41.41.m3.2.2.1.1.3.cmml" xref="algorithm1.41.41.m3.2.2.1.1.3">𝑖</ci></apply><apply id="algorithm1.41.41.m3.3.3.2.2.cmml" xref="algorithm1.41.41.m3.3.3.2.2"><csymbol cd="ambiguous" id="algorithm1.41.41.m3.3.3.2.2.1.cmml" xref="algorithm1.41.41.m3.3.3.2.2">superscript</csymbol><ci id="algorithm1.41.41.m3.3.3.2.2.2.cmml" xref="algorithm1.41.41.m3.3.3.2.2.2">𝐸</ci><ci id="algorithm1.41.41.m3.3.3.2.2.3.cmml" xref="algorithm1.41.41.m3.3.3.2.2.3">′</ci></apply><ci id="algorithm1.41.41.m3.1.1.cmml" xref="algorithm1.41.41.m3.1.1">𝑌</ci></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.41.41.m3.3c">\mathcal{V}_{l}^{i},E^{\prime},Y</annotation></semantics></math>);

</div>
<div id="algorithm1.42.42" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">29</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   Optimize(<math id="algorithm1.42.42.m1.4" class="ltx_Math" alttext="L_{l},\mathcal{H}_{l}^{i},{K}_{l},P_{l}" display="inline"><semantics id="algorithm1.42.42.m1.4a"><mrow id="algorithm1.42.42.m1.4.4.4" xref="algorithm1.42.42.m1.4.4.5.cmml"><msub id="algorithm1.42.42.m1.1.1.1.1" xref="algorithm1.42.42.m1.1.1.1.1.cmml"><mi id="algorithm1.42.42.m1.1.1.1.1.2" xref="algorithm1.42.42.m1.1.1.1.1.2.cmml">L</mi><mi id="algorithm1.42.42.m1.1.1.1.1.3" xref="algorithm1.42.42.m1.1.1.1.1.3.cmml">l</mi></msub><mo id="algorithm1.42.42.m1.4.4.4.5" xref="algorithm1.42.42.m1.4.4.5.cmml">,</mo><msubsup id="algorithm1.42.42.m1.2.2.2.2" xref="algorithm1.42.42.m1.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.42.42.m1.2.2.2.2.2.2" xref="algorithm1.42.42.m1.2.2.2.2.2.2.cmml">ℋ</mi><mi id="algorithm1.42.42.m1.2.2.2.2.2.3" xref="algorithm1.42.42.m1.2.2.2.2.2.3.cmml">l</mi><mi id="algorithm1.42.42.m1.2.2.2.2.3" xref="algorithm1.42.42.m1.2.2.2.2.3.cmml">i</mi></msubsup><mo id="algorithm1.42.42.m1.4.4.4.6" xref="algorithm1.42.42.m1.4.4.5.cmml">,</mo><msub id="algorithm1.42.42.m1.3.3.3.3" xref="algorithm1.42.42.m1.3.3.3.3.cmml"><mi id="algorithm1.42.42.m1.3.3.3.3.2" xref="algorithm1.42.42.m1.3.3.3.3.2.cmml">K</mi><mi id="algorithm1.42.42.m1.3.3.3.3.3" xref="algorithm1.42.42.m1.3.3.3.3.3.cmml">l</mi></msub><mo id="algorithm1.42.42.m1.4.4.4.7" xref="algorithm1.42.42.m1.4.4.5.cmml">,</mo><msub id="algorithm1.42.42.m1.4.4.4.4" xref="algorithm1.42.42.m1.4.4.4.4.cmml"><mi id="algorithm1.42.42.m1.4.4.4.4.2" xref="algorithm1.42.42.m1.4.4.4.4.2.cmml">P</mi><mi id="algorithm1.42.42.m1.4.4.4.4.3" xref="algorithm1.42.42.m1.4.4.4.4.3.cmml">l</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.42.42.m1.4b"><list id="algorithm1.42.42.m1.4.4.5.cmml" xref="algorithm1.42.42.m1.4.4.4"><apply id="algorithm1.42.42.m1.1.1.1.1.cmml" xref="algorithm1.42.42.m1.1.1.1.1"><csymbol cd="ambiguous" id="algorithm1.42.42.m1.1.1.1.1.1.cmml" xref="algorithm1.42.42.m1.1.1.1.1">subscript</csymbol><ci id="algorithm1.42.42.m1.1.1.1.1.2.cmml" xref="algorithm1.42.42.m1.1.1.1.1.2">𝐿</ci><ci id="algorithm1.42.42.m1.1.1.1.1.3.cmml" xref="algorithm1.42.42.m1.1.1.1.1.3">𝑙</ci></apply><apply id="algorithm1.42.42.m1.2.2.2.2.cmml" xref="algorithm1.42.42.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.42.42.m1.2.2.2.2.1.cmml" xref="algorithm1.42.42.m1.2.2.2.2">superscript</csymbol><apply id="algorithm1.42.42.m1.2.2.2.2.2.cmml" xref="algorithm1.42.42.m1.2.2.2.2"><csymbol cd="ambiguous" id="algorithm1.42.42.m1.2.2.2.2.2.1.cmml" xref="algorithm1.42.42.m1.2.2.2.2">subscript</csymbol><ci id="algorithm1.42.42.m1.2.2.2.2.2.2.cmml" xref="algorithm1.42.42.m1.2.2.2.2.2.2">ℋ</ci><ci id="algorithm1.42.42.m1.2.2.2.2.2.3.cmml" xref="algorithm1.42.42.m1.2.2.2.2.2.3">𝑙</ci></apply><ci id="algorithm1.42.42.m1.2.2.2.2.3.cmml" xref="algorithm1.42.42.m1.2.2.2.2.3">𝑖</ci></apply><apply id="algorithm1.42.42.m1.3.3.3.3.cmml" xref="algorithm1.42.42.m1.3.3.3.3"><csymbol cd="ambiguous" id="algorithm1.42.42.m1.3.3.3.3.1.cmml" xref="algorithm1.42.42.m1.3.3.3.3">subscript</csymbol><ci id="algorithm1.42.42.m1.3.3.3.3.2.cmml" xref="algorithm1.42.42.m1.3.3.3.3.2">𝐾</ci><ci id="algorithm1.42.42.m1.3.3.3.3.3.cmml" xref="algorithm1.42.42.m1.3.3.3.3.3">𝑙</ci></apply><apply id="algorithm1.42.42.m1.4.4.4.4.cmml" xref="algorithm1.42.42.m1.4.4.4.4"><csymbol cd="ambiguous" id="algorithm1.42.42.m1.4.4.4.4.1.cmml" xref="algorithm1.42.42.m1.4.4.4.4">subscript</csymbol><ci id="algorithm1.42.42.m1.4.4.4.4.2.cmml" xref="algorithm1.42.42.m1.4.4.4.4.2">𝑃</ci><ci id="algorithm1.42.42.m1.4.4.4.4.3.cmml" xref="algorithm1.42.42.m1.4.4.4.4.3">𝑙</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.42.42.m1.4c">L_{l},\mathcal{H}_{l}^{i},{K}_{l},P_{l}</annotation></semantics></math>);
</div>
<div id="algorithm1.48.64" class="ltx_listingline">  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.48.64.1" class="ltx_text ltx_font_typewriter">// </span><span id="algorithm1.48.64.2" class="ltx_text ltx_font_typewriter">Notice that global prompts are frozen. </span>
</div>
<div id="algorithm1.48.65" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">30</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>     <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.48.66" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">31</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <span id="algorithm1.48.66.1" class="ltx_text ltx_font_bold">Server aggregation:</span>

</div>
<div id="algorithm1.44.44" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">32</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.43.43.m1.1" class="ltx_Math" alttext="\mathcal{P}_{g}" display="inline"><semantics id="algorithm1.43.43.m1.1a"><msub id="algorithm1.43.43.m1.1.1" xref="algorithm1.43.43.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.43.43.m1.1.1.2" xref="algorithm1.43.43.m1.1.1.2.cmml">𝒫</mi><mi id="algorithm1.43.43.m1.1.1.3" xref="algorithm1.43.43.m1.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.43.43.m1.1b"><apply id="algorithm1.43.43.m1.1.1.cmml" xref="algorithm1.43.43.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.43.43.m1.1.1.1.cmml" xref="algorithm1.43.43.m1.1.1">subscript</csymbol><ci id="algorithm1.43.43.m1.1.1.2.cmml" xref="algorithm1.43.43.m1.1.1.2">𝒫</ci><ci id="algorithm1.43.43.m1.1.1.3.cmml" xref="algorithm1.43.43.m1.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.43.43.m1.1c">\mathcal{P}_{g}</annotation></semantics></math> = {<math id="algorithm1.44.44.m2.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{1}\cup\ldots\cup\mathcal{C}_{g}^{T_{a}}" display="inline"><semantics id="algorithm1.44.44.m2.1a"><mrow id="algorithm1.44.44.m2.1.1" xref="algorithm1.44.44.m2.1.1.cmml"><msubsup id="algorithm1.44.44.m2.1.1.2" xref="algorithm1.44.44.m2.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.44.44.m2.1.1.2.2.2" xref="algorithm1.44.44.m2.1.1.2.2.2.cmml">𝒫</mi><mi id="algorithm1.44.44.m2.1.1.2.2.3" xref="algorithm1.44.44.m2.1.1.2.2.3.cmml">g</mi><mn id="algorithm1.44.44.m2.1.1.2.3" xref="algorithm1.44.44.m2.1.1.2.3.cmml">1</mn></msubsup><mo id="algorithm1.44.44.m2.1.1.1" xref="algorithm1.44.44.m2.1.1.1.cmml">∪</mo><mi mathvariant="normal" id="algorithm1.44.44.m2.1.1.3" xref="algorithm1.44.44.m2.1.1.3.cmml">…</mi><mo id="algorithm1.44.44.m2.1.1.1a" xref="algorithm1.44.44.m2.1.1.1.cmml">∪</mo><msubsup id="algorithm1.44.44.m2.1.1.4" xref="algorithm1.44.44.m2.1.1.4.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.44.44.m2.1.1.4.2.2" xref="algorithm1.44.44.m2.1.1.4.2.2.cmml">𝒞</mi><mi id="algorithm1.44.44.m2.1.1.4.2.3" xref="algorithm1.44.44.m2.1.1.4.2.3.cmml">g</mi><msub id="algorithm1.44.44.m2.1.1.4.3" xref="algorithm1.44.44.m2.1.1.4.3.cmml"><mi id="algorithm1.44.44.m2.1.1.4.3.2" xref="algorithm1.44.44.m2.1.1.4.3.2.cmml">T</mi><mi id="algorithm1.44.44.m2.1.1.4.3.3" xref="algorithm1.44.44.m2.1.1.4.3.3.cmml">a</mi></msub></msubsup></mrow><annotation-xml encoding="MathML-Content" id="algorithm1.44.44.m2.1b"><apply id="algorithm1.44.44.m2.1.1.cmml" xref="algorithm1.44.44.m2.1.1"><union id="algorithm1.44.44.m2.1.1.1.cmml" xref="algorithm1.44.44.m2.1.1.1"></union><apply id="algorithm1.44.44.m2.1.1.2.cmml" xref="algorithm1.44.44.m2.1.1.2"><csymbol cd="ambiguous" id="algorithm1.44.44.m2.1.1.2.1.cmml" xref="algorithm1.44.44.m2.1.1.2">superscript</csymbol><apply id="algorithm1.44.44.m2.1.1.2.2.cmml" xref="algorithm1.44.44.m2.1.1.2"><csymbol cd="ambiguous" id="algorithm1.44.44.m2.1.1.2.2.1.cmml" xref="algorithm1.44.44.m2.1.1.2">subscript</csymbol><ci id="algorithm1.44.44.m2.1.1.2.2.2.cmml" xref="algorithm1.44.44.m2.1.1.2.2.2">𝒫</ci><ci id="algorithm1.44.44.m2.1.1.2.2.3.cmml" xref="algorithm1.44.44.m2.1.1.2.2.3">𝑔</ci></apply><cn type="integer" id="algorithm1.44.44.m2.1.1.2.3.cmml" xref="algorithm1.44.44.m2.1.1.2.3">1</cn></apply><ci id="algorithm1.44.44.m2.1.1.3.cmml" xref="algorithm1.44.44.m2.1.1.3">…</ci><apply id="algorithm1.44.44.m2.1.1.4.cmml" xref="algorithm1.44.44.m2.1.1.4"><csymbol cd="ambiguous" id="algorithm1.44.44.m2.1.1.4.1.cmml" xref="algorithm1.44.44.m2.1.1.4">superscript</csymbol><apply id="algorithm1.44.44.m2.1.1.4.2.cmml" xref="algorithm1.44.44.m2.1.1.4"><csymbol cd="ambiguous" id="algorithm1.44.44.m2.1.1.4.2.1.cmml" xref="algorithm1.44.44.m2.1.1.4">subscript</csymbol><ci id="algorithm1.44.44.m2.1.1.4.2.2.cmml" xref="algorithm1.44.44.m2.1.1.4.2.2">𝒞</ci><ci id="algorithm1.44.44.m2.1.1.4.2.3.cmml" xref="algorithm1.44.44.m2.1.1.4.2.3">𝑔</ci></apply><apply id="algorithm1.44.44.m2.1.1.4.3.cmml" xref="algorithm1.44.44.m2.1.1.4.3"><csymbol cd="ambiguous" id="algorithm1.44.44.m2.1.1.4.3.1.cmml" xref="algorithm1.44.44.m2.1.1.4.3">subscript</csymbol><ci id="algorithm1.44.44.m2.1.1.4.3.2.cmml" xref="algorithm1.44.44.m2.1.1.4.3.2">𝑇</ci><ci id="algorithm1.44.44.m2.1.1.4.3.3.cmml" xref="algorithm1.44.44.m2.1.1.4.3.3">𝑎</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.44.44.m2.1c">\mathcal{P}_{g}^{1}\cup\ldots\cup\mathcal{C}_{g}^{T_{a}}</annotation></semantics></math> } ;
</div>
<div id="algorithm1.48.67" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">33</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.47.47" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">34</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   <math id="algorithm1.45.45.m1.1" class="ltx_Math" alttext="\mathcal{P}_{G}" display="inline"><semantics id="algorithm1.45.45.m1.1a"><msub id="algorithm1.45.45.m1.1.1" xref="algorithm1.45.45.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.45.45.m1.1.1.2" xref="algorithm1.45.45.m1.1.1.2.cmml">𝒫</mi><mi id="algorithm1.45.45.m1.1.1.3" xref="algorithm1.45.45.m1.1.1.3.cmml">G</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.45.45.m1.1b"><apply id="algorithm1.45.45.m1.1.1.cmml" xref="algorithm1.45.45.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.45.45.m1.1.1.1.cmml" xref="algorithm1.45.45.m1.1.1">subscript</csymbol><ci id="algorithm1.45.45.m1.1.1.2.cmml" xref="algorithm1.45.45.m1.1.1.2">𝒫</ci><ci id="algorithm1.45.45.m1.1.1.3.cmml" xref="algorithm1.45.45.m1.1.1.3">𝐺</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.45.45.m1.1c">\mathcal{P}_{G}</annotation></semantics></math> <math id="algorithm1.46.46.m2.1" class="ltx_Math" alttext="\leftarrow" display="inline"><semantics id="algorithm1.46.46.m2.1a"><mo stretchy="false" id="algorithm1.46.46.m2.1.1" xref="algorithm1.46.46.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="algorithm1.46.46.m2.1b"><ci id="algorithm1.46.46.m2.1.1.cmml" xref="algorithm1.46.46.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.46.46.m2.1c">\leftarrow</annotation></semantics></math> SelectivePromptFusion(<math id="algorithm1.47.47.m3.1" class="ltx_Math" alttext="\mathcal{P}_{g}" display="inline"><semantics id="algorithm1.47.47.m3.1a"><msub id="algorithm1.47.47.m3.1.1" xref="algorithm1.47.47.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.47.47.m3.1.1.2" xref="algorithm1.47.47.m3.1.1.2.cmml">𝒫</mi><mi id="algorithm1.47.47.m3.1.1.3" xref="algorithm1.47.47.m3.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.47.47.m3.1b"><apply id="algorithm1.47.47.m3.1.1.cmml" xref="algorithm1.47.47.m3.1.1"><csymbol cd="ambiguous" id="algorithm1.47.47.m3.1.1.1.cmml" xref="algorithm1.47.47.m3.1.1">subscript</csymbol><ci id="algorithm1.47.47.m3.1.1.2.cmml" xref="algorithm1.47.47.m3.1.1.2">𝒫</ci><ci id="algorithm1.47.47.m3.1.1.3.cmml" xref="algorithm1.47.47.m3.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.47.47.m3.1c">\mathcal{P}_{g}</annotation></semantics></math>) ;
</div>
<div id="algorithm1.48.68" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">35</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   

</div>
<div id="algorithm1.48.48" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">36</span>  <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;"> </span>   Distribute <math id="algorithm1.48.48.m1.1" class="ltx_Math" alttext="\mathcal{P}_{G}" display="inline"><semantics id="algorithm1.48.48.m1.1a"><msub id="algorithm1.48.48.m1.1.1" xref="algorithm1.48.48.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="algorithm1.48.48.m1.1.1.2" xref="algorithm1.48.48.m1.1.1.2.cmml">𝒫</mi><mi id="algorithm1.48.48.m1.1.1.3" xref="algorithm1.48.48.m1.1.1.3.cmml">G</mi></msub><annotation-xml encoding="MathML-Content" id="algorithm1.48.48.m1.1b"><apply id="algorithm1.48.48.m1.1.1.cmml" xref="algorithm1.48.48.m1.1.1"><csymbol cd="ambiguous" id="algorithm1.48.48.m1.1.1.1.cmml" xref="algorithm1.48.48.m1.1.1">subscript</csymbol><ci id="algorithm1.48.48.m1.1.1.2.cmml" xref="algorithm1.48.48.m1.1.1.2">𝒫</ci><ci id="algorithm1.48.48.m1.1.1.3.cmml" xref="algorithm1.48.48.m1.1.1.3">𝐺</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="algorithm1.48.48.m1.1c">\mathcal{P}_{G}</annotation></semantics></math> to all clients for next task training.

</div>
<div id="algorithm1.48.69" class="ltx_listingline">
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="algorithm1.50.1.1" class="ltx_text ltx_font_bold">Algorithm 1</span> </span>FedMGP Algorithm.</figcaption>
</figure>
<section id="S4.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1. </span>Coarse-grained Global Prompt</h3>

<div id="S4.SS1.p1" class="ltx_para">
<p id="S4.SS1.p1.1" class="ltx_p">Due to the heterogeneity of data, significant differences exist among local models, leading to substantial variations in extracted knowledge. This also poses significant challenges for the fusion and transfer of knowledge, as the knowledge learned by each client is overly fine-grained. Inspired by the cognitive processes of humans, knowledge transfer among humans is effective because there is a fundamental shared cognition, enabling the meaningful exchange of knowledge. Therefore, we assign each client with the same pre-trained ViT model as a foundational cognitive system. With ViT’s parameters frozen, clients learn global prompts that operate at the input level. Consequently, these global prompts represent coarse-grained knowledge acquired through the common model learning process. Furthermore, as the knowledge is extracted from the same model, it is more convenient to aggregate knowledge on the server side without spatial forgetting.</p>
</div>
<div id="S4.SS1.p2" class="ltx_para">
<p id="S4.SS1.p2.1" class="ltx_p">The training of coarse-grained global prompts is based on the frozen ViT model. Moreover, global prompts operate at the input level, not influencing the model’s parameters. The purpose is to extract knowledge into a common space through the same model.</p>
</div>
<section id="S4.SS1.SSS1" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.1. </span>Global Prompt Pool</h4>

<div id="S4.SS1.SSS1.p1" class="ltx_para">
<p id="S4.SS1.SSS1.p1.7" class="ltx_p">Taking inspiration from L2P <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib42" title="" class="ltx_ref">2022b</a>)</cite>, we devise a prompt pool for storing and selecting the global prompts. The prompt pool is defined as</p>
<table id="S4.E3" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E3.m1.2" class="ltx_Math" alttext="\mathcal{P}_{g}=\{P_{g}^{1},P_{g}^{2},\ldots,P_{g}^{M}\}," display="block"><semantics id="S4.E3.m1.2a"><mrow id="S4.E3.m1.2.2.1" xref="S4.E3.m1.2.2.1.1.cmml"><mrow id="S4.E3.m1.2.2.1.1" xref="S4.E3.m1.2.2.1.1.cmml"><msub id="S4.E3.m1.2.2.1.1.5" xref="S4.E3.m1.2.2.1.1.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E3.m1.2.2.1.1.5.2" xref="S4.E3.m1.2.2.1.1.5.2.cmml">𝒫</mi><mi id="S4.E3.m1.2.2.1.1.5.3" xref="S4.E3.m1.2.2.1.1.5.3.cmml">g</mi></msub><mo id="S4.E3.m1.2.2.1.1.4" xref="S4.E3.m1.2.2.1.1.4.cmml">=</mo><mrow id="S4.E3.m1.2.2.1.1.3.3" xref="S4.E3.m1.2.2.1.1.3.4.cmml"><mo stretchy="false" id="S4.E3.m1.2.2.1.1.3.3.4" xref="S4.E3.m1.2.2.1.1.3.4.cmml">{</mo><msubsup id="S4.E3.m1.2.2.1.1.1.1.1" xref="S4.E3.m1.2.2.1.1.1.1.1.cmml"><mi id="S4.E3.m1.2.2.1.1.1.1.1.2.2" xref="S4.E3.m1.2.2.1.1.1.1.1.2.2.cmml">P</mi><mi id="S4.E3.m1.2.2.1.1.1.1.1.2.3" xref="S4.E3.m1.2.2.1.1.1.1.1.2.3.cmml">g</mi><mn id="S4.E3.m1.2.2.1.1.1.1.1.3" xref="S4.E3.m1.2.2.1.1.1.1.1.3.cmml">1</mn></msubsup><mo id="S4.E3.m1.2.2.1.1.3.3.5" xref="S4.E3.m1.2.2.1.1.3.4.cmml">,</mo><msubsup id="S4.E3.m1.2.2.1.1.2.2.2" xref="S4.E3.m1.2.2.1.1.2.2.2.cmml"><mi id="S4.E3.m1.2.2.1.1.2.2.2.2.2" xref="S4.E3.m1.2.2.1.1.2.2.2.2.2.cmml">P</mi><mi id="S4.E3.m1.2.2.1.1.2.2.2.2.3" xref="S4.E3.m1.2.2.1.1.2.2.2.2.3.cmml">g</mi><mn id="S4.E3.m1.2.2.1.1.2.2.2.3" xref="S4.E3.m1.2.2.1.1.2.2.2.3.cmml">2</mn></msubsup><mo id="S4.E3.m1.2.2.1.1.3.3.6" xref="S4.E3.m1.2.2.1.1.3.4.cmml">,</mo><mi mathvariant="normal" id="S4.E3.m1.1.1" xref="S4.E3.m1.1.1.cmml">…</mi><mo id="S4.E3.m1.2.2.1.1.3.3.7" xref="S4.E3.m1.2.2.1.1.3.4.cmml">,</mo><msubsup id="S4.E3.m1.2.2.1.1.3.3.3" xref="S4.E3.m1.2.2.1.1.3.3.3.cmml"><mi id="S4.E3.m1.2.2.1.1.3.3.3.2.2" xref="S4.E3.m1.2.2.1.1.3.3.3.2.2.cmml">P</mi><mi id="S4.E3.m1.2.2.1.1.3.3.3.2.3" xref="S4.E3.m1.2.2.1.1.3.3.3.2.3.cmml">g</mi><mi id="S4.E3.m1.2.2.1.1.3.3.3.3" xref="S4.E3.m1.2.2.1.1.3.3.3.3.cmml">M</mi></msubsup><mo stretchy="false" id="S4.E3.m1.2.2.1.1.3.3.8" xref="S4.E3.m1.2.2.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S4.E3.m1.2.2.1.2" xref="S4.E3.m1.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E3.m1.2b"><apply id="S4.E3.m1.2.2.1.1.cmml" xref="S4.E3.m1.2.2.1"><eq id="S4.E3.m1.2.2.1.1.4.cmml" xref="S4.E3.m1.2.2.1.1.4"></eq><apply id="S4.E3.m1.2.2.1.1.5.cmml" xref="S4.E3.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.5.1.cmml" xref="S4.E3.m1.2.2.1.1.5">subscript</csymbol><ci id="S4.E3.m1.2.2.1.1.5.2.cmml" xref="S4.E3.m1.2.2.1.1.5.2">𝒫</ci><ci id="S4.E3.m1.2.2.1.1.5.3.cmml" xref="S4.E3.m1.2.2.1.1.5.3">𝑔</ci></apply><set id="S4.E3.m1.2.2.1.1.3.4.cmml" xref="S4.E3.m1.2.2.1.1.3.3"><apply id="S4.E3.m1.2.2.1.1.1.1.1.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.1.1.1.1.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1">superscript</csymbol><apply id="S4.E3.m1.2.2.1.1.1.1.1.2.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.1.1.1.2.1.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1">subscript</csymbol><ci id="S4.E3.m1.2.2.1.1.1.1.1.2.2.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1.2.2">𝑃</ci><ci id="S4.E3.m1.2.2.1.1.1.1.1.2.3.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1.2.3">𝑔</ci></apply><cn type="integer" id="S4.E3.m1.2.2.1.1.1.1.1.3.cmml" xref="S4.E3.m1.2.2.1.1.1.1.1.3">1</cn></apply><apply id="S4.E3.m1.2.2.1.1.2.2.2.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.2.2.2.1.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2">superscript</csymbol><apply id="S4.E3.m1.2.2.1.1.2.2.2.2.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.2.2.2.2.1.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2">subscript</csymbol><ci id="S4.E3.m1.2.2.1.1.2.2.2.2.2.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2.2.2">𝑃</ci><ci id="S4.E3.m1.2.2.1.1.2.2.2.2.3.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2.2.3">𝑔</ci></apply><cn type="integer" id="S4.E3.m1.2.2.1.1.2.2.2.3.cmml" xref="S4.E3.m1.2.2.1.1.2.2.2.3">2</cn></apply><ci id="S4.E3.m1.1.1.cmml" xref="S4.E3.m1.1.1">…</ci><apply id="S4.E3.m1.2.2.1.1.3.3.3.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.3.3.3.1.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3">superscript</csymbol><apply id="S4.E3.m1.2.2.1.1.3.3.3.2.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.E3.m1.2.2.1.1.3.3.3.2.1.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3">subscript</csymbol><ci id="S4.E3.m1.2.2.1.1.3.3.3.2.2.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3.2.2">𝑃</ci><ci id="S4.E3.m1.2.2.1.1.3.3.3.2.3.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3.2.3">𝑔</ci></apply><ci id="S4.E3.m1.2.2.1.1.3.3.3.3.cmml" xref="S4.E3.m1.2.2.1.1.3.3.3.3">𝑀</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E3.m1.2c">\mathcal{P}_{g}=\{P_{g}^{1},P_{g}^{2},\ldots,P_{g}^{M}\},</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS1.SSS1.p1.6" class="ltx_p">where <math id="S4.SS1.SSS1.p1.1.m1.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS1.SSS1.p1.1.m1.1a"><mi id="S4.SS1.SSS1.p1.1.m1.1.1" xref="S4.SS1.SSS1.p1.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.1.m1.1b"><ci id="S4.SS1.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS1.SSS1.p1.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.1.m1.1c">m</annotation></semantics></math> is the pool size and <math id="S4.SS1.SSS1.p1.2.m2.1" class="ltx_Math" alttext="P_{g}^{j}" display="inline"><semantics id="S4.SS1.SSS1.p1.2.m2.1a"><msubsup id="S4.SS1.SSS1.p1.2.m2.1.1" xref="S4.SS1.SSS1.p1.2.m2.1.1.cmml"><mi id="S4.SS1.SSS1.p1.2.m2.1.1.2.2" xref="S4.SS1.SSS1.p1.2.m2.1.1.2.2.cmml">P</mi><mi id="S4.SS1.SSS1.p1.2.m2.1.1.2.3" xref="S4.SS1.SSS1.p1.2.m2.1.1.2.3.cmml">g</mi><mi id="S4.SS1.SSS1.p1.2.m2.1.1.3" xref="S4.SS1.SSS1.p1.2.m2.1.1.3.cmml">j</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.2.m2.1b"><apply id="S4.SS1.SSS1.p1.2.m2.1.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.2.m2.1.1.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1">superscript</csymbol><apply id="S4.SS1.SSS1.p1.2.m2.1.1.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.2.m2.1.1.2.1.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS1.p1.2.m2.1.1.2.2.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.2.2">𝑃</ci><ci id="S4.SS1.SSS1.p1.2.m2.1.1.2.3.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.2.3">𝑔</ci></apply><ci id="S4.SS1.SSS1.p1.2.m2.1.1.3.cmml" xref="S4.SS1.SSS1.p1.2.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.2.m2.1c">P_{g}^{j}</annotation></semantics></math> is a single global prompt. Then, let <math id="S4.SS1.SSS1.p1.3.m3.1" class="ltx_Math" alttext="x" display="inline"><semantics id="S4.SS1.SSS1.p1.3.m3.1a"><mi id="S4.SS1.SSS1.p1.3.m3.1.1" xref="S4.SS1.SSS1.p1.3.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.3.m3.1b"><ci id="S4.SS1.SSS1.p1.3.m3.1.1.cmml" xref="S4.SS1.SSS1.p1.3.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.3.m3.1c">x</annotation></semantics></math> and <math id="S4.SS1.SSS1.p1.4.m4.1" class="ltx_Math" alttext="E=f_{e}(x)" display="inline"><semantics id="S4.SS1.SSS1.p1.4.m4.1a"><mrow id="S4.SS1.SSS1.p1.4.m4.1.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.cmml"><mi id="S4.SS1.SSS1.p1.4.m4.1.2.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.2.cmml">E</mi><mo id="S4.SS1.SSS1.p1.4.m4.1.2.1" xref="S4.SS1.SSS1.p1.4.m4.1.2.1.cmml">=</mo><mrow id="S4.SS1.SSS1.p1.4.m4.1.2.3" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.cmml"><msub id="S4.SS1.SSS1.p1.4.m4.1.2.3.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2.cmml"><mi id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2.2.cmml">f</mi><mi id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.3" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2.3.cmml">e</mi></msub><mo lspace="0em" rspace="0em" id="S4.SS1.SSS1.p1.4.m4.1.2.3.1" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.1.cmml">​</mo><mrow id="S4.SS1.SSS1.p1.4.m4.1.2.3.3.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.cmml"><mo stretchy="false" id="S4.SS1.SSS1.p1.4.m4.1.2.3.3.2.1" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.cmml">(</mo><mi id="S4.SS1.SSS1.p1.4.m4.1.1" xref="S4.SS1.SSS1.p1.4.m4.1.1.cmml">x</mi><mo stretchy="false" id="S4.SS1.SSS1.p1.4.m4.1.2.3.3.2.2" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.4.m4.1b"><apply id="S4.SS1.SSS1.p1.4.m4.1.2.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2"><eq id="S4.SS1.SSS1.p1.4.m4.1.2.1.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.1"></eq><ci id="S4.SS1.SSS1.p1.4.m4.1.2.2.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.2">𝐸</ci><apply id="S4.SS1.SSS1.p1.4.m4.1.2.3.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3"><times id="S4.SS1.SSS1.p1.4.m4.1.2.3.1.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.1"></times><apply id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.1.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2">subscript</csymbol><ci id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.2.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2.2">𝑓</ci><ci id="S4.SS1.SSS1.p1.4.m4.1.2.3.2.3.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.2.3.2.3">𝑒</ci></apply><ci id="S4.SS1.SSS1.p1.4.m4.1.1.cmml" xref="S4.SS1.SSS1.p1.4.m4.1.1">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.4.m4.1c">E=f_{e}(x)</annotation></semantics></math> be the input and its corresponding embedding feature, respectively. Denoting <math id="S4.SS1.SSS1.p1.5.m5.1" class="ltx_Math" alttext="\{s_{i}\}_{1}^{N}" display="inline"><semantics id="S4.SS1.SSS1.p1.5.m5.1a"><msubsup id="S4.SS1.SSS1.p1.5.m5.1.1" xref="S4.SS1.SSS1.p1.5.m5.1.1.cmml"><mrow id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.2.cmml"><mo stretchy="false" id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.2" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.2.cmml">{</mo><msub id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.cmml"><mi id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.2" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.2.cmml">s</mi><mi id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.3" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.3.cmml">i</mi></msub><mo stretchy="false" id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.3" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.2.cmml">}</mo></mrow><mn id="S4.SS1.SSS1.p1.5.m5.1.1.1.3" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.3.cmml">1</mn><mi id="S4.SS1.SSS1.p1.5.m5.1.1.3" xref="S4.SS1.SSS1.p1.5.m5.1.1.3.cmml">N</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.5.m5.1b"><apply id="S4.SS1.SSS1.p1.5.m5.1.1.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.5.m5.1.1.2.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1">superscript</csymbol><apply id="S4.SS1.SSS1.p1.5.m5.1.1.1.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.5.m5.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1">subscript</csymbol><set id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1"><apply id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.1.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1">subscript</csymbol><ci id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.2.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.2">𝑠</ci><ci id="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.3.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.1.1.1.3">𝑖</ci></apply></set><cn type="integer" id="S4.SS1.SSS1.p1.5.m5.1.1.1.3.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.1.3">1</cn></apply><ci id="S4.SS1.SSS1.p1.5.m5.1.1.3.cmml" xref="S4.SS1.SSS1.p1.5.m5.1.1.3">𝑁</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.5.m5.1c">\{s_{i}\}_{1}^{N}</annotation></semantics></math> be the indices of <math id="S4.SS1.SSS1.p1.6.m6.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S4.SS1.SSS1.p1.6.m6.1a"><mi id="S4.SS1.SSS1.p1.6.m6.1.1" xref="S4.SS1.SSS1.p1.6.m6.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p1.6.m6.1b"><ci id="S4.SS1.SSS1.p1.6.m6.1.1.cmml" xref="S4.SS1.SSS1.p1.6.m6.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p1.6.m6.1c">N</annotation></semantics></math> global prompts, then we can modify the embedding feature as follows:</p>
<table id="S4.E4" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E4.m1.3" class="ltx_Math" alttext="E^{\prime}=\left[P_{g}^{s_{1}},\ldots,P_{g}^{s_{k}};E\right],1\leq N\leq M," display="block"><semantics id="S4.E4.m1.3a"><mrow id="S4.E4.m1.3.3.1"><mrow id="S4.E4.m1.3.3.1.1.2" xref="S4.E4.m1.3.3.1.1.3.cmml"><mrow id="S4.E4.m1.3.3.1.1.1.1" xref="S4.E4.m1.3.3.1.1.1.1.cmml"><msup id="S4.E4.m1.3.3.1.1.1.1.4" xref="S4.E4.m1.3.3.1.1.1.1.4.cmml"><mi id="S4.E4.m1.3.3.1.1.1.1.4.2" xref="S4.E4.m1.3.3.1.1.1.1.4.2.cmml">E</mi><mo id="S4.E4.m1.3.3.1.1.1.1.4.3" xref="S4.E4.m1.3.3.1.1.1.1.4.3.cmml">′</mo></msup><mo id="S4.E4.m1.3.3.1.1.1.1.3" xref="S4.E4.m1.3.3.1.1.1.1.3.cmml">=</mo><mrow id="S4.E4.m1.3.3.1.1.1.1.2.2" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml"><mo id="S4.E4.m1.3.3.1.1.1.1.2.2.3" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml">[</mo><msubsup id="S4.E4.m1.3.3.1.1.1.1.1.1.1" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.2" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.2.cmml">P</mi><mi id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.3" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.3.cmml">g</mi><msub id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.cmml"><mi id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.2" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.2.cmml">s</mi><mn id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.3" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.3.cmml">1</mn></msub></msubsup><mo id="S4.E4.m1.3.3.1.1.1.1.2.2.4" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml">,</mo><mi mathvariant="normal" id="S4.E4.m1.1.1" xref="S4.E4.m1.1.1.cmml">…</mi><mo id="S4.E4.m1.3.3.1.1.1.1.2.2.5" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml">,</mo><msubsup id="S4.E4.m1.3.3.1.1.1.1.2.2.2" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.cmml"><mi id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.2" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.2.cmml">P</mi><mi id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.3" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.3.cmml">g</mi><msub id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.cmml"><mi id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.2" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.2.cmml">s</mi><mi id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.3" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.3.cmml">k</mi></msub></msubsup><mo id="S4.E4.m1.3.3.1.1.1.1.2.2.6" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml">;</mo><mi id="S4.E4.m1.2.2" xref="S4.E4.m1.2.2.cmml">E</mi><mo id="S4.E4.m1.3.3.1.1.1.1.2.2.7" xref="S4.E4.m1.3.3.1.1.1.1.2.3.cmml">]</mo></mrow></mrow><mo id="S4.E4.m1.3.3.1.1.2.3" xref="S4.E4.m1.3.3.1.1.3a.cmml">,</mo><mrow id="S4.E4.m1.3.3.1.1.2.2" xref="S4.E4.m1.3.3.1.1.2.2.cmml"><mn id="S4.E4.m1.3.3.1.1.2.2.2" xref="S4.E4.m1.3.3.1.1.2.2.2.cmml">1</mn><mo id="S4.E4.m1.3.3.1.1.2.2.3" xref="S4.E4.m1.3.3.1.1.2.2.3.cmml">≤</mo><mi id="S4.E4.m1.3.3.1.1.2.2.4" xref="S4.E4.m1.3.3.1.1.2.2.4.cmml">N</mi><mo id="S4.E4.m1.3.3.1.1.2.2.5" xref="S4.E4.m1.3.3.1.1.2.2.5.cmml">≤</mo><mi id="S4.E4.m1.3.3.1.1.2.2.6" xref="S4.E4.m1.3.3.1.1.2.2.6.cmml">M</mi></mrow></mrow><mo id="S4.E4.m1.3.3.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E4.m1.3b"><apply id="S4.E4.m1.3.3.1.1.3.cmml" xref="S4.E4.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.3a.cmml" xref="S4.E4.m1.3.3.1.1.2.3">formulae-sequence</csymbol><apply id="S4.E4.m1.3.3.1.1.1.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1"><eq id="S4.E4.m1.3.3.1.1.1.1.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.3"></eq><apply id="S4.E4.m1.3.3.1.1.1.1.4.cmml" xref="S4.E4.m1.3.3.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.4.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.4">superscript</csymbol><ci id="S4.E4.m1.3.3.1.1.1.1.4.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.4.2">𝐸</ci><ci id="S4.E4.m1.3.3.1.1.1.1.4.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.4.3">′</ci></apply><list id="S4.E4.m1.3.3.1.1.1.1.2.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2"><apply id="S4.E4.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1">superscript</csymbol><apply id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.2">𝑃</ci><ci id="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.2.3">𝑔</ci></apply><apply id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.2">𝑠</ci><cn type="integer" id="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="S4.E4.m1.1.1.cmml" xref="S4.E4.m1.1.1">…</ci><apply id="S4.E4.m1.3.3.1.1.1.1.2.2.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.2.2.2.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2">superscript</csymbol><apply id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2">subscript</csymbol><ci id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.2">𝑃</ci><ci id="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.2.3">𝑔</ci></apply><apply id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.1.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3">subscript</csymbol><ci id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.2.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.2">𝑠</ci><ci id="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.3.cmml" xref="S4.E4.m1.3.3.1.1.1.1.2.2.2.3.3">𝑘</ci></apply></apply><ci id="S4.E4.m1.2.2.cmml" xref="S4.E4.m1.2.2">𝐸</ci></list></apply><apply id="S4.E4.m1.3.3.1.1.2.2.cmml" xref="S4.E4.m1.3.3.1.1.2.2"><and id="S4.E4.m1.3.3.1.1.2.2a.cmml" xref="S4.E4.m1.3.3.1.1.2.2"></and><apply id="S4.E4.m1.3.3.1.1.2.2b.cmml" xref="S4.E4.m1.3.3.1.1.2.2"><leq id="S4.E4.m1.3.3.1.1.2.2.3.cmml" xref="S4.E4.m1.3.3.1.1.2.2.3"></leq><cn type="integer" id="S4.E4.m1.3.3.1.1.2.2.2.cmml" xref="S4.E4.m1.3.3.1.1.2.2.2">1</cn><ci id="S4.E4.m1.3.3.1.1.2.2.4.cmml" xref="S4.E4.m1.3.3.1.1.2.2.4">𝑁</ci></apply><apply id="S4.E4.m1.3.3.1.1.2.2c.cmml" xref="S4.E4.m1.3.3.1.1.2.2"><leq id="S4.E4.m1.3.3.1.1.2.2.5.cmml" xref="S4.E4.m1.3.3.1.1.2.2.5"></leq><share href="#S4.E4.m1.3.3.1.1.2.2.4.cmml" id="S4.E4.m1.3.3.1.1.2.2d.cmml" xref="S4.E4.m1.3.3.1.1.2.2"></share><ci id="S4.E4.m1.3.3.1.1.2.2.6.cmml" xref="S4.E4.m1.3.3.1.1.2.2.6">𝑀</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E4.m1.3c">E^{\prime}=\left[P_{g}^{s_{1}},\ldots,P_{g}^{s_{k}};E\right],1\leq N\leq M,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS1.SSS1.p1.8" class="ltx_p">where [;] represents concatenation along the token length dimension. The next question is how to choose global prompts.</p>
</div>
</section>
<section id="S4.SS1.SSS2" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.2. </span>Global Query Function</h4>

<div id="S4.SS1.SSS2.p1" class="ltx_para">
<p id="S4.SS1.SSS2.p1.1" class="ltx_p">Due to the use of the same model, similar inputs tend to select similar prompts and vice versa. This mitigates the challenge of aggregating heterogeneous knowledge on the server. Based on this, we have designed a key-value pair-based query strategy that dynamically selects suitable prompts by calculating the similarity between the input key and existing prompts’ keys.</p>
</div>
<div id="S4.SS1.SSS2.p2" class="ltx_para">
<p id="S4.SS1.SSS2.p2.3" class="ltx_p">We associate each prompt in the pool with a learnable key, denoted as <math id="S4.SS1.SSS2.p2.1.m1.4" class="ltx_Math" alttext="\{(K_{g}^{1},P_{g}^{1}),(K_{g}^{2},P_{g}^{2}),\ldots,(K_{g}^{m},P_{g}^{m})\}" display="inline"><semantics id="S4.SS1.SSS2.p2.1.m1.4a"><mrow id="S4.SS1.SSS2.p2.1.m1.4.4.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml"><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.4.4.3.4" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml">{</mo><mrow id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.3.cmml"><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.3" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.3.cmml">(</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.2" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.2.cmml">K</mi><mi id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.3" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.3.cmml">g</mi><mn id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.3" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.3.cmml">1</mn></msubsup><mo id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.4" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.3.cmml">,</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.2" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.2.cmml">P</mi><mi id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.3.cmml">g</mi><mn id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.3.cmml">1</mn></msubsup><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.5" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.3.cmml">)</mo></mrow><mo id="S4.SS1.SSS2.p2.1.m1.4.4.3.5" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml">,</mo><mrow id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.3.cmml"><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.3.cmml">(</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.2" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.2.cmml">K</mi><mi id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.3" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.3.cmml">g</mi><mn id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.3" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.3.cmml">2</mn></msubsup><mo id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.4" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.3.cmml">,</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.2" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.2.cmml">P</mi><mi id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.3.cmml">g</mi><mn id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.3.cmml">2</mn></msubsup><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.5" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.3.cmml">)</mo></mrow><mo id="S4.SS1.SSS2.p2.1.m1.4.4.3.6" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml">,</mo><mi mathvariant="normal" id="S4.SS1.SSS2.p2.1.m1.1.1" xref="S4.SS1.SSS2.p2.1.m1.1.1.cmml">…</mi><mo id="S4.SS1.SSS2.p2.1.m1.4.4.3.7" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml">,</mo><mrow id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.3.cmml"><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.3.cmml">(</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.2" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.2.cmml">K</mi><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.3.cmml">g</mi><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.3.cmml">m</mi></msubsup><mo id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.4" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.3.cmml">,</mo><msubsup id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.2" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.2.cmml">P</mi><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.3.cmml">g</mi><mi id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.3" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.3.cmml">m</mi></msubsup><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.5" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.3.cmml">)</mo></mrow><mo stretchy="false" id="S4.SS1.SSS2.p2.1.m1.4.4.3.8" xref="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.1.m1.4b"><set id="S4.SS1.SSS2.p2.1.m1.4.4.4.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3"><interval closure="open" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2"><apply id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.2">𝐾</ci><ci id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.2.3">𝑔</ci></apply><cn type="integer" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.1.1.3">1</cn></apply><apply id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.2">𝑃</ci><ci id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.2.3">𝑔</ci></apply><cn type="integer" id="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.2.2.1.1.2.2.3">1</cn></apply></interval><interval closure="open" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2"><apply id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.2">𝐾</ci><ci id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.2.3">𝑔</ci></apply><cn type="integer" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.1.1.3">2</cn></apply><apply id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.2">𝑃</ci><ci id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.2.3">𝑔</ci></apply><cn type="integer" id="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.3.3.2.2.2.2.3">2</cn></apply></interval><ci id="S4.SS1.SSS2.p2.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.1.1">…</ci><interval closure="open" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2"><apply id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.2">𝐾</ci><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.2.3">𝑔</ci></apply><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.1.1.3">𝑚</ci></apply><apply id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2">superscript</csymbol><apply id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.2">𝑃</ci><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.2.3">𝑔</ci></apply><ci id="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.4.4.3.3.2.2.3">𝑚</ci></apply></interval></set></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.1.m1.4c">\{(K_{g}^{1},P_{g}^{1}),(K_{g}^{2},P_{g}^{2}),\ldots,(K_{g}^{m},P_{g}^{m})\}</annotation></semantics></math>. To ensure that similar inputs have similar keys, we use the output features of the pre-trained ViT <math id="S4.SS1.SSS2.p2.2.m2.1" class="ltx_Math" alttext="\mathcal{V}" display="inline"><semantics id="S4.SS1.SSS2.p2.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p2.2.m2.1.1" xref="S4.SS1.SSS2.p2.2.m2.1.1.cmml">𝒱</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.2.m2.1b"><ci id="S4.SS1.SSS2.p2.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p2.2.m2.1.1">𝒱</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.2.m2.1c">\mathcal{V}</annotation></semantics></math> as the key for the input, i.e., <math id="S4.SS1.SSS2.p2.3.m3.1" class="ltx_Math" alttext="K_{g}^{in}=\mathcal{V}(E)" display="inline"><semantics id="S4.SS1.SSS2.p2.3.m3.1a"><mrow id="S4.SS1.SSS2.p2.3.m3.1.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.cmml"><msubsup id="S4.SS1.SSS2.p2.3.m3.1.2.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.cmml"><mi id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.2.2.cmml">K</mi><mi id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.3" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.2.3.cmml">g</mi><mrow id="S4.SS1.SSS2.p2.3.m3.1.2.2.3" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.cmml"><mi id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.1" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.1.cmml">​</mo><mi id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.3" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.3.cmml">n</mi></mrow></msubsup><mo id="S4.SS1.SSS2.p2.3.m3.1.2.1" xref="S4.SS1.SSS2.p2.3.m3.1.2.1.cmml">=</mo><mrow id="S4.SS1.SSS2.p2.3.m3.1.2.3" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p2.3.m3.1.2.3.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.2.cmml">𝒱</mi><mo lspace="0em" rspace="0em" id="S4.SS1.SSS2.p2.3.m3.1.2.3.1" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.1.cmml">​</mo><mrow id="S4.SS1.SSS2.p2.3.m3.1.2.3.3.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.cmml"><mo stretchy="false" id="S4.SS1.SSS2.p2.3.m3.1.2.3.3.2.1" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.cmml">(</mo><mi id="S4.SS1.SSS2.p2.3.m3.1.1" xref="S4.SS1.SSS2.p2.3.m3.1.1.cmml">E</mi><mo stretchy="false" id="S4.SS1.SSS2.p2.3.m3.1.2.3.3.2.2" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.3.m3.1b"><apply id="S4.SS1.SSS2.p2.3.m3.1.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2"><eq id="S4.SS1.SSS2.p2.3.m3.1.2.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.1"></eq><apply id="S4.SS1.SSS2.p2.3.m3.1.2.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.3.m3.1.2.2.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2">superscript</csymbol><apply id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2">subscript</csymbol><ci id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.2.2">𝐾</ci><ci id="S4.SS1.SSS2.p2.3.m3.1.2.2.2.3.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.2.3">𝑔</ci></apply><apply id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3"><times id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.1"></times><ci id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.2">𝑖</ci><ci id="S4.SS1.SSS2.p2.3.m3.1.2.2.3.3.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.2.3.3">𝑛</ci></apply></apply><apply id="S4.SS1.SSS2.p2.3.m3.1.2.3.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.3"><times id="S4.SS1.SSS2.p2.3.m3.1.2.3.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.1"></times><ci id="S4.SS1.SSS2.p2.3.m3.1.2.3.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.2.3.2">𝒱</ci><ci id="S4.SS1.SSS2.p2.3.m3.1.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.1">𝐸</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.3.m3.1c">K_{g}^{in}=\mathcal{V}(E)</annotation></semantics></math>. Then, the query process can be summarized by the following expression:</p>
<table id="S4.E5" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(5)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E5.m1.1" class="ltx_Math" alttext="\mathcal{K}^{s}_{g}=\underset{\mathcal{K}_{g}}{\operatorname{argmin}}\sum_{i=1}^{N}\text{dis}(K_{g}^{in},K_{g}^{i})," display="block"><semantics id="S4.E5.m1.1a"><mrow id="S4.E5.m1.1.1.1" xref="S4.E5.m1.1.1.1.1.cmml"><mrow id="S4.E5.m1.1.1.1.1" xref="S4.E5.m1.1.1.1.1.cmml"><msubsup id="S4.E5.m1.1.1.1.1.4" xref="S4.E5.m1.1.1.1.1.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E5.m1.1.1.1.1.4.2.2" xref="S4.E5.m1.1.1.1.1.4.2.2.cmml">𝒦</mi><mi id="S4.E5.m1.1.1.1.1.4.3" xref="S4.E5.m1.1.1.1.1.4.3.cmml">g</mi><mi id="S4.E5.m1.1.1.1.1.4.2.3" xref="S4.E5.m1.1.1.1.1.4.2.3.cmml">s</mi></msubsup><mo id="S4.E5.m1.1.1.1.1.3" xref="S4.E5.m1.1.1.1.1.3.cmml">=</mo><mrow id="S4.E5.m1.1.1.1.1.2" xref="S4.E5.m1.1.1.1.1.2.cmml"><munder accentunder="true" id="S4.E5.m1.1.1.1.1.2.4" xref="S4.E5.m1.1.1.1.1.2.4.cmml"><mi id="S4.E5.m1.1.1.1.1.2.4.2" xref="S4.E5.m1.1.1.1.1.2.4.2.cmml">argmin</mi><msub id="S4.E5.m1.1.1.1.1.2.4.1" xref="S4.E5.m1.1.1.1.1.2.4.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E5.m1.1.1.1.1.2.4.1.2" xref="S4.E5.m1.1.1.1.1.2.4.1.2.cmml">𝒦</mi><mi id="S4.E5.m1.1.1.1.1.2.4.1.3" xref="S4.E5.m1.1.1.1.1.2.4.1.3.cmml">g</mi></msub></munder><mo lspace="0em" rspace="0em" id="S4.E5.m1.1.1.1.1.2.3" xref="S4.E5.m1.1.1.1.1.2.3.cmml">​</mo><mrow id="S4.E5.m1.1.1.1.1.2.2" xref="S4.E5.m1.1.1.1.1.2.2.cmml"><munderover id="S4.E5.m1.1.1.1.1.2.2.3" xref="S4.E5.m1.1.1.1.1.2.2.3.cmml"><mo movablelimits="false" id="S4.E5.m1.1.1.1.1.2.2.3.2.2" xref="S4.E5.m1.1.1.1.1.2.2.3.2.2.cmml">∑</mo><mrow id="S4.E5.m1.1.1.1.1.2.2.3.2.3" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.cmml"><mi id="S4.E5.m1.1.1.1.1.2.2.3.2.3.2" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.2.cmml">i</mi><mo id="S4.E5.m1.1.1.1.1.2.2.3.2.3.1" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.1.cmml">=</mo><mn id="S4.E5.m1.1.1.1.1.2.2.3.2.3.3" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.3.cmml">1</mn></mrow><mi id="S4.E5.m1.1.1.1.1.2.2.3.3" xref="S4.E5.m1.1.1.1.1.2.2.3.3.cmml">N</mi></munderover><mrow id="S4.E5.m1.1.1.1.1.2.2.2" xref="S4.E5.m1.1.1.1.1.2.2.2.cmml"><mtext id="S4.E5.m1.1.1.1.1.2.2.2.4" xref="S4.E5.m1.1.1.1.1.2.2.2.4a.cmml">dis</mtext><mo lspace="0em" rspace="0em" id="S4.E5.m1.1.1.1.1.2.2.2.3" xref="S4.E5.m1.1.1.1.1.2.2.2.3.cmml">​</mo><mrow id="S4.E5.m1.1.1.1.1.2.2.2.2.2" xref="S4.E5.m1.1.1.1.1.2.2.2.2.3.cmml"><mo stretchy="false" id="S4.E5.m1.1.1.1.1.2.2.2.2.2.3" xref="S4.E5.m1.1.1.1.1.2.2.2.2.3.cmml">(</mo><msubsup id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">K</mi><mi id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.3" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml">g</mi><mrow id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.2" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.1" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.3" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.3.cmml">n</mi></mrow></msubsup><mo id="S4.E5.m1.1.1.1.1.2.2.2.2.2.4" xref="S4.E5.m1.1.1.1.1.2.2.2.2.3.cmml">,</mo><msubsup id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.cmml"><mi id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.2" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.2.cmml">K</mi><mi id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.3" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.3.cmml">g</mi><mi id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.3" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">i</mi></msubsup><mo stretchy="false" id="S4.E5.m1.1.1.1.1.2.2.2.2.2.5" xref="S4.E5.m1.1.1.1.1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo id="S4.E5.m1.1.1.1.2" xref="S4.E5.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E5.m1.1b"><apply id="S4.E5.m1.1.1.1.1.cmml" xref="S4.E5.m1.1.1.1"><eq id="S4.E5.m1.1.1.1.1.3.cmml" xref="S4.E5.m1.1.1.1.1.3"></eq><apply id="S4.E5.m1.1.1.1.1.4.cmml" xref="S4.E5.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.4.1.cmml" xref="S4.E5.m1.1.1.1.1.4">subscript</csymbol><apply id="S4.E5.m1.1.1.1.1.4.2.cmml" xref="S4.E5.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.4.2.1.cmml" xref="S4.E5.m1.1.1.1.1.4">superscript</csymbol><ci id="S4.E5.m1.1.1.1.1.4.2.2.cmml" xref="S4.E5.m1.1.1.1.1.4.2.2">𝒦</ci><ci id="S4.E5.m1.1.1.1.1.4.2.3.cmml" xref="S4.E5.m1.1.1.1.1.4.2.3">𝑠</ci></apply><ci id="S4.E5.m1.1.1.1.1.4.3.cmml" xref="S4.E5.m1.1.1.1.1.4.3">𝑔</ci></apply><apply id="S4.E5.m1.1.1.1.1.2.cmml" xref="S4.E5.m1.1.1.1.1.2"><times id="S4.E5.m1.1.1.1.1.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.3"></times><apply id="S4.E5.m1.1.1.1.1.2.4.cmml" xref="S4.E5.m1.1.1.1.1.2.4"><apply id="S4.E5.m1.1.1.1.1.2.4.1.cmml" xref="S4.E5.m1.1.1.1.1.2.4.1"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.2.4.1.1.cmml" xref="S4.E5.m1.1.1.1.1.2.4.1">subscript</csymbol><ci id="S4.E5.m1.1.1.1.1.2.4.1.2.cmml" xref="S4.E5.m1.1.1.1.1.2.4.1.2">𝒦</ci><ci id="S4.E5.m1.1.1.1.1.2.4.1.3.cmml" xref="S4.E5.m1.1.1.1.1.2.4.1.3">𝑔</ci></apply><ci id="S4.E5.m1.1.1.1.1.2.4.2.cmml" xref="S4.E5.m1.1.1.1.1.2.4.2">argmin</ci></apply><apply id="S4.E5.m1.1.1.1.1.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2"><apply id="S4.E5.m1.1.1.1.1.2.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.2.2.3.1.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3">superscript</csymbol><apply id="S4.E5.m1.1.1.1.1.2.2.3.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.2.2.3.2.1.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3">subscript</csymbol><sum id="S4.E5.m1.1.1.1.1.2.2.3.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.2.2"></sum><apply id="S4.E5.m1.1.1.1.1.2.2.3.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3"><eq id="S4.E5.m1.1.1.1.1.2.2.3.2.3.1.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.1"></eq><ci id="S4.E5.m1.1.1.1.1.2.2.3.2.3.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.2">𝑖</ci><cn type="integer" id="S4.E5.m1.1.1.1.1.2.2.3.2.3.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.2.3.3">1</cn></apply></apply><ci id="S4.E5.m1.1.1.1.1.2.2.3.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.3.3">𝑁</ci></apply><apply id="S4.E5.m1.1.1.1.1.2.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2"><times id="S4.E5.m1.1.1.1.1.2.2.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.3"></times><ci id="S4.E5.m1.1.1.1.1.2.2.2.4a.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.4"><mtext id="S4.E5.m1.1.1.1.1.2.2.2.4.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.4">dis</mtext></ci><interval closure="open" id="S4.E5.m1.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2"><apply id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.2">𝐾</ci><ci id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.2.3">𝑔</ci></apply><apply id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3"><times id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1.1.1.1.3.3">𝑛</ci></apply></apply><apply id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.1.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2">superscript</csymbol><apply id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.1.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2">subscript</csymbol><ci id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.2.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.2">𝐾</ci><ci id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.2.3">𝑔</ci></apply><ci id="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.3.cmml" xref="S4.E5.m1.1.1.1.1.2.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E5.m1.1c">\mathcal{K}^{s}_{g}=\underset{\mathcal{K}_{g}}{\operatorname{argmin}}\sum_{i=1}^{N}\text{dis}(K_{g}^{in},K_{g}^{i}),</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS1.SSS2.p2.5" class="ltx_p">where <math id="S4.SS1.SSS2.p2.4.m1.1" class="ltx_Math" alttext="\mathcal{K}_{s}" display="inline"><semantics id="S4.SS1.SSS2.p2.4.m1.1a"><msub id="S4.SS1.SSS2.p2.4.m1.1.1" xref="S4.SS1.SSS2.p2.4.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p2.4.m1.1.1.2" xref="S4.SS1.SSS2.p2.4.m1.1.1.2.cmml">𝒦</mi><mi id="S4.SS1.SSS2.p2.4.m1.1.1.3" xref="S4.SS1.SSS2.p2.4.m1.1.1.3.cmml">s</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.4.m1.1b"><apply id="S4.SS1.SSS2.p2.4.m1.1.1.cmml" xref="S4.SS1.SSS2.p2.4.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.4.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p2.4.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.4.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p2.4.m1.1.1.2">𝒦</ci><ci id="S4.SS1.SSS2.p2.4.m1.1.1.3.cmml" xref="S4.SS1.SSS2.p2.4.m1.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.4.m1.1c">\mathcal{K}_{s}</annotation></semantics></math> denotes the subset of top-N keys selected specifically for the input, and <math id="S4.SS1.SSS2.p2.5.m2.1" class="ltx_Math" alttext="\mathcal{K}_{g}" display="inline"><semantics id="S4.SS1.SSS2.p2.5.m2.1a"><msub id="S4.SS1.SSS2.p2.5.m2.1.1" xref="S4.SS1.SSS2.p2.5.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS2.p2.5.m2.1.1.2" xref="S4.SS1.SSS2.p2.5.m2.1.1.2.cmml">𝒦</mi><mi id="S4.SS1.SSS2.p2.5.m2.1.1.3" xref="S4.SS1.SSS2.p2.5.m2.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.5.m2.1b"><apply id="S4.SS1.SSS2.p2.5.m2.1.1.cmml" xref="S4.SS1.SSS2.p2.5.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.5.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p2.5.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.5.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p2.5.m2.1.1.2">𝒦</ci><ci id="S4.SS1.SSS2.p2.5.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p2.5.m2.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.5.m2.1c">\mathcal{K}_{g}</annotation></semantics></math> represents the set of keys for all global prompts. In this work, we utilize cosine similarity as the distance function to measure the similarity between keys.</p>
</div>
</section>
<section id="S4.SS1.SSS3" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.3. </span>Optimization for Global Prompt</h4>

<div id="S4.SS1.SSS3.p1" class="ltx_para">
<p id="S4.SS1.SSS3.p1.4" class="ltx_p">Each client has a global classification head used for training global prompts, denoted as <math id="S4.SS1.SSS3.p1.1.m1.1" class="ltx_Math" alttext="H^{i}_{g}" display="inline"><semantics id="S4.SS1.SSS3.p1.1.m1.1a"><msubsup id="S4.SS1.SSS3.p1.1.m1.1.1" xref="S4.SS1.SSS3.p1.1.m1.1.1.cmml"><mi id="S4.SS1.SSS3.p1.1.m1.1.1.2.2" xref="S4.SS1.SSS3.p1.1.m1.1.1.2.2.cmml">H</mi><mi id="S4.SS1.SSS3.p1.1.m1.1.1.3" xref="S4.SS1.SSS3.p1.1.m1.1.1.3.cmml">g</mi><mi id="S4.SS1.SSS3.p1.1.m1.1.1.2.3" xref="S4.SS1.SSS3.p1.1.m1.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS3.p1.1.m1.1b"><apply id="S4.SS1.SSS3.p1.1.m1.1.1.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.1.m1.1.1.1.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1">subscript</csymbol><apply id="S4.SS1.SSS3.p1.1.m1.1.1.2.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.1.m1.1.1.2.1.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS1.SSS3.p1.1.m1.1.1.2.2.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1.2.2">𝐻</ci><ci id="S4.SS1.SSS3.p1.1.m1.1.1.2.3.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1.2.3">𝑖</ci></apply><ci id="S4.SS1.SSS3.p1.1.m1.1.1.3.cmml" xref="S4.SS1.SSS3.p1.1.m1.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS3.p1.1.m1.1c">H^{i}_{g}</annotation></semantics></math>. At the beginning of training, it is necessary to load the pre-trained model with <math id="S4.SS1.SSS3.p1.2.m2.1" class="ltx_Math" alttext="H^{i}_{g}" display="inline"><semantics id="S4.SS1.SSS3.p1.2.m2.1a"><msubsup id="S4.SS1.SSS3.p1.2.m2.1.1" xref="S4.SS1.SSS3.p1.2.m2.1.1.cmml"><mi id="S4.SS1.SSS3.p1.2.m2.1.1.2.2" xref="S4.SS1.SSS3.p1.2.m2.1.1.2.2.cmml">H</mi><mi id="S4.SS1.SSS3.p1.2.m2.1.1.3" xref="S4.SS1.SSS3.p1.2.m2.1.1.3.cmml">g</mi><mi id="S4.SS1.SSS3.p1.2.m2.1.1.2.3" xref="S4.SS1.SSS3.p1.2.m2.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS3.p1.2.m2.1b"><apply id="S4.SS1.SSS3.p1.2.m2.1.1.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.2.m2.1.1.1.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1">subscript</csymbol><apply id="S4.SS1.SSS3.p1.2.m2.1.1.2.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.2.m2.1.1.2.1.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1">superscript</csymbol><ci id="S4.SS1.SSS3.p1.2.m2.1.1.2.2.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1.2.2">𝐻</ci><ci id="S4.SS1.SSS3.p1.2.m2.1.1.2.3.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1.2.3">𝑖</ci></apply><ci id="S4.SS1.SSS3.p1.2.m2.1.1.3.cmml" xref="S4.SS1.SSS3.p1.2.m2.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS3.p1.2.m2.1c">H^{i}_{g}</annotation></semantics></math> to enable it to perform the classification task, and we denote the model with <math id="S4.SS1.SSS3.p1.3.m3.1" class="ltx_Math" alttext="H^{i}_{g}" display="inline"><semantics id="S4.SS1.SSS3.p1.3.m3.1a"><msubsup id="S4.SS1.SSS3.p1.3.m3.1.1" xref="S4.SS1.SSS3.p1.3.m3.1.1.cmml"><mi id="S4.SS1.SSS3.p1.3.m3.1.1.2.2" xref="S4.SS1.SSS3.p1.3.m3.1.1.2.2.cmml">H</mi><mi id="S4.SS1.SSS3.p1.3.m3.1.1.3" xref="S4.SS1.SSS3.p1.3.m3.1.1.3.cmml">g</mi><mi id="S4.SS1.SSS3.p1.3.m3.1.1.2.3" xref="S4.SS1.SSS3.p1.3.m3.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS3.p1.3.m3.1b"><apply id="S4.SS1.SSS3.p1.3.m3.1.1.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.3.m3.1.1.1.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1">subscript</csymbol><apply id="S4.SS1.SSS3.p1.3.m3.1.1.2.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.3.m3.1.1.2.1.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1">superscript</csymbol><ci id="S4.SS1.SSS3.p1.3.m3.1.1.2.2.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1.2.2">𝐻</ci><ci id="S4.SS1.SSS3.p1.3.m3.1.1.2.3.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1.2.3">𝑖</ci></apply><ci id="S4.SS1.SSS3.p1.3.m3.1.1.3.cmml" xref="S4.SS1.SSS3.p1.3.m3.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS3.p1.3.m3.1c">H^{i}_{g}</annotation></semantics></math> as <math id="S4.SS1.SSS3.p1.4.m4.1" class="ltx_Math" alttext="\mathcal{V}^{i}_{g}" display="inline"><semantics id="S4.SS1.SSS3.p1.4.m4.1a"><msubsup id="S4.SS1.SSS3.p1.4.m4.1.1" xref="S4.SS1.SSS3.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS3.p1.4.m4.1.1.2.2" xref="S4.SS1.SSS3.p1.4.m4.1.1.2.2.cmml">𝒱</mi><mi id="S4.SS1.SSS3.p1.4.m4.1.1.3" xref="S4.SS1.SSS3.p1.4.m4.1.1.3.cmml">g</mi><mi id="S4.SS1.SSS3.p1.4.m4.1.1.2.3" xref="S4.SS1.SSS3.p1.4.m4.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS3.p1.4.m4.1b"><apply id="S4.SS1.SSS3.p1.4.m4.1.1.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.4.m4.1.1.1.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1">subscript</csymbol><apply id="S4.SS1.SSS3.p1.4.m4.1.1.2.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.4.m4.1.1.2.1.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1">superscript</csymbol><ci id="S4.SS1.SSS3.p1.4.m4.1.1.2.2.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1.2.2">𝒱</ci><ci id="S4.SS1.SSS3.p1.4.m4.1.1.2.3.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1.2.3">𝑖</ci></apply><ci id="S4.SS1.SSS3.p1.4.m4.1.1.3.cmml" xref="S4.SS1.SSS3.p1.4.m4.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS3.p1.4.m4.1c">\mathcal{V}^{i}_{g}</annotation></semantics></math>. Overall, the training loss function is as follows:</p>
<table id="S4.E6" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(6)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E6.m1.6" class="ltx_Math" alttext="\underset{H^{i}_{g},\mathcal{P}_{g},\mathcal{K}_{g}}{\operatorname{min}}\mathcal{L}(\mathcal{V}^{i}_{g}(E^{\prime}),y)+\lambda_{1}\sum_{\mathcal{K}^{s}_{g}}\operatorname{dis}(K_{g}^{in},K_{g}^{s_{i}})," display="block"><semantics id="S4.E6.m1.6a"><mrow id="S4.E6.m1.6.6.1" xref="S4.E6.m1.6.6.1.1.cmml"><mrow id="S4.E6.m1.6.6.1.1" xref="S4.E6.m1.6.6.1.1.cmml"><mrow id="S4.E6.m1.6.6.1.1.1" xref="S4.E6.m1.6.6.1.1.1.cmml"><munder accentunder="true" id="S4.E6.m1.3.3" xref="S4.E6.m1.3.3.cmml"><mi id="S4.E6.m1.3.3.4" xref="S4.E6.m1.3.3.4.cmml">min</mi><mrow id="S4.E6.m1.3.3.3.3" xref="S4.E6.m1.3.3.3.4.cmml"><msubsup id="S4.E6.m1.1.1.1.1.1" xref="S4.E6.m1.1.1.1.1.1.cmml"><mi id="S4.E6.m1.1.1.1.1.1.2.2" xref="S4.E6.m1.1.1.1.1.1.2.2.cmml">H</mi><mi id="S4.E6.m1.1.1.1.1.1.3" xref="S4.E6.m1.1.1.1.1.1.3.cmml">g</mi><mi id="S4.E6.m1.1.1.1.1.1.2.3" xref="S4.E6.m1.1.1.1.1.1.2.3.cmml">i</mi></msubsup><mo id="S4.E6.m1.3.3.3.3.4" xref="S4.E6.m1.3.3.3.4.cmml">,</mo><msub id="S4.E6.m1.2.2.2.2.2" xref="S4.E6.m1.2.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E6.m1.2.2.2.2.2.2" xref="S4.E6.m1.2.2.2.2.2.2.cmml">𝒫</mi><mi id="S4.E6.m1.2.2.2.2.2.3" xref="S4.E6.m1.2.2.2.2.2.3.cmml">g</mi></msub><mo id="S4.E6.m1.3.3.3.3.5" xref="S4.E6.m1.3.3.3.4.cmml">,</mo><msub id="S4.E6.m1.3.3.3.3.3" xref="S4.E6.m1.3.3.3.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E6.m1.3.3.3.3.3.2" xref="S4.E6.m1.3.3.3.3.3.2.cmml">𝒦</mi><mi id="S4.E6.m1.3.3.3.3.3.3" xref="S4.E6.m1.3.3.3.3.3.3.cmml">g</mi></msub></mrow></munder><mo lspace="0.167em" rspace="0em" id="S4.E6.m1.6.6.1.1.1.2" xref="S4.E6.m1.6.6.1.1.1.2.cmml">​</mo><mi class="ltx_font_mathcaligraphic" id="S4.E6.m1.6.6.1.1.1.3" xref="S4.E6.m1.6.6.1.1.1.3.cmml">ℒ</mi><mo lspace="0em" rspace="0em" id="S4.E6.m1.6.6.1.1.1.2a" xref="S4.E6.m1.6.6.1.1.1.2.cmml">​</mo><mrow id="S4.E6.m1.6.6.1.1.1.1.1" xref="S4.E6.m1.6.6.1.1.1.1.2.cmml"><mo stretchy="false" id="S4.E6.m1.6.6.1.1.1.1.1.2" xref="S4.E6.m1.6.6.1.1.1.1.2.cmml">(</mo><mrow id="S4.E6.m1.6.6.1.1.1.1.1.1" xref="S4.E6.m1.6.6.1.1.1.1.1.1.cmml"><msubsup id="S4.E6.m1.6.6.1.1.1.1.1.1.3" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.2" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.2.cmml">𝒱</mi><mi id="S4.E6.m1.6.6.1.1.1.1.1.1.3.3" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.3.cmml">g</mi><mi id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.3" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.3.cmml">i</mi></msubsup><mo lspace="0em" rspace="0em" id="S4.E6.m1.6.6.1.1.1.1.1.1.2" xref="S4.E6.m1.6.6.1.1.1.1.1.1.2.cmml">​</mo><mrow id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.2" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.cmml">(</mo><msup id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.2" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.2.cmml">E</mi><mo id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.3" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo stretchy="false" id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.3" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E6.m1.6.6.1.1.1.1.1.3" xref="S4.E6.m1.6.6.1.1.1.1.2.cmml">,</mo><mi id="S4.E6.m1.4.4" xref="S4.E6.m1.4.4.cmml">y</mi><mo stretchy="false" id="S4.E6.m1.6.6.1.1.1.1.1.4" xref="S4.E6.m1.6.6.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E6.m1.6.6.1.1.4" xref="S4.E6.m1.6.6.1.1.4.cmml">+</mo><mrow id="S4.E6.m1.6.6.1.1.3" xref="S4.E6.m1.6.6.1.1.3.cmml"><msub id="S4.E6.m1.6.6.1.1.3.4" xref="S4.E6.m1.6.6.1.1.3.4.cmml"><mi id="S4.E6.m1.6.6.1.1.3.4.2" xref="S4.E6.m1.6.6.1.1.3.4.2.cmml">λ</mi><mn id="S4.E6.m1.6.6.1.1.3.4.3" xref="S4.E6.m1.6.6.1.1.3.4.3.cmml">1</mn></msub><mo lspace="0em" rspace="0em" id="S4.E6.m1.6.6.1.1.3.3" xref="S4.E6.m1.6.6.1.1.3.3.cmml">​</mo><mrow id="S4.E6.m1.6.6.1.1.3.2" xref="S4.E6.m1.6.6.1.1.3.2.cmml"><munder id="S4.E6.m1.6.6.1.1.3.2.3" xref="S4.E6.m1.6.6.1.1.3.2.3.cmml"><mo movablelimits="false" id="S4.E6.m1.6.6.1.1.3.2.3.2" xref="S4.E6.m1.6.6.1.1.3.2.3.2.cmml">∑</mo><msubsup id="S4.E6.m1.6.6.1.1.3.2.3.3" xref="S4.E6.m1.6.6.1.1.3.2.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E6.m1.6.6.1.1.3.2.3.3.2.2" xref="S4.E6.m1.6.6.1.1.3.2.3.3.2.2.cmml">𝒦</mi><mi id="S4.E6.m1.6.6.1.1.3.2.3.3.3" xref="S4.E6.m1.6.6.1.1.3.2.3.3.3.cmml">g</mi><mi id="S4.E6.m1.6.6.1.1.3.2.3.3.2.3" xref="S4.E6.m1.6.6.1.1.3.2.3.3.2.3.cmml">s</mi></msubsup></munder><mrow id="S4.E6.m1.6.6.1.1.3.2.2.2" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml"><mi id="S4.E6.m1.5.5" xref="S4.E6.m1.5.5.cmml">dis</mi><mo id="S4.E6.m1.6.6.1.1.3.2.2.2a" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml">⁡</mo><mrow id="S4.E6.m1.6.6.1.1.3.2.2.2.2" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml"><mo stretchy="false" id="S4.E6.m1.6.6.1.1.3.2.2.2.2.3" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml">(</mo><msubsup id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.cmml"><mi id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.2" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.2.cmml">K</mi><mi id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.3" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.3.cmml">g</mi><mrow id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.cmml"><mi id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.2" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.1" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.1.cmml">​</mo><mi id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.3" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.3.cmml">n</mi></mrow></msubsup><mo id="S4.E6.m1.6.6.1.1.3.2.2.2.2.4" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml">,</mo><msubsup id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.cmml"><mi id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.2" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.2.cmml">K</mi><mi id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.3" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.3.cmml">g</mi><msub id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.cmml"><mi id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.2" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.2.cmml">s</mi><mi id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.3" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.3.cmml">i</mi></msub></msubsup><mo stretchy="false" id="S4.E6.m1.6.6.1.1.3.2.2.2.2.5" xref="S4.E6.m1.6.6.1.1.3.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo id="S4.E6.m1.6.6.1.2" xref="S4.E6.m1.6.6.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E6.m1.6b"><apply id="S4.E6.m1.6.6.1.1.cmml" xref="S4.E6.m1.6.6.1"><plus id="S4.E6.m1.6.6.1.1.4.cmml" xref="S4.E6.m1.6.6.1.1.4"></plus><apply id="S4.E6.m1.6.6.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.1"><times id="S4.E6.m1.6.6.1.1.1.2.cmml" xref="S4.E6.m1.6.6.1.1.1.2"></times><apply id="S4.E6.m1.3.3.cmml" xref="S4.E6.m1.3.3"><list id="S4.E6.m1.3.3.3.4.cmml" xref="S4.E6.m1.3.3.3.3"><apply id="S4.E6.m1.1.1.1.1.1.cmml" xref="S4.E6.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E6.m1.1.1.1.1.1.1.cmml" xref="S4.E6.m1.1.1.1.1.1">subscript</csymbol><apply id="S4.E6.m1.1.1.1.1.1.2.cmml" xref="S4.E6.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E6.m1.1.1.1.1.1.2.1.cmml" xref="S4.E6.m1.1.1.1.1.1">superscript</csymbol><ci id="S4.E6.m1.1.1.1.1.1.2.2.cmml" xref="S4.E6.m1.1.1.1.1.1.2.2">𝐻</ci><ci id="S4.E6.m1.1.1.1.1.1.2.3.cmml" xref="S4.E6.m1.1.1.1.1.1.2.3">𝑖</ci></apply><ci id="S4.E6.m1.1.1.1.1.1.3.cmml" xref="S4.E6.m1.1.1.1.1.1.3">𝑔</ci></apply><apply id="S4.E6.m1.2.2.2.2.2.cmml" xref="S4.E6.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E6.m1.2.2.2.2.2.1.cmml" xref="S4.E6.m1.2.2.2.2.2">subscript</csymbol><ci id="S4.E6.m1.2.2.2.2.2.2.cmml" xref="S4.E6.m1.2.2.2.2.2.2">𝒫</ci><ci id="S4.E6.m1.2.2.2.2.2.3.cmml" xref="S4.E6.m1.2.2.2.2.2.3">𝑔</ci></apply><apply id="S4.E6.m1.3.3.3.3.3.cmml" xref="S4.E6.m1.3.3.3.3.3"><csymbol cd="ambiguous" id="S4.E6.m1.3.3.3.3.3.1.cmml" xref="S4.E6.m1.3.3.3.3.3">subscript</csymbol><ci id="S4.E6.m1.3.3.3.3.3.2.cmml" xref="S4.E6.m1.3.3.3.3.3.2">𝒦</ci><ci id="S4.E6.m1.3.3.3.3.3.3.cmml" xref="S4.E6.m1.3.3.3.3.3.3">𝑔</ci></apply></list><ci id="S4.E6.m1.3.3.4.cmml" xref="S4.E6.m1.3.3.4">min</ci></apply><ci id="S4.E6.m1.6.6.1.1.1.3.cmml" xref="S4.E6.m1.6.6.1.1.1.3">ℒ</ci><interval closure="open" id="S4.E6.m1.6.6.1.1.1.1.2.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1"><apply id="S4.E6.m1.6.6.1.1.1.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1"><times id="S4.E6.m1.6.6.1.1.1.1.1.1.2.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.2"></times><apply id="S4.E6.m1.6.6.1.1.1.1.1.1.3.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.1.1.1.1.3.1.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3">subscript</csymbol><apply id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.1.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3">superscript</csymbol><ci id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.2.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.2">𝒱</ci><ci id="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.3.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.2.3">𝑖</ci></apply><ci id="S4.E6.m1.6.6.1.1.1.1.1.1.3.3.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.3.3">𝑔</ci></apply><apply id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.2">𝐸</ci><ci id="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E6.m1.6.6.1.1.1.1.1.1.1.1.1.3">′</ci></apply></apply><ci id="S4.E6.m1.4.4.cmml" xref="S4.E6.m1.4.4">𝑦</ci></interval></apply><apply id="S4.E6.m1.6.6.1.1.3.cmml" xref="S4.E6.m1.6.6.1.1.3"><times id="S4.E6.m1.6.6.1.1.3.3.cmml" xref="S4.E6.m1.6.6.1.1.3.3"></times><apply id="S4.E6.m1.6.6.1.1.3.4.cmml" xref="S4.E6.m1.6.6.1.1.3.4"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.4.1.cmml" xref="S4.E6.m1.6.6.1.1.3.4">subscript</csymbol><ci id="S4.E6.m1.6.6.1.1.3.4.2.cmml" xref="S4.E6.m1.6.6.1.1.3.4.2">𝜆</ci><cn type="integer" id="S4.E6.m1.6.6.1.1.3.4.3.cmml" xref="S4.E6.m1.6.6.1.1.3.4.3">1</cn></apply><apply id="S4.E6.m1.6.6.1.1.3.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2"><apply id="S4.E6.m1.6.6.1.1.3.2.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.3.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3">subscript</csymbol><sum id="S4.E6.m1.6.6.1.1.3.2.3.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.2"></sum><apply id="S4.E6.m1.6.6.1.1.3.2.3.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.3.3.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3">subscript</csymbol><apply id="S4.E6.m1.6.6.1.1.3.2.3.3.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.3.3.2.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3">superscript</csymbol><ci id="S4.E6.m1.6.6.1.1.3.2.3.3.2.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3.2.2">𝒦</ci><ci id="S4.E6.m1.6.6.1.1.3.2.3.3.2.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3.2.3">𝑠</ci></apply><ci id="S4.E6.m1.6.6.1.1.3.2.3.3.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.3.3.3">𝑔</ci></apply></apply><apply id="S4.E6.m1.6.6.1.1.3.2.2.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2"><ci id="S4.E6.m1.5.5.cmml" xref="S4.E6.m1.5.5">dis</ci><apply id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.1.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1">superscript</csymbol><apply id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.1.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1">subscript</csymbol><ci id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.2.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.2">𝐾</ci><ci id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.3.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.2.3">𝑔</ci></apply><apply id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3"><times id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.1.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.1"></times><ci id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.2.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.2">𝑖</ci><ci id="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.3.cmml" xref="S4.E6.m1.6.6.1.1.2.1.1.1.1.1.3.3">𝑛</ci></apply></apply><apply id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2">superscript</csymbol><apply id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2">subscript</csymbol><ci id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.2">𝐾</ci><ci id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.2.3">𝑔</ci></apply><apply id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.1.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3">subscript</csymbol><ci id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.2.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.2">𝑠</ci><ci id="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.3.cmml" xref="S4.E6.m1.6.6.1.1.3.2.2.2.2.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E6.m1.6c">\underset{H^{i}_{g},\mathcal{P}_{g},\mathcal{K}_{g}}{\operatorname{min}}\mathcal{L}(\mathcal{V}^{i}_{g}(E^{\prime}),y)+\lambda_{1}\sum_{\mathcal{K}^{s}_{g}}\operatorname{dis}(K_{g}^{in},K_{g}^{s_{i}}),</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS1.SSS3.p1.5" class="ltx_p">where <math id="S4.SS1.SSS3.p1.5.m1.1" class="ltx_Math" alttext="\lambda_{1}" display="inline"><semantics id="S4.SS1.SSS3.p1.5.m1.1a"><msub id="S4.SS1.SSS3.p1.5.m1.1.1" xref="S4.SS1.SSS3.p1.5.m1.1.1.cmml"><mi id="S4.SS1.SSS3.p1.5.m1.1.1.2" xref="S4.SS1.SSS3.p1.5.m1.1.1.2.cmml">λ</mi><mn id="S4.SS1.SSS3.p1.5.m1.1.1.3" xref="S4.SS1.SSS3.p1.5.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS3.p1.5.m1.1b"><apply id="S4.SS1.SSS3.p1.5.m1.1.1.cmml" xref="S4.SS1.SSS3.p1.5.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS3.p1.5.m1.1.1.1.cmml" xref="S4.SS1.SSS3.p1.5.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS3.p1.5.m1.1.1.2.cmml" xref="S4.SS1.SSS3.p1.5.m1.1.1.2">𝜆</ci><cn type="integer" id="S4.SS1.SSS3.p1.5.m1.1.1.3.cmml" xref="S4.SS1.SSS3.p1.5.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS3.p1.5.m1.1c">\lambda_{1}</annotation></semantics></math> is a hyperparameter. The initial term comprises the softmax cross-entropy loss, while the subsequent term serves as a surrogate loss aimed at bringing selected keys closer to their corresponding query features.</p>
</div>
</section>
</section>
<section id="S4.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2. </span>Fine-grained Local Prompts</h3>

<div id="S4.SS2.p1" class="ltx_para">
<p id="S4.SS2.p1.1" class="ltx_p">Once the training of global prompts is completed, they will be frozen and remain unchanged, including both the prompts themselves and their corresponding keys, until the next task training. Based on the frozen global prompts, we further developed fine-grained class-wise local prompts. These prompts directly impact the model’s multi-head self-attention (MSA) <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al<span class="ltx_text">.</span>, <a href="#bib.bib40" title="" class="ltx_ref">2017</a>)</cite> layers, facilitating the extraction of local, fine-grained knowledge. Additionally, this fine-grained prompting helps overcome temporal forgetting induced by class increments. The hierarchy of prompts, from coarse to fine, simplifies generalized knowledge extraction, fusion, and personalization.</p>
</div>
<section id="S4.SS2.SSS1" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.1. </span>From Coarse to Fine</h4>

<div id="S4.SS2.SSS1.p1" class="ltx_para">
<p id="S4.SS2.SSS1.p1.2" class="ltx_p">Similarly, a prompt pool is constructed for local prompts. However, since it represents class-specific knowledge, the size of the pool depends on the number of data classes. The local prompt pool is defined as</p>
<table id="S4.E7" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(7)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E7.m1.2" class="ltx_Math" alttext="\mathcal{P}_{l}=\{(K_{l}^{1},P_{l}^{1}),(K_{l}^{2},P_{l}^{2}),\ldots,(K_{l}^{C},P_{l}^{C})\}," display="block"><semantics id="S4.E7.m1.2a"><mrow id="S4.E7.m1.2.2.1" xref="S4.E7.m1.2.2.1.1.cmml"><mrow id="S4.E7.m1.2.2.1.1" xref="S4.E7.m1.2.2.1.1.cmml"><msub id="S4.E7.m1.2.2.1.1.5" xref="S4.E7.m1.2.2.1.1.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E7.m1.2.2.1.1.5.2" xref="S4.E7.m1.2.2.1.1.5.2.cmml">𝒫</mi><mi id="S4.E7.m1.2.2.1.1.5.3" xref="S4.E7.m1.2.2.1.1.5.3.cmml">l</mi></msub><mo id="S4.E7.m1.2.2.1.1.4" xref="S4.E7.m1.2.2.1.1.4.cmml">=</mo><mrow id="S4.E7.m1.2.2.1.1.3.3" xref="S4.E7.m1.2.2.1.1.3.4.cmml"><mo stretchy="false" id="S4.E7.m1.2.2.1.1.3.3.4" xref="S4.E7.m1.2.2.1.1.3.4.cmml">{</mo><mrow id="S4.E7.m1.2.2.1.1.1.1.1.2" xref="S4.E7.m1.2.2.1.1.1.1.1.3.cmml"><mo stretchy="false" id="S4.E7.m1.2.2.1.1.1.1.1.2.3" xref="S4.E7.m1.2.2.1.1.1.1.1.3.cmml">(</mo><msubsup id="S4.E7.m1.2.2.1.1.1.1.1.1.1" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.2.cmml">K</mi><mi id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.3" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.3.cmml">l</mi><mn id="S4.E7.m1.2.2.1.1.1.1.1.1.1.3" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.3.cmml">1</mn></msubsup><mo id="S4.E7.m1.2.2.1.1.1.1.1.2.4" xref="S4.E7.m1.2.2.1.1.1.1.1.3.cmml">,</mo><msubsup id="S4.E7.m1.2.2.1.1.1.1.1.2.2" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.cmml"><mi id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.2" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.2.cmml">P</mi><mi id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.3" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.3.cmml">l</mi><mn id="S4.E7.m1.2.2.1.1.1.1.1.2.2.3" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.3.cmml">1</mn></msubsup><mo stretchy="false" id="S4.E7.m1.2.2.1.1.1.1.1.2.5" xref="S4.E7.m1.2.2.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S4.E7.m1.2.2.1.1.3.3.5" xref="S4.E7.m1.2.2.1.1.3.4.cmml">,</mo><mrow id="S4.E7.m1.2.2.1.1.2.2.2.2" xref="S4.E7.m1.2.2.1.1.2.2.2.3.cmml"><mo stretchy="false" id="S4.E7.m1.2.2.1.1.2.2.2.2.3" xref="S4.E7.m1.2.2.1.1.2.2.2.3.cmml">(</mo><msubsup id="S4.E7.m1.2.2.1.1.2.2.2.1.1" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.cmml"><mi id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.2" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.2.cmml">K</mi><mi id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.3" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.3.cmml">l</mi><mn id="S4.E7.m1.2.2.1.1.2.2.2.1.1.3" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.3.cmml">2</mn></msubsup><mo id="S4.E7.m1.2.2.1.1.2.2.2.2.4" xref="S4.E7.m1.2.2.1.1.2.2.2.3.cmml">,</mo><msubsup id="S4.E7.m1.2.2.1.1.2.2.2.2.2" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.cmml"><mi id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.2" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.2.cmml">P</mi><mi id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.3" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.3.cmml">l</mi><mn id="S4.E7.m1.2.2.1.1.2.2.2.2.2.3" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.3.cmml">2</mn></msubsup><mo stretchy="false" id="S4.E7.m1.2.2.1.1.2.2.2.2.5" xref="S4.E7.m1.2.2.1.1.2.2.2.3.cmml">)</mo></mrow><mo id="S4.E7.m1.2.2.1.1.3.3.6" xref="S4.E7.m1.2.2.1.1.3.4.cmml">,</mo><mi mathvariant="normal" id="S4.E7.m1.1.1" xref="S4.E7.m1.1.1.cmml">…</mi><mo id="S4.E7.m1.2.2.1.1.3.3.7" xref="S4.E7.m1.2.2.1.1.3.4.cmml">,</mo><mrow id="S4.E7.m1.2.2.1.1.3.3.3.2" xref="S4.E7.m1.2.2.1.1.3.3.3.3.cmml"><mo stretchy="false" id="S4.E7.m1.2.2.1.1.3.3.3.2.3" xref="S4.E7.m1.2.2.1.1.3.3.3.3.cmml">(</mo><msubsup id="S4.E7.m1.2.2.1.1.3.3.3.1.1" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.cmml"><mi id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.2" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.2.cmml">K</mi><mi id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.3" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.3.cmml">l</mi><mi id="S4.E7.m1.2.2.1.1.3.3.3.1.1.3" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.3.cmml">C</mi></msubsup><mo id="S4.E7.m1.2.2.1.1.3.3.3.2.4" xref="S4.E7.m1.2.2.1.1.3.3.3.3.cmml">,</mo><msubsup id="S4.E7.m1.2.2.1.1.3.3.3.2.2" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.cmml"><mi id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.2" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.2.cmml">P</mi><mi id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.3" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.3.cmml">l</mi><mi id="S4.E7.m1.2.2.1.1.3.3.3.2.2.3" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.3.cmml">C</mi></msubsup><mo stretchy="false" id="S4.E7.m1.2.2.1.1.3.3.3.2.5" xref="S4.E7.m1.2.2.1.1.3.3.3.3.cmml">)</mo></mrow><mo stretchy="false" id="S4.E7.m1.2.2.1.1.3.3.8" xref="S4.E7.m1.2.2.1.1.3.4.cmml">}</mo></mrow></mrow><mo id="S4.E7.m1.2.2.1.2" xref="S4.E7.m1.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E7.m1.2b"><apply id="S4.E7.m1.2.2.1.1.cmml" xref="S4.E7.m1.2.2.1"><eq id="S4.E7.m1.2.2.1.1.4.cmml" xref="S4.E7.m1.2.2.1.1.4"></eq><apply id="S4.E7.m1.2.2.1.1.5.cmml" xref="S4.E7.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.5.1.cmml" xref="S4.E7.m1.2.2.1.1.5">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.5.2.cmml" xref="S4.E7.m1.2.2.1.1.5.2">𝒫</ci><ci id="S4.E7.m1.2.2.1.1.5.3.cmml" xref="S4.E7.m1.2.2.1.1.5.3">𝑙</ci></apply><set id="S4.E7.m1.2.2.1.1.3.4.cmml" xref="S4.E7.m1.2.2.1.1.3.3"><interval closure="open" id="S4.E7.m1.2.2.1.1.1.1.1.3.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2"><apply id="S4.E7.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.2">𝐾</ci><ci id="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.2.3">𝑙</ci></apply><cn type="integer" id="S4.E7.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.1.1.3">1</cn></apply><apply id="S4.E7.m1.2.2.1.1.1.1.1.2.2.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.1.1.1.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.2">𝑃</ci><ci id="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.2.3">𝑙</ci></apply><cn type="integer" id="S4.E7.m1.2.2.1.1.1.1.1.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.1.1.1.2.2.3">1</cn></apply></interval><interval closure="open" id="S4.E7.m1.2.2.1.1.2.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2"><apply id="S4.E7.m1.2.2.1.1.2.2.2.1.1.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.2.2.2.1.1.1.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.1.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.2.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.2">𝐾</ci><ci id="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.3.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.2.3">𝑙</ci></apply><cn type="integer" id="S4.E7.m1.2.2.1.1.2.2.2.1.1.3.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.1.1.3">2</cn></apply><apply id="S4.E7.m1.2.2.1.1.2.2.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.2.2.2.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.2">𝑃</ci><ci id="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.2.3">𝑙</ci></apply><cn type="integer" id="S4.E7.m1.2.2.1.1.2.2.2.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.2.2.2.2.2.3">2</cn></apply></interval><ci id="S4.E7.m1.1.1.cmml" xref="S4.E7.m1.1.1">…</ci><interval closure="open" id="S4.E7.m1.2.2.1.1.3.3.3.3.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2"><apply id="S4.E7.m1.2.2.1.1.3.3.3.1.1.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.3.3.3.1.1.1.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.1.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.2.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.2">𝐾</ci><ci id="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.3.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.2.3">𝑙</ci></apply><ci id="S4.E7.m1.2.2.1.1.3.3.3.1.1.3.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.1.1.3">𝐶</ci></apply><apply id="S4.E7.m1.2.2.1.1.3.3.3.2.2.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.3.3.3.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2">superscript</csymbol><apply id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.1.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2">subscript</csymbol><ci id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.2.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.2">𝑃</ci><ci id="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.2.3">𝑙</ci></apply><ci id="S4.E7.m1.2.2.1.1.3.3.3.2.2.3.cmml" xref="S4.E7.m1.2.2.1.1.3.3.3.2.2.3">𝐶</ci></apply></interval></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E7.m1.2c">\mathcal{P}_{l}=\{(K_{l}^{1},P_{l}^{1}),(K_{l}^{2},P_{l}^{2}),\ldots,(K_{l}^{C},P_{l}^{C})\},</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS2.SSS1.p1.1" class="ltx_p">where <math id="S4.SS2.SSS1.p1.1.m1.1" class="ltx_Math" alttext="C" display="inline"><semantics id="S4.SS2.SSS1.p1.1.m1.1a"><mi id="S4.SS2.SSS1.p1.1.m1.1.1" xref="S4.SS2.SSS1.p1.1.m1.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS1.p1.1.m1.1b"><ci id="S4.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS1.p1.1.m1.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS1.p1.1.m1.1c">C</annotation></semantics></math> represents the number of classes. It is precisely the class-wise fine-grained knowledge that imparts significant effectiveness to our approach of personalization and addressing temporal forgetting induced by class increments. It is proved in <a href="#S5.SS3" title="5.3. Ablation Studies ‣ 5. Experiments ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 5.3</span></a>.</p>
</div>
</section>
<section id="S4.SS2.SSS2" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.2. </span>Local Query Function</h4>

<div id="S4.SS2.SSS2.p1" class="ltx_para">
<p id="S4.SS2.SSS2.p1.4" class="ltx_p">Fine-grained prompts are selected based on the global prompt, so we must first obtain frozen global prompts by allowing the original input <math id="S4.SS2.SSS2.p1.1.m1.1" class="ltx_Math" alttext="x" display="inline"><semantics id="S4.SS2.SSS2.p1.1.m1.1a"><mi id="S4.SS2.SSS2.p1.1.m1.1.1" xref="S4.SS2.SSS2.p1.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.1.m1.1b"><ci id="S4.SS2.SSS2.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS2.p1.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.1.m1.1c">x</annotation></semantics></math> to undergo the global query function. Subsequently, we concatenate to form an input <math id="S4.SS2.SSS2.p1.2.m2.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="S4.SS2.SSS2.p1.2.m2.1a"><msup id="S4.SS2.SSS2.p1.2.m2.1.1" xref="S4.SS2.SSS2.p1.2.m2.1.1.cmml"><mi id="S4.SS2.SSS2.p1.2.m2.1.1.2" xref="S4.SS2.SSS2.p1.2.m2.1.1.2.cmml">E</mi><mo id="S4.SS2.SSS2.p1.2.m2.1.1.3" xref="S4.SS2.SSS2.p1.2.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.2.m2.1b"><apply id="S4.SS2.SSS2.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.SSS2.p1.2.m2.1.1">superscript</csymbol><ci id="S4.SS2.SSS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.SSS2.p1.2.m2.1.1.2">𝐸</ci><ci id="S4.SS2.SSS2.p1.2.m2.1.1.3.cmml" xref="S4.SS2.SSS2.p1.2.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.2.m2.1c">E^{\prime}</annotation></semantics></math> with selected global prompts. Then, similar to obtaining the key for global prompts, we acquire the key for local prompts <math id="S4.SS2.SSS2.p1.3.m3.1" class="ltx_Math" alttext="K_{g}^{in}=\mathcal{V}(E^{\prime})" display="inline"><semantics id="S4.SS2.SSS2.p1.3.m3.1a"><mrow id="S4.SS2.SSS2.p1.3.m3.1.1" xref="S4.SS2.SSS2.p1.3.m3.1.1.cmml"><msubsup id="S4.SS2.SSS2.p1.3.m3.1.1.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.cmml"><mi id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.2.2.cmml">K</mi><mi id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.2.3.cmml">g</mi><mrow id="S4.SS2.SSS2.p1.3.m3.1.1.3.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.cmml"><mi id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.1" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.1.cmml">​</mo><mi id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.3.cmml">n</mi></mrow></msubsup><mo id="S4.SS2.SSS2.p1.3.m3.1.1.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.2.cmml">=</mo><mrow id="S4.SS2.SSS2.p1.3.m3.1.1.1" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.SSS2.p1.3.m3.1.1.1.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.3.cmml">𝒱</mi><mo lspace="0em" rspace="0em" id="S4.SS2.SSS2.p1.3.m3.1.1.1.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.2.cmml">​</mo><mrow id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.cmml">(</mo><msup id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.cmml"><mi id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.2" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.2.cmml">E</mi><mo id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.3.cmml">′</mo></msup><mo stretchy="false" id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.3" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.3.m3.1b"><apply id="S4.SS2.SSS2.p1.3.m3.1.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1"><eq id="S4.SS2.SSS2.p1.3.m3.1.1.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.2"></eq><apply id="S4.SS2.SSS2.p1.3.m3.1.1.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS2.p1.3.m3.1.1.3.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3">superscript</csymbol><apply id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3">subscript</csymbol><ci id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.2.2">𝐾</ci><ci id="S4.SS2.SSS2.p1.3.m3.1.1.3.2.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.2.3">𝑔</ci></apply><apply id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3"><times id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.1"></times><ci id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.2">𝑖</ci><ci id="S4.SS2.SSS2.p1.3.m3.1.1.3.3.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.3.3.3">𝑛</ci></apply></apply><apply id="S4.SS2.SSS2.p1.3.m3.1.1.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1"><times id="S4.SS2.SSS2.p1.3.m3.1.1.1.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.2"></times><ci id="S4.SS2.SSS2.p1.3.m3.1.1.1.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.3">𝒱</ci><apply id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.1.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1">superscript</csymbol><ci id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.2.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.2">𝐸</ci><ci id="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.3.cmml" xref="S4.SS2.SSS2.p1.3.m3.1.1.1.1.1.1.3">′</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.3.m3.1c">K_{g}^{in}=\mathcal{V}(E^{\prime})</annotation></semantics></math>, with the only difference being that the input is now <math id="S4.SS2.SSS2.p1.4.m4.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="S4.SS2.SSS2.p1.4.m4.1a"><msup id="S4.SS2.SSS2.p1.4.m4.1.1" xref="S4.SS2.SSS2.p1.4.m4.1.1.cmml"><mi id="S4.SS2.SSS2.p1.4.m4.1.1.2" xref="S4.SS2.SSS2.p1.4.m4.1.1.2.cmml">E</mi><mo id="S4.SS2.SSS2.p1.4.m4.1.1.3" xref="S4.SS2.SSS2.p1.4.m4.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.4.m4.1b"><apply id="S4.SS2.SSS2.p1.4.m4.1.1.cmml" xref="S4.SS2.SSS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS2.p1.4.m4.1.1.1.cmml" xref="S4.SS2.SSS2.p1.4.m4.1.1">superscript</csymbol><ci id="S4.SS2.SSS2.p1.4.m4.1.1.2.cmml" xref="S4.SS2.SSS2.p1.4.m4.1.1.2">𝐸</ci><ci id="S4.SS2.SSS2.p1.4.m4.1.1.3.cmml" xref="S4.SS2.SSS2.p1.4.m4.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.4.m4.1c">E^{\prime}</annotation></semantics></math>. The subsequent steps of calculating similarity and selection are analogous to the corresponding operations for global prompts.</p>
</div>
<div id="S4.SS2.SSS2.p2" class="ltx_para">
<p id="S4.SS2.SSS2.p2.1" class="ltx_p">Note that we do not employ this querying function during the <span id="S4.SS2.SSS2.p2.1.1" class="ltx_text ltx_font_italic">training phase</span>. Instead, we use mask code to select the local prompt corresponding to the data class for training.</p>
</div>
</section>
<section id="S4.SS2.SSS3" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.3. </span>Optimization for Local Prompt</h4>

<div id="S4.SS2.SSS3.p1" class="ltx_para">
<p id="S4.SS2.SSS3.p1.1" class="ltx_p">Local prompts directly operate on the model’s MSA layer, where we represent the input query, key, and values as <math id="S4.SS2.SSS3.p1.1.m1.3" class="ltx_Math" alttext="h_{q},h_{k},h_{v}" display="inline"><semantics id="S4.SS2.SSS3.p1.1.m1.3a"><mrow id="S4.SS2.SSS3.p1.1.m1.3.3.3" xref="S4.SS2.SSS3.p1.1.m1.3.3.4.cmml"><msub id="S4.SS2.SSS3.p1.1.m1.1.1.1.1" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1.cmml"><mi id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.2" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.3" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1.3.cmml">q</mi></msub><mo id="S4.SS2.SSS3.p1.1.m1.3.3.3.4" xref="S4.SS2.SSS3.p1.1.m1.3.3.4.cmml">,</mo><msub id="S4.SS2.SSS3.p1.1.m1.2.2.2.2" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2.cmml"><mi id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.2" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.3" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2.3.cmml">k</mi></msub><mo id="S4.SS2.SSS3.p1.1.m1.3.3.3.5" xref="S4.SS2.SSS3.p1.1.m1.3.3.4.cmml">,</mo><msub id="S4.SS2.SSS3.p1.1.m1.3.3.3.3" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3.cmml"><mi id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.2" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.3" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3.3.cmml">v</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.1.m1.3b"><list id="S4.SS2.SSS3.p1.1.m1.3.3.4.cmml" xref="S4.SS2.SSS3.p1.1.m1.3.3.3"><apply id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.cmml" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.1.cmml" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.2.cmml" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.1.m1.1.1.1.1.3.cmml" xref="S4.SS2.SSS3.p1.1.m1.1.1.1.1.3">𝑞</ci></apply><apply id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.cmml" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.1.cmml" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2">subscript</csymbol><ci id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.2.cmml" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.1.m1.2.2.2.2.3.cmml" xref="S4.SS2.SSS3.p1.1.m1.2.2.2.2.3">𝑘</ci></apply><apply id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.cmml" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.1.cmml" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3">subscript</csymbol><ci id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.2.cmml" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.1.m1.3.3.3.3.3.cmml" xref="S4.SS2.SSS3.p1.1.m1.3.3.3.3.3">𝑣</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.1.m1.3c">h_{q},h_{k},h_{v}</annotation></semantics></math>, respectively. MSA layers can be denoted as:</p>
<table id="S4.E8" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(8)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E8.m1.3" class="ltx_Math" alttext="\text{MSA}(h_{q},h_{k},h_{v})=\operatorname{Concat}\left(\mathrm{h}_{1},\ldots,\mathrm{h}_{\mathrm{z}}\right)W^{O}," display="block"><semantics id="S4.E8.m1.3a"><mrow id="S4.E8.m1.3.3.1" xref="S4.E8.m1.3.3.1.1.cmml"><mrow id="S4.E8.m1.3.3.1.1" xref="S4.E8.m1.3.3.1.1.cmml"><mrow id="S4.E8.m1.3.3.1.1.3" xref="S4.E8.m1.3.3.1.1.3.cmml"><mtext id="S4.E8.m1.3.3.1.1.3.5" xref="S4.E8.m1.3.3.1.1.3.5a.cmml">MSA</mtext><mo lspace="0em" rspace="0em" id="S4.E8.m1.3.3.1.1.3.4" xref="S4.E8.m1.3.3.1.1.3.4.cmml">​</mo><mrow id="S4.E8.m1.3.3.1.1.3.3.3" xref="S4.E8.m1.3.3.1.1.3.3.4.cmml"><mo stretchy="false" id="S4.E8.m1.3.3.1.1.3.3.3.4" xref="S4.E8.m1.3.3.1.1.3.3.4.cmml">(</mo><msub id="S4.E8.m1.3.3.1.1.1.1.1.1" xref="S4.E8.m1.3.3.1.1.1.1.1.1.cmml"><mi id="S4.E8.m1.3.3.1.1.1.1.1.1.2" xref="S4.E8.m1.3.3.1.1.1.1.1.1.2.cmml">h</mi><mi id="S4.E8.m1.3.3.1.1.1.1.1.1.3" xref="S4.E8.m1.3.3.1.1.1.1.1.1.3.cmml">q</mi></msub><mo id="S4.E8.m1.3.3.1.1.3.3.3.5" xref="S4.E8.m1.3.3.1.1.3.3.4.cmml">,</mo><msub id="S4.E8.m1.3.3.1.1.2.2.2.2" xref="S4.E8.m1.3.3.1.1.2.2.2.2.cmml"><mi id="S4.E8.m1.3.3.1.1.2.2.2.2.2" xref="S4.E8.m1.3.3.1.1.2.2.2.2.2.cmml">h</mi><mi id="S4.E8.m1.3.3.1.1.2.2.2.2.3" xref="S4.E8.m1.3.3.1.1.2.2.2.2.3.cmml">k</mi></msub><mo id="S4.E8.m1.3.3.1.1.3.3.3.6" xref="S4.E8.m1.3.3.1.1.3.3.4.cmml">,</mo><msub id="S4.E8.m1.3.3.1.1.3.3.3.3" xref="S4.E8.m1.3.3.1.1.3.3.3.3.cmml"><mi id="S4.E8.m1.3.3.1.1.3.3.3.3.2" xref="S4.E8.m1.3.3.1.1.3.3.3.3.2.cmml">h</mi><mi id="S4.E8.m1.3.3.1.1.3.3.3.3.3" xref="S4.E8.m1.3.3.1.1.3.3.3.3.3.cmml">v</mi></msub><mo stretchy="false" id="S4.E8.m1.3.3.1.1.3.3.3.7" xref="S4.E8.m1.3.3.1.1.3.3.4.cmml">)</mo></mrow></mrow><mo id="S4.E8.m1.3.3.1.1.6" xref="S4.E8.m1.3.3.1.1.6.cmml">=</mo><mrow id="S4.E8.m1.3.3.1.1.5" xref="S4.E8.m1.3.3.1.1.5.cmml"><mrow id="S4.E8.m1.3.3.1.1.5.2.2" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml"><mi id="S4.E8.m1.1.1" xref="S4.E8.m1.1.1.cmml">Concat</mi><mo id="S4.E8.m1.3.3.1.1.5.2.2a" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml">⁡</mo><mrow id="S4.E8.m1.3.3.1.1.5.2.2.2" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml"><mo id="S4.E8.m1.3.3.1.1.5.2.2.2.3" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml">(</mo><msub id="S4.E8.m1.3.3.1.1.4.1.1.1.1" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1.cmml"><mi mathvariant="normal" id="S4.E8.m1.3.3.1.1.4.1.1.1.1.2" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1.2.cmml">h</mi><mn id="S4.E8.m1.3.3.1.1.4.1.1.1.1.3" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1.3.cmml">1</mn></msub><mo id="S4.E8.m1.3.3.1.1.5.2.2.2.4" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml">,</mo><mi mathvariant="normal" id="S4.E8.m1.2.2" xref="S4.E8.m1.2.2.cmml">…</mi><mo id="S4.E8.m1.3.3.1.1.5.2.2.2.5" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml">,</mo><msub id="S4.E8.m1.3.3.1.1.5.2.2.2.2" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2.cmml"><mi mathvariant="normal" id="S4.E8.m1.3.3.1.1.5.2.2.2.2.2" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2.2.cmml">h</mi><mi mathvariant="normal" id="S4.E8.m1.3.3.1.1.5.2.2.2.2.3" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2.3.cmml">z</mi></msub><mo id="S4.E8.m1.3.3.1.1.5.2.2.2.6" xref="S4.E8.m1.3.3.1.1.5.2.3.cmml">)</mo></mrow></mrow><mo lspace="0em" rspace="0em" id="S4.E8.m1.3.3.1.1.5.3" xref="S4.E8.m1.3.3.1.1.5.3.cmml">​</mo><msup id="S4.E8.m1.3.3.1.1.5.4" xref="S4.E8.m1.3.3.1.1.5.4.cmml"><mi id="S4.E8.m1.3.3.1.1.5.4.2" xref="S4.E8.m1.3.3.1.1.5.4.2.cmml">W</mi><mi id="S4.E8.m1.3.3.1.1.5.4.3" xref="S4.E8.m1.3.3.1.1.5.4.3.cmml">O</mi></msup></mrow></mrow><mo id="S4.E8.m1.3.3.1.2" xref="S4.E8.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E8.m1.3b"><apply id="S4.E8.m1.3.3.1.1.cmml" xref="S4.E8.m1.3.3.1"><eq id="S4.E8.m1.3.3.1.1.6.cmml" xref="S4.E8.m1.3.3.1.1.6"></eq><apply id="S4.E8.m1.3.3.1.1.3.cmml" xref="S4.E8.m1.3.3.1.1.3"><times id="S4.E8.m1.3.3.1.1.3.4.cmml" xref="S4.E8.m1.3.3.1.1.3.4"></times><ci id="S4.E8.m1.3.3.1.1.3.5a.cmml" xref="S4.E8.m1.3.3.1.1.3.5"><mtext id="S4.E8.m1.3.3.1.1.3.5.cmml" xref="S4.E8.m1.3.3.1.1.3.5">MSA</mtext></ci><vector id="S4.E8.m1.3.3.1.1.3.3.4.cmml" xref="S4.E8.m1.3.3.1.1.3.3.3"><apply id="S4.E8.m1.3.3.1.1.1.1.1.1.cmml" xref="S4.E8.m1.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S4.E8.m1.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E8.m1.3.3.1.1.1.1.1.1.2.cmml" xref="S4.E8.m1.3.3.1.1.1.1.1.1.2">ℎ</ci><ci id="S4.E8.m1.3.3.1.1.1.1.1.1.3.cmml" xref="S4.E8.m1.3.3.1.1.1.1.1.1.3">𝑞</ci></apply><apply id="S4.E8.m1.3.3.1.1.2.2.2.2.cmml" xref="S4.E8.m1.3.3.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.2.2.2.2.1.cmml" xref="S4.E8.m1.3.3.1.1.2.2.2.2">subscript</csymbol><ci id="S4.E8.m1.3.3.1.1.2.2.2.2.2.cmml" xref="S4.E8.m1.3.3.1.1.2.2.2.2.2">ℎ</ci><ci id="S4.E8.m1.3.3.1.1.2.2.2.2.3.cmml" xref="S4.E8.m1.3.3.1.1.2.2.2.2.3">𝑘</ci></apply><apply id="S4.E8.m1.3.3.1.1.3.3.3.3.cmml" xref="S4.E8.m1.3.3.1.1.3.3.3.3"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.3.3.3.3.1.cmml" xref="S4.E8.m1.3.3.1.1.3.3.3.3">subscript</csymbol><ci id="S4.E8.m1.3.3.1.1.3.3.3.3.2.cmml" xref="S4.E8.m1.3.3.1.1.3.3.3.3.2">ℎ</ci><ci id="S4.E8.m1.3.3.1.1.3.3.3.3.3.cmml" xref="S4.E8.m1.3.3.1.1.3.3.3.3.3">𝑣</ci></apply></vector></apply><apply id="S4.E8.m1.3.3.1.1.5.cmml" xref="S4.E8.m1.3.3.1.1.5"><times id="S4.E8.m1.3.3.1.1.5.3.cmml" xref="S4.E8.m1.3.3.1.1.5.3"></times><apply id="S4.E8.m1.3.3.1.1.5.2.3.cmml" xref="S4.E8.m1.3.3.1.1.5.2.2"><ci id="S4.E8.m1.1.1.cmml" xref="S4.E8.m1.1.1">Concat</ci><apply id="S4.E8.m1.3.3.1.1.4.1.1.1.1.cmml" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.4.1.1.1.1.1.cmml" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1">subscript</csymbol><ci id="S4.E8.m1.3.3.1.1.4.1.1.1.1.2.cmml" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1.2">h</ci><cn type="integer" id="S4.E8.m1.3.3.1.1.4.1.1.1.1.3.cmml" xref="S4.E8.m1.3.3.1.1.4.1.1.1.1.3">1</cn></apply><ci id="S4.E8.m1.2.2.cmml" xref="S4.E8.m1.2.2">…</ci><apply id="S4.E8.m1.3.3.1.1.5.2.2.2.2.cmml" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.5.2.2.2.2.1.cmml" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2">subscript</csymbol><ci id="S4.E8.m1.3.3.1.1.5.2.2.2.2.2.cmml" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2.2">h</ci><ci id="S4.E8.m1.3.3.1.1.5.2.2.2.2.3.cmml" xref="S4.E8.m1.3.3.1.1.5.2.2.2.2.3">z</ci></apply></apply><apply id="S4.E8.m1.3.3.1.1.5.4.cmml" xref="S4.E8.m1.3.3.1.1.5.4"><csymbol cd="ambiguous" id="S4.E8.m1.3.3.1.1.5.4.1.cmml" xref="S4.E8.m1.3.3.1.1.5.4">superscript</csymbol><ci id="S4.E8.m1.3.3.1.1.5.4.2.cmml" xref="S4.E8.m1.3.3.1.1.5.4.2">𝑊</ci><ci id="S4.E8.m1.3.3.1.1.5.4.3.cmml" xref="S4.E8.m1.3.3.1.1.5.4.3">𝑂</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E8.m1.3c">\text{MSA}(h_{q},h_{k},h_{v})=\operatorname{Concat}\left(\mathrm{h}_{1},\ldots,\mathrm{h}_{\mathrm{z}}\right)W^{O},</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S4.SS2.SSS3.p1.9" class="ltx_p">where <math id="S4.SS2.SSS3.p1.2.m1.4" class="ltx_Math" alttext="h_{i}=\operatorname{Attention}({h}_{Q}W_{i}^{Q},{h}_{K}W_{i}^{K},{h}_{V}W_{i}^{V})" display="inline"><semantics id="S4.SS2.SSS3.p1.2.m1.4a"><mrow id="S4.SS2.SSS3.p1.2.m1.4.4" xref="S4.SS2.SSS3.p1.2.m1.4.4.cmml"><msub id="S4.SS2.SSS3.p1.2.m1.4.4.5" xref="S4.SS2.SSS3.p1.2.m1.4.4.5.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.4.4.5.2" xref="S4.SS2.SSS3.p1.2.m1.4.4.5.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.2.m1.4.4.5.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.5.3.cmml">i</mi></msub><mo id="S4.SS2.SSS3.p1.2.m1.4.4.4" xref="S4.SS2.SSS3.p1.2.m1.4.4.4.cmml">=</mo><mrow id="S4.SS2.SSS3.p1.2.m1.4.4.3.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.1.1" xref="S4.SS2.SSS3.p1.2.m1.1.1.cmml">Attention</mi><mo id="S4.SS2.SSS3.p1.2.m1.4.4.3.3a" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml">⁡</mo><mrow id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml"><mo stretchy="false" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.4" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml">(</mo><mrow id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.cmml"><msub id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.2" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.3" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.3.cmml">Q</mi></msub><mo lspace="0em" rspace="0em" id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.1" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.1.cmml">​</mo><msubsup id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.2" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.2.cmml">W</mi><mi id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.3" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.3.cmml">i</mi><mi id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.3" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.3.cmml">Q</mi></msubsup></mrow><mo id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.5" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml">,</mo><mrow id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.cmml"><msub id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.2" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.3" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.3.cmml">K</mi></msub><mo lspace="0em" rspace="0em" id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.1" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.1.cmml">​</mo><msubsup id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.2" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.2.cmml">W</mi><mi id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.3" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.3.cmml">i</mi><mi id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.3" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.3.cmml">K</mi></msubsup></mrow><mo id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.6" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml">,</mo><mrow id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.cmml"><msub id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.2" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.3.cmml">V</mi></msub><mo lspace="0em" rspace="0em" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.1" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.1.cmml">​</mo><msubsup id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.cmml"><mi id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.2" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.2.cmml">W</mi><mi id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.3.cmml">i</mi><mi id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.3" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.3.cmml">V</mi></msubsup></mrow><mo stretchy="false" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.7" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.2.m1.4b"><apply id="S4.SS2.SSS3.p1.2.m1.4.4.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4"><eq id="S4.SS2.SSS3.p1.2.m1.4.4.4.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.4"></eq><apply id="S4.SS2.SSS3.p1.2.m1.4.4.5.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.5"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.4.4.5.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.5">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.4.4.5.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.5.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.2.m1.4.4.5.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.5.3">𝑖</ci></apply><apply id="S4.SS2.SSS3.p1.2.m1.4.4.3.4.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3"><ci id="S4.SS2.SSS3.p1.2.m1.1.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.1.1">Attention</ci><apply id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1"><times id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.1"></times><apply id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.2.3">𝑄</ci></apply><apply id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3">superscript</csymbol><apply id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.2">𝑊</ci><ci id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.2.3">𝑖</ci></apply><ci id="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.2.2.1.1.1.1.3.3">𝑄</ci></apply></apply><apply id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2"><times id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.1"></times><apply id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.2.3">𝐾</ci></apply><apply id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3">superscript</csymbol><apply id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.2">𝑊</ci><ci id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.2.3">𝑖</ci></apply><ci id="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.3.3.2.2.2.2.3.3">𝐾</ci></apply></apply><apply id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3"><times id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.1"></times><apply id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.2.3">𝑉</ci></apply><apply id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3">superscript</csymbol><apply id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.1.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3">subscript</csymbol><ci id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.2.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.2">𝑊</ci><ci id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.2.3">𝑖</ci></apply><ci id="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.3.cmml" xref="S4.SS2.SSS3.p1.2.m1.4.4.3.3.3.3.3.3">𝑉</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.2.m1.4c">h_{i}=\operatorname{Attention}({h}_{Q}W_{i}^{Q},{h}_{K}W_{i}^{K},{h}_{V}W_{i}^{V})</annotation></semantics></math>. <math id="S4.SS2.SSS3.p1.3.m2.1" class="ltx_Math" alttext="W" display="inline"><semantics id="S4.SS2.SSS3.p1.3.m2.1a"><mi id="S4.SS2.SSS3.p1.3.m2.1.1" xref="S4.SS2.SSS3.p1.3.m2.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.3.m2.1b"><ci id="S4.SS2.SSS3.p1.3.m2.1.1.cmml" xref="S4.SS2.SSS3.p1.3.m2.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.3.m2.1c">W</annotation></semantics></math> is the project matrix and <math id="S4.SS2.SSS3.p1.4.m3.1" class="ltx_Math" alttext="z" display="inline"><semantics id="S4.SS2.SSS3.p1.4.m3.1a"><mi id="S4.SS2.SSS3.p1.4.m3.1.1" xref="S4.SS2.SSS3.p1.4.m3.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.4.m3.1b"><ci id="S4.SS2.SSS3.p1.4.m3.1.1.cmml" xref="S4.SS2.SSS3.p1.4.m3.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.4.m3.1c">z</annotation></semantics></math> is the number of MSA layers. We use the <span id="S4.SS2.SSS3.p1.9.1" class="ltx_text ltx_font_bold">Prefix Tuning (Pre-T)</span> to tune local prompts. Pre-T splits the local prompt <math id="S4.SS2.SSS3.p1.5.m4.1" class="ltx_Math" alttext="P_{l}" display="inline"><semantics id="S4.SS2.SSS3.p1.5.m4.1a"><msub id="S4.SS2.SSS3.p1.5.m4.1.1" xref="S4.SS2.SSS3.p1.5.m4.1.1.cmml"><mi id="S4.SS2.SSS3.p1.5.m4.1.1.2" xref="S4.SS2.SSS3.p1.5.m4.1.1.2.cmml">P</mi><mi id="S4.SS2.SSS3.p1.5.m4.1.1.3" xref="S4.SS2.SSS3.p1.5.m4.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.5.m4.1b"><apply id="S4.SS2.SSS3.p1.5.m4.1.1.cmml" xref="S4.SS2.SSS3.p1.5.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.5.m4.1.1.1.cmml" xref="S4.SS2.SSS3.p1.5.m4.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.5.m4.1.1.2.cmml" xref="S4.SS2.SSS3.p1.5.m4.1.1.2">𝑃</ci><ci id="S4.SS2.SSS3.p1.5.m4.1.1.3.cmml" xref="S4.SS2.SSS3.p1.5.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.5.m4.1c">P_{l}</annotation></semantics></math> into <math id="S4.SS2.SSS3.p1.6.m5.1" class="ltx_Math" alttext="p_{K}" display="inline"><semantics id="S4.SS2.SSS3.p1.6.m5.1a"><msub id="S4.SS2.SSS3.p1.6.m5.1.1" xref="S4.SS2.SSS3.p1.6.m5.1.1.cmml"><mi id="S4.SS2.SSS3.p1.6.m5.1.1.2" xref="S4.SS2.SSS3.p1.6.m5.1.1.2.cmml">p</mi><mi id="S4.SS2.SSS3.p1.6.m5.1.1.3" xref="S4.SS2.SSS3.p1.6.m5.1.1.3.cmml">K</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.6.m5.1b"><apply id="S4.SS2.SSS3.p1.6.m5.1.1.cmml" xref="S4.SS2.SSS3.p1.6.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.6.m5.1.1.1.cmml" xref="S4.SS2.SSS3.p1.6.m5.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.6.m5.1.1.2.cmml" xref="S4.SS2.SSS3.p1.6.m5.1.1.2">𝑝</ci><ci id="S4.SS2.SSS3.p1.6.m5.1.1.3.cmml" xref="S4.SS2.SSS3.p1.6.m5.1.1.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.6.m5.1c">p_{K}</annotation></semantics></math> and <math id="S4.SS2.SSS3.p1.7.m6.1" class="ltx_Math" alttext="p_{V}" display="inline"><semantics id="S4.SS2.SSS3.p1.7.m6.1a"><msub id="S4.SS2.SSS3.p1.7.m6.1.1" xref="S4.SS2.SSS3.p1.7.m6.1.1.cmml"><mi id="S4.SS2.SSS3.p1.7.m6.1.1.2" xref="S4.SS2.SSS3.p1.7.m6.1.1.2.cmml">p</mi><mi id="S4.SS2.SSS3.p1.7.m6.1.1.3" xref="S4.SS2.SSS3.p1.7.m6.1.1.3.cmml">V</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.7.m6.1b"><apply id="S4.SS2.SSS3.p1.7.m6.1.1.cmml" xref="S4.SS2.SSS3.p1.7.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.7.m6.1.1.1.cmml" xref="S4.SS2.SSS3.p1.7.m6.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.7.m6.1.1.2.cmml" xref="S4.SS2.SSS3.p1.7.m6.1.1.2">𝑝</ci><ci id="S4.SS2.SSS3.p1.7.m6.1.1.3.cmml" xref="S4.SS2.SSS3.p1.7.m6.1.1.3">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.7.m6.1c">p_{V}</annotation></semantics></math>, and adds them to <math id="S4.SS2.SSS3.p1.8.m7.1" class="ltx_Math" alttext="h_{K}" display="inline"><semantics id="S4.SS2.SSS3.p1.8.m7.1a"><msub id="S4.SS2.SSS3.p1.8.m7.1.1" xref="S4.SS2.SSS3.p1.8.m7.1.1.cmml"><mi id="S4.SS2.SSS3.p1.8.m7.1.1.2" xref="S4.SS2.SSS3.p1.8.m7.1.1.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.8.m7.1.1.3" xref="S4.SS2.SSS3.p1.8.m7.1.1.3.cmml">K</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.8.m7.1b"><apply id="S4.SS2.SSS3.p1.8.m7.1.1.cmml" xref="S4.SS2.SSS3.p1.8.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.8.m7.1.1.1.cmml" xref="S4.SS2.SSS3.p1.8.m7.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.8.m7.1.1.2.cmml" xref="S4.SS2.SSS3.p1.8.m7.1.1.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.8.m7.1.1.3.cmml" xref="S4.SS2.SSS3.p1.8.m7.1.1.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.8.m7.1c">h_{K}</annotation></semantics></math> and<math id="S4.SS2.SSS3.p1.9.m8.1" class="ltx_Math" alttext="h_{V}" display="inline"><semantics id="S4.SS2.SSS3.p1.9.m8.1a"><msub id="S4.SS2.SSS3.p1.9.m8.1.1" xref="S4.SS2.SSS3.p1.9.m8.1.1.cmml"><mi id="S4.SS2.SSS3.p1.9.m8.1.1.2" xref="S4.SS2.SSS3.p1.9.m8.1.1.2.cmml">h</mi><mi id="S4.SS2.SSS3.p1.9.m8.1.1.3" xref="S4.SS2.SSS3.p1.9.m8.1.1.3.cmml">V</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p1.9.m8.1b"><apply id="S4.SS2.SSS3.p1.9.m8.1.1.cmml" xref="S4.SS2.SSS3.p1.9.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p1.9.m8.1.1.1.cmml" xref="S4.SS2.SSS3.p1.9.m8.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p1.9.m8.1.1.2.cmml" xref="S4.SS2.SSS3.p1.9.m8.1.1.2">ℎ</ci><ci id="S4.SS2.SSS3.p1.9.m8.1.1.3.cmml" xref="S4.SS2.SSS3.p1.9.m8.1.1.3">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p1.9.m8.1c">h_{V}</annotation></semantics></math>:</p>
<table id="S4.E9" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(9)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E9.m1.2" class="ltx_Math" alttext="\operatorname{MSA}^{\prime}=\operatorname{MSA}(h_{Q},\left[p_{V};h_{K}\right],\left[p_{V};h_{V}\right])." display="block"><semantics id="S4.E9.m1.2a"><mrow id="S4.E9.m1.2.2.1" xref="S4.E9.m1.2.2.1.1.cmml"><mrow id="S4.E9.m1.2.2.1.1" xref="S4.E9.m1.2.2.1.1.cmml"><msup id="S4.E9.m1.2.2.1.1.5" xref="S4.E9.m1.2.2.1.1.5.cmml"><mi id="S4.E9.m1.2.2.1.1.5.2" xref="S4.E9.m1.2.2.1.1.5.2.cmml">MSA</mi><mo id="S4.E9.m1.2.2.1.1.5.3" xref="S4.E9.m1.2.2.1.1.5.3.cmml">′</mo></msup><mo id="S4.E9.m1.2.2.1.1.4" xref="S4.E9.m1.2.2.1.1.4.cmml">=</mo><mrow id="S4.E9.m1.2.2.1.1.3.3" xref="S4.E9.m1.2.2.1.1.3.4.cmml"><mi id="S4.E9.m1.1.1" xref="S4.E9.m1.1.1.cmml">MSA</mi><mo id="S4.E9.m1.2.2.1.1.3.3a" xref="S4.E9.m1.2.2.1.1.3.4.cmml">⁡</mo><mrow id="S4.E9.m1.2.2.1.1.3.3.3" xref="S4.E9.m1.2.2.1.1.3.4.cmml"><mo stretchy="false" id="S4.E9.m1.2.2.1.1.3.3.3.4" xref="S4.E9.m1.2.2.1.1.3.4.cmml">(</mo><msub id="S4.E9.m1.2.2.1.1.1.1.1.1" xref="S4.E9.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S4.E9.m1.2.2.1.1.1.1.1.1.2" xref="S4.E9.m1.2.2.1.1.1.1.1.1.2.cmml">h</mi><mi id="S4.E9.m1.2.2.1.1.1.1.1.1.3" xref="S4.E9.m1.2.2.1.1.1.1.1.1.3.cmml">Q</mi></msub><mo id="S4.E9.m1.2.2.1.1.3.3.3.5" xref="S4.E9.m1.2.2.1.1.3.4.cmml">,</mo><mrow id="S4.E9.m1.2.2.1.1.2.2.2.2.2" xref="S4.E9.m1.2.2.1.1.2.2.2.2.3.cmml"><mo id="S4.E9.m1.2.2.1.1.2.2.2.2.2.3" xref="S4.E9.m1.2.2.1.1.2.2.2.2.3.cmml">[</mo><msub id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.cmml"><mi id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.2" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.2.cmml">p</mi><mi id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.3" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.3.cmml">V</mi></msub><mo id="S4.E9.m1.2.2.1.1.2.2.2.2.2.4" xref="S4.E9.m1.2.2.1.1.2.2.2.2.3.cmml">;</mo><msub id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.cmml"><mi id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.2" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.2.cmml">h</mi><mi id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.3" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.3.cmml">K</mi></msub><mo id="S4.E9.m1.2.2.1.1.2.2.2.2.2.5" xref="S4.E9.m1.2.2.1.1.2.2.2.2.3.cmml">]</mo></mrow><mo id="S4.E9.m1.2.2.1.1.3.3.3.6" xref="S4.E9.m1.2.2.1.1.3.4.cmml">,</mo><mrow id="S4.E9.m1.2.2.1.1.3.3.3.3.2" xref="S4.E9.m1.2.2.1.1.3.3.3.3.3.cmml"><mo id="S4.E9.m1.2.2.1.1.3.3.3.3.2.3" xref="S4.E9.m1.2.2.1.1.3.3.3.3.3.cmml">[</mo><msub id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.cmml"><mi id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.2" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.2.cmml">p</mi><mi id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.3" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.3.cmml">V</mi></msub><mo id="S4.E9.m1.2.2.1.1.3.3.3.3.2.4" xref="S4.E9.m1.2.2.1.1.3.3.3.3.3.cmml">;</mo><msub id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.cmml"><mi id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.2" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.2.cmml">h</mi><mi id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.3" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.3.cmml">V</mi></msub><mo id="S4.E9.m1.2.2.1.1.3.3.3.3.2.5" xref="S4.E9.m1.2.2.1.1.3.3.3.3.3.cmml">]</mo></mrow><mo stretchy="false" id="S4.E9.m1.2.2.1.1.3.3.3.7" xref="S4.E9.m1.2.2.1.1.3.4.cmml">)</mo></mrow></mrow></mrow><mo lspace="0em" id="S4.E9.m1.2.2.1.2" xref="S4.E9.m1.2.2.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E9.m1.2b"><apply id="S4.E9.m1.2.2.1.1.cmml" xref="S4.E9.m1.2.2.1"><eq id="S4.E9.m1.2.2.1.1.4.cmml" xref="S4.E9.m1.2.2.1.1.4"></eq><apply id="S4.E9.m1.2.2.1.1.5.cmml" xref="S4.E9.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.5.1.cmml" xref="S4.E9.m1.2.2.1.1.5">superscript</csymbol><ci id="S4.E9.m1.2.2.1.1.5.2.cmml" xref="S4.E9.m1.2.2.1.1.5.2">MSA</ci><ci id="S4.E9.m1.2.2.1.1.5.3.cmml" xref="S4.E9.m1.2.2.1.1.5.3">′</ci></apply><apply id="S4.E9.m1.2.2.1.1.3.4.cmml" xref="S4.E9.m1.2.2.1.1.3.3"><ci id="S4.E9.m1.1.1.cmml" xref="S4.E9.m1.1.1">MSA</ci><apply id="S4.E9.m1.2.2.1.1.1.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.1.2">ℎ</ci><ci id="S4.E9.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.1.3">𝑄</ci></apply><list id="S4.E9.m1.2.2.1.1.2.2.2.2.3.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2"><apply id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.2.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.2">𝑝</ci><ci id="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.3.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.1.1.3">𝑉</ci></apply><apply id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.1.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.2.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.2">ℎ</ci><ci id="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.3.cmml" xref="S4.E9.m1.2.2.1.1.2.2.2.2.2.2.3">𝐾</ci></apply></list><list id="S4.E9.m1.2.2.1.1.3.3.3.3.3.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2"><apply id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.2.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.2">𝑝</ci><ci id="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.3.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.1.1.3">𝑉</ci></apply><apply id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.1.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.2.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.2">ℎ</ci><ci id="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.3.cmml" xref="S4.E9.m1.2.2.1.1.3.3.3.3.2.2.3">𝑉</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E9.m1.2c">\operatorname{MSA}^{\prime}=\operatorname{MSA}(h_{Q},\left[p_{V};h_{K}\right],\left[p_{V};h_{V}\right]).</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S4.SS2.SSS3.p2" class="ltx_para">
<p id="S4.SS2.SSS3.p2.8" class="ltx_p">Once global prompts have completed training, they freeze along with their corresponding keys. The input <math id="S4.SS2.SSS3.p2.1.m1.1" class="ltx_Math" alttext="x" display="inline"><semantics id="S4.SS2.SSS3.p2.1.m1.1a"><mi id="S4.SS2.SSS3.p2.1.m1.1.1" xref="S4.SS2.SSS3.p2.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.1.m1.1b"><ci id="S4.SS2.SSS3.p2.1.m1.1.1.cmml" xref="S4.SS2.SSS3.p2.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.1.m1.1c">x</annotation></semantics></math> first goes through the global query function to find the corresponding global prompts. Subsequently, the embedding of <math id="S4.SS2.SSS3.p2.2.m2.1" class="ltx_Math" alttext="x" display="inline"><semantics id="S4.SS2.SSS3.p2.2.m2.1a"><mi id="S4.SS2.SSS3.p2.2.m2.1.1" xref="S4.SS2.SSS3.p2.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.2.m2.1b"><ci id="S4.SS2.SSS3.p2.2.m2.1.1.cmml" xref="S4.SS2.SSS3.p2.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.2.m2.1c">x</annotation></semantics></math> is concatenated with the prompts to form <math id="S4.SS2.SSS3.p2.3.m3.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="S4.SS2.SSS3.p2.3.m3.1a"><msup id="S4.SS2.SSS3.p2.3.m3.1.1" xref="S4.SS2.SSS3.p2.3.m3.1.1.cmml"><mi id="S4.SS2.SSS3.p2.3.m3.1.1.2" xref="S4.SS2.SSS3.p2.3.m3.1.1.2.cmml">E</mi><mo id="S4.SS2.SSS3.p2.3.m3.1.1.3" xref="S4.SS2.SSS3.p2.3.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.3.m3.1b"><apply id="S4.SS2.SSS3.p2.3.m3.1.1.cmml" xref="S4.SS2.SSS3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.3.m3.1.1.1.cmml" xref="S4.SS2.SSS3.p2.3.m3.1.1">superscript</csymbol><ci id="S4.SS2.SSS3.p2.3.m3.1.1.2.cmml" xref="S4.SS2.SSS3.p2.3.m3.1.1.2">𝐸</ci><ci id="S4.SS2.SSS3.p2.3.m3.1.1.3.cmml" xref="S4.SS2.SSS3.p2.3.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.3.m3.1c">E^{\prime}</annotation></semantics></math>. Then <math id="S4.SS2.SSS3.p2.4.m4.1" class="ltx_Math" alttext="E^{\prime}" display="inline"><semantics id="S4.SS2.SSS3.p2.4.m4.1a"><msup id="S4.SS2.SSS3.p2.4.m4.1.1" xref="S4.SS2.SSS3.p2.4.m4.1.1.cmml"><mi id="S4.SS2.SSS3.p2.4.m4.1.1.2" xref="S4.SS2.SSS3.p2.4.m4.1.1.2.cmml">E</mi><mo id="S4.SS2.SSS3.p2.4.m4.1.1.3" xref="S4.SS2.SSS3.p2.4.m4.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.4.m4.1b"><apply id="S4.SS2.SSS3.p2.4.m4.1.1.cmml" xref="S4.SS2.SSS3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.4.m4.1.1.1.cmml" xref="S4.SS2.SSS3.p2.4.m4.1.1">superscript</csymbol><ci id="S4.SS2.SSS3.p2.4.m4.1.1.2.cmml" xref="S4.SS2.SSS3.p2.4.m4.1.1.2">𝐸</ci><ci id="S4.SS2.SSS3.p2.4.m4.1.1.3.cmml" xref="S4.SS2.SSS3.p2.4.m4.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.4.m4.1c">E^{\prime}</annotation></semantics></math> is processed by the local query function to find the corresponding fine-grained prompts <math id="S4.SS2.SSS3.p2.5.m5.2" class="ltx_Math" alttext="\{K_{l},P_{l}\}" display="inline"><semantics id="S4.SS2.SSS3.p2.5.m5.2a"><mrow id="S4.SS2.SSS3.p2.5.m5.2.2.2" xref="S4.SS2.SSS3.p2.5.m5.2.2.3.cmml"><mo stretchy="false" id="S4.SS2.SSS3.p2.5.m5.2.2.2.3" xref="S4.SS2.SSS3.p2.5.m5.2.2.3.cmml">{</mo><msub id="S4.SS2.SSS3.p2.5.m5.1.1.1.1" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1.cmml"><mi id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.2" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1.2.cmml">K</mi><mi id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.3" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1.3.cmml">l</mi></msub><mo id="S4.SS2.SSS3.p2.5.m5.2.2.2.4" xref="S4.SS2.SSS3.p2.5.m5.2.2.3.cmml">,</mo><msub id="S4.SS2.SSS3.p2.5.m5.2.2.2.2" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2.cmml"><mi id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.2" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2.2.cmml">P</mi><mi id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.3" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2.3.cmml">l</mi></msub><mo stretchy="false" id="S4.SS2.SSS3.p2.5.m5.2.2.2.5" xref="S4.SS2.SSS3.p2.5.m5.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.5.m5.2b"><set id="S4.SS2.SSS3.p2.5.m5.2.2.3.cmml" xref="S4.SS2.SSS3.p2.5.m5.2.2.2"><apply id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.cmml" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.1.cmml" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.2.cmml" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1.2">𝐾</ci><ci id="S4.SS2.SSS3.p2.5.m5.1.1.1.1.3.cmml" xref="S4.SS2.SSS3.p2.5.m5.1.1.1.1.3">𝑙</ci></apply><apply id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.cmml" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.1.cmml" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2">subscript</csymbol><ci id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.2.cmml" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2.2">𝑃</ci><ci id="S4.SS2.SSS3.p2.5.m5.2.2.2.2.3.cmml" xref="S4.SS2.SSS3.p2.5.m5.2.2.2.2.3">𝑙</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.5.m5.2c">\{K_{l},P_{l}\}</annotation></semantics></math>. Thus, ViT modifies its MSA layer based on <math id="S4.SS2.SSS3.p2.6.m6.1" class="ltx_Math" alttext="P_{l}" display="inline"><semantics id="S4.SS2.SSS3.p2.6.m6.1a"><msub id="S4.SS2.SSS3.p2.6.m6.1.1" xref="S4.SS2.SSS3.p2.6.m6.1.1.cmml"><mi id="S4.SS2.SSS3.p2.6.m6.1.1.2" xref="S4.SS2.SSS3.p2.6.m6.1.1.2.cmml">P</mi><mi id="S4.SS2.SSS3.p2.6.m6.1.1.3" xref="S4.SS2.SSS3.p2.6.m6.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.6.m6.1b"><apply id="S4.SS2.SSS3.p2.6.m6.1.1.cmml" xref="S4.SS2.SSS3.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.6.m6.1.1.1.cmml" xref="S4.SS2.SSS3.p2.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.SSS3.p2.6.m6.1.1.2.cmml" xref="S4.SS2.SSS3.p2.6.m6.1.1.2">𝑃</ci><ci id="S4.SS2.SSS3.p2.6.m6.1.1.3.cmml" xref="S4.SS2.SSS3.p2.6.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.6.m6.1c">P_{l}</annotation></semantics></math> and loads the local classification head
<math id="S4.SS2.SSS3.p2.7.m7.1" class="ltx_Math" alttext="H^{i}_{l}" display="inline"><semantics id="S4.SS2.SSS3.p2.7.m7.1a"><msubsup id="S4.SS2.SSS3.p2.7.m7.1.1" xref="S4.SS2.SSS3.p2.7.m7.1.1.cmml"><mi id="S4.SS2.SSS3.p2.7.m7.1.1.2.2" xref="S4.SS2.SSS3.p2.7.m7.1.1.2.2.cmml">H</mi><mi id="S4.SS2.SSS3.p2.7.m7.1.1.3" xref="S4.SS2.SSS3.p2.7.m7.1.1.3.cmml">l</mi><mi id="S4.SS2.SSS3.p2.7.m7.1.1.2.3" xref="S4.SS2.SSS3.p2.7.m7.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.7.m7.1b"><apply id="S4.SS2.SSS3.p2.7.m7.1.1.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.7.m7.1.1.1.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1">subscript</csymbol><apply id="S4.SS2.SSS3.p2.7.m7.1.1.2.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.7.m7.1.1.2.1.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1">superscript</csymbol><ci id="S4.SS2.SSS3.p2.7.m7.1.1.2.2.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1.2.2">𝐻</ci><ci id="S4.SS2.SSS3.p2.7.m7.1.1.2.3.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1.2.3">𝑖</ci></apply><ci id="S4.SS2.SSS3.p2.7.m7.1.1.3.cmml" xref="S4.SS2.SSS3.p2.7.m7.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.7.m7.1c">H^{i}_{l}</annotation></semantics></math>, forming <math id="S4.SS2.SSS3.p2.8.m8.1" class="ltx_Math" alttext="\mathcal{V}^{i}_{l}" display="inline"><semantics id="S4.SS2.SSS3.p2.8.m8.1a"><msubsup id="S4.SS2.SSS3.p2.8.m8.1.1" xref="S4.SS2.SSS3.p2.8.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.SSS3.p2.8.m8.1.1.2.2" xref="S4.SS2.SSS3.p2.8.m8.1.1.2.2.cmml">𝒱</mi><mi id="S4.SS2.SSS3.p2.8.m8.1.1.3" xref="S4.SS2.SSS3.p2.8.m8.1.1.3.cmml">l</mi><mi id="S4.SS2.SSS3.p2.8.m8.1.1.2.3" xref="S4.SS2.SSS3.p2.8.m8.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS3.p2.8.m8.1b"><apply id="S4.SS2.SSS3.p2.8.m8.1.1.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.8.m8.1.1.1.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1">subscript</csymbol><apply id="S4.SS2.SSS3.p2.8.m8.1.1.2.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS3.p2.8.m8.1.1.2.1.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1">superscript</csymbol><ci id="S4.SS2.SSS3.p2.8.m8.1.1.2.2.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1.2.2">𝒱</ci><ci id="S4.SS2.SSS3.p2.8.m8.1.1.2.3.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1.2.3">𝑖</ci></apply><ci id="S4.SS2.SSS3.p2.8.m8.1.1.3.cmml" xref="S4.SS2.SSS3.p2.8.m8.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS3.p2.8.m8.1c">\mathcal{V}^{i}_{l}</annotation></semantics></math>. The local prompt training loss function is</p>
<table id="S4.E10" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(10)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E10.m1.6" class="ltx_Math" alttext="\underset{H^{i}_{l},\mathcal{P}_{l},\mathcal{K}_{l}}{\operatorname{min}}\mathcal{L}(\mathcal{V}^{i}_{l}(E^{\prime}),y)+\lambda_{2}\sum_{\mathcal{K}^{s}_{l}}\operatorname{dis}(K_{l}^{in},K_{l}^{s_{i}})." display="block"><semantics id="S4.E10.m1.6a"><mrow id="S4.E10.m1.6.6.1" xref="S4.E10.m1.6.6.1.1.cmml"><mrow id="S4.E10.m1.6.6.1.1" xref="S4.E10.m1.6.6.1.1.cmml"><mrow id="S4.E10.m1.6.6.1.1.1" xref="S4.E10.m1.6.6.1.1.1.cmml"><munder accentunder="true" id="S4.E10.m1.3.3" xref="S4.E10.m1.3.3.cmml"><mi id="S4.E10.m1.3.3.4" xref="S4.E10.m1.3.3.4.cmml">min</mi><mrow id="S4.E10.m1.3.3.3.3" xref="S4.E10.m1.3.3.3.4.cmml"><msubsup id="S4.E10.m1.1.1.1.1.1" xref="S4.E10.m1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.1.1.1.1.1.2.2" xref="S4.E10.m1.1.1.1.1.1.2.2.cmml">H</mi><mi id="S4.E10.m1.1.1.1.1.1.3" xref="S4.E10.m1.1.1.1.1.1.3.cmml">l</mi><mi id="S4.E10.m1.1.1.1.1.1.2.3" xref="S4.E10.m1.1.1.1.1.1.2.3.cmml">i</mi></msubsup><mo id="S4.E10.m1.3.3.3.3.4" xref="S4.E10.m1.3.3.3.4.cmml">,</mo><msub id="S4.E10.m1.2.2.2.2.2" xref="S4.E10.m1.2.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.2.2.2.2.2.2" xref="S4.E10.m1.2.2.2.2.2.2.cmml">𝒫</mi><mi id="S4.E10.m1.2.2.2.2.2.3" xref="S4.E10.m1.2.2.2.2.2.3.cmml">l</mi></msub><mo id="S4.E10.m1.3.3.3.3.5" xref="S4.E10.m1.3.3.3.4.cmml">,</mo><msub id="S4.E10.m1.3.3.3.3.3" xref="S4.E10.m1.3.3.3.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.3.3.3.3.3.2" xref="S4.E10.m1.3.3.3.3.3.2.cmml">𝒦</mi><mi id="S4.E10.m1.3.3.3.3.3.3" xref="S4.E10.m1.3.3.3.3.3.3.cmml">l</mi></msub></mrow></munder><mo lspace="0.167em" rspace="0em" id="S4.E10.m1.6.6.1.1.1.2" xref="S4.E10.m1.6.6.1.1.1.2.cmml">​</mo><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.6.6.1.1.1.3" xref="S4.E10.m1.6.6.1.1.1.3.cmml">ℒ</mi><mo lspace="0em" rspace="0em" id="S4.E10.m1.6.6.1.1.1.2a" xref="S4.E10.m1.6.6.1.1.1.2.cmml">​</mo><mrow id="S4.E10.m1.6.6.1.1.1.1.1" xref="S4.E10.m1.6.6.1.1.1.1.2.cmml"><mo stretchy="false" id="S4.E10.m1.6.6.1.1.1.1.1.2" xref="S4.E10.m1.6.6.1.1.1.1.2.cmml">(</mo><mrow id="S4.E10.m1.6.6.1.1.1.1.1.1" xref="S4.E10.m1.6.6.1.1.1.1.1.1.cmml"><msubsup id="S4.E10.m1.6.6.1.1.1.1.1.1.3" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.2" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.2.cmml">𝒱</mi><mi id="S4.E10.m1.6.6.1.1.1.1.1.1.3.3" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.3.cmml">l</mi><mi id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.3" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.3.cmml">i</mi></msubsup><mo lspace="0em" rspace="0em" id="S4.E10.m1.6.6.1.1.1.1.1.1.2" xref="S4.E10.m1.6.6.1.1.1.1.1.1.2.cmml">​</mo><mrow id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.2" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.cmml">(</mo><msup id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.2" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.2.cmml">E</mi><mo id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml">′</mo></msup><mo stretchy="false" id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.6.6.1.1.1.1.1.3" xref="S4.E10.m1.6.6.1.1.1.1.2.cmml">,</mo><mi id="S4.E10.m1.4.4" xref="S4.E10.m1.4.4.cmml">y</mi><mo stretchy="false" id="S4.E10.m1.6.6.1.1.1.1.1.4" xref="S4.E10.m1.6.6.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.6.6.1.1.4" xref="S4.E10.m1.6.6.1.1.4.cmml">+</mo><mrow id="S4.E10.m1.6.6.1.1.3" xref="S4.E10.m1.6.6.1.1.3.cmml"><msub id="S4.E10.m1.6.6.1.1.3.4" xref="S4.E10.m1.6.6.1.1.3.4.cmml"><mi id="S4.E10.m1.6.6.1.1.3.4.2" xref="S4.E10.m1.6.6.1.1.3.4.2.cmml">λ</mi><mn id="S4.E10.m1.6.6.1.1.3.4.3" xref="S4.E10.m1.6.6.1.1.3.4.3.cmml">2</mn></msub><mo lspace="0em" rspace="0em" id="S4.E10.m1.6.6.1.1.3.3" xref="S4.E10.m1.6.6.1.1.3.3.cmml">​</mo><mrow id="S4.E10.m1.6.6.1.1.3.2" xref="S4.E10.m1.6.6.1.1.3.2.cmml"><munder id="S4.E10.m1.6.6.1.1.3.2.3" xref="S4.E10.m1.6.6.1.1.3.2.3.cmml"><mo movablelimits="false" id="S4.E10.m1.6.6.1.1.3.2.3.2" xref="S4.E10.m1.6.6.1.1.3.2.3.2.cmml">∑</mo><msubsup id="S4.E10.m1.6.6.1.1.3.2.3.3" xref="S4.E10.m1.6.6.1.1.3.2.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E10.m1.6.6.1.1.3.2.3.3.2.2" xref="S4.E10.m1.6.6.1.1.3.2.3.3.2.2.cmml">𝒦</mi><mi id="S4.E10.m1.6.6.1.1.3.2.3.3.3" xref="S4.E10.m1.6.6.1.1.3.2.3.3.3.cmml">l</mi><mi id="S4.E10.m1.6.6.1.1.3.2.3.3.2.3" xref="S4.E10.m1.6.6.1.1.3.2.3.3.2.3.cmml">s</mi></msubsup></munder><mrow id="S4.E10.m1.6.6.1.1.3.2.2.2" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml"><mi id="S4.E10.m1.5.5" xref="S4.E10.m1.5.5.cmml">dis</mi><mo id="S4.E10.m1.6.6.1.1.3.2.2.2a" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml">⁡</mo><mrow id="S4.E10.m1.6.6.1.1.3.2.2.2.2" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml"><mo stretchy="false" id="S4.E10.m1.6.6.1.1.3.2.2.2.2.3" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml">(</mo><msubsup id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.cmml"><mi id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.2" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.2.cmml">K</mi><mi id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.3" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.3.cmml">l</mi><mrow id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.cmml"><mi id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.2" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.1" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.1.cmml">​</mo><mi id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.3" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.3.cmml">n</mi></mrow></msubsup><mo id="S4.E10.m1.6.6.1.1.3.2.2.2.2.4" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml">,</mo><msubsup id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.cmml"><mi id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.2" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.2.cmml">K</mi><mi id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.3" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.3.cmml">l</mi><msub id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.cmml"><mi id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.2" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.2.cmml">s</mi><mi id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.3" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.3.cmml">i</mi></msub></msubsup><mo stretchy="false" id="S4.E10.m1.6.6.1.1.3.2.2.2.2.5" xref="S4.E10.m1.6.6.1.1.3.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo lspace="0em" id="S4.E10.m1.6.6.1.2" xref="S4.E10.m1.6.6.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E10.m1.6b"><apply id="S4.E10.m1.6.6.1.1.cmml" xref="S4.E10.m1.6.6.1"><plus id="S4.E10.m1.6.6.1.1.4.cmml" xref="S4.E10.m1.6.6.1.1.4"></plus><apply id="S4.E10.m1.6.6.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.1"><times id="S4.E10.m1.6.6.1.1.1.2.cmml" xref="S4.E10.m1.6.6.1.1.1.2"></times><apply id="S4.E10.m1.3.3.cmml" xref="S4.E10.m1.3.3"><list id="S4.E10.m1.3.3.3.4.cmml" xref="S4.E10.m1.3.3.3.3"><apply id="S4.E10.m1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1">subscript</csymbol><apply id="S4.E10.m1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.2.1.cmml" xref="S4.E10.m1.1.1.1.1.1">superscript</csymbol><ci id="S4.E10.m1.1.1.1.1.1.2.2.cmml" xref="S4.E10.m1.1.1.1.1.1.2.2">𝐻</ci><ci id="S4.E10.m1.1.1.1.1.1.2.3.cmml" xref="S4.E10.m1.1.1.1.1.1.2.3">𝑖</ci></apply><ci id="S4.E10.m1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.1.1.1.1.1.3">𝑙</ci></apply><apply id="S4.E10.m1.2.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.2.2.1.cmml" xref="S4.E10.m1.2.2.2.2.2">subscript</csymbol><ci id="S4.E10.m1.2.2.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.2.2.2">𝒫</ci><ci id="S4.E10.m1.2.2.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.2.2.3">𝑙</ci></apply><apply id="S4.E10.m1.3.3.3.3.3.cmml" xref="S4.E10.m1.3.3.3.3.3"><csymbol cd="ambiguous" id="S4.E10.m1.3.3.3.3.3.1.cmml" xref="S4.E10.m1.3.3.3.3.3">subscript</csymbol><ci id="S4.E10.m1.3.3.3.3.3.2.cmml" xref="S4.E10.m1.3.3.3.3.3.2">𝒦</ci><ci id="S4.E10.m1.3.3.3.3.3.3.cmml" xref="S4.E10.m1.3.3.3.3.3.3">𝑙</ci></apply></list><ci id="S4.E10.m1.3.3.4.cmml" xref="S4.E10.m1.3.3.4">min</ci></apply><ci id="S4.E10.m1.6.6.1.1.1.3.cmml" xref="S4.E10.m1.6.6.1.1.1.3">ℒ</ci><interval closure="open" id="S4.E10.m1.6.6.1.1.1.1.2.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1"><apply id="S4.E10.m1.6.6.1.1.1.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1"><times id="S4.E10.m1.6.6.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.2"></times><apply id="S4.E10.m1.6.6.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.1.1.1.1.3.1.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3">subscript</csymbol><apply id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.1.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3">superscript</csymbol><ci id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.2.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.2">𝒱</ci><ci id="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.3.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.2.3">𝑖</ci></apply><ci id="S4.E10.m1.6.6.1.1.1.1.1.1.3.3.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.3.3">𝑙</ci></apply><apply id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.2">𝐸</ci><ci id="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.6.6.1.1.1.1.1.1.1.1.1.3">′</ci></apply></apply><ci id="S4.E10.m1.4.4.cmml" xref="S4.E10.m1.4.4">𝑦</ci></interval></apply><apply id="S4.E10.m1.6.6.1.1.3.cmml" xref="S4.E10.m1.6.6.1.1.3"><times id="S4.E10.m1.6.6.1.1.3.3.cmml" xref="S4.E10.m1.6.6.1.1.3.3"></times><apply id="S4.E10.m1.6.6.1.1.3.4.cmml" xref="S4.E10.m1.6.6.1.1.3.4"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.4.1.cmml" xref="S4.E10.m1.6.6.1.1.3.4">subscript</csymbol><ci id="S4.E10.m1.6.6.1.1.3.4.2.cmml" xref="S4.E10.m1.6.6.1.1.3.4.2">𝜆</ci><cn type="integer" id="S4.E10.m1.6.6.1.1.3.4.3.cmml" xref="S4.E10.m1.6.6.1.1.3.4.3">2</cn></apply><apply id="S4.E10.m1.6.6.1.1.3.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2"><apply id="S4.E10.m1.6.6.1.1.3.2.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.3.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3">subscript</csymbol><sum id="S4.E10.m1.6.6.1.1.3.2.3.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.2"></sum><apply id="S4.E10.m1.6.6.1.1.3.2.3.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.3.3.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3">subscript</csymbol><apply id="S4.E10.m1.6.6.1.1.3.2.3.3.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.3.3.2.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3">superscript</csymbol><ci id="S4.E10.m1.6.6.1.1.3.2.3.3.2.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3.2.2">𝒦</ci><ci id="S4.E10.m1.6.6.1.1.3.2.3.3.2.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3.2.3">𝑠</ci></apply><ci id="S4.E10.m1.6.6.1.1.3.2.3.3.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.3.3.3">𝑙</ci></apply></apply><apply id="S4.E10.m1.6.6.1.1.3.2.2.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2"><ci id="S4.E10.m1.5.5.cmml" xref="S4.E10.m1.5.5">dis</ci><apply id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.1.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1">superscript</csymbol><apply id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.1.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.2.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.2">𝐾</ci><ci id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.3.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.2.3">𝑙</ci></apply><apply id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3"><times id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.1.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.1"></times><ci id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.2.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.2">𝑖</ci><ci id="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.3.cmml" xref="S4.E10.m1.6.6.1.1.2.1.1.1.1.1.3.3">𝑛</ci></apply></apply><apply id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2">superscript</csymbol><apply id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2">subscript</csymbol><ci id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.2">𝐾</ci><ci id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.2.3">𝑙</ci></apply><apply id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.1.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3">subscript</csymbol><ci id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.2.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.2">𝑠</ci><ci id="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.3.cmml" xref="S4.E10.m1.6.6.1.1.3.2.2.2.2.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E10.m1.6c">\underset{H^{i}_{l},\mathcal{P}_{l},\mathcal{K}_{l}}{\operatorname{min}}\mathcal{L}(\mathcal{V}^{i}_{l}(E^{\prime}),y)+\lambda_{2}\sum_{\mathcal{K}^{s}_{l}}\operatorname{dis}(K_{l}^{in},K_{l}^{s_{i}}).</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
</section>
</section>
<section id="S4.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3. </span>Selective Prompt Fusion</h3>

<div id="S4.SS3.p1" class="ltx_para">
<p id="S4.SS3.p1.1" class="ltx_p">To fuse global prompts precisely, we devise a novel <span id="S4.SS3.p1.1.1" class="ltx_text ltx_font_italic">selective prompt fusion</span> mechanism that aggregates prompts from different prompt pools through knowledge distillation, enhancing their generalization. To our knowledge, it is a novel approach to distill prompts from different clients.</p>
</div>
<div id="S4.SS3.p2" class="ltx_para">
<p id="S4.SS3.p2.11" class="ltx_p">We denote the small proxy dataset owned by the server as <math id="S4.SS3.p2.1.m1.1" class="ltx_Math" alttext="\mathcal{D}_{s}" display="inline"><semantics id="S4.SS3.p2.1.m1.1a"><msub id="S4.SS3.p2.1.m1.1.1" xref="S4.SS3.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.1.m1.1.1.2" xref="S4.SS3.p2.1.m1.1.1.2.cmml">𝒟</mi><mi id="S4.SS3.p2.1.m1.1.1.3" xref="S4.SS3.p2.1.m1.1.1.3.cmml">s</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.1.m1.1b"><apply id="S4.SS3.p2.1.m1.1.1.cmml" xref="S4.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.1.m1.1.1.1.cmml" xref="S4.SS3.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.p2.1.m1.1.1.2.cmml" xref="S4.SS3.p2.1.m1.1.1.2">𝒟</ci><ci id="S4.SS3.p2.1.m1.1.1.3.cmml" xref="S4.SS3.p2.1.m1.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.1.m1.1c">\mathcal{D}_{s}</annotation></semantics></math>. <math id="S4.SS3.p2.2.m2.2" class="ltx_Math" alttext="\{x_{s},y_{s}\}" display="inline"><semantics id="S4.SS3.p2.2.m2.2a"><mrow id="S4.SS3.p2.2.m2.2.2.2" xref="S4.SS3.p2.2.m2.2.2.3.cmml"><mo stretchy="false" id="S4.SS3.p2.2.m2.2.2.2.3" xref="S4.SS3.p2.2.m2.2.2.3.cmml">{</mo><msub id="S4.SS3.p2.2.m2.1.1.1.1" xref="S4.SS3.p2.2.m2.1.1.1.1.cmml"><mi id="S4.SS3.p2.2.m2.1.1.1.1.2" xref="S4.SS3.p2.2.m2.1.1.1.1.2.cmml">x</mi><mi id="S4.SS3.p2.2.m2.1.1.1.1.3" xref="S4.SS3.p2.2.m2.1.1.1.1.3.cmml">s</mi></msub><mo id="S4.SS3.p2.2.m2.2.2.2.4" xref="S4.SS3.p2.2.m2.2.2.3.cmml">,</mo><msub id="S4.SS3.p2.2.m2.2.2.2.2" xref="S4.SS3.p2.2.m2.2.2.2.2.cmml"><mi id="S4.SS3.p2.2.m2.2.2.2.2.2" xref="S4.SS3.p2.2.m2.2.2.2.2.2.cmml">y</mi><mi id="S4.SS3.p2.2.m2.2.2.2.2.3" xref="S4.SS3.p2.2.m2.2.2.2.2.3.cmml">s</mi></msub><mo stretchy="false" id="S4.SS3.p2.2.m2.2.2.2.5" xref="S4.SS3.p2.2.m2.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.2.m2.2b"><set id="S4.SS3.p2.2.m2.2.2.3.cmml" xref="S4.SS3.p2.2.m2.2.2.2"><apply id="S4.SS3.p2.2.m2.1.1.1.1.cmml" xref="S4.SS3.p2.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.2.m2.1.1.1.1.1.cmml" xref="S4.SS3.p2.2.m2.1.1.1.1">subscript</csymbol><ci id="S4.SS3.p2.2.m2.1.1.1.1.2.cmml" xref="S4.SS3.p2.2.m2.1.1.1.1.2">𝑥</ci><ci id="S4.SS3.p2.2.m2.1.1.1.1.3.cmml" xref="S4.SS3.p2.2.m2.1.1.1.1.3">𝑠</ci></apply><apply id="S4.SS3.p2.2.m2.2.2.2.2.cmml" xref="S4.SS3.p2.2.m2.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS3.p2.2.m2.2.2.2.2.1.cmml" xref="S4.SS3.p2.2.m2.2.2.2.2">subscript</csymbol><ci id="S4.SS3.p2.2.m2.2.2.2.2.2.cmml" xref="S4.SS3.p2.2.m2.2.2.2.2.2">𝑦</ci><ci id="S4.SS3.p2.2.m2.2.2.2.2.3.cmml" xref="S4.SS3.p2.2.m2.2.2.2.2.3">𝑠</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.2.m2.2c">\{x_{s},y_{s}\}</annotation></semantics></math> are the samples and corresponding labels from <math id="S4.SS3.p2.3.m3.1" class="ltx_Math" alttext="\mathcal{D}_{s}" display="inline"><semantics id="S4.SS3.p2.3.m3.1a"><msub id="S4.SS3.p2.3.m3.1.1" xref="S4.SS3.p2.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.3.m3.1.1.2" xref="S4.SS3.p2.3.m3.1.1.2.cmml">𝒟</mi><mi id="S4.SS3.p2.3.m3.1.1.3" xref="S4.SS3.p2.3.m3.1.1.3.cmml">s</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.3.m3.1b"><apply id="S4.SS3.p2.3.m3.1.1.cmml" xref="S4.SS3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.3.m3.1.1.1.cmml" xref="S4.SS3.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS3.p2.3.m3.1.1.2.cmml" xref="S4.SS3.p2.3.m3.1.1.2">𝒟</ci><ci id="S4.SS3.p2.3.m3.1.1.3.cmml" xref="S4.SS3.p2.3.m3.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.3.m3.1c">\mathcal{D}_{s}</annotation></semantics></math> for the distillation process. For the convenience of writing and understanding, we will only consider two global prompt pools here, denoted as <math id="S4.SS3.p2.4.m4.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{i}" display="inline"><semantics id="S4.SS3.p2.4.m4.1a"><msubsup id="S4.SS3.p2.4.m4.1.1" xref="S4.SS3.p2.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.4.m4.1.1.2.2" xref="S4.SS3.p2.4.m4.1.1.2.2.cmml">𝒫</mi><mi id="S4.SS3.p2.4.m4.1.1.2.3" xref="S4.SS3.p2.4.m4.1.1.2.3.cmml">g</mi><mi id="S4.SS3.p2.4.m4.1.1.3" xref="S4.SS3.p2.4.m4.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.4.m4.1b"><apply id="S4.SS3.p2.4.m4.1.1.cmml" xref="S4.SS3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.4.m4.1.1.1.cmml" xref="S4.SS3.p2.4.m4.1.1">superscript</csymbol><apply id="S4.SS3.p2.4.m4.1.1.2.cmml" xref="S4.SS3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.4.m4.1.1.2.1.cmml" xref="S4.SS3.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS3.p2.4.m4.1.1.2.2.cmml" xref="S4.SS3.p2.4.m4.1.1.2.2">𝒫</ci><ci id="S4.SS3.p2.4.m4.1.1.2.3.cmml" xref="S4.SS3.p2.4.m4.1.1.2.3">𝑔</ci></apply><ci id="S4.SS3.p2.4.m4.1.1.3.cmml" xref="S4.SS3.p2.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.4.m4.1c">\mathcal{P}_{g}^{i}</annotation></semantics></math> and <math id="S4.SS3.p2.5.m5.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{j}" display="inline"><semantics id="S4.SS3.p2.5.m5.1a"><msubsup id="S4.SS3.p2.5.m5.1.1" xref="S4.SS3.p2.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.5.m5.1.1.2.2" xref="S4.SS3.p2.5.m5.1.1.2.2.cmml">𝒫</mi><mi id="S4.SS3.p2.5.m5.1.1.2.3" xref="S4.SS3.p2.5.m5.1.1.2.3.cmml">g</mi><mi id="S4.SS3.p2.5.m5.1.1.3" xref="S4.SS3.p2.5.m5.1.1.3.cmml">j</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.5.m5.1b"><apply id="S4.SS3.p2.5.m5.1.1.cmml" xref="S4.SS3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.5.m5.1.1.1.cmml" xref="S4.SS3.p2.5.m5.1.1">superscript</csymbol><apply id="S4.SS3.p2.5.m5.1.1.2.cmml" xref="S4.SS3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.5.m5.1.1.2.1.cmml" xref="S4.SS3.p2.5.m5.1.1">subscript</csymbol><ci id="S4.SS3.p2.5.m5.1.1.2.2.cmml" xref="S4.SS3.p2.5.m5.1.1.2.2">𝒫</ci><ci id="S4.SS3.p2.5.m5.1.1.2.3.cmml" xref="S4.SS3.p2.5.m5.1.1.2.3">𝑔</ci></apply><ci id="S4.SS3.p2.5.m5.1.1.3.cmml" xref="S4.SS3.p2.5.m5.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.5.m5.1c">\mathcal{P}_{g}^{j}</annotation></semantics></math>. <math id="S4.SS3.p2.6.m6.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{i}" display="inline"><semantics id="S4.SS3.p2.6.m6.1a"><msubsup id="S4.SS3.p2.6.m6.1.1" xref="S4.SS3.p2.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.6.m6.1.1.2.2" xref="S4.SS3.p2.6.m6.1.1.2.2.cmml">𝒫</mi><mi id="S4.SS3.p2.6.m6.1.1.2.3" xref="S4.SS3.p2.6.m6.1.1.2.3.cmml">g</mi><mi id="S4.SS3.p2.6.m6.1.1.3" xref="S4.SS3.p2.6.m6.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.6.m6.1b"><apply id="S4.SS3.p2.6.m6.1.1.cmml" xref="S4.SS3.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.6.m6.1.1.1.cmml" xref="S4.SS3.p2.6.m6.1.1">superscript</csymbol><apply id="S4.SS3.p2.6.m6.1.1.2.cmml" xref="S4.SS3.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.6.m6.1.1.2.1.cmml" xref="S4.SS3.p2.6.m6.1.1">subscript</csymbol><ci id="S4.SS3.p2.6.m6.1.1.2.2.cmml" xref="S4.SS3.p2.6.m6.1.1.2.2">𝒫</ci><ci id="S4.SS3.p2.6.m6.1.1.2.3.cmml" xref="S4.SS3.p2.6.m6.1.1.2.3">𝑔</ci></apply><ci id="S4.SS3.p2.6.m6.1.1.3.cmml" xref="S4.SS3.p2.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.6.m6.1c">\mathcal{P}_{g}^{i}</annotation></semantics></math> is chosen as the student pool. Initially, the input <math id="S4.SS3.p2.7.m7.1" class="ltx_Math" alttext="x_{p}" display="inline"><semantics id="S4.SS3.p2.7.m7.1a"><msub id="S4.SS3.p2.7.m7.1.1" xref="S4.SS3.p2.7.m7.1.1.cmml"><mi id="S4.SS3.p2.7.m7.1.1.2" xref="S4.SS3.p2.7.m7.1.1.2.cmml">x</mi><mi id="S4.SS3.p2.7.m7.1.1.3" xref="S4.SS3.p2.7.m7.1.1.3.cmml">p</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.7.m7.1b"><apply id="S4.SS3.p2.7.m7.1.1.cmml" xref="S4.SS3.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.7.m7.1.1.1.cmml" xref="S4.SS3.p2.7.m7.1.1">subscript</csymbol><ci id="S4.SS3.p2.7.m7.1.1.2.cmml" xref="S4.SS3.p2.7.m7.1.1.2">𝑥</ci><ci id="S4.SS3.p2.7.m7.1.1.3.cmml" xref="S4.SS3.p2.7.m7.1.1.3">𝑝</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.7.m7.1c">x_{p}</annotation></semantics></math> searches for the corresponding global prompt within <math id="S4.SS3.p2.8.m8.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{i}" display="inline"><semantics id="S4.SS3.p2.8.m8.1a"><msubsup id="S4.SS3.p2.8.m8.1.1" xref="S4.SS3.p2.8.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.8.m8.1.1.2.2" xref="S4.SS3.p2.8.m8.1.1.2.2.cmml">𝒫</mi><mi id="S4.SS3.p2.8.m8.1.1.2.3" xref="S4.SS3.p2.8.m8.1.1.2.3.cmml">g</mi><mi id="S4.SS3.p2.8.m8.1.1.3" xref="S4.SS3.p2.8.m8.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.8.m8.1b"><apply id="S4.SS3.p2.8.m8.1.1.cmml" xref="S4.SS3.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.8.m8.1.1.1.cmml" xref="S4.SS3.p2.8.m8.1.1">superscript</csymbol><apply id="S4.SS3.p2.8.m8.1.1.2.cmml" xref="S4.SS3.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.8.m8.1.1.2.1.cmml" xref="S4.SS3.p2.8.m8.1.1">subscript</csymbol><ci id="S4.SS3.p2.8.m8.1.1.2.2.cmml" xref="S4.SS3.p2.8.m8.1.1.2.2">𝒫</ci><ci id="S4.SS3.p2.8.m8.1.1.2.3.cmml" xref="S4.SS3.p2.8.m8.1.1.2.3">𝑔</ci></apply><ci id="S4.SS3.p2.8.m8.1.1.3.cmml" xref="S4.SS3.p2.8.m8.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.8.m8.1c">\mathcal{P}_{g}^{i}</annotation></semantics></math>, and then concatenates to form an embedding <math id="S4.SS3.p2.9.m9.1" class="ltx_Math" alttext="E^{\prime}_{i}" display="inline"><semantics id="S4.SS3.p2.9.m9.1a"><msubsup id="S4.SS3.p2.9.m9.1.1" xref="S4.SS3.p2.9.m9.1.1.cmml"><mi id="S4.SS3.p2.9.m9.1.1.2.2" xref="S4.SS3.p2.9.m9.1.1.2.2.cmml">E</mi><mi id="S4.SS3.p2.9.m9.1.1.3" xref="S4.SS3.p2.9.m9.1.1.3.cmml">i</mi><mo id="S4.SS3.p2.9.m9.1.1.2.3" xref="S4.SS3.p2.9.m9.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.9.m9.1b"><apply id="S4.SS3.p2.9.m9.1.1.cmml" xref="S4.SS3.p2.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.9.m9.1.1.1.cmml" xref="S4.SS3.p2.9.m9.1.1">subscript</csymbol><apply id="S4.SS3.p2.9.m9.1.1.2.cmml" xref="S4.SS3.p2.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.9.m9.1.1.2.1.cmml" xref="S4.SS3.p2.9.m9.1.1">superscript</csymbol><ci id="S4.SS3.p2.9.m9.1.1.2.2.cmml" xref="S4.SS3.p2.9.m9.1.1.2.2">𝐸</ci><ci id="S4.SS3.p2.9.m9.1.1.2.3.cmml" xref="S4.SS3.p2.9.m9.1.1.2.3">′</ci></apply><ci id="S4.SS3.p2.9.m9.1.1.3.cmml" xref="S4.SS3.p2.9.m9.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.9.m9.1c">E^{\prime}_{i}</annotation></semantics></math> with the prompt. Similarly, <math id="S4.SS3.p2.10.m10.1" class="ltx_Math" alttext="E^{\prime}_{j}" display="inline"><semantics id="S4.SS3.p2.10.m10.1a"><msubsup id="S4.SS3.p2.10.m10.1.1" xref="S4.SS3.p2.10.m10.1.1.cmml"><mi id="S4.SS3.p2.10.m10.1.1.2.2" xref="S4.SS3.p2.10.m10.1.1.2.2.cmml">E</mi><mi id="S4.SS3.p2.10.m10.1.1.3" xref="S4.SS3.p2.10.m10.1.1.3.cmml">j</mi><mo id="S4.SS3.p2.10.m10.1.1.2.3" xref="S4.SS3.p2.10.m10.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.10.m10.1b"><apply id="S4.SS3.p2.10.m10.1.1.cmml" xref="S4.SS3.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.10.m10.1.1.1.cmml" xref="S4.SS3.p2.10.m10.1.1">subscript</csymbol><apply id="S4.SS3.p2.10.m10.1.1.2.cmml" xref="S4.SS3.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.10.m10.1.1.2.1.cmml" xref="S4.SS3.p2.10.m10.1.1">superscript</csymbol><ci id="S4.SS3.p2.10.m10.1.1.2.2.cmml" xref="S4.SS3.p2.10.m10.1.1.2.2">𝐸</ci><ci id="S4.SS3.p2.10.m10.1.1.2.3.cmml" xref="S4.SS3.p2.10.m10.1.1.2.3">′</ci></apply><ci id="S4.SS3.p2.10.m10.1.1.3.cmml" xref="S4.SS3.p2.10.m10.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.10.m10.1c">E^{\prime}_{j}</annotation></semantics></math> represents the embedding of the same input but concatenated with the prompts from <math id="S4.SS3.p2.11.m11.1" class="ltx_Math" alttext="\mathcal{P}_{g}^{j}" display="inline"><semantics id="S4.SS3.p2.11.m11.1a"><msubsup id="S4.SS3.p2.11.m11.1.1" xref="S4.SS3.p2.11.m11.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.11.m11.1.1.2.2" xref="S4.SS3.p2.11.m11.1.1.2.2.cmml">𝒫</mi><mi id="S4.SS3.p2.11.m11.1.1.2.3" xref="S4.SS3.p2.11.m11.1.1.2.3.cmml">g</mi><mi id="S4.SS3.p2.11.m11.1.1.3" xref="S4.SS3.p2.11.m11.1.1.3.cmml">j</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.11.m11.1b"><apply id="S4.SS3.p2.11.m11.1.1.cmml" xref="S4.SS3.p2.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.11.m11.1.1.1.cmml" xref="S4.SS3.p2.11.m11.1.1">superscript</csymbol><apply id="S4.SS3.p2.11.m11.1.1.2.cmml" xref="S4.SS3.p2.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.11.m11.1.1.2.1.cmml" xref="S4.SS3.p2.11.m11.1.1">subscript</csymbol><ci id="S4.SS3.p2.11.m11.1.1.2.2.cmml" xref="S4.SS3.p2.11.m11.1.1.2.2">𝒫</ci><ci id="S4.SS3.p2.11.m11.1.1.2.3.cmml" xref="S4.SS3.p2.11.m11.1.1.2.3">𝑔</ci></apply><ci id="S4.SS3.p2.11.m11.1.1.3.cmml" xref="S4.SS3.p2.11.m11.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.11.m11.1c">\mathcal{P}_{g}^{j}</annotation></semantics></math>. Therefore, the distillation loss can be summarized as:</p>
<table id="S4.E11" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left"><span class="ltx_tag ltx_tag_equation ltx_align_left">(11)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S4.E11.m1.1" class="ltx_Math" alttext="\mathcal{L}_{CE}=\underset{x_{s}\in\mathcal{D_{s}}}{\operatorname{MSE}}(\mathcal{V}(E^{\prime}_{i}),\mathcal{V}(E^{\prime}_{j}))." display="block"><semantics id="S4.E11.m1.1a"><mrow id="S4.E11.m1.1.1.1" xref="S4.E11.m1.1.1.1.1.cmml"><mrow id="S4.E11.m1.1.1.1.1" xref="S4.E11.m1.1.1.1.1.cmml"><msub id="S4.E11.m1.1.1.1.1.4" xref="S4.E11.m1.1.1.1.1.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E11.m1.1.1.1.1.4.2" xref="S4.E11.m1.1.1.1.1.4.2.cmml">ℒ</mi><mrow id="S4.E11.m1.1.1.1.1.4.3" xref="S4.E11.m1.1.1.1.1.4.3.cmml"><mi id="S4.E11.m1.1.1.1.1.4.3.2" xref="S4.E11.m1.1.1.1.1.4.3.2.cmml">C</mi><mo lspace="0em" rspace="0em" id="S4.E11.m1.1.1.1.1.4.3.1" xref="S4.E11.m1.1.1.1.1.4.3.1.cmml">​</mo><mi id="S4.E11.m1.1.1.1.1.4.3.3" xref="S4.E11.m1.1.1.1.1.4.3.3.cmml">E</mi></mrow></msub><mo id="S4.E11.m1.1.1.1.1.3" xref="S4.E11.m1.1.1.1.1.3.cmml">=</mo><mrow id="S4.E11.m1.1.1.1.1.2" xref="S4.E11.m1.1.1.1.1.2.cmml"><munder accentunder="true" id="S4.E11.m1.1.1.1.1.2.4" xref="S4.E11.m1.1.1.1.1.2.4.cmml"><mi id="S4.E11.m1.1.1.1.1.2.4.2" xref="S4.E11.m1.1.1.1.1.2.4.2.cmml">MSE</mi><mrow id="S4.E11.m1.1.1.1.1.2.4.1" xref="S4.E11.m1.1.1.1.1.2.4.1.cmml"><msub id="S4.E11.m1.1.1.1.1.2.4.1.2" xref="S4.E11.m1.1.1.1.1.2.4.1.2.cmml"><mi id="S4.E11.m1.1.1.1.1.2.4.1.2.2" xref="S4.E11.m1.1.1.1.1.2.4.1.2.2.cmml">x</mi><mi id="S4.E11.m1.1.1.1.1.2.4.1.2.3" xref="S4.E11.m1.1.1.1.1.2.4.1.2.3.cmml">s</mi></msub><mo id="S4.E11.m1.1.1.1.1.2.4.1.1" xref="S4.E11.m1.1.1.1.1.2.4.1.1.cmml">∈</mo><msub id="S4.E11.m1.1.1.1.1.2.4.1.3" xref="S4.E11.m1.1.1.1.1.2.4.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E11.m1.1.1.1.1.2.4.1.3.2" xref="S4.E11.m1.1.1.1.1.2.4.1.3.2.cmml">𝒟</mi><mi class="ltx_font_mathcaligraphic" id="S4.E11.m1.1.1.1.1.2.4.1.3.3" xref="S4.E11.m1.1.1.1.1.2.4.1.3.3.cmml">𝓈</mi></msub></mrow></munder><mo lspace="0em" rspace="0em" id="S4.E11.m1.1.1.1.1.2.3" xref="S4.E11.m1.1.1.1.1.2.3.cmml">​</mo><mrow id="S4.E11.m1.1.1.1.1.2.2.2" xref="S4.E11.m1.1.1.1.1.2.2.3.cmml"><mo stretchy="false" id="S4.E11.m1.1.1.1.1.2.2.2.3" xref="S4.E11.m1.1.1.1.1.2.2.3.cmml">(</mo><mrow id="S4.E11.m1.1.1.1.1.1.1.1.1" xref="S4.E11.m1.1.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E11.m1.1.1.1.1.1.1.1.1.3" xref="S4.E11.m1.1.1.1.1.1.1.1.1.3.cmml">𝒱</mi><mo lspace="0em" rspace="0em" id="S4.E11.m1.1.1.1.1.1.1.1.1.2" xref="S4.E11.m1.1.1.1.1.1.1.1.1.2.cmml">​</mo><mrow id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msubsup id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">E</mi><mi id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi><mo id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.3" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml">′</mo></msubsup><mo stretchy="false" id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E11.m1.1.1.1.1.2.2.2.4" xref="S4.E11.m1.1.1.1.1.2.2.3.cmml">,</mo><mrow id="S4.E11.m1.1.1.1.1.2.2.2.2" xref="S4.E11.m1.1.1.1.1.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E11.m1.1.1.1.1.2.2.2.2.3" xref="S4.E11.m1.1.1.1.1.2.2.2.2.3.cmml">𝒱</mi><mo lspace="0em" rspace="0em" id="S4.E11.m1.1.1.1.1.2.2.2.2.2" xref="S4.E11.m1.1.1.1.1.2.2.2.2.2.cmml">​</mo><mrow id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.cmml"><mo stretchy="false" id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.2" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.cmml">(</mo><msubsup id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.cmml"><mi id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.2" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.2.cmml">E</mi><mi id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.3" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.3.cmml">j</mi><mo id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.3" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.3.cmml">′</mo></msubsup><mo stretchy="false" id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.3" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo stretchy="false" id="S4.E11.m1.1.1.1.1.2.2.2.5" xref="S4.E11.m1.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo lspace="0em" id="S4.E11.m1.1.1.1.2" xref="S4.E11.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E11.m1.1b"><apply id="S4.E11.m1.1.1.1.1.cmml" xref="S4.E11.m1.1.1.1"><eq id="S4.E11.m1.1.1.1.1.3.cmml" xref="S4.E11.m1.1.1.1.1.3"></eq><apply id="S4.E11.m1.1.1.1.1.4.cmml" xref="S4.E11.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.4.1.cmml" xref="S4.E11.m1.1.1.1.1.4">subscript</csymbol><ci id="S4.E11.m1.1.1.1.1.4.2.cmml" xref="S4.E11.m1.1.1.1.1.4.2">ℒ</ci><apply id="S4.E11.m1.1.1.1.1.4.3.cmml" xref="S4.E11.m1.1.1.1.1.4.3"><times id="S4.E11.m1.1.1.1.1.4.3.1.cmml" xref="S4.E11.m1.1.1.1.1.4.3.1"></times><ci id="S4.E11.m1.1.1.1.1.4.3.2.cmml" xref="S4.E11.m1.1.1.1.1.4.3.2">𝐶</ci><ci id="S4.E11.m1.1.1.1.1.4.3.3.cmml" xref="S4.E11.m1.1.1.1.1.4.3.3">𝐸</ci></apply></apply><apply id="S4.E11.m1.1.1.1.1.2.cmml" xref="S4.E11.m1.1.1.1.1.2"><times id="S4.E11.m1.1.1.1.1.2.3.cmml" xref="S4.E11.m1.1.1.1.1.2.3"></times><apply id="S4.E11.m1.1.1.1.1.2.4.cmml" xref="S4.E11.m1.1.1.1.1.2.4"><apply id="S4.E11.m1.1.1.1.1.2.4.1.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1"><in id="S4.E11.m1.1.1.1.1.2.4.1.1.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.1"></in><apply id="S4.E11.m1.1.1.1.1.2.4.1.2.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.2"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.2.4.1.2.1.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.2">subscript</csymbol><ci id="S4.E11.m1.1.1.1.1.2.4.1.2.2.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.2.2">𝑥</ci><ci id="S4.E11.m1.1.1.1.1.2.4.1.2.3.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.2.3">𝑠</ci></apply><apply id="S4.E11.m1.1.1.1.1.2.4.1.3.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.3"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.2.4.1.3.1.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.3">subscript</csymbol><ci id="S4.E11.m1.1.1.1.1.2.4.1.3.2.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.3.2">𝒟</ci><ci id="S4.E11.m1.1.1.1.1.2.4.1.3.3.cmml" xref="S4.E11.m1.1.1.1.1.2.4.1.3.3">𝓈</ci></apply></apply><ci id="S4.E11.m1.1.1.1.1.2.4.2.cmml" xref="S4.E11.m1.1.1.1.1.2.4.2">MSE</ci></apply><interval closure="open" id="S4.E11.m1.1.1.1.1.2.2.3.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2"><apply id="S4.E11.m1.1.1.1.1.1.1.1.1.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1"><times id="S4.E11.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.2"></times><ci id="S4.E11.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.3">𝒱</ci><apply id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.2">𝐸</ci><ci id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.2.3">′</ci></apply><ci id="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E11.m1.1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><apply id="S4.E11.m1.1.1.1.1.2.2.2.2.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2"><times id="S4.E11.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.2"></times><ci id="S4.E11.m1.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.3">𝒱</ci><apply id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.1.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1">subscript</csymbol><apply id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.1.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1">superscript</csymbol><ci id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.2.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.2">𝐸</ci><ci id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.3.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.2.3">′</ci></apply><ci id="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.3.cmml" xref="S4.E11.m1.1.1.1.1.2.2.2.2.1.1.1.3">𝑗</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E11.m1.1c">\mathcal{L}_{CE}=\underset{x_{s}\in\mathcal{D_{s}}}{\operatorname{MSE}}(\mathcal{V}(E^{\prime}_{i}),\mathcal{V}(E^{\prime}_{j})).</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
</section>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Experiments</h2>

<section id="S5.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1. </span>Experimental Setup</h3>

<section id="S5.SS1.SSS1" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.1.1. </span>Datasets</h4>

<figure id="S5.T1" class="ltx_table">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span id="S5.T1.2.1.1" class="ltx_text" style="font-size:90%;">Table 1</span>. </span><span id="S5.T1.3.2" class="ltx_text" style="font-size:90%;">Accuracy of the aggregated global model on local test sets CIFAR-100 with 5 class-incremental tasks each client. </span></figcaption>
<table id="S5.T1.4" class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S5.T1.4.1.1" class="ltx_tr">
<th id="S5.T1.4.1.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" rowspan="3"><span id="S5.T1.4.1.1.1.1" class="ltx_text">Algorithm</span></th>
<th id="S5.T1.4.1.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" rowspan="3"><span id="S5.T1.4.1.1.2.1" class="ltx_text">Backbone</span></th>
<th id="S5.T1.4.1.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="6">Asynchronous</th>
<th id="S5.T1.4.1.1.4" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="6">Synchronous</th>
</tr>
<tr id="S5.T1.4.2.2" class="ltx_tr">
<th id="S5.T1.4.2.2.1" class="ltx_td ltx_align_center ltx_th ltx_th_column" colspan="6">Task ID</th>
<th id="S5.T1.4.2.2.2" class="ltx_td ltx_align_center ltx_th ltx_th_column" colspan="6">Task ID</th>
</tr>
<tr id="S5.T1.4.3.3" class="ltx_tr">
<th id="S5.T1.4.3.3.1" class="ltx_td ltx_align_center ltx_th ltx_th_column">1</th>
<th id="S5.T1.4.3.3.2" class="ltx_td ltx_align_center ltx_th ltx_th_column">2</th>
<th id="S5.T1.4.3.3.3" class="ltx_td ltx_align_center ltx_th ltx_th_column">3</th>
<th id="S5.T1.4.3.3.4" class="ltx_td ltx_align_center ltx_th ltx_th_column">4</th>
<th id="S5.T1.4.3.3.5" class="ltx_td ltx_align_center ltx_th ltx_th_column">5</th>
<th id="S5.T1.4.3.3.6" class="ltx_td ltx_align_center ltx_th ltx_th_column">Average</th>
<th id="S5.T1.4.3.3.7" class="ltx_td ltx_align_center ltx_th ltx_th_column">1</th>
<th id="S5.T1.4.3.3.8" class="ltx_td ltx_align_center ltx_th ltx_th_column">2</th>
<th id="S5.T1.4.3.3.9" class="ltx_td ltx_align_center ltx_th ltx_th_column">3</th>
<th id="S5.T1.4.3.3.10" class="ltx_td ltx_align_center ltx_th ltx_th_column">4</th>
<th id="S5.T1.4.3.3.11" class="ltx_td ltx_align_center ltx_th ltx_th_column">5</th>
<th id="S5.T1.4.3.3.12" class="ltx_td ltx_align_center ltx_th ltx_th_column">Average</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S5.T1.4.4.1" class="ltx_tr">
<td id="S5.T1.4.4.1.1" class="ltx_td ltx_align_center ltx_border_t">FedAvg<cite class="ltx_cite ltx_citemacro_citep">(McMahan et al<span class="ltx_text">.</span>, <a href="#bib.bib32" title="" class="ltx_ref">2017</a>)</cite>
</td>
<td id="S5.T1.4.4.1.2" class="ltx_td ltx_align_center ltx_border_t" rowspan="4"><span id="S5.T1.4.4.1.2.1" class="ltx_text">ResNet-18</span></td>
<td id="S5.T1.4.4.1.3" class="ltx_td ltx_align_center ltx_border_t">47.39</td>
<td id="S5.T1.4.4.1.4" class="ltx_td ltx_align_center ltx_border_t">62.63</td>
<td id="S5.T1.4.4.1.5" class="ltx_td ltx_align_center ltx_border_t">67.25</td>
<td id="S5.T1.4.4.1.6" class="ltx_td ltx_align_center ltx_border_t">62.69</td>
<td id="S5.T1.4.4.1.7" class="ltx_td ltx_align_center ltx_border_t">68.72</td>
<td id="S5.T1.4.4.1.8" class="ltx_td ltx_align_center ltx_border_t">61.74</td>
<td id="S5.T1.4.4.1.9" class="ltx_td ltx_align_center ltx_border_t">67.77</td>
<td id="S5.T1.4.4.1.10" class="ltx_td ltx_align_center ltx_border_t">77.72</td>
<td id="S5.T1.4.4.1.11" class="ltx_td ltx_align_center ltx_border_t">76.65</td>
<td id="S5.T1.4.4.1.12" class="ltx_td ltx_align_center ltx_border_t">74.59</td>
<td id="S5.T1.4.4.1.13" class="ltx_td ltx_align_center ltx_border_t">82.00</td>
<td id="S5.T1.4.4.1.14" class="ltx_td ltx_align_center ltx_border_t">75.74</td>
</tr>
<tr id="S5.T1.4.5.2" class="ltx_tr">
<td id="S5.T1.4.5.2.1" class="ltx_td ltx_align_center">FedProx<cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib24" title="" class="ltx_ref">2020</a>)</cite>
</td>
<td id="S5.T1.4.5.2.2" class="ltx_td ltx_align_center">68.26</td>
<td id="S5.T1.4.5.2.3" class="ltx_td ltx_align_center">56.94</td>
<td id="S5.T1.4.5.2.4" class="ltx_td ltx_align_center">65.20</td>
<td id="S5.T1.4.5.2.5" class="ltx_td ltx_align_center">63.82</td>
<td id="S5.T1.4.5.2.6" class="ltx_td ltx_align_center">67.48</td>
<td id="S5.T1.4.5.2.7" class="ltx_td ltx_align_center">64.34</td>
<td id="S5.T1.4.5.2.8" class="ltx_td ltx_align_center">43.07</td>
<td id="S5.T1.4.5.2.9" class="ltx_td ltx_align_center">23.09</td>
<td id="S5.T1.4.5.2.10" class="ltx_td ltx_align_center">51.41</td>
<td id="S5.T1.4.5.2.11" class="ltx_td ltx_align_center">45.01</td>
<td id="S5.T1.4.5.2.12" class="ltx_td ltx_align_center">50.62</td>
<td id="S5.T1.4.5.2.13" class="ltx_td ltx_align_center">42.64</td>
</tr>
<tr id="S5.T1.4.6.3" class="ltx_tr">
<td id="S5.T1.4.6.3.1" class="ltx_td ltx_align_center">FedEWC</td>
<td id="S5.T1.4.6.3.2" class="ltx_td ltx_align_center">27.77</td>
<td id="S5.T1.4.6.3.3" class="ltx_td ltx_align_center">20.66</td>
<td id="S5.T1.4.6.3.4" class="ltx_td ltx_align_center">25.70</td>
<td id="S5.T1.4.6.3.5" class="ltx_td ltx_align_center">24.11</td>
<td id="S5.T1.4.6.3.6" class="ltx_td ltx_align_center">26.41</td>
<td id="S5.T1.4.6.3.7" class="ltx_td ltx_align_center">24.93</td>
<td id="S5.T1.4.6.3.8" class="ltx_td ltx_align_center">49.94</td>
<td id="S5.T1.4.6.3.9" class="ltx_td ltx_align_center">71.00</td>
<td id="S5.T1.4.6.3.10" class="ltx_td ltx_align_center">70.22</td>
<td id="S5.T1.4.6.3.11" class="ltx_td ltx_align_center">70.09</td>
<td id="S5.T1.4.6.3.12" class="ltx_td ltx_align_center">77.89</td>
<td id="S5.T1.4.6.3.13" class="ltx_td ltx_align_center">67.83</td>
</tr>
<tr id="S5.T1.4.7.4" class="ltx_tr">
<td id="S5.T1.4.7.4.1" class="ltx_td ltx_align_center">GLFC<cite class="ltx_cite ltx_citemacro_citep">(Dong et al<span class="ltx_text">.</span>, <a href="#bib.bib8" title="" class="ltx_ref">2022</a>)</cite>
</td>
<td id="S5.T1.4.7.4.2" class="ltx_td ltx_align_center">14.22</td>
<td id="S5.T1.4.7.4.3" class="ltx_td ltx_align_center">18.84</td>
<td id="S5.T1.4.7.4.4" class="ltx_td ltx_align_center">23.93</td>
<td id="S5.T1.4.7.4.5" class="ltx_td ltx_align_center">26.70</td>
<td id="S5.T1.4.7.4.6" class="ltx_td ltx_align_center">22.52</td>
<td id="S5.T1.4.7.4.7" class="ltx_td ltx_align_center">21.24</td>
<td id="S5.T1.4.7.4.8" class="ltx_td ltx_align_center">5.22</td>
<td id="S5.T1.4.7.4.9" class="ltx_td ltx_align_center">8.93</td>
<td id="S5.T1.4.7.4.10" class="ltx_td ltx_align_center">24.61</td>
<td id="S5.T1.4.7.4.11" class="ltx_td ltx_align_center">35.43</td>
<td id="S5.T1.4.7.4.12" class="ltx_td ltx_align_center">42.33</td>
<td id="S5.T1.4.7.4.13" class="ltx_td ltx_align_center">23.30</td>
</tr>
<tr id="S5.T1.4.8.5" class="ltx_tr">
<td id="S5.T1.4.8.5.1" class="ltx_td ltx_align_center ltx_border_t">FedViT</td>
<td id="S5.T1.4.8.5.2" class="ltx_td ltx_align_center ltx_border_t" rowspan="3"><span id="S5.T1.4.8.5.2.1" class="ltx_text">ViT</span></td>
<td id="S5.T1.4.8.5.3" class="ltx_td ltx_align_center ltx_border_t">83.02</td>
<td id="S5.T1.4.8.5.4" class="ltx_td ltx_align_center ltx_border_t">82.39</td>
<td id="S5.T1.4.8.5.5" class="ltx_td ltx_align_center ltx_border_t">83.24</td>
<td id="S5.T1.4.8.5.6" class="ltx_td ltx_align_center ltx_border_t">80.34</td>
<td id="S5.T1.4.8.5.7" class="ltx_td ltx_align_center ltx_border_t">83.32</td>
<td id="S5.T1.4.8.5.8" class="ltx_td ltx_align_center ltx_border_t">82.46</td>
<td id="S5.T1.4.8.5.9" class="ltx_td ltx_align_center ltx_border_t">70.30</td>
<td id="S5.T1.4.8.5.10" class="ltx_td ltx_align_center ltx_border_t">71.05</td>
<td id="S5.T1.4.8.5.11" class="ltx_td ltx_align_center ltx_border_t">69.10</td>
<td id="S5.T1.4.8.5.12" class="ltx_td ltx_align_center ltx_border_t">64.36</td>
<td id="S5.T1.4.8.5.13" class="ltx_td ltx_align_center ltx_border_t">71.01</td>
<td id="S5.T1.4.8.5.14" class="ltx_td ltx_align_center ltx_border_t">69.16</td>
</tr>
<tr id="S5.T1.4.9.6" class="ltx_tr">
<td id="S5.T1.4.9.6.1" class="ltx_td ltx_align_center">FedL2P</td>
<td id="S5.T1.4.9.6.2" class="ltx_td ltx_align_center">89.63</td>
<td id="S5.T1.4.9.6.3" class="ltx_td ltx_align_center">89.68</td>
<td id="S5.T1.4.9.6.4" class="ltx_td ltx_align_center">90.45</td>
<td id="S5.T1.4.9.6.5" class="ltx_td ltx_align_center">90.02</td>
<td id="S5.T1.4.9.6.6" class="ltx_td ltx_align_center">90.75</td>
<td id="S5.T1.4.9.6.7" class="ltx_td ltx_align_center">90.11</td>
<td id="S5.T1.4.9.6.8" class="ltx_td ltx_align_center">80.22</td>
<td id="S5.T1.4.9.6.9" class="ltx_td ltx_align_center">82.81</td>
<td id="S5.T1.4.9.6.10" class="ltx_td ltx_align_center">81.61</td>
<td id="S5.T1.4.9.6.11" class="ltx_td ltx_align_center">80.68</td>
<td id="S5.T1.4.9.6.12" class="ltx_td ltx_align_center">84.14</td>
<td id="S5.T1.4.9.6.13" class="ltx_td ltx_align_center">81.89</td>
</tr>
<tr id="S5.T1.4.10.7" class="ltx_tr">
<td id="S5.T1.4.10.7.1" class="ltx_td ltx_align_center">FedDualP</td>
<td id="S5.T1.4.10.7.2" class="ltx_td ltx_align_center">82.09</td>
<td id="S5.T1.4.10.7.3" class="ltx_td ltx_align_center">81.17</td>
<td id="S5.T1.4.10.7.4" class="ltx_td ltx_align_center">80.05</td>
<td id="S5.T1.4.10.7.5" class="ltx_td ltx_align_center">80.52</td>
<td id="S5.T1.4.10.7.6" class="ltx_td ltx_align_center">81.48</td>
<td id="S5.T1.4.10.7.7" class="ltx_td ltx_align_center">81.06</td>
<td id="S5.T1.4.10.7.8" class="ltx_td ltx_align_center">63.84</td>
<td id="S5.T1.4.10.7.9" class="ltx_td ltx_align_center">65.62</td>
<td id="S5.T1.4.10.7.10" class="ltx_td ltx_align_center">63.16</td>
<td id="S5.T1.4.10.7.11" class="ltx_td ltx_align_center">61.10</td>
<td id="S5.T1.4.10.7.12" class="ltx_td ltx_align_center">63.28</td>
<td id="S5.T1.4.10.7.13" class="ltx_td ltx_align_center">63.40</td>
</tr>
<tr id="S5.T1.4.11.8" class="ltx_tr">
<td id="S5.T1.4.11.8.1" class="ltx_td ltx_align_center ltx_border_t">Ours(FedMGP)</td>
<td id="S5.T1.4.11.8.2" class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" rowspan="3"><span id="S5.T1.4.11.8.2.1" class="ltx_text">ViT</span></td>
<td id="S5.T1.4.11.8.3" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.3.1" class="ltx_text ltx_font_bold">90.26</span></td>
<td id="S5.T1.4.11.8.4" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.4.1" class="ltx_text ltx_font_bold">90.14</span></td>
<td id="S5.T1.4.11.8.5" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.5.1" class="ltx_text ltx_font_bold">91.29</span></td>
<td id="S5.T1.4.11.8.6" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.6.1" class="ltx_text ltx_font_bold">90.30</span></td>
<td id="S5.T1.4.11.8.7" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.7.1" class="ltx_text ltx_font_bold">90.83</span></td>
<td id="S5.T1.4.11.8.8" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.8.1" class="ltx_text ltx_font_bold">90.56</span></td>
<td id="S5.T1.4.11.8.9" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.9.1" class="ltx_text ltx_font_bold">82.23</span></td>
<td id="S5.T1.4.11.8.10" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.10.1" class="ltx_text ltx_font_bold">84.14</span></td>
<td id="S5.T1.4.11.8.11" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.11.1" class="ltx_text ltx_font_bold">82.01</span></td>
<td id="S5.T1.4.11.8.12" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.12.1" class="ltx_text ltx_font_bold">82.47</span></td>
<td id="S5.T1.4.11.8.13" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.13.1" class="ltx_text ltx_font_bold">86.44</span></td>
<td id="S5.T1.4.11.8.14" class="ltx_td ltx_align_center ltx_border_t"><span id="S5.T1.4.11.8.14.1" class="ltx_text ltx_font_bold">83.46</span></td>
</tr>
<tr id="S5.T1.4.12.9" class="ltx_tr">
<td id="S5.T1.4.12.9.1" class="ltx_td ltx_align_center">Ours-w/oLP</td>
<td id="S5.T1.4.12.9.2" class="ltx_td ltx_align_center">88.35</td>
<td id="S5.T1.4.12.9.3" class="ltx_td ltx_align_center">89.19</td>
<td id="S5.T1.4.12.9.4" class="ltx_td ltx_align_center">89.91</td>
<td id="S5.T1.4.12.9.5" class="ltx_td ltx_align_center">89.16</td>
<td id="S5.T1.4.12.9.6" class="ltx_td ltx_align_center">90.20</td>
<td id="S5.T1.4.12.9.7" class="ltx_td ltx_align_center">89.36</td>
<td id="S5.T1.4.12.9.8" class="ltx_td ltx_align_center">79.80</td>
<td id="S5.T1.4.12.9.9" class="ltx_td ltx_align_center">82.04</td>
<td id="S5.T1.4.12.9.10" class="ltx_td ltx_align_center">79.71</td>
<td id="S5.T1.4.12.9.11" class="ltx_td ltx_align_center">80.20</td>
<td id="S5.T1.4.12.9.12" class="ltx_td ltx_align_center">83.56</td>
<td id="S5.T1.4.12.9.13" class="ltx_td ltx_align_center">81.06</td>
</tr>
<tr id="S5.T1.4.13.10" class="ltx_tr">
<td id="S5.T1.4.13.10.1" class="ltx_td ltx_align_center ltx_border_bb">Ours-w/oGP</td>
<td id="S5.T1.4.13.10.2" class="ltx_td ltx_align_center ltx_border_bb">86.93</td>
<td id="S5.T1.4.13.10.3" class="ltx_td ltx_align_center ltx_border_bb">88.52</td>
<td id="S5.T1.4.13.10.4" class="ltx_td ltx_align_center ltx_border_bb">82.85</td>
<td id="S5.T1.4.13.10.5" class="ltx_td ltx_align_center ltx_border_bb">84.11</td>
<td id="S5.T1.4.13.10.6" class="ltx_td ltx_align_center ltx_border_bb">87.29</td>
<td id="S5.T1.4.13.10.7" class="ltx_td ltx_align_center ltx_border_bb">85.94</td>
<td id="S5.T1.4.13.10.8" class="ltx_td ltx_align_center ltx_border_bb">78.73</td>
<td id="S5.T1.4.13.10.9" class="ltx_td ltx_align_center ltx_border_bb">78.92</td>
<td id="S5.T1.4.13.10.10" class="ltx_td ltx_align_center ltx_border_bb">77.74</td>
<td id="S5.T1.4.13.10.11" class="ltx_td ltx_align_center ltx_border_bb">75.16</td>
<td id="S5.T1.4.13.10.12" class="ltx_td ltx_align_center ltx_border_bb">79.10</td>
<td id="S5.T1.4.13.10.13" class="ltx_td ltx_align_center ltx_border_bb">77.93</td>
</tr>
</tbody>
</table>
</figure>
<div id="S5.SS1.SSS1.p1" class="ltx_para">
<p id="S5.SS1.SSS1.p1.1" class="ltx_p">We conduct extensive experiments on CIFAR-100 <cite class="ltx_cite ltx_citemacro_citep">(Krizhevsky et al<span class="ltx_text">.</span>, <a href="#bib.bib20" title="" class="ltx_ref">2009</a>)</cite> with 5 incremental tasks to evaluate the effectiveness of our FedMGP in addressing the challenges of PFCL. CIFAR-100 is a widely used benchmark dataset and consists of 60,000 RGB color images, each of size 32x32 pixels, classified into 100 different classes. We consider two practical scenarios of FCL, namely synchronous FCL and asynchronous FCL.</p>
</div>
<div id="S5.SS1.SSS1.p2" class="ltx_para">
<p id="S5.SS1.SSS1.p2.1" class="ltx_p">In the <span id="S5.SS1.SSS1.p2.1.1" class="ltx_text ltx_font_bold">synchronous FCL</span> settings <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>, clients have the same task sequences but a varied proportion of samples from each class. It is a common setting employed in existing FCL works <cite class="ltx_cite ltx_citemacro_citep">(Dong et al<span class="ltx_text">.</span>, <a href="#bib.bib8" title="" class="ltx_ref">2022</a>)</cite>. The degree of data heterogeneity in this scenario is controlled with the Dirichlet parameter, which is set to be <math id="S5.SS1.SSS1.p2.1.m1.1" class="ltx_Math" alttext="1" display="inline"><semantics id="S5.SS1.SSS1.p2.1.m1.1a"><mn id="S5.SS1.SSS1.p2.1.m1.1.1" xref="S5.SS1.SSS1.p2.1.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS1.p2.1.m1.1b"><cn type="integer" id="S5.SS1.SSS1.p2.1.m1.1.1.cmml" xref="S5.SS1.SSS1.p2.1.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS1.p2.1.m1.1c">1</annotation></semantics></math> in our experiments. Specifically, we first partition the dataset into 5 tasks, each containing 20 classes, with no overlapping class between tasks. Then, within each task, the samples of each class are randomly divided into the same number of subsets as the total number of clients, ensuring that the data among clients is also non-overlapping.</p>
</div>
<div id="S5.SS1.SSS1.p3" class="ltx_para">
<p id="S5.SS1.SSS1.p3.2" class="ltx_p">In the <span id="S5.SS1.SSS1.p3.2.1" class="ltx_text ltx_font_bold">asynchronous FCL</span> settings <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a href="#bib.bib48" title="" class="ltx_ref">2024</a>)</cite>, some of the classes are accessible to all clients while others are private to certain clients, which is derived from pathological Non-IID in static FL <cite class="ltx_cite ltx_citemacro_citep">(McMahan et al<span class="ltx_text">.</span>, <a href="#bib.bib32" title="" class="ltx_ref">2017</a>)</cite>. In this setting, we consider that there are <math id="S5.SS1.SSS1.p3.1.m1.1" class="ltx_Math" alttext="15" display="inline"><semantics id="S5.SS1.SSS1.p3.1.m1.1a"><mn id="S5.SS1.SSS1.p3.1.m1.1.1" xref="S5.SS1.SSS1.p3.1.m1.1.1.cmml">15</mn><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS1.p3.1.m1.1b"><cn type="integer" id="S5.SS1.SSS1.p3.1.m1.1.1.cmml" xref="S5.SS1.SSS1.p3.1.m1.1.1">15</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS1.p3.1.m1.1c">15</annotation></semantics></math> private classes for each client. Each task contains <math id="S5.SS1.SSS1.p3.2.m2.1" class="ltx_Math" alttext="8" display="inline"><semantics id="S5.SS1.SSS1.p3.2.m2.1a"><mn id="S5.SS1.SSS1.p3.2.m2.1.1" xref="S5.SS1.SSS1.p3.2.m2.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS1.p3.2.m2.1b"><cn type="integer" id="S5.SS1.SSS1.p3.2.m2.1.1.cmml" xref="S5.SS1.SSS1.p3.2.m2.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS1.p3.2.m2.1c">8</annotation></semantics></math> classes. To be specific, each client first selects 15 classes unique to itself, and only that client has access to the full data of these classes. Therefore, there are 25 classes lefted as public classes shared by all clients. As a result, each client has data for 40 classes. The client then randomly divides these 40 classes into 5 tasks, each containing 8 classes.</p>
</div>
</section>
<section id="S5.SS1.SSS2" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.1.2. </span>Baselines and Backbones</h4>

<div id="S5.SS1.SSS2.p1" class="ltx_para">
<p id="S5.SS1.SSS2.p1.1" class="ltx_p">We compare FedMGP with FedAvg <cite class="ltx_cite ltx_citemacro_citep">(McMahan et al<span class="ltx_text">.</span>, <a href="#bib.bib32" title="" class="ltx_ref">2017</a>)</cite>, FedEWC <cite class="ltx_cite ltx_citemacro_citep">(Kirkpatrick et al<span class="ltx_text">.</span>, <a href="#bib.bib19" title="" class="ltx_ref">2017</a>)</cite>, FedProx <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib24" title="" class="ltx_ref">2020</a>)</cite> and GLFC <cite class="ltx_cite ltx_citemacro_citep">(Dong et al<span class="ltx_text">.</span>, <a href="#bib.bib8" title="" class="ltx_ref">2022</a>)</cite> on ResNet-18 <cite class="ltx_cite ltx_citemacro_citep">(He et al<span class="ltx_text">.</span>, <a href="#bib.bib13" title="" class="ltx_ref">2016</a>)</cite>. Since our method is based on ViT-B/16, we also conduct experiments on ViT-B/16 to compare FedMGP with FedViT. FedViT is a naive combination of FedAvg and ViT <cite class="ltx_cite ltx_citemacro_citep">(Dosovitskiy et al<span class="ltx_text">.</span>, <a href="#bib.bib9" title="" class="ltx_ref">2020</a>)</cite>, which performs federated training by locally updating and globally aggregating the parameters of the classifier heads iteratively. FedL2P and FedDualP are the adapted versions of two effective prompt-based methods in traditional CL, L2P <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib42" title="" class="ltx_ref">2022b</a>)</cite> and DualPrompt <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib41" title="" class="ltx_ref">2022a</a>)</cite>, making them more suitable for use in a federated environment. More detailed descriptions are in <a href="#A3" title="Appendix 3 Baselines ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Appendix 3</span></a>.</p>
</div>
</section>
<section id="S5.SS1.SSS3" class="ltx_subsubsection">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.1.3. </span>Implementation Details</h4>

<div id="S5.SS1.SSS3.p1" class="ltx_para">
<p id="S5.SS1.SSS3.p1.1" class="ltx_p">In our setup, the federated system consists of five clients and one central server, and each client possesses a sequence of five tasks. We repeat experiments with three random seeds (42,1999,2024) and report the averaged outcomes. Across all methods, we fix the number of clients at five and the interval rounds for increments at five. We employ Adam as the optimizer with a learning rate of <math id="S5.SS1.SSS3.p1.1.m1.1" class="ltx_Math" alttext="0.001" display="inline"><semantics id="S5.SS1.SSS3.p1.1.m1.1a"><mn id="S5.SS1.SSS3.p1.1.m1.1.1" xref="S5.SS1.SSS3.p1.1.m1.1.1.cmml">0.001</mn><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS3.p1.1.m1.1b"><cn type="float" id="S5.SS1.SSS3.p1.1.m1.1.1.cmml" xref="S5.SS1.SSS3.p1.1.m1.1.1">0.001</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS3.p1.1.m1.1c">0.001</annotation></semantics></math>. The whole training process is performed sequentially on an NVIDIA GPU RTX-3090.</p>
</div>
</section>
</section>
<section id="S5.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2. </span>Expermental Results</h3>

<div id="S5.SS2.p1" class="ltx_para">
<p id="S5.SS2.p1.1" class="ltx_p">We use the accuracy of the aggregated global model on local test sets as the metric in <a href="#S5.T1" title="Table 1 ‣ 5.1.1. Datasets ‣ 5.1. Experimental Setup ‣ 5. Experiments ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Table 1</span></a>. To examine the impact of different backbone networks on the experimental results, we employed baseline methods based on two backbones, namely ResNet-18 and the pre-trained ViT.</p>
</div>
<div id="S5.SS2.p2" class="ltx_para">
<p id="S5.SS2.p2.1" class="ltx_p">Surprisingly, all methods generally perform better in the asynchronous setting than in the synchronous setting. This is attributed to the fact that in the synchronous setting, each task involves 20 classes. GLFC, FedAvg, and FedProx failed in both asynchronous and synchronous FCL. As expected, methods based on ViT outperformed those based on ResNet-18 in both scenarios. But FedAvg performs even better than FedViT and FedDual in synchronous FCL. This indicates that in scenarios with similar data distributions, FedAvg has the ability to challenge large pre-trained models.</p>
</div>
<div id="S5.SS2.p3" class="ltx_para">
<p id="S5.SS2.p3.1" class="ltx_p">In all methods using ViT as the backbone, FedL2P with prompts performed better than using ViT alone. Unfortunately, FedDualP performed even worse than the simple FedViT. We believe this is due to the heterogeneity in the learned parameters across clients. Moreover, the performance of these methods did not show significant improvement after aggregation. In fact, FedViT experienced a decrease of 3.9% in average accuracy after aggregation in synchronous FCL and a decrease of 7.27% in asynchronous FCL.</p>
</div>
<div id="S5.SS2.p4" class="ltx_para">
<p id="S5.SS2.p4.1" class="ltx_p">Our method achieved the best performance in both synchronous and asynchronous settings, with accuracies of 90.56% and 83.46%, showing the state-of-the-art performance of fusing heterogeneous knowledge. Although our method performs well on this metric even without some components, such as Ours-w/oGP achieving 89.36% and 81.06%, and Ours-w/oLp achieving 87.29% and 77.93%, the ability to retain spatial-temporal knowledge is significantly affected. In the following section (<a href="#S5.SS3" title="5.3. Ablation Studies ‣ 5. Experiments ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Sec. 5.3</span></a>), we will evaluate each method using new metrics, i.e., temporal knowledge retention and spatial knowledge retention, to evaluate the resistance of spatial-temporal catastrophic forgetting.</p>
</div>
</section>
<section id="S5.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3. </span>Ablation Studies</h3>

<figure id="S5.F6.sf1" class="ltx_figure">
</figure>
<div id="S5.SS3.p1" class="ltx_para">
<p id="S5.SS3.p1.1" class="ltx_p">To further validate the effectiveness of the multi-granularity knowledge space, we conducted three different ablation experiments under the same experimental setup. These experiments respectively removed the global prompts, local prompts, and the selective prompt fusion mechanism on the server. Results are shown in <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:ablation</span>.</p>
</div>
<div id="S5.SS3.p2" class="ltx_para">
<p id="S5.SS3.p2.1" class="ltx_p">In both asynchronous and synchronous settings, ViT-based methods have demonstrated exceptional performance in retaining spatial knowledge. This result also confirms our hypothesis: having similar cognition is the foundation for knowledge sharing. Based on that, the increment of spatial knowledge retention of FedAvg in the synchronous setting is not difficult to understand, as similar data contributes to the similarity of convolutional layers. While these methods have effectively preserved spatial knowledge, none of them demonstrates resistance to temporal catastrophic forgetting. In <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_akrt</span> and <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_skrt</span>, it is challenging to distinguish the difference between FedL2P, FedDualP and other methods with ResNet18 as the backbone network, as their temporal knowledge retention rates are all around 20%.</p>
</div>
<div id="S5.SS3.p3" class="ltx_para">
<p id="S5.SS3.p3.1" class="ltx_p">Our approach not only competes with other ViT methods in terms of spatial knowledge retention but also achieves almost no forgetting in temporal knowledge retention, thanks to the construction of the multi-granularity knowledge space. To evaluate the contribution of the coarse-grained global prompt and the fine-grained local prompt, three different ablation experiments are conducted, which respectively removed global prompts (Ours-w/oGP), local prompts (Ours-w/oLP), and selective prompt fusion (Ours-w/oSPF). In <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_akrs</span>, there is a slight decrease in spatial knowledge retention when we remove the global prompt. The other two components have little impact on spatial forgetting. However, things become more complex when it comes to temporal knowledge retention. Without local prompts, it drops significantly to around 15%. And when we remove global prompts, although the retention also decreases, it is not as drastic.</p>
</div>
<div id="S5.SS3.p4" class="ltx_para">
<p id="S5.SS3.p4.1" class="ltx_p">It concludes that fine-grained local prompts play a crucial role in preventing temporal catastrophic forgetting, and they still need to be combined with coarse-grained knowledge to better prevent spatial-temporal catastrophic forgetting and achieve personalization. Hence, multi-granularity knowledge representation is a promising direction in PFCL.</p>
</div>
</section>
<section id="S5.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4. </span>Sensitivity Analysis</h3>

<figure id="S5.F6.sf2" class="ltx_figure">
</figure>
<div id="S5.SS4.p1" class="ltx_para">
<p id="S5.SS4.p1.1" class="ltx_p">FedMGP involves several hyperparameters, including prompt length, prompt pool size and so on. To further investigate the robustness of FedMGP, we conduct sensitivity analyses of prompt length and pool size on CIFAR-100 with 5 incremental tasks and present the results in <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_sensitivity</span>.</p>
</div>
<div id="S5.SS4.p2" class="ltx_para">
<p id="S5.SS4.p2.1" class="ltx_p">From <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_krsg</span>, it can be observed that, regardless of the values of prompt length and pool size, it is beneficial for spatial knowledge of the global prompts. Additionally, under the condition of Pool Size=1 and Prompt Length=10, spatial knowledge retention is the highest, reaching 100.37%.</p>
</div>
<div id="S5.SS4.p3" class="ltx_para">
<p id="S5.SS4.p3.1" class="ltx_p">From <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_krsl</span>, it can be seen that different values of prompt pool size and prompt length have little effect on spatial knowledge retention of the local prompts. It implies utilizing multi-granularity prompts is capable of training a generalized global model as well as personalized local models. More sensitivity analyses are shown in <a href="#A2" title="Appendix 2 Sensitivity Analysis ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Appendix 2</span></a>.</p>
</div>
</section>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Discussion</h2>

<div id="S6.p1" class="ltx_para">
<p id="S6.p1.1" class="ltx_p">This section will provide a preliminary analysis and discussion of the computational cost, communication overhead, and privacy protection in federated learning for FedMGP.</p>
</div>
<div id="S6.p2" class="ltx_para ltx_noindent">
<p id="S6.p2.1" class="ltx_p"><span id="S6.p2.1.1" class="ltx_text ltx_font_bold">Computational cost.</span> The clients have only two parts to train: coarse-grained global prompts and fine-grained local prompts. The size of the global prompt pool of one client is determined by the number of prompts, prompt length, and embedding dimension, which are set to 10, 10, and 768 in the experiments. And the size of prompt keys is determined by the pool size and embedding dimension. In our experimental setup, the total size of local prompts is 4,608,000, and the size of their corresponding keys is also the same as the global prompts’ keys, which is 7,680. In summary, <span id="S6.p2.1.2" class="ltx_text ltx_font_italic">each client has a total of 4,700,160 parameters to train</span>.</p>
</div>
<div id="S6.p3" class="ltx_para">
<p id="S6.p3.1" class="ltx_p">Moreover, the server only needs to aggregate the global prompts. This means that the training process of local prompts can proceed in parallel with the server’s aggregation process.</p>
</div>
<div id="S6.p4" class="ltx_para ltx_noindent">
<p id="S6.p4.1" class="ltx_p"><span id="S6.p4.1.1" class="ltx_text ltx_font_bold">Communication overhead.</span> Our method transmits only coarse-grained global prompts and keys, keeping communication overhead low. The size of the global prompt pool per client is determined by the number of prompts, prompt length, and embedding dimension (set to 10, 10, and 768 in experiments). Prompt keys size depends on pool size and embedding dimension. Thus, the total transmitted size is 76,800 + 7,680 parameters. Although there are fine-grained local parts that also need to be trained, they remain local, which significantly reduces the communication overhead compared to traditional methods, indirectly enhancing privacy.</p>
</div>
<div id="S6.p5" class="ltx_para ltx_noindent">
<p id="S6.p5.1" class="ltx_p"><span id="S6.p5.1.1" class="ltx_text ltx_font_bold">Privacy protection.</span> Since FedMGP only transmits the coarse-grained global prompts obtained from the ViT and their keys, without uploading the original embeddings of the images and the fine-grained local prompts, FedMGP has strong privacy protection, especially against gradient leakage attacks. Moreover, in our experimental setup, the size of global prompts is only 76,800 parameters, containing much less information, which also ensures privacy protection.</p>
</div>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7. </span>Conclusion</h2>

<div id="S7.p1" class="ltx_para">
<p id="S7.p1.1" class="ltx_p">Personalized Federated Continual Learning is a novel and practical scenario. It not only requires the accumulation of knowledge that evolves over time and space but also needs consideration of personalized strategies to make generalized knowledge better adapted to local requirements. Moreover, spatial-temporal catastrophic forgetting is also a key issue that needs to be addressed.</p>
</div>
<div id="S7.p2" class="ltx_para">
<p id="S7.p2.1" class="ltx_p">In this paper, we first formulated a formal problem definition for PFCL and shaped the objectives of PFCL as three folds: (1) Alleviating spatial knowledge catastrophic forgetting caused by data heterogeneity; (2) Mitigating temporal knowledge catastrophic forgetting caused by dynamic task streams; (3) Training customized local models to achieve personalization.</p>
</div>
<div id="S7.p3" class="ltx_para">
<p id="S7.p3.1" class="ltx_p">To address these issues, we proposed a multi-granularity knowledge space for federated continuous learning (termed as FedMGP), which has efficient fusion and personalization by representing knowledge at different granularities. Specifically, the FedMGP utilizes a shared ViT to construct coarse-grained global prompts and modifies the ViT with local prompts based on these global prompts. In addition, we designed 1) global prompts on the embedding layer to learn coarse-grained knowledge continually and 2) local prompts on the multi-head self-attention layer to learn fine-grained knowledge as a complementary to achieve personalization. Extensive experiments under synchronous and asynchronous FCL settings are conducted to demonstrate the effectiveness of our method.</p>
</div>
<div id="S7.p4" class="ltx_para">
<p id="S7.p4.1" class="ltx_p">The effectiveness of multi-granularity knowledge representation has been experimentally proven in this work, and their complementary nature significantly enhances the model’s resistance to spatial-temporal catastrophic forgetting. Our future research will investigate the multi-granularity representation of knowledge in various federated learning scenarios such as vertical federated learning <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a href="#bib.bib28" title="" class="ltx_ref">2024</a>)</cite> and multi-objective federated learning <cite class="ltx_cite ltx_citemacro_citep">(Kang et al<span class="ltx_text">.</span>, <a href="#bib.bib17" title="" class="ltx_ref">2023b</a>)</cite>. We will explore its implications for privacy preservation, model performance, algorithm efficiency, and so on, aiming at achieving trustworthy PFCL.</p>
</div>
<div class="ltx_acknowledgements">
<h6 class="ltx_title ltx_title_acknowledgements">Acknowledgements.</h6>
This work was supported by the National Natural Science Foundation of China (Nos. 72242106, 62176221), the Natural Science Foundation of Sichuan Province (No. 2022NSFSC0528), Sichuan Science and Technology Program (No. 2024YFHZ0024), Jiaozi Institute of Fintech Innovation in Southwestern University of Finance and Economics (Nos. kjcgzh20230103, kjcgzh20230201) and the Fundamental Research Funds for the Central Universities (YJ202421).

</div>
</section>
<section id="bib" class="ltx_bibliography">
<h2 class="ltx_title ltx_title_bibliography">References</h2>

<ul class="ltx_biblist">
<li id="bib.bib1" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">        




</span>
</li>
<li id="bib.bib2" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Arivazhagan et al<span id="bib.bib2.2.2.1" class="ltx_text">.</span> (2019)</span>
<span class="ltx_bibblock">
Manoj Ghuhan Arivazhagan, Vinay Aggarwal, Aaditya Kumar Singh, and Sunav Choudhary. 2019.

</span>
<span class="ltx_bibblock">Federated learning with personalization layers.

</span>
<span class="ltx_bibblock"><em id="bib.bib2.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:1912.00818</em> (2019).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib3" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cai et al<span id="bib.bib3.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Luxin Cai, Naiyue Chen, Yuanzhouhan Cao, Jiahuan He, and Yidong Li. 2023.

</span>
<span class="ltx_bibblock">FedCE: Personalized Federated Learning Method based on Clustering Ensembles. In <em id="bib.bib3.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 31st ACM International Conference on Multimedia</em>. 1625–1633.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib4" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cai et al<span id="bib.bib4.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Shangxuan Cai, Yunfeng Zhao, Zhicheng Liu, Chao Qiu, Xiaofei Wang, and Qinghua Hu. 2022.

</span>
<span class="ltx_bibblock">Multi-granularity Weighted Federated Learning in Heterogeneous Mobile Edge Computing Systems. In <em id="bib.bib4.3.1" class="ltx_emph ltx_font_italic">2022 IEEE 42nd International Conference on Distributed Computing Systems</em>. IEEE, 436–446.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib5" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen and Zhang (2022)</span>
<span class="ltx_bibblock">
Jiayi Chen and Aidong Zhang. 2022.

</span>
<span class="ltx_bibblock">FedMSplit: Correlation-adaptive federated multi-task learning across multimodal split networks. In <em id="bib.bib5.1.1" class="ltx_emph ltx_font_italic">Proceedings of the 28th ACM SIGKDD Conference on Knowledge Discovery and Data Mining</em>. 87–96.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib6" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span id="bib.bib6.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Ziyang Chen, Jinzhi Liao, and Xiang Zhao. 2023.

</span>
<span class="ltx_bibblock">Multi-granularity Temporal Question Answering over Knowledge Graphs. In <em id="bib.bib6.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics</em>. 11378–11392.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib7" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">De Lange et al<span id="bib.bib7.2.2.1" class="ltx_text">.</span> (2021)</span>
<span class="ltx_bibblock">
Matthias De Lange, Rahaf Aljundi, Marc Masana, Sarah Parisot, Xu Jia, Aleš Leonardis, Gregory Slabaugh, and Tinne Tuytelaars. 2021.

</span>
<span class="ltx_bibblock">A continual learning survey: Defying forgetting in classification tasks.

</span>
<span class="ltx_bibblock"><em id="bib.bib7.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Pattern Analysis and Machine Intelligence</em> 44, 7 (2021), 3366–3385.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib8" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dong et al<span id="bib.bib8.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Jiahua Dong, Lixu Wang, Zhen Fang, Gan Sun, Shichao Xu, Xiao Wang, and Qi Zhu. 2022.

</span>
<span class="ltx_bibblock">Federated class-incremental learning. In <em id="bib.bib8.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>. 10164–10173.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib9" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dosovitskiy et al<span id="bib.bib9.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Alexey Dosovitskiy, Lucas Beyer, Alexander Kolesnikov, Dirk Weissenborn, Xiaohua Zhai, Thomas Unterthiner, Mostafa Dehghani, Matthias Minderer, Georg Heigold, Sylvain Gelly, et al<span id="bib.bib9.3.1" class="ltx_text">.</span> 2020.

</span>
<span class="ltx_bibblock">An image is worth 16x16 words: Transformers for image recognition at scale.

</span>
<span class="ltx_bibblock"><em id="bib.bib9.4.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2010.11929</em> (2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib10" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fallah et al<span id="bib.bib10.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Alireza Fallah, Aryan Mokhtari, and Asuman Ozdaglar. 2020.

</span>
<span class="ltx_bibblock">Personalized federated learning with theoretical guarantees: A model-agnostic meta-learning approach.

</span>
<span class="ltx_bibblock"><em id="bib.bib10.3.1" class="ltx_emph ltx_font_italic">Advances in Neural Information Processing Systems</em> 33 (2020), 3557–3568.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib11" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fang et al<span id="bib.bib11.2.2.1" class="ltx_text">.</span> (2019)</span>
<span class="ltx_bibblock">
Shen Fang, Qi Zhang, Gaofeng Meng, Shiming Xiang, and Chunhong Pan. 2019.

</span>
<span class="ltx_bibblock">GSTNet: Global spatial-temporal network for traffic flow prediction.. In <em id="bib.bib11.3.1" class="ltx_emph ltx_font_italic">IJCAI</em>. 2286–2293.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib12" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Guo et al<span id="bib.bib12.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Tao Guo, Song Guo, and Junxiao Wang. 2023.

</span>
<span class="ltx_bibblock">pFedPrompt: Learning Personalized Prompt for Vision-Language Models in Federated Learning. In <em id="bib.bib12.3.1" class="ltx_emph ltx_font_italic">Proceedings of the ACM Web Conference</em>. 1364–1374.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib13" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">He et al<span id="bib.bib13.2.2.1" class="ltx_text">.</span> (2016)</span>
<span class="ltx_bibblock">
Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun. 2016.

</span>
<span class="ltx_bibblock">Deep residual learning for image recognition. In <em id="bib.bib13.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition</em>. 770–778.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib14" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al<span id="bib.bib14.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Zi-Yuan Hu, Yanyang Li, Michael R Lyu, and Liwei Wang. 2023.

</span>
<span class="ltx_bibblock">Vl-pet: Vision-and-language parameter-efficient tuning via granularity control. In <em id="bib.bib14.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF International Conference on Computer Vision</em>. 3010–3020.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib15" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jia et al<span id="bib.bib15.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Menglin Jia, Luming Tang, Bor-Chun Chen, Claire Cardie, Serge Belongie, Bharath Hariharan, and Ser-Nam Lim. 2022.

</span>
<span class="ltx_bibblock">Visual prompt tuning. In <em id="bib.bib15.3.1" class="ltx_emph ltx_font_italic">European Conference on Computer Vision</em>. Springer, 709–727.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib16" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kang et al<span id="bib.bib16.2.2.1" class="ltx_text">.</span> (2023a)</span>
<span class="ltx_bibblock">
Yan Kang, Tao Fan, Hanlin Gu, Lixin Fan, and Qiang Yang. 2023a.

</span>
<span class="ltx_bibblock">Grounding foundation models through federated transfer learning: A general framework.

</span>
<span class="ltx_bibblock"><em id="bib.bib16.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2311.17431</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib17" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kang et al<span id="bib.bib17.2.2.1" class="ltx_text">.</span> (2023b)</span>
<span class="ltx_bibblock">
Yan Kang, Hanlin Gu, Xingxing Tang, Yuanqin He, Yuzhu Zhang, Jinnan He, Yuxing Han, Lixin Fan, Kai Chen, and Qiang Yang. 2023b.

</span>
<span class="ltx_bibblock">Optimizing privacy, utility and efficiency in constrained multi-objective federated learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib17.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2305.00312</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib18" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khan et al<span id="bib.bib18.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Muhammad Gul Zain Ali Khan, Muhammad Ferjad Naeem, Luc Van Gool, Didier Stricker, Federico Tombari, and Muhammad Zeshan Afzal. 2023.

</span>
<span class="ltx_bibblock">Introducing language guidance in prompt-based continual learning. In <em id="bib.bib18.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF International Conference on Computer Vision</em>. 11463–11473.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib19" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kirkpatrick et al<span id="bib.bib19.2.2.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
James Kirkpatrick, Razvan Pascanu, Neil Rabinowitz, Joel Veness, Guillaume Desjardins, Andrei A Rusu, Kieran Milan, John Quan, Tiago Ramalho, Agnieszka Grabska-Barwinska, et al<span id="bib.bib19.3.1" class="ltx_text">.</span> 2017.

</span>
<span class="ltx_bibblock">Overcoming catastrophic forgetting in neural networks.

</span>
<span class="ltx_bibblock"><em id="bib.bib19.4.1" class="ltx_emph ltx_font_italic">Proceedings of the National Academy of Sciences</em> 114, 13 (2017), 3521–3526.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib20" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Krizhevsky et al<span id="bib.bib20.2.2.1" class="ltx_text">.</span> (2009)</span>
<span class="ltx_bibblock">
Alex Krizhevsky, Geoffrey Hinton, et al<span id="bib.bib20.3.1" class="ltx_text">.</span> 2009.

</span>
<span class="ltx_bibblock">Learning multiple layers of features from tiny images.

</span>
<span class="ltx_bibblock">(2009).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib21" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lester et al<span id="bib.bib21.2.2.1" class="ltx_text">.</span> (2021)</span>
<span class="ltx_bibblock">
Brian Lester, Rami Al-Rfou, and Noah Constant. 2021.

</span>
<span class="ltx_bibblock">The Power of Scale for Parameter-Efficient Prompt Tuning. In <em id="bib.bib21.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 2021 Conference on Empirical Methods in Natural Language Processing</em>. 3045–3059.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib22" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span id="bib.bib22.2.2.1" class="ltx_text">.</span> (2023b)</span>
<span class="ltx_bibblock">
Miaomiao Li, Jiaqi Zhu, Xin Yang, Yi Yang, Qiang Gao, and Hongan Wang. 2023b.

</span>
<span class="ltx_bibblock">CL-WSTC: Continual Learning for Weakly Supervised Text Classification on the Internet. In <em id="bib.bib22.3.1" class="ltx_emph ltx_font_italic">Proceedings of the ACM Web Conference</em>. 1489–1499.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib23" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span id="bib.bib23.2.2.1" class="ltx_text">.</span> (2021)</span>
<span class="ltx_bibblock">
Tian Li, Shengyuan Hu, Ahmad Beirami, and Virginia Smith. 2021.

</span>
<span class="ltx_bibblock">Ditto: Fair and robust federated learning through personalization. In <em id="bib.bib23.3.1" class="ltx_emph ltx_font_italic">International Conference on Machine Learning</em>. PMLR, 6357–6368.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib24" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span id="bib.bib24.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Tian Li, Anit Kumar Sahu, Manzil Zaheer, Maziar Sanjabi, Ameet Talwalkar, and Virginia Smith. 2020.

</span>
<span class="ltx_bibblock">Federated optimization in heterogeneous networks.

</span>
<span class="ltx_bibblock"><em id="bib.bib24.3.1" class="ltx_emph ltx_font_italic">Proceedings of Machine Learning and Systems</em> 2 (2020), 429–450.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib25" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span id="bib.bib25.2.2.1" class="ltx_text">.</span> (2024)</span>
<span class="ltx_bibblock">
Yichen Li, Qunwei Li, Haozhao Wang, Ruixuan Li, Wenliang Zhong, and Guannan Zhang. 2024.

</span>
<span class="ltx_bibblock">Towards Efficient Replay in Federated Incremental Learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib25.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2403.05890</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib26" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span id="bib.bib26.2.2.1" class="ltx_text">.</span> (2023a)</span>
<span class="ltx_bibblock">
Yujie Li, Xin Yang, Hao Wang, Xiangkun Wang, and Tianrui Li. 2023a.

</span>
<span class="ltx_bibblock">Learning to Prompt Knowledge Transfer for Open-World Continual Learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib26.3.1" class="ltx_emph ltx_font_italic">arXiv preprint arXiv:2312.14990</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib27" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span id="bib.bib27.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Lumin Liu, Jun Zhang, SH Song, and Khaled B Letaief. 2020.

</span>
<span class="ltx_bibblock">Client-edge-cloud hierarchical federated learning. In <em id="bib.bib27.3.1" class="ltx_emph ltx_font_italic">ICC 2020-2020 IEEE International Conference on Communications</em>. IEEE, 1–6.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib28" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span id="bib.bib28.2.2.1" class="ltx_text">.</span> (2024)</span>
<span class="ltx_bibblock">
Yang Liu, Yan Kang, Tianyuan Zou, Yanhong Pu, Yuanqin He, Xiaozhou Ye, Ye Ouyang, Ya-Qin Zhang, and Qiang Yang. 2024.

</span>
<span class="ltx_bibblock">Vertical Federated Learning: Concepts, Advances, and Challenges.

</span>
<span class="ltx_bibblock"><em id="bib.bib28.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Knowledge and Data Engineering</em> (2024).

</span>
<span class="ltx_bibblock">
<a target="_blank" href="https://doi.org/10.1109/TKDE.2024.3352628" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://doi.org/10.1109/TKDE.2024.3352628</a>

</span>
</li>
<li id="bib.bib29" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ma et al<span id="bib.bib29.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Xiaosong Ma, Jie Zhang, Song Guo, and Wenchao Xu. 2022.

</span>
<span class="ltx_bibblock">Layer-wised model aggregation for personalized federated learning. In <em id="bib.bib29.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>. 10092–10101.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib30" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mai et al<span id="bib.bib30.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Zheda Mai, Ruiwen Li, Jihwan Jeong, David Quispe, Hyunwoo Kim, and Scott Sanner. 2022.

</span>
<span class="ltx_bibblock">Online continual learning in image classification: An empirical survey.

</span>
<span class="ltx_bibblock"><em id="bib.bib30.3.1" class="ltx_emph ltx_font_italic">Neurocomputing</em> 469 (2022), 28–51.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib31" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Masana et al<span id="bib.bib31.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Marc Masana, Xialei Liu, Bartłomiej Twardowski, Mikel Menta, Andrew D Bagdanov, and Joost Van De Weijer. 2022.

</span>
<span class="ltx_bibblock">Class-incremental learning: survey and performance evaluation on image classification.

</span>
<span class="ltx_bibblock"><em id="bib.bib31.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Pattern Analysis and Machine Intelligence</em> 45, 5 (2022), 5513–5533.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib32" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">McMahan et al<span id="bib.bib32.2.2.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and Blaise Aguera y Arcas. 2017.

</span>
<span class="ltx_bibblock">Communication-efficient learning of deep networks from decentralized data. In <em id="bib.bib32.3.1" class="ltx_emph ltx_font_italic">Artificial Intelligence and Statistics</em>. PMLR, 1273–1282.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib33" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pan et al<span id="bib.bib33.2.2.1" class="ltx_text">.</span> (2021)</span>
<span class="ltx_bibblock">
Zijie Pan, Li Hu, Weixuan Tang, Jin Li, Yi He, and Zheli Liu. 2021.

</span>
<span class="ltx_bibblock">Privacy-preserving multi-granular federated neural architecture search a general framework.

</span>
<span class="ltx_bibblock"><em id="bib.bib33.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Knowledge and Data Engineering</em> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib34" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pillutla et al<span id="bib.bib34.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Krishna Pillutla, Kshitiz Malik, Abdel-Rahman Mohamed, Mike Rabbat, Maziar Sanjabi, and Lin Xiao. 2022.

</span>
<span class="ltx_bibblock">Federated learning with partial model personalization. In <em id="bib.bib34.3.1" class="ltx_emph ltx_font_italic">International Conference on Machine Learning</em>. PMLR, 17716–17758.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib35" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Smith et al<span id="bib.bib35.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
James Seale Smith, Leonid Karlinsky, Vyshnavi Gutta, Paola Cascante-Bonilla, Donghyun Kim, Assaf Arbelle, Rameswar Panda, Rogerio Feris, and Zsolt Kira. 2023.

</span>
<span class="ltx_bibblock">CODA-Prompt: COntinual Decomposed Attention-based Prompting for Rehearsal-Free Continual Learning. In <em id="bib.bib35.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>. 11909–11919.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib36" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al<span id="bib.bib36.2.2.1" class="ltx_text">.</span> (2021)</span>
<span class="ltx_bibblock">
Benyuan Sun, Hongxing Huo, Yi Yang, and Bo Bai. 2021.

</span>
<span class="ltx_bibblock">Partialfed: Cross-domain personalized federated learning via partial initialization.

</span>
<span class="ltx_bibblock"><em id="bib.bib36.3.1" class="ltx_emph ltx_font_italic">Advances in Neural Information Processing Systems</em> 34 (2021), 23309–23320.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib37" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">T Dinh et al<span id="bib.bib37.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Canh T Dinh, Nguyen Tran, and Josh Nguyen. 2020.

</span>
<span class="ltx_bibblock">Personalized federated learning with Moreau envelopes.

</span>
<span class="ltx_bibblock"><em id="bib.bib37.3.1" class="ltx_emph ltx_font_italic">Advances in Neural Information Processing Systems</em> 33 (2020), 21394–21405.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib38" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tan et al<span id="bib.bib38.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Alysa Ziying Tan, Han Yu, Lizhen Cui, and Qiang Yang. 2022.

</span>
<span class="ltx_bibblock">Towards personalized federated learning.

</span>
<span class="ltx_bibblock"><em id="bib.bib38.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Neural Networks and Learning Systems</em> (2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib39" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vahidian et al<span id="bib.bib39.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Saeed Vahidian, Mahdi Morafah, Weijia Wang, Vyacheslav Kungurtsev, Chen Chen, Mubarak Shah, and Bill Lin. 2023.

</span>
<span class="ltx_bibblock">Efficient distribution similarity identification in clustered federated learning via principal angles between client data subspaces. In <em id="bib.bib39.3.1" class="ltx_emph ltx_font_italic">Proceedings of the AAAI Conference on Artificial Intelligence</em>, Vol. 37. 10043–10052.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib40" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al<span id="bib.bib40.2.2.1" class="ltx_text">.</span> (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em id="bib.bib40.3.1" class="ltx_emph ltx_font_italic">Advances in Neural Information Processing Systems</em> 30 (2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib41" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span id="bib.bib41.2.2.1" class="ltx_text">.</span> (2022a)</span>
<span class="ltx_bibblock">
Zifeng Wang, Zizhao Zhang, Sayna Ebrahimi, Ruoxi Sun, Han Zhang, Chen-Yu Lee, Xiaoqi Ren, Guolong Su, Vincent Perot, Jennifer Dy, et al<span id="bib.bib41.3.1" class="ltx_text">.</span> 2022a.

</span>
<span class="ltx_bibblock">Dualprompt: Complementary prompting for rehearsal-free continual learning. In <em id="bib.bib41.4.1" class="ltx_emph ltx_font_italic">European Conference on Computer Vision</em>. Springer, 631–648.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib42" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span id="bib.bib42.2.2.1" class="ltx_text">.</span> (2022b)</span>
<span class="ltx_bibblock">
Zifeng Wang, Zizhao Zhang, Chen-Yu Lee, Han Zhang, Ruoxi Sun, Xiaoqi Ren, Guolong Su, Vincent Perot, Jennifer Dy, and Tomas Pfister. 2022b.

</span>
<span class="ltx_bibblock">Learning to prompt for continual learning. In <em id="bib.bib42.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>. 139–149.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib43" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al<span id="bib.bib43.2.2.1" class="ltx_text">.</span> (2018)</span>
<span class="ltx_bibblock">
Hao Xiao, Weiyao Lin, Bin Sheng, Ke Lu, Junchi Yan, Jingdong Wang, Errui Ding, Yihao Zhang, and Hongkai Xiong. 2018.

</span>
<span class="ltx_bibblock">Group re-identification: Leveraging and integrating multi-grain information. In <em id="bib.bib43.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 26th ACM International Conference on Multimedia</em>. 192–200.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib44" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span id="bib.bib44.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Fu-En Yang, Chien-Yi Wang, and Yu-Chiang Frank Wang. 2023.

</span>
<span class="ltx_bibblock">Efficient model personalization in federated learning via client-specific prompt generation. In <em id="bib.bib44.3.1" class="ltx_emph ltx_font_italic">Proceedings of the IEEE/CVF International Conference on Computer Vision</em>. 19159–19168.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib45" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span id="bib.bib45.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Hongwei Yang, Hui He, Weizhe Zhang, and Xiaochun Cao. 2020.

</span>
<span class="ltx_bibblock">FedSteg: A federated transfer learning framework for secure image steganalysis.

</span>
<span class="ltx_bibblock"><em id="bib.bib45.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Network Science and Engineering</em> 8, 2 (2020), 1084–1094.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib46" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span id="bib.bib46.2.2.1" class="ltx_text">.</span> (2022a)</span>
<span class="ltx_bibblock">
Xin Yang, Yujie Li, Qiuke Li, Dun Liu, and Tianrui Li. 2022a.

</span>
<span class="ltx_bibblock">Temporal-spatial three-way granular computing for dynamic text sentiment classification.

</span>
<span class="ltx_bibblock"><em id="bib.bib46.3.1" class="ltx_emph ltx_font_italic">Information Sciences</em> 596 (2022), 551–566.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib47" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span id="bib.bib47.2.2.1" class="ltx_text">.</span> (2022b)</span>
<span class="ltx_bibblock">
Xin Yang, Yujie Li, Dan Meng, Yuxuan Yang, Dun Liu, and Tianrui Li. 2022b.

</span>
<span class="ltx_bibblock">Three-way multi-granularity learning towards open topic classification.

</span>
<span class="ltx_bibblock"><em id="bib.bib47.3.1" class="ltx_emph ltx_font_italic">Information Sciences</em> 585 (2022), 41–57.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib48" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span id="bib.bib48.2.2.1" class="ltx_text">.</span> (2024)</span>
<span class="ltx_bibblock">
Xin Yang, Hao Yu, Xin Gao, Hao Wang, Junbo Zhang, and Tianrui Li. 2024.

</span>
<span class="ltx_bibblock">Federated Continual Learning via Knowledge Fusion: A Survey.

</span>
<span class="ltx_bibblock"><em id="bib.bib48.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Knowledge and Data Engineering</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib49" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span id="bib.bib49.2.2.1" class="ltx_text">.</span> (2023)</span>
<span class="ltx_bibblock">
Jianqing Zhang, Yang Hua, Hao Wang, Tao Song, Zhengui Xue, Ruhui Ma, and Haibing Guan. 2023.

</span>
<span class="ltx_bibblock">Fedcp: Separating feature information for personalized federated learning via conditional policy. In <em id="bib.bib49.3.1" class="ltx_emph ltx_font_italic">Proceedings of the 29th ACM SIGKDD Conference on Knowledge Discovery and Data Mining</em>. 3249–3261.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib50" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhou et al<span id="bib.bib50.2.2.1" class="ltx_text">.</span> (2022)</span>
<span class="ltx_bibblock">
Kaiyang Zhou, Jingkang Yang, Chen Change Loy, and Ziwei Liu. 2022.

</span>
<span class="ltx_bibblock">Learning to prompt for vision-language models.

</span>
<span class="ltx_bibblock"><em id="bib.bib50.3.1" class="ltx_emph ltx_font_italic">International Journal of Computer Vision</em> 130, 9 (2022), 2337–2348.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li id="bib.bib51" class="ltx_bibitem">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhou et al<span id="bib.bib51.2.2.1" class="ltx_text">.</span> (2020)</span>
<span class="ltx_bibblock">
Zhengyang Zhou, Yang Wang, Xike Xie, Lianliang Chen, and Chaochao Zhu. 2020.

</span>
<span class="ltx_bibblock">Foresee urban sparse traffic accidents: A spatiotemporal multi-granularity perspective.

</span>
<span class="ltx_bibblock"><em id="bib.bib51.3.1" class="ltx_emph ltx_font_italic">IEEE Transactions on Knowledge and Data Engineering</em> 34, 8 (2020), 3786–3799.

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section id="A1" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix 1 </span>Notation</h2>

<div id="A1.p1" class="ltx_para">
<p id="A1.p1.1" class="ltx_p">In <a href="#A1.T2" title="Table 2 ‣ Appendix 1 Notation ‣ Personalized Federated Continual Learning via Multi-granularity Prompt" class="ltx_ref ltx_refmacro_autoref"><span class="ltx_text ltx_ref_tag">Table 2</span></a>, we introduce the notations in our paper.</p>
</div>
<figure id="A1.T2" class="ltx_table">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span id="A1.T2.20.1.1" class="ltx_text" style="font-size:90%;">Table 2</span>. </span><span id="A1.T2.21.2" class="ltx_text" style="font-size:90%;">Mathematical notations and descriptions.</span></figcaption>
<table id="A1.T2.18" class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="A1.T2.18.19.1" class="ltx_tr">
<th id="A1.T2.18.19.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_t">Notation</th>
<th id="A1.T2.18.19.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t">Description</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="A1.T2.2.2" class="ltx_tr">
<th id="A1.T2.1.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t"><math id="A1.T2.1.1.1.m1.1" class="ltx_Math" alttext="\mathcal{A}_{i}" display="inline"><semantics id="A1.T2.1.1.1.m1.1a"><msub id="A1.T2.1.1.1.m1.1.1" xref="A1.T2.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.T2.1.1.1.m1.1.1.2" xref="A1.T2.1.1.1.m1.1.1.2.cmml">𝒜</mi><mi id="A1.T2.1.1.1.m1.1.1.3" xref="A1.T2.1.1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.T2.1.1.1.m1.1b"><apply id="A1.T2.1.1.1.m1.1.1.cmml" xref="A1.T2.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.1.1.1.m1.1.1.1.cmml" xref="A1.T2.1.1.1.m1.1.1">subscript</csymbol><ci id="A1.T2.1.1.1.m1.1.1.2.cmml" xref="A1.T2.1.1.1.m1.1.1.2">𝒜</ci><ci id="A1.T2.1.1.1.m1.1.1.3.cmml" xref="A1.T2.1.1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.1.1.1.m1.1c">\mathcal{A}_{i}</annotation></semantics></math></th>
<td id="A1.T2.2.2.2" class="ltx_td ltx_align_center ltx_border_t">Client <math id="A1.T2.2.2.2.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="A1.T2.2.2.2.m1.1a"><mi id="A1.T2.2.2.2.m1.1.1" xref="A1.T2.2.2.2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="A1.T2.2.2.2.m1.1b"><ci id="A1.T2.2.2.2.m1.1.1.cmml" xref="A1.T2.2.2.2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.2.2.2.m1.1c">i</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.4.4" class="ltx_tr">
<th id="A1.T2.3.3.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.3.3.1.m1.1" class="ltx_Math" alttext="\theta^{r}_{g}" display="inline"><semantics id="A1.T2.3.3.1.m1.1a"><msubsup id="A1.T2.3.3.1.m1.1.1" xref="A1.T2.3.3.1.m1.1.1.cmml"><mi id="A1.T2.3.3.1.m1.1.1.2.2" xref="A1.T2.3.3.1.m1.1.1.2.2.cmml">θ</mi><mi id="A1.T2.3.3.1.m1.1.1.3" xref="A1.T2.3.3.1.m1.1.1.3.cmml">g</mi><mi id="A1.T2.3.3.1.m1.1.1.2.3" xref="A1.T2.3.3.1.m1.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="A1.T2.3.3.1.m1.1b"><apply id="A1.T2.3.3.1.m1.1.1.cmml" xref="A1.T2.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.3.3.1.m1.1.1.1.cmml" xref="A1.T2.3.3.1.m1.1.1">subscript</csymbol><apply id="A1.T2.3.3.1.m1.1.1.2.cmml" xref="A1.T2.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.3.3.1.m1.1.1.2.1.cmml" xref="A1.T2.3.3.1.m1.1.1">superscript</csymbol><ci id="A1.T2.3.3.1.m1.1.1.2.2.cmml" xref="A1.T2.3.3.1.m1.1.1.2.2">𝜃</ci><ci id="A1.T2.3.3.1.m1.1.1.2.3.cmml" xref="A1.T2.3.3.1.m1.1.1.2.3">𝑟</ci></apply><ci id="A1.T2.3.3.1.m1.1.1.3.cmml" xref="A1.T2.3.3.1.m1.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.3.3.1.m1.1c">\theta^{r}_{g}</annotation></semantics></math></th>
<td id="A1.T2.4.4.2" class="ltx_td ltx_align_center">The global model at round <math id="A1.T2.4.4.2.m1.1" class="ltx_Math" alttext="r" display="inline"><semantics id="A1.T2.4.4.2.m1.1a"><mi id="A1.T2.4.4.2.m1.1.1" xref="A1.T2.4.4.2.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="A1.T2.4.4.2.m1.1b"><ci id="A1.T2.4.4.2.m1.1.1.cmml" xref="A1.T2.4.4.2.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.4.4.2.m1.1c">r</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.7.7" class="ltx_tr">
<th id="A1.T2.5.5.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.5.5.1.m1.1" class="ltx_Math" alttext="\theta^{r}_{i}" display="inline"><semantics id="A1.T2.5.5.1.m1.1a"><msubsup id="A1.T2.5.5.1.m1.1.1" xref="A1.T2.5.5.1.m1.1.1.cmml"><mi id="A1.T2.5.5.1.m1.1.1.2.2" xref="A1.T2.5.5.1.m1.1.1.2.2.cmml">θ</mi><mi id="A1.T2.5.5.1.m1.1.1.3" xref="A1.T2.5.5.1.m1.1.1.3.cmml">i</mi><mi id="A1.T2.5.5.1.m1.1.1.2.3" xref="A1.T2.5.5.1.m1.1.1.2.3.cmml">r</mi></msubsup><annotation-xml encoding="MathML-Content" id="A1.T2.5.5.1.m1.1b"><apply id="A1.T2.5.5.1.m1.1.1.cmml" xref="A1.T2.5.5.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.5.5.1.m1.1.1.1.cmml" xref="A1.T2.5.5.1.m1.1.1">subscript</csymbol><apply id="A1.T2.5.5.1.m1.1.1.2.cmml" xref="A1.T2.5.5.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.5.5.1.m1.1.1.2.1.cmml" xref="A1.T2.5.5.1.m1.1.1">superscript</csymbol><ci id="A1.T2.5.5.1.m1.1.1.2.2.cmml" xref="A1.T2.5.5.1.m1.1.1.2.2">𝜃</ci><ci id="A1.T2.5.5.1.m1.1.1.2.3.cmml" xref="A1.T2.5.5.1.m1.1.1.2.3">𝑟</ci></apply><ci id="A1.T2.5.5.1.m1.1.1.3.cmml" xref="A1.T2.5.5.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.5.5.1.m1.1c">\theta^{r}_{i}</annotation></semantics></math></th>
<td id="A1.T2.7.7.3" class="ltx_td ltx_align_center">The local model of client <math id="A1.T2.6.6.2.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="A1.T2.6.6.2.m1.1a"><mi id="A1.T2.6.6.2.m1.1.1" xref="A1.T2.6.6.2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="A1.T2.6.6.2.m1.1b"><ci id="A1.T2.6.6.2.m1.1.1.cmml" xref="A1.T2.6.6.2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.6.6.2.m1.1c">i</annotation></semantics></math> at round <math id="A1.T2.7.7.3.m2.1" class="ltx_Math" alttext="r" display="inline"><semantics id="A1.T2.7.7.3.m2.1a"><mi id="A1.T2.7.7.3.m2.1.1" xref="A1.T2.7.7.3.m2.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="A1.T2.7.7.3.m2.1b"><ci id="A1.T2.7.7.3.m2.1.1.cmml" xref="A1.T2.7.7.3.m2.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.7.7.3.m2.1c">r</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.8.8" class="ltx_tr">
<th id="A1.T2.8.8.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.8.8.1.m1.1" class="ltx_Math" alttext="\mathcal{P}_{G}" display="inline"><semantics id="A1.T2.8.8.1.m1.1a"><msub id="A1.T2.8.8.1.m1.1.1" xref="A1.T2.8.8.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.T2.8.8.1.m1.1.1.2" xref="A1.T2.8.8.1.m1.1.1.2.cmml">𝒫</mi><mi id="A1.T2.8.8.1.m1.1.1.3" xref="A1.T2.8.8.1.m1.1.1.3.cmml">G</mi></msub><annotation-xml encoding="MathML-Content" id="A1.T2.8.8.1.m1.1b"><apply id="A1.T2.8.8.1.m1.1.1.cmml" xref="A1.T2.8.8.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.8.8.1.m1.1.1.1.cmml" xref="A1.T2.8.8.1.m1.1.1">subscript</csymbol><ci id="A1.T2.8.8.1.m1.1.1.2.cmml" xref="A1.T2.8.8.1.m1.1.1.2">𝒫</ci><ci id="A1.T2.8.8.1.m1.1.1.3.cmml" xref="A1.T2.8.8.1.m1.1.1.3">𝐺</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.8.8.1.m1.1c">\mathcal{P}_{G}</annotation></semantics></math></th>
<td id="A1.T2.8.8.2" class="ltx_td ltx_align_center">Global prompt pool</td>
</tr>
<tr id="A1.T2.10.10" class="ltx_tr">
<th id="A1.T2.9.9.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.9.9.1.m1.1" class="ltx_Math" alttext="P^{i}_{l}" display="inline"><semantics id="A1.T2.9.9.1.m1.1a"><msubsup id="A1.T2.9.9.1.m1.1.1" xref="A1.T2.9.9.1.m1.1.1.cmml"><mi id="A1.T2.9.9.1.m1.1.1.2.2" xref="A1.T2.9.9.1.m1.1.1.2.2.cmml">P</mi><mi id="A1.T2.9.9.1.m1.1.1.3" xref="A1.T2.9.9.1.m1.1.1.3.cmml">l</mi><mi id="A1.T2.9.9.1.m1.1.1.2.3" xref="A1.T2.9.9.1.m1.1.1.2.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="A1.T2.9.9.1.m1.1b"><apply id="A1.T2.9.9.1.m1.1.1.cmml" xref="A1.T2.9.9.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.9.9.1.m1.1.1.1.cmml" xref="A1.T2.9.9.1.m1.1.1">subscript</csymbol><apply id="A1.T2.9.9.1.m1.1.1.2.cmml" xref="A1.T2.9.9.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.9.9.1.m1.1.1.2.1.cmml" xref="A1.T2.9.9.1.m1.1.1">superscript</csymbol><ci id="A1.T2.9.9.1.m1.1.1.2.2.cmml" xref="A1.T2.9.9.1.m1.1.1.2.2">𝑃</ci><ci id="A1.T2.9.9.1.m1.1.1.2.3.cmml" xref="A1.T2.9.9.1.m1.1.1.2.3">𝑖</ci></apply><ci id="A1.T2.9.9.1.m1.1.1.3.cmml" xref="A1.T2.9.9.1.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.9.9.1.m1.1c">P^{i}_{l}</annotation></semantics></math></th>
<td id="A1.T2.10.10.2" class="ltx_td ltx_align_center">Local prompt pool of client <math id="A1.T2.10.10.2.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="A1.T2.10.10.2.m1.1a"><mi id="A1.T2.10.10.2.m1.1.1" xref="A1.T2.10.10.2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="A1.T2.10.10.2.m1.1b"><ci id="A1.T2.10.10.2.m1.1.1.cmml" xref="A1.T2.10.10.2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.10.10.2.m1.1c">i</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.12.12" class="ltx_tr">
<th id="A1.T2.11.11.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.11.11.1.m1.1" class="ltx_Math" alttext="\mathcal{T}_{i}" display="inline"><semantics id="A1.T2.11.11.1.m1.1a"><msub id="A1.T2.11.11.1.m1.1.1" xref="A1.T2.11.11.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.T2.11.11.1.m1.1.1.2" xref="A1.T2.11.11.1.m1.1.1.2.cmml">𝒯</mi><mi id="A1.T2.11.11.1.m1.1.1.3" xref="A1.T2.11.11.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.T2.11.11.1.m1.1b"><apply id="A1.T2.11.11.1.m1.1.1.cmml" xref="A1.T2.11.11.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.11.11.1.m1.1.1.1.cmml" xref="A1.T2.11.11.1.m1.1.1">subscript</csymbol><ci id="A1.T2.11.11.1.m1.1.1.2.cmml" xref="A1.T2.11.11.1.m1.1.1.2">𝒯</ci><ci id="A1.T2.11.11.1.m1.1.1.3.cmml" xref="A1.T2.11.11.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.11.11.1.m1.1c">\mathcal{T}_{i}</annotation></semantics></math></th>
<td id="A1.T2.12.12.2" class="ltx_td ltx_align_center">Task sequence of client <math id="A1.T2.12.12.2.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="A1.T2.12.12.2.m1.1a"><mi id="A1.T2.12.12.2.m1.1.1" xref="A1.T2.12.12.2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="A1.T2.12.12.2.m1.1b"><ci id="A1.T2.12.12.2.m1.1.1.cmml" xref="A1.T2.12.12.2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.12.12.2.m1.1c">i</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.15.15" class="ltx_tr">
<th id="A1.T2.13.13.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.13.13.1.m1.1" class="ltx_Math" alttext="T^{n}_{i}" display="inline"><semantics id="A1.T2.13.13.1.m1.1a"><msubsup id="A1.T2.13.13.1.m1.1.1" xref="A1.T2.13.13.1.m1.1.1.cmml"><mi id="A1.T2.13.13.1.m1.1.1.2.2" xref="A1.T2.13.13.1.m1.1.1.2.2.cmml">T</mi><mi id="A1.T2.13.13.1.m1.1.1.3" xref="A1.T2.13.13.1.m1.1.1.3.cmml">i</mi><mi id="A1.T2.13.13.1.m1.1.1.2.3" xref="A1.T2.13.13.1.m1.1.1.2.3.cmml">n</mi></msubsup><annotation-xml encoding="MathML-Content" id="A1.T2.13.13.1.m1.1b"><apply id="A1.T2.13.13.1.m1.1.1.cmml" xref="A1.T2.13.13.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.13.13.1.m1.1.1.1.cmml" xref="A1.T2.13.13.1.m1.1.1">subscript</csymbol><apply id="A1.T2.13.13.1.m1.1.1.2.cmml" xref="A1.T2.13.13.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T2.13.13.1.m1.1.1.2.1.cmml" xref="A1.T2.13.13.1.m1.1.1">superscript</csymbol><ci id="A1.T2.13.13.1.m1.1.1.2.2.cmml" xref="A1.T2.13.13.1.m1.1.1.2.2">𝑇</ci><ci id="A1.T2.13.13.1.m1.1.1.2.3.cmml" xref="A1.T2.13.13.1.m1.1.1.2.3">𝑛</ci></apply><ci id="A1.T2.13.13.1.m1.1.1.3.cmml" xref="A1.T2.13.13.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.13.13.1.m1.1c">T^{n}_{i}</annotation></semantics></math></th>
<td id="A1.T2.15.15.3" class="ltx_td ltx_align_center">The task of client <math id="A1.T2.14.14.2.m1.1" class="ltx_Math" alttext="i" display="inline"><semantics id="A1.T2.14.14.2.m1.1a"><mi id="A1.T2.14.14.2.m1.1.1" xref="A1.T2.14.14.2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="A1.T2.14.14.2.m1.1b"><ci id="A1.T2.14.14.2.m1.1.1.cmml" xref="A1.T2.14.14.2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.14.14.2.m1.1c">i</annotation></semantics></math> at incremental state <math id="A1.T2.15.15.3.m2.1" class="ltx_Math" alttext="n" display="inline"><semantics id="A1.T2.15.15.3.m2.1a"><mi id="A1.T2.15.15.3.m2.1.1" xref="A1.T2.15.15.3.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="A1.T2.15.15.3.m2.1b"><ci id="A1.T2.15.15.3.m2.1.1.cmml" xref="A1.T2.15.15.3.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.15.15.3.m2.1c">n</annotation></semantics></math>
</td>
</tr>
<tr id="A1.T2.16.16" class="ltx_tr">
<th id="A1.T2.16.16.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.16.16.1.m1.1" class="ltx_Math" alttext="\mathcal{V}" display="inline"><semantics id="A1.T2.16.16.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="A1.T2.16.16.1.m1.1.1" xref="A1.T2.16.16.1.m1.1.1.cmml">𝒱</mi><annotation-xml encoding="MathML-Content" id="A1.T2.16.16.1.m1.1b"><ci id="A1.T2.16.16.1.m1.1.1.cmml" xref="A1.T2.16.16.1.m1.1.1">𝒱</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.16.16.1.m1.1c">\mathcal{V}</annotation></semantics></math></th>
<td id="A1.T2.16.16.2" class="ltx_td ltx_align_center">The pre-trained ViT</td>
</tr>
<tr id="A1.T2.17.17" class="ltx_tr">
<th id="A1.T2.17.17.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r"><math id="A1.T2.17.17.1.m1.1" class="ltx_Math" alttext="E" display="inline"><semantics id="A1.T2.17.17.1.m1.1a"><mi id="A1.T2.17.17.1.m1.1.1" xref="A1.T2.17.17.1.m1.1.1.cmml">E</mi><annotation-xml encoding="MathML-Content" id="A1.T2.17.17.1.m1.1b"><ci id="A1.T2.17.17.1.m1.1.1.cmml" xref="A1.T2.17.17.1.m1.1.1">𝐸</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.17.17.1.m1.1c">E</annotation></semantics></math></th>
<td id="A1.T2.17.17.2" class="ltx_td ltx_align_center">Embedding layer</td>
</tr>
<tr id="A1.T2.18.18" class="ltx_tr">
<th id="A1.T2.18.18.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b ltx_border_r"><math id="A1.T2.18.18.1.m1.1" class="ltx_Math" alttext="\mathcal{H}" display="inline"><semantics id="A1.T2.18.18.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="A1.T2.18.18.1.m1.1.1" xref="A1.T2.18.18.1.m1.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="A1.T2.18.18.1.m1.1b"><ci id="A1.T2.18.18.1.m1.1.1.cmml" xref="A1.T2.18.18.1.m1.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T2.18.18.1.m1.1c">\mathcal{H}</annotation></semantics></math></th>
<td id="A1.T2.18.18.2" class="ltx_td ltx_align_center ltx_border_b">The classification head</td>
</tr>
</tbody>
</table>
</figure>
</section>
<section id="A2" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix 2 </span>Sensitivity Analysis</h2>

<div id="A2.p1" class="ltx_para">
<p id="A2.p1.1" class="ltx_p">As illustrated in <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_sensitivity_1</span>, the aggregation of global prompts has improved the performance of both global prompts and local prompts. <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_afg</span> shows the performance improvement of coarse-grained global prompts evaluated with test accuracy (%) after the aggregation of global prompts. <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_afl</span> illustrates the performance improvement of fine-grained local prompts after the aggregation of global prompts. We can find that both improvements are robust to different values of prompt pool size and prompt length.</p>
</div>
<figure id="A2.F8.sf1" class="ltx_figure">
</figure>
<div id="A2.p2" class="ltx_para">
<p id="A2.p2.1" class="ltx_p"><span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_sensitivity_2</span> illustrates the temporal knowledge retention of the global model and local models. As illustrated in the left sub-figure <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_krtg</span>, the performance of global spatial knowledge retention exhibits robustness to different values of prompt length and prompt pool size, which means FedMGP achieves spatial-temporal transfer effectively. From <span class="ltx_ref ltx_refmacro_autoref ltx_missing_label ltx_ref_self">LABEL:fig_krtl</span>, we can conclude that different values of prompt pool size and prompt length have little effect on local spatial knowledge retention, indicating that FedMGP mitigates temporal catastrophic forgetting. It implies utilizing multi-granularity prompts is capable of training a generalized global model as well as personalized local models.</p>
</div>
<figure id="A2.F8.sf2" class="ltx_figure">
</figure>
</section>
<section id="A3" class="ltx_appendix">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix 3 </span>Baselines</h2>

<div id="A3.p1" class="ltx_para">
<p id="A3.p1.1" class="ltx_p"><span id="A3.p1.1.1" class="ltx_text ltx_font_bold">FedAvg</span> <cite class="ltx_cite ltx_citemacro_citep">(McMahan et al<span class="ltx_text">.</span>, <a href="#bib.bib32" title="" class="ltx_ref">2017</a>)</cite>: FedAvg is a fundamental algorithm in federated learning. It works by first distributing a global model to multiple clients. Each client trains the model locally using its own data for a few epochs. Then, the clients send their locally updated models back to a central server. The server aggregates these local models by computing their weighted average to update the global model. This process is repeated for several rounds until the global model converges.
<br class="ltx_break"><span id="A3.p1.1.2" class="ltx_text ltx_font_bold">FedEWC</span> <cite class="ltx_cite ltx_citemacro_citep">(Kirkpatrick et al<span class="ltx_text">.</span>, <a href="#bib.bib19" title="" class="ltx_ref">2017</a>)</cite>: a combination of FedAvg and EWC, which is a commonly used baseline in PFL and FCL. EWC is a regularization-based CL method, mitigating forgetting by penalizing the changes of important parameters of the previous tasks.
<br class="ltx_break"><span id="A3.p1.1.3" class="ltx_text ltx_font_bold">FedProx</span> <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a href="#bib.bib24" title="" class="ltx_ref">2020</a>)</cite>: a heterogeneous and static FL method. It smooths data heterogeneity by adding a proximal term in the local objective.
<br class="ltx_break"><span id="A3.p1.1.4" class="ltx_text ltx_font_bold">GLFC</span> (Glocal Local Forgetting Compensation) <cite class="ltx_cite ltx_citemacro_citep">(Dong et al<span class="ltx_text">.</span>, <a href="#bib.bib8" title="" class="ltx_ref">2022</a>)</cite>: a synchronous FCIL method. GLFC designs a class-aware gradient compensation loss and a class-semantic relation distillation loss to mitigate forgetting and distill consistent inter-class relations across tasks. A proxy server is implemented to select the optimal previous global model to assist the class-semantic relation distillation and a prototype gradient-based communication mechanism is developed to protect data privacy.
<br class="ltx_break"><span id="A3.p1.1.5" class="ltx_text ltx_font_bold">FedViT</span> <cite class="ltx_cite ltx_citemacro_citep">(Dosovitskiy et al<span class="ltx_text">.</span>, <a href="#bib.bib9" title="" class="ltx_ref">2020</a>)</cite>: a hybrid method of ViT and FedAvg. The global aggregation is performed by computing the average weights of the classification heads.
<br class="ltx_break"><span id="A3.p1.1.6" class="ltx_text ltx_font_bold">FedL2P</span> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib42" title="" class="ltx_ref">2022b</a>)</cite>: a hybrid method of L2P and FedAvg. L2P is a prompt-based CL method, which applies learnable task-specific prompts to mitigate forgetting.
<br class="ltx_break"><span id="A3.p1.1.7" class="ltx_text ltx_font_bold">FedDualP</span> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a href="#bib.bib41" title="" class="ltx_ref">2022a</a>)</cite>: a hybrid method of DualPrompt and FedAvg. DualPrompt, a prompt-based CL method derived from L2P, decouples the learnable prompts into general and expert prompts, encoding task-invariant and task-specific knowledge, respectively.</p>
</div>
</section>
</article>
</div>
<div class="ar5iv-footer"><a href="/html/2407.00112" class="ar5iv-nav-button ar5iv-nav-button-prev">◄</a>
    <a class="ar5iv-home-button" href="/"><img height="40" alt="ar5iv homepage" src="/assets/ar5iv.png"></a>
    <a href="/feeling_lucky" class="ar5iv-text-button">Feeling<br>lucky?</a>
    <a href="/log/2407.00113" class="ar5iv-text-button ar5iv-severity-warning">Conversion<br>report</a>
    <a class="ar5iv-text-button" target="_blank" href="https://github.com/dginev/ar5iv/issues/new?template=improve-article--arxiv-id-.md&title=Improve+article+2407.00113">Report<br>an issue</a>
    <a href="https://arxiv.org/abs/2407.00113" class="ar5iv-text-button arxiv-ui-theme">View&nbsp;original<br>on&nbsp;arXiv</a><a href="/html/2407.00114" class="ar5iv-nav-button ar5iv-nav-button-next">►</a>
</div><footer class="ltx_page_footer">
<a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle ar5iv color scheme"><span class="color-scheme-icon"></span></a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/license" target="_blank">Copyright</a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/policies/privacy_policy" target="_blank">Privacy Policy</a>

<div class="ltx_page_logo">Generated  on Mon Aug  5 18:12:44 2024 by <a target="_blank" href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>

    <script>
      var canMathML = typeof(MathMLElement) == "function";
      if (!canMathML) {
        var body = document.querySelector("body");
        body.firstElementChild.setAttribute('style', 'opacity: 0;');
        var loading = document.createElement("div");
        loading.setAttribute("id", "mathjax-loading-spinner");
        var message = document.createElement("div");
        message.setAttribute("id", "mathjax-loading-message");
        message.innerText = "Typesetting Equations...";
        body.prepend(loading);
        body.prepend(message);

        var el = document.createElement("script");
        el.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
        document.querySelector("head").appendChild(el);

        window.MathJax = {
          startup: {
            pageReady: () => {
              return MathJax.startup.defaultPageReady().then(() => {
                body.removeChild(loading);
                body.removeChild(message);
                body.firstElementChild.removeAttribute('style');
              }); } } };
      }
    </script>
    <script>
    // Auxiliary function, building the preview feature when
    // an inline citation is clicked
    function clicked_cite(e) {
      e.preventDefault();
      let cite = this.closest('.ltx_cite');
      let next = cite.nextSibling;
      if (next && next.nodeType == Node.ELEMENT_NODE && next.getAttribute('class') == "ar5iv-bibitem-preview") {
        next.remove();
        return; }
      // Before adding a preview modal,
      // cleanup older previews, in case they're still open
      document.querySelectorAll('span.ar5iv-bibitem-preview').forEach(function(node) {
        node.remove();
      })

      // Create the preview
      preview = document.createElement('span');
      preview.setAttribute('class','ar5iv-bibitem-preview');
      let target = document.getElementById(this.getAttribute('href').slice(1));
      target.childNodes.forEach(function (child) {
        preview.append(child.cloneNode(true));
      });
      let close_x = document.createElement('button');
      close_x.setAttribute("aria-label","Close modal for bibliography item preview");
      close_x.textContent = "×";
      close_x.setAttribute('class', 'ar5iv-button-close-preview');
      close_x.setAttribute('onclick','this.parentNode.remove()');
      preview.append(close_x);
      preview.querySelectorAll('.ltx_tag_bibitem').forEach(function(node) {
        node.remove();
      });
      cite.parentNode.insertBefore(preview, cite.nextSibling);
      return;
    }
    // Global Document initialization:
    // - assign the preview feature to all inline citation links
    document.querySelectorAll(".ltx_cite .ltx_ref").forEach(function (link) {
      link.addEventListener("click", clicked_cite);
    });
    </script>
    </body>
</html>
