<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation</title>
<!--Generated on Wed Oct  2 14:09:39 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.01573v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S1" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S2" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S2.SS1" title="In 2 Related Work ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Test-time Adaptation (TTA)</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S2.SS2" title="In 2 Related Work ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Prompt Learning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Methodology</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.SS1" title="In 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Preliminary and Problem Definition</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.SS2" title="In 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Input Decorator</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.SS3" title="In 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Cross-Attention Prompt Modulator</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.SS4" title="In 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Alternating Momentum Updating Strategy</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.SS1" title="In 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Experimental Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.SS2" title="In 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Performance Comparison</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.SS3" title="In 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Ablation study.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.SS1" title="In 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>The effect of initialization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.SS2" title="In 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Convergence of the CAPM</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.SS3" title="In 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Extension and limitations</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S6" title="In PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<div class="ltx_para" id="p1">
<span class="ltx_ERROR undefined" id="p1.1">\useunder</span>
<p class="ltx_p" id="p1.2"><span class="ltx_text ltx_ulem_uline" id="p1.2.1"></span><span class="ltx_ERROR undefined" id="p1.2.2">\ul</span>
<span class="ltx_ERROR undefined" id="p1.2.3">\FAILED</span>
<span class="ltx_ERROR undefined" id="p1.2.4">\FAILED</span>
</p>
</div>
<h1 class="ltx_title ltx_title_document">PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Chuyan Zhang
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> Hao Zheng
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> Xin You
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> Yefeng Zheng
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> <span class="ltx_ERROR undefined" id="id1.1.id1">\IEEEmembership</span>Fellow, IEEE
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> and Yun Gu
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname"> <span class="ltx_ERROR undefined" id="id2.1.id1">\IEEEmembership</span>Member, IEEE
</span><span class="ltx_author_notes">This work is supported in part by Shanghai Municipal of Science and Technology Project, under Grant 20JC1419500 and Grant 20DZ2220400. (Corresponding author: Yun Gu.)Chuyan Zhang, Xin You and Yun Gu are with the Institute of Medical Robotics, Shanghai Jiao Tong University, Shanghai, China. (Email: zhangchuyan, sjtu_youxin, geron762@sjtu.edu.cn)Hao Zheng and Yefeng Zheng are with the Jarvis Research Center, Tencent YouTu Lab, Shenzhen, China. (Email: howzheng, yefengzheng@tencent.com)</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id3.id1">Test-time adaptation (TTA) has emerged as a promising paradigm to handle the domain shifts at test time for medical images from different institutions without using extra training data.
However, existing TTA solutions for segmentation tasks suffer from (1) dependency on modifying the source training stage and access to source priors or (2) lack of emphasis on shape-related semantic knowledge that is crucial for segmentation tasks.
<span class="ltx_text" id="id3.id1.1" style="color:#000000;">
Recent research on visual prompt learning achieves source-relaxed adaptation by extended parameter space but still neglects the full utilization of semantic features, thus motivating our work on knowledge-enriched deep prompt learning.
Beyond the general concern of image style shifts, we reveal that shape variability is another crucial factor causing the performance drop. To address this issue, we propose a TTA framework called PASS (Prompting to Adapt Styles and Semantic shapes), which jointly learns two types of prompts: the input-space prompt to reformulate the style of the test image to fit into the pretrained model and the semantic-aware prompts to bridge high-level shape discrepancy across domains.
Instead of naively imposing a fixed prompt, we introduce an input decorator to generate the self-regulating visual prompt conditioned on the input data.
To retrieve the knowledge representations and customize target-specific shape prompts for each test sample, we propose a cross-attention prompt modulator, which performs interaction between target representations and an enriched shape prompt bank.</span>
Extensive experiments demonstrate the superior performance of PASS over state-of-the-art methods on multiple medical image segmentation datasets. The code is available at <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/EndoluminalSurgicalVision-IMR/PASS" title="">https://github.com/EndoluminalSurgicalVision-IMR/PASS</a>.</p>
</div>
<div class="ltx_para" id="p2">
<span class="ltx_ERROR undefined" id="p2.1">{IEEEkeywords}</span>
<p class="ltx_p" id="p2.2">test-time adaptation, prompt learning, transfer learning</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<span class="ltx_ERROR undefined" id="S1.p1.1">\IEEEPARstart</span>
<p class="ltx_p" id="S1.p1.2">Semantic segmentation is a critical task in the realm of medical image diagnosis, enabling the precise delineation of anatomical structures.
Domain adaptation (DA) techniques<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib1" title="">1</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib2" title="">2</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib3" title="">3</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib4" title="">4</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib5" title="">5</a>]</cite> have propelled deep-learning medical segmentation models into the clinical practice, overcoming the challenge of ubiquitous distribution shifts induced by diverse devices and scanning protocols. In real-world scenarios where only pretrained model weights are accessible (due to issues such as data privacy), test-time adaptation (TTA)<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>]</cite> emerges as a promising alternative to DA. TTA emphasizes learning directly from few unlabeled target test data, while DA methods typically require access to source data<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib4" title="">4</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib2" title="">2</a>]</cite> or extensive target training data<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib3" title="">3</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib5" title="">5</a>]</cite>.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="544" id="S1.F1.g1" src="x1.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>The relationship between source-to-target performance and shape similarity during adaptation in multi-site MRI prostate (one source <math alttext="\rightarrow" class="ltx_Math" display="inline" id="S1.F1.3.m1.1"><semantics id="S1.F1.3.m1.1b"><mo id="S1.F1.3.m1.1.1" stretchy="false" xref="S1.F1.3.m1.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="S1.F1.3.m1.1c"><ci id="S1.F1.3.m1.1.1.cmml" xref="S1.F1.3.m1.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.3.m1.1d">\rightarrow</annotation><annotation encoding="application/x-llamapun" id="S1.F1.3.m1.1e">→</annotation></semantics></math> five target datasets: BMC/HK/BIDMC/I2CVB/UCL) and optic disc-cup (one source <math alttext="\rightarrow" class="ltx_Math" display="inline" id="S1.F1.4.m2.1"><semantics id="S1.F1.4.m2.1b"><mo id="S1.F1.4.m2.1.1" stretchy="false" xref="S1.F1.4.m2.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="S1.F1.4.m2.1c"><ci id="S1.F1.4.m2.1.1.cmml" xref="S1.F1.4.m2.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.4.m2.1d">\rightarrow</annotation><annotation encoding="application/x-llamapun" id="S1.F1.4.m2.1e">→</annotation></semantics></math> three target datasets: BASE1-3) image segmentation. We use the moment descriptor defined in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite> to represent the shape of objects. The average cosine similarity of source and target shape descriptors is computed. For the same source model, the transfer performance on different target datasets is highly correlated with source-target shape similarity (resembling polygons in (a)-(b)).</figcaption>
</figure>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">A line of TTA approaches<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib11" title="">11</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib13" title="">13</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib14" title="">14</a>]</cite> constructed self-supervised auxiliary branches, such as auto-encoders<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib13" title="">13</a>]</cite>, to drive the adaptation of pretrained models to target domains. These methods entail altering the pretraining paradigm. However, in practice, it is critical to isolate the source training and adaptation stages due to regulatory and privacy considerations. Several unsupervised solutions have been present to relieve the dependency on intricate source training: (1) <span class="ltx_text ltx_font_bold" id="S1.p2.1.1">Model-driven TTA methods</span>, which harness task-agnostic knowledge from the pretrained model via entropy minimization<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib16" title="">16</a>]</cite>, transformation invariance<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib17" title="">17</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite> and model ensembling<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib16" title="">16</a>]</cite>, or align domain statistics stored in Batch Normalization (BN) layers<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>; (2) <span class="ltx_text ltx_font_bold" id="S1.p2.1.2">Source-driven TTA methods</span>, which use manually defined semantic-relevant priors from source data as regularisation for the adaption stage, including class-ratio prior<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib3" title="">3</a>]</cite> and shape prior<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib21" title="">21</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">Drawing inspiration from the success of prompt tuning <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib22" title="">22</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib23" title="">23</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib24" title="">24</a>]</cite> in enabling a pretrained model to solve a new task without sacrificing previously learnt knowledge, a set of <span class="ltx_text ltx_font_bold" id="S1.p3.1.1">target-driven</span> domain adaptation methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> have been explored to capture information from target images themselves via prepending visual prompts to the input images. They assume that differences in texture styles are accountable for cross-domain shifts and thus propose to modify the input distributions via learnable input-space prompts. These researches have shown that, beyond the proven advantages in efficiently tuning large-scale foundation models to new tasks with sufficient labelled target data<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib22" title="">22</a>]</cite>, prompt learning also performs well in unsupervised domain adaptation of compact models for specific semantic tasks with unseen label spaces.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1"><span class="ltx_text" id="S1.p4.1.1" style="color:#000000;">However, segmentation tasks pose unique obstacles in applying existing TTA methods, which involve maintaining the structured shape of predictions.
There are often cases that deviate from the normative shape distribution in terms of position, size or appearance, which are at risk of erroneous predictions. Some descriptors have been proposed to quantify differences in shape across domains <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">1</span></a> implies that cross-domain shape similarity exhibits a high correlation with the transfer performance across multiple datasets. This proves that shape variance is also a substantial factor contributing to the adaptation performance degradation for segmentation tasks.
Most TTA solutions only focus on mitigating low-level domain shift in the input space<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> or tightening the probability manifold in the output space<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib16" title="">16</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib17" title="">17</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>.
The lack of explicit constraints on the enriched shape representations in the latent space of networks leads to unstable adaptations or even model collapse.
Additionally, some source-driven approaches <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib3" title="">3</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib21" title="">21</a>]</cite> impose source shape priors to supervise the target objects. Despite the advantages of explicit prior constraints for stabilizing adaptation, data with out-of-distribution shape patterns may still lead to error accumulation.</span></p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">In this paper, we propose a TTA framework called <span class="ltx_text ltx_font_bold" id="S1.p5.1.1">Prompting</span>
to <span class="ltx_text ltx_font_bold" id="S1.p5.1.2">A</span>dapt <span class="ltx_text ltx_font_bold" id="S1.p5.1.3">S</span>tyles and <span class="ltx_text ltx_font_bold" id="S1.p5.1.4">S</span>emantic shapes (PASS) to enhance target-specific shape representations. We first introduce the concept of shape prompts into target-driven TTA.
Specifically, we add learnable shape prompts upon the latent features to customize knowledge from the source model towards the target data. Considering the intra-domain variance, we design a cross-attention prompt modulator to assemble the most related shape prompts from an enriched domain-common prompt bank for every single test sample.
Besides, we tackle the commonly-recognized texture style shift <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> by constructing an input decorator that prompts the source model with the input-specific visual perturbation.
Different from the same visual prompt for the whole domain in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> and the frequency-domain prompt that focuses on a small range of low-frequency domain <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>, the proposed input decorator dynamically generates a comprehensive visual prompt for each data.
To avoid error accumulation in the continually online TTA setting, we further propose an alternating momentum updating (AMU) strategy. The intuition behind AMU is that there should be a buffer to store historical knowledge and an online model to fit a particular sample.
For stable adaptation, we present a momentum decay factor to ensure that the later samples have less impact on the buffer.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">Our contributions are summarized as follows:
(1) Except for the well-recognized style shift, we first highlight the issue of shape variability in the test-time adaptation of segmentation models. Without restrictions on source training or access to the source domain, we propose a TTA method named PASS To mitigate both the style and shape inconsistency across domains.
(2) An input decorator is introduced to reformulate the input data via instance-aware style prompt and a cross-attention prompt modulator is proposed to selectively customize the specific shape prompt for each test sample from an enriched shape prompt bank.
Cooperatively, a novel alternating momentum updating strategy is proposed to mitigate overfitting to the online test data and improve the learning capacity of prompts.
(3) Extensive experimental results demonstrate that our method with a few trainable parameters could achieve state-of-the-art performances in both online and offline TTA settings for multi-center optic disc/cup and magnetic resonance imaging (MRI) prostate segmentation tasks.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="351" id="S2.F2.g1" src="x2.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>An overview of the proposed PASS approach, comprising three components: (1) an input decorator to reduce the style shift, (2) a cross-attention prompt modulator to mitigate the shape inconsistency,
and (3) an alternating momentum parameter updating strategy with the teacher/student framework to avoid error accumulation during the adaptation stage. The weights of the teacher model are updated by the exponential moving average (EMA) with a decay factor from the online updating student model. For each new test data, the student model is reset by the teacher model to recover the historical knowledge and is adapted to the given sample.</figcaption>
</figure>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Test-time Adaptation (TTA)</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">TTA aims to reduce the performance gap when deploying a source model on another target domain by relying solely on unlabeled test data. To cope with the absence of labels, numerous works <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib11" title="">11</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib13" title="">13</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib14" title="">14</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib27" title="">27</a>]</cite> introduced self-supervised auxiliary tasks to drive the adaptation stage. Especially for segmentation tasks, auto-encoders are preferable for capturing fine-grained representations <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib9" title="">9</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib13" title="">13</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib27" title="">27</a>]</cite>. However, these approaches necessitate customized pretraining stages and even extra pretrained models, deviating from the original intent of performing flexible adaptation only during test time. Another line of work seeks reasonable unsupervised loss functions. TENT-based methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib16" title="">16</a>]</cite> utilize entropy-based losses to increase the confidence of model predictions. Nguyen <em class="ltx_emph ltx_font_italic" id="S2.SS1.p1.1.1">et al.</em> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib17" title="">17</a>]</cite> and Zhang <em class="ltx_emph ltx_font_italic" id="S2.SS1.p1.1.2">et al.</em><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite> imposed the invariance regularization on model predictions under input transformations. Wang <em class="ltx_emph ltx_font_italic" id="S2.SS1.p1.1.3">et al.</em> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite> and Wu <em class="ltx_emph ltx_font_italic" id="S2.SS1.p1.1.4">et al.</em> <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib16" title="">16</a>]</cite> ensembled multiple models to reduce the uncertainty and improve the training stability. Moreover, Batch Normalization (BN) layers also provide a shortcut to align the distributions <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>. The aforementioned methods are task-agnostic and neglect the inherent characteristics of segmentation tasks. To maintain the structural properties of objects, some methods manually extract priors from the source data annotations to constrain the target predictions, including class-ratio prior <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib3" title="">3</a>]</cite> and shape prior <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib21" title="">21</a>]</cite>. This paper focuses on studying TTA for segmentation tasks without modifying the pretraining stage and the access to source data. To further tackle the shape inconsistency that contributes to the performance drop during adaptation, our PASS learns target-specific shape information for every single test sample.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Prompt Learning</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Prompting was first proposed in the form of text queries to instruct a large-scale language model to perform various downstream tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib22" title="">22</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib23" title="">23</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib28" title="">28</a>]</cite>. Recently, prompt tuning <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib22" title="">22</a>]</cite> has been explored to boost the generalizability of pretrained vision models. For example, VPT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib22" title="">22</a>]</cite> prepends trainable visual prompts to input images when transferring the frozen pretrained backbone to a new task. The deficiency in VPT lies in its limited adaptation capability of adding the same prompts to all inputs, regardless of data diversity. To further improve the effectiveness of visual prompts, some subnetworks are built to produce dynamic prompts <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib29" title="">29</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib30" title="">30</a>]</cite>. Apart from the fine-tuning paradigm, a few works attempt to introduce learnable prompts in bridging the distribution gap for domain generalization <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib24" title="">24</a>]</cite> and domain adaptation <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib31" title="">31</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>, where input-space prompts are added to the image/text and unsupervised losses are adopted to optimize the prompts. By contrast, we employ test-time adaptive prompts in both input space and latent space to mitigate the input distribution gap and shape inconsistency for TTA in medical image segmentation.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Methodology</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Preliminary and Problem Definition</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.7"><span class="ltx_text ltx_font_bold" id="S3.SS1.p1.7.1">Test-time training paradigm.</span> In domain adaptive segmentation, let <math alttext="\mathit{X}^{s}/\mathit{X}^{t}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><mrow id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><msup id="S3.SS1.p1.1.m1.1.1.2" xref="S3.SS1.p1.1.m1.1.1.2.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2.2" xref="S3.SS1.p1.1.m1.1.1.2.2.cmml">X</mi><mi id="S3.SS1.p1.1.m1.1.1.2.3" xref="S3.SS1.p1.1.m1.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.1.m1.1.1.1" xref="S3.SS1.p1.1.m1.1.1.1.cmml">/</mo><msup id="S3.SS1.p1.1.m1.1.1.3" xref="S3.SS1.p1.1.m1.1.1.3.cmml"><mi id="S3.SS1.p1.1.m1.1.1.3.2" xref="S3.SS1.p1.1.m1.1.1.3.2.cmml">X</mi><mi id="S3.SS1.p1.1.m1.1.1.3.3" xref="S3.SS1.p1.1.m1.1.1.3.3.cmml">t</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><divide id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1.1"></divide><apply id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.2.1.cmml" xref="S3.SS1.p1.1.m1.1.1.2">superscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2.2">𝑋</ci><ci id="S3.SS1.p1.1.m1.1.1.2.3.cmml" xref="S3.SS1.p1.1.m1.1.1.2.3">𝑠</ci></apply><apply id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.3.1.cmml" xref="S3.SS1.p1.1.m1.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.3.2.cmml" xref="S3.SS1.p1.1.m1.1.1.3.2">𝑋</ci><ci id="S3.SS1.p1.1.m1.1.1.3.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">\mathit{X}^{s}/\mathit{X}^{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_X start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT / italic_X start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT</annotation></semantics></math> denote the source/target input space, and <math alttext="\mathit{Y}^{s}/\mathit{Y}^{t}" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><mrow id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml"><msup id="S3.SS1.p1.2.m2.1.1.2" xref="S3.SS1.p1.2.m2.1.1.2.cmml"><mi id="S3.SS1.p1.2.m2.1.1.2.2" xref="S3.SS1.p1.2.m2.1.1.2.2.cmml">Y</mi><mi id="S3.SS1.p1.2.m2.1.1.2.3" xref="S3.SS1.p1.2.m2.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.2.m2.1.1.1" xref="S3.SS1.p1.2.m2.1.1.1.cmml">/</mo><msup id="S3.SS1.p1.2.m2.1.1.3" xref="S3.SS1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS1.p1.2.m2.1.1.3.2" xref="S3.SS1.p1.2.m2.1.1.3.2.cmml">Y</mi><mi id="S3.SS1.p1.2.m2.1.1.3.3" xref="S3.SS1.p1.2.m2.1.1.3.3.cmml">t</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><apply id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1"><divide id="S3.SS1.p1.2.m2.1.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1.1"></divide><apply id="S3.SS1.p1.2.m2.1.1.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.2.1.cmml" xref="S3.SS1.p1.2.m2.1.1.2">superscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.2.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2.2">𝑌</ci><ci id="S3.SS1.p1.2.m2.1.1.2.3.cmml" xref="S3.SS1.p1.2.m2.1.1.2.3">𝑠</ci></apply><apply id="S3.SS1.p1.2.m2.1.1.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS1.p1.2.m2.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS1.p1.2.m2.1.1.3.2">𝑌</ci><ci id="S3.SS1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">\mathit{Y}^{s}/\mathit{Y}^{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_Y start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT / italic_Y start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT</annotation></semantics></math> be the source/target label space.
Given a segmentation model <math alttext="\mathcal{S}_{\psi^{*}}" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><msub id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.3.m3.1.1.2" xref="S3.SS1.p1.3.m3.1.1.2.cmml">𝒮</mi><msup id="S3.SS1.p1.3.m3.1.1.3" xref="S3.SS1.p1.3.m3.1.1.3.cmml"><mi id="S3.SS1.p1.3.m3.1.1.3.2" xref="S3.SS1.p1.3.m3.1.1.3.2.cmml">ψ</mi><mo id="S3.SS1.p1.3.m3.1.1.3.3" xref="S3.SS1.p1.3.m3.1.1.3.3.cmml">∗</mo></msup></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><apply id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.1.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS1.p1.3.m3.1.1.2.cmml" xref="S3.SS1.p1.3.m3.1.1.2">𝒮</ci><apply id="S3.SS1.p1.3.m3.1.1.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.1.1.3.1.cmml" xref="S3.SS1.p1.3.m3.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.3.m3.1.1.3.2.cmml" xref="S3.SS1.p1.3.m3.1.1.3.2">𝜓</ci><times id="S3.SS1.p1.3.m3.1.1.3.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3.3"></times></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">\mathcal{S}_{\psi^{*}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">caligraphic_S start_POSTSUBSCRIPT italic_ψ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> pretrained on source domain(s) <math alttext="\mathit{D}^{s}=\{(x^{s},y^{s})\mid x^{s}\in\mathit{X}^{s},y^{s}\in\mathit{Y}^{%
s}\}" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.2"><semantics id="S3.SS1.p1.4.m4.2a"><mrow id="S3.SS1.p1.4.m4.2.2" xref="S3.SS1.p1.4.m4.2.2.cmml"><msup id="S3.SS1.p1.4.m4.2.2.4" xref="S3.SS1.p1.4.m4.2.2.4.cmml"><mi id="S3.SS1.p1.4.m4.2.2.4.2" xref="S3.SS1.p1.4.m4.2.2.4.2.cmml">D</mi><mi id="S3.SS1.p1.4.m4.2.2.4.3" xref="S3.SS1.p1.4.m4.2.2.4.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.2.2.3" xref="S3.SS1.p1.4.m4.2.2.3.cmml">=</mo><mrow id="S3.SS1.p1.4.m4.2.2.2.2" xref="S3.SS1.p1.4.m4.2.2.2.3.cmml"><mo id="S3.SS1.p1.4.m4.2.2.2.2.3" stretchy="false" xref="S3.SS1.p1.4.m4.2.2.2.3.1.cmml">{</mo><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml"><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.2.3" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml">(</mo><msup id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.2.4" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml">,</mo><msup id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.2.5" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml">)</mo></mrow><mo fence="true" id="S3.SS1.p1.4.m4.2.2.2.2.4" lspace="0em" rspace="0em" xref="S3.SS1.p1.4.m4.2.2.2.3.1.cmml">∣</mo><mrow id="S3.SS1.p1.4.m4.2.2.2.2.2.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.3.cmml"><mrow id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.cmml"><msup id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.2.cmml">x</mi><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.1" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.1.cmml">∈</mo><msup id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.2.cmml">X</mi><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.SS1.p1.4.m4.2.2.2.2.2.2.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.3a.cmml">,</mo><mrow id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.cmml"><msup id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.1" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.1.cmml">∈</mo><msup id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.2" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.2.cmml">Y</mi><mi id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.3" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.3.cmml">s</mi></msup></mrow></mrow><mo id="S3.SS1.p1.4.m4.2.2.2.2.5" stretchy="false" xref="S3.SS1.p1.4.m4.2.2.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.2b"><apply id="S3.SS1.p1.4.m4.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2"><eq id="S3.SS1.p1.4.m4.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.3"></eq><apply id="S3.SS1.p1.4.m4.2.2.4.cmml" xref="S3.SS1.p1.4.m4.2.2.4"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.4.1.cmml" xref="S3.SS1.p1.4.m4.2.2.4">superscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.4.2.cmml" xref="S3.SS1.p1.4.m4.2.2.4.2">𝐷</ci><ci id="S3.SS1.p1.4.m4.2.2.4.3.cmml" xref="S3.SS1.p1.4.m4.2.2.4.3">𝑠</ci></apply><apply id="S3.SS1.p1.4.m4.2.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2"><csymbol cd="latexml" id="S3.SS1.p1.4.m4.2.2.2.3.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.3">conditional-set</csymbol><interval closure="open" id="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2"><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3">𝑠</ci></apply><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2">superscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.2">𝑦</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.2.3">𝑠</ci></apply></interval><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.2.2.3a.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.3">formulae-sequence</csymbol><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1"><in id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.1"></in><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2">superscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.2">𝑥</ci><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.2.3">𝑠</ci></apply><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.2">𝑋</ci><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.1.1.3.3">𝑠</ci></apply></apply><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2"><in id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.1"></in><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2">superscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.2.3">𝑠</ci></apply><apply id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3">superscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.2">𝑌</ci><ci id="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.2.2.2.2.3.3">𝑠</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.2c">\mathit{D}^{s}=\{(x^{s},y^{s})\mid x^{s}\in\mathit{X}^{s},y^{s}\in\mathit{Y}^{%
s}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.2d">italic_D start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT = { ( italic_x start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT ) ∣ italic_x start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT ∈ italic_X start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT ∈ italic_Y start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT }</annotation></semantics></math>, test-time adaptation (TTA) aims at adapting this model to perform well on a set of unlabeled test data in another target domain <math alttext="\mathit{D}^{t}=\{x^{t}_{i}\mid x^{t}_{i}\in\mathit{X}^{t},i=1,...,N^{t}\}" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.4"><semantics id="S3.SS1.p1.5.m5.4a"><mrow id="S3.SS1.p1.5.m5.4.4" xref="S3.SS1.p1.5.m5.4.4.cmml"><msup id="S3.SS1.p1.5.m5.4.4.4" xref="S3.SS1.p1.5.m5.4.4.4.cmml"><mi id="S3.SS1.p1.5.m5.4.4.4.2" xref="S3.SS1.p1.5.m5.4.4.4.2.cmml">D</mi><mi id="S3.SS1.p1.5.m5.4.4.4.3" xref="S3.SS1.p1.5.m5.4.4.4.3.cmml">t</mi></msup><mo id="S3.SS1.p1.5.m5.4.4.3" xref="S3.SS1.p1.5.m5.4.4.3.cmml">=</mo><mrow id="S3.SS1.p1.5.m5.4.4.2.2" xref="S3.SS1.p1.5.m5.4.4.2.3.cmml"><mo id="S3.SS1.p1.5.m5.4.4.2.2.3" stretchy="false" xref="S3.SS1.p1.5.m5.4.4.2.3.1.cmml">{</mo><msubsup id="S3.SS1.p1.5.m5.3.3.1.1.1" xref="S3.SS1.p1.5.m5.3.3.1.1.1.cmml"><mi id="S3.SS1.p1.5.m5.3.3.1.1.1.2.2" xref="S3.SS1.p1.5.m5.3.3.1.1.1.2.2.cmml">x</mi><mi id="S3.SS1.p1.5.m5.3.3.1.1.1.3" xref="S3.SS1.p1.5.m5.3.3.1.1.1.3.cmml">i</mi><mi id="S3.SS1.p1.5.m5.3.3.1.1.1.2.3" xref="S3.SS1.p1.5.m5.3.3.1.1.1.2.3.cmml">t</mi></msubsup><mo fence="true" id="S3.SS1.p1.5.m5.4.4.2.2.4" lspace="0em" rspace="0em" xref="S3.SS1.p1.5.m5.4.4.2.3.1.cmml">∣</mo><mrow id="S3.SS1.p1.5.m5.4.4.2.2.2.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.3.cmml"><mrow id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.cmml"><msubsup id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.cmml"><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.2.cmml">x</mi><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.3.cmml">i</mi><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.3.cmml">t</mi></msubsup><mo id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.1" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.1.cmml">∈</mo><msup id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.cmml"><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.2.cmml">X</mi><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.3.cmml">t</mi></msup></mrow><mo id="S3.SS1.p1.5.m5.4.4.2.2.2.2.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.3a.cmml">,</mo><mrow id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.cmml"><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.3.cmml">i</mi><mo id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.2.cmml">=</mo><mrow id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.2.cmml"><mn id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml">1</mn><mo id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.2.cmml">,</mo><mi id="S3.SS1.p1.5.m5.2.2" mathvariant="normal" xref="S3.SS1.p1.5.m5.2.2.cmml">…</mi><mo id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.2.cmml">,</mo><msup id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.cmml"><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.2" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.2.cmml">N</mi><mi id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.3" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.3.cmml">t</mi></msup></mrow></mrow></mrow><mo id="S3.SS1.p1.5.m5.4.4.2.2.5" stretchy="false" xref="S3.SS1.p1.5.m5.4.4.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.4b"><apply id="S3.SS1.p1.5.m5.4.4.cmml" xref="S3.SS1.p1.5.m5.4.4"><eq id="S3.SS1.p1.5.m5.4.4.3.cmml" xref="S3.SS1.p1.5.m5.4.4.3"></eq><apply id="S3.SS1.p1.5.m5.4.4.4.cmml" xref="S3.SS1.p1.5.m5.4.4.4"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.4.1.cmml" xref="S3.SS1.p1.5.m5.4.4.4">superscript</csymbol><ci id="S3.SS1.p1.5.m5.4.4.4.2.cmml" xref="S3.SS1.p1.5.m5.4.4.4.2">𝐷</ci><ci id="S3.SS1.p1.5.m5.4.4.4.3.cmml" xref="S3.SS1.p1.5.m5.4.4.4.3">𝑡</ci></apply><apply id="S3.SS1.p1.5.m5.4.4.2.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2"><csymbol cd="latexml" id="S3.SS1.p1.5.m5.4.4.2.3.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.3">conditional-set</csymbol><apply id="S3.SS1.p1.5.m5.3.3.1.1.1.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.3.3.1.1.1.1.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1">subscript</csymbol><apply id="S3.SS1.p1.5.m5.3.3.1.1.1.2.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.3.3.1.1.1.2.1.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1">superscript</csymbol><ci id="S3.SS1.p1.5.m5.3.3.1.1.1.2.2.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1.2.2">𝑥</ci><ci id="S3.SS1.p1.5.m5.3.3.1.1.1.2.3.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1.2.3">𝑡</ci></apply><ci id="S3.SS1.p1.5.m5.3.3.1.1.1.3.cmml" xref="S3.SS1.p1.5.m5.3.3.1.1.1.3">𝑖</ci></apply><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.2.2.2.3a.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.3">formulae-sequence</csymbol><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1"><in id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.1"></in><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2">subscript</csymbol><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2">superscript</csymbol><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.2">𝑥</ci><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.2.3">𝑡</ci></apply><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.2.3">𝑖</ci></apply><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.2">𝑋</ci><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.1.1.3.3">𝑡</ci></apply></apply><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2"><eq id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.2"></eq><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.3">𝑖</ci><list id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1"><cn id="S3.SS1.p1.5.m5.1.1.cmml" type="integer" xref="S3.SS1.p1.5.m5.1.1">1</cn><ci id="S3.SS1.p1.5.m5.2.2.cmml" xref="S3.SS1.p1.5.m5.2.2">…</ci><apply id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1">superscript</csymbol><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.2.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.2">𝑁</ci><ci id="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.3.cmml" xref="S3.SS1.p1.5.m5.4.4.2.2.2.2.2.1.1.1.3">𝑡</ci></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.4c">\mathit{D}^{t}=\{x^{t}_{i}\mid x^{t}_{i}\in\mathit{X}^{t},i=1,...,N^{t}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.4d">italic_D start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT = { italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∣ italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT , italic_i = 1 , … , italic_N start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT }</annotation></semantics></math>.
Formally, following the above notations and standard TTA paradigm, we optimize the target model <math alttext="\mathcal{T}" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml">𝒯</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><ci id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">𝒯</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">\mathcal{T}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">caligraphic_T</annotation></semantics></math> with an unsupervised test-time training loss function <math alttext="L_{tt}" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><msub id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml"><mi id="S3.SS1.p1.7.m7.1.1.2" xref="S3.SS1.p1.7.m7.1.1.2.cmml">L</mi><mrow id="S3.SS1.p1.7.m7.1.1.3" xref="S3.SS1.p1.7.m7.1.1.3.cmml"><mi id="S3.SS1.p1.7.m7.1.1.3.2" xref="S3.SS1.p1.7.m7.1.1.3.2.cmml">t</mi><mo id="S3.SS1.p1.7.m7.1.1.3.1" xref="S3.SS1.p1.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.7.m7.1.1.3.3" xref="S3.SS1.p1.7.m7.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><apply id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.7.m7.1.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1">subscript</csymbol><ci id="S3.SS1.p1.7.m7.1.1.2.cmml" xref="S3.SS1.p1.7.m7.1.1.2">𝐿</ci><apply id="S3.SS1.p1.7.m7.1.1.3.cmml" xref="S3.SS1.p1.7.m7.1.1.3"><times id="S3.SS1.p1.7.m7.1.1.3.1.cmml" xref="S3.SS1.p1.7.m7.1.1.3.1"></times><ci id="S3.SS1.p1.7.m7.1.1.3.2.cmml" xref="S3.SS1.p1.7.m7.1.1.3.2">𝑡</ci><ci id="S3.SS1.p1.7.m7.1.1.3.3.cmml" xref="S3.SS1.p1.7.m7.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">L_{tt}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{T_{\theta^{*}}}=\arg\min_{\theta}\mathbb{E}_{x^{t}\sim\mathit{D}^{t}}%
[L_{tt}(\mathcal{T}_{\theta}(x^{t}))]" class="ltx_Math" display="block" id="S3.E1.m1.1"><semantics id="S3.E1.m1.1a"><mrow id="S3.E1.m1.1.1" xref="S3.E1.m1.1.1.cmml"><msub id="S3.E1.m1.1.1.3" xref="S3.E1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.1.1.3.2" xref="S3.E1.m1.1.1.3.2.cmml">𝒯</mi><msup id="S3.E1.m1.1.1.3.3" xref="S3.E1.m1.1.1.3.3.cmml"><mi id="S3.E1.m1.1.1.3.3.2" xref="S3.E1.m1.1.1.3.3.2.cmml">θ</mi><mo id="S3.E1.m1.1.1.3.3.3" xref="S3.E1.m1.1.1.3.3.3.cmml">∗</mo></msup></msub><mo id="S3.E1.m1.1.1.2" xref="S3.E1.m1.1.1.2.cmml">=</mo><mrow id="S3.E1.m1.1.1.1" xref="S3.E1.m1.1.1.1.cmml"><mrow id="S3.E1.m1.1.1.1.3" xref="S3.E1.m1.1.1.1.3.cmml"><mi id="S3.E1.m1.1.1.1.3.1" xref="S3.E1.m1.1.1.1.3.1.cmml">arg</mi><mo id="S3.E1.m1.1.1.1.3a" lspace="0.167em" xref="S3.E1.m1.1.1.1.3.cmml">⁡</mo><mrow id="S3.E1.m1.1.1.1.3.2" xref="S3.E1.m1.1.1.1.3.2.cmml"><munder id="S3.E1.m1.1.1.1.3.2.1" xref="S3.E1.m1.1.1.1.3.2.1.cmml"><mi id="S3.E1.m1.1.1.1.3.2.1.2" xref="S3.E1.m1.1.1.1.3.2.1.2.cmml">min</mi><mi id="S3.E1.m1.1.1.1.3.2.1.3" xref="S3.E1.m1.1.1.1.3.2.1.3.cmml">θ</mi></munder><mo id="S3.E1.m1.1.1.1.3.2a" lspace="0.167em" xref="S3.E1.m1.1.1.1.3.2.cmml">⁡</mo><msub id="S3.E1.m1.1.1.1.3.2.2" xref="S3.E1.m1.1.1.1.3.2.2.cmml"><mi id="S3.E1.m1.1.1.1.3.2.2.2" xref="S3.E1.m1.1.1.1.3.2.2.2.cmml">𝔼</mi><mrow id="S3.E1.m1.1.1.1.3.2.2.3" xref="S3.E1.m1.1.1.1.3.2.2.3.cmml"><msup id="S3.E1.m1.1.1.1.3.2.2.3.2" xref="S3.E1.m1.1.1.1.3.2.2.3.2.cmml"><mi id="S3.E1.m1.1.1.1.3.2.2.3.2.2" xref="S3.E1.m1.1.1.1.3.2.2.3.2.2.cmml">x</mi><mi id="S3.E1.m1.1.1.1.3.2.2.3.2.3" xref="S3.E1.m1.1.1.1.3.2.2.3.2.3.cmml">t</mi></msup><mo id="S3.E1.m1.1.1.1.3.2.2.3.1" xref="S3.E1.m1.1.1.1.3.2.2.3.1.cmml">∼</mo><msup id="S3.E1.m1.1.1.1.3.2.2.3.3" xref="S3.E1.m1.1.1.1.3.2.2.3.3.cmml"><mi id="S3.E1.m1.1.1.1.3.2.2.3.3.2" xref="S3.E1.m1.1.1.1.3.2.2.3.3.2.cmml">D</mi><mi id="S3.E1.m1.1.1.1.3.2.2.3.3.3" xref="S3.E1.m1.1.1.1.3.2.2.3.3.3.cmml">t</mi></msup></mrow></msub></mrow></mrow><mo id="S3.E1.m1.1.1.1.2" xref="S3.E1.m1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.2.cmml"><mo id="S3.E1.m1.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.1.1.1.1.2.1.cmml">[</mo><mrow id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml"><msub id="S3.E1.m1.1.1.1.1.1.1.3" xref="S3.E1.m1.1.1.1.1.1.1.3.cmml"><mi id="S3.E1.m1.1.1.1.1.1.1.3.2" xref="S3.E1.m1.1.1.1.1.1.1.3.2.cmml">L</mi><mrow id="S3.E1.m1.1.1.1.1.1.1.3.3" xref="S3.E1.m1.1.1.1.1.1.1.3.3.cmml"><mi id="S3.E1.m1.1.1.1.1.1.1.3.3.2" xref="S3.E1.m1.1.1.1.1.1.1.3.3.2.cmml">t</mi><mo id="S3.E1.m1.1.1.1.1.1.1.3.3.1" xref="S3.E1.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E1.m1.1.1.1.1.1.1.3.3.3" xref="S3.E1.m1.1.1.1.1.1.1.3.3.3.cmml">t</mi></mrow></msub><mo id="S3.E1.m1.1.1.1.1.1.1.2" xref="S3.E1.m1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.cmml"><msub id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.2.cmml">𝒯</mi><mi id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.3.cmml">θ</mi></msub><mo id="S3.E1.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msup id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">t</mi></msup><mo id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.1.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.1.1.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.1b"><apply id="S3.E1.m1.1.1.cmml" xref="S3.E1.m1.1.1"><eq id="S3.E1.m1.1.1.2.cmml" xref="S3.E1.m1.1.1.2"></eq><apply id="S3.E1.m1.1.1.3.cmml" xref="S3.E1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.3.1.cmml" xref="S3.E1.m1.1.1.3">subscript</csymbol><ci id="S3.E1.m1.1.1.3.2.cmml" xref="S3.E1.m1.1.1.3.2">𝒯</ci><apply id="S3.E1.m1.1.1.3.3.cmml" xref="S3.E1.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.3.3.1.cmml" xref="S3.E1.m1.1.1.3.3">superscript</csymbol><ci id="S3.E1.m1.1.1.3.3.2.cmml" xref="S3.E1.m1.1.1.3.3.2">𝜃</ci><times id="S3.E1.m1.1.1.3.3.3.cmml" xref="S3.E1.m1.1.1.3.3.3"></times></apply></apply><apply id="S3.E1.m1.1.1.1.cmml" xref="S3.E1.m1.1.1.1"><times id="S3.E1.m1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.2"></times><apply id="S3.E1.m1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.3"><arg id="S3.E1.m1.1.1.1.3.1.cmml" xref="S3.E1.m1.1.1.1.3.1"></arg><apply id="S3.E1.m1.1.1.1.3.2.cmml" xref="S3.E1.m1.1.1.1.3.2"><apply id="S3.E1.m1.1.1.1.3.2.1.cmml" xref="S3.E1.m1.1.1.1.3.2.1"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.3.2.1.1.cmml" xref="S3.E1.m1.1.1.1.3.2.1">subscript</csymbol><min id="S3.E1.m1.1.1.1.3.2.1.2.cmml" xref="S3.E1.m1.1.1.1.3.2.1.2"></min><ci id="S3.E1.m1.1.1.1.3.2.1.3.cmml" xref="S3.E1.m1.1.1.1.3.2.1.3">𝜃</ci></apply><apply id="S3.E1.m1.1.1.1.3.2.2.cmml" xref="S3.E1.m1.1.1.1.3.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.3.2.2.1.cmml" xref="S3.E1.m1.1.1.1.3.2.2">subscript</csymbol><ci id="S3.E1.m1.1.1.1.3.2.2.2.cmml" xref="S3.E1.m1.1.1.1.3.2.2.2">𝔼</ci><apply id="S3.E1.m1.1.1.1.3.2.2.3.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3"><csymbol cd="latexml" id="S3.E1.m1.1.1.1.3.2.2.3.1.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.1">similar-to</csymbol><apply id="S3.E1.m1.1.1.1.3.2.2.3.2.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.3.2.2.3.2.1.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.2">superscript</csymbol><ci id="S3.E1.m1.1.1.1.3.2.2.3.2.2.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.2.2">𝑥</ci><ci id="S3.E1.m1.1.1.1.3.2.2.3.2.3.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.2.3">𝑡</ci></apply><apply id="S3.E1.m1.1.1.1.3.2.2.3.3.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.3.2.2.3.3.1.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.3">superscript</csymbol><ci id="S3.E1.m1.1.1.1.3.2.2.3.3.2.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.3.2">𝐷</ci><ci id="S3.E1.m1.1.1.1.3.2.2.3.3.3.cmml" xref="S3.E1.m1.1.1.1.3.2.2.3.3.3">𝑡</ci></apply></apply></apply></apply></apply><apply id="S3.E1.m1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.1.1.1.1.2.1.cmml" xref="S3.E1.m1.1.1.1.1.1.2">delimited-[]</csymbol><apply id="S3.E1.m1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1"><times id="S3.E1.m1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.2"></times><apply id="S3.E1.m1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E1.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3.2">𝐿</ci><apply id="S3.E1.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3.3"><times id="S3.E1.m1.1.1.1.1.1.1.3.3.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3.3.1"></times><ci id="S3.E1.m1.1.1.1.1.1.1.3.3.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3.3.2">𝑡</ci><ci id="S3.E1.m1.1.1.1.1.1.1.3.3.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3.3.3">𝑡</ci></apply></apply><apply id="S3.E1.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1"><times id="S3.E1.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.2"></times><apply id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.2">𝒯</ci><ci id="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.3.3">𝜃</ci></apply><apply id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑡</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.1c">\mathcal{T_{\theta^{*}}}=\arg\min_{\theta}\mathbb{E}_{x^{t}\sim\mathit{D}^{t}}%
[L_{tt}(\mathcal{T}_{\theta}(x^{t}))]</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.1d">caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT = roman_arg roman_min start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT ∼ italic_D start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT ( caligraphic_T start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.10"><span class="ltx_text ltx_font_bold" id="S3.SS1.p2.10.10" style="color:#000000;">Prompt learning with unlabeled test data.<span class="ltx_text ltx_font_medium" id="S3.SS1.p2.10.10.10"> In prompt learning, <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p2.1.1.1.m1.1"><semantics id="S3.SS1.p2.1.1.1.m1.1a"><mi id="S3.SS1.p2.1.1.1.m1.1.1" mathcolor="#000000" xref="S3.SS1.p2.1.1.1.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.1.1.m1.1b"><ci id="S3.SS1.p2.1.1.1.m1.1.1.cmml" xref="S3.SS1.p2.1.1.1.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.1.1.m1.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.1.1.m1.1d">italic_θ</annotation></semantics></math> contains additional trainable parameters <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS1.p2.2.2.2.m2.1"><semantics id="S3.SS1.p2.2.2.2.m2.1a"><mi id="S3.SS1.p2.2.2.2.m2.1.1" mathcolor="#000000" xref="S3.SS1.p2.2.2.2.m2.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.2.2.m2.1b"><ci id="S3.SS1.p2.2.2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.2.2.m2.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.2.2.m2.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.2.2.m2.1d">italic_ϕ</annotation></semantics></math> for adaptation: <math alttext="\theta=\{\psi,\phi\}" class="ltx_Math" display="inline" id="S3.SS1.p2.3.3.3.m3.2"><semantics id="S3.SS1.p2.3.3.3.m3.2a"><mrow id="S3.SS1.p2.3.3.3.m3.2.3" xref="S3.SS1.p2.3.3.3.m3.2.3.cmml"><mi id="S3.SS1.p2.3.3.3.m3.2.3.2" mathcolor="#000000" xref="S3.SS1.p2.3.3.3.m3.2.3.2.cmml">θ</mi><mo id="S3.SS1.p2.3.3.3.m3.2.3.1" mathcolor="#000000" xref="S3.SS1.p2.3.3.3.m3.2.3.1.cmml">=</mo><mrow id="S3.SS1.p2.3.3.3.m3.2.3.3.2" xref="S3.SS1.p2.3.3.3.m3.2.3.3.1.cmml"><mo id="S3.SS1.p2.3.3.3.m3.2.3.3.2.1" mathcolor="#000000" stretchy="false" xref="S3.SS1.p2.3.3.3.m3.2.3.3.1.cmml">{</mo><mi id="S3.SS1.p2.3.3.3.m3.1.1" mathcolor="#000000" xref="S3.SS1.p2.3.3.3.m3.1.1.cmml">ψ</mi><mo id="S3.SS1.p2.3.3.3.m3.2.3.3.2.2" mathcolor="#000000" xref="S3.SS1.p2.3.3.3.m3.2.3.3.1.cmml">,</mo><mi id="S3.SS1.p2.3.3.3.m3.2.2" mathcolor="#000000" xref="S3.SS1.p2.3.3.3.m3.2.2.cmml">ϕ</mi><mo id="S3.SS1.p2.3.3.3.m3.2.3.3.2.3" mathcolor="#000000" stretchy="false" xref="S3.SS1.p2.3.3.3.m3.2.3.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.3.3.m3.2b"><apply id="S3.SS1.p2.3.3.3.m3.2.3.cmml" xref="S3.SS1.p2.3.3.3.m3.2.3"><eq id="S3.SS1.p2.3.3.3.m3.2.3.1.cmml" xref="S3.SS1.p2.3.3.3.m3.2.3.1"></eq><ci id="S3.SS1.p2.3.3.3.m3.2.3.2.cmml" xref="S3.SS1.p2.3.3.3.m3.2.3.2">𝜃</ci><set id="S3.SS1.p2.3.3.3.m3.2.3.3.1.cmml" xref="S3.SS1.p2.3.3.3.m3.2.3.3.2"><ci id="S3.SS1.p2.3.3.3.m3.1.1.cmml" xref="S3.SS1.p2.3.3.3.m3.1.1">𝜓</ci><ci id="S3.SS1.p2.3.3.3.m3.2.2.cmml" xref="S3.SS1.p2.3.3.3.m3.2.2">italic-ϕ</ci></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.3.3.m3.2c">\theta=\{\psi,\phi\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.3.3.m3.2d">italic_θ = { italic_ψ , italic_ϕ }</annotation></semantics></math>, where <math alttext="\psi" class="ltx_Math" display="inline" id="S3.SS1.p2.4.4.4.m4.1"><semantics id="S3.SS1.p2.4.4.4.m4.1a"><mi id="S3.SS1.p2.4.4.4.m4.1.1" mathcolor="#000000" xref="S3.SS1.p2.4.4.4.m4.1.1.cmml">ψ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.4.4.m4.1b"><ci id="S3.SS1.p2.4.4.4.m4.1.1.cmml" xref="S3.SS1.p2.4.4.4.m4.1.1">𝜓</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.4.4.4.m4.1c">\psi</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.4.4.4.m4.1d">italic_ψ</annotation></semantics></math> is initialized by <math alttext="\psi^{*}" class="ltx_Math" display="inline" id="S3.SS1.p2.5.5.5.m5.1"><semantics id="S3.SS1.p2.5.5.5.m5.1a"><msup id="S3.SS1.p2.5.5.5.m5.1.1" xref="S3.SS1.p2.5.5.5.m5.1.1.cmml"><mi id="S3.SS1.p2.5.5.5.m5.1.1.2" mathcolor="#000000" xref="S3.SS1.p2.5.5.5.m5.1.1.2.cmml">ψ</mi><mo id="S3.SS1.p2.5.5.5.m5.1.1.3" mathcolor="#000000" xref="S3.SS1.p2.5.5.5.m5.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.5.5.m5.1b"><apply id="S3.SS1.p2.5.5.5.m5.1.1.cmml" xref="S3.SS1.p2.5.5.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.5.5.5.m5.1.1.1.cmml" xref="S3.SS1.p2.5.5.5.m5.1.1">superscript</csymbol><ci id="S3.SS1.p2.5.5.5.m5.1.1.2.cmml" xref="S3.SS1.p2.5.5.5.m5.1.1.2">𝜓</ci><times id="S3.SS1.p2.5.5.5.m5.1.1.3.cmml" xref="S3.SS1.p2.5.5.5.m5.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.5.5.5.m5.1c">\psi^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.5.5.5.m5.1d">italic_ψ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> from the pretrained model <math alttext="S" class="ltx_Math" display="inline" id="S3.SS1.p2.6.6.6.m6.1"><semantics id="S3.SS1.p2.6.6.6.m6.1a"><mi id="S3.SS1.p2.6.6.6.m6.1.1" mathcolor="#000000" xref="S3.SS1.p2.6.6.6.m6.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.6.6.m6.1b"><ci id="S3.SS1.p2.6.6.6.m6.1.1.cmml" xref="S3.SS1.p2.6.6.6.m6.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.6.6.6.m6.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.6.6.6.m6.1d">italic_S</annotation></semantics></math> and <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS1.p2.7.7.7.m7.1"><semantics id="S3.SS1.p2.7.7.7.m7.1a"><mi id="S3.SS1.p2.7.7.7.m7.1.1" mathcolor="#000000" xref="S3.SS1.p2.7.7.7.m7.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.7.7.m7.1b"><ci id="S3.SS1.p2.7.7.7.m7.1.1.cmml" xref="S3.SS1.p2.7.7.7.m7.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.7.7.7.m7.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.7.7.7.m7.1d">italic_ϕ</annotation></semantics></math> is randomly initialized. Except for BN parameters and the introduced parameters <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS1.p2.8.8.8.m8.1"><semantics id="S3.SS1.p2.8.8.8.m8.1a"><mi id="S3.SS1.p2.8.8.8.m8.1.1" mathcolor="#000000" xref="S3.SS1.p2.8.8.8.m8.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.8.8.8.m8.1b"><ci id="S3.SS1.p2.8.8.8.m8.1.1.cmml" xref="S3.SS1.p2.8.8.8.m8.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.8.8.8.m8.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.8.8.8.m8.1d">italic_ϕ</annotation></semantics></math> which are trainable, the rest of the parameters are usually frozen during adaptation. The objective loss function <math alttext="L_{tt}" class="ltx_Math" display="inline" id="S3.SS1.p2.9.9.9.m9.1"><semantics id="S3.SS1.p2.9.9.9.m9.1a"><msub id="S3.SS1.p2.9.9.9.m9.1.1" xref="S3.SS1.p2.9.9.9.m9.1.1.cmml"><mi id="S3.SS1.p2.9.9.9.m9.1.1.2" mathcolor="#000000" xref="S3.SS1.p2.9.9.9.m9.1.1.2.cmml">L</mi><mrow id="S3.SS1.p2.9.9.9.m9.1.1.3" xref="S3.SS1.p2.9.9.9.m9.1.1.3.cmml"><mi id="S3.SS1.p2.9.9.9.m9.1.1.3.2" mathcolor="#000000" xref="S3.SS1.p2.9.9.9.m9.1.1.3.2.cmml">t</mi><mo id="S3.SS1.p2.9.9.9.m9.1.1.3.1" xref="S3.SS1.p2.9.9.9.m9.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p2.9.9.9.m9.1.1.3.3" mathcolor="#000000" xref="S3.SS1.p2.9.9.9.m9.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.9.9.9.m9.1b"><apply id="S3.SS1.p2.9.9.9.m9.1.1.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.9.9.9.m9.1.1.1.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1">subscript</csymbol><ci id="S3.SS1.p2.9.9.9.m9.1.1.2.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1.2">𝐿</ci><apply id="S3.SS1.p2.9.9.9.m9.1.1.3.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1.3"><times id="S3.SS1.p2.9.9.9.m9.1.1.3.1.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1.3.1"></times><ci id="S3.SS1.p2.9.9.9.m9.1.1.3.2.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1.3.2">𝑡</ci><ci id="S3.SS1.p2.9.9.9.m9.1.1.3.3.cmml" xref="S3.SS1.p2.9.9.9.m9.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.9.9.9.m9.1c">L_{tt}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.9.9.9.m9.1d">italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT</annotation></semantics></math> for test-time training is always carefully constructed in a self-supervised form as test labels are unavailable. This work focuses on designing effective prompt formulations to provide the model with the context tailored to test samples, which helps precisely retrieve pretrained knowledge. As for <math alttext="L_{tt}" class="ltx_Math" display="inline" id="S3.SS1.p2.10.10.10.m10.1"><semantics id="S3.SS1.p2.10.10.10.m10.1a"><msub id="S3.SS1.p2.10.10.10.m10.1.1" xref="S3.SS1.p2.10.10.10.m10.1.1.cmml"><mi id="S3.SS1.p2.10.10.10.m10.1.1.2" mathcolor="#000000" xref="S3.SS1.p2.10.10.10.m10.1.1.2.cmml">L</mi><mrow id="S3.SS1.p2.10.10.10.m10.1.1.3" xref="S3.SS1.p2.10.10.10.m10.1.1.3.cmml"><mi id="S3.SS1.p2.10.10.10.m10.1.1.3.2" mathcolor="#000000" xref="S3.SS1.p2.10.10.10.m10.1.1.3.2.cmml">t</mi><mo id="S3.SS1.p2.10.10.10.m10.1.1.3.1" xref="S3.SS1.p2.10.10.10.m10.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p2.10.10.10.m10.1.1.3.3" mathcolor="#000000" xref="S3.SS1.p2.10.10.10.m10.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.10.10.10.m10.1b"><apply id="S3.SS1.p2.10.10.10.m10.1.1.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.10.10.10.m10.1.1.1.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1">subscript</csymbol><ci id="S3.SS1.p2.10.10.10.m10.1.1.2.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1.2">𝐿</ci><apply id="S3.SS1.p2.10.10.10.m10.1.1.3.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1.3"><times id="S3.SS1.p2.10.10.10.m10.1.1.3.1.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1.3.1"></times><ci id="S3.SS1.p2.10.10.10.m10.1.1.3.2.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1.3.2">𝑡</ci><ci id="S3.SS1.p2.10.10.10.m10.1.1.3.3.cmml" xref="S3.SS1.p2.10.10.10.m10.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.10.10.10.m10.1c">L_{tt}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.10.10.10.m10.1d">italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, we directly utilize effective losses in existing TTA studies, which are thoroughly discussed in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4" title="4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">4</span></a>.</span></span></p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.6"><span class="ltx_text ltx_font_bold" id="S3.SS1.p3.6.1">Offline and online TTA.</span> Typical TTA scenarios involve offline and online setups. Offline TTA assumes that the entire target test distribution <math alttext="\{x^{t}_{i},i=1,...,N^{t}\}" class="ltx_Math" display="inline" id="S3.SS1.p3.1.m1.3"><semantics id="S3.SS1.p3.1.m1.3a"><mrow id="S3.SS1.p3.1.m1.3.3.1" xref="S3.SS1.p3.1.m1.3.3.2.cmml"><mo id="S3.SS1.p3.1.m1.3.3.1.2" stretchy="false" xref="S3.SS1.p3.1.m1.3.3.2.cmml">{</mo><mrow id="S3.SS1.p3.1.m1.3.3.1.1.2" xref="S3.SS1.p3.1.m1.3.3.1.1.3.cmml"><mrow id="S3.SS1.p3.1.m1.3.3.1.1.1.1" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.cmml"><mrow id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.2.cmml"><msubsup id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.2" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.3" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.2" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.2.cmml">,</mo><mi id="S3.SS1.p3.1.m1.1.1" xref="S3.SS1.p3.1.m1.1.1.cmml">i</mi></mrow><mo id="S3.SS1.p3.1.m1.3.3.1.1.1.1.2" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.2.cmml">=</mo><mn id="S3.SS1.p3.1.m1.3.3.1.1.1.1.3" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.3.cmml">1</mn></mrow><mo id="S3.SS1.p3.1.m1.3.3.1.1.2.3" xref="S3.SS1.p3.1.m1.3.3.1.1.3a.cmml">,</mo><mrow id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.2.cmml"><mi id="S3.SS1.p3.1.m1.2.2" mathvariant="normal" xref="S3.SS1.p3.1.m1.2.2.cmml">…</mi><mo id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.2" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.2.cmml">,</mo><msup id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.cmml"><mi id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.2" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.2.cmml">N</mi><mi id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.3" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.3.cmml">t</mi></msup></mrow></mrow><mo id="S3.SS1.p3.1.m1.3.3.1.3" stretchy="false" xref="S3.SS1.p3.1.m1.3.3.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.1.m1.3b"><set id="S3.SS1.p3.1.m1.3.3.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1"><apply id="S3.SS1.p3.1.m1.3.3.1.1.3.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.3.3.1.1.3a.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.3">formulae-sequence</csymbol><apply id="S3.SS1.p3.1.m1.3.3.1.1.1.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1"><eq id="S3.SS1.p3.1.m1.3.3.1.1.1.1.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.2"></eq><list id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1"><apply id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.SS1.p3.1.m1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1">𝑖</ci></list><cn id="S3.SS1.p3.1.m1.3.3.1.1.1.1.3.cmml" type="integer" xref="S3.SS1.p3.1.m1.3.3.1.1.1.1.3">1</cn></apply><list id="S3.SS1.p3.1.m1.3.3.1.1.2.2.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1"><ci id="S3.SS1.p3.1.m1.2.2.cmml" xref="S3.SS1.p3.1.m1.2.2">…</ci><apply id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.1.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1">superscript</csymbol><ci id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.2.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.2">𝑁</ci><ci id="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.3.cmml" xref="S3.SS1.p3.1.m1.3.3.1.1.2.2.1.1.3">𝑡</ci></apply></list></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.1.m1.3c">\{x^{t}_{i},i=1,...,N^{t}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.1.m1.3d">{ italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_i = 1 , … , italic_N start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT }</annotation></semantics></math> is available for training. <span class="ltx_text" id="S3.SS1.p3.6.2" style="color:#000000;">To prevent confusion, we distinguish between offline TTA and the traditional UDA setup: offline TTA is trained directly on a small test set, whereas UDA is trained on a larger and extra-collected training set of the target domain, together with labeled data from the source domain.</span>
For online TTA, test sample <math alttext="x^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS1.p3.2.m2.1"><semantics id="S3.SS1.p3.2.m2.1a"><msubsup id="S3.SS1.p3.2.m2.1.1" xref="S3.SS1.p3.2.m2.1.1.cmml"><mi id="S3.SS1.p3.2.m2.1.1.2.2" xref="S3.SS1.p3.2.m2.1.1.2.2.cmml">x</mi><mi id="S3.SS1.p3.2.m2.1.1.3" xref="S3.SS1.p3.2.m2.1.1.3.cmml">i</mi><mi id="S3.SS1.p3.2.m2.1.1.2.3" xref="S3.SS1.p3.2.m2.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.2.m2.1b"><apply id="S3.SS1.p3.2.m2.1.1.cmml" xref="S3.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.2.m2.1.1.1.cmml" xref="S3.SS1.p3.2.m2.1.1">subscript</csymbol><apply id="S3.SS1.p3.2.m2.1.1.2.cmml" xref="S3.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.2.m2.1.1.2.1.cmml" xref="S3.SS1.p3.2.m2.1.1">superscript</csymbol><ci id="S3.SS1.p3.2.m2.1.1.2.2.cmml" xref="S3.SS1.p3.2.m2.1.1.2.2">𝑥</ci><ci id="S3.SS1.p3.2.m2.1.1.2.3.cmml" xref="S3.SS1.p3.2.m2.1.1.2.3">𝑡</ci></apply><ci id="S3.SS1.p3.2.m2.1.1.3.cmml" xref="S3.SS1.p3.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.2.m2.1c">x^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.2.m2.1d">italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> arrives sequentially at time step <math alttext="i" class="ltx_Math" display="inline" id="S3.SS1.p3.3.m3.1"><semantics id="S3.SS1.p3.3.m3.1a"><mi id="S3.SS1.p3.3.m3.1.1" xref="S3.SS1.p3.3.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.3.m3.1b"><ci id="S3.SS1.p3.3.m3.1.1.cmml" xref="S3.SS1.p3.3.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.3.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.3.m3.1d">italic_i</annotation></semantics></math>. The target model <math alttext="\mathcal{T}" class="ltx_Math" display="inline" id="S3.SS1.p3.4.m4.1"><semantics id="S3.SS1.p3.4.m4.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p3.4.m4.1.1" xref="S3.SS1.p3.4.m4.1.1.cmml">𝒯</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.4.m4.1b"><ci id="S3.SS1.p3.4.m4.1.1.cmml" xref="S3.SS1.p3.4.m4.1.1">𝒯</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.4.m4.1c">\mathcal{T}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.4.m4.1d">caligraphic_T</annotation></semantics></math> updates accordingly for the current sample <math alttext="{\theta_{i-1}}\rightarrow{\theta_{i}}" class="ltx_Math" display="inline" id="S3.SS1.p3.5.m5.1"><semantics id="S3.SS1.p3.5.m5.1a"><mrow id="S3.SS1.p3.5.m5.1.1" xref="S3.SS1.p3.5.m5.1.1.cmml"><msub id="S3.SS1.p3.5.m5.1.1.2" xref="S3.SS1.p3.5.m5.1.1.2.cmml"><mi id="S3.SS1.p3.5.m5.1.1.2.2" xref="S3.SS1.p3.5.m5.1.1.2.2.cmml">θ</mi><mrow id="S3.SS1.p3.5.m5.1.1.2.3" xref="S3.SS1.p3.5.m5.1.1.2.3.cmml"><mi id="S3.SS1.p3.5.m5.1.1.2.3.2" xref="S3.SS1.p3.5.m5.1.1.2.3.2.cmml">i</mi><mo id="S3.SS1.p3.5.m5.1.1.2.3.1" xref="S3.SS1.p3.5.m5.1.1.2.3.1.cmml">−</mo><mn id="S3.SS1.p3.5.m5.1.1.2.3.3" xref="S3.SS1.p3.5.m5.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="S3.SS1.p3.5.m5.1.1.1" stretchy="false" xref="S3.SS1.p3.5.m5.1.1.1.cmml">→</mo><msub id="S3.SS1.p3.5.m5.1.1.3" xref="S3.SS1.p3.5.m5.1.1.3.cmml"><mi id="S3.SS1.p3.5.m5.1.1.3.2" xref="S3.SS1.p3.5.m5.1.1.3.2.cmml">θ</mi><mi id="S3.SS1.p3.5.m5.1.1.3.3" xref="S3.SS1.p3.5.m5.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.5.m5.1b"><apply id="S3.SS1.p3.5.m5.1.1.cmml" xref="S3.SS1.p3.5.m5.1.1"><ci id="S3.SS1.p3.5.m5.1.1.1.cmml" xref="S3.SS1.p3.5.m5.1.1.1">→</ci><apply id="S3.SS1.p3.5.m5.1.1.2.cmml" xref="S3.SS1.p3.5.m5.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p3.5.m5.1.1.2.1.cmml" xref="S3.SS1.p3.5.m5.1.1.2">subscript</csymbol><ci id="S3.SS1.p3.5.m5.1.1.2.2.cmml" xref="S3.SS1.p3.5.m5.1.1.2.2">𝜃</ci><apply id="S3.SS1.p3.5.m5.1.1.2.3.cmml" xref="S3.SS1.p3.5.m5.1.1.2.3"><minus id="S3.SS1.p3.5.m5.1.1.2.3.1.cmml" xref="S3.SS1.p3.5.m5.1.1.2.3.1"></minus><ci id="S3.SS1.p3.5.m5.1.1.2.3.2.cmml" xref="S3.SS1.p3.5.m5.1.1.2.3.2">𝑖</ci><cn id="S3.SS1.p3.5.m5.1.1.2.3.3.cmml" type="integer" xref="S3.SS1.p3.5.m5.1.1.2.3.3">1</cn></apply></apply><apply id="S3.SS1.p3.5.m5.1.1.3.cmml" xref="S3.SS1.p3.5.m5.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.5.m5.1.1.3.1.cmml" xref="S3.SS1.p3.5.m5.1.1.3">subscript</csymbol><ci id="S3.SS1.p3.5.m5.1.1.3.2.cmml" xref="S3.SS1.p3.5.m5.1.1.3.2">𝜃</ci><ci id="S3.SS1.p3.5.m5.1.1.3.3.cmml" xref="S3.SS1.p3.5.m5.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.5.m5.1c">{\theta_{i-1}}\rightarrow{\theta_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.5.m5.1d">italic_θ start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT → italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and makes the prediction on the fly <math alttext="p^{t}_{i}=\mathcal{T}_{\theta_{i}}(x^{t}_{i})" class="ltx_Math" display="inline" id="S3.SS1.p3.6.m6.1"><semantics id="S3.SS1.p3.6.m6.1a"><mrow id="S3.SS1.p3.6.m6.1.1" xref="S3.SS1.p3.6.m6.1.1.cmml"><msubsup id="S3.SS1.p3.6.m6.1.1.3" xref="S3.SS1.p3.6.m6.1.1.3.cmml"><mi id="S3.SS1.p3.6.m6.1.1.3.2.2" xref="S3.SS1.p3.6.m6.1.1.3.2.2.cmml">p</mi><mi id="S3.SS1.p3.6.m6.1.1.3.3" xref="S3.SS1.p3.6.m6.1.1.3.3.cmml">i</mi><mi id="S3.SS1.p3.6.m6.1.1.3.2.3" xref="S3.SS1.p3.6.m6.1.1.3.2.3.cmml">t</mi></msubsup><mo id="S3.SS1.p3.6.m6.1.1.2" xref="S3.SS1.p3.6.m6.1.1.2.cmml">=</mo><mrow id="S3.SS1.p3.6.m6.1.1.1" xref="S3.SS1.p3.6.m6.1.1.1.cmml"><msub id="S3.SS1.p3.6.m6.1.1.1.3" xref="S3.SS1.p3.6.m6.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p3.6.m6.1.1.1.3.2" xref="S3.SS1.p3.6.m6.1.1.1.3.2.cmml">𝒯</mi><msub id="S3.SS1.p3.6.m6.1.1.1.3.3" xref="S3.SS1.p3.6.m6.1.1.1.3.3.cmml"><mi id="S3.SS1.p3.6.m6.1.1.1.3.3.2" xref="S3.SS1.p3.6.m6.1.1.1.3.3.2.cmml">θ</mi><mi id="S3.SS1.p3.6.m6.1.1.1.3.3.3" xref="S3.SS1.p3.6.m6.1.1.1.3.3.3.cmml">i</mi></msub></msub><mo id="S3.SS1.p3.6.m6.1.1.1.2" xref="S3.SS1.p3.6.m6.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS1.p3.6.m6.1.1.1.1.1" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.cmml"><mo id="S3.SS1.p3.6.m6.1.1.1.1.1.2" stretchy="false" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.cmml">(</mo><msubsup id="S3.SS1.p3.6.m6.1.1.1.1.1.1" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.cmml"><mi id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.2" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="S3.SS1.p3.6.m6.1.1.1.1.1.1.3" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.3" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="S3.SS1.p3.6.m6.1.1.1.1.1.3" stretchy="false" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.6.m6.1b"><apply id="S3.SS1.p3.6.m6.1.1.cmml" xref="S3.SS1.p3.6.m6.1.1"><eq id="S3.SS1.p3.6.m6.1.1.2.cmml" xref="S3.SS1.p3.6.m6.1.1.2"></eq><apply id="S3.SS1.p3.6.m6.1.1.3.cmml" xref="S3.SS1.p3.6.m6.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.3.1.cmml" xref="S3.SS1.p3.6.m6.1.1.3">subscript</csymbol><apply id="S3.SS1.p3.6.m6.1.1.3.2.cmml" xref="S3.SS1.p3.6.m6.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.3.2.1.cmml" xref="S3.SS1.p3.6.m6.1.1.3">superscript</csymbol><ci id="S3.SS1.p3.6.m6.1.1.3.2.2.cmml" xref="S3.SS1.p3.6.m6.1.1.3.2.2">𝑝</ci><ci id="S3.SS1.p3.6.m6.1.1.3.2.3.cmml" xref="S3.SS1.p3.6.m6.1.1.3.2.3">𝑡</ci></apply><ci id="S3.SS1.p3.6.m6.1.1.3.3.cmml" xref="S3.SS1.p3.6.m6.1.1.3.3">𝑖</ci></apply><apply id="S3.SS1.p3.6.m6.1.1.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1"><times id="S3.SS1.p3.6.m6.1.1.1.2.cmml" xref="S3.SS1.p3.6.m6.1.1.1.2"></times><apply id="S3.SS1.p3.6.m6.1.1.1.3.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.1.3.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3">subscript</csymbol><ci id="S3.SS1.p3.6.m6.1.1.1.3.2.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3.2">𝒯</ci><apply id="S3.SS1.p3.6.m6.1.1.1.3.3.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.1.3.3.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3.3">subscript</csymbol><ci id="S3.SS1.p3.6.m6.1.1.1.3.3.2.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3.3.2">𝜃</ci><ci id="S3.SS1.p3.6.m6.1.1.1.3.3.3.cmml" xref="S3.SS1.p3.6.m6.1.1.1.3.3.3">𝑖</ci></apply></apply><apply id="S3.SS1.p3.6.m6.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1">subscript</csymbol><apply id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.1.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1">superscript</csymbol><ci id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.2">𝑥</ci><ci id="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.3.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="S3.SS1.p3.6.m6.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p3.6.m6.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.6.m6.1c">p^{t}_{i}=\mathcal{T}_{\theta_{i}}(x^{t}_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.6.m6.1d">italic_p start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>. <span class="ltx_text" id="S3.SS1.p3.6.3" style="color:#000000;">Coupled with proper parameter updating schemes, the proposed TTA framework is applicable to both online and offline situations.</span></p>
</div>
<div class="ltx_para" id="S3.SS1.p4">
<p class="ltx_p" id="S3.SS1.p4.4"><span class="ltx_text ltx_font_bold" id="S3.SS1.p4.4.1">Overview of the proposed method.</span> Despite the low-level style shift in <math alttext="X^{s}" class="ltx_Math" display="inline" id="S3.SS1.p4.1.m1.1"><semantics id="S3.SS1.p4.1.m1.1a"><msup id="S3.SS1.p4.1.m1.1.1" xref="S3.SS1.p4.1.m1.1.1.cmml"><mi id="S3.SS1.p4.1.m1.1.1.2" xref="S3.SS1.p4.1.m1.1.1.2.cmml">X</mi><mi id="S3.SS1.p4.1.m1.1.1.3" xref="S3.SS1.p4.1.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.1.m1.1b"><apply id="S3.SS1.p4.1.m1.1.1.cmml" xref="S3.SS1.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.1.m1.1.1.1.cmml" xref="S3.SS1.p4.1.m1.1.1">superscript</csymbol><ci id="S3.SS1.p4.1.m1.1.1.2.cmml" xref="S3.SS1.p4.1.m1.1.1.2">𝑋</ci><ci id="S3.SS1.p4.1.m1.1.1.3.cmml" xref="S3.SS1.p4.1.m1.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.1.m1.1c">X^{s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.1.m1.1d">italic_X start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="X^{t}" class="ltx_Math" display="inline" id="S3.SS1.p4.2.m2.1"><semantics id="S3.SS1.p4.2.m2.1a"><msup id="S3.SS1.p4.2.m2.1.1" xref="S3.SS1.p4.2.m2.1.1.cmml"><mi id="S3.SS1.p4.2.m2.1.1.2" xref="S3.SS1.p4.2.m2.1.1.2.cmml">X</mi><mi id="S3.SS1.p4.2.m2.1.1.3" xref="S3.SS1.p4.2.m2.1.1.3.cmml">t</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.2.m2.1b"><apply id="S3.SS1.p4.2.m2.1.1.cmml" xref="S3.SS1.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.2.m2.1.1.1.cmml" xref="S3.SS1.p4.2.m2.1.1">superscript</csymbol><ci id="S3.SS1.p4.2.m2.1.1.2.cmml" xref="S3.SS1.p4.2.m2.1.1.2">𝑋</ci><ci id="S3.SS1.p4.2.m2.1.1.3.cmml" xref="S3.SS1.p4.2.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.2.m2.1c">X^{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.2.m2.1d">italic_X start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT</annotation></semantics></math>, we first emphasize that the high-level shape discrepancy between <math alttext="Y^{s}" class="ltx_Math" display="inline" id="S3.SS1.p4.3.m3.1"><semantics id="S3.SS1.p4.3.m3.1a"><msup id="S3.SS1.p4.3.m3.1.1" xref="S3.SS1.p4.3.m3.1.1.cmml"><mi id="S3.SS1.p4.3.m3.1.1.2" xref="S3.SS1.p4.3.m3.1.1.2.cmml">Y</mi><mi id="S3.SS1.p4.3.m3.1.1.3" xref="S3.SS1.p4.3.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.3.m3.1b"><apply id="S3.SS1.p4.3.m3.1.1.cmml" xref="S3.SS1.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.3.m3.1.1.1.cmml" xref="S3.SS1.p4.3.m3.1.1">superscript</csymbol><ci id="S3.SS1.p4.3.m3.1.1.2.cmml" xref="S3.SS1.p4.3.m3.1.1.2">𝑌</ci><ci id="S3.SS1.p4.3.m3.1.1.3.cmml" xref="S3.SS1.p4.3.m3.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.3.m3.1c">Y^{s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.3.m3.1d">italic_Y start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT</annotation></semantics></math> and unseen <math alttext="Y^{t}" class="ltx_Math" display="inline" id="S3.SS1.p4.4.m4.1"><semantics id="S3.SS1.p4.4.m4.1a"><msup id="S3.SS1.p4.4.m4.1.1" xref="S3.SS1.p4.4.m4.1.1.cmml"><mi id="S3.SS1.p4.4.m4.1.1.2" xref="S3.SS1.p4.4.m4.1.1.2.cmml">Y</mi><mi id="S3.SS1.p4.4.m4.1.1.3" xref="S3.SS1.p4.4.m4.1.1.3.cmml">t</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.4.m4.1b"><apply id="S3.SS1.p4.4.m4.1.1.cmml" xref="S3.SS1.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.4.m4.1.1.1.cmml" xref="S3.SS1.p4.4.m4.1.1">superscript</csymbol><ci id="S3.SS1.p4.4.m4.1.1.2.cmml" xref="S3.SS1.p4.4.m4.1.1.2">𝑌</ci><ci id="S3.SS1.p4.4.m4.1.1.3.cmml" xref="S3.SS1.p4.4.m4.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.4.m4.1c">Y^{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.4.m4.1d">italic_Y start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT</annotation></semantics></math> also hampers the adaptation performance. In this regard, we devise two prompt modules: the input decorator (ID) and the cross-attention prompt modulator (CAPM), separately for reformulating the input data and learning target-specific shape information in the latent space, respectively. To obviate the overfitting of adaptation parameters to a particular test sample which might negatively affect the prediction of future samples in online TTA, we propose an alternating momentum updating (AMU) strategy. The overview of PASS is depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S2.F2" title="Figure 2 ‣ 2 Related Work ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">2</span></a>, with details presented below.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Input Decorator</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.5">Previous studies have shown that leveraging prompts in the continual input embedding space introduces flexibility to pretrained models through an additional parameter space <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib29" title="">29</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib24" title="">24</a>]</cite>. However, current applications of visual prompt learning to domain adaptation <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib31" title="">31</a>]</cite> simply adopt the fixed prompt for all test samples which neglects the data variety within the target distribution. Hence, we propose to generate a dynamic prompt conditioned on each test sample.
Let <span class="ltx_text ltx_markedasmath" id="S3.SS2.p1.5.1">ID</span> be the data decorator parameterized by <math alttext="{\phi_{D}}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msub id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">ϕ</mi><mi id="S3.SS2.p1.2.m2.1.1.3" xref="S3.SS2.p1.2.m2.1.1.3.cmml">D</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">italic-ϕ</ci><ci id="S3.SS2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3">𝐷</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">{\phi_{D}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_ϕ start_POSTSUBSCRIPT italic_D end_POSTSUBSCRIPT</annotation></semantics></math>. For each test data point <math alttext="x^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><msubsup id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.2.2" xref="S3.SS2.p1.3.m3.1.1.2.2.cmml">x</mi><mi id="S3.SS2.p1.3.m3.1.1.3" xref="S3.SS2.p1.3.m3.1.1.3.cmml">i</mi><mi id="S3.SS2.p1.3.m3.1.1.2.3" xref="S3.SS2.p1.3.m3.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">subscript</csymbol><apply id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.2.1.cmml" xref="S3.SS2.p1.3.m3.1.1">superscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.2.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2.2">𝑥</ci><ci id="S3.SS2.p1.3.m3.1.1.2.3.cmml" xref="S3.SS2.p1.3.m3.1.1.2.3">𝑡</ci></apply><ci id="S3.SS2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">x^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> at the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><mi id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><ci id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">italic_i</annotation></semantics></math>-th time step, <span class="ltx_text ltx_markedasmath" id="S3.SS2.p1.5.2">ID</span> reformulates it as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\tilde{x}^{t}_{i}=x^{t}_{i}+\textrm{ID}(x^{t}_{i};\phi_{D})," class="ltx_Math" display="block" id="S3.E2.m1.1"><semantics id="S3.E2.m1.1a"><mrow id="S3.E2.m1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml"><mrow id="S3.E2.m1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml"><msubsup id="S3.E2.m1.1.1.1.1.4" xref="S3.E2.m1.1.1.1.1.4.cmml"><mover accent="true" id="S3.E2.m1.1.1.1.1.4.2.2" xref="S3.E2.m1.1.1.1.1.4.2.2.cmml"><mi id="S3.E2.m1.1.1.1.1.4.2.2.2" xref="S3.E2.m1.1.1.1.1.4.2.2.2.cmml">x</mi><mo id="S3.E2.m1.1.1.1.1.4.2.2.1" xref="S3.E2.m1.1.1.1.1.4.2.2.1.cmml">~</mo></mover><mi id="S3.E2.m1.1.1.1.1.4.3" xref="S3.E2.m1.1.1.1.1.4.3.cmml">i</mi><mi id="S3.E2.m1.1.1.1.1.4.2.3" xref="S3.E2.m1.1.1.1.1.4.2.3.cmml">t</mi></msubsup><mo id="S3.E2.m1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.3.cmml">=</mo><mrow id="S3.E2.m1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.2.cmml"><msubsup id="S3.E2.m1.1.1.1.1.2.4" xref="S3.E2.m1.1.1.1.1.2.4.cmml"><mi id="S3.E2.m1.1.1.1.1.2.4.2.2" xref="S3.E2.m1.1.1.1.1.2.4.2.2.cmml">x</mi><mi id="S3.E2.m1.1.1.1.1.2.4.3" xref="S3.E2.m1.1.1.1.1.2.4.3.cmml">i</mi><mi id="S3.E2.m1.1.1.1.1.2.4.2.3" xref="S3.E2.m1.1.1.1.1.2.4.2.3.cmml">t</mi></msubsup><mo id="S3.E2.m1.1.1.1.1.2.3" xref="S3.E2.m1.1.1.1.1.2.3.cmml">+</mo><mrow id="S3.E2.m1.1.1.1.1.2.2" xref="S3.E2.m1.1.1.1.1.2.2.cmml"><mtext id="S3.E2.m1.1.1.1.1.2.2.4" xref="S3.E2.m1.1.1.1.1.2.2.4a.cmml">ID</mtext><mo id="S3.E2.m1.1.1.1.1.2.2.3" xref="S3.E2.m1.1.1.1.1.2.2.3.cmml">⁢</mo><mrow id="S3.E2.m1.1.1.1.1.2.2.2.2" xref="S3.E2.m1.1.1.1.1.2.2.2.3.cmml"><mo id="S3.E2.m1.1.1.1.1.2.2.2.2.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.2.2.2.3.cmml">(</mo><msubsup id="S3.E2.m1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.3" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="S3.E2.m1.1.1.1.1.2.2.2.2.4" xref="S3.E2.m1.1.1.1.1.2.2.2.3.cmml">;</mo><msub id="S3.E2.m1.1.1.1.1.2.2.2.2.2" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2.cmml"><mi id="S3.E2.m1.1.1.1.1.2.2.2.2.2.2" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2.2.cmml">ϕ</mi><mi id="S3.E2.m1.1.1.1.1.2.2.2.2.2.3" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2.3.cmml">D</mi></msub><mo id="S3.E2.m1.1.1.1.1.2.2.2.2.5" stretchy="false" xref="S3.E2.m1.1.1.1.1.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.E2.m1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.1b"><apply id="S3.E2.m1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1"><eq id="S3.E2.m1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.3"></eq><apply id="S3.E2.m1.1.1.1.1.4.cmml" xref="S3.E2.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.4.1.cmml" xref="S3.E2.m1.1.1.1.1.4">subscript</csymbol><apply id="S3.E2.m1.1.1.1.1.4.2.cmml" xref="S3.E2.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.4.2.1.cmml" xref="S3.E2.m1.1.1.1.1.4">superscript</csymbol><apply id="S3.E2.m1.1.1.1.1.4.2.2.cmml" xref="S3.E2.m1.1.1.1.1.4.2.2"><ci id="S3.E2.m1.1.1.1.1.4.2.2.1.cmml" xref="S3.E2.m1.1.1.1.1.4.2.2.1">~</ci><ci id="S3.E2.m1.1.1.1.1.4.2.2.2.cmml" xref="S3.E2.m1.1.1.1.1.4.2.2.2">𝑥</ci></apply><ci id="S3.E2.m1.1.1.1.1.4.2.3.cmml" xref="S3.E2.m1.1.1.1.1.4.2.3">𝑡</ci></apply><ci id="S3.E2.m1.1.1.1.1.4.3.cmml" xref="S3.E2.m1.1.1.1.1.4.3">𝑖</ci></apply><apply id="S3.E2.m1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.2"><plus id="S3.E2.m1.1.1.1.1.2.3.cmml" xref="S3.E2.m1.1.1.1.1.2.3"></plus><apply id="S3.E2.m1.1.1.1.1.2.4.cmml" xref="S3.E2.m1.1.1.1.1.2.4"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.2.4.1.cmml" xref="S3.E2.m1.1.1.1.1.2.4">subscript</csymbol><apply id="S3.E2.m1.1.1.1.1.2.4.2.cmml" xref="S3.E2.m1.1.1.1.1.2.4"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.2.4.2.1.cmml" xref="S3.E2.m1.1.1.1.1.2.4">superscript</csymbol><ci id="S3.E2.m1.1.1.1.1.2.4.2.2.cmml" xref="S3.E2.m1.1.1.1.1.2.4.2.2">𝑥</ci><ci id="S3.E2.m1.1.1.1.1.2.4.2.3.cmml" xref="S3.E2.m1.1.1.1.1.2.4.2.3">𝑡</ci></apply><ci id="S3.E2.m1.1.1.1.1.2.4.3.cmml" xref="S3.E2.m1.1.1.1.1.2.4.3">𝑖</ci></apply><apply id="S3.E2.m1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.1.1.1.1.2.2"><times id="S3.E2.m1.1.1.1.1.2.2.3.cmml" xref="S3.E2.m1.1.1.1.1.2.2.3"></times><ci id="S3.E2.m1.1.1.1.1.2.2.4a.cmml" xref="S3.E2.m1.1.1.1.1.2.2.4"><mtext id="S3.E2.m1.1.1.1.1.2.2.4.cmml" xref="S3.E2.m1.1.1.1.1.2.2.4">ID</mtext></ci><list id="S3.E2.m1.1.1.1.1.2.2.2.3.cmml" xref="S3.E2.m1.1.1.1.1.2.2.2.2"><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="S3.E2.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E2.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.2.2.2.2.2.1.cmml" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2.2">italic-ϕ</ci><ci id="S3.E2.m1.1.1.1.1.2.2.2.2.2.3.cmml" xref="S3.E2.m1.1.1.1.1.2.2.2.2.2.3">𝐷</ci></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.1c">\tilde{x}^{t}_{i}=x^{t}_{i}+\textrm{ID}(x^{t}_{i};\phi_{D}),</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.1d">over~ start_ARG italic_x end_ARG start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT + ID ( italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_ϕ start_POSTSUBSCRIPT italic_D end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.9">where <span class="ltx_text ltx_markedasmath" id="S3.SS2.p1.9.1">ID</span> intends to shift the distribution of target data <math alttext="X^{t}" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m2.1"><semantics id="S3.SS2.p1.7.m2.1a"><msup id="S3.SS2.p1.7.m2.1.1" xref="S3.SS2.p1.7.m2.1.1.cmml"><mi id="S3.SS2.p1.7.m2.1.1.2" xref="S3.SS2.p1.7.m2.1.1.2.cmml">X</mi><mi id="S3.SS2.p1.7.m2.1.1.3" xref="S3.SS2.p1.7.m2.1.1.3.cmml">t</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m2.1b"><apply id="S3.SS2.p1.7.m2.1.1.cmml" xref="S3.SS2.p1.7.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m2.1.1.1.cmml" xref="S3.SS2.p1.7.m2.1.1">superscript</csymbol><ci id="S3.SS2.p1.7.m2.1.1.2.cmml" xref="S3.SS2.p1.7.m2.1.1.2">𝑋</ci><ci id="S3.SS2.p1.7.m2.1.1.3.cmml" xref="S3.SS2.p1.7.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m2.1c">X^{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m2.1d">italic_X start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT</annotation></semantics></math> to be close to the source data <math alttext="X^{s}" class="ltx_Math" display="inline" id="S3.SS2.p1.8.m3.1"><semantics id="S3.SS2.p1.8.m3.1a"><msup id="S3.SS2.p1.8.m3.1.1" xref="S3.SS2.p1.8.m3.1.1.cmml"><mi id="S3.SS2.p1.8.m3.1.1.2" xref="S3.SS2.p1.8.m3.1.1.2.cmml">X</mi><mi id="S3.SS2.p1.8.m3.1.1.3" xref="S3.SS2.p1.8.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.8.m3.1b"><apply id="S3.SS2.p1.8.m3.1.1.cmml" xref="S3.SS2.p1.8.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.8.m3.1.1.1.cmml" xref="S3.SS2.p1.8.m3.1.1">superscript</csymbol><ci id="S3.SS2.p1.8.m3.1.1.2.cmml" xref="S3.SS2.p1.8.m3.1.1.2">𝑋</ci><ci id="S3.SS2.p1.8.m3.1.1.3.cmml" xref="S3.SS2.p1.8.m3.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.8.m3.1c">X^{s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.8.m3.1d">italic_X start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT</annotation></semantics></math>, and <math alttext="\tilde{x}^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.9.m4.1"><semantics id="S3.SS2.p1.9.m4.1a"><msubsup id="S3.SS2.p1.9.m4.1.1" xref="S3.SS2.p1.9.m4.1.1.cmml"><mover accent="true" id="S3.SS2.p1.9.m4.1.1.2.2" xref="S3.SS2.p1.9.m4.1.1.2.2.cmml"><mi id="S3.SS2.p1.9.m4.1.1.2.2.2" xref="S3.SS2.p1.9.m4.1.1.2.2.2.cmml">x</mi><mo id="S3.SS2.p1.9.m4.1.1.2.2.1" xref="S3.SS2.p1.9.m4.1.1.2.2.1.cmml">~</mo></mover><mi id="S3.SS2.p1.9.m4.1.1.3" xref="S3.SS2.p1.9.m4.1.1.3.cmml">i</mi><mi id="S3.SS2.p1.9.m4.1.1.2.3" xref="S3.SS2.p1.9.m4.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.9.m4.1b"><apply id="S3.SS2.p1.9.m4.1.1.cmml" xref="S3.SS2.p1.9.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.9.m4.1.1.1.cmml" xref="S3.SS2.p1.9.m4.1.1">subscript</csymbol><apply id="S3.SS2.p1.9.m4.1.1.2.cmml" xref="S3.SS2.p1.9.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.9.m4.1.1.2.1.cmml" xref="S3.SS2.p1.9.m4.1.1">superscript</csymbol><apply id="S3.SS2.p1.9.m4.1.1.2.2.cmml" xref="S3.SS2.p1.9.m4.1.1.2.2"><ci id="S3.SS2.p1.9.m4.1.1.2.2.1.cmml" xref="S3.SS2.p1.9.m4.1.1.2.2.1">~</ci><ci id="S3.SS2.p1.9.m4.1.1.2.2.2.cmml" xref="S3.SS2.p1.9.m4.1.1.2.2.2">𝑥</ci></apply><ci id="S3.SS2.p1.9.m4.1.1.2.3.cmml" xref="S3.SS2.p1.9.m4.1.1.2.3">𝑡</ci></apply><ci id="S3.SS2.p1.9.m4.1.1.3.cmml" xref="S3.SS2.p1.9.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.9.m4.1c">\tilde{x}^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.9.m4.1d">over~ start_ARG italic_x end_ARG start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> refers to the altered target input. <span class="ltx_text" id="S3.SS2.p1.9.2" style="color:#000000;">Since Instance Normalization (IN) has shown effectiveness in style transfer<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib32" title="">32</a>]</cite>, we adopt two shallow convolutional layers with IN to construct the ID.</span></p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Cross-Attention Prompt Modulator</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.12">Introducing solely pixel-wise prompts to the pretrained model offers limited adaptation capacity for exploring convincing knowledge essential for semantic segmentation. Therefore, we
further propose to leverage shape-aware information provided by the input image itself to boost the segmentation performance. In this regard, we construct shape prompts induced by high-level representations in the latent space.
Formally, given a reformulated test image <math alttext="\tilde{x}^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><msubsup id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml"><mover accent="true" id="S3.SS3.p1.1.m1.1.1.2.2" xref="S3.SS3.p1.1.m1.1.1.2.2.cmml"><mi id="S3.SS3.p1.1.m1.1.1.2.2.2" xref="S3.SS3.p1.1.m1.1.1.2.2.2.cmml">x</mi><mo id="S3.SS3.p1.1.m1.1.1.2.2.1" xref="S3.SS3.p1.1.m1.1.1.2.2.1.cmml">~</mo></mover><mi id="S3.SS3.p1.1.m1.1.1.3" xref="S3.SS3.p1.1.m1.1.1.3.cmml">i</mi><mi id="S3.SS3.p1.1.m1.1.1.2.3" xref="S3.SS3.p1.1.m1.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><apply id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">subscript</csymbol><apply id="S3.SS3.p1.1.m1.1.1.2.cmml" xref="S3.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.2.1.cmml" xref="S3.SS3.p1.1.m1.1.1">superscript</csymbol><apply id="S3.SS3.p1.1.m1.1.1.2.2.cmml" xref="S3.SS3.p1.1.m1.1.1.2.2"><ci id="S3.SS3.p1.1.m1.1.1.2.2.1.cmml" xref="S3.SS3.p1.1.m1.1.1.2.2.1">~</ci><ci id="S3.SS3.p1.1.m1.1.1.2.2.2.cmml" xref="S3.SS3.p1.1.m1.1.1.2.2.2">𝑥</ci></apply><ci id="S3.SS3.p1.1.m1.1.1.2.3.cmml" xref="S3.SS3.p1.1.m1.1.1.2.3">𝑡</ci></apply><ci id="S3.SS3.p1.1.m1.1.1.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">\tilde{x}^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">over~ start_ARG italic_x end_ARG start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, let <math alttext="z^{t}_{i}\in\mathbb{R}^{C\times H\times W}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><mrow id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><msubsup id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2.2.2" xref="S3.SS3.p1.2.m2.1.1.2.2.2.cmml">z</mi><mi id="S3.SS3.p1.2.m2.1.1.2.3" xref="S3.SS3.p1.2.m2.1.1.2.3.cmml">i</mi><mi id="S3.SS3.p1.2.m2.1.1.2.2.3" xref="S3.SS3.p1.2.m2.1.1.2.2.3.cmml">t</mi></msubsup><mo id="S3.SS3.p1.2.m2.1.1.1" xref="S3.SS3.p1.2.m2.1.1.1.cmml">∈</mo><msup id="S3.SS3.p1.2.m2.1.1.3" xref="S3.SS3.p1.2.m2.1.1.3.cmml"><mi id="S3.SS3.p1.2.m2.1.1.3.2" xref="S3.SS3.p1.2.m2.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS3.p1.2.m2.1.1.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.cmml"><mi id="S3.SS3.p1.2.m2.1.1.3.3.2" xref="S3.SS3.p1.2.m2.1.1.3.3.2.cmml">C</mi><mo id="S3.SS3.p1.2.m2.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.2.m2.1.1.3.3.1.cmml">×</mo><mi id="S3.SS3.p1.2.m2.1.1.3.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.3.cmml">H</mi><mo id="S3.SS3.p1.2.m2.1.1.3.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.2.m2.1.1.3.3.1.cmml">×</mo><mi id="S3.SS3.p1.2.m2.1.1.3.3.4" xref="S3.SS3.p1.2.m2.1.1.3.3.4.cmml">W</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><in id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1.1"></in><apply id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2">subscript</csymbol><apply id="S3.SS3.p1.2.m2.1.1.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.2.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2">superscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2.2.2">𝑧</ci><ci id="S3.SS3.p1.2.m2.1.1.2.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.2.3">𝑡</ci></apply><ci id="S3.SS3.p1.2.m2.1.1.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3">𝑖</ci></apply><apply id="S3.SS3.p1.2.m2.1.1.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3">superscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2">ℝ</ci><apply id="S3.SS3.p1.2.m2.1.1.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3"><times id="S3.SS3.p1.2.m2.1.1.3.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.1"></times><ci id="S3.SS3.p1.2.m2.1.1.3.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.2">𝐶</ci><ci id="S3.SS3.p1.2.m2.1.1.3.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.3">𝐻</ci><ci id="S3.SS3.p1.2.m2.1.1.3.3.4.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.4">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">z^{t}_{i}\in\mathbb{R}^{C\times H\times W}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_C × italic_H × italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> denote the latent features extracted by the encoder of <math alttext="\mathcal{T}" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1"><semantics id="S3.SS3.p1.3.m3.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml">𝒯</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b"><ci id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">𝒯</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">\mathcal{T}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.3.m3.1d">caligraphic_T</annotation></semantics></math> with
<math alttext="C" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m4.1"><semantics id="S3.SS3.p1.4.m4.1a"><mi id="S3.SS3.p1.4.m4.1.1" xref="S3.SS3.p1.4.m4.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m4.1b"><ci id="S3.SS3.p1.4.m4.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.4.m4.1c">C</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.4.m4.1d">italic_C</annotation></semantics></math> channels and size of <math alttext="H\times W" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m5.1"><semantics id="S3.SS3.p1.5.m5.1a"><mrow id="S3.SS3.p1.5.m5.1.1" xref="S3.SS3.p1.5.m5.1.1.cmml"><mi id="S3.SS3.p1.5.m5.1.1.2" xref="S3.SS3.p1.5.m5.1.1.2.cmml">H</mi><mo id="S3.SS3.p1.5.m5.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.5.m5.1.1.1.cmml">×</mo><mi id="S3.SS3.p1.5.m5.1.1.3" xref="S3.SS3.p1.5.m5.1.1.3.cmml">W</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m5.1b"><apply id="S3.SS3.p1.5.m5.1.1.cmml" xref="S3.SS3.p1.5.m5.1.1"><times id="S3.SS3.p1.5.m5.1.1.1.cmml" xref="S3.SS3.p1.5.m5.1.1.1"></times><ci id="S3.SS3.p1.5.m5.1.1.2.cmml" xref="S3.SS3.p1.5.m5.1.1.2">𝐻</ci><ci id="S3.SS3.p1.5.m5.1.1.3.cmml" xref="S3.SS3.p1.5.m5.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.5.m5.1c">H\times W</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.5.m5.1d">italic_H × italic_W</annotation></semantics></math>. We set a learnable shape prompt bank <math alttext="\overline{SP}\in\mathbb{R}^{L\times H\times W}" class="ltx_Math" display="inline" id="S3.SS3.p1.6.m6.1"><semantics id="S3.SS3.p1.6.m6.1a"><mrow id="S3.SS3.p1.6.m6.1.1" xref="S3.SS3.p1.6.m6.1.1.cmml"><mover accent="true" id="S3.SS3.p1.6.m6.1.1.2" xref="S3.SS3.p1.6.m6.1.1.2.cmml"><mrow id="S3.SS3.p1.6.m6.1.1.2.2" xref="S3.SS3.p1.6.m6.1.1.2.2.cmml"><mi id="S3.SS3.p1.6.m6.1.1.2.2.2" xref="S3.SS3.p1.6.m6.1.1.2.2.2.cmml">S</mi><mo id="S3.SS3.p1.6.m6.1.1.2.2.1" xref="S3.SS3.p1.6.m6.1.1.2.2.1.cmml">⁢</mo><mi id="S3.SS3.p1.6.m6.1.1.2.2.3" xref="S3.SS3.p1.6.m6.1.1.2.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p1.6.m6.1.1.2.1" xref="S3.SS3.p1.6.m6.1.1.2.1.cmml">¯</mo></mover><mo id="S3.SS3.p1.6.m6.1.1.1" xref="S3.SS3.p1.6.m6.1.1.1.cmml">∈</mo><msup id="S3.SS3.p1.6.m6.1.1.3" xref="S3.SS3.p1.6.m6.1.1.3.cmml"><mi id="S3.SS3.p1.6.m6.1.1.3.2" xref="S3.SS3.p1.6.m6.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS3.p1.6.m6.1.1.3.3" xref="S3.SS3.p1.6.m6.1.1.3.3.cmml"><mi id="S3.SS3.p1.6.m6.1.1.3.3.2" xref="S3.SS3.p1.6.m6.1.1.3.3.2.cmml">L</mi><mo id="S3.SS3.p1.6.m6.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.6.m6.1.1.3.3.1.cmml">×</mo><mi id="S3.SS3.p1.6.m6.1.1.3.3.3" xref="S3.SS3.p1.6.m6.1.1.3.3.3.cmml">H</mi><mo id="S3.SS3.p1.6.m6.1.1.3.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.6.m6.1.1.3.3.1.cmml">×</mo><mi id="S3.SS3.p1.6.m6.1.1.3.3.4" xref="S3.SS3.p1.6.m6.1.1.3.3.4.cmml">W</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.6.m6.1b"><apply id="S3.SS3.p1.6.m6.1.1.cmml" xref="S3.SS3.p1.6.m6.1.1"><in id="S3.SS3.p1.6.m6.1.1.1.cmml" xref="S3.SS3.p1.6.m6.1.1.1"></in><apply id="S3.SS3.p1.6.m6.1.1.2.cmml" xref="S3.SS3.p1.6.m6.1.1.2"><ci id="S3.SS3.p1.6.m6.1.1.2.1.cmml" xref="S3.SS3.p1.6.m6.1.1.2.1">¯</ci><apply id="S3.SS3.p1.6.m6.1.1.2.2.cmml" xref="S3.SS3.p1.6.m6.1.1.2.2"><times id="S3.SS3.p1.6.m6.1.1.2.2.1.cmml" xref="S3.SS3.p1.6.m6.1.1.2.2.1"></times><ci id="S3.SS3.p1.6.m6.1.1.2.2.2.cmml" xref="S3.SS3.p1.6.m6.1.1.2.2.2">𝑆</ci><ci id="S3.SS3.p1.6.m6.1.1.2.2.3.cmml" xref="S3.SS3.p1.6.m6.1.1.2.2.3">𝑃</ci></apply></apply><apply id="S3.SS3.p1.6.m6.1.1.3.cmml" xref="S3.SS3.p1.6.m6.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p1.6.m6.1.1.3.1.cmml" xref="S3.SS3.p1.6.m6.1.1.3">superscript</csymbol><ci id="S3.SS3.p1.6.m6.1.1.3.2.cmml" xref="S3.SS3.p1.6.m6.1.1.3.2">ℝ</ci><apply id="S3.SS3.p1.6.m6.1.1.3.3.cmml" xref="S3.SS3.p1.6.m6.1.1.3.3"><times id="S3.SS3.p1.6.m6.1.1.3.3.1.cmml" xref="S3.SS3.p1.6.m6.1.1.3.3.1"></times><ci id="S3.SS3.p1.6.m6.1.1.3.3.2.cmml" xref="S3.SS3.p1.6.m6.1.1.3.3.2">𝐿</ci><ci id="S3.SS3.p1.6.m6.1.1.3.3.3.cmml" xref="S3.SS3.p1.6.m6.1.1.3.3.3">𝐻</ci><ci id="S3.SS3.p1.6.m6.1.1.3.3.4.cmml" xref="S3.SS3.p1.6.m6.1.1.3.3.4">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.6.m6.1c">\overline{SP}\in\mathbb{R}^{L\times H\times W}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.6.m6.1d">over¯ start_ARG italic_S italic_P end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_L × italic_H × italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> parameterized by <math alttext="\phi_{sp}" class="ltx_Math" display="inline" id="S3.SS3.p1.7.m7.1"><semantics id="S3.SS3.p1.7.m7.1a"><msub id="S3.SS3.p1.7.m7.1.1" xref="S3.SS3.p1.7.m7.1.1.cmml"><mi id="S3.SS3.p1.7.m7.1.1.2" xref="S3.SS3.p1.7.m7.1.1.2.cmml">ϕ</mi><mrow id="S3.SS3.p1.7.m7.1.1.3" xref="S3.SS3.p1.7.m7.1.1.3.cmml"><mi id="S3.SS3.p1.7.m7.1.1.3.2" xref="S3.SS3.p1.7.m7.1.1.3.2.cmml">s</mi><mo id="S3.SS3.p1.7.m7.1.1.3.1" xref="S3.SS3.p1.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.7.m7.1.1.3.3" xref="S3.SS3.p1.7.m7.1.1.3.3.cmml">p</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.7.m7.1b"><apply id="S3.SS3.p1.7.m7.1.1.cmml" xref="S3.SS3.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.7.m7.1.1.1.cmml" xref="S3.SS3.p1.7.m7.1.1">subscript</csymbol><ci id="S3.SS3.p1.7.m7.1.1.2.cmml" xref="S3.SS3.p1.7.m7.1.1.2">italic-ϕ</ci><apply id="S3.SS3.p1.7.m7.1.1.3.cmml" xref="S3.SS3.p1.7.m7.1.1.3"><times id="S3.SS3.p1.7.m7.1.1.3.1.cmml" xref="S3.SS3.p1.7.m7.1.1.3.1"></times><ci id="S3.SS3.p1.7.m7.1.1.3.2.cmml" xref="S3.SS3.p1.7.m7.1.1.3.2">𝑠</ci><ci id="S3.SS3.p1.7.m7.1.1.3.3.cmml" xref="S3.SS3.p1.7.m7.1.1.3.3">𝑝</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.7.m7.1c">\phi_{sp}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.7.m7.1d">italic_ϕ start_POSTSUBSCRIPT italic_s italic_p end_POSTSUBSCRIPT</annotation></semantics></math>, consisting of <math alttext="L" class="ltx_Math" display="inline" id="S3.SS3.p1.8.m8.1"><semantics id="S3.SS3.p1.8.m8.1a"><mi id="S3.SS3.p1.8.m8.1.1" xref="S3.SS3.p1.8.m8.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.8.m8.1b"><ci id="S3.SS3.p1.8.m8.1.1.cmml" xref="S3.SS3.p1.8.m8.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.8.m8.1c">L</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.8.m8.1d">italic_L</annotation></semantics></math> shape prompt templates.
<math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S3.SS3.p1.9.m9.1"><semantics id="S3.SS3.p1.9.m9.1a"><mover accent="true" id="S3.SS3.p1.9.m9.1.1" xref="S3.SS3.p1.9.m9.1.1.cmml"><mrow id="S3.SS3.p1.9.m9.1.1.2" xref="S3.SS3.p1.9.m9.1.1.2.cmml"><mi id="S3.SS3.p1.9.m9.1.1.2.2" xref="S3.SS3.p1.9.m9.1.1.2.2.cmml">S</mi><mo id="S3.SS3.p1.9.m9.1.1.2.1" xref="S3.SS3.p1.9.m9.1.1.2.1.cmml">⁢</mo><mi id="S3.SS3.p1.9.m9.1.1.2.3" xref="S3.SS3.p1.9.m9.1.1.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p1.9.m9.1.1.1" xref="S3.SS3.p1.9.m9.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.9.m9.1b"><apply id="S3.SS3.p1.9.m9.1.1.cmml" xref="S3.SS3.p1.9.m9.1.1"><ci id="S3.SS3.p1.9.m9.1.1.1.cmml" xref="S3.SS3.p1.9.m9.1.1.1">¯</ci><apply id="S3.SS3.p1.9.m9.1.1.2.cmml" xref="S3.SS3.p1.9.m9.1.1.2"><times id="S3.SS3.p1.9.m9.1.1.2.1.cmml" xref="S3.SS3.p1.9.m9.1.1.2.1"></times><ci id="S3.SS3.p1.9.m9.1.1.2.2.cmml" xref="S3.SS3.p1.9.m9.1.1.2.2">𝑆</ci><ci id="S3.SS3.p1.9.m9.1.1.2.3.cmml" xref="S3.SS3.p1.9.m9.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.9.m9.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.9.m9.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math> is domain-shared for all test images within the target distribution. During the adaptation stage, the learnable shape prompt bank retrieves the knowledge of the pretrained model to obtain the target-relevant model prior.
Then, we propose a cross-attention prompt modulator <span class="ltx_text ltx_markedasmath" id="S3.SS3.p1.12.1">CAPM</span> to generate the sample-specific shape prompt <math alttext="SP_{i}" class="ltx_Math" display="inline" id="S3.SS3.p1.11.m11.1"><semantics id="S3.SS3.p1.11.m11.1a"><mrow id="S3.SS3.p1.11.m11.1.1" xref="S3.SS3.p1.11.m11.1.1.cmml"><mi id="S3.SS3.p1.11.m11.1.1.2" xref="S3.SS3.p1.11.m11.1.1.2.cmml">S</mi><mo id="S3.SS3.p1.11.m11.1.1.1" xref="S3.SS3.p1.11.m11.1.1.1.cmml">⁢</mo><msub id="S3.SS3.p1.11.m11.1.1.3" xref="S3.SS3.p1.11.m11.1.1.3.cmml"><mi id="S3.SS3.p1.11.m11.1.1.3.2" xref="S3.SS3.p1.11.m11.1.1.3.2.cmml">P</mi><mi id="S3.SS3.p1.11.m11.1.1.3.3" xref="S3.SS3.p1.11.m11.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.11.m11.1b"><apply id="S3.SS3.p1.11.m11.1.1.cmml" xref="S3.SS3.p1.11.m11.1.1"><times id="S3.SS3.p1.11.m11.1.1.1.cmml" xref="S3.SS3.p1.11.m11.1.1.1"></times><ci id="S3.SS3.p1.11.m11.1.1.2.cmml" xref="S3.SS3.p1.11.m11.1.1.2">𝑆</ci><apply id="S3.SS3.p1.11.m11.1.1.3.cmml" xref="S3.SS3.p1.11.m11.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p1.11.m11.1.1.3.1.cmml" xref="S3.SS3.p1.11.m11.1.1.3">subscript</csymbol><ci id="S3.SS3.p1.11.m11.1.1.3.2.cmml" xref="S3.SS3.p1.11.m11.1.1.3.2">𝑃</ci><ci id="S3.SS3.p1.11.m11.1.1.3.3.cmml" xref="S3.SS3.p1.11.m11.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.11.m11.1c">SP_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.11.m11.1d">italic_S italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> from the enriched shape prompt bank <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S3.SS3.p1.12.m12.1"><semantics id="S3.SS3.p1.12.m12.1a"><mover accent="true" id="S3.SS3.p1.12.m12.1.1" xref="S3.SS3.p1.12.m12.1.1.cmml"><mrow id="S3.SS3.p1.12.m12.1.1.2" xref="S3.SS3.p1.12.m12.1.1.2.cmml"><mi id="S3.SS3.p1.12.m12.1.1.2.2" xref="S3.SS3.p1.12.m12.1.1.2.2.cmml">S</mi><mo id="S3.SS3.p1.12.m12.1.1.2.1" xref="S3.SS3.p1.12.m12.1.1.2.1.cmml">⁢</mo><mi id="S3.SS3.p1.12.m12.1.1.2.3" xref="S3.SS3.p1.12.m12.1.1.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p1.12.m12.1.1.1" xref="S3.SS3.p1.12.m12.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.12.m12.1b"><apply id="S3.SS3.p1.12.m12.1.1.cmml" xref="S3.SS3.p1.12.m12.1.1"><ci id="S3.SS3.p1.12.m12.1.1.1.cmml" xref="S3.SS3.p1.12.m12.1.1.1">¯</ci><apply id="S3.SS3.p1.12.m12.1.1.2.cmml" xref="S3.SS3.p1.12.m12.1.1.2"><times id="S3.SS3.p1.12.m12.1.1.2.1.cmml" xref="S3.SS3.p1.12.m12.1.1.2.1"></times><ci id="S3.SS3.p1.12.m12.1.1.2.2.cmml" xref="S3.SS3.p1.12.m12.1.1.2.2">𝑆</ci><ci id="S3.SS3.p1.12.m12.1.1.2.3.cmml" xref="S3.SS3.p1.12.m12.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.12.m12.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.12.m12.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.2">Concretely, we regard the target feature <math alttext="z^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.1"><semantics id="S3.SS3.p2.1.m1.1a"><msubsup id="S3.SS3.p2.1.m1.1.1" xref="S3.SS3.p2.1.m1.1.1.cmml"><mi id="S3.SS3.p2.1.m1.1.1.2.2" xref="S3.SS3.p2.1.m1.1.1.2.2.cmml">z</mi><mi id="S3.SS3.p2.1.m1.1.1.3" xref="S3.SS3.p2.1.m1.1.1.3.cmml">i</mi><mi id="S3.SS3.p2.1.m1.1.1.2.3" xref="S3.SS3.p2.1.m1.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.1b"><apply id="S3.SS3.p2.1.m1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1">subscript</csymbol><apply id="S3.SS3.p2.1.m1.1.1.2.cmml" xref="S3.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.2.1.cmml" xref="S3.SS3.p2.1.m1.1.1">superscript</csymbol><ci id="S3.SS3.p2.1.m1.1.1.2.2.cmml" xref="S3.SS3.p2.1.m1.1.1.2.2">𝑧</ci><ci id="S3.SS3.p2.1.m1.1.1.2.3.cmml" xref="S3.SS3.p2.1.m1.1.1.2.3">𝑡</ci></apply><ci id="S3.SS3.p2.1.m1.1.1.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.1c">z^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.1d">italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> as the dynamic query while the domain-common prompt bank <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S3.SS3.p2.2.m2.1"><semantics id="S3.SS3.p2.2.m2.1a"><mover accent="true" id="S3.SS3.p2.2.m2.1.1" xref="S3.SS3.p2.2.m2.1.1.cmml"><mrow id="S3.SS3.p2.2.m2.1.1.2" xref="S3.SS3.p2.2.m2.1.1.2.cmml"><mi id="S3.SS3.p2.2.m2.1.1.2.2" xref="S3.SS3.p2.2.m2.1.1.2.2.cmml">S</mi><mo id="S3.SS3.p2.2.m2.1.1.2.1" xref="S3.SS3.p2.2.m2.1.1.2.1.cmml">⁢</mo><mi id="S3.SS3.p2.2.m2.1.1.2.3" xref="S3.SS3.p2.2.m2.1.1.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p2.2.m2.1.1.1" xref="S3.SS3.p2.2.m2.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.2.m2.1b"><apply id="S3.SS3.p2.2.m2.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1"><ci id="S3.SS3.p2.2.m2.1.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1.1">¯</ci><apply id="S3.SS3.p2.2.m2.1.1.2.cmml" xref="S3.SS3.p2.2.m2.1.1.2"><times id="S3.SS3.p2.2.m2.1.1.2.1.cmml" xref="S3.SS3.p2.2.m2.1.1.2.1"></times><ci id="S3.SS3.p2.2.m2.1.1.2.2.cmml" xref="S3.SS3.p2.2.m2.1.1.2.2">𝑆</ci><ci id="S3.SS3.p2.2.m2.1.1.2.3.cmml" xref="S3.SS3.p2.2.m2.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.2.m2.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.2.m2.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math> as the key/value:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="Q_{i}=\phi_{q}(z^{t}_{i}),K_{i}=\phi_{k}(\overline{SP}),V_{i}=\phi_{v}(%
\overline{SP})." class="ltx_Math" display="block" id="S3.E3.m1.3"><semantics id="S3.E3.m1.3a"><mrow id="S3.E3.m1.3.3.1"><mrow id="S3.E3.m1.3.3.1.1.2" xref="S3.E3.m1.3.3.1.1.3.cmml"><mrow id="S3.E3.m1.3.3.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.cmml"><msub id="S3.E3.m1.3.3.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.3.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.3.2" xref="S3.E3.m1.3.3.1.1.1.1.3.2.cmml">Q</mi><mi id="S3.E3.m1.3.3.1.1.1.1.3.3" xref="S3.E3.m1.3.3.1.1.1.1.3.3.cmml">i</mi></msub><mo id="S3.E3.m1.3.3.1.1.1.1.2" xref="S3.E3.m1.3.3.1.1.1.1.2.cmml">=</mo><mrow id="S3.E3.m1.3.3.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.1.cmml"><msub id="S3.E3.m1.3.3.1.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.1.3.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.1.3.2" xref="S3.E3.m1.3.3.1.1.1.1.1.3.2.cmml">ϕ</mi><mi id="S3.E3.m1.3.3.1.1.1.1.1.3.3" xref="S3.E3.m1.3.3.1.1.1.1.1.3.3.cmml">q</mi></msub><mo id="S3.E3.m1.3.3.1.1.1.1.1.2" xref="S3.E3.m1.3.3.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.1.1.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml">(</mo><msubsup id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.2" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.2.cmml">z</mi><mi id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.3" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E3.m1.3.3.1.1.2.3" xref="S3.E3.m1.3.3.1.1.3a.cmml">,</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.2" xref="S3.E3.m1.3.3.1.1.2.2.3.cmml"><mrow id="S3.E3.m1.3.3.1.1.2.2.1.1" xref="S3.E3.m1.3.3.1.1.2.2.1.1.cmml"><msub id="S3.E3.m1.3.3.1.1.2.2.1.1.2" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2.cmml"><mi id="S3.E3.m1.3.3.1.1.2.2.1.1.2.2" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2.2.cmml">K</mi><mi id="S3.E3.m1.3.3.1.1.2.2.1.1.2.3" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2.3.cmml">i</mi></msub><mo id="S3.E3.m1.3.3.1.1.2.2.1.1.1" xref="S3.E3.m1.3.3.1.1.2.2.1.1.1.cmml">=</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.1.1.3" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.cmml"><msub id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.cmml"><mi id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.2" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.2.cmml">ϕ</mi><mi id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.3" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.3.cmml">k</mi></msub><mo id="S3.E3.m1.3.3.1.1.2.2.1.1.3.1" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.1.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.1.1.3.3.2" xref="S3.E3.m1.1.1.cmml"><mo id="S3.E3.m1.3.3.1.1.2.2.1.1.3.3.2.1" stretchy="false" xref="S3.E3.m1.1.1.cmml">(</mo><mover accent="true" id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml"><mrow id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml"><mi id="S3.E3.m1.1.1.2.2" xref="S3.E3.m1.1.1.2.2.cmml">S</mi><mo id="S3.E3.m1.1.1.2.1" xref="S3.E3.m1.1.1.2.1.cmml">⁢</mo><mi id="S3.E3.m1.1.1.2.3" xref="S3.E3.m1.1.1.2.3.cmml">P</mi></mrow><mo id="S3.E3.m1.1.1.1" xref="S3.E3.m1.1.1.1.cmml">¯</mo></mover><mo id="S3.E3.m1.3.3.1.1.2.2.1.1.3.3.2.2" stretchy="false" xref="S3.E3.m1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E3.m1.3.3.1.1.2.2.2.3" xref="S3.E3.m1.3.3.1.1.2.2.3a.cmml">,</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.2.2" xref="S3.E3.m1.3.3.1.1.2.2.2.2.cmml"><msub id="S3.E3.m1.3.3.1.1.2.2.2.2.2" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2.cmml"><mi id="S3.E3.m1.3.3.1.1.2.2.2.2.2.2" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2.2.cmml">V</mi><mi id="S3.E3.m1.3.3.1.1.2.2.2.2.2.3" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.E3.m1.3.3.1.1.2.2.2.2.1" xref="S3.E3.m1.3.3.1.1.2.2.2.2.1.cmml">=</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.2.2.3" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.cmml"><msub id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.cmml"><mi id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.2" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.2.cmml">ϕ</mi><mi id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.3" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.3.cmml">v</mi></msub><mo id="S3.E3.m1.3.3.1.1.2.2.2.2.3.1" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.1.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.1.1.2.2.2.2.3.3.2" xref="S3.E3.m1.2.2.cmml"><mo id="S3.E3.m1.3.3.1.1.2.2.2.2.3.3.2.1" stretchy="false" xref="S3.E3.m1.2.2.cmml">(</mo><mover accent="true" id="S3.E3.m1.2.2" xref="S3.E3.m1.2.2.cmml"><mrow id="S3.E3.m1.2.2.2" xref="S3.E3.m1.2.2.2.cmml"><mi id="S3.E3.m1.2.2.2.2" xref="S3.E3.m1.2.2.2.2.cmml">S</mi><mo id="S3.E3.m1.2.2.2.1" xref="S3.E3.m1.2.2.2.1.cmml">⁢</mo><mi id="S3.E3.m1.2.2.2.3" xref="S3.E3.m1.2.2.2.3.cmml">P</mi></mrow><mo id="S3.E3.m1.2.2.1" xref="S3.E3.m1.2.2.1.cmml">¯</mo></mover><mo id="S3.E3.m1.3.3.1.1.2.2.2.2.3.3.2.2" stretchy="false" xref="S3.E3.m1.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo id="S3.E3.m1.3.3.1.2" lspace="0em">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.3b"><apply id="S3.E3.m1.3.3.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.3a.cmml" xref="S3.E3.m1.3.3.1.1.2.3">formulae-sequence</csymbol><apply id="S3.E3.m1.3.3.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1"><eq id="S3.E3.m1.3.3.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.2"></eq><apply id="S3.E3.m1.3.3.1.1.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.3">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.1.1.3.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.3.2">𝑄</ci><ci id="S3.E3.m1.3.3.1.1.1.1.3.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.3.3">𝑖</ci></apply><apply id="S3.E3.m1.3.3.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1"><times id="S3.E3.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.2"></times><apply id="S3.E3.m1.3.3.1.1.1.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.1.3.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.1.1.1.3.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.3.2">italic-ϕ</ci><ci id="S3.E3.m1.3.3.1.1.1.1.1.3.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.3.3">𝑞</ci></apply><apply id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.2">𝑧</ci><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply><apply id="S3.E3.m1.3.3.1.1.2.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.2.2.3a.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.3">formulae-sequence</csymbol><apply id="S3.E3.m1.3.3.1.1.2.2.1.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1"><eq id="S3.E3.m1.3.3.1.1.2.2.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.1"></eq><apply id="S3.E3.m1.3.3.1.1.2.2.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.2.2.1.1.2.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.2.2.1.1.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2.2">𝐾</ci><ci id="S3.E3.m1.3.3.1.1.2.2.1.1.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.2.3">𝑖</ci></apply><apply id="S3.E3.m1.3.3.1.1.2.2.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3"><times id="S3.E3.m1.3.3.1.1.2.2.1.1.3.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.1"></times><apply id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.2">italic-ϕ</ci><ci id="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.2.3">𝑘</ci></apply><apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.1.1.3.3.2"><ci id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1">¯</ci><apply id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2"><times id="S3.E3.m1.1.1.2.1.cmml" xref="S3.E3.m1.1.1.2.1"></times><ci id="S3.E3.m1.1.1.2.2.cmml" xref="S3.E3.m1.1.1.2.2">𝑆</ci><ci id="S3.E3.m1.1.1.2.3.cmml" xref="S3.E3.m1.1.1.2.3">𝑃</ci></apply></apply></apply></apply><apply id="S3.E3.m1.3.3.1.1.2.2.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2"><eq id="S3.E3.m1.3.3.1.1.2.2.2.2.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.1"></eq><apply id="S3.E3.m1.3.3.1.1.2.2.2.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.2.2.2.2.2.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.2.2.2.2.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2.2">𝑉</ci><ci id="S3.E3.m1.3.3.1.1.2.2.2.2.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.2.3">𝑖</ci></apply><apply id="S3.E3.m1.3.3.1.1.2.2.2.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3"><times id="S3.E3.m1.3.3.1.1.2.2.2.2.3.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.1"></times><apply id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.1.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2">subscript</csymbol><ci id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.2">italic-ϕ</ci><ci id="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.3.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.2.3">𝑣</ci></apply><apply id="S3.E3.m1.2.2.cmml" xref="S3.E3.m1.3.3.1.1.2.2.2.2.3.3.2"><ci id="S3.E3.m1.2.2.1.cmml" xref="S3.E3.m1.2.2.1">¯</ci><apply id="S3.E3.m1.2.2.2.cmml" xref="S3.E3.m1.2.2.2"><times id="S3.E3.m1.2.2.2.1.cmml" xref="S3.E3.m1.2.2.2.1"></times><ci id="S3.E3.m1.2.2.2.2.cmml" xref="S3.E3.m1.2.2.2.2">𝑆</ci><ci id="S3.E3.m1.2.2.2.3.cmml" xref="S3.E3.m1.2.2.2.3">𝑃</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.3c">Q_{i}=\phi_{q}(z^{t}_{i}),K_{i}=\phi_{k}(\overline{SP}),V_{i}=\phi_{v}(%
\overline{SP}).</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.3d">italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_ϕ start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT ( italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) , italic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( over¯ start_ARG italic_S italic_P end_ARG ) , italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_ϕ start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT ( over¯ start_ARG italic_S italic_P end_ARG ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p2.8">Here, we adopt lightweight depthwise convolutional layers for the mapping function <math alttext="\phi_{q},\phi_{k},\phi_{v}" class="ltx_Math" display="inline" id="S3.SS3.p2.3.m1.3"><semantics id="S3.SS3.p2.3.m1.3a"><mrow id="S3.SS3.p2.3.m1.3.3.3" xref="S3.SS3.p2.3.m1.3.3.4.cmml"><msub id="S3.SS3.p2.3.m1.1.1.1.1" xref="S3.SS3.p2.3.m1.1.1.1.1.cmml"><mi id="S3.SS3.p2.3.m1.1.1.1.1.2" xref="S3.SS3.p2.3.m1.1.1.1.1.2.cmml">ϕ</mi><mi id="S3.SS3.p2.3.m1.1.1.1.1.3" xref="S3.SS3.p2.3.m1.1.1.1.1.3.cmml">q</mi></msub><mo id="S3.SS3.p2.3.m1.3.3.3.4" xref="S3.SS3.p2.3.m1.3.3.4.cmml">,</mo><msub id="S3.SS3.p2.3.m1.2.2.2.2" xref="S3.SS3.p2.3.m1.2.2.2.2.cmml"><mi id="S3.SS3.p2.3.m1.2.2.2.2.2" xref="S3.SS3.p2.3.m1.2.2.2.2.2.cmml">ϕ</mi><mi id="S3.SS3.p2.3.m1.2.2.2.2.3" xref="S3.SS3.p2.3.m1.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.3.m1.3.3.3.5" xref="S3.SS3.p2.3.m1.3.3.4.cmml">,</mo><msub id="S3.SS3.p2.3.m1.3.3.3.3" xref="S3.SS3.p2.3.m1.3.3.3.3.cmml"><mi id="S3.SS3.p2.3.m1.3.3.3.3.2" xref="S3.SS3.p2.3.m1.3.3.3.3.2.cmml">ϕ</mi><mi id="S3.SS3.p2.3.m1.3.3.3.3.3" xref="S3.SS3.p2.3.m1.3.3.3.3.3.cmml">v</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.3.m1.3b"><list id="S3.SS3.p2.3.m1.3.3.4.cmml" xref="S3.SS3.p2.3.m1.3.3.3"><apply id="S3.SS3.p2.3.m1.1.1.1.1.cmml" xref="S3.SS3.p2.3.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m1.1.1.1.1.1.cmml" xref="S3.SS3.p2.3.m1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.3.m1.1.1.1.1.2.cmml" xref="S3.SS3.p2.3.m1.1.1.1.1.2">italic-ϕ</ci><ci id="S3.SS3.p2.3.m1.1.1.1.1.3.cmml" xref="S3.SS3.p2.3.m1.1.1.1.1.3">𝑞</ci></apply><apply id="S3.SS3.p2.3.m1.2.2.2.2.cmml" xref="S3.SS3.p2.3.m1.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m1.2.2.2.2.1.cmml" xref="S3.SS3.p2.3.m1.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.3.m1.2.2.2.2.2.cmml" xref="S3.SS3.p2.3.m1.2.2.2.2.2">italic-ϕ</ci><ci id="S3.SS3.p2.3.m1.2.2.2.2.3.cmml" xref="S3.SS3.p2.3.m1.2.2.2.2.3">𝑘</ci></apply><apply id="S3.SS3.p2.3.m1.3.3.3.3.cmml" xref="S3.SS3.p2.3.m1.3.3.3.3"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m1.3.3.3.3.1.cmml" xref="S3.SS3.p2.3.m1.3.3.3.3">subscript</csymbol><ci id="S3.SS3.p2.3.m1.3.3.3.3.2.cmml" xref="S3.SS3.p2.3.m1.3.3.3.3.2">italic-ϕ</ci><ci id="S3.SS3.p2.3.m1.3.3.3.3.3.cmml" xref="S3.SS3.p2.3.m1.3.3.3.3.3">𝑣</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.3.m1.3c">\phi_{q},\phi_{k},\phi_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.3.m1.3d">italic_ϕ start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math>. Note that the mapping function keeps the output channels identical to the number of input. The dimension of <math alttext="\{Q_{i},K_{i},V_{i}\}" class="ltx_Math" display="inline" id="S3.SS3.p2.4.m2.3"><semantics id="S3.SS3.p2.4.m2.3a"><mrow id="S3.SS3.p2.4.m2.3.3.3" xref="S3.SS3.p2.4.m2.3.3.4.cmml"><mo id="S3.SS3.p2.4.m2.3.3.3.4" stretchy="false" xref="S3.SS3.p2.4.m2.3.3.4.cmml">{</mo><msub id="S3.SS3.p2.4.m2.1.1.1.1" xref="S3.SS3.p2.4.m2.1.1.1.1.cmml"><mi id="S3.SS3.p2.4.m2.1.1.1.1.2" xref="S3.SS3.p2.4.m2.1.1.1.1.2.cmml">Q</mi><mi id="S3.SS3.p2.4.m2.1.1.1.1.3" xref="S3.SS3.p2.4.m2.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS3.p2.4.m2.3.3.3.5" xref="S3.SS3.p2.4.m2.3.3.4.cmml">,</mo><msub id="S3.SS3.p2.4.m2.2.2.2.2" xref="S3.SS3.p2.4.m2.2.2.2.2.cmml"><mi id="S3.SS3.p2.4.m2.2.2.2.2.2" xref="S3.SS3.p2.4.m2.2.2.2.2.2.cmml">K</mi><mi id="S3.SS3.p2.4.m2.2.2.2.2.3" xref="S3.SS3.p2.4.m2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS3.p2.4.m2.3.3.3.6" xref="S3.SS3.p2.4.m2.3.3.4.cmml">,</mo><msub id="S3.SS3.p2.4.m2.3.3.3.3" xref="S3.SS3.p2.4.m2.3.3.3.3.cmml"><mi id="S3.SS3.p2.4.m2.3.3.3.3.2" xref="S3.SS3.p2.4.m2.3.3.3.3.2.cmml">V</mi><mi id="S3.SS3.p2.4.m2.3.3.3.3.3" xref="S3.SS3.p2.4.m2.3.3.3.3.3.cmml">i</mi></msub><mo id="S3.SS3.p2.4.m2.3.3.3.7" stretchy="false" xref="S3.SS3.p2.4.m2.3.3.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.4.m2.3b"><set id="S3.SS3.p2.4.m2.3.3.4.cmml" xref="S3.SS3.p2.4.m2.3.3.3"><apply id="S3.SS3.p2.4.m2.1.1.1.1.cmml" xref="S3.SS3.p2.4.m2.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.4.m2.1.1.1.1.1.cmml" xref="S3.SS3.p2.4.m2.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.4.m2.1.1.1.1.2.cmml" xref="S3.SS3.p2.4.m2.1.1.1.1.2">𝑄</ci><ci id="S3.SS3.p2.4.m2.1.1.1.1.3.cmml" xref="S3.SS3.p2.4.m2.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS3.p2.4.m2.2.2.2.2.cmml" xref="S3.SS3.p2.4.m2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.4.m2.2.2.2.2.1.cmml" xref="S3.SS3.p2.4.m2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.4.m2.2.2.2.2.2.cmml" xref="S3.SS3.p2.4.m2.2.2.2.2.2">𝐾</ci><ci id="S3.SS3.p2.4.m2.2.2.2.2.3.cmml" xref="S3.SS3.p2.4.m2.2.2.2.2.3">𝑖</ci></apply><apply id="S3.SS3.p2.4.m2.3.3.3.3.cmml" xref="S3.SS3.p2.4.m2.3.3.3.3"><csymbol cd="ambiguous" id="S3.SS3.p2.4.m2.3.3.3.3.1.cmml" xref="S3.SS3.p2.4.m2.3.3.3.3">subscript</csymbol><ci id="S3.SS3.p2.4.m2.3.3.3.3.2.cmml" xref="S3.SS3.p2.4.m2.3.3.3.3.2">𝑉</ci><ci id="S3.SS3.p2.4.m2.3.3.3.3.3.cmml" xref="S3.SS3.p2.4.m2.3.3.3.3.3">𝑖</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.4.m2.3c">\{Q_{i},K_{i},V_{i}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.4.m2.3d">{ italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT }</annotation></semantics></math> is flattened from <math alttext="\mathbb{R}^{\frac{C}{L}\times H\times W}" class="ltx_Math" display="inline" id="S3.SS3.p2.5.m3.1"><semantics id="S3.SS3.p2.5.m3.1a"><msup id="S3.SS3.p2.5.m3.1.1" xref="S3.SS3.p2.5.m3.1.1.cmml"><mi id="S3.SS3.p2.5.m3.1.1.2" xref="S3.SS3.p2.5.m3.1.1.2.cmml">ℝ</mi><mrow id="S3.SS3.p2.5.m3.1.1.3" xref="S3.SS3.p2.5.m3.1.1.3.cmml"><mfrac id="S3.SS3.p2.5.m3.1.1.3.2" xref="S3.SS3.p2.5.m3.1.1.3.2.cmml"><mi id="S3.SS3.p2.5.m3.1.1.3.2.2" xref="S3.SS3.p2.5.m3.1.1.3.2.2.cmml">C</mi><mi id="S3.SS3.p2.5.m3.1.1.3.2.3" xref="S3.SS3.p2.5.m3.1.1.3.2.3.cmml">L</mi></mfrac><mo id="S3.SS3.p2.5.m3.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.5.m3.1.1.3.1.cmml">×</mo><mi id="S3.SS3.p2.5.m3.1.1.3.3" xref="S3.SS3.p2.5.m3.1.1.3.3.cmml">H</mi><mo id="S3.SS3.p2.5.m3.1.1.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.5.m3.1.1.3.1.cmml">×</mo><mi id="S3.SS3.p2.5.m3.1.1.3.4" xref="S3.SS3.p2.5.m3.1.1.3.4.cmml">W</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.5.m3.1b"><apply id="S3.SS3.p2.5.m3.1.1.cmml" xref="S3.SS3.p2.5.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.5.m3.1.1.1.cmml" xref="S3.SS3.p2.5.m3.1.1">superscript</csymbol><ci id="S3.SS3.p2.5.m3.1.1.2.cmml" xref="S3.SS3.p2.5.m3.1.1.2">ℝ</ci><apply id="S3.SS3.p2.5.m3.1.1.3.cmml" xref="S3.SS3.p2.5.m3.1.1.3"><times id="S3.SS3.p2.5.m3.1.1.3.1.cmml" xref="S3.SS3.p2.5.m3.1.1.3.1"></times><apply id="S3.SS3.p2.5.m3.1.1.3.2.cmml" xref="S3.SS3.p2.5.m3.1.1.3.2"><divide id="S3.SS3.p2.5.m3.1.1.3.2.1.cmml" xref="S3.SS3.p2.5.m3.1.1.3.2"></divide><ci id="S3.SS3.p2.5.m3.1.1.3.2.2.cmml" xref="S3.SS3.p2.5.m3.1.1.3.2.2">𝐶</ci><ci id="S3.SS3.p2.5.m3.1.1.3.2.3.cmml" xref="S3.SS3.p2.5.m3.1.1.3.2.3">𝐿</ci></apply><ci id="S3.SS3.p2.5.m3.1.1.3.3.cmml" xref="S3.SS3.p2.5.m3.1.1.3.3">𝐻</ci><ci id="S3.SS3.p2.5.m3.1.1.3.4.cmml" xref="S3.SS3.p2.5.m3.1.1.3.4">𝑊</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.5.m3.1c">\mathbb{R}^{\frac{C}{L}\times H\times W}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.5.m3.1d">blackboard_R start_POSTSUPERSCRIPT divide start_ARG italic_C end_ARG start_ARG italic_L end_ARG × italic_H × italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> to <math alttext="\mathbb{R}^{\frac{C}{L}\times HW}" class="ltx_Math" display="inline" id="S3.SS3.p2.6.m4.1"><semantics id="S3.SS3.p2.6.m4.1a"><msup id="S3.SS3.p2.6.m4.1.1" xref="S3.SS3.p2.6.m4.1.1.cmml"><mi id="S3.SS3.p2.6.m4.1.1.2" xref="S3.SS3.p2.6.m4.1.1.2.cmml">ℝ</mi><mrow id="S3.SS3.p2.6.m4.1.1.3" xref="S3.SS3.p2.6.m4.1.1.3.cmml"><mrow id="S3.SS3.p2.6.m4.1.1.3.2" xref="S3.SS3.p2.6.m4.1.1.3.2.cmml"><mfrac id="S3.SS3.p2.6.m4.1.1.3.2.2" xref="S3.SS3.p2.6.m4.1.1.3.2.2.cmml"><mi id="S3.SS3.p2.6.m4.1.1.3.2.2.2" xref="S3.SS3.p2.6.m4.1.1.3.2.2.2.cmml">C</mi><mi id="S3.SS3.p2.6.m4.1.1.3.2.2.3" xref="S3.SS3.p2.6.m4.1.1.3.2.2.3.cmml">L</mi></mfrac><mo id="S3.SS3.p2.6.m4.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.6.m4.1.1.3.2.1.cmml">×</mo><mi id="S3.SS3.p2.6.m4.1.1.3.2.3" xref="S3.SS3.p2.6.m4.1.1.3.2.3.cmml">H</mi></mrow><mo id="S3.SS3.p2.6.m4.1.1.3.1" xref="S3.SS3.p2.6.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.6.m4.1.1.3.3" xref="S3.SS3.p2.6.m4.1.1.3.3.cmml">W</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.6.m4.1b"><apply id="S3.SS3.p2.6.m4.1.1.cmml" xref="S3.SS3.p2.6.m4.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m4.1.1.1.cmml" xref="S3.SS3.p2.6.m4.1.1">superscript</csymbol><ci id="S3.SS3.p2.6.m4.1.1.2.cmml" xref="S3.SS3.p2.6.m4.1.1.2">ℝ</ci><apply id="S3.SS3.p2.6.m4.1.1.3.cmml" xref="S3.SS3.p2.6.m4.1.1.3"><times id="S3.SS3.p2.6.m4.1.1.3.1.cmml" xref="S3.SS3.p2.6.m4.1.1.3.1"></times><apply id="S3.SS3.p2.6.m4.1.1.3.2.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2"><times id="S3.SS3.p2.6.m4.1.1.3.2.1.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.1"></times><apply id="S3.SS3.p2.6.m4.1.1.3.2.2.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.2"><divide id="S3.SS3.p2.6.m4.1.1.3.2.2.1.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.2"></divide><ci id="S3.SS3.p2.6.m4.1.1.3.2.2.2.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.2.2">𝐶</ci><ci id="S3.SS3.p2.6.m4.1.1.3.2.2.3.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.2.3">𝐿</ci></apply><ci id="S3.SS3.p2.6.m4.1.1.3.2.3.cmml" xref="S3.SS3.p2.6.m4.1.1.3.2.3">𝐻</ci></apply><ci id="S3.SS3.p2.6.m4.1.1.3.3.cmml" xref="S3.SS3.p2.6.m4.1.1.3.3">𝑊</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.6.m4.1c">\mathbb{R}^{\frac{C}{L}\times HW}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.6.m4.1d">blackboard_R start_POSTSUPERSCRIPT divide start_ARG italic_C end_ARG start_ARG italic_L end_ARG × italic_H italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>.
Then we can perform a cross-attention operation between the target representation <math alttext="z^{t}_{i}" class="ltx_Math" display="inline" id="S3.SS3.p2.7.m5.1"><semantics id="S3.SS3.p2.7.m5.1a"><msubsup id="S3.SS3.p2.7.m5.1.1" xref="S3.SS3.p2.7.m5.1.1.cmml"><mi id="S3.SS3.p2.7.m5.1.1.2.2" xref="S3.SS3.p2.7.m5.1.1.2.2.cmml">z</mi><mi id="S3.SS3.p2.7.m5.1.1.3" xref="S3.SS3.p2.7.m5.1.1.3.cmml">i</mi><mi id="S3.SS3.p2.7.m5.1.1.2.3" xref="S3.SS3.p2.7.m5.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.7.m5.1b"><apply id="S3.SS3.p2.7.m5.1.1.cmml" xref="S3.SS3.p2.7.m5.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.7.m5.1.1.1.cmml" xref="S3.SS3.p2.7.m5.1.1">subscript</csymbol><apply id="S3.SS3.p2.7.m5.1.1.2.cmml" xref="S3.SS3.p2.7.m5.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.7.m5.1.1.2.1.cmml" xref="S3.SS3.p2.7.m5.1.1">superscript</csymbol><ci id="S3.SS3.p2.7.m5.1.1.2.2.cmml" xref="S3.SS3.p2.7.m5.1.1.2.2">𝑧</ci><ci id="S3.SS3.p2.7.m5.1.1.2.3.cmml" xref="S3.SS3.p2.7.m5.1.1.2.3">𝑡</ci></apply><ci id="S3.SS3.p2.7.m5.1.1.3.cmml" xref="S3.SS3.p2.7.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.7.m5.1c">z^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.7.m5.1d">italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and the domain-common shape prompt bank <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S3.SS3.p2.8.m6.1"><semantics id="S3.SS3.p2.8.m6.1a"><mover accent="true" id="S3.SS3.p2.8.m6.1.1" xref="S3.SS3.p2.8.m6.1.1.cmml"><mrow id="S3.SS3.p2.8.m6.1.1.2" xref="S3.SS3.p2.8.m6.1.1.2.cmml"><mi id="S3.SS3.p2.8.m6.1.1.2.2" xref="S3.SS3.p2.8.m6.1.1.2.2.cmml">S</mi><mo id="S3.SS3.p2.8.m6.1.1.2.1" xref="S3.SS3.p2.8.m6.1.1.2.1.cmml">⁢</mo><mi id="S3.SS3.p2.8.m6.1.1.2.3" xref="S3.SS3.p2.8.m6.1.1.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p2.8.m6.1.1.1" xref="S3.SS3.p2.8.m6.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.8.m6.1b"><apply id="S3.SS3.p2.8.m6.1.1.cmml" xref="S3.SS3.p2.8.m6.1.1"><ci id="S3.SS3.p2.8.m6.1.1.1.cmml" xref="S3.SS3.p2.8.m6.1.1.1">¯</ci><apply id="S3.SS3.p2.8.m6.1.1.2.cmml" xref="S3.SS3.p2.8.m6.1.1.2"><times id="S3.SS3.p2.8.m6.1.1.2.1.cmml" xref="S3.SS3.p2.8.m6.1.1.2.1"></times><ci id="S3.SS3.p2.8.m6.1.1.2.2.cmml" xref="S3.SS3.p2.8.m6.1.1.2.2">𝑆</ci><ci id="S3.SS3.p2.8.m6.1.1.2.3.cmml" xref="S3.SS3.p2.8.m6.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.8.m6.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.8.m6.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\textrm{CAPM}(z^{t}_{i},\overline{SP})=\textrm{Softmax}((Q_{i}\times K_{i}^{T}%
)/\sqrt{L})V_{i}." class="ltx_Math" display="block" id="S3.E4.m1.2"><semantics id="S3.E4.m1.2a"><mrow id="S3.E4.m1.2.2.1" xref="S3.E4.m1.2.2.1.1.cmml"><mrow id="S3.E4.m1.2.2.1.1" xref="S3.E4.m1.2.2.1.1.cmml"><mrow id="S3.E4.m1.2.2.1.1.1" xref="S3.E4.m1.2.2.1.1.1.cmml"><mtext id="S3.E4.m1.2.2.1.1.1.3" xref="S3.E4.m1.2.2.1.1.1.3a.cmml">CAPM</mtext><mo id="S3.E4.m1.2.2.1.1.1.2" xref="S3.E4.m1.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.E4.m1.2.2.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml"><mo id="S3.E4.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">(</mo><msubsup id="S3.E4.m1.2.2.1.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.2.2.1.1.1.1.1.1.2.2" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2.2.cmml">z</mi><mi id="S3.E4.m1.2.2.1.1.1.1.1.1.3" xref="S3.E4.m1.2.2.1.1.1.1.1.1.3.cmml">i</mi><mi id="S3.E4.m1.2.2.1.1.1.1.1.1.2.3" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="S3.E4.m1.2.2.1.1.1.1.1.3" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E4.m1.1.1" xref="S3.E4.m1.1.1.cmml"><mrow id="S3.E4.m1.1.1.2" xref="S3.E4.m1.1.1.2.cmml"><mi id="S3.E4.m1.1.1.2.2" xref="S3.E4.m1.1.1.2.2.cmml">S</mi><mo id="S3.E4.m1.1.1.2.1" xref="S3.E4.m1.1.1.2.1.cmml">⁢</mo><mi id="S3.E4.m1.1.1.2.3" xref="S3.E4.m1.1.1.2.3.cmml">P</mi></mrow><mo id="S3.E4.m1.1.1.1" xref="S3.E4.m1.1.1.1.cmml">¯</mo></mover><mo id="S3.E4.m1.2.2.1.1.1.1.1.4" stretchy="false" xref="S3.E4.m1.2.2.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E4.m1.2.2.1.1.3" xref="S3.E4.m1.2.2.1.1.3.cmml">=</mo><mrow id="S3.E4.m1.2.2.1.1.2" xref="S3.E4.m1.2.2.1.1.2.cmml"><mtext id="S3.E4.m1.2.2.1.1.2.3" xref="S3.E4.m1.2.2.1.1.2.3a.cmml">Softmax</mtext><mo id="S3.E4.m1.2.2.1.1.2.2" xref="S3.E4.m1.2.2.1.1.2.2.cmml">⁢</mo><mrow id="S3.E4.m1.2.2.1.1.2.1.1" xref="S3.E4.m1.2.2.1.1.2.1.1.1.cmml"><mo id="S3.E4.m1.2.2.1.1.2.1.1.2" stretchy="false" xref="S3.E4.m1.2.2.1.1.2.1.1.1.cmml">(</mo><mrow id="S3.E4.m1.2.2.1.1.2.1.1.1" xref="S3.E4.m1.2.2.1.1.2.1.1.1.cmml"><mrow id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.cmml"><mo id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.cmml"><msub id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.cmml"><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.2" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.2.cmml">Q</mi><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.3" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.3.cmml">i</mi></msub><mo id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.1.cmml">×</mo><msubsup id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.cmml"><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.2" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.2.cmml">K</mi><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.3" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.3.cmml">i</mi><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.3" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.3.cmml">T</mi></msubsup></mrow><mo id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.3" stretchy="false" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E4.m1.2.2.1.1.2.1.1.1.2" xref="S3.E4.m1.2.2.1.1.2.1.1.1.2.cmml">/</mo><msqrt id="S3.E4.m1.2.2.1.1.2.1.1.1.3" xref="S3.E4.m1.2.2.1.1.2.1.1.1.3.cmml"><mi id="S3.E4.m1.2.2.1.1.2.1.1.1.3.2" xref="S3.E4.m1.2.2.1.1.2.1.1.1.3.2.cmml">L</mi></msqrt></mrow><mo id="S3.E4.m1.2.2.1.1.2.1.1.3" stretchy="false" xref="S3.E4.m1.2.2.1.1.2.1.1.1.cmml">)</mo></mrow><mo id="S3.E4.m1.2.2.1.1.2.2a" xref="S3.E4.m1.2.2.1.1.2.2.cmml">⁢</mo><msub id="S3.E4.m1.2.2.1.1.2.4" xref="S3.E4.m1.2.2.1.1.2.4.cmml"><mi id="S3.E4.m1.2.2.1.1.2.4.2" xref="S3.E4.m1.2.2.1.1.2.4.2.cmml">V</mi><mi id="S3.E4.m1.2.2.1.1.2.4.3" xref="S3.E4.m1.2.2.1.1.2.4.3.cmml">i</mi></msub></mrow></mrow><mo id="S3.E4.m1.2.2.1.2" lspace="0em" xref="S3.E4.m1.2.2.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.2b"><apply id="S3.E4.m1.2.2.1.1.cmml" xref="S3.E4.m1.2.2.1"><eq id="S3.E4.m1.2.2.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.3"></eq><apply id="S3.E4.m1.2.2.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.1"><times id="S3.E4.m1.2.2.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.1.2"></times><ci id="S3.E4.m1.2.2.1.1.1.3a.cmml" xref="S3.E4.m1.2.2.1.1.1.3"><mtext id="S3.E4.m1.2.2.1.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.1.3">CAPM</mtext></ci><interval closure="open" id="S3.E4.m1.2.2.1.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1"><apply id="S3.E4.m1.2.2.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E4.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E4.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2.2">𝑧</ci><ci id="S3.E4.m1.2.2.1.1.1.1.1.1.2.3.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="S3.E4.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E4.m1.1.1.cmml" xref="S3.E4.m1.1.1"><ci id="S3.E4.m1.1.1.1.cmml" xref="S3.E4.m1.1.1.1">¯</ci><apply id="S3.E4.m1.1.1.2.cmml" xref="S3.E4.m1.1.1.2"><times id="S3.E4.m1.1.1.2.1.cmml" xref="S3.E4.m1.1.1.2.1"></times><ci id="S3.E4.m1.1.1.2.2.cmml" xref="S3.E4.m1.1.1.2.2">𝑆</ci><ci id="S3.E4.m1.1.1.2.3.cmml" xref="S3.E4.m1.1.1.2.3">𝑃</ci></apply></apply></interval></apply><apply id="S3.E4.m1.2.2.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.2"><times id="S3.E4.m1.2.2.1.1.2.2.cmml" xref="S3.E4.m1.2.2.1.1.2.2"></times><ci id="S3.E4.m1.2.2.1.1.2.3a.cmml" xref="S3.E4.m1.2.2.1.1.2.3"><mtext id="S3.E4.m1.2.2.1.1.2.3.cmml" xref="S3.E4.m1.2.2.1.1.2.3">Softmax</mtext></ci><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1"><divide id="S3.E4.m1.2.2.1.1.2.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.2"></divide><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1"><times id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.1"></times><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.2">𝑄</ci><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.3.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3">superscript</csymbol><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.2">𝐾</ci><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.3.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.2.3">𝑖</ci></apply><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.3.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.1.1.1.3.3">𝑇</ci></apply></apply><apply id="S3.E4.m1.2.2.1.1.2.1.1.1.3.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.3"><root id="S3.E4.m1.2.2.1.1.2.1.1.1.3a.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.3"></root><ci id="S3.E4.m1.2.2.1.1.2.1.1.1.3.2.cmml" xref="S3.E4.m1.2.2.1.1.2.1.1.1.3.2">𝐿</ci></apply></apply><apply id="S3.E4.m1.2.2.1.1.2.4.cmml" xref="S3.E4.m1.2.2.1.1.2.4"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.1.1.2.4.1.cmml" xref="S3.E4.m1.2.2.1.1.2.4">subscript</csymbol><ci id="S3.E4.m1.2.2.1.1.2.4.2.cmml" xref="S3.E4.m1.2.2.1.1.2.4.2">𝑉</ci><ci id="S3.E4.m1.2.2.1.1.2.4.3.cmml" xref="S3.E4.m1.2.2.1.1.2.4.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.2c">\textrm{CAPM}(z^{t}_{i},\overline{SP})=\textrm{Softmax}((Q_{i}\times K_{i}^{T}%
)/\sqrt{L})V_{i}.</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.2d">CAPM ( italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , over¯ start_ARG italic_S italic_P end_ARG ) = Softmax ( ( italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT × italic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT ) / square-root start_ARG italic_L end_ARG ) italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p2.16">Note that the attention map <math alttext="A_{i}=\textrm{Softmax}((Q_{i}\times K_{i}^{T})/\sqrt{L})" class="ltx_Math" display="inline" id="S3.SS3.p2.9.m1.1"><semantics id="S3.SS3.p2.9.m1.1a"><mrow id="S3.SS3.p2.9.m1.1.1" xref="S3.SS3.p2.9.m1.1.1.cmml"><msub id="S3.SS3.p2.9.m1.1.1.3" xref="S3.SS3.p2.9.m1.1.1.3.cmml"><mi id="S3.SS3.p2.9.m1.1.1.3.2" xref="S3.SS3.p2.9.m1.1.1.3.2.cmml">A</mi><mi id="S3.SS3.p2.9.m1.1.1.3.3" xref="S3.SS3.p2.9.m1.1.1.3.3.cmml">i</mi></msub><mo id="S3.SS3.p2.9.m1.1.1.2" xref="S3.SS3.p2.9.m1.1.1.2.cmml">=</mo><mrow id="S3.SS3.p2.9.m1.1.1.1" xref="S3.SS3.p2.9.m1.1.1.1.cmml"><mtext id="S3.SS3.p2.9.m1.1.1.1.3" xref="S3.SS3.p2.9.m1.1.1.1.3a.cmml">Softmax</mtext><mo id="S3.SS3.p2.9.m1.1.1.1.2" xref="S3.SS3.p2.9.m1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS3.p2.9.m1.1.1.1.1.1" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.cmml"><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.2" stretchy="false" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.9.m1.1.1.1.1.1.1" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.cmml"><mrow id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.cmml"><msub id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.2.cmml">Q</mi><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.3" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.3.cmml">i</mi></msub><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.1.cmml">×</mo><msubsup id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.2" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml">K</mi><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.3" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml">i</mi><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.3.cmml">T</mi></msubsup></mrow><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.1.2" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.2.cmml">/</mo><msqrt id="S3.SS3.p2.9.m1.1.1.1.1.1.1.3" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.2" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.2.cmml">L</mi></msqrt></mrow><mo id="S3.SS3.p2.9.m1.1.1.1.1.1.3" stretchy="false" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.9.m1.1b"><apply id="S3.SS3.p2.9.m1.1.1.cmml" xref="S3.SS3.p2.9.m1.1.1"><eq id="S3.SS3.p2.9.m1.1.1.2.cmml" xref="S3.SS3.p2.9.m1.1.1.2"></eq><apply id="S3.SS3.p2.9.m1.1.1.3.cmml" xref="S3.SS3.p2.9.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p2.9.m1.1.1.3.1.cmml" xref="S3.SS3.p2.9.m1.1.1.3">subscript</csymbol><ci id="S3.SS3.p2.9.m1.1.1.3.2.cmml" xref="S3.SS3.p2.9.m1.1.1.3.2">𝐴</ci><ci id="S3.SS3.p2.9.m1.1.1.3.3.cmml" xref="S3.SS3.p2.9.m1.1.1.3.3">𝑖</ci></apply><apply id="S3.SS3.p2.9.m1.1.1.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1"><times id="S3.SS3.p2.9.m1.1.1.1.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.2"></times><ci id="S3.SS3.p2.9.m1.1.1.1.3a.cmml" xref="S3.SS3.p2.9.m1.1.1.1.3"><mtext id="S3.SS3.p2.9.m1.1.1.1.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.3">Softmax</mtext></ci><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1"><divide id="S3.SS3.p2.9.m1.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.2"></divide><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1"><times id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.1"></times><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.2">𝑄</ci><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3">superscript</csymbol><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.2">𝐾</ci><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.2.3">𝑖</ci></apply><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.1.1.1.3.3">𝑇</ci></apply></apply><apply id="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.3"><root id="S3.SS3.p2.9.m1.1.1.1.1.1.1.3a.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.3"></root><ci id="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS3.p2.9.m1.1.1.1.1.1.1.3.2">𝐿</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.9.m1.1c">A_{i}=\textrm{Softmax}((Q_{i}\times K_{i}^{T})/\sqrt{L})</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.9.m1.1d">italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = Softmax ( ( italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT × italic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT ) / square-root start_ARG italic_L end_ARG )</annotation></semantics></math> is in the transposed size of <math alttext="\mathbb{R}^{C\times L}" class="ltx_Math" display="inline" id="S3.SS3.p2.10.m2.1"><semantics id="S3.SS3.p2.10.m2.1a"><msup id="S3.SS3.p2.10.m2.1.1" xref="S3.SS3.p2.10.m2.1.1.cmml"><mi id="S3.SS3.p2.10.m2.1.1.2" xref="S3.SS3.p2.10.m2.1.1.2.cmml">ℝ</mi><mrow id="S3.SS3.p2.10.m2.1.1.3" xref="S3.SS3.p2.10.m2.1.1.3.cmml"><mi id="S3.SS3.p2.10.m2.1.1.3.2" xref="S3.SS3.p2.10.m2.1.1.3.2.cmml">C</mi><mo id="S3.SS3.p2.10.m2.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.10.m2.1.1.3.1.cmml">×</mo><mi id="S3.SS3.p2.10.m2.1.1.3.3" xref="S3.SS3.p2.10.m2.1.1.3.3.cmml">L</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.10.m2.1b"><apply id="S3.SS3.p2.10.m2.1.1.cmml" xref="S3.SS3.p2.10.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.10.m2.1.1.1.cmml" xref="S3.SS3.p2.10.m2.1.1">superscript</csymbol><ci id="S3.SS3.p2.10.m2.1.1.2.cmml" xref="S3.SS3.p2.10.m2.1.1.2">ℝ</ci><apply id="S3.SS3.p2.10.m2.1.1.3.cmml" xref="S3.SS3.p2.10.m2.1.1.3"><times id="S3.SS3.p2.10.m2.1.1.3.1.cmml" xref="S3.SS3.p2.10.m2.1.1.3.1"></times><ci id="S3.SS3.p2.10.m2.1.1.3.2.cmml" xref="S3.SS3.p2.10.m2.1.1.3.2">𝐶</ci><ci id="S3.SS3.p2.10.m2.1.1.3.3.cmml" xref="S3.SS3.p2.10.m2.1.1.3.3">𝐿</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.10.m2.1c">\mathbb{R}^{C\times L}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.10.m2.1d">blackboard_R start_POSTSUPERSCRIPT italic_C × italic_L end_POSTSUPERSCRIPT</annotation></semantics></math> instead of the huge regular size <math alttext="\mathbb{R}^{HW\times HW}" class="ltx_Math" display="inline" id="S3.SS3.p2.11.m3.1"><semantics id="S3.SS3.p2.11.m3.1a"><msup id="S3.SS3.p2.11.m3.1.1" xref="S3.SS3.p2.11.m3.1.1.cmml"><mi id="S3.SS3.p2.11.m3.1.1.2" xref="S3.SS3.p2.11.m3.1.1.2.cmml">ℝ</mi><mrow id="S3.SS3.p2.11.m3.1.1.3" xref="S3.SS3.p2.11.m3.1.1.3.cmml"><mrow id="S3.SS3.p2.11.m3.1.1.3.2" xref="S3.SS3.p2.11.m3.1.1.3.2.cmml"><mrow id="S3.SS3.p2.11.m3.1.1.3.2.2" xref="S3.SS3.p2.11.m3.1.1.3.2.2.cmml"><mi id="S3.SS3.p2.11.m3.1.1.3.2.2.2" xref="S3.SS3.p2.11.m3.1.1.3.2.2.2.cmml">H</mi><mo id="S3.SS3.p2.11.m3.1.1.3.2.2.1" xref="S3.SS3.p2.11.m3.1.1.3.2.2.1.cmml">⁢</mo><mi id="S3.SS3.p2.11.m3.1.1.3.2.2.3" xref="S3.SS3.p2.11.m3.1.1.3.2.2.3.cmml">W</mi></mrow><mo id="S3.SS3.p2.11.m3.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p2.11.m3.1.1.3.2.1.cmml">×</mo><mi id="S3.SS3.p2.11.m3.1.1.3.2.3" xref="S3.SS3.p2.11.m3.1.1.3.2.3.cmml">H</mi></mrow><mo id="S3.SS3.p2.11.m3.1.1.3.1" xref="S3.SS3.p2.11.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.11.m3.1.1.3.3" xref="S3.SS3.p2.11.m3.1.1.3.3.cmml">W</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.11.m3.1b"><apply id="S3.SS3.p2.11.m3.1.1.cmml" xref="S3.SS3.p2.11.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.11.m3.1.1.1.cmml" xref="S3.SS3.p2.11.m3.1.1">superscript</csymbol><ci id="S3.SS3.p2.11.m3.1.1.2.cmml" xref="S3.SS3.p2.11.m3.1.1.2">ℝ</ci><apply id="S3.SS3.p2.11.m3.1.1.3.cmml" xref="S3.SS3.p2.11.m3.1.1.3"><times id="S3.SS3.p2.11.m3.1.1.3.1.cmml" xref="S3.SS3.p2.11.m3.1.1.3.1"></times><apply id="S3.SS3.p2.11.m3.1.1.3.2.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2"><times id="S3.SS3.p2.11.m3.1.1.3.2.1.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.1"></times><apply id="S3.SS3.p2.11.m3.1.1.3.2.2.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.2"><times id="S3.SS3.p2.11.m3.1.1.3.2.2.1.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.2.1"></times><ci id="S3.SS3.p2.11.m3.1.1.3.2.2.2.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.2.2">𝐻</ci><ci id="S3.SS3.p2.11.m3.1.1.3.2.2.3.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.2.3">𝑊</ci></apply><ci id="S3.SS3.p2.11.m3.1.1.3.2.3.cmml" xref="S3.SS3.p2.11.m3.1.1.3.2.3">𝐻</ci></apply><ci id="S3.SS3.p2.11.m3.1.1.3.3.cmml" xref="S3.SS3.p2.11.m3.1.1.3.3">𝑊</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.11.m3.1c">\mathbb{R}^{HW\times HW}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.11.m3.1d">blackboard_R start_POSTSUPERSCRIPT italic_H italic_W × italic_H italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>. Each row of <math alttext="A_{i}" class="ltx_Math" display="inline" id="S3.SS3.p2.12.m4.1"><semantics id="S3.SS3.p2.12.m4.1a"><msub id="S3.SS3.p2.12.m4.1.1" xref="S3.SS3.p2.12.m4.1.1.cmml"><mi id="S3.SS3.p2.12.m4.1.1.2" xref="S3.SS3.p2.12.m4.1.1.2.cmml">A</mi><mi id="S3.SS3.p2.12.m4.1.1.3" xref="S3.SS3.p2.12.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.12.m4.1b"><apply id="S3.SS3.p2.12.m4.1.1.cmml" xref="S3.SS3.p2.12.m4.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.12.m4.1.1.1.cmml" xref="S3.SS3.p2.12.m4.1.1">subscript</csymbol><ci id="S3.SS3.p2.12.m4.1.1.2.cmml" xref="S3.SS3.p2.12.m4.1.1.2">𝐴</ci><ci id="S3.SS3.p2.12.m4.1.1.3.cmml" xref="S3.SS3.p2.12.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.12.m4.1c">A_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.12.m4.1d">italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> indicates the attentive scores of a feature channel to <math alttext="L" class="ltx_Math" display="inline" id="S3.SS3.p2.13.m5.1"><semantics id="S3.SS3.p2.13.m5.1a"><mi id="S3.SS3.p2.13.m5.1.1" xref="S3.SS3.p2.13.m5.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.13.m5.1b"><ci id="S3.SS3.p2.13.m5.1.1.cmml" xref="S3.SS3.p2.13.m5.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.13.m5.1c">L</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.13.m5.1d">italic_L</annotation></semantics></math> shape prompt templates in <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S3.SS3.p2.14.m6.1"><semantics id="S3.SS3.p2.14.m6.1a"><mover accent="true" id="S3.SS3.p2.14.m6.1.1" xref="S3.SS3.p2.14.m6.1.1.cmml"><mrow id="S3.SS3.p2.14.m6.1.1.2" xref="S3.SS3.p2.14.m6.1.1.2.cmml"><mi id="S3.SS3.p2.14.m6.1.1.2.2" xref="S3.SS3.p2.14.m6.1.1.2.2.cmml">S</mi><mo id="S3.SS3.p2.14.m6.1.1.2.1" xref="S3.SS3.p2.14.m6.1.1.2.1.cmml">⁢</mo><mi id="S3.SS3.p2.14.m6.1.1.2.3" xref="S3.SS3.p2.14.m6.1.1.2.3.cmml">P</mi></mrow><mo id="S3.SS3.p2.14.m6.1.1.1" xref="S3.SS3.p2.14.m6.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.14.m6.1b"><apply id="S3.SS3.p2.14.m6.1.1.cmml" xref="S3.SS3.p2.14.m6.1.1"><ci id="S3.SS3.p2.14.m6.1.1.1.cmml" xref="S3.SS3.p2.14.m6.1.1.1">¯</ci><apply id="S3.SS3.p2.14.m6.1.1.2.cmml" xref="S3.SS3.p2.14.m6.1.1.2"><times id="S3.SS3.p2.14.m6.1.1.2.1.cmml" xref="S3.SS3.p2.14.m6.1.1.2.1"></times><ci id="S3.SS3.p2.14.m6.1.1.2.2.cmml" xref="S3.SS3.p2.14.m6.1.1.2.2">𝑆</ci><ci id="S3.SS3.p2.14.m6.1.1.2.3.cmml" xref="S3.SS3.p2.14.m6.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.14.m6.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.14.m6.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math>. To select the most related shape prompt templates to the current sample, we only reserve <math alttext="top_{k}" class="ltx_Math" display="inline" id="S3.SS3.p2.15.m7.1"><semantics id="S3.SS3.p2.15.m7.1a"><mrow id="S3.SS3.p2.15.m7.1.1" xref="S3.SS3.p2.15.m7.1.1.cmml"><mi id="S3.SS3.p2.15.m7.1.1.2" xref="S3.SS3.p2.15.m7.1.1.2.cmml">t</mi><mo id="S3.SS3.p2.15.m7.1.1.1" xref="S3.SS3.p2.15.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS3.p2.15.m7.1.1.3" xref="S3.SS3.p2.15.m7.1.1.3.cmml">o</mi><mo id="S3.SS3.p2.15.m7.1.1.1a" xref="S3.SS3.p2.15.m7.1.1.1.cmml">⁢</mo><msub id="S3.SS3.p2.15.m7.1.1.4" xref="S3.SS3.p2.15.m7.1.1.4.cmml"><mi id="S3.SS3.p2.15.m7.1.1.4.2" xref="S3.SS3.p2.15.m7.1.1.4.2.cmml">p</mi><mi id="S3.SS3.p2.15.m7.1.1.4.3" xref="S3.SS3.p2.15.m7.1.1.4.3.cmml">k</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.15.m7.1b"><apply id="S3.SS3.p2.15.m7.1.1.cmml" xref="S3.SS3.p2.15.m7.1.1"><times id="S3.SS3.p2.15.m7.1.1.1.cmml" xref="S3.SS3.p2.15.m7.1.1.1"></times><ci id="S3.SS3.p2.15.m7.1.1.2.cmml" xref="S3.SS3.p2.15.m7.1.1.2">𝑡</ci><ci id="S3.SS3.p2.15.m7.1.1.3.cmml" xref="S3.SS3.p2.15.m7.1.1.3">𝑜</ci><apply id="S3.SS3.p2.15.m7.1.1.4.cmml" xref="S3.SS3.p2.15.m7.1.1.4"><csymbol cd="ambiguous" id="S3.SS3.p2.15.m7.1.1.4.1.cmml" xref="S3.SS3.p2.15.m7.1.1.4">subscript</csymbol><ci id="S3.SS3.p2.15.m7.1.1.4.2.cmml" xref="S3.SS3.p2.15.m7.1.1.4.2">𝑝</ci><ci id="S3.SS3.p2.15.m7.1.1.4.3.cmml" xref="S3.SS3.p2.15.m7.1.1.4.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.15.m7.1c">top_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.15.m7.1d">italic_t italic_o italic_p start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> attention scores from the keys for more effective feature aggregation, leading to a sparse <math alttext="A^{*}" class="ltx_Math" display="inline" id="S3.SS3.p2.16.m8.1"><semantics id="S3.SS3.p2.16.m8.1a"><msup id="S3.SS3.p2.16.m8.1.1" xref="S3.SS3.p2.16.m8.1.1.cmml"><mi id="S3.SS3.p2.16.m8.1.1.2" xref="S3.SS3.p2.16.m8.1.1.2.cmml">A</mi><mo id="S3.SS3.p2.16.m8.1.1.3" xref="S3.SS3.p2.16.m8.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.16.m8.1b"><apply id="S3.SS3.p2.16.m8.1.1.cmml" xref="S3.SS3.p2.16.m8.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.16.m8.1.1.1.cmml" xref="S3.SS3.p2.16.m8.1.1">superscript</csymbol><ci id="S3.SS3.p2.16.m8.1.1.2.cmml" xref="S3.SS3.p2.16.m8.1.1.2">𝐴</ci><times id="S3.SS3.p2.16.m8.1.1.3.cmml" xref="S3.SS3.p2.16.m8.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.16.m8.1c">A^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.16.m8.1d">italic_A start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="A_{i}^{*{p,q}}=\begin{cases}A_{i}^{p,q}&amp;\text{if }A_{i}^{p,q}\geq top_{k}(A_{i%
}^{p}),\\
0&amp;\text{Otherwise},\end{cases}" class="ltx_Math" display="block" id="S3.E5.m1.6"><semantics id="S3.E5.m1.6a"><mrow id="S3.E5.m1.6.7" xref="S3.E5.m1.6.7.cmml"><msubsup id="S3.E5.m1.6.7.2" xref="S3.E5.m1.6.7.2.cmml"><mi id="S3.E5.m1.6.7.2.2.2" xref="S3.E5.m1.6.7.2.2.2.cmml">A</mi><mi id="S3.E5.m1.6.7.2.2.3" xref="S3.E5.m1.6.7.2.2.3.cmml">i</mi><mrow id="S3.E5.m1.6.6.2.2" xref="S3.E5.m1.6.6.2.3.cmml"><mrow id="S3.E5.m1.6.6.2.2.1" xref="S3.E5.m1.6.6.2.2.1.cmml"><mi id="S3.E5.m1.6.6.2.2.1.2" xref="S3.E5.m1.6.6.2.2.1.2.cmml"></mi><mo id="S3.E5.m1.6.6.2.2.1.1" lspace="0.222em" rspace="0.222em" xref="S3.E5.m1.6.6.2.2.1.1.cmml">∗</mo><mi id="S3.E5.m1.6.6.2.2.1.3" xref="S3.E5.m1.6.6.2.2.1.3.cmml">p</mi></mrow><mo id="S3.E5.m1.6.6.2.2.2" xref="S3.E5.m1.6.6.2.3.cmml">,</mo><mi id="S3.E5.m1.5.5.1.1" xref="S3.E5.m1.5.5.1.1.cmml">q</mi></mrow></msubsup><mo id="S3.E5.m1.6.7.1" xref="S3.E5.m1.6.7.1.cmml">=</mo><mrow id="S3.E5.m1.4.4" xref="S3.E5.m1.6.7.3.1.cmml"><mo id="S3.E5.m1.4.4.5" xref="S3.E5.m1.6.7.3.1.1.cmml">{</mo><mtable columnspacing="5pt" displaystyle="true" id="S3.E5.m1.4.4.4" rowspacing="0pt" xref="S3.E5.m1.6.7.3.1.cmml"><mtr id="S3.E5.m1.4.4.4a" xref="S3.E5.m1.6.7.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E5.m1.4.4.4b" xref="S3.E5.m1.6.7.3.1.cmml"><msubsup id="S3.E5.m1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.cmml"><mi id="S3.E5.m1.1.1.1.1.1.1.4.2" xref="S3.E5.m1.1.1.1.1.1.1.4.2.cmml">A</mi><mi id="S3.E5.m1.1.1.1.1.1.1.4.3" xref="S3.E5.m1.1.1.1.1.1.1.4.3.cmml">i</mi><mrow id="S3.E5.m1.1.1.1.1.1.1.2.2.4" xref="S3.E5.m1.1.1.1.1.1.1.2.2.3.cmml"><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.cmml">p</mi><mo id="S3.E5.m1.1.1.1.1.1.1.2.2.4.1" xref="S3.E5.m1.1.1.1.1.1.1.2.2.3.cmml">,</mo><mi id="S3.E5.m1.1.1.1.1.1.1.2.2.2" xref="S3.E5.m1.1.1.1.1.1.1.2.2.2.cmml">q</mi></mrow></msubsup></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E5.m1.4.4.4c" xref="S3.E5.m1.6.7.3.1.cmml"><mrow id="S3.E5.m1.2.2.2.2.2.1.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.cmml"><mrow id="S3.E5.m1.2.2.2.2.2.1.3.1" xref="S3.E5.m1.2.2.2.2.2.1.3.1.cmml"><mrow id="S3.E5.m1.2.2.2.2.2.1.3.1.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.cmml"><mtext id="S3.E5.m1.2.2.2.2.2.1.3.1.3.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.2a.cmml">if </mtext><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.3.1" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.1.cmml">⁢</mo><msubsup id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.cmml"><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.2.cmml">A</mi><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.3.cmml">i</mi><mrow id="S3.E5.m1.2.2.2.2.2.1.2.2.4" xref="S3.E5.m1.2.2.2.2.2.1.2.2.3.cmml"><mi id="S3.E5.m1.2.2.2.2.2.1.1.1.1" xref="S3.E5.m1.2.2.2.2.2.1.1.1.1.cmml">p</mi><mo id="S3.E5.m1.2.2.2.2.2.1.2.2.4.1" xref="S3.E5.m1.2.2.2.2.2.1.2.2.3.cmml">,</mo><mi id="S3.E5.m1.2.2.2.2.2.1.2.2.2" xref="S3.E5.m1.2.2.2.2.2.1.2.2.2.cmml">q</mi></mrow></msubsup></mrow><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.2.cmml">≥</mo><mrow id="S3.E5.m1.2.2.2.2.2.1.3.1.1" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.cmml"><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.3.cmml">t</mi><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.1.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.2.cmml">⁢</mo><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.4" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.4.cmml">o</mi><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.1.2a" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.2.cmml">⁢</mo><msub id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.cmml"><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.2.cmml">p</mi><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.3.cmml">k</mi></msub><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.1.2b" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml"><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml">(</mo><msubsup id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml"><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.2.cmml">A</mi><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.3.cmml">i</mi><mi id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.3" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.3.cmml">p</mi></msubsup><mo id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.3" stretchy="false" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E5.m1.2.2.2.2.2.1.3.2" xref="S3.E5.m1.2.2.2.2.2.1.3.1.cmml">,</mo></mrow></mtd></mtr><mtr id="S3.E5.m1.4.4.4d" xref="S3.E5.m1.6.7.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E5.m1.4.4.4e" xref="S3.E5.m1.6.7.3.1.cmml"><mn id="S3.E5.m1.3.3.3.3.1.1" xref="S3.E5.m1.3.3.3.3.1.1.cmml">0</mn></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E5.m1.4.4.4f" xref="S3.E5.m1.6.7.3.1.cmml"><mrow id="S3.E5.m1.4.4.4.4.2.1.3" xref="S3.E5.m1.4.4.4.4.2.1.1a.cmml"><mtext id="S3.E5.m1.4.4.4.4.2.1.1" xref="S3.E5.m1.4.4.4.4.2.1.1.cmml">Otherwise</mtext><mo id="S3.E5.m1.4.4.4.4.2.1.3.1" xref="S3.E5.m1.4.4.4.4.2.1.1a.cmml">,</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.6b"><apply id="S3.E5.m1.6.7.cmml" xref="S3.E5.m1.6.7"><eq id="S3.E5.m1.6.7.1.cmml" xref="S3.E5.m1.6.7.1"></eq><apply id="S3.E5.m1.6.7.2.cmml" xref="S3.E5.m1.6.7.2"><csymbol cd="ambiguous" id="S3.E5.m1.6.7.2.1.cmml" xref="S3.E5.m1.6.7.2">superscript</csymbol><apply id="S3.E5.m1.6.7.2.2.cmml" xref="S3.E5.m1.6.7.2"><csymbol cd="ambiguous" id="S3.E5.m1.6.7.2.2.1.cmml" xref="S3.E5.m1.6.7.2">subscript</csymbol><ci id="S3.E5.m1.6.7.2.2.2.cmml" xref="S3.E5.m1.6.7.2.2.2">𝐴</ci><ci id="S3.E5.m1.6.7.2.2.3.cmml" xref="S3.E5.m1.6.7.2.2.3">𝑖</ci></apply><list id="S3.E5.m1.6.6.2.3.cmml" xref="S3.E5.m1.6.6.2.2"><apply id="S3.E5.m1.6.6.2.2.1.cmml" xref="S3.E5.m1.6.6.2.2.1"><times id="S3.E5.m1.6.6.2.2.1.1.cmml" xref="S3.E5.m1.6.6.2.2.1.1"></times><csymbol cd="latexml" id="S3.E5.m1.6.6.2.2.1.2.cmml" xref="S3.E5.m1.6.6.2.2.1.2">absent</csymbol><ci id="S3.E5.m1.6.6.2.2.1.3.cmml" xref="S3.E5.m1.6.6.2.2.1.3">𝑝</ci></apply><ci id="S3.E5.m1.5.5.1.1.cmml" xref="S3.E5.m1.5.5.1.1">𝑞</ci></list></apply><apply id="S3.E5.m1.6.7.3.1.cmml" xref="S3.E5.m1.4.4"><csymbol cd="latexml" id="S3.E5.m1.6.7.3.1.1.cmml" xref="S3.E5.m1.4.4.5">cases</csymbol><apply id="S3.E5.m1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E5.m1.1.1.1.1.1.1.4.cmml" xref="S3.E5.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.1.1.4.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.1.1.4.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.4.2">𝐴</ci><ci id="S3.E5.m1.1.1.1.1.1.1.4.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1.4.3">𝑖</ci></apply><list id="S3.E5.m1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1.2.2.4"><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1">𝑝</ci><ci id="S3.E5.m1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.2.2.2">𝑞</ci></list></apply><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3"><geq id="S3.E5.m1.2.2.2.2.2.1.3.1.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.2"></geq><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3"><times id="S3.E5.m1.2.2.2.2.2.1.3.1.3.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.1"></times><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.3.2a.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.2"><mtext id="S3.E5.m1.2.2.2.2.2.1.3.1.3.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.2">if </mtext></ci><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3">superscript</csymbol><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.2">𝐴</ci><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.3.3.2.3">𝑖</ci></apply><list id="S3.E5.m1.2.2.2.2.2.1.2.2.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.2.2.4"><ci id="S3.E5.m1.2.2.2.2.2.1.1.1.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.1.1.1">𝑝</ci><ci id="S3.E5.m1.2.2.2.2.2.1.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.2.2.2">𝑞</ci></list></apply></apply><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1"><times id="S3.E5.m1.2.2.2.2.2.1.3.1.1.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.2"></times><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.3">𝑡</ci><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.4.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.4">𝑜</ci><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.2">𝑝</ci><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.5.3">𝑘</ci></apply><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1">superscript</csymbol><apply id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.2">𝐴</ci><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.2.3">𝑖</ci></apply><ci id="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.2.2.2.1.3.1.1.1.1.1.3">𝑝</ci></apply></apply></apply><cn id="S3.E5.m1.3.3.3.3.1.1.cmml" type="integer" xref="S3.E5.m1.3.3.3.3.1.1">0</cn><ci id="S3.E5.m1.4.4.4.4.2.1.1a.cmml" xref="S3.E5.m1.4.4.4.4.2.1.3"><mtext id="S3.E5.m1.4.4.4.4.2.1.1.cmml" xref="S3.E5.m1.4.4.4.4.2.1.1">Otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.6c">A_{i}^{*{p,q}}=\begin{cases}A_{i}^{p,q}&amp;\text{if }A_{i}^{p,q}\geq top_{k}(A_{i%
}^{p}),\\
0&amp;\text{Otherwise},\end{cases}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.6d">italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ∗ italic_p , italic_q end_POSTSUPERSCRIPT = { start_ROW start_CELL italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_p , italic_q end_POSTSUPERSCRIPT end_CELL start_CELL if italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_p , italic_q end_POSTSUPERSCRIPT ≥ italic_t italic_o italic_p start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_p end_POSTSUPERSCRIPT ) , end_CELL end_ROW start_ROW start_CELL 0 end_CELL start_CELL Otherwise , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p2.18">where <math alttext="p\in[1,C]" class="ltx_Math" display="inline" id="S3.SS3.p2.17.m1.2"><semantics id="S3.SS3.p2.17.m1.2a"><mrow id="S3.SS3.p2.17.m1.2.3" xref="S3.SS3.p2.17.m1.2.3.cmml"><mi id="S3.SS3.p2.17.m1.2.3.2" xref="S3.SS3.p2.17.m1.2.3.2.cmml">p</mi><mo id="S3.SS3.p2.17.m1.2.3.1" xref="S3.SS3.p2.17.m1.2.3.1.cmml">∈</mo><mrow id="S3.SS3.p2.17.m1.2.3.3.2" xref="S3.SS3.p2.17.m1.2.3.3.1.cmml"><mo id="S3.SS3.p2.17.m1.2.3.3.2.1" stretchy="false" xref="S3.SS3.p2.17.m1.2.3.3.1.cmml">[</mo><mn id="S3.SS3.p2.17.m1.1.1" xref="S3.SS3.p2.17.m1.1.1.cmml">1</mn><mo id="S3.SS3.p2.17.m1.2.3.3.2.2" xref="S3.SS3.p2.17.m1.2.3.3.1.cmml">,</mo><mi id="S3.SS3.p2.17.m1.2.2" xref="S3.SS3.p2.17.m1.2.2.cmml">C</mi><mo id="S3.SS3.p2.17.m1.2.3.3.2.3" stretchy="false" xref="S3.SS3.p2.17.m1.2.3.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.17.m1.2b"><apply id="S3.SS3.p2.17.m1.2.3.cmml" xref="S3.SS3.p2.17.m1.2.3"><in id="S3.SS3.p2.17.m1.2.3.1.cmml" xref="S3.SS3.p2.17.m1.2.3.1"></in><ci id="S3.SS3.p2.17.m1.2.3.2.cmml" xref="S3.SS3.p2.17.m1.2.3.2">𝑝</ci><interval closure="closed" id="S3.SS3.p2.17.m1.2.3.3.1.cmml" xref="S3.SS3.p2.17.m1.2.3.3.2"><cn id="S3.SS3.p2.17.m1.1.1.cmml" type="integer" xref="S3.SS3.p2.17.m1.1.1">1</cn><ci id="S3.SS3.p2.17.m1.2.2.cmml" xref="S3.SS3.p2.17.m1.2.2">𝐶</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.17.m1.2c">p\in[1,C]</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.17.m1.2d">italic_p ∈ [ 1 , italic_C ]</annotation></semantics></math>, <math alttext="q\in[1,L]" class="ltx_Math" display="inline" id="S3.SS3.p2.18.m2.2"><semantics id="S3.SS3.p2.18.m2.2a"><mrow id="S3.SS3.p2.18.m2.2.3" xref="S3.SS3.p2.18.m2.2.3.cmml"><mi id="S3.SS3.p2.18.m2.2.3.2" xref="S3.SS3.p2.18.m2.2.3.2.cmml">q</mi><mo id="S3.SS3.p2.18.m2.2.3.1" xref="S3.SS3.p2.18.m2.2.3.1.cmml">∈</mo><mrow id="S3.SS3.p2.18.m2.2.3.3.2" xref="S3.SS3.p2.18.m2.2.3.3.1.cmml"><mo id="S3.SS3.p2.18.m2.2.3.3.2.1" stretchy="false" xref="S3.SS3.p2.18.m2.2.3.3.1.cmml">[</mo><mn id="S3.SS3.p2.18.m2.1.1" xref="S3.SS3.p2.18.m2.1.1.cmml">1</mn><mo id="S3.SS3.p2.18.m2.2.3.3.2.2" xref="S3.SS3.p2.18.m2.2.3.3.1.cmml">,</mo><mi id="S3.SS3.p2.18.m2.2.2" xref="S3.SS3.p2.18.m2.2.2.cmml">L</mi><mo id="S3.SS3.p2.18.m2.2.3.3.2.3" stretchy="false" xref="S3.SS3.p2.18.m2.2.3.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.18.m2.2b"><apply id="S3.SS3.p2.18.m2.2.3.cmml" xref="S3.SS3.p2.18.m2.2.3"><in id="S3.SS3.p2.18.m2.2.3.1.cmml" xref="S3.SS3.p2.18.m2.2.3.1"></in><ci id="S3.SS3.p2.18.m2.2.3.2.cmml" xref="S3.SS3.p2.18.m2.2.3.2">𝑞</ci><interval closure="closed" id="S3.SS3.p2.18.m2.2.3.3.1.cmml" xref="S3.SS3.p2.18.m2.2.3.3.2"><cn id="S3.SS3.p2.18.m2.1.1.cmml" type="integer" xref="S3.SS3.p2.18.m2.1.1">1</cn><ci id="S3.SS3.p2.18.m2.2.2.cmml" xref="S3.SS3.p2.18.m2.2.2">𝐿</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.18.m2.2c">q\in[1,L]</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.18.m2.2d">italic_q ∈ [ 1 , italic_L ]</annotation></semantics></math>. Finally, the modulated shape prompt is fused with the latent feature:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\tilde{z}^{t}_{i}={z}^{t}_{i}+SP_{i}={z}^{t}_{i}+\textrm{CAPM}(V_{i},A^{*}_{i}%
;\phi_{M})," class="ltx_Math" display="block" id="S3.E6.m1.1"><semantics id="S3.E6.m1.1a"><mrow id="S3.E6.m1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml"><mrow id="S3.E6.m1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml"><msubsup id="S3.E6.m1.1.1.1.1.5" xref="S3.E6.m1.1.1.1.1.5.cmml"><mover accent="true" id="S3.E6.m1.1.1.1.1.5.2.2" xref="S3.E6.m1.1.1.1.1.5.2.2.cmml"><mi id="S3.E6.m1.1.1.1.1.5.2.2.2" xref="S3.E6.m1.1.1.1.1.5.2.2.2.cmml">z</mi><mo id="S3.E6.m1.1.1.1.1.5.2.2.1" xref="S3.E6.m1.1.1.1.1.5.2.2.1.cmml">~</mo></mover><mi id="S3.E6.m1.1.1.1.1.5.3" xref="S3.E6.m1.1.1.1.1.5.3.cmml">i</mi><mi id="S3.E6.m1.1.1.1.1.5.2.3" xref="S3.E6.m1.1.1.1.1.5.2.3.cmml">t</mi></msubsup><mo id="S3.E6.m1.1.1.1.1.6" xref="S3.E6.m1.1.1.1.1.6.cmml">=</mo><mrow id="S3.E6.m1.1.1.1.1.7" xref="S3.E6.m1.1.1.1.1.7.cmml"><msubsup id="S3.E6.m1.1.1.1.1.7.2" xref="S3.E6.m1.1.1.1.1.7.2.cmml"><mi id="S3.E6.m1.1.1.1.1.7.2.2.2" xref="S3.E6.m1.1.1.1.1.7.2.2.2.cmml">z</mi><mi id="S3.E6.m1.1.1.1.1.7.2.3" xref="S3.E6.m1.1.1.1.1.7.2.3.cmml">i</mi><mi id="S3.E6.m1.1.1.1.1.7.2.2.3" xref="S3.E6.m1.1.1.1.1.7.2.2.3.cmml">t</mi></msubsup><mo id="S3.E6.m1.1.1.1.1.7.1" xref="S3.E6.m1.1.1.1.1.7.1.cmml">+</mo><mrow id="S3.E6.m1.1.1.1.1.7.3" xref="S3.E6.m1.1.1.1.1.7.3.cmml"><mi id="S3.E6.m1.1.1.1.1.7.3.2" xref="S3.E6.m1.1.1.1.1.7.3.2.cmml">S</mi><mo id="S3.E6.m1.1.1.1.1.7.3.1" xref="S3.E6.m1.1.1.1.1.7.3.1.cmml">⁢</mo><msub id="S3.E6.m1.1.1.1.1.7.3.3" xref="S3.E6.m1.1.1.1.1.7.3.3.cmml"><mi id="S3.E6.m1.1.1.1.1.7.3.3.2" xref="S3.E6.m1.1.1.1.1.7.3.3.2.cmml">P</mi><mi id="S3.E6.m1.1.1.1.1.7.3.3.3" xref="S3.E6.m1.1.1.1.1.7.3.3.3.cmml">i</mi></msub></mrow></mrow><mo id="S3.E6.m1.1.1.1.1.8" xref="S3.E6.m1.1.1.1.1.8.cmml">=</mo><mrow id="S3.E6.m1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.3.cmml"><msubsup id="S3.E6.m1.1.1.1.1.3.5" xref="S3.E6.m1.1.1.1.1.3.5.cmml"><mi id="S3.E6.m1.1.1.1.1.3.5.2.2" xref="S3.E6.m1.1.1.1.1.3.5.2.2.cmml">z</mi><mi id="S3.E6.m1.1.1.1.1.3.5.3" xref="S3.E6.m1.1.1.1.1.3.5.3.cmml">i</mi><mi id="S3.E6.m1.1.1.1.1.3.5.2.3" xref="S3.E6.m1.1.1.1.1.3.5.2.3.cmml">t</mi></msubsup><mo id="S3.E6.m1.1.1.1.1.3.4" xref="S3.E6.m1.1.1.1.1.3.4.cmml">+</mo><mrow id="S3.E6.m1.1.1.1.1.3.3" xref="S3.E6.m1.1.1.1.1.3.3.cmml"><mtext id="S3.E6.m1.1.1.1.1.3.3.5" xref="S3.E6.m1.1.1.1.1.3.3.5a.cmml">CAPM</mtext><mo id="S3.E6.m1.1.1.1.1.3.3.4" xref="S3.E6.m1.1.1.1.1.3.3.4.cmml">⁢</mo><mrow id="S3.E6.m1.1.1.1.1.3.3.3.3" xref="S3.E6.m1.1.1.1.1.3.3.3.4.cmml"><mo id="S3.E6.m1.1.1.1.1.3.3.3.3.4" stretchy="false" xref="S3.E6.m1.1.1.1.1.3.3.3.4.cmml">(</mo><msub id="S3.E6.m1.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.2.cmml">V</mi><mi id="S3.E6.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E6.m1.1.1.1.1.3.3.3.3.5" xref="S3.E6.m1.1.1.1.1.3.3.3.4.cmml">,</mo><msubsup id="S3.E6.m1.1.1.1.1.2.2.2.2.2" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.cmml"><mi id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.2" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.2.cmml">A</mi><mi id="S3.E6.m1.1.1.1.1.2.2.2.2.2.3" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.3.cmml">i</mi><mo id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.3" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">∗</mo></msubsup><mo id="S3.E6.m1.1.1.1.1.3.3.3.3.6" xref="S3.E6.m1.1.1.1.1.3.3.3.4.cmml">;</mo><msub id="S3.E6.m1.1.1.1.1.3.3.3.3.3" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3.cmml"><mi id="S3.E6.m1.1.1.1.1.3.3.3.3.3.2" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3.2.cmml">ϕ</mi><mi id="S3.E6.m1.1.1.1.1.3.3.3.3.3.3" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3.3.cmml">M</mi></msub><mo id="S3.E6.m1.1.1.1.1.3.3.3.3.7" stretchy="false" xref="S3.E6.m1.1.1.1.1.3.3.3.4.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.E6.m1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.1b"><apply id="S3.E6.m1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1"><and id="S3.E6.m1.1.1.1.1a.cmml" xref="S3.E6.m1.1.1.1"></and><apply id="S3.E6.m1.1.1.1.1b.cmml" xref="S3.E6.m1.1.1.1"><eq id="S3.E6.m1.1.1.1.1.6.cmml" xref="S3.E6.m1.1.1.1.1.6"></eq><apply id="S3.E6.m1.1.1.1.1.5.cmml" xref="S3.E6.m1.1.1.1.1.5"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.5.1.cmml" xref="S3.E6.m1.1.1.1.1.5">subscript</csymbol><apply id="S3.E6.m1.1.1.1.1.5.2.cmml" xref="S3.E6.m1.1.1.1.1.5"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.5.2.1.cmml" xref="S3.E6.m1.1.1.1.1.5">superscript</csymbol><apply id="S3.E6.m1.1.1.1.1.5.2.2.cmml" xref="S3.E6.m1.1.1.1.1.5.2.2"><ci id="S3.E6.m1.1.1.1.1.5.2.2.1.cmml" xref="S3.E6.m1.1.1.1.1.5.2.2.1">~</ci><ci id="S3.E6.m1.1.1.1.1.5.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.5.2.2.2">𝑧</ci></apply><ci id="S3.E6.m1.1.1.1.1.5.2.3.cmml" xref="S3.E6.m1.1.1.1.1.5.2.3">𝑡</ci></apply><ci id="S3.E6.m1.1.1.1.1.5.3.cmml" xref="S3.E6.m1.1.1.1.1.5.3">𝑖</ci></apply><apply id="S3.E6.m1.1.1.1.1.7.cmml" xref="S3.E6.m1.1.1.1.1.7"><plus id="S3.E6.m1.1.1.1.1.7.1.cmml" xref="S3.E6.m1.1.1.1.1.7.1"></plus><apply id="S3.E6.m1.1.1.1.1.7.2.cmml" xref="S3.E6.m1.1.1.1.1.7.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.7.2.1.cmml" xref="S3.E6.m1.1.1.1.1.7.2">subscript</csymbol><apply id="S3.E6.m1.1.1.1.1.7.2.2.cmml" xref="S3.E6.m1.1.1.1.1.7.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.7.2.2.1.cmml" xref="S3.E6.m1.1.1.1.1.7.2">superscript</csymbol><ci id="S3.E6.m1.1.1.1.1.7.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.7.2.2.2">𝑧</ci><ci id="S3.E6.m1.1.1.1.1.7.2.2.3.cmml" xref="S3.E6.m1.1.1.1.1.7.2.2.3">𝑡</ci></apply><ci id="S3.E6.m1.1.1.1.1.7.2.3.cmml" xref="S3.E6.m1.1.1.1.1.7.2.3">𝑖</ci></apply><apply id="S3.E6.m1.1.1.1.1.7.3.cmml" xref="S3.E6.m1.1.1.1.1.7.3"><times id="S3.E6.m1.1.1.1.1.7.3.1.cmml" xref="S3.E6.m1.1.1.1.1.7.3.1"></times><ci id="S3.E6.m1.1.1.1.1.7.3.2.cmml" xref="S3.E6.m1.1.1.1.1.7.3.2">𝑆</ci><apply id="S3.E6.m1.1.1.1.1.7.3.3.cmml" xref="S3.E6.m1.1.1.1.1.7.3.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.7.3.3.1.cmml" xref="S3.E6.m1.1.1.1.1.7.3.3">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.7.3.3.2.cmml" xref="S3.E6.m1.1.1.1.1.7.3.3.2">𝑃</ci><ci id="S3.E6.m1.1.1.1.1.7.3.3.3.cmml" xref="S3.E6.m1.1.1.1.1.7.3.3.3">𝑖</ci></apply></apply></apply></apply><apply id="S3.E6.m1.1.1.1.1c.cmml" xref="S3.E6.m1.1.1.1"><eq id="S3.E6.m1.1.1.1.1.8.cmml" xref="S3.E6.m1.1.1.1.1.8"></eq><share href="https://arxiv.org/html/2410.01573v1#S3.E6.m1.1.1.1.1.7.cmml" id="S3.E6.m1.1.1.1.1d.cmml" xref="S3.E6.m1.1.1.1"></share><apply id="S3.E6.m1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.3"><plus id="S3.E6.m1.1.1.1.1.3.4.cmml" xref="S3.E6.m1.1.1.1.1.3.4"></plus><apply id="S3.E6.m1.1.1.1.1.3.5.cmml" xref="S3.E6.m1.1.1.1.1.3.5"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.3.5.1.cmml" xref="S3.E6.m1.1.1.1.1.3.5">subscript</csymbol><apply id="S3.E6.m1.1.1.1.1.3.5.2.cmml" xref="S3.E6.m1.1.1.1.1.3.5"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.3.5.2.1.cmml" xref="S3.E6.m1.1.1.1.1.3.5">superscript</csymbol><ci id="S3.E6.m1.1.1.1.1.3.5.2.2.cmml" xref="S3.E6.m1.1.1.1.1.3.5.2.2">𝑧</ci><ci id="S3.E6.m1.1.1.1.1.3.5.2.3.cmml" xref="S3.E6.m1.1.1.1.1.3.5.2.3">𝑡</ci></apply><ci id="S3.E6.m1.1.1.1.1.3.5.3.cmml" xref="S3.E6.m1.1.1.1.1.3.5.3">𝑖</ci></apply><apply id="S3.E6.m1.1.1.1.1.3.3.cmml" xref="S3.E6.m1.1.1.1.1.3.3"><times id="S3.E6.m1.1.1.1.1.3.3.4.cmml" xref="S3.E6.m1.1.1.1.1.3.3.4"></times><ci id="S3.E6.m1.1.1.1.1.3.3.5a.cmml" xref="S3.E6.m1.1.1.1.1.3.3.5"><mtext id="S3.E6.m1.1.1.1.1.3.3.5.cmml" xref="S3.E6.m1.1.1.1.1.3.3.5">CAPM</mtext></ci><vector id="S3.E6.m1.1.1.1.1.3.3.3.4.cmml" xref="S3.E6.m1.1.1.1.1.3.3.3.3"><apply id="S3.E6.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.2">𝑉</ci><ci id="S3.E6.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E6.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.2.2.2.2.2.1.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2">subscript</csymbol><apply id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.1.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2">superscript</csymbol><ci id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.2">𝐴</ci><times id="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.2.3"></times></apply><ci id="S3.E6.m1.1.1.1.1.2.2.2.2.2.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2.2.3">𝑖</ci></apply><apply id="S3.E6.m1.1.1.1.1.3.3.3.3.3.cmml" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.3.3.3.3.3.1.cmml" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.3.3.3.3.3.2.cmml" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3.2">italic-ϕ</ci><ci id="S3.E6.m1.1.1.1.1.3.3.3.3.3.3.cmml" xref="S3.E6.m1.1.1.1.1.3.3.3.3.3.3">𝑀</ci></apply></vector></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.1c">\tilde{z}^{t}_{i}={z}^{t}_{i}+SP_{i}={z}^{t}_{i}+\textrm{CAPM}(V_{i},A^{*}_{i}%
;\phi_{M}),</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.1d">over~ start_ARG italic_z end_ARG start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT + italic_S italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_z start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT + CAPM ( italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_A start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_ϕ start_POSTSUBSCRIPT italic_M end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p2.19">in which <math alttext="\phi_{M}=\{\phi_{sp},\phi_{q},\phi_{k},\phi_{v}\}" class="ltx_Math" display="inline" id="S3.SS3.p2.19.m1.4"><semantics id="S3.SS3.p2.19.m1.4a"><mrow id="S3.SS3.p2.19.m1.4.4" xref="S3.SS3.p2.19.m1.4.4.cmml"><msub id="S3.SS3.p2.19.m1.4.4.6" xref="S3.SS3.p2.19.m1.4.4.6.cmml"><mi id="S3.SS3.p2.19.m1.4.4.6.2" xref="S3.SS3.p2.19.m1.4.4.6.2.cmml">ϕ</mi><mi id="S3.SS3.p2.19.m1.4.4.6.3" xref="S3.SS3.p2.19.m1.4.4.6.3.cmml">M</mi></msub><mo id="S3.SS3.p2.19.m1.4.4.5" xref="S3.SS3.p2.19.m1.4.4.5.cmml">=</mo><mrow id="S3.SS3.p2.19.m1.4.4.4.4" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml"><mo id="S3.SS3.p2.19.m1.4.4.4.4.5" stretchy="false" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml">{</mo><msub id="S3.SS3.p2.19.m1.1.1.1.1.1" xref="S3.SS3.p2.19.m1.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.19.m1.1.1.1.1.1.2" xref="S3.SS3.p2.19.m1.1.1.1.1.1.2.cmml">ϕ</mi><mrow id="S3.SS3.p2.19.m1.1.1.1.1.1.3" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.cmml"><mi id="S3.SS3.p2.19.m1.1.1.1.1.1.3.2" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.2.cmml">s</mi><mo id="S3.SS3.p2.19.m1.1.1.1.1.1.3.1" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.19.m1.1.1.1.1.1.3.3" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.3.cmml">p</mi></mrow></msub><mo id="S3.SS3.p2.19.m1.4.4.4.4.6" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml">,</mo><msub id="S3.SS3.p2.19.m1.2.2.2.2.2" xref="S3.SS3.p2.19.m1.2.2.2.2.2.cmml"><mi id="S3.SS3.p2.19.m1.2.2.2.2.2.2" xref="S3.SS3.p2.19.m1.2.2.2.2.2.2.cmml">ϕ</mi><mi id="S3.SS3.p2.19.m1.2.2.2.2.2.3" xref="S3.SS3.p2.19.m1.2.2.2.2.2.3.cmml">q</mi></msub><mo id="S3.SS3.p2.19.m1.4.4.4.4.7" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml">,</mo><msub id="S3.SS3.p2.19.m1.3.3.3.3.3" xref="S3.SS3.p2.19.m1.3.3.3.3.3.cmml"><mi id="S3.SS3.p2.19.m1.3.3.3.3.3.2" xref="S3.SS3.p2.19.m1.3.3.3.3.3.2.cmml">ϕ</mi><mi id="S3.SS3.p2.19.m1.3.3.3.3.3.3" xref="S3.SS3.p2.19.m1.3.3.3.3.3.3.cmml">k</mi></msub><mo id="S3.SS3.p2.19.m1.4.4.4.4.8" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml">,</mo><msub id="S3.SS3.p2.19.m1.4.4.4.4.4" xref="S3.SS3.p2.19.m1.4.4.4.4.4.cmml"><mi id="S3.SS3.p2.19.m1.4.4.4.4.4.2" xref="S3.SS3.p2.19.m1.4.4.4.4.4.2.cmml">ϕ</mi><mi id="S3.SS3.p2.19.m1.4.4.4.4.4.3" xref="S3.SS3.p2.19.m1.4.4.4.4.4.3.cmml">v</mi></msub><mo id="S3.SS3.p2.19.m1.4.4.4.4.9" stretchy="false" xref="S3.SS3.p2.19.m1.4.4.4.5.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.19.m1.4b"><apply id="S3.SS3.p2.19.m1.4.4.cmml" xref="S3.SS3.p2.19.m1.4.4"><eq id="S3.SS3.p2.19.m1.4.4.5.cmml" xref="S3.SS3.p2.19.m1.4.4.5"></eq><apply id="S3.SS3.p2.19.m1.4.4.6.cmml" xref="S3.SS3.p2.19.m1.4.4.6"><csymbol cd="ambiguous" id="S3.SS3.p2.19.m1.4.4.6.1.cmml" xref="S3.SS3.p2.19.m1.4.4.6">subscript</csymbol><ci id="S3.SS3.p2.19.m1.4.4.6.2.cmml" xref="S3.SS3.p2.19.m1.4.4.6.2">italic-ϕ</ci><ci id="S3.SS3.p2.19.m1.4.4.6.3.cmml" xref="S3.SS3.p2.19.m1.4.4.6.3">𝑀</ci></apply><set id="S3.SS3.p2.19.m1.4.4.4.5.cmml" xref="S3.SS3.p2.19.m1.4.4.4.4"><apply id="S3.SS3.p2.19.m1.1.1.1.1.1.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.19.m1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.19.m1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1.2">italic-ϕ</ci><apply id="S3.SS3.p2.19.m1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3"><times id="S3.SS3.p2.19.m1.1.1.1.1.1.3.1.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.1"></times><ci id="S3.SS3.p2.19.m1.1.1.1.1.1.3.2.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.2">𝑠</ci><ci id="S3.SS3.p2.19.m1.1.1.1.1.1.3.3.cmml" xref="S3.SS3.p2.19.m1.1.1.1.1.1.3.3">𝑝</ci></apply></apply><apply id="S3.SS3.p2.19.m1.2.2.2.2.2.cmml" xref="S3.SS3.p2.19.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.19.m1.2.2.2.2.2.1.cmml" xref="S3.SS3.p2.19.m1.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.19.m1.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.19.m1.2.2.2.2.2.2">italic-ϕ</ci><ci id="S3.SS3.p2.19.m1.2.2.2.2.2.3.cmml" xref="S3.SS3.p2.19.m1.2.2.2.2.2.3">𝑞</ci></apply><apply id="S3.SS3.p2.19.m1.3.3.3.3.3.cmml" xref="S3.SS3.p2.19.m1.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.SS3.p2.19.m1.3.3.3.3.3.1.cmml" xref="S3.SS3.p2.19.m1.3.3.3.3.3">subscript</csymbol><ci id="S3.SS3.p2.19.m1.3.3.3.3.3.2.cmml" xref="S3.SS3.p2.19.m1.3.3.3.3.3.2">italic-ϕ</ci><ci id="S3.SS3.p2.19.m1.3.3.3.3.3.3.cmml" xref="S3.SS3.p2.19.m1.3.3.3.3.3.3">𝑘</ci></apply><apply id="S3.SS3.p2.19.m1.4.4.4.4.4.cmml" xref="S3.SS3.p2.19.m1.4.4.4.4.4"><csymbol cd="ambiguous" id="S3.SS3.p2.19.m1.4.4.4.4.4.1.cmml" xref="S3.SS3.p2.19.m1.4.4.4.4.4">subscript</csymbol><ci id="S3.SS3.p2.19.m1.4.4.4.4.4.2.cmml" xref="S3.SS3.p2.19.m1.4.4.4.4.4.2">italic-ϕ</ci><ci id="S3.SS3.p2.19.m1.4.4.4.4.4.3.cmml" xref="S3.SS3.p2.19.m1.4.4.4.4.4.3">𝑣</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.19.m1.4c">\phi_{M}=\{\phi_{sp},\phi_{q},\phi_{k},\phi_{v}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.19.m1.4d">italic_ϕ start_POSTSUBSCRIPT italic_M end_POSTSUBSCRIPT = { italic_ϕ start_POSTSUBSCRIPT italic_s italic_p end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_ϕ start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT }</annotation></semantics></math>. The cross-attention distillation leads to refined shape prompts and thus improves the feature generalization.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>Alternating Momentum Updating Strategy</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.3">Online TTA is a challenging scenario where only one test sample is accessible at each adaptation step and the model is continually updated. If the current sample is far from the overall target distribution, the model updating from this sample is likely to cause detrimental effects on the remaining samples. To alleviate the instability caused by data variety and error accumulation, previous TTA approaches <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib31" title="">31</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite> adopt the teacher-student network architecture for parameter updating. The student network <math alttext="\mathcal{T}_{\theta_{i}}" class="ltx_Math" display="inline" id="S3.SS4.p1.1.m1.1"><semantics id="S3.SS4.p1.1.m1.1a"><msub id="S3.SS4.p1.1.m1.1.1" xref="S3.SS4.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p1.1.m1.1.1.2" xref="S3.SS4.p1.1.m1.1.1.2.cmml">𝒯</mi><msub id="S3.SS4.p1.1.m1.1.1.3" xref="S3.SS4.p1.1.m1.1.1.3.cmml"><mi id="S3.SS4.p1.1.m1.1.1.3.2" xref="S3.SS4.p1.1.m1.1.1.3.2.cmml">θ</mi><mi id="S3.SS4.p1.1.m1.1.1.3.3" xref="S3.SS4.p1.1.m1.1.1.3.3.cmml">i</mi></msub></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.1.m1.1b"><apply id="S3.SS4.p1.1.m1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.1.m1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.p1.1.m1.1.1.2.cmml" xref="S3.SS4.p1.1.m1.1.1.2">𝒯</ci><apply id="S3.SS4.p1.1.m1.1.1.3.cmml" xref="S3.SS4.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p1.1.m1.1.1.3.1.cmml" xref="S3.SS4.p1.1.m1.1.1.3">subscript</csymbol><ci id="S3.SS4.p1.1.m1.1.1.3.2.cmml" xref="S3.SS4.p1.1.m1.1.1.3.2">𝜃</ci><ci id="S3.SS4.p1.1.m1.1.1.3.3.cmml" xref="S3.SS4.p1.1.m1.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.1.m1.1c">\mathcal{T}_{\theta_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.1.m1.1d">caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> is online updated with the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS4.p1.2.m2.1"><semantics id="S3.SS4.p1.2.m2.1a"><mi id="S3.SS4.p1.2.m2.1.1" xref="S3.SS4.p1.2.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.2.m2.1b"><ci id="S3.SS4.p1.2.m2.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.2.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.2.m2.1d">italic_i</annotation></semantics></math>-th sequentially arrived sample, whereas the weights of the teacher network <math alttext="\mathcal{T}_{\theta^{\prime}_{i-1}}\rightarrow\mathcal{T}_{\theta^{\prime}_{i}}" class="ltx_Math" display="inline" id="S3.SS4.p1.3.m3.1"><semantics id="S3.SS4.p1.3.m3.1a"><mrow id="S3.SS4.p1.3.m3.1.1" xref="S3.SS4.p1.3.m3.1.1.cmml"><msub id="S3.SS4.p1.3.m3.1.1.2" xref="S3.SS4.p1.3.m3.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p1.3.m3.1.1.2.2" xref="S3.SS4.p1.3.m3.1.1.2.2.cmml">𝒯</mi><msubsup id="S3.SS4.p1.3.m3.1.1.2.3" xref="S3.SS4.p1.3.m3.1.1.2.3.cmml"><mi id="S3.SS4.p1.3.m3.1.1.2.3.2.2" xref="S3.SS4.p1.3.m3.1.1.2.3.2.2.cmml">θ</mi><mrow id="S3.SS4.p1.3.m3.1.1.2.3.3" xref="S3.SS4.p1.3.m3.1.1.2.3.3.cmml"><mi id="S3.SS4.p1.3.m3.1.1.2.3.3.2" xref="S3.SS4.p1.3.m3.1.1.2.3.3.2.cmml">i</mi><mo id="S3.SS4.p1.3.m3.1.1.2.3.3.1" xref="S3.SS4.p1.3.m3.1.1.2.3.3.1.cmml">−</mo><mn id="S3.SS4.p1.3.m3.1.1.2.3.3.3" xref="S3.SS4.p1.3.m3.1.1.2.3.3.3.cmml">1</mn></mrow><mo id="S3.SS4.p1.3.m3.1.1.2.3.2.3" xref="S3.SS4.p1.3.m3.1.1.2.3.2.3.cmml">′</mo></msubsup></msub><mo id="S3.SS4.p1.3.m3.1.1.1" stretchy="false" xref="S3.SS4.p1.3.m3.1.1.1.cmml">→</mo><msub id="S3.SS4.p1.3.m3.1.1.3" xref="S3.SS4.p1.3.m3.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p1.3.m3.1.1.3.2" xref="S3.SS4.p1.3.m3.1.1.3.2.cmml">𝒯</mi><msubsup id="S3.SS4.p1.3.m3.1.1.3.3" xref="S3.SS4.p1.3.m3.1.1.3.3.cmml"><mi id="S3.SS4.p1.3.m3.1.1.3.3.2.2" xref="S3.SS4.p1.3.m3.1.1.3.3.2.2.cmml">θ</mi><mi id="S3.SS4.p1.3.m3.1.1.3.3.3" xref="S3.SS4.p1.3.m3.1.1.3.3.3.cmml">i</mi><mo id="S3.SS4.p1.3.m3.1.1.3.3.2.3" xref="S3.SS4.p1.3.m3.1.1.3.3.2.3.cmml">′</mo></msubsup></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.3.m3.1b"><apply id="S3.SS4.p1.3.m3.1.1.cmml" xref="S3.SS4.p1.3.m3.1.1"><ci id="S3.SS4.p1.3.m3.1.1.1.cmml" xref="S3.SS4.p1.3.m3.1.1.1">→</ci><apply id="S3.SS4.p1.3.m3.1.1.2.cmml" xref="S3.SS4.p1.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.2.1.cmml" xref="S3.SS4.p1.3.m3.1.1.2">subscript</csymbol><ci id="S3.SS4.p1.3.m3.1.1.2.2.cmml" xref="S3.SS4.p1.3.m3.1.1.2.2">𝒯</ci><apply id="S3.SS4.p1.3.m3.1.1.2.3.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.2.3.1.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3">subscript</csymbol><apply id="S3.SS4.p1.3.m3.1.1.2.3.2.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.2.3.2.1.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3">superscript</csymbol><ci id="S3.SS4.p1.3.m3.1.1.2.3.2.2.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3.2.2">𝜃</ci><ci id="S3.SS4.p1.3.m3.1.1.2.3.2.3.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3.2.3">′</ci></apply><apply id="S3.SS4.p1.3.m3.1.1.2.3.3.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3.3"><minus id="S3.SS4.p1.3.m3.1.1.2.3.3.1.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3.3.1"></minus><ci id="S3.SS4.p1.3.m3.1.1.2.3.3.2.cmml" xref="S3.SS4.p1.3.m3.1.1.2.3.3.2">𝑖</ci><cn id="S3.SS4.p1.3.m3.1.1.2.3.3.3.cmml" type="integer" xref="S3.SS4.p1.3.m3.1.1.2.3.3.3">1</cn></apply></apply></apply><apply id="S3.SS4.p1.3.m3.1.1.3.cmml" xref="S3.SS4.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.3.1.cmml" xref="S3.SS4.p1.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS4.p1.3.m3.1.1.3.2.cmml" xref="S3.SS4.p1.3.m3.1.1.3.2">𝒯</ci><apply id="S3.SS4.p1.3.m3.1.1.3.3.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.3.3.1.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3">subscript</csymbol><apply id="S3.SS4.p1.3.m3.1.1.3.3.2.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS4.p1.3.m3.1.1.3.3.2.1.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3">superscript</csymbol><ci id="S3.SS4.p1.3.m3.1.1.3.3.2.2.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3.2.2">𝜃</ci><ci id="S3.SS4.p1.3.m3.1.1.3.3.2.3.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3.2.3">′</ci></apply><ci id="S3.SS4.p1.3.m3.1.1.3.3.3.cmml" xref="S3.SS4.p1.3.m3.1.1.3.3.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.3.m3.1c">\mathcal{T}_{\theta^{\prime}_{i-1}}\rightarrow\mathcal{T}_{\theta^{\prime}_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.3.m3.1d">caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT → caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> is updated by the exponential-moving-average (EMA) strategy:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\prime}_{i}=(1-m){\theta^{\prime}_{i-1}}+m{\theta_{i}}." class="ltx_Math" display="block" id="S3.E7.m1.1"><semantics id="S3.E7.m1.1a"><mrow id="S3.E7.m1.1.1.1" xref="S3.E7.m1.1.1.1.1.cmml"><mrow id="S3.E7.m1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.cmml"><msubsup id="S3.E7.m1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.3.cmml"><mi id="S3.E7.m1.1.1.1.1.3.2.2" xref="S3.E7.m1.1.1.1.1.3.2.2.cmml">θ</mi><mi id="S3.E7.m1.1.1.1.1.3.3" xref="S3.E7.m1.1.1.1.1.3.3.cmml">i</mi><mo id="S3.E7.m1.1.1.1.1.3.2.3" xref="S3.E7.m1.1.1.1.1.3.2.3.cmml">′</mo></msubsup><mo id="S3.E7.m1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.2.cmml">=</mo><mrow id="S3.E7.m1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.cmml"><mrow id="S3.E7.m1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.cmml"><mrow id="S3.E7.m1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E7.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E7.m1.1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml"><mn id="S3.E7.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.2.cmml">1</mn><mo id="S3.E7.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.1.cmml">−</mo><mi id="S3.E7.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.3.cmml">m</mi></mrow><mo id="S3.E7.m1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E7.m1.1.1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.1.1.2.cmml">⁢</mo><msubsup id="S3.E7.m1.1.1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.1.1.3.cmml"><mi id="S3.E7.m1.1.1.1.1.1.1.3.2.2" xref="S3.E7.m1.1.1.1.1.1.1.3.2.2.cmml">θ</mi><mrow id="S3.E7.m1.1.1.1.1.1.1.3.3" xref="S3.E7.m1.1.1.1.1.1.1.3.3.cmml"><mi id="S3.E7.m1.1.1.1.1.1.1.3.3.2" xref="S3.E7.m1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="S3.E7.m1.1.1.1.1.1.1.3.3.1" xref="S3.E7.m1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="S3.E7.m1.1.1.1.1.1.1.3.3.3" xref="S3.E7.m1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow><mo id="S3.E7.m1.1.1.1.1.1.1.3.2.3" xref="S3.E7.m1.1.1.1.1.1.1.3.2.3.cmml">′</mo></msubsup></mrow><mo id="S3.E7.m1.1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.1.2.cmml">+</mo><mrow id="S3.E7.m1.1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.1.3.cmml"><mi id="S3.E7.m1.1.1.1.1.1.3.2" xref="S3.E7.m1.1.1.1.1.1.3.2.cmml">m</mi><mo id="S3.E7.m1.1.1.1.1.1.3.1" xref="S3.E7.m1.1.1.1.1.1.3.1.cmml">⁢</mo><msub id="S3.E7.m1.1.1.1.1.1.3.3" xref="S3.E7.m1.1.1.1.1.1.3.3.cmml"><mi id="S3.E7.m1.1.1.1.1.1.3.3.2" xref="S3.E7.m1.1.1.1.1.1.3.3.2.cmml">θ</mi><mi id="S3.E7.m1.1.1.1.1.1.3.3.3" xref="S3.E7.m1.1.1.1.1.1.3.3.3.cmml">i</mi></msub></mrow></mrow></mrow><mo id="S3.E7.m1.1.1.1.2" lspace="0em" xref="S3.E7.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E7.m1.1b"><apply id="S3.E7.m1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1"><eq id="S3.E7.m1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.2"></eq><apply id="S3.E7.m1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.1.1.1.1.3">subscript</csymbol><apply id="S3.E7.m1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.3.2.1.cmml" xref="S3.E7.m1.1.1.1.1.3">superscript</csymbol><ci id="S3.E7.m1.1.1.1.1.3.2.2.cmml" xref="S3.E7.m1.1.1.1.1.3.2.2">𝜃</ci><ci id="S3.E7.m1.1.1.1.1.3.2.3.cmml" xref="S3.E7.m1.1.1.1.1.3.2.3">′</ci></apply><ci id="S3.E7.m1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.1.1.1.1.3.3">𝑖</ci></apply><apply id="S3.E7.m1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1"><plus id="S3.E7.m1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.1.2"></plus><apply id="S3.E7.m1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1"><times id="S3.E7.m1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.2"></times><apply id="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1"><minus id="S3.E7.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.1"></minus><cn id="S3.E7.m1.1.1.1.1.1.1.1.1.1.2.cmml" type="integer" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.2">1</cn><ci id="S3.E7.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.1.3">𝑚</ci></apply><apply id="S3.E7.m1.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3">subscript</csymbol><apply id="S3.E7.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.E7.m1.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3.2.2">𝜃</ci><ci id="S3.E7.m1.1.1.1.1.1.1.3.2.3.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3.2.3">′</ci></apply><apply id="S3.E7.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3.3"><minus id="S3.E7.m1.1.1.1.1.1.1.3.3.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3.3.1"></minus><ci id="S3.E7.m1.1.1.1.1.1.1.3.3.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="S3.E7.m1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="S3.E7.m1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply><apply id="S3.E7.m1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.1.3"><times id="S3.E7.m1.1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.1.1.1.1.1.3.1"></times><ci id="S3.E7.m1.1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.1.1.1.1.1.3.2">𝑚</ci><apply id="S3.E7.m1.1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.1.3.3.1.cmml" xref="S3.E7.m1.1.1.1.1.1.3.3">subscript</csymbol><ci id="S3.E7.m1.1.1.1.1.1.3.3.2.cmml" xref="S3.E7.m1.1.1.1.1.1.3.3.2">𝜃</ci><ci id="S3.E7.m1.1.1.1.1.1.3.3.3.cmml" xref="S3.E7.m1.1.1.1.1.1.3.3.3">𝑖</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E7.m1.1c">\theta^{\prime}_{i}=(1-m){\theta^{\prime}_{i-1}}+m{\theta_{i}}.</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.1d">italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = ( 1 - italic_m ) italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT + italic_m italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.1">In this way, the teacher network accumulates new knowledge without forgetting historical knowledge. Usually, the updated parameters in the teacher model are used for predictions<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib31" title="">31</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite>. However, we keep the teacher network as a buffer for historical knowledge restoration and use the student network for a quick adaptation to the test sample. At each step with new test data, the student network is reset by the teacher network and adapted accordingly to this data.
Moreover, we argue that the fixed momentum <math alttext="m" class="ltx_Math" display="inline" id="S3.SS4.p2.1.m1.1"><semantics id="S3.SS4.p2.1.m1.1a"><mi id="S3.SS4.p2.1.m1.1.1" xref="S3.SS4.p2.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.1.m1.1b"><ci id="S3.SS4.p2.1.m1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.1.m1.1d">italic_m</annotation></semantics></math> in EMA could cause the forgetting of source knowledge in long-term TTA. For stable adaptation and fast convergence, we propose to adapt the momentum with each incoming sample:
<br class="ltx_break"/></p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="m_{i+1}=c+m_{i}\omega" class="ltx_Math" display="block" id="S3.E8.m1.1"><semantics id="S3.E8.m1.1a"><mrow id="S3.E8.m1.1.1" xref="S3.E8.m1.1.1.cmml"><msub id="S3.E8.m1.1.1.2" xref="S3.E8.m1.1.1.2.cmml"><mi id="S3.E8.m1.1.1.2.2" xref="S3.E8.m1.1.1.2.2.cmml">m</mi><mrow id="S3.E8.m1.1.1.2.3" xref="S3.E8.m1.1.1.2.3.cmml"><mi id="S3.E8.m1.1.1.2.3.2" xref="S3.E8.m1.1.1.2.3.2.cmml">i</mi><mo id="S3.E8.m1.1.1.2.3.1" xref="S3.E8.m1.1.1.2.3.1.cmml">+</mo><mn id="S3.E8.m1.1.1.2.3.3" xref="S3.E8.m1.1.1.2.3.3.cmml">1</mn></mrow></msub><mo id="S3.E8.m1.1.1.1" xref="S3.E8.m1.1.1.1.cmml">=</mo><mrow id="S3.E8.m1.1.1.3" xref="S3.E8.m1.1.1.3.cmml"><mi id="S3.E8.m1.1.1.3.2" xref="S3.E8.m1.1.1.3.2.cmml">c</mi><mo id="S3.E8.m1.1.1.3.1" xref="S3.E8.m1.1.1.3.1.cmml">+</mo><mrow id="S3.E8.m1.1.1.3.3" xref="S3.E8.m1.1.1.3.3.cmml"><msub id="S3.E8.m1.1.1.3.3.2" xref="S3.E8.m1.1.1.3.3.2.cmml"><mi id="S3.E8.m1.1.1.3.3.2.2" xref="S3.E8.m1.1.1.3.3.2.2.cmml">m</mi><mi id="S3.E8.m1.1.1.3.3.2.3" xref="S3.E8.m1.1.1.3.3.2.3.cmml">i</mi></msub><mo id="S3.E8.m1.1.1.3.3.1" xref="S3.E8.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E8.m1.1.1.3.3.3" xref="S3.E8.m1.1.1.3.3.3.cmml">ω</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E8.m1.1b"><apply id="S3.E8.m1.1.1.cmml" xref="S3.E8.m1.1.1"><eq id="S3.E8.m1.1.1.1.cmml" xref="S3.E8.m1.1.1.1"></eq><apply id="S3.E8.m1.1.1.2.cmml" xref="S3.E8.m1.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.1.1.2.1.cmml" xref="S3.E8.m1.1.1.2">subscript</csymbol><ci id="S3.E8.m1.1.1.2.2.cmml" xref="S3.E8.m1.1.1.2.2">𝑚</ci><apply id="S3.E8.m1.1.1.2.3.cmml" xref="S3.E8.m1.1.1.2.3"><plus id="S3.E8.m1.1.1.2.3.1.cmml" xref="S3.E8.m1.1.1.2.3.1"></plus><ci id="S3.E8.m1.1.1.2.3.2.cmml" xref="S3.E8.m1.1.1.2.3.2">𝑖</ci><cn id="S3.E8.m1.1.1.2.3.3.cmml" type="integer" xref="S3.E8.m1.1.1.2.3.3">1</cn></apply></apply><apply id="S3.E8.m1.1.1.3.cmml" xref="S3.E8.m1.1.1.3"><plus id="S3.E8.m1.1.1.3.1.cmml" xref="S3.E8.m1.1.1.3.1"></plus><ci id="S3.E8.m1.1.1.3.2.cmml" xref="S3.E8.m1.1.1.3.2">𝑐</ci><apply id="S3.E8.m1.1.1.3.3.cmml" xref="S3.E8.m1.1.1.3.3"><times id="S3.E8.m1.1.1.3.3.1.cmml" xref="S3.E8.m1.1.1.3.3.1"></times><apply id="S3.E8.m1.1.1.3.3.2.cmml" xref="S3.E8.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="S3.E8.m1.1.1.3.3.2.1.cmml" xref="S3.E8.m1.1.1.3.3.2">subscript</csymbol><ci id="S3.E8.m1.1.1.3.3.2.2.cmml" xref="S3.E8.m1.1.1.3.3.2.2">𝑚</ci><ci id="S3.E8.m1.1.1.3.3.2.3.cmml" xref="S3.E8.m1.1.1.3.3.2.3">𝑖</ci></apply><ci id="S3.E8.m1.1.1.3.3.3.cmml" xref="S3.E8.m1.1.1.3.3.3">𝜔</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E8.m1.1c">m_{i+1}=c+m_{i}\omega</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT = italic_c + italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_ω</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p2.6">Where <math alttext="c=0.005" class="ltx_Math" display="inline" id="S3.SS4.p2.2.m1.1"><semantics id="S3.SS4.p2.2.m1.1a"><mrow id="S3.SS4.p2.2.m1.1.1" xref="S3.SS4.p2.2.m1.1.1.cmml"><mi id="S3.SS4.p2.2.m1.1.1.2" xref="S3.SS4.p2.2.m1.1.1.2.cmml">c</mi><mo id="S3.SS4.p2.2.m1.1.1.1" xref="S3.SS4.p2.2.m1.1.1.1.cmml">=</mo><mn id="S3.SS4.p2.2.m1.1.1.3" xref="S3.SS4.p2.2.m1.1.1.3.cmml">0.005</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.2.m1.1b"><apply id="S3.SS4.p2.2.m1.1.1.cmml" xref="S3.SS4.p2.2.m1.1.1"><eq id="S3.SS4.p2.2.m1.1.1.1.cmml" xref="S3.SS4.p2.2.m1.1.1.1"></eq><ci id="S3.SS4.p2.2.m1.1.1.2.cmml" xref="S3.SS4.p2.2.m1.1.1.2">𝑐</ci><cn id="S3.SS4.p2.2.m1.1.1.3.cmml" type="float" xref="S3.SS4.p2.2.m1.1.1.3">0.005</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.2.m1.1c">c=0.005</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.2.m1.1d">italic_c = 0.005</annotation></semantics></math> is a constant to ensure the lower bound of <math alttext="m_{i}" class="ltx_Math" display="inline" id="S3.SS4.p2.3.m2.1"><semantics id="S3.SS4.p2.3.m2.1a"><msub id="S3.SS4.p2.3.m2.1.1" xref="S3.SS4.p2.3.m2.1.1.cmml"><mi id="S3.SS4.p2.3.m2.1.1.2" xref="S3.SS4.p2.3.m2.1.1.2.cmml">m</mi><mi id="S3.SS4.p2.3.m2.1.1.3" xref="S3.SS4.p2.3.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.3.m2.1b"><apply id="S3.SS4.p2.3.m2.1.1.cmml" xref="S3.SS4.p2.3.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.3.m2.1.1.1.cmml" xref="S3.SS4.p2.3.m2.1.1">subscript</csymbol><ci id="S3.SS4.p2.3.m2.1.1.2.cmml" xref="S3.SS4.p2.3.m2.1.1.2">𝑚</ci><ci id="S3.SS4.p2.3.m2.1.1.3.cmml" xref="S3.SS4.p2.3.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.3.m2.1c">m_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.3.m2.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\omega\in[0,1]" class="ltx_Math" display="inline" id="S3.SS4.p2.4.m3.2"><semantics id="S3.SS4.p2.4.m3.2a"><mrow id="S3.SS4.p2.4.m3.2.3" xref="S3.SS4.p2.4.m3.2.3.cmml"><mi id="S3.SS4.p2.4.m3.2.3.2" xref="S3.SS4.p2.4.m3.2.3.2.cmml">ω</mi><mo id="S3.SS4.p2.4.m3.2.3.1" xref="S3.SS4.p2.4.m3.2.3.1.cmml">∈</mo><mrow id="S3.SS4.p2.4.m3.2.3.3.2" xref="S3.SS4.p2.4.m3.2.3.3.1.cmml"><mo id="S3.SS4.p2.4.m3.2.3.3.2.1" stretchy="false" xref="S3.SS4.p2.4.m3.2.3.3.1.cmml">[</mo><mn id="S3.SS4.p2.4.m3.1.1" xref="S3.SS4.p2.4.m3.1.1.cmml">0</mn><mo id="S3.SS4.p2.4.m3.2.3.3.2.2" xref="S3.SS4.p2.4.m3.2.3.3.1.cmml">,</mo><mn id="S3.SS4.p2.4.m3.2.2" xref="S3.SS4.p2.4.m3.2.2.cmml">1</mn><mo id="S3.SS4.p2.4.m3.2.3.3.2.3" stretchy="false" xref="S3.SS4.p2.4.m3.2.3.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.4.m3.2b"><apply id="S3.SS4.p2.4.m3.2.3.cmml" xref="S3.SS4.p2.4.m3.2.3"><in id="S3.SS4.p2.4.m3.2.3.1.cmml" xref="S3.SS4.p2.4.m3.2.3.1"></in><ci id="S3.SS4.p2.4.m3.2.3.2.cmml" xref="S3.SS4.p2.4.m3.2.3.2">𝜔</ci><interval closure="closed" id="S3.SS4.p2.4.m3.2.3.3.1.cmml" xref="S3.SS4.p2.4.m3.2.3.3.2"><cn id="S3.SS4.p2.4.m3.1.1.cmml" type="integer" xref="S3.SS4.p2.4.m3.1.1">0</cn><cn id="S3.SS4.p2.4.m3.2.2.cmml" type="integer" xref="S3.SS4.p2.4.m3.2.2">1</cn></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.4.m3.2c">\omega\in[0,1]</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.4.m3.2d">italic_ω ∈ [ 0 , 1 ]</annotation></semantics></math> is a decay factor. We set <math alttext="m_{0}=0.1" class="ltx_Math" display="inline" id="S3.SS4.p2.5.m4.1"><semantics id="S3.SS4.p2.5.m4.1a"><mrow id="S3.SS4.p2.5.m4.1.1" xref="S3.SS4.p2.5.m4.1.1.cmml"><msub id="S3.SS4.p2.5.m4.1.1.2" xref="S3.SS4.p2.5.m4.1.1.2.cmml"><mi id="S3.SS4.p2.5.m4.1.1.2.2" xref="S3.SS4.p2.5.m4.1.1.2.2.cmml">m</mi><mn id="S3.SS4.p2.5.m4.1.1.2.3" xref="S3.SS4.p2.5.m4.1.1.2.3.cmml">0</mn></msub><mo id="S3.SS4.p2.5.m4.1.1.1" xref="S3.SS4.p2.5.m4.1.1.1.cmml">=</mo><mn id="S3.SS4.p2.5.m4.1.1.3" xref="S3.SS4.p2.5.m4.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.5.m4.1b"><apply id="S3.SS4.p2.5.m4.1.1.cmml" xref="S3.SS4.p2.5.m4.1.1"><eq id="S3.SS4.p2.5.m4.1.1.1.cmml" xref="S3.SS4.p2.5.m4.1.1.1"></eq><apply id="S3.SS4.p2.5.m4.1.1.2.cmml" xref="S3.SS4.p2.5.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p2.5.m4.1.1.2.1.cmml" xref="S3.SS4.p2.5.m4.1.1.2">subscript</csymbol><ci id="S3.SS4.p2.5.m4.1.1.2.2.cmml" xref="S3.SS4.p2.5.m4.1.1.2.2">𝑚</ci><cn id="S3.SS4.p2.5.m4.1.1.2.3.cmml" type="integer" xref="S3.SS4.p2.5.m4.1.1.2.3">0</cn></apply><cn id="S3.SS4.p2.5.m4.1.1.3.cmml" type="float" xref="S3.SS4.p2.5.m4.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.5.m4.1c">m_{0}=0.1</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.5.m4.1d">italic_m start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT = 0.1</annotation></semantics></math> at the beginning of adaptation. As the momentum <math alttext="m_{i}" class="ltx_Math" display="inline" id="S3.SS4.p2.6.m5.1"><semantics id="S3.SS4.p2.6.m5.1a"><msub id="S3.SS4.p2.6.m5.1.1" xref="S3.SS4.p2.6.m5.1.1.cmml"><mi id="S3.SS4.p2.6.m5.1.1.2" xref="S3.SS4.p2.6.m5.1.1.2.cmml">m</mi><mi id="S3.SS4.p2.6.m5.1.1.3" xref="S3.SS4.p2.6.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.6.m5.1b"><apply id="S3.SS4.p2.6.m5.1.1.cmml" xref="S3.SS4.p2.6.m5.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.6.m5.1.1.1.cmml" xref="S3.SS4.p2.6.m5.1.1">subscript</csymbol><ci id="S3.SS4.p2.6.m5.1.1.2.cmml" xref="S3.SS4.p2.6.m5.1.1.2">𝑚</ci><ci id="S3.SS4.p2.6.m5.1.1.3.cmml" xref="S3.SS4.p2.6.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.6.m5.1c">m_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.6.m5.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> decays, the later samples will have a smaller impact, thereby avoiding the catastrophic forgetting problem. Our momentum decay strategy for updating trainable parameters actually shares a similar idea with the statistic updating scheme for BN layers in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>. The overall procedures of our PASS approach for online TTA are summarized in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#alg1" title="Algorithm 1 ‣ 3.4 Alternating Momentum Updating Strategy ‣ 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.13.1.1">Algorithm 1</span> </span> PASS in online test-time adaptation setting.</figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="alg1.11"><span class="ltx_text ltx_font_bold" id="alg1.11.1">Initialize:</span>
A teacher model <math alttext="\mathcal{T}_{\theta^{\prime}_{0}}" class="ltx_Math" display="inline" id="alg1.1.m1.1"><semantics id="alg1.1.m1.1a"><msub id="alg1.1.m1.1.1" xref="alg1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.1.m1.1.1.2" xref="alg1.1.m1.1.1.2.cmml">𝒯</mi><msubsup id="alg1.1.m1.1.1.3" xref="alg1.1.m1.1.1.3.cmml"><mi id="alg1.1.m1.1.1.3.2.2" xref="alg1.1.m1.1.1.3.2.2.cmml">θ</mi><mn id="alg1.1.m1.1.1.3.3" xref="alg1.1.m1.1.1.3.3.cmml">0</mn><mo id="alg1.1.m1.1.1.3.2.3" xref="alg1.1.m1.1.1.3.2.3.cmml">′</mo></msubsup></msub><annotation-xml encoding="MathML-Content" id="alg1.1.m1.1b"><apply id="alg1.1.m1.1.1.cmml" xref="alg1.1.m1.1.1"><csymbol cd="ambiguous" id="alg1.1.m1.1.1.1.cmml" xref="alg1.1.m1.1.1">subscript</csymbol><ci id="alg1.1.m1.1.1.2.cmml" xref="alg1.1.m1.1.1.2">𝒯</ci><apply id="alg1.1.m1.1.1.3.cmml" xref="alg1.1.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.1.m1.1.1.3.1.cmml" xref="alg1.1.m1.1.1.3">subscript</csymbol><apply id="alg1.1.m1.1.1.3.2.cmml" xref="alg1.1.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.1.m1.1.1.3.2.1.cmml" xref="alg1.1.m1.1.1.3">superscript</csymbol><ci id="alg1.1.m1.1.1.3.2.2.cmml" xref="alg1.1.m1.1.1.3.2.2">𝜃</ci><ci id="alg1.1.m1.1.1.3.2.3.cmml" xref="alg1.1.m1.1.1.3.2.3">′</ci></apply><cn id="alg1.1.m1.1.1.3.3.cmml" type="integer" xref="alg1.1.m1.1.1.3.3">0</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.1.m1.1c">\mathcal{T}_{\theta^{\prime}_{0}}</annotation><annotation encoding="application/x-llamapun" id="alg1.1.m1.1d">caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> (<math alttext="\theta^{\prime}_{0}=\{\psi^{\prime}_{0},\phi^{\prime}_{0}\}" class="ltx_Math" display="inline" id="alg1.2.m2.2"><semantics id="alg1.2.m2.2a"><mrow id="alg1.2.m2.2.2" xref="alg1.2.m2.2.2.cmml"><msubsup id="alg1.2.m2.2.2.4" xref="alg1.2.m2.2.2.4.cmml"><mi id="alg1.2.m2.2.2.4.2.2" xref="alg1.2.m2.2.2.4.2.2.cmml">θ</mi><mn id="alg1.2.m2.2.2.4.3" xref="alg1.2.m2.2.2.4.3.cmml">0</mn><mo id="alg1.2.m2.2.2.4.2.3" xref="alg1.2.m2.2.2.4.2.3.cmml">′</mo></msubsup><mo id="alg1.2.m2.2.2.3" xref="alg1.2.m2.2.2.3.cmml">=</mo><mrow id="alg1.2.m2.2.2.2.2" xref="alg1.2.m2.2.2.2.3.cmml"><mo id="alg1.2.m2.2.2.2.2.3" stretchy="false" xref="alg1.2.m2.2.2.2.3.cmml">{</mo><msubsup id="alg1.2.m2.1.1.1.1.1" xref="alg1.2.m2.1.1.1.1.1.cmml"><mi id="alg1.2.m2.1.1.1.1.1.2.2" xref="alg1.2.m2.1.1.1.1.1.2.2.cmml">ψ</mi><mn id="alg1.2.m2.1.1.1.1.1.3" xref="alg1.2.m2.1.1.1.1.1.3.cmml">0</mn><mo id="alg1.2.m2.1.1.1.1.1.2.3" xref="alg1.2.m2.1.1.1.1.1.2.3.cmml">′</mo></msubsup><mo id="alg1.2.m2.2.2.2.2.4" xref="alg1.2.m2.2.2.2.3.cmml">,</mo><msubsup id="alg1.2.m2.2.2.2.2.2" xref="alg1.2.m2.2.2.2.2.2.cmml"><mi id="alg1.2.m2.2.2.2.2.2.2.2" xref="alg1.2.m2.2.2.2.2.2.2.2.cmml">ϕ</mi><mn id="alg1.2.m2.2.2.2.2.2.3" xref="alg1.2.m2.2.2.2.2.2.3.cmml">0</mn><mo id="alg1.2.m2.2.2.2.2.2.2.3" xref="alg1.2.m2.2.2.2.2.2.2.3.cmml">′</mo></msubsup><mo id="alg1.2.m2.2.2.2.2.5" stretchy="false" xref="alg1.2.m2.2.2.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.2.m2.2b"><apply id="alg1.2.m2.2.2.cmml" xref="alg1.2.m2.2.2"><eq id="alg1.2.m2.2.2.3.cmml" xref="alg1.2.m2.2.2.3"></eq><apply id="alg1.2.m2.2.2.4.cmml" xref="alg1.2.m2.2.2.4"><csymbol cd="ambiguous" id="alg1.2.m2.2.2.4.1.cmml" xref="alg1.2.m2.2.2.4">subscript</csymbol><apply id="alg1.2.m2.2.2.4.2.cmml" xref="alg1.2.m2.2.2.4"><csymbol cd="ambiguous" id="alg1.2.m2.2.2.4.2.1.cmml" xref="alg1.2.m2.2.2.4">superscript</csymbol><ci id="alg1.2.m2.2.2.4.2.2.cmml" xref="alg1.2.m2.2.2.4.2.2">𝜃</ci><ci id="alg1.2.m2.2.2.4.2.3.cmml" xref="alg1.2.m2.2.2.4.2.3">′</ci></apply><cn id="alg1.2.m2.2.2.4.3.cmml" type="integer" xref="alg1.2.m2.2.2.4.3">0</cn></apply><set id="alg1.2.m2.2.2.2.3.cmml" xref="alg1.2.m2.2.2.2.2"><apply id="alg1.2.m2.1.1.1.1.1.cmml" xref="alg1.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.2.m2.1.1.1.1.1.1.cmml" xref="alg1.2.m2.1.1.1.1.1">subscript</csymbol><apply id="alg1.2.m2.1.1.1.1.1.2.cmml" xref="alg1.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.2.m2.1.1.1.1.1.2.1.cmml" xref="alg1.2.m2.1.1.1.1.1">superscript</csymbol><ci id="alg1.2.m2.1.1.1.1.1.2.2.cmml" xref="alg1.2.m2.1.1.1.1.1.2.2">𝜓</ci><ci id="alg1.2.m2.1.1.1.1.1.2.3.cmml" xref="alg1.2.m2.1.1.1.1.1.2.3">′</ci></apply><cn id="alg1.2.m2.1.1.1.1.1.3.cmml" type="integer" xref="alg1.2.m2.1.1.1.1.1.3">0</cn></apply><apply id="alg1.2.m2.2.2.2.2.2.cmml" xref="alg1.2.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.2.m2.2.2.2.2.2.1.cmml" xref="alg1.2.m2.2.2.2.2.2">subscript</csymbol><apply id="alg1.2.m2.2.2.2.2.2.2.cmml" xref="alg1.2.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.2.m2.2.2.2.2.2.2.1.cmml" xref="alg1.2.m2.2.2.2.2.2">superscript</csymbol><ci id="alg1.2.m2.2.2.2.2.2.2.2.cmml" xref="alg1.2.m2.2.2.2.2.2.2.2">italic-ϕ</ci><ci id="alg1.2.m2.2.2.2.2.2.2.3.cmml" xref="alg1.2.m2.2.2.2.2.2.2.3">′</ci></apply><cn id="alg1.2.m2.2.2.2.2.2.3.cmml" type="integer" xref="alg1.2.m2.2.2.2.2.2.3">0</cn></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.2.m2.2c">\theta^{\prime}_{0}=\{\psi^{\prime}_{0},\phi^{\prime}_{0}\}</annotation><annotation encoding="application/x-llamapun" id="alg1.2.m2.2d">italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT = { italic_ψ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_ϕ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT }</annotation></semantics></math>) where the backbone parameters <math alttext="\psi^{\prime}_{0}" class="ltx_Math" display="inline" id="alg1.3.m3.1"><semantics id="alg1.3.m3.1a"><msubsup id="alg1.3.m3.1.1" xref="alg1.3.m3.1.1.cmml"><mi id="alg1.3.m3.1.1.2.2" xref="alg1.3.m3.1.1.2.2.cmml">ψ</mi><mn id="alg1.3.m3.1.1.3" xref="alg1.3.m3.1.1.3.cmml">0</mn><mo id="alg1.3.m3.1.1.2.3" xref="alg1.3.m3.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.3.m3.1b"><apply id="alg1.3.m3.1.1.cmml" xref="alg1.3.m3.1.1"><csymbol cd="ambiguous" id="alg1.3.m3.1.1.1.cmml" xref="alg1.3.m3.1.1">subscript</csymbol><apply id="alg1.3.m3.1.1.2.cmml" xref="alg1.3.m3.1.1"><csymbol cd="ambiguous" id="alg1.3.m3.1.1.2.1.cmml" xref="alg1.3.m3.1.1">superscript</csymbol><ci id="alg1.3.m3.1.1.2.2.cmml" xref="alg1.3.m3.1.1.2.2">𝜓</ci><ci id="alg1.3.m3.1.1.2.3.cmml" xref="alg1.3.m3.1.1.2.3">′</ci></apply><cn id="alg1.3.m3.1.1.3.cmml" type="integer" xref="alg1.3.m3.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.3.m3.1c">\psi^{\prime}_{0}</annotation><annotation encoding="application/x-llamapun" id="alg1.3.m3.1d">italic_ψ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math> are initialized from pretrained weights <math alttext="\psi^{*}" class="ltx_Math" display="inline" id="alg1.4.m4.1"><semantics id="alg1.4.m4.1a"><msup id="alg1.4.m4.1.1" xref="alg1.4.m4.1.1.cmml"><mi id="alg1.4.m4.1.1.2" xref="alg1.4.m4.1.1.2.cmml">ψ</mi><mo id="alg1.4.m4.1.1.3" xref="alg1.4.m4.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="alg1.4.m4.1b"><apply id="alg1.4.m4.1.1.cmml" xref="alg1.4.m4.1.1"><csymbol cd="ambiguous" id="alg1.4.m4.1.1.1.cmml" xref="alg1.4.m4.1.1">superscript</csymbol><ci id="alg1.4.m4.1.1.2.cmml" xref="alg1.4.m4.1.1.2">𝜓</ci><times id="alg1.4.m4.1.1.3.cmml" xref="alg1.4.m4.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.4.m4.1c">\psi^{*}</annotation><annotation encoding="application/x-llamapun" id="alg1.4.m4.1d">italic_ψ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> and the adaptation parameters <math alttext="\phi^{\prime}_{0}" class="ltx_Math" display="inline" id="alg1.5.m5.1"><semantics id="alg1.5.m5.1a"><msubsup id="alg1.5.m5.1.1" xref="alg1.5.m5.1.1.cmml"><mi id="alg1.5.m5.1.1.2.2" xref="alg1.5.m5.1.1.2.2.cmml">ϕ</mi><mn id="alg1.5.m5.1.1.3" xref="alg1.5.m5.1.1.3.cmml">0</mn><mo id="alg1.5.m5.1.1.2.3" xref="alg1.5.m5.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.5.m5.1b"><apply id="alg1.5.m5.1.1.cmml" xref="alg1.5.m5.1.1"><csymbol cd="ambiguous" id="alg1.5.m5.1.1.1.cmml" xref="alg1.5.m5.1.1">subscript</csymbol><apply id="alg1.5.m5.1.1.2.cmml" xref="alg1.5.m5.1.1"><csymbol cd="ambiguous" id="alg1.5.m5.1.1.2.1.cmml" xref="alg1.5.m5.1.1">superscript</csymbol><ci id="alg1.5.m5.1.1.2.2.cmml" xref="alg1.5.m5.1.1.2.2">italic-ϕ</ci><ci id="alg1.5.m5.1.1.2.3.cmml" xref="alg1.5.m5.1.1.2.3">′</ci></apply><cn id="alg1.5.m5.1.1.3.cmml" type="integer" xref="alg1.5.m5.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.5.m5.1c">\phi^{\prime}_{0}</annotation><annotation encoding="application/x-llamapun" id="alg1.5.m5.1d">italic_ϕ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math> are randomly initialized, hyperparameters <math alttext="m" class="ltx_Math" display="inline" id="alg1.6.m6.1"><semantics id="alg1.6.m6.1a"><mi id="alg1.6.m6.1.1" xref="alg1.6.m6.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="alg1.6.m6.1b"><ci id="alg1.6.m6.1.1.cmml" xref="alg1.6.m6.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.6.m6.1c">m</annotation><annotation encoding="application/x-llamapun" id="alg1.6.m6.1d">italic_m</annotation></semantics></math> and <math alttext="\omega" class="ltx_Math" display="inline" id="alg1.7.m7.1"><semantics id="alg1.7.m7.1a"><mi id="alg1.7.m7.1.1" xref="alg1.7.m7.1.1.cmml">ω</mi><annotation-xml encoding="MathML-Content" id="alg1.7.m7.1b"><ci id="alg1.7.m7.1.1.cmml" xref="alg1.7.m7.1.1">𝜔</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.7.m7.1c">\omega</annotation><annotation encoding="application/x-llamapun" id="alg1.7.m7.1d">italic_ω</annotation></semantics></math>, the learning rate <math alttext="\alpha" class="ltx_Math" display="inline" id="alg1.8.m8.1"><semantics id="alg1.8.m8.1a"><mi id="alg1.8.m8.1.1" xref="alg1.8.m8.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="alg1.8.m8.1b"><ci id="alg1.8.m8.1.1.cmml" xref="alg1.8.m8.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.8.m8.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="alg1.8.m8.1d">italic_α</annotation></semantics></math> and the test-time training loss <math alttext="L_{tt}" class="ltx_Math" display="inline" id="alg1.9.m9.1"><semantics id="alg1.9.m9.1a"><msub id="alg1.9.m9.1.1" xref="alg1.9.m9.1.1.cmml"><mi id="alg1.9.m9.1.1.2" xref="alg1.9.m9.1.1.2.cmml">L</mi><mrow id="alg1.9.m9.1.1.3" xref="alg1.9.m9.1.1.3.cmml"><mi id="alg1.9.m9.1.1.3.2" xref="alg1.9.m9.1.1.3.2.cmml">t</mi><mo id="alg1.9.m9.1.1.3.1" xref="alg1.9.m9.1.1.3.1.cmml">⁢</mo><mi id="alg1.9.m9.1.1.3.3" xref="alg1.9.m9.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.9.m9.1b"><apply id="alg1.9.m9.1.1.cmml" xref="alg1.9.m9.1.1"><csymbol cd="ambiguous" id="alg1.9.m9.1.1.1.cmml" xref="alg1.9.m9.1.1">subscript</csymbol><ci id="alg1.9.m9.1.1.2.cmml" xref="alg1.9.m9.1.1.2">𝐿</ci><apply id="alg1.9.m9.1.1.3.cmml" xref="alg1.9.m9.1.1.3"><times id="alg1.9.m9.1.1.3.1.cmml" xref="alg1.9.m9.1.1.3.1"></times><ci id="alg1.9.m9.1.1.3.2.cmml" xref="alg1.9.m9.1.1.3.2">𝑡</ci><ci id="alg1.9.m9.1.1.3.3.cmml" xref="alg1.9.m9.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.9.m9.1c">L_{tt}</annotation><annotation encoding="application/x-llamapun" id="alg1.9.m9.1d">italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT</annotation></semantics></math>;
<br class="ltx_break"/><span class="ltx_text ltx_font_bold" id="alg1.11.2">Input:</span> For each time step <math alttext="i" class="ltx_Math" display="inline" id="alg1.10.m10.1"><semantics id="alg1.10.m10.1a"><mi id="alg1.10.m10.1.1" xref="alg1.10.m10.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="alg1.10.m10.1b"><ci id="alg1.10.m10.1.1.cmml" xref="alg1.10.m10.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.10.m10.1c">i</annotation><annotation encoding="application/x-llamapun" id="alg1.10.m10.1d">italic_i</annotation></semantics></math>, current test sample <math alttext="x^{t}_{i}" class="ltx_Math" display="inline" id="alg1.11.m11.1"><semantics id="alg1.11.m11.1a"><msubsup id="alg1.11.m11.1.1" xref="alg1.11.m11.1.1.cmml"><mi id="alg1.11.m11.1.1.2.2" xref="alg1.11.m11.1.1.2.2.cmml">x</mi><mi id="alg1.11.m11.1.1.3" xref="alg1.11.m11.1.1.3.cmml">i</mi><mi id="alg1.11.m11.1.1.2.3" xref="alg1.11.m11.1.1.2.3.cmml">t</mi></msubsup><annotation-xml encoding="MathML-Content" id="alg1.11.m11.1b"><apply id="alg1.11.m11.1.1.cmml" xref="alg1.11.m11.1.1"><csymbol cd="ambiguous" id="alg1.11.m11.1.1.1.cmml" xref="alg1.11.m11.1.1">subscript</csymbol><apply id="alg1.11.m11.1.1.2.cmml" xref="alg1.11.m11.1.1"><csymbol cd="ambiguous" id="alg1.11.m11.1.1.2.1.cmml" xref="alg1.11.m11.1.1">superscript</csymbol><ci id="alg1.11.m11.1.1.2.2.cmml" xref="alg1.11.m11.1.1.2.2">𝑥</ci><ci id="alg1.11.m11.1.1.2.3.cmml" xref="alg1.11.m11.1.1.2.3">𝑡</ci></apply><ci id="alg1.11.m11.1.1.3.cmml" xref="alg1.11.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.11.m11.1c">x^{t}_{i}</annotation><annotation encoding="application/x-llamapun" id="alg1.11.m11.1d">italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<div class="ltx_listing ltx_figure_panel ltx_listing" id="alg1.14">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.2.1.1" style="font-size:80%;">1:</span></span><math alttext="\theta_{i}\leftarrow\theta^{\prime}_{i-1}" class="ltx_Math" display="inline" id="alg1.l1.m1.1"><semantics id="alg1.l1.m1.1a"><mrow id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml"><msub id="alg1.l1.m1.1.1.2" xref="alg1.l1.m1.1.1.2.cmml"><mi id="alg1.l1.m1.1.1.2.2" xref="alg1.l1.m1.1.1.2.2.cmml">θ</mi><mi id="alg1.l1.m1.1.1.2.3" xref="alg1.l1.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg1.l1.m1.1.1.1" stretchy="false" xref="alg1.l1.m1.1.1.1.cmml">←</mo><msubsup id="alg1.l1.m1.1.1.3" xref="alg1.l1.m1.1.1.3.cmml"><mi id="alg1.l1.m1.1.1.3.2.2" xref="alg1.l1.m1.1.1.3.2.2.cmml">θ</mi><mrow id="alg1.l1.m1.1.1.3.3" xref="alg1.l1.m1.1.1.3.3.cmml"><mi id="alg1.l1.m1.1.1.3.3.2" xref="alg1.l1.m1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l1.m1.1.1.3.3.1" xref="alg1.l1.m1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l1.m1.1.1.3.3.3" xref="alg1.l1.m1.1.1.3.3.3.cmml">1</mn></mrow><mo id="alg1.l1.m1.1.1.3.2.3" xref="alg1.l1.m1.1.1.3.2.3.cmml">′</mo></msubsup></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><apply id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1"><ci id="alg1.l1.m1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1">←</ci><apply id="alg1.l1.m1.1.1.2.cmml" xref="alg1.l1.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.2.1.cmml" xref="alg1.l1.m1.1.1.2">subscript</csymbol><ci id="alg1.l1.m1.1.1.2.2.cmml" xref="alg1.l1.m1.1.1.2.2">𝜃</ci><ci id="alg1.l1.m1.1.1.2.3.cmml" xref="alg1.l1.m1.1.1.2.3">𝑖</ci></apply><apply id="alg1.l1.m1.1.1.3.cmml" xref="alg1.l1.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.3.1.cmml" xref="alg1.l1.m1.1.1.3">subscript</csymbol><apply id="alg1.l1.m1.1.1.3.2.cmml" xref="alg1.l1.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.3.2.1.cmml" xref="alg1.l1.m1.1.1.3">superscript</csymbol><ci id="alg1.l1.m1.1.1.3.2.2.cmml" xref="alg1.l1.m1.1.1.3.2.2">𝜃</ci><ci id="alg1.l1.m1.1.1.3.2.3.cmml" xref="alg1.l1.m1.1.1.3.2.3">′</ci></apply><apply id="alg1.l1.m1.1.1.3.3.cmml" xref="alg1.l1.m1.1.1.3.3"><minus id="alg1.l1.m1.1.1.3.3.1.cmml" xref="alg1.l1.m1.1.1.3.3.1"></minus><ci id="alg1.l1.m1.1.1.3.3.2.cmml" xref="alg1.l1.m1.1.1.3.3.2">𝑖</ci><cn id="alg1.l1.m1.1.1.3.3.3.cmml" type="integer" xref="alg1.l1.m1.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">\theta_{i}\leftarrow\theta^{\prime}_{i-1}</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.1d">italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT</annotation></semantics></math>. <span class="ltx_text" id="alg1.l1.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l1.1.m1.1"><semantics id="alg1.l1.1.m1.1a"><mo id="alg1.l1.1.m1.1.1" xref="alg1.l1.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l1.1.m1.1b"><ci id="alg1.l1.1.m1.1.1.cmml" xref="alg1.l1.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.1.m1.1d">▷</annotation></semantics></math> Reset the student model with teacher weights.
</span>
</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.1.1.1" style="font-size:80%;">2:</span></span>Set <math alttext="\phi_{i}" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><msub id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml"><mi id="alg1.l2.m1.1.1.2" xref="alg1.l2.m1.1.1.2.cmml">ϕ</mi><mi id="alg1.l2.m1.1.1.3" xref="alg1.l2.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><apply id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1"><csymbol cd="ambiguous" id="alg1.l2.m1.1.1.1.cmml" xref="alg1.l2.m1.1.1">subscript</csymbol><ci id="alg1.l2.m1.1.1.2.cmml" xref="alg1.l2.m1.1.1.2">italic-ϕ</ci><ci id="alg1.l2.m1.1.1.3.cmml" xref="alg1.l2.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">\phi_{i}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_ϕ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and BN parameters to be trainable in the student model <math alttext="\mathcal{T}_{\theta_{i}}" class="ltx_Math" display="inline" id="alg1.l2.m2.1"><semantics id="alg1.l2.m2.1a"><msub id="alg1.l2.m2.1.1" xref="alg1.l2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l2.m2.1.1.2" xref="alg1.l2.m2.1.1.2.cmml">𝒯</mi><msub id="alg1.l2.m2.1.1.3" xref="alg1.l2.m2.1.1.3.cmml"><mi id="alg1.l2.m2.1.1.3.2" xref="alg1.l2.m2.1.1.3.2.cmml">θ</mi><mi id="alg1.l2.m2.1.1.3.3" xref="alg1.l2.m2.1.1.3.3.cmml">i</mi></msub></msub><annotation-xml encoding="MathML-Content" id="alg1.l2.m2.1b"><apply id="alg1.l2.m2.1.1.cmml" xref="alg1.l2.m2.1.1"><csymbol cd="ambiguous" id="alg1.l2.m2.1.1.1.cmml" xref="alg1.l2.m2.1.1">subscript</csymbol><ci id="alg1.l2.m2.1.1.2.cmml" xref="alg1.l2.m2.1.1.2">𝒯</ci><apply id="alg1.l2.m2.1.1.3.cmml" xref="alg1.l2.m2.1.1.3"><csymbol cd="ambiguous" id="alg1.l2.m2.1.1.3.1.cmml" xref="alg1.l2.m2.1.1.3">subscript</csymbol><ci id="alg1.l2.m2.1.1.3.2.cmml" xref="alg1.l2.m2.1.1.3.2">𝜃</ci><ci id="alg1.l2.m2.1.1.3.3.cmml" xref="alg1.l2.m2.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m2.1c">\mathcal{T}_{\theta_{i}}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m2.1d">caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> with others frozen.

</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l3.2.1.1" style="font-size:80%;">3:</span></span><math alttext="\theta_{i}\leftarrow\theta_{i}-\alpha\nabla L_{tt}(\mathcal{T}_{\theta_{i}}(x^%
{t}_{i}))" class="ltx_Math" display="inline" id="alg1.l3.m1.1"><semantics id="alg1.l3.m1.1a"><mrow id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml"><msub id="alg1.l3.m1.1.1.3" xref="alg1.l3.m1.1.1.3.cmml"><mi id="alg1.l3.m1.1.1.3.2" xref="alg1.l3.m1.1.1.3.2.cmml">θ</mi><mi id="alg1.l3.m1.1.1.3.3" xref="alg1.l3.m1.1.1.3.3.cmml">i</mi></msub><mo id="alg1.l3.m1.1.1.2" stretchy="false" xref="alg1.l3.m1.1.1.2.cmml">←</mo><mrow id="alg1.l3.m1.1.1.1" xref="alg1.l3.m1.1.1.1.cmml"><msub id="alg1.l3.m1.1.1.1.3" xref="alg1.l3.m1.1.1.1.3.cmml"><mi id="alg1.l3.m1.1.1.1.3.2" xref="alg1.l3.m1.1.1.1.3.2.cmml">θ</mi><mi id="alg1.l3.m1.1.1.1.3.3" xref="alg1.l3.m1.1.1.1.3.3.cmml">i</mi></msub><mo id="alg1.l3.m1.1.1.1.2" xref="alg1.l3.m1.1.1.1.2.cmml">−</mo><mrow id="alg1.l3.m1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.cmml"><mi id="alg1.l3.m1.1.1.1.1.3" xref="alg1.l3.m1.1.1.1.1.3.cmml">α</mi><mo id="alg1.l3.m1.1.1.1.1.2" lspace="0.167em" xref="alg1.l3.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l3.m1.1.1.1.1.4" xref="alg1.l3.m1.1.1.1.1.4.cmml"><mo id="alg1.l3.m1.1.1.1.1.4.1" rspace="0.167em" xref="alg1.l3.m1.1.1.1.1.4.1.cmml">∇</mo><msub id="alg1.l3.m1.1.1.1.1.4.2" xref="alg1.l3.m1.1.1.1.1.4.2.cmml"><mi id="alg1.l3.m1.1.1.1.1.4.2.2" xref="alg1.l3.m1.1.1.1.1.4.2.2.cmml">L</mi><mrow id="alg1.l3.m1.1.1.1.1.4.2.3" xref="alg1.l3.m1.1.1.1.1.4.2.3.cmml"><mi id="alg1.l3.m1.1.1.1.1.4.2.3.2" xref="alg1.l3.m1.1.1.1.1.4.2.3.2.cmml">t</mi><mo id="alg1.l3.m1.1.1.1.1.4.2.3.1" xref="alg1.l3.m1.1.1.1.1.4.2.3.1.cmml">⁢</mo><mi id="alg1.l3.m1.1.1.1.1.4.2.3.3" xref="alg1.l3.m1.1.1.1.1.4.2.3.3.cmml">t</mi></mrow></msub></mrow><mo id="alg1.l3.m1.1.1.1.1.2a" xref="alg1.l3.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l3.m1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.cmml"><mo id="alg1.l3.m1.1.1.1.1.1.1.2" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l3.m1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.cmml"><msub id="alg1.l3.m1.1.1.1.1.1.1.1.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l3.m1.1.1.1.1.1.1.1.3.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.2.cmml">𝒯</mi><msub id="alg1.l3.m1.1.1.1.1.1.1.1.3.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3.2.cmml">θ</mi><mi id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3.3.cmml">i</mi></msub></msub><mo id="alg1.l3.m1.1.1.1.1.1.1.1.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l3.m1.1.1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msubsup id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg1.l3.m1.1.1.1.1.1.1.3" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.1b"><apply id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1"><ci id="alg1.l3.m1.1.1.2.cmml" xref="alg1.l3.m1.1.1.2">←</ci><apply id="alg1.l3.m1.1.1.3.cmml" xref="alg1.l3.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.3.1.cmml" xref="alg1.l3.m1.1.1.3">subscript</csymbol><ci id="alg1.l3.m1.1.1.3.2.cmml" xref="alg1.l3.m1.1.1.3.2">𝜃</ci><ci id="alg1.l3.m1.1.1.3.3.cmml" xref="alg1.l3.m1.1.1.3.3">𝑖</ci></apply><apply id="alg1.l3.m1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1"><minus id="alg1.l3.m1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.2"></minus><apply id="alg1.l3.m1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.3.1.cmml" xref="alg1.l3.m1.1.1.1.3">subscript</csymbol><ci id="alg1.l3.m1.1.1.1.3.2.cmml" xref="alg1.l3.m1.1.1.1.3.2">𝜃</ci><ci id="alg1.l3.m1.1.1.1.3.3.cmml" xref="alg1.l3.m1.1.1.1.3.3">𝑖</ci></apply><apply id="alg1.l3.m1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1"><times id="alg1.l3.m1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.2"></times><ci id="alg1.l3.m1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.3">𝛼</ci><apply id="alg1.l3.m1.1.1.1.1.4.cmml" xref="alg1.l3.m1.1.1.1.1.4"><ci id="alg1.l3.m1.1.1.1.1.4.1.cmml" xref="alg1.l3.m1.1.1.1.1.4.1">∇</ci><apply id="alg1.l3.m1.1.1.1.1.4.2.cmml" xref="alg1.l3.m1.1.1.1.1.4.2"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.4.2.1.cmml" xref="alg1.l3.m1.1.1.1.1.4.2">subscript</csymbol><ci id="alg1.l3.m1.1.1.1.1.4.2.2.cmml" xref="alg1.l3.m1.1.1.1.1.4.2.2">𝐿</ci><apply id="alg1.l3.m1.1.1.1.1.4.2.3.cmml" xref="alg1.l3.m1.1.1.1.1.4.2.3"><times id="alg1.l3.m1.1.1.1.1.4.2.3.1.cmml" xref="alg1.l3.m1.1.1.1.1.4.2.3.1"></times><ci id="alg1.l3.m1.1.1.1.1.4.2.3.2.cmml" xref="alg1.l3.m1.1.1.1.1.4.2.3.2">𝑡</ci><ci id="alg1.l3.m1.1.1.1.1.4.2.3.3.cmml" xref="alg1.l3.m1.1.1.1.1.4.2.3.3">𝑡</ci></apply></apply></apply><apply id="alg1.l3.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1"><times id="alg1.l3.m1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.2"></times><apply id="alg1.l3.m1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.1.1.1.3.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="alg1.l3.m1.1.1.1.1.1.1.1.3.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.2">𝒯</ci><apply id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3">subscript</csymbol><ci id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3.2">𝜃</ci><ci id="alg1.l3.m1.1.1.1.1.1.1.1.3.3.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.3.3.3">𝑖</ci></apply></apply><apply id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.1c">\theta_{i}\leftarrow\theta_{i}-\alpha\nabla L_{tt}(\mathcal{T}_{\theta_{i}}(x^%
{t}_{i}))</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.1d">italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT - italic_α ∇ italic_L start_POSTSUBSCRIPT italic_t italic_t end_POSTSUBSCRIPT ( caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) )</annotation></semantics></math>. <span class="ltx_text" id="alg1.l3.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l3.1.m1.1"><semantics id="alg1.l3.1.m1.1a"><mo id="alg1.l3.1.m1.1.1" xref="alg1.l3.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l3.1.m1.1b"><ci id="alg1.l3.1.m1.1.1.cmml" xref="alg1.l3.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.1.m1.1d">▷</annotation></semantics></math> Update the student model via the unsupervised adaptation loss.
</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l4.2.1.1" style="font-size:80%;">4:</span></span><math alttext="p^{t}_{i}\leftarrow\mathcal{T}_{\theta_{i}}(x^{t}_{i})" class="ltx_Math" display="inline" id="alg1.l4.m1.1"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><msubsup id="alg1.l4.m1.1.1.3" xref="alg1.l4.m1.1.1.3.cmml"><mi id="alg1.l4.m1.1.1.3.2.2" xref="alg1.l4.m1.1.1.3.2.2.cmml">p</mi><mi id="alg1.l4.m1.1.1.3.3" xref="alg1.l4.m1.1.1.3.3.cmml">i</mi><mi id="alg1.l4.m1.1.1.3.2.3" xref="alg1.l4.m1.1.1.3.2.3.cmml">t</mi></msubsup><mo id="alg1.l4.m1.1.1.2" stretchy="false" xref="alg1.l4.m1.1.1.2.cmml">←</mo><mrow id="alg1.l4.m1.1.1.1" xref="alg1.l4.m1.1.1.1.cmml"><msub id="alg1.l4.m1.1.1.1.3" xref="alg1.l4.m1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l4.m1.1.1.1.3.2" xref="alg1.l4.m1.1.1.1.3.2.cmml">𝒯</mi><msub id="alg1.l4.m1.1.1.1.3.3" xref="alg1.l4.m1.1.1.1.3.3.cmml"><mi id="alg1.l4.m1.1.1.1.3.3.2" xref="alg1.l4.m1.1.1.1.3.3.2.cmml">θ</mi><mi id="alg1.l4.m1.1.1.1.3.3.3" xref="alg1.l4.m1.1.1.1.3.3.3.cmml">i</mi></msub></msub><mo id="alg1.l4.m1.1.1.1.2" xref="alg1.l4.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l4.m1.1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.1.1.cmml"><mo id="alg1.l4.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.l4.m1.1.1.1.1.1.1.cmml">(</mo><msubsup id="alg1.l4.m1.1.1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l4.m1.1.1.1.1.1.1.2.2" xref="alg1.l4.m1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="alg1.l4.m1.1.1.1.1.1.1.3" xref="alg1.l4.m1.1.1.1.1.1.1.3.cmml">i</mi><mi id="alg1.l4.m1.1.1.1.1.1.1.2.3" xref="alg1.l4.m1.1.1.1.1.1.1.2.3.cmml">t</mi></msubsup><mo id="alg1.l4.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.l4.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><ci id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2">←</ci><apply id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.3.1.cmml" xref="alg1.l4.m1.1.1.3">subscript</csymbol><apply id="alg1.l4.m1.1.1.3.2.cmml" xref="alg1.l4.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.3.2.1.cmml" xref="alg1.l4.m1.1.1.3">superscript</csymbol><ci id="alg1.l4.m1.1.1.3.2.2.cmml" xref="alg1.l4.m1.1.1.3.2.2">𝑝</ci><ci id="alg1.l4.m1.1.1.3.2.3.cmml" xref="alg1.l4.m1.1.1.3.2.3">𝑡</ci></apply><ci id="alg1.l4.m1.1.1.3.3.cmml" xref="alg1.l4.m1.1.1.3.3">𝑖</ci></apply><apply id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1"><times id="alg1.l4.m1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.2"></times><apply id="alg1.l4.m1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.3.1.cmml" xref="alg1.l4.m1.1.1.1.3">subscript</csymbol><ci id="alg1.l4.m1.1.1.1.3.2.cmml" xref="alg1.l4.m1.1.1.1.3.2">𝒯</ci><apply id="alg1.l4.m1.1.1.1.3.3.cmml" xref="alg1.l4.m1.1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.3.3.1.cmml" xref="alg1.l4.m1.1.1.1.3.3">subscript</csymbol><ci id="alg1.l4.m1.1.1.1.3.3.2.cmml" xref="alg1.l4.m1.1.1.1.3.3.2">𝜃</ci><ci id="alg1.l4.m1.1.1.1.3.3.3.cmml" xref="alg1.l4.m1.1.1.1.3.3.3">𝑖</ci></apply></apply><apply id="alg1.l4.m1.1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l4.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.1.1.1.2.1.cmml" xref="alg1.l4.m1.1.1.1.1.1">superscript</csymbol><ci id="alg1.l4.m1.1.1.1.1.1.1.2.2.cmml" xref="alg1.l4.m1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="alg1.l4.m1.1.1.1.1.1.1.2.3.cmml" xref="alg1.l4.m1.1.1.1.1.1.1.2.3">𝑡</ci></apply><ci id="alg1.l4.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">p^{t}_{i}\leftarrow\mathcal{T}_{\theta_{i}}(x^{t}_{i})</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.1d">italic_p start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← caligraphic_T start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_x start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>. <span class="ltx_text" id="alg1.l4.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l4.1.m1.1"><semantics id="alg1.l4.1.m1.1a"><mo id="alg1.l4.1.m1.1.1" xref="alg1.l4.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l4.1.m1.1b"><ci id="alg1.l4.1.m1.1.1.cmml" xref="alg1.l4.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.1.m1.1d">▷</annotation></semantics></math> Get test-time predictions via the adapted student model.
</span>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l5.2.1.1" style="font-size:80%;">5:</span></span>Update <math alttext="\theta^{\prime}_{i}" class="ltx_Math" display="inline" id="alg1.l5.m1.1"><semantics id="alg1.l5.m1.1a"><msubsup id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml"><mi id="alg1.l5.m1.1.1.2.2" xref="alg1.l5.m1.1.1.2.2.cmml">θ</mi><mi id="alg1.l5.m1.1.1.3" xref="alg1.l5.m1.1.1.3.cmml">i</mi><mo id="alg1.l5.m1.1.1.2.3" xref="alg1.l5.m1.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.1b"><apply id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1"><csymbol cd="ambiguous" id="alg1.l5.m1.1.1.1.cmml" xref="alg1.l5.m1.1.1">subscript</csymbol><apply id="alg1.l5.m1.1.1.2.cmml" xref="alg1.l5.m1.1.1"><csymbol cd="ambiguous" id="alg1.l5.m1.1.1.2.1.cmml" xref="alg1.l5.m1.1.1">superscript</csymbol><ci id="alg1.l5.m1.1.1.2.2.cmml" xref="alg1.l5.m1.1.1.2.2">𝜃</ci><ci id="alg1.l5.m1.1.1.2.3.cmml" xref="alg1.l5.m1.1.1.2.3">′</ci></apply><ci id="alg1.l5.m1.1.1.3.cmml" xref="alg1.l5.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.1c">\theta^{\prime}_{i}</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.1d">italic_θ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> by Equation (<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.E7" title="In 3.4 Alternating Momentum Updating Strategy ‣ 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">7</span></a>) with <math alttext="m_{i}" class="ltx_Math" display="inline" id="alg1.l5.m2.1"><semantics id="alg1.l5.m2.1a"><msub id="alg1.l5.m2.1.1" xref="alg1.l5.m2.1.1.cmml"><mi id="alg1.l5.m2.1.1.2" xref="alg1.l5.m2.1.1.2.cmml">m</mi><mi id="alg1.l5.m2.1.1.3" xref="alg1.l5.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l5.m2.1b"><apply id="alg1.l5.m2.1.1.cmml" xref="alg1.l5.m2.1.1"><csymbol cd="ambiguous" id="alg1.l5.m2.1.1.1.cmml" xref="alg1.l5.m2.1.1">subscript</csymbol><ci id="alg1.l5.m2.1.1.2.cmml" xref="alg1.l5.m2.1.1.2">𝑚</ci><ci id="alg1.l5.m2.1.1.3.cmml" xref="alg1.l5.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m2.1c">m_{i}</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m2.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.<span class="ltx_text" id="alg1.l5.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l5.1.m1.1"><semantics id="alg1.l5.1.m1.1a"><mo id="alg1.l5.1.m1.1.1" xref="alg1.l5.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l5.1.m1.1b"><ci id="alg1.l5.1.m1.1.1.cmml" xref="alg1.l5.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.1.m1.1d">▷</annotation></semantics></math> Update the teacher model via moving average.
</span>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l6.2.1.1" style="font-size:80%;">6:</span></span>Adapt the momentum <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg1.l6.m1.1"><semantics id="alg1.l6.m1.1a"><msub id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml"><mi id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml">m</mi><mrow id="alg1.l6.m1.1.1.3" xref="alg1.l6.m1.1.1.3.cmml"><mi id="alg1.l6.m1.1.1.3.2" xref="alg1.l6.m1.1.1.3.2.cmml">i</mi><mo id="alg1.l6.m1.1.1.3.1" xref="alg1.l6.m1.1.1.3.1.cmml">+</mo><mn id="alg1.l6.m1.1.1.3.3" xref="alg1.l6.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.1.cmml" xref="alg1.l6.m1.1.1">subscript</csymbol><ci id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2">𝑚</ci><apply id="alg1.l6.m1.1.1.3.cmml" xref="alg1.l6.m1.1.1.3"><plus id="alg1.l6.m1.1.1.3.1.cmml" xref="alg1.l6.m1.1.1.3.1"></plus><ci id="alg1.l6.m1.1.1.3.2.cmml" xref="alg1.l6.m1.1.1.3.2">𝑖</ci><cn id="alg1.l6.m1.1.1.3.3.cmml" type="integer" xref="alg1.l6.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> by Equation (<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S3.E8" title="In 3.4 Alternating Momentum Updating Strategy ‣ 3 Methodology ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">8</span></a>). <span class="ltx_text" id="alg1.l6.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l6.1.m1.1"><semantics id="alg1.l6.1.m1.1a"><mo id="alg1.l6.1.m1.1.1" xref="alg1.l6.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l6.1.m1.1b"><ci id="alg1.l6.1.m1.1.1.cmml" xref="alg1.l6.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.1.m1.1d">▷</annotation></semantics></math> Decrease the momentum factor.
</span>
</div>
</div>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="alg1.15"><span class="ltx_text ltx_font_bold" id="alg1.15.1">Output:</span> All predictions and teacher model parameters.</p>
</div>
</div>
</figure>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Experimental Setup</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.p1.1.1">The Fundus OD/OC Segmentation.</span>
We first evaluate our method on the joint optic disc (OD) and optic cup (OC) segmentation task. We use a multi-domain RIGA+ dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib33" title="">33</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib34" title="">34</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> comprising five domains derived from different resources: BinRushed, Magrabia, BASE1, BASE2, and BASE3.
The 195 and 95 labeled images in BinRushed and Magrabia serve as the source domain while 35, 30 and 27 unlabeled images in three test sets of BASE1, BASE2, and BASE3 are utilized as target domains, respectively. Following <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite>, each image was resized to 512<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.1"><semantics id="S4.SS1.p1.1.m1.1a"><mo id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.1b"><times id="S4.SS1.p1.1.m1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.1d">×</annotation></semantics></math>512 pixels and the intensities are normalized to a distribution with zero mean and unit variance.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.p2.1.1">The MRI Prostate Segmentation.</span> We also validate our method on the prostate segmentation task with T2-weighted MRI scans collected from six clinical centers <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib35" title="">35</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib36" title="">36</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib37" title="">37</a>]</cite>: RUNMC, BMC, I2CVB, UCL, BIDMC and HK (Sites A-F). We use 30 labelled cases in RUNMC as the source dataset and 30/19/13/12/12 unlabeled cases in the remaining five sites for target testing. Each axial slice of the MRI volume was resized to 384<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><mo id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><times id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">×</annotation></semantics></math>384 pixels and normalized to zero mean and unit variance in intensity values. Due to the large variance in the slice thickness of data, we employ a 2D network as the backbone. For all MRI slices, we clipped 5%-95% of the histograms before the intensity normalization.</p>
</div>
<div class="ltx_para" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.5"><span class="ltx_text ltx_font_bold" id="S4.SS1.p3.5.1">Implementation Details.</span>
All the experiments are run with the PyTorch framework on one NVIDIA-V100 GPU. We adopt a 2D U-Net with ResNet-34<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib38" title="">38</a>]</cite> as the backbone for OD/OC and prostate datasets, following previous TTA works<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>.
In the pretraining stage, the models are trained on the source data using the binary cross entropy (BCE) and dice losses with a batch size of 16. We employ data augmentation schemes of elastic deformation, random rotation, scaling, flipping, Gaussian noises, brightness multiplicative, Gamma and contrast transformations.
We use the Adam optimizer with an initial learning rate of 0.001/0.0001 for 100/800 epochs on OD/OC and prostate datasets, respectively. Empirically, we chose the model trained at the last epoch as the testing model.
<span class="ltx_text" id="S4.SS1.p3.5.2" style="color:#000000;">During the optimization stage, we select the BN loss <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> of aligning the source-target statistics and the TENT loss <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite> of minimizing the output entropy.</span>
Note that only the BN parameters and the introduced adaptation parameters were trainable and the rest of the parameters were frozen after being initialized by the pretrained model. We compare our PASS with previous approaches on the offline and online TTA setups separately. Under the offline TTA setting, we train the target model on the entire test dataset with a batch size of 8/16 for 20/100 epochs on OD/OC and prostate datasets, respectively. Under the online TTA setting, we perform continual adaption for each single test subject. The Adam optimizer was utilized with a learning rate of 0.005 and 0.01 for the OD/OC and prostate segmentation tasks, respectively. The hyperparameters <math alttext="L" class="ltx_Math" display="inline" id="S4.SS1.p3.1.m1.1"><semantics id="S4.SS1.p3.1.m1.1a"><mi id="S4.SS1.p3.1.m1.1.1" xref="S4.SS1.p3.1.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.1.m1.1b"><ci id="S4.SS1.p3.1.m1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.1.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.1.m1.1d">italic_L</annotation></semantics></math> (size of the shape prompt bank), <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p3.2.m2.1"><semantics id="S4.SS1.p3.2.m2.1a"><mi id="S4.SS1.p3.2.m2.1.1" xref="S4.SS1.p3.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.2.m2.1b"><ci id="S4.SS1.p3.2.m2.1.1.cmml" xref="S4.SS1.p3.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.2.m2.1d">italic_k</annotation></semantics></math> (<math alttext="top_{k}" class="ltx_Math" display="inline" id="S4.SS1.p3.3.m3.1"><semantics id="S4.SS1.p3.3.m3.1a"><mrow id="S4.SS1.p3.3.m3.1.1" xref="S4.SS1.p3.3.m3.1.1.cmml"><mi id="S4.SS1.p3.3.m3.1.1.2" xref="S4.SS1.p3.3.m3.1.1.2.cmml">t</mi><mo id="S4.SS1.p3.3.m3.1.1.1" xref="S4.SS1.p3.3.m3.1.1.1.cmml">⁢</mo><mi id="S4.SS1.p3.3.m3.1.1.3" xref="S4.SS1.p3.3.m3.1.1.3.cmml">o</mi><mo id="S4.SS1.p3.3.m3.1.1.1a" xref="S4.SS1.p3.3.m3.1.1.1.cmml">⁢</mo><msub id="S4.SS1.p3.3.m3.1.1.4" xref="S4.SS1.p3.3.m3.1.1.4.cmml"><mi id="S4.SS1.p3.3.m3.1.1.4.2" xref="S4.SS1.p3.3.m3.1.1.4.2.cmml">p</mi><mi id="S4.SS1.p3.3.m3.1.1.4.3" xref="S4.SS1.p3.3.m3.1.1.4.3.cmml">k</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.3.m3.1b"><apply id="S4.SS1.p3.3.m3.1.1.cmml" xref="S4.SS1.p3.3.m3.1.1"><times id="S4.SS1.p3.3.m3.1.1.1.cmml" xref="S4.SS1.p3.3.m3.1.1.1"></times><ci id="S4.SS1.p3.3.m3.1.1.2.cmml" xref="S4.SS1.p3.3.m3.1.1.2">𝑡</ci><ci id="S4.SS1.p3.3.m3.1.1.3.cmml" xref="S4.SS1.p3.3.m3.1.1.3">𝑜</ci><apply id="S4.SS1.p3.3.m3.1.1.4.cmml" xref="S4.SS1.p3.3.m3.1.1.4"><csymbol cd="ambiguous" id="S4.SS1.p3.3.m3.1.1.4.1.cmml" xref="S4.SS1.p3.3.m3.1.1.4">subscript</csymbol><ci id="S4.SS1.p3.3.m3.1.1.4.2.cmml" xref="S4.SS1.p3.3.m3.1.1.4.2">𝑝</ci><ci id="S4.SS1.p3.3.m3.1.1.4.3.cmml" xref="S4.SS1.p3.3.m3.1.1.4.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.3.m3.1c">top_{k}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.3.m3.1d">italic_t italic_o italic_p start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> for the sparsity of <math alttext="A" class="ltx_Math" display="inline" id="S4.SS1.p3.4.m4.1"><semantics id="S4.SS1.p3.4.m4.1a"><mi id="S4.SS1.p3.4.m4.1.1" xref="S4.SS1.p3.4.m4.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.4.m4.1b"><ci id="S4.SS1.p3.4.m4.1.1.cmml" xref="S4.SS1.p3.4.m4.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.4.m4.1c">A</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.4.m4.1d">italic_A</annotation></semantics></math>), and <math alttext="\omega" class="ltx_Math" display="inline" id="S4.SS1.p3.5.m5.1"><semantics id="S4.SS1.p3.5.m5.1a"><mi id="S4.SS1.p3.5.m5.1.1" xref="S4.SS1.p3.5.m5.1.1.cmml">ω</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.5.m5.1b"><ci id="S4.SS1.p3.5.m5.1.1.cmml" xref="S4.SS1.p3.5.m5.1.1">𝜔</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.5.m5.1c">\omega</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.5.m5.1d">italic_ω</annotation></semantics></math> (decay coefficient in AMU) are set to 512, 0.1 and 0.94/0.6 for OD/OC and prostate segmentation tasks. 
The average response time of PASS on the OD/OC and prostate segmentation tasks was 0.36s and 1.81s, respectively.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Offline TTA performance of different methods in DSC Sore (%) on three OD/OC segmentation test sets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T1.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T1.1.1.1.1" rowspan="2" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S4.T1.1.1.1.1.1">Method</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T1.1.1.1.2" style="padding:-1pt 4.0pt;">BASE1</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T1.1.1.1.3" style="padding:-1pt 4.0pt;">BASE2</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T1.1.1.1.4" style="padding:-1pt 4.0pt;">BASE3</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.1.1.1.5" rowspan="2" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S4.T1.1.1.1.5.1">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.1" style="padding:-1pt 4.0pt;">OD</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.2" style="padding:-1pt 4.0pt;">OC</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.3" style="padding:-1pt 4.0pt;">OD</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.4" style="padding:-1pt 4.0pt;">OC</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.5" style="padding:-1pt 4.0pt;">OD</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.2.6" style="padding:-1pt 4.0pt;">OC</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.3.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.1" style="padding:-1pt 4.0pt;">Source Only</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.2" style="padding:-1pt 4.0pt;">95.21</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.3" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.3.3.3.1">\ul</span>85.20</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.4" style="padding:-1pt 4.0pt;">92.58</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.5" style="padding:-1pt 4.0pt;">77.73</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.6" style="padding:-1pt 4.0pt;">93.72</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.3.3.7" style="padding:-1pt 4.0pt;">82.16</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.3.8" style="padding:-1pt 4.0pt;">87.77<span class="ltx_text" id="S4.T1.1.3.3.8.1" style="font-size:70%;">±6.49</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.4.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.1" style="padding:-1pt 4.0pt;">TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.2" style="padding:-1pt 4.0pt;">95.34</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.3" style="padding:-1pt 4.0pt;">82.30</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.4" style="padding:-1pt 4.0pt;">94.80</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.5" style="padding:-1pt 4.0pt;">78.30</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.6" style="padding:-1pt 4.0pt;">94.15</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.4.4.7" style="padding:-1pt 4.0pt;">81.39</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.4.4.8" style="padding:-1pt 4.0pt;">87.71<span class="ltx_text" id="S4.T1.1.4.4.8.1" style="font-size:70%;">±7.16</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.5.5">
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.1" style="padding:-1pt 4.0pt;">RN-CR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.2" style="padding:-1pt 4.0pt;">95.15</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.3" style="padding:-1pt 4.0pt;">80.55</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.4" style="padding:-1pt 4.0pt;">94.16</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.5" style="padding:-1pt 4.0pt;">76.39</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.6" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.5.5.6.1">\ul</span>94.24</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.5.5.7" style="padding:-1pt 4.0pt;">80.80</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.5.5.8" style="padding:-1pt 4.0pt;">86.88<span class="ltx_text" id="S4.T1.1.5.5.8.1" style="font-size:70%;">±7.77</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.6.6">
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.1" style="padding:-1pt 4.0pt;">AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.2" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.6.6.2.1">95.42</span></td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.3" style="padding:-1pt 4.0pt;">84.94</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.4" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.6.6.4.1">\ul</span>94.89</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.5" style="padding:-1pt 4.0pt;">79.21</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.6" style="padding:-1pt 4.0pt;">94.19</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.6.6.7" style="padding:-1pt 4.0pt;">82.84</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.6.6.8" style="padding:-1pt 4.0pt;">88.58<span class="ltx_text" id="S4.T1.1.6.6.8.1" style="font-size:70%;">±6.48</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.7.7">
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.1" style="padding:-1pt 4.0pt;">OCL<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.2" style="padding:-1pt 4.0pt;">94.61</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.3" style="padding:-1pt 4.0pt;">81.80</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.4" style="padding:-1pt 4.0pt;">94.73</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.5" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.7.7.5.1">\ul</span>83.07</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.6" style="padding:-1pt 4.0pt;">94.04</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.7.7.7" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.7.7.7.1">\ul</span>84.51</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.7.7.8" style="padding:-1pt 4.0pt;">88.79<span class="ltx_text" id="S4.T1.1.7.7.8.1" style="font-size:70%;">±5.72</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.8.8">
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.1" style="padding:-1pt 4.0pt;">ProSFDA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.2" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.8.8.2.1">\ul</span>95.37</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.3" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.8.8.3.1">85.40</span></td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.4" style="padding:-1pt 4.0pt;">94.58</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.5" style="padding:-1pt 4.0pt;">81.43</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.6" style="padding:-1pt 4.0pt;">93.91</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.8.8.7" style="padding:-1pt 4.0pt;">82.92</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.8.8.8" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T1.1.8.8.8.1">\ul</span>88.94<span class="ltx_text" id="S4.T1.1.8.8.8.2" style="font-size:70%;">±5.82</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.9.9">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.1" style="padding:-1pt 4.0pt;">PASS (ours)</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.2" style="padding:-1pt 4.0pt;">95.18</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.3" style="padding:-1pt 4.0pt;">84.52</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.4" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.9.9.4.1">95.25</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.5" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.9.9.5.1">83.99</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.6" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.9.9.6.1">94.75</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.7" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.9.9.7.1">85.52</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T1.1.9.9.8" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.9.9.8.1">89.87<span class="ltx_text" id="S4.T1.1.9.9.8.1.1" style="font-size:70%;">±5.21</span></span></td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_figure" id="S4.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="527" id="S4.F3.g1" src="x3.png" width="789"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Graphical comparison of the online TTA performance and the number of parameters (M) among different TTA models on the OD/OC and prostate datasets.</figcaption>
</figure>
<figure class="ltx_table" id="S4.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>Online TTA performance of different methods in DSC Score (%) on three OD/OC segmentation test sets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S4.T2.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T2.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S4.T2.1.1.1.1" rowspan="2" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S4.T2.1.1.1.1.1">Method</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T2.1.1.1.2" style="padding:-1pt 4.0pt;">BASE1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T2.1.1.1.3" style="padding:-1pt 4.0pt;">BASE2</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T2.1.1.1.4" style="padding:-1pt 4.0pt;">BASE3</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.1.1.1.5" rowspan="2" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S4.T2.1.1.1.5.1">Average</span></th>
</tr>
<tr class="ltx_tr" id="S4.T2.1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.1" style="padding:-1pt 4.0pt;">OD</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.2" style="padding:-1pt 4.0pt;">OC</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.3" style="padding:-1pt 4.0pt;">OD</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.4" style="padding:-1pt 4.0pt;">OC</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.5" style="padding:-1pt 4.0pt;">OD</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.2.2.6" style="padding:-1pt 4.0pt;">OC</th>
</tr>
<tr class="ltx_tr" id="S4.T2.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_t" id="S4.T2.1.3.3.1" style="padding:-1pt 4.0pt;">Source Only</th>
<th class="ltx_td ltx_nopad_l ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.2" style="padding:-1pt 4.0pt;">95.21</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.3" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.3.3.3.1">\ul</span>85.20</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.4" style="padding:-1pt 4.0pt;">92.58</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.5" style="padding:-1pt 4.0pt;">77.73</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.6" style="padding:-1pt 4.0pt;">93.72</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.7" style="padding:-1pt 4.0pt;">82.16</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.1.3.3.8" style="padding:-1pt 4.0pt;">87.77<span class="ltx_text" id="S4.T2.1.3.3.8.1" style="font-size:70%;">±6.49</span>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T2.1.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T2.1.4.1.1" style="padding:-1pt 4.0pt;">PTBN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center ltx_border_t" id="S4.T2.1.4.1.2" style="padding:-1pt 4.0pt;">94.21</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.3" style="padding:-1pt 4.0pt;">80.87</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.4" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.4.1.4.1">\ul</span>94.51</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.5" style="padding:-1pt 4.0pt;">74.95</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.6" style="padding:-1pt 4.0pt;">93.05</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.7" style="padding:-1pt 4.0pt;">79.02</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.4.1.8" style="padding:-1pt 4.0pt;">86.10<span class="ltx_text" id="S4.T2.1.4.1.8.1" style="font-size:70%;">±8.03</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.5.2.1" style="padding:-1pt 4.0pt;">TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.5.2.2" style="padding:-1pt 4.0pt;">95.05</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.3" style="padding:-1pt 4.0pt;">84.19</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.4" style="padding:-1pt 4.0pt;">93.42</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.5" style="padding:-1pt 4.0pt;">79.07</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.6" style="padding:-1pt 4.0pt;">93.66</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.7" style="padding:-1pt 4.0pt;">83.05</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.5.2.8" style="padding:-1pt 4.0pt;">88.07<span class="ltx_text" id="S4.T2.1.5.2.8.1" style="font-size:70%;">±6.19</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.6.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.6.3.1" style="padding:-1pt 4.0pt;">RN-CR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.6.3.2" style="padding:-1pt 4.0pt;">95.27</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.3" style="padding:-1pt 4.0pt;">84.67</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.4" style="padding:-1pt 4.0pt;">94.35</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.5" style="padding:-1pt 4.0pt;">75.70</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.6" style="padding:-1pt 4.0pt;">94.11</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.7" style="padding:-1pt 4.0pt;">80.57</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.6.3.8" style="padding:-1pt 4.0pt;">87.45<span class="ltx_text" id="S4.T2.1.6.3.8.1" style="font-size:70%;">±7.60</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.7.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.7.4.1" style="padding:-1pt 4.0pt;">AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.7.4.2" style="padding:-1pt 4.0pt;">95.05</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.3" style="padding:-1pt 4.0pt;">85.07</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.4" style="padding:-1pt 4.0pt;">93.62</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.5" style="padding:-1pt 4.0pt;">79.61</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.6" style="padding:-1pt 4.0pt;">93.97</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.7" style="padding:-1pt 4.0pt;">83.43</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.7.4.8" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.7.4.8.1">\ul</span>88.46<span class="ltx_text" id="S4.T2.1.7.4.8.2" style="font-size:70%;">±5.99</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.8.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.8.5.1" style="padding:-1pt 4.0pt;">DAE<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib27" title="">27</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.8.5.2" style="padding:-1pt 4.0pt;">93.82</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.3" style="padding:-1pt 4.0pt;">82.71</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.4" style="padding:-1pt 4.0pt;">92.23</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.5" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.8.5.5.1">\ul</span>81.24</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.6" style="padding:-1pt 4.0pt;">94.08</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.7" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.8.5.7.1">84.86</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.8.5.8" style="padding:-1pt 4.0pt;">88.16<span class="ltx_text" id="S4.T2.1.8.5.8.1" style="font-size:70%;">±5.36</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.9.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.9.6.1" style="padding:-1pt 4.0pt;">DPG<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.9.6.2" style="padding:-1pt 4.0pt;">95.26</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.3" style="padding:-1pt 4.0pt;">84.14</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.4" style="padding:-1pt 4.0pt;">93.45</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.5" style="padding:-1pt 4.0pt;">78.11</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.6" style="padding:-1pt 4.0pt;">93.76</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.7" style="padding:-1pt 4.0pt;">80.97</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.9.6.8" style="padding:-1pt 4.0pt;">87.62<span class="ltx_text" id="S4.T2.1.9.6.8.1" style="font-size:70%;">±6.79</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.10.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.10.7.1" style="padding:-1pt 4.0pt;">OCL<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.10.7.2" style="padding:-1pt 4.0pt;">95.11</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.3" style="padding:-1pt 4.0pt;">84.08</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.4" style="padding:-1pt 4.0pt;">94.11</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.5" style="padding:-1pt 4.0pt;">77.58</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.6" style="padding:-1pt 4.0pt;">94.07</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.7" style="padding:-1pt 4.0pt;">81.41</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.10.7.8" style="padding:-1pt 4.0pt;">87.73<span class="ltx_text" id="S4.T2.1.10.7.8.1" style="font-size:70%;">±6.97</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.11.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.11.8.1" style="padding:-1pt 4.0pt;">TIPI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib39" title="">39</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.11.8.2" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.11.8.2.1">\ul</span>95.43</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.3" style="padding:-1pt 4.0pt;">84.67</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.4" style="padding:-1pt 4.0pt;">93.22</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.5" style="padding:-1pt 4.0pt;">77.60</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.6" style="padding:-1pt 4.0pt;">94.05</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.7" style="padding:-1pt 4.0pt;">82.56</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.11.8.8" style="padding:-1pt 4.0pt;">87.92<span class="ltx_text" id="S4.T2.1.11.8.8.1" style="font-size:70%;">±6.68</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.12.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.12.9.1" style="padding:-1pt 4.0pt;">CoTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.12.9.2" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.12.9.2.1">95.62</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.3" style="padding:-1pt 4.0pt;">82.98</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.4" style="padding:-1pt 4.0pt;">94.36</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.5" style="padding:-1pt 4.0pt;">75.12</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.6" style="padding:-1pt 4.0pt;">93.93</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.7" style="padding:-1pt 4.0pt;">80.47</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.12.9.8" style="padding:-1pt 4.0pt;">87.08<span class="ltx_text" id="S4.T2.1.12.9.8.1" style="font-size:70%;">±7.92</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.13.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.13.10.1" style="padding:-1pt 4.0pt;">DUA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.13.10.2" style="padding:-1pt 4.0pt;">95.39</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.3" style="padding:-1pt 4.0pt;">84.06</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.4" style="padding:-1pt 4.0pt;">93.53</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.5" style="padding:-1pt 4.0pt;">74.97</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.6" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.13.10.6.1">\ul</span>94.43</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.7" style="padding:-1pt 4.0pt;">83.21</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.13.10.8" style="padding:-1pt 4.0pt;">87.59<span class="ltx_text" id="S4.T2.1.13.10.8.1" style="font-size:70%;">±7.46</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.14.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.14.11.1" style="padding:-1pt 4.0pt;">SAR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.14.11.2" style="padding:-1pt 4.0pt;">95.24</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.3" style="padding:-1pt 4.0pt;">82.37</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.4" style="padding:-1pt 4.0pt;">94.37</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.5" style="padding:-1pt 4.0pt;">75.11</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.6" style="padding:-1pt 4.0pt;">93.93</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.7" style="padding:-1pt 4.0pt;">80.48</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.14.11.8" style="padding:-1pt 4.0pt;">86.92<span class="ltx_text" id="S4.T2.1.14.11.8.1" style="font-size:70%;">±7.91</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.15.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T2.1.15.12.1" style="padding:-1pt 4.0pt;">VPTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>
</th>
<td class="ltx_td ltx_nopad_l ltx_align_center" id="S4.T2.1.15.12.2" style="padding:-1pt 4.0pt;">95.22</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.3" style="padding:-1pt 4.0pt;">84.45</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.4" style="padding:-1pt 4.0pt;">94.30</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.5" style="padding:-1pt 4.0pt;">78.12</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.6" style="padding:-1pt 4.0pt;">94.42</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.7" style="padding:-1pt 4.0pt;">82.88</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.15.12.8" style="padding:-1pt 4.0pt;">88.23<span class="ltx_text" id="S4.T2.1.15.12.8.1" style="font-size:70%;">±6.70</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.16.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.1" style="padding:-1pt 4.0pt;">PASS (ours)</th>
<td class="ltx_td ltx_nopad_l ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.2" style="padding:-1pt 4.0pt;">95.26</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.3" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.16.13.3.1">85.33</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.4" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.16.13.4.1">95.12</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.5" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.16.13.5.1">83.18</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.6" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.16.13.6.1">94.61</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.7" style="padding:-1pt 4.0pt;">
<span class="ltx_ERROR undefined" id="S4.T2.1.16.13.7.1">\ul</span>83.77</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.1.16.13.8" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.1.16.13.8.1">89.55<span class="ltx_text" id="S4.T2.1.16.13.8.1.1" style="font-size:70%;">±5.49</span></span></td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="S4.T3">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>Offline TTA performance of different methods in DSC Sore (%) and the 95th percentile of the Hausdorff Distance (HD95) on five prostate segmentation test sets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T3.12">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T3.12.13.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T3.12.13.1.1" rowspan="2" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text" id="S4.T3.12.13.1.1.1">Method</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.2" style="padding-top:-1pt;padding-bottom:-1pt;">B (BMC)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.3" style="padding-top:-1pt;padding-bottom:-1pt;">C (I2CVB)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.4" style="padding-top:-1pt;padding-bottom:-1pt;">D (UCL)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.5" style="padding-top:-1pt;padding-bottom:-1pt;">E (BIDMC)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.6" style="padding-top:-1pt;padding-bottom:-1pt;">F (HK)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T3.12.13.1.7" style="padding-top:-1pt;padding-bottom:-1pt;">Average</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.12">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.1.1.1.m1.1"><semantics id="S4.T3.1.1.1.m1.1a"><mo id="S4.T3.1.1.1.m1.1.1" stretchy="false" xref="S4.T3.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.1.1.1.m1.1b"><ci id="S4.T3.1.1.1.m1.1.1.cmml" xref="S4.T3.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.2.2" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.2.2.2.m1.1"><semantics id="S4.T3.2.2.2.m1.1a"><mo id="S4.T3.2.2.2.m1.1.1" stretchy="false" xref="S4.T3.2.2.2.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.2.2.2.m1.1b"><ci id="S4.T3.2.2.2.m1.1.1.cmml" xref="S4.T3.2.2.2.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.2.2.2.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.2.2.2.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.3.3.3.m1.1"><semantics id="S4.T3.3.3.3.m1.1a"><mo id="S4.T3.3.3.3.m1.1.1" stretchy="false" xref="S4.T3.3.3.3.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.3.3.3.m1.1b"><ci id="S4.T3.3.3.3.m1.1.1.cmml" xref="S4.T3.3.3.3.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.3.3.3.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.3.3.3.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.4.4.4" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.4.4.4.m1.1"><semantics id="S4.T3.4.4.4.m1.1a"><mo id="S4.T3.4.4.4.m1.1.1" stretchy="false" xref="S4.T3.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.4.4.4.m1.1b"><ci id="S4.T3.4.4.4.m1.1.1.cmml" xref="S4.T3.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.5.5.5.m1.1"><semantics id="S4.T3.5.5.5.m1.1a"><mo id="S4.T3.5.5.5.m1.1.1" stretchy="false" xref="S4.T3.5.5.5.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.5.5.5.m1.1b"><ci id="S4.T3.5.5.5.m1.1.1.cmml" xref="S4.T3.5.5.5.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.5.5.5.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.5.5.5.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.6" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.6.6.6.m1.1"><semantics id="S4.T3.6.6.6.m1.1a"><mo id="S4.T3.6.6.6.m1.1.1" stretchy="false" xref="S4.T3.6.6.6.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.6.6.6.m1.1b"><ci id="S4.T3.6.6.6.m1.1.1.cmml" xref="S4.T3.6.6.6.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.6.6.6.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.6.6.6.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.7" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.7.7.7.m1.1"><semantics id="S4.T3.7.7.7.m1.1a"><mo id="S4.T3.7.7.7.m1.1.1" stretchy="false" xref="S4.T3.7.7.7.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.7.7.7.m1.1b"><ci id="S4.T3.7.7.7.m1.1.1.cmml" xref="S4.T3.7.7.7.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.7.7.7.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.7.7.7.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.8.8.8" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.8.8.8.m1.1"><semantics id="S4.T3.8.8.8.m1.1a"><mo id="S4.T3.8.8.8.m1.1.1" stretchy="false" xref="S4.T3.8.8.8.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.8.8.8.m1.1b"><ci id="S4.T3.8.8.8.m1.1.1.cmml" xref="S4.T3.8.8.8.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.8.8.8.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.8.8.8.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.9.9.9" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.9.9.9.m1.1"><semantics id="S4.T3.9.9.9.m1.1a"><mo id="S4.T3.9.9.9.m1.1.1" stretchy="false" xref="S4.T3.9.9.9.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.9.9.9.m1.1b"><ci id="S4.T3.9.9.9.m1.1.1.cmml" xref="S4.T3.9.9.9.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.9.9.9.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.9.9.9.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.10.10.10" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.10.10.10.m1.1"><semantics id="S4.T3.10.10.10.m1.1a"><mo id="S4.T3.10.10.10.m1.1.1" stretchy="false" xref="S4.T3.10.10.10.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.10.10.10.m1.1b"><ci id="S4.T3.10.10.10.m1.1.1.cmml" xref="S4.T3.10.10.10.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.10.10.10.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.10.10.10.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.11.11.11" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T3.11.11.11.m1.1"><semantics id="S4.T3.11.11.11.m1.1a"><mo id="S4.T3.11.11.11.m1.1.1" stretchy="false" xref="S4.T3.11.11.11.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T3.11.11.11.m1.1b"><ci id="S4.T3.11.11.11.m1.1.1.cmml" xref="S4.T3.11.11.11.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.11.11.11.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.11.11.11.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.12.12.12" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T3.12.12.12.m1.1"><semantics id="S4.T3.12.12.12.m1.1a"><mo id="S4.T3.12.12.12.m1.1.1" stretchy="false" xref="S4.T3.12.12.12.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T3.12.12.12.m1.1b"><ci id="S4.T3.12.12.12.m1.1.1.cmml" xref="S4.T3.12.12.12.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.12.12.12.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T3.12.12.12.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.14.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.1" style="padding-top:-1pt;padding-bottom:-1pt;">Source Only</td>
<td class="ltx_td ltx_nopad_l ltx_align_left ltx_border_t" id="S4.T3.12.14.2.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.24</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.3" style="padding-top:-1pt;padding-bottom:-1pt;">14.14</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.4" style="padding-top:-1pt;padding-bottom:-1pt;">69.76</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.5" style="padding-top:-1pt;padding-bottom:-1pt;">31.09</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.41</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.7" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.14.2.7.1">\ul</span>14.68</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.8" style="padding-top:-1pt;padding-bottom:-1pt;">48.49</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.9" style="padding-top:-1pt;padding-bottom:-1pt;">54.03</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.90</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.13</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.12.14.2.12" style="padding-top:-1pt;padding-bottom:-1pt;">72.36<span class="ltx_text" id="S4.T3.12.14.2.12.1" style="font-size:70%;">±12.91</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.14.2.13" style="padding-top:-1pt;padding-bottom:-1pt;">23.41<span class="ltx_text" id="S4.T3.12.14.2.13.1" style="font-size:70%;">±17.72</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.15.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.1" style="padding-top:-1pt;padding-bottom:-1pt;">TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>
</td>
<td class="ltx_td ltx_nopad_l ltx_align_left ltx_border_t" id="S4.T3.12.15.3.2" style="padding-top:-1pt;padding-bottom:-1pt;">82.68</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.3" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.15.3.3.1">\ul</span>4.78</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.4" style="padding-top:-1pt;padding-bottom:-1pt;">72.34</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.5" style="padding-top:-1pt;padding-bottom:-1pt;">24.43</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.51</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.7" style="padding-top:-1pt;padding-bottom:-1pt;">17.43</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.8" style="padding-top:-1pt;padding-bottom:-1pt;">55.04</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.9" style="padding-top:-1pt;padding-bottom:-1pt;">62.09</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.10" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.15.3.10.1">86.48</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.11" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.15.3.11.1">2.66</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.12.15.3.12" style="padding-top:-1pt;padding-bottom:-1pt;">75.41<span class="ltx_text" id="S4.T3.12.15.3.12.1" style="font-size:70%;">±11.19</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.12.15.3.13" style="padding-top:-1pt;padding-bottom:-1pt;">22.28<span class="ltx_text" id="S4.T3.12.15.3.13.1" style="font-size:70%;">±21.47</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.16.4">
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.1" style="padding-top:-1pt;padding-bottom:-1pt;">RN-CR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>]</cite>
</td>
<td class="ltx_td ltx_nopad_l ltx_align_left" id="S4.T3.12.16.4.2" style="padding-top:-1pt;padding-bottom:-1pt;">57.35</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.3" style="padding-top:-1pt;padding-bottom:-1pt;">57.17</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.4" style="padding-top:-1pt;padding-bottom:-1pt;">32.79</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.5" style="padding-top:-1pt;padding-bottom:-1pt;">141.03</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.6" style="padding-top:-1pt;padding-bottom:-1pt;">64.95</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.7" style="padding-top:-1pt;padding-bottom:-1pt;">38.27</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.8" style="padding-top:-1pt;padding-bottom:-1pt;">48.73</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.9" style="padding-top:-1pt;padding-bottom:-1pt;">61.17</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.10" style="padding-top:-1pt;padding-bottom:-1pt;">85.17</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.11" style="padding-top:-1pt;padding-bottom:-1pt;">4.22</td>
<td class="ltx_td ltx_align_center" id="S4.T3.12.16.4.12" style="padding-top:-1pt;padding-bottom:-1pt;">57.80<span class="ltx_text" id="S4.T3.12.16.4.12.1" style="font-size:70%;">±17.37</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.16.4.13" style="padding-top:-1pt;padding-bottom:-1pt;">60.37<span class="ltx_text" id="S4.T3.12.16.4.13.1" style="font-size:70%;">±45.07</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.17.5">
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.1" style="padding-top:-1pt;padding-bottom:-1pt;">AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>
</td>
<td class="ltx_td ltx_nopad_l ltx_align_left" id="S4.T3.12.17.5.2" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.2.1">\ul</span>82.80</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.3" style="padding-top:-1pt;padding-bottom:-1pt;">6.08</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.4" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.4.1">\ul</span>72.74</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.5" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.5.1">\ul</span>24.36</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.90</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.7" style="padding-top:-1pt;padding-bottom:-1pt;">15.62</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.8" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.8.1">\ul</span>59.04</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.9" style="padding-top:-1pt;padding-bottom:-1pt;">47.41</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.10" style="padding-top:-1pt;padding-bottom:-1pt;">86.36</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.11" style="padding-top:-1pt;padding-bottom:-1pt;">2.69</td>
<td class="ltx_td ltx_align_center" id="S4.T3.12.17.5.12" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.12.1">\ul</span>76.37<span class="ltx_text" id="S4.T3.12.17.5.12.2" style="font-size:70%;">±9.75</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.17.5.13" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.17.5.13.1">\ul</span>19.23<span class="ltx_text" id="S4.T3.12.17.5.13.2" style="font-size:70%;">±16.00</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.18.6">
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.1" style="padding-top:-1pt;padding-bottom:-1pt;">OCL<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite>
</td>
<td class="ltx_td ltx_nopad_l ltx_align_left" id="S4.T3.12.18.6.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.46</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.3" style="padding-top:-1pt;padding-bottom:-1pt;">12.92</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.4" style="padding-top:-1pt;padding-bottom:-1pt;">71.55</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.5" style="padding-top:-1pt;padding-bottom:-1pt;">29.10</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.6" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.18.6.6.1">81.65</span></td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.7" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.18.6.7.1">12.84</span></td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.8" style="padding-top:-1pt;padding-bottom:-1pt;">51.83</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.9" style="padding-top:-1pt;padding-bottom:-1pt;">52.75</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.96</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.02</td>
<td class="ltx_td ltx_align_center" id="S4.T3.12.18.6.12" style="padding-top:-1pt;padding-bottom:-1pt;">73.69<span class="ltx_text" id="S4.T3.12.18.6.12.1" style="font-size:70%;">±11.79</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.18.6.13" style="padding-top:-1pt;padding-bottom:-1pt;">22.13<span class="ltx_text" id="S4.T3.12.18.6.13.1" style="font-size:70%;">±17.45</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.19.7">
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.1" style="padding-top:-1pt;padding-bottom:-1pt;">ProSFDA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite>
</td>
<td class="ltx_td ltx_nopad_l ltx_align_left" id="S4.T3.12.19.7.2" style="padding-top:-1pt;padding-bottom:-1pt;">74.60</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.3" style="padding-top:-1pt;padding-bottom:-1pt;">14.95</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.4" style="padding-top:-1pt;padding-bottom:-1pt;">53.66</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.5" style="padding-top:-1pt;padding-bottom:-1pt;">28.23</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.6" style="padding-top:-1pt;padding-bottom:-1pt;">77.50</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.7" style="padding-top:-1pt;padding-bottom:-1pt;">21.23</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.8" style="padding-top:-1pt;padding-bottom:-1pt;">48.35</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.9" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.19.7.9.1">\ul</span>43.77</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.10" style="padding-top:-1pt;padding-bottom:-1pt;">85.50</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.11" style="padding-top:-1pt;padding-bottom:-1pt;">2.91</td>
<td class="ltx_td ltx_align_center" id="S4.T3.12.19.7.12" style="padding-top:-1pt;padding-bottom:-1pt;">67.92<span class="ltx_text" id="S4.T3.12.19.7.12.1" style="font-size:70%;">±16.06</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T3.12.19.7.13" style="padding-top:-1pt;padding-bottom:-1pt;">22.22<span class="ltx_text" id="S4.T3.12.19.7.13.1" style="font-size:70%;">±13.62</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.12.20.8">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.1" style="padding-top:-1pt;padding-bottom:-1pt;">PASS (ours)</td>
<td class="ltx_td ltx_nopad_l ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.2" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.2.1">83.28</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.3" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.3.1">4.49</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.4" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.4.1">75.36</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.5" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.5.1">20.11</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.6" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.20.8.6.1">\ul</span>80.92</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.7" style="padding-top:-1pt;padding-bottom:-1pt;">18.29</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.8" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.8.1">72.43</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.9" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.9.1">25.74</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.10" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.20.8.10.1">\ul</span>86.42</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.11" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T3.12.20.8.11.1">\ul</span>2.67</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.12" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.12.1">79.68<span class="ltx_text" id="S4.T3.12.20.8.12.1.1" style="font-size:70%;">±5.12</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.12.20.8.13" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.12.20.8.13.1">14.26<span class="ltx_text" id="S4.T3.12.20.8.13.1.1" style="font-size:70%;">±9.08</span></span></td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="S4.T4">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>Online TTA performance of different methods in DSC Sore (%) and the 95th percentile of the Hausdorff Distance (HD95) on five prostate segmentation test sets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S4.T4.12">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T4.12.13.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S4.T4.12.13.1.1" rowspan="2" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text" id="S4.T4.12.13.1.1.1">Method</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.2" style="padding-top:-1pt;padding-bottom:-1pt;">B (BMC)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.3" style="padding-top:-1pt;padding-bottom:-1pt;">C (I2CVB)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.4" style="padding-top:-1pt;padding-bottom:-1pt;">D (UCL)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.5" style="padding-top:-1pt;padding-bottom:-1pt;">E (BIDMC)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.6" style="padding-top:-1pt;padding-bottom:-1pt;">F (HK)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T4.12.13.1.7" style="padding-top:-1pt;padding-bottom:-1pt;">Average</th>
</tr>
<tr class="ltx_tr" id="S4.T4.12.12">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.1.1.1" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.1.1.1.m1.1"><semantics id="S4.T4.1.1.1.m1.1a"><mo id="S4.T4.1.1.1.m1.1.1" stretchy="false" xref="S4.T4.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.1.1.1.m1.1b"><ci id="S4.T4.1.1.1.m1.1.1.cmml" xref="S4.T4.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.1.1.1.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.2.2.2" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.2.2.2.m1.1"><semantics id="S4.T4.2.2.2.m1.1a"><mo id="S4.T4.2.2.2.m1.1.1" stretchy="false" xref="S4.T4.2.2.2.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.2.2.2.m1.1b"><ci id="S4.T4.2.2.2.m1.1.1.cmml" xref="S4.T4.2.2.2.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.2.2.2.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.2.2.2.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.3.3.3" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.3.3.3.m1.1"><semantics id="S4.T4.3.3.3.m1.1a"><mo id="S4.T4.3.3.3.m1.1.1" stretchy="false" xref="S4.T4.3.3.3.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.3.3.3.m1.1b"><ci id="S4.T4.3.3.3.m1.1.1.cmml" xref="S4.T4.3.3.3.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.3.3.3.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.3.3.3.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.4.4.4" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.4.4.4.m1.1"><semantics id="S4.T4.4.4.4.m1.1a"><mo id="S4.T4.4.4.4.m1.1.1" stretchy="false" xref="S4.T4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.4.4.4.m1.1b"><ci id="S4.T4.4.4.4.m1.1.1.cmml" xref="S4.T4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.4.4.4.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.5.5.5" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.5.5.5.m1.1"><semantics id="S4.T4.5.5.5.m1.1a"><mo id="S4.T4.5.5.5.m1.1.1" stretchy="false" xref="S4.T4.5.5.5.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.5.5.5.m1.1b"><ci id="S4.T4.5.5.5.m1.1.1.cmml" xref="S4.T4.5.5.5.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.5.5.5.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.5.5.5.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.6.6.6" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.6.6.6.m1.1"><semantics id="S4.T4.6.6.6.m1.1a"><mo id="S4.T4.6.6.6.m1.1.1" stretchy="false" xref="S4.T4.6.6.6.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.6.6.6.m1.1b"><ci id="S4.T4.6.6.6.m1.1.1.cmml" xref="S4.T4.6.6.6.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.6.6.6.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.6.6.6.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.7.7.7" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.7.7.7.m1.1"><semantics id="S4.T4.7.7.7.m1.1a"><mo id="S4.T4.7.7.7.m1.1.1" stretchy="false" xref="S4.T4.7.7.7.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.7.7.7.m1.1b"><ci id="S4.T4.7.7.7.m1.1.1.cmml" xref="S4.T4.7.7.7.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.7.7.7.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.7.7.7.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.8.8.8" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.8.8.8.m1.1"><semantics id="S4.T4.8.8.8.m1.1a"><mo id="S4.T4.8.8.8.m1.1.1" stretchy="false" xref="S4.T4.8.8.8.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.8.8.8.m1.1b"><ci id="S4.T4.8.8.8.m1.1.1.cmml" xref="S4.T4.8.8.8.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.8.8.8.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.8.8.8.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.9.9.9" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.9.9.9.m1.1"><semantics id="S4.T4.9.9.9.m1.1a"><mo id="S4.T4.9.9.9.m1.1.1" stretchy="false" xref="S4.T4.9.9.9.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.9.9.9.m1.1b"><ci id="S4.T4.9.9.9.m1.1.1.cmml" xref="S4.T4.9.9.9.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.9.9.9.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.9.9.9.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.10.10.10" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.10.10.10.m1.1"><semantics id="S4.T4.10.10.10.m1.1a"><mo id="S4.T4.10.10.10.m1.1.1" stretchy="false" xref="S4.T4.10.10.10.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.10.10.10.m1.1b"><ci id="S4.T4.10.10.10.m1.1.1.cmml" xref="S4.T4.10.10.10.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.10.10.10.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.10.10.10.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.11.11.11" style="padding-top:-1pt;padding-bottom:-1pt;">DSC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T4.11.11.11.m1.1"><semantics id="S4.T4.11.11.11.m1.1a"><mo id="S4.T4.11.11.11.m1.1.1" stretchy="false" xref="S4.T4.11.11.11.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T4.11.11.11.m1.1b"><ci id="S4.T4.11.11.11.m1.1.1.cmml" xref="S4.T4.11.11.11.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.11.11.11.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.11.11.11.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.12.12" style="padding-top:-1pt;padding-bottom:-1pt;">HD95<math alttext="\downarrow" class="ltx_Math" display="inline" id="S4.T4.12.12.12.m1.1"><semantics id="S4.T4.12.12.12.m1.1a"><mo id="S4.T4.12.12.12.m1.1.1" stretchy="false" xref="S4.T4.12.12.12.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S4.T4.12.12.12.m1.1b"><ci id="S4.T4.12.12.12.m1.1.1.cmml" xref="S4.T4.12.12.12.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.12.12.12.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S4.T4.12.12.12.m1.1d">↓</annotation></semantics></math>
</th>
</tr>
<tr class="ltx_tr" id="S4.T4.12.14.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.1" style="padding-top:-1pt;padding-bottom:-1pt;">Source Only</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.24</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.3" style="padding-top:-1pt;padding-bottom:-1pt;">14.14</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.4" style="padding-top:-1pt;padding-bottom:-1pt;">69.76</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.5" style="padding-top:-1pt;padding-bottom:-1pt;">31.09</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.41</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.7" style="padding-top:-1pt;padding-bottom:-1pt;">14.68</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.8" style="padding-top:-1pt;padding-bottom:-1pt;">48.49</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.9" style="padding-top:-1pt;padding-bottom:-1pt;">54.03</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.90</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.13</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.12" style="padding-top:-1pt;padding-bottom:-1pt;">72.36<span class="ltx_text" id="S4.T4.12.14.2.12.1" style="font-size:70%;">±12.91</span>
</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T4.12.14.2.13" style="padding-top:-1pt;padding-bottom:-1pt;">23.41<span class="ltx_text" id="S4.T4.12.14.2.13.1" style="font-size:70%;">±17.72</span>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T4.12.15.1">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.1" style="padding-top:-1pt;padding-bottom:-1pt;">PTBN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>]</cite>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.19</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.3" style="padding-top:-1pt;padding-bottom:-1pt;">17.90</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.4" style="padding-top:-1pt;padding-bottom:-1pt;">65.56</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.5" style="padding-top:-1pt;padding-bottom:-1pt;">47.36</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.6" style="padding-top:-1pt;padding-bottom:-1pt;">77.11</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.7" style="padding-top:-1pt;padding-bottom:-1pt;">21.95</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.8" style="padding-top:-1pt;padding-bottom:-1pt;">42.30</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.9" style="padding-top:-1pt;padding-bottom:-1pt;">58.34</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.71</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.37</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.12.15.1.12" style="padding-top:-1pt;padding-bottom:-1pt;">69.57<span class="ltx_text" id="S4.T4.12.15.1.12.1" style="font-size:70%;">±14.97</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.12.15.1.13" style="padding-top:-1pt;padding-bottom:-1pt;">29.78<span class="ltx_text" id="S4.T4.12.15.1.13.1" style="font-size:70%;">±20.12</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.16.2">
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.1" style="padding-top:-1pt;padding-bottom:-1pt;">TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.54</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.3" style="padding-top:-1pt;padding-bottom:-1pt;">11.64</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.4" style="padding-top:-1pt;padding-bottom:-1pt;">69.71</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.5" style="padding-top:-1pt;padding-bottom:-1pt;">31.38</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.64</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.7" style="padding-top:-1pt;padding-bottom:-1pt;">14.55</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.8" style="padding-top:-1pt;padding-bottom:-1pt;">51.72</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.9" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.16.2.9.1">\ul</span>27.01</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.09</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.16.2.12" style="padding-top:-1pt;padding-bottom:-1pt;">73.10<span class="ltx_text" id="S4.T4.12.16.2.12.1" style="font-size:70%;">±11.79</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.16.2.13" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.16.2.13.1">\ul</span>17.53<span class="ltx_text" id="S4.T4.12.16.2.13.2" style="font-size:70%;">±10.33</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.17.3">
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.1" style="padding-top:-1pt;padding-bottom:-1pt;">RN-CR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.2" style="padding-top:-1pt;padding-bottom:-1pt;">21.17</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.3" style="padding-top:-1pt;padding-bottom:-1pt;">134.92</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.4" style="padding-top:-1pt;padding-bottom:-1pt;">17.02</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.5" style="padding-top:-1pt;padding-bottom:-1pt;">165.59</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.6" style="padding-top:-1pt;padding-bottom:-1pt;">37.59</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.7" style="padding-top:-1pt;padding-bottom:-1pt;">95.63</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.8" style="padding-top:-1pt;padding-bottom:-1pt;">32.07</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.9" style="padding-top:-1pt;padding-bottom:-1pt;">101.78</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.10" style="padding-top:-1pt;padding-bottom:-1pt;">67.57</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.11" style="padding-top:-1pt;padding-bottom:-1pt;">96.67</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.17.3.12" style="padding-top:-1pt;padding-bottom:-1pt;">35.08<span class="ltx_text" id="S4.T4.12.17.3.12.1" style="font-size:70%;">±17.84</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.17.3.13" style="padding-top:-1pt;padding-bottom:-1pt;">118.92<span class="ltx_text" id="S4.T4.12.17.3.13.1" style="font-size:70%;">±27.44</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.18.4">
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.1" style="padding-top:-1pt;padding-bottom:-1pt;">AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.46</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.3" style="padding-top:-1pt;padding-bottom:-1pt;">16.23</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.4" style="padding-top:-1pt;padding-bottom:-1pt;">68.78</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.5" style="padding-top:-1pt;padding-bottom:-1pt;">39.93</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.81</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.7" style="padding-top:-1pt;padding-bottom:-1pt;">13.00</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.8" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.18.4.8.1">\ul</span>55.44</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.9" style="padding-top:-1pt;padding-bottom:-1pt;">44.67</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.10" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.18.4.10.1">\ul</span>85.04</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.18</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.18.4.12" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.18.4.12.1">\ul</span>73.71<span class="ltx_text" id="S4.T4.12.18.4.12.2" style="font-size:70%;">±10.58</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.18.4.13" style="padding-top:-1pt;padding-bottom:-1pt;">23.40<span class="ltx_text" id="S4.T4.12.18.4.13.1" style="font-size:70%;">±16.09</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.19.5">
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.1" style="padding-top:-1pt;padding-bottom:-1pt;">DAE<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib27" title="">27</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.2" style="padding-top:-1pt;padding-bottom:-1pt;">57.96</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.3" style="padding-top:-1pt;padding-bottom:-1pt;">13.82</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.4" style="padding-top:-1pt;padding-bottom:-1pt;">31.26</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.5" style="padding-top:-1pt;padding-bottom:-1pt;">105.60</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.6" style="padding-top:-1pt;padding-bottom:-1pt;">63.86</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.7" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.19.5.7.1">\ul</span>11.17</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.8" style="padding-top:-1pt;padding-bottom:-1pt;">31.77</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.9" style="padding-top:-1pt;padding-bottom:-1pt;">72.87</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.10" style="padding-top:-1pt;padding-bottom:-1pt;">54.63</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.11" style="padding-top:-1pt;padding-bottom:-1pt;">15.13</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.19.5.12" style="padding-top:-1pt;padding-bottom:-1pt;">47.90<span class="ltx_text" id="S4.T4.12.19.5.12.1" style="font-size:70%;">±13.70</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.19.5.13" style="padding-top:-1pt;padding-bottom:-1pt;">43.72<span class="ltx_text" id="S4.T4.12.19.5.13.1" style="font-size:70%;">±38.60</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.20.6">
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.1" style="padding-top:-1pt;padding-bottom:-1pt;">DPG<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.2" style="padding-top:-1pt;padding-bottom:-1pt;">48.13</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.3" style="padding-top:-1pt;padding-bottom:-1pt;">143.19</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.4" style="padding-top:-1pt;padding-bottom:-1pt;">29.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.5" style="padding-top:-1pt;padding-bottom:-1pt;">101.67</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.6" style="padding-top:-1pt;padding-bottom:-1pt;">43.31</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.7" style="padding-top:-1pt;padding-bottom:-1pt;">94.38</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.8" style="padding-top:-1pt;padding-bottom:-1pt;">17.54</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.9" style="padding-top:-1pt;padding-bottom:-1pt;">141.66</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.10" style="padding-top:-1pt;padding-bottom:-1pt;">45.77</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.11" style="padding-top:-1pt;padding-bottom:-1pt;">124.53</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.20.6.12" style="padding-top:-1pt;padding-bottom:-1pt;">36.93<span class="ltx_text" id="S4.T4.12.20.6.12.1" style="font-size:70%;">±11.57</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.20.6.13" style="padding-top:-1pt;padding-bottom:-1pt;">121.09<span class="ltx_text" id="S4.T4.12.20.6.13.1" style="font-size:70%;">±20.06</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.21.7">
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.1" style="padding-top:-1pt;padding-bottom:-1pt;">OCL<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.2" style="padding-top:-1pt;padding-bottom:-1pt;">75.77</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.3" style="padding-top:-1pt;padding-bottom:-1pt;">15.29</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.4" style="padding-top:-1pt;padding-bottom:-1pt;">69.27</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.5" style="padding-top:-1pt;padding-bottom:-1pt;">31.56</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.6" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.21.7.6.1">81.79</span></td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.7" style="padding-top:-1pt;padding-bottom:-1pt;">12.57</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.8" style="padding-top:-1pt;padding-bottom:-1pt;">55.25</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.9" style="padding-top:-1pt;padding-bottom:-1pt;">41.41</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.11" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.21.7.11.1">\ul</span>2.99</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.21.7.12" style="padding-top:-1pt;padding-bottom:-1pt;">73.40<span class="ltx_text" id="S4.T4.12.21.7.12.1" style="font-size:70%;">±10.54</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.21.7.13" style="padding-top:-1pt;padding-bottom:-1pt;">20.76<span class="ltx_text" id="S4.T4.12.21.7.13.1" style="font-size:70%;">±13.83</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.22.8">
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.1" style="padding-top:-1pt;padding-bottom:-1pt;">TIPI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib17" title="">17</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.2" style="padding-top:-1pt;padding-bottom:-1pt;">79.06</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.3" style="padding-top:-1pt;padding-bottom:-1pt;">10.30</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.4" style="padding-top:-1pt;padding-bottom:-1pt;">68.96</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.5" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.22.8.5.1">\ul</span>30.68</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.56</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.7" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.22.8.7.1">9.89</span></td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.8" style="padding-top:-1pt;padding-bottom:-1pt;">44.61</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.9" style="padding-top:-1pt;padding-bottom:-1pt;">52.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.76</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.26</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.22.8.12" style="padding-top:-1pt;padding-bottom:-1pt;">71.59<span class="ltx_text" id="S4.T4.12.22.8.12.1" style="font-size:70%;">±14.45</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.22.8.13" style="padding-top:-1pt;padding-bottom:-1pt;">21.41<span class="ltx_text" id="S4.T4.12.22.8.13.1" style="font-size:70%;">±18.24</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.23.9">
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.1" style="padding-top:-1pt;padding-bottom:-1pt;">CoTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.37</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.3" style="padding-top:-1pt;padding-bottom:-1pt;">16.32</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.4" style="padding-top:-1pt;padding-bottom:-1pt;">66.52</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.5" style="padding-top:-1pt;padding-bottom:-1pt;">46.44</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.6" style="padding-top:-1pt;padding-bottom:-1pt;">77.15</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.7" style="padding-top:-1pt;padding-bottom:-1pt;">21.46</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.8" style="padding-top:-1pt;padding-bottom:-1pt;">43.24</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.9" style="padding-top:-1pt;padding-bottom:-1pt;">56.46</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.63</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.32</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.23.9.12" style="padding-top:-1pt;padding-bottom:-1pt;">69.98<span class="ltx_text" id="S4.T4.12.23.9.12.1" style="font-size:70%;">±14.58</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.23.9.13" style="padding-top:-1pt;padding-bottom:-1pt;">28.80<span class="ltx_text" id="S4.T4.12.23.9.13.1" style="font-size:70%;">±19.67</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.24.10">
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.1" style="padding-top:-1pt;padding-bottom:-1pt;">DUA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.2" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.24.10.2.1">\ul</span>79.20</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.3" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.24.10.3.1">\ul</span>9.86</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.4" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.24.10.4.1">\ul</span>69.80</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.5" style="padding-top:-1pt;padding-bottom:-1pt;">33.19</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.6" style="padding-top:-1pt;padding-bottom:-1pt;">79.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.7" style="padding-top:-1pt;padding-bottom:-1pt;">11.91</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.8" style="padding-top:-1pt;padding-bottom:-1pt;">50.89</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.9" style="padding-top:-1pt;padding-bottom:-1pt;">56.73</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.75</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.34</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.24.10.12" style="padding-top:-1pt;padding-bottom:-1pt;">72.91<span class="ltx_text" id="S4.T4.12.24.10.12.1" style="font-size:70%;">±12.03</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.24.10.13" style="padding-top:-1pt;padding-bottom:-1pt;">23.01<span class="ltx_text" id="S4.T4.12.24.10.13.1" style="font-size:70%;">±19.61</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.25.11">
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.1" style="padding-top:-1pt;padding-bottom:-1pt;">SAR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.2" style="padding-top:-1pt;padding-bottom:-1pt;">76.42</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.3" style="padding-top:-1pt;padding-bottom:-1pt;">24.76</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.4" style="padding-top:-1pt;padding-bottom:-1pt;">63.88</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.5" style="padding-top:-1pt;padding-bottom:-1pt;">48.76</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.6" style="padding-top:-1pt;padding-bottom:-1pt;">79.09</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.7" style="padding-top:-1pt;padding-bottom:-1pt;">18.93</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.8" style="padding-top:-1pt;padding-bottom:-1pt;">48.49</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.9" style="padding-top:-1pt;padding-bottom:-1pt;">54.03</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.75</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.34</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.25.11.12" style="padding-top:-1pt;padding-bottom:-1pt;">70.53<span class="ltx_text" id="S4.T4.12.25.11.12.1" style="font-size:70%;">±12.96</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.25.11.13" style="padding-top:-1pt;padding-bottom:-1pt;">29.96<span class="ltx_text" id="S4.T4.12.25.11.13.1" style="font-size:70%;">±18.92</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.26.12">
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.1" style="padding-top:-1pt;padding-bottom:-1pt;">VPTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.2" style="padding-top:-1pt;padding-bottom:-1pt;">78.64</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.3" style="padding-top:-1pt;padding-bottom:-1pt;">12.52</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.4" style="padding-top:-1pt;padding-bottom:-1pt;">70.93</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.5" style="padding-top:-1pt;padding-bottom:-1pt;">33.33</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.6" style="padding-top:-1pt;padding-bottom:-1pt;">80.52</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.7" style="padding-top:-1pt;padding-bottom:-1pt;">14.39</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.8" style="padding-top:-1pt;padding-bottom:-1pt;">52.14</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.9" style="padding-top:-1pt;padding-bottom:-1pt;">53.72</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.10" style="padding-top:-1pt;padding-bottom:-1pt;">84.94</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.11" style="padding-top:-1pt;padding-bottom:-1pt;">3.12</td>
<td class="ltx_td ltx_align_center" id="S4.T4.12.26.12.12" style="padding-top:-1pt;padding-bottom:-1pt;">73.43<span class="ltx_text" id="S4.T4.12.26.12.12.1" style="font-size:70%;">±11.57</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T4.12.26.12.13" style="padding-top:-1pt;padding-bottom:-1pt;">23.42<span class="ltx_text" id="S4.T4.12.26.12.13.1" style="font-size:70%;">±18.05</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T4.12.27.13">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.1" style="padding-top:-1pt;padding-bottom:-1pt;">PASS (ours)</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.2" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.2.1">79.26</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.3" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.3.1">9.80</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.4" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.4.1">72.64</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.5" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.5.1">28.79</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.6" style="padding-top:-1pt;padding-bottom:-1pt;">
<span class="ltx_ERROR undefined" id="S4.T4.12.27.13.6.1">\ul</span>81.36</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.7" style="padding-top:-1pt;padding-bottom:-1pt;">14.99</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.8" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.8.1">71.68</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.9" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.9.1">21.05</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.10" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.10.1">85.27</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.11" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.11.1">2.72</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.12" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.12.1">78.04<span class="ltx_text" id="S4.T4.12.27.13.12.1.1" style="font-size:70%;">±5.18</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T4.12.27.13.13" style="padding-top:-1pt;padding-bottom:-1pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.12.27.13.13.1">15.47<span class="ltx_text" id="S4.T4.12.27.13.13.1.1" style="font-size:70%;">±8.98</span></span></td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Performance Comparison</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.p1.1.1">Comparison methods.</span> We compare our PASS with the “Source Only” baseline (directly applying the model trained on the source domain to the target domain), and thirteen TTA methods, including two BN variants (PTBN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>]</cite> and DUA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>), three entropy-minimization methods (TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>, RN-CR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib15" title="">15</a>]</cite> and SAR<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>]</cite>), a contrastive learning-based method
(OCL<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib18" title="">18</a>]</cite>), a pseudo-label-based method (CoTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite>), a method using the transform invariance regularizer as the surrogate loss (TIPI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib17" title="">17</a>]</cite>), two visual prompting methods with the BN statistics alignment loss (ProSFDA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> and VPTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>), a source-prior-guided method (AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>) based on entropy minimization
and two auto-encoder-based methods (DAE<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib27" title="">27</a>]</cite> and DPG<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib12" title="">12</a>]</cite>). Depending on the applicable situations of different methods, we choose twelve for online TTA and five for offline TTA. 
All the comparison methods are based on the same baseline as our PASS, with some introducing additional modules. We first show a graphical comparison
in terms of online TTA performance and model size in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F3" title="Figure 3 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">3</span></a>. Then, we provide detailed comparisons for offline TTA and online TTA.</p>
</div>
<figure class="ltx_figure" id="S4.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="200" id="S4.F4.g1" src="x4.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>Visualization of segmentation results generated by different approaches in prostate test-time adaptation applications.</figcaption>
</figure>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.p2.1.1">Results on the OD/OC segmentation task.</span>
First, we conducted the comparison experiments on the joint OD/OC segmentation adaptation task from a source dataset to three target sets BASE1-3. As claimed in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite>, the domain discrepancy between the source dataset and BASE1 is relatively smaller than BASE2/3 according to the performance gap between “Intra-domain” (vanilla training and testing within the same domain) to “Source Only” baseline. For BASE1, “Source Only” has reached a satisfactory level due to the narrow domain shift. Hence, effective TTA methods mainly enhance the performance of BASE2/3 while maintaining the performance of BASE1.
The results in the offline TTA setting in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T1" title="Table 1 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">1</span></a> show that PASS achieves consistently better performance than other competing methods on BASE2/3. The entropy-based TENT and RN-CR fail to improve the baseline on the average dice while the AdaMI, OCL and ProSFDA yield performance gains. This indicates that entropy minimization is a weak supervision and it is imperative to introduce regularization terms that consider the informative knowledge in semantic segmentation. Compared to ProSFDA which only learns the same visual prompt for all samples, the proposed PASS involves a dynamic sample-dependent visual prompt and a high-level shape prompt, leading to the best average performance across all target domains. Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T2" title="Table 2 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">2</span></a> presents the results of the online adaptation setting. For this more challenging scenario, the majority of approaches only perform well on the optic disc (OD) class but yield frustrating results on the optic cup (OC) class. The OD is easier to segment since its boundary is much clearer than the OC.
AdaMI and DAE mitigate this issue by introducing a shape prior loss and pseudo anatomical labels generated by pretrained denoising auto-encoder from the source domain. Using shape-relevant information can facilitate the adaptation stage but the utility of these methods is greatly limited by the need for source data re-access or dedicated pretraining modules. Our PASS directly distills high-order shape prompts from the target data itself and achieves remarkable performance over other baselines.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 5: </span>The effects of different components of PASS on the OD/OC and prostate segmentation tasks in both online and offline TTA settings. The reported value is the average Dice Sore (DSC %) on three OD/OC test sets or five prostate test sets (mean±std). When the AMU is excluded (w/o AMU), an independent adaptation is performed for each test sample.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T5.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T5.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T5.1.1.1.1" rowspan="2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T5.1.1.1.1.1">Method</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="3" id="S4.T5.1.1.1.2" style="padding-left:8.0pt;padding-right:8.0pt;">Online TTA Setup</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.2.1" style="padding-left:8.0pt;padding-right:8.0pt;">OD</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.2.2" style="padding-left:8.0pt;padding-right:8.0pt;">OC</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.2.3" style="padding-left:8.0pt;padding-right:8.0pt;">Prostate</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.3.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.3.3.1" style="padding-left:8.0pt;padding-right:8.0pt;">PASS</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.3.3.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.3.3.2.1">95.00<span class="ltx_text" id="S4.T5.1.3.3.2.1.1" style="font-size:70%;">±0.28</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.3.3.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.3.3.3.1">84.09<span class="ltx_text" id="S4.T5.1.3.3.3.1.1" style="font-size:70%;">±0.91</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.3.3.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.3.3.4.1">78.04<span class="ltx_text" id="S4.T5.1.3.3.4.1.1" style="font-size:70%;">±5.18</span></span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.4.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.4.4.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/o ID</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.4.4.2" style="padding-left:8.0pt;padding-right:8.0pt;">94.43<span class="ltx_text" id="S4.T5.1.4.4.2.1" style="font-size:70%;">±0.48</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.4.4.3" style="padding-left:8.0pt;padding-right:8.0pt;">81.51<span class="ltx_text" id="S4.T5.1.4.4.3.1" style="font-size:70%;">±1.61</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.4.4.4" style="padding-left:8.0pt;padding-right:8.0pt;">72.66<span class="ltx_text" id="S4.T5.1.4.4.4.1" style="font-size:70%;">±13.90</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.5.5">
<td class="ltx_td ltx_align_left" id="S4.T5.1.5.5.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/o CAPM</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.5.5.2" style="padding-left:8.0pt;padding-right:8.0pt;">94.32<span class="ltx_text" id="S4.T5.1.5.5.2.1" style="font-size:70%;">±0.65</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.5.5.3" style="padding-left:8.0pt;padding-right:8.0pt;">82.87<span class="ltx_text" id="S4.T5.1.5.5.3.1" style="font-size:70%;">±1.93</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.5.5.4" style="padding-left:8.0pt;padding-right:8.0pt;">74.34<span class="ltx_text" id="S4.T5.1.5.5.4.1" style="font-size:70%;">±10.45</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.6.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.6.6.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/o AMU</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.6.6.2" style="padding-left:8.0pt;padding-right:8.0pt;">94.46<span class="ltx_text" id="S4.T5.1.6.6.2.1" style="font-size:70%;">±0.40</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.6.6.3" style="padding-left:8.0pt;padding-right:8.0pt;">78.70<span class="ltx_text" id="S4.T5.1.6.6.3.1" style="font-size:70%;">±6.03</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.6.6.4" style="padding-left:8.0pt;padding-right:8.0pt;">74.42<span class="ltx_text" id="S4.T5.1.6.6.4.1" style="font-size:70%;">±6.08</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.7.7">
<td class="ltx_td ltx_align_left" id="S4.T5.1.7.7.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/ EMA</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.7.7.2" style="padding-left:8.0pt;padding-right:8.0pt;">94.18<span class="ltx_text" id="S4.T5.1.7.7.2.1" style="font-size:70%;">±0.75</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.7.7.3" style="padding-left:8.0pt;padding-right:8.0pt;">82.64<span class="ltx_text" id="S4.T5.1.7.7.3.1" style="font-size:70%;">±1.22</span>
</td>
<td class="ltx_td ltx_align_left" id="S4.T5.1.7.7.4" style="padding-left:8.0pt;padding-right:8.0pt;">72.40<span class="ltx_text" id="S4.T5.1.7.7.4.1" style="font-size:70%;">±13.77</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.8.8">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.8.8.1" rowspan="2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T5.1.8.8.1.1">Method</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S4.T5.1.8.8.2" style="padding-left:8.0pt;padding-right:8.0pt;">Offline TTA Setup</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.9.9">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.9.9.1" style="padding-left:8.0pt;padding-right:8.0pt;">OD</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.9.9.2" style="padding-left:8.0pt;padding-right:8.0pt;">OC</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.9.9.3" style="padding-left:8.0pt;padding-right:8.0pt;">Prostate</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.10.10">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.10.10.1" style="padding-left:8.0pt;padding-right:8.0pt;">PASS</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.10.10.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.2.1">95.06<span class="ltx_text" id="S4.T5.1.10.10.2.1.1" style="font-size:70%;">±0.22</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.10.10.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.3.1">84.68<span class="ltx_text" id="S4.T5.1.10.10.3.1.1" style="font-size:70%;">±0.63</span></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.10.10.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.4.1">79.68<span class="ltx_text" id="S4.T5.1.10.10.4.1.1" style="font-size:70%;">±5.12</span></span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.11.11">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.11.11.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/o ID</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.11.11.2" style="padding-left:8.0pt;padding-right:8.0pt;">94.94<span class="ltx_text" id="S4.T5.1.11.11.2.1" style="font-size:70%;">±0.48</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.11.11.3" style="padding-left:8.0pt;padding-right:8.0pt;">80.17<span class="ltx_text" id="S4.T5.1.11.11.3.1" style="font-size:70%;">±3.41</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.11.11.4" style="padding-left:8.0pt;padding-right:8.0pt;">76.56<span class="ltx_text" id="S4.T5.1.11.11.4.1" style="font-size:70%;">±9.81</span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.12.12">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.1.12.12.1" style="padding-left:8.0pt;padding-right:8.0pt;">w/o CAPM</td>
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.1.12.12.2" style="padding-left:8.0pt;padding-right:8.0pt;">95.03<span class="ltx_text" id="S4.T5.1.12.12.2.1" style="font-size:70%;">±0.13</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.1.12.12.3" style="padding-left:8.0pt;padding-right:8.0pt;">81.67<span class="ltx_text" id="S4.T5.1.12.12.3.1" style="font-size:70%;">±2.97</span>
</td>
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.1.12.12.4" style="padding-left:8.0pt;padding-right:8.0pt;">78.38<span class="ltx_text" id="S4.T5.1.12.12.4.1" style="font-size:70%;">±6.35</span>
</td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para" id="S4.SS2.p3">
<p class="ltx_p" id="S4.SS2.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.p3.1.1">Results on the prostate segmentation task.</span> In Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T3" title="Table 3 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">3</span></a>, we compare PASS with the existing methods on the multi-center MRI prostate segmentation adaptation task from Site A to Sites B-F in an offline test-time adaptation setting. Benefiting from the abundant information provided by diverse slices in the entire test set, significant performance improvement is obtained by most of the TTA algorithms, except for RN-CR and ProSFDA. The Contour Regularization (CR) in RN-CR is an unsupervised loss punishing the prediction difference of pixels and their neighbours within a radius. This is inappropriate for prostates with non-circular shapes and thus results in model collapse. Despite the excellent behaviours of ProSFDA on the OD/OC segmentation tasks shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T1" title="Table 1 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">1</span></a>, it fails in prostate segmentation with more variable shapes.
Our PASS significantly exceeds other methods on the overall performance across five domains, underscoring its effectiveness and robustness.
Under the online TTA setting in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T4" title="Table 4 ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">4</span></a>, only TENT, AdaMI, OCL, DUA, VPTTA and PASS outperform the “Source Only” baseline. This suggests the difficulty of adaptation towards the online distribution shifts when only one case is accessible at a time. Compared to the offline TTA, RN-CR causes more severe model crashes as the circular constraint is violated due to the diverse and irregular shapes of prostates in 2D slices. Besides, DAE and DPG that rely on pretrained auto-encoders in the source domain as the domain-common priors yield poor results. In scenarios with a relatively small domain gap (e.g., OD/OC datasets), pretrained auto-encoders can deliver some meaningful fine-grained knowledge that is shareable with the target data, but in large-gap situations, they may cause model instability or collapse. We observe that TENT/AdaMI only provide obvious performance increases in Site E (BIDMC)
which possesses a low shape similarity with the source domain (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">1</span></a>). The transfer performance can be particularly poor without any constraints. Thus, even simple entropy minimization and inaccurate shape prior losses can boost the transferability. Among all the competing methods, our PASS stands out as the only one that improves performance substantially across all domains, proving its superiority against
varying target distribution shifts. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F4" title="Figure 4 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">4</span></a> shows the segmentation results and proves that PASS can precisely preserve the anatomical shapes at a new target distribution, whereas other methods sometimes fail to do so.</p>
</div>
<figure class="ltx_figure" id="S4.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="266" id="S4.F5.g1" src="x5.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span>Visualization of (a) the input-dependent visual prompts and (b) the shape prompts in <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S4.F5.3.m1.1"><semantics id="S4.F5.3.m1.1b"><mover accent="true" id="S4.F5.3.m1.1.1" xref="S4.F5.3.m1.1.1.cmml"><mrow id="S4.F5.3.m1.1.1.2" xref="S4.F5.3.m1.1.1.2.cmml"><mi id="S4.F5.3.m1.1.1.2.2" xref="S4.F5.3.m1.1.1.2.2.cmml">S</mi><mo id="S4.F5.3.m1.1.1.2.1" xref="S4.F5.3.m1.1.1.2.1.cmml">⁢</mo><mi id="S4.F5.3.m1.1.1.2.3" xref="S4.F5.3.m1.1.1.2.3.cmml">P</mi></mrow><mo id="S4.F5.3.m1.1.1.1" xref="S4.F5.3.m1.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S4.F5.3.m1.1c"><apply id="S4.F5.3.m1.1.1.cmml" xref="S4.F5.3.m1.1.1"><ci id="S4.F5.3.m1.1.1.1.cmml" xref="S4.F5.3.m1.1.1.1">¯</ci><apply id="S4.F5.3.m1.1.1.2.cmml" xref="S4.F5.3.m1.1.1.2"><times id="S4.F5.3.m1.1.1.2.1.cmml" xref="S4.F5.3.m1.1.1.2.1"></times><ci id="S4.F5.3.m1.1.1.2.2.cmml" xref="S4.F5.3.m1.1.1.2.2">𝑆</ci><ci id="S4.F5.3.m1.1.1.2.3.cmml" xref="S4.F5.3.m1.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F5.3.m1.1d">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S4.F5.3.m1.1e">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math> learned from different unseen target test sets with <math alttext="L=512" class="ltx_Math" display="inline" id="S4.F5.4.m2.1"><semantics id="S4.F5.4.m2.1b"><mrow id="S4.F5.4.m2.1.1" xref="S4.F5.4.m2.1.1.cmml"><mi id="S4.F5.4.m2.1.1.2" xref="S4.F5.4.m2.1.1.2.cmml">L</mi><mo id="S4.F5.4.m2.1.1.1" xref="S4.F5.4.m2.1.1.1.cmml">=</mo><mn id="S4.F5.4.m2.1.1.3" xref="S4.F5.4.m2.1.1.3.cmml">512</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.F5.4.m2.1c"><apply id="S4.F5.4.m2.1.1.cmml" xref="S4.F5.4.m2.1.1"><eq id="S4.F5.4.m2.1.1.1.cmml" xref="S4.F5.4.m2.1.1.1"></eq><ci id="S4.F5.4.m2.1.1.2.cmml" xref="S4.F5.4.m2.1.1.2">𝐿</ci><cn id="S4.F5.4.m2.1.1.3.cmml" type="integer" xref="S4.F5.4.m2.1.1.3">512</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F5.4.m2.1d">L=512</annotation><annotation encoding="application/x-llamapun" id="S4.F5.4.m2.1e">italic_L = 512</annotation></semantics></math>, as well as the corresponding segmentation mask examples.</figcaption>
</figure>
<figure class="ltx_figure" id="S4.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="291" id="S4.F6.g1" src="x6.png" width="831"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6: </span>(a) The effect of different input-space prompt formulations on the OD/OC segmentation task for online TTA. Here, we compare the traditional fixed-prompt<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite>, the frequency-domain prompt<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> and the proposed input decorator (ID) that generates input-dependent prompt on the OD/OC segmentation task. (b) The effect of different normalization layers in the proposed ID. IN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib40" title="">40</a>]</cite> / BN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib41" title="">41</a>]</cite> / LN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib42" title="">42</a>]</cite> / GN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib43" title="">43</a>]</cite> stands for Instance/Batch/Layer/Group Normalization, respectively. BN<sup class="ltx_sup" id="S4.F6.4.1">∗</sup> means that using BN without tracking the moving average statistics. </figcaption>
</figure>
<figure class="ltx_figure" id="S4.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="344" id="S4.F7.g1" src="x7.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7: </span>(a) Performance of our PASS with various <math alttext="L" class="ltx_Math" display="inline" id="S4.F7.3.m1.1"><semantics id="S4.F7.3.m1.1b"><mi id="S4.F7.3.m1.1.1" xref="S4.F7.3.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.F7.3.m1.1c"><ci id="S4.F7.3.m1.1.1.cmml" xref="S4.F7.3.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F7.3.m1.1d">L</annotation><annotation encoding="application/x-llamapun" id="S4.F7.3.m1.1e">italic_L</annotation></semantics></math> on the OD/OC and prostate segmentation tasks for online TTA. (b) Performance of our PASS with various <math alttext="k" class="ltx_Math" display="inline" id="S4.F7.4.m2.1"><semantics id="S4.F7.4.m2.1b"><mi id="S4.F7.4.m2.1.1" xref="S4.F7.4.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F7.4.m2.1c"><ci id="S4.F7.4.m2.1.1.cmml" xref="S4.F7.4.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F7.4.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F7.4.m2.1e">italic_k</annotation></semantics></math> on the prostate segmentation task for offline TTA.</figcaption>
</figure>
<figure class="ltx_figure" id="S4.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="213" id="S4.F8.g1" src="x8.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 8: </span>(a) Definition of different losses for TTA. (b) The effect of different loss functions for online TTA on the OD/OC and prostate segmentation tasks.</figcaption>
</figure>
<figure class="ltx_figure" id="S4.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="170" id="S4.F9.g1" src="x9.png" width="747"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 9: </span>Performance of our PASS with different parameter updating schemes on the OD/OC segmentation task in continual online test-time adaptation. The average dice score of OD and OC classes is reported (AVG DSC). “AMU” stands for our proposed alternating momentum strategy for parameter updating. “Independent” represents that adaptation is performed on each test subject independently. “Continual” means that the model state for the current sample is initialized with the parameters updated from the previous sample instead of the original source model.</figcaption>
</figure>
<figure class="ltx_figure" id="S4.F10"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="506" id="S4.F10.g1" src="x10.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 10: </span>Performance of our PASS with different parameter updating schemes on the MRI prostate segmentation task in continual online test-time adaptation. “AMU” stands for our proposed alternating momentum strategy for parameter updating. “Independent” represents that adaptation is performed on each test subject independently. “Continual” means that the model state for the current sample is initialized with the parameters updated from the previous sample instead of the original source model.</figcaption>
</figure>
<figure class="ltx_figure" id="S4.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="328" id="S4.F11.g1" src="x11.png" width="665"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 11: </span>Fair comparison of PASS and other TTA methods with the same adaptation losses.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Ablation study.</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p1.1.1">1) Effectiveness of the proposed modules in PASS.</span> The proposed PASS consists of two prompt modules: an input decorator (ID) and a cross-attention prompt modulator (CAPM). The best performance of PASS over the variants in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.T5" title="Table 5 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">5</span></a> demonstrates the contributions of each module. Specifically, not using ID causes a notable performance drop in prostate datasets. This highlights the necessity of decorating the new-coming target test data to eliminate style shifts from source data. In addition, tackling the shape gaps in the semantic representation space through the CAPM also remarkably boosts the generalization of the source model. 
Specifically for the parameter updating scheme in online TTA, we compare the proposed AMU with independent learning <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite> (w/o AMU) and the standard EMA strategy<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite> (w/ EMA). The results validate that AMU is essential to ensure the stability of online training.</p>
</div>
<div class="ltx_para" id="S4.SS3.p2">
<p class="ltx_p" id="S4.SS3.p2.3"><span class="ltx_text ltx_font_bold" id="S4.SS3.p2.3.1">2) The effect of different input-space prompt formulations.</span>
To validate the effectiveness of the proposed input-dependent prompt approach over traditional fixed prompts, we replace our ID with the fixed visual prompt used in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> and the frequency-domain prompt proposed in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> on the OD/OC segmentation task. The results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F6" title="Figure 6 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">6</span></a> (a) prove the better adaptation performance of input-dependent prompt generated by ID than other fixed prompts. 
In Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F6" title="Figure 6 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">6</span></a>(b), we explore the effect of normalization variants in ID, including IN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib40" title="">40</a>]</cite>, BN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib41" title="">41</a>]</cite>, LN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib42" title="">42</a>]</cite> and GN<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib43" title="">43</a>]</cite>.
For the online TTA with a batch size of 1, the only difference between BN and IN is that BN normalizes features using historical moving averaged statistics, which is detrimental to preserving the sample-specific style and thus leads to a significant performance drop. If we use BN without tracking the moving average statistics (BN<sup class="ltx_sup" id="S4.SS3.p2.3.2">∗</sup>), its performance is almost identical to IN. Compared with IN and BN which preserve the inter-channel distribution differences, LN eliminates these differences, and GN is an intermediate version of these two types. The performance trend of IN <math alttext="&gt;" class="ltx_Math" display="inline" id="S4.SS3.p2.2.m2.1"><semantics id="S4.SS3.p2.2.m2.1a"><mo id="S4.SS3.p2.2.m2.1.1" xref="S4.SS3.p2.2.m2.1.1.cmml">&gt;</mo><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.2.m2.1b"><gt id="S4.SS3.p2.2.m2.1.1.cmml" xref="S4.SS3.p2.2.m2.1.1"></gt></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.2.m2.1c">&gt;</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.2.m2.1d">&gt;</annotation></semantics></math> GN <math alttext="&gt;" class="ltx_Math" display="inline" id="S4.SS3.p2.3.m3.1"><semantics id="S4.SS3.p2.3.m3.1a"><mo id="S4.SS3.p2.3.m3.1.1" xref="S4.SS3.p2.3.m3.1.1.cmml">&gt;</mo><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.3.m3.1b"><gt id="S4.SS3.p2.3.m3.1.1.cmml" xref="S4.SS3.p2.3.m3.1.1"></gt></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.3.m3.1c">&gt;</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.3.m3.1d">&gt;</annotation></semantics></math> LN indicates that treating different channels distinctly is necessary for generating effective input prompts.</p>
</div>
<div class="ltx_para" id="S4.SS3.p3">
<p class="ltx_p" id="S4.SS3.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p3.1.1">3) The effect of different adaptation losses.</span> The proposed PASS is orthogonal to existing TTA methods dedicated to designing effective loss functions and can be integrated with them. We evaluate three objective functions on both the RIGA+ and prostate datasets: the TENT loss in TENT<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>, the BN loss in VPTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib25" title="">25</a>]</cite> and the Class-Ratio loss in AdaMI<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite>.
The detailed formulations are summarized in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F8" title="Figure 8 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">8</span></a> (a). The online TTA results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F8" title="Figure 8 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">8</span></a> (b) indicate that the BN and TENT losses perform best in OD/OC and prostate segmentation tasks, respectively.
Here, we provide suggestions for selecting appropriate TTA loss functions: (1) Overall, TENT loss is a robust choice. (2) BN loss might lead to better performance when the domain gap is minimal. (3) The Class-Ratio loss lacks general applicability since it necessitates the acquisition of source labels.
Additionally, we provide a fair comparative analysis of PASS employing the TNET, BN, and Class-Ratio loss functions against TENT, VPTTA, and AdaMI, in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F11" title="Figure 11 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">11</span></a>
It can be observed that PASS consistently outperforms the other methods when using the same loss, which further demonstrates the effectiveness of the proposed TTA framework.</p>
</div>
<div class="ltx_para" id="S4.SS3.p4">
<p class="ltx_p" id="S4.SS3.p4.9"><span class="ltx_text ltx_font_bold" id="S4.SS3.p4.9.1">4) The influence of hyperparameters in PASS.</span>
We study how the size of the shape prompt bank <math alttext="L" class="ltx_Math" display="inline" id="S4.SS3.p4.1.m1.1"><semantics id="S4.SS3.p4.1.m1.1a"><mi id="S4.SS3.p4.1.m1.1.1" xref="S4.SS3.p4.1.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.1.m1.1b"><ci id="S4.SS3.p4.1.m1.1.1.cmml" xref="S4.SS3.p4.1.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.1.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.1.m1.1d">italic_L</annotation></semantics></math> affects the performance of our method.
As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F7" title="Figure 7 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">7</span></a>(a), PASS with a moderate size <math alttext="L=512" class="ltx_Math" display="inline" id="S4.SS3.p4.2.m2.1"><semantics id="S4.SS3.p4.2.m2.1a"><mrow id="S4.SS3.p4.2.m2.1.1" xref="S4.SS3.p4.2.m2.1.1.cmml"><mi id="S4.SS3.p4.2.m2.1.1.2" xref="S4.SS3.p4.2.m2.1.1.2.cmml">L</mi><mo id="S4.SS3.p4.2.m2.1.1.1" xref="S4.SS3.p4.2.m2.1.1.1.cmml">=</mo><mn id="S4.SS3.p4.2.m2.1.1.3" xref="S4.SS3.p4.2.m2.1.1.3.cmml">512</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.2.m2.1b"><apply id="S4.SS3.p4.2.m2.1.1.cmml" xref="S4.SS3.p4.2.m2.1.1"><eq id="S4.SS3.p4.2.m2.1.1.1.cmml" xref="S4.SS3.p4.2.m2.1.1.1"></eq><ci id="S4.SS3.p4.2.m2.1.1.2.cmml" xref="S4.SS3.p4.2.m2.1.1.2">𝐿</ci><cn id="S4.SS3.p4.2.m2.1.1.3.cmml" type="integer" xref="S4.SS3.p4.2.m2.1.1.3">512</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.2.m2.1c">L=512</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.2.m2.1d">italic_L = 512</annotation></semantics></math> yields the best average DSC on both applications. 
Intuitively, fewer prompt templates are insufficient to embed the rich style patterns for a target domain, while excessive prompt templates tend to be redundant. Thus, an inappropriate size of <math alttext="L" class="ltx_Math" display="inline" id="S4.SS3.p4.3.m3.1"><semantics id="S4.SS3.p4.3.m3.1a"><mi id="S4.SS3.p4.3.m3.1.1" xref="S4.SS3.p4.3.m3.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.3.m3.1b"><ci id="S4.SS3.p4.3.m3.1.1.cmml" xref="S4.SS3.p4.3.m3.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.3.m3.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.3.m3.1d">italic_L</annotation></semantics></math> could negatively impact the adaptation stage. Nevertheless, all models with varying <math alttext="L" class="ltx_Math" display="inline" id="S4.SS3.p4.4.m4.1"><semantics id="S4.SS3.p4.4.m4.1a"><mi id="S4.SS3.p4.4.m4.1.1" xref="S4.SS3.p4.4.m4.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.4.m4.1b"><ci id="S4.SS3.p4.4.m4.1.1.cmml" xref="S4.SS3.p4.4.m4.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.4.m4.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.4.m4.1d">italic_L</annotation></semantics></math> consistently surpass the baseline (Source Only), which proves the robustness of PASS.
 Besides, the impact of <math alttext="L" class="ltx_Math" display="inline" id="S4.SS3.p4.5.m5.1"><semantics id="S4.SS3.p4.5.m5.1a"><mi id="S4.SS3.p4.5.m5.1.1" xref="S4.SS3.p4.5.m5.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.5.m5.1b"><ci id="S4.SS3.p4.5.m5.1.1.cmml" xref="S4.SS3.p4.5.m5.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.5.m5.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.5.m5.1d">italic_L</annotation></semantics></math> on OD/OC segmentation is less than prostate segmentation since the prostate has a more complex shape (as exhibited in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F5" title="Figure 5 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">5</span></a>(b)). 
Finally, we conduct the sensitivity analysis regarding <math alttext="k" class="ltx_Math" display="inline" id="S4.SS3.p4.6.m6.1"><semantics id="S4.SS3.p4.6.m6.1a"><mi id="S4.SS3.p4.6.m6.1.1" xref="S4.SS3.p4.6.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.6.m6.1b"><ci id="S4.SS3.p4.6.m6.1.1.cmml" xref="S4.SS3.p4.6.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.6.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.6.m6.1d">italic_k</annotation></semantics></math> (<math alttext="top_{k}" class="ltx_Math" display="inline" id="S4.SS3.p4.7.m7.1"><semantics id="S4.SS3.p4.7.m7.1a"><mrow id="S4.SS3.p4.7.m7.1.1" xref="S4.SS3.p4.7.m7.1.1.cmml"><mi id="S4.SS3.p4.7.m7.1.1.2" xref="S4.SS3.p4.7.m7.1.1.2.cmml">t</mi><mo id="S4.SS3.p4.7.m7.1.1.1" xref="S4.SS3.p4.7.m7.1.1.1.cmml">⁢</mo><mi id="S4.SS3.p4.7.m7.1.1.3" xref="S4.SS3.p4.7.m7.1.1.3.cmml">o</mi><mo id="S4.SS3.p4.7.m7.1.1.1a" xref="S4.SS3.p4.7.m7.1.1.1.cmml">⁢</mo><msub id="S4.SS3.p4.7.m7.1.1.4" xref="S4.SS3.p4.7.m7.1.1.4.cmml"><mi id="S4.SS3.p4.7.m7.1.1.4.2" xref="S4.SS3.p4.7.m7.1.1.4.2.cmml">p</mi><mi id="S4.SS3.p4.7.m7.1.1.4.3" xref="S4.SS3.p4.7.m7.1.1.4.3.cmml">k</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.7.m7.1b"><apply id="S4.SS3.p4.7.m7.1.1.cmml" xref="S4.SS3.p4.7.m7.1.1"><times id="S4.SS3.p4.7.m7.1.1.1.cmml" xref="S4.SS3.p4.7.m7.1.1.1"></times><ci id="S4.SS3.p4.7.m7.1.1.2.cmml" xref="S4.SS3.p4.7.m7.1.1.2">𝑡</ci><ci id="S4.SS3.p4.7.m7.1.1.3.cmml" xref="S4.SS3.p4.7.m7.1.1.3">𝑜</ci><apply id="S4.SS3.p4.7.m7.1.1.4.cmml" xref="S4.SS3.p4.7.m7.1.1.4"><csymbol cd="ambiguous" id="S4.SS3.p4.7.m7.1.1.4.1.cmml" xref="S4.SS3.p4.7.m7.1.1.4">subscript</csymbol><ci id="S4.SS3.p4.7.m7.1.1.4.2.cmml" xref="S4.SS3.p4.7.m7.1.1.4.2">𝑝</ci><ci id="S4.SS3.p4.7.m7.1.1.4.3.cmml" xref="S4.SS3.p4.7.m7.1.1.4.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.7.m7.1c">top_{k}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.7.m7.1d">italic_t italic_o italic_p start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> for the
sparsity of <math alttext="A" class="ltx_Math" display="inline" id="S4.SS3.p4.8.m8.1"><semantics id="S4.SS3.p4.8.m8.1a"><mi id="S4.SS3.p4.8.m8.1.1" xref="S4.SS3.p4.8.m8.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.8.m8.1b"><ci id="S4.SS3.p4.8.m8.1.1.cmml" xref="S4.SS3.p4.8.m8.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.8.m8.1c">A</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.8.m8.1d">italic_A</annotation></semantics></math> in CAPM). As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F7" title="Figure 7 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">7</span></a>(b), <math alttext="k" class="ltx_Math" display="inline" id="S4.SS3.p4.9.m9.1"><semantics id="S4.SS3.p4.9.m9.1a"><mi id="S4.SS3.p4.9.m9.1.1" xref="S4.SS3.p4.9.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p4.9.m9.1b"><ci id="S4.SS3.p4.9.m9.1.1.cmml" xref="S4.SS3.p4.9.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p4.9.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p4.9.m9.1d">italic_k</annotation></semantics></math> yields higher DSC between 0.1 and 0.5.</p>
</div>
<div class="ltx_para" id="S4.SS3.p5">
<p class="ltx_p" id="S4.SS3.p5.2"><span class="ltx_text ltx_font_bold" id="S4.SS3.p5.2.1">5) Visualization of input and shape prompts.</span> Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F5" title="Figure 5 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">5</span></a> shows input-space visual prompts and the learned shape prompts on different test sets and the corresponding masks.
We can observe that (1) the visual prompts alter the texture style of input images. (2) the shape prompts encode rich shape patterns with affinity to the corresponding target objects (the optic disc-cup or prostate). These <math alttext="L" class="ltx_Math" display="inline" id="S4.SS3.p5.1.m1.1"><semantics id="S4.SS3.p5.1.m1.1a"><mi id="S4.SS3.p5.1.m1.1.1" xref="S4.SS3.p5.1.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.1.m1.1b"><ci id="S4.SS3.p5.1.m1.1.1.cmml" xref="S4.SS3.p5.1.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.1.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.1.m1.1d">italic_L</annotation></semantics></math> shape prompts in <math alttext="\overline{SP}" class="ltx_Math" display="inline" id="S4.SS3.p5.2.m2.1"><semantics id="S4.SS3.p5.2.m2.1a"><mover accent="true" id="S4.SS3.p5.2.m2.1.1" xref="S4.SS3.p5.2.m2.1.1.cmml"><mrow id="S4.SS3.p5.2.m2.1.1.2" xref="S4.SS3.p5.2.m2.1.1.2.cmml"><mi id="S4.SS3.p5.2.m2.1.1.2.2" xref="S4.SS3.p5.2.m2.1.1.2.2.cmml">S</mi><mo id="S4.SS3.p5.2.m2.1.1.2.1" xref="S4.SS3.p5.2.m2.1.1.2.1.cmml">⁢</mo><mi id="S4.SS3.p5.2.m2.1.1.2.3" xref="S4.SS3.p5.2.m2.1.1.2.3.cmml">P</mi></mrow><mo id="S4.SS3.p5.2.m2.1.1.1" xref="S4.SS3.p5.2.m2.1.1.1.cmml">¯</mo></mover><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.2.m2.1b"><apply id="S4.SS3.p5.2.m2.1.1.cmml" xref="S4.SS3.p5.2.m2.1.1"><ci id="S4.SS3.p5.2.m2.1.1.1.cmml" xref="S4.SS3.p5.2.m2.1.1.1">¯</ci><apply id="S4.SS3.p5.2.m2.1.1.2.cmml" xref="S4.SS3.p5.2.m2.1.1.2"><times id="S4.SS3.p5.2.m2.1.1.2.1.cmml" xref="S4.SS3.p5.2.m2.1.1.2.1"></times><ci id="S4.SS3.p5.2.m2.1.1.2.2.cmml" xref="S4.SS3.p5.2.m2.1.1.2.2">𝑆</ci><ci id="S4.SS3.p5.2.m2.1.1.2.3.cmml" xref="S4.SS3.p5.2.m2.1.1.2.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.2.m2.1c">\overline{SP}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.2.m2.1d">over¯ start_ARG italic_S italic_P end_ARG</annotation></semantics></math> can serve as structure templates and our proposed CAPM extracts pertinent information for each test sample from the extensive shape repository, thereby enhancing the segmentation performance. (3) Given the same source model, each test set learns a distinct shape prompt bank, indicating that different sets possess unique shape prior information. Therefore, it is reasonable to learn individual prompt banks for different target datasets.</p>
</div>
<div class="ltx_para" id="S4.SS3.p6">
<p class="ltx_p" id="S4.SS3.p6.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p6.1.1">6)The influence of optimization schemes in online TTA.</span> 
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F9" title="Figure 9 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">9</span></a> and Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S4.F10" title="Figure 10 ‣ 4.2 Performance Comparison ‣ 4 Experiments ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">10</span></a> compare the online performance of PASS with different parameter updating schemes at sequentially arrived test cases. It can be observed that continual adaptation could cause notable performance degradation in some cases due to potential error accumulation.
 For most test datasets, independent adaptation outperforms continual adaptation as the parameter updating for one case does not affect the following cases, which avoids error accumulation. However, the adapted model cannot fully utilise the historical distribution information from former test cases. In contrast, the proposed alternating momentum updating (AMU) strategy leads to more stable adaptation and better performance through independently updating the student network for every single case and recovering knowledge from the teacher network.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Discussion</h2>
<figure class="ltx_table" id="S5.T6">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 6: </span>Online TTA performance of PASS with different initializations in DSC Score (%) on three OD/OC segmentation test sets. “Init.” stands for initialization. “Gain” refers to the magnitude of random distributions. </figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T6.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T6.3.4.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T6.3.4.1.1" style="padding:-1pt 4.0pt;">Gain</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S5.T6.3.4.1.2" style="padding:-1pt 4.0pt;">Method</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T6.3.4.1.3" style="padding:-1pt 4.0pt;">Average DSC</th>
</tr>
<tr class="ltx_tr" id="S5.T6.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T6.1.1.1" style="padding:-1pt 4.0pt;"><math alttext="\sqrt{5}" class="ltx_Math" display="inline" id="S5.T6.1.1.1.m1.1"><semantics id="S5.T6.1.1.1.m1.1a"><msqrt id="S5.T6.1.1.1.m1.1.1" xref="S5.T6.1.1.1.m1.1.1.cmml"><mn id="S5.T6.1.1.1.m1.1.1.2" xref="S5.T6.1.1.1.m1.1.1.2.cmml">5</mn></msqrt><annotation-xml encoding="MathML-Content" id="S5.T6.1.1.1.m1.1b"><apply id="S5.T6.1.1.1.m1.1.1.cmml" xref="S5.T6.1.1.1.m1.1.1"><root id="S5.T6.1.1.1.m1.1.1a.cmml" xref="S5.T6.1.1.1.m1.1.1"></root><cn id="S5.T6.1.1.1.m1.1.1.2.cmml" type="integer" xref="S5.T6.1.1.1.m1.1.1.2">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.1.1.1.m1.1c">\sqrt{5}</annotation><annotation encoding="application/x-llamapun" id="S5.T6.1.1.1.m1.1d">square-root start_ARG 5 end_ARG</annotation></semantics></math></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S5.T6.1.1.2" style="padding:-1pt 4.0pt;">Kaiming Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib44" title="">44</a>]</cite> (default)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T6.1.1.3" style="padding:-1pt 4.0pt;">89.55<span class="ltx_text" id="S5.T6.1.1.3.1" style="font-size:70%;">±5.49</span>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T6.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T6.2.2.1" rowspan="4" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S5.T6.2.2.1.1"><math alttext="0\sim 0.1" class="ltx_Math" display="inline" id="S5.T6.2.2.1.1.m1.1"><semantics id="S5.T6.2.2.1.1.m1.1a"><mrow id="S5.T6.2.2.1.1.m1.1.1" xref="S5.T6.2.2.1.1.m1.1.1.cmml"><mn id="S5.T6.2.2.1.1.m1.1.1.2" xref="S5.T6.2.2.1.1.m1.1.1.2.cmml">0</mn><mo id="S5.T6.2.2.1.1.m1.1.1.1" xref="S5.T6.2.2.1.1.m1.1.1.1.cmml">∼</mo><mn id="S5.T6.2.2.1.1.m1.1.1.3" xref="S5.T6.2.2.1.1.m1.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.T6.2.2.1.1.m1.1b"><apply id="S5.T6.2.2.1.1.m1.1.1.cmml" xref="S5.T6.2.2.1.1.m1.1.1"><csymbol cd="latexml" id="S5.T6.2.2.1.1.m1.1.1.1.cmml" xref="S5.T6.2.2.1.1.m1.1.1.1">similar-to</csymbol><cn id="S5.T6.2.2.1.1.m1.1.1.2.cmml" type="integer" xref="S5.T6.2.2.1.1.m1.1.1.2">0</cn><cn id="S5.T6.2.2.1.1.m1.1.1.3.cmml" type="float" xref="S5.T6.2.2.1.1.m1.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.2.2.1.1.m1.1c">0\sim 0.1</annotation><annotation encoding="application/x-llamapun" id="S5.T6.2.2.1.1.m1.1d">0 ∼ 0.1</annotation></semantics></math></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S5.T6.2.2.2" style="padding:-1pt 4.0pt;">Kaiming Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib44" title="">44</a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T6.2.2.3" style="padding:-1pt 4.0pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.2.2.3.1">89.63<span class="ltx_text" id="S5.T6.2.2.3.1.1" style="font-size:70%;">±5.82</span></span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.5.1">
<td class="ltx_td ltx_align_left" id="S5.T6.3.5.1.1" style="padding:-1pt 4.0pt;">Uniform Init.</td>
<td class="ltx_td ltx_align_center" id="S5.T6.3.5.1.2" style="padding:-1pt 4.0pt;">89.24<span class="ltx_text" id="S5.T6.3.5.1.2.1" style="font-size:70%;">±5.86</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.6.2">
<td class="ltx_td ltx_align_left" id="S5.T6.3.6.2.1" style="padding:-1pt 4.0pt;">Xavier Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib45" title="">45</a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T6.3.6.2.2" style="padding:-1pt 4.0pt;">89.26<span class="ltx_text" id="S5.T6.3.6.2.2.1" style="font-size:70%;">±5.85</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.7.3">
<td class="ltx_td ltx_align_left" id="S5.T6.3.7.3.1" style="padding:-1pt 4.0pt;">Orthogonal Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib46" title="">46</a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T6.3.7.3.2" style="padding:-1pt 4.0pt;">88.91<span class="ltx_text" id="S5.T6.3.7.3.2.1" style="font-size:70%;">±6.09</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.3">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S5.T6.3.3.1" rowspan="5" style="padding:-1pt 4.0pt;"><span class="ltx_text" id="S5.T6.3.3.1.1"><math alttext="1\sim 10" class="ltx_Math" display="inline" id="S5.T6.3.3.1.1.m1.1"><semantics id="S5.T6.3.3.1.1.m1.1a"><mrow id="S5.T6.3.3.1.1.m1.1.1" xref="S5.T6.3.3.1.1.m1.1.1.cmml"><mn id="S5.T6.3.3.1.1.m1.1.1.2" xref="S5.T6.3.3.1.1.m1.1.1.2.cmml">1</mn><mo id="S5.T6.3.3.1.1.m1.1.1.1" xref="S5.T6.3.3.1.1.m1.1.1.1.cmml">∼</mo><mn id="S5.T6.3.3.1.1.m1.1.1.3" xref="S5.T6.3.3.1.1.m1.1.1.3.cmml">10</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.T6.3.3.1.1.m1.1b"><apply id="S5.T6.3.3.1.1.m1.1.1.cmml" xref="S5.T6.3.3.1.1.m1.1.1"><csymbol cd="latexml" id="S5.T6.3.3.1.1.m1.1.1.1.cmml" xref="S5.T6.3.3.1.1.m1.1.1.1">similar-to</csymbol><cn id="S5.T6.3.3.1.1.m1.1.1.2.cmml" type="integer" xref="S5.T6.3.3.1.1.m1.1.1.2">1</cn><cn id="S5.T6.3.3.1.1.m1.1.1.3.cmml" type="integer" xref="S5.T6.3.3.1.1.m1.1.1.3">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.3.3.1.1.m1.1c">1\sim 10</annotation><annotation encoding="application/x-llamapun" id="S5.T6.3.3.1.1.m1.1d">1 ∼ 10</annotation></semantics></math></span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S5.T6.3.3.2" style="padding:-1pt 4.0pt;">Kaiming Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib44" title="">44</a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T6.3.3.3" style="padding:-1pt 4.0pt;">89.14<span class="ltx_text" id="S5.T6.3.3.3.1" style="font-size:70%;">±6.21</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.8.4">
<td class="ltx_td ltx_align_left" id="S5.T6.3.8.4.1" style="padding:-1pt 4.0pt;">Uniform Init.</td>
<td class="ltx_td ltx_align_center" id="S5.T6.3.8.4.2" style="padding:-1pt 4.0pt;">87.38<span class="ltx_text" id="S5.T6.3.8.4.2.1" style="font-size:70%;">±5.65</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.9.5">
<td class="ltx_td ltx_align_left" id="S5.T6.3.9.5.1" style="padding:-1pt 4.0pt;">Xavier Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib45" title="">45</a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T6.3.9.5.2" style="padding:-1pt 4.0pt;">88.62<span class="ltx_text" id="S5.T6.3.9.5.2.1" style="font-size:70%;">±6.29</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T6.3.10.6">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S5.T6.3.10.6.1" style="padding:-1pt 4.0pt;">Orthogonal Init.<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib46" title="">46</a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T6.3.10.6.2" style="padding:-1pt 4.0pt;">87.28<span class="ltx_text" id="S5.T6.3.10.6.2.1" style="font-size:70%;">±6.22</span>
</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_figure" id="S5.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="992" id="S5.F12.g1" src="x12.png" width="665"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 12: </span>The average difference of the shape prompt bank between adjacent adaptation steps over test cases.</figcaption>
</figure>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>The effect of initialization</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.4">Following most adapter/prompt-based methods when integrating extra parameters into the pretrained backbone<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib28" title="">28</a>]</cite>, both the Input Decorator and CAPM are introduced in a residual manner. This mechanism ensures that the pretrained features remain intact. To validate that PASS is robust to random initialization types, we evaluated five different types of random initialization in Table <span class="ltx_ref ltx_missing_label ltx_ref_self">LABEL:response_tab:init_type</span>.
We adjust the magnitude of random distributions across different intervals and present the average performance for a small range <math alttext="[0.001,0.005,0.01,0.05,0.1]" class="ltx_Math" display="inline" id="S5.SS1.p1.1.m1.5"><semantics id="S5.SS1.p1.1.m1.5a"><mrow id="S5.SS1.p1.1.m1.5.6.2" xref="S5.SS1.p1.1.m1.5.6.1.cmml"><mo id="S5.SS1.p1.1.m1.5.6.2.1" stretchy="false" xref="S5.SS1.p1.1.m1.5.6.1.cmml">[</mo><mn id="S5.SS1.p1.1.m1.1.1" xref="S5.SS1.p1.1.m1.1.1.cmml">0.001</mn><mo id="S5.SS1.p1.1.m1.5.6.2.2" xref="S5.SS1.p1.1.m1.5.6.1.cmml">,</mo><mn id="S5.SS1.p1.1.m1.2.2" xref="S5.SS1.p1.1.m1.2.2.cmml">0.005</mn><mo id="S5.SS1.p1.1.m1.5.6.2.3" xref="S5.SS1.p1.1.m1.5.6.1.cmml">,</mo><mn id="S5.SS1.p1.1.m1.3.3" xref="S5.SS1.p1.1.m1.3.3.cmml">0.01</mn><mo id="S5.SS1.p1.1.m1.5.6.2.4" xref="S5.SS1.p1.1.m1.5.6.1.cmml">,</mo><mn id="S5.SS1.p1.1.m1.4.4" xref="S5.SS1.p1.1.m1.4.4.cmml">0.05</mn><mo id="S5.SS1.p1.1.m1.5.6.2.5" xref="S5.SS1.p1.1.m1.5.6.1.cmml">,</mo><mn id="S5.SS1.p1.1.m1.5.5" xref="S5.SS1.p1.1.m1.5.5.cmml">0.1</mn><mo id="S5.SS1.p1.1.m1.5.6.2.6" stretchy="false" xref="S5.SS1.p1.1.m1.5.6.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.1.m1.5b"><list id="S5.SS1.p1.1.m1.5.6.1.cmml" xref="S5.SS1.p1.1.m1.5.6.2"><cn id="S5.SS1.p1.1.m1.1.1.cmml" type="float" xref="S5.SS1.p1.1.m1.1.1">0.001</cn><cn id="S5.SS1.p1.1.m1.2.2.cmml" type="float" xref="S5.SS1.p1.1.m1.2.2">0.005</cn><cn id="S5.SS1.p1.1.m1.3.3.cmml" type="float" xref="S5.SS1.p1.1.m1.3.3">0.01</cn><cn id="S5.SS1.p1.1.m1.4.4.cmml" type="float" xref="S5.SS1.p1.1.m1.4.4">0.05</cn><cn id="S5.SS1.p1.1.m1.5.5.cmml" type="float" xref="S5.SS1.p1.1.m1.5.5">0.1</cn></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.1.m1.5c">[0.001,0.005,0.01,0.05,0.1]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.1.m1.5d">[ 0.001 , 0.005 , 0.01 , 0.05 , 0.1 ]</annotation></semantics></math> (<math alttext="0\sim 0.1" class="ltx_Math" display="inline" id="S5.SS1.p1.2.m2.1"><semantics id="S5.SS1.p1.2.m2.1a"><mrow id="S5.SS1.p1.2.m2.1.1" xref="S5.SS1.p1.2.m2.1.1.cmml"><mn id="S5.SS1.p1.2.m2.1.1.2" xref="S5.SS1.p1.2.m2.1.1.2.cmml">0</mn><mo id="S5.SS1.p1.2.m2.1.1.1" xref="S5.SS1.p1.2.m2.1.1.1.cmml">∼</mo><mn id="S5.SS1.p1.2.m2.1.1.3" xref="S5.SS1.p1.2.m2.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.2.m2.1b"><apply id="S5.SS1.p1.2.m2.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1"><csymbol cd="latexml" id="S5.SS1.p1.2.m2.1.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1.1">similar-to</csymbol><cn id="S5.SS1.p1.2.m2.1.1.2.cmml" type="integer" xref="S5.SS1.p1.2.m2.1.1.2">0</cn><cn id="S5.SS1.p1.2.m2.1.1.3.cmml" type="float" xref="S5.SS1.p1.2.m2.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.2.m2.1c">0\sim 0.1</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.2.m2.1d">0 ∼ 0.1</annotation></semantics></math>) and a large range <math alttext="[1,5,10]" class="ltx_Math" display="inline" id="S5.SS1.p1.3.m3.3"><semantics id="S5.SS1.p1.3.m3.3a"><mrow id="S5.SS1.p1.3.m3.3.4.2" xref="S5.SS1.p1.3.m3.3.4.1.cmml"><mo id="S5.SS1.p1.3.m3.3.4.2.1" stretchy="false" xref="S5.SS1.p1.3.m3.3.4.1.cmml">[</mo><mn id="S5.SS1.p1.3.m3.1.1" xref="S5.SS1.p1.3.m3.1.1.cmml">1</mn><mo id="S5.SS1.p1.3.m3.3.4.2.2" xref="S5.SS1.p1.3.m3.3.4.1.cmml">,</mo><mn id="S5.SS1.p1.3.m3.2.2" xref="S5.SS1.p1.3.m3.2.2.cmml">5</mn><mo id="S5.SS1.p1.3.m3.3.4.2.3" xref="S5.SS1.p1.3.m3.3.4.1.cmml">,</mo><mn id="S5.SS1.p1.3.m3.3.3" xref="S5.SS1.p1.3.m3.3.3.cmml">10</mn><mo id="S5.SS1.p1.3.m3.3.4.2.4" stretchy="false" xref="S5.SS1.p1.3.m3.3.4.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.3.m3.3b"><list id="S5.SS1.p1.3.m3.3.4.1.cmml" xref="S5.SS1.p1.3.m3.3.4.2"><cn id="S5.SS1.p1.3.m3.1.1.cmml" type="integer" xref="S5.SS1.p1.3.m3.1.1">1</cn><cn id="S5.SS1.p1.3.m3.2.2.cmml" type="integer" xref="S5.SS1.p1.3.m3.2.2">5</cn><cn id="S5.SS1.p1.3.m3.3.3.cmml" type="integer" xref="S5.SS1.p1.3.m3.3.3">10</cn></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.3.m3.3c">[1,5,10]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.3.m3.3d">[ 1 , 5 , 10 ]</annotation></semantics></math> (<math alttext="1\sim 10" class="ltx_Math" display="inline" id="S5.SS1.p1.4.m4.1"><semantics id="S5.SS1.p1.4.m4.1a"><mrow id="S5.SS1.p1.4.m4.1.1" xref="S5.SS1.p1.4.m4.1.1.cmml"><mn id="S5.SS1.p1.4.m4.1.1.2" xref="S5.SS1.p1.4.m4.1.1.2.cmml">1</mn><mo id="S5.SS1.p1.4.m4.1.1.1" xref="S5.SS1.p1.4.m4.1.1.1.cmml">∼</mo><mn id="S5.SS1.p1.4.m4.1.1.3" xref="S5.SS1.p1.4.m4.1.1.3.cmml">10</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.4.m4.1b"><apply id="S5.SS1.p1.4.m4.1.1.cmml" xref="S5.SS1.p1.4.m4.1.1"><csymbol cd="latexml" id="S5.SS1.p1.4.m4.1.1.1.cmml" xref="S5.SS1.p1.4.m4.1.1.1">similar-to</csymbol><cn id="S5.SS1.p1.4.m4.1.1.2.cmml" type="integer" xref="S5.SS1.p1.4.m4.1.1.2">1</cn><cn id="S5.SS1.p1.4.m4.1.1.3.cmml" type="integer" xref="S5.SS1.p1.4.m4.1.1.3">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.4.m4.1c">1\sim 10</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.4.m4.1d">1 ∼ 10</annotation></semantics></math>). The magnitude (also termed gain) determines the scale of the random parameter. It should be noted that random initialization magnitudes are generally kept within the range of 0 to 1 to ensure numerical stability during initial gradient propagation. The larger range used here is solely for experimental investigations. We can observe that PASS achieves good performance across different random initializations within the small range. However, in the large range, the introduced random parameters potentially disrupt the pretrained features and cause a significant performance drop. The default Kaiming initialization is robust to varying scales, while orthogonal and uniform initializations exhibit greater sensitivity.
Overall, within a reasonable range, random initialization would not affect the effectiveness of the proposed method.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Convergence of the CAPM</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.3">Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.F12" title="Figure 12 ‣ 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">12</span></a> records the average difference of the shape prompt bank between tuning stages <math alttext="t" class="ltx_Math" display="inline" id="S5.SS2.p1.1.m1.1"><semantics id="S5.SS2.p1.1.m1.1a"><mi id="S5.SS2.p1.1.m1.1.1" xref="S5.SS2.p1.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.1.m1.1b"><ci id="S5.SS2.p1.1.m1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">t</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.1.m1.1d">italic_t</annotation></semantics></math> and <math alttext="t+1" class="ltx_Math" display="inline" id="S5.SS2.p1.2.m2.1"><semantics id="S5.SS2.p1.2.m2.1a"><mrow id="S5.SS2.p1.2.m2.1.1" xref="S5.SS2.p1.2.m2.1.1.cmml"><mi id="S5.SS2.p1.2.m2.1.1.2" xref="S5.SS2.p1.2.m2.1.1.2.cmml">t</mi><mo id="S5.SS2.p1.2.m2.1.1.1" xref="S5.SS2.p1.2.m2.1.1.1.cmml">+</mo><mn id="S5.SS2.p1.2.m2.1.1.3" xref="S5.SS2.p1.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.2.m2.1b"><apply id="S5.SS2.p1.2.m2.1.1.cmml" xref="S5.SS2.p1.2.m2.1.1"><plus id="S5.SS2.p1.2.m2.1.1.1.cmml" xref="S5.SS2.p1.2.m2.1.1.1"></plus><ci id="S5.SS2.p1.2.m2.1.1.2.cmml" xref="S5.SS2.p1.2.m2.1.1.2">𝑡</ci><cn id="S5.SS2.p1.2.m2.1.1.3.cmml" type="integer" xref="S5.SS2.p1.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.2.m2.1c">t+1</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.2.m2.1d">italic_t + 1</annotation></semantics></math> in the student network and teacher network. The general trend is that the shape bank will converge in later adaptation steps, and the difference is greater in the student network than in the teacher network. After nearly 6 adaptation steps, the shape bank has learned enriched representations and stabilizes. Since we employ a moving average scheme (i.e., AMU) to update the teacher network, its difference becomes really small (<math alttext="&lt;1\times 10^{-4}" class="ltx_Math" display="inline" id="S5.SS2.p1.3.m3.1"><semantics id="S5.SS2.p1.3.m3.1a"><mrow id="S5.SS2.p1.3.m3.1.1" xref="S5.SS2.p1.3.m3.1.1.cmml"><mi id="S5.SS2.p1.3.m3.1.1.2" xref="S5.SS2.p1.3.m3.1.1.2.cmml"></mi><mo id="S5.SS2.p1.3.m3.1.1.1" xref="S5.SS2.p1.3.m3.1.1.1.cmml">&lt;</mo><mrow id="S5.SS2.p1.3.m3.1.1.3" xref="S5.SS2.p1.3.m3.1.1.3.cmml"><mn id="S5.SS2.p1.3.m3.1.1.3.2" xref="S5.SS2.p1.3.m3.1.1.3.2.cmml">1</mn><mo id="S5.SS2.p1.3.m3.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S5.SS2.p1.3.m3.1.1.3.1.cmml">×</mo><msup id="S5.SS2.p1.3.m3.1.1.3.3" xref="S5.SS2.p1.3.m3.1.1.3.3.cmml"><mn id="S5.SS2.p1.3.m3.1.1.3.3.2" xref="S5.SS2.p1.3.m3.1.1.3.3.2.cmml">10</mn><mrow id="S5.SS2.p1.3.m3.1.1.3.3.3" xref="S5.SS2.p1.3.m3.1.1.3.3.3.cmml"><mo id="S5.SS2.p1.3.m3.1.1.3.3.3a" xref="S5.SS2.p1.3.m3.1.1.3.3.3.cmml">−</mo><mn id="S5.SS2.p1.3.m3.1.1.3.3.3.2" xref="S5.SS2.p1.3.m3.1.1.3.3.3.2.cmml">4</mn></mrow></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.3.m3.1b"><apply id="S5.SS2.p1.3.m3.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1"><lt id="S5.SS2.p1.3.m3.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1.1"></lt><csymbol cd="latexml" id="S5.SS2.p1.3.m3.1.1.2.cmml" xref="S5.SS2.p1.3.m3.1.1.2">absent</csymbol><apply id="S5.SS2.p1.3.m3.1.1.3.cmml" xref="S5.SS2.p1.3.m3.1.1.3"><times id="S5.SS2.p1.3.m3.1.1.3.1.cmml" xref="S5.SS2.p1.3.m3.1.1.3.1"></times><cn id="S5.SS2.p1.3.m3.1.1.3.2.cmml" type="integer" xref="S5.SS2.p1.3.m3.1.1.3.2">1</cn><apply id="S5.SS2.p1.3.m3.1.1.3.3.cmml" xref="S5.SS2.p1.3.m3.1.1.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.1.1.3.3.1.cmml" xref="S5.SS2.p1.3.m3.1.1.3.3">superscript</csymbol><cn id="S5.SS2.p1.3.m3.1.1.3.3.2.cmml" type="integer" xref="S5.SS2.p1.3.m3.1.1.3.3.2">10</cn><apply id="S5.SS2.p1.3.m3.1.1.3.3.3.cmml" xref="S5.SS2.p1.3.m3.1.1.3.3.3"><minus id="S5.SS2.p1.3.m3.1.1.3.3.3.1.cmml" xref="S5.SS2.p1.3.m3.1.1.3.3.3"></minus><cn id="S5.SS2.p1.3.m3.1.1.3.3.3.2.cmml" type="integer" xref="S5.SS2.p1.3.m3.1.1.3.3.3.2">4</cn></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.3.m3.1c">&lt;1\times 10^{-4}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.3.m3.1d">&lt; 1 × 10 start_POSTSUPERSCRIPT - 4 end_POSTSUPERSCRIPT</annotation></semantics></math>) rapidly.</p>
</div>
<figure class="ltx_figure" id="S5.F13"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="326" id="S5.F13.g1" src="x13.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 13: </span>(a) t-SNE visualization of K-means clusters of the shape descriptors in four polyp datasets A-D. (b) The proportions of different clusters.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Extension and limitations</h3>
<div class="ltx_para" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.1">To further discuss the outcomes of our method in segmentation tasks with versatile shapes, we extend PASS to a polyp segmentation task. The polyp segmentation task includes four domains<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>: BKAI (A), CVC (B), ETIS (C), and Kvasir (D), with 1000, 612, 196, and 1000 images, respectively. Each image was resized to 352<math alttext="\times" class="ltx_Math" display="inline" id="S5.SS3.p1.1.m1.1"><semantics id="S5.SS3.p1.1.m1.1a"><mo id="S5.SS3.p1.1.m1.1.1" xref="S5.SS3.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.1.m1.1b"><times id="S5.SS3.p1.1.m1.1.1.cmml" xref="S5.SS3.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.1.m1.1d">×</annotation></semantics></math>352 pixels and normalized with ImageNet statistics. Each dataset is alternately used as the source domain, with the remaining three serving as target domains. Note that all implementation details of the polyp segmentation task are based on the source code of <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>, where the PraNet <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib47" title="">47</a>]</cite> is used as the backbone.</p>
</div>
<div class="ltx_para" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.1">The results are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.T7" title="Table 7 ‣ 5.3 Extension and limitations ‣ 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">7</span></a>.
We observe that comparable performance to VPTTA<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite> can be achieved using only the ID. For the CAPM, although it performs better on domain A/C, a significant performance drop occurs on the other two source domains. To explore the reason, we collect the shape description vectors of the four domains proposed in<cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib8" title="">8</a>]</cite> and perform clustering. The t-SNE visualization in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.F13" title="Figure 13 ‣ 5.2 Convergence of the CAPM ‣ 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">13</span></a> indicates that the shape distributions of the domain B/D are particularly discrete. Overall, CAPM excels in models pretrained on data with concentrated shape distributions but shows limited effectiveness with more scattered shape distributions. In Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#S5.F14" title="Figure 14 ‣ 5.3 Extension and limitations ‣ 5 Discussion ‣ PASS:Test-Time Prompting to Adapt Styles and Semantic Shapes in Medical Image Segmentation"><span class="ltx_text ltx_ref_tag">14</span></a>, we find that shape prompt can still provide some templates harbouring the location relationships of objects.
Improvements to its single interaction pattern could be a solution to this limitation, which we leave to our future work.</p>
</div>
<figure class="ltx_table" id="S5.T7">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>Online TTA performance of different methods in DSC score (%) on the Polyp segmentation tasks. The comparison results are drawn from <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>. The source model is pretrained on each single domain (source domain) and tested on the left domains (target domains).</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T7.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T7.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="S5.T7.1.1.1.1">Method</th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T7.1.1.1.2">A</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T7.1.1.1.3">B</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T7.1.1.1.4">C</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S5.T7.1.1.1.5">D</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T7.1.1.1.6">Average</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T7.1.2.2.1">Source Only</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.2.2">79.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.2.3">66.33</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.2.4">73.89</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T7.1.2.2.5">82.95</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.2.6">75.77</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.3.3.1">PTBN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib19" title="">19</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.3.2">76.13</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.3.3">75.63</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.3.4">72.28</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.3.3.5">82.3</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.3.6">76.59</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.4.4.1">TENT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib6" title="">6</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.4.2">74.86</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.4.3">67.51</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.4.4">17.79</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.4.4.5">73.55</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.4.6">58.43</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.5.5.1">CoTTA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib7" title="">7</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.5.2">76.46</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.5.3">66.77</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.5.4">71.39</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.5.5.5">70.71</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.5.6">71.33</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.6.6.1">DUA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib20" title="">20</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.6.2">78.93</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.6.3">66.84</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.6.4">76.53</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.6.6.5">86.24</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.6.6">77.13</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.7.7.1">SRA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib10" title="">10</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.7.7.2">76.48</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.7.7.3">66.45</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.7.7.4">71.46</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.7.7.5">70.41</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.7.7.6">71.20</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.8.8.1">VPTTA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.01573v1#bib.bib26" title="">26</a>]</cite>
</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.8.8.2">81.00</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.8.8.3"><span class="ltx_text ltx_framed ltx_framed_underline" id="S5.T7.1.8.8.3.1">76.87</span></td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.8.8.4">77.58</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.8.8.5"><span class="ltx_text ltx_framed ltx_framed_underline" id="S5.T7.1.8.8.5.1">86.39</span></td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.8.8.6">80.46</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T7.1.9.9.1">PASS</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.9.9.2"><span class="ltx_text ltx_font_bold" id="S5.T7.1.9.9.2.1">83.12</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.9.9.3">76.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.9.9.4"><span class="ltx_text ltx_font_bold" id="S5.T7.1.9.9.4.1">77.93</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T7.1.9.9.5">86.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.9.9.6"><span class="ltx_text ltx_font_bold" id="S5.T7.1.9.9.6.1">80.78</span></td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.10.10.1">CAPM Only</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.10.10.2"><span class="ltx_text ltx_framed ltx_framed_underline" id="S5.T7.1.10.10.2.1">82.13</span></td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.10.10.3"><span class="ltx_text" id="S5.T7.1.10.10.3.1" style="color:#CC0000;">74.53</span></td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.10.10.4">77.26</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T7.1.10.10.5"><span class="ltx_text" id="S5.T7.1.10.10.5.1" style="color:#CC0000;">82.53</span></td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.10.10.6">79.11</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S5.T7.1.11.11.1">ID Only</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.11.11.2">80.78</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.11.11.3"><span class="ltx_text ltx_font_bold" id="S5.T7.1.11.11.3.1">77.15</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.11.11.4"><span class="ltx_text ltx_framed ltx_framed_underline" id="S5.T7.1.11.11.4.1">77.61</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T7.1.11.11.5"><span class="ltx_text ltx_font_bold" id="S5.T7.1.11.11.5.1">86.55</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.11.11.6"><span class="ltx_text ltx_framed ltx_framed_underline" id="S5.T7.1.11.11.6.1">80.52</span></td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_figure" id="S5.F14"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="340" id="S5.F14.g1" src="x14.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 14: </span>The input images, segmentation masks and learnt shape prompts in the polyp datasets. Each column displays a sample and the relevant shape prompt.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">In this paper, we have investigated a novel test-time adaptation method named PASS to learn hybrid prompts adapted to the test domain for pretrained segmentation models. Specifically, we proposed an input decorator to alter the low-level style information within input data and a cross-attention prompt modulator, which customizes target-specific shape prompts from diverse latent representations, to enhance the high-level shape prior. An alternating momentum updating mechanism was designed to train the model with continual online test data, preserving historical knowledge and attenuating the impact of newcomers on the model. Without the requirement to access the source domain data and any constraints on the target organ shape, PASS can be easily deployed on the test-time of segmentation models. Extensive experiments have been conducted over various medical imaging datasets to confirm the efficacy and superior performance of PASS. 
In the future, we will attempt to propose dynamic shape prompt schemes to tackle the tasks with diverse shape priors.


</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_tag_bibitem">[1]</span>
<span class="ltx_bibblock">
S. Zhao, X. Yue, S. Zhang, B. Li, H. Zhao, B. Wu, R. Krishna, J. E. Gonzalez,
A. L. Sangiovanni-Vincentelli, S. A. Seshia <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">et al.</em>, “A review of
single-source deep unsupervised visual domain adaptation,” <em class="ltx_emph ltx_font_italic" id="bib.bib1.2.2">IEEE
Transactions on Neural Networks and Learning Systems</em>, vol. 33, no. 2, pp.
473–493, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_tag_bibitem">[2]</span>
<span class="ltx_bibblock">
F. Wu and X. Zhuang, “Unsupervised domain adaptation with variational
approximation for cardiac segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">IEEE Transactions on Medical
Imaging</em>, vol. 40, no. 12, pp. 3555–3567, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_tag_bibitem">[3]</span>
<span class="ltx_bibblock">
M. Bateson, H. Kervadec, J. Dolz, H. Lombaert, and I. B. Ayed, “Source-free
domain adaptation for image segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Medical Image Analysis</em>,
vol. 82, p. 102617, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_tag_bibitem">[4]</span>
<span class="ltx_bibblock">
Q. Liu, Q. Dou, and P.-A. Heng, “Shape-aware meta-learning for generalizing
prostate mri segmentation to unseen domains,” in <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Medical Image
Computing and Computer Assisted Intervention–MICCAI 2020: 23rd International
Conference, Lima, Peru, October 4–8, 2020, Proceedings, Part II 23</em>.   Springer, 2020, pp. 475–485.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_tag_bibitem">[5]</span>
<span class="ltx_bibblock">
J. Wu, G. Wang, R. Gu, T. Lu, Y. Chen, W. Zhu, T. Vercauteren, S. Ourselin, and
S. Zhang, “Upl-sfda: Uncertainty-aware pseudo label guided source-free
domain adaptation for medical image segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">IEEE transactions
on medical imaging</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_tag_bibitem">[6]</span>
<span class="ltx_bibblock">
D. Wang, E. Shelhamer, S. Liu, B. Olshausen, and T. Darrell, “Tent: Fully
test-time adaptation by entropy minimization,” in <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">International
Conference on Learning Representations</em>, 2021, p. 9229–9248.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_tag_bibitem">[7]</span>
<span class="ltx_bibblock">
Q. Wang, O. Fink, L. Van Gool, and D. Dai, “Continual test-time domain
adaptation,” in <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the IEEE/CVF Conference on Computer
Vision and Pattern Recognition</em>, 2022, pp. 7201–7211.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_tag_bibitem">[8]</span>
<span class="ltx_bibblock">
M. Bateson, H. Lombaert, and I. Ben Ayed, “Test-time adaptation with shape
moments for image segmentation,” in <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">International Conference on
Medical Image Computing and Computer-Assisted Intervention</em>.   Springer, 2022, pp. 736–745.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_tag_bibitem">[9]</span>
<span class="ltx_bibblock">
Y. He, A. Carass, L. Zuo, B. E. Dewey, and J. L. Prince, “Self domain adapted
network,” in <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">Medical Image Computing and Computer Assisted
Intervention–MICCAI 2020: 23rd International Conference, Lima, Peru, October
4–8, 2020, Proceedings, Part I 23</em>.   Springer, 2020, pp. 437–446.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_tag_bibitem">[10]</span>
<span class="ltx_bibblock">
S. Niu, J. Wu, Y. Zhang, Z. Wen, Y. Chen, P. Zhao, and M. Tan, “Towards stable
test-time adaptation in dynamic wild world,” in <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">International
Conference on Learning Representations</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_tag_bibitem">[11]</span>
<span class="ltx_bibblock">
Y. Sun, X. Wang, Z. Liu, J. Miller, A. Efros, and M. Hardt, “Test-time
training with self-supervision for generalization under distribution
shifts,” in <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">International Conference on Machine Learning</em>.   PMLR, 2020, pp. 9229–9248.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_tag_bibitem">[12]</span>
<span class="ltx_bibblock">
J. M. J. Valanarasu, P. Guo, V. VS, and V. M. Patel, “On-the-fly test-time
adaptation for medical image segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">arXiv preprint
arXiv:2203.05574</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_tag_bibitem">[13]</span>
<span class="ltx_bibblock">
Y. He, A. Carass, L. Zuo, B. E. Dewey, and J. L. Prince, “Autoencoder based
self-supervised test-time adaptation for medical image analysis,”
<em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">Medical image analysis</em>, vol. 72, p. 102136, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_tag_bibitem">[14]</span>
<span class="ltx_bibblock">
J. Guo, W. Zhang, M. Sinclair, D. Rueckert, and C. Chen, “Pay attention to the
atlas: Atlas-guided test-time adaptation method for robust 3d medical image
segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2307.00676</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_tag_bibitem">[15]</span>
<span class="ltx_bibblock">
M. Hu, T. Song, Y. Gu, X. Luo, J. Chen, Y. Chen, Y. Zhang, and S. Zhang,
“Fully test-time adaptation for image segmentation,” in <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Medical Image
Computing and Computer Assisted Intervention–MICCAI 2021: 24th International
Conference, Strasbourg, France, September 27–October 1, 2021, Proceedings,
Part III 24</em>.   Springer, 2021, pp.
251–260.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_tag_bibitem">[16]</span>
<span class="ltx_bibblock">
J. Wu, R. Gu, T. Lu, S. Zhang, and G. Wang, “Upl-tta: Uncertainty-aware pseudo
label guided fully test time adaptation for fetal brain segmentation,” in
<em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">International Conference on Information Processing in Medical
Imaging</em>.   Springer, 2023, pp.
237–249.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_tag_bibitem">[17]</span>
<span class="ltx_bibblock">
A. T. Nguyen, T. Nguyen-Tang, S.-N. Lim, and P. H. Torr, “Tipi: Test time
adaptation with transformation invariance,” in <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Proceedings of the
IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>, 2023, pp.
24 162–24 171.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_tag_bibitem">[18]</span>
<span class="ltx_bibblock">
Y. Zhang, Y. Sun, S. Zheng, Z. Shui, C. Zhu, and L. Yang, “Test-time training
for semantic segmentation with output contrastive loss,” <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">arXiv
preprint arXiv:2311.07877</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_tag_bibitem">[19]</span>
<span class="ltx_bibblock">
Z. Nado, S. Padhy, D. Sculley, A. D’Amour, B. Lakshminarayanan, and J. Snoek,
“Evaluating prediction-time batch normalization for robustness under
covariate shift,” <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">arXiv preprint arXiv:2006.10963</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_tag_bibitem">[20]</span>
<span class="ltx_bibblock">
M. J. Mirza, J. Micorek, H. Possegger, and H. Bischof, “The norm must go on:
Dynamic unsupervised domain adaptation by normalization,” in
<em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern
Recognition</em>, 2022, pp. 14 765–14 775.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_tag_bibitem">[21]</span>
<span class="ltx_bibblock">
Q. Liu, C. Chen, Q. Dou, and P.-A. Heng, “Single-domain generalization in
medical image segmentation via test-time adaptation from shape dictionary,”
in <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">Proceedings of the AAAI Conference on Artificial Intelligence</em>,
vol. 36, no. 2, 2022, pp. 1756–1764.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_tag_bibitem">[22]</span>
<span class="ltx_bibblock">
M. Jia, L. Tang, B.-C. Chen, C. Cardie, S. Belongie, B. Hariharan, and S.-N.
Lim, “Visual prompt tuning,” in <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">European Conference on Computer
Vision</em>.   Springer, 2022, pp. 709–727.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_tag_bibitem">[23]</span>
<span class="ltx_bibblock">
K. Zhou, J. Yang, C. C. Loy, and Z. Liu, “Learning to prompt for
vision-language models,” <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">International Journal of Computer Vision</em>,
vol. 130, no. 9, pp. 2337–2348, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_tag_bibitem">[24]</span>
<span class="ltx_bibblock">
M. Shu, W. Nie, D.-A. Huang, Z. Yu, T. Goldstein, A. Anandkumar, and C. Xiao,
“Test-time prompt tuning for zero-shot generalization in vision-language
models,” <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Advances in Neural Information Processing Systems</em>, vol. 35,
pp. 14 274–14 289, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_tag_bibitem">[25]</span>
<span class="ltx_bibblock">
S. Hu, Z. Liao, and Y. Xia, “Prosfda: Prompt learning based source-free domain
adaptation for medical image segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">arXiv preprint
arXiv:2211.11514</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_tag_bibitem">[26]</span>
<span class="ltx_bibblock">
Z. Chen, Y. Ye, M. Lu, Y. Pan, and Y. Xia, “Each test image deserves a
specific prompt: Continual test-time adaptation for 2d medical image
segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">arXiv preprint arXiv:2311.18363</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_tag_bibitem">[27]</span>
<span class="ltx_bibblock">
N. Karani, E. Erdil, K. Chaitanya, and E. Konukoglu, “Test-time adaptable
neural networks for robust medical image segmentation,” <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">Medical Image
Analysis</em>, vol. 68, p. 101907, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_tag_bibitem">[28]</span>
<span class="ltx_bibblock">
P. Liu, W. Yuan, J. Fu, Z. Jiang, H. Hayashi, and G. Neubig, “Pre-train,
prompt, and predict: A systematic survey of prompting methods in natural
language processing,” <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">ACM Computing Surveys</em>, vol. 55, no. 9, pp.
1–35, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_tag_bibitem">[29]</span>
<span class="ltx_bibblock">
J. Loedeman, M. C. Stol, T. Han, and Y. M. Asano, “Prompt generation networks
for efficient adaptation of frozen vision transformers,” <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">arXiv
preprint arXiv:2210.06466</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_tag_bibitem">[30]</span>
<span class="ltx_bibblock">
X. Nie, B. Ni, J. Chang, G. Meng, C. Huo, S. Xiang, and Q. Tian, “Pro-tuning:
Unified prompt tuning for vision tasks,” <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">IEEE Transactions on Circuits
and Systems for Video Technology</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_tag_bibitem">[31]</span>
<span class="ltx_bibblock">
Y. Gan, Y. Bai, Y. Lou, X. Ma, R. Zhang, N. Shi, and L. Luo, “Decorate the
newcomers: Visual domain prompt for continual test time adaptation,” in
<em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">Proceedings of the AAAI Conference on Artificial Intelligence</em>,
vol. 37, no. 6, 2023, pp. 7595–7603.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_tag_bibitem">[32]</span>
<span class="ltx_bibblock">
X. Huang and S. Belongie, “Arbitrary style transfer in real-time with adaptive
instance normalization,” in <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">Proceedings of the IEEE international
conference on computer vision</em>, 2017, pp. 1501–1510.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_tag_bibitem">[33]</span>
<span class="ltx_bibblock">
A. Almazroa, S. Alodhayb, E. Osman, E. Ramadan, M. Hummadi, M. Dlaim,
M. Alkatee, K. Raahemifar, and V. Lakshminarayanan, “Retinal fundus images
for glaucoma analysis: the riga dataset,” in <em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">Medical Imaging 2018:
Imaging Informatics for Healthcare, Research, and Applications</em>, vol.
10579.   SPIE, 2018, pp. 55–62.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_tag_bibitem">[34]</span>
<span class="ltx_bibblock">
E. Decencière, X. Zhang, G. Cazuguel, B. Lay, B. Cochener, C. Trone,
P. Gain, R. Ordonez, P. Massin, A. Erginay <em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">et al.</em>, “Feedback on a
publicly distributed image database: the messidor database,” <em class="ltx_emph ltx_font_italic" id="bib.bib34.2.2">Image
Analysis &amp; Stereology</em>, vol. 33, no. 3, pp. 231–234, 2014.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_tag_bibitem">[35]</span>
<span class="ltx_bibblock">
B. Nicholas, M. Anant, H. Henkjan, F. John, K. Justin <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">et al.</em>,
“Nci-proc. ieee-isbi conf. 2013 challenge: Automated segmentation of
prostate structures,” <em class="ltx_emph ltx_font_italic" id="bib.bib35.2.2">The Cancer Imaging Archive</em>, vol. 5, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_tag_bibitem">[36]</span>
<span class="ltx_bibblock">
G. Litjens, R. Toth, W. Van De Ven, C. Hoeks, S. Kerkstra, B. Van Ginneken,
G. Vincent, G. Guillard, N. Birbeck, J. Zhang <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">et al.</em>, “Evaluation of
prostate segmentation algorithms for mri: the promise12 challenge,”
<em class="ltx_emph ltx_font_italic" id="bib.bib36.2.2">Medical image analysis</em>, vol. 18, no. 2, pp. 359–373, 2014.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_tag_bibitem">[37]</span>
<span class="ltx_bibblock">
G. Lemaître, R. Martí, J. Freixenet, J. C. Vilanova, P. M. Walker,
and F. Meriaudeau, “Computer-aided detection and diagnosis for prostate
cancer based on mono and multi-parametric mri: a review,” <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">Computers in
biology and medicine</em>, vol. 60, pp. 8–31, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_tag_bibitem">[38]</span>
<span class="ltx_bibblock">
O. Ronneberger, P. Fischer, and T. Brox, “U-net: Convolutional networks for
biomedical image segmentation,” in <em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">Medical Image Computing and
Computer-Assisted Intervention–MICCAI 2015: 18th International Conference,
Munich, Germany, October 5-9, 2015, Proceedings, Part III 18</em>.   Springer, 2015, pp. 234–241.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_tag_bibitem">[39]</span>
<span class="ltx_bibblock">
H. Yang, C. Chen, M. Jiang, Q. Liu, J. Cao, P. A. Heng, and Q. Dou, “Dltta:
Dynamic learning rate for test-time adaptation on cross-domain medical
images,” <em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">IEEE Transactions on Medical Imaging</em>, vol. 41, no. 12, pp.
3575–3586, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_tag_bibitem">[40]</span>
<span class="ltx_bibblock">
D. Ulyanov, A. Vedaldi, and V. Lempitsky, “Improved texture networks:
Maximizing quality and diversity in feed-forward stylization and texture
synthesis,” in <em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">Proceedings of the IEEE conference on computer vision
and pattern recognition</em>, 2017, pp. 6924–6932.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_tag_bibitem">[41]</span>
<span class="ltx_bibblock">
S. Ioffe, “Batch normalization: Accelerating deep network training by reducing
internal covariate shift,” <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">arXiv preprint arXiv:1502.03167</em>, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_tag_bibitem">[42]</span>
<span class="ltx_bibblock">
J. L. Ba, “Layer normalization,” <em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">arXiv preprint arXiv:1607.06450</em>,
2016.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_tag_bibitem">[43]</span>
<span class="ltx_bibblock">
Y. Wu and K. He, “Group normalization,” in <em class="ltx_emph ltx_font_italic" id="bib.bib43.1.1">Proceedings of the European
conference on computer vision (ECCV)</em>, 2018, pp. 3–19.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_tag_bibitem">[44]</span>
<span class="ltx_bibblock">
K. He, X. Zhang, S. Ren, and J. Sun, “Delving deep into rectifiers: Surpassing
human-level performance on imagenet classification,” in <em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">Proceedings of
the IEEE international conference on computer vision</em>, 2015, pp. 1026–1034.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_tag_bibitem">[45]</span>
<span class="ltx_bibblock">
X. Glorot and Y. Bengio, “Understanding the difficulty of training deep
feedforward neural networks,” in <em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">Proceedings of the thirteenth
international conference on artificial intelligence and statistics</em>.   JMLR Workshop and Conference Proceedings,
2010, pp. 249–256.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_tag_bibitem">[46]</span>
<span class="ltx_bibblock">
A. M. Saxe, J. L. McClelland, and S. Ganguli, “Exact solutions to the
nonlinear dynamics of learning in deep linear neural networks,” <em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">arXiv
preprint arXiv:1312.6120</em>, 2013.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_tag_bibitem">[47]</span>
<span class="ltx_bibblock">
D.-P. Fan, G.-P. Ji, T. Zhou, G. Chen, H. Fu, J. Shen, and L. Shao, “Pranet:
Parallel reverse attention network for polyp segmentation,” in
<em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">International conference on medical image computing and
computer-assisted intervention</em>.   Springer, 2020, pp. 263–273.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Wed Oct  2 14:09:39 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
