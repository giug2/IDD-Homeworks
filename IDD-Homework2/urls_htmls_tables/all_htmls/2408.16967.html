<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>MemLong: Memory-Augmented Retrieval for Long Text Modeling</title>
<!--Generated on Fri Aug 30 01:57:03 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2408.16967v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S1" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Preliminary</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2.SS1" title="In 2 Preliminary ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Task Definition</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2.SS2" title="In 2 Preliminary ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Module and Operation Definitions</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>MemLong</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS1" title="In 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Overview</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS2" title="In 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Retriever and Dynamic Memory Management</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS2.SSS0.Px1" title="In 3.2 Retriever and Dynamic Memory Management ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Retrieval Process.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS2.SSS0.Px2" title="In 3.2 Retriever and Dynamic Memory Management ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Memory Process.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS2.SSS0.Px3" title="In 3.2 Retriever and Dynamic Memory Management ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Dynamic Memory Update.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS3" title="In 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Attention Reformulation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS4" title="In 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Inference with MemLong</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS1" title="In 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Implementation Details</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS1.SSS0.Px1" title="In 4.1 Implementation Details ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Training Details.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS1.SSS0.Px2" title="In 4.1 Implementation Details ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Position Remapping.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS2" title="In 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Long-Context Language Modeling</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS2.SSS0.Px1" title="In 4.2 Long-Context Language Modeling ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Datasets.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS2.SSS0.Px2" title="In 4.2 Long-Context Language Modeling ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Setup.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS2.SSS0.Px3" title="In 4.2 Long-Context Language Modeling ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Baselines.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS2.SSS0.Px4" title="In 4.2 Long-Context Language Modeling ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Results.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.SS3" title="In 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>In Context Learning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Ablation Study</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.SS1" title="In 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Training Setting</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.SS2" title="In 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Inference Performance</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.SS2.SSS0.Px1" title="In 5.2 Inference Performance ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Q1: Does the memory length affect the performance of the model ?</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.SS2.SSS0.Px2" title="In 5.2 Inference Performance ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title">Q2: How many layers do we need to introduce extra memory information?</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S6" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Related Work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S6.SS1" title="In 6 Related Work ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1 </span>Long Context Language Modeling</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S6.SS2" title="In 6 Related Work ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2 </span>Retrieval-Augmented Language Modeling</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S7" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#A1" title="In MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Different Training Settings</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document">
<h1 class="ltx_title ltx_title_document">MemLong: Memory-Augmented Retrieval for Long Text Modeling</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Weijie Liu<sup class="ltx_sup" id="id8.8.id1"><span class="ltx_text ltx_font_italic" id="id8.8.id1.1">1</span></sup>, Zecheng Tang<sup class="ltx_sup" id="id9.9.id2">1</sup><span class="ltx_note ltx_role_footnotemark" id="footnotex1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">1</span></span></span></span>, Juntao Li<sup class="ltx_sup" id="id10.10.id3"><span class="ltx_text ltx_font_italic" id="id10.10.id3.1">1</span></sup>, Kehai Chen<sup class="ltx_sup" id="id11.11.id4">2</sup>, Min Zhang<sup class="ltx_sup" id="id12.12.id5"><span class="ltx_text ltx_font_italic" id="id12.12.id5.1">1</span></sup>
<br class="ltx_break"/><sup class="ltx_sup" id="id13.13.id6"><span class="ltx_text ltx_font_italic" id="id13.13.id6.1">1</span></sup>School of Computer Science and Technology, Soochow University 
<br class="ltx_break"/><sup class="ltx_sup" id="id14.14.id7"><span class="ltx_text ltx_font_italic" id="id14.14.id7.1">2</span></sup>Harbin Institute of Technology, Shenzhen 
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id15.15.id8">{wjliu,zctang}@stu.suda.edu.cn</span>
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id16.16.id9">{ljt,minzhang}@suda.edu.cn</span>;    <span class="ltx_text ltx_font_typewriter" id="id17.17.id10">chenkehai@hit.edu.cn</span>
</span><span class="ltx_author_notes">  Equal Contribution.  Corresponding author.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id18.id1">Recent advancements in Large Language Models (LLMs) have yielded remarkable success across diverse fields. However, handling long contexts remains a significant challenge for LLMs due to the quadratic time and space complexity of attention mechanisms and the growing memory consumption of the key-value cache during generation. This work introduces <span class="ltx_text ltx_font_bold" id="id18.id1.1">MemLong</span>: <span class="ltx_text ltx_font_bold" id="id18.id1.2">Mem</span>ory-Augmented Retrieval for <span class="ltx_text ltx_font_bold" id="id18.id1.3">Long</span> Text Generation (<span class="ltx_text ltx_font_bold" id="id18.id1.4">MemLong</span>, a method designed to enhance the capabilities of long-context language modeling by utilizing an external retriever for historical information retrieval. MemLong combines a non-differentiable <span class="ltx_text ltx_font_italic" id="id18.id1.5">ret-mem</span> module with a partially trainable decoder-only language model and introduces a fine-grained, controllable retrieval attention mechanism that leverages semantic-level relevant chunks.
Comprehensive evaluations on multiple long-context language modeling benchmarks demonstrate that MemLong consistently outperforms other state-of-the-art LLMs. More importantly, MemLong can extend the context length on a single 3090 GPU from 4k up to 80k<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>Our code is available at  <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/Bui1dMySea/MemLong" title="">https://github.com/Bui1dMySea/MemLong</a></span></span></span>.</p>
</div>
<div class="ltx_para ltx_noindent" id="p1">
<div class="ltx_block ltx_align_bottom" id="p1.7">
<p class="ltx_p" id="p1.7.8"><span class="ltx_text ltx_font_bold" id="p1.7.8.1">MemLong: Memory-Augmented Retrieval for Long Text Modeling</span></p>
<br class="ltx_break ltx_centering"/>
<p class="ltx_p ltx_align_center" id="p1.7.7" style="width:433.6pt;"><span class="ltx_text ltx_inline-block" id="p1.7.7.7" style="width:0.0pt;">
<span class="ltx_tabular ltx_align_top" id="p1.7.7.7.7">
<span class="ltx_tbody">
<span class="ltx_tr" id="p1.5.5.5.5.5">
<span class="ltx_td ltx_align_center" id="p1.5.5.5.5.5.5"><span class="ltx_text ltx_font_bold" id="p1.5.5.5.5.5.5.5">Weijie Liu<sup class="ltx_sup" id="p1.5.5.5.5.5.5.5.1"><span class="ltx_text ltx_font_medium ltx_font_italic" id="p1.5.5.5.5.5.5.5.1.1">1</span></sup><span class="ltx_note ltx_role_thanks" id="p1.5.5.5.5.5.5.5.2"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">thanks: </span>  Equal Contribution.</span></span></span>, Zecheng Tang<sup class="ltx_sup" id="p1.5.5.5.5.5.5.5.3"><span class="ltx_text ltx_font_medium" id="p1.5.5.5.5.5.5.5.3.1">1</span></sup><span class="ltx_note ltx_role_footnotemark" id="footnotex2"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note"><span class="ltx_text ltx_font_medium" id="footnotex2.1.1.1">1</span></span></span></span></span>, Juntao Li<sup class="ltx_sup" id="p1.5.5.5.5.5.5.5.4"><span class="ltx_text ltx_font_medium ltx_font_italic" id="p1.5.5.5.5.5.5.5.4.1">1</span></sup><span class="ltx_note ltx_role_thanks" id="p1.5.5.5.5.5.5.5.5"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">thanks: </span>  Corresponding author.</span></span></span>, Kehai Chen<sup class="ltx_sup" id="p1.5.5.5.5.5.5.5.6"><span class="ltx_text ltx_font_medium" id="p1.5.5.5.5.5.5.5.6.1">2</span></sup>, Min Zhang<sup class="ltx_sup" id="p1.5.5.5.5.5.5.5.7"><span class="ltx_text ltx_font_medium ltx_font_italic" id="p1.5.5.5.5.5.5.5.7.1">1</span></sup></span></span></span>
<span class="ltx_tr" id="p1.6.6.6.6.6">
<span class="ltx_td ltx_align_center" id="p1.6.6.6.6.6.1"><sup class="ltx_sup" id="p1.6.6.6.6.6.1.1"><span class="ltx_text ltx_font_italic" id="p1.6.6.6.6.6.1.1.1">1</span></sup>School of Computer Science and Technology, Soochow University</span></span>
<span class="ltx_tr" id="p1.7.7.7.7.7">
<span class="ltx_td ltx_align_center" id="p1.7.7.7.7.7.1"><sup class="ltx_sup" id="p1.7.7.7.7.7.1.1"><span class="ltx_text ltx_font_italic" id="p1.7.7.7.7.7.1.1.1">2</span></sup>Harbin Institute of Technology, Shenzhen</span></span>
<span class="ltx_tr" id="p1.7.7.7.7.8.1">
<span class="ltx_td ltx_align_center" id="p1.7.7.7.7.8.1.1"><span class="ltx_text ltx_font_typewriter" id="p1.7.7.7.7.8.1.1.1">{wjliu,zctang}@stu.suda.edu.cn</span></span></span>
<span class="ltx_tr" id="p1.7.7.7.7.9.2">
<span class="ltx_td ltx_align_center" id="p1.7.7.7.7.9.2.1"><span class="ltx_text ltx_font_typewriter" id="p1.7.7.7.7.9.2.1.1">{ljt,minzhang}@suda.edu.cn</span>;    <span class="ltx_text ltx_font_typewriter" id="p1.7.7.7.7.9.2.1.2">chenkehai@hit.edu.cn</span></span></span>
</span>
</span></span></p>
<br class="ltx_break ltx_centering"/>
</div>
</div>
<figure class="ltx_figure" id="S0.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="811" id="S0.F1.g1" src="x1.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span><span class="ltx_text ltx_font_bold" id="S0.F1.4.1">Illustration of Retrieval-Augment Generation(RAG) and Memory-Retrieval flow of MemLong.</span> (a) RAG can even degrade the generation performance (yellow) when the length of the retrieved information exceeds the model’s processing capacity. (b) Our approach utilizes an external retriever to fetch historical information, which is then passed into the model as <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S0.F1.2.m1.1"><semantics id="S0.F1.2.m1.1b"><mrow id="S0.F1.2.m1.1.1" xref="S0.F1.2.m1.1.1.cmml"><mi id="S0.F1.2.m1.1.1.2" xref="S0.F1.2.m1.1.1.2.cmml">𝙺</mi><mo id="S0.F1.2.m1.1.1.1" xref="S0.F1.2.m1.1.1.1.cmml">⁢</mo><mtext id="S0.F1.2.m1.1.1.3" xref="S0.F1.2.m1.1.1.3a.cmml">-</mtext><mo id="S0.F1.2.m1.1.1.1b" xref="S0.F1.2.m1.1.1.1.cmml">⁢</mo><mi id="S0.F1.2.m1.1.1.4" xref="S0.F1.2.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S0.F1.2.m1.1c"><apply id="S0.F1.2.m1.1.1.cmml" xref="S0.F1.2.m1.1.1"><times id="S0.F1.2.m1.1.1.1.cmml" xref="S0.F1.2.m1.1.1.1"></times><ci id="S0.F1.2.m1.1.1.2.cmml" xref="S0.F1.2.m1.1.1.2">𝙺</ci><ci id="S0.F1.2.m1.1.1.3a.cmml" xref="S0.F1.2.m1.1.1.3"><mtext id="S0.F1.2.m1.1.1.3.cmml" xref="S0.F1.2.m1.1.1.3">-</mtext></ci><ci id="S0.F1.2.m1.1.1.4.cmml" xref="S0.F1.2.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S0.F1.2.m1.1d">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S0.F1.2.m1.1e">typewriter_K - typewriter_V</annotation></semantics></math> pairs rather than in text form.</figcaption>
</figure>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large Language Models (LLMs) have achieved remarkable success in various fields. However, due to the quadratic time and space complexity of vanilla attention mechanisms <cite class="ltx_cite ltx_citemacro_cite">Vaswani et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib29" title="">2017</a>)</cite>, it is challenging to extend the context length considerably, which poses significant limitations for applications involving long-sequence tasks, such as long-document summarization <cite class="ltx_cite ltx_citemacro_cite">Koh et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib17" title="">2022</a>)</cite> and multiple rounds of dialogue <cite class="ltx_cite ltx_citemacro_cite">Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib30" title="">2024a</a>)</cite>. As a result, LLMs are often expected to maintain a long working capability (a.k.a. long context LLMs) to effectively handle these demanding scenarios.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">To tackle the computational bottleneck, numerous efforts have been made.
The first line of work focuses on reducing the computation of vanilla attention mechanisms <cite class="ltx_cite ltx_citemacro_cite">Vaswani et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib29" title="">2017</a>)</cite> by employing sparse attention operations <cite class="ltx_cite ltx_citemacro_cite">Beltagy et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib4" title="">2020</a>); Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib31" title="">2020</a>); Kitaev et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib16" title="">2020</a>); Xiao et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib34" title="">2023a</a>); Chen et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib8" title="">2023b</a>); Lu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib19" title="">2024</a>)</cite>.
Although these types of works can reduce computational complexity to approximately <math alttext="\mathcal{O}(n)" class="ltx_Math" display="inline" id="S1.p2.1.m1.1"><semantics id="S1.p2.1.m1.1a"><mrow id="S1.p2.1.m1.1.2" xref="S1.p2.1.m1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S1.p2.1.m1.1.2.2" xref="S1.p2.1.m1.1.2.2.cmml">𝒪</mi><mo id="S1.p2.1.m1.1.2.1" xref="S1.p2.1.m1.1.2.1.cmml">⁢</mo><mrow id="S1.p2.1.m1.1.2.3.2" xref="S1.p2.1.m1.1.2.cmml"><mo id="S1.p2.1.m1.1.2.3.2.1" stretchy="false" xref="S1.p2.1.m1.1.2.cmml">(</mo><mi id="S1.p2.1.m1.1.1" xref="S1.p2.1.m1.1.1.cmml">n</mi><mo id="S1.p2.1.m1.1.2.3.2.2" stretchy="false" xref="S1.p2.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p2.1.m1.1b"><apply id="S1.p2.1.m1.1.2.cmml" xref="S1.p2.1.m1.1.2"><times id="S1.p2.1.m1.1.2.1.cmml" xref="S1.p2.1.m1.1.2.1"></times><ci id="S1.p2.1.m1.1.2.2.cmml" xref="S1.p2.1.m1.1.2.2">𝒪</ci><ci id="S1.p2.1.m1.1.1.cmml" xref="S1.p2.1.m1.1.1">𝑛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.1.m1.1c">\mathcal{O}(n)</annotation><annotation encoding="application/x-llamapun" id="S1.p2.1.m1.1d">caligraphic_O ( italic_n )</annotation></semantics></math>, it often comes with trade-offs in model capability.
Therefore, Some works shift their focus to memory selection <cite class="ltx_cite ltx_citemacro_cite">Dai et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib9" title="">2019</a>); Bertsch et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib5" title="">2024</a>); Yu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib37" title="">2023</a>)</cite>. These approaches, as token-level memory selection, can result in the truncation of semantic information.
Another recent line of work is Retrieval-Augment Language Modeling <cite class="ltx_cite ltx_citemacro_cite">Wu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib33" title="">2022</a>); Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib32" title="">2024b</a>); Rubin and Berant (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib25" title="">2023</a>)</cite>. These works usually introduce a retrieval mechanism to enhance the model’s ability to handle long texts. However, these methods have several drawbacks. Firstly, the information stored in memory may experience <span class="ltx_text ltx_font_italic" id="S1.p2.1.1">distribution shifts</span> due to changes in model parameters during training. Secondly, these methods often require retraining, which is impractical in the era of large models. Finally, these models are often prone to processing long text inputs at the expense of the original capabilities of the pre-trained model.
To address the limitations of previous research, we posed the following question: <span class="ltx_text ltx_font_bold" id="S1.p2.1.2">Can we utilize the explicit retrieval capabilities of a retriever to approximate the implicit retrieval processes within the model?</span></p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">In this work, we propose MemLong, an efficient and lightweight method to extending the context window of LLMs. <span class="ltx_text ltx_font_bold" id="S1.p3.1.1">The key idea is to store past contexts and knowledge in a non-trainable memory bank and further leverages these stored embeddings to retrieve chunk-level key-value (<math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S1.p3.1.1.m1.1"><semantics id="S1.p3.1.1.m1.1a"><mrow id="S1.p3.1.1.m1.1.1" xref="S1.p3.1.1.m1.1.1.cmml"><mi id="S1.p3.1.1.m1.1.1.2" xref="S1.p3.1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S1.p3.1.1.m1.1.1.1" xref="S1.p3.1.1.m1.1.1.1.cmml">⁢</mo><mtext class="ltx_mathvariant_bold" id="S1.p3.1.1.m1.1.1.3" xref="S1.p3.1.1.m1.1.1.3a.cmml">-</mtext><mo id="S1.p3.1.1.m1.1.1.1a" xref="S1.p3.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S1.p3.1.1.m1.1.1.4" xref="S1.p3.1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.1.1.m1.1b"><apply id="S1.p3.1.1.m1.1.1.cmml" xref="S1.p3.1.1.m1.1.1"><times id="S1.p3.1.1.m1.1.1.1.cmml" xref="S1.p3.1.1.m1.1.1.1"></times><ci id="S1.p3.1.1.m1.1.1.2.cmml" xref="S1.p3.1.1.m1.1.1.2">𝙺</ci><ci id="S1.p3.1.1.m1.1.1.3a.cmml" xref="S1.p3.1.1.m1.1.1.3"><mtext class="ltx_mathvariant_bold" id="S1.p3.1.1.m1.1.1.3.cmml" xref="S1.p3.1.1.m1.1.1.3">-</mtext></ci><ci id="S1.p3.1.1.m1.1.1.4.cmml" xref="S1.p3.1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math>) pairs for input into the model.</span>.
MemLong is applicable to any decoder-only pretrained language models by incorporating (1) an additional <span class="ltx_text ltx_font_italic" id="S1.p3.1.2">ret-mem</span> component for memory and retrieval, and (2) a <span class="ltx_text ltx_font_italic" id="S1.p3.1.3">retrieval causal attention</span> module for integrating local and memory information.
The memory and retrieval process of MemLong is illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S0.F1" title="Figure 1 ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">1</span></a>(b). During generation,one text that exceeds the model’s maximum processing length is stored as context information in a Memory Bank. Subsequently, given a recently generated text chunk in a long document, we use the retriever to explicitly retrieve past information, obtaining additional context information through index alignment.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">MemLong offers several benefits:
(1) <span class="ltx_text ltx_font_bold" id="S1.p4.1.1">Distributional Consistency</span>:
Unlike previous models that experienced a <span class="ltx_text ltx_font_italic" id="S1.p4.1.2">distribution shift</span> when information was stored in memory, MemLong ensures the distribution of cached information remains consistent.
(2) <span class="ltx_text ltx_font_bold" id="S1.p4.1.3">Training Efficient</span>: We freeze the <span class="ltx_text ltx_font_italic" id="S1.p4.1.4">lower layers</span> of the model and only need to finetune the <span class="ltx_text ltx_font_italic" id="S1.p4.1.5">upper layers</span> which greatly reduced computational cost. In our experiments, finetuning a 3B parameter version of MemLong on 0.5B tokens requires only eight 3090 GPUs for eight hours.
(3) <span class="ltx_text ltx_font_bold" id="S1.p4.1.6">Extensive Context Window</span>: Since only a single layer’s <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S1.p4.1.m1.1"><semantics id="S1.p4.1.m1.1a"><mrow id="S1.p4.1.m1.1.1" xref="S1.p4.1.m1.1.1.cmml"><mi id="S1.p4.1.m1.1.1.2" xref="S1.p4.1.m1.1.1.2.cmml">𝙺</mi><mo id="S1.p4.1.m1.1.1.1" xref="S1.p4.1.m1.1.1.1.cmml">⁢</mo><mtext id="S1.p4.1.m1.1.1.3" xref="S1.p4.1.m1.1.1.3a.cmml">-</mtext><mo id="S1.p4.1.m1.1.1.1a" xref="S1.p4.1.m1.1.1.1.cmml">⁢</mo><mi id="S1.p4.1.m1.1.1.4" xref="S1.p4.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.p4.1.m1.1b"><apply id="S1.p4.1.m1.1.1.cmml" xref="S1.p4.1.m1.1.1"><times id="S1.p4.1.m1.1.1.1.cmml" xref="S1.p4.1.m1.1.1.1"></times><ci id="S1.p4.1.m1.1.1.2.cmml" xref="S1.p4.1.m1.1.1.2">𝙺</ci><ci id="S1.p4.1.m1.1.1.3a.cmml" xref="S1.p4.1.m1.1.1.3"><mtext id="S1.p4.1.m1.1.1.3.cmml" xref="S1.p4.1.m1.1.1.3">-</mtext></ci><ci id="S1.p4.1.m1.1.1.4.cmml" xref="S1.p4.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p4.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S1.p4.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs need to be memorized, MemLong is capable of extending the context window up to 80k tokens easily on a single 3090 GPU.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">Extensive experiments have demonstrated that MemLong exhibits superior performance in several aspects when compared with other leading LLMs. MemLong outperforms OpenLLaMA <cite class="ltx_cite ltx_citemacro_cite">Touvron et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib27" title="">2023</a>)</cite> and other retrieval-based models on several long-context language modeling datasets. In retrieval-augmented in-context learning tasks, MemLong achieves an improvement of up to 10.2 percentage points over OpenLLaMA.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Preliminary</h2>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="300" id="S2.F2.g1" src="extracted/5822409/MemLong.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span> An example of MemLong : In the <span class="ltx_text ltx_font_italic" id="S2.F2.9.1">lower layers</span>, where the model remains static, causal language modeling is performed on the entire chunk <math alttext="c_{i}" class="ltx_Math" display="inline" id="S2.F2.4.m1.1"><semantics id="S2.F2.4.m1.1b"><msub id="S2.F2.4.m1.1.1" xref="S2.F2.4.m1.1.1.cmml"><mi id="S2.F2.4.m1.1.1.2" xref="S2.F2.4.m1.1.1.2.cmml">c</mi><mi id="S2.F2.4.m1.1.1.3" xref="S2.F2.4.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.F2.4.m1.1c"><apply id="S2.F2.4.m1.1.1.cmml" xref="S2.F2.4.m1.1.1"><csymbol cd="ambiguous" id="S2.F2.4.m1.1.1.1.cmml" xref="S2.F2.4.m1.1.1">subscript</csymbol><ci id="S2.F2.4.m1.1.1.2.cmml" xref="S2.F2.4.m1.1.1.2">𝑐</ci><ci id="S2.F2.4.m1.1.1.3.cmml" xref="S2.F2.4.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.4.m1.1d">c_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.4.m1.1e">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, and subsequently, <math alttext="c_{i}" class="ltx_Math" display="inline" id="S2.F2.5.m2.1"><semantics id="S2.F2.5.m2.1b"><msub id="S2.F2.5.m2.1.1" xref="S2.F2.5.m2.1.1.cmml"><mi id="S2.F2.5.m2.1.1.2" xref="S2.F2.5.m2.1.1.2.cmml">c</mi><mi id="S2.F2.5.m2.1.1.3" xref="S2.F2.5.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.F2.5.m2.1c"><apply id="S2.F2.5.m2.1.1.cmml" xref="S2.F2.5.m2.1.1"><csymbol cd="ambiguous" id="S2.F2.5.m2.1.1.1.cmml" xref="S2.F2.5.m2.1.1">subscript</csymbol><ci id="S2.F2.5.m2.1.1.2.cmml" xref="S2.F2.5.m2.1.1.2">𝑐</ci><ci id="S2.F2.5.m2.1.1.3.cmml" xref="S2.F2.5.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.5.m2.1d">c_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.5.m2.1e">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is cached in both embedding and <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S2.F2.6.m3.1"><semantics id="S2.F2.6.m3.1b"><mrow id="S2.F2.6.m3.1.1" xref="S2.F2.6.m3.1.1.cmml"><mi id="S2.F2.6.m3.1.1.2" xref="S2.F2.6.m3.1.1.2.cmml">𝙺</mi><mo id="S2.F2.6.m3.1.1.1" xref="S2.F2.6.m3.1.1.1.cmml">⁢</mo><mtext id="S2.F2.6.m3.1.1.3" xref="S2.F2.6.m3.1.1.3a.cmml">-</mtext><mo id="S2.F2.6.m3.1.1.1b" xref="S2.F2.6.m3.1.1.1.cmml">⁢</mo><mi id="S2.F2.6.m3.1.1.4" xref="S2.F2.6.m3.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.F2.6.m3.1c"><apply id="S2.F2.6.m3.1.1.cmml" xref="S2.F2.6.m3.1.1"><times id="S2.F2.6.m3.1.1.1.cmml" xref="S2.F2.6.m3.1.1.1"></times><ci id="S2.F2.6.m3.1.1.2.cmml" xref="S2.F2.6.m3.1.1.2">𝙺</ci><ci id="S2.F2.6.m3.1.1.3a.cmml" xref="S2.F2.6.m3.1.1.3"><mtext id="S2.F2.6.m3.1.1.3.cmml" xref="S2.F2.6.m3.1.1.3">-</mtext></ci><ci id="S2.F2.6.m3.1.1.4.cmml" xref="S2.F2.6.m3.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.6.m3.1d">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.6.m3.1e">typewriter_K - typewriter_V</annotation></semantics></math> pair forms. Lastly, the <span class="ltx_text ltx_font_italic" id="S2.F2.10.2">upper layers</span> are finetuned to harmonize retrieval preferences and integrate the retrieved content.</figcaption>
</figure>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Task Definition</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.12">Language models are designed to define probability distributions over sequences of tokens, effectively predicting the likelihood of a sequence within a given language.
Given such a sequence <math alttext="x_{1},\dots,x_{n}" class="ltx_Math" display="inline" id="S2.SS1.p1.1.m1.3"><semantics id="S2.SS1.p1.1.m1.3a"><mrow id="S2.SS1.p1.1.m1.3.3.2" xref="S2.SS1.p1.1.m1.3.3.3.cmml"><msub id="S2.SS1.p1.1.m1.2.2.1.1" xref="S2.SS1.p1.1.m1.2.2.1.1.cmml"><mi id="S2.SS1.p1.1.m1.2.2.1.1.2" xref="S2.SS1.p1.1.m1.2.2.1.1.2.cmml">x</mi><mn id="S2.SS1.p1.1.m1.2.2.1.1.3" xref="S2.SS1.p1.1.m1.2.2.1.1.3.cmml">1</mn></msub><mo id="S2.SS1.p1.1.m1.3.3.2.3" xref="S2.SS1.p1.1.m1.3.3.3.cmml">,</mo><mi id="S2.SS1.p1.1.m1.1.1" mathvariant="normal" xref="S2.SS1.p1.1.m1.1.1.cmml">…</mi><mo id="S2.SS1.p1.1.m1.3.3.2.4" xref="S2.SS1.p1.1.m1.3.3.3.cmml">,</mo><msub id="S2.SS1.p1.1.m1.3.3.2.2" xref="S2.SS1.p1.1.m1.3.3.2.2.cmml"><mi id="S2.SS1.p1.1.m1.3.3.2.2.2" xref="S2.SS1.p1.1.m1.3.3.2.2.2.cmml">x</mi><mi id="S2.SS1.p1.1.m1.3.3.2.2.3" xref="S2.SS1.p1.1.m1.3.3.2.2.3.cmml">n</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.1.m1.3b"><list id="S2.SS1.p1.1.m1.3.3.3.cmml" xref="S2.SS1.p1.1.m1.3.3.2"><apply id="S2.SS1.p1.1.m1.2.2.1.1.cmml" xref="S2.SS1.p1.1.m1.2.2.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.1.m1.2.2.1.1.1.cmml" xref="S2.SS1.p1.1.m1.2.2.1.1">subscript</csymbol><ci id="S2.SS1.p1.1.m1.2.2.1.1.2.cmml" xref="S2.SS1.p1.1.m1.2.2.1.1.2">𝑥</ci><cn id="S2.SS1.p1.1.m1.2.2.1.1.3.cmml" type="integer" xref="S2.SS1.p1.1.m1.2.2.1.1.3">1</cn></apply><ci id="S2.SS1.p1.1.m1.1.1.cmml" xref="S2.SS1.p1.1.m1.1.1">…</ci><apply id="S2.SS1.p1.1.m1.3.3.2.2.cmml" xref="S2.SS1.p1.1.m1.3.3.2.2"><csymbol cd="ambiguous" id="S2.SS1.p1.1.m1.3.3.2.2.1.cmml" xref="S2.SS1.p1.1.m1.3.3.2.2">subscript</csymbol><ci id="S2.SS1.p1.1.m1.3.3.2.2.2.cmml" xref="S2.SS1.p1.1.m1.3.3.2.2.2">𝑥</ci><ci id="S2.SS1.p1.1.m1.3.3.2.2.3.cmml" xref="S2.SS1.p1.1.m1.3.3.2.2.3">𝑛</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.1.m1.3c">x_{1},\dots,x_{n}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.1.m1.3d">italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT</annotation></semantics></math>, the standard approach to modeling its probability is via the next-token prediction: <math alttext="p(x_{1},\dots,x_{n})=\sum_{i=0}^{n}{p_{\theta}{(x_{i}|x_{&lt;i})}}" class="ltx_Math" display="inline" id="S2.SS1.p1.2.m2.4"><semantics id="S2.SS1.p1.2.m2.4a"><mrow id="S2.SS1.p1.2.m2.4.4" xref="S2.SS1.p1.2.m2.4.4.cmml"><mrow id="S2.SS1.p1.2.m2.3.3.2" xref="S2.SS1.p1.2.m2.3.3.2.cmml"><mi id="S2.SS1.p1.2.m2.3.3.2.4" xref="S2.SS1.p1.2.m2.3.3.2.4.cmml">p</mi><mo id="S2.SS1.p1.2.m2.3.3.2.3" xref="S2.SS1.p1.2.m2.3.3.2.3.cmml">⁢</mo><mrow id="S2.SS1.p1.2.m2.3.3.2.2.2" xref="S2.SS1.p1.2.m2.3.3.2.2.3.cmml"><mo id="S2.SS1.p1.2.m2.3.3.2.2.2.3" stretchy="false" xref="S2.SS1.p1.2.m2.3.3.2.2.3.cmml">(</mo><msub id="S2.SS1.p1.2.m2.2.2.1.1.1.1" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1.cmml"><mi id="S2.SS1.p1.2.m2.2.2.1.1.1.1.2" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1.2.cmml">x</mi><mn id="S2.SS1.p1.2.m2.2.2.1.1.1.1.3" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS1.p1.2.m2.3.3.2.2.2.4" xref="S2.SS1.p1.2.m2.3.3.2.2.3.cmml">,</mo><mi id="S2.SS1.p1.2.m2.1.1" mathvariant="normal" xref="S2.SS1.p1.2.m2.1.1.cmml">…</mi><mo id="S2.SS1.p1.2.m2.3.3.2.2.2.5" xref="S2.SS1.p1.2.m2.3.3.2.2.3.cmml">,</mo><msub id="S2.SS1.p1.2.m2.3.3.2.2.2.2" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2.cmml"><mi id="S2.SS1.p1.2.m2.3.3.2.2.2.2.2" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2.2.cmml">x</mi><mi id="S2.SS1.p1.2.m2.3.3.2.2.2.2.3" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2.3.cmml">n</mi></msub><mo id="S2.SS1.p1.2.m2.3.3.2.2.2.6" stretchy="false" xref="S2.SS1.p1.2.m2.3.3.2.2.3.cmml">)</mo></mrow></mrow><mo id="S2.SS1.p1.2.m2.4.4.4" rspace="0.111em" xref="S2.SS1.p1.2.m2.4.4.4.cmml">=</mo><mrow id="S2.SS1.p1.2.m2.4.4.3" xref="S2.SS1.p1.2.m2.4.4.3.cmml"><msubsup id="S2.SS1.p1.2.m2.4.4.3.2" xref="S2.SS1.p1.2.m2.4.4.3.2.cmml"><mo id="S2.SS1.p1.2.m2.4.4.3.2.2.2" xref="S2.SS1.p1.2.m2.4.4.3.2.2.2.cmml">∑</mo><mrow id="S2.SS1.p1.2.m2.4.4.3.2.2.3" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.cmml"><mi id="S2.SS1.p1.2.m2.4.4.3.2.2.3.2" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.2.cmml">i</mi><mo id="S2.SS1.p1.2.m2.4.4.3.2.2.3.1" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.1.cmml">=</mo><mn id="S2.SS1.p1.2.m2.4.4.3.2.2.3.3" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.3.cmml">0</mn></mrow><mi id="S2.SS1.p1.2.m2.4.4.3.2.3" xref="S2.SS1.p1.2.m2.4.4.3.2.3.cmml">n</mi></msubsup><mrow id="S2.SS1.p1.2.m2.4.4.3.1" xref="S2.SS1.p1.2.m2.4.4.3.1.cmml"><msub id="S2.SS1.p1.2.m2.4.4.3.1.3" xref="S2.SS1.p1.2.m2.4.4.3.1.3.cmml"><mi id="S2.SS1.p1.2.m2.4.4.3.1.3.2" xref="S2.SS1.p1.2.m2.4.4.3.1.3.2.cmml">p</mi><mi id="S2.SS1.p1.2.m2.4.4.3.1.3.3" xref="S2.SS1.p1.2.m2.4.4.3.1.3.3.cmml">θ</mi></msub><mo id="S2.SS1.p1.2.m2.4.4.3.1.2" xref="S2.SS1.p1.2.m2.4.4.3.1.2.cmml">⁢</mo><mrow id="S2.SS1.p1.2.m2.4.4.3.1.1.1" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.cmml"><mo id="S2.SS1.p1.2.m2.4.4.3.1.1.1.2" stretchy="false" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.cmml">(</mo><mrow id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.cmml"><msub id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.cmml"><mi id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.2" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.2.cmml">x</mi><mi id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.3" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.3.cmml">i</mi></msub><mo fence="false" id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.1" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.1.cmml">|</mo><msub id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.cmml"><mi id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.2" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.2.cmml">x</mi><mrow id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.cmml"><mi id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.2" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.2.cmml"></mi><mo id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.1" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.1.cmml">&lt;</mo><mi id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.3" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.3.cmml">i</mi></mrow></msub></mrow><mo id="S2.SS1.p1.2.m2.4.4.3.1.1.1.3" stretchy="false" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.2.m2.4b"><apply id="S2.SS1.p1.2.m2.4.4.cmml" xref="S2.SS1.p1.2.m2.4.4"><eq id="S2.SS1.p1.2.m2.4.4.4.cmml" xref="S2.SS1.p1.2.m2.4.4.4"></eq><apply id="S2.SS1.p1.2.m2.3.3.2.cmml" xref="S2.SS1.p1.2.m2.3.3.2"><times id="S2.SS1.p1.2.m2.3.3.2.3.cmml" xref="S2.SS1.p1.2.m2.3.3.2.3"></times><ci id="S2.SS1.p1.2.m2.3.3.2.4.cmml" xref="S2.SS1.p1.2.m2.3.3.2.4">𝑝</ci><vector id="S2.SS1.p1.2.m2.3.3.2.2.3.cmml" xref="S2.SS1.p1.2.m2.3.3.2.2.2"><apply id="S2.SS1.p1.2.m2.2.2.1.1.1.1.cmml" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.2.2.1.1.1.1.1.cmml" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1">subscript</csymbol><ci id="S2.SS1.p1.2.m2.2.2.1.1.1.1.2.cmml" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1.2">𝑥</ci><cn id="S2.SS1.p1.2.m2.2.2.1.1.1.1.3.cmml" type="integer" xref="S2.SS1.p1.2.m2.2.2.1.1.1.1.3">1</cn></apply><ci id="S2.SS1.p1.2.m2.1.1.cmml" xref="S2.SS1.p1.2.m2.1.1">…</ci><apply id="S2.SS1.p1.2.m2.3.3.2.2.2.2.cmml" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.3.3.2.2.2.2.1.cmml" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2">subscript</csymbol><ci id="S2.SS1.p1.2.m2.3.3.2.2.2.2.2.cmml" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2.2">𝑥</ci><ci id="S2.SS1.p1.2.m2.3.3.2.2.2.2.3.cmml" xref="S2.SS1.p1.2.m2.3.3.2.2.2.2.3">𝑛</ci></apply></vector></apply><apply id="S2.SS1.p1.2.m2.4.4.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3"><apply id="S2.SS1.p1.2.m2.4.4.3.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.4.4.3.2.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2">superscript</csymbol><apply id="S2.SS1.p1.2.m2.4.4.3.2.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.4.4.3.2.2.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2">subscript</csymbol><sum id="S2.SS1.p1.2.m2.4.4.3.2.2.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2.2.2"></sum><apply id="S2.SS1.p1.2.m2.4.4.3.2.2.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3"><eq id="S2.SS1.p1.2.m2.4.4.3.2.2.3.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.1"></eq><ci id="S2.SS1.p1.2.m2.4.4.3.2.2.3.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.2">𝑖</ci><cn id="S2.SS1.p1.2.m2.4.4.3.2.2.3.3.cmml" type="integer" xref="S2.SS1.p1.2.m2.4.4.3.2.2.3.3">0</cn></apply></apply><ci id="S2.SS1.p1.2.m2.4.4.3.2.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.2.3">𝑛</ci></apply><apply id="S2.SS1.p1.2.m2.4.4.3.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1"><times id="S2.SS1.p1.2.m2.4.4.3.1.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.2"></times><apply id="S2.SS1.p1.2.m2.4.4.3.1.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.3"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.4.4.3.1.3.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.3">subscript</csymbol><ci id="S2.SS1.p1.2.m2.4.4.3.1.3.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.3.2">𝑝</ci><ci id="S2.SS1.p1.2.m2.4.4.3.1.3.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.3.3">𝜃</ci></apply><apply id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1"><csymbol cd="latexml" id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.1">conditional</csymbol><apply id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2">subscript</csymbol><ci id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.2">𝑥</ci><ci id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.2.3">𝑖</ci></apply><apply id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3">subscript</csymbol><ci id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.2">𝑥</ci><apply id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3"><lt id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.1.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.1"></lt><csymbol cd="latexml" id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.2.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.2">absent</csymbol><ci id="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.3.cmml" xref="S2.SS1.p1.2.m2.4.4.3.1.1.1.1.3.3.3">𝑖</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.2.m2.4c">p(x_{1},\dots,x_{n})=\sum_{i=0}^{n}{p_{\theta}{(x_{i}|x_{&lt;i})}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.2.m2.4d">italic_p ( italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_i = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT italic_p start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_x start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>, where <math alttext="x_{&lt;i}\coloneqq x_{1},\dots,x_{i-1}" class="ltx_Math" display="inline" id="S2.SS1.p1.3.m3.3"><semantics id="S2.SS1.p1.3.m3.3a"><mrow id="S2.SS1.p1.3.m3.3.3" xref="S2.SS1.p1.3.m3.3.3.cmml"><msub id="S2.SS1.p1.3.m3.3.3.4" xref="S2.SS1.p1.3.m3.3.3.4.cmml"><mi id="S2.SS1.p1.3.m3.3.3.4.2" xref="S2.SS1.p1.3.m3.3.3.4.2.cmml">x</mi><mrow id="S2.SS1.p1.3.m3.3.3.4.3" xref="S2.SS1.p1.3.m3.3.3.4.3.cmml"><mi id="S2.SS1.p1.3.m3.3.3.4.3.2" xref="S2.SS1.p1.3.m3.3.3.4.3.2.cmml"></mi><mo id="S2.SS1.p1.3.m3.3.3.4.3.1" xref="S2.SS1.p1.3.m3.3.3.4.3.1.cmml">&lt;</mo><mi id="S2.SS1.p1.3.m3.3.3.4.3.3" xref="S2.SS1.p1.3.m3.3.3.4.3.3.cmml">i</mi></mrow></msub><mo id="S2.SS1.p1.3.m3.3.3.3" xref="S2.SS1.p1.3.m3.3.3.3.cmml">≔</mo><mrow id="S2.SS1.p1.3.m3.3.3.2.2" xref="S2.SS1.p1.3.m3.3.3.2.3.cmml"><msub id="S2.SS1.p1.3.m3.2.2.1.1.1" xref="S2.SS1.p1.3.m3.2.2.1.1.1.cmml"><mi id="S2.SS1.p1.3.m3.2.2.1.1.1.2" xref="S2.SS1.p1.3.m3.2.2.1.1.1.2.cmml">x</mi><mn id="S2.SS1.p1.3.m3.2.2.1.1.1.3" xref="S2.SS1.p1.3.m3.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS1.p1.3.m3.3.3.2.2.3" xref="S2.SS1.p1.3.m3.3.3.2.3.cmml">,</mo><mi id="S2.SS1.p1.3.m3.1.1" mathvariant="normal" xref="S2.SS1.p1.3.m3.1.1.cmml">…</mi><mo id="S2.SS1.p1.3.m3.3.3.2.2.4" xref="S2.SS1.p1.3.m3.3.3.2.3.cmml">,</mo><msub id="S2.SS1.p1.3.m3.3.3.2.2.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.cmml"><mi id="S2.SS1.p1.3.m3.3.3.2.2.2.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.cmml">x</mi><mrow id="S2.SS1.p1.3.m3.3.3.2.2.2.3" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.cmml"><mi id="S2.SS1.p1.3.m3.3.3.2.2.2.3.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.2.cmml">i</mi><mo id="S2.SS1.p1.3.m3.3.3.2.2.2.3.1" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.1.cmml">−</mo><mn id="S2.SS1.p1.3.m3.3.3.2.2.2.3.3" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.3.cmml">1</mn></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.3.m3.3b"><apply id="S2.SS1.p1.3.m3.3.3.cmml" xref="S2.SS1.p1.3.m3.3.3"><ci id="S2.SS1.p1.3.m3.3.3.3.cmml" xref="S2.SS1.p1.3.m3.3.3.3">≔</ci><apply id="S2.SS1.p1.3.m3.3.3.4.cmml" xref="S2.SS1.p1.3.m3.3.3.4"><csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.3.3.4.1.cmml" xref="S2.SS1.p1.3.m3.3.3.4">subscript</csymbol><ci id="S2.SS1.p1.3.m3.3.3.4.2.cmml" xref="S2.SS1.p1.3.m3.3.3.4.2">𝑥</ci><apply id="S2.SS1.p1.3.m3.3.3.4.3.cmml" xref="S2.SS1.p1.3.m3.3.3.4.3"><lt id="S2.SS1.p1.3.m3.3.3.4.3.1.cmml" xref="S2.SS1.p1.3.m3.3.3.4.3.1"></lt><csymbol cd="latexml" id="S2.SS1.p1.3.m3.3.3.4.3.2.cmml" xref="S2.SS1.p1.3.m3.3.3.4.3.2">absent</csymbol><ci id="S2.SS1.p1.3.m3.3.3.4.3.3.cmml" xref="S2.SS1.p1.3.m3.3.3.4.3.3">𝑖</ci></apply></apply><list id="S2.SS1.p1.3.m3.3.3.2.3.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2"><apply id="S2.SS1.p1.3.m3.2.2.1.1.1.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.2.2.1.1.1.1.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1">subscript</csymbol><ci id="S2.SS1.p1.3.m3.2.2.1.1.1.2.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.2">𝑥</ci><cn id="S2.SS1.p1.3.m3.2.2.1.1.1.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.2.2.1.1.1.3">1</cn></apply><ci id="S2.SS1.p1.3.m3.1.1.cmml" xref="S2.SS1.p1.3.m3.1.1">…</ci><apply id="S2.SS1.p1.3.m3.3.3.2.2.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.3.3.2.2.2.1.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2">subscript</csymbol><ci id="S2.SS1.p1.3.m3.3.3.2.2.2.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2">𝑥</ci><apply id="S2.SS1.p1.3.m3.3.3.2.2.2.3.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3"><minus id="S2.SS1.p1.3.m3.3.3.2.2.2.3.1.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.1"></minus><ci id="S2.SS1.p1.3.m3.3.3.2.2.2.3.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.2">𝑖</ci><cn id="S2.SS1.p1.3.m3.3.3.2.2.2.3.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.3.3.2.2.2.3.3">1</cn></apply></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.3.m3.3c">x_{&lt;i}\coloneqq x_{1},\dots,x_{i-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.3.m3.3d">italic_x start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT ≔ italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT</annotation></semantics></math> is the sequence of tokens proceeding <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.SS1.p1.4.m4.1"><semantics id="S2.SS1.p1.4.m4.1a"><msub id="S2.SS1.p1.4.m4.1.1" xref="S2.SS1.p1.4.m4.1.1.cmml"><mi id="S2.SS1.p1.4.m4.1.1.2" xref="S2.SS1.p1.4.m4.1.1.2.cmml">x</mi><mi id="S2.SS1.p1.4.m4.1.1.3" xref="S2.SS1.p1.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.4.m4.1b"><apply id="S2.SS1.p1.4.m4.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.4.m4.1.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S2.SS1.p1.4.m4.1.1.2.cmml" xref="S2.SS1.p1.4.m4.1.1.2">𝑥</ci><ci id="S2.SS1.p1.4.m4.1.1.3.cmml" xref="S2.SS1.p1.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.4.m4.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.4.m4.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. Differently from the standard language modeling objective, we not only use the current context to make next-token predictions, but also utilize external retrieval to obtain relevant information and perform knowledge fusion at the upper layers of the model.
Specifically, given a sequence consisting of <math alttext="l" class="ltx_Math" display="inline" id="S2.SS1.p1.5.m5.1"><semantics id="S2.SS1.p1.5.m5.1a"><mi id="S2.SS1.p1.5.m5.1.1" xref="S2.SS1.p1.5.m5.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.5.m5.1b"><ci id="S2.SS1.p1.5.m5.1.1.cmml" xref="S2.SS1.p1.5.m5.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.5.m5.1c">l</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.5.m5.1d">italic_l</annotation></semantics></math> tokens and the size of each chunk <math alttext="\tau" class="ltx_Math" display="inline" id="S2.SS1.p1.6.m6.1"><semantics id="S2.SS1.p1.6.m6.1a"><mi id="S2.SS1.p1.6.m6.1.1" xref="S2.SS1.p1.6.m6.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.6.m6.1b"><ci id="S2.SS1.p1.6.m6.1.1.cmml" xref="S2.SS1.p1.6.m6.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.6.m6.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.6.m6.1d">italic_τ</annotation></semantics></math>, we partition it into a long sequence of <math alttext="\nu=\frac{l}{\tau}" class="ltx_Math" display="inline" id="S2.SS1.p1.7.m7.1"><semantics id="S2.SS1.p1.7.m7.1a"><mrow id="S2.SS1.p1.7.m7.1.1" xref="S2.SS1.p1.7.m7.1.1.cmml"><mi id="S2.SS1.p1.7.m7.1.1.2" xref="S2.SS1.p1.7.m7.1.1.2.cmml">ν</mi><mo id="S2.SS1.p1.7.m7.1.1.1" xref="S2.SS1.p1.7.m7.1.1.1.cmml">=</mo><mfrac id="S2.SS1.p1.7.m7.1.1.3" xref="S2.SS1.p1.7.m7.1.1.3.cmml"><mi id="S2.SS1.p1.7.m7.1.1.3.2" xref="S2.SS1.p1.7.m7.1.1.3.2.cmml">l</mi><mi id="S2.SS1.p1.7.m7.1.1.3.3" xref="S2.SS1.p1.7.m7.1.1.3.3.cmml">τ</mi></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.7.m7.1b"><apply id="S2.SS1.p1.7.m7.1.1.cmml" xref="S2.SS1.p1.7.m7.1.1"><eq id="S2.SS1.p1.7.m7.1.1.1.cmml" xref="S2.SS1.p1.7.m7.1.1.1"></eq><ci id="S2.SS1.p1.7.m7.1.1.2.cmml" xref="S2.SS1.p1.7.m7.1.1.2">𝜈</ci><apply id="S2.SS1.p1.7.m7.1.1.3.cmml" xref="S2.SS1.p1.7.m7.1.1.3"><divide id="S2.SS1.p1.7.m7.1.1.3.1.cmml" xref="S2.SS1.p1.7.m7.1.1.3"></divide><ci id="S2.SS1.p1.7.m7.1.1.3.2.cmml" xref="S2.SS1.p1.7.m7.1.1.3.2">𝑙</ci><ci id="S2.SS1.p1.7.m7.1.1.3.3.cmml" xref="S2.SS1.p1.7.m7.1.1.3.3">𝜏</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.7.m7.1c">\nu=\frac{l}{\tau}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.7.m7.1d">italic_ν = divide start_ARG italic_l end_ARG start_ARG italic_τ end_ARG</annotation></semantics></math> non-overlapping chunks , which denoted as <math alttext="\mathcal{C}=(c_{1},\dots,c_{\nu})" class="ltx_Math" display="inline" id="S2.SS1.p1.8.m8.3"><semantics id="S2.SS1.p1.8.m8.3a"><mrow id="S2.SS1.p1.8.m8.3.3" xref="S2.SS1.p1.8.m8.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS1.p1.8.m8.3.3.4" xref="S2.SS1.p1.8.m8.3.3.4.cmml">𝒞</mi><mo id="S2.SS1.p1.8.m8.3.3.3" xref="S2.SS1.p1.8.m8.3.3.3.cmml">=</mo><mrow id="S2.SS1.p1.8.m8.3.3.2.2" xref="S2.SS1.p1.8.m8.3.3.2.3.cmml"><mo id="S2.SS1.p1.8.m8.3.3.2.2.3" stretchy="false" xref="S2.SS1.p1.8.m8.3.3.2.3.cmml">(</mo><msub id="S2.SS1.p1.8.m8.2.2.1.1.1" xref="S2.SS1.p1.8.m8.2.2.1.1.1.cmml"><mi id="S2.SS1.p1.8.m8.2.2.1.1.1.2" xref="S2.SS1.p1.8.m8.2.2.1.1.1.2.cmml">c</mi><mn id="S2.SS1.p1.8.m8.2.2.1.1.1.3" xref="S2.SS1.p1.8.m8.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS1.p1.8.m8.3.3.2.2.4" xref="S2.SS1.p1.8.m8.3.3.2.3.cmml">,</mo><mi id="S2.SS1.p1.8.m8.1.1" mathvariant="normal" xref="S2.SS1.p1.8.m8.1.1.cmml">…</mi><mo id="S2.SS1.p1.8.m8.3.3.2.2.5" xref="S2.SS1.p1.8.m8.3.3.2.3.cmml">,</mo><msub id="S2.SS1.p1.8.m8.3.3.2.2.2" xref="S2.SS1.p1.8.m8.3.3.2.2.2.cmml"><mi id="S2.SS1.p1.8.m8.3.3.2.2.2.2" xref="S2.SS1.p1.8.m8.3.3.2.2.2.2.cmml">c</mi><mi id="S2.SS1.p1.8.m8.3.3.2.2.2.3" xref="S2.SS1.p1.8.m8.3.3.2.2.2.3.cmml">ν</mi></msub><mo id="S2.SS1.p1.8.m8.3.3.2.2.6" stretchy="false" xref="S2.SS1.p1.8.m8.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.8.m8.3b"><apply id="S2.SS1.p1.8.m8.3.3.cmml" xref="S2.SS1.p1.8.m8.3.3"><eq id="S2.SS1.p1.8.m8.3.3.3.cmml" xref="S2.SS1.p1.8.m8.3.3.3"></eq><ci id="S2.SS1.p1.8.m8.3.3.4.cmml" xref="S2.SS1.p1.8.m8.3.3.4">𝒞</ci><vector id="S2.SS1.p1.8.m8.3.3.2.3.cmml" xref="S2.SS1.p1.8.m8.3.3.2.2"><apply id="S2.SS1.p1.8.m8.2.2.1.1.1.cmml" xref="S2.SS1.p1.8.m8.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.8.m8.2.2.1.1.1.1.cmml" xref="S2.SS1.p1.8.m8.2.2.1.1.1">subscript</csymbol><ci id="S2.SS1.p1.8.m8.2.2.1.1.1.2.cmml" xref="S2.SS1.p1.8.m8.2.2.1.1.1.2">𝑐</ci><cn id="S2.SS1.p1.8.m8.2.2.1.1.1.3.cmml" type="integer" xref="S2.SS1.p1.8.m8.2.2.1.1.1.3">1</cn></apply><ci id="S2.SS1.p1.8.m8.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1">…</ci><apply id="S2.SS1.p1.8.m8.3.3.2.2.2.cmml" xref="S2.SS1.p1.8.m8.3.3.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.p1.8.m8.3.3.2.2.2.1.cmml" xref="S2.SS1.p1.8.m8.3.3.2.2.2">subscript</csymbol><ci id="S2.SS1.p1.8.m8.3.3.2.2.2.2.cmml" xref="S2.SS1.p1.8.m8.3.3.2.2.2.2">𝑐</ci><ci id="S2.SS1.p1.8.m8.3.3.2.2.2.3.cmml" xref="S2.SS1.p1.8.m8.3.3.2.2.2.3">𝜈</ci></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.8.m8.3c">\mathcal{C}=(c_{1},\dots,c_{\nu})</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.8.m8.3d">caligraphic_C = ( italic_c start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_c start_POSTSUBSCRIPT italic_ν end_POSTSUBSCRIPT )</annotation></semantics></math>. Correspondingly, its textual form is divided into <math alttext="\nu" class="ltx_Math" display="inline" id="S2.SS1.p1.9.m9.1"><semantics id="S2.SS1.p1.9.m9.1a"><mi id="S2.SS1.p1.9.m9.1.1" xref="S2.SS1.p1.9.m9.1.1.cmml">ν</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.9.m9.1b"><ci id="S2.SS1.p1.9.m9.1.1.cmml" xref="S2.SS1.p1.9.m9.1.1">𝜈</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.9.m9.1c">\nu</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.9.m9.1d">italic_ν</annotation></semantics></math> text chunks, which denoted as <math alttext="\mathcal{T}=(t_{1},\dots,t_{\nu})" class="ltx_Math" display="inline" id="S2.SS1.p1.10.m10.3"><semantics id="S2.SS1.p1.10.m10.3a"><mrow id="S2.SS1.p1.10.m10.3.3" xref="S2.SS1.p1.10.m10.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS1.p1.10.m10.3.3.4" xref="S2.SS1.p1.10.m10.3.3.4.cmml">𝒯</mi><mo id="S2.SS1.p1.10.m10.3.3.3" xref="S2.SS1.p1.10.m10.3.3.3.cmml">=</mo><mrow id="S2.SS1.p1.10.m10.3.3.2.2" xref="S2.SS1.p1.10.m10.3.3.2.3.cmml"><mo id="S2.SS1.p1.10.m10.3.3.2.2.3" stretchy="false" xref="S2.SS1.p1.10.m10.3.3.2.3.cmml">(</mo><msub id="S2.SS1.p1.10.m10.2.2.1.1.1" xref="S2.SS1.p1.10.m10.2.2.1.1.1.cmml"><mi id="S2.SS1.p1.10.m10.2.2.1.1.1.2" xref="S2.SS1.p1.10.m10.2.2.1.1.1.2.cmml">t</mi><mn id="S2.SS1.p1.10.m10.2.2.1.1.1.3" xref="S2.SS1.p1.10.m10.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS1.p1.10.m10.3.3.2.2.4" xref="S2.SS1.p1.10.m10.3.3.2.3.cmml">,</mo><mi id="S2.SS1.p1.10.m10.1.1" mathvariant="normal" xref="S2.SS1.p1.10.m10.1.1.cmml">…</mi><mo id="S2.SS1.p1.10.m10.3.3.2.2.5" xref="S2.SS1.p1.10.m10.3.3.2.3.cmml">,</mo><msub id="S2.SS1.p1.10.m10.3.3.2.2.2" xref="S2.SS1.p1.10.m10.3.3.2.2.2.cmml"><mi id="S2.SS1.p1.10.m10.3.3.2.2.2.2" xref="S2.SS1.p1.10.m10.3.3.2.2.2.2.cmml">t</mi><mi id="S2.SS1.p1.10.m10.3.3.2.2.2.3" xref="S2.SS1.p1.10.m10.3.3.2.2.2.3.cmml">ν</mi></msub><mo id="S2.SS1.p1.10.m10.3.3.2.2.6" stretchy="false" xref="S2.SS1.p1.10.m10.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.10.m10.3b"><apply id="S2.SS1.p1.10.m10.3.3.cmml" xref="S2.SS1.p1.10.m10.3.3"><eq id="S2.SS1.p1.10.m10.3.3.3.cmml" xref="S2.SS1.p1.10.m10.3.3.3"></eq><ci id="S2.SS1.p1.10.m10.3.3.4.cmml" xref="S2.SS1.p1.10.m10.3.3.4">𝒯</ci><vector id="S2.SS1.p1.10.m10.3.3.2.3.cmml" xref="S2.SS1.p1.10.m10.3.3.2.2"><apply id="S2.SS1.p1.10.m10.2.2.1.1.1.cmml" xref="S2.SS1.p1.10.m10.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.10.m10.2.2.1.1.1.1.cmml" xref="S2.SS1.p1.10.m10.2.2.1.1.1">subscript</csymbol><ci id="S2.SS1.p1.10.m10.2.2.1.1.1.2.cmml" xref="S2.SS1.p1.10.m10.2.2.1.1.1.2">𝑡</ci><cn id="S2.SS1.p1.10.m10.2.2.1.1.1.3.cmml" type="integer" xref="S2.SS1.p1.10.m10.2.2.1.1.1.3">1</cn></apply><ci id="S2.SS1.p1.10.m10.1.1.cmml" xref="S2.SS1.p1.10.m10.1.1">…</ci><apply id="S2.SS1.p1.10.m10.3.3.2.2.2.cmml" xref="S2.SS1.p1.10.m10.3.3.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.p1.10.m10.3.3.2.2.2.1.cmml" xref="S2.SS1.p1.10.m10.3.3.2.2.2">subscript</csymbol><ci id="S2.SS1.p1.10.m10.3.3.2.2.2.2.cmml" xref="S2.SS1.p1.10.m10.3.3.2.2.2.2">𝑡</ci><ci id="S2.SS1.p1.10.m10.3.3.2.2.2.3.cmml" xref="S2.SS1.p1.10.m10.3.3.2.2.2.3">𝜈</ci></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.10.m10.3c">\mathcal{T}=(t_{1},\dots,t_{\nu})</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.10.m10.3d">caligraphic_T = ( italic_t start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_t start_POSTSUBSCRIPT italic_ν end_POSTSUBSCRIPT )</annotation></semantics></math>.
In each step, we perform causal language modeling on <math alttext="c_{i}" class="ltx_Math" display="inline" id="S2.SS1.p1.11.m11.1"><semantics id="S2.SS1.p1.11.m11.1a"><msub id="S2.SS1.p1.11.m11.1.1" xref="S2.SS1.p1.11.m11.1.1.cmml"><mi id="S2.SS1.p1.11.m11.1.1.2" xref="S2.SS1.p1.11.m11.1.1.2.cmml">c</mi><mi id="S2.SS1.p1.11.m11.1.1.3" xref="S2.SS1.p1.11.m11.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.11.m11.1b"><apply id="S2.SS1.p1.11.m11.1.1.cmml" xref="S2.SS1.p1.11.m11.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.11.m11.1.1.1.cmml" xref="S2.SS1.p1.11.m11.1.1">subscript</csymbol><ci id="S2.SS1.p1.11.m11.1.1.2.cmml" xref="S2.SS1.p1.11.m11.1.1.2">𝑐</ci><ci id="S2.SS1.p1.11.m11.1.1.3.cmml" xref="S2.SS1.p1.11.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.11.m11.1c">c_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.11.m11.1d">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> in the <span class="ltx_text ltx_font_italic" id="S2.SS1.p1.12.1">lower layers</span>, while in the <span class="ltx_text ltx_font_italic" id="S2.SS1.p1.12.2">upper layers</span>, we conduct fine-grained controllable retrieval on <math alttext="t_{i}" class="ltx_Math" display="inline" id="S2.SS1.p1.12.m12.1"><semantics id="S2.SS1.p1.12.m12.1a"><msub id="S2.SS1.p1.12.m12.1.1" xref="S2.SS1.p1.12.m12.1.1.cmml"><mi id="S2.SS1.p1.12.m12.1.1.2" xref="S2.SS1.p1.12.m12.1.1.2.cmml">t</mi><mi id="S2.SS1.p1.12.m12.1.1.3" xref="S2.SS1.p1.12.m12.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.12.m12.1b"><apply id="S2.SS1.p1.12.m12.1.1.cmml" xref="S2.SS1.p1.12.m12.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.12.m12.1.1.1.cmml" xref="S2.SS1.p1.12.m12.1.1">subscript</csymbol><ci id="S2.SS1.p1.12.m12.1.1.2.cmml" xref="S2.SS1.p1.12.m12.1.1.2">𝑡</ci><ci id="S2.SS1.p1.12.m12.1.1.3.cmml" xref="S2.SS1.p1.12.m12.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.12.m12.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.12.m12.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> for the fusion of additional information.
After do this, our language modeling objective becomes</p>
<table class="ltx_equationgroup ltx_eqn_gather ltx_eqn_table" id="A1.EGx1">
<tbody id="S2.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\displaystyle p(x_{1},\dots,x_{n})=\sum_{i=0}^{n}{p_{\theta}{(x_{i}|\mathcal{R%
}(t_{i}),x_{&lt;i})}}" class="ltx_Math" display="block" id="S2.E1.m1.4"><semantics id="S2.E1.m1.4a"><mrow id="S2.E1.m1.4.4" xref="S2.E1.m1.4.4.cmml"><mrow id="S2.E1.m1.3.3.2" xref="S2.E1.m1.3.3.2.cmml"><mi id="S2.E1.m1.3.3.2.4" xref="S2.E1.m1.3.3.2.4.cmml">p</mi><mo id="S2.E1.m1.3.3.2.3" xref="S2.E1.m1.3.3.2.3.cmml">⁢</mo><mrow id="S2.E1.m1.3.3.2.2.2" xref="S2.E1.m1.3.3.2.2.3.cmml"><mo id="S2.E1.m1.3.3.2.2.2.3" stretchy="false" xref="S2.E1.m1.3.3.2.2.3.cmml">(</mo><msub id="S2.E1.m1.2.2.1.1.1.1" xref="S2.E1.m1.2.2.1.1.1.1.cmml"><mi id="S2.E1.m1.2.2.1.1.1.1.2" xref="S2.E1.m1.2.2.1.1.1.1.2.cmml">x</mi><mn id="S2.E1.m1.2.2.1.1.1.1.3" xref="S2.E1.m1.2.2.1.1.1.1.3.cmml">1</mn></msub><mo id="S2.E1.m1.3.3.2.2.2.4" xref="S2.E1.m1.3.3.2.2.3.cmml">,</mo><mi id="S2.E1.m1.1.1" mathvariant="normal" xref="S2.E1.m1.1.1.cmml">…</mi><mo id="S2.E1.m1.3.3.2.2.2.5" xref="S2.E1.m1.3.3.2.2.3.cmml">,</mo><msub id="S2.E1.m1.3.3.2.2.2.2" xref="S2.E1.m1.3.3.2.2.2.2.cmml"><mi id="S2.E1.m1.3.3.2.2.2.2.2" xref="S2.E1.m1.3.3.2.2.2.2.2.cmml">x</mi><mi id="S2.E1.m1.3.3.2.2.2.2.3" xref="S2.E1.m1.3.3.2.2.2.2.3.cmml">n</mi></msub><mo id="S2.E1.m1.3.3.2.2.2.6" stretchy="false" xref="S2.E1.m1.3.3.2.2.3.cmml">)</mo></mrow></mrow><mo id="S2.E1.m1.4.4.4" rspace="0.111em" xref="S2.E1.m1.4.4.4.cmml">=</mo><mrow id="S2.E1.m1.4.4.3" xref="S2.E1.m1.4.4.3.cmml"><munderover id="S2.E1.m1.4.4.3.2" xref="S2.E1.m1.4.4.3.2.cmml"><mo id="S2.E1.m1.4.4.3.2.2.2" movablelimits="false" xref="S2.E1.m1.4.4.3.2.2.2.cmml">∑</mo><mrow id="S2.E1.m1.4.4.3.2.2.3" xref="S2.E1.m1.4.4.3.2.2.3.cmml"><mi id="S2.E1.m1.4.4.3.2.2.3.2" xref="S2.E1.m1.4.4.3.2.2.3.2.cmml">i</mi><mo id="S2.E1.m1.4.4.3.2.2.3.1" xref="S2.E1.m1.4.4.3.2.2.3.1.cmml">=</mo><mn id="S2.E1.m1.4.4.3.2.2.3.3" xref="S2.E1.m1.4.4.3.2.2.3.3.cmml">0</mn></mrow><mi id="S2.E1.m1.4.4.3.2.3" xref="S2.E1.m1.4.4.3.2.3.cmml">n</mi></munderover><mrow id="S2.E1.m1.4.4.3.1" xref="S2.E1.m1.4.4.3.1.cmml"><msub id="S2.E1.m1.4.4.3.1.3" xref="S2.E1.m1.4.4.3.1.3.cmml"><mi id="S2.E1.m1.4.4.3.1.3.2" xref="S2.E1.m1.4.4.3.1.3.2.cmml">p</mi><mi id="S2.E1.m1.4.4.3.1.3.3" xref="S2.E1.m1.4.4.3.1.3.3.cmml">θ</mi></msub><mo id="S2.E1.m1.4.4.3.1.2" xref="S2.E1.m1.4.4.3.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.4.4.3.1.1.1" xref="S2.E1.m1.4.4.3.1.1.1.1.cmml"><mo id="S2.E1.m1.4.4.3.1.1.1.2" stretchy="false" xref="S2.E1.m1.4.4.3.1.1.1.1.cmml">(</mo><mrow id="S2.E1.m1.4.4.3.1.1.1.1" xref="S2.E1.m1.4.4.3.1.1.1.1.cmml"><msub id="S2.E1.m1.4.4.3.1.1.1.1.4" xref="S2.E1.m1.4.4.3.1.1.1.1.4.cmml"><mi id="S2.E1.m1.4.4.3.1.1.1.1.4.2" xref="S2.E1.m1.4.4.3.1.1.1.1.4.2.cmml">x</mi><mi id="S2.E1.m1.4.4.3.1.1.1.1.4.3" xref="S2.E1.m1.4.4.3.1.1.1.1.4.3.cmml">i</mi></msub><mo fence="false" id="S2.E1.m1.4.4.3.1.1.1.1.3" xref="S2.E1.m1.4.4.3.1.1.1.1.3.cmml">|</mo><mrow id="S2.E1.m1.4.4.3.1.1.1.1.2.2" xref="S2.E1.m1.4.4.3.1.1.1.1.2.3.cmml"><mrow id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.3" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.3.cmml">ℛ</mi><mo id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.2" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.2" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.2.cmml">t</mi><mi id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.3" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E1.m1.4.4.3.1.1.1.1.2.2.3" xref="S2.E1.m1.4.4.3.1.1.1.1.2.3.cmml">,</mo><msub id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.cmml"><mi id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.2" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.2.cmml">x</mi><mrow id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.cmml"><mi id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.2" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.2.cmml"></mi><mo id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.1" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.1.cmml">&lt;</mo><mi id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.3" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.3.cmml">i</mi></mrow></msub></mrow></mrow><mo id="S2.E1.m1.4.4.3.1.1.1.3" stretchy="false" xref="S2.E1.m1.4.4.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m1.4b"><apply id="S2.E1.m1.4.4.cmml" xref="S2.E1.m1.4.4"><eq id="S2.E1.m1.4.4.4.cmml" xref="S2.E1.m1.4.4.4"></eq><apply id="S2.E1.m1.3.3.2.cmml" xref="S2.E1.m1.3.3.2"><times id="S2.E1.m1.3.3.2.3.cmml" xref="S2.E1.m1.3.3.2.3"></times><ci id="S2.E1.m1.3.3.2.4.cmml" xref="S2.E1.m1.3.3.2.4">𝑝</ci><vector id="S2.E1.m1.3.3.2.2.3.cmml" xref="S2.E1.m1.3.3.2.2.2"><apply id="S2.E1.m1.2.2.1.1.1.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.2.2.1.1.1.1.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S2.E1.m1.2.2.1.1.1.1.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.2">𝑥</ci><cn id="S2.E1.m1.2.2.1.1.1.1.3.cmml" type="integer" xref="S2.E1.m1.2.2.1.1.1.1.3">1</cn></apply><ci id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1">…</ci><apply id="S2.E1.m1.3.3.2.2.2.2.cmml" xref="S2.E1.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S2.E1.m1.3.3.2.2.2.2.1.cmml" xref="S2.E1.m1.3.3.2.2.2.2">subscript</csymbol><ci id="S2.E1.m1.3.3.2.2.2.2.2.cmml" xref="S2.E1.m1.3.3.2.2.2.2.2">𝑥</ci><ci id="S2.E1.m1.3.3.2.2.2.2.3.cmml" xref="S2.E1.m1.3.3.2.2.2.2.3">𝑛</ci></apply></vector></apply><apply id="S2.E1.m1.4.4.3.cmml" xref="S2.E1.m1.4.4.3"><apply id="S2.E1.m1.4.4.3.2.cmml" xref="S2.E1.m1.4.4.3.2"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.2.1.cmml" xref="S2.E1.m1.4.4.3.2">superscript</csymbol><apply id="S2.E1.m1.4.4.3.2.2.cmml" xref="S2.E1.m1.4.4.3.2"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.2.2.1.cmml" xref="S2.E1.m1.4.4.3.2">subscript</csymbol><sum id="S2.E1.m1.4.4.3.2.2.2.cmml" xref="S2.E1.m1.4.4.3.2.2.2"></sum><apply id="S2.E1.m1.4.4.3.2.2.3.cmml" xref="S2.E1.m1.4.4.3.2.2.3"><eq id="S2.E1.m1.4.4.3.2.2.3.1.cmml" xref="S2.E1.m1.4.4.3.2.2.3.1"></eq><ci id="S2.E1.m1.4.4.3.2.2.3.2.cmml" xref="S2.E1.m1.4.4.3.2.2.3.2">𝑖</ci><cn id="S2.E1.m1.4.4.3.2.2.3.3.cmml" type="integer" xref="S2.E1.m1.4.4.3.2.2.3.3">0</cn></apply></apply><ci id="S2.E1.m1.4.4.3.2.3.cmml" xref="S2.E1.m1.4.4.3.2.3">𝑛</ci></apply><apply id="S2.E1.m1.4.4.3.1.cmml" xref="S2.E1.m1.4.4.3.1"><times id="S2.E1.m1.4.4.3.1.2.cmml" xref="S2.E1.m1.4.4.3.1.2"></times><apply id="S2.E1.m1.4.4.3.1.3.cmml" xref="S2.E1.m1.4.4.3.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.1.3.1.cmml" xref="S2.E1.m1.4.4.3.1.3">subscript</csymbol><ci id="S2.E1.m1.4.4.3.1.3.2.cmml" xref="S2.E1.m1.4.4.3.1.3.2">𝑝</ci><ci id="S2.E1.m1.4.4.3.1.3.3.cmml" xref="S2.E1.m1.4.4.3.1.3.3">𝜃</ci></apply><apply id="S2.E1.m1.4.4.3.1.1.1.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1"><csymbol cd="latexml" id="S2.E1.m1.4.4.3.1.1.1.1.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.3">conditional</csymbol><apply id="S2.E1.m1.4.4.3.1.1.1.1.4.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.1.1.1.1.4.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.4">subscript</csymbol><ci id="S2.E1.m1.4.4.3.1.1.1.1.4.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.4.2">𝑥</ci><ci id="S2.E1.m1.4.4.3.1.1.1.1.4.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.4.3">𝑖</ci></apply><list id="S2.E1.m1.4.4.3.1.1.1.1.2.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2"><apply id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1"><times id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.2"></times><ci id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.3">ℛ</ci><apply id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.2">𝑡</ci><ci id="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><apply id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.2">𝑥</ci><apply id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3"><lt id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.1.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.1"></lt><csymbol cd="latexml" id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.2.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.2">absent</csymbol><ci id="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.3.cmml" xref="S2.E1.m1.4.4.3.1.1.1.1.2.2.2.3.3">𝑖</ci></apply></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.4c">\displaystyle p(x_{1},\dots,x_{n})=\sum_{i=0}^{n}{p_{\theta}{(x_{i}|\mathcal{R%
}(t_{i}),x_{&lt;i})}}</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.4d">italic_p ( italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_i = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT italic_p start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | caligraphic_R ( italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) , italic_x start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.p1.15">where <math alttext="\mathcal{R}(t_{i})" class="ltx_Math" display="inline" id="S2.SS1.p1.13.m1.1"><semantics id="S2.SS1.p1.13.m1.1a"><mrow id="S2.SS1.p1.13.m1.1.1" xref="S2.SS1.p1.13.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS1.p1.13.m1.1.1.3" xref="S2.SS1.p1.13.m1.1.1.3.cmml">ℛ</mi><mo id="S2.SS1.p1.13.m1.1.1.2" xref="S2.SS1.p1.13.m1.1.1.2.cmml">⁢</mo><mrow id="S2.SS1.p1.13.m1.1.1.1.1" xref="S2.SS1.p1.13.m1.1.1.1.1.1.cmml"><mo id="S2.SS1.p1.13.m1.1.1.1.1.2" stretchy="false" xref="S2.SS1.p1.13.m1.1.1.1.1.1.cmml">(</mo><msub id="S2.SS1.p1.13.m1.1.1.1.1.1" xref="S2.SS1.p1.13.m1.1.1.1.1.1.cmml"><mi id="S2.SS1.p1.13.m1.1.1.1.1.1.2" xref="S2.SS1.p1.13.m1.1.1.1.1.1.2.cmml">t</mi><mi id="S2.SS1.p1.13.m1.1.1.1.1.1.3" xref="S2.SS1.p1.13.m1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.SS1.p1.13.m1.1.1.1.1.3" stretchy="false" xref="S2.SS1.p1.13.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.13.m1.1b"><apply id="S2.SS1.p1.13.m1.1.1.cmml" xref="S2.SS1.p1.13.m1.1.1"><times id="S2.SS1.p1.13.m1.1.1.2.cmml" xref="S2.SS1.p1.13.m1.1.1.2"></times><ci id="S2.SS1.p1.13.m1.1.1.3.cmml" xref="S2.SS1.p1.13.m1.1.1.3">ℛ</ci><apply id="S2.SS1.p1.13.m1.1.1.1.1.1.cmml" xref="S2.SS1.p1.13.m1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.13.m1.1.1.1.1.1.1.cmml" xref="S2.SS1.p1.13.m1.1.1.1.1">subscript</csymbol><ci id="S2.SS1.p1.13.m1.1.1.1.1.1.2.cmml" xref="S2.SS1.p1.13.m1.1.1.1.1.1.2">𝑡</ci><ci id="S2.SS1.p1.13.m1.1.1.1.1.1.3.cmml" xref="S2.SS1.p1.13.m1.1.1.1.1.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.13.m1.1c">\mathcal{R}(t_{i})</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.13.m1.1d">caligraphic_R ( italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> denotes the retrieval of <span class="ltx_text ltx_font_italic" id="S2.SS1.p1.15.1">neighboring chunks</span> of <math alttext="t_{i}" class="ltx_Math" display="inline" id="S2.SS1.p1.14.m2.1"><semantics id="S2.SS1.p1.14.m2.1a"><msub id="S2.SS1.p1.14.m2.1.1" xref="S2.SS1.p1.14.m2.1.1.cmml"><mi id="S2.SS1.p1.14.m2.1.1.2" xref="S2.SS1.p1.14.m2.1.1.2.cmml">t</mi><mi id="S2.SS1.p1.14.m2.1.1.3" xref="S2.SS1.p1.14.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.14.m2.1b"><apply id="S2.SS1.p1.14.m2.1.1.cmml" xref="S2.SS1.p1.14.m2.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.14.m2.1.1.1.cmml" xref="S2.SS1.p1.14.m2.1.1">subscript</csymbol><ci id="S2.SS1.p1.14.m2.1.1.2.cmml" xref="S2.SS1.p1.14.m2.1.1.2">𝑡</ci><ci id="S2.SS1.p1.14.m2.1.1.3.cmml" xref="S2.SS1.p1.14.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.14.m2.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.14.m2.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> where <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.SS1.p1.15.m3.1"><semantics id="S2.SS1.p1.15.m3.1a"><msub id="S2.SS1.p1.15.m3.1.1" xref="S2.SS1.p1.15.m3.1.1.cmml"><mi id="S2.SS1.p1.15.m3.1.1.2" xref="S2.SS1.p1.15.m3.1.1.2.cmml">x</mi><mi id="S2.SS1.p1.15.m3.1.1.3" xref="S2.SS1.p1.15.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.15.m3.1b"><apply id="S2.SS1.p1.15.m3.1.1.cmml" xref="S2.SS1.p1.15.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.15.m3.1.1.1.cmml" xref="S2.SS1.p1.15.m3.1.1">subscript</csymbol><ci id="S2.SS1.p1.15.m3.1.1.2.cmml" xref="S2.SS1.p1.15.m3.1.1.2">𝑥</ci><ci id="S2.SS1.p1.15.m3.1.1.3.cmml" xref="S2.SS1.p1.15.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.15.m3.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.15.m3.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is located.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Module and Operation Definitions</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.10">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2.F2" title="Figure 2 ‣ 2 Preliminary ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">2</span></a>, the <span class="ltx_text ltx_font_italic" id="S2.SS2.p1.10.1">Ret-Mem</span> module comprises a <span class="ltx_text ltx_font_italic" id="S2.SS2.p1.10.2">Retriever</span> and a <span class="ltx_text ltx_font_italic" id="S2.SS2.p1.10.3">Memory</span> component for information exchange.
Initially, we define the Memory component as <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S2.SS2.p1.1.m1.1"><semantics id="S2.SS2.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p1.1.m1.1.1" xref="S2.SS2.p1.1.m1.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.1.m1.1b"><ci id="S2.SS2.p1.1.m1.1.1.cmml" xref="S2.SS2.p1.1.m1.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.1.m1.1d">caligraphic_M</annotation></semantics></math> and the Retriever as <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S2.SS2.p1.2.m2.1"><semantics id="S2.SS2.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p1.2.m2.1.1" xref="S2.SS2.p1.2.m2.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.2.m2.1b"><ci id="S2.SS2.p1.2.m2.1.1.cmml" xref="S2.SS2.p1.2.m2.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.2.m2.1c">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.2.m2.1d">caligraphic_R</annotation></semantics></math>, and their corresponding operations <math alttext="\mathcal{M}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.p1.3.m3.1"><semantics id="S2.SS2.p1.3.m3.1a"><mrow id="S2.SS2.p1.3.m3.1.2" xref="S2.SS2.p1.3.m3.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p1.3.m3.1.2.2" xref="S2.SS2.p1.3.m3.1.2.2.cmml">ℳ</mi><mo id="S2.SS2.p1.3.m3.1.2.1" xref="S2.SS2.p1.3.m3.1.2.1.cmml">⁢</mo><mrow id="S2.SS2.p1.3.m3.1.2.3.2" xref="S2.SS2.p1.3.m3.1.2.cmml"><mo id="S2.SS2.p1.3.m3.1.2.3.2.1" stretchy="false" xref="S2.SS2.p1.3.m3.1.2.cmml">(</mo><mo id="S2.SS2.p1.3.m3.1.1" lspace="0em" rspace="0em" xref="S2.SS2.p1.3.m3.1.1.cmml">⋅</mo><mo id="S2.SS2.p1.3.m3.1.2.3.2.2" stretchy="false" xref="S2.SS2.p1.3.m3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.3.m3.1b"><apply id="S2.SS2.p1.3.m3.1.2.cmml" xref="S2.SS2.p1.3.m3.1.2"><times id="S2.SS2.p1.3.m3.1.2.1.cmml" xref="S2.SS2.p1.3.m3.1.2.1"></times><ci id="S2.SS2.p1.3.m3.1.2.2.cmml" xref="S2.SS2.p1.3.m3.1.2.2">ℳ</ci><ci id="S2.SS2.p1.3.m3.1.1.cmml" xref="S2.SS2.p1.3.m3.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.3.m3.1c">\mathcal{M}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.3.m3.1d">caligraphic_M ( ⋅ )</annotation></semantics></math> and <math alttext="\mathcal{R}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.p1.4.m4.1"><semantics id="S2.SS2.p1.4.m4.1a"><mrow id="S2.SS2.p1.4.m4.1.2" xref="S2.SS2.p1.4.m4.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p1.4.m4.1.2.2" xref="S2.SS2.p1.4.m4.1.2.2.cmml">ℛ</mi><mo id="S2.SS2.p1.4.m4.1.2.1" xref="S2.SS2.p1.4.m4.1.2.1.cmml">⁢</mo><mrow id="S2.SS2.p1.4.m4.1.2.3.2" xref="S2.SS2.p1.4.m4.1.2.cmml"><mo id="S2.SS2.p1.4.m4.1.2.3.2.1" stretchy="false" xref="S2.SS2.p1.4.m4.1.2.cmml">(</mo><mo id="S2.SS2.p1.4.m4.1.1" lspace="0em" rspace="0em" xref="S2.SS2.p1.4.m4.1.1.cmml">⋅</mo><mo id="S2.SS2.p1.4.m4.1.2.3.2.2" stretchy="false" xref="S2.SS2.p1.4.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.4.m4.1b"><apply id="S2.SS2.p1.4.m4.1.2.cmml" xref="S2.SS2.p1.4.m4.1.2"><times id="S2.SS2.p1.4.m4.1.2.1.cmml" xref="S2.SS2.p1.4.m4.1.2.1"></times><ci id="S2.SS2.p1.4.m4.1.2.2.cmml" xref="S2.SS2.p1.4.m4.1.2.2">ℛ</ci><ci id="S2.SS2.p1.4.m4.1.1.cmml" xref="S2.SS2.p1.4.m4.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.4.m4.1c">\mathcal{R}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.4.m4.1d">caligraphic_R ( ⋅ )</annotation></semantics></math>. Furthermore, we specify the dimension of the model as <math alttext="d_{model}" class="ltx_Math" display="inline" id="S2.SS2.p1.5.m5.1"><semantics id="S2.SS2.p1.5.m5.1a"><msub id="S2.SS2.p1.5.m5.1.1" xref="S2.SS2.p1.5.m5.1.1.cmml"><mi id="S2.SS2.p1.5.m5.1.1.2" xref="S2.SS2.p1.5.m5.1.1.2.cmml">d</mi><mrow id="S2.SS2.p1.5.m5.1.1.3" xref="S2.SS2.p1.5.m5.1.1.3.cmml"><mi id="S2.SS2.p1.5.m5.1.1.3.2" xref="S2.SS2.p1.5.m5.1.1.3.2.cmml">m</mi><mo id="S2.SS2.p1.5.m5.1.1.3.1" xref="S2.SS2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.5.m5.1.1.3.3" xref="S2.SS2.p1.5.m5.1.1.3.3.cmml">o</mi><mo id="S2.SS2.p1.5.m5.1.1.3.1a" xref="S2.SS2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.5.m5.1.1.3.4" xref="S2.SS2.p1.5.m5.1.1.3.4.cmml">d</mi><mo id="S2.SS2.p1.5.m5.1.1.3.1b" xref="S2.SS2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.5.m5.1.1.3.5" xref="S2.SS2.p1.5.m5.1.1.3.5.cmml">e</mi><mo id="S2.SS2.p1.5.m5.1.1.3.1c" xref="S2.SS2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.5.m5.1.1.3.6" xref="S2.SS2.p1.5.m5.1.1.3.6.cmml">l</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.5.m5.1b"><apply id="S2.SS2.p1.5.m5.1.1.cmml" xref="S2.SS2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.5.m5.1.1.1.cmml" xref="S2.SS2.p1.5.m5.1.1">subscript</csymbol><ci id="S2.SS2.p1.5.m5.1.1.2.cmml" xref="S2.SS2.p1.5.m5.1.1.2">𝑑</ci><apply id="S2.SS2.p1.5.m5.1.1.3.cmml" xref="S2.SS2.p1.5.m5.1.1.3"><times id="S2.SS2.p1.5.m5.1.1.3.1.cmml" xref="S2.SS2.p1.5.m5.1.1.3.1"></times><ci id="S2.SS2.p1.5.m5.1.1.3.2.cmml" xref="S2.SS2.p1.5.m5.1.1.3.2">𝑚</ci><ci id="S2.SS2.p1.5.m5.1.1.3.3.cmml" xref="S2.SS2.p1.5.m5.1.1.3.3">𝑜</ci><ci id="S2.SS2.p1.5.m5.1.1.3.4.cmml" xref="S2.SS2.p1.5.m5.1.1.3.4">𝑑</ci><ci id="S2.SS2.p1.5.m5.1.1.3.5.cmml" xref="S2.SS2.p1.5.m5.1.1.3.5">𝑒</ci><ci id="S2.SS2.p1.5.m5.1.1.3.6.cmml" xref="S2.SS2.p1.5.m5.1.1.3.6">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.5.m5.1c">d_{model}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.5.m5.1d">italic_d start_POSTSUBSCRIPT italic_m italic_o italic_d italic_e italic_l end_POSTSUBSCRIPT</annotation></semantics></math> , the dimension of the retriever as <math alttext="d_{ret}" class="ltx_Math" display="inline" id="S2.SS2.p1.6.m6.1"><semantics id="S2.SS2.p1.6.m6.1a"><msub id="S2.SS2.p1.6.m6.1.1" xref="S2.SS2.p1.6.m6.1.1.cmml"><mi id="S2.SS2.p1.6.m6.1.1.2" xref="S2.SS2.p1.6.m6.1.1.2.cmml">d</mi><mrow id="S2.SS2.p1.6.m6.1.1.3" xref="S2.SS2.p1.6.m6.1.1.3.cmml"><mi id="S2.SS2.p1.6.m6.1.1.3.2" xref="S2.SS2.p1.6.m6.1.1.3.2.cmml">r</mi><mo id="S2.SS2.p1.6.m6.1.1.3.1" xref="S2.SS2.p1.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.6.m6.1.1.3.3" xref="S2.SS2.p1.6.m6.1.1.3.3.cmml">e</mi><mo id="S2.SS2.p1.6.m6.1.1.3.1a" xref="S2.SS2.p1.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.6.m6.1.1.3.4" xref="S2.SS2.p1.6.m6.1.1.3.4.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.6.m6.1b"><apply id="S2.SS2.p1.6.m6.1.1.cmml" xref="S2.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.6.m6.1.1.1.cmml" xref="S2.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S2.SS2.p1.6.m6.1.1.2.cmml" xref="S2.SS2.p1.6.m6.1.1.2">𝑑</ci><apply id="S2.SS2.p1.6.m6.1.1.3.cmml" xref="S2.SS2.p1.6.m6.1.1.3"><times id="S2.SS2.p1.6.m6.1.1.3.1.cmml" xref="S2.SS2.p1.6.m6.1.1.3.1"></times><ci id="S2.SS2.p1.6.m6.1.1.3.2.cmml" xref="S2.SS2.p1.6.m6.1.1.3.2">𝑟</ci><ci id="S2.SS2.p1.6.m6.1.1.3.3.cmml" xref="S2.SS2.p1.6.m6.1.1.3.3">𝑒</ci><ci id="S2.SS2.p1.6.m6.1.1.3.4.cmml" xref="S2.SS2.p1.6.m6.1.1.3.4">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.6.m6.1c">d_{ret}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.6.m6.1d">italic_d start_POSTSUBSCRIPT italic_r italic_e italic_t end_POSTSUBSCRIPT</annotation></semantics></math>.
The <span class="ltx_text ltx_font_italic" id="S2.SS2.p1.10.4">Memory</span> module includes two segments: <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S2.SS2.p1.7.m7.1"><semantics id="S2.SS2.p1.7.m7.1a"><mrow id="S2.SS2.p1.7.m7.1.1" xref="S2.SS2.p1.7.m7.1.1.cmml"><mi id="S2.SS2.p1.7.m7.1.1.2" xref="S2.SS2.p1.7.m7.1.1.2.cmml">𝙺</mi><mo id="S2.SS2.p1.7.m7.1.1.1" xref="S2.SS2.p1.7.m7.1.1.1.cmml">⁢</mo><mtext id="S2.SS2.p1.7.m7.1.1.3" xref="S2.SS2.p1.7.m7.1.1.3a.cmml">-</mtext><mo id="S2.SS2.p1.7.m7.1.1.1a" xref="S2.SS2.p1.7.m7.1.1.1.cmml">⁢</mo><mi id="S2.SS2.p1.7.m7.1.1.4" xref="S2.SS2.p1.7.m7.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.7.m7.1b"><apply id="S2.SS2.p1.7.m7.1.1.cmml" xref="S2.SS2.p1.7.m7.1.1"><times id="S2.SS2.p1.7.m7.1.1.1.cmml" xref="S2.SS2.p1.7.m7.1.1.1"></times><ci id="S2.SS2.p1.7.m7.1.1.2.cmml" xref="S2.SS2.p1.7.m7.1.1.2">𝙺</ci><ci id="S2.SS2.p1.7.m7.1.1.3a.cmml" xref="S2.SS2.p1.7.m7.1.1.3"><mtext id="S2.SS2.p1.7.m7.1.1.3.cmml" xref="S2.SS2.p1.7.m7.1.1.3">-</mtext></ci><ci id="S2.SS2.p1.7.m7.1.1.4.cmml" xref="S2.SS2.p1.7.m7.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.7.m7.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.7.m7.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs and corresponding Representation Embeddings. The dimension for both keys and values is represented as <math alttext="\mathbb{R}^{d_{model}}" class="ltx_Math" display="inline" id="S2.SS2.p1.8.m8.1"><semantics id="S2.SS2.p1.8.m8.1a"><msup id="S2.SS2.p1.8.m8.1.1" xref="S2.SS2.p1.8.m8.1.1.cmml"><mi id="S2.SS2.p1.8.m8.1.1.2" xref="S2.SS2.p1.8.m8.1.1.2.cmml">ℝ</mi><msub id="S2.SS2.p1.8.m8.1.1.3" xref="S2.SS2.p1.8.m8.1.1.3.cmml"><mi id="S2.SS2.p1.8.m8.1.1.3.2" xref="S2.SS2.p1.8.m8.1.1.3.2.cmml">d</mi><mrow id="S2.SS2.p1.8.m8.1.1.3.3" xref="S2.SS2.p1.8.m8.1.1.3.3.cmml"><mi id="S2.SS2.p1.8.m8.1.1.3.3.2" xref="S2.SS2.p1.8.m8.1.1.3.3.2.cmml">m</mi><mo id="S2.SS2.p1.8.m8.1.1.3.3.1" xref="S2.SS2.p1.8.m8.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.8.m8.1.1.3.3.3" xref="S2.SS2.p1.8.m8.1.1.3.3.3.cmml">o</mi><mo id="S2.SS2.p1.8.m8.1.1.3.3.1a" xref="S2.SS2.p1.8.m8.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.8.m8.1.1.3.3.4" xref="S2.SS2.p1.8.m8.1.1.3.3.4.cmml">d</mi><mo id="S2.SS2.p1.8.m8.1.1.3.3.1b" xref="S2.SS2.p1.8.m8.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.8.m8.1.1.3.3.5" xref="S2.SS2.p1.8.m8.1.1.3.3.5.cmml">e</mi><mo id="S2.SS2.p1.8.m8.1.1.3.3.1c" xref="S2.SS2.p1.8.m8.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.8.m8.1.1.3.3.6" xref="S2.SS2.p1.8.m8.1.1.3.3.6.cmml">l</mi></mrow></msub></msup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.8.m8.1b"><apply id="S2.SS2.p1.8.m8.1.1.cmml" xref="S2.SS2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.8.m8.1.1.1.cmml" xref="S2.SS2.p1.8.m8.1.1">superscript</csymbol><ci id="S2.SS2.p1.8.m8.1.1.2.cmml" xref="S2.SS2.p1.8.m8.1.1.2">ℝ</ci><apply id="S2.SS2.p1.8.m8.1.1.3.cmml" xref="S2.SS2.p1.8.m8.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.p1.8.m8.1.1.3.1.cmml" xref="S2.SS2.p1.8.m8.1.1.3">subscript</csymbol><ci id="S2.SS2.p1.8.m8.1.1.3.2.cmml" xref="S2.SS2.p1.8.m8.1.1.3.2">𝑑</ci><apply id="S2.SS2.p1.8.m8.1.1.3.3.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3"><times id="S2.SS2.p1.8.m8.1.1.3.3.1.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.1"></times><ci id="S2.SS2.p1.8.m8.1.1.3.3.2.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.2">𝑚</ci><ci id="S2.SS2.p1.8.m8.1.1.3.3.3.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.3">𝑜</ci><ci id="S2.SS2.p1.8.m8.1.1.3.3.4.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.4">𝑑</ci><ci id="S2.SS2.p1.8.m8.1.1.3.3.5.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.5">𝑒</ci><ci id="S2.SS2.p1.8.m8.1.1.3.3.6.cmml" xref="S2.SS2.p1.8.m8.1.1.3.3.6">𝑙</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.8.m8.1c">\mathbb{R}^{d_{model}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.8.m8.1d">blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_m italic_o italic_d italic_e italic_l end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> and for Embeddings as <math alttext="\mathbb{R}^{d_{ret}}" class="ltx_Math" display="inline" id="S2.SS2.p1.9.m9.1"><semantics id="S2.SS2.p1.9.m9.1a"><msup id="S2.SS2.p1.9.m9.1.1" xref="S2.SS2.p1.9.m9.1.1.cmml"><mi id="S2.SS2.p1.9.m9.1.1.2" xref="S2.SS2.p1.9.m9.1.1.2.cmml">ℝ</mi><msub id="S2.SS2.p1.9.m9.1.1.3" xref="S2.SS2.p1.9.m9.1.1.3.cmml"><mi id="S2.SS2.p1.9.m9.1.1.3.2" xref="S2.SS2.p1.9.m9.1.1.3.2.cmml">d</mi><mrow id="S2.SS2.p1.9.m9.1.1.3.3" xref="S2.SS2.p1.9.m9.1.1.3.3.cmml"><mi id="S2.SS2.p1.9.m9.1.1.3.3.2" xref="S2.SS2.p1.9.m9.1.1.3.3.2.cmml">r</mi><mo id="S2.SS2.p1.9.m9.1.1.3.3.1" xref="S2.SS2.p1.9.m9.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.9.m9.1.1.3.3.3" xref="S2.SS2.p1.9.m9.1.1.3.3.3.cmml">e</mi><mo id="S2.SS2.p1.9.m9.1.1.3.3.1a" xref="S2.SS2.p1.9.m9.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.9.m9.1.1.3.3.4" xref="S2.SS2.p1.9.m9.1.1.3.3.4.cmml">t</mi></mrow></msub></msup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.9.m9.1b"><apply id="S2.SS2.p1.9.m9.1.1.cmml" xref="S2.SS2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.9.m9.1.1.1.cmml" xref="S2.SS2.p1.9.m9.1.1">superscript</csymbol><ci id="S2.SS2.p1.9.m9.1.1.2.cmml" xref="S2.SS2.p1.9.m9.1.1.2">ℝ</ci><apply id="S2.SS2.p1.9.m9.1.1.3.cmml" xref="S2.SS2.p1.9.m9.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.p1.9.m9.1.1.3.1.cmml" xref="S2.SS2.p1.9.m9.1.1.3">subscript</csymbol><ci id="S2.SS2.p1.9.m9.1.1.3.2.cmml" xref="S2.SS2.p1.9.m9.1.1.3.2">𝑑</ci><apply id="S2.SS2.p1.9.m9.1.1.3.3.cmml" xref="S2.SS2.p1.9.m9.1.1.3.3"><times id="S2.SS2.p1.9.m9.1.1.3.3.1.cmml" xref="S2.SS2.p1.9.m9.1.1.3.3.1"></times><ci id="S2.SS2.p1.9.m9.1.1.3.3.2.cmml" xref="S2.SS2.p1.9.m9.1.1.3.3.2">𝑟</ci><ci id="S2.SS2.p1.9.m9.1.1.3.3.3.cmml" xref="S2.SS2.p1.9.m9.1.1.3.3.3">𝑒</ci><ci id="S2.SS2.p1.9.m9.1.1.3.3.4.cmml" xref="S2.SS2.p1.9.m9.1.1.3.3.4">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.9.m9.1c">\mathbb{R}^{d_{ret}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.9.m9.1d">blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_r italic_e italic_t end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>. It is crucial to emphasize that the actual retrieval process involves the embeddings representing the chunks, not the <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S2.SS2.p1.10.m10.1"><semantics id="S2.SS2.p1.10.m10.1a"><mrow id="S2.SS2.p1.10.m10.1.1" xref="S2.SS2.p1.10.m10.1.1.cmml"><mi id="S2.SS2.p1.10.m10.1.1.2" xref="S2.SS2.p1.10.m10.1.1.2.cmml">𝙺</mi><mo id="S2.SS2.p1.10.m10.1.1.1" xref="S2.SS2.p1.10.m10.1.1.1.cmml">⁢</mo><mtext id="S2.SS2.p1.10.m10.1.1.3" xref="S2.SS2.p1.10.m10.1.1.3a.cmml">-</mtext><mo id="S2.SS2.p1.10.m10.1.1.1a" xref="S2.SS2.p1.10.m10.1.1.1.cmml">⁢</mo><mi id="S2.SS2.p1.10.m10.1.1.4" xref="S2.SS2.p1.10.m10.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.10.m10.1b"><apply id="S2.SS2.p1.10.m10.1.1.cmml" xref="S2.SS2.p1.10.m10.1.1"><times id="S2.SS2.p1.10.m10.1.1.1.cmml" xref="S2.SS2.p1.10.m10.1.1.1"></times><ci id="S2.SS2.p1.10.m10.1.1.2.cmml" xref="S2.SS2.p1.10.m10.1.1.2">𝙺</ci><ci id="S2.SS2.p1.10.m10.1.1.3a.cmml" xref="S2.SS2.p1.10.m10.1.1.3"><mtext id="S2.SS2.p1.10.m10.1.1.3.cmml" xref="S2.SS2.p1.10.m10.1.1.3">-</mtext></ci><ci id="S2.SS2.p1.10.m10.1.1.4.cmml" xref="S2.SS2.p1.10.m10.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.10.m10.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.10.m10.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs.
The <span class="ltx_text ltx_font_italic" id="S2.SS2.p1.10.5">Retriever</span> is essentially a pretrained dense embedder with excellent representation capabilities. MemLong use it to encode each chunk into Representation Embeddings. Since it produces a one-dimensional representation vector for one chunk, the memory footprint remains minimal even if the memory size is substantial.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>MemLong</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Overview</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.7">As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2.F2" title="Figure 2 ‣ 2 Preliminary ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">2</span></a>, each step involves an input of a chunk <math alttext="c_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><msub id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2" xref="S3.SS1.p1.1.m1.1.1.2.cmml">c</mi><mi id="S3.SS1.p1.1.m1.1.1.3" xref="S3.SS1.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2">𝑐</ci><ci id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">c_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, where the original text for that chunk is <math alttext="t_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><msub id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml"><mi id="S3.SS1.p1.2.m2.1.1.2" xref="S3.SS1.p1.2.m2.1.1.2.cmml">t</mi><mi id="S3.SS1.p1.2.m2.1.1.3" xref="S3.SS1.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><apply id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2">𝑡</ci><ci id="S3.SS1.p1.2.m2.1.1.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
In the <span class="ltx_text ltx_font_italic" id="S3.SS1.p1.7.1">lower layers</span> where the model is frozen, the standard causal attention is applied to the entire <math alttext="c_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><msub id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml"><mi id="S3.SS1.p1.3.m3.1.1.2" xref="S3.SS1.p1.3.m3.1.1.2.cmml">c</mi><mi id="S3.SS1.p1.3.m3.1.1.3" xref="S3.SS1.p1.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><apply id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.1.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS1.p1.3.m3.1.1.2.cmml" xref="S3.SS1.p1.3.m3.1.1.2">𝑐</ci><ci id="S3.SS1.p1.3.m3.1.1.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">c_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
For the final layer of the <span class="ltx_text ltx_font_italic" id="S3.SS1.p1.7.2">lower layers</span>, we refer to it as the <span class="ltx_text ltx_font_italic" id="S3.SS1.p1.7.3">memory layer</span>.
Following each traversal of the <span class="ltx_text ltx_font_italic" id="S3.SS1.p1.7.4">memory layer</span>, two key operations are performed. The first operation is retrieval, depicted by the red line, where <math alttext="t_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><msub id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml"><mi id="S3.SS1.p1.4.m4.1.1.2" xref="S3.SS1.p1.4.m4.1.1.2.cmml">t</mi><mi id="S3.SS1.p1.4.m4.1.1.3" xref="S3.SS1.p1.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><apply id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.2">𝑡</ci><ci id="S3.SS1.p1.4.m4.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is utilized to fetch the most pertinent <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><mrow id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml"><mi id="S3.SS1.p1.5.m5.1.1.2" xref="S3.SS1.p1.5.m5.1.1.2.cmml">𝙺</mi><mo id="S3.SS1.p1.5.m5.1.1.1" xref="S3.SS1.p1.5.m5.1.1.1.cmml">⁢</mo><mtext id="S3.SS1.p1.5.m5.1.1.3" xref="S3.SS1.p1.5.m5.1.1.3a.cmml">-</mtext><mo id="S3.SS1.p1.5.m5.1.1.1a" xref="S3.SS1.p1.5.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.5.m5.1.1.4" xref="S3.SS1.p1.5.m5.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><apply id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1"><times id="S3.SS1.p1.5.m5.1.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1.1"></times><ci id="S3.SS1.p1.5.m5.1.1.2.cmml" xref="S3.SS1.p1.5.m5.1.1.2">𝙺</ci><ci id="S3.SS1.p1.5.m5.1.1.3a.cmml" xref="S3.SS1.p1.5.m5.1.1.3"><mtext id="S3.SS1.p1.5.m5.1.1.3.cmml" xref="S3.SS1.p1.5.m5.1.1.3">-</mtext></ci><ci id="S3.SS1.p1.5.m5.1.1.4.cmml" xref="S3.SS1.p1.5.m5.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs. The second operation, indicated by the blue line, involves caching the acquired <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><mrow id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml"><mi id="S3.SS1.p1.6.m6.1.1.2" xref="S3.SS1.p1.6.m6.1.1.2.cmml">𝙺</mi><mo id="S3.SS1.p1.6.m6.1.1.1" xref="S3.SS1.p1.6.m6.1.1.1.cmml">⁢</mo><mtext id="S3.SS1.p1.6.m6.1.1.3" xref="S3.SS1.p1.6.m6.1.1.3a.cmml">-</mtext><mo id="S3.SS1.p1.6.m6.1.1.1a" xref="S3.SS1.p1.6.m6.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.6.m6.1.1.4" xref="S3.SS1.p1.6.m6.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><apply id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1"><times id="S3.SS1.p1.6.m6.1.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1.1"></times><ci id="S3.SS1.p1.6.m6.1.1.2.cmml" xref="S3.SS1.p1.6.m6.1.1.2">𝙺</ci><ci id="S3.SS1.p1.6.m6.1.1.3a.cmml" xref="S3.SS1.p1.6.m6.1.1.3"><mtext id="S3.SS1.p1.6.m6.1.1.3.cmml" xref="S3.SS1.p1.6.m6.1.1.3">-</mtext></ci><ci id="S3.SS1.p1.6.m6.1.1.4.cmml" xref="S3.SS1.p1.6.m6.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs along with their associated chunk representation.
Within the model’s <span class="ltx_text ltx_font_italic" id="S3.SS1.p1.7.5">upper layers</span>, the retrieved <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><mrow id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml"><mi id="S3.SS1.p1.7.m7.1.1.2" xref="S3.SS1.p1.7.m7.1.1.2.cmml">𝙺</mi><mo id="S3.SS1.p1.7.m7.1.1.1" xref="S3.SS1.p1.7.m7.1.1.1.cmml">⁢</mo><mtext id="S3.SS1.p1.7.m7.1.1.3" xref="S3.SS1.p1.7.m7.1.1.3a.cmml">-</mtext><mo id="S3.SS1.p1.7.m7.1.1.1a" xref="S3.SS1.p1.7.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.7.m7.1.1.4" xref="S3.SS1.p1.7.m7.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><apply id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1"><times id="S3.SS1.p1.7.m7.1.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1.1"></times><ci id="S3.SS1.p1.7.m7.1.1.2.cmml" xref="S3.SS1.p1.7.m7.1.1.2">𝙺</ci><ci id="S3.SS1.p1.7.m7.1.1.3a.cmml" xref="S3.SS1.p1.7.m7.1.1.3"><mtext id="S3.SS1.p1.7.m7.1.1.3.cmml" xref="S3.SS1.p1.7.m7.1.1.3">-</mtext></ci><ci id="S3.SS1.p1.7.m7.1.1.4.cmml" xref="S3.SS1.p1.7.m7.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs are integrated with the current input context, subsequently tuning the model parameters to calibrate the retrieval reference.
Subsequent sections will explore the various facets of the MemLong framework and their intricacies, encompassing Retriever and Dynamic Memory Management (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS2" title="3.2 Retriever and Dynamic Memory Management ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">§</span> <span class="ltx_text ltx_ref_tag">3.2</span></a>), Attention Reformulation (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS3" title="3.3 Attention Reformulation ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">§</span> <span class="ltx_text ltx_ref_tag">3.3</span></a>), and Inference with MemLong (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.SS4" title="3.4 Inference with MemLong ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">§</span> <span class="ltx_text ltx_ref_tag">3.4</span></a>).</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Retriever and Dynamic Memory Management</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">We offer a comprehensive explanation of the retrieval process and the dynamics of memory management.</p>
</div>
<section class="ltx_paragraph" id="S3.SS2.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Retrieval Process.</h4>
<div class="ltx_para" id="S3.SS2.SSS0.Px1.p1">
<p class="ltx_p" id="S3.SS2.SSS0.Px1.p1.14">Given our objective to replace traditional kNN retrieval based on <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.1.m1.1"><semantics id="S3.SS2.SSS0.Px1.p1.1.m1.1a"><mrow id="S3.SS2.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1a" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.4" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.1.m1.1b"><apply id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1"><times id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.1"></times><ci id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3a.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3"><mtext id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px1.p1.1.m1.1.1.4.cmml" xref="S3.SS2.SSS0.Px1.p1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs with explicit retrieval, we aim to pre-fetch the desired information when feasible before each model input. Specifically, for each potential query block <math alttext="c^{q}=c_{i}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.2.m2.1"><semantics id="S3.SS2.SSS0.Px1.p1.2.m2.1a"><mrow id="S3.SS2.SSS0.Px1.p1.2.m2.1.1" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.2" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.3" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.1" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.1.cmml">=</mo><msub id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.2.m2.1b"><apply id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1"><eq id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.1"></eq><apply id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.2">𝑐</ci><ci id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.2.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.2">𝑐</ci><ci id="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.2.m2.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.2.m2.1c">c^{q}=c_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.2.m2.1d">italic_c start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and its corresponding text block <math alttext="t^{q}=t_{i}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.3.m3.1"><semantics id="S3.SS2.SSS0.Px1.p1.3.m3.1a"><mrow id="S3.SS2.SSS0.Px1.p1.3.m3.1.1" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.2" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.2.cmml">t</mi><mi id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.3" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.1" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.1.cmml">=</mo><msub id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.2.cmml">t</mi><mi id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.3.m3.1b"><apply id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1"><eq id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.1"></eq><apply id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.2">𝑡</ci><ci id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.2.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.2">𝑡</ci><ci id="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.3.m3.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.3.m3.1c">t^{q}=t_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.3.m3.1d">italic_t start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, we first pass it through <span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px1.p1.14.1">Retriever</span> and then obtain a representation embedding <math alttext="r^{q}=\mathcal{R}(t^{q})" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.4.m4.1"><semantics id="S3.SS2.SSS0.Px1.p1.4.m4.1a"><mrow id="S3.SS2.SSS0.Px1.p1.4.m4.1.1" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.2" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.2.cmml">=</mo><mrow id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.3.cmml">ℛ</mi><mo id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml">(</mo><msup id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.2.cmml">t</mi><mi id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.4.m4.1b"><apply id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1"><eq id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.2"></eq><apply id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.2">𝑟</ci><ci id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.3.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1"><times id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.2"></times><ci id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.3">ℛ</ci><apply id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.2">𝑡</ci><ci id="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.3">𝑞</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.4.m4.1c">r^{q}=\mathcal{R}(t^{q})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.4.m4.1d">italic_r start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = caligraphic_R ( italic_t start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT )</annotation></semantics></math>, where <math alttext="r^{q}\in\mathbb{R}^{d_{ret}}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.5.m5.1"><semantics id="S3.SS2.SSS0.Px1.p1.5.m5.1a"><mrow id="S3.SS2.SSS0.Px1.p1.5.m5.1.1" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.2" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.3" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.1" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.1.cmml">∈</mo><msup id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.2.cmml">ℝ</mi><msub id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.2" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.2.cmml">d</mi><mrow id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.2" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.2.cmml">r</mi><mo id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.3" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.3.cmml">e</mi><mo id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1a" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.4" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.4.cmml">t</mi></mrow></msub></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.5.m5.1b"><apply id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1"><in id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.1"></in><apply id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.2">𝑟</ci><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.2.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.2">ℝ</ci><apply id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3">subscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.2">𝑑</ci><apply id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3"><times id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.1"></times><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.2">𝑟</ci><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.3">𝑒</ci><ci id="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.4.cmml" xref="S3.SS2.SSS0.Px1.p1.5.m5.1.1.3.3.3.4">𝑡</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.5.m5.1c">r^{q}\in\mathbb{R}^{d_{ret}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.5.m5.1d">italic_r start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_r italic_e italic_t end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>.
Subsequently, we use this representation embedding to perform retrieval against the embeddings in <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.6.m6.1"><semantics id="S3.SS2.SSS0.Px1.p1.6.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.SSS0.Px1.p1.6.m6.1.1" xref="S3.SS2.SSS0.Px1.p1.6.m6.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.6.m6.1b"><ci id="S3.SS2.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.6.m6.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.6.m6.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.6.m6.1d">caligraphic_M</annotation></semantics></math> to obtain the required <math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.7.m7.1"><semantics id="S3.SS2.SSS0.Px1.p1.7.m7.1a"><mi id="S3.SS2.SSS0.Px1.p1.7.m7.1.1" xref="S3.SS2.SSS0.Px1.p1.7.m7.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.7.m7.1b"><ci id="S3.SS2.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.7.m7.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.7.m7.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.7.m7.1d">italic_k</annotation></semantics></math> chunk-level indices. We compute the cosine similarity between the retrieval representation <math alttext="r^{q}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.8.m8.1"><semantics id="S3.SS2.SSS0.Px1.p1.8.m8.1a"><msup id="S3.SS2.SSS0.Px1.p1.8.m8.1.1" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.2" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.3" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.8.m8.1b"><apply id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1.2">𝑟</ci><ci id="S3.SS2.SSS0.Px1.p1.8.m8.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.8.m8.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.8.m8.1c">r^{q}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.8.m8.1d">italic_r start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math> and the embeddings stored in Memory <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.9.m9.1"><semantics id="S3.SS2.SSS0.Px1.p1.9.m9.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.SSS0.Px1.p1.9.m9.1.1" xref="S3.SS2.SSS0.Px1.p1.9.m9.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.9.m9.1b"><ci id="S3.SS2.SSS0.Px1.p1.9.m9.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.9.m9.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.9.m9.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.9.m9.1d">caligraphic_M</annotation></semantics></math>. Finally , we get the top-k indices <math alttext="z^{q}=\mathtt{TopK}{\{\mathtt{Cos}\left(r^{q}\right)\}}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.10.m10.1"><semantics id="S3.SS2.SSS0.Px1.p1.10.m10.1a"><mrow id="S3.SS2.SSS0.Px1.p1.10.m10.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.2.cmml">z</mi><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.2.cmml">=</mo><mrow id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.3.cmml">𝚃𝚘𝚙𝙺</mi><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.2.cmml"><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.2.cmml">{</mo><mrow id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.3.cmml">𝙲𝚘𝚜</mi><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.cmml">(</mo><msup id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.2" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.3" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.2.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.10.m10.1b"><apply id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1"><eq id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.2"></eq><apply id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.2">𝑧</ci><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.3.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1"><times id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.2"></times><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.3">𝚃𝚘𝚙𝙺</ci><set id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1"><apply id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1"><times id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.2"></times><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.3">𝙲𝚘𝚜</ci><apply id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.2">𝑟</ci><ci id="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.1.1.1.1.1.3">𝑞</ci></apply></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.10.m10.1c">z^{q}=\mathtt{TopK}{\{\mathtt{Cos}\left(r^{q}\right)\}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.10.m10.1d">italic_z start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = typewriter_TopK { typewriter_Cos ( italic_r start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ) }</annotation></semantics></math> for the <math alttext="c^{q}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.11.m11.1"><semantics id="S3.SS2.SSS0.Px1.p1.11.m11.1a"><msup id="S3.SS2.SSS0.Px1.p1.11.m11.1.1" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.2" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.3" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1.3.cmml">q</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.11.m11.1b"><apply id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1.2">𝑐</ci><ci id="S3.SS2.SSS0.Px1.p1.11.m11.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.11.m11.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.11.m11.1c">c^{q}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.11.m11.1d">italic_c start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>, where <math alttext="z^{q}\in\mathbb{R}^{k}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.12.m12.1"><semantics id="S3.SS2.SSS0.Px1.p1.12.m12.1a"><mrow id="S3.SS2.SSS0.Px1.p1.12.m12.1.1" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.2" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.2.cmml">z</mi><mi id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.3" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.1" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.1.cmml">∈</mo><msup id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.3.cmml">k</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.12.m12.1b"><apply id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1"><in id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.1"></in><apply id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.2">𝑧</ci><ci id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.2.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.2">ℝ</ci><ci id="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.12.m12.1.1.3.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.12.m12.1c">z^{q}\in\mathbb{R}^{k}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.12.m12.1d">italic_z start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT</annotation></semantics></math>.
Due to the contiguous nature within the blocks, we can easily extend the obtained indices to cover the entire relevant range for retrieval. Finally, we retrieve the corresponding <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.13.m13.1"><semantics id="S3.SS2.SSS0.Px1.p1.13.m13.1a"><mrow id="S3.SS2.SSS0.Px1.p1.13.m13.1.1" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.cmml"><mi id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.2" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1a" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.4" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.13.m13.1b"><apply id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1"><times id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.1"></times><ci id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3a.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3"><mtext id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px1.p1.13.m13.1.1.4.cmml" xref="S3.SS2.SSS0.Px1.p1.13.m13.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.13.m13.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.13.m13.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs <math alttext="{\tilde{z}}^{q}\in\mathbb{R}^{k\times\tau\times d_{model}}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px1.p1.14.m14.1"><semantics id="S3.SS2.SSS0.Px1.p1.14.m14.1a"><mrow id="S3.SS2.SSS0.Px1.p1.14.m14.1.1" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.cmml"><msup id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.cmml"><mover accent="true" id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.cmml"><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.2.cmml">z</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.1" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.1.cmml">~</mo></mover><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.3.cmml">q</mi></msup><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.1" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.1.cmml">∈</mo><msup id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.2.cmml">k</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1.cmml">×</mo><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.3.cmml">τ</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1.cmml">×</mo><msub id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.cmml"><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.2.cmml">d</mi><mrow id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.cmml"><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.2" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.2.cmml">m</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.3" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.3.cmml">o</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1a" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.4" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.4.cmml">d</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1b" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.5" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.5.cmml">e</mi><mo id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1c" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.6" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.6.cmml">l</mi></mrow></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px1.p1.14.m14.1b"><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1"><in id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.1"></in><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2">superscript</csymbol><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2"><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.1">~</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.2.2">𝑧</ci></apply><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.2.3">𝑞</ci></apply><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.2">ℝ</ci><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3"><times id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.1"></times><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.2">𝑘</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.3">𝜏</ci><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4">subscript</csymbol><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.2">𝑑</ci><apply id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3"><times id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.1"></times><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.2.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.2">𝑚</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.3.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.3">𝑜</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.4.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.4">𝑑</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.5.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.5">𝑒</ci><ci id="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.6.cmml" xref="S3.SS2.SSS0.Px1.p1.14.m14.1.1.3.3.4.3.6">𝑙</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px1.p1.14.m14.1c">{\tilde{z}}^{q}\in\mathbb{R}^{k\times\tau\times d_{model}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px1.p1.14.m14.1d">over~ start_ARG italic_z end_ARG start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_k × italic_τ × italic_d start_POSTSUBSCRIPT italic_m italic_o italic_d italic_e italic_l end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> from Memory based on these indices and used for the<span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px1.p1.14.2"> upper layer</span>.
It is noteworthy that we have equipped the <span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px1.p1.14.3">Memory</span> with a counter mechanism to record the frequency of retrievals for each index contained therein. This frequency data will subsequently serve as a basis for dynamic memory updating, allowing for the prioritization of more frequently retrieved information.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS2.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Memory Process.</h4>
<div class="ltx_para" id="S3.SS2.SSS0.Px2.p1">
<p class="ltx_p" id="S3.SS2.SSS0.Px2.p1.9">The memory process synchronously stores the <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.1.m1.1"><semantics id="S3.SS2.SSS0.Px2.p1.1.m1.1a"><mrow id="S3.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.2" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1a" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.4" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.1.m1.1b"><apply id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1"><times id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.1"></times><ci id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3a.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3"><mtext id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px2.p1.1.m1.1.1.4.cmml" xref="S3.SS2.SSS0.Px2.p1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs from the <span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px2.p1.9.1">memory layer</span> and the <span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px2.p1.9.2">representation embedding</span> previous calculated for retrieval , ensuring that indices for <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.2.m2.1"><semantics id="S3.SS2.SSS0.Px2.p1.2.m2.1a"><mrow id="S3.SS2.SSS0.Px2.p1.2.m2.1.1" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.2" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1a" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.4" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.2.m2.1b"><apply id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1"><times id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.1"></times><ci id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3a.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3"><mtext id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px2.p1.2.m2.1.1.4.cmml" xref="S3.SS2.SSS0.Px2.p1.2.m2.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.2.m2.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.2.m2.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs correspond accurately to their representation embeddings (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S2.F2" title="Figure 2 ‣ 2 Preliminary ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">2</span></a>, right, blue line). For every possible chunk memory <math alttext="c^{m}=c_{i}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.3.m3.1"><semantics id="S3.SS2.SSS0.Px2.p1.3.m3.1a"><mrow id="S3.SS2.SSS0.Px2.p1.3.m3.1.1" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.cmml"><msup id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.2" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.3" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.3.cmml">m</mi></msup><mo id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.1" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.1.cmml">=</mo><msub id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.2" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.3" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.3.m3.1b"><apply id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1"><eq id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.1"></eq><apply id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.2">𝑐</ci><ci id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.2.3">𝑚</ci></apply><apply id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.2">𝑐</ci><ci id="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px2.p1.3.m3.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.3.m3.1c">c^{m}=c_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.3.m3.1d">italic_c start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT = italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, and its corresponding text chunk <math alttext="t^{m}=t_{i}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.4.m4.1"><semantics id="S3.SS2.SSS0.Px2.p1.4.m4.1a"><mrow id="S3.SS2.SSS0.Px2.p1.4.m4.1.1" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.cmml"><msup id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.2" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.2.cmml">t</mi><mi id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.3" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.3.cmml">m</mi></msup><mo id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.1" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.1.cmml">=</mo><msub id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.2" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.2.cmml">t</mi><mi id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.3" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.4.m4.1b"><apply id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1"><eq id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.1"></eq><apply id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.2">𝑡</ci><ci id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.2.3">𝑚</ci></apply><apply id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.2">𝑡</ci><ci id="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px2.p1.4.m4.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.4.m4.1c">t^{m}=t_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.4.m4.1d">italic_t start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT = italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, we divide the memory process into two parts: the first part details how to cache the <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.5.m5.1"><semantics id="S3.SS2.SSS0.Px2.p1.5.m5.1a"><mrow id="S3.SS2.SSS0.Px2.p1.5.m5.1.1" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.2" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1a" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.4" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.5.m5.1b"><apply id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1"><times id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.1"></times><ci id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3a.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3"><mtext id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px2.p1.5.m5.1.1.4.cmml" xref="S3.SS2.SSS0.Px2.p1.5.m5.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.5.m5.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.5.m5.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs, and the second part explains how to store the corresponding representations. Firstly, we input <math alttext="c^{m}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.6.m6.1"><semantics id="S3.SS2.SSS0.Px2.p1.6.m6.1a"><msup id="S3.SS2.SSS0.Px2.p1.6.m6.1.1" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.2" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1.2.cmml">c</mi><mi id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.3" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1.3.cmml">m</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.6.m6.1b"><apply id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1.2">𝑐</ci><ci id="S3.SS2.SSS0.Px2.p1.6.m6.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.6.m6.1.1.3">𝑚</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.6.m6.1c">c^{m}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.6.m6.1d">italic_c start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT</annotation></semantics></math> into the MemLong and get the output from the <span class="ltx_text ltx_font_italic" id="S3.SS2.SSS0.Px2.p1.9.3">memory layer</span>. It is worth noting that, since the lower layers are frozen during training, we can ensure that the distribution of the output <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.7.m7.1"><semantics id="S3.SS2.SSS0.Px2.p1.7.m7.1a"><mrow id="S3.SS2.SSS0.Px2.p1.7.m7.1.1" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.2" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml">𝙺</mi><mo id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml">⁢</mo><mtext id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3a.cmml">-</mtext><mo id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1a" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.4" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.7.m7.1b"><apply id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1"><times id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.1"></times><ci id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.2">𝙺</ci><ci id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3a.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3"><mtext id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.3">-</mtext></ci><ci id="S3.SS2.SSS0.Px2.p1.7.m7.1.1.4.cmml" xref="S3.SS2.SSS0.Px2.p1.7.m7.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.7.m7.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.7.m7.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs is consistent. This consistency is crucial for avoiding the distribution shift issue, which was previously observed in models like MemTrm <cite class="ltx_cite ltx_citemacro_cite">Wu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib33" title="">2022</a>)</cite>. Our memory operation is highly efficient because it only involves storing the representations needed for retrieval, <math alttext="r^{m}=r^{q}" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.8.m8.1"><semantics id="S3.SS2.SSS0.Px2.p1.8.m8.1a"><mrow id="S3.SS2.SSS0.Px2.p1.8.m8.1.1" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.cmml"><msup id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml"><mi id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.2" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.3" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.3.cmml">m</mi></msup><mo id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.1" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml">=</mo><msup id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml"><mi id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.2" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.3" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.cmml">q</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.8.m8.1b"><apply id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1"><eq id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.1"></eq><apply id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.1.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.2.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.2">𝑟</ci><ci id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.3.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.2.3">𝑚</ci></apply><apply id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.1.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.2.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.2">𝑟</ci><ci id="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.cmml" xref="S3.SS2.SSS0.Px2.p1.8.m8.1.1.3.3">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.8.m8.1c">r^{m}=r^{q}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.8.m8.1d">italic_r start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT = italic_r start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>, thereby avoiding redundancy. After the retrieval for all chunk pairs is complete, the memory operation—denoted as <math alttext="\mathcal{M}(k,v;r^{m})" class="ltx_Math" display="inline" id="S3.SS2.SSS0.Px2.p1.9.m9.3"><semantics id="S3.SS2.SSS0.Px2.p1.9.m9.3a"><mrow id="S3.SS2.SSS0.Px2.p1.9.m9.3.3" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.3" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.3.cmml">ℳ</mi><mo id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.2" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.2.cmml">⁢</mo><mrow id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml"><mo id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.2" stretchy="false" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml">(</mo><mi id="S3.SS2.SSS0.Px2.p1.9.m9.1.1" xref="S3.SS2.SSS0.Px2.p1.9.m9.1.1.cmml">k</mi><mo id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.3" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml">,</mo><mi id="S3.SS2.SSS0.Px2.p1.9.m9.2.2" xref="S3.SS2.SSS0.Px2.p1.9.m9.2.2.cmml">v</mi><mo id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.4" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml">;</mo><msup id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.cmml"><mi id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.2" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.2.cmml">r</mi><mi id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.3" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.3.cmml">m</mi></msup><mo id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.5" stretchy="false" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS0.Px2.p1.9.m9.3b"><apply id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3"><times id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.2.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.2"></times><ci id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.3.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.3">ℳ</ci><vector id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1"><ci id="S3.SS2.SSS0.Px2.p1.9.m9.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.1.1">𝑘</ci><ci id="S3.SS2.SSS0.Px2.p1.9.m9.2.2.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.2.2">𝑣</ci><apply id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.1.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1">superscript</csymbol><ci id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.2.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.2">𝑟</ci><ci id="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.3.cmml" xref="S3.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.1.3">𝑚</ci></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS0.Px2.p1.9.m9.3c">\mathcal{M}(k,v;r^{m})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS0.Px2.p1.9.m9.3d">caligraphic_M ( italic_k , italic_v ; italic_r start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT )</annotation></semantics></math>—synchronously updates the memory with both the Key-Value pairs and their corresponding representations.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS2.SSS0.Px3">
<h4 class="ltx_title ltx_title_paragraph">Dynamic Memory Update.</h4>
<div class="ltx_para" id="S3.SS2.SSS0.Px3.p1">
<p class="ltx_p" id="S3.SS2.SSS0.Px3.p1.1">When memory overflows, we use the Counter to update memory intelligently. In our experiments, we keep the latest 10% of memory content due to its potential relevance, discard the oldest 10% as likely outdated, and prioritize the middle 80% based on retrieval frequency, deleting the least accessed entries until memory usage drops to 50%. This selective pruning balances recency and relevance, retaining valuable information and removing less pertinent data. Unlike traditional FIFO strategies, our method focuses on retrieval frequency to efficiently prune redundant information, maintaining a high-quality dataset. The decision to dynamically update the datastore is a trade-off between effectiveness and efficiency. For tasks requiring long-term dependencies, storing all information can enhance comprehensive processing, but for shorter-term tasks, dynamic updates are more suitable. Dynamic updates control memory size to prevent out-of-memory issues, discard stale information, and reduce retrieval overhead, ensuring efficiency without significantly compromising performance.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Attention Reformulation</h3>
<figure class="ltx_figure" id="S3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="325" id="S3.F3.g1" src="extracted/5822409/attn.png" width="479"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Illustration of retrieval causal attention. Local causal attention is applied to the recent context, while chunk-level <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S3.F3.2.m1.1"><semantics id="S3.F3.2.m1.1b"><mrow id="S3.F3.2.m1.1.1" xref="S3.F3.2.m1.1.1.cmml"><mi id="S3.F3.2.m1.1.1.2" xref="S3.F3.2.m1.1.1.2.cmml">𝙺</mi><mo id="S3.F3.2.m1.1.1.1" xref="S3.F3.2.m1.1.1.1.cmml">⁢</mo><mtext id="S3.F3.2.m1.1.1.3" xref="S3.F3.2.m1.1.1.3a.cmml">-</mtext><mo id="S3.F3.2.m1.1.1.1b" xref="S3.F3.2.m1.1.1.1.cmml">⁢</mo><mi id="S3.F3.2.m1.1.1.4" xref="S3.F3.2.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.F3.2.m1.1c"><apply id="S3.F3.2.m1.1.1.cmml" xref="S3.F3.2.m1.1.1"><times id="S3.F3.2.m1.1.1.1.cmml" xref="S3.F3.2.m1.1.1.1"></times><ci id="S3.F3.2.m1.1.1.2.cmml" xref="S3.F3.2.m1.1.1.2">𝙺</ci><ci id="S3.F3.2.m1.1.1.3a.cmml" xref="S3.F3.2.m1.1.1.3"><mtext id="S3.F3.2.m1.1.1.3.cmml" xref="S3.F3.2.m1.1.1.3">-</mtext></ci><ci id="S3.F3.2.m1.1.1.4.cmml" xref="S3.F3.2.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.2.m1.1d">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.2.m1.1e">typewriter_K - typewriter_V</annotation></semantics></math> pairs, obtained through the retrieval method, enable bidirectional attention without information leakage due to their historical nature.</figcaption>
</figure>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.3">In the trainable <span class="ltx_text ltx_font_italic" id="S3.SS3.p1.3.1">upper layers</span> of the model, we revised the attentions to fuse with long-term memory.
As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.F3" title="Figure 3 ‣ 3.3 Attention Reformulation ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">3</span></a>, unlike the traditional Transformer decoder layers that utilize Multi-Head Attention <cite class="ltx_cite ltx_citemacro_cite">Vaswani et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib29" title="">2017</a>)</cite>, we propose a <span class="ltx_text ltx_font_italic" id="S3.SS3.p1.3.2">Retrieval Causal Attention</span> to extend it to a joint-attention mechanism and propose a long-term memory fusion process to enable each token to attend on both local contexts and chunk-level past contexts which have complete and continuous semantics. With the head-wise hidden state output from previous layer <math alttext="H^{l-1}\in\mathbb{R}^{\lvert x\rvert\times d_{model}}" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><mrow id="S3.SS3.p1.1.m1.1.2" xref="S3.SS3.p1.1.m1.1.2.cmml"><msup id="S3.SS3.p1.1.m1.1.2.2" xref="S3.SS3.p1.1.m1.1.2.2.cmml"><mi id="S3.SS3.p1.1.m1.1.2.2.2" xref="S3.SS3.p1.1.m1.1.2.2.2.cmml">H</mi><mrow id="S3.SS3.p1.1.m1.1.2.2.3" xref="S3.SS3.p1.1.m1.1.2.2.3.cmml"><mi id="S3.SS3.p1.1.m1.1.2.2.3.2" xref="S3.SS3.p1.1.m1.1.2.2.3.2.cmml">l</mi><mo id="S3.SS3.p1.1.m1.1.2.2.3.1" xref="S3.SS3.p1.1.m1.1.2.2.3.1.cmml">−</mo><mn id="S3.SS3.p1.1.m1.1.2.2.3.3" xref="S3.SS3.p1.1.m1.1.2.2.3.3.cmml">1</mn></mrow></msup><mo id="S3.SS3.p1.1.m1.1.2.1" xref="S3.SS3.p1.1.m1.1.2.1.cmml">∈</mo><msup id="S3.SS3.p1.1.m1.1.2.3" xref="S3.SS3.p1.1.m1.1.2.3.cmml"><mi id="S3.SS3.p1.1.m1.1.2.3.2" xref="S3.SS3.p1.1.m1.1.2.3.2.cmml">ℝ</mi><mrow id="S3.SS3.p1.1.m1.1.1.1" xref="S3.SS3.p1.1.m1.1.1.1.cmml"><mrow id="S3.SS3.p1.1.m1.1.1.1.3.2" xref="S3.SS3.p1.1.m1.1.1.1.3.1.cmml"><mo id="S3.SS3.p1.1.m1.1.1.1.3.2.1" stretchy="false" xref="S3.SS3.p1.1.m1.1.1.1.3.1.1.cmml">|</mo><mi id="S3.SS3.p1.1.m1.1.1.1.1" xref="S3.SS3.p1.1.m1.1.1.1.1.cmml">x</mi><mo id="S3.SS3.p1.1.m1.1.1.1.3.2.2" rspace="0.055em" stretchy="false" xref="S3.SS3.p1.1.m1.1.1.1.3.1.1.cmml">|</mo></mrow><mo id="S3.SS3.p1.1.m1.1.1.1.2" rspace="0.222em" xref="S3.SS3.p1.1.m1.1.1.1.2.cmml">×</mo><msub id="S3.SS3.p1.1.m1.1.1.1.4" xref="S3.SS3.p1.1.m1.1.1.1.4.cmml"><mi id="S3.SS3.p1.1.m1.1.1.1.4.2" xref="S3.SS3.p1.1.m1.1.1.1.4.2.cmml">d</mi><mrow id="S3.SS3.p1.1.m1.1.1.1.4.3" xref="S3.SS3.p1.1.m1.1.1.1.4.3.cmml"><mi id="S3.SS3.p1.1.m1.1.1.1.4.3.2" xref="S3.SS3.p1.1.m1.1.1.1.4.3.2.cmml">m</mi><mo id="S3.SS3.p1.1.m1.1.1.1.4.3.1" xref="S3.SS3.p1.1.m1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.1.4.3.3" xref="S3.SS3.p1.1.m1.1.1.1.4.3.3.cmml">o</mi><mo id="S3.SS3.p1.1.m1.1.1.1.4.3.1a" xref="S3.SS3.p1.1.m1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.1.4.3.4" xref="S3.SS3.p1.1.m1.1.1.1.4.3.4.cmml">d</mi><mo id="S3.SS3.p1.1.m1.1.1.1.4.3.1b" xref="S3.SS3.p1.1.m1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.1.4.3.5" xref="S3.SS3.p1.1.m1.1.1.1.4.3.5.cmml">e</mi><mo id="S3.SS3.p1.1.m1.1.1.1.4.3.1c" xref="S3.SS3.p1.1.m1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.1.4.3.6" xref="S3.SS3.p1.1.m1.1.1.1.4.3.6.cmml">l</mi></mrow></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><apply id="S3.SS3.p1.1.m1.1.2.cmml" xref="S3.SS3.p1.1.m1.1.2"><in id="S3.SS3.p1.1.m1.1.2.1.cmml" xref="S3.SS3.p1.1.m1.1.2.1"></in><apply id="S3.SS3.p1.1.m1.1.2.2.cmml" xref="S3.SS3.p1.1.m1.1.2.2"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.2.2.1.cmml" xref="S3.SS3.p1.1.m1.1.2.2">superscript</csymbol><ci id="S3.SS3.p1.1.m1.1.2.2.2.cmml" xref="S3.SS3.p1.1.m1.1.2.2.2">𝐻</ci><apply id="S3.SS3.p1.1.m1.1.2.2.3.cmml" xref="S3.SS3.p1.1.m1.1.2.2.3"><minus id="S3.SS3.p1.1.m1.1.2.2.3.1.cmml" xref="S3.SS3.p1.1.m1.1.2.2.3.1"></minus><ci id="S3.SS3.p1.1.m1.1.2.2.3.2.cmml" xref="S3.SS3.p1.1.m1.1.2.2.3.2">𝑙</ci><cn id="S3.SS3.p1.1.m1.1.2.2.3.3.cmml" type="integer" xref="S3.SS3.p1.1.m1.1.2.2.3.3">1</cn></apply></apply><apply id="S3.SS3.p1.1.m1.1.2.3.cmml" xref="S3.SS3.p1.1.m1.1.2.3"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.2.3.1.cmml" xref="S3.SS3.p1.1.m1.1.2.3">superscript</csymbol><ci id="S3.SS3.p1.1.m1.1.2.3.2.cmml" xref="S3.SS3.p1.1.m1.1.2.3.2">ℝ</ci><apply id="S3.SS3.p1.1.m1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1"><times id="S3.SS3.p1.1.m1.1.1.1.2.cmml" xref="S3.SS3.p1.1.m1.1.1.1.2"></times><apply id="S3.SS3.p1.1.m1.1.1.1.3.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1.3.2"><abs id="S3.SS3.p1.1.m1.1.1.1.3.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1.3.2.1"></abs><ci id="S3.SS3.p1.1.m1.1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1.1">𝑥</ci></apply><apply id="S3.SS3.p1.1.m1.1.1.1.4.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.1.4.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4">subscript</csymbol><ci id="S3.SS3.p1.1.m1.1.1.1.4.2.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.2">𝑑</ci><apply id="S3.SS3.p1.1.m1.1.1.1.4.3.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3"><times id="S3.SS3.p1.1.m1.1.1.1.4.3.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.1"></times><ci id="S3.SS3.p1.1.m1.1.1.1.4.3.2.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.2">𝑚</ci><ci id="S3.SS3.p1.1.m1.1.1.1.4.3.3.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.3">𝑜</ci><ci id="S3.SS3.p1.1.m1.1.1.1.4.3.4.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.4">𝑑</ci><ci id="S3.SS3.p1.1.m1.1.1.1.4.3.5.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.5">𝑒</ci><ci id="S3.SS3.p1.1.m1.1.1.1.4.3.6.cmml" xref="S3.SS3.p1.1.m1.1.1.1.4.3.6">𝑙</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">H^{l-1}\in\mathbb{R}^{\lvert x\rvert\times d_{model}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">italic_H start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT | italic_x | × italic_d start_POSTSUBSCRIPT italic_m italic_o italic_d italic_e italic_l end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> and the corresponding retrieved key-value pairs are <math alttext="{\tilde{z}}^{q}={\{\tilde{K_{i}},\tilde{V_{i}}\}}_{i=1}^{\omega}\in\mathbb{R}^%
{k\times\tau\times d_{model}}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.2"><semantics id="S3.SS3.p1.2.m2.2a"><mrow id="S3.SS3.p1.2.m2.2.3" xref="S3.SS3.p1.2.m2.2.3.cmml"><msup id="S3.SS3.p1.2.m2.2.3.2" xref="S3.SS3.p1.2.m2.2.3.2.cmml"><mover accent="true" id="S3.SS3.p1.2.m2.2.3.2.2" xref="S3.SS3.p1.2.m2.2.3.2.2.cmml"><mi id="S3.SS3.p1.2.m2.2.3.2.2.2" xref="S3.SS3.p1.2.m2.2.3.2.2.2.cmml">z</mi><mo id="S3.SS3.p1.2.m2.2.3.2.2.1" xref="S3.SS3.p1.2.m2.2.3.2.2.1.cmml">~</mo></mover><mi id="S3.SS3.p1.2.m2.2.3.2.3" xref="S3.SS3.p1.2.m2.2.3.2.3.cmml">q</mi></msup><mo id="S3.SS3.p1.2.m2.2.3.3" xref="S3.SS3.p1.2.m2.2.3.3.cmml">=</mo><msubsup id="S3.SS3.p1.2.m2.2.3.4" xref="S3.SS3.p1.2.m2.2.3.4.cmml"><mrow id="S3.SS3.p1.2.m2.2.3.4.2.2.2" xref="S3.SS3.p1.2.m2.2.3.4.2.2.1.cmml"><mo id="S3.SS3.p1.2.m2.2.3.4.2.2.2.1" stretchy="false" xref="S3.SS3.p1.2.m2.2.3.4.2.2.1.cmml">{</mo><mover accent="true" id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><msub id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2.2" xref="S3.SS3.p1.2.m2.1.1.2.2.cmml">K</mi><mi id="S3.SS3.p1.2.m2.1.1.2.3" xref="S3.SS3.p1.2.m2.1.1.2.3.cmml">i</mi></msub><mo id="S3.SS3.p1.2.m2.1.1.1" xref="S3.SS3.p1.2.m2.1.1.1.cmml">~</mo></mover><mo id="S3.SS3.p1.2.m2.2.3.4.2.2.2.2" xref="S3.SS3.p1.2.m2.2.3.4.2.2.1.cmml">,</mo><mover accent="true" id="S3.SS3.p1.2.m2.2.2" xref="S3.SS3.p1.2.m2.2.2.cmml"><msub id="S3.SS3.p1.2.m2.2.2.2" xref="S3.SS3.p1.2.m2.2.2.2.cmml"><mi id="S3.SS3.p1.2.m2.2.2.2.2" xref="S3.SS3.p1.2.m2.2.2.2.2.cmml">V</mi><mi id="S3.SS3.p1.2.m2.2.2.2.3" xref="S3.SS3.p1.2.m2.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS3.p1.2.m2.2.2.1" xref="S3.SS3.p1.2.m2.2.2.1.cmml">~</mo></mover><mo id="S3.SS3.p1.2.m2.2.3.4.2.2.2.3" stretchy="false" xref="S3.SS3.p1.2.m2.2.3.4.2.2.1.cmml">}</mo></mrow><mrow id="S3.SS3.p1.2.m2.2.3.4.2.3" xref="S3.SS3.p1.2.m2.2.3.4.2.3.cmml"><mi id="S3.SS3.p1.2.m2.2.3.4.2.3.2" xref="S3.SS3.p1.2.m2.2.3.4.2.3.2.cmml">i</mi><mo id="S3.SS3.p1.2.m2.2.3.4.2.3.1" xref="S3.SS3.p1.2.m2.2.3.4.2.3.1.cmml">=</mo><mn id="S3.SS3.p1.2.m2.2.3.4.2.3.3" xref="S3.SS3.p1.2.m2.2.3.4.2.3.3.cmml">1</mn></mrow><mi id="S3.SS3.p1.2.m2.2.3.4.3" xref="S3.SS3.p1.2.m2.2.3.4.3.cmml">ω</mi></msubsup><mo id="S3.SS3.p1.2.m2.2.3.5" xref="S3.SS3.p1.2.m2.2.3.5.cmml">∈</mo><msup id="S3.SS3.p1.2.m2.2.3.6" xref="S3.SS3.p1.2.m2.2.3.6.cmml"><mi id="S3.SS3.p1.2.m2.2.3.6.2" xref="S3.SS3.p1.2.m2.2.3.6.2.cmml">ℝ</mi><mrow id="S3.SS3.p1.2.m2.2.3.6.3" xref="S3.SS3.p1.2.m2.2.3.6.3.cmml"><mi id="S3.SS3.p1.2.m2.2.3.6.3.2" xref="S3.SS3.p1.2.m2.2.3.6.3.2.cmml">k</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.2.m2.2.3.6.3.1.cmml">×</mo><mi id="S3.SS3.p1.2.m2.2.3.6.3.3" xref="S3.SS3.p1.2.m2.2.3.6.3.3.cmml">τ</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.2.m2.2.3.6.3.1.cmml">×</mo><msub id="S3.SS3.p1.2.m2.2.3.6.3.4" xref="S3.SS3.p1.2.m2.2.3.6.3.4.cmml"><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.2" xref="S3.SS3.p1.2.m2.2.3.6.3.4.2.cmml">d</mi><mrow id="S3.SS3.p1.2.m2.2.3.6.3.4.3" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.cmml"><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.3.2" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.2.cmml">m</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.4.3.1" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.3.3" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.3.cmml">o</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.4.3.1a" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.3.4" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.4.cmml">d</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.4.3.1b" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.3.5" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.5.cmml">e</mi><mo id="S3.SS3.p1.2.m2.2.3.6.3.4.3.1c" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.2.3.6.3.4.3.6" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.6.cmml">l</mi></mrow></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.2b"><apply id="S3.SS3.p1.2.m2.2.3.cmml" xref="S3.SS3.p1.2.m2.2.3"><and id="S3.SS3.p1.2.m2.2.3a.cmml" xref="S3.SS3.p1.2.m2.2.3"></and><apply id="S3.SS3.p1.2.m2.2.3b.cmml" xref="S3.SS3.p1.2.m2.2.3"><eq id="S3.SS3.p1.2.m2.2.3.3.cmml" xref="S3.SS3.p1.2.m2.2.3.3"></eq><apply id="S3.SS3.p1.2.m2.2.3.2.cmml" xref="S3.SS3.p1.2.m2.2.3.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.3.2.1.cmml" xref="S3.SS3.p1.2.m2.2.3.2">superscript</csymbol><apply id="S3.SS3.p1.2.m2.2.3.2.2.cmml" xref="S3.SS3.p1.2.m2.2.3.2.2"><ci id="S3.SS3.p1.2.m2.2.3.2.2.1.cmml" xref="S3.SS3.p1.2.m2.2.3.2.2.1">~</ci><ci id="S3.SS3.p1.2.m2.2.3.2.2.2.cmml" xref="S3.SS3.p1.2.m2.2.3.2.2.2">𝑧</ci></apply><ci id="S3.SS3.p1.2.m2.2.3.2.3.cmml" xref="S3.SS3.p1.2.m2.2.3.2.3">𝑞</ci></apply><apply id="S3.SS3.p1.2.m2.2.3.4.cmml" xref="S3.SS3.p1.2.m2.2.3.4"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.3.4.1.cmml" xref="S3.SS3.p1.2.m2.2.3.4">superscript</csymbol><apply id="S3.SS3.p1.2.m2.2.3.4.2.cmml" xref="S3.SS3.p1.2.m2.2.3.4"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.3.4.2.1.cmml" xref="S3.SS3.p1.2.m2.2.3.4">subscript</csymbol><set id="S3.SS3.p1.2.m2.2.3.4.2.2.1.cmml" xref="S3.SS3.p1.2.m2.2.3.4.2.2.2"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><ci id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1.1">~</ci><apply id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2.2">𝐾</ci><ci id="S3.SS3.p1.2.m2.1.1.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3">𝑖</ci></apply></apply><apply id="S3.SS3.p1.2.m2.2.2.cmml" xref="S3.SS3.p1.2.m2.2.2"><ci id="S3.SS3.p1.2.m2.2.2.1.cmml" xref="S3.SS3.p1.2.m2.2.2.1">~</ci><apply id="S3.SS3.p1.2.m2.2.2.2.cmml" xref="S3.SS3.p1.2.m2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.2.2.1.cmml" xref="S3.SS3.p1.2.m2.2.2.2">subscript</csymbol><ci id="S3.SS3.p1.2.m2.2.2.2.2.cmml" xref="S3.SS3.p1.2.m2.2.2.2.2">𝑉</ci><ci id="S3.SS3.p1.2.m2.2.2.2.3.cmml" xref="S3.SS3.p1.2.m2.2.2.2.3">𝑖</ci></apply></apply></set><apply id="S3.SS3.p1.2.m2.2.3.4.2.3.cmml" xref="S3.SS3.p1.2.m2.2.3.4.2.3"><eq id="S3.SS3.p1.2.m2.2.3.4.2.3.1.cmml" xref="S3.SS3.p1.2.m2.2.3.4.2.3.1"></eq><ci id="S3.SS3.p1.2.m2.2.3.4.2.3.2.cmml" xref="S3.SS3.p1.2.m2.2.3.4.2.3.2">𝑖</ci><cn id="S3.SS3.p1.2.m2.2.3.4.2.3.3.cmml" type="integer" xref="S3.SS3.p1.2.m2.2.3.4.2.3.3">1</cn></apply></apply><ci id="S3.SS3.p1.2.m2.2.3.4.3.cmml" xref="S3.SS3.p1.2.m2.2.3.4.3">𝜔</ci></apply></apply><apply id="S3.SS3.p1.2.m2.2.3c.cmml" xref="S3.SS3.p1.2.m2.2.3"><in id="S3.SS3.p1.2.m2.2.3.5.cmml" xref="S3.SS3.p1.2.m2.2.3.5"></in><share href="https://arxiv.org/html/2408.16967v1#S3.SS3.p1.2.m2.2.3.4.cmml" id="S3.SS3.p1.2.m2.2.3d.cmml" xref="S3.SS3.p1.2.m2.2.3"></share><apply id="S3.SS3.p1.2.m2.2.3.6.cmml" xref="S3.SS3.p1.2.m2.2.3.6"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.3.6.1.cmml" xref="S3.SS3.p1.2.m2.2.3.6">superscript</csymbol><ci id="S3.SS3.p1.2.m2.2.3.6.2.cmml" xref="S3.SS3.p1.2.m2.2.3.6.2">ℝ</ci><apply id="S3.SS3.p1.2.m2.2.3.6.3.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3"><times id="S3.SS3.p1.2.m2.2.3.6.3.1.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.1"></times><ci id="S3.SS3.p1.2.m2.2.3.6.3.2.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.2">𝑘</ci><ci id="S3.SS3.p1.2.m2.2.3.6.3.3.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.3">𝜏</ci><apply id="S3.SS3.p1.2.m2.2.3.6.3.4.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.2.3.6.3.4.1.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4">subscript</csymbol><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.2.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.2">𝑑</ci><apply id="S3.SS3.p1.2.m2.2.3.6.3.4.3.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3"><times id="S3.SS3.p1.2.m2.2.3.6.3.4.3.1.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.1"></times><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.3.2.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.2">𝑚</ci><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.3.3.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.3">𝑜</ci><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.3.4.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.4">𝑑</ci><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.3.5.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.5">𝑒</ci><ci id="S3.SS3.p1.2.m2.2.3.6.3.4.3.6.cmml" xref="S3.SS3.p1.2.m2.2.3.6.3.4.3.6">𝑙</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.2c">{\tilde{z}}^{q}={\{\tilde{K_{i}},\tilde{V_{i}}\}}_{i=1}^{\omega}\in\mathbb{R}^%
{k\times\tau\times d_{model}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.2d">over~ start_ARG italic_z end_ARG start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT = { over~ start_ARG italic_K start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG , over~ start_ARG italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_ω end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_k × italic_τ × italic_d start_POSTSUBSCRIPT italic_m italic_o italic_d italic_e italic_l end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>, the output hidden state for the next layer <math alttext="H^{l}" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1"><semantics id="S3.SS3.p1.3.m3.1a"><msup id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml"><mi id="S3.SS3.p1.3.m3.1.1.2" xref="S3.SS3.p1.3.m3.1.1.2.cmml">H</mi><mi id="S3.SS3.p1.3.m3.1.1.3" xref="S3.SS3.p1.3.m3.1.1.3.cmml">l</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b"><apply id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.3.m3.1.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">superscript</csymbol><ci id="S3.SS3.p1.3.m3.1.1.2.cmml" xref="S3.SS3.p1.3.m3.1.1.2">𝐻</ci><ci id="S3.SS3.p1.3.m3.1.1.3.cmml" xref="S3.SS3.p1.3.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">H^{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.3.m3.1d">italic_H start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> is computed as:</p>
<table class="ltx_equationgroup ltx_eqn_gather ltx_eqn_table" id="A1.EGx2">
<tbody id="S3.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\displaystyle S_{a}=\mathtt{Softmax}{\left(\frac{QK^{T}}{d}\right)}" class="ltx_Math" display="block" id="S3.E2.m1.1"><semantics id="S3.E2.m1.1a"><mrow id="S3.E2.m1.1.2" xref="S3.E2.m1.1.2.cmml"><msub id="S3.E2.m1.1.2.2" xref="S3.E2.m1.1.2.2.cmml"><mi id="S3.E2.m1.1.2.2.2" xref="S3.E2.m1.1.2.2.2.cmml">S</mi><mi id="S3.E2.m1.1.2.2.3" xref="S3.E2.m1.1.2.2.3.cmml">a</mi></msub><mo id="S3.E2.m1.1.2.1" xref="S3.E2.m1.1.2.1.cmml">=</mo><mrow id="S3.E2.m1.1.2.3" xref="S3.E2.m1.1.2.3.cmml"><mi id="S3.E2.m1.1.2.3.2" xref="S3.E2.m1.1.2.3.2.cmml">𝚂𝚘𝚏𝚝𝚖𝚊𝚡</mi><mo id="S3.E2.m1.1.2.3.1" xref="S3.E2.m1.1.2.3.1.cmml">⁢</mo><mrow id="S3.E2.m1.1.2.3.3.2" xref="S3.E2.m1.1.1.cmml"><mo id="S3.E2.m1.1.2.3.3.2.1" xref="S3.E2.m1.1.1.cmml">(</mo><mfrac id="S3.E2.m1.1.1" xref="S3.E2.m1.1.1.cmml"><mrow id="S3.E2.m1.1.1.2" xref="S3.E2.m1.1.1.2.cmml"><mi id="S3.E2.m1.1.1.2.2" xref="S3.E2.m1.1.1.2.2.cmml">Q</mi><mo id="S3.E2.m1.1.1.2.1" xref="S3.E2.m1.1.1.2.1.cmml">⁢</mo><msup id="S3.E2.m1.1.1.2.3" xref="S3.E2.m1.1.1.2.3.cmml"><mi id="S3.E2.m1.1.1.2.3.2" xref="S3.E2.m1.1.1.2.3.2.cmml">K</mi><mi id="S3.E2.m1.1.1.2.3.3" xref="S3.E2.m1.1.1.2.3.3.cmml">T</mi></msup></mrow><mi id="S3.E2.m1.1.1.3" xref="S3.E2.m1.1.1.3.cmml">d</mi></mfrac><mo id="S3.E2.m1.1.2.3.3.2.2" xref="S3.E2.m1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.1b"><apply id="S3.E2.m1.1.2.cmml" xref="S3.E2.m1.1.2"><eq id="S3.E2.m1.1.2.1.cmml" xref="S3.E2.m1.1.2.1"></eq><apply id="S3.E2.m1.1.2.2.cmml" xref="S3.E2.m1.1.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.1.2.2.1.cmml" xref="S3.E2.m1.1.2.2">subscript</csymbol><ci id="S3.E2.m1.1.2.2.2.cmml" xref="S3.E2.m1.1.2.2.2">𝑆</ci><ci id="S3.E2.m1.1.2.2.3.cmml" xref="S3.E2.m1.1.2.2.3">𝑎</ci></apply><apply id="S3.E2.m1.1.2.3.cmml" xref="S3.E2.m1.1.2.3"><times id="S3.E2.m1.1.2.3.1.cmml" xref="S3.E2.m1.1.2.3.1"></times><ci id="S3.E2.m1.1.2.3.2.cmml" xref="S3.E2.m1.1.2.3.2">𝚂𝚘𝚏𝚝𝚖𝚊𝚡</ci><apply id="S3.E2.m1.1.1.cmml" xref="S3.E2.m1.1.2.3.3.2"><divide id="S3.E2.m1.1.1.1.cmml" xref="S3.E2.m1.1.2.3.3.2"></divide><apply id="S3.E2.m1.1.1.2.cmml" xref="S3.E2.m1.1.1.2"><times id="S3.E2.m1.1.1.2.1.cmml" xref="S3.E2.m1.1.1.2.1"></times><ci id="S3.E2.m1.1.1.2.2.cmml" xref="S3.E2.m1.1.1.2.2">𝑄</ci><apply id="S3.E2.m1.1.1.2.3.cmml" xref="S3.E2.m1.1.1.2.3"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.2.3.1.cmml" xref="S3.E2.m1.1.1.2.3">superscript</csymbol><ci id="S3.E2.m1.1.1.2.3.2.cmml" xref="S3.E2.m1.1.1.2.3.2">𝐾</ci><ci id="S3.E2.m1.1.1.2.3.3.cmml" xref="S3.E2.m1.1.1.2.3.3">𝑇</ci></apply></apply><ci id="S3.E2.m1.1.1.3.cmml" xref="S3.E2.m1.1.1.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.1c">\displaystyle S_{a}=\mathtt{Softmax}{\left(\frac{QK^{T}}{d}\right)}</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.1d">italic_S start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT = typewriter_Softmax ( divide start_ARG italic_Q italic_K start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT end_ARG start_ARG italic_d end_ARG )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
<tbody id="S3.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\displaystyle S_{m}=\mathtt{Concat}{\left\{\mathtt{Softmax}(\mathbf{{\tilde{z}%
}^{q}_{i}})\right\}}_{i=1}^{\omega}" class="ltx_Math" display="block" id="S3.E3.m1.1"><semantics id="S3.E3.m1.1a"><mrow id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml"><msub id="S3.E3.m1.1.1.3" xref="S3.E3.m1.1.1.3.cmml"><mi id="S3.E3.m1.1.1.3.2" xref="S3.E3.m1.1.1.3.2.cmml">S</mi><mi id="S3.E3.m1.1.1.3.3" xref="S3.E3.m1.1.1.3.3.cmml">m</mi></msub><mo id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml">=</mo><mrow id="S3.E3.m1.1.1.1" xref="S3.E3.m1.1.1.1.cmml"><mi id="S3.E3.m1.1.1.1.3" xref="S3.E3.m1.1.1.1.3.cmml">𝙲𝚘𝚗𝚌𝚊𝚝</mi><mo id="S3.E3.m1.1.1.1.2" xref="S3.E3.m1.1.1.1.2.cmml">⁢</mo><msubsup id="S3.E3.m1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.cmml"><mrow id="S3.E3.m1.1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.2.cmml"><mo id="S3.E3.m1.1.1.1.1.1.1.1.2" xref="S3.E3.m1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="S3.E3.m1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E3.m1.1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.1.1.1.1.3.cmml">𝚂𝚘𝚏𝚝𝚖𝚊𝚡</mi><mo id="S3.E3.m1.1.1.1.1.1.1.1.1.2" xref="S3.E3.m1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msubsup id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">𝐳</mi><mo id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.1" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml">~</mo></mover><mi id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">𝐢</mi><mi id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.3" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml">𝐪</mi></msubsup><mo id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S3.E3.m1.1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.1.3.cmml"><mi id="S3.E3.m1.1.1.1.1.1.3.2" xref="S3.E3.m1.1.1.1.1.1.3.2.cmml">i</mi><mo id="S3.E3.m1.1.1.1.1.1.3.1" xref="S3.E3.m1.1.1.1.1.1.3.1.cmml">=</mo><mn id="S3.E3.m1.1.1.1.1.1.3.3" xref="S3.E3.m1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="S3.E3.m1.1.1.1.1.3" xref="S3.E3.m1.1.1.1.1.3.cmml">ω</mi></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.1b"><apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.1.1"><eq id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2"></eq><apply id="S3.E3.m1.1.1.3.cmml" xref="S3.E3.m1.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.1.cmml" xref="S3.E3.m1.1.1.3">subscript</csymbol><ci id="S3.E3.m1.1.1.3.2.cmml" xref="S3.E3.m1.1.1.3.2">𝑆</ci><ci id="S3.E3.m1.1.1.3.3.cmml" xref="S3.E3.m1.1.1.3.3">𝑚</ci></apply><apply id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1"><times id="S3.E3.m1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.2"></times><ci id="S3.E3.m1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.3">𝙲𝚘𝚗𝚌𝚊𝚝</ci><apply id="S3.E3.m1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1">superscript</csymbol><apply id="S3.E3.m1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1">subscript</csymbol><set id="S3.E3.m1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1"><apply id="S3.E3.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1"><times id="S3.E3.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.2"></times><ci id="S3.E3.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.3">𝚂𝚘𝚏𝚝𝚖𝚊𝚡</ci><apply id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2"><ci id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.1">~</ci><ci id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.2.2">𝐳</ci></apply><ci id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.2.3">𝐪</ci></apply><ci id="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.1.1.1.1.1.1.1.1.3">𝐢</ci></apply></apply></set><apply id="S3.E3.m1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.1.1.3"><eq id="S3.E3.m1.1.1.1.1.1.3.1.cmml" xref="S3.E3.m1.1.1.1.1.1.3.1"></eq><ci id="S3.E3.m1.1.1.1.1.1.3.2.cmml" xref="S3.E3.m1.1.1.1.1.1.3.2">𝑖</ci><cn id="S3.E3.m1.1.1.1.1.1.3.3.cmml" type="integer" xref="S3.E3.m1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="S3.E3.m1.1.1.1.1.3.cmml" xref="S3.E3.m1.1.1.1.1.3">𝜔</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.1c">\displaystyle S_{m}=\mathtt{Concat}{\left\{\mathtt{Softmax}(\mathbf{{\tilde{z}%
}^{q}_{i}})\right\}}_{i=1}^{\omega}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.1d">italic_S start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT = typewriter_Concat { typewriter_Softmax ( over~ start_ARG bold_z end_ARG start_POSTSUPERSCRIPT bold_q end_POSTSUPERSCRIPT start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_ω end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p1.4">To avoid the interference caused by the retrieval attention scores <math alttext="S_{m}" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m1.1"><semantics id="S3.SS3.p1.4.m1.1a"><msub id="S3.SS3.p1.4.m1.1.1" xref="S3.SS3.p1.4.m1.1.1.cmml"><mi id="S3.SS3.p1.4.m1.1.1.2" xref="S3.SS3.p1.4.m1.1.1.2.cmml">S</mi><mi id="S3.SS3.p1.4.m1.1.1.3" xref="S3.SS3.p1.4.m1.1.1.3.cmml">m</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m1.1b"><apply id="S3.SS3.p1.4.m1.1.1.cmml" xref="S3.SS3.p1.4.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m1.1.1.1.cmml" xref="S3.SS3.p1.4.m1.1.1">subscript</csymbol><ci id="S3.SS3.p1.4.m1.1.1.2.cmml" xref="S3.SS3.p1.4.m1.1.1.2">𝑆</ci><ci id="S3.SS3.p1.4.m1.1.1.3.cmml" xref="S3.SS3.p1.4.m1.1.1.3">𝑚</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.4.m1.1c">S_{m}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.4.m1.1d">italic_S start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math> at the initial stage of training, we adopt a multi-head attention mechanism following the approach of the LLaMA-adapter<cite class="ltx_cite ltx_citemacro_cite">Zhang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib40" title="">2023b</a>)</cite> :</p>
<table class="ltx_equationgroup ltx_eqn_gather ltx_eqn_table" id="A1.EGx3">
<tbody id="S3.E4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\displaystyle S_{l}^{g}={\left[(S_{m})\cdot g_{l};(S_{a})\right]}^{T}" class="ltx_Math" display="block" id="S3.E4.m1.2"><semantics id="S3.E4.m1.2a"><mrow id="S3.E4.m1.2.2" xref="S3.E4.m1.2.2.cmml"><msubsup id="S3.E4.m1.2.2.4" xref="S3.E4.m1.2.2.4.cmml"><mi id="S3.E4.m1.2.2.4.2.2" xref="S3.E4.m1.2.2.4.2.2.cmml">S</mi><mi id="S3.E4.m1.2.2.4.2.3" xref="S3.E4.m1.2.2.4.2.3.cmml">l</mi><mi id="S3.E4.m1.2.2.4.3" xref="S3.E4.m1.2.2.4.3.cmml">g</mi></msubsup><mo id="S3.E4.m1.2.2.3" xref="S3.E4.m1.2.2.3.cmml">=</mo><msup id="S3.E4.m1.2.2.2" xref="S3.E4.m1.2.2.2.cmml"><mrow id="S3.E4.m1.2.2.2.2.2" xref="S3.E4.m1.2.2.2.2.3.cmml"><mo id="S3.E4.m1.2.2.2.2.2.3" xref="S3.E4.m1.2.2.2.2.3.cmml">[</mo><mrow id="S3.E4.m1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.cmml"><mrow id="S3.E4.m1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E4.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E4.m1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.2.cmml">S</mi><mi id="S3.E4.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.3.cmml">m</mi></msub><mo id="S3.E4.m1.1.1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E4.m1.1.1.1.1.1.1.2" rspace="0.222em" xref="S3.E4.m1.1.1.1.1.1.1.2.cmml">⋅</mo><msub id="S3.E4.m1.1.1.1.1.1.1.3" xref="S3.E4.m1.1.1.1.1.1.1.3.cmml"><mi id="S3.E4.m1.1.1.1.1.1.1.3.2" xref="S3.E4.m1.1.1.1.1.1.1.3.2.cmml">g</mi><mi id="S3.E4.m1.1.1.1.1.1.1.3.3" xref="S3.E4.m1.1.1.1.1.1.1.3.3.cmml">l</mi></msub></mrow><mo id="S3.E4.m1.2.2.2.2.2.4" xref="S3.E4.m1.2.2.2.2.3.cmml">;</mo><mrow id="S3.E4.m1.2.2.2.2.2.2.1" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml"><mo id="S3.E4.m1.2.2.2.2.2.2.1.2" stretchy="false" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml">(</mo><msub id="S3.E4.m1.2.2.2.2.2.2.1.1" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml"><mi id="S3.E4.m1.2.2.2.2.2.2.1.1.2" xref="S3.E4.m1.2.2.2.2.2.2.1.1.2.cmml">S</mi><mi id="S3.E4.m1.2.2.2.2.2.2.1.1.3" xref="S3.E4.m1.2.2.2.2.2.2.1.1.3.cmml">a</mi></msub><mo id="S3.E4.m1.2.2.2.2.2.2.1.3" stretchy="false" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml">)</mo></mrow><mo id="S3.E4.m1.2.2.2.2.2.5" xref="S3.E4.m1.2.2.2.2.3.cmml">]</mo></mrow><mi id="S3.E4.m1.2.2.2.4" xref="S3.E4.m1.2.2.2.4.cmml">T</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.2b"><apply id="S3.E4.m1.2.2.cmml" xref="S3.E4.m1.2.2"><eq id="S3.E4.m1.2.2.3.cmml" xref="S3.E4.m1.2.2.3"></eq><apply id="S3.E4.m1.2.2.4.cmml" xref="S3.E4.m1.2.2.4"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.4.1.cmml" xref="S3.E4.m1.2.2.4">superscript</csymbol><apply id="S3.E4.m1.2.2.4.2.cmml" xref="S3.E4.m1.2.2.4"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.4.2.1.cmml" xref="S3.E4.m1.2.2.4">subscript</csymbol><ci id="S3.E4.m1.2.2.4.2.2.cmml" xref="S3.E4.m1.2.2.4.2.2">𝑆</ci><ci id="S3.E4.m1.2.2.4.2.3.cmml" xref="S3.E4.m1.2.2.4.2.3">𝑙</ci></apply><ci id="S3.E4.m1.2.2.4.3.cmml" xref="S3.E4.m1.2.2.4.3">𝑔</ci></apply><apply id="S3.E4.m1.2.2.2.cmml" xref="S3.E4.m1.2.2.2"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.2.3.cmml" xref="S3.E4.m1.2.2.2">superscript</csymbol><list id="S3.E4.m1.2.2.2.2.3.cmml" xref="S3.E4.m1.2.2.2.2.2"><apply id="S3.E4.m1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1"><ci id="S3.E4.m1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.2">⋅</ci><apply id="S3.E4.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E4.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.2">𝑆</ci><ci id="S3.E4.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.1.1.1.3">𝑚</ci></apply><apply id="S3.E4.m1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E4.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E4.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3.2">𝑔</ci><ci id="S3.E4.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.E4.m1.1.1.1.1.1.1.3.3">𝑙</ci></apply></apply><apply id="S3.E4.m1.2.2.2.2.2.2.1.1.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1"><csymbol cd="ambiguous" id="S3.E4.m1.2.2.2.2.2.2.1.1.1.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1">subscript</csymbol><ci id="S3.E4.m1.2.2.2.2.2.2.1.1.2.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.1.2">𝑆</ci><ci id="S3.E4.m1.2.2.2.2.2.2.1.1.3.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.1.3">𝑎</ci></apply></list><ci id="S3.E4.m1.2.2.2.4.cmml" xref="S3.E4.m1.2.2.2.4">𝑇</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.2c">\displaystyle S_{l}^{g}={\left[(S_{m})\cdot g_{l};(S_{a})\right]}^{T}</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.2d">italic_S start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g end_POSTSUPERSCRIPT = [ ( italic_S start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT ) ⋅ italic_g start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ; ( italic_S start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT ) ] start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p1.7">Finally, we concatenate the <math alttext="\tilde{V}" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m1.1"><semantics id="S3.SS3.p1.5.m1.1a"><mover accent="true" id="S3.SS3.p1.5.m1.1.1" xref="S3.SS3.p1.5.m1.1.1.cmml"><mi id="S3.SS3.p1.5.m1.1.1.2" xref="S3.SS3.p1.5.m1.1.1.2.cmml">V</mi><mo id="S3.SS3.p1.5.m1.1.1.1" xref="S3.SS3.p1.5.m1.1.1.1.cmml">~</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m1.1b"><apply id="S3.SS3.p1.5.m1.1.1.cmml" xref="S3.SS3.p1.5.m1.1.1"><ci id="S3.SS3.p1.5.m1.1.1.1.cmml" xref="S3.SS3.p1.5.m1.1.1.1">~</ci><ci id="S3.SS3.p1.5.m1.1.1.2.cmml" xref="S3.SS3.p1.5.m1.1.1.2">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.5.m1.1c">\tilde{V}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.5.m1.1d">over~ start_ARG italic_V end_ARG</annotation></semantics></math> and <math alttext="V" class="ltx_Math" display="inline" id="S3.SS3.p1.6.m2.1"><semantics id="S3.SS3.p1.6.m2.1a"><mi id="S3.SS3.p1.6.m2.1.1" xref="S3.SS3.p1.6.m2.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.6.m2.1b"><ci id="S3.SS3.p1.6.m2.1.1.cmml" xref="S3.SS3.p1.6.m2.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.6.m2.1c">V</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.6.m2.1d">italic_V</annotation></semantics></math> to obtain <math alttext="H^{l}" class="ltx_Math" display="inline" id="S3.SS3.p1.7.m3.1"><semantics id="S3.SS3.p1.7.m3.1a"><msup id="S3.SS3.p1.7.m3.1.1" xref="S3.SS3.p1.7.m3.1.1.cmml"><mi id="S3.SS3.p1.7.m3.1.1.2" xref="S3.SS3.p1.7.m3.1.1.2.cmml">H</mi><mi id="S3.SS3.p1.7.m3.1.1.3" xref="S3.SS3.p1.7.m3.1.1.3.cmml">l</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.7.m3.1b"><apply id="S3.SS3.p1.7.m3.1.1.cmml" xref="S3.SS3.p1.7.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.7.m3.1.1.1.cmml" xref="S3.SS3.p1.7.m3.1.1">superscript</csymbol><ci id="S3.SS3.p1.7.m3.1.1.2.cmml" xref="S3.SS3.p1.7.m3.1.1.2">𝐻</ci><ci id="S3.SS3.p1.7.m3.1.1.3.cmml" xref="S3.SS3.p1.7.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.7.m3.1c">H^{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.7.m3.1d">italic_H start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equationgroup ltx_eqn_gather ltx_eqn_table" id="A1.EGx4">
<tbody id="S3.E5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\displaystyle V_{l}={\left[\tilde{V}_{c};V_{i}\right]},H^{l}=S_{l}^{g}V_{l}" class="ltx_Math" display="block" id="S3.E5.m1.2"><semantics id="S3.E5.m1.2a"><mrow id="S3.E5.m1.2.2.2" xref="S3.E5.m1.2.2.3.cmml"><mrow id="S3.E5.m1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml"><msub id="S3.E5.m1.1.1.1.1.4" xref="S3.E5.m1.1.1.1.1.4.cmml"><mi id="S3.E5.m1.1.1.1.1.4.2" xref="S3.E5.m1.1.1.1.1.4.2.cmml">V</mi><mi id="S3.E5.m1.1.1.1.1.4.3" xref="S3.E5.m1.1.1.1.1.4.3.cmml">l</mi></msub><mo id="S3.E5.m1.1.1.1.1.3" xref="S3.E5.m1.1.1.1.1.3.cmml">=</mo><mrow id="S3.E5.m1.1.1.1.1.2.2" xref="S3.E5.m1.1.1.1.1.2.3.cmml"><mo id="S3.E5.m1.1.1.1.1.2.2.3" xref="S3.E5.m1.1.1.1.1.2.3.cmml">[</mo><msub id="S3.E5.m1.1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E5.m1.1.1.1.1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E5.m1.1.1.1.1.1.1.1.2.2" xref="S3.E5.m1.1.1.1.1.1.1.1.2.2.cmml">V</mi><mo id="S3.E5.m1.1.1.1.1.1.1.1.2.1" xref="S3.E5.m1.1.1.1.1.1.1.1.2.1.cmml">~</mo></mover><mi id="S3.E5.m1.1.1.1.1.1.1.1.3" xref="S3.E5.m1.1.1.1.1.1.1.1.3.cmml">c</mi></msub><mo id="S3.E5.m1.1.1.1.1.2.2.4" xref="S3.E5.m1.1.1.1.1.2.3.cmml">;</mo><msub id="S3.E5.m1.1.1.1.1.2.2.2" xref="S3.E5.m1.1.1.1.1.2.2.2.cmml"><mi id="S3.E5.m1.1.1.1.1.2.2.2.2" xref="S3.E5.m1.1.1.1.1.2.2.2.2.cmml">V</mi><mi id="S3.E5.m1.1.1.1.1.2.2.2.3" xref="S3.E5.m1.1.1.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S3.E5.m1.1.1.1.1.2.2.5" xref="S3.E5.m1.1.1.1.1.2.3.cmml">]</mo></mrow></mrow><mo id="S3.E5.m1.2.2.2.3" xref="S3.E5.m1.2.2.3a.cmml">,</mo><mrow id="S3.E5.m1.2.2.2.2" xref="S3.E5.m1.2.2.2.2.cmml"><msup id="S3.E5.m1.2.2.2.2.2" xref="S3.E5.m1.2.2.2.2.2.cmml"><mi id="S3.E5.m1.2.2.2.2.2.2" xref="S3.E5.m1.2.2.2.2.2.2.cmml">H</mi><mi id="S3.E5.m1.2.2.2.2.2.3" xref="S3.E5.m1.2.2.2.2.2.3.cmml">l</mi></msup><mo id="S3.E5.m1.2.2.2.2.1" xref="S3.E5.m1.2.2.2.2.1.cmml">=</mo><mrow id="S3.E5.m1.2.2.2.2.3" xref="S3.E5.m1.2.2.2.2.3.cmml"><msubsup id="S3.E5.m1.2.2.2.2.3.2" xref="S3.E5.m1.2.2.2.2.3.2.cmml"><mi id="S3.E5.m1.2.2.2.2.3.2.2.2" xref="S3.E5.m1.2.2.2.2.3.2.2.2.cmml">S</mi><mi id="S3.E5.m1.2.2.2.2.3.2.2.3" xref="S3.E5.m1.2.2.2.2.3.2.2.3.cmml">l</mi><mi id="S3.E5.m1.2.2.2.2.3.2.3" xref="S3.E5.m1.2.2.2.2.3.2.3.cmml">g</mi></msubsup><mo id="S3.E5.m1.2.2.2.2.3.1" xref="S3.E5.m1.2.2.2.2.3.1.cmml">⁢</mo><msub id="S3.E5.m1.2.2.2.2.3.3" xref="S3.E5.m1.2.2.2.2.3.3.cmml"><mi id="S3.E5.m1.2.2.2.2.3.3.2" xref="S3.E5.m1.2.2.2.2.3.3.2.cmml">V</mi><mi id="S3.E5.m1.2.2.2.2.3.3.3" xref="S3.E5.m1.2.2.2.2.3.3.3.cmml">l</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.2b"><apply id="S3.E5.m1.2.2.3.cmml" xref="S3.E5.m1.2.2.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.3a.cmml" xref="S3.E5.m1.2.2.2.3">formulae-sequence</csymbol><apply id="S3.E5.m1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1"><eq id="S3.E5.m1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.3"></eq><apply id="S3.E5.m1.1.1.1.1.4.cmml" xref="S3.E5.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.4.1.cmml" xref="S3.E5.m1.1.1.1.1.4">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.4.2.cmml" xref="S3.E5.m1.1.1.1.1.4.2">𝑉</ci><ci id="S3.E5.m1.1.1.1.1.4.3.cmml" xref="S3.E5.m1.1.1.1.1.4.3">𝑙</ci></apply><list id="S3.E5.m1.1.1.1.1.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2"><apply id="S3.E5.m1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E5.m1.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.2"><ci id="S3.E5.m1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.2.1">~</ci><ci id="S3.E5.m1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.2.2">𝑉</ci></apply><ci id="S3.E5.m1.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.3">𝑐</ci></apply><apply id="S3.E5.m1.1.1.1.1.2.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.2.2.2.1.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2">𝑉</ci><ci id="S3.E5.m1.1.1.1.1.2.2.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.3">𝑖</ci></apply></list></apply><apply id="S3.E5.m1.2.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2"><eq id="S3.E5.m1.2.2.2.2.1.cmml" xref="S3.E5.m1.2.2.2.2.1"></eq><apply id="S3.E5.m1.2.2.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.2.1.cmml" xref="S3.E5.m1.2.2.2.2.2">superscript</csymbol><ci id="S3.E5.m1.2.2.2.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2.2">𝐻</ci><ci id="S3.E5.m1.2.2.2.2.2.3.cmml" xref="S3.E5.m1.2.2.2.2.2.3">𝑙</ci></apply><apply id="S3.E5.m1.2.2.2.2.3.cmml" xref="S3.E5.m1.2.2.2.2.3"><times id="S3.E5.m1.2.2.2.2.3.1.cmml" xref="S3.E5.m1.2.2.2.2.3.1"></times><apply id="S3.E5.m1.2.2.2.2.3.2.cmml" xref="S3.E5.m1.2.2.2.2.3.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.3.2.1.cmml" xref="S3.E5.m1.2.2.2.2.3.2">superscript</csymbol><apply id="S3.E5.m1.2.2.2.2.3.2.2.cmml" xref="S3.E5.m1.2.2.2.2.3.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.3.2.2.1.cmml" xref="S3.E5.m1.2.2.2.2.3.2">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.3.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2.3.2.2.2">𝑆</ci><ci id="S3.E5.m1.2.2.2.2.3.2.2.3.cmml" xref="S3.E5.m1.2.2.2.2.3.2.2.3">𝑙</ci></apply><ci id="S3.E5.m1.2.2.2.2.3.2.3.cmml" xref="S3.E5.m1.2.2.2.2.3.2.3">𝑔</ci></apply><apply id="S3.E5.m1.2.2.2.2.3.3.cmml" xref="S3.E5.m1.2.2.2.2.3.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.2.2.3.3.1.cmml" xref="S3.E5.m1.2.2.2.2.3.3">subscript</csymbol><ci id="S3.E5.m1.2.2.2.2.3.3.2.cmml" xref="S3.E5.m1.2.2.2.2.3.3.2">𝑉</ci><ci id="S3.E5.m1.2.2.2.2.3.3.3.cmml" xref="S3.E5.m1.2.2.2.2.3.3.3">𝑙</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.2c">\displaystyle V_{l}={\left[\tilde{V}_{c};V_{i}\right]},H^{l}=S_{l}^{g}V_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.2d">italic_V start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT = [ over~ start_ARG italic_V end_ARG start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT ; italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] , italic_H start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = italic_S start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g end_POSTSUPERSCRIPT italic_V start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>Inference with MemLong</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.2">When MemLong receives an input exceeding the length, we treat it as two segments: the <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.2.1">prefix</span> and the <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.2.2">main</span>.
We will separately describe the encoding of long inputs and the generation of long outputs during the inference phase.
When MemLong receives long inputs, it first divides the <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.2.3">prefix</span> into multiple non-overlapping chunks and computes the from its <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.2.4">memory layer</span>, which ensures that the number of tokens involved in the attention is equal to the chunk size, which is much smaller than the length of the input. It is important to note that each chunk is interrelated (e.g., the <math alttext="t" class="ltx_Math" display="inline" id="S3.SS4.p1.1.m1.1"><semantics id="S3.SS4.p1.1.m1.1a"><mi id="S3.SS4.p1.1.m1.1.1" xref="S3.SS4.p1.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.1.m1.1b"><ci id="S3.SS4.p1.1.m1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.1.m1.1c">t</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.1.m1.1d">italic_t</annotation></semantics></math>-th chunk needs to process the of the previous <math alttext="t-1" class="ltx_Math" display="inline" id="S3.SS4.p1.2.m2.1"><semantics id="S3.SS4.p1.2.m2.1a"><mrow id="S3.SS4.p1.2.m2.1.1" xref="S3.SS4.p1.2.m2.1.1.cmml"><mi id="S3.SS4.p1.2.m2.1.1.2" xref="S3.SS4.p1.2.m2.1.1.2.cmml">t</mi><mo id="S3.SS4.p1.2.m2.1.1.1" xref="S3.SS4.p1.2.m2.1.1.1.cmml">−</mo><mn id="S3.SS4.p1.2.m2.1.1.3" xref="S3.SS4.p1.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.2.m2.1b"><apply id="S3.SS4.p1.2.m2.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1"><minus id="S3.SS4.p1.2.m2.1.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1.1"></minus><ci id="S3.SS4.p1.2.m2.1.1.2.cmml" xref="S3.SS4.p1.2.m2.1.1.2">𝑡</ci><cn id="S3.SS4.p1.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.p1.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.2.m2.1c">t-1</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.2.m2.1d">italic_t - 1</annotation></semantics></math> chunks).</p>
</div>
<div class="ltx_para" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.2">The second step is to select the <math alttext="k" class="ltx_Math" display="inline" id="S3.SS4.p2.1.m1.1"><semantics id="S3.SS4.p2.1.m1.1a"><mi id="S3.SS4.p2.1.m1.1.1" xref="S3.SS4.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.1.m1.1b"><ci id="S3.SS4.p2.1.m1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.1.m1.1d">italic_k</annotation></semantics></math> most relevant chunks for the <span class="ltx_text ltx_font_italic" id="S3.SS4.p2.2.1">main</span> based on chunk-level retrieval representations and to obtain their key and value representations. After this, for the upper retrieval layers, the attention window for retrieval is equivalent to <math alttext="k*\tau" class="ltx_Math" display="inline" id="S3.SS4.p2.2.m2.1"><semantics id="S3.SS4.p2.2.m2.1a"><mrow id="S3.SS4.p2.2.m2.1.1" xref="S3.SS4.p2.2.m2.1.1.cmml"><mi id="S3.SS4.p2.2.m2.1.1.2" xref="S3.SS4.p2.2.m2.1.1.2.cmml">k</mi><mo id="S3.SS4.p2.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS4.p2.2.m2.1.1.1.cmml">∗</mo><mi id="S3.SS4.p2.2.m2.1.1.3" xref="S3.SS4.p2.2.m2.1.1.3.cmml">τ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.2.m2.1b"><apply id="S3.SS4.p2.2.m2.1.1.cmml" xref="S3.SS4.p2.2.m2.1.1"><times id="S3.SS4.p2.2.m2.1.1.1.cmml" xref="S3.SS4.p2.2.m2.1.1.1"></times><ci id="S3.SS4.p2.2.m2.1.1.2.cmml" xref="S3.SS4.p2.2.m2.1.1.2">𝑘</ci><ci id="S3.SS4.p2.2.m2.1.1.3.cmml" xref="S3.SS4.p2.2.m2.1.1.3">𝜏</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.2.m2.1c">k*\tau</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.2.m2.1d">italic_k ∗ italic_τ</annotation></semantics></math>, which is also smaller than the input length. Finally, both length-restricted causal attention and retrieval attention is performed efficiently.</p>
</div>
<figure class="ltx_table" id="S3.T1">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S3.T1.15" style="width:433.6pt;height:153pt;vertical-align:-0.6pt;"><span class="ltx_transformed_inner" style="transform:translate(-141.7pt,49.8pt) scale(0.604741013672372,0.604741013672372) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S3.T1.15.15">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T1.15.15.16.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S3.T1.15.15.16.1.1" style="padding-top:2.5pt;padding-bottom:2.5pt;"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S3.T1.15.15.16.1.2" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.16.1.2.1">PG19</span></td>
<td class="ltx_td ltx_border_tt" id="S3.T1.15.15.16.1.3" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S3.T1.15.15.16.1.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.16.1.4.1">Proof-pile</span></td>
<td class="ltx_td ltx_border_tt" id="S3.T1.15.15.16.1.5" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S3.T1.15.15.16.1.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.16.1.6.1">BookCorpus</span></td>
<td class="ltx_td ltx_border_tt" id="S3.T1.15.15.16.1.7" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S3.T1.15.15.16.1.8" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.16.1.8.1">Wikitext-103</span></td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.17.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.17.2.1" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.17.2.1.1">Model</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">1k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">2k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">4k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">16k</td>
<td class="ltx_td" id="S3.T1.15.15.17.2.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">1k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">2k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">4k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">16k</td>
<td class="ltx_td" id="S3.T1.15.15.17.2.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">1k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">2k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">4k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">16k</td>
<td class="ltx_td" id="S3.T1.15.15.17.2.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">1k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">2k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">4k</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.15.15.17.2.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">16k</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.18.3" style="background-color:#808080;">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="20" id="S3.T1.15.15.18.3.1" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_italic" id="S3.T1.15.15.18.3.1.1" style="background-color:#808080;">7B Model</span></th>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.19.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.19.4.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">LLaMA-2-7B</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.82</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.06</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.92</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.19.4.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.24</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.40</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">2.72</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.19.4.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.73</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.91</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">6.99</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.19.4.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.82</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">6.49</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">5.66</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.19.4.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.20.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.20.5.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">LongLoRA-7B-32k</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.76</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.71</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.37</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.62</td>
<td class="ltx_td" id="S3.T1.15.15.20.5.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.68</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.35</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.23</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">2.60</td>
<td class="ltx_td" id="S3.T1.15.15.20.5.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">14.99</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">12.66</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">11.66</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">6.93</td>
<td class="ltx_td" id="S3.T1.15.15.20.5.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.99</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.83</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.39</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.20.5.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">5.47</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.21.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.21.6.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">YARN-128k-7b</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.22</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.47</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.17</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.21.6.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.03</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.29</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">2.98</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.21.6.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.02</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.54</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.06</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.21.6.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">5.71</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">6.11</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">5.71</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.21.6.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.22.7" style="background-color:#808080;">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="20" id="S3.T1.15.15.22.7.1" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_italic" id="S3.T1.15.15.22.7.1.1" style="background-color:#808080;">3B Model</span></th>
</tr>
<tr class="ltx_tr" id="S3.T1.4.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.4.4.4.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">OpenLLaMA-3B</th>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.6" style="padding-top:2.5pt;padding-bottom:2.5pt;">11.60</td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.77</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.1.1.1" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.1.1.1.1.m1.1"><semantics id="S3.T1.1.1.1.1.m1.1a"><mrow id="S3.T1.1.1.1.1.m1.1.1" xref="S3.T1.1.1.1.1.m1.1.1.cmml"><mi id="S3.T1.1.1.1.1.m1.1.1.2" xref="S3.T1.1.1.1.1.m1.1.1.2.cmml"></mi><mo id="S3.T1.1.1.1.1.m1.1.1.1" xref="S3.T1.1.1.1.1.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.1.1.1.1.m1.1.1.3" xref="S3.T1.1.1.1.1.m1.1.1.3.cmml"><mn id="S3.T1.1.1.1.1.m1.1.1.3.2" xref="S3.T1.1.1.1.1.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.1.1.1.1.m1.1.1.3.3" xref="S3.T1.1.1.1.1.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.1.1.1.1.m1.1b"><apply id="S3.T1.1.1.1.1.m1.1.1.cmml" xref="S3.T1.1.1.1.1.m1.1.1"><gt id="S3.T1.1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.1.1.1.1.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.1.1.1.1.m1.1.1.2.cmml" xref="S3.T1.1.1.1.1.m1.1.1.2">absent</csymbol><apply id="S3.T1.1.1.1.1.m1.1.1.3.cmml" xref="S3.T1.1.1.1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.1.1.1.1.m1.1.1.3.1.cmml" xref="S3.T1.1.1.1.1.m1.1.1.3">superscript</csymbol><cn id="S3.T1.1.1.1.1.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.1.1.1.1.m1.1.1.3.2">10</cn><cn id="S3.T1.1.1.1.1.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.1.1.1.1.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.1.1.1.1.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.1.1.1.1.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.4.4.4.9" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.10" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.4.4.4.10.1">2.96</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.4.4.4.11.1">2.70</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.2.2.2.2" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.2.2.2.2.m1.1"><semantics id="S3.T1.2.2.2.2.m1.1a"><mrow id="S3.T1.2.2.2.2.m1.1.1" xref="S3.T1.2.2.2.2.m1.1.1.cmml"><mi id="S3.T1.2.2.2.2.m1.1.1.2" xref="S3.T1.2.2.2.2.m1.1.1.2.cmml"></mi><mo id="S3.T1.2.2.2.2.m1.1.1.1" xref="S3.T1.2.2.2.2.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.2.2.2.2.m1.1.1.3" xref="S3.T1.2.2.2.2.m1.1.1.3.cmml"><mn id="S3.T1.2.2.2.2.m1.1.1.3.2" xref="S3.T1.2.2.2.2.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.2.2.2.2.m1.1.1.3.3" xref="S3.T1.2.2.2.2.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.2.2.2.2.m1.1b"><apply id="S3.T1.2.2.2.2.m1.1.1.cmml" xref="S3.T1.2.2.2.2.m1.1.1"><gt id="S3.T1.2.2.2.2.m1.1.1.1.cmml" xref="S3.T1.2.2.2.2.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.2.2.2.2.m1.1.1.2.cmml" xref="S3.T1.2.2.2.2.m1.1.1.2">absent</csymbol><apply id="S3.T1.2.2.2.2.m1.1.1.3.cmml" xref="S3.T1.2.2.2.2.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.2.2.2.2.m1.1.1.3.1.cmml" xref="S3.T1.2.2.2.2.m1.1.1.3">superscript</csymbol><cn id="S3.T1.2.2.2.2.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.2.2.2.2.m1.1.1.3.2">10</cn><cn id="S3.T1.2.2.2.2.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.2.2.2.2.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.2.2.2.2.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.2.2.2.2.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.4.4.4.13" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.14" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.4.4.4.14.1">8.97</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.77</td>
<td class="ltx_td ltx_align_center" id="S3.T1.3.3.3.3" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.3.3.3.3.m1.1"><semantics id="S3.T1.3.3.3.3.m1.1a"><mrow id="S3.T1.3.3.3.3.m1.1.1" xref="S3.T1.3.3.3.3.m1.1.1.cmml"><mi id="S3.T1.3.3.3.3.m1.1.1.2" xref="S3.T1.3.3.3.3.m1.1.1.2.cmml"></mi><mo id="S3.T1.3.3.3.3.m1.1.1.1" xref="S3.T1.3.3.3.3.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.3.3.3.3.m1.1.1.3" xref="S3.T1.3.3.3.3.m1.1.1.3.cmml"><mn id="S3.T1.3.3.3.3.m1.1.1.3.2" xref="S3.T1.3.3.3.3.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.3.3.3.3.m1.1.1.3.3" xref="S3.T1.3.3.3.3.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.3.3.3.3.m1.1b"><apply id="S3.T1.3.3.3.3.m1.1.1.cmml" xref="S3.T1.3.3.3.3.m1.1.1"><gt id="S3.T1.3.3.3.3.m1.1.1.1.cmml" xref="S3.T1.3.3.3.3.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.3.3.3.3.m1.1.1.2.cmml" xref="S3.T1.3.3.3.3.m1.1.1.2">absent</csymbol><apply id="S3.T1.3.3.3.3.m1.1.1.3.cmml" xref="S3.T1.3.3.3.3.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.3.3.3.3.m1.1.1.3.1.cmml" xref="S3.T1.3.3.3.3.m1.1.1.3">superscript</csymbol><cn id="S3.T1.3.3.3.3.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.3.3.3.3.m1.1.1.3.2">10</cn><cn id="S3.T1.3.3.3.3.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.3.3.3.3.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.3.3.3.3.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.3.3.3.3.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.16" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.4.4.4.17" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.57</td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.08</td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.4.4.4.4.m1.1"><semantics id="S3.T1.4.4.4.4.m1.1a"><mrow id="S3.T1.4.4.4.4.m1.1.1" xref="S3.T1.4.4.4.4.m1.1.1.cmml"><mi id="S3.T1.4.4.4.4.m1.1.1.2" xref="S3.T1.4.4.4.4.m1.1.1.2.cmml"></mi><mo id="S3.T1.4.4.4.4.m1.1.1.1" xref="S3.T1.4.4.4.4.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.4.4.4.4.m1.1.1.3" xref="S3.T1.4.4.4.4.m1.1.1.3.cmml"><mn id="S3.T1.4.4.4.4.m1.1.1.3.2" xref="S3.T1.4.4.4.4.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.4.4.4.4.m1.1.1.3.3" xref="S3.T1.4.4.4.4.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.4.4.4.4.m1.1b"><apply id="S3.T1.4.4.4.4.m1.1.1.cmml" xref="S3.T1.4.4.4.4.m1.1.1"><gt id="S3.T1.4.4.4.4.m1.1.1.1.cmml" xref="S3.T1.4.4.4.4.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.4.4.4.4.m1.1.1.2.cmml" xref="S3.T1.4.4.4.4.m1.1.1.2">absent</csymbol><apply id="S3.T1.4.4.4.4.m1.1.1.3.cmml" xref="S3.T1.4.4.4.4.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.4.4.4.4.m1.1.1.3.1.cmml" xref="S3.T1.4.4.4.4.m1.1.1.3">superscript</csymbol><cn id="S3.T1.4.4.4.4.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.4.4.4.4.m1.1.1.3.2">10</cn><cn id="S3.T1.4.4.4.4.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.4.4.4.4.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.4.4.4.4.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.4.4.4.4.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.4.4.4.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.9.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.5.5.5.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">LongLLaMA-3B<sup class="ltx_sup" id="S3.T1.5.5.5.1.1">∗</sup>
</th>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.6" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.59</td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.02</td>
<td class="ltx_td ltx_align_center" id="S3.T1.6.6.6.2" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.6.6.6.2.m1.1"><semantics id="S3.T1.6.6.6.2.m1.1a"><mrow id="S3.T1.6.6.6.2.m1.1.1" xref="S3.T1.6.6.6.2.m1.1.1.cmml"><mi id="S3.T1.6.6.6.2.m1.1.1.2" xref="S3.T1.6.6.6.2.m1.1.1.2.cmml"></mi><mo id="S3.T1.6.6.6.2.m1.1.1.1" xref="S3.T1.6.6.6.2.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.6.6.6.2.m1.1.1.3" xref="S3.T1.6.6.6.2.m1.1.1.3.cmml"><mn id="S3.T1.6.6.6.2.m1.1.1.3.2" xref="S3.T1.6.6.6.2.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.6.6.6.2.m1.1.1.3.3" xref="S3.T1.6.6.6.2.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.6.6.6.2.m1.1b"><apply id="S3.T1.6.6.6.2.m1.1.1.cmml" xref="S3.T1.6.6.6.2.m1.1.1"><gt id="S3.T1.6.6.6.2.m1.1.1.1.cmml" xref="S3.T1.6.6.6.2.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.6.6.6.2.m1.1.1.2.cmml" xref="S3.T1.6.6.6.2.m1.1.1.2">absent</csymbol><apply id="S3.T1.6.6.6.2.m1.1.1.3.cmml" xref="S3.T1.6.6.6.2.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.6.6.6.2.m1.1.1.3.1.cmml" xref="S3.T1.6.6.6.2.m1.1.1.3">superscript</csymbol><cn id="S3.T1.6.6.6.2.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.6.6.6.2.m1.1.1.3.2">10</cn><cn id="S3.T1.6.6.6.2.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.6.6.6.2.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.6.6.6.2.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.6.6.6.2.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.9.9.9.9" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.55</td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.11" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.15</td>
<td class="ltx_td ltx_align_center" id="S3.T1.7.7.7.3" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.7.7.7.3.m1.1"><semantics id="S3.T1.7.7.7.3.m1.1a"><mrow id="S3.T1.7.7.7.3.m1.1.1" xref="S3.T1.7.7.7.3.m1.1.1.cmml"><mi id="S3.T1.7.7.7.3.m1.1.1.2" xref="S3.T1.7.7.7.3.m1.1.1.2.cmml"></mi><mo id="S3.T1.7.7.7.3.m1.1.1.1" xref="S3.T1.7.7.7.3.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.7.7.7.3.m1.1.1.3" xref="S3.T1.7.7.7.3.m1.1.1.3.cmml"><mn id="S3.T1.7.7.7.3.m1.1.1.3.2" xref="S3.T1.7.7.7.3.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.7.7.7.3.m1.1.1.3.3" xref="S3.T1.7.7.7.3.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.7.7.7.3.m1.1b"><apply id="S3.T1.7.7.7.3.m1.1.1.cmml" xref="S3.T1.7.7.7.3.m1.1.1"><gt id="S3.T1.7.7.7.3.m1.1.1.1.cmml" xref="S3.T1.7.7.7.3.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.7.7.7.3.m1.1.1.2.cmml" xref="S3.T1.7.7.7.3.m1.1.1.2">absent</csymbol><apply id="S3.T1.7.7.7.3.m1.1.1.3.cmml" xref="S3.T1.7.7.7.3.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.7.7.7.3.m1.1.1.3.1.cmml" xref="S3.T1.7.7.7.3.m1.1.1.3">superscript</csymbol><cn id="S3.T1.7.7.7.3.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.7.7.7.3.m1.1.1.3.2">10</cn><cn id="S3.T1.7.7.7.3.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.7.7.7.3.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.7.7.7.3.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.7.7.7.3.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.9.9.9.13" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.70</td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.83</td>
<td class="ltx_td ltx_align_center" id="S3.T1.8.8.8.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.8.8.8.4.m1.1"><semantics id="S3.T1.8.8.8.4.m1.1a"><mrow id="S3.T1.8.8.8.4.m1.1.1" xref="S3.T1.8.8.8.4.m1.1.1.cmml"><mi id="S3.T1.8.8.8.4.m1.1.1.2" xref="S3.T1.8.8.8.4.m1.1.1.2.cmml"></mi><mo id="S3.T1.8.8.8.4.m1.1.1.1" xref="S3.T1.8.8.8.4.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.8.8.8.4.m1.1.1.3" xref="S3.T1.8.8.8.4.m1.1.1.3.cmml"><mn id="S3.T1.8.8.8.4.m1.1.1.3.2" xref="S3.T1.8.8.8.4.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.8.8.8.4.m1.1.1.3.3" xref="S3.T1.8.8.8.4.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.8.8.8.4.m1.1b"><apply id="S3.T1.8.8.8.4.m1.1.1.cmml" xref="S3.T1.8.8.8.4.m1.1.1"><gt id="S3.T1.8.8.8.4.m1.1.1.1.cmml" xref="S3.T1.8.8.8.4.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.8.8.8.4.m1.1.1.2.cmml" xref="S3.T1.8.8.8.4.m1.1.1.2">absent</csymbol><apply id="S3.T1.8.8.8.4.m1.1.1.3.cmml" xref="S3.T1.8.8.8.4.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.8.8.8.4.m1.1.1.3.1.cmml" xref="S3.T1.8.8.8.4.m1.1.1.3">superscript</csymbol><cn id="S3.T1.8.8.8.4.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.8.8.8.4.m1.1.1.3.2">10</cn><cn id="S3.T1.8.8.8.4.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.8.8.8.4.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.8.8.8.4.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.8.8.8.4.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.16" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.9.9.9.17" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.88</td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.07</td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.5" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.9.9.9.5.m1.1"><semantics id="S3.T1.9.9.9.5.m1.1a"><mrow id="S3.T1.9.9.9.5.m1.1.1" xref="S3.T1.9.9.9.5.m1.1.1.cmml"><mi id="S3.T1.9.9.9.5.m1.1.1.2" xref="S3.T1.9.9.9.5.m1.1.1.2.cmml"></mi><mo id="S3.T1.9.9.9.5.m1.1.1.1" xref="S3.T1.9.9.9.5.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.9.9.9.5.m1.1.1.3" xref="S3.T1.9.9.9.5.m1.1.1.3.cmml"><mn id="S3.T1.9.9.9.5.m1.1.1.3.2" xref="S3.T1.9.9.9.5.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.9.9.9.5.m1.1.1.3.3" xref="S3.T1.9.9.9.5.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.9.9.9.5.m1.1b"><apply id="S3.T1.9.9.9.5.m1.1.1.cmml" xref="S3.T1.9.9.9.5.m1.1.1"><gt id="S3.T1.9.9.9.5.m1.1.1.1.cmml" xref="S3.T1.9.9.9.5.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.9.9.9.5.m1.1.1.2.cmml" xref="S3.T1.9.9.9.5.m1.1.1.2">absent</csymbol><apply id="S3.T1.9.9.9.5.m1.1.1.3.cmml" xref="S3.T1.9.9.9.5.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.9.9.9.5.m1.1.1.3.1.cmml" xref="S3.T1.9.9.9.5.m1.1.1.3">superscript</csymbol><cn id="S3.T1.9.9.9.5.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.9.9.9.5.m1.1.1.3.2">10</cn><cn id="S3.T1.9.9.9.5.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.9.9.9.5.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.9.9.9.5.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.9.9.9.5.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.9.9.9.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.10.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.10.10.10.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">LongLLaMA-3B<sup class="ltx_sup" id="S3.T1.10.10.10.1.1"><span class="ltx_text ltx_font_italic" id="S3.T1.10.10.10.1.1.1">†</span></sup>
</th>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.59</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.25</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.87</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.10.10.10.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.55</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.22</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.9" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.10.10.10.9.1">2.94</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.10.10.10.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.14</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.62</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.57</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.10.10.10.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.69</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.33</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.84</td>
<td class="ltx_td ltx_align_center" id="S3.T1.10.10.10.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.23.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.23.8.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">Phi3-128k</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">11.31</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.90</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.23.8.4.1">9.66</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">- / <span class="ltx_text ltx_font_italic" id="S3.T1.15.15.23.8.5.1">9.65</span>
</td>
<td class="ltx_td" id="S3.T1.15.15.23.8.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">4.25</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.11</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">2.77</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">- / <span class="ltx_text ltx_font_italic" id="S3.T1.15.15.23.8.10.1">3.08</span>
</td>
<td class="ltx_td" id="S3.T1.15.15.23.8.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">11.01</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.13" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.23.8.13.1">9.22</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.14" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.23.8.14.1">8.98</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">- / <span class="ltx_text ltx_font_italic" id="S3.T1.15.15.23.8.15.1">9.27</span>
</td>
<td class="ltx_td" id="S3.T1.15.15.23.8.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.17" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.23.8.17.1">7.54</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.18" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.23.8.18.1">7.22</span></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.01</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.23.8.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">- / <span class="ltx_text ltx_font_italic" id="S3.T1.15.15.23.8.20.1">7.20</span>
</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.15">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.11.11.11.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">MemLong-3B<sup class="ltx_sup" id="S3.T1.11.11.11.1.1">∗</sup>
</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.6" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.66</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.09</td>
<td class="ltx_td ltx_align_center" id="S3.T1.12.12.12.2" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.12.12.12.2.m1.1"><semantics id="S3.T1.12.12.12.2.m1.1a"><mrow id="S3.T1.12.12.12.2.m1.1.1" xref="S3.T1.12.12.12.2.m1.1.1.cmml"><mi id="S3.T1.12.12.12.2.m1.1.1.2" xref="S3.T1.12.12.12.2.m1.1.1.2.cmml"></mi><mo id="S3.T1.12.12.12.2.m1.1.1.1" xref="S3.T1.12.12.12.2.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.12.12.12.2.m1.1.1.3" xref="S3.T1.12.12.12.2.m1.1.1.3.cmml"><mn id="S3.T1.12.12.12.2.m1.1.1.3.2" xref="S3.T1.12.12.12.2.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.12.12.12.2.m1.1.1.3.3" xref="S3.T1.12.12.12.2.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.12.12.12.2.m1.1b"><apply id="S3.T1.12.12.12.2.m1.1.1.cmml" xref="S3.T1.12.12.12.2.m1.1.1"><gt id="S3.T1.12.12.12.2.m1.1.1.1.cmml" xref="S3.T1.12.12.12.2.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.12.12.12.2.m1.1.1.2.cmml" xref="S3.T1.12.12.12.2.m1.1.1.2">absent</csymbol><apply id="S3.T1.12.12.12.2.m1.1.1.3.cmml" xref="S3.T1.12.12.12.2.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.12.12.12.2.m1.1.1.3.1.cmml" xref="S3.T1.12.12.12.2.m1.1.1.3">superscript</csymbol><cn id="S3.T1.12.12.12.2.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.12.12.12.2.m1.1.1.3.2">10</cn><cn id="S3.T1.12.12.12.2.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.12.12.12.2.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.12.12.12.2.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.12.12.12.2.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.15.9" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.58</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.11" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.18</td>
<td class="ltx_td ltx_align_center" id="S3.T1.13.13.13.3" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.13.13.13.3.m1.1"><semantics id="S3.T1.13.13.13.3.m1.1a"><mrow id="S3.T1.13.13.13.3.m1.1.1" xref="S3.T1.13.13.13.3.m1.1.1.cmml"><mi id="S3.T1.13.13.13.3.m1.1.1.2" xref="S3.T1.13.13.13.3.m1.1.1.2.cmml"></mi><mo id="S3.T1.13.13.13.3.m1.1.1.1" xref="S3.T1.13.13.13.3.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.13.13.13.3.m1.1.1.3" xref="S3.T1.13.13.13.3.m1.1.1.3.cmml"><mn id="S3.T1.13.13.13.3.m1.1.1.3.2" xref="S3.T1.13.13.13.3.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.13.13.13.3.m1.1.1.3.3" xref="S3.T1.13.13.13.3.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.13.13.13.3.m1.1b"><apply id="S3.T1.13.13.13.3.m1.1.1.cmml" xref="S3.T1.13.13.13.3.m1.1.1"><gt id="S3.T1.13.13.13.3.m1.1.1.1.cmml" xref="S3.T1.13.13.13.3.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.13.13.13.3.m1.1.1.2.cmml" xref="S3.T1.13.13.13.3.m1.1.1.2">absent</csymbol><apply id="S3.T1.13.13.13.3.m1.1.1.3.cmml" xref="S3.T1.13.13.13.3.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.13.13.13.3.m1.1.1.3.1.cmml" xref="S3.T1.13.13.13.3.m1.1.1.3">superscript</csymbol><cn id="S3.T1.13.13.13.3.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.13.13.13.3.m1.1.1.3.2">10</cn><cn id="S3.T1.13.13.13.3.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.13.13.13.3.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.13.13.13.3.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.13.13.13.3.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.15.13" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.37</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.55</td>
<td class="ltx_td ltx_align_center" id="S3.T1.14.14.14.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.14.14.14.4.m1.1"><semantics id="S3.T1.14.14.14.4.m1.1a"><mrow id="S3.T1.14.14.14.4.m1.1.1" xref="S3.T1.14.14.14.4.m1.1.1.cmml"><mi id="S3.T1.14.14.14.4.m1.1.1.2" xref="S3.T1.14.14.14.4.m1.1.1.2.cmml"></mi><mo id="S3.T1.14.14.14.4.m1.1.1.1" xref="S3.T1.14.14.14.4.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.14.14.14.4.m1.1.1.3" xref="S3.T1.14.14.14.4.m1.1.1.3.cmml"><mn id="S3.T1.14.14.14.4.m1.1.1.3.2" xref="S3.T1.14.14.14.4.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.14.14.14.4.m1.1.1.3.3" xref="S3.T1.14.14.14.4.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.14.14.14.4.m1.1b"><apply id="S3.T1.14.14.14.4.m1.1.1.cmml" xref="S3.T1.14.14.14.4.m1.1.1"><gt id="S3.T1.14.14.14.4.m1.1.1.1.cmml" xref="S3.T1.14.14.14.4.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.14.14.14.4.m1.1.1.2.cmml" xref="S3.T1.14.14.14.4.m1.1.1.2">absent</csymbol><apply id="S3.T1.14.14.14.4.m1.1.1.3.cmml" xref="S3.T1.14.14.14.4.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.14.14.14.4.m1.1.1.3.1.cmml" xref="S3.T1.14.14.14.4.m1.1.1.3">superscript</csymbol><cn id="S3.T1.14.14.14.4.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.14.14.14.4.m1.1.1.3.2">10</cn><cn id="S3.T1.14.14.14.4.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.14.14.14.4.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.14.14.14.4.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.14.14.14.4.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.16" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
<td class="ltx_td" id="S3.T1.15.15.15.17" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.72</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.93</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.5" style="padding-top:2.5pt;padding-bottom:2.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S3.T1.15.15.15.5.m1.1"><semantics id="S3.T1.15.15.15.5.m1.1a"><mrow id="S3.T1.15.15.15.5.m1.1.1" xref="S3.T1.15.15.15.5.m1.1.1.cmml"><mi id="S3.T1.15.15.15.5.m1.1.1.2" xref="S3.T1.15.15.15.5.m1.1.1.2.cmml"></mi><mo id="S3.T1.15.15.15.5.m1.1.1.1" xref="S3.T1.15.15.15.5.m1.1.1.1.cmml">&gt;</mo><msup id="S3.T1.15.15.15.5.m1.1.1.3" xref="S3.T1.15.15.15.5.m1.1.1.3.cmml"><mn id="S3.T1.15.15.15.5.m1.1.1.3.2" xref="S3.T1.15.15.15.5.m1.1.1.3.2.cmml">10</mn><mn id="S3.T1.15.15.15.5.m1.1.1.3.3" xref="S3.T1.15.15.15.5.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.15.15.15.5.m1.1b"><apply id="S3.T1.15.15.15.5.m1.1.1.cmml" xref="S3.T1.15.15.15.5.m1.1.1"><gt id="S3.T1.15.15.15.5.m1.1.1.1.cmml" xref="S3.T1.15.15.15.5.m1.1.1.1"></gt><csymbol cd="latexml" id="S3.T1.15.15.15.5.m1.1.1.2.cmml" xref="S3.T1.15.15.15.5.m1.1.1.2">absent</csymbol><apply id="S3.T1.15.15.15.5.m1.1.1.3.cmml" xref="S3.T1.15.15.15.5.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T1.15.15.15.5.m1.1.1.3.1.cmml" xref="S3.T1.15.15.15.5.m1.1.1.3">superscript</csymbol><cn id="S3.T1.15.15.15.5.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.15.15.15.5.m1.1.1.3.2">10</cn><cn id="S3.T1.15.15.15.5.m1.1.1.3.3.cmml" type="integer" xref="S3.T1.15.15.15.5.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.15.15.15.5.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.15.15.15.5.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.15.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.24.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T1.15.15.24.9.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">w/ 4K Memory</th>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.2" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.54</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.3" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.95</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.4" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.89</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.5" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.24.9.5.1">9.64</span></td>
<td class="ltx_td" id="S3.T1.15.15.24.9.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.53</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.16</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.15</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.10" style="padding-top:2.5pt;padding-bottom:2.5pt;">2.99</td>
<td class="ltx_td" id="S3.T1.15.15.24.9.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">10.18</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.50</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.14" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.57</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.15" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.61</td>
<td class="ltx_td" id="S3.T1.15.15.24.9.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.53</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.92</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.19" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.87</td>
<td class="ltx_td ltx_align_center" id="S3.T1.15.15.24.9.20" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.99</td>
</tr>
<tr class="ltx_tr" id="S3.T1.15.15.25.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S3.T1.15.15.25.10.1" style="padding-top:2.5pt;padding-bottom:2.5pt;">w/ 32K Memory</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.2" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.2.1">10.53</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.3" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.3.1">9.85</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.4" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.4.1">9.83</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.5" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.73</td>
<td class="ltx_td ltx_border_bb" id="S3.T1.15.15.25.10.6" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.7" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.51</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.8" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.15</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.9" style="padding-top:2.5pt;padding-bottom:2.5pt;">3.11</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.10" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.10.1">2.99</span></td>
<td class="ltx_td ltx_border_bb" id="S3.T1.15.15.25.10.11" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.12" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.64</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.13" style="padding-top:2.5pt;padding-bottom:2.5pt;">9.56</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.14" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.14.1">9.51</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.15" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.15.1">9.54</span></td>
<td class="ltx_td ltx_border_bb" id="S3.T1.15.15.25.10.16" style="padding-top:2.5pt;padding-bottom:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.17" style="padding-top:2.5pt;padding-bottom:2.5pt;">8.02</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.18" style="padding-top:2.5pt;padding-bottom:2.5pt;">7.58</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.19" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.19.1">6.89</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T1.15.15.25.10.20" style="padding-top:2.5pt;padding-bottom:2.5pt;"><span class="ltx_text ltx_font_bold" id="S3.T1.15.15.25.10.20.1">7.09</span></td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>
Sliding window perplexity of different context window extension models on PG19, Proof-pile, BookCorpus, Wikitext-103. All experiments are conducted on one 3090 24GB GPU. LongLLaMA-3B and MemLong-3B marked with <sup class="ltx_sup" id="S3.T1.22.1">∗</sup> means evaluating without Memory, and LongLLaMA-3B marked with <sup class="ltx_sup" id="S3.T1.23.2"><span class="ltx_text ltx_font_italic" id="S3.T1.23.2.1">†</span></sup> means evaluating with infinite memory. We also evaluate MemLong with 4K/32K Memory scenarios. "- / 6.95" indicates that the model results in an Out of Memory (OOM) error on a single GPU, while on dual GPUs it yields the corresponding result.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">We evaluate our proposed MemLong model on various tasks that require in-memory long-context processing: (a) long-context language modeling and retrieval-augmented language modeling; (b) scalable in-context learning capable of handling a large number of demonstration examples in memory.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Implementation Details</h3>
<section class="ltx_paragraph" id="S4.SS1.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Training Details.</h4>
<div class="ltx_para" id="S4.SS1.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS1.SSS0.Px1.p1.1">We use OpenLLaMA-3B as the pre-trained backbone LLM with rotation position coding <cite class="ltx_cite ltx_citemacro_cite">Su et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib26" title="">2024</a>)</cite>. Due to hardware constraints, we opted to train our models using the LoRA <cite class="ltx_cite ltx_citemacro_cite">Hu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib12" title="">2021</a>)</cite> technique. The backbone LLM holds a <math alttext="L=26,H=32,d=100" class="ltx_Math" display="inline" id="S4.SS1.SSS0.Px1.p1.1.m1.2"><semantics id="S4.SS1.SSS0.Px1.p1.1.m1.2a"><mrow id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.3.cmml"><mrow id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.cmml"><mi id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.2.cmml">L</mi><mo id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.1" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.1.cmml">=</mo><mn id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.3" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.3.cmml">26</mn></mrow><mo id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.3" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.3a.cmml">,</mo><mrow id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.3.cmml"><mrow id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml"><mi id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.2.cmml">H</mi><mo id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.1" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.1.cmml">=</mo><mn id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.3" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.3.cmml">32</mn></mrow><mo id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.3" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.3a.cmml">,</mo><mrow id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.cmml"><mi id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.2" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.2.cmml">d</mi><mo id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.1" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.1.cmml">=</mo><mn id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.3" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.3.cmml">100</mn></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS0.Px1.p1.1.m1.2b"><apply id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.3.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.3a.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.3">formulae-sequence</csymbol><apply id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1"><eq id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.1.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.1"></eq><ci id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.2.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.2">𝐿</ci><cn id="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.3.cmml" type="integer" xref="S4.SS1.SSS0.Px1.p1.1.m1.1.1.1.1.3">26</cn></apply><apply id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.3.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.3a.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.3">formulae-sequence</csymbol><apply id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1"><eq id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.1.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.1"></eq><ci id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.2.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.2">𝐻</ci><cn id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.3.cmml" type="integer" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.1.1.3">32</cn></apply><apply id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2"><eq id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.1.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.1"></eq><ci id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.2.cmml" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.2">𝑑</ci><cn id="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.3.cmml" type="integer" xref="S4.SS1.SSS0.Px1.p1.1.m1.2.2.2.2.2.2.3">100</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS0.Px1.p1.1.m1.2c">L=26,H=32,d=100</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS0.Px1.p1.1.m1.2d">italic_L = 26 , italic_H = 32 , italic_d = 100</annotation></semantics></math> architecture. Unless specified otherwise, we use the 13-th layer as <span class="ltx_text ltx_font_italic" id="S4.SS1.SSS0.Px1.p1.1.1">the memory layer</span> and the [14,18,22,26] layers as the <span class="ltx_text ltx_font_italic" id="S4.SS1.SSS0.Px1.p1.1.2">retrieval-augment</span> layers. The training for retrieval-augmented adaptation iterates only on 0.5B tokens with 1024 sequence length. MemLong’s trainable parameters are from 14 to 26 layers. We utilized the slimpajama dataset sampled by <cite class="ltx_cite ltx_citemacro_cite">Fu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib10" title="">2024</a>)</cite> as our training corpus.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS1.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Position Remapping.</h4>
<div class="ltx_para" id="S4.SS1.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS1.SSS0.Px2.p1.3">There are several chunk-level <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S4.SS1.SSS0.Px2.p1.1.m1.1"><semantics id="S4.SS1.SSS0.Px2.p1.1.m1.1a"><mrow id="S4.SS1.SSS0.Px2.p1.1.m1.1.1" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.cmml"><mi id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.2" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mtext id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3a.cmml">-</mtext><mo id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1a" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.4" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS0.Px2.p1.1.m1.1b"><apply id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1"><times id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.1"></times><ci id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.2">𝙺</ci><ci id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3a.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3"><mtext id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.3">-</mtext></ci><ci id="S4.SS1.SSS0.Px2.p1.1.m1.1.1.4.cmml" xref="S4.SS1.SSS0.Px2.p1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS0.Px2.p1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS0.Px2.p1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> in the <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS1.SSS0.Px2.p1.2.m2.1"><semantics id="S4.SS1.SSS0.Px2.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.SSS0.Px2.p1.2.m2.1.1" xref="S4.SS1.SSS0.Px2.p1.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS0.Px2.p1.2.m2.1b"><ci id="S4.SS1.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S4.SS1.SSS0.Px2.p1.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS0.Px2.p1.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS0.Px2.p1.2.m2.1d">caligraphic_M</annotation></semantics></math> retrieved for generation. Due to the uncertainty of retrieval at each step, we need to remap position embeddings to the retrieved chunks. Same as the previous work <cite class="ltx_cite ltx_citemacro_cite">Tworkowski et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib28" title="">2024</a>)</cite>, the local context (up to 2048 tokens) receives the standard rotary positional encoding, whereas memory keys are encoded as if they had position <math alttext="0" class="ltx_Math" display="inline" id="S4.SS1.SSS0.Px2.p1.3.m3.1"><semantics id="S4.SS1.SSS0.Px2.p1.3.m3.1a"><mn id="S4.SS1.SSS0.Px2.p1.3.m3.1.1" xref="S4.SS1.SSS0.Px2.p1.3.m3.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS0.Px2.p1.3.m3.1b"><cn id="S4.SS1.SSS0.Px2.p1.3.m3.1.1.cmml" type="integer" xref="S4.SS1.SSS0.Px2.p1.3.m3.1.1">0</cn></annotation-xml></semantics></math> in the local context window.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Long-Context Language Modeling</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.2">We first evaluate MemLong on long-context language modeling benchmarks to assess basic language modeling abilities. Due to the <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.1"><semantics id="S4.SS2.p1.1.m1.1a"><mrow id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml"><mi id="S4.SS2.p1.1.m1.1.1.2" xref="S4.SS2.p1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S4.SS2.p1.1.m1.1.1.1" xref="S4.SS2.p1.1.m1.1.1.1.cmml">⁢</mo><mtext id="S4.SS2.p1.1.m1.1.1.3" xref="S4.SS2.p1.1.m1.1.1.3a.cmml">-</mtext><mo id="S4.SS2.p1.1.m1.1.1.1a" xref="S4.SS2.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.4" xref="S4.SS2.p1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.1b"><apply id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1"><times id="S4.SS2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1.1"></times><ci id="S4.SS2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.p1.1.m1.1.1.2">𝙺</ci><ci id="S4.SS2.p1.1.m1.1.1.3a.cmml" xref="S4.SS2.p1.1.m1.1.1.3"><mtext id="S4.SS2.p1.1.m1.1.1.3.cmml" xref="S4.SS2.p1.1.m1.1.1.3">-</mtext></ci><ci id="S4.SS2.p1.1.m1.1.1.4.cmml" xref="S4.SS2.p1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> cache providing sinificant background and contextual information, MemLong can retrieve relevant <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S4.SS2.p1.2.m2.1"><semantics id="S4.SS2.p1.2.m2.1a"><mrow id="S4.SS2.p1.2.m2.1.1" xref="S4.SS2.p1.2.m2.1.1.cmml"><mi id="S4.SS2.p1.2.m2.1.1.2" xref="S4.SS2.p1.2.m2.1.1.2.cmml">𝙺</mi><mo id="S4.SS2.p1.2.m2.1.1.1" xref="S4.SS2.p1.2.m2.1.1.1.cmml">⁢</mo><mtext id="S4.SS2.p1.2.m2.1.1.3" xref="S4.SS2.p1.2.m2.1.1.3a.cmml">-</mtext><mo id="S4.SS2.p1.2.m2.1.1.1a" xref="S4.SS2.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.4" xref="S4.SS2.p1.2.m2.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.2.m2.1b"><apply id="S4.SS2.p1.2.m2.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1"><times id="S4.SS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1.1"></times><ci id="S4.SS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.p1.2.m2.1.1.2">𝙺</ci><ci id="S4.SS2.p1.2.m2.1.1.3a.cmml" xref="S4.SS2.p1.2.m2.1.1.3"><mtext id="S4.SS2.p1.2.m2.1.1.3.cmml" xref="S4.SS2.p1.2.m2.1.1.3">-</mtext></ci><ci id="S4.SS2.p1.2.m2.1.1.4.cmml" xref="S4.SS2.p1.2.m2.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.2.m2.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.2.m2.1d">typewriter_K - typewriter_V</annotation></semantics></math> cache quickly and make full use of it, thereby enhancing the model’s in long-context modeling tasks.</p>
</div>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Datasets.</h4>
<div class="ltx_para" id="S4.SS2.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px1.p1.1">We conducte an evaluation of our model across four extensive text benchmark datasets: English-language books PG-19 <cite class="ltx_cite ltx_citemacro_cite">Rae et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib23" title="">2019</a>)</cite> and BookCorpus <cite class="ltx_cite ltx_citemacro_cite">Zhu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib41" title="">2015</a>)</cite>, Wikipedia articles Wikitext-103 <cite class="ltx_cite ltx_citemacro_cite">Merity et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib20" title="">2016</a>)</cite>, and mathematical papers Proof-Pile <cite class="ltx_cite ltx_citemacro_cite">Azerbayev et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib3" title="">2023</a>)</cite>. The experimental results indicate a significant perplexity improvement across all datasets. Our model is tested over various lengths ranging from 1024 to 32768 tokens. Across all datasets, our model demonstrated substantial performance gains with minimal memory overhead by leveraging an external retriever and memory.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Setup.</h4>
<div class="ltx_para" id="S4.SS2.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px2.p1.2">Following <cite class="ltx_cite ltx_citemacro_cite">Yen et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib36" title="">2024</a>)</cite>, we calculate the perplexity on the last 2048 tokens of each sequence. This experimental setup is designed to validate the influence of different retriever sizes on the overall performance of our model. For the implementation of the efficient fine-grained retrieval, we use the <span class="ltx_text ltx_font_italic" id="S4.SS2.SSS0.Px2.p1.2.1">faiss</span> <cite class="ltx_cite ltx_citemacro_cite">Johnson et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib14" title="">2019</a>)</cite> toolkit to construct an exact-search index on GPU to store the <span class="ltx_text ltx_font_italic" id="S4.SS2.SSS0.Px2.p1.2.2">Representation Embeddings</span> of text chunks and perform efficient retrieval. For MemLong, we split and put the tokens over <math alttext="\text{finetune-length}=1024" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.1.m1.1"><semantics id="S4.SS2.SSS0.Px2.p1.1.m1.1a"><mrow id="S4.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml"><mtext id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2a.cmml">finetune-length</mtext><mo id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml">=</mo><mn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml">1024</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1"><eq id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1"></eq><ci id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2a.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2"><mtext id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2">finetune-length</mtext></ci><cn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3">1024</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.1.m1.1c">\text{finetune-length}=1024</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.1.m1.1d">finetune-length = 1024</annotation></semantics></math> into the <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.2.m2.1"><semantics id="S4.SS2.SSS0.Px2.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.SSS0.Px2.p1.2.m2.1.1" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.2.m2.1b"><ci id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.2.m2.1d">caligraphic_M</annotation></semantics></math> used for further retrieval.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px3">
<h4 class="ltx_title ltx_title_paragraph">Baselines.</h4>
<div class="ltx_para" id="S4.SS2.SSS0.Px3.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px3.p1.1">For our experiments, we employ the OpenLLaMA-3B model as our baseline. To ensure a fair comparison, we utilize an identical LoRA configuration and finetuned the models on the same amount of data from the slimpajama dataset. Additional, we compare LongLLaMA-3B <cite class="ltx_cite ltx_citemacro_cite">Tworkowski et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib28" title="">2024</a>)</cite>, which finetuned with the Focused Transformer (FoT) method and 5B tokens.
To perform a further comprehensive comparison, we additionally test two 7B models: LLaMA-2-7B and LongLoRA-7B-32K <cite class="ltx_cite ltx_citemacro_cite">Chen et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib8" title="">2023b</a>)</cite> and two positional encoding models: Yarn-7b-128k <cite class="ltx_cite ltx_citemacro_cite">Peng et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib21" title="">2023</a>)</cite> and Phi3-128k <cite class="ltx_cite ltx_citemacro_cite">Abdin et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib1" title="">2024</a>)</cite>.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px4">
<h4 class="ltx_title ltx_title_paragraph">Results.</h4>
<div class="ltx_para" id="S4.SS2.SSS0.Px4.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px4.p1.1">The results are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S3.T1" title="Table 1 ‣ 3.4 Inference with MemLong ‣ 3 MemLong ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">1</span></a>.
We employ Perplexity (PPL) as the evaluation metric for the language model. Lower PPL indicates stronger language modeling capabilities.
Compared to the two fully fine-tuned models, OpenLLaMA-3B and LLaMA-2-7B, our model demonstrates comparable performance across multiple datasets when test lengths are within their pre-trained limits (2048 for OpenLLaMA-3B and 4096 for LLaMA-2-7B). However, once the test lengths exceed these pre-trained limits, our model continues to reduce perplexity even beyond the fine-tuning length of 1024 and the pre-trained length of 2048, showcasing its superior generalizability. In contrast, the OpenLLaMA-3B and LLaMA-2-7B models fail to generalize to inputs beyond their pre-trained lengths and exhibit significantly increased memory overhead due to the quadratic complexity of attention.
We also compare our model with LongLoRA. Although the proposed Shifted Sparse Attention in LongLoRA significantly reduces memory usage, it also diminishes the model’s performance on short texts.
In contrast, LongLLaMA, which <math alttext="\mathtt{K}\mbox{-}\mathtt{V}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px4.p1.1.m1.1"><semantics id="S4.SS2.SSS0.Px4.p1.1.m1.1a"><mrow id="S4.SS2.SSS0.Px4.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.cmml"><mi id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2.cmml">𝙺</mi><mo id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1.cmml">⁢</mo><mtext id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3a.cmml">-</mtext><mo id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1a" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.4" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.4.cmml">𝚅</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px4.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1"><times id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.1"></times><ci id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.2">𝙺</ci><ci id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3a.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3"><mtext id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.3">-</mtext></ci><ci id="S4.SS2.SSS0.Px4.p1.1.m1.1.1.4.cmml" xref="S4.SS2.SSS0.Px4.p1.1.m1.1.1.4">𝚅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px4.p1.1.m1.1c">\mathtt{K}\mbox{-}\mathtt{V}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px4.p1.1.m1.1d">typewriter_K - typewriter_V</annotation></semantics></math> pairs can also be stored, suffers from OOM issues when test lengths become excessively long due to its infinitely growing memory usage.
Positional encoding models have strong generalization capabilities. However, the performance of such methods can only guarantee that the generation performance over long distances does not degrade.
<span class="ltx_text ltx_font_bold" id="S4.SS2.SSS0.Px4.p1.1.1">Compared to their methods, MemLong leverages an external retriever to handle longer input tokens and achieve better perplexity improvements.At the same time, because of the high storage efficiency, MemLong can effectively control the use of GPU to avoid OOM problems.</span></p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>In Context Learning</h3>
<figure class="ltx_table" id="S4.T2">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T2.5" style="width:390.3pt;height:195.4pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-20.6pt,10.3pt) scale(0.904414278018472,0.904414278018472) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T2.5.5">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T2.5.5.6.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.1" rowspan="2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.1.1">Model</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.2.1">In-Context</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.3.1">In-Memory</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.4.1">SST-2</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.5.1">MR</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.6.1">Subj</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.7.1">SST-5</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.8.1">MPQA</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T2.5.5.6.1.9" rowspan="2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.6.1.9.1">Avg.</span></th>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.5">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.5.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.5.6.1">#Demons.</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.5.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.5.7.1">#Demons.</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.1.1.1.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">ACC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T2.1.1.1.1.m1.1"><semantics id="S4.T2.1.1.1.1.m1.1a"><mo id="S4.T2.1.1.1.1.m1.1.1" stretchy="false" xref="S4.T2.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T2.1.1.1.1.m1.1b"><ci id="S4.T2.1.1.1.1.m1.1.1.cmml" xref="S4.T2.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T2.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.2.2.2.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">ACC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T2.2.2.2.2.m1.1"><semantics id="S4.T2.2.2.2.2.m1.1a"><mo id="S4.T2.2.2.2.2.m1.1.1" stretchy="false" xref="S4.T2.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T2.2.2.2.2.m1.1b"><ci id="S4.T2.2.2.2.2.m1.1.1.cmml" xref="S4.T2.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T2.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.3.3.3.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">ACC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T2.3.3.3.3.m1.1"><semantics id="S4.T2.3.3.3.3.m1.1a"><mo id="S4.T2.3.3.3.3.m1.1.1" stretchy="false" xref="S4.T2.3.3.3.3.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T2.3.3.3.3.m1.1b"><ci id="S4.T2.3.3.3.3.m1.1.1.cmml" xref="S4.T2.3.3.3.3.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.3.3.3.3.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T2.3.3.3.3.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.4.4.4.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">ACC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T2.4.4.4.4.m1.1"><semantics id="S4.T2.4.4.4.4.m1.1a"><mo id="S4.T2.4.4.4.4.m1.1.1" stretchy="false" xref="S4.T2.4.4.4.4.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T2.4.4.4.4.m1.1b"><ci id="S4.T2.4.4.4.4.m1.1.1.cmml" xref="S4.T2.4.4.4.4.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.4.4.4.4.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T2.4.4.4.4.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.5.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">ACC<math alttext="\uparrow" class="ltx_Math" display="inline" id="S4.T2.5.5.5.5.m1.1"><semantics id="S4.T2.5.5.5.5.m1.1a"><mo id="S4.T2.5.5.5.5.m1.1.1" stretchy="false" xref="S4.T2.5.5.5.5.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S4.T2.5.5.5.5.m1.1b"><ci id="S4.T2.5.5.5.5.m1.1.1.cmml" xref="S4.T2.5.5.5.5.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.5.5.5.5.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S4.T2.5.5.5.5.m1.1d">↑</annotation></semantics></math>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T2.5.5.7.1">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T2.5.5.7.1.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">OpenLLaMA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">N/A</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">90.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">84.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">58.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">41.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">70.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.7.1.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">68.9</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.8.2">
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">w./ Rag</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">90.9</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">90.5</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">61.6</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">39.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">63.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.8.2.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">69.1</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.9.3">
<td class="ltx_td ltx_align_left" id="S4.T2.5.5.9.3.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">LongLLaMA</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">90.4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">83.9</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">64.3</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">40.0</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">64.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.9.3.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">68.6</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.10.4">
<td class="ltx_td ltx_align_left" id="S4.T2.5.5.10.4.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">MemLong</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">91.5</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">84.5</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">61.5</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">41.4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">70.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.10.4.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.10.4.9.1">69.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.11.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">LongLLaMA</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">18</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">91.4</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">87.1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">59.1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">41.0</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">64.5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T2.5.5.11.5.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">68.7</th>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.12.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column" id="S4.T2.5.5.12.6.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">MemLong</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">4</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">18</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">91.0</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">89.6</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">61.7</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">43.5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">69.4</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S4.T2.5.5.12.6.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.12.6.9.1">71.0</span></th>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.13.7">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T2.5.5.13.7.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">OpenLLaMA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">20</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">N/A</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">93.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">91.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">55.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">38.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">66.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.5.5.13.7.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">69.0</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.14.8">
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">w./ Rag</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">20</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">18</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">92.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">91.3</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">75.8</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">39.8</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">57.6</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.14.8.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">71.3</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.15.9">
<td class="ltx_td ltx_align_left" id="S4.T2.5.5.15.9.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">LongLLaMA</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">20</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">18</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.15.9.4.1">94.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">90.8</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">64.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">41.4</td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.15.9.8.1">72.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.5.5.15.9.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">72.7</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.16.10">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T2.5.5.16.10.1" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">MemLong</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.2" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">20</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.3" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">18</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.4" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">93.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.5" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.16.10.5.1">93.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.6" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.16.10.6.1">65.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.7" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.16.10.7.1">43.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.8" style="padding-top:-0.5pt;padding-bottom:-0.5pt;">70.6</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.16.10.9" style="padding-top:-0.5pt;padding-bottom:-0.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T2.5.5.16.10.9.1">73.4</span></td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>
Accuracy [%] of 4-shot and 20-shot ICL on 5 NLU tasks (SST-2, MR, Subj, SST-5, MPQA). We compare MemLong with both the vanilla model (OpenLLaMA) and the memory-augmented model (LongLLaMA). Across a diverse range of experimental settings, our method consistently shows competitive performance.
</figcaption>
</figure>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1">Traditional in-context learning (ICL; <cite class="ltx_cite ltx_citemacro_citep">Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib6" title="">2020</a></cite>) inputs few-shot non-parameterized demonstration examples along with the query into the model. However, these methods are typically constrained by the model’s input length. In this experiment, since MemLong can store examples in a parameterized form within its memory, we primarily investigate whether MemLong can effectively utilize the knowledge stored in its memory to enhance its emergent abilities. The results are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S4.T2" title="Table 2 ‣ 4.3 In Context Learning ‣ 4 Experiments ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">2</span></a>.
Compared to OpenLLaMA,which rely solely on non-parametric knowledge , given the same number of in-context demonstrations, MemLong can utilize additional demonstrations stored in its memory. The performance further increases or remains consistent with more demonstrations in the memory.
In our comparative analysis against LongLLaMA, it was observed that our model outperforms LongLLaMA across the majority of datasets under the same conditions of preserving In-Memory Demonstrations. <span class="ltx_text ltx_font_bold" id="S4.SS3.p1.1.1">It is important to highlight that our model operates with significantly lower training parameters (200M <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.p1.1.1.1">V. S.</span> 0.3B) and fine-tuning data volume (0.5B <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.p1.1.1.2">V. S.</span> 5B) compared to LongLLaMA.</span> This underscores our model’s efficiency in leveraging an external retriever for information acquisition, demonstrating a superior ability to synthesize and utilize knowledge effectively with substantially fewer resources.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Ablation Study</h2>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Training Setting</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">During the training phase, we explore the effects of varying retrieval layers on the model and examine whether the distribution shift problem, as discussed in MemTrm <cite class="ltx_cite ltx_citemacro_cite">Wu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib33" title="">2022</a>)</cite>, could be adequately resolved by our approach.
As mentioned before, Our method proposes a low-cost solution for distribution shifts. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.F4" title="Figure 4 ‣ 5.1 Training Setting ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">4</span></a>, the brown line (the line at the top of the picture; the training method is similar to MemTrm fine-tuning all parameters of the model and all layers after the <span class="ltx_text ltx_font_italic" id="S5.SS1.p1.1.1">memory layer</span> are involved in the retrieval) is significantly worse than all other ours methods (even the most unreasonable settings) in terms of performance and fitting speed. We will analyze the performance of the reasoning stage later.</p>
</div>
<figure class="ltx_figure" id="S5.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="450" id="S5.F4.g1" src="extracted/5822409/step_perplexity.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>Degree of PPL during the training phase. The indicator for the y-axis is PPL. We mainly focus on training params and retrieval layers. We provide the specific parameter settings of each line in <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#A1" title="Appendix A Different Training Settings ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">appendix</span> <span class="ltx_text ltx_ref_tag">A</span></a>.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Inference Performance</h3>
<figure class="ltx_table" id="S5.T3">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T3.3" style="width:433.6pt;height:186.2pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(70.1pt,-30.1pt) scale(1.47788461028405,1.47788461028405) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T3.3.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T3.3.3.4.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S5.T3.3.3.4.1.1" style="padding-top:1.5pt;padding-bottom:1.5pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="3" id="S5.T3.3.3.4.1.2" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.4.1.2.1">PG19</span></th>
<th class="ltx_td ltx_th ltx_th_column ltx_border_tt" id="S5.T3.3.3.4.1.3" style="padding-top:1.5pt;padding-bottom:1.5pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="3" id="S5.T3.3.3.4.1.4" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.4.1.4.1">Proof-pile</span></th>
</tr>
<tr class="ltx_tr" id="S5.T3.3.3.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row" id="S5.T3.3.3.5.2.1" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.5.2.1.1">Method</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.2" style="padding-top:1.5pt;padding-bottom:1.5pt;">2k</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.3" style="padding-top:1.5pt;padding-bottom:1.5pt;">4k</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.4" style="padding-top:1.5pt;padding-bottom:1.5pt;">8k</th>
<th class="ltx_td ltx_th ltx_th_column" id="S5.T3.3.3.5.2.5" style="padding-top:1.5pt;padding-bottom:1.5pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.6" style="padding-top:1.5pt;padding-bottom:1.5pt;">2k</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.7" style="padding-top:1.5pt;padding-bottom:1.5pt;">4k</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.5.2.8" style="padding-top:1.5pt;padding-bottom:1.5pt;">8k</th>
</tr>
<tr class="ltx_tr" id="S5.T3.3.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_t" id="S5.T3.1.1.1.1" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.1">MemLong<sup class="ltx_sup" id="S5.T3.1.1.1.1.1.1"><span class="ltx_text ltx_font_medium" id="S5.T3.1.1.1.1.1.1.1">∗</span></sup></span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.4" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.09</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.2.2.2.2" style="padding-top:1.5pt;padding-bottom:1.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S5.T3.2.2.2.2.m1.1"><semantics id="S5.T3.2.2.2.2.m1.1a"><mrow id="S5.T3.2.2.2.2.m1.1.1" xref="S5.T3.2.2.2.2.m1.1.1.cmml"><mi id="S5.T3.2.2.2.2.m1.1.1.2" xref="S5.T3.2.2.2.2.m1.1.1.2.cmml"></mi><mo id="S5.T3.2.2.2.2.m1.1.1.1" xref="S5.T3.2.2.2.2.m1.1.1.1.cmml">&gt;</mo><msup id="S5.T3.2.2.2.2.m1.1.1.3" xref="S5.T3.2.2.2.2.m1.1.1.3.cmml"><mn id="S5.T3.2.2.2.2.m1.1.1.3.2" xref="S5.T3.2.2.2.2.m1.1.1.3.2.cmml">10</mn><mn id="S5.T3.2.2.2.2.m1.1.1.3.3" xref="S5.T3.2.2.2.2.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.T3.2.2.2.2.m1.1b"><apply id="S5.T3.2.2.2.2.m1.1.1.cmml" xref="S5.T3.2.2.2.2.m1.1.1"><gt id="S5.T3.2.2.2.2.m1.1.1.1.cmml" xref="S5.T3.2.2.2.2.m1.1.1.1"></gt><csymbol cd="latexml" id="S5.T3.2.2.2.2.m1.1.1.2.cmml" xref="S5.T3.2.2.2.2.m1.1.1.2">absent</csymbol><apply id="S5.T3.2.2.2.2.m1.1.1.3.cmml" xref="S5.T3.2.2.2.2.m1.1.1.3"><csymbol cd="ambiguous" id="S5.T3.2.2.2.2.m1.1.1.3.1.cmml" xref="S5.T3.2.2.2.2.m1.1.1.3">superscript</csymbol><cn id="S5.T3.2.2.2.2.m1.1.1.3.2.cmml" type="integer" xref="S5.T3.2.2.2.2.m1.1.1.3.2">10</cn><cn id="S5.T3.2.2.2.2.m1.1.1.3.3.cmml" type="integer" xref="S5.T3.2.2.2.2.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.2.2.2.2.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S5.T3.2.2.2.2.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.5" style="padding-top:1.5pt;padding-bottom:1.5pt;">-</th>
<th class="ltx_td ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.6" style="padding-top:1.5pt;padding-bottom:1.5pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.7" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.18</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.3" style="padding-top:1.5pt;padding-bottom:1.5pt;"><math alttext="&gt;10^{3}" class="ltx_Math" display="inline" id="S5.T3.3.3.3.3.m1.1"><semantics id="S5.T3.3.3.3.3.m1.1a"><mrow id="S5.T3.3.3.3.3.m1.1.1" xref="S5.T3.3.3.3.3.m1.1.1.cmml"><mi id="S5.T3.3.3.3.3.m1.1.1.2" xref="S5.T3.3.3.3.3.m1.1.1.2.cmml"></mi><mo id="S5.T3.3.3.3.3.m1.1.1.1" xref="S5.T3.3.3.3.3.m1.1.1.1.cmml">&gt;</mo><msup id="S5.T3.3.3.3.3.m1.1.1.3" xref="S5.T3.3.3.3.3.m1.1.1.3.cmml"><mn id="S5.T3.3.3.3.3.m1.1.1.3.2" xref="S5.T3.3.3.3.3.m1.1.1.3.2.cmml">10</mn><mn id="S5.T3.3.3.3.3.m1.1.1.3.3" xref="S5.T3.3.3.3.3.m1.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.T3.3.3.3.3.m1.1b"><apply id="S5.T3.3.3.3.3.m1.1.1.cmml" xref="S5.T3.3.3.3.3.m1.1.1"><gt id="S5.T3.3.3.3.3.m1.1.1.1.cmml" xref="S5.T3.3.3.3.3.m1.1.1.1"></gt><csymbol cd="latexml" id="S5.T3.3.3.3.3.m1.1.1.2.cmml" xref="S5.T3.3.3.3.3.m1.1.1.2">absent</csymbol><apply id="S5.T3.3.3.3.3.m1.1.1.3.cmml" xref="S5.T3.3.3.3.3.m1.1.1.3"><csymbol cd="ambiguous" id="S5.T3.3.3.3.3.m1.1.1.3.1.cmml" xref="S5.T3.3.3.3.3.m1.1.1.3">superscript</csymbol><cn id="S5.T3.3.3.3.3.m1.1.1.3.2.cmml" type="integer" xref="S5.T3.3.3.3.3.m1.1.1.3.2">10</cn><cn id="S5.T3.3.3.3.3.m1.1.1.3.3.cmml" type="integer" xref="S5.T3.3.3.3.3.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.3.3.3.3.m1.1c">&gt;10^{3}</annotation><annotation encoding="application/x-llamapun" id="S5.T3.3.3.3.3.m1.1d">&gt; 10 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.3.3.3.8" style="padding-top:1.5pt;padding-bottom:1.5pt;">-</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T3.3.3.6.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.3.3.6.1.1" style="padding-top:1.5pt;padding-bottom:1.5pt;">w. RA + TA</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.2" style="padding-top:1.5pt;padding-bottom:1.5pt;">11.43</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.3" style="padding-top:1.5pt;padding-bottom:1.5pt;">11.40</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.4" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.65</td>
<td class="ltx_td ltx_border_t" id="S5.T3.3.3.6.1.5" style="padding-top:1.5pt;padding-bottom:1.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.6" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.51</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.7" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.26</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.3.3.6.1.8" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.14</td>
</tr>
<tr class="ltx_tr" id="S5.T3.3.3.7.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.3.3.7.2.1" style="padding-top:1.5pt;padding-bottom:1.5pt;">w. RA + TH</th>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.2" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.57</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.3" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.48</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.4" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.36</td>
<td class="ltx_td" id="S5.T3.3.3.7.2.5" style="padding-top:1.5pt;padding-bottom:1.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.6" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.30</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.7" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.26</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.7.2.8" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.15</td>
</tr>
<tr class="ltx_tr" id="S5.T3.3.3.8.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.3.3.8.3.1" style="padding-top:1.5pt;padding-bottom:1.5pt;">w. RP + TH</th>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.2" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.28</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.3" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.15</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.4" style="padding-top:1.5pt;padding-bottom:1.5pt;">10.12</td>
<td class="ltx_td" id="S5.T3.3.3.8.3.5" style="padding-top:1.5pt;padding-bottom:1.5pt;"></td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.6" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.21</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.7" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.13</td>
<td class="ltx_td ltx_align_center" id="S5.T3.3.3.8.3.8" style="padding-top:1.5pt;padding-bottom:1.5pt;">3.08</td>
</tr>
<tr class="ltx_tr" id="S5.T3.3.3.9.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S5.T3.3.3.9.4.1" style="padding-top:1.5pt;padding-bottom:1.5pt;">w. RLP + TH</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.2" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.9.4.2.1">9.85</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.3" style="padding-top:1.5pt;padding-bottom:1.5pt;">9.83</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.4" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.9.4.4.1">9.80</span></td>
<td class="ltx_td ltx_border_bb" id="S5.T3.3.3.9.4.5" style="padding-top:1.5pt;padding-bottom:1.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.6" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.9.4.6.1">3.15</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.7" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.9.4.7.1">3.11</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.3.3.9.4.8" style="padding-top:1.5pt;padding-bottom:1.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T3.3.3.9.4.8.1">3.04</span></td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>Different retrieval layers can affect MemLong’s performance. MemLong marked with <sup class="ltx_sup" id="S5.T3.7.1">∗</sup> means evaluating without Memory. The size of all methods using Memory is set to 32768. RA means retrieval across all upper layers; TA means training all params without freeze; RP means retrieval across fewer upper layers; RPL means retrieval acorss much fewer upper layers.</figcaption>
</figure>
<section class="ltx_paragraph" id="S5.SS2.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Q1: Does the memory length affect the performance of the model ?</h4>
<figure class="ltx_figure" id="S5.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="545" id="S5.F5.g1" src="extracted/5822409/plot_line.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span>Evaluating different datasets at various memory sizes.In each subplot, all parameters are the same except for the memory size.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS2.SSS0.Px1.p1">
<p class="ltx_p" id="S5.SS2.SSS0.Px1.p1.1">As depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.F5" title="Figure 5 ‣ Q1: Does the memory length affect the performance of the model ? ‣ 5.2 Inference Performance ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">5</span></a>, our examination of the same model’s performance across various memory sizes demonstrates a clear correlation between memory capacity and model efficiency. The trend indicates that incremental increases in memory size yield gradual enhancements in performance. Moreover, a critical threshold is identified at a memory size of 65536, beyond which the model’s capabilities undergo a substantial leap. This suggests that while expanding memory offers substantial benefits, there is a practical ceiling to its effectiveness, likely influenced by the nuances of the data’s distribution.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS2.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Q2: How many layers do we need to introduce extra memory information?</h4>
<div class="ltx_para" id="S5.SS2.SSS0.Px2.p1">
<p class="ltx_p" id="S5.SS2.SSS0.Px2.p1.1">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.F4" title="Figure 4 ‣ 5.1 Training Setting ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">4</span></a>, (the pink line) and Table <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#S5.T3" title="Table 3 ‣ 5.2 Inference Performance ‣ 5 Ablation Study ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">3</span></a> (RPL+TH), the model performs best when the number of retrieval layers is set to [13,17,21,25]. It is empirically believed that if retrieval information is introduced into all upper layers of the model, it leads to a decrease in the model’s attention to local context. Therefore, selecting retrieval layers at appropriate intervals can actually enhance the model’s capabilities.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Related Work</h2>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1 </span>Long Context Language Modeling</h3>
<div class="ltx_para" id="S6.SS1.p1">
<p class="ltx_p" id="S6.SS1.p1.1">Long context Language Modeling mainly concentrate on length extension and context window expansion.
Length Extension studies typically target the popular RoPE encoding, aiming to scale unseen PE into the space of positions seen during pre-training. These works <cite class="ltx_cite ltx_citemacro_cite">Su et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib26" title="">2024</a>); Press et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib22" title="">2021</a>); Chen et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib7" title="">2023a</a>); Peng et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib21" title="">2023</a>)</cite> enable the model to generalize to unseen positional encodings during inference, thereby achieving extrapolation beyond the lengths encountered during training. In contrast, our method does not require modifying the PE, and only use one addition module to extend the context. Context Window Extension focuses on how to extend the context window that LLMs can handle the input at one time. Due to the quadratic time and space complexity of computing attention, extending the input length of language models is quite challenging. Sparse attention  <cite class="ltx_cite ltx_citemacro_cite">Kitaev et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib16" title="">2020</a>); Chen et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib8" title="">2023b</a>); Tworkowski et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib28" title="">2024</a>); Bertsch et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib5" title="">2024</a>); Beltagy et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib4" title="">2020</a>)</cite> techniques have made significant strides, but our focus is on improving long-range language modeling by enabling LLMs to access relevant information at shorter input lengths via a retrieval-enhanced method.</p>
</div>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2 </span>Retrieval-Augmented Language Modeling</h3>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.1">Much effort has been made to enhance Retrieval-Augmented Language Modeling <cite class="ltx_cite ltx_citemacro_cite">Lewis et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib18" title="">2020</a>); Izacard and Grave (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib13" title="">2020</a>); Ram et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib24" title="">2023</a>); Yu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib38" title="">2022</a>); Asai et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib2" title="">2023</a>)</cite>. While some approaches use external retrievers, non-parametric information fusion often falls short compared to parametric methods within the model. We concentrate on integrating retrieval concepts directly into the model. REALM <cite class="ltx_cite ltx_citemacro_cite">Guu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib11" title="">2020</a>)</cite> suggests that relying solely on internal model knowledge is inefficient and advocates for the model to learn to retrieve and comprehend. kNN-LM <cite class="ltx_cite ltx_citemacro_cite">Khandelwal et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib15" title="">2019</a>)</cite> enhances language modeling by blending the LLM’s next-word predictions with those from a retrieval-based mechanism. MemTrm <cite class="ltx_cite ltx_citemacro_cite">Wu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib33" title="">2022</a>)</cite> introduces a memory bank but risks shifting memory distributions due to parameter adjustments. LongMEM <cite class="ltx_cite ltx_citemacro_cite">Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib32" title="">2024b</a>)</cite> mitigates this by training a sub-network, though this adds significant overhead. In contrast, our approach involves a fixed pre-trained model, enhancing it with a frozen retriever that aligns with the model’s internal retrieval processes, thus avoiding distribution shifts and architectural changes.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Conclusion</h2>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">We introduce MemLong, an innovative approach that significantly enhances the capability of language models to process long texts by leveraging an external retriever. MemLong utilizes a proficient retriever to swiftly and accurately access text relevant to the distant context with minimal memory overhead. MemLong successfully expands the model’s context window from 2k to 80k tokens. We demonstrate that MemLong exhibits considerable competitive advantages in long-distance text modeling and comprehension tasks. MemLong can achieve up to a 10.4 percentage point improvement in performance compared to the full-context model.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Limitations</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">Our work primarily focuses on OpenLLaMA-3B. We hope that future research will explore and investigate the application of our methods to models of various sizes. At the same time, it has been found that while single-layer K-V Pairs can provide additional semantic information to the upper layers, this information is unstable. We hope that future work can provide a more rational framework to accommodate our methods. At the same time, we employ a retriever with fixed FlagEmbeddings <cite class="ltx_cite ltx_citemacro_cite">Xiao et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib35" title="">2023b</a>); Zhang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#bib.bib39" title="">2023a</a>)</cite>, but studying a greater range of retrievers would be useful.</p>
</div>
</section>
<section class="ltx_section" id="Sx2">
<h2 class="ltx_title ltx_title_section">Ethics Statement</h2>
<div class="ltx_para" id="Sx2.p1">
<p class="ltx_p" id="Sx2.p1.1">In the pursuit of advancing knowledge and developing innovative solutions, we are committed to upholding the highest ethical standards. Our work is guided by a steadfast dedication to integrity, transparency, and respect for all individuals and communities involved. Since pre-trained models may have some bias due to the unavoidable presence of harmful/offensive corpus during training, MemLong fine-tuning on Slimpajama will face this problem as well. Although solving this problem is out of our current work, we hope that there will be future work that addresses this type of problem well.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abdin et al. (2024)</span>
<span class="ltx_bibblock">
Marah Abdin, Sam Ade Jacobs, Ammar Ahmad Awan, Jyoti Aneja, Ahmed Awadallah, Hany Awadalla, Nguyen Bach, Amit Bahree, Arash Bakhtiari, Harkirat Behl, et al. 2024.

</span>
<span class="ltx_bibblock">Phi-3 technical report: A highly capable language model locally on your phone.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">arXiv preprint arXiv:2404.14219</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Asai et al. (2023)</span>
<span class="ltx_bibblock">
Akari Asai, Zeqiu Wu, Yizhong Wang, Avirup Sil, and Hannaneh Hajishirzi. 2023.

</span>
<span class="ltx_bibblock">Self-rag: Learning to retrieve, generate, and critique through self-reflection.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">arXiv preprint arXiv:2310.11511</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Azerbayev et al. (2023)</span>
<span class="ltx_bibblock">
Zhangir Azerbayev, Edward Ayers, and Bartosz Piotrowski. 2023.

</span>
<span class="ltx_bibblock">Proof-pile: A pre-training dataset of mathematical text.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Beltagy et al. (2020)</span>
<span class="ltx_bibblock">
Iz Beltagy, Matthew E Peters, and Arman Cohan. 2020.

</span>
<span class="ltx_bibblock">Longformer: The long-document transformer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">arXiv preprint arXiv:2004.05150</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bertsch et al. (2024)</span>
<span class="ltx_bibblock">
Amanda Bertsch, Uri Alon, Graham Neubig, and Matthew Gormley. 2024.

</span>
<span class="ltx_bibblock">Unlimiformer: Long-range transformers with unlimited length input.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Advances in Neural Information Processing Systems</em>, 36.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et al. (2020)</span>
<span class="ltx_bibblock">
Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. 2020.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Advances in neural information processing systems</em>, 33:1877–1901.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2023a)</span>
<span class="ltx_bibblock">
Shouyuan Chen, Sherman Wong, Liangjian Chen, and Yuandong Tian. 2023a.

</span>
<span class="ltx_bibblock">Extending context window of large language models via positional interpolation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">arXiv preprint arXiv:2306.15595</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2023b)</span>
<span class="ltx_bibblock">
Yukang Chen, Shengju Qian, Haotian Tang, Xin Lai, Zhijian Liu, Song Han, and Jiaya Jia. 2023b.

</span>
<span class="ltx_bibblock">Longlora: Efficient fine-tuning of long-context large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">arXiv preprint arXiv:2309.12307</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dai et al. (2019)</span>
<span class="ltx_bibblock">
Zihang Dai, Zhilin Yang, Yiming Yang, Jaime Carbonell, Quoc V Le, and Ruslan Salakhutdinov. 2019.

</span>
<span class="ltx_bibblock">Transformer-xl: Attentive language models beyond a fixed-length context.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:1901.02860</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fu et al. (2024)</span>
<span class="ltx_bibblock">
Yao Fu, Rameswar Panda, Xinyao Niu, Xiang Yue, Hannaneh Hajishirzi, Yoon Kim, and Hao Peng. 2024.

</span>
<span class="ltx_bibblock">Data engineering for scaling language models to 128k context.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">arXiv preprint arXiv:2402.10171</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Guu et al. (2020)</span>
<span class="ltx_bibblock">
Kelvin Guu, Kenton Lee, Zora Tung, Panupong Pasupat, and Ming-Wei Chang. 2020.

</span>
<span class="ltx_bibblock">Realm: Retrieval-augmented language model pre-training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">arXiv: Computation and Language,arXiv: Computation and Language</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al. (2021)</span>
<span class="ltx_bibblock">
Edward J Hu, Yelong Shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean Wang, Lu Wang, and Weizhu Chen. 2021.

</span>
<span class="ltx_bibblock">Lora: Low-rank adaptation of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">arXiv preprint arXiv:2106.09685</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Izacard and Grave (2020)</span>
<span class="ltx_bibblock">
Gautier Izacard and Edouard Grave. 2020.

</span>
<span class="ltx_bibblock">Leveraging passage retrieval with generative models for open domain question answering.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">arXiv preprint arXiv:2007.01282</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Johnson et al. (2019)</span>
<span class="ltx_bibblock">
Jeff Johnson, Matthijs Douze, and Hervé Jégou. 2019.

</span>
<span class="ltx_bibblock">Billion-scale similarity search with gpus.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">IEEE Transactions on Big Data</em>, 7(3):535–547.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khandelwal et al. (2019)</span>
<span class="ltx_bibblock">
Urvashi Khandelwal, Omer Levy, Dan Jurafsky, Luke Zettlemoyer, and Mike Lewis. 2019.

</span>
<span class="ltx_bibblock">Generalization through memorization: Nearest neighbor language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">arXiv preprint arXiv:1911.00172</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kitaev et al. (2020)</span>
<span class="ltx_bibblock">
Nikita Kitaev, Łukasz Kaiser, and Anselm Levskaya. 2020.

</span>
<span class="ltx_bibblock">Reformer: The efficient transformer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">arXiv preprint arXiv:2001.04451</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Koh et al. (2022)</span>
<span class="ltx_bibblock">
Huan Yee Koh, Jiaxin Ju, Ming Liu, and Shirui Pan. 2022.

</span>
<span class="ltx_bibblock">An empirical survey on long document summarization: Datasets, models, and metrics.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">ACM computing surveys</em>, 55(8):1–35.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al. (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, Mike Lewis, Wen-tau Yih, Tim Rocktäschel, et al. 2020.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for knowledge-intensive nlp tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Advances in Neural Information Processing Systems</em>, 33:9459–9474.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lu et al. (2024)</span>
<span class="ltx_bibblock">
Yi Lu, Xin Zhou, Wei He, Jun Zhao, Tao Ji, Tao Gui, Qi Zhang, and Xuanjing Huang. 2024.

</span>
<span class="ltx_bibblock">Longheads: Multi-head attention is secretly a long context processor.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">arXiv preprint arXiv:2402.10685</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Merity et al. (2016)</span>
<span class="ltx_bibblock">
Stephen Merity, Caiming Xiong, James Bradbury, and Richard Socher. 2016.

</span>
<span class="ltx_bibblock">Pointer sentinel mixture models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:1609.07843</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et al. (2023)</span>
<span class="ltx_bibblock">
Bowen Peng, Jeffrey Quesnelle, Honglu Fan, and Enrico Shippole. 2023.

</span>
<span class="ltx_bibblock">Yarn: Efficient context window extension of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">arXiv preprint arXiv:2309.00071</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Press et al. (2021)</span>
<span class="ltx_bibblock">
Ofir Press, Noah A Smith, and Mike Lewis. 2021.

</span>
<span class="ltx_bibblock">Train short, test long: Attention with linear biases enables input length extrapolation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2108.12409</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rae et al. (2019)</span>
<span class="ltx_bibblock">
Jack W Rae, Anna Potapenko, Siddhant M Jayakumar, Chloe Hillier, and Timothy P Lillicrap. 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://arxiv.org/abs/1911.05507" title="">Compressive transformers for long-range sequence modelling</a>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ram et al. (2023)</span>
<span class="ltx_bibblock">
Ori Ram, Yoav Levine, Itay Dalmedigos, Dor Muhlgay, Amnon Shashua, Kevin Leyton-Brown, and Yoav Shoham. 2023.

</span>
<span class="ltx_bibblock">In-context retrieval-augmented language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Transactions of the Association for Computational Linguistics</em>, 11:1316–1331.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rubin and Berant (2023)</span>
<span class="ltx_bibblock">
Ohad Rubin and Jonathan Berant. 2023.

</span>
<span class="ltx_bibblock">Long-range language modeling with self-retrieval.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">arXiv preprint arXiv:2306.13421</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Su et al. (2024)</span>
<span class="ltx_bibblock">
Jianlin Su, Murtadha Ahmed, Yu Lu, Shengfeng Pan, Wen Bo, and Yunfeng Liu. 2024.

</span>
<span class="ltx_bibblock">Roformer: Enhanced transformer with rotary position embedding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Neurocomputing</em>, 568:127063.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al. (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timothée Lacroix, Baptiste Rozière, Naman Goyal, Eric Hambro, Faisal Azhar, et al. 2023.

</span>
<span class="ltx_bibblock">Llama: Open and efficient foundation language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">arXiv preprint arXiv:2302.13971</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tworkowski et al. (2024)</span>
<span class="ltx_bibblock">
Szymon Tworkowski, Konrad Staniszewski, Mikołaj Pacek, Yuhuai Wu, Henryk Michalewski, and Piotr Miłoś. 2024.

</span>
<span class="ltx_bibblock">Focused transformer: Contrastive training for context scaling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Advances in Neural Information Processing Systems</em>, 36.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">Advances in neural information processing systems</em>, 30.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024a)</span>
<span class="ltx_bibblock">
Jian Wang, Chak Tou Leong, Jiashuo Wang, Dongding Lin, Wenjie Li, and Xiao-Yong Wei. 2024a.

</span>
<span class="ltx_bibblock">Instruct once, chat consistently in multiple rounds: An efficient tuning framework for dialogue.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">arXiv preprint arXiv:2402.06967</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2020)</span>
<span class="ltx_bibblock">
Sinong Wang, Belinda Z Li, Madian Khabsa, Han Fang, and Hao Ma. 2020.

</span>
<span class="ltx_bibblock">Linformer: Self-attention with linear complexity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">arXiv preprint arXiv:2006.04768</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024b)</span>
<span class="ltx_bibblock">
Weizhi Wang, Li Dong, Hao Cheng, Xiaodong Liu, Xifeng Yan, Jianfeng Gao, and Furu Wei. 2024b.

</span>
<span class="ltx_bibblock">Augmenting language models with long-term memory.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">Advances in Neural Information Processing Systems</em>, 36.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al. (2022)</span>
<span class="ltx_bibblock">
Yuhuai Wu, Markus N Rabe, DeLesley Hutchins, and Christian Szegedy. 2022.

</span>
<span class="ltx_bibblock">Memorizing transformers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">arXiv preprint arXiv:2203.08913</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al. (2023a)</span>
<span class="ltx_bibblock">
Guangxuan Xiao, Yuandong Tian, Beidi Chen, Song Han, and Mike Lewis. 2023a.

</span>
<span class="ltx_bibblock">Efficient streaming language models with attention sinks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2309.17453</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al. (2023b)</span>
<span class="ltx_bibblock">
Shitao Xiao, Zheng Liu, Peitian Zhang, and Niklas Muennighoff. 2023b.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://arxiv.org/abs/2309.07597" title="">C-pack: Packaged resources to advance general chinese embedding</a>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">Preprint</em>, arXiv:2309.07597.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yen et al. (2024)</span>
<span class="ltx_bibblock">
Howard Yen, Tianyu Gao, and Danqi Chen. 2024.

</span>
<span class="ltx_bibblock">Long-context language modeling with parallel context encoding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">arXiv preprint arXiv:2402.16617</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu et al. (2023)</span>
<span class="ltx_bibblock">
Haofei Yu, Yue Zhang, Wei Bi, et al. 2023.

</span>
<span class="ltx_bibblock">Trams: Training-free memory selection for long-range language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">arXiv preprint arXiv:2310.15494</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu et al. (2022)</span>
<span class="ltx_bibblock">
Wenhao Yu, Dan Iter, Shuohang Wang, Yichong Xu, Mingxuan Ju, Soumya Sanyal, Chenguang Zhu, Michael Zeng, and Meng Jiang. 2022.

</span>
<span class="ltx_bibblock">Generate rather than retrieve: Large language models are strong context generators.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">arXiv preprint arXiv:2209.10063</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2023a)</span>
<span class="ltx_bibblock">
Peitian Zhang, Shitao Xiao, Zheng Liu, Zhicheng Dou, and Jian-Yun Nie. 2023a.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://arxiv.org/abs/2310.07554" title="">Retrieve anything to augment large language models</a>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">Preprint</em>, arXiv:2310.07554.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2023b)</span>
<span class="ltx_bibblock">
Renrui Zhang, Jiaming Han, Chris Liu, Peng Gao, Aojun Zhou, Xiangfei Hu, Shilin Yan, Pan Lu, Hongsheng Li, and Yu Qiao. 2023b.

</span>
<span class="ltx_bibblock">Llama-adapter: Efficient fine-tuning of language models with zero-init attention.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">arXiv preprint arXiv:2303.16199</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhu et al. (2015)</span>
<span class="ltx_bibblock">
Yukun Zhu, Ryan Kiros, Rich Zemel, Ruslan Salakhutdinov, Raquel Urtasun, Antonio Torralba, and Sanja Fidler. 2015.

</span>
<span class="ltx_bibblock">Aligning books and movies: Towards story-like visual explanations by watching movies and reading books.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">Proceedings of the IEEE international conference on computer vision</em>, pages 19–27.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_table" id="A0.T4">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A0.T4.3" style="width:433.6pt;height:79.1pt;vertical-align:-0.9pt;"><span class="ltx_transformed_inner" style="transform:translate(-32.6pt,5.9pt) scale(0.869363680577867,0.869363680577867) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="A0.T4.3.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A0.T4.3.3.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A0.T4.3.3.4.1.1">Setting Name</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A0.T4.3.3.4.1.2">Retreival Layers</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A0.T4.3.3.4.1.3">Memory Layer</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A0.T4.3.3.4.1.4">Training Params</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A0.T4.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A0.T4.1.1.1.2">Retreival_All_and_Training_All</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A0.T4.1.1.1.1">[14,15,<math alttext="\dots" class="ltx_Math" display="inline" id="A0.T4.1.1.1.1.m1.1"><semantics id="A0.T4.1.1.1.1.m1.1a"><mi id="A0.T4.1.1.1.1.m1.1.1" mathvariant="normal" xref="A0.T4.1.1.1.1.m1.1.1.cmml">…</mi><annotation-xml encoding="MathML-Content" id="A0.T4.1.1.1.1.m1.1b"><ci id="A0.T4.1.1.1.1.m1.1.1.cmml" xref="A0.T4.1.1.1.1.m1.1.1">…</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T4.1.1.1.1.m1.1c">\dots</annotation><annotation encoding="application/x-llamapun" id="A0.T4.1.1.1.1.m1.1d">…</annotation></semantics></math>,26]</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A0.T4.1.1.1.3">13</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A0.T4.1.1.1.4">All of Model’s Trainable</td>
</tr>
<tr class="ltx_tr" id="A0.T4.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="A0.T4.2.2.2.2">Retreival_All_and_Training_Half</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A0.T4.2.2.2.1">[14,15,<math alttext="\dots" class="ltx_Math" display="inline" id="A0.T4.2.2.2.1.m1.1"><semantics id="A0.T4.2.2.2.1.m1.1a"><mi id="A0.T4.2.2.2.1.m1.1.1" mathvariant="normal" xref="A0.T4.2.2.2.1.m1.1.1.cmml">…</mi><annotation-xml encoding="MathML-Content" id="A0.T4.2.2.2.1.m1.1b"><ci id="A0.T4.2.2.2.1.m1.1.1.cmml" xref="A0.T4.2.2.2.1.m1.1.1">…</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T4.2.2.2.1.m1.1c">\dots</annotation><annotation encoding="application/x-llamapun" id="A0.T4.2.2.2.1.m1.1d">…</annotation></semantics></math>,26]</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A0.T4.2.2.2.3">13</td>
<td class="ltx_td ltx_align_center" id="A0.T4.2.2.2.4">Half of Model’s Trainable</td>
</tr>
<tr class="ltx_tr" id="A0.T4.3.3.3">
<td class="ltx_td ltx_align_left ltx_border_r" id="A0.T4.3.3.3.2">Retreival_Partial_and_Training_Half</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A0.T4.3.3.3.1">[14,16,18,<math alttext="\dots" class="ltx_Math" display="inline" id="A0.T4.3.3.3.1.m1.1"><semantics id="A0.T4.3.3.3.1.m1.1a"><mi id="A0.T4.3.3.3.1.m1.1.1" mathvariant="normal" xref="A0.T4.3.3.3.1.m1.1.1.cmml">…</mi><annotation-xml encoding="MathML-Content" id="A0.T4.3.3.3.1.m1.1b"><ci id="A0.T4.3.3.3.1.m1.1.1.cmml" xref="A0.T4.3.3.3.1.m1.1.1">…</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T4.3.3.3.1.m1.1c">\dots</annotation><annotation encoding="application/x-llamapun" id="A0.T4.3.3.3.1.m1.1d">…</annotation></semantics></math>,26]</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A0.T4.3.3.3.3">13</td>
<td class="ltx_td ltx_align_center" id="A0.T4.3.3.3.4">Half of Model’s Trainable</td>
</tr>
<tr class="ltx_tr" id="A0.T4.3.3.5.1">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="A0.T4.3.3.5.1.1">Retreival_lower_Partial_and_Training_Half</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="A0.T4.3.3.5.1.2">[14,18,22,26]</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="A0.T4.3.3.5.1.3">13</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A0.T4.3.3.5.1.4">Half of Model’s Trainable</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>The specific parameters of different setting names.</figcaption>
</figure>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Different Training Settings</h2>
<div class="ltx_para" id="A1.p1">
<p class="ltx_p" id="A1.p1.1">As shown in  <a class="ltx_ref" href="https://arxiv.org/html/2408.16967v1#A0.T4" title="Table 4 ‣ MemLong: Memory-Augmented Retrieval for Long Text Modeling"><span class="ltx_text ltx_ref_tag">4</span></a>, we list the variable values corresponding to different setting names in the ablation experiment.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Aug 30 01:57:03 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
