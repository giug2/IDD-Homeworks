<article class="ltx_document ltx_authors_1line">
 <h1 class="ltx_title ltx_title_document">
  Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization
 </h1>
 <div class="ltx_authors">
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Weiran Yao
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Shelby Heinecke
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Juan Carlos Niebles
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Zhiwei Liu
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Yihao Feng
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Le Xue
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Rithesh Murthy
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Zeyuan Chen
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Jianguo Zhang
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Devansh Arpit
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Ran Xu
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Phil Mui
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Huan Wang
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Caiming Xiong
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Silvio Savarese
   </span>
   <span class="ltx_author_notes">
    <span class="ltx_contact ltx_role_affiliation">
    </span>
    <span class="ltx_contact ltx_role_affiliation">
    </span>
   </span>
  </span>
 </div>
 <div class="ltx_abstract">
  <h6 class="ltx_title ltx_title_abstract">
   Abstract
  </h6>
  <p class="ltx_p" id="id1.id1">
   Recent months have seen the emergence of a powerful new trend in which large language models (LLMs) are augmented to become autonomous language agents capable of performing objective oriented multi-step tasks on their own, rather than merely responding to queries from human users. Most existing language agents, however, are not optimized using environment-specific rewards. Although some agents enable iterative refinement through verbal feedback, they do not reason and plan in ways that are compatible with gradient-based learning from rewards. This paper introduces a principled framework for reinforcing large language agents by learning a retrospective model, which automatically tunes the language agent prompts from environment feedback through policy gradient. Specifically, our proposed agent architecture learns from rewards across multiple environments and tasks, for fine-tuning a pre-trained language model which refines the language agent prompt by summarizing the root cause of prior failed attempts and proposing action plans. Experimental results on various tasks demonstrate that the language agents improve over time and that our approach considerably outperforms baselines that do not properly leverage gradients from the environment. This demonstrates that using policy gradient optimization to improve language agents, for which we believe our work is one of the first, seems promising and can be applied to optimize other models in the agent architecture to enhance agent performances over time.
  </p>
 </div>
 <section class="ltx_section" id="S1">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    1
   </span>
   Introduction
  </h2>
  <div class="ltx_para ltx_noindent" id="S1.p1">
   <p class="ltx_p" id="S1.p1.1">
    Recently, we have seen the emergence of a powerful new trend in which large language models (LLMs) are augmented to become autonomous language agents capable of performing tasks on their own, ultimately in the service of a goal, rather than simply responding to queries from human users. Prominent studies, including ReAct
    <cite class="ltx_cite ltx_citemacro_citep">
     (Yao et al.,
     <a class="ltx_ref" href="#bib.bib25" title="">
      2023
     </a>
     )
    </cite>
    , Toolformer
    <cite class="ltx_cite ltx_citemacro_citep">
     (Schick et al.,
     <a class="ltx_ref" href="#bib.bib14" title="">
      2023
     </a>
     )
    </cite>
    , HuggingGPT
    <cite class="ltx_cite ltx_citemacro_citep">
     (Shen et al.,
     <a class="ltx_ref" href="#bib.bib17" title="">
      2023
     </a>
     )
    </cite>
    , generative agents
    <cite class="ltx_cite ltx_citemacro_citep">
     (Park et al.,
     <a class="ltx_ref" href="#bib.bib12" title="">
      2023
     </a>
     )
    </cite>
    , WebGPT
    <cite class="ltx_cite ltx_citemacro_citep">
     (Nakano et al.,
     <a class="ltx_ref" href="#bib.bib10" title="">
      2021
     </a>
     )
    </cite>
    , AutoGPT
    <cite class="ltx_cite ltx_citemacro_citep">
     (Gravitas,
     <a class="ltx_ref" href="#bib.bib3" title="">
      2023
     </a>
     )
    </cite>
    , BabyAGI
    <cite class="ltx_cite ltx_citemacro_citep">
     (Nakajima,
     <a class="ltx_ref" href="#bib.bib9" title="">
      2023
     </a>
     )
    </cite>
    , and Langchain
    <cite class="ltx_cite ltx_citemacro_citep">
     (Chase,
     <a class="ltx_ref" href="#bib.bib2" title="">
      2023
     </a>
     )
    </cite>
    , have successfully showcased the viability of creating autonomous decision-making agents by leveraging the capabilities of LLMs. These approaches use LLMs to generate text-based outputs and actions that can be further employed for making API calls and executing operations within a given environment.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S1.p2">
   <p class="ltx_p" id="S1.p2.1">
    Given the immense scale of LLMs with an extensive parameter count, the behaviors of most existing language agents, however, are not optimized or aligned with environment reward functions. An exception is a very recent language agent architecture, namely Reflexion
    <cite class="ltx_cite ltx_citemacro_citep">
     (Shinn et al.,
     <a class="ltx_ref" href="#bib.bib18" title="">
      2023
     </a>
     )
    </cite>
    , and several other related work, e.g., Self-Refine
    <cite class="ltx_cite ltx_citemacro_citep">
     (Madaan et al.,
     <a class="ltx_ref" href="#bib.bib7" title="">
      2023b
     </a>
     )
    </cite>
    and Generative Agent
    <cite class="ltx_cite ltx_citemacro_citep">
     (Park et al.,
     <a class="ltx_ref" href="#bib.bib12" title="">
      2023
     </a>
     )
    </cite>
    , which use verbal feedback, namely self-reflection, to help agents learn from prior failure. These reflective agents convert binary or scalar reward from the environment into verbal feedback in the form of a textual summary, which is then added as additional context to the prompt for the language agent. The self-reflection feedback acts as a semantic signal by providing the agent with a concrete direction to improve upon, helping it learn from prior mistakes and prevent repetitive errors to perform better in the next attempt.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S1.p3">
   <p class="ltx_p" id="S1.p3.1">
    Although the self-reflection operation enables iterative refinement, generating useful reflective feedback from a pre-trained, frozen LLM is challenging, as showcased in
    <a class="ltx_ref" href="#S1.F1" title="In 1 Introduction ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
     <span class="ltx_text ltx_ref_tag">
      Fig.
     </span>
     <span class="ltx_text ltx_ref_tag">
      1
     </span>
    </a>
    , since it requires the LLM to have a good understanding of where the agent made mistakes in a specific environment, i.e., the credit assignment problem
    <cite class="ltx_cite ltx_citemacro_citep">
     (Sutton &amp; Barto,
     <a class="ltx_ref" href="#bib.bib21" title="">
      2018
     </a>
     )
    </cite>
    , as well as the ability to generate a summary containing actionable insights for improvement. The verbal reinforcement cannot be optimal, if the frozen language model has not been properly fine-tuned to specialize in credit assignment problems for the tasks in given environments. Furthermore, the existing language agents do not reason and plan in ways that are compatible with differentiable, gradient-based learning from rewards by exploiting the existing abundant reinforcement learning techniques. To address these limitations, this paper introduces
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S1.p3.1.1">
     Retroformer
    </span>
    , a principled framework for reinforcing language agents by learning a plug-in retrospective model, which automatically refines the language agent prompts from environment feedback through policy optimization. Specifically, our proposed agent architecture can learn from arbitrary reward information across multiple environments and tasks, for iteratively fine-tuning a pre-trained language model, which refines the language agent prompts by reflecting on failed attempts and assigning credits of actions taken by the agent on future rewards.
   </p>
  </div>
  <figure class="ltx_figure" id="S1.F1">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="199" id="S1.F1.g1" src="/html/2308.02151/assets/x1.png" width="461"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 1:
    </span>
    An example of uninformative self-reflections from a frozen LLM. The root cause of failure in prior trial is that the agent should have responded only the spinoff series “Teen Titans Go” not “Teen Titans” as the answer. The agent forgot its goal during a chain of thought, actions and lengthy observations. The verbal feedback from frozen LLM, however, only rephrases the prior actions sequences as the proposed new plan, resulting the same, incorrect actions in the next trial.
   </figcaption>
  </figure>
  <div class="ltx_para ltx_noindent" id="S1.p4">
   <p class="ltx_p" id="S1.p4.1">
    We conduct experiments on open-source simulation and real-world environments including HotPotQA
    <cite class="ltx_cite ltx_citemacro_citep">
     (Yang et al.,
     <a class="ltx_ref" href="#bib.bib24" title="">
      2018
     </a>
     )
    </cite>
    , which consists of search-based question answering tasks to test the tool use abilities of a web agent which needs to call Wikipedia APIs in multiple steps for answering question. We observe
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S1.p4.1.1">
     Retroformer
    </span>
    agents are faster learners compared with reflexion, which does not use gradient for reasoning and planning, and better decision-makers and reasoners. More concretely,
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S1.p4.1.2">
     Retroformer
    </span>
    agents improve the success rate of search-based question-anwering tasks in HotPotQA
    <cite class="ltx_cite ltx_citemacro_citep">
     (Yang et al.,
     <a class="ltx_ref" href="#bib.bib24" title="">
      2018
     </a>
     )
    </cite>
    by 18% in 4 attempts, which demonstrates the effectiveness of gradient-based reasoning and planning for tool use under large state-action space.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S1.p5">
   <p class="ltx_p" id="S1.p5.1">
    To summarize, our contributions are the following:
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S1.p6">
   <ul class="ltx_itemize" id="S1.I1">
    <li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para ltx_noindent" id="S1.I1.i1.p1">
      <p class="ltx_p" id="S1.I1.i1.p1.1">
       The paper introduces
       <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S1.I1.i1.p1.1.1">
        Retroformer
       </span>
       , which iteratively refines the prompts given to large language agents based on environmental feedback to improve learning speed and task completion. We take a policy gradient approach with the Actor LLM being part of the environment, allowing learning from a wide range of reward signals for diverse tasks and environments.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para ltx_noindent" id="S1.I1.i2.p1">
      <p class="ltx_p" id="S1.I1.i2.p1.1">
       The proposed method focuses on enhancing the retrospective model in the language agent architecture, without accessing the Actor LLM parameters or needing to propagate gradients through it. The agnostic nature of
       <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S1.I1.i2.p1.1.1">
        Retroformer
       </span>
       makes it a flexible plug-in module for various types of cloud-based LLMs, such as GPT or Bard.
      </p>
     </div>
    </li>
   </ul>
  </div>
 </section>
 <section class="ltx_section" id="S2">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    2
   </span>
   Related Work
  </h2>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px1">
   <h4 class="ltx_title ltx_title_paragraph">
    Autonomous Language Agents
   </h4>
   <div class="ltx_para ltx_noindent" id="S2.SS0.SSS0.Px1.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.1">
     We summarize in
     <a class="ltx_ref" href="#S2.T1" title="In Autonomous Language Agents ‣ 2 Related Work ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Table
      </span>
      <span class="ltx_text ltx_ref_tag">
       1
      </span>
     </a>
     the recent language agent literature related to our work from five perspectives and differentiate our method from them. The completion of a complex task typically involves numerous stages. An agent must possess knowledge of these stages and plan accordingly. Chain-of-Thoughts or CoT
     <cite class="ltx_cite ltx_citemacro_citep">
      (Wei et al.,
      <a class="ltx_ref" href="#bib.bib23" title="">
       2022
      </a>
      )
     </cite>
     is the pioneering work that prompts the agent to decompose challenging reasoning tasks into smaller, more manageable steps. ReAct
     <cite class="ltx_cite ltx_citemacro_citep">
      (Yao et al.,
      <a class="ltx_ref" href="#bib.bib25" title="">
       2023
      </a>
      )
     </cite>
     , on the other hand, proposes the exploitation of this reasoning and acting proficiency within LLM to encourage interaction with the environment (e.g. using the Wikipedia search API) by mapping observations to the generation of reasoning and action traces or API calls in natural language. This agent architecture has spawned various applications, such as HuggingGPT
     <cite class="ltx_cite ltx_citemacro_citep">
      (Shen et al.,
      <a class="ltx_ref" href="#bib.bib17" title="">
       2023
      </a>
      )
     </cite>
     , generative agents
     <cite class="ltx_cite ltx_citemacro_citep">
      (Park et al.,
      <a class="ltx_ref" href="#bib.bib12" title="">
       2023
      </a>
      )
     </cite>
     , WebGPT
     <cite class="ltx_cite ltx_citemacro_citep">
      (Nakano et al.,
      <a class="ltx_ref" href="#bib.bib10" title="">
       2021
      </a>
      )
     </cite>
     , AutoGPT
     <cite class="ltx_cite ltx_citemacro_citep">
      (Gravitas,
      <a class="ltx_ref" href="#bib.bib3" title="">
       2023
      </a>
      )
     </cite>
     , BabyAGI
     <cite class="ltx_cite ltx_citemacro_citep">
      (Nakajima,
      <a class="ltx_ref" href="#bib.bib9" title="">
       2023
      </a>
      )
     </cite>
     , and Langchain
     <cite class="ltx_cite ltx_citemacro_citep">
      (Chase,
      <a class="ltx_ref" href="#bib.bib2" title="">
       2023
      </a>
      )
     </cite>
     .
    </p>
   </div>
   <figure class="ltx_table" id="S2.T1">
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 1:
     </span>
     Related work on large language agents.
    </figcaption>
    <div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S2.T1.1" style="width:433.6pt;height:108.2pt;vertical-align:-0.7pt;">
     <span class="ltx_transformed_inner" style="transform:translate(-73.5pt,18.2pt) scale(0.746747531390154,0.746747531390154) ;">
      <table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S2.T1.1.1">
       <thead class="ltx_thead">
        <tr class="ltx_tr" id="S2.T1.1.1.1.1">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S2.T1.1.1.1.1.1">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.1.1">
           Approach
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.2">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.2.1">
           Gradient
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.3">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.3.1">
           Arbitrary
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.4">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.4.1">
           Iterative
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.5">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.5.1">
           Hidden
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.6">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.6.1">
           Decision
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1.7">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.7.1">
           Memory
          </span>
         </th>
        </tr>
       </thead>
       <tbody class="ltx_tbody">
        <tr class="ltx_tr" id="S2.T1.1.1.2.1">
         <th class="ltx_td ltx_th ltx_th_row" id="S2.T1.1.1.2.1.1">
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S2.T1.1.1.2.1.2">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.2.1.2.1">
           learning
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S2.T1.1.1.2.1.3">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.2.1.3.1">
           reward
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S2.T1.1.1.2.1.4">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.2.1.4.1">
           refinement
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S2.T1.1.1.2.1.5">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.2.1.5.1">
           constraints
          </span>
         </th>
         <th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S2.T1.1.1.2.1.6">
          <span class="ltx_text ltx_font_bold" id="S2.T1.1.1.2.1.6.1">
           making
          </span>
         </th>
         <td class="ltx_td" id="S2.T1.1.1.2.1.7">
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.3.2">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S2.T1.1.1.3.2.1">
          CoT
          <cite class="ltx_cite ltx_citemacro_citep">
           (Wei et al.,
           <a class="ltx_ref" href="#bib.bib23" title="">
            2022
           </a>
           )
          </cite>
         </th>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.2">
          <span class="ltx_text" id="S2.T1.1.1.3.2.2.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.3">
          <span class="ltx_text" id="S2.T1.1.1.3.2.3.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.4">
          <span class="ltx_text" id="S2.T1.1.1.3.2.4.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.5">
          <span class="ltx_text" id="S2.T1.1.1.3.2.5.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.6">
          <span class="ltx_text" id="S2.T1.1.1.3.2.6.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.1.3.2.7">
          <span class="ltx_text" id="S2.T1.1.1.3.2.7.1" style="color:#808080;">
           ✗
          </span>
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.4.3">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T1.1.1.4.3.1">
          ReAct
          <cite class="ltx_cite ltx_citemacro_citep">
           (Yao et al.,
           <a class="ltx_ref" href="#bib.bib25" title="">
            2023
           </a>
           )
          </cite>
         </th>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.2">
          <span class="ltx_text" id="S2.T1.1.1.4.3.2.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.3">
          <span class="ltx_text" id="S2.T1.1.1.4.3.3.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.4">
          <span class="ltx_text" id="S2.T1.1.1.4.3.4.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.5">
          <span class="ltx_text" id="S2.T1.1.1.4.3.5.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.6">
          <span class="ltx_text" id="S2.T1.1.1.4.3.6.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.4.3.7">
          <span class="ltx_text" id="S2.T1.1.1.4.3.7.1" style="color:#000000;">
           ✓
          </span>
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.5.4">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T1.1.1.5.4.1">
          Self-refine
          <cite class="ltx_cite ltx_citemacro_citep">
           (Madaan et al.,
           <a class="ltx_ref" href="#bib.bib7" title="">
            2023b
           </a>
           )
          </cite>
         </th>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.2">
          <span class="ltx_text" id="S2.T1.1.1.5.4.2.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.3">
          <span class="ltx_text" id="S2.T1.1.1.5.4.3.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.4">
          <span class="ltx_text" id="S2.T1.1.1.5.4.4.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.5">
          <span class="ltx_text" id="S2.T1.1.1.5.4.5.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.6">
          <span class="ltx_text" id="S2.T1.1.1.5.4.6.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.5.4.7">
          <span class="ltx_text" id="S2.T1.1.1.5.4.7.1" style="color:#808080;">
           ✗
          </span>
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.6.5">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T1.1.1.6.5.1">
          RAP
          <cite class="ltx_cite ltx_citemacro_citep">
           (Hao et al.,
           <a class="ltx_ref" href="#bib.bib4" title="">
            2023
           </a>
           )
          </cite>
         </th>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.2">
          <span class="ltx_text" id="S2.T1.1.1.6.5.2.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.3">
          <span class="ltx_text" id="S2.T1.1.1.6.5.3.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.4">
          <span class="ltx_text" id="S2.T1.1.1.6.5.4.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.5">
          <span class="ltx_text" id="S2.T1.1.1.6.5.5.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.6">
          <span class="ltx_text" id="S2.T1.1.1.6.5.6.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.6.5.7">
          <span class="ltx_text" id="S2.T1.1.1.6.5.7.1" style="color:#000000;">
           ✓
          </span>
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.7.6">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T1.1.1.7.6.1">
          Reflexion
          <cite class="ltx_cite ltx_citemacro_citep">
           (Shinn et al.,
           <a class="ltx_ref" href="#bib.bib18" title="">
            2023
           </a>
           )
          </cite>
         </th>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.2">
          <span class="ltx_text" id="S2.T1.1.1.7.6.2.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.3">
          <span class="ltx_text" id="S2.T1.1.1.7.6.3.1" style="color:#808080;">
           ✗
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.4">
          <span class="ltx_text" id="S2.T1.1.1.7.6.4.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.5">
          <span class="ltx_text" id="S2.T1.1.1.7.6.5.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.6">
          <span class="ltx_text" id="S2.T1.1.1.7.6.6.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center" id="S2.T1.1.1.7.6.7">
          <span class="ltx_text" id="S2.T1.1.1.7.6.7.1" style="color:#000000;">
           ✓
          </span>
         </td>
        </tr>
        <tr class="ltx_tr" id="S2.T1.1.1.8.7">
         <th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S2.T1.1.1.8.7.1">
          <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S2.T1.1.1.8.7.1.1">
           Retroformer
          </span>
          (our method)
         </th>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.2">
          <span class="ltx_text" id="S2.T1.1.1.8.7.2.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.3">
          <span class="ltx_text" id="S2.T1.1.1.8.7.3.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.4">
          <span class="ltx_text" id="S2.T1.1.1.8.7.4.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.5">
          <span class="ltx_text" id="S2.T1.1.1.8.7.5.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.6">
          <span class="ltx_text" id="S2.T1.1.1.8.7.6.1" style="color:#000000;">
           ✓
          </span>
         </td>
         <td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.1.8.7.7">
          <span class="ltx_text" id="S2.T1.1.1.8.7.7.1" style="color:#000000;">
           ✓
          </span>
         </td>
        </tr>
       </tbody>
      </table>
     </span>
    </div>
   </figure>
   <div class="ltx_para ltx_noindent" id="S2.SS0.SSS0.Px1.p2">
    <p class="ltx_p" id="S2.SS0.SSS0.Px1.p2.1">
     However, these approaches fail to learn from valuable feedback, such as environment rewards, to enhance the agent’s behaviors, resulting in performances that are solely dependent on the quality of the pre-trained LLM. Self-refine
     <cite class="ltx_cite ltx_citemacro_citep">
      (Madaan et al.,
      <a class="ltx_ref" href="#bib.bib6" title="">
       2023a
      </a>
      )
     </cite>
     addresses this limitation by employing a single LLM as a generator, refiner, and provider of feedback, allowing for iterative refinement of outputs. However, it is not specifically tailored for real-world task-based interaction with the environment. On the other hand, RAP
     <cite class="ltx_cite ltx_citemacro_citep">
      (Hao et al.,
      <a class="ltx_ref" href="#bib.bib4" title="">
       2023
      </a>
      )
     </cite>
     repurposes the LLM to function as both a world model and a reasoning agent. It incorporates Monte Carlo Tree Search for strategic exploration within the extensive realm of reasoning with environment rewards. This approach enables effective navigation and decision-making in complex domains. Recently,
     <cite class="ltx_cite ltx_citemacro_citet">
      Shinn et al. (
      <a class="ltx_ref" href="#bib.bib18" title="">
       2023
      </a>
      )
     </cite>
     presents Reflexion, a framework that equips agents with dynamic memory and self-reflection capabilities, enhancing their reasoning skills. Self-reflection plays a pivotal role, allowing autonomous agents to iteratively refine past actions, make improvements, and prevent repetitive errors.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S2.SS0.SSS0.Px2">
   <h4 class="ltx_title ltx_title_paragraph">
    Transformer Reinforcement Learning
   </h4>
   <div class="ltx_para ltx_noindent" id="S2.SS0.SSS0.Px2.p1">
    <p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.1">
     Reinforcement learning with a provided reward function or a reward-labeled dataset, commonly referred to as RLHF, has become a standard practice within the LLM fine-tuning pipeline. These endeavors have convincingly demonstrated the efficacy of RL as a means to guide language models towards desired behaviors that align with predefined reward functions encompassing various domains, including machine translation, summarization, and generating favorable reviews. Among the prevalent transformer RL methods are online RL algorithms such as Proximal Policy Optimization or PPO
     <cite class="ltx_cite ltx_citemacro_citep">
      (Schulman et al.,
      <a class="ltx_ref" href="#bib.bib16" title="">
       2017
      </a>
      )
     </cite>
     , and offline RL techniques such as Implicit Language Q-Learning or ILQL
     <cite class="ltx_cite ltx_citemacro_citep">
      (Snell et al.,
      <a class="ltx_ref" href="#bib.bib19" title="">
       2022
      </a>
      )
     </cite>
     and Direct Preference Optimization or DPO
     <cite class="ltx_cite ltx_citemacro_citep">
      (Rafailov et al.,
      <a class="ltx_ref" href="#bib.bib13" title="">
       2023
      </a>
      )
     </cite>
     . These methods have been implemented in
     <span class="ltx_text ltx_font_smallcaps" id="S2.SS0.SSS0.Px2.p1.1.1">
      trl/trlx
     </span>
     <cite class="ltx_cite ltx_citemacro_citep">
      (von Werra et al.,
      <a class="ltx_ref" href="#bib.bib22" title="">
       2020
      </a>
      )
     </cite>
     distributed training framework.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S3">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    3
   </span>
   Challenges
  </h2>
  <div class="ltx_para ltx_noindent" id="S3.p1">
   <p class="ltx_p" id="S3.p1.1">
    Although LLMs are not designed to handle tool use or take actions, it has been observed
    <cite class="ltx_cite ltx_citemacro_citep">
     (Gravitas,
     <a class="ltx_ref" href="#bib.bib3" title="">
      2023
     </a>
     ; Nakajima,
     <a class="ltx_ref" href="#bib.bib9" title="">
      2023
     </a>
     ; Chase,
     <a class="ltx_ref" href="#bib.bib2" title="">
      2023
     </a>
     )
    </cite>
    that empirically for text-rich environment, especially when the actions and states are accurately described using natural languages, LLMs work surprisingly well. However there are still plenty of challenges applying LLM-based agents. Here we list several below.
   </p>
  </div>
  <section class="ltx_paragraph" id="S3.SS0.SSS0.Px1">
   <h4 class="ltx_title ltx_title_paragraph">
    Spurious Actions
   </h4>
   <div class="ltx_para ltx_noindent" id="S3.SS0.SSS0.Px1.p1">
    <p class="ltx_p" id="S3.SS0.SSS0.Px1.p1.1">
     LLMs are not pre-trained or designed with an action-agent application in mind. Even some restrictions are explicitly specified in the prompt, the LLM model may still generate spurious actions that are not in the action space
     <math alttext="\mathcal{A}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.1.m1.1">
      <semantics id="S3.SS0.SSS0.Px1.p1.1.m1.1a">
       <mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml">
        𝒜
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.1.m1.1b">
        <ci id="S3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.1.m1.1.1">
         𝒜
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.1.m1.1c">
        \mathcal{A}
       </annotation>
      </semantics>
     </math>
     .
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S3.SS0.SSS0.Px2">
   <h4 class="ltx_title ltx_title_paragraph">
    Limited Prompt Length
   </h4>
   <div class="ltx_para ltx_noindent" id="S3.SS0.SSS0.Px2.p1">
    <p class="ltx_p" id="S3.SS0.SSS0.Px2.p1.1">
     LLM itself is stateless. However, in applications it is preferred to empower agents with states or memories for better performance. It has been observed that LLM based agents are easy to run into infinite loops if the states are not handled nicely. Many LLM agents concatenate all the previous state descriptions and actions into the prompt so that LLM as a way to bestow ”state” to the LLM. Inevitably this methodology runs into the prompt length issues. As the trajectory grows longer, the prompt runs out of spaces.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S3.SS0.SSS0.Px3">
   <h4 class="ltx_title ltx_title_paragraph">
    Heuristic Prompt Engineering
   </h4>
   <div class="ltx_para ltx_noindent" id="S3.SS0.SSS0.Px3.p1">
    <p class="ltx_p" id="S3.SS0.SSS0.Px3.p1.1">
     Even though a lot of paradigms have been proposed to improve LLM agents’ performance
     <cite class="ltx_cite ltx_citemacro_citep">
      (Yao et al.,
      <a class="ltx_ref" href="#bib.bib25" title="">
       2023
      </a>
      ; Ahn et al.,
      <a class="ltx_ref" href="#bib.bib1" title="">
       2022
      </a>
      )
     </cite>
     , there is a lack of systematic methodologies for consistent model refinement. In fact, manual prompt tuning is still widely used in a lot of the application scenarios.
    </p>
   </div>
  </section>
  <section class="ltx_paragraph" id="S3.SS0.SSS0.Px4">
   <h4 class="ltx_title ltx_title_paragraph">
    Prohibitive Training
   </h4>
   <div class="ltx_para ltx_noindent" id="S3.SS0.SSS0.Px4.p1">
    <p class="ltx_p" id="S3.SS0.SSS0.Px4.p1.1">
     Most of the well-performing LLMs are too large to be fit in just one or two GPUs. It is technically challenging to optimize the LLMs directly as is done in the the classical reinforcement learning setting. In particular, OpenAI has not provided any solution for RL based finetuning. Most of the issues are caused by the fact that LLMs are not pre-trained or designed with an action-agent application in mind.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S4">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    4
   </span>
   Intuition
  </h2>
  <div class="ltx_para ltx_noindent" id="S4.p1">
   <p class="ltx_p" id="S4.p1.1">
    Compared to the LLM-based action agents, classical RL agents, though not able to handle text-based environments as nicely in the zero shot setting, are able to keep improving based on the feedback and rewards provided by the environment. Popular RL algorithms include Policy Gradient
    <cite class="ltx_cite ltx_citemacro_citep">
     (Sutton et al.,
     <a class="ltx_ref" href="#bib.bib20" title="">
      2000
     </a>
     )
    </cite>
    , Proximal Policy Optimization Algorithm (PPO)
    <cite class="ltx_cite ltx_citemacro_citep">
     (Schulman et al.,
     <a class="ltx_ref" href="#bib.bib16" title="">
      2017
     </a>
     )
    </cite>
    , Trust Region Policy Optimization (TRPO)
    <cite class="ltx_cite ltx_citemacro_citep">
     (Schulman et al.,
     <a class="ltx_ref" href="#bib.bib15" title="">
      2015
     </a>
     )
    </cite>
    , and Advantage Actor Critic methods
    <cite class="ltx_cite ltx_citemacro_citep">
     (Mnih et al.,
     <a class="ltx_ref" href="#bib.bib8" title="">
      2016
     </a>
     )
    </cite>
    .
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S4.p2">
   <p class="ltx_p" id="S4.p2.1">
    In this draft we are proposing a simple but powerful novel framework to tackle the challenges mentioned above. On one hand, we would like to leverage the classical RL based optimization algorithms such as policy gradient to improve the model performance. On the other hand, our framework avoids finetuning on the LLM directly. The key is, instead of training the LLM directly, we train a retrospective LM. The retrospective LM takes users’ prompt, rewards and feedback from the environment as input. Its output will be prompt for the actual LLM to be consumed. RL algorithms are employed to optimize the weights in the retrospective LM model instead of directly on the LLM. In our framework the weights in the actual LLM is assumed to be fixed (untrainable), which aligns well with the application scenario when the LLM is either too large to tune or prohibited from any tuning.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S4.p3">
   <p class="ltx_p" id="S4.p3.1">
    Another perspective viewing our framework is, we train a retrospective LM to apply automatic prompt tuning for the LLM agents. In this case, the RL algorithms such as policy gradients are employed to optimize the prompts. Ideally the retrospective LM can help summarize the past “experience”, the users’ prompt, the environments’ feedback into a condensed text with length limit so that it is easier for the LLM to digest. To some extent, in our setting the original LLM can be considered as part of the environment since its parameters are all fixed.
   </p>
  </div>
 </section>
 <section class="ltx_section" id="S5">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    5
   </span>
   Notation and Formulation
  </h2>
  <div class="ltx_para ltx_noindent" id="S5.p1">
   <p class="ltx_p" id="S5.p1.10">
    We denote a large language model (LLM) based agent as a function
    <math alttext="\mathcal{L}_{\xi_{l}}:\mathcal{M}\rightarrow\mathcal{A}" class="ltx_Math" display="inline" id="S5.p1.1.m1.1">
     <semantics id="S5.p1.1.m1.1a">
      <mrow id="S5.p1.1.m1.1.1" xref="S5.p1.1.m1.1.1.cmml">
       <msub id="S5.p1.1.m1.1.1.2" xref="S5.p1.1.m1.1.1.2.cmml">
        <mi class="ltx_font_mathcaligraphic" id="S5.p1.1.m1.1.1.2.2" xref="S5.p1.1.m1.1.1.2.2.cmml">
         ℒ
        </mi>
        <msub id="S5.p1.1.m1.1.1.2.3" xref="S5.p1.1.m1.1.1.2.3.cmml">
         <mi id="S5.p1.1.m1.1.1.2.3.2" xref="S5.p1.1.m1.1.1.2.3.2.cmml">
          ξ
         </mi>
         <mi id="S5.p1.1.m1.1.1.2.3.3" xref="S5.p1.1.m1.1.1.2.3.3.cmml">
          l
         </mi>
        </msub>
       </msub>
       <mo id="S5.p1.1.m1.1.1.1" lspace="0.278em" rspace="0.278em" xref="S5.p1.1.m1.1.1.1.cmml">
        :
       </mo>
       <mrow id="S5.p1.1.m1.1.1.3" xref="S5.p1.1.m1.1.1.3.cmml">
        <mi class="ltx_font_mathcaligraphic" id="S5.p1.1.m1.1.1.3.2" xref="S5.p1.1.m1.1.1.3.2.cmml">
         ℳ
        </mi>
        <mo id="S5.p1.1.m1.1.1.3.1" stretchy="false" xref="S5.p1.1.m1.1.1.3.1.cmml">
         →
        </mo>
        <mi class="ltx_font_mathcaligraphic" id="S5.p1.1.m1.1.1.3.3" xref="S5.p1.1.m1.1.1.3.3.cmml">
         𝒜
        </mi>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p1.1.m1.1b">
       <apply id="S5.p1.1.m1.1.1.cmml" xref="S5.p1.1.m1.1.1">
        <ci id="S5.p1.1.m1.1.1.1.cmml" xref="S5.p1.1.m1.1.1.1">
         :
        </ci>
        <apply id="S5.p1.1.m1.1.1.2.cmml" xref="S5.p1.1.m1.1.1.2">
         <csymbol cd="ambiguous" id="S5.p1.1.m1.1.1.2.1.cmml" xref="S5.p1.1.m1.1.1.2">
          subscript
         </csymbol>
         <ci id="S5.p1.1.m1.1.1.2.2.cmml" xref="S5.p1.1.m1.1.1.2.2">
          ℒ
         </ci>
         <apply id="S5.p1.1.m1.1.1.2.3.cmml" xref="S5.p1.1.m1.1.1.2.3">
          <csymbol cd="ambiguous" id="S5.p1.1.m1.1.1.2.3.1.cmml" xref="S5.p1.1.m1.1.1.2.3">
           subscript
          </csymbol>
          <ci id="S5.p1.1.m1.1.1.2.3.2.cmml" xref="S5.p1.1.m1.1.1.2.3.2">
           𝜉
          </ci>
          <ci id="S5.p1.1.m1.1.1.2.3.3.cmml" xref="S5.p1.1.m1.1.1.2.3.3">
           𝑙
          </ci>
         </apply>
        </apply>
        <apply id="S5.p1.1.m1.1.1.3.cmml" xref="S5.p1.1.m1.1.1.3">
         <ci id="S5.p1.1.m1.1.1.3.1.cmml" xref="S5.p1.1.m1.1.1.3.1">
          →
         </ci>
         <ci id="S5.p1.1.m1.1.1.3.2.cmml" xref="S5.p1.1.m1.1.1.3.2">
          ℳ
         </ci>
         <ci id="S5.p1.1.m1.1.1.3.3.cmml" xref="S5.p1.1.m1.1.1.3.3">
          𝒜
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.1.m1.1c">
       \mathcal{L}_{\xi_{l}}:\mathcal{M}\rightarrow\mathcal{A}
      </annotation>
     </semantics>
    </math>
    , where
    <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S5.p1.2.m2.1">
     <semantics id="S5.p1.2.m2.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p1.2.m2.1.1" xref="S5.p1.2.m2.1.1.cmml">
       ℳ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.2.m2.1b">
       <ci id="S5.p1.2.m2.1.1.cmml" xref="S5.p1.2.m2.1.1">
        ℳ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.2.m2.1c">
       \mathcal{M}
      </annotation>
     </semantics>
    </math>
    is the space of prompts, which may include the actual prompts
    <math alttext="m^{u}" class="ltx_Math" display="inline" id="S5.p1.3.m3.1">
     <semantics id="S5.p1.3.m3.1a">
      <msup id="S5.p1.3.m3.1.1" xref="S5.p1.3.m3.1.1.cmml">
       <mi id="S5.p1.3.m3.1.1.2" xref="S5.p1.3.m3.1.1.2.cmml">
        m
       </mi>
       <mi id="S5.p1.3.m3.1.1.3" xref="S5.p1.3.m3.1.1.3.cmml">
        u
       </mi>
      </msup>
      <annotation-xml encoding="MathML-Content" id="S5.p1.3.m3.1b">
       <apply id="S5.p1.3.m3.1.1.cmml" xref="S5.p1.3.m3.1.1">
        <csymbol cd="ambiguous" id="S5.p1.3.m3.1.1.1.cmml" xref="S5.p1.3.m3.1.1">
         superscript
        </csymbol>
        <ci id="S5.p1.3.m3.1.1.2.cmml" xref="S5.p1.3.m3.1.1.2">
         𝑚
        </ci>
        <ci id="S5.p1.3.m3.1.1.3.cmml" xref="S5.p1.3.m3.1.1.3">
         𝑢
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.3.m3.1c">
       m^{u}
      </annotation>
     </semantics>
    </math>
    provided by the users, as well as some contextual information
    <math alttext="c\in\mathcal{C}" class="ltx_Math" display="inline" id="S5.p1.4.m4.1">
     <semantics id="S5.p1.4.m4.1a">
      <mrow id="S5.p1.4.m4.1.1" xref="S5.p1.4.m4.1.1.cmml">
       <mi id="S5.p1.4.m4.1.1.2" xref="S5.p1.4.m4.1.1.2.cmml">
        c
       </mi>
       <mo id="S5.p1.4.m4.1.1.1" xref="S5.p1.4.m4.1.1.1.cmml">
        ∈
       </mo>
       <mi class="ltx_font_mathcaligraphic" id="S5.p1.4.m4.1.1.3" xref="S5.p1.4.m4.1.1.3.cmml">
        𝒞
       </mi>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p1.4.m4.1b">
       <apply id="S5.p1.4.m4.1.1.cmml" xref="S5.p1.4.m4.1.1">
        <in id="S5.p1.4.m4.1.1.1.cmml" xref="S5.p1.4.m4.1.1.1">
        </in>
        <ci id="S5.p1.4.m4.1.1.2.cmml" xref="S5.p1.4.m4.1.1.2">
         𝑐
        </ci>
        <ci id="S5.p1.4.m4.1.1.3.cmml" xref="S5.p1.4.m4.1.1.3">
         𝒞
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.4.m4.1c">
       c\in\mathcal{C}
      </annotation>
     </semantics>
    </math>
    . Here
    <math alttext="\mathcal{C}" class="ltx_Math" display="inline" id="S5.p1.5.m5.1">
     <semantics id="S5.p1.5.m5.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p1.5.m5.1.1" xref="S5.p1.5.m5.1.1.cmml">
       𝒞
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.5.m5.1b">
       <ci id="S5.p1.5.m5.1.1.cmml" xref="S5.p1.5.m5.1.1">
        𝒞
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.5.m5.1c">
       \mathcal{C}
      </annotation>
     </semantics>
    </math>
    is the space of context as a representation of the current state
    <math alttext="\mathcal{S}" class="ltx_Math" display="inline" id="S5.p1.6.m6.1">
     <semantics id="S5.p1.6.m6.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p1.6.m6.1.1" xref="S5.p1.6.m6.1.1.cmml">
       𝒮
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.6.m6.1b">
       <ci id="S5.p1.6.m6.1.1.cmml" xref="S5.p1.6.m6.1.1">
        𝒮
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.6.m6.1c">
       \mathcal{S}
      </annotation>
     </semantics>
    </math>
    returned by the environment
    <math alttext="\Omega" class="ltx_Math" display="inline" id="S5.p1.7.m7.1">
     <semantics id="S5.p1.7.m7.1a">
      <mi id="S5.p1.7.m7.1.1" mathvariant="normal" xref="S5.p1.7.m7.1.1.cmml">
       Ω
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.7.m7.1b">
       <ci id="S5.p1.7.m7.1.1.cmml" xref="S5.p1.7.m7.1.1">
        Ω
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.7.m7.1c">
       \Omega
      </annotation>
     </semantics>
    </math>
    .
    <math alttext="\mathcal{A}" class="ltx_Math" display="inline" id="S5.p1.8.m8.1">
     <semantics id="S5.p1.8.m8.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p1.8.m8.1.1" xref="S5.p1.8.m8.1.1.cmml">
       𝒜
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.8.m8.1b">
       <ci id="S5.p1.8.m8.1.1.cmml" xref="S5.p1.8.m8.1.1">
        𝒜
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.8.m8.1c">
       \mathcal{A}
      </annotation>
     </semantics>
    </math>
    is the space of actions. Note the actions taken by most language model based agents are sampled auto-repressively, so
    <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S5.p1.9.m9.1">
     <semantics id="S5.p1.9.m9.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p1.9.m9.1.1" xref="S5.p1.9.m9.1.1.cmml">
       ℒ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p1.9.m9.1b">
       <ci id="S5.p1.9.m9.1.1.cmml" xref="S5.p1.9.m9.1.1">
        ℒ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.9.m9.1c">
       \mathcal{L}
      </annotation>
     </semantics>
    </math>
    is a random function. The subscript
    <math alttext="\xi_{l}" class="ltx_Math" display="inline" id="S5.p1.10.m10.1">
     <semantics id="S5.p1.10.m10.1a">
      <msub id="S5.p1.10.m10.1.1" xref="S5.p1.10.m10.1.1.cmml">
       <mi id="S5.p1.10.m10.1.1.2" xref="S5.p1.10.m10.1.1.2.cmml">
        ξ
       </mi>
       <mi id="S5.p1.10.m10.1.1.3" xref="S5.p1.10.m10.1.1.3.cmml">
        l
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p1.10.m10.1b">
       <apply id="S5.p1.10.m10.1.1.cmml" xref="S5.p1.10.m10.1.1">
        <csymbol cd="ambiguous" id="S5.p1.10.m10.1.1.1.cmml" xref="S5.p1.10.m10.1.1">
         subscript
        </csymbol>
        <ci id="S5.p1.10.m10.1.1.2.cmml" xref="S5.p1.10.m10.1.1.2">
         𝜉
        </ci>
        <ci id="S5.p1.10.m10.1.1.3.cmml" xref="S5.p1.10.m10.1.1.3">
         𝑙
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p1.10.m10.1c">
       \xi_{l}
      </annotation>
     </semantics>
    </math>
    denotes the re-parameterized random variables involved in the sampling process. Another note is, the LLM-based agent itself is stateless. All the states and possible memorization are characterized as text in the prompt.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S5.p2">
   <p class="ltx_p" id="S5.p2.11">
    The environment is defined as a tuple
    <math alttext="(\mathcal{T}_{\xi_{o}},\mathcal{R})" class="ltx_Math" display="inline" id="S5.p2.1.m1.2">
     <semantics id="S5.p2.1.m1.2a">
      <mrow id="S5.p2.1.m1.2.2.1" xref="S5.p2.1.m1.2.2.2.cmml">
       <mo id="S5.p2.1.m1.2.2.1.2" stretchy="false" xref="S5.p2.1.m1.2.2.2.cmml">
        (
       </mo>
       <msub id="S5.p2.1.m1.2.2.1.1" xref="S5.p2.1.m1.2.2.1.1.cmml">
        <mi class="ltx_font_mathcaligraphic" id="S5.p2.1.m1.2.2.1.1.2" xref="S5.p2.1.m1.2.2.1.1.2.cmml">
         𝒯
        </mi>
        <msub id="S5.p2.1.m1.2.2.1.1.3" xref="S5.p2.1.m1.2.2.1.1.3.cmml">
         <mi id="S5.p2.1.m1.2.2.1.1.3.2" xref="S5.p2.1.m1.2.2.1.1.3.2.cmml">
          ξ
         </mi>
         <mi id="S5.p2.1.m1.2.2.1.1.3.3" xref="S5.p2.1.m1.2.2.1.1.3.3.cmml">
          o
         </mi>
        </msub>
       </msub>
       <mo id="S5.p2.1.m1.2.2.1.3" xref="S5.p2.1.m1.2.2.2.cmml">
        ,
       </mo>
       <mi class="ltx_font_mathcaligraphic" id="S5.p2.1.m1.1.1" xref="S5.p2.1.m1.1.1.cmml">
        ℛ
       </mi>
       <mo id="S5.p2.1.m1.2.2.1.4" stretchy="false" xref="S5.p2.1.m1.2.2.2.cmml">
        )
       </mo>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.1.m1.2b">
       <interval closure="open" id="S5.p2.1.m1.2.2.2.cmml" xref="S5.p2.1.m1.2.2.1">
        <apply id="S5.p2.1.m1.2.2.1.1.cmml" xref="S5.p2.1.m1.2.2.1.1">
         <csymbol cd="ambiguous" id="S5.p2.1.m1.2.2.1.1.1.cmml" xref="S5.p2.1.m1.2.2.1.1">
          subscript
         </csymbol>
         <ci id="S5.p2.1.m1.2.2.1.1.2.cmml" xref="S5.p2.1.m1.2.2.1.1.2">
          𝒯
         </ci>
         <apply id="S5.p2.1.m1.2.2.1.1.3.cmml" xref="S5.p2.1.m1.2.2.1.1.3">
          <csymbol cd="ambiguous" id="S5.p2.1.m1.2.2.1.1.3.1.cmml" xref="S5.p2.1.m1.2.2.1.1.3">
           subscript
          </csymbol>
          <ci id="S5.p2.1.m1.2.2.1.1.3.2.cmml" xref="S5.p2.1.m1.2.2.1.1.3.2">
           𝜉
          </ci>
          <ci id="S5.p2.1.m1.2.2.1.1.3.3.cmml" xref="S5.p2.1.m1.2.2.1.1.3.3">
           𝑜
          </ci>
         </apply>
        </apply>
        <ci id="S5.p2.1.m1.1.1.cmml" xref="S5.p2.1.m1.1.1">
         ℛ
        </ci>
       </interval>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.1.m1.2c">
       (\mathcal{T}_{\xi_{o}},\mathcal{R})
      </annotation>
     </semantics>
    </math>
    .
    <math alttext="\mathcal{T}_{\xi_{o}}:\mathcal{S}\times\mathcal{A}\rightarrow\mathcal{S}" class="ltx_Math" display="inline" id="S5.p2.2.m2.1">
     <semantics id="S5.p2.2.m2.1a">
      <mrow id="S5.p2.2.m2.1.1" xref="S5.p2.2.m2.1.1.cmml">
       <msub id="S5.p2.2.m2.1.1.2" xref="S5.p2.2.m2.1.1.2.cmml">
        <mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.1.1.2.2" xref="S5.p2.2.m2.1.1.2.2.cmml">
         𝒯
        </mi>
        <msub id="S5.p2.2.m2.1.1.2.3" xref="S5.p2.2.m2.1.1.2.3.cmml">
         <mi id="S5.p2.2.m2.1.1.2.3.2" xref="S5.p2.2.m2.1.1.2.3.2.cmml">
          ξ
         </mi>
         <mi id="S5.p2.2.m2.1.1.2.3.3" xref="S5.p2.2.m2.1.1.2.3.3.cmml">
          o
         </mi>
        </msub>
       </msub>
       <mo id="S5.p2.2.m2.1.1.1" lspace="0.278em" rspace="0.278em" xref="S5.p2.2.m2.1.1.1.cmml">
        :
       </mo>
       <mrow id="S5.p2.2.m2.1.1.3" xref="S5.p2.2.m2.1.1.3.cmml">
        <mrow id="S5.p2.2.m2.1.1.3.2" xref="S5.p2.2.m2.1.1.3.2.cmml">
         <mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.1.1.3.2.2" xref="S5.p2.2.m2.1.1.3.2.2.cmml">
          𝒮
         </mi>
         <mo id="S5.p2.2.m2.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S5.p2.2.m2.1.1.3.2.1.cmml">
          ×
         </mo>
         <mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.1.1.3.2.3" xref="S5.p2.2.m2.1.1.3.2.3.cmml">
          𝒜
         </mi>
        </mrow>
        <mo id="S5.p2.2.m2.1.1.3.1" stretchy="false" xref="S5.p2.2.m2.1.1.3.1.cmml">
         →
        </mo>
        <mi class="ltx_font_mathcaligraphic" id="S5.p2.2.m2.1.1.3.3" xref="S5.p2.2.m2.1.1.3.3.cmml">
         𝒮
        </mi>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.2.m2.1b">
       <apply id="S5.p2.2.m2.1.1.cmml" xref="S5.p2.2.m2.1.1">
        <ci id="S5.p2.2.m2.1.1.1.cmml" xref="S5.p2.2.m2.1.1.1">
         :
        </ci>
        <apply id="S5.p2.2.m2.1.1.2.cmml" xref="S5.p2.2.m2.1.1.2">
         <csymbol cd="ambiguous" id="S5.p2.2.m2.1.1.2.1.cmml" xref="S5.p2.2.m2.1.1.2">
          subscript
         </csymbol>
         <ci id="S5.p2.2.m2.1.1.2.2.cmml" xref="S5.p2.2.m2.1.1.2.2">
          𝒯
         </ci>
         <apply id="S5.p2.2.m2.1.1.2.3.cmml" xref="S5.p2.2.m2.1.1.2.3">
          <csymbol cd="ambiguous" id="S5.p2.2.m2.1.1.2.3.1.cmml" xref="S5.p2.2.m2.1.1.2.3">
           subscript
          </csymbol>
          <ci id="S5.p2.2.m2.1.1.2.3.2.cmml" xref="S5.p2.2.m2.1.1.2.3.2">
           𝜉
          </ci>
          <ci id="S5.p2.2.m2.1.1.2.3.3.cmml" xref="S5.p2.2.m2.1.1.2.3.3">
           𝑜
          </ci>
         </apply>
        </apply>
        <apply id="S5.p2.2.m2.1.1.3.cmml" xref="S5.p2.2.m2.1.1.3">
         <ci id="S5.p2.2.m2.1.1.3.1.cmml" xref="S5.p2.2.m2.1.1.3.1">
          →
         </ci>
         <apply id="S5.p2.2.m2.1.1.3.2.cmml" xref="S5.p2.2.m2.1.1.3.2">
          <times id="S5.p2.2.m2.1.1.3.2.1.cmml" xref="S5.p2.2.m2.1.1.3.2.1">
          </times>
          <ci id="S5.p2.2.m2.1.1.3.2.2.cmml" xref="S5.p2.2.m2.1.1.3.2.2">
           𝒮
          </ci>
          <ci id="S5.p2.2.m2.1.1.3.2.3.cmml" xref="S5.p2.2.m2.1.1.3.2.3">
           𝒜
          </ci>
         </apply>
         <ci id="S5.p2.2.m2.1.1.3.3.cmml" xref="S5.p2.2.m2.1.1.3.3">
          𝒮
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.2.m2.1c">
       \mathcal{T}_{\xi_{o}}:\mathcal{S}\times\mathcal{A}\rightarrow\mathcal{S}
      </annotation>
     </semantics>
    </math>
    is the state transition function, where
    <math alttext="\mathcal{S}" class="ltx_Math" display="inline" id="S5.p2.3.m3.1">
     <semantics id="S5.p2.3.m3.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p2.3.m3.1.1" xref="S5.p2.3.m3.1.1.cmml">
       𝒮
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p2.3.m3.1b">
       <ci id="S5.p2.3.m3.1.1.cmml" xref="S5.p2.3.m3.1.1">
        𝒮
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.3.m3.1c">
       \mathcal{S}
      </annotation>
     </semantics>
    </math>
    is the space of states and
    <math alttext="\mathcal{A}" class="ltx_Math" display="inline" id="S5.p2.4.m4.1">
     <semantics id="S5.p2.4.m4.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p2.4.m4.1.1" xref="S5.p2.4.m4.1.1.cmml">
       𝒜
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p2.4.m4.1b">
       <ci id="S5.p2.4.m4.1.1.cmml" xref="S5.p2.4.m4.1.1">
        𝒜
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.4.m4.1c">
       \mathcal{A}
      </annotation>
     </semantics>
    </math>
    is the action space. Here we assume the states and actions are represented using text. Again we used
    <math alttext="\xi_{o}" class="ltx_Math" display="inline" id="S5.p2.5.m5.1">
     <semantics id="S5.p2.5.m5.1a">
      <msub id="S5.p2.5.m5.1.1" xref="S5.p2.5.m5.1.1.cmml">
       <mi id="S5.p2.5.m5.1.1.2" xref="S5.p2.5.m5.1.1.2.cmml">
        ξ
       </mi>
       <mi id="S5.p2.5.m5.1.1.3" xref="S5.p2.5.m5.1.1.3.cmml">
        o
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p2.5.m5.1b">
       <apply id="S5.p2.5.m5.1.1.cmml" xref="S5.p2.5.m5.1.1">
        <csymbol cd="ambiguous" id="S5.p2.5.m5.1.1.1.cmml" xref="S5.p2.5.m5.1.1">
         subscript
        </csymbol>
        <ci id="S5.p2.5.m5.1.1.2.cmml" xref="S5.p2.5.m5.1.1.2">
         𝜉
        </ci>
        <ci id="S5.p2.5.m5.1.1.3.cmml" xref="S5.p2.5.m5.1.1.3">
         𝑜
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.5.m5.1c">
       \xi_{o}
      </annotation>
     </semantics>
    </math>
    to represent the randomness involved in the state transition. For each state
    <math alttext="s\in\mathcal{S}" class="ltx_Math" display="inline" id="S5.p2.6.m6.1">
     <semantics id="S5.p2.6.m6.1a">
      <mrow id="S5.p2.6.m6.1.1" xref="S5.p2.6.m6.1.1.cmml">
       <mi id="S5.p2.6.m6.1.1.2" xref="S5.p2.6.m6.1.1.2.cmml">
        s
       </mi>
       <mo id="S5.p2.6.m6.1.1.1" xref="S5.p2.6.m6.1.1.1.cmml">
        ∈
       </mo>
       <mi class="ltx_font_mathcaligraphic" id="S5.p2.6.m6.1.1.3" xref="S5.p2.6.m6.1.1.3.cmml">
        𝒮
       </mi>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.6.m6.1b">
       <apply id="S5.p2.6.m6.1.1.cmml" xref="S5.p2.6.m6.1.1">
        <in id="S5.p2.6.m6.1.1.1.cmml" xref="S5.p2.6.m6.1.1.1">
        </in>
        <ci id="S5.p2.6.m6.1.1.2.cmml" xref="S5.p2.6.m6.1.1.2">
         𝑠
        </ci>
        <ci id="S5.p2.6.m6.1.1.3.cmml" xref="S5.p2.6.m6.1.1.3">
         𝒮
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.6.m6.1c">
       s\in\mathcal{S}
      </annotation>
     </semantics>
    </math>
    , a reward function is defined as
    <math alttext="\mathcal{R}:\mathcal{S}\rightarrow\mathbb{R}" class="ltx_Math" display="inline" id="S5.p2.7.m7.1">
     <semantics id="S5.p2.7.m7.1a">
      <mrow id="S5.p2.7.m7.1.1" xref="S5.p2.7.m7.1.1.cmml">
       <mi class="ltx_font_mathcaligraphic" id="S5.p2.7.m7.1.1.2" xref="S5.p2.7.m7.1.1.2.cmml">
        ℛ
       </mi>
       <mo id="S5.p2.7.m7.1.1.1" lspace="0.278em" rspace="0.278em" xref="S5.p2.7.m7.1.1.1.cmml">
        :
       </mo>
       <mrow id="S5.p2.7.m7.1.1.3" xref="S5.p2.7.m7.1.1.3.cmml">
        <mi class="ltx_font_mathcaligraphic" id="S5.p2.7.m7.1.1.3.2" xref="S5.p2.7.m7.1.1.3.2.cmml">
         𝒮
        </mi>
        <mo id="S5.p2.7.m7.1.1.3.1" stretchy="false" xref="S5.p2.7.m7.1.1.3.1.cmml">
         →
        </mo>
        <mi id="S5.p2.7.m7.1.1.3.3" xref="S5.p2.7.m7.1.1.3.3.cmml">
         ℝ
        </mi>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.7.m7.1b">
       <apply id="S5.p2.7.m7.1.1.cmml" xref="S5.p2.7.m7.1.1">
        <ci id="S5.p2.7.m7.1.1.1.cmml" xref="S5.p2.7.m7.1.1.1">
         :
        </ci>
        <ci id="S5.p2.7.m7.1.1.2.cmml" xref="S5.p2.7.m7.1.1.2">
         ℛ
        </ci>
        <apply id="S5.p2.7.m7.1.1.3.cmml" xref="S5.p2.7.m7.1.1.3">
         <ci id="S5.p2.7.m7.1.1.3.1.cmml" xref="S5.p2.7.m7.1.1.3.1">
          →
         </ci>
         <ci id="S5.p2.7.m7.1.1.3.2.cmml" xref="S5.p2.7.m7.1.1.3.2">
          𝒮
         </ci>
         <ci id="S5.p2.7.m7.1.1.3.3.cmml" xref="S5.p2.7.m7.1.1.3.3">
          ℝ
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.7.m7.1c">
       \mathcal{R}:\mathcal{S}\rightarrow\mathbb{R}
      </annotation>
     </semantics>
    </math>
    . At each step of the play, the state
    <math alttext="s" class="ltx_Math" display="inline" id="S5.p2.8.m8.1">
     <semantics id="S5.p2.8.m8.1a">
      <mi id="S5.p2.8.m8.1.1" xref="S5.p2.8.m8.1.1.cmml">
       s
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p2.8.m8.1b">
       <ci id="S5.p2.8.m8.1.1.cmml" xref="S5.p2.8.m8.1.1">
        𝑠
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.8.m8.1c">
       s
      </annotation>
     </semantics>
    </math>
    is described using natural language, and integrated into the context
    <math alttext="c" class="ltx_Math" display="inline" id="S5.p2.9.m9.1">
     <semantics id="S5.p2.9.m9.1a">
      <mi id="S5.p2.9.m9.1.1" xref="S5.p2.9.m9.1.1.cmml">
       c
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p2.9.m9.1b">
       <ci id="S5.p2.9.m9.1.1.cmml" xref="S5.p2.9.m9.1.1">
        𝑐
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.9.m9.1c">
       c
      </annotation>
     </semantics>
    </math>
    . In the context, previous states may also be described and embedded to help LLMs making a good guess on the next action to take. As in all the reinforcement learning setting, the final goal is to maximize the cumulative rewards, or returns
    <math alttext="G_{cum}=\sum_{t=0}^{T}R(s_{t})" class="ltx_Math" display="inline" id="S5.p2.10.m10.1">
     <semantics id="S5.p2.10.m10.1a">
      <mrow id="S5.p2.10.m10.1.1" xref="S5.p2.10.m10.1.1.cmml">
       <msub id="S5.p2.10.m10.1.1.3" xref="S5.p2.10.m10.1.1.3.cmml">
        <mi id="S5.p2.10.m10.1.1.3.2" xref="S5.p2.10.m10.1.1.3.2.cmml">
         G
        </mi>
        <mrow id="S5.p2.10.m10.1.1.3.3" xref="S5.p2.10.m10.1.1.3.3.cmml">
         <mi id="S5.p2.10.m10.1.1.3.3.2" xref="S5.p2.10.m10.1.1.3.3.2.cmml">
          c
         </mi>
         <mo id="S5.p2.10.m10.1.1.3.3.1" lspace="0em" rspace="0em" xref="S5.p2.10.m10.1.1.3.3.1.cmml">
          ​
         </mo>
         <mi id="S5.p2.10.m10.1.1.3.3.3" xref="S5.p2.10.m10.1.1.3.3.3.cmml">
          u
         </mi>
         <mo id="S5.p2.10.m10.1.1.3.3.1a" lspace="0em" rspace="0em" xref="S5.p2.10.m10.1.1.3.3.1.cmml">
          ​
         </mo>
         <mi id="S5.p2.10.m10.1.1.3.3.4" xref="S5.p2.10.m10.1.1.3.3.4.cmml">
          m
         </mi>
        </mrow>
       </msub>
       <mo id="S5.p2.10.m10.1.1.2" rspace="0.111em" xref="S5.p2.10.m10.1.1.2.cmml">
        =
       </mo>
       <mrow id="S5.p2.10.m10.1.1.1" xref="S5.p2.10.m10.1.1.1.cmml">
        <msubsup id="S5.p2.10.m10.1.1.1.2" xref="S5.p2.10.m10.1.1.1.2.cmml">
         <mo id="S5.p2.10.m10.1.1.1.2.2.2" xref="S5.p2.10.m10.1.1.1.2.2.2.cmml">
          ∑
         </mo>
         <mrow id="S5.p2.10.m10.1.1.1.2.2.3" xref="S5.p2.10.m10.1.1.1.2.2.3.cmml">
          <mi id="S5.p2.10.m10.1.1.1.2.2.3.2" xref="S5.p2.10.m10.1.1.1.2.2.3.2.cmml">
           t
          </mi>
          <mo id="S5.p2.10.m10.1.1.1.2.2.3.1" xref="S5.p2.10.m10.1.1.1.2.2.3.1.cmml">
           =
          </mo>
          <mn id="S5.p2.10.m10.1.1.1.2.2.3.3" xref="S5.p2.10.m10.1.1.1.2.2.3.3.cmml">
           0
          </mn>
         </mrow>
         <mi id="S5.p2.10.m10.1.1.1.2.3" xref="S5.p2.10.m10.1.1.1.2.3.cmml">
          T
         </mi>
        </msubsup>
        <mrow id="S5.p2.10.m10.1.1.1.1" xref="S5.p2.10.m10.1.1.1.1.cmml">
         <mi id="S5.p2.10.m10.1.1.1.1.3" xref="S5.p2.10.m10.1.1.1.1.3.cmml">
          R
         </mi>
         <mo id="S5.p2.10.m10.1.1.1.1.2" lspace="0em" rspace="0em" xref="S5.p2.10.m10.1.1.1.1.2.cmml">
          ​
         </mo>
         <mrow id="S5.p2.10.m10.1.1.1.1.1.1" xref="S5.p2.10.m10.1.1.1.1.1.1.1.cmml">
          <mo id="S5.p2.10.m10.1.1.1.1.1.1.2" stretchy="false" xref="S5.p2.10.m10.1.1.1.1.1.1.1.cmml">
           (
          </mo>
          <msub id="S5.p2.10.m10.1.1.1.1.1.1.1" xref="S5.p2.10.m10.1.1.1.1.1.1.1.cmml">
           <mi id="S5.p2.10.m10.1.1.1.1.1.1.1.2" xref="S5.p2.10.m10.1.1.1.1.1.1.1.2.cmml">
            s
           </mi>
           <mi id="S5.p2.10.m10.1.1.1.1.1.1.1.3" xref="S5.p2.10.m10.1.1.1.1.1.1.1.3.cmml">
            t
           </mi>
          </msub>
          <mo id="S5.p2.10.m10.1.1.1.1.1.1.3" stretchy="false" xref="S5.p2.10.m10.1.1.1.1.1.1.1.cmml">
           )
          </mo>
         </mrow>
        </mrow>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.10.m10.1b">
       <apply id="S5.p2.10.m10.1.1.cmml" xref="S5.p2.10.m10.1.1">
        <eq id="S5.p2.10.m10.1.1.2.cmml" xref="S5.p2.10.m10.1.1.2">
        </eq>
        <apply id="S5.p2.10.m10.1.1.3.cmml" xref="S5.p2.10.m10.1.1.3">
         <csymbol cd="ambiguous" id="S5.p2.10.m10.1.1.3.1.cmml" xref="S5.p2.10.m10.1.1.3">
          subscript
         </csymbol>
         <ci id="S5.p2.10.m10.1.1.3.2.cmml" xref="S5.p2.10.m10.1.1.3.2">
          𝐺
         </ci>
         <apply id="S5.p2.10.m10.1.1.3.3.cmml" xref="S5.p2.10.m10.1.1.3.3">
          <times id="S5.p2.10.m10.1.1.3.3.1.cmml" xref="S5.p2.10.m10.1.1.3.3.1">
          </times>
          <ci id="S5.p2.10.m10.1.1.3.3.2.cmml" xref="S5.p2.10.m10.1.1.3.3.2">
           𝑐
          </ci>
          <ci id="S5.p2.10.m10.1.1.3.3.3.cmml" xref="S5.p2.10.m10.1.1.3.3.3">
           𝑢
          </ci>
          <ci id="S5.p2.10.m10.1.1.3.3.4.cmml" xref="S5.p2.10.m10.1.1.3.3.4">
           𝑚
          </ci>
         </apply>
        </apply>
        <apply id="S5.p2.10.m10.1.1.1.cmml" xref="S5.p2.10.m10.1.1.1">
         <apply id="S5.p2.10.m10.1.1.1.2.cmml" xref="S5.p2.10.m10.1.1.1.2">
          <csymbol cd="ambiguous" id="S5.p2.10.m10.1.1.1.2.1.cmml" xref="S5.p2.10.m10.1.1.1.2">
           superscript
          </csymbol>
          <apply id="S5.p2.10.m10.1.1.1.2.2.cmml" xref="S5.p2.10.m10.1.1.1.2">
           <csymbol cd="ambiguous" id="S5.p2.10.m10.1.1.1.2.2.1.cmml" xref="S5.p2.10.m10.1.1.1.2">
            subscript
           </csymbol>
           <sum id="S5.p2.10.m10.1.1.1.2.2.2.cmml" xref="S5.p2.10.m10.1.1.1.2.2.2">
           </sum>
           <apply id="S5.p2.10.m10.1.1.1.2.2.3.cmml" xref="S5.p2.10.m10.1.1.1.2.2.3">
            <eq id="S5.p2.10.m10.1.1.1.2.2.3.1.cmml" xref="S5.p2.10.m10.1.1.1.2.2.3.1">
            </eq>
            <ci id="S5.p2.10.m10.1.1.1.2.2.3.2.cmml" xref="S5.p2.10.m10.1.1.1.2.2.3.2">
             𝑡
            </ci>
            <cn id="S5.p2.10.m10.1.1.1.2.2.3.3.cmml" type="integer" xref="S5.p2.10.m10.1.1.1.2.2.3.3">
             0
            </cn>
           </apply>
          </apply>
          <ci id="S5.p2.10.m10.1.1.1.2.3.cmml" xref="S5.p2.10.m10.1.1.1.2.3">
           𝑇
          </ci>
         </apply>
         <apply id="S5.p2.10.m10.1.1.1.1.cmml" xref="S5.p2.10.m10.1.1.1.1">
          <times id="S5.p2.10.m10.1.1.1.1.2.cmml" xref="S5.p2.10.m10.1.1.1.1.2">
          </times>
          <ci id="S5.p2.10.m10.1.1.1.1.3.cmml" xref="S5.p2.10.m10.1.1.1.1.3">
           𝑅
          </ci>
          <apply id="S5.p2.10.m10.1.1.1.1.1.1.1.cmml" xref="S5.p2.10.m10.1.1.1.1.1.1">
           <csymbol cd="ambiguous" id="S5.p2.10.m10.1.1.1.1.1.1.1.1.cmml" xref="S5.p2.10.m10.1.1.1.1.1.1">
            subscript
           </csymbol>
           <ci id="S5.p2.10.m10.1.1.1.1.1.1.1.2.cmml" xref="S5.p2.10.m10.1.1.1.1.1.1.1.2">
            𝑠
           </ci>
           <ci id="S5.p2.10.m10.1.1.1.1.1.1.1.3.cmml" xref="S5.p2.10.m10.1.1.1.1.1.1.1.3">
            𝑡
           </ci>
          </apply>
         </apply>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.10.m10.1c">
       G_{cum}=\sum_{t=0}^{T}R(s_{t})
      </annotation>
     </semantics>
    </math>
    . In many situations, the rewards are sparse, i.e.,
    <math alttext="R(s_{t})" class="ltx_Math" display="inline" id="S5.p2.11.m11.1">
     <semantics id="S5.p2.11.m11.1a">
      <mrow id="S5.p2.11.m11.1.1" xref="S5.p2.11.m11.1.1.cmml">
       <mi id="S5.p2.11.m11.1.1.3" xref="S5.p2.11.m11.1.1.3.cmml">
        R
       </mi>
       <mo id="S5.p2.11.m11.1.1.2" lspace="0em" rspace="0em" xref="S5.p2.11.m11.1.1.2.cmml">
        ​
       </mo>
       <mrow id="S5.p2.11.m11.1.1.1.1" xref="S5.p2.11.m11.1.1.1.1.1.cmml">
        <mo id="S5.p2.11.m11.1.1.1.1.2" stretchy="false" xref="S5.p2.11.m11.1.1.1.1.1.cmml">
         (
        </mo>
        <msub id="S5.p2.11.m11.1.1.1.1.1" xref="S5.p2.11.m11.1.1.1.1.1.cmml">
         <mi id="S5.p2.11.m11.1.1.1.1.1.2" xref="S5.p2.11.m11.1.1.1.1.1.2.cmml">
          s
         </mi>
         <mi id="S5.p2.11.m11.1.1.1.1.1.3" xref="S5.p2.11.m11.1.1.1.1.1.3.cmml">
          t
         </mi>
        </msub>
        <mo id="S5.p2.11.m11.1.1.1.1.3" stretchy="false" xref="S5.p2.11.m11.1.1.1.1.1.cmml">
         )
        </mo>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p2.11.m11.1b">
       <apply id="S5.p2.11.m11.1.1.cmml" xref="S5.p2.11.m11.1.1">
        <times id="S5.p2.11.m11.1.1.2.cmml" xref="S5.p2.11.m11.1.1.2">
        </times>
        <ci id="S5.p2.11.m11.1.1.3.cmml" xref="S5.p2.11.m11.1.1.3">
         𝑅
        </ci>
        <apply id="S5.p2.11.m11.1.1.1.1.1.cmml" xref="S5.p2.11.m11.1.1.1.1">
         <csymbol cd="ambiguous" id="S5.p2.11.m11.1.1.1.1.1.1.cmml" xref="S5.p2.11.m11.1.1.1.1">
          subscript
         </csymbol>
         <ci id="S5.p2.11.m11.1.1.1.1.1.2.cmml" xref="S5.p2.11.m11.1.1.1.1.1.2">
          𝑠
         </ci>
         <ci id="S5.p2.11.m11.1.1.1.1.1.3.cmml" xref="S5.p2.11.m11.1.1.1.1.1.3">
          𝑡
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p2.11.m11.1c">
       R(s_{t})
      </annotation>
     </semantics>
    </math>
    are mostly zero except very few states.
   </p>
  </div>
  <div class="ltx_para ltx_noindent" id="S5.p3">
   <p class="ltx_p" id="S5.p3.5">
    The retrospective model takes the all the previous states
    <math alttext="s_{1,\cdots,t}" class="ltx_Math" display="inline" id="S5.p3.1.m1.3">
     <semantics id="S5.p3.1.m1.3a">
      <msub id="S5.p3.1.m1.3.4" xref="S5.p3.1.m1.3.4.cmml">
       <mi id="S5.p3.1.m1.3.4.2" xref="S5.p3.1.m1.3.4.2.cmml">
        s
       </mi>
       <mrow id="S5.p3.1.m1.3.3.3.5" xref="S5.p3.1.m1.3.3.3.4.cmml">
        <mn id="S5.p3.1.m1.1.1.1.1" xref="S5.p3.1.m1.1.1.1.1.cmml">
         1
        </mn>
        <mo id="S5.p3.1.m1.3.3.3.5.1" xref="S5.p3.1.m1.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.1.m1.2.2.2.2" mathvariant="normal" xref="S5.p3.1.m1.2.2.2.2.cmml">
         ⋯
        </mi>
        <mo id="S5.p3.1.m1.3.3.3.5.2" xref="S5.p3.1.m1.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.1.m1.3.3.3.3" xref="S5.p3.1.m1.3.3.3.3.cmml">
         t
        </mi>
       </mrow>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p3.1.m1.3b">
       <apply id="S5.p3.1.m1.3.4.cmml" xref="S5.p3.1.m1.3.4">
        <csymbol cd="ambiguous" id="S5.p3.1.m1.3.4.1.cmml" xref="S5.p3.1.m1.3.4">
         subscript
        </csymbol>
        <ci id="S5.p3.1.m1.3.4.2.cmml" xref="S5.p3.1.m1.3.4.2">
         𝑠
        </ci>
        <list id="S5.p3.1.m1.3.3.3.4.cmml" xref="S5.p3.1.m1.3.3.3.5">
         <cn id="S5.p3.1.m1.1.1.1.1.cmml" type="integer" xref="S5.p3.1.m1.1.1.1.1">
          1
         </cn>
         <ci id="S5.p3.1.m1.2.2.2.2.cmml" xref="S5.p3.1.m1.2.2.2.2">
          ⋯
         </ci>
         <ci id="S5.p3.1.m1.3.3.3.3.cmml" xref="S5.p3.1.m1.3.3.3.3">
          𝑡
         </ci>
        </list>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.1.m1.3c">
       s_{1,\cdots,t}
      </annotation>
     </semantics>
    </math>
    , actions
    <math alttext="a_{1,\cdots,t}" class="ltx_Math" display="inline" id="S5.p3.2.m2.3">
     <semantics id="S5.p3.2.m2.3a">
      <msub id="S5.p3.2.m2.3.4" xref="S5.p3.2.m2.3.4.cmml">
       <mi id="S5.p3.2.m2.3.4.2" xref="S5.p3.2.m2.3.4.2.cmml">
        a
       </mi>
       <mrow id="S5.p3.2.m2.3.3.3.5" xref="S5.p3.2.m2.3.3.3.4.cmml">
        <mn id="S5.p3.2.m2.1.1.1.1" xref="S5.p3.2.m2.1.1.1.1.cmml">
         1
        </mn>
        <mo id="S5.p3.2.m2.3.3.3.5.1" xref="S5.p3.2.m2.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.2.m2.2.2.2.2" mathvariant="normal" xref="S5.p3.2.m2.2.2.2.2.cmml">
         ⋯
        </mi>
        <mo id="S5.p3.2.m2.3.3.3.5.2" xref="S5.p3.2.m2.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.2.m2.3.3.3.3" xref="S5.p3.2.m2.3.3.3.3.cmml">
         t
        </mi>
       </mrow>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p3.2.m2.3b">
       <apply id="S5.p3.2.m2.3.4.cmml" xref="S5.p3.2.m2.3.4">
        <csymbol cd="ambiguous" id="S5.p3.2.m2.3.4.1.cmml" xref="S5.p3.2.m2.3.4">
         subscript
        </csymbol>
        <ci id="S5.p3.2.m2.3.4.2.cmml" xref="S5.p3.2.m2.3.4.2">
         𝑎
        </ci>
        <list id="S5.p3.2.m2.3.3.3.4.cmml" xref="S5.p3.2.m2.3.3.3.5">
         <cn id="S5.p3.2.m2.1.1.1.1.cmml" type="integer" xref="S5.p3.2.m2.1.1.1.1">
          1
         </cn>
         <ci id="S5.p3.2.m2.2.2.2.2.cmml" xref="S5.p3.2.m2.2.2.2.2">
          ⋯
         </ci>
         <ci id="S5.p3.2.m2.3.3.3.3.cmml" xref="S5.p3.2.m2.3.3.3.3">
          𝑡
         </ci>
        </list>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.2.m2.3c">
       a_{1,\cdots,t}
      </annotation>
     </semantics>
    </math>
    , rewards
    <math alttext="r_{1,\cdots,t}" class="ltx_Math" display="inline" id="S5.p3.3.m3.3">
     <semantics id="S5.p3.3.m3.3a">
      <msub id="S5.p3.3.m3.3.4" xref="S5.p3.3.m3.3.4.cmml">
       <mi id="S5.p3.3.m3.3.4.2" xref="S5.p3.3.m3.3.4.2.cmml">
        r
       </mi>
       <mrow id="S5.p3.3.m3.3.3.3.5" xref="S5.p3.3.m3.3.3.3.4.cmml">
        <mn id="S5.p3.3.m3.1.1.1.1" xref="S5.p3.3.m3.1.1.1.1.cmml">
         1
        </mn>
        <mo id="S5.p3.3.m3.3.3.3.5.1" xref="S5.p3.3.m3.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.3.m3.2.2.2.2" mathvariant="normal" xref="S5.p3.3.m3.2.2.2.2.cmml">
         ⋯
        </mi>
        <mo id="S5.p3.3.m3.3.3.3.5.2" xref="S5.p3.3.m3.3.3.3.4.cmml">
         ,
        </mo>
        <mi id="S5.p3.3.m3.3.3.3.3" xref="S5.p3.3.m3.3.3.3.3.cmml">
         t
        </mi>
       </mrow>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p3.3.m3.3b">
       <apply id="S5.p3.3.m3.3.4.cmml" xref="S5.p3.3.m3.3.4">
        <csymbol cd="ambiguous" id="S5.p3.3.m3.3.4.1.cmml" xref="S5.p3.3.m3.3.4">
         subscript
        </csymbol>
        <ci id="S5.p3.3.m3.3.4.2.cmml" xref="S5.p3.3.m3.3.4.2">
         𝑟
        </ci>
        <list id="S5.p3.3.m3.3.3.3.4.cmml" xref="S5.p3.3.m3.3.3.3.5">
         <cn id="S5.p3.3.m3.1.1.1.1.cmml" type="integer" xref="S5.p3.3.m3.1.1.1.1">
          1
         </cn>
         <ci id="S5.p3.3.m3.2.2.2.2.cmml" xref="S5.p3.3.m3.2.2.2.2">
          ⋯
         </ci>
         <ci id="S5.p3.3.m3.3.3.3.3.cmml" xref="S5.p3.3.m3.3.3.3.3">
          𝑡
         </ci>
        </list>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.3.m3.3c">
       r_{1,\cdots,t}
      </annotation>
     </semantics>
    </math>
    , and the user prompt
    <math alttext="m^{u}" class="ltx_Math" display="inline" id="S5.p3.4.m4.1">
     <semantics id="S5.p3.4.m4.1a">
      <msup id="S5.p3.4.m4.1.1" xref="S5.p3.4.m4.1.1.cmml">
       <mi id="S5.p3.4.m4.1.1.2" xref="S5.p3.4.m4.1.1.2.cmml">
        m
       </mi>
       <mi id="S5.p3.4.m4.1.1.3" xref="S5.p3.4.m4.1.1.3.cmml">
        u
       </mi>
      </msup>
      <annotation-xml encoding="MathML-Content" id="S5.p3.4.m4.1b">
       <apply id="S5.p3.4.m4.1.1.cmml" xref="S5.p3.4.m4.1.1">
        <csymbol cd="ambiguous" id="S5.p3.4.m4.1.1.1.cmml" xref="S5.p3.4.m4.1.1">
         superscript
        </csymbol>
        <ci id="S5.p3.4.m4.1.1.2.cmml" xref="S5.p3.4.m4.1.1.2">
         𝑚
        </ci>
        <ci id="S5.p3.4.m4.1.1.3.cmml" xref="S5.p3.4.m4.1.1.3">
         𝑢
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.4.m4.1c">
       m^{u}
      </annotation>
     </semantics>
    </math>
    as input, and massage those information into a new prompt
    <math alttext="m" class="ltx_Math" display="inline" id="S5.p3.5.m5.1">
     <semantics id="S5.p3.5.m5.1a">
      <mi id="S5.p3.5.m5.1.1" xref="S5.p3.5.m5.1.1.cmml">
       m
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p3.5.m5.1b">
       <ci id="S5.p3.5.m5.1.1.cmml" xref="S5.p3.5.m5.1.1">
        𝑚
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.5.m5.1c">
       m
      </annotation>
     </semantics>
    </math>
    to be consumed by the LLM agent:
   </p>
   <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A1.EGx1">
    <tbody id="S5.E1">
     <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
      <td class="ltx_eqn_cell ltx_eqn_center_padleft">
      </td>
      <td class="ltx_td ltx_align_right ltx_eqn_cell">
       <math alttext="\displaystyle\Gamma_{\xi_{r},\Theta}:\left[\mathcal{S}_{i},\mathcal{A}_{i},\mathcal{R}_{i},\mathcal{M}^{u}_{i}\right]_{i=1}^{t}\rightarrow\mathcal{M}," class="ltx_Math" display="inline" id="S5.E1.m1.3">
        <semantics id="S5.E1.m1.3a">
         <mrow id="S5.E1.m1.3.3.1" xref="S5.E1.m1.3.3.1.1.cmml">
          <mrow id="S5.E1.m1.3.3.1.1" xref="S5.E1.m1.3.3.1.1.cmml">
           <msub id="S5.E1.m1.3.3.1.1.6" xref="S5.E1.m1.3.3.1.1.6.cmml">
            <mi id="S5.E1.m1.3.3.1.1.6.2" mathvariant="normal" xref="S5.E1.m1.3.3.1.1.6.2.cmml">
             Γ
            </mi>
            <mrow id="S5.E1.m1.2.2.2.2" xref="S5.E1.m1.2.2.2.3.cmml">
             <msub id="S5.E1.m1.2.2.2.2.1" xref="S5.E1.m1.2.2.2.2.1.cmml">
              <mi id="S5.E1.m1.2.2.2.2.1.2" xref="S5.E1.m1.2.2.2.2.1.2.cmml">
               ξ
              </mi>
              <mi id="S5.E1.m1.2.2.2.2.1.3" xref="S5.E1.m1.2.2.2.2.1.3.cmml">
               r
              </mi>
             </msub>
             <mo id="S5.E1.m1.2.2.2.2.2" xref="S5.E1.m1.2.2.2.3.cmml">
              ,
             </mo>
             <mi id="S5.E1.m1.1.1.1.1" mathvariant="normal" xref="S5.E1.m1.1.1.1.1.cmml">
              Θ
             </mi>
            </mrow>
           </msub>
           <mo id="S5.E1.m1.3.3.1.1.5" lspace="0.278em" rspace="0.278em" xref="S5.E1.m1.3.3.1.1.5.cmml">
            :
           </mo>
           <mrow id="S5.E1.m1.3.3.1.1.4" xref="S5.E1.m1.3.3.1.1.4.cmml">
            <msubsup id="S5.E1.m1.3.3.1.1.4.4" xref="S5.E1.m1.3.3.1.1.4.4.cmml">
             <mrow id="S5.E1.m1.3.3.1.1.4.4.4.4.4" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.4.4.5" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
               [
              </mo>
              <msub id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.cmml">
               <mi class="ltx_font_mathcaligraphic" id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.2" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">
                𝒮
               </mi>
               <mi id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.3" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.3.cmml">
                i
               </mi>
              </msub>
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.4.4.6" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
               ,
              </mo>
              <msub id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.cmml">
               <mi class="ltx_font_mathcaligraphic" id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.2" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.2.cmml">
                𝒜
               </mi>
               <mi id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.3" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.3.cmml">
                i
               </mi>
              </msub>
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.4.4.7" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
               ,
              </mo>
              <msub id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.cmml">
               <mi class="ltx_font_mathcaligraphic" id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.2" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.2.cmml">
                ℛ
               </mi>
               <mi id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.3" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.3.cmml">
                i
               </mi>
              </msub>
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.4.4.8" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
               ,
              </mo>
              <msubsup id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.cmml">
               <mi class="ltx_font_mathcaligraphic" id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.2" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.2.cmml">
                ℳ
               </mi>
               <mi id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.3" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.3.cmml">
                i
               </mi>
               <mi id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.3" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.3.cmml">
                u
               </mi>
              </msubsup>
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.4.4.9" xref="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml">
               ]
              </mo>
             </mrow>
             <mrow id="S5.E1.m1.3.3.1.1.4.4.4.6" xref="S5.E1.m1.3.3.1.1.4.4.4.6.cmml">
              <mi id="S5.E1.m1.3.3.1.1.4.4.4.6.2" xref="S5.E1.m1.3.3.1.1.4.4.4.6.2.cmml">
               i
              </mi>
              <mo id="S5.E1.m1.3.3.1.1.4.4.4.6.1" xref="S5.E1.m1.3.3.1.1.4.4.4.6.1.cmml">
               =
              </mo>
              <mn id="S5.E1.m1.3.3.1.1.4.4.4.6.3" xref="S5.E1.m1.3.3.1.1.4.4.4.6.3.cmml">
               1
              </mn>
             </mrow>
             <mi id="S5.E1.m1.3.3.1.1.4.4.6" xref="S5.E1.m1.3.3.1.1.4.4.6.cmml">
              t
             </mi>
            </msubsup>
            <mo id="S5.E1.m1.3.3.1.1.4.5" stretchy="false" xref="S5.E1.m1.3.3.1.1.4.5.cmml">
             →
            </mo>
            <mi class="ltx_font_mathcaligraphic" id="S5.E1.m1.3.3.1.1.4.6" xref="S5.E1.m1.3.3.1.1.4.6.cmml">
             ℳ
            </mi>
           </mrow>
          </mrow>
          <mo id="S5.E1.m1.3.3.1.2" xref="S5.E1.m1.3.3.1.1.cmml">
           ,
          </mo>
         </mrow>
         <annotation-xml encoding="MathML-Content" id="S5.E1.m1.3b">
          <apply id="S5.E1.m1.3.3.1.1.cmml" xref="S5.E1.m1.3.3.1">
           <ci id="S5.E1.m1.3.3.1.1.5.cmml" xref="S5.E1.m1.3.3.1.1.5">
            :
           </ci>
           <apply id="S5.E1.m1.3.3.1.1.6.cmml" xref="S5.E1.m1.3.3.1.1.6">
            <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.6.1.cmml" xref="S5.E1.m1.3.3.1.1.6">
             subscript
            </csymbol>
            <ci id="S5.E1.m1.3.3.1.1.6.2.cmml" xref="S5.E1.m1.3.3.1.1.6.2">
             Γ
            </ci>
            <list id="S5.E1.m1.2.2.2.3.cmml" xref="S5.E1.m1.2.2.2.2">
             <apply id="S5.E1.m1.2.2.2.2.1.cmml" xref="S5.E1.m1.2.2.2.2.1">
              <csymbol cd="ambiguous" id="S5.E1.m1.2.2.2.2.1.1.cmml" xref="S5.E1.m1.2.2.2.2.1">
               subscript
              </csymbol>
              <ci id="S5.E1.m1.2.2.2.2.1.2.cmml" xref="S5.E1.m1.2.2.2.2.1.2">
               𝜉
              </ci>
              <ci id="S5.E1.m1.2.2.2.2.1.3.cmml" xref="S5.E1.m1.2.2.2.2.1.3">
               𝑟
              </ci>
             </apply>
             <ci id="S5.E1.m1.1.1.1.1.cmml" xref="S5.E1.m1.1.1.1.1">
              Θ
             </ci>
            </list>
           </apply>
           <apply id="S5.E1.m1.3.3.1.1.4.cmml" xref="S5.E1.m1.3.3.1.1.4">
            <ci id="S5.E1.m1.3.3.1.1.4.5.cmml" xref="S5.E1.m1.3.3.1.1.4.5">
             →
            </ci>
            <apply id="S5.E1.m1.3.3.1.1.4.4.cmml" xref="S5.E1.m1.3.3.1.1.4.4">
             <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.4.4.5.cmml" xref="S5.E1.m1.3.3.1.1.4.4">
              superscript
             </csymbol>
             <apply id="S5.E1.m1.3.3.1.1.4.4.4.cmml" xref="S5.E1.m1.3.3.1.1.4.4">
              <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.4.4.4.5.cmml" xref="S5.E1.m1.3.3.1.1.4.4">
               subscript
              </csymbol>
              <list id="S5.E1.m1.3.3.1.1.4.4.4.4.5.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4">
               <apply id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1">
                 subscript
                </csymbol>
                <ci id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.2.cmml" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.2">
                 𝒮
                </ci>
                <ci id="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.3.cmml" xref="S5.E1.m1.3.3.1.1.1.1.1.1.1.1.3">
                 𝑖
                </ci>
               </apply>
               <apply id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.cmml" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2">
                <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.1.cmml" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2">
                 subscript
                </csymbol>
                <ci id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.2.cmml" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.2">
                 𝒜
                </ci>
                <ci id="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.3.cmml" xref="S5.E1.m1.3.3.1.1.2.2.2.2.2.2.3">
                 𝑖
                </ci>
               </apply>
               <apply id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.cmml" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3">
                <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.1.cmml" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3">
                 subscript
                </csymbol>
                <ci id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.2.cmml" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.2">
                 ℛ
                </ci>
                <ci id="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.3.cmml" xref="S5.E1.m1.3.3.1.1.3.3.3.3.3.3.3">
                 𝑖
                </ci>
               </apply>
               <apply id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4">
                <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.1.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4">
                 subscript
                </csymbol>
                <apply id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4">
                 <csymbol cd="ambiguous" id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.1.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4">
                  superscript
                 </csymbol>
                 <ci id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.2.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.2">
                  ℳ
                 </ci>
                 <ci id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.3.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.2.3">
                  𝑢
                 </ci>
                </apply>
                <ci id="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.3.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.4.4.4.3">
                 𝑖
                </ci>
               </apply>
              </list>
              <apply id="S5.E1.m1.3.3.1.1.4.4.4.6.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.6">
               <eq id="S5.E1.m1.3.3.1.1.4.4.4.6.1.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.6.1">
               </eq>
               <ci id="S5.E1.m1.3.3.1.1.4.4.4.6.2.cmml" xref="S5.E1.m1.3.3.1.1.4.4.4.6.2">
                𝑖
               </ci>
               <cn id="S5.E1.m1.3.3.1.1.4.4.4.6.3.cmml" type="integer" xref="S5.E1.m1.3.3.1.1.4.4.4.6.3">
                1
               </cn>
              </apply>
             </apply>
             <ci id="S5.E1.m1.3.3.1.1.4.4.6.cmml" xref="S5.E1.m1.3.3.1.1.4.4.6">
              𝑡
             </ci>
            </apply>
            <ci id="S5.E1.m1.3.3.1.1.4.6.cmml" xref="S5.E1.m1.3.3.1.1.4.6">
             ℳ
            </ci>
           </apply>
          </apply>
         </annotation-xml>
         <annotation encoding="application/x-tex" id="S5.E1.m1.3c">
          \displaystyle\Gamma_{\xi_{r},\Theta}:\left[\mathcal{S}_{i},\mathcal{A}_{i},\mathcal{R}_{i},\mathcal{M}^{u}_{i}\right]_{i=1}^{t}\rightarrow\mathcal{M},
         </annotation>
        </semantics>
       </math>
      </td>
      <td class="ltx_eqn_cell ltx_eqn_center_padright">
      </td>
      <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
       <span class="ltx_tag ltx_tag_equation ltx_align_right">
        (1)
       </span>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="ltx_p" id="S5.p3.7">
    where
    <math alttext="\xi_{r}" class="ltx_Math" display="inline" id="S5.p3.6.m1.1">
     <semantics id="S5.p3.6.m1.1a">
      <msub id="S5.p3.6.m1.1.1" xref="S5.p3.6.m1.1.1.cmml">
       <mi id="S5.p3.6.m1.1.1.2" xref="S5.p3.6.m1.1.1.2.cmml">
        ξ
       </mi>
       <mi id="S5.p3.6.m1.1.1.3" xref="S5.p3.6.m1.1.1.3.cmml">
        r
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p3.6.m1.1b">
       <apply id="S5.p3.6.m1.1.1.cmml" xref="S5.p3.6.m1.1.1">
        <csymbol cd="ambiguous" id="S5.p3.6.m1.1.1.1.cmml" xref="S5.p3.6.m1.1.1">
         subscript
        </csymbol>
        <ci id="S5.p3.6.m1.1.1.2.cmml" xref="S5.p3.6.m1.1.1.2">
         𝜉
        </ci>
        <ci id="S5.p3.6.m1.1.1.3.cmml" xref="S5.p3.6.m1.1.1.3">
         𝑟
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.6.m1.1c">
       \xi_{r}
      </annotation>
     </semantics>
    </math>
    stands for the randomness involved in the retrospective model, and
    <math alttext="\Theta" class="ltx_Math" display="inline" id="S5.p3.7.m2.1">
     <semantics id="S5.p3.7.m2.1a">
      <mi id="S5.p3.7.m2.1.1" mathvariant="normal" xref="S5.p3.7.m2.1.1.cmml">
       Θ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p3.7.m2.1b">
       <ci id="S5.p3.7.m2.1.1.cmml" xref="S5.p3.7.m2.1.1">
        Θ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p3.7.m2.1c">
       \Theta
      </annotation>
     </semantics>
    </math>
    is the set of learnable parameters in the retrospective model. The goal of the RL optimization is
   </p>
   <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A1.EGx2">
    <tbody id="S5.Ex1">
     <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
      <td class="ltx_eqn_cell ltx_eqn_center_padleft">
      </td>
      <td class="ltx_td ltx_align_right ltx_eqn_cell">
      </td>
      <td class="ltx_td ltx_align_left ltx_eqn_cell">
       <math alttext="\displaystyle\arg\max_{\Theta}~{}~{}~{}~{}\mathbb{E}_{\xi_{l},\xi_{o},\xi_{r}}\left[\sum_{t=1}^{T}R(s_{t})\right]~{}~{}~{}~{}~{}~{}~{}s.t.~{}~{}~{}~{}" class="ltx_Math" display="inline" id="S5.Ex1.m2.6">
        <semantics id="S5.Ex1.m2.6a">
         <mrow id="S5.Ex1.m2.6.6.1">
          <mrow id="S5.Ex1.m2.6.6.1.1.1" xref="S5.Ex1.m2.6.6.1.1.2.cmml">
           <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2" xref="S5.Ex1.m2.6.6.1.1.1.1.3.cmml">
            <mrow id="S5.Ex1.m2.6.6.1.1.1.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.cmml">
             <mi id="S5.Ex1.m2.6.6.1.1.1.1.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.1.cmml">
              arg
             </mi>
             <mo id="S5.Ex1.m2.6.6.1.1.1.1.1.1a" lspace="0.167em" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.cmml">
              ⁡
             </mo>
             <munder id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.cmml">
              <mi id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.2" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.2.cmml">
               max
              </mi>
              <mi id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.3" mathvariant="normal" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.3.cmml">
               Θ
              </mi>
             </munder>
            </mrow>
            <mspace id="S5.Ex1.m2.6.6.1.1.1.1.2.3" width="1.487em" xref="S5.Ex1.m2.6.6.1.1.1.1.3.cmml">
            </mspace>
            <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.cmml">
             <msub id="S5.Ex1.m2.6.6.1.1.1.1.2.2.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.cmml">
              <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.2.cmml">
               𝔼
              </mi>
              <mrow id="S5.Ex1.m2.3.3.3.3" xref="S5.Ex1.m2.3.3.3.4.cmml">
               <msub id="S5.Ex1.m2.1.1.1.1.1" xref="S5.Ex1.m2.1.1.1.1.1.cmml">
                <mi id="S5.Ex1.m2.1.1.1.1.1.2" xref="S5.Ex1.m2.1.1.1.1.1.2.cmml">
                 ξ
                </mi>
                <mi id="S5.Ex1.m2.1.1.1.1.1.3" xref="S5.Ex1.m2.1.1.1.1.1.3.cmml">
                 l
                </mi>
               </msub>
               <mo id="S5.Ex1.m2.3.3.3.3.4" xref="S5.Ex1.m2.3.3.3.4.cmml">
                ,
               </mo>
               <msub id="S5.Ex1.m2.2.2.2.2.2" xref="S5.Ex1.m2.2.2.2.2.2.cmml">
                <mi id="S5.Ex1.m2.2.2.2.2.2.2" xref="S5.Ex1.m2.2.2.2.2.2.2.cmml">
                 ξ
                </mi>
                <mi id="S5.Ex1.m2.2.2.2.2.2.3" xref="S5.Ex1.m2.2.2.2.2.2.3.cmml">
                 o
                </mi>
               </msub>
               <mo id="S5.Ex1.m2.3.3.3.3.5" xref="S5.Ex1.m2.3.3.3.4.cmml">
                ,
               </mo>
               <msub id="S5.Ex1.m2.3.3.3.3.3" xref="S5.Ex1.m2.3.3.3.3.3.cmml">
                <mi id="S5.Ex1.m2.3.3.3.3.3.2" xref="S5.Ex1.m2.3.3.3.3.3.2.cmml">
                 ξ
                </mi>
                <mi id="S5.Ex1.m2.3.3.3.3.3.3" xref="S5.Ex1.m2.3.3.3.3.3.3.cmml">
                 r
                </mi>
               </msub>
              </mrow>
             </msub>
             <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.2" lspace="0em" rspace="0em" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.2.cmml">
              ​
             </mo>
             <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.2.cmml">
              <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.2.1.cmml">
               [
              </mo>
              <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.cmml">
               <mstyle displaystyle="true" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.cmml">
                <munderover id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2a" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.cmml">
                 <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.2" movablelimits="false" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.2.cmml">
                  ∑
                 </mo>
                 <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.cmml">
                  <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.2.cmml">
                   t
                  </mi>
                  <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.1.cmml">
                   =
                  </mo>
                  <mn id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.3.cmml">
                   1
                  </mn>
                 </mrow>
                 <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.3.cmml">
                  T
                 </mi>
                </munderover>
               </mstyle>
               <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.cmml">
                <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.3.cmml">
                 R
                </mi>
                <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.2" lspace="0em" rspace="0em" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.2.cmml">
                 ​
                </mo>
                <mrow id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.cmml">
                 <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.cmml">
                  (
                 </mo>
                 <msub id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.cmml">
                  <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.2" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.2.cmml">
                   s
                  </mi>
                  <mi id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.3.cmml">
                   t
                  </mi>
                 </msub>
                 <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.cmml">
                  )
                 </mo>
                </mrow>
               </mrow>
              </mrow>
              <mo id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.3" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.2.1.cmml">
               ]
              </mo>
             </mrow>
            </mrow>
            <mspace id="S5.Ex1.m2.6.6.1.1.1.1.2.4" width="2.31em" xref="S5.Ex1.m2.6.6.1.1.1.1.3.cmml">
            </mspace>
            <mi id="S5.Ex1.m2.4.4" xref="S5.Ex1.m2.4.4.cmml">
             s
            </mi>
           </mrow>
           <mo id="S5.Ex1.m2.6.6.1.1.1.2" lspace="0em" rspace="0.167em" xref="S5.Ex1.m2.6.6.1.1.2a.cmml">
            .
           </mo>
           <mi id="S5.Ex1.m2.5.5" xref="S5.Ex1.m2.5.5.cmml">
            t
           </mi>
          </mrow>
          <mo id="S5.Ex1.m2.6.6.1.2" lspace="0em">
           .
          </mo>
          <mspace id="S5.Ex1.m2.6.6.1.3" width="1.487em">
          </mspace>
         </mrow>
         <annotation-xml encoding="MathML-Content" id="S5.Ex1.m2.6b">
          <apply id="S5.Ex1.m2.6.6.1.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1">
           <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.2a.cmml" xref="S5.Ex1.m2.6.6.1.1.1.2">
            formulae-sequence
           </csymbol>
           <list id="S5.Ex1.m2.6.6.1.1.1.1.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2">
            <apply id="S5.Ex1.m2.6.6.1.1.1.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1">
             <arg id="S5.Ex1.m2.6.6.1.1.1.1.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.1">
             </arg>
             <apply id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2">
              <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2">
               subscript
              </csymbol>
              <max id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.2">
              </max>
              <ci id="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.1.1.2.3">
               Θ
              </ci>
             </apply>
            </apply>
            <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2">
             <times id="S5.Ex1.m2.6.6.1.1.1.1.2.2.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.2">
             </times>
             <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.3">
              <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.3">
               subscript
              </csymbol>
              <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.3.2">
               𝔼
              </ci>
              <list id="S5.Ex1.m2.3.3.3.4.cmml" xref="S5.Ex1.m2.3.3.3.3">
               <apply id="S5.Ex1.m2.1.1.1.1.1.cmml" xref="S5.Ex1.m2.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S5.Ex1.m2.1.1.1.1.1.1.cmml" xref="S5.Ex1.m2.1.1.1.1.1">
                 subscript
                </csymbol>
                <ci id="S5.Ex1.m2.1.1.1.1.1.2.cmml" xref="S5.Ex1.m2.1.1.1.1.1.2">
                 𝜉
                </ci>
                <ci id="S5.Ex1.m2.1.1.1.1.1.3.cmml" xref="S5.Ex1.m2.1.1.1.1.1.3">
                 𝑙
                </ci>
               </apply>
               <apply id="S5.Ex1.m2.2.2.2.2.2.cmml" xref="S5.Ex1.m2.2.2.2.2.2">
                <csymbol cd="ambiguous" id="S5.Ex1.m2.2.2.2.2.2.1.cmml" xref="S5.Ex1.m2.2.2.2.2.2">
                 subscript
                </csymbol>
                <ci id="S5.Ex1.m2.2.2.2.2.2.2.cmml" xref="S5.Ex1.m2.2.2.2.2.2.2">
                 𝜉
                </ci>
                <ci id="S5.Ex1.m2.2.2.2.2.2.3.cmml" xref="S5.Ex1.m2.2.2.2.2.2.3">
                 𝑜
                </ci>
               </apply>
               <apply id="S5.Ex1.m2.3.3.3.3.3.cmml" xref="S5.Ex1.m2.3.3.3.3.3">
                <csymbol cd="ambiguous" id="S5.Ex1.m2.3.3.3.3.3.1.cmml" xref="S5.Ex1.m2.3.3.3.3.3">
                 subscript
                </csymbol>
                <ci id="S5.Ex1.m2.3.3.3.3.3.2.cmml" xref="S5.Ex1.m2.3.3.3.3.3.2">
                 𝜉
                </ci>
                <ci id="S5.Ex1.m2.3.3.3.3.3.3.cmml" xref="S5.Ex1.m2.3.3.3.3.3.3">
                 𝑟
                </ci>
               </apply>
              </list>
             </apply>
             <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1">
              <csymbol cd="latexml" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.2.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.2">
               delimited-[]
              </csymbol>
              <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1">
               <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2">
                <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2">
                 superscript
                </csymbol>
                <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2">
                 <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2">
                  subscript
                 </csymbol>
                 <sum id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.2">
                 </sum>
                 <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3">
                  <eq id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.1">
                  </eq>
                  <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.2">
                   𝑡
                  </ci>
                  <cn id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.3.cmml" type="integer" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.2.3.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.2.3">
                 𝑇
                </ci>
               </apply>
               <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1">
                <times id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.2">
                </times>
                <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.3">
                 𝑅
                </ci>
                <apply id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1">
                 <csymbol cd="ambiguous" id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1">
                  subscript
                 </csymbol>
                 <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.2">
                  𝑠
                 </ci>
                 <ci id="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S5.Ex1.m2.6.6.1.1.1.1.2.2.1.1.1.1.1.1.1.3">
                  𝑡
                 </ci>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
            <ci id="S5.Ex1.m2.4.4.cmml" xref="S5.Ex1.m2.4.4">
             𝑠
            </ci>
           </list>
           <ci id="S5.Ex1.m2.5.5.cmml" xref="S5.Ex1.m2.5.5">
            𝑡
           </ci>
          </apply>
         </annotation-xml>
         <annotation encoding="application/x-tex" id="S5.Ex1.m2.6c">
          \displaystyle\arg\max_{\Theta}~{}~{}~{}~{}\mathbb{E}_{\xi_{l},\xi_{o},\xi_{r}}\left[\sum_{t=1}^{T}R(s_{t})\right]~{}~{}~{}~{}~{}~{}~{}s.t.~{}~{}~{}~{}
         </annotation>
        </semantics>
       </math>
      </td>
      <td class="ltx_eqn_cell ltx_eqn_center_padright">
      </td>
     </tr>
    </tbody>
    <tbody id="S5.E2">
     <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
      <td class="ltx_eqn_cell ltx_eqn_center_padleft">
      </td>
      <td class="ltx_td ltx_eqn_cell">
      </td>
      <td class="ltx_td ltx_align_left ltx_eqn_cell">
       <math alttext="\displaystyle s_{t+1}=\mathcal{T}_{\xi_{o}}\left(s_{t},\mathcal{L}_{\xi_{l}}\circ\Gamma_{\xi_{r},\Theta}\left([s_{i},a_{i},r_{i},m^{u}_{i}]_{i=1}^{t}\right)\right),~{}~{}~{}~{}\forall t\in\{1,\cdots,T-1\}" class="ltx_Math" display="inline" id="S5.E2.m1.6">
        <semantics id="S5.E2.m1.6a">
         <mrow id="S5.E2.m1.6.6.2" xref="S5.E2.m1.6.6.3.cmml">
          <mrow id="S5.E2.m1.5.5.1.1" xref="S5.E2.m1.5.5.1.1.cmml">
           <msub id="S5.E2.m1.5.5.1.1.4" xref="S5.E2.m1.5.5.1.1.4.cmml">
            <mi id="S5.E2.m1.5.5.1.1.4.2" xref="S5.E2.m1.5.5.1.1.4.2.cmml">
             s
            </mi>
            <mrow id="S5.E2.m1.5.5.1.1.4.3" xref="S5.E2.m1.5.5.1.1.4.3.cmml">
             <mi id="S5.E2.m1.5.5.1.1.4.3.2" xref="S5.E2.m1.5.5.1.1.4.3.2.cmml">
              t
             </mi>
             <mo id="S5.E2.m1.5.5.1.1.4.3.1" xref="S5.E2.m1.5.5.1.1.4.3.1.cmml">
              +
             </mo>
             <mn id="S5.E2.m1.5.5.1.1.4.3.3" xref="S5.E2.m1.5.5.1.1.4.3.3.cmml">
              1
             </mn>
            </mrow>
           </msub>
           <mo id="S5.E2.m1.5.5.1.1.3" xref="S5.E2.m1.5.5.1.1.3.cmml">
            =
           </mo>
           <mrow id="S5.E2.m1.5.5.1.1.2" xref="S5.E2.m1.5.5.1.1.2.cmml">
            <msub id="S5.E2.m1.5.5.1.1.2.4" xref="S5.E2.m1.5.5.1.1.2.4.cmml">
             <mi class="ltx_font_mathcaligraphic" id="S5.E2.m1.5.5.1.1.2.4.2" xref="S5.E2.m1.5.5.1.1.2.4.2.cmml">
              𝒯
             </mi>
             <msub id="S5.E2.m1.5.5.1.1.2.4.3" xref="S5.E2.m1.5.5.1.1.2.4.3.cmml">
              <mi id="S5.E2.m1.5.5.1.1.2.4.3.2" xref="S5.E2.m1.5.5.1.1.2.4.3.2.cmml">
               ξ
              </mi>
              <mi id="S5.E2.m1.5.5.1.1.2.4.3.3" xref="S5.E2.m1.5.5.1.1.2.4.3.3.cmml">
               o
              </mi>
             </msub>
            </msub>
            <mo id="S5.E2.m1.5.5.1.1.2.3" lspace="0em" rspace="0em" xref="S5.E2.m1.5.5.1.1.2.3.cmml">
             ​
            </mo>
            <mrow id="S5.E2.m1.5.5.1.1.2.2.2" xref="S5.E2.m1.5.5.1.1.2.2.3.cmml">
             <mo id="S5.E2.m1.5.5.1.1.2.2.2.3" xref="S5.E2.m1.5.5.1.1.2.2.3.cmml">
              (
             </mo>
             <msub id="S5.E2.m1.5.5.1.1.1.1.1.1" xref="S5.E2.m1.5.5.1.1.1.1.1.1.cmml">
              <mi id="S5.E2.m1.5.5.1.1.1.1.1.1.2" xref="S5.E2.m1.5.5.1.1.1.1.1.1.2.cmml">
               s
              </mi>
              <mi id="S5.E2.m1.5.5.1.1.1.1.1.1.3" xref="S5.E2.m1.5.5.1.1.1.1.1.1.3.cmml">
               t
              </mi>
             </msub>
             <mo id="S5.E2.m1.5.5.1.1.2.2.2.4" xref="S5.E2.m1.5.5.1.1.2.2.3.cmml">
              ,
             </mo>
             <mrow id="S5.E2.m1.5.5.1.1.2.2.2.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.cmml">
              <mrow id="S5.E2.m1.5.5.1.1.2.2.2.2.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.cmml">
               <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.cmml">
                <mi class="ltx_font_mathcaligraphic" id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.2.cmml">
                 ℒ
                </mi>
                <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.cmml">
                 <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.2.cmml">
                  ξ
                 </mi>
                 <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.3.cmml">
                  l
                 </mi>
                </msub>
               </msub>
               <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.3.1" lspace="0.222em" rspace="0.222em" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.1.cmml">
                ∘
               </mo>
               <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.3.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.cmml">
                <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.2" mathvariant="normal" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.2.cmml">
                 Γ
                </mi>
                <mrow id="S5.E2.m1.2.2.2.2" xref="S5.E2.m1.2.2.2.3.cmml">
                 <msub id="S5.E2.m1.2.2.2.2.1" xref="S5.E2.m1.2.2.2.2.1.cmml">
                  <mi id="S5.E2.m1.2.2.2.2.1.2" xref="S5.E2.m1.2.2.2.2.1.2.cmml">
                   ξ
                  </mi>
                  <mi id="S5.E2.m1.2.2.2.2.1.3" xref="S5.E2.m1.2.2.2.2.1.3.cmml">
                   r
                  </mi>
                 </msub>
                 <mo id="S5.E2.m1.2.2.2.2.2" xref="S5.E2.m1.2.2.2.3.cmml">
                  ,
                 </mo>
                 <mi id="S5.E2.m1.1.1.1.1" mathvariant="normal" xref="S5.E2.m1.1.1.1.1.cmml">
                  Θ
                 </mi>
                </mrow>
               </msub>
              </mrow>
              <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.2" lspace="0em" rspace="0em" xref="S5.E2.m1.5.5.1.1.2.2.2.2.2.cmml">
               ​
              </mo>
              <mrow id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.cmml">
               <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.cmml">
                (
               </mo>
               <msubsup id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.cmml">
                <mrow id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.5" stretchy="false" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                  [
                 </mo>
                 <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.cmml">
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.2.cmml">
                   s
                  </mi>
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.3.cmml">
                   i
                  </mi>
                 </msub>
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.6" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                  ,
                 </mo>
                 <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.cmml">
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.2.cmml">
                   a
                  </mi>
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.3.cmml">
                   i
                  </mi>
                 </msub>
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.7" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                  ,
                 </mo>
                 <msub id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.cmml">
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.2.cmml">
                   r
                  </mi>
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.3.cmml">
                   i
                  </mi>
                 </msub>
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.8" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                  ,
                 </mo>
                 <msubsup id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.cmml">
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.2.cmml">
                   m
                  </mi>
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.3.cmml">
                   i
                  </mi>
                  <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.3.cmml">
                   u
                  </mi>
                 </msubsup>
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.9" stretchy="false" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml">
                  ]
                 </mo>
                </mrow>
                <mrow id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.cmml">
                 <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.2" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.2.cmml">
                  i
                 </mi>
                 <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.1" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.1.cmml">
                  =
                 </mo>
                 <mn id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.3.cmml">
                  1
                 </mn>
                </mrow>
                <mi id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.6" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.6.cmml">
                 t
                </mi>
               </msubsup>
               <mo id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.3" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.cmml">
                )
               </mo>
              </mrow>
             </mrow>
             <mo id="S5.E2.m1.5.5.1.1.2.2.2.5" xref="S5.E2.m1.5.5.1.1.2.2.3.cmml">
              )
             </mo>
            </mrow>
           </mrow>
          </mrow>
          <mo id="S5.E2.m1.6.6.2.3" rspace="1.487em" xref="S5.E2.m1.6.6.3a.cmml">
           ,
          </mo>
          <mrow id="S5.E2.m1.6.6.2.2" xref="S5.E2.m1.6.6.2.2.cmml">
           <mrow id="S5.E2.m1.6.6.2.2.3" xref="S5.E2.m1.6.6.2.2.3.cmml">
            <mo id="S5.E2.m1.6.6.2.2.3.1" rspace="0.167em" xref="S5.E2.m1.6.6.2.2.3.1.cmml">
             ∀
            </mo>
            <mi id="S5.E2.m1.6.6.2.2.3.2" xref="S5.E2.m1.6.6.2.2.3.2.cmml">
             t
            </mi>
           </mrow>
           <mo id="S5.E2.m1.6.6.2.2.2" xref="S5.E2.m1.6.6.2.2.2.cmml">
            ∈
           </mo>
           <mrow id="S5.E2.m1.6.6.2.2.1.1" xref="S5.E2.m1.6.6.2.2.1.2.cmml">
            <mo id="S5.E2.m1.6.6.2.2.1.1.2" stretchy="false" xref="S5.E2.m1.6.6.2.2.1.2.cmml">
             {
            </mo>
            <mn id="S5.E2.m1.3.3" xref="S5.E2.m1.3.3.cmml">
             1
            </mn>
            <mo id="S5.E2.m1.6.6.2.2.1.1.3" xref="S5.E2.m1.6.6.2.2.1.2.cmml">
             ,
            </mo>
            <mi id="S5.E2.m1.4.4" mathvariant="normal" xref="S5.E2.m1.4.4.cmml">
             ⋯
            </mi>
            <mo id="S5.E2.m1.6.6.2.2.1.1.4" xref="S5.E2.m1.6.6.2.2.1.2.cmml">
             ,
            </mo>
            <mrow id="S5.E2.m1.6.6.2.2.1.1.1" xref="S5.E2.m1.6.6.2.2.1.1.1.cmml">
             <mi id="S5.E2.m1.6.6.2.2.1.1.1.2" xref="S5.E2.m1.6.6.2.2.1.1.1.2.cmml">
              T
             </mi>
             <mo id="S5.E2.m1.6.6.2.2.1.1.1.1" xref="S5.E2.m1.6.6.2.2.1.1.1.1.cmml">
              −
             </mo>
             <mn id="S5.E2.m1.6.6.2.2.1.1.1.3" xref="S5.E2.m1.6.6.2.2.1.1.1.3.cmml">
              1
             </mn>
            </mrow>
            <mo id="S5.E2.m1.6.6.2.2.1.1.5" stretchy="false" xref="S5.E2.m1.6.6.2.2.1.2.cmml">
             }
            </mo>
           </mrow>
          </mrow>
         </mrow>
         <annotation-xml encoding="MathML-Content" id="S5.E2.m1.6b">
          <apply id="S5.E2.m1.6.6.3.cmml" xref="S5.E2.m1.6.6.2">
           <csymbol cd="ambiguous" id="S5.E2.m1.6.6.3a.cmml" xref="S5.E2.m1.6.6.2.3">
            formulae-sequence
           </csymbol>
           <apply id="S5.E2.m1.5.5.1.1.cmml" xref="S5.E2.m1.5.5.1.1">
            <eq id="S5.E2.m1.5.5.1.1.3.cmml" xref="S5.E2.m1.5.5.1.1.3">
            </eq>
            <apply id="S5.E2.m1.5.5.1.1.4.cmml" xref="S5.E2.m1.5.5.1.1.4">
             <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.4.1.cmml" xref="S5.E2.m1.5.5.1.1.4">
              subscript
             </csymbol>
             <ci id="S5.E2.m1.5.5.1.1.4.2.cmml" xref="S5.E2.m1.5.5.1.1.4.2">
              𝑠
             </ci>
             <apply id="S5.E2.m1.5.5.1.1.4.3.cmml" xref="S5.E2.m1.5.5.1.1.4.3">
              <plus id="S5.E2.m1.5.5.1.1.4.3.1.cmml" xref="S5.E2.m1.5.5.1.1.4.3.1">
              </plus>
              <ci id="S5.E2.m1.5.5.1.1.4.3.2.cmml" xref="S5.E2.m1.5.5.1.1.4.3.2">
               𝑡
              </ci>
              <cn id="S5.E2.m1.5.5.1.1.4.3.3.cmml" type="integer" xref="S5.E2.m1.5.5.1.1.4.3.3">
               1
              </cn>
             </apply>
            </apply>
            <apply id="S5.E2.m1.5.5.1.1.2.cmml" xref="S5.E2.m1.5.5.1.1.2">
             <times id="S5.E2.m1.5.5.1.1.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.3">
             </times>
             <apply id="S5.E2.m1.5.5.1.1.2.4.cmml" xref="S5.E2.m1.5.5.1.1.2.4">
              <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.4.1.cmml" xref="S5.E2.m1.5.5.1.1.2.4">
               subscript
              </csymbol>
              <ci id="S5.E2.m1.5.5.1.1.2.4.2.cmml" xref="S5.E2.m1.5.5.1.1.2.4.2">
               𝒯
              </ci>
              <apply id="S5.E2.m1.5.5.1.1.2.4.3.cmml" xref="S5.E2.m1.5.5.1.1.2.4.3">
               <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.4.3.1.cmml" xref="S5.E2.m1.5.5.1.1.2.4.3">
                subscript
               </csymbol>
               <ci id="S5.E2.m1.5.5.1.1.2.4.3.2.cmml" xref="S5.E2.m1.5.5.1.1.2.4.3.2">
                𝜉
               </ci>
               <ci id="S5.E2.m1.5.5.1.1.2.4.3.3.cmml" xref="S5.E2.m1.5.5.1.1.2.4.3.3">
                𝑜
               </ci>
              </apply>
             </apply>
             <interval closure="open" id="S5.E2.m1.5.5.1.1.2.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2">
              <apply id="S5.E2.m1.5.5.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.1.1.1.1.1.1">
               <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.1.1.1.1.1.1">
                subscript
               </csymbol>
               <ci id="S5.E2.m1.5.5.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.5.5.1.1.1.1.1.1.2">
                𝑠
               </ci>
               <ci id="S5.E2.m1.5.5.1.1.1.1.1.1.3.cmml" xref="S5.E2.m1.5.5.1.1.1.1.1.1.3">
                𝑡
               </ci>
              </apply>
              <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2">
               <times id="S5.E2.m1.5.5.1.1.2.2.2.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.2">
               </times>
               <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3">
                <compose id="S5.E2.m1.5.5.1.1.2.2.2.2.3.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.1">
                </compose>
                <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2">
                 <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2">
                  subscript
                 </csymbol>
                 <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.2">
                  ℒ
                 </ci>
                 <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3">
                  <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3">
                   subscript
                  </csymbol>
                  <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.2">
                   𝜉
                  </ci>
                  <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.2.3.3">
                   𝑙
                  </ci>
                 </apply>
                </apply>
                <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.3">
                 <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.3">
                  subscript
                 </csymbol>
                 <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.3.3.2">
                  Γ
                 </ci>
                 <list id="S5.E2.m1.2.2.2.3.cmml" xref="S5.E2.m1.2.2.2.2">
                  <apply id="S5.E2.m1.2.2.2.2.1.cmml" xref="S5.E2.m1.2.2.2.2.1">
                   <csymbol cd="ambiguous" id="S5.E2.m1.2.2.2.2.1.1.cmml" xref="S5.E2.m1.2.2.2.2.1">
                    subscript
                   </csymbol>
                   <ci id="S5.E2.m1.2.2.2.2.1.2.cmml" xref="S5.E2.m1.2.2.2.2.1.2">
                    𝜉
                   </ci>
                   <ci id="S5.E2.m1.2.2.2.2.1.3.cmml" xref="S5.E2.m1.2.2.2.2.1.3">
                    𝑟
                   </ci>
                  </apply>
                  <ci id="S5.E2.m1.1.1.1.1.cmml" xref="S5.E2.m1.1.1.1.1">
                   Θ
                  </ci>
                 </list>
                </apply>
               </apply>
               <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1">
                <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.5.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1">
                 superscript
                </csymbol>
                <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1">
                 <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.5.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1">
                  subscript
                 </csymbol>
                 <list id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.5.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4">
                  <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1">
                   <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1">
                    subscript
                   </csymbol>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.2">
                    𝑠
                   </ci>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.1.1.1.1.3">
                    𝑖
                   </ci>
                  </apply>
                  <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2">
                   <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2">
                    subscript
                   </csymbol>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.2">
                    𝑎
                   </ci>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.2.2.2.2.3">
                    𝑖
                   </ci>
                  </apply>
                  <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3">
                   <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3">
                    subscript
                   </csymbol>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.2">
                    𝑟
                   </ci>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.3.3.3.3.3">
                    𝑖
                   </ci>
                  </apply>
                  <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4">
                   <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4">
                    subscript
                   </csymbol>
                   <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4">
                    <csymbol cd="ambiguous" id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4">
                     superscript
                    </csymbol>
                    <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.2">
                     𝑚
                    </ci>
                    <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.2.3">
                     𝑢
                    </ci>
                   </apply>
                   <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.3.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.4.4.4.3">
                    𝑖
                   </ci>
                  </apply>
                 </list>
                 <apply id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6">
                  <eq id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.1.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.1">
                  </eq>
                  <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.2.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.2">
                   𝑖
                  </ci>
                  <cn id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.3.cmml" type="integer" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.4.6.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <ci id="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.6.cmml" xref="S5.E2.m1.5.5.1.1.2.2.2.2.1.1.1.6">
                 𝑡
                </ci>
               </apply>
              </apply>
             </interval>
            </apply>
           </apply>
           <apply id="S5.E2.m1.6.6.2.2.cmml" xref="S5.E2.m1.6.6.2.2">
            <in id="S5.E2.m1.6.6.2.2.2.cmml" xref="S5.E2.m1.6.6.2.2.2">
            </in>
            <apply id="S5.E2.m1.6.6.2.2.3.cmml" xref="S5.E2.m1.6.6.2.2.3">
             <csymbol cd="latexml" id="S5.E2.m1.6.6.2.2.3.1.cmml" xref="S5.E2.m1.6.6.2.2.3.1">
              for-all
             </csymbol>
             <ci id="S5.E2.m1.6.6.2.2.3.2.cmml" xref="S5.E2.m1.6.6.2.2.3.2">
              𝑡
             </ci>
            </apply>
            <set id="S5.E2.m1.6.6.2.2.1.2.cmml" xref="S5.E2.m1.6.6.2.2.1.1">
             <cn id="S5.E2.m1.3.3.cmml" type="integer" xref="S5.E2.m1.3.3">
              1
             </cn>
             <ci id="S5.E2.m1.4.4.cmml" xref="S5.E2.m1.4.4">
              ⋯
             </ci>
             <apply id="S5.E2.m1.6.6.2.2.1.1.1.cmml" xref="S5.E2.m1.6.6.2.2.1.1.1">
              <minus id="S5.E2.m1.6.6.2.2.1.1.1.1.cmml" xref="S5.E2.m1.6.6.2.2.1.1.1.1">
              </minus>
              <ci id="S5.E2.m1.6.6.2.2.1.1.1.2.cmml" xref="S5.E2.m1.6.6.2.2.1.1.1.2">
               𝑇
              </ci>
              <cn id="S5.E2.m1.6.6.2.2.1.1.1.3.cmml" type="integer" xref="S5.E2.m1.6.6.2.2.1.1.1.3">
               1
              </cn>
             </apply>
            </set>
           </apply>
          </apply>
         </annotation-xml>
         <annotation encoding="application/x-tex" id="S5.E2.m1.6c">
          \displaystyle s_{t+1}=\mathcal{T}_{\xi_{o}}\left(s_{t},\mathcal{L}_{\xi_{l}}\circ\Gamma_{\xi_{r},\Theta}\left([s_{i},a_{i},r_{i},m^{u}_{i}]_{i=1}^{t}\right)\right),~{}~{}~{}~{}\forall t\in\{1,\cdots,T-1\}
         </annotation>
        </semantics>
       </math>
      </td>
      <td class="ltx_eqn_cell ltx_eqn_center_padright">
      </td>
      <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
       <span class="ltx_tag ltx_tag_equation ltx_align_right">
        (2)
       </span>
      </td>
     </tr>
    </tbody>
   </table>
  </div>
  <div class="ltx_para ltx_noindent" id="S5.p4">
   <p class="ltx_p" id="S5.p4.3">
    Note that the only learnable parameters are in the retrospective model
    <math alttext="M_{r}" class="ltx_Math" display="inline" id="S5.p4.1.m1.1">
     <semantics id="S5.p4.1.m1.1a">
      <msub id="S5.p4.1.m1.1.1" xref="S5.p4.1.m1.1.1.cmml">
       <mi id="S5.p4.1.m1.1.1.2" xref="S5.p4.1.m1.1.1.2.cmml">
        M
       </mi>
       <mi id="S5.p4.1.m1.1.1.3" xref="S5.p4.1.m1.1.1.3.cmml">
        r
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S5.p4.1.m1.1b">
       <apply id="S5.p4.1.m1.1.1.cmml" xref="S5.p4.1.m1.1.1">
        <csymbol cd="ambiguous" id="S5.p4.1.m1.1.1.1.cmml" xref="S5.p4.1.m1.1.1">
         subscript
        </csymbol>
        <ci id="S5.p4.1.m1.1.1.2.cmml" xref="S5.p4.1.m1.1.1.2">
         𝑀
        </ci>
        <ci id="S5.p4.1.m1.1.1.3.cmml" xref="S5.p4.1.m1.1.1.3">
         𝑟
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p4.1.m1.1c">
       M_{r}
      </annotation>
     </semantics>
    </math>
    . Since LLM agent model is fixed, it can be considered as a component of the environment. Specifically, if we construct another environment with the transition function
    <math alttext="\mathcal{T}^{\prime}=\mathcal{T}(\mathcal{S},\bullet)\circ\mathcal{L}:\mathcal{S}\times\mathcal{M}\rightarrow\mathcal{S}" class="ltx_Math" display="inline" id="S5.p4.2.m2.2">
     <semantics id="S5.p4.2.m2.2a">
      <mrow id="S5.p4.2.m2.2.3" xref="S5.p4.2.m2.2.3.cmml">
       <mrow id="S5.p4.2.m2.2.3.2" xref="S5.p4.2.m2.2.3.2.cmml">
        <msup id="S5.p4.2.m2.2.3.2.2" xref="S5.p4.2.m2.2.3.2.2.cmml">
         <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.2.2.2" xref="S5.p4.2.m2.2.3.2.2.2.cmml">
          𝒯
         </mi>
         <mo id="S5.p4.2.m2.2.3.2.2.3" xref="S5.p4.2.m2.2.3.2.2.3.cmml">
          ′
         </mo>
        </msup>
        <mo id="S5.p4.2.m2.2.3.2.1" xref="S5.p4.2.m2.2.3.2.1.cmml">
         =
        </mo>
        <mrow id="S5.p4.2.m2.2.3.2.3" xref="S5.p4.2.m2.2.3.2.3.cmml">
         <mrow id="S5.p4.2.m2.2.3.2.3.2" xref="S5.p4.2.m2.2.3.2.3.2.cmml">
          <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.2.3.2.2" xref="S5.p4.2.m2.2.3.2.3.2.2.cmml">
           𝒯
          </mi>
          <mo id="S5.p4.2.m2.2.3.2.3.2.1" lspace="0em" rspace="0em" xref="S5.p4.2.m2.2.3.2.3.2.1.cmml">
           ​
          </mo>
          <mrow id="S5.p4.2.m2.2.3.2.3.2.3.2" xref="S5.p4.2.m2.2.3.2.3.2.3.1.cmml">
           <mo id="S5.p4.2.m2.2.3.2.3.2.3.2.1" stretchy="false" xref="S5.p4.2.m2.2.3.2.3.2.3.1.cmml">
            (
           </mo>
           <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.1.1" xref="S5.p4.2.m2.1.1.cmml">
            𝒮
           </mi>
           <mo id="S5.p4.2.m2.2.3.2.3.2.3.2.2" rspace="0em" xref="S5.p4.2.m2.2.3.2.3.2.3.1.cmml">
            ,
           </mo>
           <mo id="S5.p4.2.m2.2.2" lspace="0em" rspace="0em" xref="S5.p4.2.m2.2.2.cmml">
            ∙
           </mo>
           <mo id="S5.p4.2.m2.2.3.2.3.2.3.2.3" rspace="0.055em" stretchy="false" xref="S5.p4.2.m2.2.3.2.3.2.3.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
         <mo id="S5.p4.2.m2.2.3.2.3.1" rspace="0.222em" xref="S5.p4.2.m2.2.3.2.3.1.cmml">
          ∘
         </mo>
         <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.2.3.3" xref="S5.p4.2.m2.2.3.2.3.3.cmml">
          ℒ
         </mi>
        </mrow>
       </mrow>
       <mo id="S5.p4.2.m2.2.3.1" lspace="0.278em" rspace="0.278em" xref="S5.p4.2.m2.2.3.1.cmml">
        :
       </mo>
       <mrow id="S5.p4.2.m2.2.3.3" xref="S5.p4.2.m2.2.3.3.cmml">
        <mrow id="S5.p4.2.m2.2.3.3.2" xref="S5.p4.2.m2.2.3.3.2.cmml">
         <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.3.2.2" xref="S5.p4.2.m2.2.3.3.2.2.cmml">
          𝒮
         </mi>
         <mo id="S5.p4.2.m2.2.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S5.p4.2.m2.2.3.3.2.1.cmml">
          ×
         </mo>
         <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.3.2.3" xref="S5.p4.2.m2.2.3.3.2.3.cmml">
          ℳ
         </mi>
        </mrow>
        <mo id="S5.p4.2.m2.2.3.3.1" stretchy="false" xref="S5.p4.2.m2.2.3.3.1.cmml">
         →
        </mo>
        <mi class="ltx_font_mathcaligraphic" id="S5.p4.2.m2.2.3.3.3" xref="S5.p4.2.m2.2.3.3.3.cmml">
         𝒮
        </mi>
       </mrow>
      </mrow>
      <annotation-xml encoding="MathML-Content" id="S5.p4.2.m2.2b">
       <apply id="S5.p4.2.m2.2.3.cmml" xref="S5.p4.2.m2.2.3">
        <ci id="S5.p4.2.m2.2.3.1.cmml" xref="S5.p4.2.m2.2.3.1">
         :
        </ci>
        <apply id="S5.p4.2.m2.2.3.2.cmml" xref="S5.p4.2.m2.2.3.2">
         <eq id="S5.p4.2.m2.2.3.2.1.cmml" xref="S5.p4.2.m2.2.3.2.1">
         </eq>
         <apply id="S5.p4.2.m2.2.3.2.2.cmml" xref="S5.p4.2.m2.2.3.2.2">
          <csymbol cd="ambiguous" id="S5.p4.2.m2.2.3.2.2.1.cmml" xref="S5.p4.2.m2.2.3.2.2">
           superscript
          </csymbol>
          <ci id="S5.p4.2.m2.2.3.2.2.2.cmml" xref="S5.p4.2.m2.2.3.2.2.2">
           𝒯
          </ci>
          <ci id="S5.p4.2.m2.2.3.2.2.3.cmml" xref="S5.p4.2.m2.2.3.2.2.3">
           ′
          </ci>
         </apply>
         <apply id="S5.p4.2.m2.2.3.2.3.cmml" xref="S5.p4.2.m2.2.3.2.3">
          <compose id="S5.p4.2.m2.2.3.2.3.1.cmml" xref="S5.p4.2.m2.2.3.2.3.1">
          </compose>
          <apply id="S5.p4.2.m2.2.3.2.3.2.cmml" xref="S5.p4.2.m2.2.3.2.3.2">
           <times id="S5.p4.2.m2.2.3.2.3.2.1.cmml" xref="S5.p4.2.m2.2.3.2.3.2.1">
           </times>
           <ci id="S5.p4.2.m2.2.3.2.3.2.2.cmml" xref="S5.p4.2.m2.2.3.2.3.2.2">
            𝒯
           </ci>
           <interval closure="open" id="S5.p4.2.m2.2.3.2.3.2.3.1.cmml" xref="S5.p4.2.m2.2.3.2.3.2.3.2">
            <ci id="S5.p4.2.m2.1.1.cmml" xref="S5.p4.2.m2.1.1">
             𝒮
            </ci>
            <ci id="S5.p4.2.m2.2.2.cmml" xref="S5.p4.2.m2.2.2">
             ∙
            </ci>
           </interval>
          </apply>
          <ci id="S5.p4.2.m2.2.3.2.3.3.cmml" xref="S5.p4.2.m2.2.3.2.3.3">
           ℒ
          </ci>
         </apply>
        </apply>
        <apply id="S5.p4.2.m2.2.3.3.cmml" xref="S5.p4.2.m2.2.3.3">
         <ci id="S5.p4.2.m2.2.3.3.1.cmml" xref="S5.p4.2.m2.2.3.3.1">
          →
         </ci>
         <apply id="S5.p4.2.m2.2.3.3.2.cmml" xref="S5.p4.2.m2.2.3.3.2">
          <times id="S5.p4.2.m2.2.3.3.2.1.cmml" xref="S5.p4.2.m2.2.3.3.2.1">
          </times>
          <ci id="S5.p4.2.m2.2.3.3.2.2.cmml" xref="S5.p4.2.m2.2.3.3.2.2">
           𝒮
          </ci>
          <ci id="S5.p4.2.m2.2.3.3.2.3.cmml" xref="S5.p4.2.m2.2.3.3.2.3">
           ℳ
          </ci>
         </apply>
         <ci id="S5.p4.2.m2.2.3.3.3.cmml" xref="S5.p4.2.m2.2.3.3.3">
          𝒮
         </ci>
        </apply>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p4.2.m2.2c">
       \mathcal{T}^{\prime}=\mathcal{T}(\mathcal{S},\bullet)\circ\mathcal{L}:\mathcal{S}\times\mathcal{M}\rightarrow\mathcal{S}
      </annotation>
     </semantics>
    </math>
    , and the same reward function
    <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S5.p4.3.m3.1">
     <semantics id="S5.p4.3.m3.1a">
      <mi class="ltx_font_mathcaligraphic" id="S5.p4.3.m3.1.1" xref="S5.p4.3.m3.1.1.cmml">
       ℛ
      </mi>
      <annotation-xml encoding="MathML-Content" id="S5.p4.3.m3.1b">
       <ci id="S5.p4.3.m3.1.1.cmml" xref="S5.p4.3.m3.1.1">
        ℛ
       </ci>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S5.p4.3.m3.1c">
       \mathcal{R}
      </annotation>
     </semantics>
    </math>
    , then the objective in
    <a class="ltx_ref" href="#S5.Ex1" title="5 Notation and Formulation ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
     <span class="ltx_text ltx_ref_tag">
      Section
     </span>
     <span class="ltx_text ltx_ref_tag">
      5
     </span>
    </a>
    is just a regular RL optimization so all the popular RL algorithms apply.
   </p>
  </div>
 </section>
 <section class="ltx_section" id="S6">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    6
   </span>
   Our Approach: Reinforcing Retrospective Language Agent
  </h2>
  <div class="ltx_para" id="S6.p1">
   <p class="ltx_p" id="S6.p1.2">
    As illustrated in
    <a class="ltx_ref" href="#S6.F2" title="In 6 Our Approach: Reinforcing Retrospective Language Agent ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
     <span class="ltx_text ltx_ref_tag">
      Fig.
     </span>
     <span class="ltx_text ltx_ref_tag">
      2
     </span>
    </a>
    , our proposed framework
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S6.p1.2.1">
     Retroformer
    </span>
    is comprised of two language model components: an
    <span class="ltx_text ltx_font_bold" id="S6.p1.2.2">
     actor
    </span>
    LLM, denoted as
    <math alttext="M_{a}" class="ltx_Math" display="inline" id="S6.p1.1.m1.1">
     <semantics id="S6.p1.1.m1.1a">
      <msub id="S6.p1.1.m1.1.1" xref="S6.p1.1.m1.1.1.cmml">
       <mi id="S6.p1.1.m1.1.1.2" xref="S6.p1.1.m1.1.1.2.cmml">
        M
       </mi>
       <mi id="S6.p1.1.m1.1.1.3" xref="S6.p1.1.m1.1.1.3.cmml">
        a
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S6.p1.1.m1.1b">
       <apply id="S6.p1.1.m1.1.1.cmml" xref="S6.p1.1.m1.1.1">
        <csymbol cd="ambiguous" id="S6.p1.1.m1.1.1.1.cmml" xref="S6.p1.1.m1.1.1">
         subscript
        </csymbol>
        <ci id="S6.p1.1.m1.1.1.2.cmml" xref="S6.p1.1.m1.1.1.2">
         𝑀
        </ci>
        <ci id="S6.p1.1.m1.1.1.3.cmml" xref="S6.p1.1.m1.1.1.3">
         𝑎
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S6.p1.1.m1.1c">
       M_{a}
      </annotation>
     </semantics>
    </math>
    , which generates reasoning thoughts and actions, and a
    <span class="ltx_text ltx_font_bold" id="S6.p1.2.3">
     retrospective
    </span>
    LLM, denoted as
    <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.p1.2.m2.1">
     <semantics id="S6.p1.2.m2.1a">
      <msub id="S6.p1.2.m2.1.1" xref="S6.p1.2.m2.1.1.cmml">
       <mi id="S6.p1.2.m2.1.1.2" xref="S6.p1.2.m2.1.1.2.cmml">
        M
       </mi>
       <mi id="S6.p1.2.m2.1.1.3" xref="S6.p1.2.m2.1.1.3.cmml">
        r
       </mi>
      </msub>
      <annotation-xml encoding="MathML-Content" id="S6.p1.2.m2.1b">
       <apply id="S6.p1.2.m2.1.1.cmml" xref="S6.p1.2.m2.1.1">
        <csymbol cd="ambiguous" id="S6.p1.2.m2.1.1.1.cmml" xref="S6.p1.2.m2.1.1">
         subscript
        </csymbol>
        <ci id="S6.p1.2.m2.1.1.2.cmml" xref="S6.p1.2.m2.1.1.2">
         𝑀
        </ci>
        <ci id="S6.p1.2.m2.1.1.3.cmml" xref="S6.p1.2.m2.1.1.3">
         𝑟
        </ci>
       </apply>
      </annotation-xml>
      <annotation encoding="application/x-tex" id="S6.p1.2.m2.1c">
       M_{r}
      </annotation>
     </semantics>
    </math>
    , which generates verbal reinforcement cues to assist the actor in self-improvement by refining the actor prompt with reflection responses.
   </p>
  </div>
  <figure class="ltx_figure" id="S6.F2">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="165" id="S6.F2.g1" src="/html/2308.02151/assets/x2.png" width="461"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 2:
    </span>
    Framework overview.
   </figcaption>
  </figure>
  <div class="ltx_para ltx_noindent" id="S6.p2">
   <p class="ltx_p" id="S6.p2.1">
    We assume in this paper that the actor model is a frozen LLM whose model parameters are inaccessable (e.g., GPT, Bard) and the retrospective model is a smaller, local language model that can be fine-tuned under low-resource settings. In addition,
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S6.p2.1.1">
     Retroformer
    </span>
    has an iterative policy gradient optimization step which is specifically designed to reinforce the reflection model with gradient-based approach. We provide in this section a detailed description of each of these modules and subsequently elucidate their collaborative functioning within the
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S6.p2.1.2">
     Retroformer
    </span>
    framework. The implementation details are presented in
    <a class="ltx_ref" href="#S7.SS2" title="7.2 Implementation Details ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
     <span class="ltx_text ltx_ref_tag">
      Section
     </span>
     <span class="ltx_text ltx_ref_tag">
      7.2
     </span>
    </a>
    .
   </p>
  </div>
  <section class="ltx_subsection" id="S6.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.1
    </span>
    retrospective Agent Architecture
   </h3>
   <div class="ltx_para ltx_noindent" id="S6.SS1.p1">
    <p class="ltx_p" id="S6.SS1.p1.1">
     As illustrated in
     <a class="ltx_ref" href="#S6.F2" title="In 6 Our Approach: Reinforcing Retrospective Language Agent ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Fig.
      </span>
      <span class="ltx_text ltx_ref_tag">
       2
      </span>
     </a>
     (a), for the base actor model and retrospective model, we apply a standard communication protocol modified from the Relexion agent architecture
     <cite class="ltx_cite ltx_citemacro_citep">
      (Shinn et al.,
      <a class="ltx_ref" href="#bib.bib18" title="">
       2023
      </a>
      )
     </cite>
     , in which the retrospective model refines the actor prompt by appending verbal feedback to the prompt.
    </p>
   </div>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Actor Model
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px1.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px1.p1.4">
      The actor model is a LLM hosted in the cloud, whose model parameters are hidden and frozen all the time. The actor LM is instructed to generate actions with required textual content, taking into account the observed states. Similar to reinforcement learning, we select an action or generation, denoted as
      <math alttext="a_{t}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.1.m1.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.1.m1.1a">
        <msub id="S6.SS1.SSS0.Px1.p1.1.m1.1.1" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.2" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.2.cmml">
          a
         </mi>
         <mi id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.3" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.3.cmml">
          t
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.1.m1.1b">
         <apply id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.2">
           𝑎
          </ci>
          <ci id="S6.SS1.SSS0.Px1.p1.1.m1.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.1.m1.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.1.m1.1c">
         a_{t}
        </annotation>
       </semantics>
      </math>
      , from the current policy
      <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.2.m2.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.2.m2.1a">
        <msub id="S6.SS1.SSS0.Px1.p1.2.m2.1.1" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.2" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.2.cmml">
          π
         </mi>
         <mi id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.3" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.3.cmml">
          θ
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.2.m2.1b">
         <apply id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.2">
           𝜋
          </ci>
          <ci id="S6.SS1.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.2.m2.1.1.3">
           𝜃
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.2.m2.1c">
         \pi_{\theta}
        </annotation>
       </semantics>
      </math>
      at time step
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.3.m3.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.3.m3.1a">
        <mi id="S6.SS1.SSS0.Px1.p1.3.m3.1.1" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.3.m3.1b">
         <ci id="S6.SS1.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.3.m3.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.3.m3.1c">
         t
        </annotation>
       </semantics>
      </math>
      and receive an observation, represented by
      <math alttext="s_{t}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px1.p1.4.m4.1">
       <semantics id="S6.SS1.SSS0.Px1.p1.4.m4.1a">
        <msub id="S6.SS1.SSS0.Px1.p1.4.m4.1.1" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.2" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.2.cmml">
          s
         </mi>
         <mi id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.3" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.3.cmml">
          t
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px1.p1.4.m4.1b">
         <apply id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.2">
           𝑠
          </ci>
          <ci id="S6.SS1.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S6.SS1.SSS0.Px1.p1.4.m4.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px1.p1.4.m4.1c">
         s_{t}
        </annotation>
       </semantics>
      </math>
      , from the environment. We use ReAct
      <cite class="ltx_cite ltx_citemacro_citep">
       (Yao et al.,
       <a class="ltx_ref" href="#bib.bib25" title="">
        2023
       </a>
       )
      </cite>
      as our actor prompt.
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S6.E3">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="a_{k,i,t}=M_{a}\left([s_{k,i,\tau},a_{k,i,\tau},r_{k,i,\tau}]_{\tau=1}^{t-1},s_{k,i,t}\right)." class="ltx_Math" display="block" id="S6.E3.m1.16">
          <semantics id="S6.E3.m1.16a">
           <mrow id="S6.E3.m1.16.16.1" xref="S6.E3.m1.16.16.1.1.cmml">
            <mrow id="S6.E3.m1.16.16.1.1" xref="S6.E3.m1.16.16.1.1.cmml">
             <msub id="S6.E3.m1.16.16.1.1.4" xref="S6.E3.m1.16.16.1.1.4.cmml">
              <mi id="S6.E3.m1.16.16.1.1.4.2" xref="S6.E3.m1.16.16.1.1.4.2.cmml">
               a
              </mi>
              <mrow id="S6.E3.m1.3.3.3.5" xref="S6.E3.m1.3.3.3.4.cmml">
               <mi id="S6.E3.m1.1.1.1.1" xref="S6.E3.m1.1.1.1.1.cmml">
                k
               </mi>
               <mo id="S6.E3.m1.3.3.3.5.1" xref="S6.E3.m1.3.3.3.4.cmml">
                ,
               </mo>
               <mi id="S6.E3.m1.2.2.2.2" xref="S6.E3.m1.2.2.2.2.cmml">
                i
               </mi>
               <mo id="S6.E3.m1.3.3.3.5.2" xref="S6.E3.m1.3.3.3.4.cmml">
                ,
               </mo>
               <mi id="S6.E3.m1.3.3.3.3" xref="S6.E3.m1.3.3.3.3.cmml">
                t
               </mi>
              </mrow>
             </msub>
             <mo id="S6.E3.m1.16.16.1.1.3" xref="S6.E3.m1.16.16.1.1.3.cmml">
              =
             </mo>
             <mrow id="S6.E3.m1.16.16.1.1.2" xref="S6.E3.m1.16.16.1.1.2.cmml">
              <msub id="S6.E3.m1.16.16.1.1.2.4" xref="S6.E3.m1.16.16.1.1.2.4.cmml">
               <mi id="S6.E3.m1.16.16.1.1.2.4.2" xref="S6.E3.m1.16.16.1.1.2.4.2.cmml">
                M
               </mi>
               <mi id="S6.E3.m1.16.16.1.1.2.4.3" xref="S6.E3.m1.16.16.1.1.2.4.3.cmml">
                a
               </mi>
              </msub>
              <mo id="S6.E3.m1.16.16.1.1.2.3" lspace="0em" rspace="0em" xref="S6.E3.m1.16.16.1.1.2.3.cmml">
               ​
              </mo>
              <mrow id="S6.E3.m1.16.16.1.1.2.2.2" xref="S6.E3.m1.16.16.1.1.2.2.3.cmml">
               <mo id="S6.E3.m1.16.16.1.1.2.2.2.3" xref="S6.E3.m1.16.16.1.1.2.2.3.cmml">
                (
               </mo>
               <msubsup id="S6.E3.m1.16.16.1.1.1.1.1.1" xref="S6.E3.m1.16.16.1.1.1.1.1.1.cmml">
                <mrow id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml">
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.4" stretchy="false" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml">
                  [
                 </mo>
                 <msub id="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1" xref="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.cmml">
                  <mi id="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.2.cmml">
                   s
                  </mi>
                  <mrow id="S6.E3.m1.6.6.3.5" xref="S6.E3.m1.6.6.3.4.cmml">
                   <mi id="S6.E3.m1.4.4.1.1" xref="S6.E3.m1.4.4.1.1.cmml">
                    k
                   </mi>
                   <mo id="S6.E3.m1.6.6.3.5.1" xref="S6.E3.m1.6.6.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.5.5.2.2" xref="S6.E3.m1.5.5.2.2.cmml">
                    i
                   </mi>
                   <mo id="S6.E3.m1.6.6.3.5.2" xref="S6.E3.m1.6.6.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.6.6.3.3" xref="S6.E3.m1.6.6.3.3.cmml">
                    τ
                   </mi>
                  </mrow>
                 </msub>
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.5" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml">
                  ,
                 </mo>
                 <msub id="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.cmml">
                  <mi id="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.2.cmml">
                   a
                  </mi>
                  <mrow id="S6.E3.m1.9.9.3.5" xref="S6.E3.m1.9.9.3.4.cmml">
                   <mi id="S6.E3.m1.7.7.1.1" xref="S6.E3.m1.7.7.1.1.cmml">
                    k
                   </mi>
                   <mo id="S6.E3.m1.9.9.3.5.1" xref="S6.E3.m1.9.9.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.8.8.2.2" xref="S6.E3.m1.8.8.2.2.cmml">
                    i
                   </mi>
                   <mo id="S6.E3.m1.9.9.3.5.2" xref="S6.E3.m1.9.9.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.9.9.3.3" xref="S6.E3.m1.9.9.3.3.cmml">
                    τ
                   </mi>
                  </mrow>
                 </msub>
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.6" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml">
                  ,
                 </mo>
                 <msub id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.cmml">
                  <mi id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.2.cmml">
                   r
                  </mi>
                  <mrow id="S6.E3.m1.12.12.3.5" xref="S6.E3.m1.12.12.3.4.cmml">
                   <mi id="S6.E3.m1.10.10.1.1" xref="S6.E3.m1.10.10.1.1.cmml">
                    k
                   </mi>
                   <mo id="S6.E3.m1.12.12.3.5.1" xref="S6.E3.m1.12.12.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.11.11.2.2" xref="S6.E3.m1.11.11.2.2.cmml">
                    i
                   </mi>
                   <mo id="S6.E3.m1.12.12.3.5.2" xref="S6.E3.m1.12.12.3.4.cmml">
                    ,
                   </mo>
                   <mi id="S6.E3.m1.12.12.3.3" xref="S6.E3.m1.12.12.3.3.cmml">
                    τ
                   </mi>
                  </mrow>
                 </msub>
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.7" stretchy="false" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml">
                  ]
                 </mo>
                </mrow>
                <mrow id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.cmml">
                 <mi id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.2.cmml">
                  τ
                 </mi>
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.1" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.1.cmml">
                  =
                 </mo>
                 <mn id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.3" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.3.cmml">
                  1
                 </mn>
                </mrow>
                <mrow id="S6.E3.m1.16.16.1.1.1.1.1.1.5" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.cmml">
                 <mi id="S6.E3.m1.16.16.1.1.1.1.1.1.5.2" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.2.cmml">
                  t
                 </mi>
                 <mo id="S6.E3.m1.16.16.1.1.1.1.1.1.5.1" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.1.cmml">
                  −
                 </mo>
                 <mn id="S6.E3.m1.16.16.1.1.1.1.1.1.5.3" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.3.cmml">
                  1
                 </mn>
                </mrow>
               </msubsup>
               <mo id="S6.E3.m1.16.16.1.1.2.2.2.4" xref="S6.E3.m1.16.16.1.1.2.2.3.cmml">
                ,
               </mo>
               <msub id="S6.E3.m1.16.16.1.1.2.2.2.2" xref="S6.E3.m1.16.16.1.1.2.2.2.2.cmml">
                <mi id="S6.E3.m1.16.16.1.1.2.2.2.2.2" xref="S6.E3.m1.16.16.1.1.2.2.2.2.2.cmml">
                 s
                </mi>
                <mrow id="S6.E3.m1.15.15.3.5" xref="S6.E3.m1.15.15.3.4.cmml">
                 <mi id="S6.E3.m1.13.13.1.1" xref="S6.E3.m1.13.13.1.1.cmml">
                  k
                 </mi>
                 <mo id="S6.E3.m1.15.15.3.5.1" xref="S6.E3.m1.15.15.3.4.cmml">
                  ,
                 </mo>
                 <mi id="S6.E3.m1.14.14.2.2" xref="S6.E3.m1.14.14.2.2.cmml">
                  i
                 </mi>
                 <mo id="S6.E3.m1.15.15.3.5.2" xref="S6.E3.m1.15.15.3.4.cmml">
                  ,
                 </mo>
                 <mi id="S6.E3.m1.15.15.3.3" xref="S6.E3.m1.15.15.3.3.cmml">
                  t
                 </mi>
                </mrow>
               </msub>
               <mo id="S6.E3.m1.16.16.1.1.2.2.2.5" xref="S6.E3.m1.16.16.1.1.2.2.3.cmml">
                )
               </mo>
              </mrow>
             </mrow>
            </mrow>
            <mo id="S6.E3.m1.16.16.1.2" lspace="0em" xref="S6.E3.m1.16.16.1.1.cmml">
             .
            </mo>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.E3.m1.16b">
            <apply id="S6.E3.m1.16.16.1.1.cmml" xref="S6.E3.m1.16.16.1">
             <eq id="S6.E3.m1.16.16.1.1.3.cmml" xref="S6.E3.m1.16.16.1.1.3">
             </eq>
             <apply id="S6.E3.m1.16.16.1.1.4.cmml" xref="S6.E3.m1.16.16.1.1.4">
              <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.4.1.cmml" xref="S6.E3.m1.16.16.1.1.4">
               subscript
              </csymbol>
              <ci id="S6.E3.m1.16.16.1.1.4.2.cmml" xref="S6.E3.m1.16.16.1.1.4.2">
               𝑎
              </ci>
              <list id="S6.E3.m1.3.3.3.4.cmml" xref="S6.E3.m1.3.3.3.5">
               <ci id="S6.E3.m1.1.1.1.1.cmml" xref="S6.E3.m1.1.1.1.1">
                𝑘
               </ci>
               <ci id="S6.E3.m1.2.2.2.2.cmml" xref="S6.E3.m1.2.2.2.2">
                𝑖
               </ci>
               <ci id="S6.E3.m1.3.3.3.3.cmml" xref="S6.E3.m1.3.3.3.3">
                𝑡
               </ci>
              </list>
             </apply>
             <apply id="S6.E3.m1.16.16.1.1.2.cmml" xref="S6.E3.m1.16.16.1.1.2">
              <times id="S6.E3.m1.16.16.1.1.2.3.cmml" xref="S6.E3.m1.16.16.1.1.2.3">
              </times>
              <apply id="S6.E3.m1.16.16.1.1.2.4.cmml" xref="S6.E3.m1.16.16.1.1.2.4">
               <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.2.4.1.cmml" xref="S6.E3.m1.16.16.1.1.2.4">
                subscript
               </csymbol>
               <ci id="S6.E3.m1.16.16.1.1.2.4.2.cmml" xref="S6.E3.m1.16.16.1.1.2.4.2">
                𝑀
               </ci>
               <ci id="S6.E3.m1.16.16.1.1.2.4.3.cmml" xref="S6.E3.m1.16.16.1.1.2.4.3">
                𝑎
               </ci>
              </apply>
              <interval closure="open" id="S6.E3.m1.16.16.1.1.2.2.3.cmml" xref="S6.E3.m1.16.16.1.1.2.2.2">
               <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.1.1.1.1.4.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1">
                 superscript
                </csymbol>
                <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.3.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1">
                 <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.1.1.1.1.3.4.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1">
                  subscript
                 </csymbol>
                 <list id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.4.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3">
                  <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1">
                   <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1">
                    subscript
                   </csymbol>
                   <ci id="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.1.1.1.1.2">
                    𝑠
                   </ci>
                   <list id="S6.E3.m1.6.6.3.4.cmml" xref="S6.E3.m1.6.6.3.5">
                    <ci id="S6.E3.m1.4.4.1.1.cmml" xref="S6.E3.m1.4.4.1.1">
                     𝑘
                    </ci>
                    <ci id="S6.E3.m1.5.5.2.2.cmml" xref="S6.E3.m1.5.5.2.2">
                     𝑖
                    </ci>
                    <ci id="S6.E3.m1.6.6.3.3.cmml" xref="S6.E3.m1.6.6.3.3">
                     𝜏
                    </ci>
                   </list>
                  </apply>
                  <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2">
                   <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2">
                    subscript
                   </csymbol>
                   <ci id="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.2.2.2.2.2">
                    𝑎
                   </ci>
                   <list id="S6.E3.m1.9.9.3.4.cmml" xref="S6.E3.m1.9.9.3.5">
                    <ci id="S6.E3.m1.7.7.1.1.cmml" xref="S6.E3.m1.7.7.1.1">
                     𝑘
                    </ci>
                    <ci id="S6.E3.m1.8.8.2.2.cmml" xref="S6.E3.m1.8.8.2.2">
                     𝑖
                    </ci>
                    <ci id="S6.E3.m1.9.9.3.3.cmml" xref="S6.E3.m1.9.9.3.3">
                     𝜏
                    </ci>
                   </list>
                  </apply>
                  <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3">
                   <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3">
                    subscript
                   </csymbol>
                   <ci id="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.3.3.3.2">
                    𝑟
                   </ci>
                   <list id="S6.E3.m1.12.12.3.4.cmml" xref="S6.E3.m1.12.12.3.5">
                    <ci id="S6.E3.m1.10.10.1.1.cmml" xref="S6.E3.m1.10.10.1.1">
                     𝑘
                    </ci>
                    <ci id="S6.E3.m1.11.11.2.2.cmml" xref="S6.E3.m1.11.11.2.2">
                     𝑖
                    </ci>
                    <ci id="S6.E3.m1.12.12.3.3.cmml" xref="S6.E3.m1.12.12.3.3">
                     𝜏
                    </ci>
                   </list>
                  </apply>
                 </list>
                 <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5">
                  <eq id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.1">
                  </eq>
                  <ci id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.2">
                   𝜏
                  </ci>
                  <cn id="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.3.cmml" type="integer" xref="S6.E3.m1.16.16.1.1.1.1.1.1.3.5.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <apply id="S6.E3.m1.16.16.1.1.1.1.1.1.5.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5">
                 <minus id="S6.E3.m1.16.16.1.1.1.1.1.1.5.1.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.1">
                 </minus>
                 <ci id="S6.E3.m1.16.16.1.1.1.1.1.1.5.2.cmml" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.2">
                  𝑡
                 </ci>
                 <cn id="S6.E3.m1.16.16.1.1.1.1.1.1.5.3.cmml" type="integer" xref="S6.E3.m1.16.16.1.1.1.1.1.1.5.3">
                  1
                 </cn>
                </apply>
               </apply>
               <apply id="S6.E3.m1.16.16.1.1.2.2.2.2.cmml" xref="S6.E3.m1.16.16.1.1.2.2.2.2">
                <csymbol cd="ambiguous" id="S6.E3.m1.16.16.1.1.2.2.2.2.1.cmml" xref="S6.E3.m1.16.16.1.1.2.2.2.2">
                 subscript
                </csymbol>
                <ci id="S6.E3.m1.16.16.1.1.2.2.2.2.2.cmml" xref="S6.E3.m1.16.16.1.1.2.2.2.2.2">
                 𝑠
                </ci>
                <list id="S6.E3.m1.15.15.3.4.cmml" xref="S6.E3.m1.15.15.3.5">
                 <ci id="S6.E3.m1.13.13.1.1.cmml" xref="S6.E3.m1.13.13.1.1">
                  𝑘
                 </ci>
                 <ci id="S6.E3.m1.14.14.2.2.cmml" xref="S6.E3.m1.14.14.2.2">
                  𝑖
                 </ci>
                 <ci id="S6.E3.m1.15.15.3.3.cmml" xref="S6.E3.m1.15.15.3.3">
                  𝑡
                 </ci>
                </list>
               </apply>
              </interval>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.E3.m1.16c">
            a_{k,i,t}=M_{a}\left([s_{k,i,\tau},a_{k,i,\tau},r_{k,i,\tau}]_{\tau=1}^{t-1},s_{k,i,t}\right).
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (3)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Retrospective Model
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px2.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px2.p1.1">
      The retrospective model
      <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px2.p1.1.m1.1">
       <semantics id="S6.SS1.SSS0.Px2.p1.1.m1.1a">
        <msub id="S6.SS1.SSS0.Px2.p1.1.m1.1.1" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.2" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml">
          M
         </mi>
         <mi id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.3" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1.3.cmml">
          r
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px2.p1.1.m1.1b">
         <apply id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1.2">
           𝑀
          </ci>
          <ci id="S6.SS1.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S6.SS1.SSS0.Px2.p1.1.m1.1.1.3">
           𝑟
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px2.p1.1.m1.1c">
         M_{r}
        </annotation>
       </semantics>
      </math>
      is instantiated as a local LM. Its primary function is to produce self-reflections, offering valuable feedback for diagnosing a possible reason for prior failure and devising a new, concise, high-level plan that aims to mitigate same failure. Operating under a sparse reward signal, such as binary success status (success/failure), the model detects the root cause of failure by considering the current trajectory alongside its persistent memory.
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S6.E4">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="y_{k,i}=M_{r}(\underbrace{[s_{k,i,\tau},a_{k,i,\tau},r_{k,i,\tau}]_{\tau=1}^{T},G_{k,i}}_{\text{Reflection prompt}\;x_{k,i}})." class="ltx_Math" display="block" id="S6.E4.m1.18">
          <semantics id="S6.E4.m1.18a">
           <mrow id="S6.E4.m1.18.18.1" xref="S6.E4.m1.18.18.1.1.cmml">
            <mrow id="S6.E4.m1.18.18.1.1" xref="S6.E4.m1.18.18.1.1.cmml">
             <msub id="S6.E4.m1.18.18.1.1.3" xref="S6.E4.m1.18.18.1.1.3.cmml">
              <mi id="S6.E4.m1.18.18.1.1.3.2" xref="S6.E4.m1.18.18.1.1.3.2.cmml">
               y
              </mi>
              <mrow id="S6.E4.m1.2.2.2.4" xref="S6.E4.m1.2.2.2.3.cmml">
               <mi id="S6.E4.m1.1.1.1.1" xref="S6.E4.m1.1.1.1.1.cmml">
                k
               </mi>
               <mo id="S6.E4.m1.2.2.2.4.1" xref="S6.E4.m1.2.2.2.3.cmml">
                ,
               </mo>
               <mi id="S6.E4.m1.2.2.2.2" xref="S6.E4.m1.2.2.2.2.cmml">
                i
               </mi>
              </mrow>
             </msub>
             <mo id="S6.E4.m1.18.18.1.1.2" xref="S6.E4.m1.18.18.1.1.2.cmml">
              =
             </mo>
             <mrow id="S6.E4.m1.18.18.1.1.1" xref="S6.E4.m1.18.18.1.1.1.cmml">
              <msub id="S6.E4.m1.18.18.1.1.1.3" xref="S6.E4.m1.18.18.1.1.1.3.cmml">
               <mi id="S6.E4.m1.18.18.1.1.1.3.2" xref="S6.E4.m1.18.18.1.1.1.3.2.cmml">
                M
               </mi>
               <mi id="S6.E4.m1.18.18.1.1.1.3.3" xref="S6.E4.m1.18.18.1.1.1.3.3.cmml">
                r
               </mi>
              </msub>
              <mo id="S6.E4.m1.18.18.1.1.1.2" lspace="0em" rspace="0em" xref="S6.E4.m1.18.18.1.1.1.2.cmml">
               ​
              </mo>
              <mrow id="S6.E4.m1.18.18.1.1.1.1.1" xref="S6.E4.m1.18.18.1.1.1.1.1.1.cmml">
               <mo id="S6.E4.m1.18.18.1.1.1.1.1.2" stretchy="false" xref="S6.E4.m1.18.18.1.1.1.1.1.1.cmml">
                (
               </mo>
               <munder id="S6.E4.m1.18.18.1.1.1.1.1.1" xref="S6.E4.m1.18.18.1.1.1.1.1.1.cmml">
                <munder accentunder="true" id="S6.E4.m1.15.15" xref="S6.E4.m1.15.15.cmml">
                 <mrow id="S6.E4.m1.15.15.13.13" xref="S6.E4.m1.15.15.13.14.cmml">
                  <msubsup id="S6.E4.m1.14.14.12.12.1" xref="S6.E4.m1.14.14.12.12.1.cmml">
                   <mrow id="S6.E4.m1.14.14.12.12.1.3.3.3" xref="S6.E4.m1.14.14.12.12.1.3.3.4.cmml">
                    <mo id="S6.E4.m1.14.14.12.12.1.3.3.3.4" stretchy="false" xref="S6.E4.m1.14.14.12.12.1.3.3.4.cmml">
                     [
                    </mo>
                    <msub id="S6.E4.m1.14.14.12.12.1.1.1.1.1" xref="S6.E4.m1.14.14.12.12.1.1.1.1.1.cmml">
                     <mi id="S6.E4.m1.14.14.12.12.1.1.1.1.1.2" xref="S6.E4.m1.14.14.12.12.1.1.1.1.1.2.cmml">
                      s
                     </mi>
                     <mrow id="S6.E4.m1.5.5.3.3.3.5" xref="S6.E4.m1.5.5.3.3.3.4.cmml">
                      <mi id="S6.E4.m1.3.3.1.1.1.1" xref="S6.E4.m1.3.3.1.1.1.1.cmml">
                       k
                      </mi>
                      <mo id="S6.E4.m1.5.5.3.3.3.5.1" xref="S6.E4.m1.5.5.3.3.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.4.4.2.2.2.2" xref="S6.E4.m1.4.4.2.2.2.2.cmml">
                       i
                      </mi>
                      <mo id="S6.E4.m1.5.5.3.3.3.5.2" xref="S6.E4.m1.5.5.3.3.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.5.5.3.3.3.3" xref="S6.E4.m1.5.5.3.3.3.3.cmml">
                       τ
                      </mi>
                     </mrow>
                    </msub>
                    <mo id="S6.E4.m1.14.14.12.12.1.3.3.3.5" xref="S6.E4.m1.14.14.12.12.1.3.3.4.cmml">
                     ,
                    </mo>
                    <msub id="S6.E4.m1.14.14.12.12.1.2.2.2.2" xref="S6.E4.m1.14.14.12.12.1.2.2.2.2.cmml">
                     <mi id="S6.E4.m1.14.14.12.12.1.2.2.2.2.2" xref="S6.E4.m1.14.14.12.12.1.2.2.2.2.2.cmml">
                      a
                     </mi>
                     <mrow id="S6.E4.m1.8.8.6.6.3.5" xref="S6.E4.m1.8.8.6.6.3.4.cmml">
                      <mi id="S6.E4.m1.6.6.4.4.1.1" xref="S6.E4.m1.6.6.4.4.1.1.cmml">
                       k
                      </mi>
                      <mo id="S6.E4.m1.8.8.6.6.3.5.1" xref="S6.E4.m1.8.8.6.6.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.7.7.5.5.2.2" xref="S6.E4.m1.7.7.5.5.2.2.cmml">
                       i
                      </mi>
                      <mo id="S6.E4.m1.8.8.6.6.3.5.2" xref="S6.E4.m1.8.8.6.6.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.8.8.6.6.3.3" xref="S6.E4.m1.8.8.6.6.3.3.cmml">
                       τ
                      </mi>
                     </mrow>
                    </msub>
                    <mo id="S6.E4.m1.14.14.12.12.1.3.3.3.6" xref="S6.E4.m1.14.14.12.12.1.3.3.4.cmml">
                     ,
                    </mo>
                    <msub id="S6.E4.m1.14.14.12.12.1.3.3.3.3" xref="S6.E4.m1.14.14.12.12.1.3.3.3.3.cmml">
                     <mi id="S6.E4.m1.14.14.12.12.1.3.3.3.3.2" xref="S6.E4.m1.14.14.12.12.1.3.3.3.3.2.cmml">
                      r
                     </mi>
                     <mrow id="S6.E4.m1.11.11.9.9.3.5" xref="S6.E4.m1.11.11.9.9.3.4.cmml">
                      <mi id="S6.E4.m1.9.9.7.7.1.1" xref="S6.E4.m1.9.9.7.7.1.1.cmml">
                       k
                      </mi>
                      <mo id="S6.E4.m1.11.11.9.9.3.5.1" xref="S6.E4.m1.11.11.9.9.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.10.10.8.8.2.2" xref="S6.E4.m1.10.10.8.8.2.2.cmml">
                       i
                      </mi>
                      <mo id="S6.E4.m1.11.11.9.9.3.5.2" xref="S6.E4.m1.11.11.9.9.3.4.cmml">
                       ,
                      </mo>
                      <mi id="S6.E4.m1.11.11.9.9.3.3" xref="S6.E4.m1.11.11.9.9.3.3.cmml">
                       τ
                      </mi>
                     </mrow>
                    </msub>
                    <mo id="S6.E4.m1.14.14.12.12.1.3.3.3.7" stretchy="false" xref="S6.E4.m1.14.14.12.12.1.3.3.4.cmml">
                     ]
                    </mo>
                   </mrow>
                   <mrow id="S6.E4.m1.14.14.12.12.1.3.5" xref="S6.E4.m1.14.14.12.12.1.3.5.cmml">
                    <mi id="S6.E4.m1.14.14.12.12.1.3.5.2" xref="S6.E4.m1.14.14.12.12.1.3.5.2.cmml">
                     τ
                    </mi>
                    <mo id="S6.E4.m1.14.14.12.12.1.3.5.1" xref="S6.E4.m1.14.14.12.12.1.3.5.1.cmml">
                     =
                    </mo>
                    <mn id="S6.E4.m1.14.14.12.12.1.3.5.3" xref="S6.E4.m1.14.14.12.12.1.3.5.3.cmml">
                     1
                    </mn>
                   </mrow>
                   <mi id="S6.E4.m1.14.14.12.12.1.5" xref="S6.E4.m1.14.14.12.12.1.5.cmml">
                    T
                   </mi>
                  </msubsup>
                  <mo id="S6.E4.m1.15.15.13.13.3" xref="S6.E4.m1.15.15.13.14.cmml">
                   ,
                  </mo>
                  <msub id="S6.E4.m1.15.15.13.13.2" xref="S6.E4.m1.15.15.13.13.2.cmml">
                   <mi id="S6.E4.m1.15.15.13.13.2.2" xref="S6.E4.m1.15.15.13.13.2.2.cmml">
                    G
                   </mi>
                   <mrow id="S6.E4.m1.13.13.11.11.2.4" xref="S6.E4.m1.13.13.11.11.2.3.cmml">
                    <mi id="S6.E4.m1.12.12.10.10.1.1" xref="S6.E4.m1.12.12.10.10.1.1.cmml">
                     k
                    </mi>
                    <mo id="S6.E4.m1.13.13.11.11.2.4.1" xref="S6.E4.m1.13.13.11.11.2.3.cmml">
                     ,
                    </mo>
                    <mi id="S6.E4.m1.13.13.11.11.2.2" xref="S6.E4.m1.13.13.11.11.2.2.cmml">
                     i
                    </mi>
                   </mrow>
                  </msub>
                 </mrow>
                 <mo id="S6.E4.m1.15.15.14" xref="S6.E4.m1.15.15.14.cmml">
                  ⏟
                 </mo>
                </munder>
                <mrow id="S6.E4.m1.17.17.2" xref="S6.E4.m1.17.17.2.cmml">
                 <mtext id="S6.E4.m1.17.17.2.4" xref="S6.E4.m1.17.17.2.4a.cmml">
                  Reflection prompt
                 </mtext>
                 <mo id="S6.E4.m1.17.17.2.3" lspace="0.280em" rspace="0em" xref="S6.E4.m1.17.17.2.3.cmml">
                  ​
                 </mo>
                 <msub id="S6.E4.m1.17.17.2.5" xref="S6.E4.m1.17.17.2.5.cmml">
                  <mi id="S6.E4.m1.17.17.2.5.2" xref="S6.E4.m1.17.17.2.5.2.cmml">
                   x
                  </mi>
                  <mrow id="S6.E4.m1.17.17.2.2.2.4" xref="S6.E4.m1.17.17.2.2.2.3.cmml">
                   <mi id="S6.E4.m1.16.16.1.1.1.1" xref="S6.E4.m1.16.16.1.1.1.1.cmml">
                    k
                   </mi>
                   <mo id="S6.E4.m1.17.17.2.2.2.4.1" xref="S6.E4.m1.17.17.2.2.2.3.cmml">
                    ,
                   </mo>
                   <mi id="S6.E4.m1.17.17.2.2.2.2" xref="S6.E4.m1.17.17.2.2.2.2.cmml">
                    i
                   </mi>
                  </mrow>
                 </msub>
                </mrow>
               </munder>
               <mo id="S6.E4.m1.18.18.1.1.1.1.1.3" stretchy="false" xref="S6.E4.m1.18.18.1.1.1.1.1.1.cmml">
                )
               </mo>
              </mrow>
             </mrow>
            </mrow>
            <mo id="S6.E4.m1.18.18.1.2" lspace="0em" xref="S6.E4.m1.18.18.1.1.cmml">
             .
            </mo>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.E4.m1.18b">
            <apply id="S6.E4.m1.18.18.1.1.cmml" xref="S6.E4.m1.18.18.1">
             <eq id="S6.E4.m1.18.18.1.1.2.cmml" xref="S6.E4.m1.18.18.1.1.2">
             </eq>
             <apply id="S6.E4.m1.18.18.1.1.3.cmml" xref="S6.E4.m1.18.18.1.1.3">
              <csymbol cd="ambiguous" id="S6.E4.m1.18.18.1.1.3.1.cmml" xref="S6.E4.m1.18.18.1.1.3">
               subscript
              </csymbol>
              <ci id="S6.E4.m1.18.18.1.1.3.2.cmml" xref="S6.E4.m1.18.18.1.1.3.2">
               𝑦
              </ci>
              <list id="S6.E4.m1.2.2.2.3.cmml" xref="S6.E4.m1.2.2.2.4">
               <ci id="S6.E4.m1.1.1.1.1.cmml" xref="S6.E4.m1.1.1.1.1">
                𝑘
               </ci>
               <ci id="S6.E4.m1.2.2.2.2.cmml" xref="S6.E4.m1.2.2.2.2">
                𝑖
               </ci>
              </list>
             </apply>
             <apply id="S6.E4.m1.18.18.1.1.1.cmml" xref="S6.E4.m1.18.18.1.1.1">
              <times id="S6.E4.m1.18.18.1.1.1.2.cmml" xref="S6.E4.m1.18.18.1.1.1.2">
              </times>
              <apply id="S6.E4.m1.18.18.1.1.1.3.cmml" xref="S6.E4.m1.18.18.1.1.1.3">
               <csymbol cd="ambiguous" id="S6.E4.m1.18.18.1.1.1.3.1.cmml" xref="S6.E4.m1.18.18.1.1.1.3">
                subscript
               </csymbol>
               <ci id="S6.E4.m1.18.18.1.1.1.3.2.cmml" xref="S6.E4.m1.18.18.1.1.1.3.2">
                𝑀
               </ci>
               <ci id="S6.E4.m1.18.18.1.1.1.3.3.cmml" xref="S6.E4.m1.18.18.1.1.1.3.3">
                𝑟
               </ci>
              </apply>
              <apply id="S6.E4.m1.18.18.1.1.1.1.1.1.cmml" xref="S6.E4.m1.18.18.1.1.1.1.1">
               <csymbol cd="ambiguous" id="S6.E4.m1.18.18.1.1.1.1.1.1.1.cmml" xref="S6.E4.m1.18.18.1.1.1.1.1">
                subscript
               </csymbol>
               <apply id="S6.E4.m1.15.15.cmml" xref="S6.E4.m1.15.15">
                <ci id="S6.E4.m1.15.15.14.cmml" xref="S6.E4.m1.15.15.14">
                 ⏟
                </ci>
                <list id="S6.E4.m1.15.15.13.14.cmml" xref="S6.E4.m1.15.15.13.13">
                 <apply id="S6.E4.m1.14.14.12.12.1.cmml" xref="S6.E4.m1.14.14.12.12.1">
                  <csymbol cd="ambiguous" id="S6.E4.m1.14.14.12.12.1.4.cmml" xref="S6.E4.m1.14.14.12.12.1">
                   superscript
                  </csymbol>
                  <apply id="S6.E4.m1.14.14.12.12.1.3.cmml" xref="S6.E4.m1.14.14.12.12.1">
                   <csymbol cd="ambiguous" id="S6.E4.m1.14.14.12.12.1.3.4.cmml" xref="S6.E4.m1.14.14.12.12.1">
                    subscript
                   </csymbol>
                   <list id="S6.E4.m1.14.14.12.12.1.3.3.4.cmml" xref="S6.E4.m1.14.14.12.12.1.3.3.3">
                    <apply id="S6.E4.m1.14.14.12.12.1.1.1.1.1.cmml" xref="S6.E4.m1.14.14.12.12.1.1.1.1.1">
                     <csymbol cd="ambiguous" id="S6.E4.m1.14.14.12.12.1.1.1.1.1.1.cmml" xref="S6.E4.m1.14.14.12.12.1.1.1.1.1">
                      subscript
                     </csymbol>
                     <ci id="S6.E4.m1.14.14.12.12.1.1.1.1.1.2.cmml" xref="S6.E4.m1.14.14.12.12.1.1.1.1.1.2">
                      𝑠
                     </ci>
                     <list id="S6.E4.m1.5.5.3.3.3.4.cmml" xref="S6.E4.m1.5.5.3.3.3.5">
                      <ci id="S6.E4.m1.3.3.1.1.1.1.cmml" xref="S6.E4.m1.3.3.1.1.1.1">
                       𝑘
                      </ci>
                      <ci id="S6.E4.m1.4.4.2.2.2.2.cmml" xref="S6.E4.m1.4.4.2.2.2.2">
                       𝑖
                      </ci>
                      <ci id="S6.E4.m1.5.5.3.3.3.3.cmml" xref="S6.E4.m1.5.5.3.3.3.3">
                       𝜏
                      </ci>
                     </list>
                    </apply>
                    <apply id="S6.E4.m1.14.14.12.12.1.2.2.2.2.cmml" xref="S6.E4.m1.14.14.12.12.1.2.2.2.2">
                     <csymbol cd="ambiguous" id="S6.E4.m1.14.14.12.12.1.2.2.2.2.1.cmml" xref="S6.E4.m1.14.14.12.12.1.2.2.2.2">
                      subscript
                     </csymbol>
                     <ci id="S6.E4.m1.14.14.12.12.1.2.2.2.2.2.cmml" xref="S6.E4.m1.14.14.12.12.1.2.2.2.2.2">
                      𝑎
                     </ci>
                     <list id="S6.E4.m1.8.8.6.6.3.4.cmml" xref="S6.E4.m1.8.8.6.6.3.5">
                      <ci id="S6.E4.m1.6.6.4.4.1.1.cmml" xref="S6.E4.m1.6.6.4.4.1.1">
                       𝑘
                      </ci>
                      <ci id="S6.E4.m1.7.7.5.5.2.2.cmml" xref="S6.E4.m1.7.7.5.5.2.2">
                       𝑖
                      </ci>
                      <ci id="S6.E4.m1.8.8.6.6.3.3.cmml" xref="S6.E4.m1.8.8.6.6.3.3">
                       𝜏
                      </ci>
                     </list>
                    </apply>
                    <apply id="S6.E4.m1.14.14.12.12.1.3.3.3.3.cmml" xref="S6.E4.m1.14.14.12.12.1.3.3.3.3">
                     <csymbol cd="ambiguous" id="S6.E4.m1.14.14.12.12.1.3.3.3.3.1.cmml" xref="S6.E4.m1.14.14.12.12.1.3.3.3.3">
                      subscript
                     </csymbol>
                     <ci id="S6.E4.m1.14.14.12.12.1.3.3.3.3.2.cmml" xref="S6.E4.m1.14.14.12.12.1.3.3.3.3.2">
                      𝑟
                     </ci>
                     <list id="S6.E4.m1.11.11.9.9.3.4.cmml" xref="S6.E4.m1.11.11.9.9.3.5">
                      <ci id="S6.E4.m1.9.9.7.7.1.1.cmml" xref="S6.E4.m1.9.9.7.7.1.1">
                       𝑘
                      </ci>
                      <ci id="S6.E4.m1.10.10.8.8.2.2.cmml" xref="S6.E4.m1.10.10.8.8.2.2">
                       𝑖
                      </ci>
                      <ci id="S6.E4.m1.11.11.9.9.3.3.cmml" xref="S6.E4.m1.11.11.9.9.3.3">
                       𝜏
                      </ci>
                     </list>
                    </apply>
                   </list>
                   <apply id="S6.E4.m1.14.14.12.12.1.3.5.cmml" xref="S6.E4.m1.14.14.12.12.1.3.5">
                    <eq id="S6.E4.m1.14.14.12.12.1.3.5.1.cmml" xref="S6.E4.m1.14.14.12.12.1.3.5.1">
                    </eq>
                    <ci id="S6.E4.m1.14.14.12.12.1.3.5.2.cmml" xref="S6.E4.m1.14.14.12.12.1.3.5.2">
                     𝜏
                    </ci>
                    <cn id="S6.E4.m1.14.14.12.12.1.3.5.3.cmml" type="integer" xref="S6.E4.m1.14.14.12.12.1.3.5.3">
                     1
                    </cn>
                   </apply>
                  </apply>
                  <ci id="S6.E4.m1.14.14.12.12.1.5.cmml" xref="S6.E4.m1.14.14.12.12.1.5">
                   𝑇
                  </ci>
                 </apply>
                 <apply id="S6.E4.m1.15.15.13.13.2.cmml" xref="S6.E4.m1.15.15.13.13.2">
                  <csymbol cd="ambiguous" id="S6.E4.m1.15.15.13.13.2.1.cmml" xref="S6.E4.m1.15.15.13.13.2">
                   subscript
                  </csymbol>
                  <ci id="S6.E4.m1.15.15.13.13.2.2.cmml" xref="S6.E4.m1.15.15.13.13.2.2">
                   𝐺
                  </ci>
                  <list id="S6.E4.m1.13.13.11.11.2.3.cmml" xref="S6.E4.m1.13.13.11.11.2.4">
                   <ci id="S6.E4.m1.12.12.10.10.1.1.cmml" xref="S6.E4.m1.12.12.10.10.1.1">
                    𝑘
                   </ci>
                   <ci id="S6.E4.m1.13.13.11.11.2.2.cmml" xref="S6.E4.m1.13.13.11.11.2.2">
                    𝑖
                   </ci>
                  </list>
                 </apply>
                </list>
               </apply>
               <apply id="S6.E4.m1.17.17.2.cmml" xref="S6.E4.m1.17.17.2">
                <times id="S6.E4.m1.17.17.2.3.cmml" xref="S6.E4.m1.17.17.2.3">
                </times>
                <ci id="S6.E4.m1.17.17.2.4a.cmml" xref="S6.E4.m1.17.17.2.4">
                 <mtext id="S6.E4.m1.17.17.2.4.cmml" mathsize="70%" xref="S6.E4.m1.17.17.2.4">
                  Reflection prompt
                 </mtext>
                </ci>
                <apply id="S6.E4.m1.17.17.2.5.cmml" xref="S6.E4.m1.17.17.2.5">
                 <csymbol cd="ambiguous" id="S6.E4.m1.17.17.2.5.1.cmml" xref="S6.E4.m1.17.17.2.5">
                  subscript
                 </csymbol>
                 <ci id="S6.E4.m1.17.17.2.5.2.cmml" xref="S6.E4.m1.17.17.2.5.2">
                  𝑥
                 </ci>
                 <list id="S6.E4.m1.17.17.2.2.2.3.cmml" xref="S6.E4.m1.17.17.2.2.2.4">
                  <ci id="S6.E4.m1.16.16.1.1.1.1.cmml" xref="S6.E4.m1.16.16.1.1.1.1">
                   𝑘
                  </ci>
                  <ci id="S6.E4.m1.17.17.2.2.2.2.cmml" xref="S6.E4.m1.17.17.2.2.2.2">
                   𝑖
                  </ci>
                 </list>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.E4.m1.18c">
            y_{k,i}=M_{r}(\underbrace{[s_{k,i,\tau},a_{k,i,\tau},r_{k,i,\tau}]_{\tau=1}^{T},G_{k,i}}_{\text{Reflection prompt}\;x_{k,i}}).
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (4)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="ltx_p" id="S6.SS1.SSS0.Px2.p1.5">
      This self-reflection feedback
      <math alttext="y_{k,i}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px2.p1.2.m1.2">
       <semantics id="S6.SS1.SSS0.Px2.p1.2.m1.2a">
        <msub id="S6.SS1.SSS0.Px2.p1.2.m1.2.3" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.3.cmml">
         <mi id="S6.SS1.SSS0.Px2.p1.2.m1.2.3.2" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.3.2.cmml">
          y
         </mi>
         <mrow id="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.4" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.3.cmml">
          <mi id="S6.SS1.SSS0.Px2.p1.2.m1.1.1.1.1" xref="S6.SS1.SSS0.Px2.p1.2.m1.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.4.1" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.2" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px2.p1.2.m1.2b">
         <apply id="S6.SS1.SSS0.Px2.p1.2.m1.2.3.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.3">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px2.p1.2.m1.2.3.1.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px2.p1.2.m1.2.3.2.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.3.2">
           𝑦
          </ci>
          <list id="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.3.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.4">
           <ci id="S6.SS1.SSS0.Px2.p1.2.m1.1.1.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.2.cmml" xref="S6.SS1.SSS0.Px2.p1.2.m1.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px2.p1.2.m1.2c">
         y_{k,i}
        </annotation>
       </semantics>
      </math>
      is appended to the actor prompt to prevent repetitive errors in a specific environment in future attempts. Consider a multi-step task, wherein the agent failed in the prior trial. In such a scenario, the retrospective model can detect that a particular action, denoted as
      <math alttext="a_{t}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px2.p1.3.m2.1">
       <semantics id="S6.SS1.SSS0.Px2.p1.3.m2.1a">
        <msub id="S6.SS1.SSS0.Px2.p1.3.m2.1.1" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.2" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1.2.cmml">
          a
         </mi>
         <mi id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.3" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1.3.cmml">
          t
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px2.p1.3.m2.1b">
         <apply id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.2.cmml" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1.2">
           𝑎
          </ci>
          <ci id="S6.SS1.SSS0.Px2.p1.3.m2.1.1.3.cmml" xref="S6.SS1.SSS0.Px2.p1.3.m2.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px2.p1.3.m2.1c">
         a_{t}
        </annotation>
       </semantics>
      </math>
      , led to subsequent erroneous actions and final failure. In future trials, the actor LM can use these self-reflections, which are appended to the prompt, to adapt its reasoning and action steps at time
      <math alttext="t" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px2.p1.4.m3.1">
       <semantics id="S6.SS1.SSS0.Px2.p1.4.m3.1a">
        <mi id="S6.SS1.SSS0.Px2.p1.4.m3.1.1" xref="S6.SS1.SSS0.Px2.p1.4.m3.1.1.cmml">
         t
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px2.p1.4.m3.1b">
         <ci id="S6.SS1.SSS0.Px2.p1.4.m3.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.4.m3.1.1">
          𝑡
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px2.p1.4.m3.1c">
         t
        </annotation>
       </semantics>
      </math>
      , opting for the alternative action
      <math alttext="a_{t}^{\prime}" class="ltx_Math" display="inline" id="S6.SS1.SSS0.Px2.p1.5.m4.1">
       <semantics id="S6.SS1.SSS0.Px2.p1.5.m4.1a">
        <msubsup id="S6.SS1.SSS0.Px2.p1.5.m4.1.1" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.cmml">
         <mi id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.2" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.2.cmml">
          a
         </mi>
         <mi id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.3" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.3.cmml">
          t
         </mi>
         <mo id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.3" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.3.cmml">
          ′
         </mo>
        </msubsup>
        <annotation-xml encoding="MathML-Content" id="S6.SS1.SSS0.Px2.p1.5.m4.1b">
         <apply id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1">
          <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.1.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1">
           superscript
          </csymbol>
          <apply id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1">
           <csymbol cd="ambiguous" id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.1.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1">
            subscript
           </csymbol>
           <ci id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.2.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.2">
            𝑎
           </ci>
           <ci id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.3.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.2.3">
            𝑡
           </ci>
          </apply>
          <ci id="S6.SS1.SSS0.Px2.p1.5.m4.1.1.3.cmml" xref="S6.SS1.SSS0.Px2.p1.5.m4.1.1.3">
           ′
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS1.SSS0.Px2.p1.5.m4.1c">
         a_{t}^{\prime}
        </annotation>
       </semantics>
      </math>
      . This iterative process empowers the agent to exploit past experiences within a specific environment and task, thereby avoiding repetitive errors.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px3">
    <h4 class="ltx_title ltx_title_paragraph">
     Memory Module
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px3.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px3.p1.1">
      The actor model generates thoughts and actions, by conditioning on its recent interactions (short-term memory) and reflection responses (long-term memory).
     </p>
    </div>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px3.p2">
     <ul class="ltx_itemize" id="S6.I1">
      <li class="ltx_item" id="S6.I1.i1" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        •
       </span>
       <div class="ltx_para" id="S6.I1.i1.p1">
        <p class="ltx_p" id="S6.I1.i1.p1.2">
         <span class="ltx_text ltx_font_italic" id="S6.I1.i1.p1.2.1">
          Short-term memory
         </span>
         . The trajectory history
         <math alttext="\tau_{i}" class="ltx_Math" display="inline" id="S6.I1.i1.p1.1.m1.1">
          <semantics id="S6.I1.i1.p1.1.m1.1a">
           <msub id="S6.I1.i1.p1.1.m1.1.1" xref="S6.I1.i1.p1.1.m1.1.1.cmml">
            <mi id="S6.I1.i1.p1.1.m1.1.1.2" xref="S6.I1.i1.p1.1.m1.1.1.2.cmml">
             τ
            </mi>
            <mi id="S6.I1.i1.p1.1.m1.1.1.3" xref="S6.I1.i1.p1.1.m1.1.1.3.cmml">
             i
            </mi>
           </msub>
           <annotation-xml encoding="MathML-Content" id="S6.I1.i1.p1.1.m1.1b">
            <apply id="S6.I1.i1.p1.1.m1.1.1.cmml" xref="S6.I1.i1.p1.1.m1.1.1">
             <csymbol cd="ambiguous" id="S6.I1.i1.p1.1.m1.1.1.1.cmml" xref="S6.I1.i1.p1.1.m1.1.1">
              subscript
             </csymbol>
             <ci id="S6.I1.i1.p1.1.m1.1.1.2.cmml" xref="S6.I1.i1.p1.1.m1.1.1.2">
              𝜏
             </ci>
             <ci id="S6.I1.i1.p1.1.m1.1.1.3.cmml" xref="S6.I1.i1.p1.1.m1.1.1.3">
              𝑖
             </ci>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I1.i1.p1.1.m1.1c">
            \tau_{i}
           </annotation>
          </semantics>
         </math>
         of the current episode
         <math alttext="i" class="ltx_Math" display="inline" id="S6.I1.i1.p1.2.m2.1">
          <semantics id="S6.I1.i1.p1.2.m2.1a">
           <mi id="S6.I1.i1.p1.2.m2.1.1" xref="S6.I1.i1.p1.2.m2.1.1.cmml">
            i
           </mi>
           <annotation-xml encoding="MathML-Content" id="S6.I1.i1.p1.2.m2.1b">
            <ci id="S6.I1.i1.p1.2.m2.1.1.cmml" xref="S6.I1.i1.p1.2.m2.1.1">
             𝑖
            </ci>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I1.i1.p1.2.m2.1c">
            i
           </annotation>
          </semantics>
         </math>
         serves as the short-term memory for decision making and reasoning.
        </p>
       </div>
      </li>
      <li class="ltx_item" id="S6.I1.i2" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        •
       </span>
       <div class="ltx_para ltx_noindent" id="S6.I1.i2.p1">
        <p class="ltx_p" id="S6.I1.i2.p1.1">
         <span class="ltx_text ltx_font_italic" id="S6.I1.i2.p1.1.1">
          Long-term memory
         </span>
         . The reflection responses that summarize prior failed attempts are appended to the actor prompt as the long-term memory.
        </p>
       </div>
      </li>
     </ul>
    </div>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px3.p3">
     <p class="ltx_p" id="S6.SS1.SSS0.Px3.p3.1">
      To facilitate policy optimization in
      <a class="ltx_ref" href="#S6.SS2" title="6.2 Policy Gradient Optimization ‣ 6 Our Approach: Reinforcing Retrospective Language Agent ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Section
       </span>
       <span class="ltx_text ltx_ref_tag">
        6.2
       </span>
      </a>
      , we store the prompts and responses of the retrospective model of each trial, as instruction-response pairs, together with the episode returns in a local dataset, which we call
      <span class="ltx_text ltx_font_italic" id="S6.SS1.SSS0.Px3.p3.1.1">
       replay buffer
      </span>
      . We sample from the replay buffer to reinforce the retrospective model at the end of each episode. The long and short-term memory components provide context that is specific to a given task over several failed trials and the replay buffer provides demonstrations of successful reflections across the tasks and environments, so that our
      <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S6.SS1.SSS0.Px3.p3.1.2">
       Retroformer
      </span>
      agent not only exploits lessons learned over failed trials in this task, but also explores by learning from successful reflections in other tasks.
     </p>
    </div>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px3.p4">
     <ul class="ltx_itemize" id="S6.I2">
      <li class="ltx_item" id="S6.I2.i1" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        •
       </span>
       <div class="ltx_para ltx_noindent" id="S6.I2.i1.p1">
        <p class="ltx_p" id="S6.I2.i1.p1.7">
         <span class="ltx_text ltx_font_italic" id="S6.I2.i1.p1.7.1">
          Replay buffer
         </span>
         . The memory
         <math alttext="D_{\text{RL}}" class="ltx_Math" display="inline" id="S6.I2.i1.p1.1.m1.1">
          <semantics id="S6.I2.i1.p1.1.m1.1a">
           <msub id="S6.I2.i1.p1.1.m1.1.1" xref="S6.I2.i1.p1.1.m1.1.1.cmml">
            <mi id="S6.I2.i1.p1.1.m1.1.1.2" xref="S6.I2.i1.p1.1.m1.1.1.2.cmml">
             D
            </mi>
            <mtext id="S6.I2.i1.p1.1.m1.1.1.3" xref="S6.I2.i1.p1.1.m1.1.1.3a.cmml">
             RL
            </mtext>
           </msub>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.1.m1.1b">
            <apply id="S6.I2.i1.p1.1.m1.1.1.cmml" xref="S6.I2.i1.p1.1.m1.1.1">
             <csymbol cd="ambiguous" id="S6.I2.i1.p1.1.m1.1.1.1.cmml" xref="S6.I2.i1.p1.1.m1.1.1">
              subscript
             </csymbol>
             <ci id="S6.I2.i1.p1.1.m1.1.1.2.cmml" xref="S6.I2.i1.p1.1.m1.1.1.2">
              𝐷
             </ci>
             <ci id="S6.I2.i1.p1.1.m1.1.1.3a.cmml" xref="S6.I2.i1.p1.1.m1.1.1.3">
              <mtext id="S6.I2.i1.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S6.I2.i1.p1.1.m1.1.1.3">
               RL
              </mtext>
             </ci>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.1.m1.1c">
            D_{\text{RL}}
           </annotation>
          </semantics>
         </math>
         which stores the triplets
         <math alttext="(x_{k,i},y_{k,i},G_{k,i})" class="ltx_Math" display="inline" id="S6.I2.i1.p1.2.m2.9">
          <semantics id="S6.I2.i1.p1.2.m2.9a">
           <mrow id="S6.I2.i1.p1.2.m2.9.9.3" xref="S6.I2.i1.p1.2.m2.9.9.4.cmml">
            <mo id="S6.I2.i1.p1.2.m2.9.9.3.4" stretchy="false" xref="S6.I2.i1.p1.2.m2.9.9.4.cmml">
             (
            </mo>
            <msub id="S6.I2.i1.p1.2.m2.7.7.1.1" xref="S6.I2.i1.p1.2.m2.7.7.1.1.cmml">
             <mi id="S6.I2.i1.p1.2.m2.7.7.1.1.2" xref="S6.I2.i1.p1.2.m2.7.7.1.1.2.cmml">
              x
             </mi>
             <mrow id="S6.I2.i1.p1.2.m2.2.2.2.4" xref="S6.I2.i1.p1.2.m2.2.2.2.3.cmml">
              <mi id="S6.I2.i1.p1.2.m2.1.1.1.1" xref="S6.I2.i1.p1.2.m2.1.1.1.1.cmml">
               k
              </mi>
              <mo id="S6.I2.i1.p1.2.m2.2.2.2.4.1" xref="S6.I2.i1.p1.2.m2.2.2.2.3.cmml">
               ,
              </mo>
              <mi id="S6.I2.i1.p1.2.m2.2.2.2.2" xref="S6.I2.i1.p1.2.m2.2.2.2.2.cmml">
               i
              </mi>
             </mrow>
            </msub>
            <mo id="S6.I2.i1.p1.2.m2.9.9.3.5" xref="S6.I2.i1.p1.2.m2.9.9.4.cmml">
             ,
            </mo>
            <msub id="S6.I2.i1.p1.2.m2.8.8.2.2" xref="S6.I2.i1.p1.2.m2.8.8.2.2.cmml">
             <mi id="S6.I2.i1.p1.2.m2.8.8.2.2.2" xref="S6.I2.i1.p1.2.m2.8.8.2.2.2.cmml">
              y
             </mi>
             <mrow id="S6.I2.i1.p1.2.m2.4.4.2.4" xref="S6.I2.i1.p1.2.m2.4.4.2.3.cmml">
              <mi id="S6.I2.i1.p1.2.m2.3.3.1.1" xref="S6.I2.i1.p1.2.m2.3.3.1.1.cmml">
               k
              </mi>
              <mo id="S6.I2.i1.p1.2.m2.4.4.2.4.1" xref="S6.I2.i1.p1.2.m2.4.4.2.3.cmml">
               ,
              </mo>
              <mi id="S6.I2.i1.p1.2.m2.4.4.2.2" xref="S6.I2.i1.p1.2.m2.4.4.2.2.cmml">
               i
              </mi>
             </mrow>
            </msub>
            <mo id="S6.I2.i1.p1.2.m2.9.9.3.6" xref="S6.I2.i1.p1.2.m2.9.9.4.cmml">
             ,
            </mo>
            <msub id="S6.I2.i1.p1.2.m2.9.9.3.3" xref="S6.I2.i1.p1.2.m2.9.9.3.3.cmml">
             <mi id="S6.I2.i1.p1.2.m2.9.9.3.3.2" xref="S6.I2.i1.p1.2.m2.9.9.3.3.2.cmml">
              G
             </mi>
             <mrow id="S6.I2.i1.p1.2.m2.6.6.2.4" xref="S6.I2.i1.p1.2.m2.6.6.2.3.cmml">
              <mi id="S6.I2.i1.p1.2.m2.5.5.1.1" xref="S6.I2.i1.p1.2.m2.5.5.1.1.cmml">
               k
              </mi>
              <mo id="S6.I2.i1.p1.2.m2.6.6.2.4.1" xref="S6.I2.i1.p1.2.m2.6.6.2.3.cmml">
               ,
              </mo>
              <mi id="S6.I2.i1.p1.2.m2.6.6.2.2" xref="S6.I2.i1.p1.2.m2.6.6.2.2.cmml">
               i
              </mi>
             </mrow>
            </msub>
            <mo id="S6.I2.i1.p1.2.m2.9.9.3.7" stretchy="false" xref="S6.I2.i1.p1.2.m2.9.9.4.cmml">
             )
            </mo>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.2.m2.9b">
            <vector id="S6.I2.i1.p1.2.m2.9.9.4.cmml" xref="S6.I2.i1.p1.2.m2.9.9.3">
             <apply id="S6.I2.i1.p1.2.m2.7.7.1.1.cmml" xref="S6.I2.i1.p1.2.m2.7.7.1.1">
              <csymbol cd="ambiguous" id="S6.I2.i1.p1.2.m2.7.7.1.1.1.cmml" xref="S6.I2.i1.p1.2.m2.7.7.1.1">
               subscript
              </csymbol>
              <ci id="S6.I2.i1.p1.2.m2.7.7.1.1.2.cmml" xref="S6.I2.i1.p1.2.m2.7.7.1.1.2">
               𝑥
              </ci>
              <list id="S6.I2.i1.p1.2.m2.2.2.2.3.cmml" xref="S6.I2.i1.p1.2.m2.2.2.2.4">
               <ci id="S6.I2.i1.p1.2.m2.1.1.1.1.cmml" xref="S6.I2.i1.p1.2.m2.1.1.1.1">
                𝑘
               </ci>
               <ci id="S6.I2.i1.p1.2.m2.2.2.2.2.cmml" xref="S6.I2.i1.p1.2.m2.2.2.2.2">
                𝑖
               </ci>
              </list>
             </apply>
             <apply id="S6.I2.i1.p1.2.m2.8.8.2.2.cmml" xref="S6.I2.i1.p1.2.m2.8.8.2.2">
              <csymbol cd="ambiguous" id="S6.I2.i1.p1.2.m2.8.8.2.2.1.cmml" xref="S6.I2.i1.p1.2.m2.8.8.2.2">
               subscript
              </csymbol>
              <ci id="S6.I2.i1.p1.2.m2.8.8.2.2.2.cmml" xref="S6.I2.i1.p1.2.m2.8.8.2.2.2">
               𝑦
              </ci>
              <list id="S6.I2.i1.p1.2.m2.4.4.2.3.cmml" xref="S6.I2.i1.p1.2.m2.4.4.2.4">
               <ci id="S6.I2.i1.p1.2.m2.3.3.1.1.cmml" xref="S6.I2.i1.p1.2.m2.3.3.1.1">
                𝑘
               </ci>
               <ci id="S6.I2.i1.p1.2.m2.4.4.2.2.cmml" xref="S6.I2.i1.p1.2.m2.4.4.2.2">
                𝑖
               </ci>
              </list>
             </apply>
             <apply id="S6.I2.i1.p1.2.m2.9.9.3.3.cmml" xref="S6.I2.i1.p1.2.m2.9.9.3.3">
              <csymbol cd="ambiguous" id="S6.I2.i1.p1.2.m2.9.9.3.3.1.cmml" xref="S6.I2.i1.p1.2.m2.9.9.3.3">
               subscript
              </csymbol>
              <ci id="S6.I2.i1.p1.2.m2.9.9.3.3.2.cmml" xref="S6.I2.i1.p1.2.m2.9.9.3.3.2">
               𝐺
              </ci>
              <list id="S6.I2.i1.p1.2.m2.6.6.2.3.cmml" xref="S6.I2.i1.p1.2.m2.6.6.2.4">
               <ci id="S6.I2.i1.p1.2.m2.5.5.1.1.cmml" xref="S6.I2.i1.p1.2.m2.5.5.1.1">
                𝑘
               </ci>
               <ci id="S6.I2.i1.p1.2.m2.6.6.2.2.cmml" xref="S6.I2.i1.p1.2.m2.6.6.2.2">
                𝑖
               </ci>
              </list>
             </apply>
            </vector>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.2.m2.9c">
            (x_{k,i},y_{k,i},G_{k,i})
           </annotation>
          </semantics>
         </math>
         of the reflection prompt
         <math alttext="x_{k,i}" class="ltx_Math" display="inline" id="S6.I2.i1.p1.3.m3.2">
          <semantics id="S6.I2.i1.p1.3.m3.2a">
           <msub id="S6.I2.i1.p1.3.m3.2.3" xref="S6.I2.i1.p1.3.m3.2.3.cmml">
            <mi id="S6.I2.i1.p1.3.m3.2.3.2" xref="S6.I2.i1.p1.3.m3.2.3.2.cmml">
             x
            </mi>
            <mrow id="S6.I2.i1.p1.3.m3.2.2.2.4" xref="S6.I2.i1.p1.3.m3.2.2.2.3.cmml">
             <mi id="S6.I2.i1.p1.3.m3.1.1.1.1" xref="S6.I2.i1.p1.3.m3.1.1.1.1.cmml">
              k
             </mi>
             <mo id="S6.I2.i1.p1.3.m3.2.2.2.4.1" xref="S6.I2.i1.p1.3.m3.2.2.2.3.cmml">
              ,
             </mo>
             <mi id="S6.I2.i1.p1.3.m3.2.2.2.2" xref="S6.I2.i1.p1.3.m3.2.2.2.2.cmml">
              i
             </mi>
            </mrow>
           </msub>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.3.m3.2b">
            <apply id="S6.I2.i1.p1.3.m3.2.3.cmml" xref="S6.I2.i1.p1.3.m3.2.3">
             <csymbol cd="ambiguous" id="S6.I2.i1.p1.3.m3.2.3.1.cmml" xref="S6.I2.i1.p1.3.m3.2.3">
              subscript
             </csymbol>
             <ci id="S6.I2.i1.p1.3.m3.2.3.2.cmml" xref="S6.I2.i1.p1.3.m3.2.3.2">
              𝑥
             </ci>
             <list id="S6.I2.i1.p1.3.m3.2.2.2.3.cmml" xref="S6.I2.i1.p1.3.m3.2.2.2.4">
              <ci id="S6.I2.i1.p1.3.m3.1.1.1.1.cmml" xref="S6.I2.i1.p1.3.m3.1.1.1.1">
               𝑘
              </ci>
              <ci id="S6.I2.i1.p1.3.m3.2.2.2.2.cmml" xref="S6.I2.i1.p1.3.m3.2.2.2.2">
               𝑖
              </ci>
             </list>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.3.m3.2c">
            x_{k,i}
           </annotation>
          </semantics>
         </math>
         , reflection response
         <math alttext="y_{k,i}" class="ltx_Math" display="inline" id="S6.I2.i1.p1.4.m4.2">
          <semantics id="S6.I2.i1.p1.4.m4.2a">
           <msub id="S6.I2.i1.p1.4.m4.2.3" xref="S6.I2.i1.p1.4.m4.2.3.cmml">
            <mi id="S6.I2.i1.p1.4.m4.2.3.2" xref="S6.I2.i1.p1.4.m4.2.3.2.cmml">
             y
            </mi>
            <mrow id="S6.I2.i1.p1.4.m4.2.2.2.4" xref="S6.I2.i1.p1.4.m4.2.2.2.3.cmml">
             <mi id="S6.I2.i1.p1.4.m4.1.1.1.1" xref="S6.I2.i1.p1.4.m4.1.1.1.1.cmml">
              k
             </mi>
             <mo id="S6.I2.i1.p1.4.m4.2.2.2.4.1" xref="S6.I2.i1.p1.4.m4.2.2.2.3.cmml">
              ,
             </mo>
             <mi id="S6.I2.i1.p1.4.m4.2.2.2.2" xref="S6.I2.i1.p1.4.m4.2.2.2.2.cmml">
              i
             </mi>
            </mrow>
           </msub>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.4.m4.2b">
            <apply id="S6.I2.i1.p1.4.m4.2.3.cmml" xref="S6.I2.i1.p1.4.m4.2.3">
             <csymbol cd="ambiguous" id="S6.I2.i1.p1.4.m4.2.3.1.cmml" xref="S6.I2.i1.p1.4.m4.2.3">
              subscript
             </csymbol>
             <ci id="S6.I2.i1.p1.4.m4.2.3.2.cmml" xref="S6.I2.i1.p1.4.m4.2.3.2">
              𝑦
             </ci>
             <list id="S6.I2.i1.p1.4.m4.2.2.2.3.cmml" xref="S6.I2.i1.p1.4.m4.2.2.2.4">
              <ci id="S6.I2.i1.p1.4.m4.1.1.1.1.cmml" xref="S6.I2.i1.p1.4.m4.1.1.1.1">
               𝑘
              </ci>
              <ci id="S6.I2.i1.p1.4.m4.2.2.2.2.cmml" xref="S6.I2.i1.p1.4.m4.2.2.2.2">
               𝑖
              </ci>
             </list>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.4.m4.2c">
            y_{k,i}
           </annotation>
          </semantics>
         </math>
         and episode return
         <math alttext="G_{k,i}" class="ltx_Math" display="inline" id="S6.I2.i1.p1.5.m5.2">
          <semantics id="S6.I2.i1.p1.5.m5.2a">
           <msub id="S6.I2.i1.p1.5.m5.2.3" xref="S6.I2.i1.p1.5.m5.2.3.cmml">
            <mi id="S6.I2.i1.p1.5.m5.2.3.2" xref="S6.I2.i1.p1.5.m5.2.3.2.cmml">
             G
            </mi>
            <mrow id="S6.I2.i1.p1.5.m5.2.2.2.4" xref="S6.I2.i1.p1.5.m5.2.2.2.3.cmml">
             <mi id="S6.I2.i1.p1.5.m5.1.1.1.1" xref="S6.I2.i1.p1.5.m5.1.1.1.1.cmml">
              k
             </mi>
             <mo id="S6.I2.i1.p1.5.m5.2.2.2.4.1" xref="S6.I2.i1.p1.5.m5.2.2.2.3.cmml">
              ,
             </mo>
             <mi id="S6.I2.i1.p1.5.m5.2.2.2.2" xref="S6.I2.i1.p1.5.m5.2.2.2.2.cmml">
              i
             </mi>
            </mrow>
           </msub>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.5.m5.2b">
            <apply id="S6.I2.i1.p1.5.m5.2.3.cmml" xref="S6.I2.i1.p1.5.m5.2.3">
             <csymbol cd="ambiguous" id="S6.I2.i1.p1.5.m5.2.3.1.cmml" xref="S6.I2.i1.p1.5.m5.2.3">
              subscript
             </csymbol>
             <ci id="S6.I2.i1.p1.5.m5.2.3.2.cmml" xref="S6.I2.i1.p1.5.m5.2.3.2">
              𝐺
             </ci>
             <list id="S6.I2.i1.p1.5.m5.2.2.2.3.cmml" xref="S6.I2.i1.p1.5.m5.2.2.2.4">
              <ci id="S6.I2.i1.p1.5.m5.1.1.1.1.cmml" xref="S6.I2.i1.p1.5.m5.1.1.1.1">
               𝑘
              </ci>
              <ci id="S6.I2.i1.p1.5.m5.2.2.2.2.cmml" xref="S6.I2.i1.p1.5.m5.2.2.2.2">
               𝑖
              </ci>
             </list>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.5.m5.2c">
            G_{k,i}
           </annotation>
          </semantics>
         </math>
         of trial
         <math alttext="i" class="ltx_Math" display="inline" id="S6.I2.i1.p1.6.m6.1">
          <semantics id="S6.I2.i1.p1.6.m6.1a">
           <mi id="S6.I2.i1.p1.6.m6.1.1" xref="S6.I2.i1.p1.6.m6.1.1.cmml">
            i
           </mi>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.6.m6.1b">
            <ci id="S6.I2.i1.p1.6.m6.1.1.cmml" xref="S6.I2.i1.p1.6.m6.1.1">
             𝑖
            </ci>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.6.m6.1c">
            i
           </annotation>
          </semantics>
         </math>
         and task
         <math alttext="k" class="ltx_Math" display="inline" id="S6.I2.i1.p1.7.m7.1">
          <semantics id="S6.I2.i1.p1.7.m7.1a">
           <mi id="S6.I2.i1.p1.7.m7.1.1" xref="S6.I2.i1.p1.7.m7.1.1.cmml">
            k
           </mi>
           <annotation-xml encoding="MathML-Content" id="S6.I2.i1.p1.7.m7.1b">
            <ci id="S6.I2.i1.p1.7.m7.1.1.cmml" xref="S6.I2.i1.p1.7.m7.1.1">
             𝑘
            </ci>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.I2.i1.p1.7.m7.1c">
            k
           </annotation>
          </semantics>
         </math>
         .
        </p>
       </div>
      </li>
     </ul>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS1.SSS0.Px4">
    <h4 class="ltx_title ltx_title_paragraph">
     Reward Shaping
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS1.SSS0.Px4.p1">
     <p class="ltx_p" id="S6.SS1.SSS0.Px4.p1.1">
      We apply reward shaping to the binary rewards for obtaining more information. For question answering tasks, instead of exactly matching the answer, we use f1 score grading to evaluate the alignment of the generated output with the expected answer as the reward function.
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S6.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     6.2
    </span>
    Policy Gradient Optimization
   </h3>
   <div class="ltx_para" id="S6.SS2.p1">
    <p class="ltx_p" id="S6.SS2.p1.6">
     The actor model
     <math alttext="M_{a}" class="ltx_Math" display="inline" id="S6.SS2.p1.1.m1.1">
      <semantics id="S6.SS2.p1.1.m1.1a">
       <msub id="S6.SS2.p1.1.m1.1.1" xref="S6.SS2.p1.1.m1.1.1.cmml">
        <mi id="S6.SS2.p1.1.m1.1.1.2" xref="S6.SS2.p1.1.m1.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.1.m1.1.1.3" xref="S6.SS2.p1.1.m1.1.1.3.cmml">
         a
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.1.m1.1b">
        <apply id="S6.SS2.p1.1.m1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.1.m1.1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.1.m1.1.1.2.cmml" xref="S6.SS2.p1.1.m1.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.1.m1.1.1.3.cmml" xref="S6.SS2.p1.1.m1.1.1.3">
          𝑎
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.1.m1.1c">
        M_{a}
       </annotation>
      </semantics>
     </math>
     is regarded as an frozen LLM, such as GPT, with inaccessible model parameters. In this scenario, the most direct approach to enhancing actor performance in a given environment is by refining the actor LM’s prompt. Consequently, the retrospective model
     <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.p1.2.m2.1">
      <semantics id="S6.SS2.p1.2.m2.1a">
       <msub id="S6.SS2.p1.2.m2.1.1" xref="S6.SS2.p1.2.m2.1.1.cmml">
        <mi id="S6.SS2.p1.2.m2.1.1.2" xref="S6.SS2.p1.2.m2.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.2.m2.1.1.3" xref="S6.SS2.p1.2.m2.1.1.3.cmml">
         r
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.2.m2.1b">
        <apply id="S6.SS2.p1.2.m2.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.2.m2.1.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.2.m2.1.1.2.cmml" xref="S6.SS2.p1.2.m2.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.2.m2.1.1.3.cmml" xref="S6.SS2.p1.2.m2.1.1.3">
          𝑟
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.2.m2.1c">
        M_{r}
       </annotation>
      </semantics>
     </math>
     , a smaller local language model, paraphrases the actor’s prompt by incorporating a concise summary of errors and valuable insights from failed attempts. We therefore aim to optimize the
     <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.p1.3.m3.1">
      <semantics id="S6.SS2.p1.3.m3.1a">
       <msub id="S6.SS2.p1.3.m3.1.1" xref="S6.SS2.p1.3.m3.1.1.cmml">
        <mi id="S6.SS2.p1.3.m3.1.1.2" xref="S6.SS2.p1.3.m3.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.3.m3.1.1.3" xref="S6.SS2.p1.3.m3.1.1.3.cmml">
         r
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.3.m3.1b">
        <apply id="S6.SS2.p1.3.m3.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.3.m3.1.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.3.m3.1.1.2.cmml" xref="S6.SS2.p1.3.m3.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.3.m3.1.1.3.cmml" xref="S6.SS2.p1.3.m3.1.1.3">
          𝑟
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.3.m3.1c">
        M_{r}
       </annotation>
      </semantics>
     </math>
     model using environment reward. The desired behavior of
     <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.p1.4.m4.1">
      <semantics id="S6.SS2.p1.4.m4.1a">
       <msub id="S6.SS2.p1.4.m4.1.1" xref="S6.SS2.p1.4.m4.1.1.cmml">
        <mi id="S6.SS2.p1.4.m4.1.1.2" xref="S6.SS2.p1.4.m4.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.4.m4.1.1.3" xref="S6.SS2.p1.4.m4.1.1.3.cmml">
         r
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.4.m4.1b">
        <apply id="S6.SS2.p1.4.m4.1.1.cmml" xref="S6.SS2.p1.4.m4.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.4.m4.1.1.1.cmml" xref="S6.SS2.p1.4.m4.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.4.m4.1.1.2.cmml" xref="S6.SS2.p1.4.m4.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.4.m4.1.1.3.cmml" xref="S6.SS2.p1.4.m4.1.1.3">
          𝑟
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.4.m4.1c">
        M_{r}
       </annotation>
      </semantics>
     </math>
     is to improve the actor model
     <math alttext="M_{a}" class="ltx_Math" display="inline" id="S6.SS2.p1.5.m5.1">
      <semantics id="S6.SS2.p1.5.m5.1a">
       <msub id="S6.SS2.p1.5.m5.1.1" xref="S6.SS2.p1.5.m5.1.1.cmml">
        <mi id="S6.SS2.p1.5.m5.1.1.2" xref="S6.SS2.p1.5.m5.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.5.m5.1.1.3" xref="S6.SS2.p1.5.m5.1.1.3.cmml">
         a
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.5.m5.1b">
        <apply id="S6.SS2.p1.5.m5.1.1.cmml" xref="S6.SS2.p1.5.m5.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.5.m5.1.1.1.cmml" xref="S6.SS2.p1.5.m5.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.5.m5.1.1.2.cmml" xref="S6.SS2.p1.5.m5.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.5.m5.1.1.3.cmml" xref="S6.SS2.p1.5.m5.1.1.3">
          𝑎
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.5.m5.1c">
        M_{a}
       </annotation>
      </semantics>
     </math>
     in next attempts. Hence, the difference in episode returns between two consecutive trials naturally serve as a reward signal for iteratively fine-tuning the retrospective model
     <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.p1.6.m6.1">
      <semantics id="S6.SS2.p1.6.m6.1a">
       <msub id="S6.SS2.p1.6.m6.1.1" xref="S6.SS2.p1.6.m6.1.1.cmml">
        <mi id="S6.SS2.p1.6.m6.1.1.2" xref="S6.SS2.p1.6.m6.1.1.2.cmml">
         M
        </mi>
        <mi id="S6.SS2.p1.6.m6.1.1.3" xref="S6.SS2.p1.6.m6.1.1.3.cmml">
         r
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S6.SS2.p1.6.m6.1b">
        <apply id="S6.SS2.p1.6.m6.1.1.cmml" xref="S6.SS2.p1.6.m6.1.1">
         <csymbol cd="ambiguous" id="S6.SS2.p1.6.m6.1.1.1.cmml" xref="S6.SS2.p1.6.m6.1.1">
          subscript
         </csymbol>
         <ci id="S6.SS2.p1.6.m6.1.1.2.cmml" xref="S6.SS2.p1.6.m6.1.1.2">
          𝑀
         </ci>
         <ci id="S6.SS2.p1.6.m6.1.1.3.cmml" xref="S6.SS2.p1.6.m6.1.1.3">
          𝑟
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S6.SS2.p1.6.m6.1c">
        M_{r}
       </annotation>
      </semantics>
     </math>
     , acting as a surrogate for reinforcement learning aided by gradient-based signals. The specifics of this approach are outlined as follows.
    </p>
   </div>
   <figure class="ltx_figure" id="S6.F3">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="108" id="S6.F3.g1" src="/html/2308.02151/assets/x3.png" width="461"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      Figure 3:
     </span>
     Policy gradient optimization of retrospective LM using RLHF training pipeline.
    </figcaption>
   </figure>
   <section class="ltx_paragraph" id="S6.SS2.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Instruction and Response Generation
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS2.SSS0.Px1.p1">
     <p class="ltx_p" id="S6.SS2.SSS0.Px1.p1.13">
      The retrospective model generates a pair of instruction and response at the end of each trial
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.1.m1.1a">
        <mi id="S6.SS2.SSS0.Px1.p1.1.m1.1.1" xref="S6.SS2.SSS0.Px1.p1.1.m1.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.1.m1.1b">
         <ci id="S6.SS2.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.1.m1.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.1.m1.1c">
         i
        </annotation>
       </semantics>
      </math>
      in the environment
      <math alttext="k" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.2.m2.1a">
        <mi id="S6.SS2.SSS0.Px1.p1.2.m2.1.1" xref="S6.SS2.SSS0.Px1.p1.2.m2.1.1.cmml">
         k
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.2.m2.1b">
         <ci id="S6.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.2.m2.1.1">
          𝑘
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.2.m2.1c">
         k
        </annotation>
       </semantics>
      </math>
      . In the trial
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.3.m3.1a">
        <mi id="S6.SS2.SSS0.Px1.p1.3.m3.1.1" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.3.m3.1b">
         <ci id="S6.SS2.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.3.m3.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.3.m3.1c">
         i
        </annotation>
       </semantics>
      </math>
      , the actor produces a trajectory
      <math alttext="\tau_{i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.4.m4.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.4.m4.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.4.m4.1.1" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.2" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1.2.cmml">
          τ
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.3" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml">
          i
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.4.m4.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1.2">
           𝜏
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.4.m4.1.1.3">
           𝑖
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.4.m4.1c">
         \tau_{i}
        </annotation>
       </semantics>
      </math>
      by interacting with the environment. The evaluator then produces a score
      <math alttext="r_{i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.5.m5.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.5.m5.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.5.m5.1.1" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.2" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1.2.cmml">
          r
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.3" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml">
          i
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.5.m5.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1.2">
           𝑟
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.5.m5.1.1.3">
           𝑖
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.5.m5.1c">
         r_{i}
        </annotation>
       </semantics>
      </math>
      which is computed as
      <math alttext="r_{t}=M_{e}(\tau_{i})" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.6.m6.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.6.m6.1a">
        <mrow id="S6.SS2.SSS0.Px1.p1.6.m6.1.1" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.cmml">
         <msub id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.2" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.2.cmml">
           r
          </mi>
          <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.3" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.3.cmml">
           t
          </mi>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.2" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.2.cmml">
          =
         </mo>
         <mrow id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.cmml">
          <msub id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.2" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.2.cmml">
            M
           </mi>
           <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.3" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.3.cmml">
            e
           </mi>
          </msub>
          <mo id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.2" lspace="0em" rspace="0em" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.2.cmml">
           ​
          </mo>
          <mrow id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.cmml">
           <mo id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.2" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.cmml">
            (
           </mo>
           <msub id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.cmml">
            <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.2" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.2.cmml">
             τ
            </mi>
            <mi id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.3" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.3.cmml">
             i
            </mi>
           </msub>
           <mo id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.3" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.cmml">
            )
           </mo>
          </mrow>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.6.m6.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1">
          <eq id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.2">
          </eq>
          <apply id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.2">
            𝑟
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.3.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.3.3">
            𝑡
           </ci>
          </apply>
          <apply id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1">
           <times id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.2">
           </times>
           <apply id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.2">
             𝑀
            </ci>
            <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.3.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.3.3">
             𝑒
            </ci>
           </apply>
           <apply id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.2">
             𝜏
            </ci>
            <ci id="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.6.m6.1.1.1.1.1.1.3">
             𝑖
            </ci>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.6.m6.1c">
         r_{t}=M_{e}(\tau_{i})
        </annotation>
       </semantics>
      </math>
      . After the trial, to produce verbal feedback for refining the actor prompt,
      <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.7.m7.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.7.m7.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.7.m7.1.1" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.2" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1.2.cmml">
          M
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.3" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1.3.cmml">
          r
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.7.m7.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1.2">
           𝑀
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.7.m7.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.7.m7.1.1.3">
           𝑟
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.7.m7.1c">
         M_{r}
        </annotation>
       </semantics>
      </math>
      takes the set of
      <math alttext="\{\tau_{i},r_{i}\}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.8.m8.2">
       <semantics id="S6.SS2.SSS0.Px1.p1.8.m8.2a">
        <mrow id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.3.cmml">
         <mo id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.3" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.3.cmml">
          {
         </mo>
         <msub id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.2" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.2.cmml">
           τ
          </mi>
          <mi id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.3" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.3.cmml">
           i
          </mi>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.4" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.3.cmml">
          ,
         </mo>
         <msub id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.2.cmml">
           r
          </mi>
          <mi id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.3" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.3.cmml">
           i
          </mi>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.5" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.3.cmml">
          }
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.8.m8.2b">
         <set id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2">
          <apply id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.2">
            𝜏
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.1.1.1.1.3">
            𝑖
           </ci>
          </apply>
          <apply id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.1.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.2">
            𝑟
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.8.m8.2.2.2.2.3">
            𝑖
           </ci>
          </apply>
         </set>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.8.m8.2c">
         \{\tau_{i},r_{i}\}
        </annotation>
       </semantics>
      </math>
      as the instruction
      <math alttext="x_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.9.m9.2">
       <semantics id="S6.SS2.SSS0.Px1.p1.9.m9.2a">
        <msub id="S6.SS2.SSS0.Px1.p1.9.m9.2.3" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.9.m9.2.3.2" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.3.2.cmml">
          x
         </mi>
         <mrow id="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.4" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.9.m9.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.9.m9.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.9.m9.2b">
         <apply id="S6.SS2.SSS0.Px1.p1.9.m9.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.9.m9.2.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.9.m9.2.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.3.2">
           𝑥
          </ci>
          <list id="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px1.p1.9.m9.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.9.m9.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.9.m9.2c">
         x_{k,i}
        </annotation>
       </semantics>
      </math>
      and is prompted to produce a reflection response
      <math alttext="y_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.10.m10.2">
       <semantics id="S6.SS2.SSS0.Px1.p1.10.m10.2a">
        <msub id="S6.SS2.SSS0.Px1.p1.10.m10.2.3" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.10.m10.2.3.2" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.3.2.cmml">
          y
         </mi>
         <mrow id="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.4" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.10.m10.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.10.m10.2b">
         <apply id="S6.SS2.SSS0.Px1.p1.10.m10.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.10.m10.2.3.1.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.10.m10.2.3.2.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.3.2">
           𝑦
          </ci>
          <list id="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px1.p1.10.m10.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.10.m10.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.10.m10.2c">
         y_{k,i}
        </annotation>
       </semantics>
      </math>
      . All these instruction-response pairs
      <math alttext="(x_{k,i},y_{k,i})" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.11.m11.6">
       <semantics id="S6.SS2.SSS0.Px1.p1.11.m11.6a">
        <mrow id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.3.cmml">
         <mo id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.3" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.3.cmml">
          (
         </mo>
         <msub id="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1" xref="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.2.cmml">
           x
          </mi>
          <mrow id="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.4" xref="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.11.m11.1.1.1.1" xref="S6.SS2.SSS0.Px1.p1.11.m11.1.1.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.4.1" xref="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.4" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.3.cmml">
          ,
         </mo>
         <msub id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.cmml">
          <mi id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.2.cmml">
           y
          </mi>
          <mrow id="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.4" xref="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px1.p1.11.m11.3.3.1.1" xref="S6.SS2.SSS0.Px1.p1.11.m11.3.3.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.4.1" xref="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.2" xref="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
         <mo id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.5" stretchy="false" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.3.cmml">
          )
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.11.m11.6b">
         <interval closure="open" id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.3.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2">
          <apply id="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.5.5.1.1.2">
            𝑥
           </ci>
           <list id="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.4">
            <ci id="S6.SS2.SSS0.Px1.p1.11.m11.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.1.1.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.2.2.2.2">
             𝑖
            </ci>
           </list>
          </apply>
          <apply id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.1.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.6.6.2.2.2">
            𝑦
           </ci>
           <list id="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.3.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.4">
            <ci id="S6.SS2.SSS0.Px1.p1.11.m11.3.3.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.3.3.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.2.cmml" xref="S6.SS2.SSS0.Px1.p1.11.m11.4.4.2.2">
             𝑖
            </ci>
           </list>
          </apply>
         </interval>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.11.m11.6c">
         (x_{k,i},y_{k,i})
        </annotation>
       </semantics>
      </math>
      across tasks and trials are stored to a local dataset
      <math alttext="D_{\text{RL}}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.12.m12.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.12.m12.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.12.m12.1.1" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.2" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.2.cmml">
          D
         </mi>
         <mtext id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3a.cmml">
          RL
         </mtext>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.12.m12.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.2">
           𝐷
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3a.cmml" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3">
           <mtext id="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3.cmml" mathsize="70%" xref="S6.SS2.SSS0.Px1.p1.12.m12.1.1.3">
            RL
           </mtext>
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.12.m12.1c">
         D_{\text{RL}}
        </annotation>
       </semantics>
      </math>
      , which we call “replay buffer”, for fine-tuning the
      <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px1.p1.13.m13.1">
       <semantics id="S6.SS2.SSS0.Px1.p1.13.m13.1a">
        <msub id="S6.SS2.SSS0.Px1.p1.13.m13.1.1" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.2" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml">
          M
         </mi>
         <mi id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.3" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1.3.cmml">
          r
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px1.p1.13.m13.1b">
         <apply id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1.2">
           𝑀
          </ci>
          <ci id="S6.SS2.SSS0.Px1.p1.13.m13.1.1.3.cmml" xref="S6.SS2.SSS0.Px1.p1.13.m13.1.1.3">
           𝑟
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px1.p1.13.m13.1c">
         M_{r}
        </annotation>
       </semantics>
      </math>
      at the end of each episode.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS2.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Reflection Response Rating
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS2.SSS0.Px2.p1">
     <p class="ltx_p" id="S6.SS2.SSS0.Px2.p1.13">
      As illustrated in
      <a class="ltx_ref" href="#S6.F2" title="In 6 Our Approach: Reinforcing Retrospective Language Agent ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Fig.
       </span>
       <span class="ltx_text ltx_ref_tag">
        2
       </span>
      </a>
      (b), let us assume a reflection prompt
      <math alttext="x_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.1.m1.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.1.m1.2a">
        <msub id="S6.SS2.SSS0.Px2.p1.1.m1.2.3" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.1.m1.2.3.2" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.3.2.cmml">
          x
         </mi>
         <mrow id="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.1.m1.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.1.m1.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.1.m1.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.1.m1.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.1.m1.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.1.m1.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.3.2">
           𝑥
          </ci>
          <list id="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px2.p1.1.m1.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.1.m1.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.1.m1.2c">
         x_{k,i}
        </annotation>
       </semantics>
      </math>
      and the corresponding episode return
      <math alttext="G_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.2.m2.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.2.m2.2a">
        <msub id="S6.SS2.SSS0.Px2.p1.2.m2.2.3" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.2.m2.2.3.2" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.3.2.cmml">
          G
         </mi>
         <mrow id="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.2.m2.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.2.m2.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.2.m2.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.2.m2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.2.m2.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.2.m2.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.3.2">
           𝐺
          </ci>
          <list id="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px2.p1.2.m2.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.2.m2.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.2.m2.2c">
         G_{k,i}
        </annotation>
       </semantics>
      </math>
      , and the retrospective model
      <math alttext="M_{r}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.3.m3.1a">
        <msub id="S6.SS2.SSS0.Px2.p1.3.m3.1.1" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.2" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml">
          M
         </mi>
         <mi id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.3" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml">
          r
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.3.m3.1b">
         <apply id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1.2">
           𝑀
          </ci>
          <ci id="S6.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="S6.SS2.SSS0.Px2.p1.3.m3.1.1.3">
           𝑟
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.3.m3.1c">
         M_{r}
        </annotation>
       </semantics>
      </math>
      generates the response
      <math alttext="y_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.4.m4.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.4.m4.2a">
        <msub id="S6.SS2.SSS0.Px2.p1.4.m4.2.3" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.4.m4.2.3.2" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.3.2.cmml">
          y
         </mi>
         <mrow id="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.4.m4.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.4.m4.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.4.m4.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.4.m4.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.4.m4.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.4.m4.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.3.2">
           𝑦
          </ci>
          <list id="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px2.p1.4.m4.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.4.m4.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.4.m4.2c">
         y_{k,i}
        </annotation>
       </semantics>
      </math>
      that summarizes the mistakes in
      <math alttext="i" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.5.m5.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.5.m5.1a">
        <mi id="S6.SS2.SSS0.Px2.p1.5.m5.1.1" xref="S6.SS2.SSS0.Px2.p1.5.m5.1.1.cmml">
         i
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.5.m5.1b">
         <ci id="S6.SS2.SSS0.Px2.p1.5.m5.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.5.m5.1.1">
          𝑖
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.5.m5.1c">
         i
        </annotation>
       </semantics>
      </math>
      , which results in the return
      <math alttext="R_{k,i+1}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.6.m6.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.6.m6.2a">
        <msub id="S6.SS2.SSS0.Px2.p1.6.m6.2.3" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.6.m6.2.3.2" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.3.2.cmml">
          R
         </mi>
         <mrow id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.6.m6.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.6.m6.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.3.cmml">
           ,
          </mo>
          <mrow id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.2" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.2.cmml">
            i
           </mi>
           <mo id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.1" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.1.cmml">
            +
           </mo>
           <mn id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.3" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.3.cmml">
            1
           </mn>
          </mrow>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.6.m6.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.6.m6.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.6.m6.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.6.m6.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.3.2">
           𝑅
          </ci>
          <list id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2">
           <ci id="S6.SS2.SSS0.Px2.p1.6.m6.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.1.1.1.1">
            𝑘
           </ci>
           <apply id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1">
            <plus id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.1">
            </plus>
            <ci id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.2">
             𝑖
            </ci>
            <cn id="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.3.cmml" type="integer" xref="S6.SS2.SSS0.Px2.p1.6.m6.2.2.2.2.1.3">
             1
            </cn>
           </apply>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.6.m6.2c">
         R_{k,i+1}
        </annotation>
       </semantics>
      </math>
      in the next attempt
      <math alttext="i+1" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.7.m7.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.7.m7.1a">
        <mrow id="S6.SS2.SSS0.Px2.p1.7.m7.1.1" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.2" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml">
          i
         </mi>
         <mo id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.1" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml">
          +
         </mo>
         <mn id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.3" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.3.cmml">
          1
         </mn>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.7.m7.1b">
         <apply id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1">
          <plus id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.1">
          </plus>
          <ci id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.2">
           𝑖
          </ci>
          <cn id="S6.SS2.SSS0.Px2.p1.7.m7.1.1.3.cmml" type="integer" xref="S6.SS2.SSS0.Px2.p1.7.m7.1.1.3">
           1
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.7.m7.1c">
         i+1
        </annotation>
       </semantics>
      </math>
      . Because the actor is a frozen LM and the temperature is set to zero as default
      <cite class="ltx_cite ltx_citemacro_citep">
       (Yao et al.,
       <a class="ltx_ref" href="#bib.bib25" title="">
        2023
       </a>
       )
      </cite>
      , i.e.,
      <math alttext="T=0" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.8.m8.1">
       <semantics id="S6.SS2.SSS0.Px2.p1.8.m8.1a">
        <mrow id="S6.SS2.SSS0.Px2.p1.8.m8.1.1" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.2" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml">
          T
         </mi>
         <mo id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.1" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml">
          =
         </mo>
         <mn id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.3" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml">
          0
         </mn>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.8.m8.1b">
         <apply id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1">
          <eq id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.1">
          </eq>
          <ci id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.2">
           𝑇
          </ci>
          <cn id="S6.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml" type="integer" xref="S6.SS2.SSS0.Px2.p1.8.m8.1.1.3">
           0
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.8.m8.1c">
         T=0
        </annotation>
       </semantics>
      </math>
      , the injected randomness that leads to differences in returns
      <math alttext="\Delta G_{k,i}=G_{k,i+1}-G_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.9.m9.6">
       <semantics id="S6.SS2.SSS0.Px2.p1.9.m9.6a">
        <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.6.7" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.cmml">
         <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.2" mathvariant="normal" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.2.cmml">
           Δ
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.1" lspace="0em" rspace="0em" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.1.cmml">
           ​
          </mo>
          <msub id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.2.cmml">
            G
           </mi>
           <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.3.cmml">
            <mi id="S6.SS2.SSS0.Px2.p1.9.m9.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.1.1.1.1.cmml">
             k
            </mi>
            <mo id="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.3.cmml">
             ,
            </mo>
            <mi id="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.2.cmml">
             i
            </mi>
           </mrow>
          </msub>
         </mrow>
         <mo id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.1.cmml">
          =
         </mo>
         <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.cmml">
          <msub id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.2.cmml">
            G
           </mi>
           <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.3.cmml">
            <mi id="S6.SS2.SSS0.Px2.p1.9.m9.3.3.1.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.cmml">
             k
            </mi>
            <mo id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.3.cmml">
             ,
            </mo>
            <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.cmml">
             <mi id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.2.cmml">
              i
             </mi>
             <mo id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.1.cmml">
              +
             </mo>
             <mn id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.3" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.3.cmml">
              1
             </mn>
            </mrow>
           </mrow>
          </msub>
          <mo id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.1.cmml">
           −
          </mo>
          <msub id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.2.cmml">
            G
           </mi>
           <mrow id="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.4" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.3.cmml">
            <mi id="S6.SS2.SSS0.Px2.p1.9.m9.5.5.1.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.5.5.1.1.cmml">
             k
            </mi>
            <mo id="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.4.1" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.3.cmml">
             ,
            </mo>
            <mi id="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.2" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.2.cmml">
             i
            </mi>
           </mrow>
          </msub>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.9.m9.6b">
         <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7">
          <eq id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.1">
          </eq>
          <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2">
           <times id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.1">
           </times>
           <ci id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.2">
            Δ
           </ci>
           <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.2.3.2">
             𝐺
            </ci>
            <list id="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.4">
             <ci id="S6.SS2.SSS0.Px2.p1.9.m9.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.1.1.1.1">
              𝑘
             </ci>
             <ci id="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.2.2.2.2">
              𝑖
             </ci>
            </list>
           </apply>
          </apply>
          <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3">
           <minus id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.1">
           </minus>
           <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.2.2">
             𝐺
            </ci>
            <list id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2">
             <ci id="S6.SS2.SSS0.Px2.p1.9.m9.3.3.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.3.3.1.1">
              𝑘
             </ci>
             <apply id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1">
              <plus id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.1">
              </plus>
              <ci id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.2">
               𝑖
              </ci>
              <cn id="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.3.cmml" type="integer" xref="S6.SS2.SSS0.Px2.p1.9.m9.4.4.2.2.1.3">
               1
              </cn>
             </apply>
            </list>
           </apply>
           <apply id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3">
            <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3">
             subscript
            </csymbol>
            <ci id="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.7.3.3.2">
             𝐺
            </ci>
            <list id="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.4">
             <ci id="S6.SS2.SSS0.Px2.p1.9.m9.5.5.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.5.5.1.1">
              𝑘
             </ci>
             <ci id="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.9.m9.6.6.2.2">
              𝑖
             </ci>
            </list>
           </apply>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.9.m9.6c">
         \Delta G_{k,i}=G_{k,i+1}-G_{k,i}
        </annotation>
       </semantics>
      </math>
      are from the reflection responses
      <math alttext="y_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.10.m10.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.10.m10.2a">
        <msub id="S6.SS2.SSS0.Px2.p1.10.m10.2.3" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.10.m10.2.3.2" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.3.2.cmml">
          y
         </mi>
         <mrow id="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.10.m10.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.10.m10.1.1.1.1.cmml">
           k
          </mi>
          <mo id="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.3.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.2.cmml">
           i
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.10.m10.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.10.m10.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.3">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.10.m10.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.3">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px2.p1.10.m10.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.3.2">
           𝑦
          </ci>
          <list id="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.4">
           <ci id="S6.SS2.SSS0.Px2.p1.10.m10.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.1.1.1.1">
            𝑘
           </ci>
           <ci id="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.10.m10.2.2.2.2">
            𝑖
           </ci>
          </list>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.10.m10.2c">
         y_{k,i}
        </annotation>
       </semantics>
      </math>
      , in which positive
      <math alttext="\Delta G_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.11.m11.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.11.m11.2a">
        <mrow id="S6.SS2.SSS0.Px2.p1.11.m11.2.3" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.2" mathvariant="normal" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.2.cmml">
          Δ
         </mi>
         <mo id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.1" lspace="0em" rspace="0em" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.1.cmml">
          ​
         </mo>
         <msub id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.2" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.2.cmml">
           G
          </mi>
          <mrow id="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.11.m11.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.11.m11.1.1.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.11.m11.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3">
          <times id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.1">
          </times>
          <ci id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.2">
           Δ
          </ci>
          <apply id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.3.3.2">
            𝐺
           </ci>
           <list id="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.4">
            <ci id="S6.SS2.SSS0.Px2.p1.11.m11.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.1.1.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.11.m11.2.2.2.2">
             𝑖
            </ci>
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.11.m11.2c">
         \Delta G_{k,i}
        </annotation>
       </semantics>
      </math>
      indicates better responses that help the actor learn from prior errors, and hence should be rated with higher scores; negative or zero
      <math alttext="\Delta G_{k,i}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.12.m12.2">
       <semantics id="S6.SS2.SSS0.Px2.p1.12.m12.2a">
        <mrow id="S6.SS2.SSS0.Px2.p1.12.m12.2.3" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.2" mathvariant="normal" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.2.cmml">
          Δ
         </mi>
         <mo id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.1" lspace="0em" rspace="0em" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.1.cmml">
          ​
         </mo>
         <msub id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.2" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.2.cmml">
           G
          </mi>
          <mrow id="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.12.m12.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.12.m12.1.1.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.12.m12.2b">
         <apply id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3">
          <times id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.1">
          </times>
          <ci id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.2">
           Δ
          </ci>
          <apply id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.1.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.2.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.3.3.2">
            𝐺
           </ci>
           <list id="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.4">
            <ci id="S6.SS2.SSS0.Px2.p1.12.m12.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.1.1.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.12.m12.2.2.2.2">
             𝑖
            </ci>
           </list>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.12.m12.2c">
         \Delta G_{k,i}
        </annotation>
       </semantics>
      </math>
      indicates worse responses that needs to be avoided and hence should be rated with lower scores. Therefore, we define the rating score of a reflection instruction-response pair
      <math alttext="(x_{k,i},y_{k,i})" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px2.p1.13.m13.6">
       <semantics id="S6.SS2.SSS0.Px2.p1.13.m13.6a">
        <mrow id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.3.cmml">
         <mo id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.3" stretchy="false" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.3.cmml">
          (
         </mo>
         <msub id="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1" xref="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.2.cmml">
           x
          </mi>
          <mrow id="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.4" xref="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.13.m13.1.1.1.1" xref="S6.SS2.SSS0.Px2.p1.13.m13.1.1.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.4.1" xref="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
         <mo id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.4" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.3.cmml">
          ,
         </mo>
         <msub id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.cmml">
          <mi id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.2.cmml">
           y
          </mi>
          <mrow id="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.4" xref="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.3.cmml">
           <mi id="S6.SS2.SSS0.Px2.p1.13.m13.3.3.1.1" xref="S6.SS2.SSS0.Px2.p1.13.m13.3.3.1.1.cmml">
            k
           </mi>
           <mo id="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.4.1" xref="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.3.cmml">
            ,
           </mo>
           <mi id="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.2" xref="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.2.cmml">
            i
           </mi>
          </mrow>
         </msub>
         <mo id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.5" stretchy="false" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.3.cmml">
          )
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px2.p1.13.m13.6b">
         <interval closure="open" id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.3.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2">
          <apply id="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.2.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.5.5.1.1.2">
            𝑥
           </ci>
           <list id="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.4">
            <ci id="S6.SS2.SSS0.Px2.p1.13.m13.1.1.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.1.1.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.2.2.2.2">
             𝑖
            </ci>
           </list>
          </apply>
          <apply id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2">
           <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.1.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2">
            subscript
           </csymbol>
           <ci id="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.6.6.2.2.2">
            𝑦
           </ci>
           <list id="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.3.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.4">
            <ci id="S6.SS2.SSS0.Px2.p1.13.m13.3.3.1.1.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.3.3.1.1">
             𝑘
            </ci>
            <ci id="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.2.cmml" xref="S6.SS2.SSS0.Px2.p1.13.m13.4.4.2.2">
             𝑖
            </ci>
           </list>
          </apply>
         </interval>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px2.p1.13.m13.6c">
         (x_{k,i},y_{k,i})
        </annotation>
       </semantics>
      </math>
      as:
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S6.E5">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="r(x_{k,i},y_{k,i})\triangleq G_{k,i+1}-G_{k,i}." class="ltx_Math" display="block" id="S6.E5.m1.9">
          <semantics id="S6.E5.m1.9a">
           <mrow id="S6.E5.m1.9.9.1" xref="S6.E5.m1.9.9.1.1.cmml">
            <mrow id="S6.E5.m1.9.9.1.1" xref="S6.E5.m1.9.9.1.1.cmml">
             <mrow id="S6.E5.m1.9.9.1.1.2" xref="S6.E5.m1.9.9.1.1.2.cmml">
              <mi id="S6.E5.m1.9.9.1.1.2.4" xref="S6.E5.m1.9.9.1.1.2.4.cmml">
               r
              </mi>
              <mo id="S6.E5.m1.9.9.1.1.2.3" lspace="0em" rspace="0em" xref="S6.E5.m1.9.9.1.1.2.3.cmml">
               ​
              </mo>
              <mrow id="S6.E5.m1.9.9.1.1.2.2.2" xref="S6.E5.m1.9.9.1.1.2.2.3.cmml">
               <mo id="S6.E5.m1.9.9.1.1.2.2.2.3" stretchy="false" xref="S6.E5.m1.9.9.1.1.2.2.3.cmml">
                (
               </mo>
               <msub id="S6.E5.m1.9.9.1.1.1.1.1.1" xref="S6.E5.m1.9.9.1.1.1.1.1.1.cmml">
                <mi id="S6.E5.m1.9.9.1.1.1.1.1.1.2" xref="S6.E5.m1.9.9.1.1.1.1.1.1.2.cmml">
                 x
                </mi>
                <mrow id="S6.E5.m1.2.2.2.4" xref="S6.E5.m1.2.2.2.3.cmml">
                 <mi id="S6.E5.m1.1.1.1.1" xref="S6.E5.m1.1.1.1.1.cmml">
                  k
                 </mi>
                 <mo id="S6.E5.m1.2.2.2.4.1" xref="S6.E5.m1.2.2.2.3.cmml">
                  ,
                 </mo>
                 <mi id="S6.E5.m1.2.2.2.2" xref="S6.E5.m1.2.2.2.2.cmml">
                  i
                 </mi>
                </mrow>
               </msub>
               <mo id="S6.E5.m1.9.9.1.1.2.2.2.4" xref="S6.E5.m1.9.9.1.1.2.2.3.cmml">
                ,
               </mo>
               <msub id="S6.E5.m1.9.9.1.1.2.2.2.2" xref="S6.E5.m1.9.9.1.1.2.2.2.2.cmml">
                <mi id="S6.E5.m1.9.9.1.1.2.2.2.2.2" xref="S6.E5.m1.9.9.1.1.2.2.2.2.2.cmml">
                 y
                </mi>
                <mrow id="S6.E5.m1.4.4.2.4" xref="S6.E5.m1.4.4.2.3.cmml">
                 <mi id="S6.E5.m1.3.3.1.1" xref="S6.E5.m1.3.3.1.1.cmml">
                  k
                 </mi>
                 <mo id="S6.E5.m1.4.4.2.4.1" xref="S6.E5.m1.4.4.2.3.cmml">
                  ,
                 </mo>
                 <mi id="S6.E5.m1.4.4.2.2" xref="S6.E5.m1.4.4.2.2.cmml">
                  i
                 </mi>
                </mrow>
               </msub>
               <mo id="S6.E5.m1.9.9.1.1.2.2.2.5" stretchy="false" xref="S6.E5.m1.9.9.1.1.2.2.3.cmml">
                )
               </mo>
              </mrow>
             </mrow>
             <mo id="S6.E5.m1.9.9.1.1.3" xref="S6.E5.m1.9.9.1.1.3.cmml">
              ≜
             </mo>
             <mrow id="S6.E5.m1.9.9.1.1.4" xref="S6.E5.m1.9.9.1.1.4.cmml">
              <msub id="S6.E5.m1.9.9.1.1.4.2" xref="S6.E5.m1.9.9.1.1.4.2.cmml">
               <mi id="S6.E5.m1.9.9.1.1.4.2.2" xref="S6.E5.m1.9.9.1.1.4.2.2.cmml">
                G
               </mi>
               <mrow id="S6.E5.m1.6.6.2.2" xref="S6.E5.m1.6.6.2.3.cmml">
                <mi id="S6.E5.m1.5.5.1.1" xref="S6.E5.m1.5.5.1.1.cmml">
                 k
                </mi>
                <mo id="S6.E5.m1.6.6.2.2.2" xref="S6.E5.m1.6.6.2.3.cmml">
                 ,
                </mo>
                <mrow id="S6.E5.m1.6.6.2.2.1" xref="S6.E5.m1.6.6.2.2.1.cmml">
                 <mi id="S6.E5.m1.6.6.2.2.1.2" xref="S6.E5.m1.6.6.2.2.1.2.cmml">
                  i
                 </mi>
                 <mo id="S6.E5.m1.6.6.2.2.1.1" xref="S6.E5.m1.6.6.2.2.1.1.cmml">
                  +
                 </mo>
                 <mn id="S6.E5.m1.6.6.2.2.1.3" xref="S6.E5.m1.6.6.2.2.1.3.cmml">
                  1
                 </mn>
                </mrow>
               </mrow>
              </msub>
              <mo id="S6.E5.m1.9.9.1.1.4.1" xref="S6.E5.m1.9.9.1.1.4.1.cmml">
               −
              </mo>
              <msub id="S6.E5.m1.9.9.1.1.4.3" xref="S6.E5.m1.9.9.1.1.4.3.cmml">
               <mi id="S6.E5.m1.9.9.1.1.4.3.2" xref="S6.E5.m1.9.9.1.1.4.3.2.cmml">
                G
               </mi>
               <mrow id="S6.E5.m1.8.8.2.4" xref="S6.E5.m1.8.8.2.3.cmml">
                <mi id="S6.E5.m1.7.7.1.1" xref="S6.E5.m1.7.7.1.1.cmml">
                 k
                </mi>
                <mo id="S6.E5.m1.8.8.2.4.1" xref="S6.E5.m1.8.8.2.3.cmml">
                 ,
                </mo>
                <mi id="S6.E5.m1.8.8.2.2" xref="S6.E5.m1.8.8.2.2.cmml">
                 i
                </mi>
               </mrow>
              </msub>
             </mrow>
            </mrow>
            <mo id="S6.E5.m1.9.9.1.2" lspace="0em" xref="S6.E5.m1.9.9.1.1.cmml">
             .
            </mo>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.E5.m1.9b">
            <apply id="S6.E5.m1.9.9.1.1.cmml" xref="S6.E5.m1.9.9.1">
             <ci id="S6.E5.m1.9.9.1.1.3.cmml" xref="S6.E5.m1.9.9.1.1.3">
              ≜
             </ci>
             <apply id="S6.E5.m1.9.9.1.1.2.cmml" xref="S6.E5.m1.9.9.1.1.2">
              <times id="S6.E5.m1.9.9.1.1.2.3.cmml" xref="S6.E5.m1.9.9.1.1.2.3">
              </times>
              <ci id="S6.E5.m1.9.9.1.1.2.4.cmml" xref="S6.E5.m1.9.9.1.1.2.4">
               𝑟
              </ci>
              <interval closure="open" id="S6.E5.m1.9.9.1.1.2.2.3.cmml" xref="S6.E5.m1.9.9.1.1.2.2.2">
               <apply id="S6.E5.m1.9.9.1.1.1.1.1.1.cmml" xref="S6.E5.m1.9.9.1.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S6.E5.m1.9.9.1.1.1.1.1.1.1.cmml" xref="S6.E5.m1.9.9.1.1.1.1.1.1">
                 subscript
                </csymbol>
                <ci id="S6.E5.m1.9.9.1.1.1.1.1.1.2.cmml" xref="S6.E5.m1.9.9.1.1.1.1.1.1.2">
                 𝑥
                </ci>
                <list id="S6.E5.m1.2.2.2.3.cmml" xref="S6.E5.m1.2.2.2.4">
                 <ci id="S6.E5.m1.1.1.1.1.cmml" xref="S6.E5.m1.1.1.1.1">
                  𝑘
                 </ci>
                 <ci id="S6.E5.m1.2.2.2.2.cmml" xref="S6.E5.m1.2.2.2.2">
                  𝑖
                 </ci>
                </list>
               </apply>
               <apply id="S6.E5.m1.9.9.1.1.2.2.2.2.cmml" xref="S6.E5.m1.9.9.1.1.2.2.2.2">
                <csymbol cd="ambiguous" id="S6.E5.m1.9.9.1.1.2.2.2.2.1.cmml" xref="S6.E5.m1.9.9.1.1.2.2.2.2">
                 subscript
                </csymbol>
                <ci id="S6.E5.m1.9.9.1.1.2.2.2.2.2.cmml" xref="S6.E5.m1.9.9.1.1.2.2.2.2.2">
                 𝑦
                </ci>
                <list id="S6.E5.m1.4.4.2.3.cmml" xref="S6.E5.m1.4.4.2.4">
                 <ci id="S6.E5.m1.3.3.1.1.cmml" xref="S6.E5.m1.3.3.1.1">
                  𝑘
                 </ci>
                 <ci id="S6.E5.m1.4.4.2.2.cmml" xref="S6.E5.m1.4.4.2.2">
                  𝑖
                 </ci>
                </list>
               </apply>
              </interval>
             </apply>
             <apply id="S6.E5.m1.9.9.1.1.4.cmml" xref="S6.E5.m1.9.9.1.1.4">
              <minus id="S6.E5.m1.9.9.1.1.4.1.cmml" xref="S6.E5.m1.9.9.1.1.4.1">
              </minus>
              <apply id="S6.E5.m1.9.9.1.1.4.2.cmml" xref="S6.E5.m1.9.9.1.1.4.2">
               <csymbol cd="ambiguous" id="S6.E5.m1.9.9.1.1.4.2.1.cmml" xref="S6.E5.m1.9.9.1.1.4.2">
                subscript
               </csymbol>
               <ci id="S6.E5.m1.9.9.1.1.4.2.2.cmml" xref="S6.E5.m1.9.9.1.1.4.2.2">
                𝐺
               </ci>
               <list id="S6.E5.m1.6.6.2.3.cmml" xref="S6.E5.m1.6.6.2.2">
                <ci id="S6.E5.m1.5.5.1.1.cmml" xref="S6.E5.m1.5.5.1.1">
                 𝑘
                </ci>
                <apply id="S6.E5.m1.6.6.2.2.1.cmml" xref="S6.E5.m1.6.6.2.2.1">
                 <plus id="S6.E5.m1.6.6.2.2.1.1.cmml" xref="S6.E5.m1.6.6.2.2.1.1">
                 </plus>
                 <ci id="S6.E5.m1.6.6.2.2.1.2.cmml" xref="S6.E5.m1.6.6.2.2.1.2">
                  𝑖
                 </ci>
                 <cn id="S6.E5.m1.6.6.2.2.1.3.cmml" type="integer" xref="S6.E5.m1.6.6.2.2.1.3">
                  1
                 </cn>
                </apply>
               </list>
              </apply>
              <apply id="S6.E5.m1.9.9.1.1.4.3.cmml" xref="S6.E5.m1.9.9.1.1.4.3">
               <csymbol cd="ambiguous" id="S6.E5.m1.9.9.1.1.4.3.1.cmml" xref="S6.E5.m1.9.9.1.1.4.3">
                subscript
               </csymbol>
               <ci id="S6.E5.m1.9.9.1.1.4.3.2.cmml" xref="S6.E5.m1.9.9.1.1.4.3.2">
                𝐺
               </ci>
               <list id="S6.E5.m1.8.8.2.3.cmml" xref="S6.E5.m1.8.8.2.4">
                <ci id="S6.E5.m1.7.7.1.1.cmml" xref="S6.E5.m1.7.7.1.1">
                 𝑘
                </ci>
                <ci id="S6.E5.m1.8.8.2.2.cmml" xref="S6.E5.m1.8.8.2.2">
                 𝑖
                </ci>
               </list>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.E5.m1.9c">
            r(x_{k,i},y_{k,i})\triangleq G_{k,i+1}-G_{k,i}.
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (5)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </section>
   <section class="ltx_paragraph" id="S6.SS2.SSS0.Px3">
    <h4 class="ltx_title ltx_title_paragraph">
     Proximal Policy Optimization
    </h4>
    <div class="ltx_para ltx_noindent" id="S6.SS2.SSS0.Px3.p1">
     <p class="ltx_p" id="S6.SS2.SSS0.Px3.p1.5">
      The optimization step of
      <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S6.SS2.SSS0.Px3.p1.5.1">
       Retroformer
      </span>
      is formalized as an iterative process in
      <a class="ltx_ref" href="#S6.F3" title="In 6.2 Policy Gradient Optimization ‣ 6 Our Approach: Reinforcing Retrospective Language Agent ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Fig.
       </span>
       <span class="ltx_text ltx_ref_tag">
        3
       </span>
      </a>
      . We use the differences of episode returns as the ratings of the generated reflection responses. The retrospective language model is fine-tuned at the end of each episode following the standard RLHF training procedures
      <cite class="ltx_cite ltx_citemacro_citep">
       (Ouyang et al.,
       <a class="ltx_ref" href="#bib.bib11" title="">
        2022
       </a>
       )
      </cite>
      with proximal policy optimization:
     </p>
     <table class="ltx_equation ltx_eqn_table" id="S6.E6">
      <tbody>
       <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
        <td class="ltx_eqn_cell ltx_eqn_center_padleft">
        </td>
        <td class="ltx_eqn_cell ltx_align_center">
         <math alttext="\mathcal{L}_{\text{PPO}}=\mathbb{E}_{x\sim D_{\text{RL}}}\mathbb{E}_{y\sim\text{LLM}^{\text{RL}}_{\phi}(x)}\left[r(x,y)-\beta\log\frac{\text{LLM}^{\text{RL}}_{\phi}(y|x)}{\text{LLM}^{\text{Ref}}(y|x)}\right]," class="ltx_Math" display="block" id="S6.E6.m1.6">
          <semantics id="S6.E6.m1.6a">
           <mrow id="S6.E6.m1.6.6.1" xref="S6.E6.m1.6.6.1.1.cmml">
            <mrow id="S6.E6.m1.6.6.1.1" xref="S6.E6.m1.6.6.1.1.cmml">
             <msub id="S6.E6.m1.6.6.1.1.3" xref="S6.E6.m1.6.6.1.1.3.cmml">
              <mi class="ltx_font_mathcaligraphic" id="S6.E6.m1.6.6.1.1.3.2" xref="S6.E6.m1.6.6.1.1.3.2.cmml">
               ℒ
              </mi>
              <mtext id="S6.E6.m1.6.6.1.1.3.3" xref="S6.E6.m1.6.6.1.1.3.3a.cmml">
               PPO
              </mtext>
             </msub>
             <mo id="S6.E6.m1.6.6.1.1.2" xref="S6.E6.m1.6.6.1.1.2.cmml">
              =
             </mo>
             <mrow id="S6.E6.m1.6.6.1.1.1" xref="S6.E6.m1.6.6.1.1.1.cmml">
              <msub id="S6.E6.m1.6.6.1.1.1.3" xref="S6.E6.m1.6.6.1.1.1.3.cmml">
               <mi id="S6.E6.m1.6.6.1.1.1.3.2" xref="S6.E6.m1.6.6.1.1.1.3.2.cmml">
                𝔼
               </mi>
               <mrow id="S6.E6.m1.6.6.1.1.1.3.3" xref="S6.E6.m1.6.6.1.1.1.3.3.cmml">
                <mi id="S6.E6.m1.6.6.1.1.1.3.3.2" xref="S6.E6.m1.6.6.1.1.1.3.3.2.cmml">
                 x
                </mi>
                <mo id="S6.E6.m1.6.6.1.1.1.3.3.1" xref="S6.E6.m1.6.6.1.1.1.3.3.1.cmml">
                 ∼
                </mo>
                <msub id="S6.E6.m1.6.6.1.1.1.3.3.3" xref="S6.E6.m1.6.6.1.1.1.3.3.3.cmml">
                 <mi id="S6.E6.m1.6.6.1.1.1.3.3.3.2" xref="S6.E6.m1.6.6.1.1.1.3.3.3.2.cmml">
                  D
                 </mi>
                 <mtext id="S6.E6.m1.6.6.1.1.1.3.3.3.3" xref="S6.E6.m1.6.6.1.1.1.3.3.3.3a.cmml">
                  RL
                 </mtext>
                </msub>
               </mrow>
              </msub>
              <mo id="S6.E6.m1.6.6.1.1.1.2" lspace="0em" rspace="0em" xref="S6.E6.m1.6.6.1.1.1.2.cmml">
               ​
              </mo>
              <msub id="S6.E6.m1.6.6.1.1.1.4" xref="S6.E6.m1.6.6.1.1.1.4.cmml">
               <mi id="S6.E6.m1.6.6.1.1.1.4.2" xref="S6.E6.m1.6.6.1.1.1.4.2.cmml">
                𝔼
               </mi>
               <mrow id="S6.E6.m1.1.1.1" xref="S6.E6.m1.1.1.1.cmml">
                <mi id="S6.E6.m1.1.1.1.3" xref="S6.E6.m1.1.1.1.3.cmml">
                 y
                </mi>
                <mo id="S6.E6.m1.1.1.1.2" xref="S6.E6.m1.1.1.1.2.cmml">
                 ∼
                </mo>
                <mrow id="S6.E6.m1.1.1.1.4" xref="S6.E6.m1.1.1.1.4.cmml">
                 <msubsup id="S6.E6.m1.1.1.1.4.2" xref="S6.E6.m1.1.1.1.4.2.cmml">
                  <mtext id="S6.E6.m1.1.1.1.4.2.2.2" xref="S6.E6.m1.1.1.1.4.2.2.2a.cmml">
                   LLM
                  </mtext>
                  <mi id="S6.E6.m1.1.1.1.4.2.3" xref="S6.E6.m1.1.1.1.4.2.3.cmml">
                   ϕ
                  </mi>
                  <mtext id="S6.E6.m1.1.1.1.4.2.2.3" xref="S6.E6.m1.1.1.1.4.2.2.3a.cmml">
                   RL
                  </mtext>
                 </msubsup>
                 <mo id="S6.E6.m1.1.1.1.4.1" lspace="0em" rspace="0em" xref="S6.E6.m1.1.1.1.4.1.cmml">
                  ​
                 </mo>
                 <mrow id="S6.E6.m1.1.1.1.4.3.2" xref="S6.E6.m1.1.1.1.4.cmml">
                  <mo id="S6.E6.m1.1.1.1.4.3.2.1" stretchy="false" xref="S6.E6.m1.1.1.1.4.cmml">
                   (
                  </mo>
                  <mi id="S6.E6.m1.1.1.1.1" xref="S6.E6.m1.1.1.1.1.cmml">
                   x
                  </mi>
                  <mo id="S6.E6.m1.1.1.1.4.3.2.2" stretchy="false" xref="S6.E6.m1.1.1.1.4.cmml">
                   )
                  </mo>
                 </mrow>
                </mrow>
               </mrow>
              </msub>
              <mo id="S6.E6.m1.6.6.1.1.1.2a" lspace="0em" rspace="0em" xref="S6.E6.m1.6.6.1.1.1.2.cmml">
               ​
              </mo>
              <mrow id="S6.E6.m1.6.6.1.1.1.1.1" xref="S6.E6.m1.6.6.1.1.1.1.2.cmml">
               <mo id="S6.E6.m1.6.6.1.1.1.1.1.2" xref="S6.E6.m1.6.6.1.1.1.1.2.1.cmml">
                [
               </mo>
               <mrow id="S6.E6.m1.6.6.1.1.1.1.1.1" xref="S6.E6.m1.6.6.1.1.1.1.1.1.cmml">
                <mrow id="S6.E6.m1.6.6.1.1.1.1.1.1.2" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.cmml">
                 <mi id="S6.E6.m1.6.6.1.1.1.1.1.1.2.2" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.2.cmml">
                  r
                 </mi>
                 <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.2.1" lspace="0em" rspace="0em" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.1.cmml">
                  ​
                 </mo>
                 <mrow id="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.2" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.1.cmml">
                  <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.2.1" stretchy="false" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.1.cmml">
                   (
                  </mo>
                  <mi id="S6.E6.m1.4.4" xref="S6.E6.m1.4.4.cmml">
                   x
                  </mi>
                  <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.2.2" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.1.cmml">
                   ,
                  </mo>
                  <mi id="S6.E6.m1.5.5" xref="S6.E6.m1.5.5.cmml">
                   y
                  </mi>
                  <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.2.3" stretchy="false" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.1.cmml">
                   )
                  </mo>
                 </mrow>
                </mrow>
                <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.1" xref="S6.E6.m1.6.6.1.1.1.1.1.1.1.cmml">
                 −
                </mo>
                <mrow id="S6.E6.m1.6.6.1.1.1.1.1.1.3" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.cmml">
                 <mi id="S6.E6.m1.6.6.1.1.1.1.1.1.3.2" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.2.cmml">
                  β
                 </mi>
                 <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.3.1" lspace="0.167em" rspace="0em" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.1.cmml">
                  ​
                 </mo>
                 <mrow id="S6.E6.m1.6.6.1.1.1.1.1.1.3.3" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.cmml">
                  <mi id="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.1" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.1.cmml">
                   log
                  </mi>
                  <mo id="S6.E6.m1.6.6.1.1.1.1.1.1.3.3a" lspace="0.167em" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.cmml">
                   ⁡
                  </mo>
                  <mfrac id="S6.E6.m1.3.3" xref="S6.E6.m1.3.3.cmml">
                   <mrow id="S6.E6.m1.2.2.1" xref="S6.E6.m1.2.2.1.cmml">
                    <msubsup id="S6.E6.m1.2.2.1.3" xref="S6.E6.m1.2.2.1.3.cmml">
                     <mtext id="S6.E6.m1.2.2.1.3.2.2" xref="S6.E6.m1.2.2.1.3.2.2a.cmml">
                      LLM
                     </mtext>
                     <mi id="S6.E6.m1.2.2.1.3.3" xref="S6.E6.m1.2.2.1.3.3.cmml">
                      ϕ
                     </mi>
                     <mtext id="S6.E6.m1.2.2.1.3.2.3" xref="S6.E6.m1.2.2.1.3.2.3a.cmml">
                      RL
                     </mtext>
                    </msubsup>
                    <mo id="S6.E6.m1.2.2.1.2" lspace="0em" rspace="0em" xref="S6.E6.m1.2.2.1.2.cmml">
                     ​
                    </mo>
                    <mrow id="S6.E6.m1.2.2.1.1.1" xref="S6.E6.m1.2.2.1.1.1.1.cmml">
                     <mo id="S6.E6.m1.2.2.1.1.1.2" stretchy="false" xref="S6.E6.m1.2.2.1.1.1.1.cmml">
                      (
                     </mo>
                     <mrow id="S6.E6.m1.2.2.1.1.1.1" xref="S6.E6.m1.2.2.1.1.1.1.cmml">
                      <mi id="S6.E6.m1.2.2.1.1.1.1.2" xref="S6.E6.m1.2.2.1.1.1.1.2.cmml">
                       y
                      </mi>
                      <mo fence="false" id="S6.E6.m1.2.2.1.1.1.1.1" xref="S6.E6.m1.2.2.1.1.1.1.1.cmml">
                       |
                      </mo>
                      <mi id="S6.E6.m1.2.2.1.1.1.1.3" xref="S6.E6.m1.2.2.1.1.1.1.3.cmml">
                       x
                      </mi>
                     </mrow>
                     <mo id="S6.E6.m1.2.2.1.1.1.3" stretchy="false" xref="S6.E6.m1.2.2.1.1.1.1.cmml">
                      )
                     </mo>
                    </mrow>
                   </mrow>
                   <mrow id="S6.E6.m1.3.3.2" xref="S6.E6.m1.3.3.2.cmml">
                    <msup id="S6.E6.m1.3.3.2.3" xref="S6.E6.m1.3.3.2.3.cmml">
                     <mtext id="S6.E6.m1.3.3.2.3.2" xref="S6.E6.m1.3.3.2.3.2a.cmml">
                      LLM
                     </mtext>
                     <mtext id="S6.E6.m1.3.3.2.3.3" xref="S6.E6.m1.3.3.2.3.3a.cmml">
                      Ref
                     </mtext>
                    </msup>
                    <mo id="S6.E6.m1.3.3.2.2" lspace="0em" rspace="0em" xref="S6.E6.m1.3.3.2.2.cmml">
                     ​
                    </mo>
                    <mrow id="S6.E6.m1.3.3.2.1.1" xref="S6.E6.m1.3.3.2.1.1.1.cmml">
                     <mo id="S6.E6.m1.3.3.2.1.1.2" stretchy="false" xref="S6.E6.m1.3.3.2.1.1.1.cmml">
                      (
                     </mo>
                     <mrow id="S6.E6.m1.3.3.2.1.1.1" xref="S6.E6.m1.3.3.2.1.1.1.cmml">
                      <mi id="S6.E6.m1.3.3.2.1.1.1.2" xref="S6.E6.m1.3.3.2.1.1.1.2.cmml">
                       y
                      </mi>
                      <mo fence="false" id="S6.E6.m1.3.3.2.1.1.1.1" xref="S6.E6.m1.3.3.2.1.1.1.1.cmml">
                       |
                      </mo>
                      <mi id="S6.E6.m1.3.3.2.1.1.1.3" xref="S6.E6.m1.3.3.2.1.1.1.3.cmml">
                       x
                      </mi>
                     </mrow>
                     <mo id="S6.E6.m1.3.3.2.1.1.3" stretchy="false" xref="S6.E6.m1.3.3.2.1.1.1.cmml">
                      )
                     </mo>
                    </mrow>
                   </mrow>
                  </mfrac>
                 </mrow>
                </mrow>
               </mrow>
               <mo id="S6.E6.m1.6.6.1.1.1.1.1.3" xref="S6.E6.m1.6.6.1.1.1.1.2.1.cmml">
                ]
               </mo>
              </mrow>
             </mrow>
            </mrow>
            <mo id="S6.E6.m1.6.6.1.2" xref="S6.E6.m1.6.6.1.1.cmml">
             ,
            </mo>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="S6.E6.m1.6b">
            <apply id="S6.E6.m1.6.6.1.1.cmml" xref="S6.E6.m1.6.6.1">
             <eq id="S6.E6.m1.6.6.1.1.2.cmml" xref="S6.E6.m1.6.6.1.1.2">
             </eq>
             <apply id="S6.E6.m1.6.6.1.1.3.cmml" xref="S6.E6.m1.6.6.1.1.3">
              <csymbol cd="ambiguous" id="S6.E6.m1.6.6.1.1.3.1.cmml" xref="S6.E6.m1.6.6.1.1.3">
               subscript
              </csymbol>
              <ci id="S6.E6.m1.6.6.1.1.3.2.cmml" xref="S6.E6.m1.6.6.1.1.3.2">
               ℒ
              </ci>
              <ci id="S6.E6.m1.6.6.1.1.3.3a.cmml" xref="S6.E6.m1.6.6.1.1.3.3">
               <mtext id="S6.E6.m1.6.6.1.1.3.3.cmml" mathsize="70%" xref="S6.E6.m1.6.6.1.1.3.3">
                PPO
               </mtext>
              </ci>
             </apply>
             <apply id="S6.E6.m1.6.6.1.1.1.cmml" xref="S6.E6.m1.6.6.1.1.1">
              <times id="S6.E6.m1.6.6.1.1.1.2.cmml" xref="S6.E6.m1.6.6.1.1.1.2">
              </times>
              <apply id="S6.E6.m1.6.6.1.1.1.3.cmml" xref="S6.E6.m1.6.6.1.1.1.3">
               <csymbol cd="ambiguous" id="S6.E6.m1.6.6.1.1.1.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.3">
                subscript
               </csymbol>
               <ci id="S6.E6.m1.6.6.1.1.1.3.2.cmml" xref="S6.E6.m1.6.6.1.1.1.3.2">
                𝔼
               </ci>
               <apply id="S6.E6.m1.6.6.1.1.1.3.3.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3">
                <csymbol cd="latexml" id="S6.E6.m1.6.6.1.1.1.3.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.1">
                 similar-to
                </csymbol>
                <ci id="S6.E6.m1.6.6.1.1.1.3.3.2.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.2">
                 𝑥
                </ci>
                <apply id="S6.E6.m1.6.6.1.1.1.3.3.3.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.3">
                 <csymbol cd="ambiguous" id="S6.E6.m1.6.6.1.1.1.3.3.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.3">
                  subscript
                 </csymbol>
                 <ci id="S6.E6.m1.6.6.1.1.1.3.3.3.2.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.3.2">
                  𝐷
                 </ci>
                 <ci id="S6.E6.m1.6.6.1.1.1.3.3.3.3a.cmml" xref="S6.E6.m1.6.6.1.1.1.3.3.3.3">
                  <mtext id="S6.E6.m1.6.6.1.1.1.3.3.3.3.cmml" mathsize="50%" xref="S6.E6.m1.6.6.1.1.1.3.3.3.3">
                   RL
                  </mtext>
                 </ci>
                </apply>
               </apply>
              </apply>
              <apply id="S6.E6.m1.6.6.1.1.1.4.cmml" xref="S6.E6.m1.6.6.1.1.1.4">
               <csymbol cd="ambiguous" id="S6.E6.m1.6.6.1.1.1.4.1.cmml" xref="S6.E6.m1.6.6.1.1.1.4">
                subscript
               </csymbol>
               <ci id="S6.E6.m1.6.6.1.1.1.4.2.cmml" xref="S6.E6.m1.6.6.1.1.1.4.2">
                𝔼
               </ci>
               <apply id="S6.E6.m1.1.1.1.cmml" xref="S6.E6.m1.1.1.1">
                <csymbol cd="latexml" id="S6.E6.m1.1.1.1.2.cmml" xref="S6.E6.m1.1.1.1.2">
                 similar-to
                </csymbol>
                <ci id="S6.E6.m1.1.1.1.3.cmml" xref="S6.E6.m1.1.1.1.3">
                 𝑦
                </ci>
                <apply id="S6.E6.m1.1.1.1.4.cmml" xref="S6.E6.m1.1.1.1.4">
                 <times id="S6.E6.m1.1.1.1.4.1.cmml" xref="S6.E6.m1.1.1.1.4.1">
                 </times>
                 <apply id="S6.E6.m1.1.1.1.4.2.cmml" xref="S6.E6.m1.1.1.1.4.2">
                  <csymbol cd="ambiguous" id="S6.E6.m1.1.1.1.4.2.1.cmml" xref="S6.E6.m1.1.1.1.4.2">
                   subscript
                  </csymbol>
                  <apply id="S6.E6.m1.1.1.1.4.2.2.cmml" xref="S6.E6.m1.1.1.1.4.2">
                   <csymbol cd="ambiguous" id="S6.E6.m1.1.1.1.4.2.2.1.cmml" xref="S6.E6.m1.1.1.1.4.2">
                    superscript
                   </csymbol>
                   <ci id="S6.E6.m1.1.1.1.4.2.2.2a.cmml" xref="S6.E6.m1.1.1.1.4.2.2.2">
                    <mtext id="S6.E6.m1.1.1.1.4.2.2.2.cmml" mathsize="70%" xref="S6.E6.m1.1.1.1.4.2.2.2">
                     LLM
                    </mtext>
                   </ci>
                   <ci id="S6.E6.m1.1.1.1.4.2.2.3a.cmml" xref="S6.E6.m1.1.1.1.4.2.2.3">
                    <mtext id="S6.E6.m1.1.1.1.4.2.2.3.cmml" mathsize="50%" xref="S6.E6.m1.1.1.1.4.2.2.3">
                     RL
                    </mtext>
                   </ci>
                  </apply>
                  <ci id="S6.E6.m1.1.1.1.4.2.3.cmml" xref="S6.E6.m1.1.1.1.4.2.3">
                   italic-ϕ
                  </ci>
                 </apply>
                 <ci id="S6.E6.m1.1.1.1.1.cmml" xref="S6.E6.m1.1.1.1.1">
                  𝑥
                 </ci>
                </apply>
               </apply>
              </apply>
              <apply id="S6.E6.m1.6.6.1.1.1.1.2.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1">
               <csymbol cd="latexml" id="S6.E6.m1.6.6.1.1.1.1.2.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.2">
                delimited-[]
               </csymbol>
               <apply id="S6.E6.m1.6.6.1.1.1.1.1.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1">
                <minus id="S6.E6.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.1">
                </minus>
                <apply id="S6.E6.m1.6.6.1.1.1.1.1.1.2.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2">
                 <times id="S6.E6.m1.6.6.1.1.1.1.1.1.2.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.1">
                 </times>
                 <ci id="S6.E6.m1.6.6.1.1.1.1.1.1.2.2.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.2">
                  𝑟
                 </ci>
                 <interval closure="open" id="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.2.3.2">
                  <ci id="S6.E6.m1.4.4.cmml" xref="S6.E6.m1.4.4">
                   𝑥
                  </ci>
                  <ci id="S6.E6.m1.5.5.cmml" xref="S6.E6.m1.5.5">
                   𝑦
                  </ci>
                 </interval>
                </apply>
                <apply id="S6.E6.m1.6.6.1.1.1.1.1.1.3.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3">
                 <times id="S6.E6.m1.6.6.1.1.1.1.1.1.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.1">
                 </times>
                 <ci id="S6.E6.m1.6.6.1.1.1.1.1.1.3.2.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.2">
                  𝛽
                 </ci>
                 <apply id="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.3">
                  <log id="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.1.cmml" xref="S6.E6.m1.6.6.1.1.1.1.1.1.3.3.1">
                  </log>
                  <apply id="S6.E6.m1.3.3.cmml" xref="S6.E6.m1.3.3">
                   <divide id="S6.E6.m1.3.3.3.cmml" xref="S6.E6.m1.3.3">
                   </divide>
                   <apply id="S6.E6.m1.2.2.1.cmml" xref="S6.E6.m1.2.2.1">
                    <times id="S6.E6.m1.2.2.1.2.cmml" xref="S6.E6.m1.2.2.1.2">
                    </times>
                    <apply id="S6.E6.m1.2.2.1.3.cmml" xref="S6.E6.m1.2.2.1.3">
                     <csymbol cd="ambiguous" id="S6.E6.m1.2.2.1.3.1.cmml" xref="S6.E6.m1.2.2.1.3">
                      subscript
                     </csymbol>
                     <apply id="S6.E6.m1.2.2.1.3.2.cmml" xref="S6.E6.m1.2.2.1.3">
                      <csymbol cd="ambiguous" id="S6.E6.m1.2.2.1.3.2.1.cmml" xref="S6.E6.m1.2.2.1.3">
                       superscript
                      </csymbol>
                      <ci id="S6.E6.m1.2.2.1.3.2.2a.cmml" xref="S6.E6.m1.2.2.1.3.2.2">
                       <mtext id="S6.E6.m1.2.2.1.3.2.2.cmml" xref="S6.E6.m1.2.2.1.3.2.2">
                        LLM
                       </mtext>
                      </ci>
                      <ci id="S6.E6.m1.2.2.1.3.2.3a.cmml" xref="S6.E6.m1.2.2.1.3.2.3">
                       <mtext id="S6.E6.m1.2.2.1.3.2.3.cmml" mathsize="70%" xref="S6.E6.m1.2.2.1.3.2.3">
                        RL
                       </mtext>
                      </ci>
                     </apply>
                     <ci id="S6.E6.m1.2.2.1.3.3.cmml" xref="S6.E6.m1.2.2.1.3.3">
                      italic-ϕ
                     </ci>
                    </apply>
                    <apply id="S6.E6.m1.2.2.1.1.1.1.cmml" xref="S6.E6.m1.2.2.1.1.1">
                     <csymbol cd="latexml" id="S6.E6.m1.2.2.1.1.1.1.1.cmml" xref="S6.E6.m1.2.2.1.1.1.1.1">
                      conditional
                     </csymbol>
                     <ci id="S6.E6.m1.2.2.1.1.1.1.2.cmml" xref="S6.E6.m1.2.2.1.1.1.1.2">
                      𝑦
                     </ci>
                     <ci id="S6.E6.m1.2.2.1.1.1.1.3.cmml" xref="S6.E6.m1.2.2.1.1.1.1.3">
                      𝑥
                     </ci>
                    </apply>
                   </apply>
                   <apply id="S6.E6.m1.3.3.2.cmml" xref="S6.E6.m1.3.3.2">
                    <times id="S6.E6.m1.3.3.2.2.cmml" xref="S6.E6.m1.3.3.2.2">
                    </times>
                    <apply id="S6.E6.m1.3.3.2.3.cmml" xref="S6.E6.m1.3.3.2.3">
                     <csymbol cd="ambiguous" id="S6.E6.m1.3.3.2.3.1.cmml" xref="S6.E6.m1.3.3.2.3">
                      superscript
                     </csymbol>
                     <ci id="S6.E6.m1.3.3.2.3.2a.cmml" xref="S6.E6.m1.3.3.2.3.2">
                      <mtext id="S6.E6.m1.3.3.2.3.2.cmml" xref="S6.E6.m1.3.3.2.3.2">
                       LLM
                      </mtext>
                     </ci>
                     <ci id="S6.E6.m1.3.3.2.3.3a.cmml" xref="S6.E6.m1.3.3.2.3.3">
                      <mtext id="S6.E6.m1.3.3.2.3.3.cmml" mathsize="70%" xref="S6.E6.m1.3.3.2.3.3">
                       Ref
                      </mtext>
                     </ci>
                    </apply>
                    <apply id="S6.E6.m1.3.3.2.1.1.1.cmml" xref="S6.E6.m1.3.3.2.1.1">
                     <csymbol cd="latexml" id="S6.E6.m1.3.3.2.1.1.1.1.cmml" xref="S6.E6.m1.3.3.2.1.1.1.1">
                      conditional
                     </csymbol>
                     <ci id="S6.E6.m1.3.3.2.1.1.1.2.cmml" xref="S6.E6.m1.3.3.2.1.1.1.2">
                      𝑦
                     </ci>
                     <ci id="S6.E6.m1.3.3.2.1.1.1.3.cmml" xref="S6.E6.m1.3.3.2.1.1.1.3">
                      𝑥
                     </ci>
                    </apply>
                   </apply>
                  </apply>
                 </apply>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="S6.E6.m1.6c">
            \mathcal{L}_{\text{PPO}}=\mathbb{E}_{x\sim D_{\text{RL}}}\mathbb{E}_{y\sim\text{LLM}^{\text{RL}}_{\phi}(x)}\left[r(x,y)-\beta\log\frac{\text{LLM}^{\text{RL}}_{\phi}(y|x)}{\text{LLM}^{\text{Ref}}(y|x)}\right],
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_eqn_cell ltx_eqn_center_padright">
        </td>
        <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
         <span class="ltx_tag ltx_tag_equation ltx_align_right">
          (6)
         </span>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="ltx_p" id="S6.SS2.SSS0.Px3.p1.4">
      where
      <math alttext="(x,y)" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p1.1.m1.2">
       <semantics id="S6.SS2.SSS0.Px3.p1.1.m1.2a">
        <mrow id="S6.SS2.SSS0.Px3.p1.1.m1.2.3.2" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.3.1.cmml">
         <mo id="S6.SS2.SSS0.Px3.p1.1.m1.2.3.2.1" stretchy="false" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.3.1.cmml">
          (
         </mo>
         <mi id="S6.SS2.SSS0.Px3.p1.1.m1.1.1" xref="S6.SS2.SSS0.Px3.p1.1.m1.1.1.cmml">
          x
         </mi>
         <mo id="S6.SS2.SSS0.Px3.p1.1.m1.2.3.2.2" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.3.1.cmml">
          ,
         </mo>
         <mi id="S6.SS2.SSS0.Px3.p1.1.m1.2.2" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.2.cmml">
          y
         </mi>
         <mo id="S6.SS2.SSS0.Px3.p1.1.m1.2.3.2.3" stretchy="false" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.3.1.cmml">
          )
         </mo>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p1.1.m1.2b">
         <interval closure="open" id="S6.SS2.SSS0.Px3.p1.1.m1.2.3.1.cmml" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.3.2">
          <ci id="S6.SS2.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.1.m1.1.1">
           𝑥
          </ci>
          <ci id="S6.SS2.SSS0.Px3.p1.1.m1.2.2.cmml" xref="S6.SS2.SSS0.Px3.p1.1.m1.2.2">
           𝑦
          </ci>
         </interval>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p1.1.m1.2c">
         (x,y)
        </annotation>
       </semantics>
      </math>
      are sampled from the replay buffer,
      <math alttext="r(x,y)" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p1.2.m2.2">
       <semantics id="S6.SS2.SSS0.Px3.p1.2.m2.2a">
        <mrow id="S6.SS2.SSS0.Px3.p1.2.m2.2.3" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.cmml">
         <mi id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.2" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.2.cmml">
          r
         </mi>
         <mo id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.1" lspace="0em" rspace="0em" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.1.cmml">
          ​
         </mo>
         <mrow id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.2" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.1.cmml">
          <mo id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.2.1" stretchy="false" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.1.cmml">
           (
          </mo>
          <mi id="S6.SS2.SSS0.Px3.p1.2.m2.1.1" xref="S6.SS2.SSS0.Px3.p1.2.m2.1.1.cmml">
           x
          </mi>
          <mo id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.2.2" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.1.cmml">
           ,
          </mo>
          <mi id="S6.SS2.SSS0.Px3.p1.2.m2.2.2" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.2.cmml">
           y
          </mi>
          <mo id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.2.3" stretchy="false" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.1.cmml">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p1.2.m2.2b">
         <apply id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3">
          <times id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.1.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.1">
          </times>
          <ci id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.2.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.2">
           𝑟
          </ci>
          <interval closure="open" id="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.1.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.3.3.2">
           <ci id="S6.SS2.SSS0.Px3.p1.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.1.1">
            𝑥
           </ci>
           <ci id="S6.SS2.SSS0.Px3.p1.2.m2.2.2.cmml" xref="S6.SS2.SSS0.Px3.p1.2.m2.2.2">
            𝑦
           </ci>
          </interval>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p1.2.m2.2c">
         r(x,y)
        </annotation>
       </semantics>
      </math>
      is the defined reward model, and the second term in this objective is the KL divergence to make sure that the fine-tuned model
      <math alttext="\text{LLM}^{\text{RL}}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p1.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px3.p1.3.m3.1a">
        <msup id="S6.SS2.SSS0.Px3.p1.3.m3.1.1" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.cmml">
         <mtext id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2a.cmml">
          LLM
         </mtext>
         <mtext id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3a.cmml">
          RL
         </mtext>
        </msup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p1.3.m3.1b">
         <apply id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1">
           superscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2a.cmml" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2">
           <mtext id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2.cmml" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.2">
            LLM
           </mtext>
          </ci>
          <ci id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3a.cmml" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3">
           <mtext id="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S6.SS2.SSS0.Px3.p1.3.m3.1.1.3">
            RL
           </mtext>
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p1.3.m3.1c">
         \text{LLM}^{\text{RL}}
        </annotation>
       </semantics>
      </math>
      does not stray too far from the frozen reference model
      <math alttext="\text{LLM}^{\text{Ref}}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p1.4.m4.1">
       <semantics id="S6.SS2.SSS0.Px3.p1.4.m4.1a">
        <msup id="S6.SS2.SSS0.Px3.p1.4.m4.1.1" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.cmml">
         <mtext id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2a.cmml">
          LLM
         </mtext>
         <mtext id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3a.cmml">
          Ref
         </mtext>
        </msup>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p1.4.m4.1b">
         <apply id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1">
           superscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2a.cmml" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2">
           <mtext id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2.cmml" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.2">
            LLM
           </mtext>
          </ci>
          <ci id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3a.cmml" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3">
           <mtext id="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3.cmml" mathsize="70%" xref="S6.SS2.SSS0.Px3.p1.4.m4.1.1.3">
            Ref
           </mtext>
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p1.4.m4.1c">
         \text{LLM}^{\text{Ref}}
        </annotation>
       </semantics>
      </math>
      .
     </p>
    </div>
    <div class="ltx_para ltx_noindent" id="S6.SS2.SSS0.Px3.p2">
     <p class="ltx_p" id="S6.SS2.SSS0.Px3.p2.4">
      The actor and retrospective model, and the policy gradient optimization module work together through trials in a loop until the environment deems
      <math alttext="\tau_{t}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p2.1.m1.1">
       <semantics id="S6.SS2.SSS0.Px3.p2.1.m1.1a">
        <msub id="S6.SS2.SSS0.Px3.p2.1.m1.1.1" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.2" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1.2.cmml">
          τ
         </mi>
         <mi id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.3" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1.3.cmml">
          t
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p2.1.m1.1b">
         <apply id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.2.cmml" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1.2">
           𝜏
          </ci>
          <ci id="S6.SS2.SSS0.Px3.p2.1.m1.1.1.3.cmml" xref="S6.SS2.SSS0.Px3.p2.1.m1.1.1.3">
           𝑡
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p2.1.m1.1c">
         \tau_{t}
        </annotation>
       </semantics>
      </math>
      to be correct. In practice, we apply offline RL methods instead of online optimization. We collected the dataset
      <math alttext="D_{\text{RL}}" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p2.2.m2.1">
       <semantics id="S6.SS2.SSS0.Px3.p2.2.m2.1a">
        <msub id="S6.SS2.SSS0.Px3.p2.2.m2.1.1" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.cmml">
         <mi id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.2" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.2.cmml">
          D
         </mi>
         <mtext id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3a.cmml">
          RL
         </mtext>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p2.2.m2.1b">
         <apply id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1">
          <csymbol cd="ambiguous" id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1">
           subscript
          </csymbol>
          <ci id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.2.cmml" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.2">
           𝐷
          </ci>
          <ci id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3a.cmml" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3">
           <mtext id="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3.cmml" mathsize="70%" xref="S6.SS2.SSS0.Px3.p2.2.m2.1.1.3">
            RL
           </mtext>
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p2.2.m2.1c">
         D_{\text{RL}}
        </annotation>
       </semantics>
      </math>
      by rolling out a base policy, i.e., the frozen actor LM and the initialized retrospective LM, in the tasks in the training sets for
      <math alttext="N" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p2.3.m3.1">
       <semantics id="S6.SS2.SSS0.Px3.p2.3.m3.1a">
        <mi id="S6.SS2.SSS0.Px3.p2.3.m3.1.1" xref="S6.SS2.SSS0.Px3.p2.3.m3.1.1.cmml">
         N
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p2.3.m3.1b">
         <ci id="S6.SS2.SSS0.Px3.p2.3.m3.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.3.m3.1.1">
          𝑁
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p2.3.m3.1c">
         N
        </annotation>
       </semantics>
      </math>
      trials and compute the ratings. We apply the standard RLHF pipeline to fine-tune the retrospective model offline before evaluating the agent in the validation tasks. In online execution, we use best-of-
      <math alttext="n" class="ltx_Math" display="inline" id="S6.SS2.SSS0.Px3.p2.4.m4.1">
       <semantics id="S6.SS2.SSS0.Px3.p2.4.m4.1a">
        <mi id="S6.SS2.SSS0.Px3.p2.4.m4.1.1" xref="S6.SS2.SSS0.Px3.p2.4.m4.1.1.cmml">
         n
        </mi>
        <annotation-xml encoding="MathML-Content" id="S6.SS2.SSS0.Px3.p2.4.m4.1b">
         <ci id="S6.SS2.SSS0.Px3.p2.4.m4.1.1.cmml" xref="S6.SS2.SSS0.Px3.p2.4.m4.1.1">
          𝑛
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S6.SS2.SSS0.Px3.p2.4.m4.1c">
         n
        </annotation>
       </semantics>
      </math>
      sampler, with the scores evaluated by the learned reward model from RLHF pipeline, as an alternative method of generating better retrospective responses in each trial.
     </p>
    </div>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S7">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    7
   </span>
   Experiments
  </h2>
  <div class="ltx_para ltx_noindent" id="S7.p1">
   <p class="ltx_p" id="S7.p1.1">
    Extensive experiments are conducted to evaluate our method, including comparisons with ReAct and Reflexion performances, and visualization and discussion of agent’s generated text and actions.
   </p>
  </div>
  <section class="ltx_subsection" id="S7.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     7.1
    </span>
    Environment and Dataset
   </h3>
   <div class="ltx_para ltx_noindent" id="S7.SS1.p1">
    <p class="ltx_p" id="S7.SS1.p1.1">
     We use open-source HotPotQA
     <cite class="ltx_cite ltx_citemacro_citep">
      (Yang et al.,
      <a class="ltx_ref" href="#bib.bib24" title="">
       2018
      </a>
      )
     </cite>
     environment, which consists of search-based question answering tasks to evaluate the agent’s tool usage abilities under large state-action space.
    </p>
   </div>
   <section class="ltx_paragraph" id="S7.SS1.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     HotPotQA
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS1.SSS0.Px1.p1">
     <p class="ltx_p" id="S7.SS1.SSS0.Px1.p1.1">
      The agent is asked to solve a question answering task by searching in Wikipedia pages. At each time step, the agent is asked to choose from three action types or API calls:
     </p>
     <ol class="ltx_enumerate" id="S7.I1">
      <li class="ltx_item" id="S7.I1.i1" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        1.
       </span>
       <div class="ltx_para ltx_noindent" id="S7.I1.i1.p1">
        <p class="ltx_p" id="S7.I1.i1.p1.1">
         <span class="ltx_text ltx_font_smallcaps" id="S7.I1.i1.p1.1.1">
          Search[entity]
         </span>
         , which searches the exact entity on Wikipedia and returns the first paragraph if it exists. If not, it will return some similar entities to search.
        </p>
       </div>
      </li>
      <li class="ltx_item" id="S7.I1.i2" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        2.
       </span>
       <div class="ltx_para ltx_noindent" id="S7.I1.i2.p1">
        <p class="ltx_p" id="S7.I1.i2.p1.1">
         <span class="ltx_text ltx_font_smallcaps" id="S7.I1.i2.p1.1.1">
          Lookup[keyword]
         </span>
         , which returns the next sentence containing keyword in the last passage successfully found by Search.
        </p>
       </div>
      </li>
      <li class="ltx_item" id="S7.I1.i3" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        3.
       </span>
       <div class="ltx_para ltx_noindent" id="S7.I1.i3.p1">
        <p class="ltx_p" id="S7.I1.i3.p1.1">
         <span class="ltx_text ltx_font_smallcaps" id="S7.I1.i3.p1.1.1">
          Finish[answer]
         </span>
         , which returns the answer and finishes the task.
        </p>
       </div>
      </li>
     </ol>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS1.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Dataset
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS1.SSS0.Px2.p1">
     <p class="ltx_p" id="S7.SS1.SSS0.Px2.p1.1">
      We collected 3,383 reflection samples by running the base rollout policy for 3 trials (
      <math alttext="N=3" class="ltx_Math" display="inline" id="S7.SS1.SSS0.Px2.p1.1.m1.1">
       <semantics id="S7.SS1.SSS0.Px2.p1.1.m1.1a">
        <mrow id="S7.SS1.SSS0.Px2.p1.1.m1.1.1" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.cmml">
         <mi id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.2" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml">
          N
         </mi>
         <mo id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.1" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml">
          =
         </mo>
         <mn id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.3" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.3.cmml">
          3
         </mn>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S7.SS1.SSS0.Px2.p1.1.m1.1b">
         <apply id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1">
          <eq id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.1">
          </eq>
          <ci id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.2">
           𝑁
          </ci>
          <cn id="S7.SS1.SSS0.Px2.p1.1.m1.1.1.3.cmml" type="integer" xref="S7.SS1.SSS0.Px2.p1.1.m1.1.1.3">
           3
          </cn>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S7.SS1.SSS0.Px2.p1.1.m1.1c">
         N=3
        </annotation>
       </semantics>
      </math>
      ) for 3,000 tasks in the training set, in which 1,084 instruction-response pairs have positive ratings.
     </p>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S7.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     7.2
    </span>
    Implementation Details
   </h3>
   <section class="ltx_paragraph" id="S7.SS2.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Model
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px1.p1">
     <p class="ltx_p" id="S7.SS2.SSS0.Px1.p1.1">
      We use GPT-3 (model: text-davinci-003) as the frozen actor model. For the retrospective model, we instantiate it from LongChat (model: longchat-7b-16k), which is a LM with 16k context length by fine-tuning llama-7b on instruction-following samples from ShareGPT. In all experiments, we set the temperature of actor LM as zero, i.e., T=0 and top p =1 to isolate the randomness of LM from the effects of reflections. We acknowledge that setting a higher temperature value can encourage exploration but it can obscure the impact of the proposed approaches, making it difficult to compare against existing baselines with T=0
      <cite class="ltx_cite ltx_citemacro_citep">
       (Yao et al.,
       <a class="ltx_ref" href="#bib.bib25" title="">
        2023
       </a>
       ; Shinn et al.,
       <a class="ltx_ref" href="#bib.bib18" title="">
        2023
       </a>
       )
      </cite>
      .
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS2.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Setup
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px2.p1">
     <p class="ltx_p" id="S7.SS2.SSS0.Px2.p1.1">
      Our proposed learning framework is developed by using multiple open-source tools as follows. We use the OpenAI connectors from
      <span class="ltx_text ltx_font_italic" id="S7.SS2.SSS0.Px2.p1.1.1">
       langchain
      </span>
      to build our actor models
      <math alttext="M_{a}" class="ltx_Math" display="inline" id="S7.SS2.SSS0.Px2.p1.1.m1.1">
       <semantics id="S7.SS2.SSS0.Px2.p1.1.m1.1a">
        <msub id="S7.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1.cmml">
         <mi id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.2" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml">
          M
         </mi>
         <mi id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml">
          a
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S7.SS2.SSS0.Px2.p1.1.m1.1b">
         <apply id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1">
          <csymbol cd="ambiguous" id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1.2">
           𝑀
          </ci>
          <ci id="S7.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S7.SS2.SSS0.Px2.p1.1.m1.1.1.3">
           𝑎
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S7.SS2.SSS0.Px2.p1.1.m1.1c">
         M_{a}
        </annotation>
       </semantics>
      </math>
      . During inference of the retrospective model, we host an API server using
      <span class="ltx_text ltx_font_italic" id="S7.SS2.SSS0.Px2.p1.1.2">
       FastChat
      </span>
      and integrates it with
      <span class="ltx_text ltx_font_italic" id="S7.SS2.SSS0.Px2.p1.1.3">
       langchain
      </span>
      agents. The tool can host longchat-7b-16k with concurrent requests to speed up RL policy rollouts. For fine-tuning the retrospective model, we develop our training pipeline with
      <span class="ltx_text ltx_font_italic" id="S7.SS2.SSS0.Px2.p1.1.4">
       trl
      </span>
      , which supports transformer reinforcement learning with PPO trainer.
     </p>
    </div>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px2.p2">
     <p class="ltx_p" id="S7.SS2.SSS0.Px2.p2.1">
      We present the details of the specific prompts we used and the full agent demonstrations and examples for each environment in
      <a class="ltx_ref" href="#A1" title="Appendix A Full Examples ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Appendix
       </span>
       <span class="ltx_text ltx_ref_tag">
        A
       </span>
      </a>
      .
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS2.SSS0.Px3">
    <h4 class="ltx_title ltx_title_paragraph">
     Training
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px3.p1">
     <p class="ltx_p" id="S7.SS2.SSS0.Px3.p1.1">
      We fine-tune the retrospective model
      <math alttext="M_{r}" class="ltx_Math" display="inline" id="S7.SS2.SSS0.Px3.p1.1.m1.1">
       <semantics id="S7.SS2.SSS0.Px3.p1.1.m1.1a">
        <msub id="S7.SS2.SSS0.Px3.p1.1.m1.1.1" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1.cmml">
         <mi id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.2" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1.2.cmml">
          M
         </mi>
         <mi id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.3" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1.3.cmml">
          r
         </mi>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S7.SS2.SSS0.Px3.p1.1.m1.1b">
         <apply id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1">
          <csymbol cd="ambiguous" id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.1.cmml" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.2.cmml" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1.2">
           𝑀
          </ci>
          <ci id="S7.SS2.SSS0.Px3.p1.1.m1.1.1.3.cmml" xref="S7.SS2.SSS0.Px3.p1.1.m1.1.1.3">
           𝑟
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S7.SS2.SSS0.Px3.p1.1.m1.1c">
         M_{r}
        </annotation>
       </semantics>
      </math>
      with 4-bit quantized LoRA adapters (r=1) on the offline RL datasets with epochs=4; batch size=8; lr=1.4e-5. The number of trainable parameters is 0.53M (0.015% of llama-7b). We first run supervised fine-tuning trainer on the samples with positive ratings for 2 epochs and then the RLHF pipeline, including reward modeling, and RL fine-tuning with PPO, on the whole offline rating dataset using the default settings for llama-7b model.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS2.SSS0.Px4">
    <h4 class="ltx_title ltx_title_paragraph">
     Evaluation Metrics
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px4.p1">
     <p class="ltx_p" id="S7.SS2.SSS0.Px4.p1.1">
      We report the success rate and the average episode returns over validation tasks in an environment. The agent is evaluated on 100 validation tasks from the distractor dev split of open-source HotPotQA dataset.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS2.SSS0.Px5">
    <h4 class="ltx_title ltx_title_paragraph">
     Baselines
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS2.SSS0.Px5.p1">
     <p class="ltx_p" id="S7.SS2.SSS0.Px5.p1.1">
      We experiment with two language agent baselines.
     </p>
     <ul class="ltx_itemize" id="S7.I2">
      <li class="ltx_item" id="S7.I2.i1" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        •
       </span>
       <div class="ltx_para ltx_noindent" id="S7.I2.i1.p1">
        <p class="ltx_p" id="S7.I2.i1.p1.1">
         <span class="ltx_text ltx_font_italic" id="S7.I2.i1.p1.1.1">
          ReAct
          <cite class="ltx_cite ltx_citemacro_citep">
           (Yao et al.,
           <a class="ltx_ref" href="#bib.bib25" title="">
            2023
           </a>
           )
          </cite>
         </span>
         . This is the language agent architecture which AutoGPT
         <cite class="ltx_cite ltx_citemacro_citep">
          (Gravitas,
          <a class="ltx_ref" href="#bib.bib3" title="">
           2023
          </a>
          )
         </cite>
         is built upon. At the same time, this agent does not learn from the environment rewards at all and can serve as a baseline for showing how the actor model performs without exploration and exploitation in the environment.
        </p>
       </div>
      </li>
      <li class="ltx_item" id="S7.I2.i2" style="list-style-type:none;">
       <span class="ltx_tag ltx_tag_item">
        •
       </span>
       <div class="ltx_para ltx_noindent" id="S7.I2.i2.p1">
        <p class="ltx_p" id="S7.I2.i2.p1.1">
         <span class="ltx_text ltx_font_italic" id="S7.I2.i2.p1.1.1">
          Reflexion
          <cite class="ltx_cite ltx_citemacro_citep">
           (Shinn et al.,
           <a class="ltx_ref" href="#bib.bib18" title="">
            2023
           </a>
           )
          </cite>
         </span>
         . This is the state-of-the-art language agent architecture that the authors identify from literature so far. This agent enhances from verbal feedback of the environment, and does not use gradient signals explicitly. It can serve as a baseline for showing the effectiveness of gradient-based learning for reasoning and planning.
        </p>
       </div>
      </li>
     </ul>
    </div>
   </section>
  </section>
  <section class="ltx_subsection" id="S7.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     7.3
    </span>
    Comparisons with Baselines
   </h3>
   <div class="ltx_para" id="S7.SS3.p1">
    <p class="ltx_p" id="S7.SS3.p1.1">
     We present the performances of our
     <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S7.SS3.p1.1.1">
      Retroformer
     </span>
     in
     <a class="ltx_ref" href="#S7.T2" title="In 7.3 Comparisons with Baselines ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Table
      </span>
      <span class="ltx_text ltx_ref_tag">
       2
      </span>
     </a>
     and compare it against the baselines in
     <a class="ltx_ref" href="#S7.F4" title="In 7.3 Comparisons with Baselines ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Fig.
      </span>
      <span class="ltx_text ltx_ref_tag">
       4
      </span>
     </a>
     . As shown in the table, we observe that the generated reflections consistently improve the agent performances over trials and the effects of reflection sampling are significant in the first few trials. This is expected as exploration in the early trials benefits exploration of the state action space.
    </p>
   </div>
   <figure class="ltx_table" id="S7.T2">
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_table">
      Table 2:
     </span>
     <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S7.T2.16.1">
      Retroformer
     </span>
     success rate (succ%) and average reward in N trials and best-of-
     <math alttext="n" class="ltx_Math" display="inline" id="S7.T2.3.m1.1">
      <semantics id="S7.T2.3.m1.1b">
       <mi id="S7.T2.3.m1.1.1" xref="S7.T2.3.m1.1.1.cmml">
        n
       </mi>
       <annotation-xml encoding="MathML-Content" id="S7.T2.3.m1.1c">
        <ci id="S7.T2.3.m1.1.1.cmml" xref="S7.T2.3.m1.1.1">
         𝑛
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S7.T2.3.m1.1d">
        n
       </annotation>
      </semantics>
     </math>
     shots reflection sampling scored by the learned reward model in HotPotQA environment. The standard deviation is calculated for the average rewards over 100 tasks and
     <math alttext="n" class="ltx_Math" display="inline" id="S7.T2.4.m2.1">
      <semantics id="S7.T2.4.m2.1b">
       <mi id="S7.T2.4.m2.1.1" xref="S7.T2.4.m2.1.1.cmml">
        n
       </mi>
       <annotation-xml encoding="MathML-Content" id="S7.T2.4.m2.1c">
        <ci id="S7.T2.4.m2.1.1.cmml" xref="S7.T2.4.m2.1.1">
         𝑛
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S7.T2.4.m2.1d">
        n
       </annotation>
      </semantics>
     </math>
     shots.
    </figcaption>
    <table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S7.T2.14">
     <thead class="ltx_thead">
      <tr class="ltx_tr" id="S7.T2.14.11.1">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S7.T2.14.11.1.1" style="padding-left:3.0pt;padding-right:3.0pt;">
        Environment
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S7.T2.14.11.1.2" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.14.11.1.2.1" style="background-color:#FFFFFF;">
         Settings
        </span>
       </th>
       <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S7.T2.14.11.1.3" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.14.11.1.3.1" style="background-color:#FFFFFF;">
         1 shot
        </span>
       </th>
       <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S7.T2.14.11.1.4" style="padding-left:3.0pt;padding-right:3.0pt;">
        2 shots
       </th>
       <th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S7.T2.14.11.1.5" style="padding-left:3.0pt;padding-right:3.0pt;">
        4 shots
       </th>
      </tr>
     </thead>
     <tbody class="ltx_tbody">
      <tr class="ltx_tr" id="S7.T2.5.1">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S7.T2.5.1.2" rowspan="4" style="padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.5.1.2.1">
         HotPotQA
        </span>
       </th>
       <th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S7.T2.5.1.3" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.5.1.3.1" style="background-color:#FFFFFF;">
         N=0 (initial trial)
        </span>
       </th>
       <td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S7.T2.5.1.1" style="padding-left:3.0pt;padding-right:3.0pt;">
        ———————-
        <math alttext="34\%/0.43\pm 0.46" class="ltx_Math" display="inline" id="S7.T2.5.1.1.m1.1">
         <semantics id="S7.T2.5.1.1.m1.1a">
          <mrow id="S7.T2.5.1.1.m1.1.1" xref="S7.T2.5.1.1.m1.1.1.cmml">
           <mrow id="S7.T2.5.1.1.m1.1.1.2" xref="S7.T2.5.1.1.m1.1.1.2.cmml">
            <mrow id="S7.T2.5.1.1.m1.1.1.2.2" xref="S7.T2.5.1.1.m1.1.1.2.2.cmml">
             <mn id="S7.T2.5.1.1.m1.1.1.2.2.2" xref="S7.T2.5.1.1.m1.1.1.2.2.2.cmml">
              34
             </mn>
             <mo id="S7.T2.5.1.1.m1.1.1.2.2.1" xref="S7.T2.5.1.1.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.5.1.1.m1.1.1.2.1" xref="S7.T2.5.1.1.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.5.1.1.m1.1.1.2.3" xref="S7.T2.5.1.1.m1.1.1.2.3.cmml">
             0.43
            </mn>
           </mrow>
           <mo id="S7.T2.5.1.1.m1.1.1.1" xref="S7.T2.5.1.1.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.5.1.1.m1.1.1.3" xref="S7.T2.5.1.1.m1.1.1.3.cmml">
            0.46
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.5.1.1.m1.1b">
           <apply id="S7.T2.5.1.1.m1.1.1.cmml" xref="S7.T2.5.1.1.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.5.1.1.m1.1.1.1.cmml" xref="S7.T2.5.1.1.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.5.1.1.m1.1.1.2.cmml" xref="S7.T2.5.1.1.m1.1.1.2">
             <divide id="S7.T2.5.1.1.m1.1.1.2.1.cmml" xref="S7.T2.5.1.1.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.5.1.1.m1.1.1.2.2.cmml" xref="S7.T2.5.1.1.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.5.1.1.m1.1.1.2.2.1.cmml" xref="S7.T2.5.1.1.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.5.1.1.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.5.1.1.m1.1.1.2.2.2">
               34
              </cn>
             </apply>
             <cn id="S7.T2.5.1.1.m1.1.1.2.3.cmml" type="float" xref="S7.T2.5.1.1.m1.1.1.2.3">
              0.43
             </cn>
            </apply>
            <cn id="S7.T2.5.1.1.m1.1.1.3.cmml" type="float" xref="S7.T2.5.1.1.m1.1.1.3">
             0.46
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.5.1.1.m1.1c">
           34\%/0.43\pm 0.46
          </annotation>
         </semantics>
        </math>
        ———————-
       </td>
      </tr>
      <tr class="ltx_tr" id="S7.T2.8.4">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S7.T2.8.4.4" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.8.4.4.1" style="background-color:#FFFFFF;">
         N=1
        </span>
       </th>
       <td class="ltx_td ltx_align_center" id="S7.T2.6.2.1" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="39\%/0.45\pm 0.47" class="ltx_Math" display="inline" id="S7.T2.6.2.1.m1.1" style="background-color:#FFFFFF;">
         <semantics id="S7.T2.6.2.1.m1.1a">
          <mrow id="S7.T2.6.2.1.m1.1.1" xref="S7.T2.6.2.1.m1.1.1.cmml">
           <mrow id="S7.T2.6.2.1.m1.1.1.2" xref="S7.T2.6.2.1.m1.1.1.2.cmml">
            <mrow id="S7.T2.6.2.1.m1.1.1.2.2" xref="S7.T2.6.2.1.m1.1.1.2.2.cmml">
             <mn id="S7.T2.6.2.1.m1.1.1.2.2.2" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.2.2.2.cmml">
              39
             </mn>
             <mo id="S7.T2.6.2.1.m1.1.1.2.2.1" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.6.2.1.m1.1.1.2.1" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.6.2.1.m1.1.1.2.3" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.2.3.cmml">
             0.45
            </mn>
           </mrow>
           <mo id="S7.T2.6.2.1.m1.1.1.1" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.6.2.1.m1.1.1.3" mathbackground="#FFFFFF" xref="S7.T2.6.2.1.m1.1.1.3.cmml">
            0.47
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.6.2.1.m1.1b">
           <apply id="S7.T2.6.2.1.m1.1.1.cmml" xref="S7.T2.6.2.1.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.6.2.1.m1.1.1.1.cmml" xref="S7.T2.6.2.1.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.6.2.1.m1.1.1.2.cmml" xref="S7.T2.6.2.1.m1.1.1.2">
             <divide id="S7.T2.6.2.1.m1.1.1.2.1.cmml" xref="S7.T2.6.2.1.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.6.2.1.m1.1.1.2.2.cmml" xref="S7.T2.6.2.1.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.6.2.1.m1.1.1.2.2.1.cmml" xref="S7.T2.6.2.1.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.6.2.1.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.6.2.1.m1.1.1.2.2.2">
               39
              </cn>
             </apply>
             <cn id="S7.T2.6.2.1.m1.1.1.2.3.cmml" type="float" xref="S7.T2.6.2.1.m1.1.1.2.3">
              0.45
             </cn>
            </apply>
            <cn id="S7.T2.6.2.1.m1.1.1.3.cmml" type="float" xref="S7.T2.6.2.1.m1.1.1.3">
             0.47
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.6.2.1.m1.1c">
           39\%/0.45\pm 0.47
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S7.T2.7.3.2" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="42\%/0.48\pm 0.46" class="ltx_Math" display="inline" id="S7.T2.7.3.2.m1.1">
         <semantics id="S7.T2.7.3.2.m1.1a">
          <mrow id="S7.T2.7.3.2.m1.1.1" xref="S7.T2.7.3.2.m1.1.1.cmml">
           <mrow id="S7.T2.7.3.2.m1.1.1.2" xref="S7.T2.7.3.2.m1.1.1.2.cmml">
            <mrow id="S7.T2.7.3.2.m1.1.1.2.2" xref="S7.T2.7.3.2.m1.1.1.2.2.cmml">
             <mn id="S7.T2.7.3.2.m1.1.1.2.2.2" xref="S7.T2.7.3.2.m1.1.1.2.2.2.cmml">
              42
             </mn>
             <mo id="S7.T2.7.3.2.m1.1.1.2.2.1" xref="S7.T2.7.3.2.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.7.3.2.m1.1.1.2.1" xref="S7.T2.7.3.2.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.7.3.2.m1.1.1.2.3" xref="S7.T2.7.3.2.m1.1.1.2.3.cmml">
             0.48
            </mn>
           </mrow>
           <mo id="S7.T2.7.3.2.m1.1.1.1" xref="S7.T2.7.3.2.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.7.3.2.m1.1.1.3" xref="S7.T2.7.3.2.m1.1.1.3.cmml">
            0.46
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.7.3.2.m1.1b">
           <apply id="S7.T2.7.3.2.m1.1.1.cmml" xref="S7.T2.7.3.2.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.7.3.2.m1.1.1.1.cmml" xref="S7.T2.7.3.2.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.7.3.2.m1.1.1.2.cmml" xref="S7.T2.7.3.2.m1.1.1.2">
             <divide id="S7.T2.7.3.2.m1.1.1.2.1.cmml" xref="S7.T2.7.3.2.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.7.3.2.m1.1.1.2.2.cmml" xref="S7.T2.7.3.2.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.7.3.2.m1.1.1.2.2.1.cmml" xref="S7.T2.7.3.2.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.7.3.2.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.7.3.2.m1.1.1.2.2.2">
               42
              </cn>
             </apply>
             <cn id="S7.T2.7.3.2.m1.1.1.2.3.cmml" type="float" xref="S7.T2.7.3.2.m1.1.1.2.3">
              0.48
             </cn>
            </apply>
            <cn id="S7.T2.7.3.2.m1.1.1.3.cmml" type="float" xref="S7.T2.7.3.2.m1.1.1.3">
             0.46
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.7.3.2.m1.1c">
           42\%/0.48\pm 0.46
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S7.T2.8.4.3" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="45\%/0.52\pm 0.47" class="ltx_Math" display="inline" id="S7.T2.8.4.3.m1.1">
         <semantics id="S7.T2.8.4.3.m1.1a">
          <mrow id="S7.T2.8.4.3.m1.1.1" xref="S7.T2.8.4.3.m1.1.1.cmml">
           <mrow id="S7.T2.8.4.3.m1.1.1.2" xref="S7.T2.8.4.3.m1.1.1.2.cmml">
            <mrow id="S7.T2.8.4.3.m1.1.1.2.2" xref="S7.T2.8.4.3.m1.1.1.2.2.cmml">
             <mn id="S7.T2.8.4.3.m1.1.1.2.2.2" xref="S7.T2.8.4.3.m1.1.1.2.2.2.cmml">
              45
             </mn>
             <mo id="S7.T2.8.4.3.m1.1.1.2.2.1" xref="S7.T2.8.4.3.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.8.4.3.m1.1.1.2.1" xref="S7.T2.8.4.3.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.8.4.3.m1.1.1.2.3" xref="S7.T2.8.4.3.m1.1.1.2.3.cmml">
             0.52
            </mn>
           </mrow>
           <mo id="S7.T2.8.4.3.m1.1.1.1" xref="S7.T2.8.4.3.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.8.4.3.m1.1.1.3" xref="S7.T2.8.4.3.m1.1.1.3.cmml">
            0.47
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.8.4.3.m1.1b">
           <apply id="S7.T2.8.4.3.m1.1.1.cmml" xref="S7.T2.8.4.3.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.8.4.3.m1.1.1.1.cmml" xref="S7.T2.8.4.3.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.8.4.3.m1.1.1.2.cmml" xref="S7.T2.8.4.3.m1.1.1.2">
             <divide id="S7.T2.8.4.3.m1.1.1.2.1.cmml" xref="S7.T2.8.4.3.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.8.4.3.m1.1.1.2.2.cmml" xref="S7.T2.8.4.3.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.8.4.3.m1.1.1.2.2.1.cmml" xref="S7.T2.8.4.3.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.8.4.3.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.8.4.3.m1.1.1.2.2.2">
               45
              </cn>
             </apply>
             <cn id="S7.T2.8.4.3.m1.1.1.2.3.cmml" type="float" xref="S7.T2.8.4.3.m1.1.1.2.3">
              0.52
             </cn>
            </apply>
            <cn id="S7.T2.8.4.3.m1.1.1.3.cmml" type="float" xref="S7.T2.8.4.3.m1.1.1.3">
             0.47
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.8.4.3.m1.1c">
           45\%/0.52\pm 0.47
          </annotation>
         </semantics>
        </math>
       </td>
      </tr>
      <tr class="ltx_tr" id="S7.T2.11.7">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S7.T2.11.7.4" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.11.7.4.1" style="background-color:#FFFFFF;">
         N=2
        </span>
       </th>
       <td class="ltx_td ltx_align_center" id="S7.T2.9.5.1" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="42\%/0.48\pm 0.46" class="ltx_Math" display="inline" id="S7.T2.9.5.1.m1.1" style="background-color:#FFFFFF;">
         <semantics id="S7.T2.9.5.1.m1.1a">
          <mrow id="S7.T2.9.5.1.m1.1.1" xref="S7.T2.9.5.1.m1.1.1.cmml">
           <mrow id="S7.T2.9.5.1.m1.1.1.2" xref="S7.T2.9.5.1.m1.1.1.2.cmml">
            <mrow id="S7.T2.9.5.1.m1.1.1.2.2" xref="S7.T2.9.5.1.m1.1.1.2.2.cmml">
             <mn id="S7.T2.9.5.1.m1.1.1.2.2.2" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.2.2.2.cmml">
              42
             </mn>
             <mo id="S7.T2.9.5.1.m1.1.1.2.2.1" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.9.5.1.m1.1.1.2.1" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.9.5.1.m1.1.1.2.3" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.2.3.cmml">
             0.48
            </mn>
           </mrow>
           <mo id="S7.T2.9.5.1.m1.1.1.1" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.9.5.1.m1.1.1.3" mathbackground="#FFFFFF" xref="S7.T2.9.5.1.m1.1.1.3.cmml">
            0.46
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.9.5.1.m1.1b">
           <apply id="S7.T2.9.5.1.m1.1.1.cmml" xref="S7.T2.9.5.1.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.9.5.1.m1.1.1.1.cmml" xref="S7.T2.9.5.1.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.9.5.1.m1.1.1.2.cmml" xref="S7.T2.9.5.1.m1.1.1.2">
             <divide id="S7.T2.9.5.1.m1.1.1.2.1.cmml" xref="S7.T2.9.5.1.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.9.5.1.m1.1.1.2.2.cmml" xref="S7.T2.9.5.1.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.9.5.1.m1.1.1.2.2.1.cmml" xref="S7.T2.9.5.1.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.9.5.1.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.9.5.1.m1.1.1.2.2.2">
               42
              </cn>
             </apply>
             <cn id="S7.T2.9.5.1.m1.1.1.2.3.cmml" type="float" xref="S7.T2.9.5.1.m1.1.1.2.3">
              0.48
             </cn>
            </apply>
            <cn id="S7.T2.9.5.1.m1.1.1.3.cmml" type="float" xref="S7.T2.9.5.1.m1.1.1.3">
             0.46
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.9.5.1.m1.1c">
           42\%/0.48\pm 0.46
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S7.T2.10.6.2" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="45\%/0.52\pm 0.47" class="ltx_Math" display="inline" id="S7.T2.10.6.2.m1.1">
         <semantics id="S7.T2.10.6.2.m1.1a">
          <mrow id="S7.T2.10.6.2.m1.1.1" xref="S7.T2.10.6.2.m1.1.1.cmml">
           <mrow id="S7.T2.10.6.2.m1.1.1.2" xref="S7.T2.10.6.2.m1.1.1.2.cmml">
            <mrow id="S7.T2.10.6.2.m1.1.1.2.2" xref="S7.T2.10.6.2.m1.1.1.2.2.cmml">
             <mn id="S7.T2.10.6.2.m1.1.1.2.2.2" xref="S7.T2.10.6.2.m1.1.1.2.2.2.cmml">
              45
             </mn>
             <mo id="S7.T2.10.6.2.m1.1.1.2.2.1" xref="S7.T2.10.6.2.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.10.6.2.m1.1.1.2.1" xref="S7.T2.10.6.2.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.10.6.2.m1.1.1.2.3" xref="S7.T2.10.6.2.m1.1.1.2.3.cmml">
             0.52
            </mn>
           </mrow>
           <mo id="S7.T2.10.6.2.m1.1.1.1" xref="S7.T2.10.6.2.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.10.6.2.m1.1.1.3" xref="S7.T2.10.6.2.m1.1.1.3.cmml">
            0.47
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.10.6.2.m1.1b">
           <apply id="S7.T2.10.6.2.m1.1.1.cmml" xref="S7.T2.10.6.2.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.10.6.2.m1.1.1.1.cmml" xref="S7.T2.10.6.2.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.10.6.2.m1.1.1.2.cmml" xref="S7.T2.10.6.2.m1.1.1.2">
             <divide id="S7.T2.10.6.2.m1.1.1.2.1.cmml" xref="S7.T2.10.6.2.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.10.6.2.m1.1.1.2.2.cmml" xref="S7.T2.10.6.2.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.10.6.2.m1.1.1.2.2.1.cmml" xref="S7.T2.10.6.2.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.10.6.2.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.10.6.2.m1.1.1.2.2.2">
               45
              </cn>
             </apply>
             <cn id="S7.T2.10.6.2.m1.1.1.2.3.cmml" type="float" xref="S7.T2.10.6.2.m1.1.1.2.3">
              0.52
             </cn>
            </apply>
            <cn id="S7.T2.10.6.2.m1.1.1.3.cmml" type="float" xref="S7.T2.10.6.2.m1.1.1.3">
             0.47
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.10.6.2.m1.1c">
           45\%/0.52\pm 0.47
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S7.T2.11.7.3" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="48\%/0.54\pm 0.47" class="ltx_Math" display="inline" id="S7.T2.11.7.3.m1.1">
         <semantics id="S7.T2.11.7.3.m1.1a">
          <mrow id="S7.T2.11.7.3.m1.1.1" xref="S7.T2.11.7.3.m1.1.1.cmml">
           <mrow id="S7.T2.11.7.3.m1.1.1.2" xref="S7.T2.11.7.3.m1.1.1.2.cmml">
            <mrow id="S7.T2.11.7.3.m1.1.1.2.2" xref="S7.T2.11.7.3.m1.1.1.2.2.cmml">
             <mn id="S7.T2.11.7.3.m1.1.1.2.2.2" xref="S7.T2.11.7.3.m1.1.1.2.2.2.cmml">
              48
             </mn>
             <mo id="S7.T2.11.7.3.m1.1.1.2.2.1" xref="S7.T2.11.7.3.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.11.7.3.m1.1.1.2.1" xref="S7.T2.11.7.3.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.11.7.3.m1.1.1.2.3" xref="S7.T2.11.7.3.m1.1.1.2.3.cmml">
             0.54
            </mn>
           </mrow>
           <mo id="S7.T2.11.7.3.m1.1.1.1" xref="S7.T2.11.7.3.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.11.7.3.m1.1.1.3" xref="S7.T2.11.7.3.m1.1.1.3.cmml">
            0.47
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.11.7.3.m1.1b">
           <apply id="S7.T2.11.7.3.m1.1.1.cmml" xref="S7.T2.11.7.3.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.11.7.3.m1.1.1.1.cmml" xref="S7.T2.11.7.3.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.11.7.3.m1.1.1.2.cmml" xref="S7.T2.11.7.3.m1.1.1.2">
             <divide id="S7.T2.11.7.3.m1.1.1.2.1.cmml" xref="S7.T2.11.7.3.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.11.7.3.m1.1.1.2.2.cmml" xref="S7.T2.11.7.3.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.11.7.3.m1.1.1.2.2.1.cmml" xref="S7.T2.11.7.3.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.11.7.3.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.11.7.3.m1.1.1.2.2.2">
               48
              </cn>
             </apply>
             <cn id="S7.T2.11.7.3.m1.1.1.2.3.cmml" type="float" xref="S7.T2.11.7.3.m1.1.1.2.3">
              0.54
             </cn>
            </apply>
            <cn id="S7.T2.11.7.3.m1.1.1.3.cmml" type="float" xref="S7.T2.11.7.3.m1.1.1.3">
             0.47
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.11.7.3.m1.1c">
           48\%/0.54\pm 0.47
          </annotation>
         </semantics>
        </math>
       </td>
      </tr>
      <tr class="ltx_tr" id="S7.T2.14.10">
       <th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S7.T2.14.10.4" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <span class="ltx_text" id="S7.T2.14.10.4.1" style="background-color:#FFFFFF;">
         N=4
        </span>
       </th>
       <td class="ltx_td ltx_align_center ltx_border_bb" id="S7.T2.12.8.1" style="background-color:#FFFFFF;padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="50\%/0.55\pm 0.48" class="ltx_Math" display="inline" id="S7.T2.12.8.1.m1.1" style="background-color:#FFFFFF;">
         <semantics id="S7.T2.12.8.1.m1.1a">
          <mrow id="S7.T2.12.8.1.m1.1.1" xref="S7.T2.12.8.1.m1.1.1.cmml">
           <mrow id="S7.T2.12.8.1.m1.1.1.2" xref="S7.T2.12.8.1.m1.1.1.2.cmml">
            <mrow id="S7.T2.12.8.1.m1.1.1.2.2" xref="S7.T2.12.8.1.m1.1.1.2.2.cmml">
             <mn id="S7.T2.12.8.1.m1.1.1.2.2.2" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.2.2.2.cmml">
              50
             </mn>
             <mo id="S7.T2.12.8.1.m1.1.1.2.2.1" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.12.8.1.m1.1.1.2.1" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.12.8.1.m1.1.1.2.3" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.2.3.cmml">
             0.55
            </mn>
           </mrow>
           <mo id="S7.T2.12.8.1.m1.1.1.1" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.12.8.1.m1.1.1.3" mathbackground="#FFFFFF" xref="S7.T2.12.8.1.m1.1.1.3.cmml">
            0.48
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.12.8.1.m1.1b">
           <apply id="S7.T2.12.8.1.m1.1.1.cmml" xref="S7.T2.12.8.1.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.12.8.1.m1.1.1.1.cmml" xref="S7.T2.12.8.1.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.12.8.1.m1.1.1.2.cmml" xref="S7.T2.12.8.1.m1.1.1.2">
             <divide id="S7.T2.12.8.1.m1.1.1.2.1.cmml" xref="S7.T2.12.8.1.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.12.8.1.m1.1.1.2.2.cmml" xref="S7.T2.12.8.1.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.12.8.1.m1.1.1.2.2.1.cmml" xref="S7.T2.12.8.1.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.12.8.1.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.12.8.1.m1.1.1.2.2.2">
               50
              </cn>
             </apply>
             <cn id="S7.T2.12.8.1.m1.1.1.2.3.cmml" type="float" xref="S7.T2.12.8.1.m1.1.1.2.3">
              0.55
             </cn>
            </apply>
            <cn id="S7.T2.12.8.1.m1.1.1.3.cmml" type="float" xref="S7.T2.12.8.1.m1.1.1.3">
             0.48
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.12.8.1.m1.1c">
           50\%/0.55\pm 0.48
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_bb" id="S7.T2.13.9.2" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="52\%/0.58\pm 0.46" class="ltx_Math" display="inline" id="S7.T2.13.9.2.m1.1">
         <semantics id="S7.T2.13.9.2.m1.1a">
          <mrow id="S7.T2.13.9.2.m1.1.1" xref="S7.T2.13.9.2.m1.1.1.cmml">
           <mrow id="S7.T2.13.9.2.m1.1.1.2" xref="S7.T2.13.9.2.m1.1.1.2.cmml">
            <mrow id="S7.T2.13.9.2.m1.1.1.2.2" xref="S7.T2.13.9.2.m1.1.1.2.2.cmml">
             <mn id="S7.T2.13.9.2.m1.1.1.2.2.2" xref="S7.T2.13.9.2.m1.1.1.2.2.2.cmml">
              52
             </mn>
             <mo id="S7.T2.13.9.2.m1.1.1.2.2.1" xref="S7.T2.13.9.2.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.13.9.2.m1.1.1.2.1" xref="S7.T2.13.9.2.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.13.9.2.m1.1.1.2.3" xref="S7.T2.13.9.2.m1.1.1.2.3.cmml">
             0.58
            </mn>
           </mrow>
           <mo id="S7.T2.13.9.2.m1.1.1.1" xref="S7.T2.13.9.2.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.13.9.2.m1.1.1.3" xref="S7.T2.13.9.2.m1.1.1.3.cmml">
            0.46
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.13.9.2.m1.1b">
           <apply id="S7.T2.13.9.2.m1.1.1.cmml" xref="S7.T2.13.9.2.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.13.9.2.m1.1.1.1.cmml" xref="S7.T2.13.9.2.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.13.9.2.m1.1.1.2.cmml" xref="S7.T2.13.9.2.m1.1.1.2">
             <divide id="S7.T2.13.9.2.m1.1.1.2.1.cmml" xref="S7.T2.13.9.2.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.13.9.2.m1.1.1.2.2.cmml" xref="S7.T2.13.9.2.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.13.9.2.m1.1.1.2.2.1.cmml" xref="S7.T2.13.9.2.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.13.9.2.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.13.9.2.m1.1.1.2.2.2">
               52
              </cn>
             </apply>
             <cn id="S7.T2.13.9.2.m1.1.1.2.3.cmml" type="float" xref="S7.T2.13.9.2.m1.1.1.2.3">
              0.58
             </cn>
            </apply>
            <cn id="S7.T2.13.9.2.m1.1.1.3.cmml" type="float" xref="S7.T2.13.9.2.m1.1.1.3">
             0.46
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.13.9.2.m1.1c">
           52\%/0.58\pm 0.46
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_bb" id="S7.T2.14.10.3" style="padding-left:3.0pt;padding-right:3.0pt;">
        <math alttext="53\%/0.60\pm 0.46" class="ltx_Math" display="inline" id="S7.T2.14.10.3.m1.1">
         <semantics id="S7.T2.14.10.3.m1.1a">
          <mrow id="S7.T2.14.10.3.m1.1.1" xref="S7.T2.14.10.3.m1.1.1.cmml">
           <mrow id="S7.T2.14.10.3.m1.1.1.2" xref="S7.T2.14.10.3.m1.1.1.2.cmml">
            <mrow id="S7.T2.14.10.3.m1.1.1.2.2" xref="S7.T2.14.10.3.m1.1.1.2.2.cmml">
             <mn id="S7.T2.14.10.3.m1.1.1.2.2.2" xref="S7.T2.14.10.3.m1.1.1.2.2.2.cmml">
              53
             </mn>
             <mo id="S7.T2.14.10.3.m1.1.1.2.2.1" xref="S7.T2.14.10.3.m1.1.1.2.2.1.cmml">
              %
             </mo>
            </mrow>
            <mo id="S7.T2.14.10.3.m1.1.1.2.1" xref="S7.T2.14.10.3.m1.1.1.2.1.cmml">
             /
            </mo>
            <mn id="S7.T2.14.10.3.m1.1.1.2.3" xref="S7.T2.14.10.3.m1.1.1.2.3.cmml">
             0.60
            </mn>
           </mrow>
           <mo id="S7.T2.14.10.3.m1.1.1.1" xref="S7.T2.14.10.3.m1.1.1.1.cmml">
            ±
           </mo>
           <mn id="S7.T2.14.10.3.m1.1.1.3" xref="S7.T2.14.10.3.m1.1.1.3.cmml">
            0.46
           </mn>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S7.T2.14.10.3.m1.1b">
           <apply id="S7.T2.14.10.3.m1.1.1.cmml" xref="S7.T2.14.10.3.m1.1.1">
            <csymbol cd="latexml" id="S7.T2.14.10.3.m1.1.1.1.cmml" xref="S7.T2.14.10.3.m1.1.1.1">
             plus-or-minus
            </csymbol>
            <apply id="S7.T2.14.10.3.m1.1.1.2.cmml" xref="S7.T2.14.10.3.m1.1.1.2">
             <divide id="S7.T2.14.10.3.m1.1.1.2.1.cmml" xref="S7.T2.14.10.3.m1.1.1.2.1">
             </divide>
             <apply id="S7.T2.14.10.3.m1.1.1.2.2.cmml" xref="S7.T2.14.10.3.m1.1.1.2.2">
              <csymbol cd="latexml" id="S7.T2.14.10.3.m1.1.1.2.2.1.cmml" xref="S7.T2.14.10.3.m1.1.1.2.2.1">
               percent
              </csymbol>
              <cn id="S7.T2.14.10.3.m1.1.1.2.2.2.cmml" type="integer" xref="S7.T2.14.10.3.m1.1.1.2.2.2">
               53
              </cn>
             </apply>
             <cn id="S7.T2.14.10.3.m1.1.1.2.3.cmml" type="float" xref="S7.T2.14.10.3.m1.1.1.2.3">
              0.60
             </cn>
            </apply>
            <cn id="S7.T2.14.10.3.m1.1.1.3.cmml" type="float" xref="S7.T2.14.10.3.m1.1.1.3">
             0.46
            </cn>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S7.T2.14.10.3.m1.1c">
           53\%/0.60\pm 0.46
          </annotation>
         </semantics>
        </math>
       </td>
      </tr>
     </tbody>
    </table>
   </figure>
   <figure class="ltx_figure ltx_align_floatright" id="S7.F4">
    <img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="275" id="S7.F4.g1" src="/html/2308.02151/assets/x4.png" width="460"/>
    <figcaption class="ltx_caption">
     <span class="ltx_tag ltx_tag_figure">
      Figure 4:
     </span>
     We compare
     <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S7.F4.2.1">
      Retroformer
     </span>
     with baselines and observe consistent and faster performance improvement in terms of success rate.
    </figcaption>
   </figure>
   <div class="ltx_para ltx_noindent" id="S7.SS3.p2">
    <p class="ltx_p" id="S7.SS3.p2.1">
     Furthermore, as shown in
     <a class="ltx_ref" href="#S7.F4" title="In 7.3 Comparisons with Baselines ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Fig.
      </span>
      <span class="ltx_text ltx_ref_tag">
       4
      </span>
     </a>
     , our agent outperforms the two strong baselines. Specifically, the results indicate that our reinforced model provides the language agents with better reflection responses in early trials, which enables the agents to learn faster, while also achieving better performances in the end. Our
     <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S7.SS3.p2.1.1">
      Retroformer
     </span>
     agent achieves 53% success rate in 5 trials, which is better than the state-of-the-art 50% success rate reported in
     <cite class="ltx_cite ltx_citemacro_citep">
      (Jang,
      <a class="ltx_ref" href="#bib.bib5" title="">
       2023
      </a>
      )
     </cite>
     that uses a much larger language model, i.e., GPT-3 (model: text-davinci-003) as the retrospective component. The results show the effectiveness of our policy gradient approach for fine-tuning the agent with offline samples.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S7.SS4">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     7.4
    </span>
    Discussion of the Reinforced Agent Behaviors
   </h3>
   <div class="ltx_para ltx_noindent" id="S7.SS4.p1">
    <p class="ltx_p" id="S7.SS4.p1.1">
     We examine how the retrospective model
     <math alttext="M_{r}" class="ltx_Math" display="inline" id="S7.SS4.p1.1.m1.1">
      <semantics id="S7.SS4.p1.1.m1.1a">
       <msub id="S7.SS4.p1.1.m1.1.1" xref="S7.SS4.p1.1.m1.1.1.cmml">
        <mi id="S7.SS4.p1.1.m1.1.1.2" xref="S7.SS4.p1.1.m1.1.1.2.cmml">
         M
        </mi>
        <mi id="S7.SS4.p1.1.m1.1.1.3" xref="S7.SS4.p1.1.m1.1.1.3.cmml">
         r
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S7.SS4.p1.1.m1.1b">
        <apply id="S7.SS4.p1.1.m1.1.1.cmml" xref="S7.SS4.p1.1.m1.1.1">
         <csymbol cd="ambiguous" id="S7.SS4.p1.1.m1.1.1.1.cmml" xref="S7.SS4.p1.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="S7.SS4.p1.1.m1.1.1.2.cmml" xref="S7.SS4.p1.1.m1.1.1.2">
          𝑀
         </ci>
         <ci id="S7.SS4.p1.1.m1.1.1.3.cmml" xref="S7.SS4.p1.1.m1.1.1.3">
          𝑟
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S7.SS4.p1.1.m1.1c">
        M_{r}
       </annotation>
      </semantics>
     </math>
     is improved with policy optimization by comparing the generated responses from the frozen retrospective LM and the ones from the fine-tuned, reinforced LM. We observe two general emerging behaviors that the fine-tuned LM learns to follow through trial and error. These two reinforced behaviors help the agents outperform the baselines in
     <a class="ltx_ref" href="#S7.F4" title="In 7.3 Comparisons with Baselines ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
      <span class="ltx_text ltx_ref_tag">
       Fig.
      </span>
      <span class="ltx_text ltx_ref_tag">
       4
      </span>
     </a>
     .
    </p>
   </div>
   <figure class="ltx_figure" id="S7.F5">
    <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="175" id="S7.F5.g1" src="/html/2308.02151/assets/x5.png" width="422"/>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_figure">
      Figure 5:
     </span>
     Response refinement from the reinforced retrospective model. Note that the lengthy observation step in the prior failed trial column is abbreviated for better presentation purposes.
    </figcaption>
   </figure>
   <section class="ltx_paragraph" id="S7.SS4.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Precise Credit Assignment for Failed Trials.
    </h4>
    <div class="ltx_para ltx_noindent" id="S7.SS4.SSS0.Px1.p1">
     <p class="ltx_p" id="S7.SS4.SSS0.Px1.p1.1">
      As shown in
      <a class="ltx_ref" href="#S7.F5" title="In 7.4 Discussion of the Reinforced Agent Behaviors ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Fig.
       </span>
       <span class="ltx_text ltx_ref_tag">
        5
       </span>
      </a>
      , we gave an example that illustrates why the reinforced responses better analyze the mistakes made in the prior failed trial and enable the agent to prevent from repetitive errors in the next attempt. The agent failed in the last attempt mainly because it submits both “Teen Tians” and “Teen Titans Go” as the answer to the Teen Titans spin-off series, while the correct answer should only include “Teen Titans Go”; The agent forgot its original goal during a chain of thought, actions and lengthy observations. While the
      <span class="ltx_text" id="S7.SS4.SSS0.Px1.p1.1.1" style="color:#BF8040;">
       reflection response
      </span>
      from the frozen model seems to have a lot “should have” terms and is very fluent in language, it simply reiterates the prior action sequences that lead to failure as the steps that the agent should have done, which prompts the agent to follow these steps again in the next attempt, resulting in an infinite loop.
     </p>
    </div>
    <div class="ltx_para ltx_noindent" id="S7.SS4.SSS0.Px1.p2">
     <p class="ltx_p" id="S7.SS4.SSS0.Px1.p2.1">
      On the contrary, our
      <span class="ltx_text" id="S7.SS4.SSS0.Px1.p2.1.1" style="color:#009900;">
       reinforced response
      </span>
      prompts the agent to focus on
      <span class="ltx_text ltx_font_bold" id="S7.SS4.SSS0.Px1.p2.1.2">
       spinoff series
      </span>
      in the very beginning of the response and asks the agent to find the answer in the previous actions and observations with special attention on the search results of “Tara Strong”. In summary, our proposed reinforcement learning approach presents better credit assignment and root cause analysis abilities, and has the power to recommend real actionable insights for the next attempt.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S7.SS4.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Structured Reflections and Action Plans.
    </h4>
    <figure class="ltx_figure" id="S7.F6">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="88" id="S7.F6.g1" src="/html/2308.02151/assets/x6.png" width="422"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       Figure 6:
      </span>
      Response refinement from the reinforced retrospective model with structured format.
     </figcaption>
    </figure>
    <div class="ltx_para ltx_noindent" id="S7.SS4.SSS0.Px2.p1">
     <p class="ltx_p" id="S7.SS4.SSS0.Px2.p1.1">
      We discover one emergent behavior of the reinforced model that it can automatically paraphrase the original responses into two separate structured sections, namely
      <span class="ltx_text ltx_font_italic" id="S7.SS4.SSS0.Px2.p1.1.1">
       Reflection
      </span>
      section and
      <span class="ltx_text ltx_font_italic" id="S7.SS4.SSS0.Px2.p1.1.2">
       New plan:
      </span>
      section, although not being explicitly trained or prompted for. One such example is shown in
      <a class="ltx_ref" href="#S7.F6" title="In Structured Reflections and Action Plans. ‣ 7.4 Discussion of the Reinforced Agent Behaviors ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Fig.
       </span>
       <span class="ltx_text ltx_ref_tag">
        6
       </span>
      </a>
      . The paraphrased response retrospects in the first paragraph and provides actionable insights next, while the response from the frozen LM interleaved both parts in one paragraph, making it hard to comprehend. We can also observer from
      <a class="ltx_ref" href="#S7.F5" title="In 7.4 Discussion of the Reinforced Agent Behaviors ‣ 7 Experiments ‣ Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization">
       <span class="ltx_text ltx_ref_tag">
        Fig.
       </span>
       <span class="ltx_text ltx_ref_tag">
        5
       </span>
      </a>
      that the reinforced response removes the messy, irrelevant “Next trial:” content in the end for cleaner format, which may very likely result from LLM hallucination.
     </p>
    </div>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S8">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    8
   </span>
   Conclusion
  </h2>
  <div class="ltx_para ltx_noindent" id="S8.p1">
   <p class="ltx_p" id="S8.p1.1">
    In this study, we present
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S8.p1.1.1">
     Retroformer
    </span>
    , an elegant framework for iteratively improving large language agents by learning a plug-in retrospective model. This model, through the process of policy optimization, automatically refines the prompts provided to the language agent with environmental feedback. Through extensive evaluations on real-world datasets such as HotPotQA, the method has been proven to effectively improve the performances of large language agents over time both in terms of learning speed and final task completion performances.
   </p>
  </div>
  <div class="ltx_para" id="S8.p2">
   <p class="ltx_p" id="S8.p2.1">
    By considering the Actor LLM as a component of the environment, our policy gradient approach allows learning from arbitrary reward signals from diverse environments and tasks. This facilitates the iterative refinement of a specific component within the language agent architecture – the retrospective model, in our case, while circumventing the need to access the Actor LLM parameters or propagate gradients through it. This agnostic characteristic renders
    <span class="ltx_text ltx_font_typewriter ltx_font_bold" id="S8.p2.1.1">
     Retroformer
    </span>
    a concise and adaptable plug-in module for different types of cloud-hosted LLMs, such as GPT and Bard. Furthermore, our approach is not limited to enhancing the retrospective model alone; it can be applied to reinforce other components within the agent architecture, such as the memory and summarization module, or the actor prompt. By selectively focusing on the component to be fine-tuned while keeping the remainder fixed, our proposed policy gradient approach allows for iterative improvements of the component with reward signals obtained from the environment.
   </p>
  </div>
 </section>
 <section class="ltx_bibliography" id="bib">
  <h2 class="ltx_title ltx_title_bibliography">
   References
  </h2>
  <ul class="ltx_biblist">
   <li class="ltx_bibitem" id="bib.bib1">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Ahn et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Michael Ahn, Anthony Brohan, Noah Brown, Yevgen Chebotar, Omar Cortes, Byron
David, Chelsea Finn, Keerthana Gopalakrishnan, Karol Hausman, Alex Herzog,
et al.
    </span>
    <span class="ltx_bibblock">
     Do as i can, not as i say: Grounding language in robotic affordances.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">
      arXiv preprint arXiv:2204.01691
     </em>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib2">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Chase (2023)
    </span>
    <span class="ltx_bibblock">
     Harrison Chase.
    </span>
    <span class="ltx_bibblock">
     Langchain.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/hwchase17/langchain" target="_blank" title="">
      https://github.com/hwchase17/langchain
     </a>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib3">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Gravitas (2023)
    </span>
    <span class="ltx_bibblock">
     Significant Gravitas.
    </span>
    <span class="ltx_bibblock">
     Autogpt.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/Significant-Gravitas/Auto-GPT" target="_blank" title="">
      https://github.com/Significant-Gravitas/Auto-GPT
     </a>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib4">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Hao et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Shibo Hao, Yi Gu, Haodi Ma, Joshua Jiahua Hong, Zhen Wang, Daisy Zhe Wang, and
Zhiting Hu.
    </span>
    <span class="ltx_bibblock">
     Reasoning with language model is planning with world model.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">
      arXiv preprint arXiv:2305.14992
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib5">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Jang (2023)
    </span>
    <span class="ltx_bibblock">
     Eric Jang.
    </span>
    <span class="ltx_bibblock">
     Can llms critique and iterate on their own outputs?
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">
      evjang.com
     </em>
     , Mar 2023.
    </span>
    <span class="ltx_bibblock">
     URL
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://evjang.com/2023/03/26/self-reflection.html" target="_blank" title="">
      https://evjang.com/2023/03/26/self-reflection.html
     </a>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib6">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Madaan et al. (2023a)
    </span>
    <span class="ltx_bibblock">
     Aman Madaan, Alexander Shypula, Uri Alon, Milad Hashemi, Parthasarathy
Ranganathan, Yiming Yang, Graham Neubig, and Amir Yazdanbakhsh.
    </span>
    <span class="ltx_bibblock">
     Learning performance-improving code edits.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">
      arXiv preprint arXiv:2302.07867
     </em>
     , 2023a.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib7">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Madaan et al. (2023b)
    </span>
    <span class="ltx_bibblock">
     Aman Madaan, Niket Tandon, Prakhar Gupta, Skyler Hallinan, Luyu Gao, Sarah
Wiegreffe, Uri Alon, Nouha Dziri, Shrimai Prabhumoye, Yiming Yang, et al.
    </span>
    <span class="ltx_bibblock">
     Self-refine: Iterative refinement with self-feedback.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">
      arXiv preprint arXiv:2303.17651
     </em>
     , 2023b.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib8">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Mnih et al. (2016)
    </span>
    <span class="ltx_bibblock">
     Volodymyr Mnih, Adrià Puigdomènech Badia, Mehdi Mirza, Alex Graves,
Timothy P. Lillicrap, Tim Harley, David Silver, and Koray Kavukcuoglu.
    </span>
    <span class="ltx_bibblock">
     Asynchronous methods for deep reinforcement learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">
      CoRR
     </em>
     , abs/1602.01783, 2016.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib9">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Nakajima (2023)
    </span>
    <span class="ltx_bibblock">
     Yohei Nakajima.
    </span>
    <span class="ltx_bibblock">
     Babyagi.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/yoheinakajima/babyagi" target="_blank" title="">
      https://github.com/yoheinakajima/babyagi
     </a>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib10">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Nakano et al. (2021)
    </span>
    <span class="ltx_bibblock">
     Reiichiro Nakano, Jacob Hilton, Suchir Balaji, Jeff Wu, Long Ouyang, Christina
Kim, Christopher Hesse, Shantanu Jain, Vineet Kosaraju, William Saunders,
et al.
    </span>
    <span class="ltx_bibblock">
     Webgpt: Browser-assisted question-answering with human feedback.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">
      arXiv preprint arXiv:2112.09332
     </em>
     , 2021.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib11">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Ouyang et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Long Ouyang, Jeffrey Wu, Xu Jiang, Diogo Almeida, Carroll Wainwright, Pamela
Mishkin, Chong Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, et al.
    </span>
    <span class="ltx_bibblock">
     Training language models to follow instructions with human feedback.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">
      Advances in Neural Information Processing Systems
     </em>
     ,
35:27730–27744, 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib12">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Park et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Joon Sung Park, Joseph C O’Brien, Carrie J Cai, Meredith Ringel Morris, Percy
Liang, and Michael S Bernstein.
    </span>
    <span class="ltx_bibblock">
     Generative agents: Interactive simulacra of human behavior.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">
      arXiv preprint arXiv:2304.03442
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib13">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Rafailov et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Rafael Rafailov, Archit Sharma, Eric Mitchell, Stefano Ermon, Christopher D
Manning, and Chelsea Finn.
    </span>
    <span class="ltx_bibblock">
     Direct preference optimization: Your language model is secretly a
reward model.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">
      arXiv preprint arXiv:2305.18290
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib14">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Schick et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Timo Schick, Jane Dwivedi-Yu, Roberto Dessì, Roberta Raileanu, Maria
Lomeli, Luke Zettlemoyer, Nicola Cancedda, and Thomas Scialom.
    </span>
    <span class="ltx_bibblock">
     Toolformer: Language models can teach themselves to use tools.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">
      arXiv preprint arXiv:2302.04761
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib15">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Schulman et al. (2015)
    </span>
    <span class="ltx_bibblock">
     John Schulman, Sergey Levine, Philipp Moritz, Michael I. Jordan, and Pieter
Abbeel.
    </span>
    <span class="ltx_bibblock">
     Trust region policy optimization.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">
      CoRR
     </em>
     , abs/1502.05477, 2015.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib16">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Schulman et al. (2017)
    </span>
    <span class="ltx_bibblock">
     John Schulman, Filip Wolski, Prafulla Dhariwal, Alec Radford, and Oleg Klimov.
    </span>
    <span class="ltx_bibblock">
     Proximal policy optimization algorithms.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">
      CoRR
     </em>
     , abs/1707.06347, 2017.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib17">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Shen et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Yongliang Shen, Kaitao Song, Xu Tan, Dongsheng Li, Weiming Lu, and Yueting
Zhuang.
    </span>
    <span class="ltx_bibblock">
     Hugginggpt: Solving ai tasks with chatgpt and its friends in
huggingface.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">
      arXiv preprint arXiv:2303.17580
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib18">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Shinn et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Noah Shinn, Federico Cassano, Beck Labash, Ashwin Gopinath, Karthik Narasimhan,
and Shunyu Yao.
    </span>
    <span class="ltx_bibblock">
     Reflexion: Language agents with verbal reinforcement learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">
      arXiv preprint arXiv:2303.11366
     </em>
     , 2023.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib19">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Snell et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Charlie Snell, Ilya Kostrikov, Yi Su, Mengjiao Yang, and Sergey Levine.
    </span>
    <span class="ltx_bibblock">
     Offline rl for natural language generation with implicit language q
learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">
      arXiv preprint arXiv:2206.11871
     </em>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib20">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Sutton et al. (2000)
    </span>
    <span class="ltx_bibblock">
     R. S. Sutton, D. Mcallester, S. Singh, and Y. Mansour.
    </span>
    <span class="ltx_bibblock">
     Policy gradient methods for reinforcement learning with function
approximation.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">
      Advances in Neural Information Processing Systems 12
     </em>
     ,
volume 12, pp.  1057–1063. MIT Press, 2000.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib21">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Sutton &amp; Barto (2018)
    </span>
    <span class="ltx_bibblock">
     Richard S. Sutton and Andrew G. Barto.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">
      Reinforcement Learning: An Introduction
     </em>
     .
    </span>
    <span class="ltx_bibblock">
     The MIT Press, second edition, 2018.
    </span>
    <span class="ltx_bibblock">
     URL
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://incompleteideas.net/book/the-book-2nd.html" target="_blank" title="">
      http://incompleteideas.net/book/the-book-2nd.html
     </a>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib22">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     von Werra et al. (2020)
    </span>
    <span class="ltx_bibblock">
     Leandro von Werra, Younes Belkada, Lewis Tunstall, Edward Beeching, Tristan
Thrush, and Nathan Lambert.
    </span>
    <span class="ltx_bibblock">
     Trl: Transformer reinforcement learning.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/lvwerra/trl" target="_blank" title="">
      https://github.com/lvwerra/trl
     </a>
     , 2020.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib23">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wei et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Ed Chi, Quoc Le, and
Denny Zhou.
    </span>
    <span class="ltx_bibblock">
     Chain of thought prompting elicits reasoning in large language
models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">
      arXiv preprint arXiv:2201.11903
     </em>
     , 2022.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib24">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yang et al. (2018)
    </span>
    <span class="ltx_bibblock">
     Zhilin Yang, Peng Qi, Saizheng Zhang, Yoshua Bengio, William W. Cohen, Ruslan
Salakhutdinov, and Christopher D. Manning.
    </span>
    <span class="ltx_bibblock">
     HotpotQA: A dataset for diverse, explainable multi-hop question
answering.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">
      Conference on Empirical Methods in Natural Language
Processing (EMNLP)
     </em>
     , 2018.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib25">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yao et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik Narasimhan,
and Yuan Cao.
    </span>
    <span class="ltx_bibblock">
     ReAct: Synergizing reasoning and acting in language models.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">
      International Conference on Learning Representations
(ICLR)
     </em>
     , 2023.
    </span>
   </li>
  </ul>
 </section>
 <div class="ltx_pagination ltx_role_newpage">
 </div>
 <div class="ltx_para ltx_noindent" id="p1">
  <p class="ltx_p" id="p1.1">
   <span class="ltx_text ltx_font_italic" id="p1.1.1">
    Appendix for
    <br class="ltx_break"/>
   </span>
   <br class="ltx_break"/>
   <span class="ltx_text ltx_font_bold" id="p1.1.2">
    “Retroformer: Retrospective Large Language Agents with Policy Gradient Optimization”
   </span>
  </p>
 </div>
 <section class="ltx_appendix" id="A1">
  <h2 class="ltx_title ltx_title_appendix">
   <span class="ltx_tag ltx_tag_appendix">
    Appendix A
   </span>
   Full Examples
  </h2>
  <section class="ltx_subsection" id="A1.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     A.1
    </span>
    Actor Prompt Engineering
   </h3>
   <div class="ltx_para ltx_noindent" id="A1.SS1.p1">
    <p class="ltx_p" id="A1.SS1.p1.1">
     An example of the HotPotQA actor language model prompt is shown below.
    </p>
   </div>
   <figure class="ltx_figure" id="A1.SS1.1">
    <p class="ltx_p" id="A1.SS1.1.1">
     <span class="ltx_text" id="A1.SS1.1.1.1">
      <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="523" id="A1.SS1.1.1.1.g1" src="/html/2308.02151/assets/x7.png" width="422"/>
     </span>
    </p>
   </figure>
  </section>
  <section class="ltx_subsection" id="A1.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     A.2
    </span>
    Retrospective Prompt Engineering
   </h3>
   <div class="ltx_para" id="A1.SS2.p1">
    <p class="ltx_p" id="A1.SS2.p1.1">
     An example of the HotPotQA retrospective instruction prompt is shown below.
    </p>
   </div>
   <figure class="ltx_figure" id="A1.SS2.1">
    <p class="ltx_p" id="A1.SS2.1.1">
     <span class="ltx_text" id="A1.SS2.1.1.1">
      <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_portrait" height="533" id="A1.SS2.1.1.1.g1" src="/html/2308.02151/assets/x8.png" width="422"/>
     </span>
    </p>
   </figure>
  </section>
 </section>
</article>
