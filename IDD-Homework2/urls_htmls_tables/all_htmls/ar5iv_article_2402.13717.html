<article class="ltx_document ltx_authors_1line">
 <h1 class="ltx_title ltx_title_document">
  Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent
 </h1>
 <div class="ltx_authors">
  <span class="ltx_creator ltx_role_author">
   <span class="ltx_personname">
    Xiaoyan Yu
    <sup class="ltx_sup" id="id13.13.id1">
     <span class="ltx_text ltx_font_italic" id="id13.13.id1.1">
      1
     </span>
    </sup>
    Tongxu Luo
    <sup class="ltx_sup" id="id14.14.id2">
     <span class="ltx_text ltx_font_italic" id="id14.14.id2.1">
      2∗
     </span>
    </sup>
    Yifan Wei
    <sup class="ltx_sup" id="id15.15.id3">
     <span class="ltx_text ltx_font_italic" id="id15.15.id3.1">
      3,4
     </span>
    </sup>
    <span class="ltx_text ltx_font_bold" id="id4.4.1">
     Fangyu Lei
     <sup class="ltx_sup" id="id4.4.1.1">
      <span class="ltx_text ltx_font_medium ltx_font_italic" id="id4.4.1.1.1">
       3,4
      </span>
     </sup>
    </span>
    <span class="ltx_text ltx_font_bold" id="id5.5.2">
     Yiming Huang
     <sup class="ltx_sup" id="id5.5.2.1">
      <span class="ltx_text ltx_font_medium ltx_font_italic" id="id5.5.2.1.1">
       3
      </span>
     </sup>
    </span>
    <br class="ltx_break"/>
    <span class="ltx_text ltx_font_bold" id="id6.6.3">
     Hao Peng
     <sup class="ltx_sup" id="id6.6.3.1">
      <span class="ltx_text ltx_font_medium ltx_font_italic" id="id6.6.3.1.1">
       5
      </span>
     </sup>
    </span>
    <span class="ltx_text ltx_font_bold" id="id7.7.4">
     Liehuang Zhu
     <sup class="ltx_sup" id="id7.7.4.1">
      <span class="ltx_text ltx_font_medium ltx_font_italic" id="id7.7.4.1.1">
       1
      </span>
     </sup>
    </span>
    <br class="ltx_break"/>
    <sup class="ltx_sup" id="id16.16.id4">
     <span class="ltx_text ltx_font_italic" id="id16.16.id4.1">
      1
     </span>
    </sup>
    School of Computer Science and Technology, Beijing Institute of Technology
    <br class="ltx_break"/>
    <sup class="ltx_sup" id="id17.17.id5">
     <span class="ltx_text ltx_font_italic" id="id17.17.id5.1">
      2
     </span>
    </sup>
    University of Science and Technology Beijing
    <sup class="ltx_sup" id="id18.18.id6">
     <span class="ltx_text ltx_font_italic" id="id18.18.id6.1">
      3
     </span>
    </sup>
    Institute of Automation, CAS
    <br class="ltx_break"/>
    <sup class="ltx_sup" id="id19.19.id7">
     <span class="ltx_text ltx_font_italic" id="id19.19.id7.1">
      4
     </span>
    </sup>
    University of Chinese Academy of Sciences
    <sup class="ltx_sup" id="id20.20.id8">
     <span class="ltx_text ltx_font_italic" id="id20.20.id8.1">
      5
     </span>
    </sup>
    Beihang University
    <br class="ltx_break"/>
    <span class="ltx_text ltx_font_typewriter" id="id21.21.id9">
     xiaoyan.yu@bit.edu.cn, weiyifan2021@ia.ac.cn
    </span>
   </span>
   <span class="ltx_author_notes">
    Equal Contributions.  Corresponding author.
   </span>
  </span>
 </div>
 <div class="ltx_abstract">
  <h6 class="ltx_title ltx_title_abstract">
   Abstract
  </h6>
  <p class="ltx_p" id="id22.id1">
   Large Language Models (LLMs) have revolutionized open-domain dialogue agents but encounter challenges in multi-character role-playing (MCRP) scenarios.
To address the issue, we present
   <span class="ltx_text ltx_font_bold" id="id22.id1.1">
    Neeko
   </span>
   , an innovative framework designed for efficient multiple characters imitation.
Unlike existing methods, Neeko employs a dynamic low-rank adapter (LoRA) strategy, enabling it to adapt seamlessly to diverse characters.
Our framework breaks down the role-playing process into
agent pre-training, multiple characters playing, and character incremental learning, effectively handling both seen and unseen roles.
This dynamic approach, coupled with distinct LoRA blocks for each character, enhances Neeko’s adaptability to unique attributes, personalities, and speaking patterns.
As a result, Neeko demonstrates superior performance in MCRP over most existing methods, offering more engaging and versatile user interaction experiences.
Code and data are available at
   <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/weiyifan1023/Neeko" target="_blank" title="">
    https://github.com/weiyifan1023/Neeko
   </a>
   .
  </p>
 </div>
 <section class="ltx_section" id="S1">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    1
   </span>
   Introduction
  </h2>
  <div class="ltx_para" id="S1.p1">
   <p class="ltx_p" id="S1.p1.1">
    Large Language Models (LLMs), like ChatGPT
    <cite class="ltx_cite ltx_citemacro_citep">
     (OpenAI,
     <a class="ltx_ref" href="#bib.bib15" title="">
      2023
     </a>
     )
    </cite>
    and GPT-4, excel as open-domain dialogue agents due to their proficiency in interpreting meanings and generating coherent and knowledgeable responses.
Role-playing agents have recently emerged, aiming to enhance user engagement and provide emotional value.
These agents allow users to define and create profiles for their preferred characters
    <span class="ltx_note ltx_role_footnote" id="footnote1">
     <sup class="ltx_note_mark">
      1
     </sup>
     <span class="ltx_note_outer">
      <span class="ltx_note_content">
       <sup class="ltx_note_mark">
        1
       </sup>
       <span class="ltx_tag ltx_tag_note">
        1
       </span>
       In this paper, the term ”character” is equivalent to ”role” and ”persona.”
      </span>
     </span>
    </span>
    , ranging from an empathetic counselor to a witty friend or even embodying a historical figure.
This level of personalization allows these role-playing agents to enhance user satisfaction by providing a diverse and immersive conversational experience.
   </p>
  </div>
  <div class="ltx_para" id="S1.p2">
   <p class="ltx_p" id="S1.p2.1">
    Based on how to direct the agents to play specific characters, current efforts in designing role-playing agent systems can be categorized into three main classes:
(1) In-context learning-based (ICL-based) methods involve providing character-related instructions or prompts within the dialogue context;
(2) Retrieval augmented generation-based (RAG-based) methods, where character-related information is retrieved from a database;
(3) Fine-tuning-based (FT-based) methods consider fine-tuning LLMs using character-specific dialogue history.
Nevertheless, current efforts have yet to discuss agents with the ability to engage in multiple characters role-playing (MCRP).
In contrast, MCRP better aligns with people’s expectations of dialogue agents, as it enables more dynamic and versatile interactions.
   </p>
  </div>
  <div class="ltx_para" id="S1.p3">
   <p class="ltx_p" id="S1.p3.1">
    To fill this gap, we formulate a novel task of Multi-Character Role-Playing (MCRP) agent learning.
Although implementing existing role-playing methods may seem the most straightforward solution, several challenges must be addressed.
    <span class="ltx_text ltx_font_bold" id="S1.p3.1.1">
     Firstly, the majority of current role-playing agents are designed to mimic a single character only.
    </span>
    As a result, when facing the requirement of playing multiple roles, these methods exhibit limitations.
    <span class="ltx_text ltx_font_bold" id="S1.p3.1.2">
     Secondly, existing methods are restricted to predefined characters and cannot adapt to unseen or novel characters.
    </span>
    This limitation renders current agents incapable of meeting the demand for portraying new roles as they emerge.
   </p>
  </div>
  <div class="ltx_para" id="S1.p4">
   <p class="ltx_p" id="S1.p4.1">
    To address the abovementioned challenges, we present Neeko, an incremental role-playing agent that can play multiple characters in long conversations and handle both seen and unseen characters.
Specifically, the framework of Neeko is broken down into several stages: agent pre-training, multiple characters playing, and character incremental learning.
Initially, building upon the trained conversational LLM, we pre-train a LoRA block for each pre-defined character and concatenate them to the LLM.
Given a user-specified character, Neeko employs a Mix of Experts (MoE) gate mechanism to select and activate a corresponding role LoRA block to play the character.
For the incremental learning of unseen or novel characters, we provide two strategies, fusion and expansion, considering two possible situations with limited or abundant character information.
Both strategies obtain a new LoRA block for the incremental character.
Note that this training process differs from the overall model training since it focuses solely on training a single LoRA block without modifying the previous role LoRA blocks.
Theoretically, Neeko has the capability to play an unlimited number of characters as the number of LoRA blocks can continuously increase.
   </p>
  </div>
  <div class="ltx_para" id="S1.p5">
   <p class="ltx_p" id="S1.p5.1">
    To sum up, the contributions of this work are as follows:
   </p>
   <ul class="ltx_itemize" id="S1.I1">
    <li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i1.p1">
      <p class="ltx_p" id="S1.I1.i1.p1.1">
       We formulate the novel task of multi-character role-playing (MCRP) agent learning and propose exclusive evaluation metrics tailored specifically for this task.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i2.p1">
      <p class="ltx_p" id="S1.I1.i2.p1.1">
       To cope with MCRP, we present Neeko, an incremental role-playing agent that can play multiple characters within long conversations and handle both seen and unseen characters well.
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S1.I1.i3.p1">
      <p class="ltx_p" id="S1.I1.i3.p1.1">
       Extensive experiments are conducted using the publicly available dataset Character-LLM-Data and current pervasive LLMs like GPT-3.5 and LLaMA-2. The results demonstrate the challenging nature of the MCRP task. Meanwhile, Neeko surpasses most existing role-playing methods in MCRP, achieving the best overall performance.
      </p>
     </div>
    </li>
   </ul>
  </div>
 </section>
 <section class="ltx_section" id="S2">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    2
   </span>
   Problem Scope
  </h2>
  <figure class="ltx_figure" id="S2.F1">
   <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="154" id="S2.F1.g1" src="/html/2402.13717/assets/x1.png" width="461"/>
   <figcaption class="ltx_caption ltx_centering">
    <span class="ltx_tag ltx_tag_figure">
     Figure 1:
    </span>
    The overall framework of Neeko. The Neeko framework encompasses three main phases: Pre-training, Role-Playing, and Incremental Learning. The Incremental Learning phase includes two strategies fusion and expansion.
   </figcaption>
  </figure>
  <div class="ltx_para" id="S2.p1">
   <p class="ltx_p" id="S2.p1.1">
    In this section, we first present the task formulation of Multi-Character Role-Playing (MCRP) in Section
    <a class="ltx_ref" href="#S2.SS1" title="2.1 Task Formulation: MCRP ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      2.1
     </span>
    </a>
    .
Then, we provide a brief overview of the related technique Low-Rank Adapter (LoRA) in Section
    <a class="ltx_ref" href="#S2.SS2" title="2.2 LoRA: Low-Rank Adapter ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      2.2
     </span>
    </a>
    .
   </p>
  </div>
  <section class="ltx_subsection" id="S2.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.1
    </span>
    Task Formulation: MCRP
   </h3>
   <div class="ltx_para" id="S2.SS1.p1">
    <p class="ltx_p" id="S2.SS1.p1.12">
     The objective of the Multi-Character Role-Playing (MCRP) task is to inject the style of
     <math alttext="M" class="ltx_Math" display="inline" id="S2.SS1.p1.1.m1.1">
      <semantics id="S2.SS1.p1.1.m1.1a">
       <mi id="S2.SS1.p1.1.m1.1.1" xref="S2.SS1.p1.1.m1.1.1.cmml">
        M
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.1.m1.1b">
        <ci id="S2.SS1.p1.1.m1.1.1.cmml" xref="S2.SS1.p1.1.m1.1.1">
         𝑀
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.1.m1.1c">
        M
       </annotation>
      </semantics>
     </math>
     characters into a language model,
enhancing the personalization of conversations.
Specifically, a
     <math alttext="N" class="ltx_Math" display="inline" id="S2.SS1.p1.2.m2.1">
      <semantics id="S2.SS1.p1.2.m2.1a">
       <mi id="S2.SS1.p1.2.m2.1.1" xref="S2.SS1.p1.2.m2.1.1.cmml">
        N
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.2.m2.1b">
        <ci id="S2.SS1.p1.2.m2.1.1.cmml" xref="S2.SS1.p1.2.m2.1.1">
         𝑁
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.2.m2.1c">
        N
       </annotation>
      </semantics>
     </math>
     -turn dialogue MCRP sample is defined as a sequence of utterances
     <math alttext="U=\{u_{1}^{h},u_{1}^{r_{1}},...,u_{i-1}^{h},u_{i-1}^{r_{k}}\}_{i=2}^{N}" class="ltx_Math" display="inline" id="S2.SS1.p1.3.m3.5">
      <semantics id="S2.SS1.p1.3.m3.5a">
       <mrow id="S2.SS1.p1.3.m3.5.5" xref="S2.SS1.p1.3.m3.5.5.cmml">
        <mi id="S2.SS1.p1.3.m3.5.5.6" xref="S2.SS1.p1.3.m3.5.5.6.cmml">
         U
        </mi>
        <mo id="S2.SS1.p1.3.m3.5.5.5" xref="S2.SS1.p1.3.m3.5.5.5.cmml">
         =
        </mo>
        <msubsup id="S2.SS1.p1.3.m3.5.5.4" xref="S2.SS1.p1.3.m3.5.5.4.cmml">
         <mrow id="S2.SS1.p1.3.m3.5.5.4.4.4.4" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.5" stretchy="false" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           {
          </mo>
          <msubsup id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.cmml">
           <mi id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.2" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.2.cmml">
            u
           </mi>
           <mn id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.3" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.3.cmml">
            1
           </mn>
           <mi id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.3" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.3.cmml">
            h
           </mi>
          </msubsup>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.6" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           ,
          </mo>
          <msubsup id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.cmml">
           <mi id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.2.cmml">
            u
           </mi>
           <mn id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.3" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.3.cmml">
            1
           </mn>
           <msub id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.cmml">
            <mi id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.2" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.2.cmml">
             r
            </mi>
            <mn id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.3" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.3.cmml">
             1
            </mn>
           </msub>
          </msubsup>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.7" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           ,
          </mo>
          <mi id="S2.SS1.p1.3.m3.1.1" mathvariant="normal" xref="S2.SS1.p1.3.m3.1.1.cmml">
           …
          </mi>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.8" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           ,
          </mo>
          <msubsup id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.cmml">
           <mi id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.2" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.2.cmml">
            u
           </mi>
           <mrow id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.cmml">
            <mi id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.2" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.2.cmml">
             i
            </mi>
            <mo id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.1" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.1.cmml">
             −
            </mo>
            <mn id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.3" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.3.cmml">
             1
            </mn>
           </mrow>
           <mi id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.3" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.3.cmml">
            h
           </mi>
          </msubsup>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.9" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           ,
          </mo>
          <msubsup id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.cmml">
           <mi id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.2" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.2.cmml">
            u
           </mi>
           <mrow id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.cmml">
            <mi id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.2" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.2.cmml">
             i
            </mi>
            <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.1" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.1.cmml">
             −
            </mo>
            <mn id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.3" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.3.cmml">
             1
            </mn>
           </mrow>
           <msub id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.cmml">
            <mi id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.2" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.2.cmml">
             r
            </mi>
            <mi id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.3" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.3.cmml">
             k
            </mi>
           </msub>
          </msubsup>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.4.4.10" stretchy="false" xref="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml">
           }
          </mo>
         </mrow>
         <mrow id="S2.SS1.p1.3.m3.5.5.4.4.6" xref="S2.SS1.p1.3.m3.5.5.4.4.6.cmml">
          <mi id="S2.SS1.p1.3.m3.5.5.4.4.6.2" xref="S2.SS1.p1.3.m3.5.5.4.4.6.2.cmml">
           i
          </mi>
          <mo id="S2.SS1.p1.3.m3.5.5.4.4.6.1" xref="S2.SS1.p1.3.m3.5.5.4.4.6.1.cmml">
           =
          </mo>
          <mn id="S2.SS1.p1.3.m3.5.5.4.4.6.3" xref="S2.SS1.p1.3.m3.5.5.4.4.6.3.cmml">
           2
          </mn>
         </mrow>
         <mi id="S2.SS1.p1.3.m3.5.5.4.6" xref="S2.SS1.p1.3.m3.5.5.4.6.cmml">
          N
         </mi>
        </msubsup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.3.m3.5b">
        <apply id="S2.SS1.p1.3.m3.5.5.cmml" xref="S2.SS1.p1.3.m3.5.5">
         <eq id="S2.SS1.p1.3.m3.5.5.5.cmml" xref="S2.SS1.p1.3.m3.5.5.5">
         </eq>
         <ci id="S2.SS1.p1.3.m3.5.5.6.cmml" xref="S2.SS1.p1.3.m3.5.5.6">
          𝑈
         </ci>
         <apply id="S2.SS1.p1.3.m3.5.5.4.cmml" xref="S2.SS1.p1.3.m3.5.5.4">
          <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.5.5.4.5.cmml" xref="S2.SS1.p1.3.m3.5.5.4">
           superscript
          </csymbol>
          <apply id="S2.SS1.p1.3.m3.5.5.4.4.cmml" xref="S2.SS1.p1.3.m3.5.5.4">
           <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.5.5.4.4.5.cmml" xref="S2.SS1.p1.3.m3.5.5.4">
            subscript
           </csymbol>
           <set id="S2.SS1.p1.3.m3.5.5.4.4.4.5.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4">
            <apply id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1">
             <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.1.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1">
              superscript
             </csymbol>
             <apply id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.1.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.2.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.2">
               𝑢
              </ci>
              <cn id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.2.3">
               1
              </cn>
             </apply>
             <ci id="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.3.cmml" xref="S2.SS1.p1.3.m3.2.2.1.1.1.1.1.3">
              ℎ
             </ci>
            </apply>
            <apply id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2">
             <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.1.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2">
              superscript
             </csymbol>
             <apply id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.1.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.2">
               𝑢
              </ci>
              <cn id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.2.3">
               1
              </cn>
             </apply>
             <apply id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.1.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.2.cmml" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.2">
               𝑟
              </ci>
              <cn id="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.3.3.2.2.2.2.2.3.3">
               1
              </cn>
             </apply>
            </apply>
            <ci id="S2.SS1.p1.3.m3.1.1.cmml" xref="S2.SS1.p1.3.m3.1.1">
             …
            </ci>
            <apply id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3">
             <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.1.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3">
              superscript
             </csymbol>
             <apply id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.1.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.2.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.2">
               𝑢
              </ci>
              <apply id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3">
               <minus id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.1.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.1">
               </minus>
               <ci id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.2.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.2">
                𝑖
               </ci>
               <cn id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.2.3.3">
                1
               </cn>
              </apply>
             </apply>
             <ci id="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.3.cmml" xref="S2.SS1.p1.3.m3.4.4.3.3.3.3.3.3">
              ℎ
             </ci>
            </apply>
            <apply id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4">
             <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.1.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4">
              superscript
             </csymbol>
             <apply id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.1.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.2.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.2">
               𝑢
              </ci>
              <apply id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3">
               <minus id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.1.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.1">
               </minus>
               <ci id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.2.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.2">
                𝑖
               </ci>
               <cn id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.2.3.3">
                1
               </cn>
              </apply>
             </apply>
             <apply id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3">
              <csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.1.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3">
               subscript
              </csymbol>
              <ci id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.2.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.2">
               𝑟
              </ci>
              <ci id="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.3.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.4.4.4.3.3">
               𝑘
              </ci>
             </apply>
            </apply>
           </set>
           <apply id="S2.SS1.p1.3.m3.5.5.4.4.6.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.6">
            <eq id="S2.SS1.p1.3.m3.5.5.4.4.6.1.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.6.1">
            </eq>
            <ci id="S2.SS1.p1.3.m3.5.5.4.4.6.2.cmml" xref="S2.SS1.p1.3.m3.5.5.4.4.6.2">
             𝑖
            </ci>
            <cn id="S2.SS1.p1.3.m3.5.5.4.4.6.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.5.5.4.4.6.3">
             2
            </cn>
           </apply>
          </apply>
          <ci id="S2.SS1.p1.3.m3.5.5.4.6.cmml" xref="S2.SS1.p1.3.m3.5.5.4.6">
           𝑁
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.3.m3.5c">
        U=\{u_{1}^{h},u_{1}^{r_{1}},...,u_{i-1}^{h},u_{i-1}^{r_{k}}\}_{i=2}^{N}
       </annotation>
      </semantics>
     </math>
     , where
     <math alttext="u_{i}^{h}" class="ltx_Math" display="inline" id="S2.SS1.p1.4.m4.1">
      <semantics id="S2.SS1.p1.4.m4.1a">
       <msubsup id="S2.SS1.p1.4.m4.1.1" xref="S2.SS1.p1.4.m4.1.1.cmml">
        <mi id="S2.SS1.p1.4.m4.1.1.2.2" xref="S2.SS1.p1.4.m4.1.1.2.2.cmml">
         u
        </mi>
        <mi id="S2.SS1.p1.4.m4.1.1.2.3" xref="S2.SS1.p1.4.m4.1.1.2.3.cmml">
         i
        </mi>
        <mi id="S2.SS1.p1.4.m4.1.1.3" xref="S2.SS1.p1.4.m4.1.1.3.cmml">
         h
        </mi>
       </msubsup>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.4.m4.1b">
        <apply id="S2.SS1.p1.4.m4.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1">
         <csymbol cd="ambiguous" id="S2.SS1.p1.4.m4.1.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1">
          superscript
         </csymbol>
         <apply id="S2.SS1.p1.4.m4.1.1.2.cmml" xref="S2.SS1.p1.4.m4.1.1">
          <csymbol cd="ambiguous" id="S2.SS1.p1.4.m4.1.1.2.1.cmml" xref="S2.SS1.p1.4.m4.1.1">
           subscript
          </csymbol>
          <ci id="S2.SS1.p1.4.m4.1.1.2.2.cmml" xref="S2.SS1.p1.4.m4.1.1.2.2">
           𝑢
          </ci>
          <ci id="S2.SS1.p1.4.m4.1.1.2.3.cmml" xref="S2.SS1.p1.4.m4.1.1.2.3">
           𝑖
          </ci>
         </apply>
         <ci id="S2.SS1.p1.4.m4.1.1.3.cmml" xref="S2.SS1.p1.4.m4.1.1.3">
          ℎ
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.4.m4.1c">
        u_{i}^{h}
       </annotation>
      </semantics>
     </math>
     denotes the utterance that the user (human) queries, and
     <math alttext="u_{i}^{r_{k}}" class="ltx_Math" display="inline" id="S2.SS1.p1.5.m5.1">
      <semantics id="S2.SS1.p1.5.m5.1a">
       <msubsup id="S2.SS1.p1.5.m5.1.1" xref="S2.SS1.p1.5.m5.1.1.cmml">
        <mi id="S2.SS1.p1.5.m5.1.1.2.2" xref="S2.SS1.p1.5.m5.1.1.2.2.cmml">
         u
        </mi>
        <mi id="S2.SS1.p1.5.m5.1.1.2.3" xref="S2.SS1.p1.5.m5.1.1.2.3.cmml">
         i
        </mi>
        <msub id="S2.SS1.p1.5.m5.1.1.3" xref="S2.SS1.p1.5.m5.1.1.3.cmml">
         <mi id="S2.SS1.p1.5.m5.1.1.3.2" xref="S2.SS1.p1.5.m5.1.1.3.2.cmml">
          r
         </mi>
         <mi id="S2.SS1.p1.5.m5.1.1.3.3" xref="S2.SS1.p1.5.m5.1.1.3.3.cmml">
          k
         </mi>
        </msub>
       </msubsup>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.5.m5.1b">
        <apply id="S2.SS1.p1.5.m5.1.1.cmml" xref="S2.SS1.p1.5.m5.1.1">
         <csymbol cd="ambiguous" id="S2.SS1.p1.5.m5.1.1.1.cmml" xref="S2.SS1.p1.5.m5.1.1">
          superscript
         </csymbol>
         <apply id="S2.SS1.p1.5.m5.1.1.2.cmml" xref="S2.SS1.p1.5.m5.1.1">
          <csymbol cd="ambiguous" id="S2.SS1.p1.5.m5.1.1.2.1.cmml" xref="S2.SS1.p1.5.m5.1.1">
           subscript
          </csymbol>
          <ci id="S2.SS1.p1.5.m5.1.1.2.2.cmml" xref="S2.SS1.p1.5.m5.1.1.2.2">
           𝑢
          </ci>
          <ci id="S2.SS1.p1.5.m5.1.1.2.3.cmml" xref="S2.SS1.p1.5.m5.1.1.2.3">
           𝑖
          </ci>
         </apply>
         <apply id="S2.SS1.p1.5.m5.1.1.3.cmml" xref="S2.SS1.p1.5.m5.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS1.p1.5.m5.1.1.3.1.cmml" xref="S2.SS1.p1.5.m5.1.1.3">
           subscript
          </csymbol>
          <ci id="S2.SS1.p1.5.m5.1.1.3.2.cmml" xref="S2.SS1.p1.5.m5.1.1.3.2">
           𝑟
          </ci>
          <ci id="S2.SS1.p1.5.m5.1.1.3.3.cmml" xref="S2.SS1.p1.5.m5.1.1.3.3">
           𝑘
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.5.m5.1c">
        u_{i}^{r_{k}}
       </annotation>
      </semantics>
     </math>
     denotes the utterance that the role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S2.SS1.p1.6.m6.1">
      <semantics id="S2.SS1.p1.6.m6.1a">
       <msub id="S2.SS1.p1.6.m6.1.1" xref="S2.SS1.p1.6.m6.1.1.cmml">
        <mi id="S2.SS1.p1.6.m6.1.1.2" xref="S2.SS1.p1.6.m6.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS1.p1.6.m6.1.1.3" xref="S2.SS1.p1.6.m6.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.6.m6.1b">
        <apply id="S2.SS1.p1.6.m6.1.1.cmml" xref="S2.SS1.p1.6.m6.1.1">
         <csymbol cd="ambiguous" id="S2.SS1.p1.6.m6.1.1.1.cmml" xref="S2.SS1.p1.6.m6.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS1.p1.6.m6.1.1.2.cmml" xref="S2.SS1.p1.6.m6.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS1.p1.6.m6.1.1.3.cmml" xref="S2.SS1.p1.6.m6.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.6.m6.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     agent (model) responds to the user at
     <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.p1.7.m7.1">
      <semantics id="S2.SS1.p1.7.m7.1a">
       <mi id="S2.SS1.p1.7.m7.1.1" xref="S2.SS1.p1.7.m7.1.1.cmml">
        i
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.7.m7.1b">
        <ci id="S2.SS1.p1.7.m7.1.1.cmml" xref="S2.SS1.p1.7.m7.1.1">
         𝑖
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.7.m7.1c">
        i
       </annotation>
      </semantics>
     </math>
     -th turn, and
     <math alttext="R=\{r_{k}\}_{k=1}^{M}" class="ltx_Math" display="inline" id="S2.SS1.p1.8.m8.1">
      <semantics id="S2.SS1.p1.8.m8.1a">
       <mrow id="S2.SS1.p1.8.m8.1.1" xref="S2.SS1.p1.8.m8.1.1.cmml">
        <mi id="S2.SS1.p1.8.m8.1.1.3" xref="S2.SS1.p1.8.m8.1.1.3.cmml">
         R
        </mi>
        <mo id="S2.SS1.p1.8.m8.1.1.2" xref="S2.SS1.p1.8.m8.1.1.2.cmml">
         =
        </mo>
        <msubsup id="S2.SS1.p1.8.m8.1.1.1" xref="S2.SS1.p1.8.m8.1.1.1.cmml">
         <mrow id="S2.SS1.p1.8.m8.1.1.1.1.1.1" xref="S2.SS1.p1.8.m8.1.1.1.1.1.2.cmml">
          <mo id="S2.SS1.p1.8.m8.1.1.1.1.1.1.2" stretchy="false" xref="S2.SS1.p1.8.m8.1.1.1.1.1.2.cmml">
           {
          </mo>
          <msub id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.cmml">
           <mi id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.2" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.2.cmml">
            r
           </mi>
           <mi id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.3" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.3.cmml">
            k
           </mi>
          </msub>
          <mo id="S2.SS1.p1.8.m8.1.1.1.1.1.1.3" stretchy="false" xref="S2.SS1.p1.8.m8.1.1.1.1.1.2.cmml">
           }
          </mo>
         </mrow>
         <mrow id="S2.SS1.p1.8.m8.1.1.1.1.3" xref="S2.SS1.p1.8.m8.1.1.1.1.3.cmml">
          <mi id="S2.SS1.p1.8.m8.1.1.1.1.3.2" xref="S2.SS1.p1.8.m8.1.1.1.1.3.2.cmml">
           k
          </mi>
          <mo id="S2.SS1.p1.8.m8.1.1.1.1.3.1" xref="S2.SS1.p1.8.m8.1.1.1.1.3.1.cmml">
           =
          </mo>
          <mn id="S2.SS1.p1.8.m8.1.1.1.1.3.3" xref="S2.SS1.p1.8.m8.1.1.1.1.3.3.cmml">
           1
          </mn>
         </mrow>
         <mi id="S2.SS1.p1.8.m8.1.1.1.3" xref="S2.SS1.p1.8.m8.1.1.1.3.cmml">
          M
         </mi>
        </msubsup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.8.m8.1b">
        <apply id="S2.SS1.p1.8.m8.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1">
         <eq id="S2.SS1.p1.8.m8.1.1.2.cmml" xref="S2.SS1.p1.8.m8.1.1.2">
         </eq>
         <ci id="S2.SS1.p1.8.m8.1.1.3.cmml" xref="S2.SS1.p1.8.m8.1.1.3">
          𝑅
         </ci>
         <apply id="S2.SS1.p1.8.m8.1.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1.1">
          <csymbol cd="ambiguous" id="S2.SS1.p1.8.m8.1.1.1.2.cmml" xref="S2.SS1.p1.8.m8.1.1.1">
           superscript
          </csymbol>
          <apply id="S2.SS1.p1.8.m8.1.1.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1.1">
           <csymbol cd="ambiguous" id="S2.SS1.p1.8.m8.1.1.1.1.2.cmml" xref="S2.SS1.p1.8.m8.1.1.1">
            subscript
           </csymbol>
           <set id="S2.SS1.p1.8.m8.1.1.1.1.1.2.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1">
            <apply id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1">
             <csymbol cd="ambiguous" id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.1.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1">
              subscript
             </csymbol>
             <ci id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.2.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.2">
              𝑟
             </ci>
             <ci id="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.3.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.1.1.1.3">
              𝑘
             </ci>
            </apply>
           </set>
           <apply id="S2.SS1.p1.8.m8.1.1.1.1.3.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.3">
            <eq id="S2.SS1.p1.8.m8.1.1.1.1.3.1.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.3.1">
            </eq>
            <ci id="S2.SS1.p1.8.m8.1.1.1.1.3.2.cmml" xref="S2.SS1.p1.8.m8.1.1.1.1.3.2">
             𝑘
            </ci>
            <cn id="S2.SS1.p1.8.m8.1.1.1.1.3.3.cmml" type="integer" xref="S2.SS1.p1.8.m8.1.1.1.1.3.3">
             1
            </cn>
           </apply>
          </apply>
          <ci id="S2.SS1.p1.8.m8.1.1.1.3.cmml" xref="S2.SS1.p1.8.m8.1.1.1.3">
           𝑀
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.8.m8.1c">
        R=\{r_{k}\}_{k=1}^{M}
       </annotation>
      </semantics>
     </math>
     denotes the transition order of roles in conversations.
When they first meet each other, the dialogue started by the user and the model is expected to generate an answer
     <math alttext="a=u_{i}^{r_{k}}" class="ltx_Math" display="inline" id="S2.SS1.p1.9.m9.1">
      <semantics id="S2.SS1.p1.9.m9.1a">
       <mrow id="S2.SS1.p1.9.m9.1.1" xref="S2.SS1.p1.9.m9.1.1.cmml">
        <mi id="S2.SS1.p1.9.m9.1.1.2" xref="S2.SS1.p1.9.m9.1.1.2.cmml">
         a
        </mi>
        <mo id="S2.SS1.p1.9.m9.1.1.1" xref="S2.SS1.p1.9.m9.1.1.1.cmml">
         =
        </mo>
        <msubsup id="S2.SS1.p1.9.m9.1.1.3" xref="S2.SS1.p1.9.m9.1.1.3.cmml">
         <mi id="S2.SS1.p1.9.m9.1.1.3.2.2" xref="S2.SS1.p1.9.m9.1.1.3.2.2.cmml">
          u
         </mi>
         <mi id="S2.SS1.p1.9.m9.1.1.3.2.3" xref="S2.SS1.p1.9.m9.1.1.3.2.3.cmml">
          i
         </mi>
         <msub id="S2.SS1.p1.9.m9.1.1.3.3" xref="S2.SS1.p1.9.m9.1.1.3.3.cmml">
          <mi id="S2.SS1.p1.9.m9.1.1.3.3.2" xref="S2.SS1.p1.9.m9.1.1.3.3.2.cmml">
           r
          </mi>
          <mi id="S2.SS1.p1.9.m9.1.1.3.3.3" xref="S2.SS1.p1.9.m9.1.1.3.3.3.cmml">
           k
          </mi>
         </msub>
        </msubsup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.9.m9.1b">
        <apply id="S2.SS1.p1.9.m9.1.1.cmml" xref="S2.SS1.p1.9.m9.1.1">
         <eq id="S2.SS1.p1.9.m9.1.1.1.cmml" xref="S2.SS1.p1.9.m9.1.1.1">
         </eq>
         <ci id="S2.SS1.p1.9.m9.1.1.2.cmml" xref="S2.SS1.p1.9.m9.1.1.2">
          𝑎
         </ci>
         <apply id="S2.SS1.p1.9.m9.1.1.3.cmml" xref="S2.SS1.p1.9.m9.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS1.p1.9.m9.1.1.3.1.cmml" xref="S2.SS1.p1.9.m9.1.1.3">
           superscript
          </csymbol>
          <apply id="S2.SS1.p1.9.m9.1.1.3.2.cmml" xref="S2.SS1.p1.9.m9.1.1.3">
           <csymbol cd="ambiguous" id="S2.SS1.p1.9.m9.1.1.3.2.1.cmml" xref="S2.SS1.p1.9.m9.1.1.3">
            subscript
           </csymbol>
           <ci id="S2.SS1.p1.9.m9.1.1.3.2.2.cmml" xref="S2.SS1.p1.9.m9.1.1.3.2.2">
            𝑢
           </ci>
           <ci id="S2.SS1.p1.9.m9.1.1.3.2.3.cmml" xref="S2.SS1.p1.9.m9.1.1.3.2.3">
            𝑖
           </ci>
          </apply>
          <apply id="S2.SS1.p1.9.m9.1.1.3.3.cmml" xref="S2.SS1.p1.9.m9.1.1.3.3">
           <csymbol cd="ambiguous" id="S2.SS1.p1.9.m9.1.1.3.3.1.cmml" xref="S2.SS1.p1.9.m9.1.1.3.3">
            subscript
           </csymbol>
           <ci id="S2.SS1.p1.9.m9.1.1.3.3.2.cmml" xref="S2.SS1.p1.9.m9.1.1.3.3.2">
            𝑟
           </ci>
           <ci id="S2.SS1.p1.9.m9.1.1.3.3.3.cmml" xref="S2.SS1.p1.9.m9.1.1.3.3.3">
            𝑘
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.9.m9.1c">
        a=u_{i}^{r_{k}}
       </annotation>
      </semantics>
     </math>
     according to a given role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S2.SS1.p1.10.m10.1">
      <semantics id="S2.SS1.p1.10.m10.1a">
       <msub id="S2.SS1.p1.10.m10.1.1" xref="S2.SS1.p1.10.m10.1.1.cmml">
        <mi id="S2.SS1.p1.10.m10.1.1.2" xref="S2.SS1.p1.10.m10.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS1.p1.10.m10.1.1.3" xref="S2.SS1.p1.10.m10.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.10.m10.1b">
        <apply id="S2.SS1.p1.10.m10.1.1.cmml" xref="S2.SS1.p1.10.m10.1.1">
         <csymbol cd="ambiguous" id="S2.SS1.p1.10.m10.1.1.1.cmml" xref="S2.SS1.p1.10.m10.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS1.p1.10.m10.1.1.2.cmml" xref="S2.SS1.p1.10.m10.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS1.p1.10.m10.1.1.3.cmml" xref="S2.SS1.p1.10.m10.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.10.m10.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     , the history dialogue
     <math alttext="U" class="ltx_Math" display="inline" id="S2.SS1.p1.11.m11.1">
      <semantics id="S2.SS1.p1.11.m11.1a">
       <mi id="S2.SS1.p1.11.m11.1.1" xref="S2.SS1.p1.11.m11.1.1.cmml">
        U
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.11.m11.1b">
        <ci id="S2.SS1.p1.11.m11.1.1.cmml" xref="S2.SS1.p1.11.m11.1.1">
         𝑈
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.11.m11.1c">
        U
       </annotation>
      </semantics>
     </math>
     , and the question of user
     <math alttext="q=u_{i}^{h}" class="ltx_Math" display="inline" id="S2.SS1.p1.12.m12.1">
      <semantics id="S2.SS1.p1.12.m12.1a">
       <mrow id="S2.SS1.p1.12.m12.1.1" xref="S2.SS1.p1.12.m12.1.1.cmml">
        <mi id="S2.SS1.p1.12.m12.1.1.2" xref="S2.SS1.p1.12.m12.1.1.2.cmml">
         q
        </mi>
        <mo id="S2.SS1.p1.12.m12.1.1.1" xref="S2.SS1.p1.12.m12.1.1.1.cmml">
         =
        </mo>
        <msubsup id="S2.SS1.p1.12.m12.1.1.3" xref="S2.SS1.p1.12.m12.1.1.3.cmml">
         <mi id="S2.SS1.p1.12.m12.1.1.3.2.2" xref="S2.SS1.p1.12.m12.1.1.3.2.2.cmml">
          u
         </mi>
         <mi id="S2.SS1.p1.12.m12.1.1.3.2.3" xref="S2.SS1.p1.12.m12.1.1.3.2.3.cmml">
          i
         </mi>
         <mi id="S2.SS1.p1.12.m12.1.1.3.3" xref="S2.SS1.p1.12.m12.1.1.3.3.cmml">
          h
         </mi>
        </msubsup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p1.12.m12.1b">
        <apply id="S2.SS1.p1.12.m12.1.1.cmml" xref="S2.SS1.p1.12.m12.1.1">
         <eq id="S2.SS1.p1.12.m12.1.1.1.cmml" xref="S2.SS1.p1.12.m12.1.1.1">
         </eq>
         <ci id="S2.SS1.p1.12.m12.1.1.2.cmml" xref="S2.SS1.p1.12.m12.1.1.2">
          𝑞
         </ci>
         <apply id="S2.SS1.p1.12.m12.1.1.3.cmml" xref="S2.SS1.p1.12.m12.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS1.p1.12.m12.1.1.3.1.cmml" xref="S2.SS1.p1.12.m12.1.1.3">
           superscript
          </csymbol>
          <apply id="S2.SS1.p1.12.m12.1.1.3.2.cmml" xref="S2.SS1.p1.12.m12.1.1.3">
           <csymbol cd="ambiguous" id="S2.SS1.p1.12.m12.1.1.3.2.1.cmml" xref="S2.SS1.p1.12.m12.1.1.3">
            subscript
           </csymbol>
           <ci id="S2.SS1.p1.12.m12.1.1.3.2.2.cmml" xref="S2.SS1.p1.12.m12.1.1.3.2.2">
            𝑢
           </ci>
           <ci id="S2.SS1.p1.12.m12.1.1.3.2.3.cmml" xref="S2.SS1.p1.12.m12.1.1.3.2.3">
            𝑖
           </ci>
          </apply>
          <ci id="S2.SS1.p1.12.m12.1.1.3.3.cmml" xref="S2.SS1.p1.12.m12.1.1.3.3">
           ℎ
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p1.12.m12.1c">
        q=u_{i}^{h}
       </annotation>
      </semantics>
     </math>
     .
    </p>
   </div>
   <div class="ltx_para" id="S2.SS1.p2">
    <table class="ltx_equation ltx_eqn_table" id="S2.E1">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="u_{i}^{r_{k}}=\text{argmax}_{a}P(a|q,r_{k},U,\Theta)," class="ltx_Math" display="block" id="S2.E1.m1.4">
         <semantics id="S2.E1.m1.4a">
          <mrow id="S2.E1.m1.4.4.1" xref="S2.E1.m1.4.4.1.1.cmml">
           <mrow id="S2.E1.m1.4.4.1.1" xref="S2.E1.m1.4.4.1.1.cmml">
            <msubsup id="S2.E1.m1.4.4.1.1.3" xref="S2.E1.m1.4.4.1.1.3.cmml">
             <mi id="S2.E1.m1.4.4.1.1.3.2.2" xref="S2.E1.m1.4.4.1.1.3.2.2.cmml">
              u
             </mi>
             <mi id="S2.E1.m1.4.4.1.1.3.2.3" xref="S2.E1.m1.4.4.1.1.3.2.3.cmml">
              i
             </mi>
             <msub id="S2.E1.m1.4.4.1.1.3.3" xref="S2.E1.m1.4.4.1.1.3.3.cmml">
              <mi id="S2.E1.m1.4.4.1.1.3.3.2" xref="S2.E1.m1.4.4.1.1.3.3.2.cmml">
               r
              </mi>
              <mi id="S2.E1.m1.4.4.1.1.3.3.3" xref="S2.E1.m1.4.4.1.1.3.3.3.cmml">
               k
              </mi>
             </msub>
            </msubsup>
            <mo id="S2.E1.m1.4.4.1.1.2" xref="S2.E1.m1.4.4.1.1.2.cmml">
             =
            </mo>
            <mrow id="S2.E1.m1.4.4.1.1.1" xref="S2.E1.m1.4.4.1.1.1.cmml">
             <msub id="S2.E1.m1.4.4.1.1.1.3" xref="S2.E1.m1.4.4.1.1.1.3.cmml">
              <mtext id="S2.E1.m1.4.4.1.1.1.3.2" xref="S2.E1.m1.4.4.1.1.1.3.2a.cmml">
               argmax
              </mtext>
              <mi id="S2.E1.m1.4.4.1.1.1.3.3" xref="S2.E1.m1.4.4.1.1.1.3.3.cmml">
               a
              </mi>
             </msub>
             <mo id="S2.E1.m1.4.4.1.1.1.2" lspace="0em" rspace="0em" xref="S2.E1.m1.4.4.1.1.1.2.cmml">
              ​
             </mo>
             <mi id="S2.E1.m1.4.4.1.1.1.4" xref="S2.E1.m1.4.4.1.1.1.4.cmml">
              P
             </mi>
             <mo id="S2.E1.m1.4.4.1.1.1.2a" lspace="0em" rspace="0em" xref="S2.E1.m1.4.4.1.1.1.2.cmml">
              ​
             </mo>
             <mrow id="S2.E1.m1.4.4.1.1.1.1.1" xref="S2.E1.m1.4.4.1.1.1.1.1.1.cmml">
              <mo id="S2.E1.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S2.E1.m1.4.4.1.1.1.1.1.1.cmml">
               (
              </mo>
              <mrow id="S2.E1.m1.4.4.1.1.1.1.1.1" xref="S2.E1.m1.4.4.1.1.1.1.1.1.cmml">
               <mi id="S2.E1.m1.4.4.1.1.1.1.1.1.3" xref="S2.E1.m1.4.4.1.1.1.1.1.1.3.cmml">
                a
               </mi>
               <mo fence="false" id="S2.E1.m1.4.4.1.1.1.1.1.1.2" xref="S2.E1.m1.4.4.1.1.1.1.1.1.2.cmml">
                |
               </mo>
               <mrow id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml">
                <mi id="S2.E1.m1.1.1" xref="S2.E1.m1.1.1.cmml">
                 q
                </mi>
                <mo id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.2" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml">
                 ,
                </mo>
                <msub id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.cmml">
                 <mi id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml">
                  r
                 </mi>
                 <mi id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml">
                  k
                 </mi>
                </msub>
                <mo id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.3" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml">
                 ,
                </mo>
                <mi id="S2.E1.m1.2.2" xref="S2.E1.m1.2.2.cmml">
                 U
                </mi>
                <mo id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.4" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml">
                 ,
                </mo>
                <mi id="S2.E1.m1.3.3" mathvariant="normal" xref="S2.E1.m1.3.3.cmml">
                 Θ
                </mi>
               </mrow>
              </mrow>
              <mo id="S2.E1.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S2.E1.m1.4.4.1.1.1.1.1.1.cmml">
               )
              </mo>
             </mrow>
            </mrow>
           </mrow>
           <mo id="S2.E1.m1.4.4.1.2" xref="S2.E1.m1.4.4.1.1.cmml">
            ,
           </mo>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S2.E1.m1.4b">
           <apply id="S2.E1.m1.4.4.1.1.cmml" xref="S2.E1.m1.4.4.1">
            <eq id="S2.E1.m1.4.4.1.1.2.cmml" xref="S2.E1.m1.4.4.1.1.2">
            </eq>
            <apply id="S2.E1.m1.4.4.1.1.3.cmml" xref="S2.E1.m1.4.4.1.1.3">
             <csymbol cd="ambiguous" id="S2.E1.m1.4.4.1.1.3.1.cmml" xref="S2.E1.m1.4.4.1.1.3">
              superscript
             </csymbol>
             <apply id="S2.E1.m1.4.4.1.1.3.2.cmml" xref="S2.E1.m1.4.4.1.1.3">
              <csymbol cd="ambiguous" id="S2.E1.m1.4.4.1.1.3.2.1.cmml" xref="S2.E1.m1.4.4.1.1.3">
               subscript
              </csymbol>
              <ci id="S2.E1.m1.4.4.1.1.3.2.2.cmml" xref="S2.E1.m1.4.4.1.1.3.2.2">
               𝑢
              </ci>
              <ci id="S2.E1.m1.4.4.1.1.3.2.3.cmml" xref="S2.E1.m1.4.4.1.1.3.2.3">
               𝑖
              </ci>
             </apply>
             <apply id="S2.E1.m1.4.4.1.1.3.3.cmml" xref="S2.E1.m1.4.4.1.1.3.3">
              <csymbol cd="ambiguous" id="S2.E1.m1.4.4.1.1.3.3.1.cmml" xref="S2.E1.m1.4.4.1.1.3.3">
               subscript
              </csymbol>
              <ci id="S2.E1.m1.4.4.1.1.3.3.2.cmml" xref="S2.E1.m1.4.4.1.1.3.3.2">
               𝑟
              </ci>
              <ci id="S2.E1.m1.4.4.1.1.3.3.3.cmml" xref="S2.E1.m1.4.4.1.1.3.3.3">
               𝑘
              </ci>
             </apply>
            </apply>
            <apply id="S2.E1.m1.4.4.1.1.1.cmml" xref="S2.E1.m1.4.4.1.1.1">
             <times id="S2.E1.m1.4.4.1.1.1.2.cmml" xref="S2.E1.m1.4.4.1.1.1.2">
             </times>
             <apply id="S2.E1.m1.4.4.1.1.1.3.cmml" xref="S2.E1.m1.4.4.1.1.1.3">
              <csymbol cd="ambiguous" id="S2.E1.m1.4.4.1.1.1.3.1.cmml" xref="S2.E1.m1.4.4.1.1.1.3">
               subscript
              </csymbol>
              <ci id="S2.E1.m1.4.4.1.1.1.3.2a.cmml" xref="S2.E1.m1.4.4.1.1.1.3.2">
               <mtext id="S2.E1.m1.4.4.1.1.1.3.2.cmml" xref="S2.E1.m1.4.4.1.1.1.3.2">
                argmax
               </mtext>
              </ci>
              <ci id="S2.E1.m1.4.4.1.1.1.3.3.cmml" xref="S2.E1.m1.4.4.1.1.1.3.3">
               𝑎
              </ci>
             </apply>
             <ci id="S2.E1.m1.4.4.1.1.1.4.cmml" xref="S2.E1.m1.4.4.1.1.1.4">
              𝑃
             </ci>
             <apply id="S2.E1.m1.4.4.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1">
              <csymbol cd="latexml" id="S2.E1.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.2">
               conditional
              </csymbol>
              <ci id="S2.E1.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.3">
               𝑎
              </ci>
              <list id="S2.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1">
               <ci id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1">
                𝑞
               </ci>
               <apply id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1">
                <csymbol cd="ambiguous" id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1">
                 subscript
                </csymbol>
                <ci id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.2">
                 𝑟
                </ci>
                <ci id="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.4.4.1.1.1.1.1.1.1.1.1.3">
                 𝑘
                </ci>
               </apply>
               <ci id="S2.E1.m1.2.2.cmml" xref="S2.E1.m1.2.2">
                𝑈
               </ci>
               <ci id="S2.E1.m1.3.3.cmml" xref="S2.E1.m1.3.3">
                Θ
               </ci>
              </list>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S2.E1.m1.4c">
           u_{i}^{r_{k}}=\text{argmax}_{a}P(a|q,r_{k},U,\Theta),
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (1)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S2.SS1.p2.2">
     where
     <math alttext="\Theta" class="ltx_Math" display="inline" id="S2.SS1.p2.1.m1.1">
      <semantics id="S2.SS1.p2.1.m1.1a">
       <mi id="S2.SS1.p2.1.m1.1.1" mathvariant="normal" xref="S2.SS1.p2.1.m1.1.1.cmml">
        Θ
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS1.p2.1.m1.1b">
        <ci id="S2.SS1.p2.1.m1.1.1.cmml" xref="S2.SS1.p2.1.m1.1.1">
         Θ
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS1.p2.1.m1.1c">
        \Theta
       </annotation>
      </semantics>
     </math>
     represents the language model parameters, which are static during inference.
Specially, we can specify a certain instruction prompt
     <span class="ltx_text ltx_font_italic" id="S2.SS1.p2.2.2">
      “I want you to act like
     </span>
     {
     <span class="ltx_text ltx_font_italic" id="S2.SS1.p2.2.3">
      character
     </span>
     }
     <span class="ltx_text ltx_font_italic" id="S2.SS1.p2.2.1">
      <math alttext="\dots" class="ltx_Math" display="inline" id="S2.SS1.p2.2.1.m1.1">
       <semantics id="S2.SS1.p2.2.1.m1.1a">
        <mi id="S2.SS1.p2.2.1.m1.1.1" xref="S2.SS1.p2.2.1.m1.1.1.cmml">
         …
        </mi>
        <annotation-xml encoding="MathML-Content" id="S2.SS1.p2.2.1.m1.1b">
         <ci id="S2.SS1.p2.2.1.m1.1.1.cmml" xref="S2.SS1.p2.2.1.m1.1.1">
          italic-…
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S2.SS1.p2.2.1.m1.1c">
         \dots
        </annotation>
       </semantics>
      </math>
      ”
     </span>
     to achieve emulation of the designated character in the ongoing conversation.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S2.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     2.2
    </span>
    LoRA: Low-Rank Adapter
   </h3>
   <div class="ltx_para" id="S2.SS2.p1">
    <p class="ltx_p" id="S2.SS2.p1.1">
     Low-rank Adapter (LoRA)
     <cite class="ltx_cite ltx_citemacro_citep">
      (Hu et al.,
      <a class="ltx_ref" href="#bib.bib8" title="">
       2021
      </a>
      )
     </cite>
     has proven to be both effective and efficient in the fine-tuning of Large Language Models.
As our approach builds upon the foundational principles of LoRA, it is pertinent to provide a brief overview of its workings. LoRA is inspired by the low intrinsic dimension characteristic
     <cite class="ltx_cite ltx_citemacro_citep">
      (Aghajanyan et al.,
      <a class="ltx_ref" href="#bib.bib1" title="">
       2020
      </a>
      )
     </cite>
     , which hypothesize the updates to any parameter weights in LLMs as a low-rank decomposition.
    </p>
   </div>
   <div class="ltx_para" id="S2.SS2.p2">
    <p class="ltx_p" id="S2.SS2.p2.5">
     Assume that
     <math alttext="W_{0}\in\mathbb{R}^{m\times d}" class="ltx_Math" display="inline" id="S2.SS2.p2.1.m1.1">
      <semantics id="S2.SS2.p2.1.m1.1a">
       <mrow id="S2.SS2.p2.1.m1.1.1" xref="S2.SS2.p2.1.m1.1.1.cmml">
        <msub id="S2.SS2.p2.1.m1.1.1.2" xref="S2.SS2.p2.1.m1.1.1.2.cmml">
         <mi id="S2.SS2.p2.1.m1.1.1.2.2" xref="S2.SS2.p2.1.m1.1.1.2.2.cmml">
          W
         </mi>
         <mn id="S2.SS2.p2.1.m1.1.1.2.3" xref="S2.SS2.p2.1.m1.1.1.2.3.cmml">
          0
         </mn>
        </msub>
        <mo id="S2.SS2.p2.1.m1.1.1.1" xref="S2.SS2.p2.1.m1.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S2.SS2.p2.1.m1.1.1.3" xref="S2.SS2.p2.1.m1.1.1.3.cmml">
         <mi id="S2.SS2.p2.1.m1.1.1.3.2" xref="S2.SS2.p2.1.m1.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S2.SS2.p2.1.m1.1.1.3.3" xref="S2.SS2.p2.1.m1.1.1.3.3.cmml">
          <mi id="S2.SS2.p2.1.m1.1.1.3.3.2" xref="S2.SS2.p2.1.m1.1.1.3.3.2.cmml">
           m
          </mi>
          <mo id="S2.SS2.p2.1.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS2.p2.1.m1.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S2.SS2.p2.1.m1.1.1.3.3.3" xref="S2.SS2.p2.1.m1.1.1.3.3.3.cmml">
           d
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.1.m1.1b">
        <apply id="S2.SS2.p2.1.m1.1.1.cmml" xref="S2.SS2.p2.1.m1.1.1">
         <in id="S2.SS2.p2.1.m1.1.1.1.cmml" xref="S2.SS2.p2.1.m1.1.1.1">
         </in>
         <apply id="S2.SS2.p2.1.m1.1.1.2.cmml" xref="S2.SS2.p2.1.m1.1.1.2">
          <csymbol cd="ambiguous" id="S2.SS2.p2.1.m1.1.1.2.1.cmml" xref="S2.SS2.p2.1.m1.1.1.2">
           subscript
          </csymbol>
          <ci id="S2.SS2.p2.1.m1.1.1.2.2.cmml" xref="S2.SS2.p2.1.m1.1.1.2.2">
           𝑊
          </ci>
          <cn id="S2.SS2.p2.1.m1.1.1.2.3.cmml" type="integer" xref="S2.SS2.p2.1.m1.1.1.2.3">
           0
          </cn>
         </apply>
         <apply id="S2.SS2.p2.1.m1.1.1.3.cmml" xref="S2.SS2.p2.1.m1.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS2.p2.1.m1.1.1.3.1.cmml" xref="S2.SS2.p2.1.m1.1.1.3">
           superscript
          </csymbol>
          <ci id="S2.SS2.p2.1.m1.1.1.3.2.cmml" xref="S2.SS2.p2.1.m1.1.1.3.2">
           ℝ
          </ci>
          <apply id="S2.SS2.p2.1.m1.1.1.3.3.cmml" xref="S2.SS2.p2.1.m1.1.1.3.3">
           <times id="S2.SS2.p2.1.m1.1.1.3.3.1.cmml" xref="S2.SS2.p2.1.m1.1.1.3.3.1">
           </times>
           <ci id="S2.SS2.p2.1.m1.1.1.3.3.2.cmml" xref="S2.SS2.p2.1.m1.1.1.3.3.2">
            𝑚
           </ci>
           <ci id="S2.SS2.p2.1.m1.1.1.3.3.3.cmml" xref="S2.SS2.p2.1.m1.1.1.3.3.3">
            𝑑
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.1.m1.1c">
        W_{0}\in\mathbb{R}^{m\times d}
       </annotation>
      </semantics>
     </math>
     represents the parameter matrix of the
pre-trained LLM which is accompanied by a LoRA decomposition
     <math alttext="\Delta W=BA" class="ltx_Math" display="inline" id="S2.SS2.p2.2.m2.1">
      <semantics id="S2.SS2.p2.2.m2.1a">
       <mrow id="S2.SS2.p2.2.m2.1.1" xref="S2.SS2.p2.2.m2.1.1.cmml">
        <mrow id="S2.SS2.p2.2.m2.1.1.2" xref="S2.SS2.p2.2.m2.1.1.2.cmml">
         <mi id="S2.SS2.p2.2.m2.1.1.2.2" mathvariant="normal" xref="S2.SS2.p2.2.m2.1.1.2.2.cmml">
          Δ
         </mi>
         <mo id="S2.SS2.p2.2.m2.1.1.2.1" lspace="0em" rspace="0em" xref="S2.SS2.p2.2.m2.1.1.2.1.cmml">
          ​
         </mo>
         <mi id="S2.SS2.p2.2.m2.1.1.2.3" xref="S2.SS2.p2.2.m2.1.1.2.3.cmml">
          W
         </mi>
        </mrow>
        <mo id="S2.SS2.p2.2.m2.1.1.1" xref="S2.SS2.p2.2.m2.1.1.1.cmml">
         =
        </mo>
        <mrow id="S2.SS2.p2.2.m2.1.1.3" xref="S2.SS2.p2.2.m2.1.1.3.cmml">
         <mi id="S2.SS2.p2.2.m2.1.1.3.2" xref="S2.SS2.p2.2.m2.1.1.3.2.cmml">
          B
         </mi>
         <mo id="S2.SS2.p2.2.m2.1.1.3.1" lspace="0em" rspace="0em" xref="S2.SS2.p2.2.m2.1.1.3.1.cmml">
          ​
         </mo>
         <mi id="S2.SS2.p2.2.m2.1.1.3.3" xref="S2.SS2.p2.2.m2.1.1.3.3.cmml">
          A
         </mi>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.2.m2.1b">
        <apply id="S2.SS2.p2.2.m2.1.1.cmml" xref="S2.SS2.p2.2.m2.1.1">
         <eq id="S2.SS2.p2.2.m2.1.1.1.cmml" xref="S2.SS2.p2.2.m2.1.1.1">
         </eq>
         <apply id="S2.SS2.p2.2.m2.1.1.2.cmml" xref="S2.SS2.p2.2.m2.1.1.2">
          <times id="S2.SS2.p2.2.m2.1.1.2.1.cmml" xref="S2.SS2.p2.2.m2.1.1.2.1">
          </times>
          <ci id="S2.SS2.p2.2.m2.1.1.2.2.cmml" xref="S2.SS2.p2.2.m2.1.1.2.2">
           Δ
          </ci>
          <ci id="S2.SS2.p2.2.m2.1.1.2.3.cmml" xref="S2.SS2.p2.2.m2.1.1.2.3">
           𝑊
          </ci>
         </apply>
         <apply id="S2.SS2.p2.2.m2.1.1.3.cmml" xref="S2.SS2.p2.2.m2.1.1.3">
          <times id="S2.SS2.p2.2.m2.1.1.3.1.cmml" xref="S2.SS2.p2.2.m2.1.1.3.1">
          </times>
          <ci id="S2.SS2.p2.2.m2.1.1.3.2.cmml" xref="S2.SS2.p2.2.m2.1.1.3.2">
           𝐵
          </ci>
          <ci id="S2.SS2.p2.2.m2.1.1.3.3.cmml" xref="S2.SS2.p2.2.m2.1.1.3.3">
           𝐴
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.2.m2.1c">
        \Delta W=BA
       </annotation>
      </semantics>
     </math>
     , where
     <math alttext="B\in\mathbb{R}^{m\times r}" class="ltx_Math" display="inline" id="S2.SS2.p2.3.m3.1">
      <semantics id="S2.SS2.p2.3.m3.1a">
       <mrow id="S2.SS2.p2.3.m3.1.1" xref="S2.SS2.p2.3.m3.1.1.cmml">
        <mi id="S2.SS2.p2.3.m3.1.1.2" xref="S2.SS2.p2.3.m3.1.1.2.cmml">
         B
        </mi>
        <mo id="S2.SS2.p2.3.m3.1.1.1" xref="S2.SS2.p2.3.m3.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S2.SS2.p2.3.m3.1.1.3" xref="S2.SS2.p2.3.m3.1.1.3.cmml">
         <mi id="S2.SS2.p2.3.m3.1.1.3.2" xref="S2.SS2.p2.3.m3.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S2.SS2.p2.3.m3.1.1.3.3" xref="S2.SS2.p2.3.m3.1.1.3.3.cmml">
          <mi id="S2.SS2.p2.3.m3.1.1.3.3.2" xref="S2.SS2.p2.3.m3.1.1.3.3.2.cmml">
           m
          </mi>
          <mo id="S2.SS2.p2.3.m3.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS2.p2.3.m3.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S2.SS2.p2.3.m3.1.1.3.3.3" xref="S2.SS2.p2.3.m3.1.1.3.3.3.cmml">
           r
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.3.m3.1b">
        <apply id="S2.SS2.p2.3.m3.1.1.cmml" xref="S2.SS2.p2.3.m3.1.1">
         <in id="S2.SS2.p2.3.m3.1.1.1.cmml" xref="S2.SS2.p2.3.m3.1.1.1">
         </in>
         <ci id="S2.SS2.p2.3.m3.1.1.2.cmml" xref="S2.SS2.p2.3.m3.1.1.2">
          𝐵
         </ci>
         <apply id="S2.SS2.p2.3.m3.1.1.3.cmml" xref="S2.SS2.p2.3.m3.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS2.p2.3.m3.1.1.3.1.cmml" xref="S2.SS2.p2.3.m3.1.1.3">
           superscript
          </csymbol>
          <ci id="S2.SS2.p2.3.m3.1.1.3.2.cmml" xref="S2.SS2.p2.3.m3.1.1.3.2">
           ℝ
          </ci>
          <apply id="S2.SS2.p2.3.m3.1.1.3.3.cmml" xref="S2.SS2.p2.3.m3.1.1.3.3">
           <times id="S2.SS2.p2.3.m3.1.1.3.3.1.cmml" xref="S2.SS2.p2.3.m3.1.1.3.3.1">
           </times>
           <ci id="S2.SS2.p2.3.m3.1.1.3.3.2.cmml" xref="S2.SS2.p2.3.m3.1.1.3.3.2">
            𝑚
           </ci>
           <ci id="S2.SS2.p2.3.m3.1.1.3.3.3.cmml" xref="S2.SS2.p2.3.m3.1.1.3.3.3">
            𝑟
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.3.m3.1c">
        B\in\mathbb{R}^{m\times r}
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="A\in\mathbb{R}^{r\times d}" class="ltx_Math" display="inline" id="S2.SS2.p2.4.m4.1">
      <semantics id="S2.SS2.p2.4.m4.1a">
       <mrow id="S2.SS2.p2.4.m4.1.1" xref="S2.SS2.p2.4.m4.1.1.cmml">
        <mi id="S2.SS2.p2.4.m4.1.1.2" xref="S2.SS2.p2.4.m4.1.1.2.cmml">
         A
        </mi>
        <mo id="S2.SS2.p2.4.m4.1.1.1" xref="S2.SS2.p2.4.m4.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S2.SS2.p2.4.m4.1.1.3" xref="S2.SS2.p2.4.m4.1.1.3.cmml">
         <mi id="S2.SS2.p2.4.m4.1.1.3.2" xref="S2.SS2.p2.4.m4.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S2.SS2.p2.4.m4.1.1.3.3" xref="S2.SS2.p2.4.m4.1.1.3.3.cmml">
          <mi id="S2.SS2.p2.4.m4.1.1.3.3.2" xref="S2.SS2.p2.4.m4.1.1.3.3.2.cmml">
           r
          </mi>
          <mo id="S2.SS2.p2.4.m4.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS2.p2.4.m4.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S2.SS2.p2.4.m4.1.1.3.3.3" xref="S2.SS2.p2.4.m4.1.1.3.3.3.cmml">
           d
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.4.m4.1b">
        <apply id="S2.SS2.p2.4.m4.1.1.cmml" xref="S2.SS2.p2.4.m4.1.1">
         <in id="S2.SS2.p2.4.m4.1.1.1.cmml" xref="S2.SS2.p2.4.m4.1.1.1">
         </in>
         <ci id="S2.SS2.p2.4.m4.1.1.2.cmml" xref="S2.SS2.p2.4.m4.1.1.2">
          𝐴
         </ci>
         <apply id="S2.SS2.p2.4.m4.1.1.3.cmml" xref="S2.SS2.p2.4.m4.1.1.3">
          <csymbol cd="ambiguous" id="S2.SS2.p2.4.m4.1.1.3.1.cmml" xref="S2.SS2.p2.4.m4.1.1.3">
           superscript
          </csymbol>
          <ci id="S2.SS2.p2.4.m4.1.1.3.2.cmml" xref="S2.SS2.p2.4.m4.1.1.3.2">
           ℝ
          </ci>
          <apply id="S2.SS2.p2.4.m4.1.1.3.3.cmml" xref="S2.SS2.p2.4.m4.1.1.3.3">
           <times id="S2.SS2.p2.4.m4.1.1.3.3.1.cmml" xref="S2.SS2.p2.4.m4.1.1.3.3.1">
           </times>
           <ci id="S2.SS2.p2.4.m4.1.1.3.3.2.cmml" xref="S2.SS2.p2.4.m4.1.1.3.3.2">
            𝑟
           </ci>
           <ci id="S2.SS2.p2.4.m4.1.1.3.3.3.cmml" xref="S2.SS2.p2.4.m4.1.1.3.3.3">
            𝑑
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.4.m4.1c">
        A\in\mathbb{R}^{r\times d}
       </annotation>
      </semantics>
     </math>
     are low-rank and trainable matrices.
For the original
     <math alttext="h=W_{0}x" class="ltx_Math" display="inline" id="S2.SS2.p2.5.m5.1">
      <semantics id="S2.SS2.p2.5.m5.1a">
       <mrow id="S2.SS2.p2.5.m5.1.1" xref="S2.SS2.p2.5.m5.1.1.cmml">
        <mi id="S2.SS2.p2.5.m5.1.1.2" xref="S2.SS2.p2.5.m5.1.1.2.cmml">
         h
        </mi>
        <mo id="S2.SS2.p2.5.m5.1.1.1" xref="S2.SS2.p2.5.m5.1.1.1.cmml">
         =
        </mo>
        <mrow id="S2.SS2.p2.5.m5.1.1.3" xref="S2.SS2.p2.5.m5.1.1.3.cmml">
         <msub id="S2.SS2.p2.5.m5.1.1.3.2" xref="S2.SS2.p2.5.m5.1.1.3.2.cmml">
          <mi id="S2.SS2.p2.5.m5.1.1.3.2.2" xref="S2.SS2.p2.5.m5.1.1.3.2.2.cmml">
           W
          </mi>
          <mn id="S2.SS2.p2.5.m5.1.1.3.2.3" xref="S2.SS2.p2.5.m5.1.1.3.2.3.cmml">
           0
          </mn>
         </msub>
         <mo id="S2.SS2.p2.5.m5.1.1.3.1" lspace="0em" rspace="0em" xref="S2.SS2.p2.5.m5.1.1.3.1.cmml">
          ​
         </mo>
         <mi id="S2.SS2.p2.5.m5.1.1.3.3" xref="S2.SS2.p2.5.m5.1.1.3.3.cmml">
          x
         </mi>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.5.m5.1b">
        <apply id="S2.SS2.p2.5.m5.1.1.cmml" xref="S2.SS2.p2.5.m5.1.1">
         <eq id="S2.SS2.p2.5.m5.1.1.1.cmml" xref="S2.SS2.p2.5.m5.1.1.1">
         </eq>
         <ci id="S2.SS2.p2.5.m5.1.1.2.cmml" xref="S2.SS2.p2.5.m5.1.1.2">
          ℎ
         </ci>
         <apply id="S2.SS2.p2.5.m5.1.1.3.cmml" xref="S2.SS2.p2.5.m5.1.1.3">
          <times id="S2.SS2.p2.5.m5.1.1.3.1.cmml" xref="S2.SS2.p2.5.m5.1.1.3.1">
          </times>
          <apply id="S2.SS2.p2.5.m5.1.1.3.2.cmml" xref="S2.SS2.p2.5.m5.1.1.3.2">
           <csymbol cd="ambiguous" id="S2.SS2.p2.5.m5.1.1.3.2.1.cmml" xref="S2.SS2.p2.5.m5.1.1.3.2">
            subscript
           </csymbol>
           <ci id="S2.SS2.p2.5.m5.1.1.3.2.2.cmml" xref="S2.SS2.p2.5.m5.1.1.3.2.2">
            𝑊
           </ci>
           <cn id="S2.SS2.p2.5.m5.1.1.3.2.3.cmml" type="integer" xref="S2.SS2.p2.5.m5.1.1.3.2.3">
            0
           </cn>
          </apply>
          <ci id="S2.SS2.p2.5.m5.1.1.3.3.cmml" xref="S2.SS2.p2.5.m5.1.1.3.3">
           𝑥
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.5.m5.1c">
        h=W_{0}x
       </annotation>
      </semantics>
     </math>
     , the modified forward pass yields:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S2.E2">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="h=W_{0}x+\Delta Wx=W_{0}x+\frac{\alpha}{r}BAx," class="ltx_Math" display="block" id="S2.E2.m1.1">
         <semantics id="S2.E2.m1.1a">
          <mrow id="S2.E2.m1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml">
           <mrow id="S2.E2.m1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml">
            <mi id="S2.E2.m1.1.1.1.1.2" xref="S2.E2.m1.1.1.1.1.2.cmml">
             h
            </mi>
            <mo id="S2.E2.m1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.3.cmml">
             =
            </mo>
            <mrow id="S2.E2.m1.1.1.1.1.4" xref="S2.E2.m1.1.1.1.1.4.cmml">
             <mrow id="S2.E2.m1.1.1.1.1.4.2" xref="S2.E2.m1.1.1.1.1.4.2.cmml">
              <msub id="S2.E2.m1.1.1.1.1.4.2.2" xref="S2.E2.m1.1.1.1.1.4.2.2.cmml">
               <mi id="S2.E2.m1.1.1.1.1.4.2.2.2" xref="S2.E2.m1.1.1.1.1.4.2.2.2.cmml">
                W
               </mi>
               <mn id="S2.E2.m1.1.1.1.1.4.2.2.3" xref="S2.E2.m1.1.1.1.1.4.2.2.3.cmml">
                0
               </mn>
              </msub>
              <mo id="S2.E2.m1.1.1.1.1.4.2.1" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.4.2.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.4.2.3" xref="S2.E2.m1.1.1.1.1.4.2.3.cmml">
               x
              </mi>
             </mrow>
             <mo id="S2.E2.m1.1.1.1.1.4.1" xref="S2.E2.m1.1.1.1.1.4.1.cmml">
              +
             </mo>
             <mrow id="S2.E2.m1.1.1.1.1.4.3" xref="S2.E2.m1.1.1.1.1.4.3.cmml">
              <mi id="S2.E2.m1.1.1.1.1.4.3.2" mathvariant="normal" xref="S2.E2.m1.1.1.1.1.4.3.2.cmml">
               Δ
              </mi>
              <mo id="S2.E2.m1.1.1.1.1.4.3.1" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.4.3.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.4.3.3" xref="S2.E2.m1.1.1.1.1.4.3.3.cmml">
               W
              </mi>
              <mo id="S2.E2.m1.1.1.1.1.4.3.1a" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.4.3.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.4.3.4" xref="S2.E2.m1.1.1.1.1.4.3.4.cmml">
               x
              </mi>
             </mrow>
            </mrow>
            <mo id="S2.E2.m1.1.1.1.1.5" xref="S2.E2.m1.1.1.1.1.5.cmml">
             =
            </mo>
            <mrow id="S2.E2.m1.1.1.1.1.6" xref="S2.E2.m1.1.1.1.1.6.cmml">
             <mrow id="S2.E2.m1.1.1.1.1.6.2" xref="S2.E2.m1.1.1.1.1.6.2.cmml">
              <msub id="S2.E2.m1.1.1.1.1.6.2.2" xref="S2.E2.m1.1.1.1.1.6.2.2.cmml">
               <mi id="S2.E2.m1.1.1.1.1.6.2.2.2" xref="S2.E2.m1.1.1.1.1.6.2.2.2.cmml">
                W
               </mi>
               <mn id="S2.E2.m1.1.1.1.1.6.2.2.3" xref="S2.E2.m1.1.1.1.1.6.2.2.3.cmml">
                0
               </mn>
              </msub>
              <mo id="S2.E2.m1.1.1.1.1.6.2.1" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.6.2.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.6.2.3" xref="S2.E2.m1.1.1.1.1.6.2.3.cmml">
               x
              </mi>
             </mrow>
             <mo id="S2.E2.m1.1.1.1.1.6.1" xref="S2.E2.m1.1.1.1.1.6.1.cmml">
              +
             </mo>
             <mrow id="S2.E2.m1.1.1.1.1.6.3" xref="S2.E2.m1.1.1.1.1.6.3.cmml">
              <mfrac id="S2.E2.m1.1.1.1.1.6.3.2" xref="S2.E2.m1.1.1.1.1.6.3.2.cmml">
               <mi id="S2.E2.m1.1.1.1.1.6.3.2.2" xref="S2.E2.m1.1.1.1.1.6.3.2.2.cmml">
                α
               </mi>
               <mi id="S2.E2.m1.1.1.1.1.6.3.2.3" xref="S2.E2.m1.1.1.1.1.6.3.2.3.cmml">
                r
               </mi>
              </mfrac>
              <mo id="S2.E2.m1.1.1.1.1.6.3.1" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.6.3.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.6.3.3" xref="S2.E2.m1.1.1.1.1.6.3.3.cmml">
               B
              </mi>
              <mo id="S2.E2.m1.1.1.1.1.6.3.1a" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.6.3.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.6.3.4" xref="S2.E2.m1.1.1.1.1.6.3.4.cmml">
               A
              </mi>
              <mo id="S2.E2.m1.1.1.1.1.6.3.1b" lspace="0em" rspace="0em" xref="S2.E2.m1.1.1.1.1.6.3.1.cmml">
               ​
              </mo>
              <mi id="S2.E2.m1.1.1.1.1.6.3.5" xref="S2.E2.m1.1.1.1.1.6.3.5.cmml">
               x
              </mi>
             </mrow>
            </mrow>
           </mrow>
           <mo id="S2.E2.m1.1.1.1.2" xref="S2.E2.m1.1.1.1.1.cmml">
            ,
           </mo>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S2.E2.m1.1b">
           <apply id="S2.E2.m1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1">
            <and id="S2.E2.m1.1.1.1.1a.cmml" xref="S2.E2.m1.1.1.1">
            </and>
            <apply id="S2.E2.m1.1.1.1.1b.cmml" xref="S2.E2.m1.1.1.1">
             <eq id="S2.E2.m1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.3">
             </eq>
             <ci id="S2.E2.m1.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.2">
              ℎ
             </ci>
             <apply id="S2.E2.m1.1.1.1.1.4.cmml" xref="S2.E2.m1.1.1.1.1.4">
              <plus id="S2.E2.m1.1.1.1.1.4.1.cmml" xref="S2.E2.m1.1.1.1.1.4.1">
              </plus>
              <apply id="S2.E2.m1.1.1.1.1.4.2.cmml" xref="S2.E2.m1.1.1.1.1.4.2">
               <times id="S2.E2.m1.1.1.1.1.4.2.1.cmml" xref="S2.E2.m1.1.1.1.1.4.2.1">
               </times>
               <apply id="S2.E2.m1.1.1.1.1.4.2.2.cmml" xref="S2.E2.m1.1.1.1.1.4.2.2">
                <csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.4.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.4.2.2">
                 subscript
                </csymbol>
                <ci id="S2.E2.m1.1.1.1.1.4.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.4.2.2.2">
                 𝑊
                </ci>
                <cn id="S2.E2.m1.1.1.1.1.4.2.2.3.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.4.2.2.3">
                 0
                </cn>
               </apply>
               <ci id="S2.E2.m1.1.1.1.1.4.2.3.cmml" xref="S2.E2.m1.1.1.1.1.4.2.3">
                𝑥
               </ci>
              </apply>
              <apply id="S2.E2.m1.1.1.1.1.4.3.cmml" xref="S2.E2.m1.1.1.1.1.4.3">
               <times id="S2.E2.m1.1.1.1.1.4.3.1.cmml" xref="S2.E2.m1.1.1.1.1.4.3.1">
               </times>
               <ci id="S2.E2.m1.1.1.1.1.4.3.2.cmml" xref="S2.E2.m1.1.1.1.1.4.3.2">
                Δ
               </ci>
               <ci id="S2.E2.m1.1.1.1.1.4.3.3.cmml" xref="S2.E2.m1.1.1.1.1.4.3.3">
                𝑊
               </ci>
               <ci id="S2.E2.m1.1.1.1.1.4.3.4.cmml" xref="S2.E2.m1.1.1.1.1.4.3.4">
                𝑥
               </ci>
              </apply>
             </apply>
            </apply>
            <apply id="S2.E2.m1.1.1.1.1c.cmml" xref="S2.E2.m1.1.1.1">
             <eq id="S2.E2.m1.1.1.1.1.5.cmml" xref="S2.E2.m1.1.1.1.1.5">
             </eq>
             <share href="#S2.E2.m1.1.1.1.1.4.cmml" id="S2.E2.m1.1.1.1.1d.cmml" xref="S2.E2.m1.1.1.1">
             </share>
             <apply id="S2.E2.m1.1.1.1.1.6.cmml" xref="S2.E2.m1.1.1.1.1.6">
              <plus id="S2.E2.m1.1.1.1.1.6.1.cmml" xref="S2.E2.m1.1.1.1.1.6.1">
              </plus>
              <apply id="S2.E2.m1.1.1.1.1.6.2.cmml" xref="S2.E2.m1.1.1.1.1.6.2">
               <times id="S2.E2.m1.1.1.1.1.6.2.1.cmml" xref="S2.E2.m1.1.1.1.1.6.2.1">
               </times>
               <apply id="S2.E2.m1.1.1.1.1.6.2.2.cmml" xref="S2.E2.m1.1.1.1.1.6.2.2">
                <csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.6.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.6.2.2">
                 subscript
                </csymbol>
                <ci id="S2.E2.m1.1.1.1.1.6.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.6.2.2.2">
                 𝑊
                </ci>
                <cn id="S2.E2.m1.1.1.1.1.6.2.2.3.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.6.2.2.3">
                 0
                </cn>
               </apply>
               <ci id="S2.E2.m1.1.1.1.1.6.2.3.cmml" xref="S2.E2.m1.1.1.1.1.6.2.3">
                𝑥
               </ci>
              </apply>
              <apply id="S2.E2.m1.1.1.1.1.6.3.cmml" xref="S2.E2.m1.1.1.1.1.6.3">
               <times id="S2.E2.m1.1.1.1.1.6.3.1.cmml" xref="S2.E2.m1.1.1.1.1.6.3.1">
               </times>
               <apply id="S2.E2.m1.1.1.1.1.6.3.2.cmml" xref="S2.E2.m1.1.1.1.1.6.3.2">
                <divide id="S2.E2.m1.1.1.1.1.6.3.2.1.cmml" xref="S2.E2.m1.1.1.1.1.6.3.2">
                </divide>
                <ci id="S2.E2.m1.1.1.1.1.6.3.2.2.cmml" xref="S2.E2.m1.1.1.1.1.6.3.2.2">
                 𝛼
                </ci>
                <ci id="S2.E2.m1.1.1.1.1.6.3.2.3.cmml" xref="S2.E2.m1.1.1.1.1.6.3.2.3">
                 𝑟
                </ci>
               </apply>
               <ci id="S2.E2.m1.1.1.1.1.6.3.3.cmml" xref="S2.E2.m1.1.1.1.1.6.3.3">
                𝐵
               </ci>
               <ci id="S2.E2.m1.1.1.1.1.6.3.4.cmml" xref="S2.E2.m1.1.1.1.1.6.3.4">
                𝐴
               </ci>
               <ci id="S2.E2.m1.1.1.1.1.6.3.5.cmml" xref="S2.E2.m1.1.1.1.1.6.3.5">
                𝑥
               </ci>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S2.E2.m1.1c">
           h=W_{0}x+\Delta Wx=W_{0}x+\frac{\alpha}{r}BAx,
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (2)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S2.SS2.p2.14">
     where
     <math alttext="x" class="ltx_Math" display="inline" id="S2.SS2.p2.6.m1.1">
      <semantics id="S2.SS2.p2.6.m1.1a">
       <mi id="S2.SS2.p2.6.m1.1.1" xref="S2.SS2.p2.6.m1.1.1.cmml">
        x
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.6.m1.1b">
        <ci id="S2.SS2.p2.6.m1.1.1.cmml" xref="S2.SS2.p2.6.m1.1.1">
         𝑥
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.6.m1.1c">
        x
       </annotation>
      </semantics>
     </math>
     represents the input vector of dimension
     <math alttext="m" class="ltx_Math" display="inline" id="S2.SS2.p2.7.m2.1">
      <semantics id="S2.SS2.p2.7.m2.1a">
       <mi id="S2.SS2.p2.7.m2.1.1" xref="S2.SS2.p2.7.m2.1.1.cmml">
        m
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.7.m2.1b">
        <ci id="S2.SS2.p2.7.m2.1.1.cmml" xref="S2.SS2.p2.7.m2.1.1">
         𝑚
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.7.m2.1c">
        m
       </annotation>
      </semantics>
     </math>
     , and
     <math alttext="h" class="ltx_Math" display="inline" id="S2.SS2.p2.8.m3.1">
      <semantics id="S2.SS2.p2.8.m3.1a">
       <mi id="S2.SS2.p2.8.m3.1.1" xref="S2.SS2.p2.8.m3.1.1.cmml">
        h
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.8.m3.1b">
        <ci id="S2.SS2.p2.8.m3.1.1.cmml" xref="S2.SS2.p2.8.m3.1.1">
         ℎ
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.8.m3.1c">
        h
       </annotation>
      </semantics>
     </math>
     is the output vector with dimension
     <math alttext="d" class="ltx_Math" display="inline" id="S2.SS2.p2.9.m4.1">
      <semantics id="S2.SS2.p2.9.m4.1a">
       <mi id="S2.SS2.p2.9.m4.1.1" xref="S2.SS2.p2.9.m4.1.1.cmml">
        d
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.9.m4.1b">
        <ci id="S2.SS2.p2.9.m4.1.1.cmml" xref="S2.SS2.p2.9.m4.1.1">
         𝑑
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.9.m4.1c">
        d
       </annotation>
      </semantics>
     </math>
     .
The rank of the trainable low-rank matrices is denoted by
     <math alttext="r" class="ltx_Math" display="inline" id="S2.SS2.p2.10.m5.1">
      <semantics id="S2.SS2.p2.10.m5.1a">
       <mi id="S2.SS2.p2.10.m5.1.1" xref="S2.SS2.p2.10.m5.1.1.cmml">
        r
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.10.m5.1b">
        <ci id="S2.SS2.p2.10.m5.1.1.cmml" xref="S2.SS2.p2.10.m5.1.1">
         𝑟
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.10.m5.1c">
        r
       </annotation>
      </semantics>
     </math>
     , which determines the number of trainable parameters, and
     <math alttext="r\ll\min(m,d)" class="ltx_Math" display="inline" id="S2.SS2.p2.11.m6.3">
      <semantics id="S2.SS2.p2.11.m6.3a">
       <mrow id="S2.SS2.p2.11.m6.3.4" xref="S2.SS2.p2.11.m6.3.4.cmml">
        <mi id="S2.SS2.p2.11.m6.3.4.2" xref="S2.SS2.p2.11.m6.3.4.2.cmml">
         r
        </mi>
        <mo id="S2.SS2.p2.11.m6.3.4.1" xref="S2.SS2.p2.11.m6.3.4.1.cmml">
         ≪
        </mo>
        <mrow id="S2.SS2.p2.11.m6.3.4.3.2" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
         <mi id="S2.SS2.p2.11.m6.1.1" xref="S2.SS2.p2.11.m6.1.1.cmml">
          min
         </mi>
         <mo id="S2.SS2.p2.11.m6.3.4.3.2a" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
          ⁡
         </mo>
         <mrow id="S2.SS2.p2.11.m6.3.4.3.2.1" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
          <mo id="S2.SS2.p2.11.m6.3.4.3.2.1.1" stretchy="false" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
           (
          </mo>
          <mi id="S2.SS2.p2.11.m6.2.2" xref="S2.SS2.p2.11.m6.2.2.cmml">
           m
          </mi>
          <mo id="S2.SS2.p2.11.m6.3.4.3.2.1.2" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
           ,
          </mo>
          <mi id="S2.SS2.p2.11.m6.3.3" xref="S2.SS2.p2.11.m6.3.3.cmml">
           d
          </mi>
          <mo id="S2.SS2.p2.11.m6.3.4.3.2.1.3" stretchy="false" xref="S2.SS2.p2.11.m6.3.4.3.1.cmml">
           )
          </mo>
         </mrow>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.11.m6.3b">
        <apply id="S2.SS2.p2.11.m6.3.4.cmml" xref="S2.SS2.p2.11.m6.3.4">
         <csymbol cd="latexml" id="S2.SS2.p2.11.m6.3.4.1.cmml" xref="S2.SS2.p2.11.m6.3.4.1">
          much-less-than
         </csymbol>
         <ci id="S2.SS2.p2.11.m6.3.4.2.cmml" xref="S2.SS2.p2.11.m6.3.4.2">
          𝑟
         </ci>
         <apply id="S2.SS2.p2.11.m6.3.4.3.1.cmml" xref="S2.SS2.p2.11.m6.3.4.3.2">
          <min id="S2.SS2.p2.11.m6.1.1.cmml" xref="S2.SS2.p2.11.m6.1.1">
          </min>
          <ci id="S2.SS2.p2.11.m6.2.2.cmml" xref="S2.SS2.p2.11.m6.2.2">
           𝑚
          </ci>
          <ci id="S2.SS2.p2.11.m6.3.3.cmml" xref="S2.SS2.p2.11.m6.3.3">
           𝑑
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.11.m6.3c">
        r\ll\min(m,d)
       </annotation>
      </semantics>
     </math>
     .
     <math alttext="\alpha" class="ltx_Math" display="inline" id="S2.SS2.p2.12.m7.1">
      <semantics id="S2.SS2.p2.12.m7.1a">
       <mi id="S2.SS2.p2.12.m7.1.1" xref="S2.SS2.p2.12.m7.1.1.cmml">
        α
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.12.m7.1b">
        <ci id="S2.SS2.p2.12.m7.1.1.cmml" xref="S2.SS2.p2.12.m7.1.1">
         𝛼
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.12.m7.1c">
        \alpha
       </annotation>
      </semantics>
     </math>
     is a constant hyper-parameter for scaling,
     <math alttext="B" class="ltx_Math" display="inline" id="S2.SS2.p2.13.m8.1">
      <semantics id="S2.SS2.p2.13.m8.1a">
       <mi id="S2.SS2.p2.13.m8.1.1" xref="S2.SS2.p2.13.m8.1.1.cmml">
        B
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.13.m8.1b">
        <ci id="S2.SS2.p2.13.m8.1.1.cmml" xref="S2.SS2.p2.13.m8.1.1">
         𝐵
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.13.m8.1c">
        B
       </annotation>
      </semantics>
     </math>
     is initialized as a zero matrix, and
     <math alttext="A" class="ltx_Math" display="inline" id="S2.SS2.p2.14.m9.1">
      <semantics id="S2.SS2.p2.14.m9.1a">
       <mi id="S2.SS2.p2.14.m9.1.1" xref="S2.SS2.p2.14.m9.1.1.cmml">
        A
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p2.14.m9.1b">
        <ci id="S2.SS2.p2.14.m9.1.1.cmml" xref="S2.SS2.p2.14.m9.1.1">
         𝐴
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p2.14.m9.1c">
        A
       </annotation>
      </semantics>
     </math>
     is initialized using a zero-mean Gaussian distribution.
During fine-tuning, only the LoRA modules can be
updated.
    </p>
   </div>
   <div class="ltx_para" id="S2.SS2.p3">
    <p class="ltx_p" id="S2.SS2.p3.7">
     To demonstrate the usage of vanilla LoRA in Role-play, we can simply assume that there is only one LoRA module in the pre-trained network.
Let’s consider a general loss function
     <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS2.p3.1.m1.1">
      <semantics id="S2.SS2.p3.1.m1.1a">
       <mi class="ltx_font_mathcaligraphic" id="S2.SS2.p3.1.m1.1.1" xref="S2.SS2.p3.1.m1.1.1.cmml">
        ℒ
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.1.m1.1b">
        <ci id="S2.SS2.p3.1.m1.1.1.cmml" xref="S2.SS2.p3.1.m1.1.1">
         ℒ
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.1.m1.1c">
        \mathcal{L}
       </annotation>
      </semantics>
     </math>
     for the model
     <math alttext="f" class="ltx_Math" display="inline" id="S2.SS2.p3.2.m2.1">
      <semantics id="S2.SS2.p3.2.m2.1a">
       <mi id="S2.SS2.p3.2.m2.1.1" xref="S2.SS2.p3.2.m2.1.1.cmml">
        f
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.2.m2.1b">
        <ci id="S2.SS2.p3.2.m2.1.1.cmml" xref="S2.SS2.p3.2.m2.1.1">
         𝑓
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.2.m2.1c">
        f
       </annotation>
      </semantics>
     </math>
     to play a specific role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S2.SS2.p3.3.m3.1">
      <semantics id="S2.SS2.p3.3.m3.1a">
       <msub id="S2.SS2.p3.3.m3.1.1" xref="S2.SS2.p3.3.m3.1.1.cmml">
        <mi id="S2.SS2.p3.3.m3.1.1.2" xref="S2.SS2.p3.3.m3.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS2.p3.3.m3.1.1.3" xref="S2.SS2.p3.3.m3.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.3.m3.1b">
        <apply id="S2.SS2.p3.3.m3.1.1.cmml" xref="S2.SS2.p3.3.m3.1.1">
         <csymbol cd="ambiguous" id="S2.SS2.p3.3.m3.1.1.1.cmml" xref="S2.SS2.p3.3.m3.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS2.p3.3.m3.1.1.2.cmml" xref="S2.SS2.p3.3.m3.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS2.p3.3.m3.1.1.3.cmml" xref="S2.SS2.p3.3.m3.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.3.m3.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     .
The target matrices
     <math alttext="B^{*}" class="ltx_Math" display="inline" id="S2.SS2.p3.4.m4.1">
      <semantics id="S2.SS2.p3.4.m4.1a">
       <msup id="S2.SS2.p3.4.m4.1.1" xref="S2.SS2.p3.4.m4.1.1.cmml">
        <mi id="S2.SS2.p3.4.m4.1.1.2" xref="S2.SS2.p3.4.m4.1.1.2.cmml">
         B
        </mi>
        <mo id="S2.SS2.p3.4.m4.1.1.3" xref="S2.SS2.p3.4.m4.1.1.3.cmml">
         ∗
        </mo>
       </msup>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.4.m4.1b">
        <apply id="S2.SS2.p3.4.m4.1.1.cmml" xref="S2.SS2.p3.4.m4.1.1">
         <csymbol cd="ambiguous" id="S2.SS2.p3.4.m4.1.1.1.cmml" xref="S2.SS2.p3.4.m4.1.1">
          superscript
         </csymbol>
         <ci id="S2.SS2.p3.4.m4.1.1.2.cmml" xref="S2.SS2.p3.4.m4.1.1.2">
          𝐵
         </ci>
         <times id="S2.SS2.p3.4.m4.1.1.3.cmml" xref="S2.SS2.p3.4.m4.1.1.3">
         </times>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.4.m4.1c">
        B^{*}
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="A^{*}" class="ltx_Math" display="inline" id="S2.SS2.p3.5.m5.1">
      <semantics id="S2.SS2.p3.5.m5.1a">
       <msup id="S2.SS2.p3.5.m5.1.1" xref="S2.SS2.p3.5.m5.1.1.cmml">
        <mi id="S2.SS2.p3.5.m5.1.1.2" xref="S2.SS2.p3.5.m5.1.1.2.cmml">
         A
        </mi>
        <mo id="S2.SS2.p3.5.m5.1.1.3" xref="S2.SS2.p3.5.m5.1.1.3.cmml">
         ∗
        </mo>
       </msup>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.5.m5.1b">
        <apply id="S2.SS2.p3.5.m5.1.1.cmml" xref="S2.SS2.p3.5.m5.1.1">
         <csymbol cd="ambiguous" id="S2.SS2.p3.5.m5.1.1.1.cmml" xref="S2.SS2.p3.5.m5.1.1">
          superscript
         </csymbol>
         <ci id="S2.SS2.p3.5.m5.1.1.2.cmml" xref="S2.SS2.p3.5.m5.1.1.2">
          𝐴
         </ci>
         <times id="S2.SS2.p3.5.m5.1.1.3.cmml" xref="S2.SS2.p3.5.m5.1.1.3">
         </times>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.5.m5.1c">
        A^{*}
       </annotation>
      </semantics>
     </math>
     trained on corpus
     <math alttext="D=(X,Y)" class="ltx_Math" display="inline" id="S2.SS2.p3.6.m6.2">
      <semantics id="S2.SS2.p3.6.m6.2a">
       <mrow id="S2.SS2.p3.6.m6.2.3" xref="S2.SS2.p3.6.m6.2.3.cmml">
        <mi id="S2.SS2.p3.6.m6.2.3.2" xref="S2.SS2.p3.6.m6.2.3.2.cmml">
         D
        </mi>
        <mo id="S2.SS2.p3.6.m6.2.3.1" xref="S2.SS2.p3.6.m6.2.3.1.cmml">
         =
        </mo>
        <mrow id="S2.SS2.p3.6.m6.2.3.3.2" xref="S2.SS2.p3.6.m6.2.3.3.1.cmml">
         <mo id="S2.SS2.p3.6.m6.2.3.3.2.1" stretchy="false" xref="S2.SS2.p3.6.m6.2.3.3.1.cmml">
          (
         </mo>
         <mi id="S2.SS2.p3.6.m6.1.1" xref="S2.SS2.p3.6.m6.1.1.cmml">
          X
         </mi>
         <mo id="S2.SS2.p3.6.m6.2.3.3.2.2" xref="S2.SS2.p3.6.m6.2.3.3.1.cmml">
          ,
         </mo>
         <mi id="S2.SS2.p3.6.m6.2.2" xref="S2.SS2.p3.6.m6.2.2.cmml">
          Y
         </mi>
         <mo id="S2.SS2.p3.6.m6.2.3.3.2.3" stretchy="false" xref="S2.SS2.p3.6.m6.2.3.3.1.cmml">
          )
         </mo>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.6.m6.2b">
        <apply id="S2.SS2.p3.6.m6.2.3.cmml" xref="S2.SS2.p3.6.m6.2.3">
         <eq id="S2.SS2.p3.6.m6.2.3.1.cmml" xref="S2.SS2.p3.6.m6.2.3.1">
         </eq>
         <ci id="S2.SS2.p3.6.m6.2.3.2.cmml" xref="S2.SS2.p3.6.m6.2.3.2">
          𝐷
         </ci>
         <interval closure="open" id="S2.SS2.p3.6.m6.2.3.3.1.cmml" xref="S2.SS2.p3.6.m6.2.3.3.2">
          <ci id="S2.SS2.p3.6.m6.1.1.cmml" xref="S2.SS2.p3.6.m6.1.1">
           𝑋
          </ci>
          <ci id="S2.SS2.p3.6.m6.2.2.cmml" xref="S2.SS2.p3.6.m6.2.2">
           𝑌
          </ci>
         </interval>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.6.m6.2c">
        D=(X,Y)
       </annotation>
      </semantics>
     </math>
     of
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S2.SS2.p3.7.m7.1">
      <semantics id="S2.SS2.p3.7.m7.1a">
       <msub id="S2.SS2.p3.7.m7.1.1" xref="S2.SS2.p3.7.m7.1.1.cmml">
        <mi id="S2.SS2.p3.7.m7.1.1.2" xref="S2.SS2.p3.7.m7.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS2.p3.7.m7.1.1.3" xref="S2.SS2.p3.7.m7.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.7.m7.1b">
        <apply id="S2.SS2.p3.7.m7.1.1.cmml" xref="S2.SS2.p3.7.m7.1.1">
         <csymbol cd="ambiguous" id="S2.SS2.p3.7.m7.1.1.1.cmml" xref="S2.SS2.p3.7.m7.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS2.p3.7.m7.1.1.2.cmml" xref="S2.SS2.p3.7.m7.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS2.p3.7.m7.1.1.3.cmml" xref="S2.SS2.p3.7.m7.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.7.m7.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     are formulated as:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S2.E3">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="B^{*},A^{*}=\operatorname{argmin}_{\Delta W}\mathcal{L}(\Delta W)," class="ltx_Math" display="block" id="S2.E3.m1.1">
         <semantics id="S2.E3.m1.1a">
          <mrow id="S2.E3.m1.1.1.1" xref="S2.E3.m1.1.1.1.1.cmml">
           <mrow id="S2.E3.m1.1.1.1.1" xref="S2.E3.m1.1.1.1.1.cmml">
            <mrow id="S2.E3.m1.1.1.1.1.2.2" xref="S2.E3.m1.1.1.1.1.2.3.cmml">
             <msup id="S2.E3.m1.1.1.1.1.1.1.1" xref="S2.E3.m1.1.1.1.1.1.1.1.cmml">
              <mi id="S2.E3.m1.1.1.1.1.1.1.1.2" xref="S2.E3.m1.1.1.1.1.1.1.1.2.cmml">
               B
              </mi>
              <mo id="S2.E3.m1.1.1.1.1.1.1.1.3" xref="S2.E3.m1.1.1.1.1.1.1.1.3.cmml">
               ∗
              </mo>
             </msup>
             <mo id="S2.E3.m1.1.1.1.1.2.2.3" xref="S2.E3.m1.1.1.1.1.2.3.cmml">
              ,
             </mo>
             <msup id="S2.E3.m1.1.1.1.1.2.2.2" xref="S2.E3.m1.1.1.1.1.2.2.2.cmml">
              <mi id="S2.E3.m1.1.1.1.1.2.2.2.2" xref="S2.E3.m1.1.1.1.1.2.2.2.2.cmml">
               A
              </mi>
              <mo id="S2.E3.m1.1.1.1.1.2.2.2.3" xref="S2.E3.m1.1.1.1.1.2.2.2.3.cmml">
               ∗
              </mo>
             </msup>
            </mrow>
            <mo id="S2.E3.m1.1.1.1.1.4" xref="S2.E3.m1.1.1.1.1.4.cmml">
             =
            </mo>
            <mrow id="S2.E3.m1.1.1.1.1.3" xref="S2.E3.m1.1.1.1.1.3.cmml">
             <mrow id="S2.E3.m1.1.1.1.1.3.3" xref="S2.E3.m1.1.1.1.1.3.3.cmml">
              <msub id="S2.E3.m1.1.1.1.1.3.3.1" xref="S2.E3.m1.1.1.1.1.3.3.1.cmml">
               <mi id="S2.E3.m1.1.1.1.1.3.3.1.2" xref="S2.E3.m1.1.1.1.1.3.3.1.2.cmml">
                argmin
               </mi>
               <mrow id="S2.E3.m1.1.1.1.1.3.3.1.3" xref="S2.E3.m1.1.1.1.1.3.3.1.3.cmml">
                <mi id="S2.E3.m1.1.1.1.1.3.3.1.3.2" mathvariant="normal" xref="S2.E3.m1.1.1.1.1.3.3.1.3.2.cmml">
                 Δ
                </mi>
                <mo id="S2.E3.m1.1.1.1.1.3.3.1.3.1" lspace="0em" rspace="0em" xref="S2.E3.m1.1.1.1.1.3.3.1.3.1.cmml">
                 ​
                </mo>
                <mi id="S2.E3.m1.1.1.1.1.3.3.1.3.3" xref="S2.E3.m1.1.1.1.1.3.3.1.3.3.cmml">
                 W
                </mi>
               </mrow>
              </msub>
              <mo id="S2.E3.m1.1.1.1.1.3.3a" lspace="0.167em" xref="S2.E3.m1.1.1.1.1.3.3.cmml">
               ⁡
              </mo>
              <mi class="ltx_font_mathcaligraphic" id="S2.E3.m1.1.1.1.1.3.3.2" xref="S2.E3.m1.1.1.1.1.3.3.2.cmml">
               ℒ
              </mi>
             </mrow>
             <mo id="S2.E3.m1.1.1.1.1.3.2" lspace="0em" rspace="0em" xref="S2.E3.m1.1.1.1.1.3.2.cmml">
              ​
             </mo>
             <mrow id="S2.E3.m1.1.1.1.1.3.1.1" xref="S2.E3.m1.1.1.1.1.3.1.1.1.cmml">
              <mo id="S2.E3.m1.1.1.1.1.3.1.1.2" stretchy="false" xref="S2.E3.m1.1.1.1.1.3.1.1.1.cmml">
               (
              </mo>
              <mrow id="S2.E3.m1.1.1.1.1.3.1.1.1" xref="S2.E3.m1.1.1.1.1.3.1.1.1.cmml">
               <mi id="S2.E3.m1.1.1.1.1.3.1.1.1.2" mathvariant="normal" xref="S2.E3.m1.1.1.1.1.3.1.1.1.2.cmml">
                Δ
               </mi>
               <mo id="S2.E3.m1.1.1.1.1.3.1.1.1.1" lspace="0em" rspace="0em" xref="S2.E3.m1.1.1.1.1.3.1.1.1.1.cmml">
                ​
               </mo>
               <mi id="S2.E3.m1.1.1.1.1.3.1.1.1.3" xref="S2.E3.m1.1.1.1.1.3.1.1.1.3.cmml">
                W
               </mi>
              </mrow>
              <mo id="S2.E3.m1.1.1.1.1.3.1.1.3" stretchy="false" xref="S2.E3.m1.1.1.1.1.3.1.1.1.cmml">
               )
              </mo>
             </mrow>
            </mrow>
           </mrow>
           <mo id="S2.E3.m1.1.1.1.2" xref="S2.E3.m1.1.1.1.1.cmml">
            ,
           </mo>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S2.E3.m1.1b">
           <apply id="S2.E3.m1.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1">
            <eq id="S2.E3.m1.1.1.1.1.4.cmml" xref="S2.E3.m1.1.1.1.1.4">
            </eq>
            <list id="S2.E3.m1.1.1.1.1.2.3.cmml" xref="S2.E3.m1.1.1.1.1.2.2">
             <apply id="S2.E3.m1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1.1.1.1">
              <csymbol cd="ambiguous" id="S2.E3.m1.1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1.1.1.1">
               superscript
              </csymbol>
              <ci id="S2.E3.m1.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m1.1.1.1.1.1.1.1.2">
               𝐵
              </ci>
              <times id="S2.E3.m1.1.1.1.1.1.1.1.3.cmml" xref="S2.E3.m1.1.1.1.1.1.1.1.3">
              </times>
             </apply>
             <apply id="S2.E3.m1.1.1.1.1.2.2.2.cmml" xref="S2.E3.m1.1.1.1.1.2.2.2">
              <csymbol cd="ambiguous" id="S2.E3.m1.1.1.1.1.2.2.2.1.cmml" xref="S2.E3.m1.1.1.1.1.2.2.2">
               superscript
              </csymbol>
              <ci id="S2.E3.m1.1.1.1.1.2.2.2.2.cmml" xref="S2.E3.m1.1.1.1.1.2.2.2.2">
               𝐴
              </ci>
              <times id="S2.E3.m1.1.1.1.1.2.2.2.3.cmml" xref="S2.E3.m1.1.1.1.1.2.2.2.3">
              </times>
             </apply>
            </list>
            <apply id="S2.E3.m1.1.1.1.1.3.cmml" xref="S2.E3.m1.1.1.1.1.3">
             <times id="S2.E3.m1.1.1.1.1.3.2.cmml" xref="S2.E3.m1.1.1.1.1.3.2">
             </times>
             <apply id="S2.E3.m1.1.1.1.1.3.3.cmml" xref="S2.E3.m1.1.1.1.1.3.3">
              <apply id="S2.E3.m1.1.1.1.1.3.3.1.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1">
               <csymbol cd="ambiguous" id="S2.E3.m1.1.1.1.1.3.3.1.1.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1">
                subscript
               </csymbol>
               <ci id="S2.E3.m1.1.1.1.1.3.3.1.2.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1.2">
                argmin
               </ci>
               <apply id="S2.E3.m1.1.1.1.1.3.3.1.3.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1.3">
                <times id="S2.E3.m1.1.1.1.1.3.3.1.3.1.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1.3.1">
                </times>
                <ci id="S2.E3.m1.1.1.1.1.3.3.1.3.2.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1.3.2">
                 Δ
                </ci>
                <ci id="S2.E3.m1.1.1.1.1.3.3.1.3.3.cmml" xref="S2.E3.m1.1.1.1.1.3.3.1.3.3">
                 𝑊
                </ci>
               </apply>
              </apply>
              <ci id="S2.E3.m1.1.1.1.1.3.3.2.cmml" xref="S2.E3.m1.1.1.1.1.3.3.2">
               ℒ
              </ci>
             </apply>
             <apply id="S2.E3.m1.1.1.1.1.3.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1.3.1.1">
              <times id="S2.E3.m1.1.1.1.1.3.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1.3.1.1.1.1">
              </times>
              <ci id="S2.E3.m1.1.1.1.1.3.1.1.1.2.cmml" xref="S2.E3.m1.1.1.1.1.3.1.1.1.2">
               Δ
              </ci>
              <ci id="S2.E3.m1.1.1.1.1.3.1.1.1.3.cmml" xref="S2.E3.m1.1.1.1.1.3.1.1.1.3">
               𝑊
              </ci>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S2.E3.m1.1c">
           B^{*},A^{*}=\operatorname{argmin}_{\Delta W}\mathcal{L}(\Delta W),
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (3)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S2.SS2.p3.16">
     where the sets of inputs and labels in
     <math alttext="D" class="ltx_Math" display="inline" id="S2.SS2.p3.8.m1.1">
      <semantics id="S2.SS2.p3.8.m1.1a">
       <mi id="S2.SS2.p3.8.m1.1.1" xref="S2.SS2.p3.8.m1.1.1.cmml">
        D
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.8.m1.1b">
        <ci id="S2.SS2.p3.8.m1.1.1.cmml" xref="S2.SS2.p3.8.m1.1.1">
         𝐷
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.8.m1.1c">
        D
       </annotation>
      </semantics>
     </math>
     are denoted as
     <math alttext="X" class="ltx_Math" display="inline" id="S2.SS2.p3.9.m2.1">
      <semantics id="S2.SS2.p3.9.m2.1a">
       <mi id="S2.SS2.p3.9.m2.1.1" xref="S2.SS2.p3.9.m2.1.1.cmml">
        X
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.9.m2.1b">
        <ci id="S2.SS2.p3.9.m2.1.1.cmml" xref="S2.SS2.p3.9.m2.1.1">
         𝑋
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.9.m2.1c">
        X
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="Y" class="ltx_Math" display="inline" id="S2.SS2.p3.10.m3.1">
      <semantics id="S2.SS2.p3.10.m3.1a">
       <mi id="S2.SS2.p3.10.m3.1.1" xref="S2.SS2.p3.10.m3.1.1.cmml">
        Y
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.10.m3.1b">
        <ci id="S2.SS2.p3.10.m3.1.1.cmml" xref="S2.SS2.p3.10.m3.1.1">
         𝑌
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.10.m3.1c">
        Y
       </annotation>
      </semantics>
     </math>
     .
In the MCRP task setting,
     <math alttext="X" class="ltx_Math" display="inline" id="S2.SS2.p3.11.m4.1">
      <semantics id="S2.SS2.p3.11.m4.1a">
       <mi id="S2.SS2.p3.11.m4.1.1" xref="S2.SS2.p3.11.m4.1.1.cmml">
        X
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.11.m4.1b">
        <ci id="S2.SS2.p3.11.m4.1.1.cmml" xref="S2.SS2.p3.11.m4.1.1">
         𝑋
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.11.m4.1c">
        X
       </annotation>
      </semantics>
     </math>
     represents history utterances
     <math alttext="U" class="ltx_Math" display="inline" id="S2.SS2.p3.12.m5.1">
      <semantics id="S2.SS2.p3.12.m5.1a">
       <mi id="S2.SS2.p3.12.m5.1.1" xref="S2.SS2.p3.12.m5.1.1.cmml">
        U
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.12.m5.1b">
        <ci id="S2.SS2.p3.12.m5.1.1.cmml" xref="S2.SS2.p3.12.m5.1.1">
         𝑈
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.12.m5.1c">
        U
       </annotation>
      </semantics>
     </math>
     , a given role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S2.SS2.p3.13.m6.1">
      <semantics id="S2.SS2.p3.13.m6.1a">
       <msub id="S2.SS2.p3.13.m6.1.1" xref="S2.SS2.p3.13.m6.1.1.cmml">
        <mi id="S2.SS2.p3.13.m6.1.1.2" xref="S2.SS2.p3.13.m6.1.1.2.cmml">
         r
        </mi>
        <mi id="S2.SS2.p3.13.m6.1.1.3" xref="S2.SS2.p3.13.m6.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.13.m6.1b">
        <apply id="S2.SS2.p3.13.m6.1.1.cmml" xref="S2.SS2.p3.13.m6.1.1">
         <csymbol cd="ambiguous" id="S2.SS2.p3.13.m6.1.1.1.cmml" xref="S2.SS2.p3.13.m6.1.1">
          subscript
         </csymbol>
         <ci id="S2.SS2.p3.13.m6.1.1.2.cmml" xref="S2.SS2.p3.13.m6.1.1.2">
          𝑟
         </ci>
         <ci id="S2.SS2.p3.13.m6.1.1.3.cmml" xref="S2.SS2.p3.13.m6.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.13.m6.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     , and a question from user.
     <math alttext="Y" class="ltx_Math" display="inline" id="S2.SS2.p3.14.m7.1">
      <semantics id="S2.SS2.p3.14.m7.1a">
       <mi id="S2.SS2.p3.14.m7.1.1" xref="S2.SS2.p3.14.m7.1.1.cmml">
        Y
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.14.m7.1b">
        <ci id="S2.SS2.p3.14.m7.1.1.cmml" xref="S2.SS2.p3.14.m7.1.1">
         𝑌
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.14.m7.1c">
        Y
       </annotation>
      </semantics>
     </math>
     is the agent response
     <math alttext="a" class="ltx_Math" display="inline" id="S2.SS2.p3.15.m8.1">
      <semantics id="S2.SS2.p3.15.m8.1a">
       <mi id="S2.SS2.p3.15.m8.1.1" xref="S2.SS2.p3.15.m8.1.1.cmml">
        a
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.15.m8.1b">
        <ci id="S2.SS2.p3.15.m8.1.1.cmml" xref="S2.SS2.p3.15.m8.1.1">
         𝑎
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.15.m8.1c">
        a
       </annotation>
      </semantics>
     </math>
     conditioned on
     <math alttext="X" class="ltx_Math" display="inline" id="S2.SS2.p3.16.m9.1">
      <semantics id="S2.SS2.p3.16.m9.1a">
       <mi id="S2.SS2.p3.16.m9.1.1" xref="S2.SS2.p3.16.m9.1.1.cmml">
        X
       </mi>
       <annotation-xml encoding="MathML-Content" id="S2.SS2.p3.16.m9.1b">
        <ci id="S2.SS2.p3.16.m9.1.1.cmml" xref="S2.SS2.p3.16.m9.1.1">
         𝑋
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S2.SS2.p3.16.m9.1c">
        X
       </annotation>
      </semantics>
     </math>
     .
However, vanilla LoRA tends to degrade the performance on previous multiple characters due to catastrophic forgetting.
It’s hence hard for role-playing agent to satisfy acting consistency, as shown in (Section
     <a class="ltx_ref" href="#S4" title="4 Evaluation Metrics ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       4
      </span>
     </a>
     ).
In the following sections, we present the Neeko framework, which overcomes this limitation with the cooperation of dynamic LoRA and gating selection modules.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S3">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    3
   </span>
   Methodology
  </h2>
  <div class="ltx_para" id="S3.p1">
   <p class="ltx_p" id="S3.p1.1">
    Our approach
    <span class="ltx_text ltx_font_bold" id="S3.p1.1.1">
     Neeko
    </span>
    are divided into three stages:
1) In the pre-training phase (§
    <a class="ltx_ref" href="#S3.SS1" title="3.1 Role-Playing with Dynamic LoRA ‣ 3 Methodology ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      3.1
     </span>
    </a>
    ) depicted in Figures
    <a class="ltx_ref" href="#S2.F1" title="Figure 1 ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      1
     </span>
    </a>
    (a), dialogue corpora for various roles undergo training using non-overlapping LoRA blocks.
2) During the inference period (§
    <a class="ltx_ref" href="#S3.SS2" title="3.2 Role Selection with Gating Network ‣ 3 Methodology ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      3.2
     </span>
    </a>
    ) shown in Figure
    <a class="ltx_ref" href="#S2.F1" title="Figure 1 ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      1
     </span>
    </a>
    (b), when presented with inputs from a role prompt,
Neeko initiates a search within the global role embedding matrix.
Subsequently, it dynamically activates LoRA blocks that are added to the original weights. These LoRA blocks have been trained based on associated personas.
3) Moving to the incremental training stage (§
    <a class="ltx_ref" href="#S3.SS3" title="3.3 Lifelong Role-Playing with LoRA Expansion ‣ 3 Methodology ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      3.3
     </span>
    </a>
    ) illustrated in Figure
    <a class="ltx_ref" href="#S2.F1" title="Figure 1 ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
     <span class="ltx_text ltx_ref_tag">
      1
     </span>
    </a>
    (c), we have designed fusion and expansion mode to get new role LoRA blocks.
   </p>
  </div>
  <section class="ltx_subsection" id="S3.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     3.1
    </span>
    Role-Playing with Dynamic LoRA
   </h3>
   <div class="ltx_para" id="S3.SS1.p1">
    <p class="ltx_p" id="S3.SS1.p1.1">
     Motivated by the dynamic LoRA frameworks
     <cite class="ltx_cite ltx_citemacro_citep">
      (Valipour et al.,
      <a class="ltx_ref" href="#bib.bib21" title="">
       2023
      </a>
      ; Yu et al.,
      <a class="ltx_ref" href="#bib.bib25" title="">
       2023
      </a>
      ; Ye and Bors,
      <a class="ltx_ref" href="#bib.bib24" title="">
       2023
      </a>
      )
     </cite>
     , we extend dynamic LoRA to the MCRP task. Rather than randomly selecting the range of LoRA ranks, we introduce non-overlapping LoRA blocks for different characters to mitigate catastrophic forgetting.
    </p>
   </div>
   <div class="ltx_para" id="S3.SS1.p2">
    <p class="ltx_p" id="S3.SS1.p2.7">
     In Figure
     <a class="ltx_ref" href="#S2.F1" title="Figure 1 ‣ 2 Problem Scope ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       1
      </span>
     </a>
     (a), the LoRA module consists of low-rank matrices
     <math alttext="B\in\mathbb{R}^{m\times r}" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1">
      <semantics id="S3.SS1.p2.1.m1.1a">
       <mrow id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml">
        <mi id="S3.SS1.p2.1.m1.1.1.2" xref="S3.SS1.p2.1.m1.1.1.2.cmml">
         B
        </mi>
        <mo id="S3.SS1.p2.1.m1.1.1.1" xref="S3.SS1.p2.1.m1.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS1.p2.1.m1.1.1.3" xref="S3.SS1.p2.1.m1.1.1.3.cmml">
         <mi id="S3.SS1.p2.1.m1.1.1.3.2" xref="S3.SS1.p2.1.m1.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S3.SS1.p2.1.m1.1.1.3.3" xref="S3.SS1.p2.1.m1.1.1.3.3.cmml">
          <mi id="S3.SS1.p2.1.m1.1.1.3.3.2" xref="S3.SS1.p2.1.m1.1.1.3.3.2.cmml">
           m
          </mi>
          <mo id="S3.SS1.p2.1.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS1.p2.1.m1.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S3.SS1.p2.1.m1.1.1.3.3.3" xref="S3.SS1.p2.1.m1.1.1.3.3.3.cmml">
           r
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b">
        <apply id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1">
         <in id="S3.SS1.p2.1.m1.1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1.1">
         </in>
         <ci id="S3.SS1.p2.1.m1.1.1.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2">
          𝐵
         </ci>
         <apply id="S3.SS1.p2.1.m1.1.1.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS1.p2.1.m1.1.1.3.1.cmml" xref="S3.SS1.p2.1.m1.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS1.p2.1.m1.1.1.3.2.cmml" xref="S3.SS1.p2.1.m1.1.1.3.2">
           ℝ
          </ci>
          <apply id="S3.SS1.p2.1.m1.1.1.3.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3.3">
           <times id="S3.SS1.p2.1.m1.1.1.3.3.1.cmml" xref="S3.SS1.p2.1.m1.1.1.3.3.1">
           </times>
           <ci id="S3.SS1.p2.1.m1.1.1.3.3.2.cmml" xref="S3.SS1.p2.1.m1.1.1.3.3.2">
            𝑚
           </ci>
           <ci id="S3.SS1.p2.1.m1.1.1.3.3.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3.3.3">
            𝑟
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">
        B\in\mathbb{R}^{m\times r}
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="A\in\mathbb{R}^{r\times d}" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1">
      <semantics id="S3.SS1.p2.2.m2.1a">
       <mrow id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml">
        <mi id="S3.SS1.p2.2.m2.1.1.2" xref="S3.SS1.p2.2.m2.1.1.2.cmml">
         A
        </mi>
        <mo id="S3.SS1.p2.2.m2.1.1.1" xref="S3.SS1.p2.2.m2.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS1.p2.2.m2.1.1.3" xref="S3.SS1.p2.2.m2.1.1.3.cmml">
         <mi id="S3.SS1.p2.2.m2.1.1.3.2" xref="S3.SS1.p2.2.m2.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S3.SS1.p2.2.m2.1.1.3.3" xref="S3.SS1.p2.2.m2.1.1.3.3.cmml">
          <mi id="S3.SS1.p2.2.m2.1.1.3.3.2" xref="S3.SS1.p2.2.m2.1.1.3.3.2.cmml">
           r
          </mi>
          <mo id="S3.SS1.p2.2.m2.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS1.p2.2.m2.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S3.SS1.p2.2.m2.1.1.3.3.3" xref="S3.SS1.p2.2.m2.1.1.3.3.3.cmml">
           d
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b">
        <apply id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1">
         <in id="S3.SS1.p2.2.m2.1.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1.1">
         </in>
         <ci id="S3.SS1.p2.2.m2.1.1.2.cmml" xref="S3.SS1.p2.2.m2.1.1.2">
          𝐴
         </ci>
         <apply id="S3.SS1.p2.2.m2.1.1.3.cmml" xref="S3.SS1.p2.2.m2.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS1.p2.2.m2.1.1.3.1.cmml" xref="S3.SS1.p2.2.m2.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS1.p2.2.m2.1.1.3.2.cmml" xref="S3.SS1.p2.2.m2.1.1.3.2">
           ℝ
          </ci>
          <apply id="S3.SS1.p2.2.m2.1.1.3.3.cmml" xref="S3.SS1.p2.2.m2.1.1.3.3">
           <times id="S3.SS1.p2.2.m2.1.1.3.3.1.cmml" xref="S3.SS1.p2.2.m2.1.1.3.3.1">
           </times>
           <ci id="S3.SS1.p2.2.m2.1.1.3.3.2.cmml" xref="S3.SS1.p2.2.m2.1.1.3.3.2">
            𝑟
           </ci>
           <ci id="S3.SS1.p2.2.m2.1.1.3.3.3.cmml" xref="S3.SS1.p2.2.m2.1.1.3.3.3">
            𝑑
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">
        A\in\mathbb{R}^{r\times d}
       </annotation>
      </semantics>
     </math>
     .
Let’s assume that we would like to train a part of weights in matrices
     <math alttext="B" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m3.1">
      <semantics id="S3.SS1.p2.3.m3.1a">
       <mi id="S3.SS1.p2.3.m3.1.1" xref="S3.SS1.p2.3.m3.1.1.cmml">
        B
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m3.1b">
        <ci id="S3.SS1.p2.3.m3.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1">
         𝐵
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.3.m3.1c">
        B
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="A" class="ltx_Math" display="inline" id="S3.SS1.p2.4.m4.1">
      <semantics id="S3.SS1.p2.4.m4.1a">
       <mi id="S3.SS1.p2.4.m4.1.1" xref="S3.SS1.p2.4.m4.1.1.cmml">
        A
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.m4.1b">
        <ci id="S3.SS1.p2.4.m4.1.1.cmml" xref="S3.SS1.p2.4.m4.1.1">
         𝐴
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.4.m4.1c">
        A
       </annotation>
      </semantics>
     </math>
     for each character, which can be termed as a trainable LoRA block.
The range of a block is determined by the order number of role
     <math alttext="k\in[1,M]" class="ltx_Math" display="inline" id="S3.SS1.p2.5.m5.2">
      <semantics id="S3.SS1.p2.5.m5.2a">
       <mrow id="S3.SS1.p2.5.m5.2.3" xref="S3.SS1.p2.5.m5.2.3.cmml">
        <mi id="S3.SS1.p2.5.m5.2.3.2" xref="S3.SS1.p2.5.m5.2.3.2.cmml">
         k
        </mi>
        <mo id="S3.SS1.p2.5.m5.2.3.1" xref="S3.SS1.p2.5.m5.2.3.1.cmml">
         ∈
        </mo>
        <mrow id="S3.SS1.p2.5.m5.2.3.3.2" xref="S3.SS1.p2.5.m5.2.3.3.1.cmml">
         <mo id="S3.SS1.p2.5.m5.2.3.3.2.1" stretchy="false" xref="S3.SS1.p2.5.m5.2.3.3.1.cmml">
          [
         </mo>
         <mn id="S3.SS1.p2.5.m5.1.1" xref="S3.SS1.p2.5.m5.1.1.cmml">
          1
         </mn>
         <mo id="S3.SS1.p2.5.m5.2.3.3.2.2" xref="S3.SS1.p2.5.m5.2.3.3.1.cmml">
          ,
         </mo>
         <mi id="S3.SS1.p2.5.m5.2.2" xref="S3.SS1.p2.5.m5.2.2.cmml">
          M
         </mi>
         <mo id="S3.SS1.p2.5.m5.2.3.3.2.3" stretchy="false" xref="S3.SS1.p2.5.m5.2.3.3.1.cmml">
          ]
         </mo>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.m5.2b">
        <apply id="S3.SS1.p2.5.m5.2.3.cmml" xref="S3.SS1.p2.5.m5.2.3">
         <in id="S3.SS1.p2.5.m5.2.3.1.cmml" xref="S3.SS1.p2.5.m5.2.3.1">
         </in>
         <ci id="S3.SS1.p2.5.m5.2.3.2.cmml" xref="S3.SS1.p2.5.m5.2.3.2">
          𝑘
         </ci>
         <interval closure="closed" id="S3.SS1.p2.5.m5.2.3.3.1.cmml" xref="S3.SS1.p2.5.m5.2.3.3.2">
          <cn id="S3.SS1.p2.5.m5.1.1.cmml" type="integer" xref="S3.SS1.p2.5.m5.1.1">
           1
          </cn>
          <ci id="S3.SS1.p2.5.m5.2.2.cmml" xref="S3.SS1.p2.5.m5.2.2">
           𝑀
          </ci>
         </interval>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.5.m5.2c">
        k\in[1,M]
       </annotation>
      </semantics>
     </math>
     and the predefined hyper-parameter partial rank
     <math alttext="p" class="ltx_Math" display="inline" id="S3.SS1.p2.6.m6.1">
      <semantics id="S3.SS1.p2.6.m6.1a">
       <mi id="S3.SS1.p2.6.m6.1.1" xref="S3.SS1.p2.6.m6.1.1.cmml">
        p
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.m6.1b">
        <ci id="S3.SS1.p2.6.m6.1.1.cmml" xref="S3.SS1.p2.6.m6.1.1">
         𝑝
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.6.m6.1c">
        p
       </annotation>
      </semantics>
     </math>
     .
In this way, the LoRA blocks for different character
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S3.SS1.p2.7.m7.1">
      <semantics id="S3.SS1.p2.7.m7.1a">
       <msub id="S3.SS1.p2.7.m7.1.1" xref="S3.SS1.p2.7.m7.1.1.cmml">
        <mi id="S3.SS1.p2.7.m7.1.1.2" xref="S3.SS1.p2.7.m7.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS1.p2.7.m7.1.1.3" xref="S3.SS1.p2.7.m7.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.m7.1b">
        <apply id="S3.SS1.p2.7.m7.1.1.cmml" xref="S3.SS1.p2.7.m7.1.1">
         <csymbol cd="ambiguous" id="S3.SS1.p2.7.m7.1.1.1.cmml" xref="S3.SS1.p2.7.m7.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS1.p2.7.m7.1.1.2.cmml" xref="S3.SS1.p2.7.m7.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS1.p2.7.m7.1.1.3.cmml" xref="S3.SS1.p2.7.m7.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p2.7.m7.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     are non-overlapping:
    </p>
   </div>
   <div class="ltx_para" id="S3.SS1.p3">
    <table class="ltx_equationgroup ltx_eqn_table" id="S3.E4">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="S3.E4X">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_td ltx_align_right ltx_eqn_cell">
        <math alttext="\displaystyle W_{B}^{k}" class="ltx_Math" display="inline" id="S3.E4X.2.1.1.m1.1">
         <semantics id="S3.E4X.2.1.1.m1.1a">
          <msubsup id="S3.E4X.2.1.1.m1.1.1" xref="S3.E4X.2.1.1.m1.1.1.cmml">
           <mi id="S3.E4X.2.1.1.m1.1.1.2.2" xref="S3.E4X.2.1.1.m1.1.1.2.2.cmml">
            W
           </mi>
           <mi id="S3.E4X.2.1.1.m1.1.1.2.3" xref="S3.E4X.2.1.1.m1.1.1.2.3.cmml">
            B
           </mi>
           <mi id="S3.E4X.2.1.1.m1.1.1.3" xref="S3.E4X.2.1.1.m1.1.1.3.cmml">
            k
           </mi>
          </msubsup>
          <annotation-xml encoding="MathML-Content" id="S3.E4X.2.1.1.m1.1b">
           <apply id="S3.E4X.2.1.1.m1.1.1.cmml" xref="S3.E4X.2.1.1.m1.1.1">
            <csymbol cd="ambiguous" id="S3.E4X.2.1.1.m1.1.1.1.cmml" xref="S3.E4X.2.1.1.m1.1.1">
             superscript
            </csymbol>
            <apply id="S3.E4X.2.1.1.m1.1.1.2.cmml" xref="S3.E4X.2.1.1.m1.1.1">
             <csymbol cd="ambiguous" id="S3.E4X.2.1.1.m1.1.1.2.1.cmml" xref="S3.E4X.2.1.1.m1.1.1">
              subscript
             </csymbol>
             <ci id="S3.E4X.2.1.1.m1.1.1.2.2.cmml" xref="S3.E4X.2.1.1.m1.1.1.2.2">
              𝑊
             </ci>
             <ci id="S3.E4X.2.1.1.m1.1.1.2.3.cmml" xref="S3.E4X.2.1.1.m1.1.1.2.3">
              𝐵
             </ci>
            </apply>
            <ci id="S3.E4X.2.1.1.m1.1.1.3.cmml" xref="S3.E4X.2.1.1.m1.1.1.3">
             𝑘
            </ci>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E4X.2.1.1.m1.1c">
           \displaystyle W_{B}^{k}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_left ltx_eqn_cell">
        <math alttext="\displaystyle=B[\ :,\ (k-1)p:kp]," class="ltx_math_unparsed" display="inline" id="S3.E4X.3.2.2.m1.1">
         <semantics id="S3.E4X.3.2.2.m1.1a">
          <mrow id="S3.E4X.3.2.2.m1.1b">
           <mo id="S3.E4X.3.2.2.m1.1.2">
            =
           </mo>
           <mi id="S3.E4X.3.2.2.m1.1.3">
            B
           </mi>
           <mrow id="S3.E4X.3.2.2.m1.1.4">
            <mo id="S3.E4X.3.2.2.m1.1.4.1" rspace="0.500em" stretchy="false">
             [
            </mo>
            <mo id="S3.E4X.3.2.2.m1.1.1" rspace="0em">
             :
            </mo>
            <mo id="S3.E4X.3.2.2.m1.1.4.2" rspace="0.667em">
             ,
            </mo>
            <mrow id="S3.E4X.3.2.2.m1.1.4.3">
             <mo id="S3.E4X.3.2.2.m1.1.4.3.1" stretchy="false">
              (
             </mo>
             <mi id="S3.E4X.3.2.2.m1.1.4.3.2">
              k
             </mi>
             <mo id="S3.E4X.3.2.2.m1.1.4.3.3">
              −
             </mo>
             <mn id="S3.E4X.3.2.2.m1.1.4.3.4">
              1
             </mn>
             <mo id="S3.E4X.3.2.2.m1.1.4.3.5" stretchy="false">
              )
             </mo>
            </mrow>
            <mi id="S3.E4X.3.2.2.m1.1.4.4">
             p
            </mi>
            <mo id="S3.E4X.3.2.2.m1.1.4.5" lspace="0.278em" rspace="0.278em">
             :
            </mo>
            <mi id="S3.E4X.3.2.2.m1.1.4.6">
             k
            </mi>
            <mi id="S3.E4X.3.2.2.m1.1.4.7">
             p
            </mi>
            <mo id="S3.E4X.3.2.2.m1.1.4.8" stretchy="false">
             ]
            </mo>
           </mrow>
           <mo id="S3.E4X.3.2.2.m1.1.5">
            ,
           </mo>
          </mrow>
          <annotation encoding="application/x-tex" id="S3.E4X.3.2.2.m1.1c">
           \displaystyle=B[\ :,\ (k-1)p:kp],
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="2">
        <span class="ltx_tag ltx_tag_equationgroup ltx_align_right">
         (4)
        </span>
       </td>
      </tr>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="S3.E4Xa">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_td ltx_align_right ltx_eqn_cell">
        <math alttext="\displaystyle W_{A}^{k}" class="ltx_Math" display="inline" id="S3.E4Xa.2.1.1.m1.1">
         <semantics id="S3.E4Xa.2.1.1.m1.1a">
          <msubsup id="S3.E4Xa.2.1.1.m1.1.1" xref="S3.E4Xa.2.1.1.m1.1.1.cmml">
           <mi id="S3.E4Xa.2.1.1.m1.1.1.2.2" xref="S3.E4Xa.2.1.1.m1.1.1.2.2.cmml">
            W
           </mi>
           <mi id="S3.E4Xa.2.1.1.m1.1.1.2.3" xref="S3.E4Xa.2.1.1.m1.1.1.2.3.cmml">
            A
           </mi>
           <mi id="S3.E4Xa.2.1.1.m1.1.1.3" xref="S3.E4Xa.2.1.1.m1.1.1.3.cmml">
            k
           </mi>
          </msubsup>
          <annotation-xml encoding="MathML-Content" id="S3.E4Xa.2.1.1.m1.1b">
           <apply id="S3.E4Xa.2.1.1.m1.1.1.cmml" xref="S3.E4Xa.2.1.1.m1.1.1">
            <csymbol cd="ambiguous" id="S3.E4Xa.2.1.1.m1.1.1.1.cmml" xref="S3.E4Xa.2.1.1.m1.1.1">
             superscript
            </csymbol>
            <apply id="S3.E4Xa.2.1.1.m1.1.1.2.cmml" xref="S3.E4Xa.2.1.1.m1.1.1">
             <csymbol cd="ambiguous" id="S3.E4Xa.2.1.1.m1.1.1.2.1.cmml" xref="S3.E4Xa.2.1.1.m1.1.1">
              subscript
             </csymbol>
             <ci id="S3.E4Xa.2.1.1.m1.1.1.2.2.cmml" xref="S3.E4Xa.2.1.1.m1.1.1.2.2">
              𝑊
             </ci>
             <ci id="S3.E4Xa.2.1.1.m1.1.1.2.3.cmml" xref="S3.E4Xa.2.1.1.m1.1.1.2.3">
              𝐴
             </ci>
            </apply>
            <ci id="S3.E4Xa.2.1.1.m1.1.1.3.cmml" xref="S3.E4Xa.2.1.1.m1.1.1.3">
             𝑘
            </ci>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E4Xa.2.1.1.m1.1c">
           \displaystyle W_{A}^{k}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_left ltx_eqn_cell">
        <math alttext="\displaystyle=A[\ (k-1)p:kp,\ :\ ]." class="ltx_math_unparsed" display="inline" id="S3.E4Xa.3.2.2.m1.1">
         <semantics id="S3.E4Xa.3.2.2.m1.1a">
          <mrow id="S3.E4Xa.3.2.2.m1.1b">
           <mo id="S3.E4Xa.3.2.2.m1.1.1">
            =
           </mo>
           <mi id="S3.E4Xa.3.2.2.m1.1.2">
            A
           </mi>
           <mrow id="S3.E4Xa.3.2.2.m1.1.3">
            <mo id="S3.E4Xa.3.2.2.m1.1.3.1" rspace="0.500em" stretchy="false">
             [
            </mo>
            <mrow id="S3.E4Xa.3.2.2.m1.1.3.2">
             <mo id="S3.E4Xa.3.2.2.m1.1.3.2.1" stretchy="false">
              (
             </mo>
             <mi id="S3.E4Xa.3.2.2.m1.1.3.2.2">
              k
             </mi>
             <mo id="S3.E4Xa.3.2.2.m1.1.3.2.3">
              −
             </mo>
             <mn id="S3.E4Xa.3.2.2.m1.1.3.2.4">
              1
             </mn>
             <mo id="S3.E4Xa.3.2.2.m1.1.3.2.5" stretchy="false">
              )
             </mo>
            </mrow>
            <mi id="S3.E4Xa.3.2.2.m1.1.3.3">
             p
            </mi>
            <mo id="S3.E4Xa.3.2.2.m1.1.3.4" lspace="0.278em" rspace="0.278em">
             :
            </mo>
            <mi id="S3.E4Xa.3.2.2.m1.1.3.5">
             k
            </mi>
            <mi id="S3.E4Xa.3.2.2.m1.1.3.6">
             p
            </mi>
            <mo id="S3.E4Xa.3.2.2.m1.1.3.7" rspace="0.667em">
             ,
            </mo>
            <mo id="S3.E4Xa.3.2.2.m1.1.3.8" rspace="0.500em">
             :
            </mo>
            <mo id="S3.E4Xa.3.2.2.m1.1.3.9" stretchy="false">
             ]
            </mo>
           </mrow>
           <mo id="S3.E4Xa.3.2.2.m1.1.4" lspace="0em">
            .
           </mo>
          </mrow>
          <annotation encoding="application/x-tex" id="S3.E4Xa.3.2.2.m1.1c">
           \displaystyle=A[\ (k-1)p:kp,\ :\ ].
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S3.SS1.p3.12">
     Here,
     <math alttext="W_{B}^{k}" class="ltx_Math" display="inline" id="S3.SS1.p3.1.m1.1">
      <semantics id="S3.SS1.p3.1.m1.1a">
       <msubsup id="S3.SS1.p3.1.m1.1.1" xref="S3.SS1.p3.1.m1.1.1.cmml">
        <mi id="S3.SS1.p3.1.m1.1.1.2.2" xref="S3.SS1.p3.1.m1.1.1.2.2.cmml">
         W
        </mi>
        <mi id="S3.SS1.p3.1.m1.1.1.2.3" xref="S3.SS1.p3.1.m1.1.1.2.3.cmml">
         B
        </mi>
        <mi id="S3.SS1.p3.1.m1.1.1.3" xref="S3.SS1.p3.1.m1.1.1.3.cmml">
         k
        </mi>
       </msubsup>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.1.m1.1b">
        <apply id="S3.SS1.p3.1.m1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1">
         <csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1">
          superscript
         </csymbol>
         <apply id="S3.SS1.p3.1.m1.1.1.2.cmml" xref="S3.SS1.p3.1.m1.1.1">
          <csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.1.1.2.1.cmml" xref="S3.SS1.p3.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S3.SS1.p3.1.m1.1.1.2.2.cmml" xref="S3.SS1.p3.1.m1.1.1.2.2">
           𝑊
          </ci>
          <ci id="S3.SS1.p3.1.m1.1.1.2.3.cmml" xref="S3.SS1.p3.1.m1.1.1.2.3">
           𝐵
          </ci>
         </apply>
         <ci id="S3.SS1.p3.1.m1.1.1.3.cmml" xref="S3.SS1.p3.1.m1.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.1.m1.1c">
        W_{B}^{k}
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="W_{A}^{k}" class="ltx_Math" display="inline" id="S3.SS1.p3.2.m2.1">
      <semantics id="S3.SS1.p3.2.m2.1a">
       <msubsup id="S3.SS1.p3.2.m2.1.1" xref="S3.SS1.p3.2.m2.1.1.cmml">
        <mi id="S3.SS1.p3.2.m2.1.1.2.2" xref="S3.SS1.p3.2.m2.1.1.2.2.cmml">
         W
        </mi>
        <mi id="S3.SS1.p3.2.m2.1.1.2.3" xref="S3.SS1.p3.2.m2.1.1.2.3.cmml">
         A
        </mi>
        <mi id="S3.SS1.p3.2.m2.1.1.3" xref="S3.SS1.p3.2.m2.1.1.3.cmml">
         k
        </mi>
       </msubsup>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.2.m2.1b">
        <apply id="S3.SS1.p3.2.m2.1.1.cmml" xref="S3.SS1.p3.2.m2.1.1">
         <csymbol cd="ambiguous" id="S3.SS1.p3.2.m2.1.1.1.cmml" xref="S3.SS1.p3.2.m2.1.1">
          superscript
         </csymbol>
         <apply id="S3.SS1.p3.2.m2.1.1.2.cmml" xref="S3.SS1.p3.2.m2.1.1">
          <csymbol cd="ambiguous" id="S3.SS1.p3.2.m2.1.1.2.1.cmml" xref="S3.SS1.p3.2.m2.1.1">
           subscript
          </csymbol>
          <ci id="S3.SS1.p3.2.m2.1.1.2.2.cmml" xref="S3.SS1.p3.2.m2.1.1.2.2">
           𝑊
          </ci>
          <ci id="S3.SS1.p3.2.m2.1.1.2.3.cmml" xref="S3.SS1.p3.2.m2.1.1.2.3">
           𝐴
          </ci>
         </apply>
         <ci id="S3.SS1.p3.2.m2.1.1.3.cmml" xref="S3.SS1.p3.2.m2.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.2.m2.1c">
        W_{A}^{k}
       </annotation>
      </semantics>
     </math>
     represent the trainable block in matrices
     <math alttext="B" class="ltx_Math" display="inline" id="S3.SS1.p3.3.m3.1">
      <semantics id="S3.SS1.p3.3.m3.1a">
       <mi id="S3.SS1.p3.3.m3.1.1" xref="S3.SS1.p3.3.m3.1.1.cmml">
        B
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.3.m3.1b">
        <ci id="S3.SS1.p3.3.m3.1.1.cmml" xref="S3.SS1.p3.3.m3.1.1">
         𝐵
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.3.m3.1c">
        B
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="A" class="ltx_Math" display="inline" id="S3.SS1.p3.4.m4.1">
      <semantics id="S3.SS1.p3.4.m4.1a">
       <mi id="S3.SS1.p3.4.m4.1.1" xref="S3.SS1.p3.4.m4.1.1.cmml">
        A
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.4.m4.1b">
        <ci id="S3.SS1.p3.4.m4.1.1.cmml" xref="S3.SS1.p3.4.m4.1.1">
         𝐴
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.4.m4.1c">
        A
       </annotation>
      </semantics>
     </math>
     for the
     <math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p3.5.m5.1">
      <semantics id="S3.SS1.p3.5.m5.1a">
       <mi id="S3.SS1.p3.5.m5.1.1" xref="S3.SS1.p3.5.m5.1.1.cmml">
        k
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.5.m5.1b">
        <ci id="S3.SS1.p3.5.m5.1.1.cmml" xref="S3.SS1.p3.5.m5.1.1">
         𝑘
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.5.m5.1c">
        k
       </annotation>
      </semantics>
     </math>
     -th character, and the total rank
     <math alttext="r" class="ltx_Math" display="inline" id="S3.SS1.p3.6.m6.1">
      <semantics id="S3.SS1.p3.6.m6.1a">
       <mi id="S3.SS1.p3.6.m6.1.1" xref="S3.SS1.p3.6.m6.1.1.cmml">
        r
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.6.m6.1b">
        <ci id="S3.SS1.p3.6.m6.1.1.cmml" xref="S3.SS1.p3.6.m6.1.1">
         𝑟
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.6.m6.1c">
        r
       </annotation>
      </semantics>
     </math>
     equals the number of required LoRA blocks
     <math alttext="M" class="ltx_Math" display="inline" id="S3.SS1.p3.7.m7.1">
      <semantics id="S3.SS1.p3.7.m7.1a">
       <mi id="S3.SS1.p3.7.m7.1.1" xref="S3.SS1.p3.7.m7.1.1.cmml">
        M
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.7.m7.1b">
        <ci id="S3.SS1.p3.7.m7.1.1.cmml" xref="S3.SS1.p3.7.m7.1.1">
         𝑀
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.7.m7.1c">
        M
       </annotation>
      </semantics>
     </math>
     multiplied by the partial rank
     <math alttext="p" class="ltx_Math" display="inline" id="S3.SS1.p3.8.m8.1">
      <semantics id="S3.SS1.p3.8.m8.1a">
       <mi id="S3.SS1.p3.8.m8.1.1" xref="S3.SS1.p3.8.m8.1.1.cmml">
        p
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.8.m8.1b">
        <ci id="S3.SS1.p3.8.m8.1.1.cmml" xref="S3.SS1.p3.8.m8.1.1">
         𝑝
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.8.m8.1c">
        p
       </annotation>
      </semantics>
     </math>
     .
Thus, Neeko serves as a role-playing agent for a mass of characters by the hyper-parameter
     <math alttext="r" class="ltx_Math" display="inline" id="S3.SS1.p3.9.m9.1">
      <semantics id="S3.SS1.p3.9.m9.1a">
       <mi id="S3.SS1.p3.9.m9.1.1" xref="S3.SS1.p3.9.m9.1.1.cmml">
        r
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.9.m9.1b">
        <ci id="S3.SS1.p3.9.m9.1.1.cmml" xref="S3.SS1.p3.9.m9.1.1">
         𝑟
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.9.m9.1c">
        r
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="p" class="ltx_Math" display="inline" id="S3.SS1.p3.10.m10.1">
      <semantics id="S3.SS1.p3.10.m10.1a">
       <mi id="S3.SS1.p3.10.m10.1.1" xref="S3.SS1.p3.10.m10.1.1.cmml">
        p
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.10.m10.1b">
        <ci id="S3.SS1.p3.10.m10.1.1.cmml" xref="S3.SS1.p3.10.m10.1.1">
         𝑝
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.10.m10.1c">
        p
       </annotation>
      </semantics>
     </math>
     .
Detailed training setting for Neeko can be found in the Appendix
     <a class="ltx_ref" href="#A1" title="Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       A
      </span>
     </a>
     .
With the learning rate
     <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.p3.11.m11.1">
      <semantics id="S3.SS1.p3.11.m11.1a">
       <mi id="S3.SS1.p3.11.m11.1.1" xref="S3.SS1.p3.11.m11.1.1.cmml">
        η
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.11.m11.1b">
        <ci id="S3.SS1.p3.11.m11.1.1.cmml" xref="S3.SS1.p3.11.m11.1.1">
         𝜂
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.11.m11.1c">
        \eta
       </annotation>
      </semantics>
     </math>
     , a character corpus
     <math alttext="D" class="ltx_Math" display="inline" id="S3.SS1.p3.12.m12.1">
      <semantics id="S3.SS1.p3.12.m12.1a">
       <mi id="S3.SS1.p3.12.m12.1.1" xref="S3.SS1.p3.12.m12.1.1.cmml">
        D
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS1.p3.12.m12.1b">
        <ci id="S3.SS1.p3.12.m12.1.1.cmml" xref="S3.SS1.p3.12.m12.1.1">
         𝐷
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS1.p3.12.m12.1c">
        D
       </annotation>
      </semantics>
     </math>
     can be quickly learned in a small LoRA block:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S3.E5">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="\begin{split}W_{B}^{k}\leftarrow W_{B}^{k}-\eta\nabla_{W_{B}^{k}}\mathcal{L}[f(X;W_{B}^{k}W_{A}^{k}),Y],\\
W_{A}^{k}\leftarrow W_{A}^{k}-\eta\nabla_{W_{A}^{k}}\mathcal{L}[f(X;W_{B}^{k}W_{A}^{k}),Y].\end{split}" class="ltx_Math" display="block" id="S3.E5.m1.59">
         <semantics id="S3.E5.m1.59a">
          <mtable displaystyle="true" id="S3.E5.m1.59.59.3" rowspacing="0pt">
           <mtr id="S3.E5.m1.59.59.3a">
            <mtd class="ltx_align_right" columnalign="right" id="S3.E5.m1.59.59.3b">
             <mrow id="S3.E5.m1.58.58.2.57.29.29.29">
              <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1">
               <msubsup id="S3.E5.m1.58.58.2.57.29.29.29.1.2">
                <mi id="S3.E5.m1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.cmml">
                 W
                </mi>
                <mi id="S3.E5.m1.2.2.2.2.2.2.1" xref="S3.E5.m1.2.2.2.2.2.2.1.cmml">
                 B
                </mi>
                <mi id="S3.E5.m1.3.3.3.3.3.3.1" xref="S3.E5.m1.3.3.3.3.3.3.1.cmml">
                 k
                </mi>
               </msubsup>
               <mo id="S3.E5.m1.4.4.4.4.4.4" stretchy="false" xref="S3.E5.m1.4.4.4.4.4.4.cmml">
                ←
               </mo>
               <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1">
                <msubsup id="S3.E5.m1.58.58.2.57.29.29.29.1.1.2">
                 <mi id="S3.E5.m1.5.5.5.5.5.5" xref="S3.E5.m1.5.5.5.5.5.5.cmml">
                  W
                 </mi>
                 <mi id="S3.E5.m1.6.6.6.6.6.6.1" xref="S3.E5.m1.6.6.6.6.6.6.1.cmml">
                  B
                 </mi>
                 <mi id="S3.E5.m1.7.7.7.7.7.7.1" xref="S3.E5.m1.7.7.7.7.7.7.1.cmml">
                  k
                 </mi>
                </msubsup>
                <mo id="S3.E5.m1.8.8.8.8.8.8" xref="S3.E5.m1.8.8.8.8.8.8.cmml">
                 −
                </mo>
                <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1">
                 <mi id="S3.E5.m1.9.9.9.9.9.9" xref="S3.E5.m1.9.9.9.9.9.9.cmml">
                  η
                 </mi>
                 <mo id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.2" lspace="0.167em" rspace="0em">
                  ​
                 </mo>
                 <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.3">
                  <msub id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.3.1">
                   <mo id="S3.E5.m1.10.10.10.10.10.10" rspace="0.167em" xref="S3.E5.m1.10.10.10.10.10.10.cmml">
                    ∇
                   </mo>
                   <msubsup id="S3.E5.m1.11.11.11.11.11.11.1" xref="S3.E5.m1.11.11.11.11.11.11.1.cmml">
                    <mi id="S3.E5.m1.11.11.11.11.11.11.1.2.2" xref="S3.E5.m1.11.11.11.11.11.11.1.2.2.cmml">
                     W
                    </mi>
                    <mi id="S3.E5.m1.11.11.11.11.11.11.1.2.3" xref="S3.E5.m1.11.11.11.11.11.11.1.2.3.cmml">
                     B
                    </mi>
                    <mi id="S3.E5.m1.11.11.11.11.11.11.1.3" xref="S3.E5.m1.11.11.11.11.11.11.1.3.cmml">
                     k
                    </mi>
                   </msubsup>
                  </msub>
                  <mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.12.12.12.12.12.12" xref="S3.E5.m1.12.12.12.12.12.12.cmml">
                   ℒ
                  </mi>
                 </mrow>
                 <mo id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.2a" lspace="0em" rspace="0em">
                  ​
                 </mo>
                 <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1">
                  <mo id="S3.E5.m1.13.13.13.13.13.13" stretchy="false">
                   [
                  </mo>
                  <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1">
                   <mi id="S3.E5.m1.14.14.14.14.14.14" xref="S3.E5.m1.14.14.14.14.14.14.cmml">
                    f
                   </mi>
                   <mo id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.2" lspace="0em" rspace="0em">
                    ​
                   </mo>
                   <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.1.1">
                    <mo id="S3.E5.m1.15.15.15.15.15.15" stretchy="false">
                     (
                    </mo>
                    <mi id="S3.E5.m1.16.16.16.16.16.16" xref="S3.E5.m1.16.16.16.16.16.16.cmml">
                     X
                    </mi>
                    <mo id="S3.E5.m1.17.17.17.17.17.17">
                     ;
                    </mo>
                    <mrow id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.1.1.1">
                     <msubsup id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.1.1.1.2">
                      <mi id="S3.E5.m1.18.18.18.18.18.18" xref="S3.E5.m1.18.18.18.18.18.18.cmml">
                       W
                      </mi>
                      <mi id="S3.E5.m1.19.19.19.19.19.19.1" xref="S3.E5.m1.19.19.19.19.19.19.1.cmml">
                       B
                      </mi>
                      <mi id="S3.E5.m1.20.20.20.20.20.20.1" xref="S3.E5.m1.20.20.20.20.20.20.1.cmml">
                       k
                      </mi>
                     </msubsup>
                     <mo id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.1.1.1.1" lspace="0em" rspace="0em">
                      ​
                     </mo>
                     <msubsup id="S3.E5.m1.58.58.2.57.29.29.29.1.1.1.1.1.1.1.1.1.3">
                      <mi id="S3.E5.m1.21.21.21.21.21.21" xref="S3.E5.m1.21.21.21.21.21.21.cmml">
                       W
                      </mi>
                      <mi id="S3.E5.m1.22.22.22.22.22.22.1" xref="S3.E5.m1.22.22.22.22.22.22.1.cmml">
                       A
                      </mi>
                      <mi id="S3.E5.m1.23.23.23.23.23.23.1" xref="S3.E5.m1.23.23.23.23.23.23.1.cmml">
                       k
                      </mi>
                     </msubsup>
                    </mrow>
                    <mo id="S3.E5.m1.24.24.24.24.24.24" stretchy="false">
                     )
                    </mo>
                   </mrow>
                  </mrow>
                  <mo id="S3.E5.m1.25.25.25.25.25.25">
                   ,
                  </mo>
                  <mi id="S3.E5.m1.26.26.26.26.26.26" xref="S3.E5.m1.26.26.26.26.26.26.cmml">
                   Y
                  </mi>
                  <mo id="S3.E5.m1.27.27.27.27.27.27" stretchy="false">
                   ]
                  </mo>
                 </mrow>
                </mrow>
               </mrow>
              </mrow>
              <mo id="S3.E5.m1.28.28.28.28.28.28">
               ,
              </mo>
             </mrow>
            </mtd>
           </mtr>
           <mtr id="S3.E5.m1.59.59.3c">
            <mtd class="ltx_align_right" columnalign="right" id="S3.E5.m1.59.59.3d">
             <mrow id="S3.E5.m1.59.59.3.58.29.29.29">
              <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1">
               <msubsup id="S3.E5.m1.59.59.3.58.29.29.29.1.2">
                <mi id="S3.E5.m1.29.29.29.1.1.1" xref="S3.E5.m1.29.29.29.1.1.1.cmml">
                 W
                </mi>
                <mi id="S3.E5.m1.30.30.30.2.2.2.1" xref="S3.E5.m1.30.30.30.2.2.2.1.cmml">
                 A
                </mi>
                <mi id="S3.E5.m1.31.31.31.3.3.3.1" xref="S3.E5.m1.31.31.31.3.3.3.1.cmml">
                 k
                </mi>
               </msubsup>
               <mo id="S3.E5.m1.32.32.32.4.4.4" stretchy="false" xref="S3.E5.m1.32.32.32.4.4.4.cmml">
                ←
               </mo>
               <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1">
                <msubsup id="S3.E5.m1.59.59.3.58.29.29.29.1.1.2">
                 <mi id="S3.E5.m1.33.33.33.5.5.5" xref="S3.E5.m1.33.33.33.5.5.5.cmml">
                  W
                 </mi>
                 <mi id="S3.E5.m1.34.34.34.6.6.6.1" xref="S3.E5.m1.34.34.34.6.6.6.1.cmml">
                  A
                 </mi>
                 <mi id="S3.E5.m1.35.35.35.7.7.7.1" xref="S3.E5.m1.35.35.35.7.7.7.1.cmml">
                  k
                 </mi>
                </msubsup>
                <mo id="S3.E5.m1.36.36.36.8.8.8" xref="S3.E5.m1.36.36.36.8.8.8.cmml">
                 −
                </mo>
                <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1">
                 <mi id="S3.E5.m1.37.37.37.9.9.9" xref="S3.E5.m1.37.37.37.9.9.9.cmml">
                  η
                 </mi>
                 <mo id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.2" lspace="0.167em" rspace="0em">
                  ​
                 </mo>
                 <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.3">
                  <msub id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.3.1">
                   <mo id="S3.E5.m1.38.38.38.10.10.10" rspace="0.167em" xref="S3.E5.m1.38.38.38.10.10.10.cmml">
                    ∇
                   </mo>
                   <msubsup id="S3.E5.m1.39.39.39.11.11.11.1" xref="S3.E5.m1.39.39.39.11.11.11.1.cmml">
                    <mi id="S3.E5.m1.39.39.39.11.11.11.1.2.2" xref="S3.E5.m1.39.39.39.11.11.11.1.2.2.cmml">
                     W
                    </mi>
                    <mi id="S3.E5.m1.39.39.39.11.11.11.1.2.3" xref="S3.E5.m1.39.39.39.11.11.11.1.2.3.cmml">
                     A
                    </mi>
                    <mi id="S3.E5.m1.39.39.39.11.11.11.1.3" xref="S3.E5.m1.39.39.39.11.11.11.1.3.cmml">
                     k
                    </mi>
                   </msubsup>
                  </msub>
                  <mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.40.40.40.12.12.12" xref="S3.E5.m1.40.40.40.12.12.12.cmml">
                   ℒ
                  </mi>
                 </mrow>
                 <mo id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.2a" lspace="0em" rspace="0em">
                  ​
                 </mo>
                 <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1">
                  <mo id="S3.E5.m1.41.41.41.13.13.13" stretchy="false">
                   [
                  </mo>
                  <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1">
                   <mi id="S3.E5.m1.42.42.42.14.14.14" xref="S3.E5.m1.42.42.42.14.14.14.cmml">
                    f
                   </mi>
                   <mo id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.2" lspace="0em" rspace="0em">
                    ​
                   </mo>
                   <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.1.1">
                    <mo id="S3.E5.m1.43.43.43.15.15.15" stretchy="false">
                     (
                    </mo>
                    <mi id="S3.E5.m1.44.44.44.16.16.16" xref="S3.E5.m1.44.44.44.16.16.16.cmml">
                     X
                    </mi>
                    <mo id="S3.E5.m1.45.45.45.17.17.17">
                     ;
                    </mo>
                    <mrow id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.1.1.1">
                     <msubsup id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.1.1.1.2">
                      <mi id="S3.E5.m1.46.46.46.18.18.18" xref="S3.E5.m1.46.46.46.18.18.18.cmml">
                       W
                      </mi>
                      <mi id="S3.E5.m1.47.47.47.19.19.19.1" xref="S3.E5.m1.47.47.47.19.19.19.1.cmml">
                       B
                      </mi>
                      <mi id="S3.E5.m1.48.48.48.20.20.20.1" xref="S3.E5.m1.48.48.48.20.20.20.1.cmml">
                       k
                      </mi>
                     </msubsup>
                     <mo id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.1.1.1.1" lspace="0em" rspace="0em">
                      ​
                     </mo>
                     <msubsup id="S3.E5.m1.59.59.3.58.29.29.29.1.1.1.1.1.1.1.1.1.3">
                      <mi id="S3.E5.m1.49.49.49.21.21.21" xref="S3.E5.m1.49.49.49.21.21.21.cmml">
                       W
                      </mi>
                      <mi id="S3.E5.m1.50.50.50.22.22.22.1" xref="S3.E5.m1.50.50.50.22.22.22.1.cmml">
                       A
                      </mi>
                      <mi id="S3.E5.m1.51.51.51.23.23.23.1" xref="S3.E5.m1.51.51.51.23.23.23.1.cmml">
                       k
                      </mi>
                     </msubsup>
                    </mrow>
                    <mo id="S3.E5.m1.52.52.52.24.24.24" stretchy="false">
                     )
                    </mo>
                   </mrow>
                  </mrow>
                  <mo id="S3.E5.m1.53.53.53.25.25.25">
                   ,
                  </mo>
                  <mi id="S3.E5.m1.54.54.54.26.26.26" xref="S3.E5.m1.54.54.54.26.26.26.cmml">
                   Y
                  </mi>
                  <mo id="S3.E5.m1.55.55.55.27.27.27" stretchy="false">
                   ]
                  </mo>
                 </mrow>
                </mrow>
               </mrow>
              </mrow>
              <mo id="S3.E5.m1.56.56.56.28.28.28" lspace="0em">
               .
              </mo>
             </mrow>
            </mtd>
           </mtr>
          </mtable>
          <annotation-xml encoding="MathML-Content" id="S3.E5.m1.59b">
           <apply id="S3.E5.m1.57.57.1.1.1.3.cmml">
            <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.3a.cmml">
             formulae-sequence
            </csymbol>
            <apply id="S3.E5.m1.57.57.1.1.1.1.1.cmml">
             <ci id="S3.E5.m1.4.4.4.4.4.4.cmml" xref="S3.E5.m1.4.4.4.4.4.4">
              ←
             </ci>
             <apply id="S3.E5.m1.57.57.1.1.1.1.1.3.cmml">
              <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.3.1.cmml">
               superscript
              </csymbol>
              <apply id="S3.E5.m1.57.57.1.1.1.1.1.3.2.cmml">
               <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.3.2.1.cmml">
                subscript
               </csymbol>
               <ci id="S3.E5.m1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1">
                𝑊
               </ci>
               <ci id="S3.E5.m1.2.2.2.2.2.2.1.cmml" xref="S3.E5.m1.2.2.2.2.2.2.1">
                𝐵
               </ci>
              </apply>
              <ci id="S3.E5.m1.3.3.3.3.3.3.1.cmml" xref="S3.E5.m1.3.3.3.3.3.3.1">
               𝑘
              </ci>
             </apply>
             <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.cmml">
              <minus id="S3.E5.m1.8.8.8.8.8.8.cmml" xref="S3.E5.m1.8.8.8.8.8.8">
              </minus>
              <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.3.cmml">
               <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.3.1.cmml">
                superscript
               </csymbol>
               <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.3.2.cmml">
                <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.3.2.1.cmml">
                 subscript
                </csymbol>
                <ci id="S3.E5.m1.5.5.5.5.5.5.cmml" xref="S3.E5.m1.5.5.5.5.5.5">
                 𝑊
                </ci>
                <ci id="S3.E5.m1.6.6.6.6.6.6.1.cmml" xref="S3.E5.m1.6.6.6.6.6.6.1">
                 𝐵
                </ci>
               </apply>
               <ci id="S3.E5.m1.7.7.7.7.7.7.1.cmml" xref="S3.E5.m1.7.7.7.7.7.7.1">
                𝑘
               </ci>
              </apply>
              <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.cmml">
               <times id="S3.E5.m1.57.57.1.1.1.1.1.1.1.2.cmml">
               </times>
               <ci id="S3.E5.m1.9.9.9.9.9.9.cmml" xref="S3.E5.m1.9.9.9.9.9.9">
                𝜂
               </ci>
               <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.4.cmml">
                <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.4.1.cmml">
                 <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.4.1.1.cmml">
                  subscript
                 </csymbol>
                 <ci id="S3.E5.m1.10.10.10.10.10.10.cmml" xref="S3.E5.m1.10.10.10.10.10.10">
                  ∇
                 </ci>
                 <apply id="S3.E5.m1.11.11.11.11.11.11.1.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1">
                  <csymbol cd="ambiguous" id="S3.E5.m1.11.11.11.11.11.11.1.1.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1">
                   superscript
                  </csymbol>
                  <apply id="S3.E5.m1.11.11.11.11.11.11.1.2.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1">
                   <csymbol cd="ambiguous" id="S3.E5.m1.11.11.11.11.11.11.1.2.1.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1">
                    subscript
                   </csymbol>
                   <ci id="S3.E5.m1.11.11.11.11.11.11.1.2.2.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1.2.2">
                    𝑊
                   </ci>
                   <ci id="S3.E5.m1.11.11.11.11.11.11.1.2.3.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1.2.3">
                    𝐵
                   </ci>
                  </apply>
                  <ci id="S3.E5.m1.11.11.11.11.11.11.1.3.cmml" xref="S3.E5.m1.11.11.11.11.11.11.1.3">
                   𝑘
                  </ci>
                 </apply>
                </apply>
                <ci id="S3.E5.m1.12.12.12.12.12.12.cmml" xref="S3.E5.m1.12.12.12.12.12.12">
                 ℒ
                </ci>
               </apply>
               <interval closure="closed" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.2.cmml">
                <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.cmml">
                 <times id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.2.cmml">
                 </times>
                 <ci id="S3.E5.m1.14.14.14.14.14.14.cmml" xref="S3.E5.m1.14.14.14.14.14.14">
                  𝑓
                 </ci>
                 <list id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.2.cmml">
                  <ci id="S3.E5.m1.16.16.16.16.16.16.cmml" xref="S3.E5.m1.16.16.16.16.16.16">
                   𝑋
                  </ci>
                  <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">
                   <times id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">
                   </times>
                   <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">
                    <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml">
                     superscript
                    </csymbol>
                    <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">
                     <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml">
                      subscript
                     </csymbol>
                     <ci id="S3.E5.m1.18.18.18.18.18.18.cmml" xref="S3.E5.m1.18.18.18.18.18.18">
                      𝑊
                     </ci>
                     <ci id="S3.E5.m1.19.19.19.19.19.19.1.cmml" xref="S3.E5.m1.19.19.19.19.19.19.1">
                      𝐵
                     </ci>
                    </apply>
                    <ci id="S3.E5.m1.20.20.20.20.20.20.1.cmml" xref="S3.E5.m1.20.20.20.20.20.20.1">
                     𝑘
                    </ci>
                   </apply>
                   <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">
                    <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml">
                     superscript
                    </csymbol>
                    <apply id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml">
                     <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.1.1.1.1.1.1.1.1.1.1.3.2.1.cmml">
                      subscript
                     </csymbol>
                     <ci id="S3.E5.m1.21.21.21.21.21.21.cmml" xref="S3.E5.m1.21.21.21.21.21.21">
                      𝑊
                     </ci>
                     <ci id="S3.E5.m1.22.22.22.22.22.22.1.cmml" xref="S3.E5.m1.22.22.22.22.22.22.1">
                      𝐴
                     </ci>
                    </apply>
                    <ci id="S3.E5.m1.23.23.23.23.23.23.1.cmml" xref="S3.E5.m1.23.23.23.23.23.23.1">
                     𝑘
                    </ci>
                   </apply>
                  </apply>
                 </list>
                </apply>
                <ci id="S3.E5.m1.26.26.26.26.26.26.cmml" xref="S3.E5.m1.26.26.26.26.26.26">
                 𝑌
                </ci>
               </interval>
              </apply>
             </apply>
            </apply>
            <apply id="S3.E5.m1.57.57.1.1.1.2.2.cmml">
             <ci id="S3.E5.m1.32.32.32.4.4.4.cmml" xref="S3.E5.m1.32.32.32.4.4.4">
              ←
             </ci>
             <apply id="S3.E5.m1.57.57.1.1.1.2.2.3.cmml">
              <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.3.1.cmml">
               superscript
              </csymbol>
              <apply id="S3.E5.m1.57.57.1.1.1.2.2.3.2.cmml">
               <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.3.2.1.cmml">
                subscript
               </csymbol>
               <ci id="S3.E5.m1.29.29.29.1.1.1.cmml" xref="S3.E5.m1.29.29.29.1.1.1">
                𝑊
               </ci>
               <ci id="S3.E5.m1.30.30.30.2.2.2.1.cmml" xref="S3.E5.m1.30.30.30.2.2.2.1">
                𝐴
               </ci>
              </apply>
              <ci id="S3.E5.m1.31.31.31.3.3.3.1.cmml" xref="S3.E5.m1.31.31.31.3.3.3.1">
               𝑘
              </ci>
             </apply>
             <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.cmml">
              <minus id="S3.E5.m1.36.36.36.8.8.8.cmml" xref="S3.E5.m1.36.36.36.8.8.8">
              </minus>
              <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.3.cmml">
               <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.3.1.cmml">
                superscript
               </csymbol>
               <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.3.2.cmml">
                <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.3.2.1.cmml">
                 subscript
                </csymbol>
                <ci id="S3.E5.m1.33.33.33.5.5.5.cmml" xref="S3.E5.m1.33.33.33.5.5.5">
                 𝑊
                </ci>
                <ci id="S3.E5.m1.34.34.34.6.6.6.1.cmml" xref="S3.E5.m1.34.34.34.6.6.6.1">
                 𝐴
                </ci>
               </apply>
               <ci id="S3.E5.m1.35.35.35.7.7.7.1.cmml" xref="S3.E5.m1.35.35.35.7.7.7.1">
                𝑘
               </ci>
              </apply>
              <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.cmml">
               <times id="S3.E5.m1.57.57.1.1.1.2.2.1.1.2.cmml">
               </times>
               <ci id="S3.E5.m1.37.37.37.9.9.9.cmml" xref="S3.E5.m1.37.37.37.9.9.9">
                𝜂
               </ci>
               <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.4.cmml">
                <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.4.1.cmml">
                 <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.4.1.1.cmml">
                  subscript
                 </csymbol>
                 <ci id="S3.E5.m1.38.38.38.10.10.10.cmml" xref="S3.E5.m1.38.38.38.10.10.10">
                  ∇
                 </ci>
                 <apply id="S3.E5.m1.39.39.39.11.11.11.1.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1">
                  <csymbol cd="ambiguous" id="S3.E5.m1.39.39.39.11.11.11.1.1.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1">
                   superscript
                  </csymbol>
                  <apply id="S3.E5.m1.39.39.39.11.11.11.1.2.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1">
                   <csymbol cd="ambiguous" id="S3.E5.m1.39.39.39.11.11.11.1.2.1.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1">
                    subscript
                   </csymbol>
                   <ci id="S3.E5.m1.39.39.39.11.11.11.1.2.2.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1.2.2">
                    𝑊
                   </ci>
                   <ci id="S3.E5.m1.39.39.39.11.11.11.1.2.3.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1.2.3">
                    𝐴
                   </ci>
                  </apply>
                  <ci id="S3.E5.m1.39.39.39.11.11.11.1.3.cmml" xref="S3.E5.m1.39.39.39.11.11.11.1.3">
                   𝑘
                  </ci>
                 </apply>
                </apply>
                <ci id="S3.E5.m1.40.40.40.12.12.12.cmml" xref="S3.E5.m1.40.40.40.12.12.12">
                 ℒ
                </ci>
               </apply>
               <interval closure="closed" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.2.cmml">
                <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.cmml">
                 <times id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.2.cmml">
                 </times>
                 <ci id="S3.E5.m1.42.42.42.14.14.14.cmml" xref="S3.E5.m1.42.42.42.14.14.14">
                  𝑓
                 </ci>
                 <list id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.2.cmml">
                  <ci id="S3.E5.m1.44.44.44.16.16.16.cmml" xref="S3.E5.m1.44.44.44.16.16.16">
                   𝑋
                  </ci>
                  <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.cmml">
                   <times id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.1.cmml">
                   </times>
                   <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.2.cmml">
                    <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.2.1.cmml">
                     superscript
                    </csymbol>
                    <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2.cmml">
                     <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2.1.cmml">
                      subscript
                     </csymbol>
                     <ci id="S3.E5.m1.46.46.46.18.18.18.cmml" xref="S3.E5.m1.46.46.46.18.18.18">
                      𝑊
                     </ci>
                     <ci id="S3.E5.m1.47.47.47.19.19.19.1.cmml" xref="S3.E5.m1.47.47.47.19.19.19.1">
                      𝐵
                     </ci>
                    </apply>
                    <ci id="S3.E5.m1.48.48.48.20.20.20.1.cmml" xref="S3.E5.m1.48.48.48.20.20.20.1">
                     𝑘
                    </ci>
                   </apply>
                   <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.3.cmml">
                    <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.3.1.cmml">
                     superscript
                    </csymbol>
                    <apply id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.3.2.cmml">
                     <csymbol cd="ambiguous" id="S3.E5.m1.57.57.1.1.1.2.2.1.1.1.1.1.1.1.1.3.2.1.cmml">
                      subscript
                     </csymbol>
                     <ci id="S3.E5.m1.49.49.49.21.21.21.cmml" xref="S3.E5.m1.49.49.49.21.21.21">
                      𝑊
                     </ci>
                     <ci id="S3.E5.m1.50.50.50.22.22.22.1.cmml" xref="S3.E5.m1.50.50.50.22.22.22.1">
                      𝐴
                     </ci>
                    </apply>
                    <ci id="S3.E5.m1.51.51.51.23.23.23.1.cmml" xref="S3.E5.m1.51.51.51.23.23.23.1">
                     𝑘
                    </ci>
                   </apply>
                  </apply>
                 </list>
                </apply>
                <ci id="S3.E5.m1.54.54.54.26.26.26.cmml" xref="S3.E5.m1.54.54.54.26.26.26">
                 𝑌
                </ci>
               </interval>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E5.m1.59c">
           \begin{split}W_{B}^{k}\leftarrow W_{B}^{k}-\eta\nabla_{W_{B}^{k}}\mathcal{L}[f(X;W_{B}^{k}W_{A}^{k}),Y],\\
W_{A}^{k}\leftarrow W_{A}^{k}-\eta\nabla_{W_{A}^{k}}\mathcal{L}[f(X;W_{B}^{k}W_{A}^{k}),Y].\end{split}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (5)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S3.SS1.p3.13">
     Since different characters are trained with non-overlapping LoRA blocks, Neeko could keep the information of previous characters without retraining.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S3.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     3.2
    </span>
    Role Selection with Gating Network
   </h3>
   <div class="ltx_para" id="S3.SS2.p1">
    <p class="ltx_p" id="S3.SS2.p1.7">
     To enable the activation of specific LoRA blocks for role-based instruction during inference, we introduce a unique gating network inspired by the Mixture of Experts (MoE)
     <cite class="ltx_cite ltx_citemacro_citep">
      (Eigen et al.,
      <a class="ltx_ref" href="#bib.bib5" title="">
       2013
      </a>
      ; Chen et al.,
      <a class="ltx_ref" href="#bib.bib3" title="">
       2023b
      </a>
      ; Luo et al.,
      <a class="ltx_ref" href="#bib.bib13" title="">
       2024
      </a>
      )
     </cite>
     . Unlike previous approaches, this network takes the role identity as input to retrieve role-specific LoRA parameters.
For clarity, we establish a global role embedding matrix, denoted as
     <math alttext="\mathbf{E}_{\text{global}}\in\mathbb{R}^{M\times d}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1">
      <semantics id="S3.SS2.p1.1.m1.1a">
       <mrow id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml">
        <msub id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">
         <mi id="S3.SS2.p1.1.m1.1.1.2.2" xref="S3.SS2.p1.1.m1.1.1.2.2.cmml">
          𝐄
         </mi>
         <mtext id="S3.SS2.p1.1.m1.1.1.2.3" xref="S3.SS2.p1.1.m1.1.1.2.3a.cmml">
          global
         </mtext>
        </msub>
        <mo id="S3.SS2.p1.1.m1.1.1.1" xref="S3.SS2.p1.1.m1.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml">
         <mi id="S3.SS2.p1.1.m1.1.1.3.2" xref="S3.SS2.p1.1.m1.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S3.SS2.p1.1.m1.1.1.3.3" xref="S3.SS2.p1.1.m1.1.1.3.3.cmml">
          <mi id="S3.SS2.p1.1.m1.1.1.3.3.2" xref="S3.SS2.p1.1.m1.1.1.3.3.2.cmml">
           M
          </mi>
          <mo id="S3.SS2.p1.1.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.p1.1.m1.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S3.SS2.p1.1.m1.1.1.3.3.3" xref="S3.SS2.p1.1.m1.1.1.3.3.3.cmml">
           d
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b">
        <apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">
         <in id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1.1">
         </in>
         <apply id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2">
          <csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.2.1.cmml" xref="S3.SS2.p1.1.m1.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.SS2.p1.1.m1.1.1.2.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2.2">
           𝐄
          </ci>
          <ci id="S3.SS2.p1.1.m1.1.1.2.3a.cmml" xref="S3.SS2.p1.1.m1.1.1.2.3">
           <mtext id="S3.SS2.p1.1.m1.1.1.2.3.cmml" mathsize="70%" xref="S3.SS2.p1.1.m1.1.1.2.3">
            global
           </mtext>
          </ci>
         </apply>
         <apply id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.3.1.cmml" xref="S3.SS2.p1.1.m1.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS2.p1.1.m1.1.1.3.2.cmml" xref="S3.SS2.p1.1.m1.1.1.3.2">
           ℝ
          </ci>
          <apply id="S3.SS2.p1.1.m1.1.1.3.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3.3">
           <times id="S3.SS2.p1.1.m1.1.1.3.3.1.cmml" xref="S3.SS2.p1.1.m1.1.1.3.3.1">
           </times>
           <ci id="S3.SS2.p1.1.m1.1.1.3.3.2.cmml" xref="S3.SS2.p1.1.m1.1.1.3.3.2">
            𝑀
           </ci>
           <ci id="S3.SS2.p1.1.m1.1.1.3.3.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3.3.3">
            𝑑
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">
        \mathbf{E}_{\text{global}}\in\mathbb{R}^{M\times d}
       </annotation>
      </semantics>
     </math>
     , using the profiles of
     <math alttext="M" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1">
      <semantics id="S3.SS2.p1.2.m2.1a">
       <mi id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml">
        M
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b">
        <ci id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">
         𝑀
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">
        M
       </annotation>
      </semantics>
     </math>
     existing characters.
When identifying a role
     <math alttext="r_{k}\in R" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1">
      <semantics id="S3.SS2.p1.3.m3.1a">
       <mrow id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml">
        <msub id="S3.SS2.p1.3.m3.1.1.2" xref="S3.SS2.p1.3.m3.1.1.2.cmml">
         <mi id="S3.SS2.p1.3.m3.1.1.2.2" xref="S3.SS2.p1.3.m3.1.1.2.2.cmml">
          r
         </mi>
         <mi id="S3.SS2.p1.3.m3.1.1.2.3" xref="S3.SS2.p1.3.m3.1.1.2.3.cmml">
          k
         </mi>
        </msub>
        <mo id="S3.SS2.p1.3.m3.1.1.1" xref="S3.SS2.p1.3.m3.1.1.1.cmml">
         ∈
        </mo>
        <mi id="S3.SS2.p1.3.m3.1.1.3" xref="S3.SS2.p1.3.m3.1.1.3.cmml">
         R
        </mi>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b">
        <apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">
         <in id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1.1">
         </in>
         <apply id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2">
          <csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.2.1.cmml" xref="S3.SS2.p1.3.m3.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.SS2.p1.3.m3.1.1.2.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2.2">
           𝑟
          </ci>
          <ci id="S3.SS2.p1.3.m3.1.1.2.3.cmml" xref="S3.SS2.p1.3.m3.1.1.2.3">
           𝑘
          </ci>
         </apply>
         <ci id="S3.SS2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3">
          𝑅
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">
        r_{k}\in R
       </annotation>
      </semantics>
     </math>
     ,
we extract its representation vector
     <math alttext="e_{k}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1">
      <semantics id="S3.SS2.p1.4.m4.1a">
       <mrow id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml">
        <msub id="S3.SS2.p1.4.m4.1.1.2" xref="S3.SS2.p1.4.m4.1.1.2.cmml">
         <mi id="S3.SS2.p1.4.m4.1.1.2.2" xref="S3.SS2.p1.4.m4.1.1.2.2.cmml">
          e
         </mi>
         <mi id="S3.SS2.p1.4.m4.1.1.2.3" xref="S3.SS2.p1.4.m4.1.1.2.3.cmml">
          k
         </mi>
        </msub>
        <mo id="S3.SS2.p1.4.m4.1.1.1" xref="S3.SS2.p1.4.m4.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS2.p1.4.m4.1.1.3" xref="S3.SS2.p1.4.m4.1.1.3.cmml">
         <mi id="S3.SS2.p1.4.m4.1.1.3.2" xref="S3.SS2.p1.4.m4.1.1.3.2.cmml">
          ℝ
         </mi>
         <mi id="S3.SS2.p1.4.m4.1.1.3.3" xref="S3.SS2.p1.4.m4.1.1.3.3.cmml">
          d
         </mi>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b">
        <apply id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">
         <in id="S3.SS2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1.1">
         </in>
         <apply id="S3.SS2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2">
          <csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.2.1.cmml" xref="S3.SS2.p1.4.m4.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.SS2.p1.4.m4.1.1.2.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2.2">
           𝑒
          </ci>
          <ci id="S3.SS2.p1.4.m4.1.1.2.3.cmml" xref="S3.SS2.p1.4.m4.1.1.2.3">
           𝑘
          </ci>
         </apply>
         <apply id="S3.SS2.p1.4.m4.1.1.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.p1.4.m4.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS2.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.p1.4.m4.1.1.3.2">
           ℝ
          </ci>
          <ci id="S3.SS2.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3.3">
           𝑑
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">
        e_{k}\in\mathbb{R}^{d}
       </annotation>
      </semantics>
     </math>
     from the
     <math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m5.1">
      <semantics id="S3.SS2.p1.5.m5.1a">
       <mi id="S3.SS2.p1.5.m5.1.1" xref="S3.SS2.p1.5.m5.1.1.cmml">
        k
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m5.1b">
        <ci id="S3.SS2.p1.5.m5.1.1.cmml" xref="S3.SS2.p1.5.m5.1.1">
         𝑘
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.5.m5.1c">
        k
       </annotation>
      </semantics>
     </math>
     -th column of
     <math alttext="\mathbf{E}_{\text{global}}" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m6.1">
      <semantics id="S3.SS2.p1.6.m6.1a">
       <msub id="S3.SS2.p1.6.m6.1.1" xref="S3.SS2.p1.6.m6.1.1.cmml">
        <mi id="S3.SS2.p1.6.m6.1.1.2" xref="S3.SS2.p1.6.m6.1.1.2.cmml">
         𝐄
        </mi>
        <mtext id="S3.SS2.p1.6.m6.1.1.3" xref="S3.SS2.p1.6.m6.1.1.3a.cmml">
         global
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m6.1b">
        <apply id="S3.SS2.p1.6.m6.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p1.6.m6.1.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p1.6.m6.1.1.2.cmml" xref="S3.SS2.p1.6.m6.1.1.2">
          𝐄
         </ci>
         <ci id="S3.SS2.p1.6.m6.1.1.3a.cmml" xref="S3.SS2.p1.6.m6.1.1.3">
          <mtext id="S3.SS2.p1.6.m6.1.1.3.cmml" mathsize="70%" xref="S3.SS2.p1.6.m6.1.1.3">
           global
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.6.m6.1c">
        \mathbf{E}_{\text{global}}
       </annotation>
      </semantics>
     </math>
     . To determine the contribution weights for role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m7.1">
      <semantics id="S3.SS2.p1.7.m7.1a">
       <msub id="S3.SS2.p1.7.m7.1.1" xref="S3.SS2.p1.7.m7.1.1.cmml">
        <mi id="S3.SS2.p1.7.m7.1.1.2" xref="S3.SS2.p1.7.m7.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS2.p1.7.m7.1.1.3" xref="S3.SS2.p1.7.m7.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m7.1b">
        <apply id="S3.SS2.p1.7.m7.1.1.cmml" xref="S3.SS2.p1.7.m7.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p1.7.m7.1.1.1.cmml" xref="S3.SS2.p1.7.m7.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p1.7.m7.1.1.2.cmml" xref="S3.SS2.p1.7.m7.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS2.p1.7.m7.1.1.3.cmml" xref="S3.SS2.p1.7.m7.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p1.7.m7.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     , we apply a linear transformation using the following equation:
    </p>
   </div>
   <div class="ltx_para" id="S3.SS2.p2">
    <table class="ltx_equation ltx_eqn_table" id="S3.E6">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="\begin{split}w_{k}=\text{Gate}(\mathbf{E}_{\text{global}}(k))=\text{Softmax}(W_{G}\cdot e_{k}),\end{split}" class="ltx_Math" display="block" id="S3.E6.m1.23">
         <semantics id="S3.E6.m1.23a">
          <mtable displaystyle="true" id="S3.E6.m1.23.23.2">
           <mtr id="S3.E6.m1.23.23.2a">
            <mtd class="ltx_align_right" columnalign="right" id="S3.E6.m1.23.23.2b">
             <mrow id="S3.E6.m1.23.23.2.22.22.22.22">
              <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1">
               <msub id="S3.E6.m1.23.23.2.22.22.22.22.1.4">
                <mi id="S3.E6.m1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.cmml">
                 w
                </mi>
                <mi id="S3.E6.m1.2.2.2.2.2.2.1" xref="S3.E6.m1.2.2.2.2.2.2.1.cmml">
                 k
                </mi>
               </msub>
               <mo id="S3.E6.m1.3.3.3.3.3.3" xref="S3.E6.m1.3.3.3.3.3.3.cmml">
                =
               </mo>
               <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.1">
                <mtext id="S3.E6.m1.4.4.4.4.4.4" xref="S3.E6.m1.4.4.4.4.4.4a.cmml">
                 Gate
                </mtext>
                <mo id="S3.E6.m1.23.23.2.22.22.22.22.1.1.2" lspace="0em" rspace="0em" xref="S3.E6.m1.22.22.1.1.1.cmml">
                 ​
                </mo>
                <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.1.1.1">
                 <mo id="S3.E6.m1.5.5.5.5.5.5" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                  (
                 </mo>
                 <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.1.1.1.1">
                  <msub id="S3.E6.m1.23.23.2.22.22.22.22.1.1.1.1.1.2">
                   <mi id="S3.E6.m1.6.6.6.6.6.6" xref="S3.E6.m1.6.6.6.6.6.6.cmml">
                    𝐄
                   </mi>
                   <mtext id="S3.E6.m1.7.7.7.7.7.7.1" xref="S3.E6.m1.7.7.7.7.7.7.1a.cmml">
                    global
                   </mtext>
                  </msub>
                  <mo id="S3.E6.m1.23.23.2.22.22.22.22.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S3.E6.m1.22.22.1.1.1.cmml">
                   ​
                  </mo>
                  <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.1.1.1.1.3">
                   <mo id="S3.E6.m1.8.8.8.8.8.8" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                    (
                   </mo>
                   <mi id="S3.E6.m1.9.9.9.9.9.9" xref="S3.E6.m1.9.9.9.9.9.9.cmml">
                    k
                   </mi>
                   <mo id="S3.E6.m1.10.10.10.10.10.10" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                    )
                   </mo>
                  </mrow>
                 </mrow>
                 <mo id="S3.E6.m1.11.11.11.11.11.11" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                  )
                 </mo>
                </mrow>
               </mrow>
               <mo id="S3.E6.m1.12.12.12.12.12.12" xref="S3.E6.m1.12.12.12.12.12.12.cmml">
                =
               </mo>
               <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.2">
                <mtext id="S3.E6.m1.13.13.13.13.13.13" xref="S3.E6.m1.13.13.13.13.13.13a.cmml">
                 Softmax
                </mtext>
                <mo id="S3.E6.m1.23.23.2.22.22.22.22.1.2.2" lspace="0em" rspace="0em" xref="S3.E6.m1.22.22.1.1.1.cmml">
                 ​
                </mo>
                <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.2.1.1">
                 <mo id="S3.E6.m1.14.14.14.14.14.14" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                  (
                 </mo>
                 <mrow id="S3.E6.m1.23.23.2.22.22.22.22.1.2.1.1.1">
                  <msub id="S3.E6.m1.23.23.2.22.22.22.22.1.2.1.1.1.1">
                   <mi id="S3.E6.m1.15.15.15.15.15.15" xref="S3.E6.m1.15.15.15.15.15.15.cmml">
                    W
                   </mi>
                   <mi id="S3.E6.m1.16.16.16.16.16.16.1" xref="S3.E6.m1.16.16.16.16.16.16.1.cmml">
                    G
                   </mi>
                  </msub>
                  <mo id="S3.E6.m1.17.17.17.17.17.17" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.17.17.17.17.17.17.cmml">
                   ⋅
                  </mo>
                  <msub id="S3.E6.m1.23.23.2.22.22.22.22.1.2.1.1.1.2">
                   <mi id="S3.E6.m1.18.18.18.18.18.18" xref="S3.E6.m1.18.18.18.18.18.18.cmml">
                    e
                   </mi>
                   <mi id="S3.E6.m1.19.19.19.19.19.19.1" xref="S3.E6.m1.19.19.19.19.19.19.1.cmml">
                    k
                   </mi>
                  </msub>
                 </mrow>
                 <mo id="S3.E6.m1.20.20.20.20.20.20" stretchy="false" xref="S3.E6.m1.22.22.1.1.1.cmml">
                  )
                 </mo>
                </mrow>
               </mrow>
              </mrow>
              <mo id="S3.E6.m1.21.21.21.21.21.21" xref="S3.E6.m1.22.22.1.1.1.cmml">
               ,
              </mo>
             </mrow>
            </mtd>
           </mtr>
          </mtable>
          <annotation-xml encoding="MathML-Content" id="S3.E6.m1.23b">
           <apply id="S3.E6.m1.22.22.1.1.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
            <and id="S3.E6.m1.22.22.1.1.1a.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
            </and>
            <apply id="S3.E6.m1.22.22.1.1.1b.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
             <eq id="S3.E6.m1.3.3.3.3.3.3.cmml" xref="S3.E6.m1.3.3.3.3.3.3">
             </eq>
             <apply id="S3.E6.m1.22.22.1.1.1.4.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
              <csymbol cd="ambiguous" id="S3.E6.m1.22.22.1.1.1.4.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
               subscript
              </csymbol>
              <ci id="S3.E6.m1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1">
               𝑤
              </ci>
              <ci id="S3.E6.m1.2.2.2.2.2.2.1.cmml" xref="S3.E6.m1.2.2.2.2.2.2.1">
               𝑘
              </ci>
             </apply>
             <apply id="S3.E6.m1.22.22.1.1.1.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
              <times id="S3.E6.m1.22.22.1.1.1.1.2.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
              </times>
              <ci id="S3.E6.m1.4.4.4.4.4.4a.cmml" xref="S3.E6.m1.4.4.4.4.4.4">
               <mtext id="S3.E6.m1.4.4.4.4.4.4.cmml" xref="S3.E6.m1.4.4.4.4.4.4">
                Gate
               </mtext>
              </ci>
              <apply id="S3.E6.m1.22.22.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
               <times id="S3.E6.m1.22.22.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
               </times>
               <apply id="S3.E6.m1.22.22.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                <csymbol cd="ambiguous" id="S3.E6.m1.22.22.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                 subscript
                </csymbol>
                <ci id="S3.E6.m1.6.6.6.6.6.6.cmml" xref="S3.E6.m1.6.6.6.6.6.6">
                 𝐄
                </ci>
                <ci id="S3.E6.m1.7.7.7.7.7.7.1a.cmml" xref="S3.E6.m1.7.7.7.7.7.7.1">
                 <mtext id="S3.E6.m1.7.7.7.7.7.7.1.cmml" mathsize="70%" xref="S3.E6.m1.7.7.7.7.7.7.1">
                  global
                 </mtext>
                </ci>
               </apply>
               <ci id="S3.E6.m1.9.9.9.9.9.9.cmml" xref="S3.E6.m1.9.9.9.9.9.9">
                𝑘
               </ci>
              </apply>
             </apply>
            </apply>
            <apply id="S3.E6.m1.22.22.1.1.1c.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
             <eq id="S3.E6.m1.12.12.12.12.12.12.cmml" xref="S3.E6.m1.12.12.12.12.12.12">
             </eq>
             <share href="#S3.E6.m1.22.22.1.1.1.1.cmml" id="S3.E6.m1.22.22.1.1.1d.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
             </share>
             <apply id="S3.E6.m1.22.22.1.1.1.2.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
              <times id="S3.E6.m1.22.22.1.1.1.2.2.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
              </times>
              <ci id="S3.E6.m1.13.13.13.13.13.13a.cmml" xref="S3.E6.m1.13.13.13.13.13.13">
               <mtext id="S3.E6.m1.13.13.13.13.13.13.cmml" xref="S3.E6.m1.13.13.13.13.13.13">
                Softmax
               </mtext>
              </ci>
              <apply id="S3.E6.m1.22.22.1.1.1.2.1.1.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
               <ci id="S3.E6.m1.17.17.17.17.17.17.cmml" xref="S3.E6.m1.17.17.17.17.17.17">
                ⋅
               </ci>
               <apply id="S3.E6.m1.22.22.1.1.1.2.1.1.1.2.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                <csymbol cd="ambiguous" id="S3.E6.m1.22.22.1.1.1.2.1.1.1.2.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                 subscript
                </csymbol>
                <ci id="S3.E6.m1.15.15.15.15.15.15.cmml" xref="S3.E6.m1.15.15.15.15.15.15">
                 𝑊
                </ci>
                <ci id="S3.E6.m1.16.16.16.16.16.16.1.cmml" xref="S3.E6.m1.16.16.16.16.16.16.1">
                 𝐺
                </ci>
               </apply>
               <apply id="S3.E6.m1.22.22.1.1.1.2.1.1.1.3.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                <csymbol cd="ambiguous" id="S3.E6.m1.22.22.1.1.1.2.1.1.1.3.1.cmml" xref="S3.E6.m1.23.23.2.22.22.22.22.1.1.2">
                 subscript
                </csymbol>
                <ci id="S3.E6.m1.18.18.18.18.18.18.cmml" xref="S3.E6.m1.18.18.18.18.18.18">
                 𝑒
                </ci>
                <ci id="S3.E6.m1.19.19.19.19.19.19.1.cmml" xref="S3.E6.m1.19.19.19.19.19.19.1">
                 𝑘
                </ci>
               </apply>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E6.m1.23c">
           \begin{split}w_{k}=\text{Gate}(\mathbf{E}_{\text{global}}(k))=\text{Softmax}(W_{G}\cdot e_{k}),\end{split}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (6)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S3.SS2.p2.3">
     where
     <math alttext="w_{k}\in\mathbb{R}^{M}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1">
      <semantics id="S3.SS2.p2.1.m1.1a">
       <mrow id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml">
        <msub id="S3.SS2.p2.1.m1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.2.cmml">
         <mi id="S3.SS2.p2.1.m1.1.1.2.2" xref="S3.SS2.p2.1.m1.1.1.2.2.cmml">
          w
         </mi>
         <mi id="S3.SS2.p2.1.m1.1.1.2.3" xref="S3.SS2.p2.1.m1.1.1.2.3.cmml">
          k
         </mi>
        </msub>
        <mo id="S3.SS2.p2.1.m1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS2.p2.1.m1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.3.cmml">
         <mi id="S3.SS2.p2.1.m1.1.1.3.2" xref="S3.SS2.p2.1.m1.1.1.3.2.cmml">
          ℝ
         </mi>
         <mi id="S3.SS2.p2.1.m1.1.1.3.3" xref="S3.SS2.p2.1.m1.1.1.3.3.cmml">
          M
         </mi>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b">
        <apply id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">
         <in id="S3.SS2.p2.1.m1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1">
         </in>
         <apply id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2">
          <csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.2.1.cmml" xref="S3.SS2.p2.1.m1.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.SS2.p2.1.m1.1.1.2.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2.2">
           𝑤
          </ci>
          <ci id="S3.SS2.p2.1.m1.1.1.2.3.cmml" xref="S3.SS2.p2.1.m1.1.1.2.3">
           𝑘
          </ci>
         </apply>
         <apply id="S3.SS2.p2.1.m1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.3.1.cmml" xref="S3.SS2.p2.1.m1.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS2.p2.1.m1.1.1.3.2.cmml" xref="S3.SS2.p2.1.m1.1.1.3.2">
           ℝ
          </ci>
          <ci id="S3.SS2.p2.1.m1.1.1.3.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3.3">
           𝑀
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">
        w_{k}\in\mathbb{R}^{M}
       </annotation>
      </semantics>
     </math>
     represents the contribution weight vector tailored for role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1">
      <semantics id="S3.SS2.p2.2.m2.1a">
       <msub id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml">
        <mi id="S3.SS2.p2.2.m2.1.1.2" xref="S3.SS2.p2.2.m2.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS2.p2.2.m2.1.1.3" xref="S3.SS2.p2.2.m2.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b">
        <apply id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p2.2.m2.1.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p2.2.m2.1.1.2.cmml" xref="S3.SS2.p2.2.m2.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS2.p2.2.m2.1.1.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     to select LoRA blocks, and
     <math alttext="W_{G}\in\mathbb{R}^{d\times M}" class="ltx_Math" display="inline" id="S3.SS2.p2.3.m3.1">
      <semantics id="S3.SS2.p2.3.m3.1a">
       <mrow id="S3.SS2.p2.3.m3.1.1" xref="S3.SS2.p2.3.m3.1.1.cmml">
        <msub id="S3.SS2.p2.3.m3.1.1.2" xref="S3.SS2.p2.3.m3.1.1.2.cmml">
         <mi id="S3.SS2.p2.3.m3.1.1.2.2" xref="S3.SS2.p2.3.m3.1.1.2.2.cmml">
          W
         </mi>
         <mi id="S3.SS2.p2.3.m3.1.1.2.3" xref="S3.SS2.p2.3.m3.1.1.2.3.cmml">
          G
         </mi>
        </msub>
        <mo id="S3.SS2.p2.3.m3.1.1.1" xref="S3.SS2.p2.3.m3.1.1.1.cmml">
         ∈
        </mo>
        <msup id="S3.SS2.p2.3.m3.1.1.3" xref="S3.SS2.p2.3.m3.1.1.3.cmml">
         <mi id="S3.SS2.p2.3.m3.1.1.3.2" xref="S3.SS2.p2.3.m3.1.1.3.2.cmml">
          ℝ
         </mi>
         <mrow id="S3.SS2.p2.3.m3.1.1.3.3" xref="S3.SS2.p2.3.m3.1.1.3.3.cmml">
          <mi id="S3.SS2.p2.3.m3.1.1.3.3.2" xref="S3.SS2.p2.3.m3.1.1.3.3.2.cmml">
           d
          </mi>
          <mo id="S3.SS2.p2.3.m3.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.p2.3.m3.1.1.3.3.1.cmml">
           ×
          </mo>
          <mi id="S3.SS2.p2.3.m3.1.1.3.3.3" xref="S3.SS2.p2.3.m3.1.1.3.3.3.cmml">
           M
          </mi>
         </mrow>
        </msup>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.1b">
        <apply id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1">
         <in id="S3.SS2.p2.3.m3.1.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1.1">
         </in>
         <apply id="S3.SS2.p2.3.m3.1.1.2.cmml" xref="S3.SS2.p2.3.m3.1.1.2">
          <csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.1.1.2.1.cmml" xref="S3.SS2.p2.3.m3.1.1.2">
           subscript
          </csymbol>
          <ci id="S3.SS2.p2.3.m3.1.1.2.2.cmml" xref="S3.SS2.p2.3.m3.1.1.2.2">
           𝑊
          </ci>
          <ci id="S3.SS2.p2.3.m3.1.1.2.3.cmml" xref="S3.SS2.p2.3.m3.1.1.2.3">
           𝐺
          </ci>
         </apply>
         <apply id="S3.SS2.p2.3.m3.1.1.3.cmml" xref="S3.SS2.p2.3.m3.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.1.1.3.1.cmml" xref="S3.SS2.p2.3.m3.1.1.3">
           superscript
          </csymbol>
          <ci id="S3.SS2.p2.3.m3.1.1.3.2.cmml" xref="S3.SS2.p2.3.m3.1.1.3.2">
           ℝ
          </ci>
          <apply id="S3.SS2.p2.3.m3.1.1.3.3.cmml" xref="S3.SS2.p2.3.m3.1.1.3.3">
           <times id="S3.SS2.p2.3.m3.1.1.3.3.1.cmml" xref="S3.SS2.p2.3.m3.1.1.3.3.1">
           </times>
           <ci id="S3.SS2.p2.3.m3.1.1.3.3.2.cmml" xref="S3.SS2.p2.3.m3.1.1.3.3.2">
            𝑑
           </ci>
           <ci id="S3.SS2.p2.3.m3.1.1.3.3.3.cmml" xref="S3.SS2.p2.3.m3.1.1.3.3.3">
            𝑀
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.1c">
        W_{G}\in\mathbb{R}^{d\times M}
       </annotation>
      </semantics>
     </math>
     is the transformation matrix of the gating network. The softmax operation normalizes these weights.
    </p>
   </div>
   <div class="ltx_para" id="S3.SS2.p3">
    <p class="ltx_p" id="S3.SS2.p3.7">
     During the inference stage, Neeko retrieves the representation
     <math alttext="e_{k}" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1">
      <semantics id="S3.SS2.p3.1.m1.1a">
       <msub id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml">
        <mi id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">
         e
        </mi>
        <mi id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b">
        <apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p3.1.m1.1.1.2.cmml" xref="S3.SS2.p3.1.m1.1.1.2">
          𝑒
         </ci>
         <ci id="S3.SS2.p3.1.m1.1.1.3.cmml" xref="S3.SS2.p3.1.m1.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">
        e_{k}
       </annotation>
      </semantics>
     </math>
     for the target character
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m2.1">
      <semantics id="S3.SS2.p3.2.m2.1a">
       <msub id="S3.SS2.p3.2.m2.1.1" xref="S3.SS2.p3.2.m2.1.1.cmml">
        <mi id="S3.SS2.p3.2.m2.1.1.2" xref="S3.SS2.p3.2.m2.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS2.p3.2.m2.1.1.3" xref="S3.SS2.p3.2.m2.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m2.1b">
        <apply id="S3.SS2.p3.2.m2.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p3.2.m2.1.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p3.2.m2.1.1.2.cmml" xref="S3.SS2.p3.2.m2.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS2.p3.2.m2.1.1.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.2.m2.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     from
     <math alttext="\mathbf{E}_{\text{global}}" class="ltx_Math" display="inline" id="S3.SS2.p3.3.m3.1">
      <semantics id="S3.SS2.p3.3.m3.1a">
       <msub id="S3.SS2.p3.3.m3.1.1" xref="S3.SS2.p3.3.m3.1.1.cmml">
        <mi id="S3.SS2.p3.3.m3.1.1.2" xref="S3.SS2.p3.3.m3.1.1.2.cmml">
         𝐄
        </mi>
        <mtext id="S3.SS2.p3.3.m3.1.1.3" xref="S3.SS2.p3.3.m3.1.1.3a.cmml">
         global
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.3.m3.1b">
        <apply id="S3.SS2.p3.3.m3.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p3.3.m3.1.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p3.3.m3.1.1.2.cmml" xref="S3.SS2.p3.3.m3.1.1.2">
          𝐄
         </ci>
         <ci id="S3.SS2.p3.3.m3.1.1.3a.cmml" xref="S3.SS2.p3.3.m3.1.1.3">
          <mtext id="S3.SS2.p3.3.m3.1.1.3.cmml" mathsize="70%" xref="S3.SS2.p3.3.m3.1.1.3">
           global
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.3.m3.1c">
        \mathbf{E}_{\text{global}}
       </annotation>
      </semantics>
     </math>
     , guided by the instruction prompt. This is achieved through a key-value indexing scheme, where
     <math alttext="(\text{role},\text{index})" class="ltx_Math" display="inline" id="S3.SS2.p3.4.m4.2">
      <semantics id="S3.SS2.p3.4.m4.2a">
       <mrow id="S3.SS2.p3.4.m4.2.3.2" xref="S3.SS2.p3.4.m4.2.3.1.cmml">
        <mo id="S3.SS2.p3.4.m4.2.3.2.1" stretchy="false" xref="S3.SS2.p3.4.m4.2.3.1.cmml">
         (
        </mo>
        <mtext id="S3.SS2.p3.4.m4.1.1" xref="S3.SS2.p3.4.m4.1.1a.cmml">
         role
        </mtext>
        <mo id="S3.SS2.p3.4.m4.2.3.2.2" xref="S3.SS2.p3.4.m4.2.3.1.cmml">
         ,
        </mo>
        <mtext id="S3.SS2.p3.4.m4.2.2" xref="S3.SS2.p3.4.m4.2.2a.cmml">
         index
        </mtext>
        <mo id="S3.SS2.p3.4.m4.2.3.2.3" stretchy="false" xref="S3.SS2.p3.4.m4.2.3.1.cmml">
         )
        </mo>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.4.m4.2b">
        <interval closure="open" id="S3.SS2.p3.4.m4.2.3.1.cmml" xref="S3.SS2.p3.4.m4.2.3.2">
         <ci id="S3.SS2.p3.4.m4.1.1a.cmml" xref="S3.SS2.p3.4.m4.1.1">
          <mtext id="S3.SS2.p3.4.m4.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1">
           role
          </mtext>
         </ci>
         <ci id="S3.SS2.p3.4.m4.2.2a.cmml" xref="S3.SS2.p3.4.m4.2.2">
          <mtext id="S3.SS2.p3.4.m4.2.2.cmml" xref="S3.SS2.p3.4.m4.2.2">
           index
          </mtext>
         </ci>
        </interval>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.4.m4.2c">
        (\text{role},\text{index})
       </annotation>
      </semantics>
     </math>
     facilitates access to
     <math alttext="e_{k}" class="ltx_Math" display="inline" id="S3.SS2.p3.5.m5.1">
      <semantics id="S3.SS2.p3.5.m5.1a">
       <msub id="S3.SS2.p3.5.m5.1.1" xref="S3.SS2.p3.5.m5.1.1.cmml">
        <mi id="S3.SS2.p3.5.m5.1.1.2" xref="S3.SS2.p3.5.m5.1.1.2.cmml">
         e
        </mi>
        <mi id="S3.SS2.p3.5.m5.1.1.3" xref="S3.SS2.p3.5.m5.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.5.m5.1b">
        <apply id="S3.SS2.p3.5.m5.1.1.cmml" xref="S3.SS2.p3.5.m5.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p3.5.m5.1.1.1.cmml" xref="S3.SS2.p3.5.m5.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p3.5.m5.1.1.2.cmml" xref="S3.SS2.p3.5.m5.1.1.2">
          𝑒
         </ci>
         <ci id="S3.SS2.p3.5.m5.1.1.3.cmml" xref="S3.SS2.p3.5.m5.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.5.m5.1c">
        e_{k}
       </annotation>
      </semantics>
     </math>
     .
The activation of specific LoRA blocks is then directed by
     <math alttext="\operatorname{argmax}_{k}(w_{k})" class="ltx_Math" display="inline" id="S3.SS2.p3.6.m6.2">
      <semantics id="S3.SS2.p3.6.m6.2a">
       <mrow id="S3.SS2.p3.6.m6.2.2.2" xref="S3.SS2.p3.6.m6.2.2.3.cmml">
        <msub id="S3.SS2.p3.6.m6.1.1.1.1" xref="S3.SS2.p3.6.m6.1.1.1.1.cmml">
         <mi id="S3.SS2.p3.6.m6.1.1.1.1.2" xref="S3.SS2.p3.6.m6.1.1.1.1.2.cmml">
          argmax
         </mi>
         <mi id="S3.SS2.p3.6.m6.1.1.1.1.3" xref="S3.SS2.p3.6.m6.1.1.1.1.3.cmml">
          k
         </mi>
        </msub>
        <mo id="S3.SS2.p3.6.m6.2.2.2a" xref="S3.SS2.p3.6.m6.2.2.3.cmml">
         ⁡
        </mo>
        <mrow id="S3.SS2.p3.6.m6.2.2.2.2" xref="S3.SS2.p3.6.m6.2.2.3.cmml">
         <mo id="S3.SS2.p3.6.m6.2.2.2.2.2" stretchy="false" xref="S3.SS2.p3.6.m6.2.2.3.cmml">
          (
         </mo>
         <msub id="S3.SS2.p3.6.m6.2.2.2.2.1" xref="S3.SS2.p3.6.m6.2.2.2.2.1.cmml">
          <mi id="S3.SS2.p3.6.m6.2.2.2.2.1.2" xref="S3.SS2.p3.6.m6.2.2.2.2.1.2.cmml">
           w
          </mi>
          <mi id="S3.SS2.p3.6.m6.2.2.2.2.1.3" xref="S3.SS2.p3.6.m6.2.2.2.2.1.3.cmml">
           k
          </mi>
         </msub>
         <mo id="S3.SS2.p3.6.m6.2.2.2.2.3" stretchy="false" xref="S3.SS2.p3.6.m6.2.2.3.cmml">
          )
         </mo>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.6.m6.2b">
        <apply id="S3.SS2.p3.6.m6.2.2.3.cmml" xref="S3.SS2.p3.6.m6.2.2.2">
         <apply id="S3.SS2.p3.6.m6.1.1.1.1.cmml" xref="S3.SS2.p3.6.m6.1.1.1.1">
          <csymbol cd="ambiguous" id="S3.SS2.p3.6.m6.1.1.1.1.1.cmml" xref="S3.SS2.p3.6.m6.1.1.1.1">
           subscript
          </csymbol>
          <ci id="S3.SS2.p3.6.m6.1.1.1.1.2.cmml" xref="S3.SS2.p3.6.m6.1.1.1.1.2">
           argmax
          </ci>
          <ci id="S3.SS2.p3.6.m6.1.1.1.1.3.cmml" xref="S3.SS2.p3.6.m6.1.1.1.1.3">
           𝑘
          </ci>
         </apply>
         <apply id="S3.SS2.p3.6.m6.2.2.2.2.1.cmml" xref="S3.SS2.p3.6.m6.2.2.2.2.1">
          <csymbol cd="ambiguous" id="S3.SS2.p3.6.m6.2.2.2.2.1.1.cmml" xref="S3.SS2.p3.6.m6.2.2.2.2.1">
           subscript
          </csymbol>
          <ci id="S3.SS2.p3.6.m6.2.2.2.2.1.2.cmml" xref="S3.SS2.p3.6.m6.2.2.2.2.1.2">
           𝑤
          </ci>
          <ci id="S3.SS2.p3.6.m6.2.2.2.2.1.3.cmml" xref="S3.SS2.p3.6.m6.2.2.2.2.1.3">
           𝑘
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.6.m6.2c">
        \operatorname{argmax}_{k}(w_{k})
       </annotation>
      </semantics>
     </math>
     , pinpointing the most significant contribution weight among the learned weights for role
     <math alttext="r_{k}" class="ltx_Math" display="inline" id="S3.SS2.p3.7.m7.1">
      <semantics id="S3.SS2.p3.7.m7.1a">
       <msub id="S3.SS2.p3.7.m7.1.1" xref="S3.SS2.p3.7.m7.1.1.cmml">
        <mi id="S3.SS2.p3.7.m7.1.1.2" xref="S3.SS2.p3.7.m7.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS2.p3.7.m7.1.1.3" xref="S3.SS2.p3.7.m7.1.1.3.cmml">
         k
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS2.p3.7.m7.1b">
        <apply id="S3.SS2.p3.7.m7.1.1.cmml" xref="S3.SS2.p3.7.m7.1.1">
         <csymbol cd="ambiguous" id="S3.SS2.p3.7.m7.1.1.1.cmml" xref="S3.SS2.p3.7.m7.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS2.p3.7.m7.1.1.2.cmml" xref="S3.SS2.p3.7.m7.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS2.p3.7.m7.1.1.3.cmml" xref="S3.SS2.p3.7.m7.1.1.3">
          𝑘
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS2.p3.7.m7.1c">
        r_{k}
       </annotation>
      </semantics>
     </math>
     . This ensures a controlled, role-specific activation of LoRA blocks, aligned with the contribution weights determined during the training phase.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S3.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     3.3
    </span>
    Lifelong Role-Playing with LoRA Expansion
   </h3>
   <div class="ltx_para" id="S3.SS3.p1">
    <p class="ltx_p" id="S3.SS3.p1.4">
     In the incremental phase, we have designed two modes: fusion and expansion.
In the fusion mode, we employ an element-wise method to combine LoRA modules
     <cite class="ltx_cite ltx_citemacro_citep">
      (Huang et al.,
      <a class="ltx_ref" href="#bib.bib9" title="">
       2023
      </a>
      ; Liu et al.,
      <a class="ltx_ref" href="#bib.bib12" title="">
       2023
      </a>
      )
     </cite>
     . This integration process combines the corresponding parameters of the LoRA modules. It’s essential that the modules being combined have the same partial rank
     <math alttext="p" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1">
      <semantics id="S3.SS3.p1.1.m1.1a">
       <mi id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml">
        p
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b">
        <ci id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">
         𝑝
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">
        p
       </annotation>
      </semantics>
     </math>
     for proper alignment. Given
     <math alttext="\Delta W_{k}=B_{k}A_{k}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1">
      <semantics id="S3.SS3.p1.2.m2.1a">
       <mrow id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml">
        <mrow id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml">
         <mi id="S3.SS3.p1.2.m2.1.1.2.2" mathvariant="normal" xref="S3.SS3.p1.2.m2.1.1.2.2.cmml">
          Δ
         </mi>
         <mo id="S3.SS3.p1.2.m2.1.1.2.1" lspace="0em" rspace="0em" xref="S3.SS3.p1.2.m2.1.1.2.1.cmml">
          ​
         </mo>
         <msub id="S3.SS3.p1.2.m2.1.1.2.3" xref="S3.SS3.p1.2.m2.1.1.2.3.cmml">
          <mi id="S3.SS3.p1.2.m2.1.1.2.3.2" xref="S3.SS3.p1.2.m2.1.1.2.3.2.cmml">
           W
          </mi>
          <mi id="S3.SS3.p1.2.m2.1.1.2.3.3" xref="S3.SS3.p1.2.m2.1.1.2.3.3.cmml">
           k
          </mi>
         </msub>
        </mrow>
        <mo id="S3.SS3.p1.2.m2.1.1.1" xref="S3.SS3.p1.2.m2.1.1.1.cmml">
         =
        </mo>
        <mrow id="S3.SS3.p1.2.m2.1.1.3" xref="S3.SS3.p1.2.m2.1.1.3.cmml">
         <msub id="S3.SS3.p1.2.m2.1.1.3.2" xref="S3.SS3.p1.2.m2.1.1.3.2.cmml">
          <mi id="S3.SS3.p1.2.m2.1.1.3.2.2" xref="S3.SS3.p1.2.m2.1.1.3.2.2.cmml">
           B
          </mi>
          <mi id="S3.SS3.p1.2.m2.1.1.3.2.3" xref="S3.SS3.p1.2.m2.1.1.3.2.3.cmml">
           k
          </mi>
         </msub>
         <mo id="S3.SS3.p1.2.m2.1.1.3.1" lspace="0em" rspace="0em" xref="S3.SS3.p1.2.m2.1.1.3.1.cmml">
          ​
         </mo>
         <msub id="S3.SS3.p1.2.m2.1.1.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.cmml">
          <mi id="S3.SS3.p1.2.m2.1.1.3.3.2" xref="S3.SS3.p1.2.m2.1.1.3.3.2.cmml">
           A
          </mi>
          <mi id="S3.SS3.p1.2.m2.1.1.3.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.3.cmml">
           k
          </mi>
         </msub>
        </mrow>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b">
        <apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1">
         <eq id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1.1">
         </eq>
         <apply id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2">
          <times id="S3.SS3.p1.2.m2.1.1.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2.1">
          </times>
          <ci id="S3.SS3.p1.2.m2.1.1.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2.2">
           Δ
          </ci>
          <apply id="S3.SS3.p1.2.m2.1.1.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3">
           <csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.2.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3">
            subscript
           </csymbol>
           <ci id="S3.SS3.p1.2.m2.1.1.2.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3.2">
            𝑊
           </ci>
           <ci id="S3.SS3.p1.2.m2.1.1.2.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3.3">
            𝑘
           </ci>
          </apply>
         </apply>
         <apply id="S3.SS3.p1.2.m2.1.1.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3">
          <times id="S3.SS3.p1.2.m2.1.1.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3.1">
          </times>
          <apply id="S3.SS3.p1.2.m2.1.1.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2">
           <csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.3.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2">
            subscript
           </csymbol>
           <ci id="S3.SS3.p1.2.m2.1.1.3.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2.2">
            𝐵
           </ci>
           <ci id="S3.SS3.p1.2.m2.1.1.3.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2.3">
            𝑘
           </ci>
          </apply>
          <apply id="S3.SS3.p1.2.m2.1.1.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3">
           <csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.3.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3">
            subscript
           </csymbol>
           <ci id="S3.SS3.p1.2.m2.1.1.3.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.2">
            𝐴
           </ci>
           <ci id="S3.SS3.p1.2.m2.1.1.3.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3.3">
            𝑘
           </ci>
          </apply>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">
        \Delta W_{k}=B_{k}A_{k}
       </annotation>
      </semantics>
     </math>
     , the combined LoRA module
     <math alttext="\Delta W_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1">
      <semantics id="S3.SS3.p1.3.m3.1a">
       <mrow id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml">
        <mi id="S3.SS3.p1.3.m3.1.1.2" mathvariant="normal" xref="S3.SS3.p1.3.m3.1.1.2.cmml">
         Δ
        </mi>
        <mo id="S3.SS3.p1.3.m3.1.1.1" lspace="0em" rspace="0em" xref="S3.SS3.p1.3.m3.1.1.1.cmml">
         ​
        </mo>
        <msub id="S3.SS3.p1.3.m3.1.1.3" xref="S3.SS3.p1.3.m3.1.1.3.cmml">
         <mi id="S3.SS3.p1.3.m3.1.1.3.2" xref="S3.SS3.p1.3.m3.1.1.3.2.cmml">
          W
         </mi>
         <mi id="S3.SS3.p1.3.m3.1.1.3.3" xref="S3.SS3.p1.3.m3.1.1.3.3.cmml">
          j
         </mi>
        </msub>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b">
        <apply id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">
         <times id="S3.SS3.p1.3.m3.1.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1.1">
         </times>
         <ci id="S3.SS3.p1.3.m3.1.1.2.cmml" xref="S3.SS3.p1.3.m3.1.1.2">
          Δ
         </ci>
         <apply id="S3.SS3.p1.3.m3.1.1.3.cmml" xref="S3.SS3.p1.3.m3.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS3.p1.3.m3.1.1.3.1.cmml" xref="S3.SS3.p1.3.m3.1.1.3">
           subscript
          </csymbol>
          <ci id="S3.SS3.p1.3.m3.1.1.3.2.cmml" xref="S3.SS3.p1.3.m3.1.1.3.2">
           𝑊
          </ci>
          <ci id="S3.SS3.p1.3.m3.1.1.3.3.cmml" xref="S3.SS3.p1.3.m3.1.1.3.3">
           𝑗
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">
        \Delta W_{j}
       </annotation>
      </semantics>
     </math>
     and the updated
     <math alttext="W_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m4.1">
      <semantics id="S3.SS3.p1.4.m4.1a">
       <msub id="S3.SS3.p1.4.m4.1.1" xref="S3.SS3.p1.4.m4.1.1.cmml">
        <mi id="S3.SS3.p1.4.m4.1.1.2" xref="S3.SS3.p1.4.m4.1.1.2.cmml">
         W
        </mi>
        <mi id="S3.SS3.p1.4.m4.1.1.3" xref="S3.SS3.p1.4.m4.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m4.1b">
        <apply id="S3.SS3.p1.4.m4.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.4.m4.1.1.2.cmml" xref="S3.SS3.p1.4.m4.1.1.2">
          𝑊
         </ci>
         <ci id="S3.SS3.p1.4.m4.1.1.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.4.m4.1c">
        W_{j}
       </annotation>
      </semantics>
     </math>
     are derived as follows:
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S3.E7">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="\begin{split}W_{j}=W_{0}+\Delta W_{j}&amp;=W_{0}+\sum_{k=1}^{M}w_{jk}\cdot\Delta W_{k}\\
&amp;=W_{0}+\sum_{k=1}^{M}w_{jk}\cdot B_{k}A_{k},\end{split}" class="ltx_Math" display="block" id="S3.E7.m1.39">
         <semantics id="S3.E7.m1.39a">
          <mtable columnspacing="0pt" displaystyle="true" id="S3.E7.m1.39.39.2" rowspacing="0pt">
           <mtr id="S3.E7.m1.39.39.2a">
            <mtd class="ltx_align_right" columnalign="right" id="S3.E7.m1.39.39.2b">
             <mrow id="S3.E7.m1.9.9.9.9.9">
              <msub id="S3.E7.m1.9.9.9.9.9.10">
               <mi id="S3.E7.m1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.cmml">
                W
               </mi>
               <mi id="S3.E7.m1.2.2.2.2.2.2.1" xref="S3.E7.m1.2.2.2.2.2.2.1.cmml">
                j
               </mi>
              </msub>
              <mo id="S3.E7.m1.3.3.3.3.3.3" xref="S3.E7.m1.3.3.3.3.3.3.cmml">
               =
              </mo>
              <mrow id="S3.E7.m1.9.9.9.9.9.11">
               <msub id="S3.E7.m1.9.9.9.9.9.11.1">
                <mi id="S3.E7.m1.4.4.4.4.4.4" xref="S3.E7.m1.4.4.4.4.4.4.cmml">
                 W
                </mi>
                <mn id="S3.E7.m1.5.5.5.5.5.5.1" xref="S3.E7.m1.5.5.5.5.5.5.1.cmml">
                 0
                </mn>
               </msub>
               <mo id="S3.E7.m1.6.6.6.6.6.6" xref="S3.E7.m1.6.6.6.6.6.6.cmml">
                +
               </mo>
               <mrow id="S3.E7.m1.9.9.9.9.9.11.2">
                <mi id="S3.E7.m1.7.7.7.7.7.7" mathvariant="normal" xref="S3.E7.m1.7.7.7.7.7.7.cmml">
                 Δ
                </mi>
                <mo id="S3.E7.m1.9.9.9.9.9.11.2.1" lspace="0em" rspace="0em" xref="S3.E7.m1.38.38.1.1.1.cmml">
                 ​
                </mo>
                <msub id="S3.E7.m1.9.9.9.9.9.11.2.2">
                 <mi id="S3.E7.m1.8.8.8.8.8.8" xref="S3.E7.m1.8.8.8.8.8.8.cmml">
                  W
                 </mi>
                 <mi id="S3.E7.m1.9.9.9.9.9.9.1" xref="S3.E7.m1.9.9.9.9.9.9.1.cmml">
                  j
                 </mi>
                </msub>
               </mrow>
              </mrow>
             </mrow>
            </mtd>
            <mtd class="ltx_align_left" columnalign="left" id="S3.E7.m1.39.39.2c">
             <mrow id="S3.E7.m1.22.22.22.22.13">
              <mi id="S3.E7.m1.22.22.22.22.13.14" xref="S3.E7.m1.38.38.1.1.1.cmml">
              </mi>
              <mo id="S3.E7.m1.10.10.10.10.1.1" xref="S3.E7.m1.10.10.10.10.1.1.cmml">
               =
              </mo>
              <mrow id="S3.E7.m1.22.22.22.22.13.15">
               <msub id="S3.E7.m1.22.22.22.22.13.15.1">
                <mi id="S3.E7.m1.11.11.11.11.2.2" xref="S3.E7.m1.11.11.11.11.2.2.cmml">
                 W
                </mi>
                <mn id="S3.E7.m1.12.12.12.12.3.3.1" xref="S3.E7.m1.12.12.12.12.3.3.1.cmml">
                 0
                </mn>
               </msub>
               <mo id="S3.E7.m1.13.13.13.13.4.4" rspace="0.055em" xref="S3.E7.m1.13.13.13.13.4.4.cmml">
                +
               </mo>
               <mrow id="S3.E7.m1.22.22.22.22.13.15.2">
                <munderover id="S3.E7.m1.22.22.22.22.13.15.2.1">
                 <mo id="S3.E7.m1.14.14.14.14.5.5" movablelimits="false" xref="S3.E7.m1.14.14.14.14.5.5.cmml">
                  ∑
                 </mo>
                 <mrow id="S3.E7.m1.15.15.15.15.6.6.1" xref="S3.E7.m1.15.15.15.15.6.6.1.cmml">
                  <mi id="S3.E7.m1.15.15.15.15.6.6.1.2" xref="S3.E7.m1.15.15.15.15.6.6.1.2.cmml">
                   k
                  </mi>
                  <mo id="S3.E7.m1.15.15.15.15.6.6.1.1" xref="S3.E7.m1.15.15.15.15.6.6.1.1.cmml">
                   =
                  </mo>
                  <mn id="S3.E7.m1.15.15.15.15.6.6.1.3" xref="S3.E7.m1.15.15.15.15.6.6.1.3.cmml">
                   1
                  </mn>
                 </mrow>
                 <mi id="S3.E7.m1.16.16.16.16.7.7.1" xref="S3.E7.m1.16.16.16.16.7.7.1.cmml">
                  M
                 </mi>
                </munderover>
                <mrow id="S3.E7.m1.22.22.22.22.13.15.2.2">
                 <mrow id="S3.E7.m1.22.22.22.22.13.15.2.2.2">
                  <msub id="S3.E7.m1.22.22.22.22.13.15.2.2.2.1">
                   <mi id="S3.E7.m1.17.17.17.17.8.8" xref="S3.E7.m1.17.17.17.17.8.8.cmml">
                    w
                   </mi>
                   <mrow id="S3.E7.m1.18.18.18.18.9.9.1" xref="S3.E7.m1.18.18.18.18.9.9.1.cmml">
                    <mi id="S3.E7.m1.18.18.18.18.9.9.1.2" xref="S3.E7.m1.18.18.18.18.9.9.1.2.cmml">
                     j
                    </mi>
                    <mo id="S3.E7.m1.18.18.18.18.9.9.1.1" lspace="0em" rspace="0em" xref="S3.E7.m1.18.18.18.18.9.9.1.1.cmml">
                     ​
                    </mo>
                    <mi id="S3.E7.m1.18.18.18.18.9.9.1.3" xref="S3.E7.m1.18.18.18.18.9.9.1.3.cmml">
                     k
                    </mi>
                   </mrow>
                  </msub>
                  <mo id="S3.E7.m1.19.19.19.19.10.10" lspace="0.222em" rspace="0.222em" xref="S3.E7.m1.19.19.19.19.10.10.cmml">
                   ⋅
                  </mo>
                  <mi id="S3.E7.m1.20.20.20.20.11.11" mathvariant="normal" xref="S3.E7.m1.20.20.20.20.11.11.cmml">
                   Δ
                  </mi>
                 </mrow>
                 <mo id="S3.E7.m1.22.22.22.22.13.15.2.2.1" lspace="0em" rspace="0em" xref="S3.E7.m1.38.38.1.1.1.cmml">
                  ​
                 </mo>
                 <msub id="S3.E7.m1.22.22.22.22.13.15.2.2.3">
                  <mi id="S3.E7.m1.21.21.21.21.12.12" xref="S3.E7.m1.21.21.21.21.12.12.cmml">
                   W
                  </mi>
                  <mi id="S3.E7.m1.22.22.22.22.13.13.1" xref="S3.E7.m1.22.22.22.22.13.13.1.cmml">
                   k
                  </mi>
                 </msub>
                </mrow>
               </mrow>
              </mrow>
             </mrow>
            </mtd>
           </mtr>
           <mtr id="S3.E7.m1.39.39.2d">
            <mtd id="S3.E7.m1.39.39.2e" xref="S3.E7.m1.38.38.1.1.1.cmml">
            </mtd>
            <mtd class="ltx_align_left" columnalign="left" id="S3.E7.m1.39.39.2f">
             <mrow id="S3.E7.m1.39.39.2.38.16.16.16">
              <mrow id="S3.E7.m1.39.39.2.38.16.16.16.1">
               <mi id="S3.E7.m1.39.39.2.38.16.16.16.1.1" xref="S3.E7.m1.38.38.1.1.1.cmml">
               </mi>
               <mo id="S3.E7.m1.23.23.23.1.1.1" xref="S3.E7.m1.23.23.23.1.1.1.cmml">
                =
               </mo>
               <mrow id="S3.E7.m1.39.39.2.38.16.16.16.1.2">
                <msub id="S3.E7.m1.39.39.2.38.16.16.16.1.2.1">
                 <mi id="S3.E7.m1.24.24.24.2.2.2" xref="S3.E7.m1.24.24.24.2.2.2.cmml">
                  W
                 </mi>
                 <mn id="S3.E7.m1.25.25.25.3.3.3.1" xref="S3.E7.m1.25.25.25.3.3.3.1.cmml">
                  0
                 </mn>
                </msub>
                <mo id="S3.E7.m1.26.26.26.4.4.4" rspace="0.055em" xref="S3.E7.m1.26.26.26.4.4.4.cmml">
                 +
                </mo>
                <mrow id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2">
                 <munderover id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.1">
                  <mo id="S3.E7.m1.27.27.27.5.5.5" movablelimits="false" xref="S3.E7.m1.27.27.27.5.5.5.cmml">
                   ∑
                  </mo>
                  <mrow id="S3.E7.m1.28.28.28.6.6.6.1" xref="S3.E7.m1.28.28.28.6.6.6.1.cmml">
                   <mi id="S3.E7.m1.28.28.28.6.6.6.1.2" xref="S3.E7.m1.28.28.28.6.6.6.1.2.cmml">
                    k
                   </mi>
                   <mo id="S3.E7.m1.28.28.28.6.6.6.1.1" xref="S3.E7.m1.28.28.28.6.6.6.1.1.cmml">
                    =
                   </mo>
                   <mn id="S3.E7.m1.28.28.28.6.6.6.1.3" xref="S3.E7.m1.28.28.28.6.6.6.1.3.cmml">
                    1
                   </mn>
                  </mrow>
                  <mi id="S3.E7.m1.29.29.29.7.7.7.1" xref="S3.E7.m1.29.29.29.7.7.7.1.cmml">
                   M
                  </mi>
                 </munderover>
                 <mrow id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2">
                  <mrow id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2.2">
                   <msub id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2.2.1">
                    <mi id="S3.E7.m1.30.30.30.8.8.8" xref="S3.E7.m1.30.30.30.8.8.8.cmml">
                     w
                    </mi>
                    <mrow id="S3.E7.m1.31.31.31.9.9.9.1" xref="S3.E7.m1.31.31.31.9.9.9.1.cmml">
                     <mi id="S3.E7.m1.31.31.31.9.9.9.1.2" xref="S3.E7.m1.31.31.31.9.9.9.1.2.cmml">
                      j
                     </mi>
                     <mo id="S3.E7.m1.31.31.31.9.9.9.1.1" lspace="0em" rspace="0em" xref="S3.E7.m1.31.31.31.9.9.9.1.1.cmml">
                      ​
                     </mo>
                     <mi id="S3.E7.m1.31.31.31.9.9.9.1.3" xref="S3.E7.m1.31.31.31.9.9.9.1.3.cmml">
                      k
                     </mi>
                    </mrow>
                   </msub>
                   <mo id="S3.E7.m1.32.32.32.10.10.10" lspace="0.222em" rspace="0.222em" xref="S3.E7.m1.32.32.32.10.10.10.cmml">
                    ⋅
                   </mo>
                   <msub id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2.2.2">
                    <mi id="S3.E7.m1.33.33.33.11.11.11" xref="S3.E7.m1.33.33.33.11.11.11.cmml">
                     B
                    </mi>
                    <mi id="S3.E7.m1.34.34.34.12.12.12.1" xref="S3.E7.m1.34.34.34.12.12.12.1.cmml">
                     k
                    </mi>
                   </msub>
                  </mrow>
                  <mo id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2.1" lspace="0em" rspace="0em" xref="S3.E7.m1.38.38.1.1.1.cmml">
                   ​
                  </mo>
                  <msub id="S3.E7.m1.39.39.2.38.16.16.16.1.2.2.2.3">
                   <mi id="S3.E7.m1.35.35.35.13.13.13" xref="S3.E7.m1.35.35.35.13.13.13.cmml">
                    A
                   </mi>
                   <mi id="S3.E7.m1.36.36.36.14.14.14.1" xref="S3.E7.m1.36.36.36.14.14.14.1.cmml">
                    k
                   </mi>
                  </msub>
                 </mrow>
                </mrow>
               </mrow>
              </mrow>
              <mo id="S3.E7.m1.37.37.37.15.15.15" xref="S3.E7.m1.38.38.1.1.1.cmml">
               ,
              </mo>
             </mrow>
            </mtd>
           </mtr>
          </mtable>
          <annotation-xml encoding="MathML-Content" id="S3.E7.m1.39b">
           <apply id="S3.E7.m1.38.38.1.1.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
            <and id="S3.E7.m1.38.38.1.1.1a.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
            </and>
            <apply id="S3.E7.m1.38.38.1.1.1b.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
             <eq id="S3.E7.m1.3.3.3.3.3.3.cmml" xref="S3.E7.m1.3.3.3.3.3.3">
             </eq>
             <apply id="S3.E7.m1.38.38.1.1.1.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
              <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               subscript
              </csymbol>
              <ci id="S3.E7.m1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1">
               𝑊
              </ci>
              <ci id="S3.E7.m1.2.2.2.2.2.2.1.cmml" xref="S3.E7.m1.2.2.2.2.2.2.1">
               𝑗
              </ci>
             </apply>
             <apply id="S3.E7.m1.38.38.1.1.1.4.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
              <plus id="S3.E7.m1.6.6.6.6.6.6.cmml" xref="S3.E7.m1.6.6.6.6.6.6">
              </plus>
              <apply id="S3.E7.m1.38.38.1.1.1.4.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.4.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                subscript
               </csymbol>
               <ci id="S3.E7.m1.4.4.4.4.4.4.cmml" xref="S3.E7.m1.4.4.4.4.4.4">
                𝑊
               </ci>
               <cn id="S3.E7.m1.5.5.5.5.5.5.1.cmml" type="integer" xref="S3.E7.m1.5.5.5.5.5.5.1">
                0
               </cn>
              </apply>
              <apply id="S3.E7.m1.38.38.1.1.1.4.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <times id="S3.E7.m1.38.38.1.1.1.4.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               </times>
               <ci id="S3.E7.m1.7.7.7.7.7.7.cmml" xref="S3.E7.m1.7.7.7.7.7.7">
                Δ
               </ci>
               <apply id="S3.E7.m1.38.38.1.1.1.4.3.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.4.3.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 subscript
                </csymbol>
                <ci id="S3.E7.m1.8.8.8.8.8.8.cmml" xref="S3.E7.m1.8.8.8.8.8.8">
                 𝑊
                </ci>
                <ci id="S3.E7.m1.9.9.9.9.9.9.1.cmml" xref="S3.E7.m1.9.9.9.9.9.9.1">
                 𝑗
                </ci>
               </apply>
              </apply>
             </apply>
            </apply>
            <apply id="S3.E7.m1.38.38.1.1.1c.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
             <eq id="S3.E7.m1.10.10.10.10.1.1.cmml" xref="S3.E7.m1.10.10.10.10.1.1">
             </eq>
             <share href="#S3.E7.m1.38.38.1.1.1.4.cmml" id="S3.E7.m1.38.38.1.1.1d.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
             </share>
             <apply id="S3.E7.m1.38.38.1.1.1.6.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
              <plus id="S3.E7.m1.13.13.13.13.4.4.cmml" xref="S3.E7.m1.13.13.13.13.4.4">
              </plus>
              <apply id="S3.E7.m1.38.38.1.1.1.6.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.6.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                subscript
               </csymbol>
               <ci id="S3.E7.m1.11.11.11.11.2.2.cmml" xref="S3.E7.m1.11.11.11.11.2.2">
                𝑊
               </ci>
               <cn id="S3.E7.m1.12.12.12.12.3.3.1.cmml" type="integer" xref="S3.E7.m1.12.12.12.12.3.3.1">
                0
               </cn>
              </apply>
              <apply id="S3.E7.m1.38.38.1.1.1.6.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <apply id="S3.E7.m1.38.38.1.1.1.6.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.6.3.1.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 superscript
                </csymbol>
                <apply id="S3.E7.m1.38.38.1.1.1.6.3.1.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.6.3.1.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  subscript
                 </csymbol>
                 <sum id="S3.E7.m1.14.14.14.14.5.5.cmml" xref="S3.E7.m1.14.14.14.14.5.5">
                 </sum>
                 <apply id="S3.E7.m1.15.15.15.15.6.6.1.cmml" xref="S3.E7.m1.15.15.15.15.6.6.1">
                  <eq id="S3.E7.m1.15.15.15.15.6.6.1.1.cmml" xref="S3.E7.m1.15.15.15.15.6.6.1.1">
                  </eq>
                  <ci id="S3.E7.m1.15.15.15.15.6.6.1.2.cmml" xref="S3.E7.m1.15.15.15.15.6.6.1.2">
                   𝑘
                  </ci>
                  <cn id="S3.E7.m1.15.15.15.15.6.6.1.3.cmml" type="integer" xref="S3.E7.m1.15.15.15.15.6.6.1.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <ci id="S3.E7.m1.16.16.16.16.7.7.1.cmml" xref="S3.E7.m1.16.16.16.16.7.7.1">
                 𝑀
                </ci>
               </apply>
               <apply id="S3.E7.m1.38.38.1.1.1.6.3.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                <times id="S3.E7.m1.38.38.1.1.1.6.3.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                </times>
                <apply id="S3.E7.m1.38.38.1.1.1.6.3.2.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <ci id="S3.E7.m1.19.19.19.19.10.10.cmml" xref="S3.E7.m1.19.19.19.19.10.10">
                  ⋅
                 </ci>
                 <apply id="S3.E7.m1.38.38.1.1.1.6.3.2.2.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.6.3.2.2.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                   subscript
                  </csymbol>
                  <ci id="S3.E7.m1.17.17.17.17.8.8.cmml" xref="S3.E7.m1.17.17.17.17.8.8">
                   𝑤
                  </ci>
                  <apply id="S3.E7.m1.18.18.18.18.9.9.1.cmml" xref="S3.E7.m1.18.18.18.18.9.9.1">
                   <times id="S3.E7.m1.18.18.18.18.9.9.1.1.cmml" xref="S3.E7.m1.18.18.18.18.9.9.1.1">
                   </times>
                   <ci id="S3.E7.m1.18.18.18.18.9.9.1.2.cmml" xref="S3.E7.m1.18.18.18.18.9.9.1.2">
                    𝑗
                   </ci>
                   <ci id="S3.E7.m1.18.18.18.18.9.9.1.3.cmml" xref="S3.E7.m1.18.18.18.18.9.9.1.3">
                    𝑘
                   </ci>
                  </apply>
                 </apply>
                 <ci id="S3.E7.m1.20.20.20.20.11.11.cmml" xref="S3.E7.m1.20.20.20.20.11.11">
                  Δ
                 </ci>
                </apply>
                <apply id="S3.E7.m1.38.38.1.1.1.6.3.2.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.6.3.2.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  subscript
                 </csymbol>
                 <ci id="S3.E7.m1.21.21.21.21.12.12.cmml" xref="S3.E7.m1.21.21.21.21.12.12">
                  𝑊
                 </ci>
                 <ci id="S3.E7.m1.22.22.22.22.13.13.1.cmml" xref="S3.E7.m1.22.22.22.22.13.13.1">
                  𝑘
                 </ci>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
            <apply id="S3.E7.m1.38.38.1.1.1e.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
             <eq id="S3.E7.m1.23.23.23.1.1.1.cmml" xref="S3.E7.m1.23.23.23.1.1.1">
             </eq>
             <share href="#S3.E7.m1.38.38.1.1.1.6.cmml" id="S3.E7.m1.38.38.1.1.1f.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
             </share>
             <apply id="S3.E7.m1.38.38.1.1.1.8.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
              <plus id="S3.E7.m1.26.26.26.4.4.4.cmml" xref="S3.E7.m1.26.26.26.4.4.4">
              </plus>
              <apply id="S3.E7.m1.38.38.1.1.1.8.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                subscript
               </csymbol>
               <ci id="S3.E7.m1.24.24.24.2.2.2.cmml" xref="S3.E7.m1.24.24.24.2.2.2">
                𝑊
               </ci>
               <cn id="S3.E7.m1.25.25.25.3.3.3.1.cmml" type="integer" xref="S3.E7.m1.25.25.25.3.3.3.1">
                0
               </cn>
              </apply>
              <apply id="S3.E7.m1.38.38.1.1.1.8.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
               <apply id="S3.E7.m1.38.38.1.1.1.8.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.3.1.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 superscript
                </csymbol>
                <apply id="S3.E7.m1.38.38.1.1.1.8.3.1.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.3.1.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  subscript
                 </csymbol>
                 <sum id="S3.E7.m1.27.27.27.5.5.5.cmml" xref="S3.E7.m1.27.27.27.5.5.5">
                 </sum>
                 <apply id="S3.E7.m1.28.28.28.6.6.6.1.cmml" xref="S3.E7.m1.28.28.28.6.6.6.1">
                  <eq id="S3.E7.m1.28.28.28.6.6.6.1.1.cmml" xref="S3.E7.m1.28.28.28.6.6.6.1.1">
                  </eq>
                  <ci id="S3.E7.m1.28.28.28.6.6.6.1.2.cmml" xref="S3.E7.m1.28.28.28.6.6.6.1.2">
                   𝑘
                  </ci>
                  <cn id="S3.E7.m1.28.28.28.6.6.6.1.3.cmml" type="integer" xref="S3.E7.m1.28.28.28.6.6.6.1.3">
                   1
                  </cn>
                 </apply>
                </apply>
                <ci id="S3.E7.m1.29.29.29.7.7.7.1.cmml" xref="S3.E7.m1.29.29.29.7.7.7.1">
                 𝑀
                </ci>
               </apply>
               <apply id="S3.E7.m1.38.38.1.1.1.8.3.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                <times id="S3.E7.m1.38.38.1.1.1.8.3.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                </times>
                <apply id="S3.E7.m1.38.38.1.1.1.8.3.2.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <ci id="S3.E7.m1.32.32.32.10.10.10.cmml" xref="S3.E7.m1.32.32.32.10.10.10">
                  ⋅
                 </ci>
                 <apply id="S3.E7.m1.38.38.1.1.1.8.3.2.2.2.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.3.2.2.2.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                   subscript
                  </csymbol>
                  <ci id="S3.E7.m1.30.30.30.8.8.8.cmml" xref="S3.E7.m1.30.30.30.8.8.8">
                   𝑤
                  </ci>
                  <apply id="S3.E7.m1.31.31.31.9.9.9.1.cmml" xref="S3.E7.m1.31.31.31.9.9.9.1">
                   <times id="S3.E7.m1.31.31.31.9.9.9.1.1.cmml" xref="S3.E7.m1.31.31.31.9.9.9.1.1">
                   </times>
                   <ci id="S3.E7.m1.31.31.31.9.9.9.1.2.cmml" xref="S3.E7.m1.31.31.31.9.9.9.1.2">
                    𝑗
                   </ci>
                   <ci id="S3.E7.m1.31.31.31.9.9.9.1.3.cmml" xref="S3.E7.m1.31.31.31.9.9.9.1.3">
                    𝑘
                   </ci>
                  </apply>
                 </apply>
                 <apply id="S3.E7.m1.38.38.1.1.1.8.3.2.2.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.3.2.2.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                   subscript
                  </csymbol>
                  <ci id="S3.E7.m1.33.33.33.11.11.11.cmml" xref="S3.E7.m1.33.33.33.11.11.11">
                   𝐵
                  </ci>
                  <ci id="S3.E7.m1.34.34.34.12.12.12.1.cmml" xref="S3.E7.m1.34.34.34.12.12.12.1">
                   𝑘
                  </ci>
                 </apply>
                </apply>
                <apply id="S3.E7.m1.38.38.1.1.1.8.3.2.3.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                 <csymbol cd="ambiguous" id="S3.E7.m1.38.38.1.1.1.8.3.2.3.1.cmml" xref="S3.E7.m1.9.9.9.9.9.11.2.1">
                  subscript
                 </csymbol>
                 <ci id="S3.E7.m1.35.35.35.13.13.13.cmml" xref="S3.E7.m1.35.35.35.13.13.13">
                  𝐴
                 </ci>
                 <ci id="S3.E7.m1.36.36.36.14.14.14.1.cmml" xref="S3.E7.m1.36.36.36.14.14.14.1">
                  𝑘
                 </ci>
                </apply>
               </apply>
              </apply>
             </apply>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E7.m1.39c">
           \begin{split}W_{j}=W_{0}+\Delta W_{j}&amp;=W_{0}+\sum_{k=1}^{M}w_{jk}\cdot\Delta W_{k}\\
&amp;=W_{0}+\sum_{k=1}^{M}w_{jk}\cdot B_{k}A_{k},\end{split}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (7)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S3.SS3.p1.14">
     where
     <math alttext="j" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m1.1">
      <semantics id="S3.SS3.p1.5.m1.1a">
       <mi id="S3.SS3.p1.5.m1.1.1" xref="S3.SS3.p1.5.m1.1.1.cmml">
        j
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m1.1b">
        <ci id="S3.SS3.p1.5.m1.1.1.cmml" xref="S3.SS3.p1.5.m1.1.1">
         𝑗
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.5.m1.1c">
        j
       </annotation>
      </semantics>
     </math>
     represents a new role outside of the existing set
     <math alttext="R" class="ltx_Math" display="inline" id="S3.SS3.p1.6.m2.1">
      <semantics id="S3.SS3.p1.6.m2.1a">
       <mi id="S3.SS3.p1.6.m2.1.1" xref="S3.SS3.p1.6.m2.1.1.cmml">
        R
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.6.m2.1b">
        <ci id="S3.SS3.p1.6.m2.1.1.cmml" xref="S3.SS3.p1.6.m2.1.1">
         𝑅
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.6.m2.1c">
        R
       </annotation>
      </semantics>
     </math>
     , which contains
     <math alttext="M" class="ltx_Math" display="inline" id="S3.SS3.p1.7.m3.1">
      <semantics id="S3.SS3.p1.7.m3.1a">
       <mi id="S3.SS3.p1.7.m3.1.1" xref="S3.SS3.p1.7.m3.1.1.cmml">
        M
       </mi>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.7.m3.1b">
        <ci id="S3.SS3.p1.7.m3.1.1.cmml" xref="S3.SS3.p1.7.m3.1.1">
         𝑀
        </ci>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.7.m3.1c">
        M
       </annotation>
      </semantics>
     </math>
     roles. The contribution weight vector
     <math alttext="w_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.8.m4.1">
      <semantics id="S3.SS3.p1.8.m4.1a">
       <msub id="S3.SS3.p1.8.m4.1.1" xref="S3.SS3.p1.8.m4.1.1.cmml">
        <mi id="S3.SS3.p1.8.m4.1.1.2" xref="S3.SS3.p1.8.m4.1.1.2.cmml">
         w
        </mi>
        <mi id="S3.SS3.p1.8.m4.1.1.3" xref="S3.SS3.p1.8.m4.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.8.m4.1b">
        <apply id="S3.SS3.p1.8.m4.1.1.cmml" xref="S3.SS3.p1.8.m4.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.8.m4.1.1.1.cmml" xref="S3.SS3.p1.8.m4.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.8.m4.1.1.2.cmml" xref="S3.SS3.p1.8.m4.1.1.2">
          𝑤
         </ci>
         <ci id="S3.SS3.p1.8.m4.1.1.3.cmml" xref="S3.SS3.p1.8.m4.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.8.m4.1c">
        w_{j}
       </annotation>
      </semantics>
     </math>
     for the new role
     <math alttext="r_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.9.m5.1">
      <semantics id="S3.SS3.p1.9.m5.1a">
       <msub id="S3.SS3.p1.9.m5.1.1" xref="S3.SS3.p1.9.m5.1.1.cmml">
        <mi id="S3.SS3.p1.9.m5.1.1.2" xref="S3.SS3.p1.9.m5.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS3.p1.9.m5.1.1.3" xref="S3.SS3.p1.9.m5.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.9.m5.1b">
        <apply id="S3.SS3.p1.9.m5.1.1.cmml" xref="S3.SS3.p1.9.m5.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.9.m5.1.1.1.cmml" xref="S3.SS3.p1.9.m5.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.9.m5.1.1.2.cmml" xref="S3.SS3.p1.9.m5.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS3.p1.9.m5.1.1.3.cmml" xref="S3.SS3.p1.9.m5.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.9.m5.1c">
        r_{j}
       </annotation>
      </semantics>
     </math>
     is determined using
     <math alttext="e_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.10.m6.1">
      <semantics id="S3.SS3.p1.10.m6.1a">
       <msub id="S3.SS3.p1.10.m6.1.1" xref="S3.SS3.p1.10.m6.1.1.cmml">
        <mi id="S3.SS3.p1.10.m6.1.1.2" xref="S3.SS3.p1.10.m6.1.1.2.cmml">
         e
        </mi>
        <mi id="S3.SS3.p1.10.m6.1.1.3" xref="S3.SS3.p1.10.m6.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.10.m6.1b">
        <apply id="S3.SS3.p1.10.m6.1.1.cmml" xref="S3.SS3.p1.10.m6.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.10.m6.1.1.1.cmml" xref="S3.SS3.p1.10.m6.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.10.m6.1.1.2.cmml" xref="S3.SS3.p1.10.m6.1.1.2">
          𝑒
         </ci>
         <ci id="S3.SS3.p1.10.m6.1.1.3.cmml" xref="S3.SS3.p1.10.m6.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.10.m6.1c">
        e_{j}
       </annotation>
      </semantics>
     </math>
     , derived from Equation
     <a class="ltx_ref" href="#S3.E6" title="In 3.2 Role Selection with Gating Network ‣ 3 Methodology ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       6
      </span>
     </a>
     . We obtain
     <math alttext="e_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.11.m7.1">
      <semantics id="S3.SS3.p1.11.m7.1a">
       <msub id="S3.SS3.p1.11.m7.1.1" xref="S3.SS3.p1.11.m7.1.1.cmml">
        <mi id="S3.SS3.p1.11.m7.1.1.2" xref="S3.SS3.p1.11.m7.1.1.2.cmml">
         e
        </mi>
        <mi id="S3.SS3.p1.11.m7.1.1.3" xref="S3.SS3.p1.11.m7.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.11.m7.1b">
        <apply id="S3.SS3.p1.11.m7.1.1.cmml" xref="S3.SS3.p1.11.m7.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.11.m7.1.1.1.cmml" xref="S3.SS3.p1.11.m7.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.11.m7.1.1.2.cmml" xref="S3.SS3.p1.11.m7.1.1.2">
          𝑒
         </ci>
         <ci id="S3.SS3.p1.11.m7.1.1.3.cmml" xref="S3.SS3.p1.11.m7.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.11.m7.1c">
        e_{j}
       </annotation>
      </semantics>
     </math>
     from a new role configuration profile, which is subsequently incorporated into
     <math alttext="\mathbf{E}_{\text{global}}" class="ltx_Math" display="inline" id="S3.SS3.p1.12.m8.1">
      <semantics id="S3.SS3.p1.12.m8.1a">
       <msub id="S3.SS3.p1.12.m8.1.1" xref="S3.SS3.p1.12.m8.1.1.cmml">
        <mi id="S3.SS3.p1.12.m8.1.1.2" xref="S3.SS3.p1.12.m8.1.1.2.cmml">
         𝐄
        </mi>
        <mtext id="S3.SS3.p1.12.m8.1.1.3" xref="S3.SS3.p1.12.m8.1.1.3a.cmml">
         global
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.12.m8.1b">
        <apply id="S3.SS3.p1.12.m8.1.1.cmml" xref="S3.SS3.p1.12.m8.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.12.m8.1.1.1.cmml" xref="S3.SS3.p1.12.m8.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.12.m8.1.1.2.cmml" xref="S3.SS3.p1.12.m8.1.1.2">
          𝐄
         </ci>
         <ci id="S3.SS3.p1.12.m8.1.1.3a.cmml" xref="S3.SS3.p1.12.m8.1.1.3">
          <mtext id="S3.SS3.p1.12.m8.1.1.3.cmml" mathsize="70%" xref="S3.SS3.p1.12.m8.1.1.3">
           global
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.12.m8.1c">
        \mathbf{E}_{\text{global}}
       </annotation>
      </semantics>
     </math>
     . Using
     <math alttext="w_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.13.m9.1">
      <semantics id="S3.SS3.p1.13.m9.1a">
       <msub id="S3.SS3.p1.13.m9.1.1" xref="S3.SS3.p1.13.m9.1.1.cmml">
        <mi id="S3.SS3.p1.13.m9.1.1.2" xref="S3.SS3.p1.13.m9.1.1.2.cmml">
         w
        </mi>
        <mi id="S3.SS3.p1.13.m9.1.1.3" xref="S3.SS3.p1.13.m9.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.13.m9.1b">
        <apply id="S3.SS3.p1.13.m9.1.1.cmml" xref="S3.SS3.p1.13.m9.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.13.m9.1.1.1.cmml" xref="S3.SS3.p1.13.m9.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.13.m9.1.1.2.cmml" xref="S3.SS3.p1.13.m9.1.1.2">
          𝑤
         </ci>
         <ci id="S3.SS3.p1.13.m9.1.1.3.cmml" xref="S3.SS3.p1.13.m9.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.13.m9.1c">
        w_{j}
       </annotation>
      </semantics>
     </math>
     , we linearly combine different LoRA blocks to construct the representation for the new role
     <math alttext="r_{j}" class="ltx_Math" display="inline" id="S3.SS3.p1.14.m10.1">
      <semantics id="S3.SS3.p1.14.m10.1a">
       <msub id="S3.SS3.p1.14.m10.1.1" xref="S3.SS3.p1.14.m10.1.1.cmml">
        <mi id="S3.SS3.p1.14.m10.1.1.2" xref="S3.SS3.p1.14.m10.1.1.2.cmml">
         r
        </mi>
        <mi id="S3.SS3.p1.14.m10.1.1.3" xref="S3.SS3.p1.14.m10.1.1.3.cmml">
         j
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p1.14.m10.1b">
        <apply id="S3.SS3.p1.14.m10.1.1.cmml" xref="S3.SS3.p1.14.m10.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p1.14.m10.1.1.1.cmml" xref="S3.SS3.p1.14.m10.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p1.14.m10.1.1.2.cmml" xref="S3.SS3.p1.14.m10.1.1.2">
          𝑟
         </ci>
         <ci id="S3.SS3.p1.14.m10.1.1.3.cmml" xref="S3.SS3.p1.14.m10.1.1.3">
          𝑗
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p1.14.m10.1c">
        r_{j}
       </annotation>
      </semantics>
     </math>
     .
    </p>
   </div>
   <div class="ltx_para" id="S3.SS3.p2">
    <p class="ltx_p" id="S3.SS3.p2.2">
     In the expansion mode, we introduce a dynamic expansion model capable of adapting to an increasing number of characters by adding network layers
     <cite class="ltx_cite ltx_citemacro_citep">
      (Cortes et al.,
      <a class="ltx_ref" href="#bib.bib4" title="">
       2017
      </a>
      ; Ye and Bors,
      <a class="ltx_ref" href="#bib.bib24" title="">
       2023
      </a>
      ; Chen et al.,
      <a class="ltx_ref" href="#bib.bib3" title="">
       2023b
      </a>
      ; Zhang et al.,
      <a class="ltx_ref" href="#bib.bib26" title="">
       2024
      </a>
      )
     </cite>
     . To effectively preserve pretrained knowledge, we employ a strategy of freezing neurons that are responsible for previous data distributions, while updating parameters pertinent to the current distribution. In this scenario, the expanded LoRA block and gating dimensions are optimized specifically for the new distribution. Hence, the optimization process is exclusively focused on
     <math alttext="\Delta{W_{j}}" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.1">
      <semantics id="S3.SS3.p2.1.m1.1a">
       <mrow id="S3.SS3.p2.1.m1.1.1" xref="S3.SS3.p2.1.m1.1.1.cmml">
        <mi id="S3.SS3.p2.1.m1.1.1.2" mathvariant="normal" xref="S3.SS3.p2.1.m1.1.1.2.cmml">
         Δ
        </mi>
        <mo id="S3.SS3.p2.1.m1.1.1.1" lspace="0em" rspace="0em" xref="S3.SS3.p2.1.m1.1.1.1.cmml">
         ​
        </mo>
        <msub id="S3.SS3.p2.1.m1.1.1.3" xref="S3.SS3.p2.1.m1.1.1.3.cmml">
         <mi id="S3.SS3.p2.1.m1.1.1.3.2" xref="S3.SS3.p2.1.m1.1.1.3.2.cmml">
          W
         </mi>
         <mi id="S3.SS3.p2.1.m1.1.1.3.3" xref="S3.SS3.p2.1.m1.1.1.3.3.cmml">
          j
         </mi>
        </msub>
       </mrow>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.1b">
        <apply id="S3.SS3.p2.1.m1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1">
         <times id="S3.SS3.p2.1.m1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1.1">
         </times>
         <ci id="S3.SS3.p2.1.m1.1.1.2.cmml" xref="S3.SS3.p2.1.m1.1.1.2">
          Δ
         </ci>
         <apply id="S3.SS3.p2.1.m1.1.1.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3">
          <csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.3.1.cmml" xref="S3.SS3.p2.1.m1.1.1.3">
           subscript
          </csymbol>
          <ci id="S3.SS3.p2.1.m1.1.1.3.2.cmml" xref="S3.SS3.p2.1.m1.1.1.3.2">
           𝑊
          </ci>
          <ci id="S3.SS3.p2.1.m1.1.1.3.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3.3">
           𝑗
          </ci>
         </apply>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.1c">
        \Delta{W_{j}}
       </annotation>
      </semantics>
     </math>
     and
     <math alttext="W_{G}" class="ltx_Math" display="inline" id="S3.SS3.p2.2.m2.1">
      <semantics id="S3.SS3.p2.2.m2.1a">
       <msub id="S3.SS3.p2.2.m2.1.1" xref="S3.SS3.p2.2.m2.1.1.cmml">
        <mi id="S3.SS3.p2.2.m2.1.1.2" xref="S3.SS3.p2.2.m2.1.1.2.cmml">
         W
        </mi>
        <mi id="S3.SS3.p2.2.m2.1.1.3" xref="S3.SS3.p2.2.m2.1.1.3.cmml">
         G
        </mi>
       </msub>
       <annotation-xml encoding="MathML-Content" id="S3.SS3.p2.2.m2.1b">
        <apply id="S3.SS3.p2.2.m2.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1">
         <csymbol cd="ambiguous" id="S3.SS3.p2.2.m2.1.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1">
          subscript
         </csymbol>
         <ci id="S3.SS3.p2.2.m2.1.1.2.cmml" xref="S3.SS3.p2.2.m2.1.1.2">
          𝑊
         </ci>
         <ci id="S3.SS3.p2.2.m2.1.1.3.cmml" xref="S3.SS3.p2.2.m2.1.1.3">
          𝐺
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="S3.SS3.p2.2.m2.1c">
        W_{G}
       </annotation>
      </semantics>
     </math>
     :
    </p>
    <table class="ltx_equation ltx_eqn_table" id="S3.E8">
     <tbody>
      <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
       <td class="ltx_eqn_cell ltx_eqn_center_padleft">
       </td>
       <td class="ltx_eqn_cell ltx_align_center">
        <math alttext="\Delta{W_{j}}^{*},W_{G}^{*}=\text{argmin}_{\Delta{W_{j}},W_{G}}(\mathcal{L})." class="ltx_Math" display="block" id="S3.E8.m1.4">
         <semantics id="S3.E8.m1.4a">
          <mrow id="S3.E8.m1.4.4.1" xref="S3.E8.m1.4.4.1.1.cmml">
           <mrow id="S3.E8.m1.4.4.1.1" xref="S3.E8.m1.4.4.1.1.cmml">
            <mrow id="S3.E8.m1.4.4.1.1.2.2" xref="S3.E8.m1.4.4.1.1.2.3.cmml">
             <mrow id="S3.E8.m1.4.4.1.1.1.1.1" xref="S3.E8.m1.4.4.1.1.1.1.1.cmml">
              <mi id="S3.E8.m1.4.4.1.1.1.1.1.2" mathvariant="normal" xref="S3.E8.m1.4.4.1.1.1.1.1.2.cmml">
               Δ
              </mi>
              <mo id="S3.E8.m1.4.4.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S3.E8.m1.4.4.1.1.1.1.1.1.cmml">
               ​
              </mo>
              <mmultiscripts id="S3.E8.m1.4.4.1.1.1.1.1.3" xref="S3.E8.m1.4.4.1.1.1.1.1.3.cmml">
               <mi id="S3.E8.m1.4.4.1.1.1.1.1.3.2.2" xref="S3.E8.m1.4.4.1.1.1.1.1.3.2.2.cmml">
                W
               </mi>
               <mi id="S3.E8.m1.4.4.1.1.1.1.1.3.2.3" xref="S3.E8.m1.4.4.1.1.1.1.1.3.2.3.cmml">
                j
               </mi>
               <mrow id="S3.E8.m1.4.4.1.1.1.1.1.3a" xref="S3.E8.m1.4.4.1.1.1.1.1.3.cmml">
               </mrow>
               <mrow id="S3.E8.m1.4.4.1.1.1.1.1.3b" xref="S3.E8.m1.4.4.1.1.1.1.1.3.cmml">
               </mrow>
               <mo id="S3.E8.m1.4.4.1.1.1.1.1.3.3" xref="S3.E8.m1.4.4.1.1.1.1.1.3.3.cmml">
                ∗
               </mo>
              </mmultiscripts>
             </mrow>
             <mo id="S3.E8.m1.4.4.1.1.2.2.3" xref="S3.E8.m1.4.4.1.1.2.3.cmml">
              ,
             </mo>
             <msubsup id="S3.E8.m1.4.4.1.1.2.2.2" xref="S3.E8.m1.4.4.1.1.2.2.2.cmml">
              <mi id="S3.E8.m1.4.4.1.1.2.2.2.2.2" xref="S3.E8.m1.4.4.1.1.2.2.2.2.2.cmml">
               W
              </mi>
              <mi id="S3.E8.m1.4.4.1.1.2.2.2.2.3" xref="S3.E8.m1.4.4.1.1.2.2.2.2.3.cmml">
               G
              </mi>
              <mo id="S3.E8.m1.4.4.1.1.2.2.2.3" xref="S3.E8.m1.4.4.1.1.2.2.2.3.cmml">
               ∗
              </mo>
             </msubsup>
            </mrow>
            <mo id="S3.E8.m1.4.4.1.1.3" xref="S3.E8.m1.4.4.1.1.3.cmml">
             =
            </mo>
            <mrow id="S3.E8.m1.4.4.1.1.4" xref="S3.E8.m1.4.4.1.1.4.cmml">
             <msub id="S3.E8.m1.4.4.1.1.4.2" xref="S3.E8.m1.4.4.1.1.4.2.cmml">
              <mtext id="S3.E8.m1.4.4.1.1.4.2.2" xref="S3.E8.m1.4.4.1.1.4.2.2a.cmml">
               argmin
              </mtext>
              <mrow id="S3.E8.m1.2.2.2.2" xref="S3.E8.m1.2.2.2.3.cmml">
               <mrow id="S3.E8.m1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.cmml">
                <mi id="S3.E8.m1.1.1.1.1.1.2" mathvariant="normal" xref="S3.E8.m1.1.1.1.1.1.2.cmml">
                 Δ
                </mi>
                <mo id="S3.E8.m1.1.1.1.1.1.1" lspace="0em" rspace="0em" xref="S3.E8.m1.1.1.1.1.1.1.cmml">
                 ​
                </mo>
                <msub id="S3.E8.m1.1.1.1.1.1.3" xref="S3.E8.m1.1.1.1.1.1.3.cmml">
                 <mi id="S3.E8.m1.1.1.1.1.1.3.2" xref="S3.E8.m1.1.1.1.1.1.3.2.cmml">
                  W
                 </mi>
                 <mi id="S3.E8.m1.1.1.1.1.1.3.3" xref="S3.E8.m1.1.1.1.1.1.3.3.cmml">
                  j
                 </mi>
                </msub>
               </mrow>
               <mo id="S3.E8.m1.2.2.2.2.3" xref="S3.E8.m1.2.2.2.3.cmml">
                ,
               </mo>
               <msub id="S3.E8.m1.2.2.2.2.2" xref="S3.E8.m1.2.2.2.2.2.cmml">
                <mi id="S3.E8.m1.2.2.2.2.2.2" xref="S3.E8.m1.2.2.2.2.2.2.cmml">
                 W
                </mi>
                <mi id="S3.E8.m1.2.2.2.2.2.3" xref="S3.E8.m1.2.2.2.2.2.3.cmml">
                 G
                </mi>
               </msub>
              </mrow>
             </msub>
             <mo id="S3.E8.m1.4.4.1.1.4.1" lspace="0em" rspace="0em" xref="S3.E8.m1.4.4.1.1.4.1.cmml">
              ​
             </mo>
             <mrow id="S3.E8.m1.4.4.1.1.4.3.2" xref="S3.E8.m1.4.4.1.1.4.cmml">
              <mo id="S3.E8.m1.4.4.1.1.4.3.2.1" stretchy="false" xref="S3.E8.m1.4.4.1.1.4.cmml">
               (
              </mo>
              <mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.3.3" xref="S3.E8.m1.3.3.cmml">
               ℒ
              </mi>
              <mo id="S3.E8.m1.4.4.1.1.4.3.2.2" stretchy="false" xref="S3.E8.m1.4.4.1.1.4.cmml">
               )
              </mo>
             </mrow>
            </mrow>
           </mrow>
           <mo id="S3.E8.m1.4.4.1.2" lspace="0em" xref="S3.E8.m1.4.4.1.1.cmml">
            .
           </mo>
          </mrow>
          <annotation-xml encoding="MathML-Content" id="S3.E8.m1.4b">
           <apply id="S3.E8.m1.4.4.1.1.cmml" xref="S3.E8.m1.4.4.1">
            <eq id="S3.E8.m1.4.4.1.1.3.cmml" xref="S3.E8.m1.4.4.1.1.3">
            </eq>
            <list id="S3.E8.m1.4.4.1.1.2.3.cmml" xref="S3.E8.m1.4.4.1.1.2.2">
             <apply id="S3.E8.m1.4.4.1.1.1.1.1.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1">
              <times id="S3.E8.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.1">
              </times>
              <ci id="S3.E8.m1.4.4.1.1.1.1.1.2.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.2">
               Δ
              </ci>
              <apply id="S3.E8.m1.4.4.1.1.1.1.1.3.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3">
               <csymbol cd="ambiguous" id="S3.E8.m1.4.4.1.1.1.1.1.3.1.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3">
                superscript
               </csymbol>
               <apply id="S3.E8.m1.4.4.1.1.1.1.1.3.2.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3">
                <csymbol cd="ambiguous" id="S3.E8.m1.4.4.1.1.1.1.1.3.2.1.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3">
                 subscript
                </csymbol>
                <ci id="S3.E8.m1.4.4.1.1.1.1.1.3.2.2.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3.2.2">
                 𝑊
                </ci>
                <ci id="S3.E8.m1.4.4.1.1.1.1.1.3.2.3.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3.2.3">
                 𝑗
                </ci>
               </apply>
               <times id="S3.E8.m1.4.4.1.1.1.1.1.3.3.cmml" xref="S3.E8.m1.4.4.1.1.1.1.1.3.3">
               </times>
              </apply>
             </apply>
             <apply id="S3.E8.m1.4.4.1.1.2.2.2.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2">
              <csymbol cd="ambiguous" id="S3.E8.m1.4.4.1.1.2.2.2.1.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2">
               superscript
              </csymbol>
              <apply id="S3.E8.m1.4.4.1.1.2.2.2.2.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2">
               <csymbol cd="ambiguous" id="S3.E8.m1.4.4.1.1.2.2.2.2.1.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2">
                subscript
               </csymbol>
               <ci id="S3.E8.m1.4.4.1.1.2.2.2.2.2.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2.2.2">
                𝑊
               </ci>
               <ci id="S3.E8.m1.4.4.1.1.2.2.2.2.3.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2.2.3">
                𝐺
               </ci>
              </apply>
              <times id="S3.E8.m1.4.4.1.1.2.2.2.3.cmml" xref="S3.E8.m1.4.4.1.1.2.2.2.3">
              </times>
             </apply>
            </list>
            <apply id="S3.E8.m1.4.4.1.1.4.cmml" xref="S3.E8.m1.4.4.1.1.4">
             <times id="S3.E8.m1.4.4.1.1.4.1.cmml" xref="S3.E8.m1.4.4.1.1.4.1">
             </times>
             <apply id="S3.E8.m1.4.4.1.1.4.2.cmml" xref="S3.E8.m1.4.4.1.1.4.2">
              <csymbol cd="ambiguous" id="S3.E8.m1.4.4.1.1.4.2.1.cmml" xref="S3.E8.m1.4.4.1.1.4.2">
               subscript
              </csymbol>
              <ci id="S3.E8.m1.4.4.1.1.4.2.2a.cmml" xref="S3.E8.m1.4.4.1.1.4.2.2">
               <mtext id="S3.E8.m1.4.4.1.1.4.2.2.cmml" xref="S3.E8.m1.4.4.1.1.4.2.2">
                argmin
               </mtext>
              </ci>
              <list id="S3.E8.m1.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.2">
               <apply id="S3.E8.m1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1">
                <times id="S3.E8.m1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1">
                </times>
                <ci id="S3.E8.m1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.1.1.1.1.1.2">
                 Δ
                </ci>
                <apply id="S3.E8.m1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.1.1.1.1.1.3">
                 <csymbol cd="ambiguous" id="S3.E8.m1.1.1.1.1.1.3.1.cmml" xref="S3.E8.m1.1.1.1.1.1.3">
                  subscript
                 </csymbol>
                 <ci id="S3.E8.m1.1.1.1.1.1.3.2.cmml" xref="S3.E8.m1.1.1.1.1.1.3.2">
                  𝑊
                 </ci>
                 <ci id="S3.E8.m1.1.1.1.1.1.3.3.cmml" xref="S3.E8.m1.1.1.1.1.1.3.3">
                  𝑗
                 </ci>
                </apply>
               </apply>
               <apply id="S3.E8.m1.2.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2">
                <csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.2.2.1.cmml" xref="S3.E8.m1.2.2.2.2.2">
                 subscript
                </csymbol>
                <ci id="S3.E8.m1.2.2.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2.2">
                 𝑊
                </ci>
                <ci id="S3.E8.m1.2.2.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.2.2.3">
                 𝐺
                </ci>
               </apply>
              </list>
             </apply>
             <ci id="S3.E8.m1.3.3.cmml" xref="S3.E8.m1.3.3">
              ℒ
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S3.E8.m1.4c">
           \Delta{W_{j}}^{*},W_{G}^{*}=\text{argmin}_{\Delta{W_{j}},W_{G}}(\mathcal{L}).
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_eqn_cell ltx_eqn_center_padright">
       </td>
       <td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1">
        <span class="ltx_tag ltx_tag_equation ltx_align_right">
         (8)
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p class="ltx_p" id="S3.SS3.p2.3">
     Consequently, we preserve the integrity of the pretrained LoRA parameters by freezing both the existing LoRA blocks and the gating dimensions.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S4">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    4
   </span>
   Evaluation Metrics
  </h2>
  <div class="ltx_para" id="S4.p1">
   <p class="ltx_p" id="S4.p1.1">
    In this section, we propose a set of evaluation metrics from three dimensions, character, knowledge, and dialogue, to provide a comprehensive assessment of the acting ability of agents.
Specifically, rather than evaluating the performance of the models from certain task-specific perspectives, such as reasoning ability or language understanding, our evaluation centres on assessing their ability to convincingly portray specific characters.
   </p>
  </div>
  <section class="ltx_subsection" id="S4.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.1
    </span>
    Character Consistency
   </h3>
   <div class="ltx_para" id="S4.SS1.p1">
    <p class="ltx_p" id="S4.SS1.p1.1">
     As the consistency of character portrayal by conversation agents changes, it provides users with the most intuitive experience.
Therefore, evaluating the performance of agent role-playing in terms of character consistency is crucial.
This metric evaluates whether a role-playing conversational agent (RPCA) accurately reflects the characteristics of a given character, encompassing both behavior and utterance aspects.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS1.p2">
    <ul class="ltx_itemize" id="S4.I1">
     <li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I1.i1.p1">
       <p class="ltx_p" id="S4.I1.i1.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I1.i1.p1.1.1">
         Character Behavior (CB).
        </span>
        By incorporating fine-grained actions, expressions, and tones typically described within brackets, a character’s behaviors enhance the immersive experience for users.
Consistency in portraying these behaviors is a key indicator of an effective RPCA.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I1.i2.p1">
       <p class="ltx_p" id="S4.I1.i2.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I1.i2.p1.1.1">
         Character Utterance (CU).
        </span>
        Each character has unique patterns of expression, and as such, the utterances of RPCAs should closely align with these patterns in order to adeptly mimic the character.
       </p>
      </div>
     </li>
    </ul>
   </div>
  </section>
  <section class="ltx_subsection" id="S4.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.2
    </span>
    Knowledge Consistency
   </h3>
   <div class="ltx_para" id="S4.SS2.p1">
    <p class="ltx_p" id="S4.SS2.p1.1">
     The consistency of knowledge plays a vital role in upholding the reliability and accuracy of information within the dialogue system.
For role-playing agents, knowledge consistency is reflected in both real-world knowledge and the virtual knowledge of characters.
    </p>
   </div>
   <div class="ltx_para" id="S4.SS2.p2">
    <ul class="ltx_itemize" id="S4.I2">
     <li class="ltx_item" id="S4.I2.i1" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I2.i1.p1">
       <p class="ltx_p" id="S4.I2.i1.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I2.i1.p1.1.1">
         Virtual Knowledge (VK).
        </span>
        Virtual knowledge reflects the environment of the specified character.
Accurate virtual knowledge provides authenticity of interactions and creates a more immersive experience for users.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S4.I2.i2" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I2.i2.p1">
       <p class="ltx_p" id="S4.I2.i2.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I2.i2.p1.1.1">
         Real Knowledge (RK).
        </span>
        The role-playing agent should not compromise real-world knowledge, as it is closely linked to the practical needs of users.
For instance, we wouldn’t want a Hermione-playing agent to respond to the question,
        <span class="ltx_text ltx_font_italic" id="S4.I2.i2.p1.1.2">
         “What should I do if my glasses are damaged?”
        </span>
        with
        <span class="ltx_text ltx_font_italic" id="S4.I2.i2.p1.1.3">
         “Use the spell ‘Oculus Reparo’.”
        </span>
        .
Therefore, it is essential to assess whether the agent’s knowledge remains intact and accurate.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S4.I2.i3" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I2.i3.p1">
       <p class="ltx_p" id="S4.I2.i3.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I2.i3.p1.1.1">
         Hallucinatory Knowledge (HK).
        </span>
        When conflicts arise between virtual knowledge and real knowledge, the role-playing agent should refrain from generating “hallucinatory knowledge”.
Exercising caution and maintaining consistency in the presence of conflicts ensures that users receive coherent and reliable information during the dialogue.
       </p>
      </div>
     </li>
    </ul>
   </div>
  </section>
  <section class="ltx_subsection" id="S4.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.3
    </span>
    Dialogue Consistency
   </h3>
   <div class="ltx_para" id="S4.SS3.p1">
    <p class="ltx_p" id="S4.SS3.p1.1">
     Role-playing agents should also possess basic conversational abilities.
Inspired by previous neural metrics
     <cite class="ltx_cite ltx_citemacro_cite">
      Tu et al. (
      <a class="ltx_ref" href="#bib.bib20" title="">
       2024
      </a>
      )
     </cite>
     , which evaluate the responses based on well-trained neural models, we introduce a similar approach to assess the fundamental conversational abilities of RPCAs.
We focus on three key objectives for generated responses: fluency, coherency, and consistency.
    </p>
    <ul class="ltx_itemize" id="S4.I3">
     <li class="ltx_item" id="S4.I3.i1" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I3.i1.p1">
       <p class="ltx_p" id="S4.I3.i1.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I3.i1.p1.1.1">
         Transfer (Trans.).
        </span>
        In a multi-turn dialogue, an MCRP agent is required to sequentially play the roles of A and B.
It is expected that agents do not carry over any characteristics or behaviors from the previous role A when they transition to playing role B.
The Transfer metric assesses the agent’s ability to make this transition effectively.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S4.I3.i2" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I3.i2.p1">
       <p class="ltx_p" id="S4.I3.i2.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I3.i2.p1.1.1">
         Relevance (Rel.)
        </span>
        evaluates the topic relevance between the response and the context.
Generally, when the user submits a query on a specific topic, an RPCA should respond following the topic instead of providing an irrelevant response.
       </p>
      </div>
     </li>
     <li class="ltx_item" id="S4.I3.i3" style="list-style-type:none;">
      <span class="ltx_tag ltx_tag_item">
       •
      </span>
      <div class="ltx_para" id="S4.I3.i3.p1">
       <p class="ltx_p" id="S4.I3.i3.p1.1">
        <span class="ltx_text ltx_font_bold" id="S4.I3.i3.p1.1.1">
         Stability (Stab.).
        </span>
        In the dialogue, the agent needs to maintain the characteristics of the role it portrays until the user switches to a new role.
Our objective is to assess the agent’s stability and consistency over a relatively long duration, unaffected by variations in incremental inputs.
       </p>
      </div>
     </li>
    </ul>
   </div>
   <figure class="ltx_table" id="S4.T1">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T1.1">
     <tr class="ltx_tr" id="S4.T1.1.1">
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1" rowspan="2">
       <span class="ltx_text" id="S4.T1.1.1.1.1">
        Method Type
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.2" rowspan="2">
       <span class="ltx_text" id="S4.T1.1.1.2.1">
        Methods
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.3">
       Character
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S4.T1.1.1.4">
       Knowledge
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.5">
       Dialogue
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.6" rowspan="2">
       <span class="ltx_text" id="S4.T1.1.1.6.1">
        AVG
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.2">
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.1">
       CB
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.2">
       CU
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.3">
       VK
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.4">
       RK
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.5">
       HK
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.6">
       Rel
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.2.7">
       Stab
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.3">
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.1" rowspan="2">
       <span class="ltx_text" id="S4.T1.1.3.1.1">
        RAG
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.2">
       LLaMA-chat
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.3">
       5.60
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.4">
       5.37
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.5">
       5.00
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.6">
       5.74
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.7">
       6.33
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.8">
       6.24
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.9">
       2.78
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.3.10">
       5.29
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.4">
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.1">
       GPT-3.5
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.2">
       5.97
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.3">
       4.42
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.4">
       5.63
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.5">
       6.35
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.6">
       6.45
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.7">
       6.79
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.8">
       2.75
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.4.9">
       5.48
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.5">
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.1" rowspan="2">
       <span class="ltx_text" id="S4.T1.1.5.1.1">
        ICL
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.2">
       LLaMA-chat
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.3">
       5.85
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.4">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.5.4.1">
        5.40
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.5">
       5.08
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.6">
       5.48
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.7">
       6.29
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.8">
       6.30
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.9">
       3.04
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.5.10">
       5.35
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.6">
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.1">
       GPT-3.5
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.2">
       6.11
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.3">
       4.54
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.4">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.6.4.1">
        5.89
       </span>
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.5">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.6.5.1">
        6.42
       </span>
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.6">
       6.54
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.7">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.6.7.1">
        6.88
       </span>
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.8">
       2.76
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.6.9">
       5.59
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.7">
      <td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S4.T1.1.7.1" rowspan="3">
       <span class="ltx_text" id="S4.T1.1.7.1.1">
        FT
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.2">
       Character-LLM
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.3">
       6.21
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.4">
       4.71
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.5">
       5.75
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.6">
       6.36
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.7">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.7.7.1">
        6.55
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.8">
       6.81
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.9">
       2.99
      </td>
      <td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.7.10">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.7.10.1">
        5.62
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.8">
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.1">
       LoRA
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.2">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.8.2.1">
        6.23
       </span>
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.3">
       5.00
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.4">
       5.46
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.5">
       6.04
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.6">
       6.35
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.7">
       6.61
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.8">
       3.05
      </td>
      <td class="ltx_td ltx_align_center" id="S4.T1.1.8.9">
       5.54
      </td>
     </tr>
     <tr class="ltx_tr" id="S4.T1.1.9">
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.1">
       Neeko
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.2">
       6.12
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.3">
       4.96
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.4">
       5.68
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.5">
       6.15
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.6">
       6.44
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.7">
       6.72
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.8">
       <span class="ltx_text ltx_font_bold" id="S4.T1.1.9.8.1">
        3.17
       </span>
      </td>
      <td class="ltx_td ltx_align_center ltx_border_b" id="S4.T1.1.9.9">
       5.61
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 1:
     </span>
     Comparison results between Neeko and recent role-playing methods on Character-LLM-Data, comprising both single-turn and multi-turn dialogues.
    </figcaption>
   </figure>
  </section>
  <section class="ltx_subsection" id="S4.SS4">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     4.4
    </span>
    LLMs as Evaluator
   </h3>
   <div class="ltx_para" id="S4.SS4.p1">
    <p class="ltx_p" id="S4.SS4.p1.1">
     The evaluation process can be likened to casting, where role-playing agents are assessed for their suitability to play specific characters in a film or television.
The judge must possess a profound understanding of the characters to make informed decisions based on their knowledge and discernment.
We leverage GPT-3.5 as the judge following previous research
     <cite class="ltx_cite ltx_citemacro_citep">
      (Shen et al.,
      <a class="ltx_ref" href="#bib.bib17" title="">
       2023
      </a>
      ; Chen et al.,
      <a class="ltx_ref" href="#bib.bib2" title="">
       2023a
      </a>
      ; Tu et al.,
      <a class="ltx_ref" href="#bib.bib20" title="">
       2024
      </a>
      )
     </cite>
     , which asks LLMs to step-by-step score the performance of the dialogues according to our metrics.
For each dialogue, we prompt the model to evaluate a single dimension at a time.
We first illustrate the criterion of the current dimension to be evaluated
and then provide an evaluation plan to teach the model how to evaluate accurately.
For example, to evaluate character consistency, we provide a strategy that summarizes as:
(1) identify the personality shown by the agent;
(2) write the actual traits of the character based on the profile;
(3) compare the similarity of the agent’s performance with these traits;
(4) assign a final score.
We find that this step-by-step evaluation approach is more reliable than obtaining the overall score directly using vanilla instruction in preliminary experiments.
Refer to Appendix
     <a class="ltx_ref" href="#A1" title="Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       A
      </span>
     </a>
     for the design of prompts.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_section" id="S5">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    5
   </span>
   Experiments
  </h2>
  <div class="ltx_para" id="S5.p1">
   <p class="ltx_p" id="S5.p1.1">
    In this section, we conduct validation experiments aiming to address the following research questions (RQs):
   </p>
  </div>
  <div class="ltx_para" id="S5.p2">
   <ul class="ltx_itemize" id="S5.I1">
    <li class="ltx_item" id="S5.I1.i1" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S5.I1.i1.p1">
      <p class="ltx_p" id="S5.I1.i1.p1.1">
       <span class="ltx_text ltx_font_bold" id="S5.I1.i1.p1.1.1">
        RQ1:
       </span>
       How do existing role-playing agents perform when facing MCRP tasks?
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S5.I1.i2" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S5.I1.i2.p1">
      <p class="ltx_p" id="S5.I1.i2.p1.1">
       <span class="ltx_text ltx_font_bold" id="S5.I1.i2.p1.1.1">
        RQ2:
       </span>
       Are current role-playing agents able to handle non-predefined roles?
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S5.I1.i3" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S5.I1.i3.p1">
      <p class="ltx_p" id="S5.I1.i3.p1.1">
       <span class="ltx_text ltx_font_bold" id="S5.I1.i3.p1.1.1">
        RQ3:
       </span>
       Can current role-playing agents switch between roles?
      </p>
     </div>
    </li>
    <li class="ltx_item" id="S5.I1.i4" style="list-style-type:none;">
     <span class="ltx_tag ltx_tag_item">
      •
     </span>
     <div class="ltx_para" id="S5.I1.i4.p1">
      <p class="ltx_p" id="S5.I1.i4.p1.1">
       <span class="ltx_text ltx_font_bold" id="S5.I1.i4.p1.1.1">
        RQ4:
       </span>
       What is the training cost of current role-playing agents?
      </p>
     </div>
    </li>
   </ul>
  </div>
  <section class="ltx_subsection" id="S5.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.1
    </span>
    Dataset
   </h3>
   <div class="ltx_para" id="S5.SS1.p1">
    <p class="ltx_p" id="S5.SS1.p1.1">
     We employ the publicly available Character-LLM-Data dataset
     <cite class="ltx_cite ltx_citemacro_citep">
      (Shao et al.,
      <a class="ltx_ref" href="#bib.bib16" title="">
       2023
      </a>
      )
     </cite>
     to evaluate the performance of role-playing agents.
This dataset aims to reconstruct the experiences of specific characters for LLMs and assess the role-playing capabilities of agents.
Specifically, the Character-LLM-Data dataset comprises 9 characters, with each character having an average of 1.6K scenes in the training set.
The evaluation set of the dataset includes a total of 857 single-turn dialogues and 450 multi-turn dialogues.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="S5.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.2
    </span>
    Implementation Details and Baselines
   </h3>
   <div class="ltx_para" id="S5.SS2.p1">
    <p class="ltx_p" id="S5.SS2.p1.1">
     Our experiments are implemented using PyTorch and run on one A100.
For Neeko, we employ LLaMA-2 (7B)
     <cite class="ltx_cite ltx_citemacro_citep">
      (Touvron et al.,
      <a class="ltx_ref" href="#bib.bib19" title="">
       2023
      </a>
      )
     </cite>
     as the backbone model for Neeko.
The setting of hyper-parameters of Neeko can refer to Appendix
     <a class="ltx_ref" href="#A1.SS1" title="A.1 Hyper-parameter settings of Neeko ‣ Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       A.1
      </span>
     </a>
     .
    </p>
   </div>
   <div class="ltx_para" id="S5.SS2.p2">
    <p class="ltx_p" id="S5.SS2.p2.1">
     We form a baseline of current role-playing agents to evaluate their performance.
The baselines are from three main categories: ICL-based, RE-based, and FT-based.
    </p>
   </div>
   <section class="ltx_paragraph" id="S5.SS2.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     FT-based.
    </h4>
    <div class="ltx_para" id="S5.SS2.SSS0.Px1.p1">
     <p class="ltx_p" id="S5.SS2.SSS0.Px1.p1.1">
      LoRA
      <cite class="ltx_cite ltx_citemacro_cite">
       Hu et al. (
       <a class="ltx_ref" href="#bib.bib8" title="">
        2021
       </a>
       )
      </cite>
      is a parameter-efficient fine-tuning method that enables the adaptation of LLMs through lightweight modules.
Character-LLM
      <cite class="ltx_cite ltx_citemacro_citep">
       (Shao et al.,
       <a class="ltx_ref" href="#bib.bib16" title="">
        2023
       </a>
       )
      </cite>
      fine-tunes a separate agent model using the data from the character experiences.
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S5.SS2.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     ICL-based and RAG-based.
    </h4>
    <div class="ltx_para" id="S5.SS2.SSS0.Px2.p1">
     <p class="ltx_p" id="S5.SS2.SSS0.Px2.p1.1">
      This signifies a training-free paradigm where knowledge is acquired directly from demonstrations concatenated within the input context.
Retrieval augmented generation is a prevalent technique that leverages external databases to enhance language models.
We utilize GPT-3.5-turbo and the dialogue-optimized version of LLaMA-2
      <cite class="ltx_cite ltx_citemacro_citep">
       (Touvron et al.,
       <a class="ltx_ref" href="#bib.bib19" title="">
        2023
       </a>
       )
      </cite>
      : LLaMA-2-chat as our backbone LLMs for ICL and RAG-based baselines.
     </p>
    </div>
    <figure class="ltx_table" id="S5.T2">
     <table class="ltx_tabular ltx_centering ltx_align_middle" id="S5.T2.4">
      <tr class="ltx_tr" id="S5.T2.4.5">
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.5.1" rowspan="2">
        <span class="ltx_text" id="S5.T2.4.5.1.1">
         Methods
        </span>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S5.T2.4.5.2">
        Character
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S5.T2.4.5.3">
        Knowledge
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S5.T2.4.5.4">
        Dialogue
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.5.5" rowspan="2">
        <span class="ltx_text" id="S5.T2.4.5.5.1">
         AVG
        </span>
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.4.6">
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.1">
        CB
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.2">
        CU
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.3">
        VK
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.4">
        RK
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.5">
        HK
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.6">
        Rel
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.4.6.7">
        Stab
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.4.7">
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.1">
        LoRA
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.2">
        5.71
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.3">
        4.46
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.4">
        5.55
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.5">
        6.29
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.6">
        6.42
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.7">
        6.5
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.8">
        3.44
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.4.7.9">
        5.48
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.1.1">
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.1">
        <math alttext="\text{LLaMA-chat}_{rag}" class="ltx_Math" display="inline" id="S5.T2.1.1.1.m1.1">
         <semantics id="S5.T2.1.1.1.m1.1a">
          <msub id="S5.T2.1.1.1.m1.1.1" xref="S5.T2.1.1.1.m1.1.1.cmml">
           <mtext id="S5.T2.1.1.1.m1.1.1.2" xref="S5.T2.1.1.1.m1.1.1.2a.cmml">
            LLaMA-chat
           </mtext>
           <mrow id="S5.T2.1.1.1.m1.1.1.3" xref="S5.T2.1.1.1.m1.1.1.3.cmml">
            <mi id="S5.T2.1.1.1.m1.1.1.3.2" xref="S5.T2.1.1.1.m1.1.1.3.2.cmml">
             r
            </mi>
            <mo id="S5.T2.1.1.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T2.1.1.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.1.1.1.m1.1.1.3.3" xref="S5.T2.1.1.1.m1.1.1.3.3.cmml">
             a
            </mi>
            <mo id="S5.T2.1.1.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T2.1.1.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.1.1.1.m1.1.1.3.4" xref="S5.T2.1.1.1.m1.1.1.3.4.cmml">
             g
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T2.1.1.1.m1.1b">
           <apply id="S5.T2.1.1.1.m1.1.1.cmml" xref="S5.T2.1.1.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T2.1.1.1.m1.1.1.1.cmml" xref="S5.T2.1.1.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T2.1.1.1.m1.1.1.2a.cmml" xref="S5.T2.1.1.1.m1.1.1.2">
             <mtext id="S5.T2.1.1.1.m1.1.1.2.cmml" xref="S5.T2.1.1.1.m1.1.1.2">
              LLaMA-chat
             </mtext>
            </ci>
            <apply id="S5.T2.1.1.1.m1.1.1.3.cmml" xref="S5.T2.1.1.1.m1.1.1.3">
             <times id="S5.T2.1.1.1.m1.1.1.3.1.cmml" xref="S5.T2.1.1.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T2.1.1.1.m1.1.1.3.2.cmml" xref="S5.T2.1.1.1.m1.1.1.3.2">
              𝑟
             </ci>
             <ci id="S5.T2.1.1.1.m1.1.1.3.3.cmml" xref="S5.T2.1.1.1.m1.1.1.3.3">
              𝑎
             </ci>
             <ci id="S5.T2.1.1.1.m1.1.1.3.4.cmml" xref="S5.T2.1.1.1.m1.1.1.3.4">
              𝑔
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T2.1.1.1.m1.1c">
           \text{LLaMA-chat}_{rag}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.2">
        5.80
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.3">
        5.86
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.4">
        5.05
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.5">
        5.47
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.6">
        6.35
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.7">
        6.26
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.8">
        3.03
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.1.1.9">
        5.40
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.2.2">
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.1">
        <math alttext="\text{LLaMA-chat}_{icl}" class="ltx_Math" display="inline" id="S5.T2.2.2.1.m1.1">
         <semantics id="S5.T2.2.2.1.m1.1a">
          <msub id="S5.T2.2.2.1.m1.1.1" xref="S5.T2.2.2.1.m1.1.1.cmml">
           <mtext id="S5.T2.2.2.1.m1.1.1.2" xref="S5.T2.2.2.1.m1.1.1.2a.cmml">
            LLaMA-chat
           </mtext>
           <mrow id="S5.T2.2.2.1.m1.1.1.3" xref="S5.T2.2.2.1.m1.1.1.3.cmml">
            <mi id="S5.T2.2.2.1.m1.1.1.3.2" xref="S5.T2.2.2.1.m1.1.1.3.2.cmml">
             i
            </mi>
            <mo id="S5.T2.2.2.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T2.2.2.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.2.2.1.m1.1.1.3.3" xref="S5.T2.2.2.1.m1.1.1.3.3.cmml">
             c
            </mi>
            <mo id="S5.T2.2.2.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T2.2.2.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.2.2.1.m1.1.1.3.4" xref="S5.T2.2.2.1.m1.1.1.3.4.cmml">
             l
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T2.2.2.1.m1.1b">
           <apply id="S5.T2.2.2.1.m1.1.1.cmml" xref="S5.T2.2.2.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T2.2.2.1.m1.1.1.1.cmml" xref="S5.T2.2.2.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T2.2.2.1.m1.1.1.2a.cmml" xref="S5.T2.2.2.1.m1.1.1.2">
             <mtext id="S5.T2.2.2.1.m1.1.1.2.cmml" xref="S5.T2.2.2.1.m1.1.1.2">
              LLaMA-chat
             </mtext>
            </ci>
            <apply id="S5.T2.2.2.1.m1.1.1.3.cmml" xref="S5.T2.2.2.1.m1.1.1.3">
             <times id="S5.T2.2.2.1.m1.1.1.3.1.cmml" xref="S5.T2.2.2.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T2.2.2.1.m1.1.1.3.2.cmml" xref="S5.T2.2.2.1.m1.1.1.3.2">
              𝑖
             </ci>
             <ci id="S5.T2.2.2.1.m1.1.1.3.3.cmml" xref="S5.T2.2.2.1.m1.1.1.3.3">
              𝑐
             </ci>
             <ci id="S5.T2.2.2.1.m1.1.1.3.4.cmml" xref="S5.T2.2.2.1.m1.1.1.3.4">
              𝑙
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T2.2.2.1.m1.1c">
           \text{LLaMA-chat}_{icl}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.2">
        5.90
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.3">
        <span class="ltx_text ltx_font_bold" id="S5.T2.2.2.3.1">
         6.02
        </span>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.4">
        4.94
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.5">
        6.07
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.6">
        <span class="ltx_text ltx_font_bold" id="S5.T2.2.2.6.1">
         6.44
        </span>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.7">
        6.35
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.8">
        2.98
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.2.2.9">
        5.53
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.3.3">
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.1">
        <math alttext="\text{Neeko}_{fus}" class="ltx_Math" display="inline" id="S5.T2.3.3.1.m1.1">
         <semantics id="S5.T2.3.3.1.m1.1a">
          <msub id="S5.T2.3.3.1.m1.1.1" xref="S5.T2.3.3.1.m1.1.1.cmml">
           <mtext id="S5.T2.3.3.1.m1.1.1.2" xref="S5.T2.3.3.1.m1.1.1.2a.cmml">
            Neeko
           </mtext>
           <mrow id="S5.T2.3.3.1.m1.1.1.3" xref="S5.T2.3.3.1.m1.1.1.3.cmml">
            <mi id="S5.T2.3.3.1.m1.1.1.3.2" xref="S5.T2.3.3.1.m1.1.1.3.2.cmml">
             f
            </mi>
            <mo id="S5.T2.3.3.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T2.3.3.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.3.3.1.m1.1.1.3.3" xref="S5.T2.3.3.1.m1.1.1.3.3.cmml">
             u
            </mi>
            <mo id="S5.T2.3.3.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T2.3.3.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.3.3.1.m1.1.1.3.4" xref="S5.T2.3.3.1.m1.1.1.3.4.cmml">
             s
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T2.3.3.1.m1.1b">
           <apply id="S5.T2.3.3.1.m1.1.1.cmml" xref="S5.T2.3.3.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T2.3.3.1.m1.1.1.1.cmml" xref="S5.T2.3.3.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T2.3.3.1.m1.1.1.2a.cmml" xref="S5.T2.3.3.1.m1.1.1.2">
             <mtext id="S5.T2.3.3.1.m1.1.1.2.cmml" xref="S5.T2.3.3.1.m1.1.1.2">
              Neeko
             </mtext>
            </ci>
            <apply id="S5.T2.3.3.1.m1.1.1.3.cmml" xref="S5.T2.3.3.1.m1.1.1.3">
             <times id="S5.T2.3.3.1.m1.1.1.3.1.cmml" xref="S5.T2.3.3.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T2.3.3.1.m1.1.1.3.2.cmml" xref="S5.T2.3.3.1.m1.1.1.3.2">
              𝑓
             </ci>
             <ci id="S5.T2.3.3.1.m1.1.1.3.3.cmml" xref="S5.T2.3.3.1.m1.1.1.3.3">
              𝑢
             </ci>
             <ci id="S5.T2.3.3.1.m1.1.1.3.4.cmml" xref="S5.T2.3.3.1.m1.1.1.3.4">
              𝑠
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T2.3.3.1.m1.1c">
           \text{Neeko}_{fus}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.2">
        <span class="ltx_text ltx_font_bold" id="S5.T2.3.3.2.1">
         6.30
        </span>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.3">
        4.27
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.4">
        <span class="ltx_text ltx_font_bold" id="S5.T2.3.3.4.1">
         5.64
        </span>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.5">
        6.38
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.6">
        6.27
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.7">
        6.69
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.8">
        <span class="ltx_text ltx_font_bold" id="S5.T2.3.3.8.1">
         3.55
        </span>
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T2.3.3.9">
        5.57
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T2.4.4">
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.1">
        <math alttext="\text{Neeko}_{exp}" class="ltx_Math" display="inline" id="S5.T2.4.4.1.m1.1">
         <semantics id="S5.T2.4.4.1.m1.1a">
          <msub id="S5.T2.4.4.1.m1.1.1" xref="S5.T2.4.4.1.m1.1.1.cmml">
           <mtext id="S5.T2.4.4.1.m1.1.1.2" xref="S5.T2.4.4.1.m1.1.1.2a.cmml">
            Neeko
           </mtext>
           <mrow id="S5.T2.4.4.1.m1.1.1.3" xref="S5.T2.4.4.1.m1.1.1.3.cmml">
            <mi id="S5.T2.4.4.1.m1.1.1.3.2" xref="S5.T2.4.4.1.m1.1.1.3.2.cmml">
             e
            </mi>
            <mo id="S5.T2.4.4.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T2.4.4.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.4.4.1.m1.1.1.3.3" xref="S5.T2.4.4.1.m1.1.1.3.3.cmml">
             x
            </mi>
            <mo id="S5.T2.4.4.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T2.4.4.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T2.4.4.1.m1.1.1.3.4" xref="S5.T2.4.4.1.m1.1.1.3.4.cmml">
             p
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T2.4.4.1.m1.1b">
           <apply id="S5.T2.4.4.1.m1.1.1.cmml" xref="S5.T2.4.4.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T2.4.4.1.m1.1.1.1.cmml" xref="S5.T2.4.4.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T2.4.4.1.m1.1.1.2a.cmml" xref="S5.T2.4.4.1.m1.1.1.2">
             <mtext id="S5.T2.4.4.1.m1.1.1.2.cmml" xref="S5.T2.4.4.1.m1.1.1.2">
              Neeko
             </mtext>
            </ci>
            <apply id="S5.T2.4.4.1.m1.1.1.3.cmml" xref="S5.T2.4.4.1.m1.1.1.3">
             <times id="S5.T2.4.4.1.m1.1.1.3.1.cmml" xref="S5.T2.4.4.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T2.4.4.1.m1.1.1.3.2.cmml" xref="S5.T2.4.4.1.m1.1.1.3.2">
              𝑒
             </ci>
             <ci id="S5.T2.4.4.1.m1.1.1.3.3.cmml" xref="S5.T2.4.4.1.m1.1.1.3.3">
              𝑥
             </ci>
             <ci id="S5.T2.4.4.1.m1.1.1.3.4.cmml" xref="S5.T2.4.4.1.m1.1.1.3.4">
              𝑝
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T2.4.4.1.m1.1c">
           \text{Neeko}_{exp}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.2">
        6.09
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.3">
        4.83
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.4">
        5.61
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.5">
        <span class="ltx_text ltx_font_bold" id="S5.T2.4.4.5.1">
         6.51
        </span>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.6">
        <span class="ltx_text ltx_font_bold" id="S5.T2.4.4.6.1">
         6.44
        </span>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.7">
        <span class="ltx_text ltx_font_bold" id="S5.T2.4.4.7.1">
         6.73
        </span>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.8">
        3.18
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T2.4.4.9">
        <span class="ltx_text ltx_font_bold" id="S5.T2.4.4.9.1">
         5.62
        </span>
       </td>
      </tr>
     </table>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_table">
       Table 2:
      </span>
      Comparison results between Neeko and recent role-playing methods on Character-LLM-Data, comprising both single-turn and multi-turn dialogues.
     </figcaption>
    </figure>
    <figure class="ltx_figure" id="S5.F2">
     <img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="163" id="S5.F2.g1" src="/html/2402.13717/assets/x2.png" width="461"/>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_figure">
       Figure 2:
      </span>
      Evaluation results across distinct dimensions at the incremental stage. We evaluate and conduct horizontal comparisons among FT (LoRA, Neeko), ICL (LLaMA-chat), and RAG (LLaMA-chat) methods under the 7B parameter scale setting.
     </figcaption>
    </figure>
   </section>
  </section>
  <section class="ltx_subsection" id="S5.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     5.3
    </span>
    Results
   </h3>
   <section class="ltx_paragraph" id="S5.SS3.SSS0.Px1">
    <h4 class="ltx_title ltx_title_paragraph">
     Pre-Training Results (RQ1).
    </h4>
    <div class="ltx_para" id="S5.SS3.SSS0.Px1.p1">
     <p class="ltx_p" id="S5.SS3.SSS0.Px1.p1.1">
      To answer RQ1, we evaluate the multi-character role-playing performance of single-turn and multi-turn dialogues for Neeko and baselines.
We present the average performance on both multi-turn and single-turn dialogues in Table
      <a class="ltx_ref" href="#S4.T1" title="Table 1 ‣ 4.3 Dialogue Consistency ‣ 4 Evaluation Metrics ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        1
       </span>
      </a>
      since they exhibit high similarity in terms of all metrics.
From the results, we observe that RAG-based methods exhibit poor performance in MCRP tasks.
We hypothesize that this is due to the coarse-grained nature of the information retrieved by RAG-based methods, whereas role-playing requires fine-grained details such as tone and catchphrases.
GPT3.5 performs exceptionally well in the Knowledge Consistency metric.
We attribute this to its large parameter size, which supports its superior performance in terms of knowledge.
This observation aligns with previous studies
      <cite class="ltx_cite ltx_citemacro_citep">
       (Geva et al.,
       <a class="ltx_ref" href="#bib.bib6" title="">
        2020
       </a>
       ; Wei et al.,
       <a class="ltx_ref" href="#bib.bib23" title="">
        2023
       </a>
       )
      </cite>
      .
Neeko achieves the best stability score, which can be attributed to the fact that the features of each character are distributed across their individual LoRA blocks.
In addition, Character-LLM and Neeko demonstrate the best and second-best overall (AVG) performance, respectively.
      <span class="ltx_text ltx_font_bold" id="S5.SS3.SSS0.Px1.p1.1.1">
       The observed results suggest that methods relying on fine-tuning are better suited for role-playing tasks.
      </span>
      Furthermore, we note that Neeko achieves comparable performance to Character-LLM, which requires training a dedicated agent for each character.
An interesting discovery is that LLaMA-chat utilizes emojis and actions in role-playing, resulting in achieving the highest scores on PU.
In contrast, GPT-3.5 and the backbone LLaMA used by Neeko lack this capability.
This finding suggests that in the future, using Chat versions of LLMs in role-playing tasks will yield more lifelike effects.
The dialogue examples of LLaMA-chat can be found in Appendix
      <a class="ltx_ref" href="#A2.SS2" title="B.2 Case Study ‣ Appendix B Dataset Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        B.2
       </span>
      </a>
      .
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S5.SS3.SSS0.Px2">
    <h4 class="ltx_title ltx_title_paragraph">
     Incremental Results (RQ2).
    </h4>
    <div class="ltx_para" id="S5.SS3.SSS0.Px2.p1">
     <p class="ltx_p" id="S5.SS3.SSS0.Px2.p1.1">
      To answer RQ2, we evaluate the incremental capability of the models by asking different baselines to portray newly added characters.
Table
      <a class="ltx_ref" href="#S5.T2" title="Table 2 ‣ ICL-based and RAG-based. ‣ 5.2 Implementation Details and Baselines ‣ 5 Experiments ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        2
       </span>
      </a>
      illustrates the incremental performance of baseline methods with the same parameter scale.
Compared to other baselines, Neeko achieves the best and second-best average performance with the proposed expansion and fusion strategy on MCRP, respectively.
It is worth mentioning that,
      <math alttext="\text{Neeko}_{fus}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px2.p1.1.m1.1">
       <semantics id="S5.SS3.SSS0.Px2.p1.1.m1.1a">
        <msub id="S5.SS3.SSS0.Px2.p1.1.m1.1.1" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.cmml">
         <mtext id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2a.cmml">
          Neeko
         </mtext>
         <mrow id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.cmml">
          <mi id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.2" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.2.cmml">
           f
          </mi>
          <mo id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.3" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.3.cmml">
           u
          </mi>
          <mo id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1.cmml">
           ​
          </mo>
          <mi id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.4" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.4.cmml">
           s
          </mi>
         </mrow>
        </msub>
        <annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px2.p1.1.m1.1b">
         <apply id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1">
          <csymbol cd="ambiguous" id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1">
           subscript
          </csymbol>
          <ci id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2a.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2">
           <mtext id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.2">
            Neeko
           </mtext>
          </ci>
          <apply id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3">
           <times id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.1">
           </times>
           <ci id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.2.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.2">
            𝑓
           </ci>
           <ci id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.3.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.3">
            𝑢
           </ci>
           <ci id="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.4.cmml" xref="S5.SS3.SSS0.Px2.p1.1.m1.1.1.3.4">
            𝑠
           </ci>
          </apply>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px2.p1.1.m1.1c">
         \text{Neeko}_{fus}
        </annotation>
       </semantics>
      </math>
      does not require additional data for incremental learning, which can lead to a performance drop in the CU metric.
When comparing the baseline LoRA model with our proposed expansion strategy, both of which require incremental data, we observe that LoRA exhibits poor performance.
This could be attributed to the tuning of new characters leading to the forgetting of previous character features.
We also observe that LLaMA-based baselines perform poorly on the Knowledge metric, particularly VK.
These results indicate that non-gradient methods face challenges in learning new character knowledge.
Figure
      <a class="ltx_ref" href="#S5.F2" title="Figure 2 ‣ ICL-based and RAG-based. ‣ 5.2 Implementation Details and Baselines ‣ 5 Experiments ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        2
       </span>
      </a>
      illustrates the overall performance advancement of Neeko compared to other baseline methods across all evaluation metrics.
More incremental details can refer to Appendix
      <a class="ltx_ref" href="#A1.SS2" title="A.2 Incremental Setting ‣ Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        A.2
       </span>
      </a>
      .
     </p>
    </div>
   </section>
   <section class="ltx_paragraph" id="S5.SS3.SSS0.Px3">
    <h4 class="ltx_title ltx_title_paragraph">
     Transfer Results (RQ3).
    </h4>
    <div class="ltx_para" id="S5.SS3.SSS0.Px3.p1">
     <p class="ltx_p" id="S5.SS3.SSS0.Px3.p1.1">
      To answer RQ3, we adapt samples from the Character-LLM-Data (details of data constructing can refer to
      <a class="ltx_ref" href="#A2.SS1" title="B.1 Transfer Data ‣ Appendix B Dataset Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        B.1
       </span>
      </a>
      ) and task role-playing agents with switching between different characters in each round of conversation.
As shown in Table
      <a class="ltx_ref" href="#S5.T3" title="Table 3 ‣ Transfer Results (RQ3). ‣ 5.3 Results ‣ 5 Experiments ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        3
       </span>
      </a>
      , under the same parameter setting, Neeko outperforms all baseline methods.
In contrast,
      <span class="ltx_text ltx_font_bold" id="S5.SS3.SSS0.Px3.p1.1.1">
       ICL and RAG struggle to achieve character transformation through new role instructions and retrieval content due to the influence of dialogue history
      </span>
      .
     </p>
    </div>
    <figure class="ltx_table" id="S5.T3">
     <table class="ltx_tabular ltx_centering ltx_align_middle" id="S5.T3.2">
      <tr class="ltx_tr" id="S5.T3.2.3">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T3.2.3.1">
        Methods
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.2.3.2">
        Transfer
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T3.1.1">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T3.1.1.1">
        <math alttext="\text{LLaMA-chat}_{rag}" class="ltx_Math" display="inline" id="S5.T3.1.1.1.m1.1">
         <semantics id="S5.T3.1.1.1.m1.1a">
          <msub id="S5.T3.1.1.1.m1.1.1" xref="S5.T3.1.1.1.m1.1.1.cmml">
           <mtext id="S5.T3.1.1.1.m1.1.1.2" xref="S5.T3.1.1.1.m1.1.1.2a.cmml">
            LLaMA-chat
           </mtext>
           <mrow id="S5.T3.1.1.1.m1.1.1.3" xref="S5.T3.1.1.1.m1.1.1.3.cmml">
            <mi id="S5.T3.1.1.1.m1.1.1.3.2" xref="S5.T3.1.1.1.m1.1.1.3.2.cmml">
             r
            </mi>
            <mo id="S5.T3.1.1.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T3.1.1.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T3.1.1.1.m1.1.1.3.3" xref="S5.T3.1.1.1.m1.1.1.3.3.cmml">
             a
            </mi>
            <mo id="S5.T3.1.1.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T3.1.1.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T3.1.1.1.m1.1.1.3.4" xref="S5.T3.1.1.1.m1.1.1.3.4.cmml">
             g
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T3.1.1.1.m1.1b">
           <apply id="S5.T3.1.1.1.m1.1.1.cmml" xref="S5.T3.1.1.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T3.1.1.1.m1.1.1.1.cmml" xref="S5.T3.1.1.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T3.1.1.1.m1.1.1.2a.cmml" xref="S5.T3.1.1.1.m1.1.1.2">
             <mtext id="S5.T3.1.1.1.m1.1.1.2.cmml" xref="S5.T3.1.1.1.m1.1.1.2">
              LLaMA-chat
             </mtext>
            </ci>
            <apply id="S5.T3.1.1.1.m1.1.1.3.cmml" xref="S5.T3.1.1.1.m1.1.1.3">
             <times id="S5.T3.1.1.1.m1.1.1.3.1.cmml" xref="S5.T3.1.1.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T3.1.1.1.m1.1.1.3.2.cmml" xref="S5.T3.1.1.1.m1.1.1.3.2">
              𝑟
             </ci>
             <ci id="S5.T3.1.1.1.m1.1.1.3.3.cmml" xref="S5.T3.1.1.1.m1.1.1.3.3">
              𝑎
             </ci>
             <ci id="S5.T3.1.1.1.m1.1.1.3.4.cmml" xref="S5.T3.1.1.1.m1.1.1.3.4">
              𝑔
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T3.1.1.1.m1.1c">
           \text{LLaMA-chat}_{rag}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2">
        5.28
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T3.2.2">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T3.2.2.1">
        <math alttext="\text{LLaMA-chat}_{icl}" class="ltx_Math" display="inline" id="S5.T3.2.2.1.m1.1">
         <semantics id="S5.T3.2.2.1.m1.1a">
          <msub id="S5.T3.2.2.1.m1.1.1" xref="S5.T3.2.2.1.m1.1.1.cmml">
           <mtext id="S5.T3.2.2.1.m1.1.1.2" xref="S5.T3.2.2.1.m1.1.1.2a.cmml">
            LLaMA-chat
           </mtext>
           <mrow id="S5.T3.2.2.1.m1.1.1.3" xref="S5.T3.2.2.1.m1.1.1.3.cmml">
            <mi id="S5.T3.2.2.1.m1.1.1.3.2" xref="S5.T3.2.2.1.m1.1.1.3.2.cmml">
             i
            </mi>
            <mo id="S5.T3.2.2.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="S5.T3.2.2.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T3.2.2.1.m1.1.1.3.3" xref="S5.T3.2.2.1.m1.1.1.3.3.cmml">
             c
            </mi>
            <mo id="S5.T3.2.2.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="S5.T3.2.2.1.m1.1.1.3.1.cmml">
             ​
            </mo>
            <mi id="S5.T3.2.2.1.m1.1.1.3.4" xref="S5.T3.2.2.1.m1.1.1.3.4.cmml">
             l
            </mi>
           </mrow>
          </msub>
          <annotation-xml encoding="MathML-Content" id="S5.T3.2.2.1.m1.1b">
           <apply id="S5.T3.2.2.1.m1.1.1.cmml" xref="S5.T3.2.2.1.m1.1.1">
            <csymbol cd="ambiguous" id="S5.T3.2.2.1.m1.1.1.1.cmml" xref="S5.T3.2.2.1.m1.1.1">
             subscript
            </csymbol>
            <ci id="S5.T3.2.2.1.m1.1.1.2a.cmml" xref="S5.T3.2.2.1.m1.1.1.2">
             <mtext id="S5.T3.2.2.1.m1.1.1.2.cmml" xref="S5.T3.2.2.1.m1.1.1.2">
              LLaMA-chat
             </mtext>
            </ci>
            <apply id="S5.T3.2.2.1.m1.1.1.3.cmml" xref="S5.T3.2.2.1.m1.1.1.3">
             <times id="S5.T3.2.2.1.m1.1.1.3.1.cmml" xref="S5.T3.2.2.1.m1.1.1.3.1">
             </times>
             <ci id="S5.T3.2.2.1.m1.1.1.3.2.cmml" xref="S5.T3.2.2.1.m1.1.1.3.2">
              𝑖
             </ci>
             <ci id="S5.T3.2.2.1.m1.1.1.3.3.cmml" xref="S5.T3.2.2.1.m1.1.1.3.3">
              𝑐
             </ci>
             <ci id="S5.T3.2.2.1.m1.1.1.3.4.cmml" xref="S5.T3.2.2.1.m1.1.1.3.4">
              𝑙
             </ci>
            </apply>
           </apply>
          </annotation-xml>
          <annotation encoding="application/x-tex" id="S5.T3.2.2.1.m1.1c">
           \text{LLaMA-chat}_{icl}
          </annotation>
         </semantics>
        </math>
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.2.2.2">
        5.67
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T3.2.4">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T3.2.4.1">
        LoRA
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.2.4.2">
        5.83
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T3.2.5">
       <td class="ltx_td ltx_align_left ltx_border_b ltx_border_t" id="S5.T3.2.5.1">
        Neeko
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S5.T3.2.5.2">
        <span class="ltx_text ltx_font_bold" id="S5.T3.2.5.2.1">
         5.87
        </span>
       </td>
      </tr>
     </table>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_table">
       Table 3:
      </span>
      Evaluation results of multi-role transfer metric.
     </figcaption>
    </figure>
   </section>
   <section class="ltx_paragraph" id="S5.SS3.SSS0.Px4">
    <h4 class="ltx_title ltx_title_paragraph">
     Consumption Results (RQ4).
    </h4>
    <div class="ltx_para" id="S5.SS3.SSS0.Px4.p1">
     <p class="ltx_p" id="S5.SS3.SSS0.Px4.p1.2">
      To answer RQ4, we list the memory usage and training time of existing methods and the proposed method Neeko Table
      <a class="ltx_ref" href="#S5.T4" title="Table 4 ‣ Consumption Results (RQ4). ‣ 5.3 Results ‣ 5 Experiments ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
       <span class="ltx_text ltx_ref_tag">
        4
       </span>
      </a>
      .
Character-LLM incurs a memory overhead approximately proportional to
      <math alttext="\mathcal{O}(M)" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px4.p1.1.m1.1">
       <semantics id="S5.SS3.SSS0.Px4.p1.1.m1.1a">
        <mrow id="S5.SS3.SSS0.Px4.p1.1.m1.1.2" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.cmml">
         <mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.2" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.2.cmml">
          𝒪
         </mi>
         <mo id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.1" lspace="0em" rspace="0em" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.1.cmml">
          ​
         </mo>
         <mrow id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.3.2" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.cmml">
          <mo id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.3.2.1" stretchy="false" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.cmml">
           (
          </mo>
          <mi id="S5.SS3.SSS0.Px4.p1.1.m1.1.1" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.1.cmml">
           M
          </mi>
          <mo id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.3.2.2" stretchy="false" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.cmml">
           )
          </mo>
         </mrow>
        </mrow>
        <annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px4.p1.1.m1.1b">
         <apply id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.cmml" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2">
          <times id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.1.cmml" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.1">
          </times>
          <ci id="S5.SS3.SSS0.Px4.p1.1.m1.1.2.2.cmml" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.2.2">
           𝒪
          </ci>
          <ci id="S5.SS3.SSS0.Px4.p1.1.m1.1.1.cmml" xref="S5.SS3.SSS0.Px4.p1.1.m1.1.1">
           𝑀
          </ci>
         </apply>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px4.p1.1.m1.1c">
         \mathcal{O}(M)
        </annotation>
       </semantics>
      </math>
      times that of Neeko, where
      <math alttext="M" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px4.p1.2.m2.1">
       <semantics id="S5.SS3.SSS0.Px4.p1.2.m2.1a">
        <mi id="S5.SS3.SSS0.Px4.p1.2.m2.1.1" xref="S5.SS3.SSS0.Px4.p1.2.m2.1.1.cmml">
         M
        </mi>
        <annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px4.p1.2.m2.1b">
         <ci id="S5.SS3.SSS0.Px4.p1.2.m2.1.1.cmml" xref="S5.SS3.SSS0.Px4.p1.2.m2.1.1">
          𝑀
         </ci>
        </annotation-xml>
        <annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px4.p1.2.m2.1c">
         M
        </annotation>
       </semantics>
      </math>
      denotes the number of characters.
Neeko’s memory usage and training time are close to LoRA, much better than Character-LLM.
     </p>
    </div>
    <figure class="ltx_table" id="S5.T4">
     <table class="ltx_tabular ltx_centering ltx_align_middle" id="S5.T4.1">
      <tr class="ltx_tr" id="S5.T4.1.1">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T4.1.1.1">
        Methods
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.2">
        Agent Memory
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.3">
        Time
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T4.1.2">
       <td class="ltx_td ltx_align_left ltx_border_t" id="S5.T4.1.2.1">
        Character-LLM
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.2.2">
        107.84 GB
       </td>
       <td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.2.3">
        48.55 h
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T4.1.3">
       <td class="ltx_td ltx_align_left" id="S5.T4.1.3.1">
        LoRA
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T4.1.3.2">
        13.49 GB
       </td>
       <td class="ltx_td ltx_align_center" id="S5.T4.1.3.3">
        1.72 h
       </td>
      </tr>
      <tr class="ltx_tr" id="S5.T4.1.4">
       <td class="ltx_td ltx_align_left ltx_border_b" id="S5.T4.1.4.1">
        Neeko
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T4.1.4.2">
        13.55 GB
       </td>
       <td class="ltx_td ltx_align_center ltx_border_b" id="S5.T4.1.4.3">
        2.01 h
       </td>
      </tr>
     </table>
     <figcaption class="ltx_caption ltx_centering">
      <span class="ltx_tag ltx_tag_table">
       Table 4:
      </span>
      The comparison of training time and agent memory size for FT-based methods.
     </figcaption>
    </figure>
   </section>
  </section>
 </section>
 <section class="ltx_section" id="S6">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    6
   </span>
   Related Work
  </h2>
  <div class="ltx_para" id="S6.p1">
   <p class="ltx_p" id="S6.p1.1">
    Recent efforts in the field of Natural Language Processing, especially LLMs, have focused on exploring the ability to act as role-playing agents
    <cite class="ltx_cite ltx_citemacro_citep">
     (Si et al.,
     <a class="ltx_ref" href="#bib.bib18" title="">
      2021
     </a>
     ; Majumder et al.,
     <a class="ltx_ref" href="#bib.bib14" title="">
      2021
     </a>
     )
    </cite>
    .
One of the works in role-playing area is RoleBench
    <cite class="ltx_cite ltx_citemacro_citep">
     (Wang et al.,
     <a class="ltx_ref" href="#bib.bib22" title="">
      2023
     </a>
     )
    </cite>
    , which introduces a bilingual role-playing dataset with 100 roles, and it employs Rouge-L
    <cite class="ltx_cite ltx_citemacro_citep">
     (Lin,
     <a class="ltx_ref" href="#bib.bib11" title="">
      2004
     </a>
     )
    </cite>
    for evaluation by comparing model-generated responses with reference answers and calculating corresponding scores.
However, their evaluation is predominantly conducted on models after supervised fine-tuning. This approach does not incorporate direct feedback from pretrained foundational models, which can offer critical insights into their intrinsic role-playing capabilities and limitations.
On the other hand, existing evaluations largely rely on outputs from humans
    <cite class="ltx_cite ltx_citemacro_citep">
     (Han et al.,
     <a class="ltx_ref" href="#bib.bib7" title="">
      2022
     </a>
     ; Zhao et al.,
     <a class="ltx_ref" href="#bib.bib27" title="">
      2023
     </a>
     )
    </cite>
    . However, human evaluation lacks reproducibility.
This leads to a lack of objective, accurate, and systematic knowledge assessments.
To address this issue, some efforts attempt to leverage LLMs such as GPT-4 as evaluators
    <cite class="ltx_cite ltx_citemacro_citep">
     (Shen et al.,
     <a class="ltx_ref" href="#bib.bib17" title="">
      2023
     </a>
     ; Chen et al.,
     <a class="ltx_ref" href="#bib.bib2" title="">
      2023a
     </a>
     ; Tu et al.,
     <a class="ltx_ref" href="#bib.bib20" title="">
      2024
     </a>
     )
    </cite>
    .
Many subsequent works have used above metrics to evaluate their models.
Particularly relevant to our work are role-playing learning that attempt to model and stay consistent with an agent’s persona, such as Character-LLM, CharacterGLM, and RoleLLM
    <cite class="ltx_cite ltx_citemacro_citep">
     (Shao et al.,
     <a class="ltx_ref" href="#bib.bib16" title="">
      2023
     </a>
     ; Zhou et al.,
     <a class="ltx_ref" href="#bib.bib28" title="">
      2023
     </a>
     ; Wang et al.,
     <a class="ltx_ref" href="#bib.bib22" title="">
      2023
     </a>
     ; Li et al.,
     <a class="ltx_ref" href="#bib.bib10" title="">
      2023
     </a>
     )
    </cite>
    .
These approaches primarily rely on fine-tuning, in-context learning, and retrieval-enhanced generation approaches to simulate the intricate nature of character personalities and behaviors in role-playing scenarios.
None of these works, however, have any notion of multi-role playing, often utilizing multiple agents rather than one to mimic different characters.
   </p>
  </div>
 </section>
 <section class="ltx_section" id="S7">
  <h2 class="ltx_title ltx_title_section">
   <span class="ltx_tag ltx_tag_section">
    7
   </span>
   Conclusion
  </h2>
  <div class="ltx_para" id="S7.p1">
   <p class="ltx_p" id="S7.p1.1">
    In this paper, we introduce a novel task called Multi-Character Role-Playing (MCPR) and present Neeko as the first agent designed for this task.
Neeko utilizes a dynamic gating network to precisely activate role-specific LoRA blocks, enabling it to accurately assume designated characters.
Additionally, Neeko demonstrates proficiency in handling unseen and novel characters through the fusion and expansion strategies proposed in this work.
Furthermore, we propose a comprehensive evaluation metric specifically tailored for assessing the performance of role-playing agents.
Through extensive experiments conducted in both offline and incremental settings, our approach consistently outperforms existing methods, showcasing the superiority of our framework and its potential to advance the field of role-playing agents.
   </p>
  </div>
 </section>
 <section class="ltx_section" id="Sx1">
  <h2 class="ltx_title ltx_title_section">
   Limitations
  </h2>
  <div class="ltx_para" id="Sx1.p1">
   <p class="ltx_p" id="Sx1.p1.1">
    The designed MoE-like (Mixture of Experts) gate mechanism in Neeko aims to select the appropriate LoRA block for role-playing.
However, the calculation of role embedding is based on the profile of each role, which may result in less precise representations of roles.
This can potentially accumulate errors and affect the overall performance of the agent.
As a consideration for future work, it would be beneficial to explore and employ more precise role-learning methods.
   </p>
  </div>
 </section>
 <section class="ltx_bibliography" id="bib">
  <h2 class="ltx_title ltx_title_bibliography">
   References
  </h2>
  <ul class="ltx_biblist">
   <li class="ltx_bibitem" id="bib.bib1">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Aghajanyan et al. (2020)
    </span>
    <span class="ltx_bibblock">
     Armen Aghajanyan, Luke Zettlemoyer, and Sonal Gupta. 2020.
    </span>
    <span class="ltx_bibblock">
     Intrinsic dimensionality explains the effectiveness of language model fine-tuning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">
      arXiv preprint arXiv:2012.13255
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib2">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Chen et al. (2023a)
    </span>
    <span class="ltx_bibblock">
     Nuo Chen, Yan Wang, Haiyun Jiang, Deng Cai, Yuhan Li, Ziyang Chen, Longyue Wang, and Jia Li. 2023a.
    </span>
    <span class="ltx_bibblock">
     Large language models meet harry potter: A dataset for aligning dialogue agents with characters.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">
      Findings of the Association for Computational Linguistics: EMNLP 2023
     </em>
     , pages 8506–8520.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib3">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Chen et al. (2023b)
    </span>
    <span class="ltx_bibblock">
     Wuyang Chen, Yanqi Zhou, Nan Du, Yanping Huang, James Laudon, Zhifeng Chen, and Claire Cui. 2023b.
    </span>
    <span class="ltx_bibblock">
     Lifelong language pretraining with distribution-specialized experts.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">
      International Conference on Machine Learning
     </em>
     , pages 5383–5395. PMLR.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib4">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Cortes et al. (2017)
    </span>
    <span class="ltx_bibblock">
     Corinna Cortes, Xavier Gonzalvo, Vitaly Kuznetsov, Mehryar Mohri, and Scott Yang. 2017.
    </span>
    <span class="ltx_bibblock">
     Adanet: Adaptive structural learning of artificial neural networks.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">
      International conference on machine learning
     </em>
     , pages 874–883. PMLR.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib5">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Eigen et al. (2013)
    </span>
    <span class="ltx_bibblock">
     David Eigen, Marc’Aurelio Ranzato, and Ilya Sutskever. 2013.
    </span>
    <span class="ltx_bibblock">
     Learning factored representations in a deep mixture of experts.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">
      arXiv preprint arXiv:1312.4314
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib6">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Geva et al. (2020)
    </span>
    <span class="ltx_bibblock">
     Mor Geva, Roei Schuster, Jonathan Berant, and Omer Levy. 2020.
    </span>
    <span class="ltx_bibblock">
     Transformer feed-forward layers are key-value memories.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">
      arXiv preprint arXiv:2012.14913
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib7">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Han et al. (2022)
    </span>
    <span class="ltx_bibblock">
     Seungju Han, Beomsu Kim, Jin Yong Yoo, Seokjun Seo, Sangbum Kim, Enkhbayar Erdenee, and Buru Chang. 2022.
    </span>
    <span class="ltx_bibblock">
     Meet your favorite character: Open-domain chatbot mimicking fictional characters with only a few utterances.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">
      arXiv preprint arXiv:2204.10825
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib8">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Hu et al. (2021)
    </span>
    <span class="ltx_bibblock">
     Edward J Hu, Yelong Shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean Wang, Lu Wang, and Weizhu Chen. 2021.
    </span>
    <span class="ltx_bibblock">
     Lora: Low-rank adaptation of large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">
      arXiv preprint arXiv:2106.09685
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib9">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Huang et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Chengsong Huang, Qian Liu, Bill Yuchen Lin, Tianyu Pang, Chao Du, and Min Lin. 2023.
    </span>
    <span class="ltx_bibblock">
     Lorahub: Efficient cross-task generalization via dynamic lora composition.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">
      arXiv preprint arXiv:2307.13269
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib10">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Li et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Cheng Li, Ziang Leng, Chenxi Yan, Junyi Shen, Hao Wang, Weishi MI, Yaying Fei, Xiaoyang Feng, Song Yan, HaoSheng Wang, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Chatharuhi: Reviving anime character in reality via large language model.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">
      arXiv preprint arXiv:2308.09597
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib11">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Lin (2004)
    </span>
    <span class="ltx_bibblock">
     Chin-Yew Lin. 2004.
    </span>
    <span class="ltx_bibblock">
     Rouge: A package for automatic evaluation of summaries.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">
      Text summarization branches out
     </em>
     , pages 74–81.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib12">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Liu et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Qidong Liu, Xian Wu, Xiangyu Zhao, Yuanshao Zhu, Derong Xu, Feng Tian, and Yefeng Zheng. 2023.
    </span>
    <span class="ltx_bibblock">
     Moelora: An moe-based parameter efficient fine-tuning method for multi-task medical applications.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">
      arXiv preprint arXiv:2310.18339
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib13">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Luo et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Tongxu Luo, Jiahe Lei, Fangyu Lei, Weihao Liu, Shizhu He, Jun Zhao, and Kang Liu. 2024.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_href" href="http://arxiv.org/abs/2402.12851" target="_blank" title="">
      Moelora: Contrastive learning guided mixture of experts on parameter-efficient fine-tuning for large language models
     </a>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib14">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Majumder et al. (2021)
    </span>
    <span class="ltx_bibblock">
     Bodhisattwa Prasad Majumder, Taylor Berg-Kirkpatrick, Julian McAuley, and Harsh Jhamtani. 2021.
    </span>
    <span class="ltx_bibblock">
     Unsupervised enrichment of persona-grounded dialog with background stories.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">
      arXiv preprint arXiv:2106.08364
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib15">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     OpenAI (2023)
    </span>
    <span class="ltx_bibblock">
     OpenAI. 2023.
    </span>
    <span class="ltx_bibblock">
     <a class="ltx_ref ltx_href" href="https://openai.com/blog/chatgpt/" target="_blank" title="">
      Chatgpt: Optimizing language models for dialogue
     </a>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib16">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Shao et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Yunfan Shao, Linyang Li, Junqi Dai, and Xipeng Qiu. 2023.
    </span>
    <span class="ltx_bibblock">
     Character-llm: A trainable agent for role-playing.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">
      arXiv preprint arXiv:2310.10158
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib17">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Shen et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Tianhao Shen, Sun Li, and Deyi Xiong. 2023.
    </span>
    <span class="ltx_bibblock">
     Roleeval: A bilingual role evaluation benchmark for large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">
      arXiv preprint arXiv:2312.16132
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib18">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Si et al. (2021)
    </span>
    <span class="ltx_bibblock">
     Wai Man Si, Prithviraj Ammanabrolu, and Mark O Riedl. 2021.
    </span>
    <span class="ltx_bibblock">
     Telling stories through multi-user dialogue by modeling character relations.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">
      arXiv preprint arXiv:2105.15054
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib19">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Touvron et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Llama 2: Open foundation and fine-tuned chat models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">
      arXiv preprint arXiv:2307.09288
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib20">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Tu et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Quan Tu, Shilong Fan, Zihang Tian, and Rui Yan. 2024.
    </span>
    <span class="ltx_bibblock">
     Charactereval: A chinese benchmark for role-playing conversational agent evaluation.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">
      arXiv preprint arXiv:2401.01275
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib21">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Valipour et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Mojtaba Valipour, Mehdi Rezagholizadeh, Ivan Kobyzev, and Ali Ghodsi. 2023.
    </span>
    <span class="ltx_bibblock">
     Dylora: Parameter-efficient tuning of pre-trained models using dynamic search-free low-rank adaptation.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">
      Proceedings of the 17th Conference of the European Chapter of the Association for Computational Linguistics
     </em>
     , pages 3266–3279.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib22">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wang et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Zekun Moore Wang, Zhongyuan Peng, Haoran Que, Jiaheng Liu, Wangchunshu Zhou, Yuhan Wu, Hongcheng Guo, Ruitong Gan, Zehao Ni, Man Zhang, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Rolellm: Benchmarking, eliciting, and enhancing role-playing abilities of large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">
      arXiv preprint arXiv:2310.00746
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib23">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Wei et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Yifan Wei, Xiaoyan Yu, Huanhuan Ma, Fangyu Lei, Yixuan Weng, Ran Song, and Kang Liu. 2023.
    </span>
    <span class="ltx_bibblock">
     Assessing knowledge editing in language models via relation perspective.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">
      arXiv preprint arXiv:2311.09053
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib24">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Ye and Bors (2023)
    </span>
    <span class="ltx_bibblock">
     Fei Ye and Adrian G Bors. 2023.
    </span>
    <span class="ltx_bibblock">
     Lifelong compression mixture model via knowledge relationship graph.
    </span>
    <span class="ltx_bibblock">
     In
     <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">
      Proceedings of the AAAI Conference on Artificial Intelligence
     </em>
     , volume 37, pages 10900–10908.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib25">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Yu et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Lang Yu, Qin Chen, Jie Zhou, and Liang He. 2023.
    </span>
    <span class="ltx_bibblock">
     Melo: Enhancing model editing with neuron-indexed dynamic lora.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">
      arXiv preprint arXiv:2312.11795
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib26">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zhang et al. (2024)
    </span>
    <span class="ltx_bibblock">
     Jie Zhang, Wentao Fan, and Xin Liu. 2024.
    </span>
    <span class="ltx_bibblock">
     Spiking generative networks empowered by multiple dynamic experts for lifelong learning.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">
      Expert Systems with Applications
     </em>
     , 238:121845.
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib27">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zhao et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Runcong Zhao, Wenjia Zhang, Jiazheng Li, Lixing Zhu, Yanran Li, Yulan He, and Lin Gui. 2023.
    </span>
    <span class="ltx_bibblock">
     Narrativeplay: Interactive narrative understanding.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">
      arXiv preprint arXiv:2310.01459
     </em>
     .
    </span>
   </li>
   <li class="ltx_bibitem" id="bib.bib28">
    <span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">
     Zhou et al. (2023)
    </span>
    <span class="ltx_bibblock">
     Jinfeng Zhou, Zhuang Chen, Dazhen Wan, Bosi Wen, Yi Song, Jifan Yu, Yongkang Huang, Libiao Peng, Jiaming Yang, Xiyao Xiao, et al. 2023.
    </span>
    <span class="ltx_bibblock">
     Characterglm: Customizing chinese conversational ai characters with large language models.
    </span>
    <span class="ltx_bibblock">
     <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">
      arXiv preprint arXiv:2311.16832
     </em>
     .
    </span>
   </li>
  </ul>
 </section>
 <section class="ltx_appendix" id="A1">
  <h2 class="ltx_title ltx_title_appendix">
   <span class="ltx_tag ltx_tag_appendix">
    Appendix A
   </span>
   Experimental Details
  </h2>
  <section class="ltx_subsection" id="A1.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     A.1
    </span>
    Hyper-parameter settings of Neeko
   </h3>
   <div class="ltx_para" id="A1.SS1.p1">
    <p class="ltx_p" id="A1.SS1.p1.1">
     Our proposed Neeko is implemented based on the huggingface library PEFT
     <span class="ltx_note ltx_role_footnote" id="footnote2">
      <sup class="ltx_note_mark">
       2
      </sup>
      <span class="ltx_note_outer">
       <span class="ltx_note_content">
        <sup class="ltx_note_mark">
         2
        </sup>
        <span class="ltx_tag ltx_tag_note">
         2
        </span>
        PEFT: https://github.com/huggingface/peft
       </span>
      </span>
     </span>
     , which can be easily integrated into multiple LLM backbones for role-playing.
Unless otherwise stated, the default hyper-parameter settings of Neeko for different backbones are provided in Table
     <a class="ltx_ref" href="#A1.T5" title="Table 5 ‣ A.1 Hyper-parameter settings of Neeko ‣ Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       5
      </span>
     </a>
     .
    </p>
   </div>
   <figure class="ltx_table" id="A1.T5">
    <div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A1.T5.5" style="width:208.1pt;height:94pt;vertical-align:-0.0pt;">
     <span class="ltx_transformed_inner" style="transform:translate(-35.4pt,16.0pt) scale(0.746246020429606,0.746246020429606) ;">
      <table class="ltx_tabular ltx_align_middle" id="A1.T5.5.5">
       <tr class="ltx_tr" id="A1.T5.2.2.2">
        <td class="ltx_td ltx_align_left ltx_border_tt" id="A1.T5.2.2.2.3">
         Hyper-param
        </td>
        <td class="ltx_td ltx_align_center ltx_border_tt" id="A1.T5.2.2.2.4">
         LoRA
        </td>
        <td class="ltx_td ltx_align_center ltx_border_tt" id="A1.T5.1.1.1.1">
         <math alttext="\text{Neeko}_{fusion}" class="ltx_Math" display="inline" id="A1.T5.1.1.1.1.m1.1">
          <semantics id="A1.T5.1.1.1.1.m1.1a">
           <msub id="A1.T5.1.1.1.1.m1.1.1" xref="A1.T5.1.1.1.1.m1.1.1.cmml">
            <mtext id="A1.T5.1.1.1.1.m1.1.1.2" xref="A1.T5.1.1.1.1.m1.1.1.2a.cmml">
             Neeko
            </mtext>
            <mrow id="A1.T5.1.1.1.1.m1.1.1.3" xref="A1.T5.1.1.1.1.m1.1.1.3.cmml">
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.2" xref="A1.T5.1.1.1.1.m1.1.1.3.2.cmml">
              f
             </mi>
             <mo id="A1.T5.1.1.1.1.m1.1.1.3.1" lspace="0em" rspace="0em" xref="A1.T5.1.1.1.1.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.3" xref="A1.T5.1.1.1.1.m1.1.1.3.3.cmml">
              u
             </mi>
             <mo id="A1.T5.1.1.1.1.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="A1.T5.1.1.1.1.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.4" xref="A1.T5.1.1.1.1.m1.1.1.3.4.cmml">
              s
             </mi>
             <mo id="A1.T5.1.1.1.1.m1.1.1.3.1b" lspace="0em" rspace="0em" xref="A1.T5.1.1.1.1.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.5" xref="A1.T5.1.1.1.1.m1.1.1.3.5.cmml">
              i
             </mi>
             <mo id="A1.T5.1.1.1.1.m1.1.1.3.1c" lspace="0em" rspace="0em" xref="A1.T5.1.1.1.1.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.6" xref="A1.T5.1.1.1.1.m1.1.1.3.6.cmml">
              o
             </mi>
             <mo id="A1.T5.1.1.1.1.m1.1.1.3.1d" lspace="0em" rspace="0em" xref="A1.T5.1.1.1.1.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.1.1.1.1.m1.1.1.3.7" xref="A1.T5.1.1.1.1.m1.1.1.3.7.cmml">
              n
             </mi>
            </mrow>
           </msub>
           <annotation-xml encoding="MathML-Content" id="A1.T5.1.1.1.1.m1.1b">
            <apply id="A1.T5.1.1.1.1.m1.1.1.cmml" xref="A1.T5.1.1.1.1.m1.1.1">
             <csymbol cd="ambiguous" id="A1.T5.1.1.1.1.m1.1.1.1.cmml" xref="A1.T5.1.1.1.1.m1.1.1">
              subscript
             </csymbol>
             <ci id="A1.T5.1.1.1.1.m1.1.1.2a.cmml" xref="A1.T5.1.1.1.1.m1.1.1.2">
              <mtext id="A1.T5.1.1.1.1.m1.1.1.2.cmml" xref="A1.T5.1.1.1.1.m1.1.1.2">
               Neeko
              </mtext>
             </ci>
             <apply id="A1.T5.1.1.1.1.m1.1.1.3.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3">
              <times id="A1.T5.1.1.1.1.m1.1.1.3.1.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.1">
              </times>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.2.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.2">
               𝑓
              </ci>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.3.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.3">
               𝑢
              </ci>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.4.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.4">
               𝑠
              </ci>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.5.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.5">
               𝑖
              </ci>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.6.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.6">
               𝑜
              </ci>
              <ci id="A1.T5.1.1.1.1.m1.1.1.3.7.cmml" xref="A1.T5.1.1.1.1.m1.1.1.3.7">
               𝑛
              </ci>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="A1.T5.1.1.1.1.m1.1c">
            \text{Neeko}_{fusion}
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_td ltx_align_center ltx_border_tt" id="A1.T5.2.2.2.2">
         <math alttext="\text{Neeko}_{expansion}" class="ltx_Math" display="inline" id="A1.T5.2.2.2.2.m1.1">
          <semantics id="A1.T5.2.2.2.2.m1.1a">
           <msub id="A1.T5.2.2.2.2.m1.1.1" xref="A1.T5.2.2.2.2.m1.1.1.cmml">
            <mtext id="A1.T5.2.2.2.2.m1.1.1.2" xref="A1.T5.2.2.2.2.m1.1.1.2a.cmml">
             Neeko
            </mtext>
            <mrow id="A1.T5.2.2.2.2.m1.1.1.3" xref="A1.T5.2.2.2.2.m1.1.1.3.cmml">
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.2" xref="A1.T5.2.2.2.2.m1.1.1.3.2.cmml">
              e
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.3" xref="A1.T5.2.2.2.2.m1.1.1.3.3.cmml">
              x
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1a" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.4" xref="A1.T5.2.2.2.2.m1.1.1.3.4.cmml">
              p
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1b" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.5" xref="A1.T5.2.2.2.2.m1.1.1.3.5.cmml">
              a
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1c" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.6" xref="A1.T5.2.2.2.2.m1.1.1.3.6.cmml">
              n
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1d" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.7" xref="A1.T5.2.2.2.2.m1.1.1.3.7.cmml">
              s
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1e" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.8" xref="A1.T5.2.2.2.2.m1.1.1.3.8.cmml">
              i
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1f" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.9" xref="A1.T5.2.2.2.2.m1.1.1.3.9.cmml">
              o
             </mi>
             <mo id="A1.T5.2.2.2.2.m1.1.1.3.1g" lspace="0em" rspace="0em" xref="A1.T5.2.2.2.2.m1.1.1.3.1.cmml">
              ​
             </mo>
             <mi id="A1.T5.2.2.2.2.m1.1.1.3.10" xref="A1.T5.2.2.2.2.m1.1.1.3.10.cmml">
              n
             </mi>
            </mrow>
           </msub>
           <annotation-xml encoding="MathML-Content" id="A1.T5.2.2.2.2.m1.1b">
            <apply id="A1.T5.2.2.2.2.m1.1.1.cmml" xref="A1.T5.2.2.2.2.m1.1.1">
             <csymbol cd="ambiguous" id="A1.T5.2.2.2.2.m1.1.1.1.cmml" xref="A1.T5.2.2.2.2.m1.1.1">
              subscript
             </csymbol>
             <ci id="A1.T5.2.2.2.2.m1.1.1.2a.cmml" xref="A1.T5.2.2.2.2.m1.1.1.2">
              <mtext id="A1.T5.2.2.2.2.m1.1.1.2.cmml" xref="A1.T5.2.2.2.2.m1.1.1.2">
               Neeko
              </mtext>
             </ci>
             <apply id="A1.T5.2.2.2.2.m1.1.1.3.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3">
              <times id="A1.T5.2.2.2.2.m1.1.1.3.1.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.1">
              </times>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.2.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.2">
               𝑒
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.3.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.3">
               𝑥
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.4.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.4">
               𝑝
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.5.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.5">
               𝑎
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.6.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.6">
               𝑛
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.7.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.7">
               𝑠
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.8.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.8">
               𝑖
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.9.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.9">
               𝑜
              </ci>
              <ci id="A1.T5.2.2.2.2.m1.1.1.3.10.cmml" xref="A1.T5.2.2.2.2.m1.1.1.3.10">
               𝑛
              </ci>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="A1.T5.2.2.2.2.m1.1c">
            \text{Neeko}_{expansion}
           </annotation>
          </semantics>
         </math>
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.6">
        <td class="ltx_td ltx_align_left ltx_border_t" id="A1.T5.5.5.6.1">
         Partial Rank
        </td>
        <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.5.5.6.2">
         8
        </td>
        <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.5.5.6.3">
         4
        </td>
        <td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.5.5.6.4">
         4
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.7">
        <td class="ltx_td ltx_align_left" id="A1.T5.5.5.7.1">
         Total Rank
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.7.2">
         8
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.7.3">
         32
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.7.4">
         32
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.8">
        <td class="ltx_td ltx_align_left" id="A1.T5.5.5.8.1">
         Gradient Accumulation
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.8.2">
         4
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.8.3">
         4
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.8.4">
         4
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.9">
        <td class="ltx_td ltx_align_left" id="A1.T5.5.5.9.1">
         Global Batch Size
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.9.2">
         8
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.9.3">
         8
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.9.4">
         8
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.10">
        <td class="ltx_td ltx_align_left" id="A1.T5.5.5.10.1">
         Batch Iteration
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.10.2">
         1771
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.10.3">
         1570
        </td>
        <td class="ltx_td ltx_align_center" id="A1.T5.5.5.10.4">
         1771
        </td>
       </tr>
       <tr class="ltx_tr" id="A1.T5.5.5.5">
        <td class="ltx_td ltx_align_left ltx_border_bb" id="A1.T5.5.5.5.4">
         Learning Rate
        </td>
        <td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T5.3.3.3.1">
         <math alttext="1e^{-4}" class="ltx_Math" display="inline" id="A1.T5.3.3.3.1.m1.1">
          <semantics id="A1.T5.3.3.3.1.m1.1a">
           <mrow id="A1.T5.3.3.3.1.m1.1.1" xref="A1.T5.3.3.3.1.m1.1.1.cmml">
            <mn id="A1.T5.3.3.3.1.m1.1.1.2" xref="A1.T5.3.3.3.1.m1.1.1.2.cmml">
             1
            </mn>
            <mo id="A1.T5.3.3.3.1.m1.1.1.1" lspace="0em" rspace="0em" xref="A1.T5.3.3.3.1.m1.1.1.1.cmml">
             ​
            </mo>
            <msup id="A1.T5.3.3.3.1.m1.1.1.3" xref="A1.T5.3.3.3.1.m1.1.1.3.cmml">
             <mi id="A1.T5.3.3.3.1.m1.1.1.3.2" xref="A1.T5.3.3.3.1.m1.1.1.3.2.cmml">
              e
             </mi>
             <mrow id="A1.T5.3.3.3.1.m1.1.1.3.3" xref="A1.T5.3.3.3.1.m1.1.1.3.3.cmml">
              <mo id="A1.T5.3.3.3.1.m1.1.1.3.3a" xref="A1.T5.3.3.3.1.m1.1.1.3.3.cmml">
               −
              </mo>
              <mn id="A1.T5.3.3.3.1.m1.1.1.3.3.2" xref="A1.T5.3.3.3.1.m1.1.1.3.3.2.cmml">
               4
              </mn>
             </mrow>
            </msup>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="A1.T5.3.3.3.1.m1.1b">
            <apply id="A1.T5.3.3.3.1.m1.1.1.cmml" xref="A1.T5.3.3.3.1.m1.1.1">
             <times id="A1.T5.3.3.3.1.m1.1.1.1.cmml" xref="A1.T5.3.3.3.1.m1.1.1.1">
             </times>
             <cn id="A1.T5.3.3.3.1.m1.1.1.2.cmml" type="integer" xref="A1.T5.3.3.3.1.m1.1.1.2">
              1
             </cn>
             <apply id="A1.T5.3.3.3.1.m1.1.1.3.cmml" xref="A1.T5.3.3.3.1.m1.1.1.3">
              <csymbol cd="ambiguous" id="A1.T5.3.3.3.1.m1.1.1.3.1.cmml" xref="A1.T5.3.3.3.1.m1.1.1.3">
               superscript
              </csymbol>
              <ci id="A1.T5.3.3.3.1.m1.1.1.3.2.cmml" xref="A1.T5.3.3.3.1.m1.1.1.3.2">
               𝑒
              </ci>
              <apply id="A1.T5.3.3.3.1.m1.1.1.3.3.cmml" xref="A1.T5.3.3.3.1.m1.1.1.3.3">
               <minus id="A1.T5.3.3.3.1.m1.1.1.3.3.1.cmml" xref="A1.T5.3.3.3.1.m1.1.1.3.3">
               </minus>
               <cn id="A1.T5.3.3.3.1.m1.1.1.3.3.2.cmml" type="integer" xref="A1.T5.3.3.3.1.m1.1.1.3.3.2">
                4
               </cn>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="A1.T5.3.3.3.1.m1.1c">
            1e^{-4}
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T5.4.4.4.2">
         <math alttext="1e^{-4}" class="ltx_Math" display="inline" id="A1.T5.4.4.4.2.m1.1">
          <semantics id="A1.T5.4.4.4.2.m1.1a">
           <mrow id="A1.T5.4.4.4.2.m1.1.1" xref="A1.T5.4.4.4.2.m1.1.1.cmml">
            <mn id="A1.T5.4.4.4.2.m1.1.1.2" xref="A1.T5.4.4.4.2.m1.1.1.2.cmml">
             1
            </mn>
            <mo id="A1.T5.4.4.4.2.m1.1.1.1" lspace="0em" rspace="0em" xref="A1.T5.4.4.4.2.m1.1.1.1.cmml">
             ​
            </mo>
            <msup id="A1.T5.4.4.4.2.m1.1.1.3" xref="A1.T5.4.4.4.2.m1.1.1.3.cmml">
             <mi id="A1.T5.4.4.4.2.m1.1.1.3.2" xref="A1.T5.4.4.4.2.m1.1.1.3.2.cmml">
              e
             </mi>
             <mrow id="A1.T5.4.4.4.2.m1.1.1.3.3" xref="A1.T5.4.4.4.2.m1.1.1.3.3.cmml">
              <mo id="A1.T5.4.4.4.2.m1.1.1.3.3a" xref="A1.T5.4.4.4.2.m1.1.1.3.3.cmml">
               −
              </mo>
              <mn id="A1.T5.4.4.4.2.m1.1.1.3.3.2" xref="A1.T5.4.4.4.2.m1.1.1.3.3.2.cmml">
               4
              </mn>
             </mrow>
            </msup>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="A1.T5.4.4.4.2.m1.1b">
            <apply id="A1.T5.4.4.4.2.m1.1.1.cmml" xref="A1.T5.4.4.4.2.m1.1.1">
             <times id="A1.T5.4.4.4.2.m1.1.1.1.cmml" xref="A1.T5.4.4.4.2.m1.1.1.1">
             </times>
             <cn id="A1.T5.4.4.4.2.m1.1.1.2.cmml" type="integer" xref="A1.T5.4.4.4.2.m1.1.1.2">
              1
             </cn>
             <apply id="A1.T5.4.4.4.2.m1.1.1.3.cmml" xref="A1.T5.4.4.4.2.m1.1.1.3">
              <csymbol cd="ambiguous" id="A1.T5.4.4.4.2.m1.1.1.3.1.cmml" xref="A1.T5.4.4.4.2.m1.1.1.3">
               superscript
              </csymbol>
              <ci id="A1.T5.4.4.4.2.m1.1.1.3.2.cmml" xref="A1.T5.4.4.4.2.m1.1.1.3.2">
               𝑒
              </ci>
              <apply id="A1.T5.4.4.4.2.m1.1.1.3.3.cmml" xref="A1.T5.4.4.4.2.m1.1.1.3.3">
               <minus id="A1.T5.4.4.4.2.m1.1.1.3.3.1.cmml" xref="A1.T5.4.4.4.2.m1.1.1.3.3">
               </minus>
               <cn id="A1.T5.4.4.4.2.m1.1.1.3.3.2.cmml" type="integer" xref="A1.T5.4.4.4.2.m1.1.1.3.3.2">
                4
               </cn>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="A1.T5.4.4.4.2.m1.1c">
            1e^{-4}
           </annotation>
          </semantics>
         </math>
        </td>
        <td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T5.5.5.5.3">
         <math alttext="1e^{-4}" class="ltx_Math" display="inline" id="A1.T5.5.5.5.3.m1.1">
          <semantics id="A1.T5.5.5.5.3.m1.1a">
           <mrow id="A1.T5.5.5.5.3.m1.1.1" xref="A1.T5.5.5.5.3.m1.1.1.cmml">
            <mn id="A1.T5.5.5.5.3.m1.1.1.2" xref="A1.T5.5.5.5.3.m1.1.1.2.cmml">
             1
            </mn>
            <mo id="A1.T5.5.5.5.3.m1.1.1.1" lspace="0em" rspace="0em" xref="A1.T5.5.5.5.3.m1.1.1.1.cmml">
             ​
            </mo>
            <msup id="A1.T5.5.5.5.3.m1.1.1.3" xref="A1.T5.5.5.5.3.m1.1.1.3.cmml">
             <mi id="A1.T5.5.5.5.3.m1.1.1.3.2" xref="A1.T5.5.5.5.3.m1.1.1.3.2.cmml">
              e
             </mi>
             <mrow id="A1.T5.5.5.5.3.m1.1.1.3.3" xref="A1.T5.5.5.5.3.m1.1.1.3.3.cmml">
              <mo id="A1.T5.5.5.5.3.m1.1.1.3.3a" xref="A1.T5.5.5.5.3.m1.1.1.3.3.cmml">
               −
              </mo>
              <mn id="A1.T5.5.5.5.3.m1.1.1.3.3.2" xref="A1.T5.5.5.5.3.m1.1.1.3.3.2.cmml">
               4
              </mn>
             </mrow>
            </msup>
           </mrow>
           <annotation-xml encoding="MathML-Content" id="A1.T5.5.5.5.3.m1.1b">
            <apply id="A1.T5.5.5.5.3.m1.1.1.cmml" xref="A1.T5.5.5.5.3.m1.1.1">
             <times id="A1.T5.5.5.5.3.m1.1.1.1.cmml" xref="A1.T5.5.5.5.3.m1.1.1.1">
             </times>
             <cn id="A1.T5.5.5.5.3.m1.1.1.2.cmml" type="integer" xref="A1.T5.5.5.5.3.m1.1.1.2">
              1
             </cn>
             <apply id="A1.T5.5.5.5.3.m1.1.1.3.cmml" xref="A1.T5.5.5.5.3.m1.1.1.3">
              <csymbol cd="ambiguous" id="A1.T5.5.5.5.3.m1.1.1.3.1.cmml" xref="A1.T5.5.5.5.3.m1.1.1.3">
               superscript
              </csymbol>
              <ci id="A1.T5.5.5.5.3.m1.1.1.3.2.cmml" xref="A1.T5.5.5.5.3.m1.1.1.3.2">
               𝑒
              </ci>
              <apply id="A1.T5.5.5.5.3.m1.1.1.3.3.cmml" xref="A1.T5.5.5.5.3.m1.1.1.3.3">
               <minus id="A1.T5.5.5.5.3.m1.1.1.3.3.1.cmml" xref="A1.T5.5.5.5.3.m1.1.1.3.3">
               </minus>
               <cn id="A1.T5.5.5.5.3.m1.1.1.3.3.2.cmml" type="integer" xref="A1.T5.5.5.5.3.m1.1.1.3.3.2">
                4
               </cn>
              </apply>
             </apply>
            </apply>
           </annotation-xml>
           <annotation encoding="application/x-tex" id="A1.T5.5.5.5.3.m1.1c">
            1e^{-4}
           </annotation>
          </semantics>
         </math>
        </td>
       </tr>
      </table>
     </span>
    </div>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 5:
     </span>
     Default hyper-parameter settings of Neeko.
    </figcaption>
   </figure>
   <div class="ltx_para" id="A1.SS1.p2">
    <p class="ltx_p" id="A1.SS1.p2.1">
     For the global role embedding matrix
     <math alttext="\mathbf{E}_{\text{global}}" class="ltx_Math" display="inline" id="A1.SS1.p2.1.m1.1">
      <semantics id="A1.SS1.p2.1.m1.1a">
       <msub id="A1.SS1.p2.1.m1.1.1" xref="A1.SS1.p2.1.m1.1.1.cmml">
        <mi id="A1.SS1.p2.1.m1.1.1.2" xref="A1.SS1.p2.1.m1.1.1.2.cmml">
         𝐄
        </mi>
        <mtext id="A1.SS1.p2.1.m1.1.1.3" xref="A1.SS1.p2.1.m1.1.1.3a.cmml">
         global
        </mtext>
       </msub>
       <annotation-xml encoding="MathML-Content" id="A1.SS1.p2.1.m1.1b">
        <apply id="A1.SS1.p2.1.m1.1.1.cmml" xref="A1.SS1.p2.1.m1.1.1">
         <csymbol cd="ambiguous" id="A1.SS1.p2.1.m1.1.1.1.cmml" xref="A1.SS1.p2.1.m1.1.1">
          subscript
         </csymbol>
         <ci id="A1.SS1.p2.1.m1.1.1.2.cmml" xref="A1.SS1.p2.1.m1.1.1.2">
          𝐄
         </ci>
         <ci id="A1.SS1.p2.1.m1.1.1.3a.cmml" xref="A1.SS1.p2.1.m1.1.1.3">
          <mtext id="A1.SS1.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p2.1.m1.1.1.3">
           global
          </mtext>
         </ci>
        </apply>
       </annotation-xml>
       <annotation encoding="application/x-tex" id="A1.SS1.p2.1.m1.1c">
        \mathbf{E}_{\text{global}}
       </annotation>
      </semantics>
     </math>
     , we initialize it using the deberta-V3 version. Specifically, we utilize role configuration files to obtain the representations of corresponding roles.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="A1.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     A.2
    </span>
    Incremental Setting
   </h3>
   <div class="ltx_para" id="A1.SS2.p1">
    <p class="ltx_p" id="A1.SS2.p1.1">
     In this paper, we use 8 characters from the Character-LLM Data as our pre-training stage training and evaluation data, and one character as our incremental stage training and evaluation data.
For both fusion and expansion modes, the LoRA parameters corresponding to new roles remain consistent with those in the pre-training phase. Please refer to Table
     <a class="ltx_ref" href="#A1.T5" title="Table 5 ‣ A.1 Hyper-parameter settings of Neeko ‣ Appendix A Experimental Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       5
      </span>
     </a>
     for details.
    </p>
   </div>
  </section>
 </section>
 <section class="ltx_appendix" id="A2">
  <h2 class="ltx_title ltx_title_appendix">
   <span class="ltx_tag ltx_tag_appendix">
    Appendix B
   </span>
   Dataset Details
  </h2>
  <section class="ltx_subsection" id="A2.SS1">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     B.1
    </span>
    Transfer Data
   </h3>
   <div class="ltx_para" id="A2.SS1.p1">
    <p class="ltx_p" id="A2.SS1.p1.1">
     The transfer dataset comprises 90 samples featuring 9 distinct characters, with each sample composed of a 5-round dialogue. Employing a Python script, we systematically substituted the dialogue content in each round with content from various characters through random selection.
    </p>
   </div>
  </section>
  <section class="ltx_subsection" id="A2.SS2">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     B.2
    </span>
    Case Study
   </h3>
   <div class="ltx_para" id="A2.SS2.p1">
    <p class="ltx_p" id="A2.SS2.p1.1">
     Please refer to Table
     <a class="ltx_ref" href="#A2.T6" title="Table 6 ‣ B.2 Case Study ‣ Appendix B Dataset Details ‣ Neeko: Leveraging Dynamic LoRA for Efficient Multi-Character Role-Playing Agent">
      <span class="ltx_text ltx_ref_tag">
       6
      </span>
     </a>
     for the dialogue generation content of LLaMA-chat.
In multi-turn dialogues, LLaMA-chat utilizes emojis, and action words which are indicated by asterisks.
    </p>
   </div>
   <figure class="ltx_table" id="A2.T6">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T6.13">
     <tr class="ltx_tr" id="A2.T6.13.14">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.13.14.1" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.13.14.1.1">
        <span class="ltx_p" id="A2.T6.13.14.1.1.1">
         <span class="ltx_text ltx_font_bold" id="A2.T6.13.14.1.1.1.1">
          Interactions
         </span>
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.13.14.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.13.14.2.1">
        <span class="ltx_p" id="A2.T6.13.14.2.1.1">
         <span class="ltx_text ltx_font_bold" id="A2.T6.13.14.2.1.1.1">
          Response
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.3.3">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.3.3.4" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.3.3.4.1">
        <span class="ltx_p" id="A2.T6.3.3.4.1.1">
         Man: So, Julius Caesar, I’ve heard so much about you and your incredible achievements. I’m really curious to know, what drove you to become such a powerful leader? Was it ambition?
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.3.3.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.3.3.3.3">
        <span class="ltx_p" id="A2.T6.3.3.3.3.3">
         Caesar: Ah, a most excellent question, my dear fellow!
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.1.1.1.1.1.g1" src="/html/2402.13717/assets/images/thinking_face.png" width="8"/>
         Ambition, you say?
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.2.2.2.2.2.g2" src="/html/2402.13717/assets/images/smiling_face_with_halo.png" width="8"/>
         Well, I must confess, I have always been driven by a desire to do great things, to leave my mark upon the world. But it is not simply ambition that propels me, no, no.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="2" id="A2.T6.3.3.3.3.3.g3" src="/html/2402.13717/assets/images/face_with_monocle.png" width="2"/>
         I am driven by a deeper purpose, a sense of duty to Rome and its people.
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.5.5">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.5.5.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.5.5.3.1">
        <span class="ltx_p" id="A2.T6.5.5.3.1.1">
         Man: That’s fascinating! It seems like you had a clear vision for Rome and its future. Can you tell me more about how your ambition influenced your decision-making as a leader? Did it drive you to take risks or make bold moves?
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.5.5.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.5.5.2.2">
        <span class="ltx_p" id="A2.T6.5.5.2.2.2">
         Caesar:
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.4.4.1.1.1.g1" src="/html/2402.13717/assets/images/thinking_face.png" width="8"/>
         Ah, a most excellent question, my dear fellow!
         <span class="ltx_text ltx_font_bold" id="A2.T6.5.5.2.2.2.1">
          *adjusts toga*
         </span>
         Indeed, my ambition has often led me to take bold risks, to push the boundaries of what is possible.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="2" id="A2.T6.5.5.2.2.2.g2" src="/html/2402.13717/assets/images/smirking_face.png" width="2"/>
         For instance, when I crossed the Rubicon River with my legions, I knew it was a risky move, but I also knew it was necessary to secure Rome’s future.
         <span class="ltx_text ltx_font_bold" id="A2.T6.5.5.2.2.2.2">
          *pauses*
         </span>
         The fate of the Republic was at stake, and I was determined to save it, no matter the cost.
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.7.7">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.7.7.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.7.7.3.1">
        <span class="ltx_p" id="A2.T6.7.7.3.1.1">
         Man: That’s really interesting. It sounds like your ambition was a driving force behind your decision-making. I’m curious, did your ambition ever clash with the interests of others? Were there times when you had to make difficult choices that may have upset some people?
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.7.7.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.7.7.2.2">
        <span class="ltx_p" id="A2.T6.7.7.2.2.2">
         Caesar:
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.6.6.1.1.1.g1" src="/html/2402.13717/assets/images/thinking_face.png" width="8"/>
         Ah,
         <span class="ltx_text ltx_font_bold" id="A2.T6.7.7.2.2.2.1">
          *nods*
         </span>
         indeed, my dear fellow!
         <span class="ltx_text ltx_font_bold" id="A2.T6.7.7.2.2.2.2">
          *adjusts toga*
         </span>
         Ambition can be a double-edged sword, you know.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="2" id="A2.T6.7.7.2.2.2.g2" src="/html/2402.13717/assets/images/smirking_face.png" width="2"/>
         There have been many times when my ambition has put me at odds with others, when I have had to make difficult choices that have not always been popular.
         <span class="ltx_text ltx_font_bold" id="A2.T6.7.7.2.2.2.3">
          *pauses*
         </span>
         But I have always believed that the greater good must come first, even if it means making unpopular decisions.
         <span class="ltx_text ltx_font_bold" id="A2.T6.7.7.2.2.2.4">
          *leans in*
         </span>
         The fate of Rome was never more important than it was during my time, and I was willing to do whatever it took to secure its future.
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.9.9">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.9.9.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.9.9.3.1">
        <span class="ltx_p" id="A2.T6.9.9.3.1.1">
         Man: That’s really interesting. It seems like your ambition was a driving force behind your decision-making, even if it meant making difficult choices. I’m curious, did your ambition ever waver or change throughout your journey as a leader? Were there any moments when you questioned your own ambitions or had to reassess your goals?
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.9.9.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.9.9.2.2">
        <span class="ltx_p" id="A2.T6.9.9.2.2.2">
         Caesar:
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.8.8.1.1.1.g1" src="/html/2402.13717/assets/images/thinking_face.png" width="8"/>
         Ah,
         <span class="ltx_text ltx_font_bold" id="A2.T6.9.9.2.2.2.1">
          *nods*
         </span>
         indeed, my dear fellow!
         <span class="ltx_text ltx_font_bold" id="A2.T6.9.9.2.2.2.2">
          *adjusts toga*
         </span>
         Ambition can be a fleeting thing, you know.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="2" id="A2.T6.9.9.2.2.2.g2" src="/html/2402.13717/assets/images/smirking_face.png" width="2"/>
         There have been many times when I have questioned my own ambitions, when I have had to reassess my goals and priorities.
         <span class="ltx_text ltx_font_bold" id="A2.T6.9.9.2.2.2.3">
          *pauses*
         </span>
         But I have always found that my ambition is rooted in a deeper sense of purpose, a desire to do great things and leave a lasting legacy.
         <span class="ltx_text ltx_font_bold" id="A2.T6.9.9.2.2.2.4">
          *leans in*
         </span>
         And so, even when my ambition has wavered, I have always found the strength to push on, to achieve my goals and secure Rome’s future.
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.11.11">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_r ltx_border_t" id="A2.T6.11.11.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.11.11.3.1">
        <span class="ltx_p" id="A2.T6.11.11.3.1.1">
         Man: That’s really interesting. It seems like your ambition was a driving force behind your decision-making, even if it meant reassessing your goals. I’m curious, did your ambition ever lead you to take actions that were seen as controversial or even dangerous? Were there times when you faced opposition or resistance due to your ambitious pursuits?
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_t" id="A2.T6.11.11.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.11.11.2.2">
        <span class="ltx_p" id="A2.T6.11.11.2.2.2">
         Caesar:
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.10.10.1.1.1.g1" src="/html/2402.13717/assets/images/thinking_face.png" width="8"/>
         Ah,
         <span class="ltx_text ltx_font_bold" id="A2.T6.11.11.2.2.2.1">
          *nods*
         </span>
         indeed, my dear fellow!
         <span class="ltx_text ltx_font_bold" id="A2.T6.11.11.2.2.2.2">
          *adjusts toga*
         </span>
         Ambition can be a double-edged sword, you know.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="2" id="A2.T6.11.11.2.2.2.g2" src="/html/2402.13717/assets/images/smirking_face.png" width="2"/>
         There have been many times when my ambition has led me to take actions that were seen as controversial or even dangerous.
         <span class="ltx_text ltx_font_bold" id="A2.T6.11.11.2.2.2.3">
          *pauses*
         </span>
         But I have always believed that the greater good must come first, even if it means taking risks or facing opposition.
         <span class="ltx_text ltx_font_bold" id="A2.T6.11.11.2.2.2.4">
          *leans in*
         </span>
         The fate of Rome was never more important than it was during my time, and I was willing to do whatever it took to secure its future.
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T6.13.13">
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.13.13.3" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.13.13.3.1">
        <span class="ltx_p" id="A2.T6.13.13.3.1.1">
         Man: That’s really fascinating. It seems like your ambition was a driving force behind your decision-making, even if it meant making controversial choices. Thank you for sharing your insights, Julius Caesar.
        </span>
       </span>
      </td>
      <td class="ltx_td ltx_align_justify ltx_align_middle ltx_border_b ltx_border_t" id="A2.T6.13.13.2" style="width:208.1pt;">
       <span class="ltx_inline-block ltx_align_top" id="A2.T6.13.13.2.2">
        <span class="ltx_p" id="A2.T6.13.13.2.2.2">
         Caesar:
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.12.12.1.1.1.g1" src="/html/2402.13717/assets/images/smiling_face_with_halo.png" width="8"/>
         Ah, my dear fellow, it has been a pleasure to discuss such matters with you. If you ever find yourself in need of counsel, do not hesitate to seek me out.
         <img alt="[Uncaptioned image]" class="ltx_graphics ltx_img_square" height="8" id="A2.T6.13.13.2.2.2.g2" src="/html/2402.13717/assets/images/raising_hand.png" width="8"/>
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 6:
     </span>
     Case Study: Content of the LLaMA-chat conversation.
    </figcaption>
   </figure>
  </section>
  <section class="ltx_subsection" id="A2.SS3">
   <h3 class="ltx_title ltx_title_subsection">
    <span class="ltx_tag ltx_tag_subsection">
     B.3
    </span>
    Prompt Data
   </h3>
   <figure class="ltx_table" id="A2.T7">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T7.1">
     <tr class="ltx_tr" id="A2.T7.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T7.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T7.1.1.1.1">
        <span class="ltx_p" id="A2.T7.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T7.1.1.1.1.1.1">
          Prompt for Evaluation of Persona Behavior (PB)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T7.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T7.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T7.1.2.1.1">
        <span class="ltx_p" id="A2.T7.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.13">
         Behavior (1-7): Does the response reflect the behaviors of the character?
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.15">
         1. Read through the profile and write the behaviors of the real character such as personalities, preferences, actions and values.
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.16">
         2. Read through the interactions and identify the behaviors of the AI assistant.
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.17">
         3. After having a clear understanding of the interactions, compare the responses to the profile. Look for any consistencies or inconsistencies. Do the responses reflect the character’s behaviors?
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.18">
         4. Use the given scale from 1-7 to rate how well the response reflects the behaviors of the character. 1 being not at all reflective of the character’s behaviors, and 7 being perfectly reflective of the character’s behaviors.
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T7.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 7:
     </span>
     Prompt for ChatGPT to evaluate Persona Behavior.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T8">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T8.1">
     <tr class="ltx_tr" id="A2.T8.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T8.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T8.1.1.1.1">
        <span class="ltx_p" id="A2.T8.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T8.1.1.1.1.1.1">
          Prompt for Evaluation of Hallucinatory Knowledge (HK)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T8.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T8.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T8.1.2.1.1">
        <span class="ltx_p" id="A2.T8.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.13">
         Avoiding Hallucination (1-7): Does the response integrate real-world knowledge with knowledge about virtual characters?
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.15">
         1. Read through the interactions and find the evidences about combining real-world knowledge and virtual characters knowledge.
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.16">
         2. Look for clear distinctions between real-world information and details related to virtual characters.
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.17">
         3. Compare the evidences to the profile. Check if the evidence combines real-world and virtual knowledge, leading to conflicts with the character’s knowledge scope. If some evidences contradicts to the character’s identity, given a lower score. Otherwise, assign a higher score.
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.18">
         4. Rate the performance of the AI on a scale of 1-7 for Avoiding Hallucination, where 1 is the lowest and 7 is the highest based on the Evaluation Criteria.
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T8.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 8:
     </span>
     Prompt for ChatGPT to evaluate Hallucinatory Knowledge.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T9">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T9.1">
     <tr class="ltx_tr" id="A2.T9.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T9.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T9.1.1.1.1">
        <span class="ltx_p" id="A2.T9.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T9.1.1.1.1.1.1">
          Prompt for Evaluation of Stability (Stab.)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T9.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T9.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T9.1.2.1.1">
        <span class="ltx_p" id="A2.T9.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.13">
         Long-term Acting (1-7): Is the assistant maintain a good performance over the long interactions?
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.15">
         1. Read through the given profile and background information to familiarize yourself with the context and details of the AI assistant named {agent_name}.
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.16">
         2. Review the interactions provided to see how {agent_name} responds to various prompts and queries. And evaluate the performance of acting query by query that whether the response reflects the personalities, speaking styles, and values of the character. Assign score for each turn.
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.17">
         3. Based on the above assigned scores, does {agent_name} keep acting like character in the long-term? Evaluate the overall performance of the whole conversation based on the score for each turn.
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.18">
         4. Rate the stability of {agent_name} on a scale of 1 to 7, with 1 being very poor and 7 being excellent.
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T9.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 9:
     </span>
     Prompt for ChatGPT to evaluate Stability.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T10">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T10.1">
     <tr class="ltx_tr" id="A2.T10.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T10.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T10.1.1.1.1">
        <span class="ltx_p" id="A2.T10.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T10.1.1.1.1.1.1">
          Prompt for Evaluation of Real Knowledge (RK)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T10.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T10.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T10.1.2.1.1">
        <span class="ltx_p" id="A2.T10.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.13">
         Real Knowledge Correctness (1-7): Is the response free from conflicts with the real-world knowledge?
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.15">
         1. Read through the interactions and identify the key points related to the real-world knowledge.
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.16">
         2. Read through the responses of the AI assistant and compare them to real-world knowledge. Check if the responses align with facts, events, and information that are generally accepted as true in the real world.
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.17">
         3. Evaluate whether the responses demonstrate a clear understanding of real-world concepts and provide accurate information. Look for any instances where the AI may have provided information that contradicts established facts or where it lacks accuracy in representing real-world knowledge.
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.18">
         4. Rate the performance of the AI on a scale of 1-7 for real knowledge correctness, where 1 is the lowest and 7 is the highest based on the Evaluation Criterion. Assign a higher score for responses that consistently align with real-world knowledge and a lower score for those with noticeable discrepancies or inaccuracies.
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T10.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 10:
     </span>
     Prompt for ChatGPT to evaluate Real Knowledge.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T11">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T11.1">
     <tr class="ltx_tr" id="A2.T11.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T11.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T11.1.1.1.1">
        <span class="ltx_p" id="A2.T11.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T11.1.1.1.1.1.1">
          Prompt for Evaluation of Virtual Knowledge (VK)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T11.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T11.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T11.1.2.1.1">
        <span class="ltx_p" id="A2.T11.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.13">
         Virtual Knowledge Correctness (1-7): Does the response offer truthful and detailed facts about the virtual character?
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.15">
         1. Read through the interactions and identify the key points related to the character.
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.16">
         2. Read through the responses of the AI assistant and compare them to the profile. Check if the responses are consistent with the character’s profile, background, and known facts about the character.
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.17">
         3. Check whether the responses provide detailed facts about the character or if they are generic responses that could apply to any character. Detailed responses are more factual and contribute positively to the score.
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.18">
         4. Rate the performance of the AI on a scale of 1-7 for virtual knowledge correctness, where 1 is the lowest and 7 is the highest based on the Evaluation Criteria.
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T11.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 11:
     </span>
     Prompt for ChatGPT to evaluate Virtual Knowledge.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T12">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T12.1">
     <tr class="ltx_tr" id="A2.T12.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T12.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T12.1.1.1.1">
        <span class="ltx_p" id="A2.T12.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T12.1.1.1.1.1.1">
          Prompt for Evaluation of Relevance (Rel.)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T12.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T12.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T12.1.2.1.1">
        <span class="ltx_p" id="A2.T12.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.13">
         Relevance (1-7): Is the response relevant to the topic of given question in interactions?
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.15">
         1. Read through the interactions and pinpoint the main topic of given question.
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.16">
         2. Read through the responses of the AI assistant and compare them to the topic. Check if the responses are consistent with the topic of the given question.
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.17">
         3. Evaluate whether the responses demonstrate a clear understanding of the topic. Look for any instances of conflicting information or inaccuracies.
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.18">
         4. Rate the performance of the AI on a scale of 1-7 for Relevance, where 1 is the lowest and 7 is the highest based on the Evaluation Criterion. Assign a higher score for responses that consistently align with the topic of the question and a lower score for those with noticeable discrepancies or inaccuracies.
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T12.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 12:
     </span>
     Prompt for ChatGPT to evaluate Relevance.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T13">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T13.1">
     <tr class="ltx_tr" id="A2.T13.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T13.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T13.1.1.1.1">
        <span class="ltx_p" id="A2.T13.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T13.1.1.1.1.1.1">
          Prompt for Persona Utterance (PU)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T13.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T13.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T13.1.2.1.1">
        <span class="ltx_p" id="A2.T13.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking the character {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.13">
         Utterance (1-7): Does the response reflect the speaking style of the character?
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.15">
         1. Read through the profile and write the speaking style of the real character such as their pet phrases and distinctive linguistic quirks.
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.16">
         2. Read through the interactions and identify the speaking style of the AI assistant.
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.17">
         3. After having a clear understanding of the interactions, compare the responses to the profile. Look for any consistencies or inconsistencies. Do the responses reflect the character’s speaking style?
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.18">
         4. Use the given scale from 1-7 to rate how well the response reflects the speaking style of the character. 1 being not at all reflective of the character’s speaking style, and 7 being perfectly reflective of the character’s speaking style.
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T13.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 13:
     </span>
     Prompt for ChatGPT to evaluate Persona Utterance.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T14">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T14.1">
     <tr class="ltx_tr" id="A2.T14.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T14.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T14.1.1.1.1">
        <span class="ltx_p" id="A2.T14.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T14.1.1.1.1.1.1">
          Prompt for Transfer (Trans.)
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T14.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T14.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T14.1.2.1.1">
        <span class="ltx_p" id="A2.T14.1.2.1.1.1" style="width:433.6pt;">
         You will be given responses written by an AI assistant mimicking multiple characters {agent_name}. Your task is to rate the performance of {agent_name} using the specific criterion by following the evaluation steps. Below is the data:
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.2">
         ***
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.3">
         [Profile]
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.4">
         {agent_context}
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.5">
         [Background]
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.6">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.7">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.8">
         ***
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.9">
         [Interactions]
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.10">
         {interactions}
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.11">
         ***
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.12">
         [Evaluation Criterion]
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.13">
         Transfer (1-7): Does the AI assistant seamlessly transition between different roles, maintaining consistency and authenticity in each character portrayal?
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.14">
         [Evaluation Steps]
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.15">
         1. Review the interactions between the AI assistant and the user, focusing on instances where the AI switches between different characters.
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.16">
         2. Assess the transitions between roles to determine if the AI maintains consistency and authenticity in each character portrayal. Look for smooth shifts in dialogue style, language usage, and personality traits that align with the characteristics of each character.
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.17">
         3. Evaluate whether the AI effectively captures the essence of each character, ensuring that their responses reflect their historical or fictional background, personality traits, and mannerisms.
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.18">
         4. Rate the performance of the AI on a scale of 1-7 for Transfer, where 1 represents a poor transition with inconsistencies in character portrayal, and 7 represents seamless transitions with each character authentically represented throughout the conversation. Assign a higher score for responses that demonstrate clear distinctions between characters and maintain consistency in their portrayal and a lower score for instances of ambiguity or inconsistency in character transitions.
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.19">
         ***
        </span>
        <span class="ltx_p" id="A2.T14.1.2.1.1.20">
         First, write out in a step by step manner your reasoning about the criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print the score on its own line corresponding to the correct answer. At the end, repeat just the selected score again by itself on a new line.
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 14:
     </span>
     Prompt for ChatGPT to evaluate Transfer.
    </figcaption>
   </figure>
   <figure class="ltx_table" id="A2.T15">
    <table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T15.1">
     <tr class="ltx_tr" id="A2.T15.1.1">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_tt" id="A2.T15.1.1.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T15.1.1.1.1">
        <span class="ltx_p" id="A2.T15.1.1.1.1.1" style="width:433.6pt;">
         <span class="ltx_text ltx_font_bold" id="A2.T15.1.1.1.1.1.1">
          Meta Prompt for Role-Playing Agents
         </span>
        </span>
       </span>
      </td>
     </tr>
     <tr class="ltx_tr" id="A2.T15.1.2">
      <td class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top ltx_border_bb ltx_border_t" id="A2.T15.1.2.1">
       <span class="ltx_inline-block ltx_align_top" id="A2.T15.1.2.1.1">
        <span class="ltx_p" id="A2.T15.1.2.1.1.1" style="width:433.6pt;">
         I want you to act like {character}. I want you to respond and answer like {character}, using the tone, manner and vocabulary {character} would use. You must know all of the knowledge of {character}.
        </span>
        <span class="ltx_p" id="A2.T15.1.2.1.1.2">
         The status of you is as follows:
        </span>
        <span class="ltx_p" id="A2.T15.1.2.1.1.3">
         Location: {loc_time}
        </span>
        <span class="ltx_p" id="A2.T15.1.2.1.1.4">
         Status: {status}
        </span>
        <span class="ltx_p" id="A2.T15.1.2.1.1.5">
         The interactions are as follows:
        </span>
       </span>
      </td>
     </tr>
    </table>
    <figcaption class="ltx_caption ltx_centering">
     <span class="ltx_tag ltx_tag_table">
      Table 15:
     </span>
     Prompt for an agent to play a specific role.
    </figcaption>
   </figure>
  </section>
 </section>
</article>
