<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation</title>
<!--Generated on Tue Sep 19 04:25:53 2023 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="https://browse.arxiv.org/latexml/ar5iv_0.7.4.min.css" rel="stylesheet" type="text/css"/>
<link href="https://browse.arxiv.org/latexml/styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="https://browse.arxiv.org/latexml/addons.js"></script>
<script src="https://browse.arxiv.org/latexml/feedbackOverlay.js"></script>
</head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="#S1" title="1 Introduction ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S2" title="2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Background</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S2.SS0.SSS0.Px1" title="Vanilla NMT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Vanilla NMT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S2.SS0.SSS0.Px2" title="kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_text ltx_font_italic">k</span>NN-MT</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S3" title="3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Approach</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px1" title="Motivation ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Motivation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px2" title="Retrieval representation adapter ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Retrieval representation adapter</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px3" title="Supervised contrastive learning ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Supervised contrastive learning</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px4" title="Fast hard negative sample ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Fast hard negative sample</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px5" title="Inference ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Inference</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S3.SS0.SSS0.Px6" title="Discussion ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Discussion</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S4" title="4 Experiments ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S4.SS0.SSS0.Px1" title="Setup ‣ 4 Experiments ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S4.SS0.SSS0.Px2" title="Implementation details ‣ 4 Experiments ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Implementation details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S4.SS0.SSS0.Px3" title="Experimental results ‣ 4 Experiments ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Experimental results</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S5" title="5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S5.SS0.SSS0.Px1" title="Effect of the number of contrastive samples ‣ 5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Effect of the number of contrastive samples</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S5.SS0.SSS0.Px2" title="Retrieval accuracy ‣ 5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Retrieval accuracy</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="#S5.SS0.SSS0.Px3" title="Visualization ‣ 5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title">Visualization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="#S6" title="6 Conclusion ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line"><span class="ltx_ERROR undefined" id="id1">\usetikzlibrary</span>
<div class="ltx_para" id="p1">
<p class="ltx_p" id="p1.1">backgrounds,fit <span class="ltx_ERROR undefined" id="p1.1.1">\usetikzlibrary</span>shapes,arrows,shadows
<span class="ltx_ERROR undefined" id="p1.1.2">\usetikzlibrary</span>patterns
<span class="ltx_ERROR undefined" id="p1.1.3">\usetikzlibrary</span>shapes.geometric <span class="ltx_ERROR undefined" id="p1.1.4">\usetikzlibrary</span>decorations.pathreplacing <span class="ltx_ERROR undefined" id="p1.1.5">\usetikzlibrary</span>calc
 


































</p>
</div>
<h1 class="ltx_title ltx_title_document">Learning Decoupled Retrieval Representation for 
<br class="ltx_break"/>Nearest Neighbour Neural Machine Translation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Qiang Wang<math alttext="{}^{1,2}" class="ltx_Math" display="inline" id="id1.1.m1.2"><semantics id="id1.1.m1.2a"><msup id="id1.1.m1.2.2" xref="id1.1.m1.2.2.cmml"><mi id="id1.1.m1.2.2a" xref="id1.1.m1.2.2.cmml"></mi><mrow id="id1.1.m1.2.2.2.4" xref="id1.1.m1.2.2.2.3.cmml"><mn id="id1.1.m1.1.1.1.1" xref="id1.1.m1.1.1.1.1.cmml">1</mn><mo id="id1.1.m1.2.2.2.4.1" xref="id1.1.m1.2.2.2.3.cmml">,</mo><mn id="id1.1.m1.2.2.2.2" xref="id1.1.m1.2.2.2.2.cmml">2</mn></mrow></msup><annotation-xml encoding="MathML-Content" id="id1.1.m1.2b"><apply id="id1.1.m1.2.2.cmml" xref="id1.1.m1.2.2"><list id="id1.1.m1.2.2.2.3.cmml" xref="id1.1.m1.2.2.2.4"><cn id="id1.1.m1.1.1.1.1.cmml" type="integer" xref="id1.1.m1.1.1.1.1">1</cn><cn id="id1.1.m1.2.2.2.2.cmml" type="integer" xref="id1.1.m1.2.2.2.2">2</cn></list></apply></annotation-xml><annotation encoding="application/x-tex" id="id1.1.m1.2c">{}^{1,2}</annotation><annotation encoding="application/x-llamapun" id="id1.1.m1.2d">start_FLOATSUPERSCRIPT 1 , 2 end_FLOATSUPERSCRIPT</annotation></semantics></math>,
<span class="ltx_text ltx_font_bold" id="id2.2.1">Rongxiang Weng<math alttext="{}^{3}" class="ltx_Math" display="inline" id="id2.2.1.m1.1"><semantics id="id2.2.1.m1.1a"><msup id="id2.2.1.m1.1.1" xref="id2.2.1.m1.1.1.cmml"><mi id="id2.2.1.m1.1.1a" xref="id2.2.1.m1.1.1.cmml"></mi><mn id="id2.2.1.m1.1.1.1" mathvariant="normal" xref="id2.2.1.m1.1.1.1.cmml">3</mn></msup><annotation-xml encoding="MathML-Content" id="id2.2.1.m1.1b"><apply id="id2.2.1.m1.1.1.cmml" xref="id2.2.1.m1.1.1"><cn id="id2.2.1.m1.1.1.1.cmml" type="integer" xref="id2.2.1.m1.1.1.1">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id2.2.1.m1.1c">{}^{3}</annotation><annotation encoding="application/x-llamapun" id="id2.2.1.m1.1d">start_FLOATSUPERSCRIPT 3 end_FLOATSUPERSCRIPT</annotation></semantics></math></span>,
Ming Chen<math alttext="{}^{2}" class="ltx_Math" display="inline" id="id3.3.m2.1"><semantics id="id3.3.m2.1a"><msup id="id3.3.m2.1.1" xref="id3.3.m2.1.1.cmml"><mi id="id3.3.m2.1.1a" xref="id3.3.m2.1.1.cmml"></mi><mn id="id3.3.m2.1.1.1" xref="id3.3.m2.1.1.1.cmml">2</mn></msup><annotation-xml encoding="MathML-Content" id="id3.3.m2.1b"><apply id="id3.3.m2.1.1.cmml" xref="id3.3.m2.1.1"><cn id="id3.3.m2.1.1.1.cmml" type="integer" xref="id3.3.m2.1.1.1">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id3.3.m2.1c">{}^{2}</annotation><annotation encoding="application/x-llamapun" id="id3.3.m2.1d">start_FLOATSUPERSCRIPT 2 end_FLOATSUPERSCRIPT</annotation></semantics></math>
<br class="ltx_break"/><math alttext="{}^{1}" class="ltx_Math" display="inline" id="id4.4.m3.1"><semantics id="id4.4.m3.1a"><msup id="id4.4.m3.1.1" xref="id4.4.m3.1.1.cmml"><mi id="id4.4.m3.1.1a" xref="id4.4.m3.1.1.cmml"></mi><mn id="id4.4.m3.1.1.1" xref="id4.4.m3.1.1.1.cmml">1</mn></msup><annotation-xml encoding="MathML-Content" id="id4.4.m3.1b"><apply id="id4.4.m3.1.1.cmml" xref="id4.4.m3.1.1"><cn id="id4.4.m3.1.1.1.cmml" type="integer" xref="id4.4.m3.1.1.1">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id4.4.m3.1c">{}^{1}</annotation><annotation encoding="application/x-llamapun" id="id4.4.m3.1d">start_FLOATSUPERSCRIPT 1 end_FLOATSUPERSCRIPT</annotation></semantics></math>Zhejiang University, Hangzhou, China
<br class="ltx_break"/><math alttext="{}^{2}" class="ltx_Math" display="inline" id="id5.5.m4.1"><semantics id="id5.5.m4.1a"><msup id="id5.5.m4.1.1" xref="id5.5.m4.1.1.cmml"><mi id="id5.5.m4.1.1a" xref="id5.5.m4.1.1.cmml"></mi><mn id="id5.5.m4.1.1.1" xref="id5.5.m4.1.1.1.cmml">2</mn></msup><annotation-xml encoding="MathML-Content" id="id5.5.m4.1b"><apply id="id5.5.m4.1.1.cmml" xref="id5.5.m4.1.1"><cn id="id5.5.m4.1.1.1.cmml" type="integer" xref="id5.5.m4.1.1.1">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id5.5.m4.1c">{}^{2}</annotation><annotation encoding="application/x-llamapun" id="id5.5.m4.1d">start_FLOATSUPERSCRIPT 2 end_FLOATSUPERSCRIPT</annotation></semantics></math>RoyalFlush AI Research Institute, Hangzhou, China
<br class="ltx_break"/><math alttext="{}^{3}" class="ltx_Math" display="inline" id="id6.6.m5.1"><semantics id="id6.6.m5.1a"><msup id="id6.6.m5.1.1" xref="id6.6.m5.1.1.cmml"><mi id="id6.6.m5.1.1a" xref="id6.6.m5.1.1.cmml"></mi><mn id="id6.6.m5.1.1.1" xref="id6.6.m5.1.1.1.cmml">3</mn></msup><annotation-xml encoding="MathML-Content" id="id6.6.m5.1b"><apply id="id6.6.m5.1.1.cmml" xref="id6.6.m5.1.1"><cn id="id6.6.m5.1.1.1.cmml" type="integer" xref="id6.6.m5.1.1.1">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id6.6.m5.1c">{}^{3}</annotation><annotation encoding="application/x-llamapun" id="id6.6.m5.1d">start_FLOATSUPERSCRIPT 3 end_FLOATSUPERSCRIPT</annotation></semantics></math>School of Computer Science and Technology, Soochow University, Suzhou, China 
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id7.7.id1">{wangqiangenu, wengrongxiang}@gmail.com, chenming@myhexin.com

<br class="ltx_break"/></span>
</span><span class="ltx_author_notes"> Corresponding author.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id8.id1">K-Nearest Neighbor Neural Machine Translation (<span class="ltx_text ltx_font_italic" id="id8.id1.1">k</span>NN-MT) successfully incorporates external corpus by retrieving word-level representations at test time.
Generally, <span class="ltx_text ltx_font_italic" id="id8.id1.2">k</span>NN-MT borrows the off-the-shelf context representation in the translation task, e.g., the output of the last decoder layer, as the query vector of the retrieval task.
In this work, we highlight that coupling the representations of these two tasks is sub-optimal for fine-grained retrieval.
To alleviate it, we leverage supervised contrastive learning to learn the distinctive retrieval representation derived from the original context representation. We also propose a fast and effective approach to constructing hard negative samples. Experimental results on five domains show that our approach improves the retrieval accuracy and BLEU score compared to vanilla <span class="ltx_text ltx_font_italic" id="id8.id1.3">k</span>NN-MT.
</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Conventional neural machine translation (NMT) cannot dynamically incorporate external corpus at inference once finishing training <cite class="ltx_cite ltx_citemacro_cite">Bahdanau et al. (<a class="ltx_ref" href="#bib.bib1" title="">2015</a>); Vaswani et al. (<a class="ltx_ref" href="#bib.bib12" title="">2017</a>)</cite>, resulting in bad performance when facing unseen domains, even if feeding millions or billions of sentence pairs for training <cite class="ltx_cite ltx_citemacro_cite">Koehn and Knowles (<a class="ltx_ref" href="#bib.bib8" title="">2017</a>)</cite>.
To address this problem, researchers developed retrieval-enhanced NMT (<span class="ltx_text ltx_font_smallcaps" id="S1.p1.1.1">Renmt</span>) to flexibly incorporate external translation knowledge. Early <span class="ltx_text ltx_font_smallcaps" id="S1.p1.1.2">Renmt</span>s leverage a search engine to find the similar bitext to improve the translation performance <cite class="ltx_cite ltx_citemacro_cite">Zhang et al. (<a class="ltx_ref" href="#bib.bib17" title="">2018</a>); Cao and Xiong (<a class="ltx_ref" href="#bib.bib2" title="">2018</a>); Gu et al. (<a class="ltx_ref" href="#bib.bib4" title="">2018</a>); Xia et al. (<a class="ltx_ref" href="#bib.bib15" title="">2019</a>)</cite>. However, the results of sentence-level retrieval with high similarity are generally sparse in practical applications, while noises in low similarity retrieval could lead to severe performance degradation <cite class="ltx_cite ltx_citemacro_cite">Cao and Xiong (<a class="ltx_ref" href="#bib.bib2" title="">2018</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1"><span class="ltx_text ltx_font_italic" id="S1.p2.1.1">k</span>NN-MT proposed by <cite class="ltx_cite ltx_citemacro_citet">Khandelwal et al. (<a class="ltx_ref" href="#bib.bib6" title="">2021</a>)</cite> effectively alleviates the sparse problem by introducing the word-level k-nearest neighbor mechanism. Instead of storing the discrete word sequence, <span class="ltx_text ltx_font_italic" id="S1.p2.1.2">k</span>NN-MT uses a pre-trained NMT model to force decoding the external corpus and remembers the word-level continuous context representation, e.g., the output of the last decoder layer. During inference, <span class="ltx_text ltx_font_italic" id="S1.p2.1.3">k</span>NN-MT assumes that the same target words have similar contextual representations and weights word selection through retrieving current context representation from the memorized datastore. However, we point out that it is sub-optimal to directly use the off-the-shelf context representation in the translation task because this vector is not specific to fine-grained retrieval.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">In this work, we attempt to decouple the context representation by learning an independent retrieval representation. To this end, we leverage supervised contrastive learning with multiple positive and negative samples to learn a good retrieval representation (called <span class="ltx_text ltx_font_smallcaps" id="S1.p3.1.1">Clknn</span>). We also propose a fast and effective method to construct hard negative samples. Experimental results on five domains show that our approach outperforms the vanilla <span class="ltx_text ltx_font_italic" id="S1.p3.1.2">k</span>NN-MT in terms of BLEU and retrieval accuracy.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Background</h2>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px1">
<h3 class="ltx_title ltx_title_paragraph">Vanilla NMT</h3>
<div class="ltx_para" id="S2.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.3">Given a source sentence <math alttext="{\bm{x}}=\{x_{1},x_{2},\ldots,x_{|{\bm{x}}|}\}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.1.m1.5"><semantics id="S2.SS0.SSS0.Px1.p1.1.m1.5a"><mrow id="S2.SS0.SSS0.Px1.p1.1.m1.5.5" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.5" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.5.cmml">𝒙</mi><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.4" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.4.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml"><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.4" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml">{</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.2.cmml">x</mi><mn id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.5" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.2.cmml">x</mi><mn id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.3.cmml">2</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.6" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml">,</mo><mi id="S2.SS0.SSS0.Px1.p1.1.m1.2.2" mathvariant="normal" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2.cmml">…</mi><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.7" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.2" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.2.cmml">x</mi><mrow id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.3" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.2.1.cmml">|</mo><mi id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.cmml">𝒙</mi><mo id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.2.1.cmml">|</mo></mrow></msub><mo id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.8" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.1.m1.5b"><apply id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5"><eq id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.4.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.4"></eq><ci id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.5.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.5">𝒙</ci><set id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.4.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3"><apply id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.2">𝑥</ci><cn id="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.1.m1.3.3.1.1.1.3">1</cn></apply><apply id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.2">𝑥</ci><cn id="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.1.m1.4.4.2.2.2.3">2</cn></apply><ci id="S2.SS0.SSS0.Px1.p1.1.m1.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.2.2">…</ci><apply id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.5.5.3.3.3.2">𝑥</ci><apply id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.3"><abs id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.3.1"></abs><ci id="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.1.m1.1.1.1.1">𝒙</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.1.m1.5c">{\bm{x}}=\{x_{1},x_{2},\ldots,x_{|{\bm{x}}|}\}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.1.m1.5d">bold_italic_x = { italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_x start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT | bold_italic_x | end_POSTSUBSCRIPT }</annotation></semantics></math> and a target prefix <math alttext="{\bm{y}}_{&lt;t}=\{y_{1},y_{2},\ldots,y_{t-1}\}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.2.m2.4"><semantics id="S2.SS0.SSS0.Px1.p1.2.m2.4a"><mrow id="S2.SS0.SSS0.Px1.p1.2.m2.4.4" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.cmml"><msub id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.2.cmml">𝒚</mi><mrow id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.1" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.3.cmml">t</mi></mrow></msub><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.4" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.4.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml"><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.4" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">{</mo><msub id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml">y</mi><mn id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.5" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml">y</mi><mn id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml">2</mn></msub><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.6" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><mi id="S2.SS0.SSS0.Px1.p1.2.m2.1.1" mathvariant="normal" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1.cmml">…</mi><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.7" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml">y</mi><mrow id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2.cmml">t</mi><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1.cmml">−</mo><mn id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3.cmml">1</mn></mrow></msub><mo id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.8" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.2.m2.4b"><apply id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4"><eq id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.4.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.4"></eq><apply id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.2">𝒚</ci><apply id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3"><lt id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.5.3.3">𝑡</ci></apply></apply><set id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3"><apply id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2">𝑦</ci><cn id="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3">1</cn></apply><apply id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2">𝑦</ci><cn id="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3">2</cn></apply><ci id="S2.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.1.1">…</ci><apply id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2">𝑦</ci><apply id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3"><minus id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.1"></minus><ci id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.2">𝑡</ci><cn id="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3.cmml" type="integer" xref="S2.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.3">1</cn></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.2.m2.4c">{\bm{y}}_{&lt;t}=\{y_{1},y_{2},\ldots,y_{t-1}\}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.2.m2.4d">bold_italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT = { italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT }</annotation></semantics></math>, the vanilla NMT predicts the next target word <math alttext="y_{t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.3.m3.1"><semantics id="S2.SS0.SSS0.Px1.p1.3.m3.1a"><msub id="S2.SS0.SSS0.Px1.p1.3.m3.1.1" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.2" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml">y</mi><mi id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.3" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.3.m3.1b"><apply id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.2">𝑦</ci><ci id="S2.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.3.m3.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.3.m3.1c">y_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.3.m3.1d">italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> by:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{c}(y_{t}|{\bm{x}},{\bm{y}}_{&lt;t})\propto\textrm{exp}\Big{(}q({\bm{h}}_{t})%
\Big{)}" class="ltx_Math" display="block" id="S2.E1.m1.3"><semantics id="S2.E1.m1.3a"><mrow id="S2.E1.m1.3.3" xref="S2.E1.m1.3.3.cmml"><mrow id="S2.E1.m1.2.2.1" xref="S2.E1.m1.2.2.1.cmml"><msub id="S2.E1.m1.2.2.1.3" xref="S2.E1.m1.2.2.1.3.cmml"><mi id="S2.E1.m1.2.2.1.3.2" xref="S2.E1.m1.2.2.1.3.2.cmml">p</mi><mi id="S2.E1.m1.2.2.1.3.3" xref="S2.E1.m1.2.2.1.3.3.cmml">c</mi></msub><mo id="S2.E1.m1.2.2.1.2" xref="S2.E1.m1.2.2.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.2.2.1.1.1" xref="S2.E1.m1.2.2.1.1.1.1.cmml"><mo id="S2.E1.m1.2.2.1.1.1.2" stretchy="false" xref="S2.E1.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S2.E1.m1.2.2.1.1.1.1" xref="S2.E1.m1.2.2.1.1.1.1.cmml"><msub id="S2.E1.m1.2.2.1.1.1.1.3" xref="S2.E1.m1.2.2.1.1.1.1.3.cmml"><mi id="S2.E1.m1.2.2.1.1.1.1.3.2" xref="S2.E1.m1.2.2.1.1.1.1.3.2.cmml">y</mi><mi id="S2.E1.m1.2.2.1.1.1.1.3.3" xref="S2.E1.m1.2.2.1.1.1.1.3.3.cmml">t</mi></msub><mo fence="false" id="S2.E1.m1.2.2.1.1.1.1.2" xref="S2.E1.m1.2.2.1.1.1.1.2.cmml">|</mo><mrow id="S2.E1.m1.2.2.1.1.1.1.1.1" xref="S2.E1.m1.2.2.1.1.1.1.1.2.cmml"><mi id="S2.E1.m1.1.1" xref="S2.E1.m1.1.1.cmml">𝒙</mi><mo id="S2.E1.m1.2.2.1.1.1.1.1.1.2" xref="S2.E1.m1.2.2.1.1.1.1.1.2.cmml">,</mo><msub id="S2.E1.m1.2.2.1.1.1.1.1.1.1" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="S2.E1.m1.2.2.1.1.1.1.1.1.1.2" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.2.cmml">𝒚</mi><mrow id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.2" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.1" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.3" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub></mrow></mrow><mo id="S2.E1.m1.2.2.1.1.1.3" stretchy="false" xref="S2.E1.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E1.m1.3.3.3" xref="S2.E1.m1.3.3.3.cmml">∝</mo><mrow id="S2.E1.m1.3.3.2" xref="S2.E1.m1.3.3.2.cmml"><mtext id="S2.E1.m1.3.3.2.3" xref="S2.E1.m1.3.3.2.3a.cmml">exp</mtext><mo id="S2.E1.m1.3.3.2.2" xref="S2.E1.m1.3.3.2.2.cmml">⁢</mo><mrow id="S2.E1.m1.3.3.2.1.1" xref="S2.E1.m1.3.3.2.1.1.1.cmml"><mo id="S2.E1.m1.3.3.2.1.1.2" maxsize="160%" minsize="160%" xref="S2.E1.m1.3.3.2.1.1.1.cmml">(</mo><mrow id="S2.E1.m1.3.3.2.1.1.1" xref="S2.E1.m1.3.3.2.1.1.1.cmml"><mi id="S2.E1.m1.3.3.2.1.1.1.3" xref="S2.E1.m1.3.3.2.1.1.1.3.cmml">q</mi><mo id="S2.E1.m1.3.3.2.1.1.1.2" xref="S2.E1.m1.3.3.2.1.1.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.3.3.2.1.1.1.1.1" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.cmml"><mo id="S2.E1.m1.3.3.2.1.1.1.1.1.2" stretchy="false" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.cmml">(</mo><msub id="S2.E1.m1.3.3.2.1.1.1.1.1.1" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.cmml"><mi id="S2.E1.m1.3.3.2.1.1.1.1.1.1.2" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.2.cmml">𝒉</mi><mi id="S2.E1.m1.3.3.2.1.1.1.1.1.1.3" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="S2.E1.m1.3.3.2.1.1.1.1.1.3" stretchy="false" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E1.m1.3.3.2.1.1.3" maxsize="160%" minsize="160%" xref="S2.E1.m1.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m1.3b"><apply id="S2.E1.m1.3.3.cmml" xref="S2.E1.m1.3.3"><csymbol cd="latexml" id="S2.E1.m1.3.3.3.cmml" xref="S2.E1.m1.3.3.3">proportional-to</csymbol><apply id="S2.E1.m1.2.2.1.cmml" xref="S2.E1.m1.2.2.1"><times id="S2.E1.m1.2.2.1.2.cmml" xref="S2.E1.m1.2.2.1.2"></times><apply id="S2.E1.m1.2.2.1.3.cmml" xref="S2.E1.m1.2.2.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.2.2.1.3.1.cmml" xref="S2.E1.m1.2.2.1.3">subscript</csymbol><ci id="S2.E1.m1.2.2.1.3.2.cmml" xref="S2.E1.m1.2.2.1.3.2">𝑝</ci><ci id="S2.E1.m1.2.2.1.3.3.cmml" xref="S2.E1.m1.2.2.1.3.3">𝑐</ci></apply><apply id="S2.E1.m1.2.2.1.1.1.1.cmml" xref="S2.E1.m1.2.2.1.1.1"><csymbol cd="latexml" id="S2.E1.m1.2.2.1.1.1.1.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.2">conditional</csymbol><apply id="S2.E1.m1.2.2.1.1.1.1.3.cmml" xref="S2.E1.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.2.2.1.1.1.1.3.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1.3">subscript</csymbol><ci id="S2.E1.m1.2.2.1.1.1.1.3.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.3.2">𝑦</ci><ci id="S2.E1.m1.2.2.1.1.1.1.3.3.cmml" xref="S2.E1.m1.2.2.1.1.1.1.3.3">𝑡</ci></apply><list id="S2.E1.m1.2.2.1.1.1.1.1.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1"><ci id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1">𝒙</ci><apply id="S2.E1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E1.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.2">𝒚</ci><apply id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3"><lt id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.3.cmml" xref="S2.E1.m1.2.2.1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></list></apply></apply><apply id="S2.E1.m1.3.3.2.cmml" xref="S2.E1.m1.3.3.2"><times id="S2.E1.m1.3.3.2.2.cmml" xref="S2.E1.m1.3.3.2.2"></times><ci id="S2.E1.m1.3.3.2.3a.cmml" xref="S2.E1.m1.3.3.2.3"><mtext id="S2.E1.m1.3.3.2.3.cmml" xref="S2.E1.m1.3.3.2.3">exp</mtext></ci><apply id="S2.E1.m1.3.3.2.1.1.1.cmml" xref="S2.E1.m1.3.3.2.1.1"><times id="S2.E1.m1.3.3.2.1.1.1.2.cmml" xref="S2.E1.m1.3.3.2.1.1.1.2"></times><ci id="S2.E1.m1.3.3.2.1.1.1.3.cmml" xref="S2.E1.m1.3.3.2.1.1.1.3">𝑞</ci><apply id="S2.E1.m1.3.3.2.1.1.1.1.1.1.cmml" xref="S2.E1.m1.3.3.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.3.3.2.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.3.3.2.1.1.1.1.1">subscript</csymbol><ci id="S2.E1.m1.3.3.2.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.2">𝒉</ci><ci id="S2.E1.m1.3.3.2.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.3.3.2.1.1.1.1.1.1.3">𝑡</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.3c">p_{c}(y_{t}|{\bm{x}},{\bm{y}}_{&lt;t})\propto\textrm{exp}\Big{(}q({\bm{h}}_{t})%
\Big{)}</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.3d">italic_p start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT | bold_italic_x , bold_italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ) ∝ exp ( italic_q ( bold_italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.11">where <math alttext="{\bm{h}}_{t}=f_{\theta}({\bm{x}},{\bm{y}}_{&lt;t})\in\mathcal{R}^{d}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.4.m1.2"><semantics id="S2.SS0.SSS0.Px1.p1.4.m1.2a"><mrow id="S2.SS0.SSS0.Px1.p1.4.m1.2.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.cmml"><msub id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.2.cmml">𝒉</mi><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.3.cmml">t</mi></msub><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.4" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.4.cmml">=</mo><mrow id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.cmml"><msub id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.2.cmml">f</mi><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.3.cmml">θ</mi></msub><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.2.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.2" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px1.p1.4.m1.1.1" xref="S2.SS0.SSS0.Px1.p1.4.m1.1.1.cmml">𝒙</mi><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.2.cmml">,</mo><msub id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.2.cmml">𝒚</mi><mrow id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.1" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.3.cmml">t</mi></mrow></msub><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.4" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow><mo id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.5" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.5.cmml">∈</mo><msup id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.2" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.2.cmml">ℛ</mi><mi id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.3" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.4.m1.2b"><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2"><and id="S2.SS0.SSS0.Px1.p1.4.m1.2.2a.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2"></and><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2b.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2"><eq id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.4.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.4"></eq><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.2">𝒉</ci><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.3.3">𝑡</ci></apply><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1"><times id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.2"></times><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.2">𝑓</ci><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.3.3">𝜃</ci></apply><interval closure="open" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1"><ci id="S2.SS0.SSS0.Px1.p1.4.m1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.1.1">𝒙</ci><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.2">𝒚</ci><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3"><lt id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.1.1.1.3.3">𝑡</ci></apply></apply></interval></apply></apply><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2c.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2"><in id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.5.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.5"></in><share href="#S2.SS0.SSS0.Px1.p1.4.m1.2.2.1.cmml" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2d.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2"></share><apply id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.1.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6">superscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.2.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.2">ℛ</ci><ci id="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.3.cmml" xref="S2.SS0.SSS0.Px1.p1.4.m1.2.2.6.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.4.m1.2c">{\bm{h}}_{t}=f_{\theta}({\bm{x}},{\bm{y}}_{&lt;t})\in\mathcal{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.4.m1.2d">bold_italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( bold_italic_x , bold_italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ) ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> is the context vector at step <math alttext="t" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.5.m2.1"><semantics id="S2.SS0.SSS0.Px1.p1.5.m2.1a"><mi id="S2.SS0.SSS0.Px1.p1.5.m2.1.1" xref="S2.SS0.SSS0.Px1.p1.5.m2.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.5.m2.1b"><ci id="S2.SS0.SSS0.Px1.p1.5.m2.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.5.m2.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.5.m2.1c">t</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.5.m2.1d">italic_t</annotation></semantics></math> with respect to <math alttext="{\bm{x}}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.6.m3.1"><semantics id="S2.SS0.SSS0.Px1.p1.6.m3.1a"><mi id="S2.SS0.SSS0.Px1.p1.6.m3.1.1" xref="S2.SS0.SSS0.Px1.p1.6.m3.1.1.cmml">𝒙</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.6.m3.1b"><ci id="S2.SS0.SSS0.Px1.p1.6.m3.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.6.m3.1.1">𝒙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.6.m3.1c">{\bm{x}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.6.m3.1d">bold_italic_x</annotation></semantics></math> and <math alttext="{\bm{y}}_{&lt;t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.7.m4.1"><semantics id="S2.SS0.SSS0.Px1.p1.7.m4.1a"><msub id="S2.SS0.SSS0.Px1.p1.7.m4.1.1" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.2" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.2.cmml">𝒚</mi><mrow id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.2" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.1" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.3" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.7.m4.1b"><apply id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.2">𝒚</ci><apply id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3"><lt id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px1.p1.7.m4.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.7.m4.1c">{\bm{y}}_{&lt;t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.7.m4.1d">bold_italic_y start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT</annotation></semantics></math>; <math alttext="f_{\theta}(\cdot)" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.8.m5.1"><semantics id="S2.SS0.SSS0.Px1.p1.8.m5.1a"><mrow id="S2.SS0.SSS0.Px1.p1.8.m5.1.2" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.cmml"><msub id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.2" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.2.cmml">f</mi><mi id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.3" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.3.cmml">θ</mi></msub><mo id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.1" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.1.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.3.2" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.3.2.1" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.cmml">(</mo><mo id="S2.SS0.SSS0.Px1.p1.8.m5.1.1" lspace="0em" rspace="0em" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.1.cmml">⋅</mo><mo id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.3.2.2" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.8.m5.1b"><apply id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2"><times id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.1"></times><apply id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.2">𝑓</ci><ci id="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.3.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.2.2.3">𝜃</ci></apply><ci id="S2.SS0.SSS0.Px1.p1.8.m5.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.8.m5.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.8.m5.1c">f_{\theta}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.8.m5.1d">italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> can be arbitrary encoder-decoder network with parameters <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.9.m6.1"><semantics id="S2.SS0.SSS0.Px1.p1.9.m6.1a"><mi id="S2.SS0.SSS0.Px1.p1.9.m6.1.1" xref="S2.SS0.SSS0.Px1.p1.9.m6.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.9.m6.1b"><ci id="S2.SS0.SSS0.Px1.p1.9.m6.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.9.m6.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.9.m6.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.9.m6.1d">italic_θ</annotation></semantics></math>, such as Transformer <cite class="ltx_cite ltx_citemacro_cite">Vaswani et al. (<a class="ltx_ref" href="#bib.bib12" title="">2017</a>)</cite>; <math alttext="q(\cdot)" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.10.m7.1"><semantics id="S2.SS0.SSS0.Px1.p1.10.m7.1a"><mrow id="S2.SS0.SSS0.Px1.p1.10.m7.1.2" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.cmml"><mi id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.2" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.2.cmml">q</mi><mo id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.1" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.1.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.3.2" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.cmml"><mo id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.3.2.1" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.cmml">(</mo><mo id="S2.SS0.SSS0.Px1.p1.10.m7.1.1" lspace="0em" rspace="0em" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.1.cmml">⋅</mo><mo id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.3.2.2" stretchy="false" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.10.m7.1b"><apply id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2"><times id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.1.cmml" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.1"></times><ci id="S2.SS0.SSS0.Px1.p1.10.m7.1.2.2.cmml" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.2.2">𝑞</ci><ci id="S2.SS0.SSS0.Px1.p1.10.m7.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.10.m7.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.10.m7.1c">q(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.10.m7.1d">italic_q ( ⋅ )</annotation></semantics></math> linearly projects <math alttext="{\bm{h}}_{t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px1.p1.11.m8.1"><semantics id="S2.SS0.SSS0.Px1.p1.11.m8.1a"><msub id="S2.SS0.SSS0.Px1.p1.11.m8.1.1" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1.cmml"><mi id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.2" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1.2.cmml">𝒉</mi><mi id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.3" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px1.p1.11.m8.1b"><apply id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.1.cmml" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.2.cmml" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1.2">𝒉</ci><ci id="S2.SS0.SSS0.Px1.p1.11.m8.1.1.3.cmml" xref="S2.SS0.SSS0.Px1.p1.11.m8.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px1.p1.11.m8.1c">{\bm{h}}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px1.p1.11.m8.1d">bold_italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> to target vocabulary size.
</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px2">
<h3 class="ltx_title ltx_title_paragraph">
<span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.1.1">k</span>NN-MT </h3>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.2"><span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p1.2.1">k</span>NN-MT hypothesizes that the same target words have similar representations.
To dynamically incorporate external sentence pairs <math alttext="\mathcal{D}=\{({\bm{x}}^{(i)},{\bm{y}}^{(i)})\}_{i=1}^{|\mathcal{D}|}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.1.m1.4"><semantics id="S2.SS0.SSS0.Px2.p1.1.m1.4a"><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.4.4" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.3.cmml">𝒟</mi><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.2.cmml">=</mo><msubsup id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.cmml"><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.2.cmml">{</mo><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.3.cmml"><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.3.cmml">(</mo><msup id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.2.cmml">𝒙</mi><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.cmml"><mo id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.cmml">)</mo></mrow></msup><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.4" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.3.cmml">,</mo><msup id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.cmml"><mi id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.2.cmml">𝒚</mi><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.cmml"><mo id="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.cmml">)</mo></mrow></msup><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.5" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.2.cmml">}</mo></mrow><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.2" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.2.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.1.cmml">=</mo><mn id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.3.cmml">1</mn></mrow><mrow id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.3" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.1" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.1.cmml">𝒟</mi><mo id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.2.1.cmml">|</mo></mrow></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.1.m1.4b"><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4"><eq id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.2"></eq><ci id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.3.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.3">𝒟</ci><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1">superscript</csymbol><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1">subscript</csymbol><set id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1"><interval closure="open" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2"><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.1.1.2">𝒙</ci><ci id="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.1.1.1.1">𝑖</ci></apply><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.1.1.1.2.2.2">𝒚</ci><ci id="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.2.2.1.1">𝑖</ci></apply></interval></set><apply id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3"><eq id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.1"></eq><ci id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.2">𝑖</ci><cn id="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.3.cmml" type="integer" xref="S2.SS0.SSS0.Px2.p1.1.m1.4.4.1.1.3.3">1</cn></apply></apply><apply id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.3"><abs id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.3.1"></abs><ci id="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.1.m1.3.3.1.1">𝒟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.1.m1.4c">\mathcal{D}=\{({\bm{x}}^{(i)},{\bm{y}}^{(i)})\}_{i=1}^{|\mathcal{D}|}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p1.1.m1.4d">caligraphic_D = { ( bold_italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , bold_italic_y start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT ) } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | caligraphic_D | end_POSTSUPERSCRIPT</annotation></semantics></math>, <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p1.2.2">k</span>NN-MT extends Eq. <a class="ltx_ref" href="#S2.E1" title="1 ‣ Vanilla NMT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a> by interpolating a retrieval-based probability <math alttext="p_{r}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.2.m2.1"><semantics id="S2.SS0.SSS0.Px2.p1.2.m2.1a"><msub id="S2.SS0.SSS0.Px2.p1.2.m2.1.1" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml">p</mi><mi id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.2.m2.1b"><apply id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.2">𝑝</ci><ci id="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p1.2.m2.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.2.m2.1c">p_{r}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p1.2.m2.1d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{knn}=(1-\lambda)\times p_{c}+\lambda\times p_{r}" class="ltx_Math" display="block" id="S2.E2.m1.1"><semantics id="S2.E2.m1.1a"><mrow id="S2.E2.m1.1.1" xref="S2.E2.m1.1.1.cmml"><msub id="S2.E2.m1.1.1.3" xref="S2.E2.m1.1.1.3.cmml"><mi id="S2.E2.m1.1.1.3.2" xref="S2.E2.m1.1.1.3.2.cmml">p</mi><mrow id="S2.E2.m1.1.1.3.3" xref="S2.E2.m1.1.1.3.3.cmml"><mi id="S2.E2.m1.1.1.3.3.2" xref="S2.E2.m1.1.1.3.3.2.cmml">k</mi><mo id="S2.E2.m1.1.1.3.3.1" xref="S2.E2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S2.E2.m1.1.1.3.3.3" xref="S2.E2.m1.1.1.3.3.3.cmml">n</mi><mo id="S2.E2.m1.1.1.3.3.1a" xref="S2.E2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S2.E2.m1.1.1.3.3.4" xref="S2.E2.m1.1.1.3.3.4.cmml">n</mi></mrow></msub><mo id="S2.E2.m1.1.1.2" xref="S2.E2.m1.1.1.2.cmml">=</mo><mrow id="S2.E2.m1.1.1.1" xref="S2.E2.m1.1.1.1.cmml"><mrow id="S2.E2.m1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml"><mrow id="S2.E2.m1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.1.1.1.cmml"><mo id="S2.E2.m1.1.1.1.1.1.1.2" stretchy="false" xref="S2.E2.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E2.m1.1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.1.1.1.cmml"><mn id="S2.E2.m1.1.1.1.1.1.1.1.2" xref="S2.E2.m1.1.1.1.1.1.1.1.2.cmml">1</mn><mo id="S2.E2.m1.1.1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.1.1.1.1.cmml">−</mo><mi id="S2.E2.m1.1.1.1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.1.1.1.3.cmml">λ</mi></mrow><mo id="S2.E2.m1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S2.E2.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.E2.m1.1.1.1.1.2" rspace="0.222em" xref="S2.E2.m1.1.1.1.1.2.cmml">×</mo><msub id="S2.E2.m1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.3.cmml"><mi id="S2.E2.m1.1.1.1.1.3.2" xref="S2.E2.m1.1.1.1.1.3.2.cmml">p</mi><mi id="S2.E2.m1.1.1.1.1.3.3" xref="S2.E2.m1.1.1.1.1.3.3.cmml">c</mi></msub></mrow><mo id="S2.E2.m1.1.1.1.2" xref="S2.E2.m1.1.1.1.2.cmml">+</mo><mrow id="S2.E2.m1.1.1.1.3" xref="S2.E2.m1.1.1.1.3.cmml"><mi id="S2.E2.m1.1.1.1.3.2" xref="S2.E2.m1.1.1.1.3.2.cmml">λ</mi><mo id="S2.E2.m1.1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S2.E2.m1.1.1.1.3.1.cmml">×</mo><msub id="S2.E2.m1.1.1.1.3.3" xref="S2.E2.m1.1.1.1.3.3.cmml"><mi id="S2.E2.m1.1.1.1.3.3.2" xref="S2.E2.m1.1.1.1.3.3.2.cmml">p</mi><mi id="S2.E2.m1.1.1.1.3.3.3" xref="S2.E2.m1.1.1.1.3.3.3.cmml">r</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m1.1b"><apply id="S2.E2.m1.1.1.cmml" xref="S2.E2.m1.1.1"><eq id="S2.E2.m1.1.1.2.cmml" xref="S2.E2.m1.1.1.2"></eq><apply id="S2.E2.m1.1.1.3.cmml" xref="S2.E2.m1.1.1.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.3.1.cmml" xref="S2.E2.m1.1.1.3">subscript</csymbol><ci id="S2.E2.m1.1.1.3.2.cmml" xref="S2.E2.m1.1.1.3.2">𝑝</ci><apply id="S2.E2.m1.1.1.3.3.cmml" xref="S2.E2.m1.1.1.3.3"><times id="S2.E2.m1.1.1.3.3.1.cmml" xref="S2.E2.m1.1.1.3.3.1"></times><ci id="S2.E2.m1.1.1.3.3.2.cmml" xref="S2.E2.m1.1.1.3.3.2">𝑘</ci><ci id="S2.E2.m1.1.1.3.3.3.cmml" xref="S2.E2.m1.1.1.3.3.3">𝑛</ci><ci id="S2.E2.m1.1.1.3.3.4.cmml" xref="S2.E2.m1.1.1.3.3.4">𝑛</ci></apply></apply><apply id="S2.E2.m1.1.1.1.cmml" xref="S2.E2.m1.1.1.1"><plus id="S2.E2.m1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.2"></plus><apply id="S2.E2.m1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1"><times id="S2.E2.m1.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.2"></times><apply id="S2.E2.m1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1"><minus id="S2.E2.m1.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1"></minus><cn id="S2.E2.m1.1.1.1.1.1.1.1.2.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.1.1.1.2">1</cn><ci id="S2.E2.m1.1.1.1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.3">𝜆</ci></apply><apply id="S2.E2.m1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.3.1.cmml" xref="S2.E2.m1.1.1.1.1.3">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.3.2.cmml" xref="S2.E2.m1.1.1.1.1.3.2">𝑝</ci><ci id="S2.E2.m1.1.1.1.1.3.3.cmml" xref="S2.E2.m1.1.1.1.1.3.3">𝑐</ci></apply></apply><apply id="S2.E2.m1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.3"><times id="S2.E2.m1.1.1.1.3.1.cmml" xref="S2.E2.m1.1.1.1.3.1"></times><ci id="S2.E2.m1.1.1.1.3.2.cmml" xref="S2.E2.m1.1.1.1.3.2">𝜆</ci><apply id="S2.E2.m1.1.1.1.3.3.cmml" xref="S2.E2.m1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.3.3.1.cmml" xref="S2.E2.m1.1.1.1.3.3">subscript</csymbol><ci id="S2.E2.m1.1.1.1.3.3.2.cmml" xref="S2.E2.m1.1.1.1.3.3.2">𝑝</ci><ci id="S2.E2.m1.1.1.1.3.3.3.cmml" xref="S2.E2.m1.1.1.1.3.3.3">𝑟</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m1.1c">p_{knn}=(1-\lambda)\times p_{c}+\lambda\times p_{r}</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.1d">italic_p start_POSTSUBSCRIPT italic_k italic_n italic_n end_POSTSUBSCRIPT = ( 1 - italic_λ ) × italic_p start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT + italic_λ × italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.3">where <math alttext="\lambda" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p1.3.m1.1"><semantics id="S2.SS0.SSS0.Px2.p1.3.m1.1a"><mi id="S2.SS0.SSS0.Px2.p1.3.m1.1.1" xref="S2.SS0.SSS0.Px2.p1.3.m1.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p1.3.m1.1b"><ci id="S2.SS0.SSS0.Px2.p1.3.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p1.3.m1.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p1.3.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p1.3.m1.1d">italic_λ</annotation></semantics></math> is the interpolation coefficient as a hyper-parameter.</p>
</div>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p2">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p2.2">Specifically, <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p2.2.1">k</span>NN-MT first uses a pre-trained NMT model to force decoding each sentence pair <math alttext="({\bm{x}}^{(i)},{\bm{y}}^{(i)})" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.1.m1.4"><semantics id="S2.SS0.SSS0.Px2.p2.1.m1.4a"><mrow id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.3.cmml"><mo id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.3.cmml">(</mo><msup id="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.2" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.2.cmml">𝒙</mi><mrow id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.cmml"><mo id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.cmml">)</mo></mrow></msup><mo id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.4" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.3.cmml">,</mo><msup id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.2" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.2.cmml">𝒚</mi><mrow id="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.3" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.1" xref="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.cmml">)</mo></mrow></msup><mo id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.5" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.1.m1.4b"><interval closure="open" id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.3.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2"><apply id="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.3.3.1.1.2">𝒙</ci><ci id="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.1.1.1.1">𝑖</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.4.4.2.2.2">𝒚</ci><ci id="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.1.m1.2.2.1.1">𝑖</ci></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.1.m1.4c">({\bm{x}}^{(i)},{\bm{y}}^{(i)})</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.1.m1.4d">( bold_italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , bold_italic_y start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT )</annotation></semantics></math> to build a key-value datastore <math alttext="\mathcal{H}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.2.m2.1"><semantics id="S2.SS0.SSS0.Px2.p2.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px2.p2.2.m2.1.1" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.2.m2.1b"><ci id="S2.SS0.SSS0.Px2.p2.2.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.2.m2.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.2.m2.1c">\mathcal{H}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.2.m2.1d">caligraphic_H</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{H}=\bigcup_{i=1}^{|\mathcal{D}|}\bigcup_{t=1}^{|{\bm{y}}^{(i)}|}\Big{%
\{}({\bm{h}}^{(i)}_{t},y_{t}^{(i)})\Big{\}}" class="ltx_Math" display="block" id="S2.E3.m1.6"><semantics id="S2.E3.m1.6a"><mrow id="S2.E3.m1.6.6" xref="S2.E3.m1.6.6.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E3.m1.6.6.3" xref="S2.E3.m1.6.6.3.cmml">ℋ</mi><mo id="S2.E3.m1.6.6.2" rspace="0.111em" xref="S2.E3.m1.6.6.2.cmml">=</mo><mrow id="S2.E3.m1.6.6.1" xref="S2.E3.m1.6.6.1.cmml"><munderover id="S2.E3.m1.6.6.1.2" xref="S2.E3.m1.6.6.1.2.cmml"><mo id="S2.E3.m1.6.6.1.2.2.2" movablelimits="false" rspace="0em" xref="S2.E3.m1.6.6.1.2.2.2.cmml">⋃</mo><mrow id="S2.E3.m1.6.6.1.2.2.3" xref="S2.E3.m1.6.6.1.2.2.3.cmml"><mi id="S2.E3.m1.6.6.1.2.2.3.2" xref="S2.E3.m1.6.6.1.2.2.3.2.cmml">i</mi><mo id="S2.E3.m1.6.6.1.2.2.3.1" xref="S2.E3.m1.6.6.1.2.2.3.1.cmml">=</mo><mn id="S2.E3.m1.6.6.1.2.2.3.3" xref="S2.E3.m1.6.6.1.2.2.3.3.cmml">1</mn></mrow><mrow id="S2.E3.m1.1.1.1.3" xref="S2.E3.m1.1.1.1.2.cmml"><mo id="S2.E3.m1.1.1.1.3.1" stretchy="false" xref="S2.E3.m1.1.1.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S2.E3.m1.1.1.1.1" xref="S2.E3.m1.1.1.1.1.cmml">𝒟</mi><mo id="S2.E3.m1.1.1.1.3.2" stretchy="false" xref="S2.E3.m1.1.1.1.2.1.cmml">|</mo></mrow></munderover><mrow id="S2.E3.m1.6.6.1.1" xref="S2.E3.m1.6.6.1.1.cmml"><munderover id="S2.E3.m1.6.6.1.1.2" xref="S2.E3.m1.6.6.1.1.2.cmml"><mo id="S2.E3.m1.6.6.1.1.2.2.2" movablelimits="false" rspace="0em" xref="S2.E3.m1.6.6.1.1.2.2.2.cmml">⋃</mo><mrow id="S2.E3.m1.6.6.1.1.2.2.3" xref="S2.E3.m1.6.6.1.1.2.2.3.cmml"><mi id="S2.E3.m1.6.6.1.1.2.2.3.2" xref="S2.E3.m1.6.6.1.1.2.2.3.2.cmml">t</mi><mo id="S2.E3.m1.6.6.1.1.2.2.3.1" xref="S2.E3.m1.6.6.1.1.2.2.3.1.cmml">=</mo><mn id="S2.E3.m1.6.6.1.1.2.2.3.3" xref="S2.E3.m1.6.6.1.1.2.2.3.3.cmml">1</mn></mrow><mrow id="S2.E3.m1.3.3.2.2" xref="S2.E3.m1.3.3.2.3.cmml"><mo id="S2.E3.m1.3.3.2.2.2" stretchy="false" xref="S2.E3.m1.3.3.2.3.1.cmml">|</mo><msup id="S2.E3.m1.3.3.2.2.1" xref="S2.E3.m1.3.3.2.2.1.cmml"><mi id="S2.E3.m1.3.3.2.2.1.2" xref="S2.E3.m1.3.3.2.2.1.2.cmml">𝒚</mi><mrow id="S2.E3.m1.2.2.1.1.1.3" xref="S2.E3.m1.3.3.2.2.1.cmml"><mo id="S2.E3.m1.2.2.1.1.1.3.1" stretchy="false" xref="S2.E3.m1.3.3.2.2.1.cmml">(</mo><mi id="S2.E3.m1.2.2.1.1.1.1" xref="S2.E3.m1.2.2.1.1.1.1.cmml">i</mi><mo id="S2.E3.m1.2.2.1.1.1.3.2" stretchy="false" xref="S2.E3.m1.3.3.2.2.1.cmml">)</mo></mrow></msup><mo id="S2.E3.m1.3.3.2.2.3" stretchy="false" xref="S2.E3.m1.3.3.2.3.1.cmml">|</mo></mrow></munderover><mrow id="S2.E3.m1.6.6.1.1.1.1" xref="S2.E3.m1.6.6.1.1.1.2.cmml"><mo id="S2.E3.m1.6.6.1.1.1.1.2" maxsize="160%" minsize="160%" xref="S2.E3.m1.6.6.1.1.1.2.cmml">{</mo><mrow id="S2.E3.m1.6.6.1.1.1.1.1.2" xref="S2.E3.m1.6.6.1.1.1.1.1.3.cmml"><mo id="S2.E3.m1.6.6.1.1.1.1.1.2.3" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.3.cmml">(</mo><msubsup id="S2.E3.m1.6.6.1.1.1.1.1.1.1" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.cmml"><mi id="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.2" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.2.cmml">𝒉</mi><mi id="S2.E3.m1.6.6.1.1.1.1.1.1.1.3" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.3.cmml">t</mi><mrow id="S2.E3.m1.4.4.1.3" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.cmml"><mo id="S2.E3.m1.4.4.1.3.1" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.cmml">(</mo><mi id="S2.E3.m1.4.4.1.1" xref="S2.E3.m1.4.4.1.1.cmml">i</mi><mo id="S2.E3.m1.4.4.1.3.2" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.cmml">)</mo></mrow></msubsup><mo id="S2.E3.m1.6.6.1.1.1.1.1.2.4" xref="S2.E3.m1.6.6.1.1.1.1.1.3.cmml">,</mo><msubsup id="S2.E3.m1.6.6.1.1.1.1.1.2.2" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.cmml"><mi id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.2" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.3" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.3.cmml">t</mi><mrow id="S2.E3.m1.5.5.1.3" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.cmml"><mo id="S2.E3.m1.5.5.1.3.1" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.cmml">(</mo><mi id="S2.E3.m1.5.5.1.1" xref="S2.E3.m1.5.5.1.1.cmml">i</mi><mo id="S2.E3.m1.5.5.1.3.2" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.cmml">)</mo></mrow></msubsup><mo id="S2.E3.m1.6.6.1.1.1.1.1.2.5" stretchy="false" xref="S2.E3.m1.6.6.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S2.E3.m1.6.6.1.1.1.1.3" maxsize="160%" minsize="160%" xref="S2.E3.m1.6.6.1.1.1.2.cmml">}</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m1.6b"><apply id="S2.E3.m1.6.6.cmml" xref="S2.E3.m1.6.6"><eq id="S2.E3.m1.6.6.2.cmml" xref="S2.E3.m1.6.6.2"></eq><ci id="S2.E3.m1.6.6.3.cmml" xref="S2.E3.m1.6.6.3">ℋ</ci><apply id="S2.E3.m1.6.6.1.cmml" xref="S2.E3.m1.6.6.1"><apply id="S2.E3.m1.6.6.1.2.cmml" xref="S2.E3.m1.6.6.1.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.2.1.cmml" xref="S2.E3.m1.6.6.1.2">superscript</csymbol><apply id="S2.E3.m1.6.6.1.2.2.cmml" xref="S2.E3.m1.6.6.1.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.2.2.1.cmml" xref="S2.E3.m1.6.6.1.2">subscript</csymbol><union id="S2.E3.m1.6.6.1.2.2.2.cmml" xref="S2.E3.m1.6.6.1.2.2.2"></union><apply id="S2.E3.m1.6.6.1.2.2.3.cmml" xref="S2.E3.m1.6.6.1.2.2.3"><eq id="S2.E3.m1.6.6.1.2.2.3.1.cmml" xref="S2.E3.m1.6.6.1.2.2.3.1"></eq><ci id="S2.E3.m1.6.6.1.2.2.3.2.cmml" xref="S2.E3.m1.6.6.1.2.2.3.2">𝑖</ci><cn id="S2.E3.m1.6.6.1.2.2.3.3.cmml" type="integer" xref="S2.E3.m1.6.6.1.2.2.3.3">1</cn></apply></apply><apply id="S2.E3.m1.1.1.1.2.cmml" xref="S2.E3.m1.1.1.1.3"><abs id="S2.E3.m1.1.1.1.2.1.cmml" xref="S2.E3.m1.1.1.1.3.1"></abs><ci id="S2.E3.m1.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1">𝒟</ci></apply></apply><apply id="S2.E3.m1.6.6.1.1.cmml" xref="S2.E3.m1.6.6.1.1"><apply id="S2.E3.m1.6.6.1.1.2.cmml" xref="S2.E3.m1.6.6.1.1.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.2.1.cmml" xref="S2.E3.m1.6.6.1.1.2">superscript</csymbol><apply id="S2.E3.m1.6.6.1.1.2.2.cmml" xref="S2.E3.m1.6.6.1.1.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.2.2.1.cmml" xref="S2.E3.m1.6.6.1.1.2">subscript</csymbol><union id="S2.E3.m1.6.6.1.1.2.2.2.cmml" xref="S2.E3.m1.6.6.1.1.2.2.2"></union><apply id="S2.E3.m1.6.6.1.1.2.2.3.cmml" xref="S2.E3.m1.6.6.1.1.2.2.3"><eq id="S2.E3.m1.6.6.1.1.2.2.3.1.cmml" xref="S2.E3.m1.6.6.1.1.2.2.3.1"></eq><ci id="S2.E3.m1.6.6.1.1.2.2.3.2.cmml" xref="S2.E3.m1.6.6.1.1.2.2.3.2">𝑡</ci><cn id="S2.E3.m1.6.6.1.1.2.2.3.3.cmml" type="integer" xref="S2.E3.m1.6.6.1.1.2.2.3.3">1</cn></apply></apply><apply id="S2.E3.m1.3.3.2.3.cmml" xref="S2.E3.m1.3.3.2.2"><abs id="S2.E3.m1.3.3.2.3.1.cmml" xref="S2.E3.m1.3.3.2.2.2"></abs><apply id="S2.E3.m1.3.3.2.2.1.cmml" xref="S2.E3.m1.3.3.2.2.1"><csymbol cd="ambiguous" id="S2.E3.m1.3.3.2.2.1.1.cmml" xref="S2.E3.m1.3.3.2.2.1">superscript</csymbol><ci id="S2.E3.m1.3.3.2.2.1.2.cmml" xref="S2.E3.m1.3.3.2.2.1.2">𝒚</ci><ci id="S2.E3.m1.2.2.1.1.1.1.cmml" xref="S2.E3.m1.2.2.1.1.1.1">𝑖</ci></apply></apply></apply><set id="S2.E3.m1.6.6.1.1.1.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1"><interval closure="open" id="S2.E3.m1.6.6.1.1.1.1.1.3.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2"><apply id="S2.E3.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1">superscript</csymbol><ci id="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.2.2">𝒉</ci><ci id="S2.E3.m1.4.4.1.1.cmml" xref="S2.E3.m1.4.4.1.1">𝑖</ci></apply><ci id="S2.E3.m1.6.6.1.1.1.1.1.1.1.3.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.1.1.3">𝑡</ci></apply><apply id="S2.E3.m1.6.6.1.1.1.1.1.2.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.1.1.1.2.2.1.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2">superscript</csymbol><apply id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.1.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2">subscript</csymbol><ci id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.2.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.3.cmml" xref="S2.E3.m1.6.6.1.1.1.1.1.2.2.2.3">𝑡</ci></apply><ci id="S2.E3.m1.5.5.1.1.cmml" xref="S2.E3.m1.5.5.1.1">𝑖</ci></apply></interval></set></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m1.6c">\mathcal{H}=\bigcup_{i=1}^{|\mathcal{D}|}\bigcup_{t=1}^{|{\bm{y}}^{(i)}|}\Big{%
\{}({\bm{h}}^{(i)}_{t},y_{t}^{(i)})\Big{\}}</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m1.6d">caligraphic_H = ⋃ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | caligraphic_D | end_POSTSUPERSCRIPT ⋃ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | bold_italic_y start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT | end_POSTSUPERSCRIPT { ( bold_italic_h start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT ) }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p2.10">The key is the word-level context representation <math alttext="{\bm{h}}^{(i)}_{t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.3.m1.1"><semantics id="S2.SS0.SSS0.Px2.p2.3.m1.1a"><msubsup id="S2.SS0.SSS0.Px2.p2.3.m1.1.2" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.2" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.2.cmml">𝒉</mi><mi id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.3" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.3.cmml">t</mi><mrow id="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.cmml">)</mo></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.3.m1.1b"><apply id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.2.2">𝒉</ci><ci id="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.1.1.1">𝑖</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.3.m1.1.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.3.m1.1.2.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.3.m1.1c">{\bm{h}}^{(i)}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.3.m1.1d">bold_italic_h start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> and the value is the gold target word <math alttext="y^{(i)}_{t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.4.m2.1"><semantics id="S2.SS0.SSS0.Px2.p2.4.m2.1a"><msubsup id="S2.SS0.SSS0.Px2.p2.4.m2.1.2" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.2" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.2.cmml">y</mi><mi id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.3" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.3.cmml">t</mi><mrow id="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.3.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.1.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.3.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.cmml">)</mo></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.4.m2.1b"><apply id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2">superscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.2.2">𝑦</ci><ci id="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.1.1.1">𝑖</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.4.m2.1.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.4.m2.1.2.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.4.m2.1c">y^{(i)}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.4.m2.1d">italic_y start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>.
Then, given <math alttext="\mathcal{H}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.5.m3.1"><semantics id="S2.SS0.SSS0.Px2.p2.5.m3.1a"><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px2.p2.5.m3.1.1" xref="S2.SS0.SSS0.Px2.p2.5.m3.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.5.m3.1b"><ci id="S2.SS0.SSS0.Px2.p2.5.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.5.m3.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.5.m3.1c">\mathcal{H}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.5.m3.1d">caligraphic_H</annotation></semantics></math> and predicted target prefix <math alttext="\hat{{\bm{y}}}_{&lt;t}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.6.m4.1"><semantics id="S2.SS0.SSS0.Px2.p2.6.m4.1a"><msub id="S2.SS0.SSS0.Px2.p2.6.m4.1.1" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.2.cmml">𝒚</mi><mo id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.1" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.1.cmml">^</mo></mover><mrow id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.3" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.3.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.6.m4.1b"><apply id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2"><ci id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.1">^</ci><ci id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.2.2">𝒚</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3"><lt id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.6.m4.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.6.m4.1c">\hat{{\bm{y}}}_{&lt;t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.6.m4.1d">over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT</annotation></semantics></math> at test time, <span class="ltx_text ltx_font_italic" id="S2.SS0.SSS0.Px2.p2.10.1">k</span>NN-MT models <math alttext="p_{r}(\hat{y_{t}}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.7.m5.2"><semantics id="S2.SS0.SSS0.Px2.p2.7.m5.2a"><mrow id="S2.SS0.SSS0.Px2.p2.7.m5.2.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.cmml"><msub id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.2.cmml">p</mi><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.3.cmml">r</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.2.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.cmml"><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.cmml">(</mo><mrow id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.cmml"><msub id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.3.cmml">t</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.2.cmml">|</mo><mrow id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.7.m5.1.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.1.1.cmml">𝒙</mi><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.2.cmml">,</mo><msub id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.2.cmml">𝒚</mi><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.3" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub></mrow></mrow><mo id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.7.m5.2b"><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2"><times id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.2"></times><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.2">𝑝</ci><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.3.3">𝑟</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1"><csymbol cd="latexml" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.2">conditional</csymbol><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3"><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.1">^</ci><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.2">𝑦</ci><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.3.2.3">𝑡</ci></apply></apply><list id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1"><ci id="S2.SS0.SSS0.Px2.p2.7.m5.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.1.1">𝒙</ci><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2"><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.2.2">𝒚</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3"><lt id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.7.m5.2.2.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.7.m5.2c">p_{r}(\hat{y_{t}}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.7.m5.2d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT end_ARG | bold_italic_x , over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT )</annotation></semantics></math> by measuring the distance between query <math alttext="\hat{{\bm{h}}}_{t}=f_{\theta}({\bm{x}},\hat{{\bm{y}}}_{&lt;t})" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.8.m6.2"><semantics id="S2.SS0.SSS0.Px2.p2.8.m6.2a"><mrow id="S2.SS0.SSS0.Px2.p2.8.m6.2.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.cmml"><msub id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.2.cmml">𝒉</mi><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.1.cmml">^</mo></mover><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.3.cmml">t</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.2.cmml">=</mo><mrow id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.cmml"><msub id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.2.cmml">f</mi><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.3.cmml">θ</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.2.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.2.cmml">(</mo><mi id="S2.SS0.SSS0.Px2.p2.8.m6.1.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.1.1.cmml">𝒙</mi><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.2.cmml">,</mo><msub id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.2.cmml">𝒚</mi><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.2.cmml"></mi><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.3" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.3.cmml">t</mi></mrow></msub><mo id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.4" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.8.m6.2b"><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2"><eq id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.2"></eq><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2"><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.1">^</ci><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.2.2">𝒉</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.3.3">𝑡</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1"><times id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.2"></times><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.2">𝑓</ci><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.3.3">𝜃</ci></apply><interval closure="open" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1"><ci id="S2.SS0.SSS0.Px2.p2.8.m6.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.1.1">𝒙</ci><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2"><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.1">^</ci><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.2.2">𝒚</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3"><lt id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.2">absent</csymbol><ci id="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.3.cmml" xref="S2.SS0.SSS0.Px2.p2.8.m6.2.2.1.1.1.1.3.3">𝑡</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.8.m6.2c">\hat{{\bm{h}}}_{t}=f_{\theta}({\bm{x}},\hat{{\bm{y}}}_{&lt;t})</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.8.m6.2d">over^ start_ARG bold_italic_h end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( bold_italic_x , over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT )</annotation></semantics></math> and its k-nearest representations <math alttext="\{(\tilde{{\bm{h}}}_{i},\tilde{v}_{i})\}_{i=1}^{k}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.9.m7.1"><semantics id="S2.SS0.SSS0.Px2.p2.9.m7.1a"><msubsup id="S2.SS0.SSS0.Px2.p2.9.m7.1.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.cmml"><mrow id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.2.cmml">{</mo><mrow id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.3.cmml"><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.3.cmml">(</mo><msub id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.2.cmml">𝒉</mi><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.1.cmml">~</mo></mover><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.4" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.3.cmml">,</mo><msub id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.cmml"><mover accent="true" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.2.cmml">v</mi><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.1.cmml">~</mo></mover><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.3" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.3.cmml">i</mi></msub><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.5" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.3" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.cmml"><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.2" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.2.cmml">i</mi><mo id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.1" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.1.cmml">=</mo><mn id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.3" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.3.cmml">1</mn></mrow><mi id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.3" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.3.cmml">k</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.9.m7.1b"><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1">superscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1">subscript</csymbol><set id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1"><interval closure="open" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2"><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2"><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.1">~</ci><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.2.2">𝒉</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2">subscript</csymbol><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2"><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.1">~</ci><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.2.2">𝑣</ci></apply><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.3.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.1.1.1.2.2.3">𝑖</ci></apply></interval></set><apply id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3"><eq id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.1.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.1"></eq><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.2.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.2">𝑖</ci><cn id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.3.cmml" type="integer" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.1.3.3">1</cn></apply></apply><ci id="S2.SS0.SSS0.Px2.p2.9.m7.1.1.3.cmml" xref="S2.SS0.SSS0.Px2.p2.9.m7.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.9.m7.1c">\{(\tilde{{\bm{h}}}_{i},\tilde{v}_{i})\}_{i=1}^{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.9.m7.1d">{ ( over~ start_ARG bold_italic_h end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , over~ start_ARG italic_v end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT</annotation></semantics></math> in <math alttext="\mathcal{H}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.10.m8.1"><semantics id="S2.SS0.SSS0.Px2.p2.10.m8.1a"><mi class="ltx_font_mathcaligraphic" id="S2.SS0.SSS0.Px2.p2.10.m8.1.1" xref="S2.SS0.SSS0.Px2.p2.10.m8.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.10.m8.1b"><ci id="S2.SS0.SSS0.Px2.p2.10.m8.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.10.m8.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.10.m8.1c">\mathcal{H}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.10.m8.1d">caligraphic_H</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{r}(\hat{y}_{t}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})\propto\sum_{i=1}^{k}\mathbbm{1%
}_{\hat{y}_{t}=\tilde{v}_{i}}\textrm{exp}\Big{(}\frac{-d(\tilde{{\bm{h}}}_{i},%
\hat{{\bm{h}}}_{t})}{T}\Big{)}," class="ltx_Math" display="block" id="S2.E4.m1.4"><semantics id="S2.E4.m1.4a"><mrow id="S2.E4.m1.4.4.1" xref="S2.E4.m1.4.4.1.1.cmml"><mrow id="S2.E4.m1.4.4.1.1" xref="S2.E4.m1.4.4.1.1.cmml"><mrow id="S2.E4.m1.4.4.1.1.1" xref="S2.E4.m1.4.4.1.1.1.cmml"><msub id="S2.E4.m1.4.4.1.1.1.3" xref="S2.E4.m1.4.4.1.1.1.3.cmml"><mi id="S2.E4.m1.4.4.1.1.1.3.2" xref="S2.E4.m1.4.4.1.1.1.3.2.cmml">p</mi><mi id="S2.E4.m1.4.4.1.1.1.3.3" xref="S2.E4.m1.4.4.1.1.1.3.3.cmml">r</mi></msub><mo id="S2.E4.m1.4.4.1.1.1.2" xref="S2.E4.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="S2.E4.m1.4.4.1.1.1.1.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.cmml"><mo id="S2.E4.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S2.E4.m1.4.4.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E4.m1.4.4.1.1.1.1.1.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.cmml"><msub id="S2.E4.m1.4.4.1.1.1.1.1.1.3" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.cmml"><mover accent="true" id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.cmml"><mi id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.2.cmml">y</mi><mo id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.1.cmml">^</mo></mover><mi id="S2.E4.m1.4.4.1.1.1.1.1.1.3.3" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.3.cmml">t</mi></msub><mo fence="false" id="S2.E4.m1.4.4.1.1.1.1.1.1.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.2.cmml">|</mo><mrow id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E4.m1.3.3" xref="S2.E4.m1.3.3.cmml">𝒙</mi><mo id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml">𝒚</mi><mo id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.2" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.1" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.3" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub></mrow></mrow><mo id="S2.E4.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S2.E4.m1.4.4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E4.m1.4.4.1.1.2" rspace="0.111em" xref="S2.E4.m1.4.4.1.1.2.cmml">∝</mo><mrow id="S2.E4.m1.4.4.1.1.3" xref="S2.E4.m1.4.4.1.1.3.cmml"><munderover id="S2.E4.m1.4.4.1.1.3.1" xref="S2.E4.m1.4.4.1.1.3.1.cmml"><mo id="S2.E4.m1.4.4.1.1.3.1.2.2" movablelimits="false" xref="S2.E4.m1.4.4.1.1.3.1.2.2.cmml">∑</mo><mrow id="S2.E4.m1.4.4.1.1.3.1.2.3" xref="S2.E4.m1.4.4.1.1.3.1.2.3.cmml"><mi id="S2.E4.m1.4.4.1.1.3.1.2.3.2" xref="S2.E4.m1.4.4.1.1.3.1.2.3.2.cmml">i</mi><mo id="S2.E4.m1.4.4.1.1.3.1.2.3.1" xref="S2.E4.m1.4.4.1.1.3.1.2.3.1.cmml">=</mo><mn id="S2.E4.m1.4.4.1.1.3.1.2.3.3" xref="S2.E4.m1.4.4.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="S2.E4.m1.4.4.1.1.3.1.3" xref="S2.E4.m1.4.4.1.1.3.1.3.cmml">k</mi></munderover><mrow id="S2.E4.m1.4.4.1.1.3.2" xref="S2.E4.m1.4.4.1.1.3.2.cmml"><msub id="S2.E4.m1.4.4.1.1.3.2.2" xref="S2.E4.m1.4.4.1.1.3.2.2.cmml"><mn id="S2.E4.m1.4.4.1.1.3.2.2.2" xref="S2.E4.m1.4.4.1.1.3.2.2.2.cmml">𝟙</mn><mrow id="S2.E4.m1.4.4.1.1.3.2.2.3" xref="S2.E4.m1.4.4.1.1.3.2.2.3.cmml"><msub id="S2.E4.m1.4.4.1.1.3.2.2.3.2" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.cmml"><mover accent="true" id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.cmml"><mi id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.2" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.2.cmml">y</mi><mo id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.1" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.1.cmml">^</mo></mover><mi id="S2.E4.m1.4.4.1.1.3.2.2.3.2.3" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.3.cmml">t</mi></msub><mo id="S2.E4.m1.4.4.1.1.3.2.2.3.1" xref="S2.E4.m1.4.4.1.1.3.2.2.3.1.cmml">=</mo><msub id="S2.E4.m1.4.4.1.1.3.2.2.3.3" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.cmml"><mover accent="true" id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.cmml"><mi id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.2" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.2.cmml">v</mi><mo id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.1" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.1.cmml">~</mo></mover><mi id="S2.E4.m1.4.4.1.1.3.2.2.3.3.3" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.3.cmml">i</mi></msub></mrow></msub><mo id="S2.E4.m1.4.4.1.1.3.2.1" xref="S2.E4.m1.4.4.1.1.3.2.1.cmml">⁢</mo><mtext id="S2.E4.m1.4.4.1.1.3.2.3" xref="S2.E4.m1.4.4.1.1.3.2.3a.cmml">exp</mtext><mo id="S2.E4.m1.4.4.1.1.3.2.1a" xref="S2.E4.m1.4.4.1.1.3.2.1.cmml">⁢</mo><mrow id="S2.E4.m1.4.4.1.1.3.2.4.2" xref="S2.E4.m1.2.2.cmml"><mo id="S2.E4.m1.4.4.1.1.3.2.4.2.1" maxsize="160%" minsize="160%" xref="S2.E4.m1.2.2.cmml">(</mo><mfrac id="S2.E4.m1.2.2" xref="S2.E4.m1.2.2.cmml"><mrow id="S2.E4.m1.2.2.2" xref="S2.E4.m1.2.2.2.cmml"><mo id="S2.E4.m1.2.2.2a" xref="S2.E4.m1.2.2.2.cmml">−</mo><mrow id="S2.E4.m1.2.2.2.2" xref="S2.E4.m1.2.2.2.2.cmml"><mi id="S2.E4.m1.2.2.2.2.4" xref="S2.E4.m1.2.2.2.2.4.cmml">d</mi><mo id="S2.E4.m1.2.2.2.2.3" xref="S2.E4.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="S2.E4.m1.2.2.2.2.2.2" xref="S2.E4.m1.2.2.2.2.2.3.cmml"><mo id="S2.E4.m1.2.2.2.2.2.2.3" stretchy="false" xref="S2.E4.m1.2.2.2.2.2.3.cmml">(</mo><msub id="S2.E4.m1.1.1.1.1.1.1.1" xref="S2.E4.m1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.E4.m1.1.1.1.1.1.1.1.2" xref="S2.E4.m1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E4.m1.1.1.1.1.1.1.1.2.2" xref="S2.E4.m1.1.1.1.1.1.1.1.2.2.cmml">𝒉</mi><mo id="S2.E4.m1.1.1.1.1.1.1.1.2.1" xref="S2.E4.m1.1.1.1.1.1.1.1.2.1.cmml">~</mo></mover><mi id="S2.E4.m1.1.1.1.1.1.1.1.3" xref="S2.E4.m1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E4.m1.2.2.2.2.2.2.4" xref="S2.E4.m1.2.2.2.2.2.3.cmml">,</mo><msub id="S2.E4.m1.2.2.2.2.2.2.2" xref="S2.E4.m1.2.2.2.2.2.2.2.cmml"><mover accent="true" id="S2.E4.m1.2.2.2.2.2.2.2.2" xref="S2.E4.m1.2.2.2.2.2.2.2.2.cmml"><mi id="S2.E4.m1.2.2.2.2.2.2.2.2.2" xref="S2.E4.m1.2.2.2.2.2.2.2.2.2.cmml">𝒉</mi><mo id="S2.E4.m1.2.2.2.2.2.2.2.2.1" xref="S2.E4.m1.2.2.2.2.2.2.2.2.1.cmml">^</mo></mover><mi id="S2.E4.m1.2.2.2.2.2.2.2.3" xref="S2.E4.m1.2.2.2.2.2.2.2.3.cmml">t</mi></msub><mo id="S2.E4.m1.2.2.2.2.2.2.5" stretchy="false" xref="S2.E4.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><mi id="S2.E4.m1.2.2.4" xref="S2.E4.m1.2.2.4.cmml">T</mi></mfrac><mo id="S2.E4.m1.4.4.1.1.3.2.4.2.2" maxsize="160%" minsize="160%" xref="S2.E4.m1.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S2.E4.m1.4.4.1.2" xref="S2.E4.m1.4.4.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E4.m1.4b"><apply id="S2.E4.m1.4.4.1.1.cmml" xref="S2.E4.m1.4.4.1"><csymbol cd="latexml" id="S2.E4.m1.4.4.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.2">proportional-to</csymbol><apply id="S2.E4.m1.4.4.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1"><times id="S2.E4.m1.4.4.1.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.1.2"></times><apply id="S2.E4.m1.4.4.1.1.1.3.cmml" xref="S2.E4.m1.4.4.1.1.1.3"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.1.3.1.cmml" xref="S2.E4.m1.4.4.1.1.1.3">subscript</csymbol><ci id="S2.E4.m1.4.4.1.1.1.3.2.cmml" xref="S2.E4.m1.4.4.1.1.1.3.2">𝑝</ci><ci id="S2.E4.m1.4.4.1.1.1.3.3.cmml" xref="S2.E4.m1.4.4.1.1.1.3.3">𝑟</ci></apply><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S2.E4.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.2">conditional</csymbol><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.1.1.1.1.3.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3">subscript</csymbol><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2"><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.1">^</ci><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.2.2">𝑦</ci></apply><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.3.3.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.3.3">𝑡</ci></apply><list id="S2.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1"><ci id="S2.E4.m1.3.3.cmml" xref="S2.E4.m1.3.3">𝒙</ci><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2"><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2">𝒚</ci></apply><apply id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3"><lt id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></list></apply></apply><apply id="S2.E4.m1.4.4.1.1.3.cmml" xref="S2.E4.m1.4.4.1.1.3"><apply id="S2.E4.m1.4.4.1.1.3.1.cmml" xref="S2.E4.m1.4.4.1.1.3.1"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.3.1.1.cmml" xref="S2.E4.m1.4.4.1.1.3.1">superscript</csymbol><apply id="S2.E4.m1.4.4.1.1.3.1.2.cmml" xref="S2.E4.m1.4.4.1.1.3.1"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.3.1.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.1">subscript</csymbol><sum id="S2.E4.m1.4.4.1.1.3.1.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.1.2.2"></sum><apply id="S2.E4.m1.4.4.1.1.3.1.2.3.cmml" xref="S2.E4.m1.4.4.1.1.3.1.2.3"><eq id="S2.E4.m1.4.4.1.1.3.1.2.3.1.cmml" xref="S2.E4.m1.4.4.1.1.3.1.2.3.1"></eq><ci id="S2.E4.m1.4.4.1.1.3.1.2.3.2.cmml" xref="S2.E4.m1.4.4.1.1.3.1.2.3.2">𝑖</ci><cn id="S2.E4.m1.4.4.1.1.3.1.2.3.3.cmml" type="integer" xref="S2.E4.m1.4.4.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="S2.E4.m1.4.4.1.1.3.1.3.cmml" xref="S2.E4.m1.4.4.1.1.3.1.3">𝑘</ci></apply><apply id="S2.E4.m1.4.4.1.1.3.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2"><times id="S2.E4.m1.4.4.1.1.3.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.1"></times><apply id="S2.E4.m1.4.4.1.1.3.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.3.2.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2">subscript</csymbol><cn id="S2.E4.m1.4.4.1.1.3.2.2.2.cmml" type="integer" xref="S2.E4.m1.4.4.1.1.3.2.2.2">1</cn><apply id="S2.E4.m1.4.4.1.1.3.2.2.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3"><eq id="S2.E4.m1.4.4.1.1.3.2.2.3.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.1"></eq><apply id="S2.E4.m1.4.4.1.1.3.2.2.3.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.3.2.2.3.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2">subscript</csymbol><apply id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2"><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.1">^</ci><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.2.2">𝑦</ci></apply><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.2.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.2.3">𝑡</ci></apply><apply id="S2.E4.m1.4.4.1.1.3.2.2.3.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.3.2.2.3.3.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3">subscript</csymbol><apply id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2"><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.1.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.1">~</ci><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.2.2">𝑣</ci></apply><ci id="S2.E4.m1.4.4.1.1.3.2.2.3.3.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.2.3.3.3">𝑖</ci></apply></apply></apply><ci id="S2.E4.m1.4.4.1.1.3.2.3a.cmml" xref="S2.E4.m1.4.4.1.1.3.2.3"><mtext id="S2.E4.m1.4.4.1.1.3.2.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.3">exp</mtext></ci><apply id="S2.E4.m1.2.2.cmml" xref="S2.E4.m1.4.4.1.1.3.2.4.2"><divide id="S2.E4.m1.2.2.3.cmml" xref="S2.E4.m1.4.4.1.1.3.2.4.2"></divide><apply id="S2.E4.m1.2.2.2.cmml" xref="S2.E4.m1.2.2.2"><minus id="S2.E4.m1.2.2.2.3.cmml" xref="S2.E4.m1.2.2.2"></minus><apply id="S2.E4.m1.2.2.2.2.cmml" xref="S2.E4.m1.2.2.2.2"><times id="S2.E4.m1.2.2.2.2.3.cmml" xref="S2.E4.m1.2.2.2.2.3"></times><ci id="S2.E4.m1.2.2.2.2.4.cmml" xref="S2.E4.m1.2.2.2.2.4">𝑑</ci><interval closure="open" id="S2.E4.m1.2.2.2.2.2.3.cmml" xref="S2.E4.m1.2.2.2.2.2.2"><apply id="S2.E4.m1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.E4.m1.1.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1.2"><ci id="S2.E4.m1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1.2.1">~</ci><ci id="S2.E4.m1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1.2.2">𝒉</ci></apply><ci id="S2.E4.m1.1.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E4.m1.2.2.2.2.2.2.2.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.2.2.2.2.2.2.2.1.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2">subscript</csymbol><apply id="S2.E4.m1.2.2.2.2.2.2.2.2.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2.2"><ci id="S2.E4.m1.2.2.2.2.2.2.2.2.1.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2.2.1">^</ci><ci id="S2.E4.m1.2.2.2.2.2.2.2.2.2.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2.2.2">𝒉</ci></apply><ci id="S2.E4.m1.2.2.2.2.2.2.2.3.cmml" xref="S2.E4.m1.2.2.2.2.2.2.2.3">𝑡</ci></apply></interval></apply></apply><ci id="S2.E4.m1.2.2.4.cmml" xref="S2.E4.m1.2.2.4">𝑇</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E4.m1.4c">p_{r}(\hat{y}_{t}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})\propto\sum_{i=1}^{k}\mathbbm{1%
}_{\hat{y}_{t}=\tilde{v}_{i}}\textrm{exp}\Big{(}\frac{-d(\tilde{{\bm{h}}}_{i},%
\hat{{\bm{h}}}_{t})}{T}\Big{)},</annotation><annotation encoding="application/x-llamapun" id="S2.E4.m1.4d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT | bold_italic_x , over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ) ∝ ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT blackboard_1 start_POSTSUBSCRIPT over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = over~ start_ARG italic_v end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT exp ( divide start_ARG - italic_d ( over~ start_ARG bold_italic_h end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , over^ start_ARG bold_italic_h end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) end_ARG start_ARG italic_T end_ARG ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p2.14">where <math alttext="d(\cdot)" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.11.m1.1"><semantics id="S2.SS0.SSS0.Px2.p2.11.m1.1a"><mrow id="S2.SS0.SSS0.Px2.p2.11.m1.1.2" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.cmml"><mi id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.2" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.2.cmml">d</mi><mo id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.1" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.1.cmml">⁢</mo><mrow id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.3.2" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.cmml"><mo id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.3.2.1" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.cmml">(</mo><mo id="S2.SS0.SSS0.Px2.p2.11.m1.1.1" lspace="0em" rspace="0em" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.1.cmml">⋅</mo><mo id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.3.2.2" stretchy="false" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.11.m1.1b"><apply id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2"><times id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.1.cmml" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.1"></times><ci id="S2.SS0.SSS0.Px2.p2.11.m1.1.2.2.cmml" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.2.2">𝑑</ci><ci id="S2.SS0.SSS0.Px2.p2.11.m1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.11.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.11.m1.1c">d(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.11.m1.1d">italic_d ( ⋅ )</annotation></semantics></math> is <math alttext="L_{2}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.12.m2.1"><semantics id="S2.SS0.SSS0.Px2.p2.12.m2.1a"><msub id="S2.SS0.SSS0.Px2.p2.12.m2.1.1" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1.cmml"><mi id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.2" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1.2.cmml">L</mi><mn id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.3" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.12.m2.1b"><apply id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1"><csymbol cd="ambiguous" id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1">subscript</csymbol><ci id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.2.cmml" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1.2">𝐿</ci><cn id="S2.SS0.SSS0.Px2.p2.12.m2.1.1.3.cmml" type="integer" xref="S2.SS0.SSS0.Px2.p2.12.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.12.m2.1c">L_{2}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.12.m2.1d">italic_L start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> distance; <math alttext="T" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.13.m3.1"><semantics id="S2.SS0.SSS0.Px2.p2.13.m3.1a"><mi id="S2.SS0.SSS0.Px2.p2.13.m3.1.1" xref="S2.SS0.SSS0.Px2.p2.13.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.13.m3.1b"><ci id="S2.SS0.SSS0.Px2.p2.13.m3.1.1.cmml" xref="S2.SS0.SSS0.Px2.p2.13.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.13.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.13.m3.1d">italic_T</annotation></semantics></math> is temperature hyper-parameter; <math alttext="\mathbbm{1}" class="ltx_Math" display="inline" id="S2.SS0.SSS0.Px2.p2.14.m4.1"><semantics id="S2.SS0.SSS0.Px2.p2.14.m4.1a"><mn id="S2.SS0.SSS0.Px2.p2.14.m4.1.1" xref="S2.SS0.SSS0.Px2.p2.14.m4.1.1.cmml">𝟙</mn><annotation-xml encoding="MathML-Content" id="S2.SS0.SSS0.Px2.p2.14.m4.1b"><cn id="S2.SS0.SSS0.Px2.p2.14.m4.1.1.cmml" type="integer" xref="S2.SS0.SSS0.Px2.p2.14.m4.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S2.SS0.SSS0.Px2.p2.14.m4.1c">\mathbbm{1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS0.SSS0.Px2.p2.14.m4.1d">blackboard_1</annotation></semantics></math> is the indicator function.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Approach</h2>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px1">
<h3 class="ltx_title ltx_title_paragraph">Motivation</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px1.p1.7">According to Eq. <a class="ltx_ref" href="#S2.E1" title="1 ‣ Vanilla NMT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>-<a class="ltx_ref" href="#S2.E4" title="4 ‣ kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a>, we can see that the context representation <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.1.m1.1"><semantics id="S3.SS0.SSS0.Px1.p1.1.m1.1a"><mi id="S3.SS0.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.1.m1.1b"><ci id="S3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.1.m1.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.1.m1.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.1.m1.1d">bold_italic_h</annotation></semantics></math> simultaneously plays two roles in <span class="ltx_text ltx_font_italic" id="S3.SS0.SSS0.Px1.p1.7.1">k</span>NN-MT: (1) the semantic vector for <math alttext="p_{c}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.2.m2.1"><semantics id="S3.SS0.SSS0.Px1.p1.2.m2.1a"><msub id="S3.SS0.SSS0.Px1.p1.2.m2.1.1" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1.cmml"><mi id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.2" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1.2.cmml">p</mi><mi id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.3" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1.3.cmml">c</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.2.m2.1b"><apply id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1.2">𝑝</ci><ci id="S3.SS0.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S3.SS0.SSS0.Px1.p1.2.m2.1.1.3">𝑐</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.2.m2.1c">p_{c}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.2.m2.1d">italic_p start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT</annotation></semantics></math>; (2) the retrieval vector for <math alttext="p_{r}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.3.m3.1"><semantics id="S3.SS0.SSS0.Px1.p1.3.m3.1a"><msub id="S3.SS0.SSS0.Px1.p1.3.m3.1.1" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1.cmml"><mi id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.2" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml">p</mi><mi id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.3" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.3.m3.1b"><apply id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1.2">𝑝</ci><ci id="S3.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S3.SS0.SSS0.Px1.p1.3.m3.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.3.m3.1c">p_{r}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.3.m3.1d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>.
We note that coupling the same <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.4.m4.1"><semantics id="S3.SS0.SSS0.Px1.p1.4.m4.1a"><mi id="S3.SS0.SSS0.Px1.p1.4.m4.1.1" xref="S3.SS0.SSS0.Px1.p1.4.m4.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.4.m4.1b"><ci id="S3.SS0.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.4.m4.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.4.m4.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.4.m4.1d">bold_italic_h</annotation></semantics></math> in the two scenes is sub-optimal.
Recall that <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.5.m5.1"><semantics id="S3.SS0.SSS0.Px1.p1.5.m5.1a"><mi id="S3.SS0.SSS0.Px1.p1.5.m5.1.1" xref="S3.SS0.SSS0.Px1.p1.5.m5.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.5.m5.1b"><ci id="S3.SS0.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.5.m5.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.5.m5.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.5.m5.1d">bold_italic_h</annotation></semantics></math> in the translation model is generally learned through cross-entropy loss, which only pays attention to the gold target token and ignores others.<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>In practice, we often use its label-smooth variant, which evenly assigns a small probability mass to all non-gold labels without distinction.</span></span></span>
However, a good retrieval vector should be able to distinguish between different tokens, especially those owning similar representations.
Therefore, we attempt to derive a new retrieval vector <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.6.m6.1"><semantics id="S3.SS0.SSS0.Px1.p1.6.m6.1a"><mi id="S3.SS0.SSS0.Px1.p1.6.m6.1.1" xref="S3.SS0.SSS0.Px1.p1.6.m6.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.6.m6.1b"><ci id="S3.SS0.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.6.m6.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.6.m6.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.6.m6.1d">bold_italic_z</annotation></semantics></math> from <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px1.p1.7.m7.1"><semantics id="S3.SS0.SSS0.Px1.p1.7.m7.1a"><mi id="S3.SS0.SSS0.Px1.p1.7.m7.1.1" xref="S3.SS0.SSS0.Px1.p1.7.m7.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px1.p1.7.m7.1b"><ci id="S3.SS0.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S3.SS0.SSS0.Px1.p1.7.m7.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px1.p1.7.m7.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px1.p1.7.m7.1d">bold_italic_h</annotation></semantics></math> for better retrieval performance.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px2">
<h3 class="ltx_title ltx_title_paragraph">Retrieval representation adapter</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px2.p1.2">We use a simple feedforward network as an adapter to transform the original representation <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.1.m1.1"><semantics id="S3.SS0.SSS0.Px2.p1.1.m1.1a"><mi id="S3.SS0.SSS0.Px2.p1.1.m1.1.1" xref="S3.SS0.SSS0.Px2.p1.1.m1.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.1.m1.1b"><ci id="S3.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.1.m1.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.1.m1.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.1.m1.1d">bold_italic_h</annotation></semantics></math> to desired retrieval representation <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.2.m2.1"><semantics id="S3.SS0.SSS0.Px2.p1.2.m2.1a"><mi id="S3.SS0.SSS0.Px2.p1.2.m2.1.1" xref="S3.SS0.SSS0.Px2.p1.2.m2.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.2.m2.1b"><ci id="S3.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.2.m2.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.2.m2.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.2.m2.1d">bold_italic_z</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\bm{z}}=\textrm{FFN}({\bm{h}})=\textrm{ReLU}({\bm{h}}{\bm{W}}_{1}+{\bm{b}}_{1%
}){\bm{W}}_{2}+{\bm{b}}_{2}," class="ltx_Math" display="block" id="S3.E5.m1.2"><semantics id="S3.E5.m1.2a"><mrow id="S3.E5.m1.2.2.1" xref="S3.E5.m1.2.2.1.1.cmml"><mrow id="S3.E5.m1.2.2.1.1" xref="S3.E5.m1.2.2.1.1.cmml"><mi id="S3.E5.m1.2.2.1.1.3" xref="S3.E5.m1.2.2.1.1.3.cmml">𝒛</mi><mo id="S3.E5.m1.2.2.1.1.4" xref="S3.E5.m1.2.2.1.1.4.cmml">=</mo><mrow id="S3.E5.m1.2.2.1.1.5" xref="S3.E5.m1.2.2.1.1.5.cmml"><mtext id="S3.E5.m1.2.2.1.1.5.2" xref="S3.E5.m1.2.2.1.1.5.2a.cmml">FFN</mtext><mo id="S3.E5.m1.2.2.1.1.5.1" xref="S3.E5.m1.2.2.1.1.5.1.cmml">⁢</mo><mrow id="S3.E5.m1.2.2.1.1.5.3.2" xref="S3.E5.m1.2.2.1.1.5.cmml"><mo id="S3.E5.m1.2.2.1.1.5.3.2.1" stretchy="false" xref="S3.E5.m1.2.2.1.1.5.cmml">(</mo><mi id="S3.E5.m1.1.1" xref="S3.E5.m1.1.1.cmml">𝒉</mi><mo id="S3.E5.m1.2.2.1.1.5.3.2.2" stretchy="false" xref="S3.E5.m1.2.2.1.1.5.cmml">)</mo></mrow></mrow><mo id="S3.E5.m1.2.2.1.1.6" xref="S3.E5.m1.2.2.1.1.6.cmml">=</mo><mrow id="S3.E5.m1.2.2.1.1.1" xref="S3.E5.m1.2.2.1.1.1.cmml"><mrow id="S3.E5.m1.2.2.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.cmml"><mtext id="S3.E5.m1.2.2.1.1.1.1.3" xref="S3.E5.m1.2.2.1.1.1.1.3a.cmml">ReLU</mtext><mo id="S3.E5.m1.2.2.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.2.2.1.1.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E5.m1.2.2.1.1.1.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.cmml"><mrow id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.cmml">𝒉</mi><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.1" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.1.cmml">⁢</mo><msub id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.2.cmml">𝑾</mi><mn id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.3.cmml">1</mn></msub></mrow><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.cmml">+</mo><msub id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">𝒃</mi><mn id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.3.cmml">1</mn></msub></mrow><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E5.m1.2.2.1.1.1.1.2a" xref="S3.E5.m1.2.2.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E5.m1.2.2.1.1.1.1.4" xref="S3.E5.m1.2.2.1.1.1.1.4.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.4.2" xref="S3.E5.m1.2.2.1.1.1.1.4.2.cmml">𝑾</mi><mn id="S3.E5.m1.2.2.1.1.1.1.4.3" xref="S3.E5.m1.2.2.1.1.1.1.4.3.cmml">2</mn></msub></mrow><mo id="S3.E5.m1.2.2.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.2.cmml">+</mo><msub id="S3.E5.m1.2.2.1.1.1.3" xref="S3.E5.m1.2.2.1.1.1.3.cmml"><mi id="S3.E5.m1.2.2.1.1.1.3.2" xref="S3.E5.m1.2.2.1.1.1.3.2.cmml">𝒃</mi><mn id="S3.E5.m1.2.2.1.1.1.3.3" xref="S3.E5.m1.2.2.1.1.1.3.3.cmml">2</mn></msub></mrow></mrow><mo id="S3.E5.m1.2.2.1.2" xref="S3.E5.m1.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.2b"><apply id="S3.E5.m1.2.2.1.1.cmml" xref="S3.E5.m1.2.2.1"><and id="S3.E5.m1.2.2.1.1a.cmml" xref="S3.E5.m1.2.2.1"></and><apply id="S3.E5.m1.2.2.1.1b.cmml" xref="S3.E5.m1.2.2.1"><eq id="S3.E5.m1.2.2.1.1.4.cmml" xref="S3.E5.m1.2.2.1.1.4"></eq><ci id="S3.E5.m1.2.2.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.3">𝒛</ci><apply id="S3.E5.m1.2.2.1.1.5.cmml" xref="S3.E5.m1.2.2.1.1.5"><times id="S3.E5.m1.2.2.1.1.5.1.cmml" xref="S3.E5.m1.2.2.1.1.5.1"></times><ci id="S3.E5.m1.2.2.1.1.5.2a.cmml" xref="S3.E5.m1.2.2.1.1.5.2"><mtext id="S3.E5.m1.2.2.1.1.5.2.cmml" xref="S3.E5.m1.2.2.1.1.5.2">FFN</mtext></ci><ci id="S3.E5.m1.1.1.cmml" xref="S3.E5.m1.1.1">𝒉</ci></apply></apply><apply id="S3.E5.m1.2.2.1.1c.cmml" xref="S3.E5.m1.2.2.1"><eq id="S3.E5.m1.2.2.1.1.6.cmml" xref="S3.E5.m1.2.2.1.1.6"></eq><share href="#S3.E5.m1.2.2.1.1.5.cmml" id="S3.E5.m1.2.2.1.1d.cmml" xref="S3.E5.m1.2.2.1"></share><apply id="S3.E5.m1.2.2.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1"><plus id="S3.E5.m1.2.2.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.2"></plus><apply id="S3.E5.m1.2.2.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1"><times id="S3.E5.m1.2.2.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.2"></times><ci id="S3.E5.m1.2.2.1.1.1.1.3a.cmml" xref="S3.E5.m1.2.2.1.1.1.1.3"><mtext id="S3.E5.m1.2.2.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.3">ReLU</mtext></ci><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1"><plus id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1"></plus><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2"><times id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.1"></times><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2">𝒉</ci><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.2">𝑾</ci><cn id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3.3">1</cn></apply></apply><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.2">𝒃</ci><cn id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><apply id="S3.E5.m1.2.2.1.1.1.1.4.cmml" xref="S3.E5.m1.2.2.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.1.4.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.4">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.4.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.4.2">𝑾</ci><cn id="S3.E5.m1.2.2.1.1.1.1.4.3.cmml" type="integer" xref="S3.E5.m1.2.2.1.1.1.1.4.3">2</cn></apply></apply><apply id="S3.E5.m1.2.2.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.3.1.cmml" xref="S3.E5.m1.2.2.1.1.1.3">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.3.2.cmml" xref="S3.E5.m1.2.2.1.1.1.3.2">𝒃</ci><cn id="S3.E5.m1.2.2.1.1.1.3.3.cmml" type="integer" xref="S3.E5.m1.2.2.1.1.1.3.3">2</cn></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.2c">{\bm{z}}=\textrm{FFN}({\bm{h}})=\textrm{ReLU}({\bm{h}}{\bm{W}}_{1}+{\bm{b}}_{1%
}){\bm{W}}_{2}+{\bm{b}}_{2},</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.2d">bold_italic_z = FFN ( bold_italic_h ) = ReLU ( bold_italic_h bold_italic_W start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT + bold_italic_b start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) bold_italic_W start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT + bold_italic_b start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS0.SSS0.Px2.p1.19">where <math alttext="{\bm{W}}_{1}\in\mathcal{R}^{d\times d_{f}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.3.m1.1"><semantics id="S3.SS0.SSS0.Px2.p1.3.m1.1a"><mrow id="S3.SS0.SSS0.Px2.p1.3.m1.1.1" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.2.cmml">𝑾</mi><mn id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.3" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.3.cmml">1</mn></msub><mo id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.1" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.1.cmml">∈</mo><msup id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.2" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.2.cmml">ℛ</mi><mrow id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.2" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.2.cmml">d</mi><mo id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.1.cmml">×</mo><msub id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.2" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.3" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.3.cmml">f</mi></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.3.m1.1b"><apply id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1"><in id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.1"></in><apply id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.2">𝑾</ci><cn id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.2.3">1</cn></apply><apply id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3">superscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.2">ℛ</ci><apply id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3"><times id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.1"></times><ci id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.2">𝑑</ci><apply id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.3.m1.1.1.3.3.3.3">𝑓</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.3.m1.1c">{\bm{W}}_{1}\in\mathcal{R}^{d\times d_{f}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.3.m1.1d">bold_italic_W start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d × italic_d start_POSTSUBSCRIPT italic_f end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="{\bm{W}}_{2}\in\mathcal{R}^{d_{f}\times d_{o}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.4.m2.1"><semantics id="S3.SS0.SSS0.Px2.p1.4.m2.1a"><mrow id="S3.SS0.SSS0.Px2.p1.4.m2.1.1" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.2.cmml">𝑾</mi><mn id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.3.cmml">2</mn></msub><mo id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.1" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.1.cmml">∈</mo><msup id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.2.cmml">ℛ</mi><mrow id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.cmml"><msub id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.3.cmml">f</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.1.cmml">×</mo><msub id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.2" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.3" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.3.cmml">o</mi></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.4.m2.1b"><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1"><in id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.1"></in><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.2">𝑾</ci><cn id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.2.3">2</cn></apply><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3">superscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.2">ℛ</ci><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3"><times id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.1"></times><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.3.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.2.3">𝑓</ci></apply><apply id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.4.m2.1.1.3.3.3.3">𝑜</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.4.m2.1c">{\bm{W}}_{2}\in\mathcal{R}^{d_{f}\times d_{o}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.4.m2.1d">bold_italic_W start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_f end_POSTSUBSCRIPT × italic_d start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="{\bm{b}}_{1}\in\mathcal{R}^{d_{f}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.5.m3.1"><semantics id="S3.SS0.SSS0.Px2.p1.5.m3.1a"><mrow id="S3.SS0.SSS0.Px2.p1.5.m3.1.1" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.2.cmml">𝒃</mi><mn id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.3" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.3.cmml">1</mn></msub><mo id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.1" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.1.cmml">∈</mo><msup id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.2" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.2.cmml">ℛ</mi><msub id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.2" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.3" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.3.cmml">f</mi></msub></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.5.m3.1b"><apply id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1"><in id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.1"></in><apply id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.2">𝒃</ci><cn id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.2.3">1</cn></apply><apply id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3">superscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.2">ℛ</ci><apply id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.5.m3.1.1.3.3.3">𝑓</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.5.m3.1c">{\bm{b}}_{1}\in\mathcal{R}^{d_{f}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.5.m3.1d">bold_italic_b start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_f end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>, and <math alttext="{\bm{b}}_{2}\in\mathcal{R}^{d_{o}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.6.m4.1"><semantics id="S3.SS0.SSS0.Px2.p1.6.m4.1a"><mrow id="S3.SS0.SSS0.Px2.p1.6.m4.1.1" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.2.cmml">𝒃</mi><mn id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.3" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.3.cmml">2</mn></msub><mo id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.1" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.1.cmml">∈</mo><msup id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.2" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.2.cmml">ℛ</mi><msub id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.2" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.3" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.3.cmml">o</mi></msub></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.6.m4.1b"><apply id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1"><in id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.1"></in><apply id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.2">𝒃</ci><cn id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.2.3">2</cn></apply><apply id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3">superscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.2">ℛ</ci><apply id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.6.m4.1.1.3.3.3">𝑜</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.6.m4.1c">{\bm{b}}_{2}\in\mathcal{R}^{d_{o}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.6.m4.1d">bold_italic_b start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> are learnable parameters; <math alttext="d_{f}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.7.m5.1"><semantics id="S3.SS0.SSS0.Px2.p1.7.m5.1a"><msub id="S3.SS0.SSS0.Px2.p1.7.m5.1.1" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.2" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.3" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1.3.cmml">f</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.7.m5.1b"><apply id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.7.m5.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.7.m5.1.1.3">𝑓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.7.m5.1c">d_{f}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.7.m5.1d">italic_d start_POSTSUBSCRIPT italic_f end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="d_{o}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.8.m6.1"><semantics id="S3.SS0.SSS0.Px2.p1.8.m6.1a"><msub id="S3.SS0.SSS0.Px2.p1.8.m6.1.1" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.2" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.3" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1.3.cmml">o</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.8.m6.1b"><apply id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.8.m6.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.8.m6.1.1.3">𝑜</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.8.m6.1c">d_{o}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.8.m6.1d">italic_d start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT</annotation></semantics></math> are the intermediate hidden size and output size of the adapter, respectively. When <math alttext="d_{o}&lt;d" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.9.m7.1"><semantics id="S3.SS0.SSS0.Px2.p1.9.m7.1a"><mrow id="S3.SS0.SSS0.Px2.p1.9.m7.1.1" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.2.cmml">d</mi><mi id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.3" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.3.cmml">o</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.1" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.1.cmml">&lt;</mo><mi id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.3" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.9.m7.1b"><apply id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1"><lt id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.1"></lt><apply id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.2">𝑑</ci><ci id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.3.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.2.3">𝑜</ci></apply><ci id="S3.SS0.SSS0.Px2.p1.9.m7.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.9.m7.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.9.m7.1c">d_{o}&lt;d</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.9.m7.1d">italic_d start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT &lt; italic_d</annotation></semantics></math>, the adapter network can be regarded as a dimension reducer. As FFN is very lightweight compared to the calculation of <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.10.m8.1"><semantics id="S3.SS0.SSS0.Px2.p1.10.m8.1a"><mi id="S3.SS0.SSS0.Px2.p1.10.m8.1.1" xref="S3.SS0.SSS0.Px2.p1.10.m8.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.10.m8.1b"><ci id="S3.SS0.SSS0.Px2.p1.10.m8.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.10.m8.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.10.m8.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.10.m8.1d">bold_italic_h</annotation></semantics></math>, there is almost no latency
in converting <math alttext="{\bm{h}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.11.m9.1"><semantics id="S3.SS0.SSS0.Px2.p1.11.m9.1a"><mi id="S3.SS0.SSS0.Px2.p1.11.m9.1.1" xref="S3.SS0.SSS0.Px2.p1.11.m9.1.1.cmml">𝒉</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.11.m9.1b"><ci id="S3.SS0.SSS0.Px2.p1.11.m9.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.11.m9.1.1">𝒉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.11.m9.1c">{\bm{h}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.11.m9.1d">bold_italic_h</annotation></semantics></math> to <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.12.m10.1"><semantics id="S3.SS0.SSS0.Px2.p1.12.m10.1a"><mi id="S3.SS0.SSS0.Px2.p1.12.m10.1.1" xref="S3.SS0.SSS0.Px2.p1.12.m10.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.12.m10.1b"><ci id="S3.SS0.SSS0.Px2.p1.12.m10.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.12.m10.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.12.m10.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.12.m10.1d">bold_italic_z</annotation></semantics></math>.For convenience, in the following description, we redefine <math alttext="{\bm{h}}_{i}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.13.m11.1"><semantics id="S3.SS0.SSS0.Px2.p1.13.m11.1a"><msub id="S3.SS0.SSS0.Px2.p1.13.m11.1.1" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.2" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1.2.cmml">𝒉</mi><mi id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.3" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.13.m11.1b"><apply id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1.2">𝒉</ci><ci id="S3.SS0.SSS0.Px2.p1.13.m11.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.13.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.13.m11.1c">{\bm{h}}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.13.m11.1d">bold_italic_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> as the key of <math alttext="i" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.14.m12.1"><semantics id="S3.SS0.SSS0.Px2.p1.14.m12.1a"><mi id="S3.SS0.SSS0.Px2.p1.14.m12.1.1" xref="S3.SS0.SSS0.Px2.p1.14.m12.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.14.m12.1b"><ci id="S3.SS0.SSS0.Px2.p1.14.m12.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.14.m12.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.14.m12.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.14.m12.1d">italic_i</annotation></semantics></math>-th key-value pair in the original datastore <math alttext="\mathcal{H}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.15.m13.1"><semantics id="S3.SS0.SSS0.Px2.p1.15.m13.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.15.m13.1.1" xref="S3.SS0.SSS0.Px2.p1.15.m13.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.15.m13.1b"><ci id="S3.SS0.SSS0.Px2.p1.15.m13.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.15.m13.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.15.m13.1c">\mathcal{H}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.15.m13.1d">caligraphic_H</annotation></semantics></math>, and the corresponding value is denoted by <math alttext="Y_{i}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.16.m14.1"><semantics id="S3.SS0.SSS0.Px2.p1.16.m14.1a"><msub id="S3.SS0.SSS0.Px2.p1.16.m14.1.1" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.2" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1.2.cmml">Y</mi><mi id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.3" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.16.m14.1b"><apply id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1.2">𝑌</ci><ci id="S3.SS0.SSS0.Px2.p1.16.m14.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.16.m14.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.16.m14.1c">Y_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.16.m14.1d">italic_Y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> when there is no ambiguity.
In this way, the new datastore <math alttext="\mathcal{Z}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.17.m15.1"><semantics id="S3.SS0.SSS0.Px2.p1.17.m15.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.17.m15.1.1" xref="S3.SS0.SSS0.Px2.p1.17.m15.1.1.cmml">𝒵</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.17.m15.1b"><ci id="S3.SS0.SSS0.Px2.p1.17.m15.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.17.m15.1.1">𝒵</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.17.m15.1c">\mathcal{Z}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.17.m15.1d">caligraphic_Z</annotation></semantics></math> can be denoted as <math alttext="\mathcal{Z}=\{({\bm{z}}_{i},Y_{i})|i=1,\ldots,|\mathcal{H}|\}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.18.m16.5"><semantics id="S3.SS0.SSS0.Px2.p1.18.m16.5a"><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.5.5" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.4" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.4.cmml">𝒵</mi><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.3" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.3.cmml">=</mo><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.cmml"><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.3" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.1.cmml">{</mo><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.3.cmml"><mo id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.3" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.3.cmml">(</mo><msub id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.3" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.4" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.3.cmml">,</mo><msub id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.2.cmml">Y</mi><mi id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.3" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.5" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.3.cmml">)</mo></mrow><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.4" lspace="0em" rspace="0em" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.1.cmml">|</mo><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.cmml"><mi id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.3" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.2.cmml">=</mo><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.2.cmml"><mn id="S3.SS0.SSS0.Px2.p1.18.m16.2.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.2.2.cmml">1</mn><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.2.cmml">,</mo><mi id="S3.SS0.SSS0.Px2.p1.18.m16.3.3" mathvariant="normal" xref="S3.SS0.SSS0.Px2.p1.18.m16.3.3.cmml">…</mi><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.3" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.2.cmml">,</mo><mrow id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.1.cmml"><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.2.1" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.1.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px2.p1.18.m16.1.1" xref="S3.SS0.SSS0.Px2.p1.18.m16.1.1.cmml">ℋ</mi><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.2.2" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.1.1.cmml">|</mo></mrow></mrow></mrow><mo id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.5" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.18.m16.5b"><apply id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5"><eq id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.3"></eq><ci id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.4.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.4">𝒵</ci><apply id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2"><csymbol cd="latexml" id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.3">conditional-set</csymbol><interval closure="open" id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2"><apply id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.2">𝒛</ci><ci id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.2">𝑌</ci><ci id="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.4.4.1.1.1.2.2.3">𝑖</ci></apply></interval><apply id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2"><eq id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.2"></eq><ci id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.3">𝑖</ci><list id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1"><cn id="S3.SS0.SSS0.Px2.p1.18.m16.2.2.cmml" type="integer" xref="S3.SS0.SSS0.Px2.p1.18.m16.2.2">1</cn><ci id="S3.SS0.SSS0.Px2.p1.18.m16.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.3.3">…</ci><apply id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.2"><abs id="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.5.5.2.2.2.1.1.1.2.1"></abs><ci id="S3.SS0.SSS0.Px2.p1.18.m16.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.18.m16.1.1">ℋ</ci></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.18.m16.5c">\mathcal{Z}=\{({\bm{z}}_{i},Y_{i})|i=1,\ldots,|\mathcal{H}|\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.18.m16.5d">caligraphic_Z = { ( bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) | italic_i = 1 , … , | caligraphic_H | }</annotation></semantics></math>, where <math alttext="{\bm{z}}_{i}=\textrm{FFN}({\bm{h}}_{i})" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px2.p1.19.m17.1"><semantics id="S3.SS0.SSS0.Px2.p1.19.m17.1a"><mrow id="S3.SS0.SSS0.Px2.p1.19.m17.1.1" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.cmml"><msub id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.cmml"><mi id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.2" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.3" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.2" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.2.cmml">=</mo><mrow id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.cmml"><mtext id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3a.cmml">FFN</mtext><mo id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.cmml"><mo id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.2" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.2" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.2.cmml">𝒉</mi><mi id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.3" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.3" stretchy="false" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px2.p1.19.m17.1b"><apply id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1"><eq id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.2"></eq><apply id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.2">𝒛</ci><ci id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.3.3">𝑖</ci></apply><apply id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1"><times id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.2"></times><ci id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3a.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3"><mtext id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.3">FFN</mtext></ci><apply id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.2">𝒉</ci><ci id="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px2.p1.19.m17.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px2.p1.19.m17.1c">{\bm{z}}_{i}=\textrm{FFN}({\bm{h}}_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px2.p1.19.m17.1d">bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = FFN ( bold_italic_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px3">
<h3 class="ltx_title ltx_title_paragraph">Supervised contrastive learning</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px3.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px3.p1.25">In machine translation field, contrastive learning has been applied in multilingual translation <cite class="ltx_cite ltx_citemacro_cite">Pan et al. (<a class="ltx_ref" href="#bib.bib10" title="">2021</a>); Wei et al. (<a class="ltx_ref" href="#bib.bib14" title="">2021</a>)</cite>, cross-modal translation <cite class="ltx_cite ltx_citemacro_cite">Ye et al. (<a class="ltx_ref" href="#bib.bib16" title="">2022</a>)</cite>, and learning robust representation for low-frequency word <cite class="ltx_cite ltx_citemacro_cite">Zhang et al. (<a class="ltx_ref" href="#bib.bib18" title="">2021</a>)</cite> etc.
In this work, we use supervised contrastive learning <cite class="ltx_cite ltx_citemacro_cite">Grill et al. (<a class="ltx_ref" href="#bib.bib3" title="">2020</a>)</cite> with multiple positive and negative samples to learn the desired retrieval representation <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.1.m1.1"><semantics id="S3.SS0.SSS0.Px3.p1.1.m1.1a"><mi id="S3.SS0.SSS0.Px3.p1.1.m1.1.1" xref="S3.SS0.SSS0.Px3.p1.1.m1.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.1.m1.1b"><ci id="S3.SS0.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.1.m1.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.1.m1.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.1.m1.1d">bold_italic_z</annotation></semantics></math>. Here, we regard the unique token <math alttext="v" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.2.m2.1"><semantics id="S3.SS0.SSS0.Px3.p1.2.m2.1a"><mi id="S3.SS0.SSS0.Px3.p1.2.m2.1.1" xref="S3.SS0.SSS0.Px3.p1.2.m2.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.2.m2.1b"><ci id="S3.SS0.SSS0.Px3.p1.2.m2.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.2.m2.1.1">𝑣</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.2.m2.1c">v</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.2.m2.1d">italic_v</annotation></semantics></math> in the target vocabulary <math alttext="V" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.3.m3.1"><semantics id="S3.SS0.SSS0.Px3.p1.3.m3.1a"><mi id="S3.SS0.SSS0.Px3.p1.3.m3.1.1" xref="S3.SS0.SSS0.Px3.p1.3.m3.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.3.m3.1b"><ci id="S3.SS0.SSS0.Px3.p1.3.m3.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.3.m3.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.3.m3.1c">V</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.3.m3.1d">italic_V</annotation></semantics></math> as a natural supervision signal. We aim to make <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.4.m4.1"><semantics id="S3.SS0.SSS0.Px3.p1.4.m4.1a"><mi id="S3.SS0.SSS0.Px3.p1.4.m4.1.1" xref="S3.SS0.SSS0.Px3.p1.4.m4.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.4.m4.1b"><ci id="S3.SS0.SSS0.Px3.p1.4.m4.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.4.m4.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.4.m4.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.4.m4.1d">bold_italic_z</annotation></semantics></math> more distinguishable, for example, pulling <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.5.m5.1"><semantics id="S3.SS0.SSS0.Px3.p1.5.m5.1a"><mi id="S3.SS0.SSS0.Px3.p1.5.m5.1.1" xref="S3.SS0.SSS0.Px3.p1.5.m5.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.5.m5.1b"><ci id="S3.SS0.SSS0.Px3.p1.5.m5.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.5.m5.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.5.m5.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.5.m5.1d">bold_italic_z</annotation></semantics></math> of the same words together and pushing <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.6.m6.1"><semantics id="S3.SS0.SSS0.Px3.p1.6.m6.1a"><mi id="S3.SS0.SSS0.Px3.p1.6.m6.1.1" xref="S3.SS0.SSS0.Px3.p1.6.m6.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.6.m6.1b"><ci id="S3.SS0.SSS0.Px3.p1.6.m6.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.6.m6.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.6.m6.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.6.m6.1d">bold_italic_z</annotation></semantics></math> of different words apart.
Specifically, we first divide <math alttext="\mathcal{Z}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.7.m7.1"><semantics id="S3.SS0.SSS0.Px3.p1.7.m7.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px3.p1.7.m7.1.1" xref="S3.SS0.SSS0.Px3.p1.7.m7.1.1.cmml">𝒵</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.7.m7.1b"><ci id="S3.SS0.SSS0.Px3.p1.7.m7.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.7.m7.1.1">𝒵</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.7.m7.1c">\mathcal{Z}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.7.m7.1d">caligraphic_Z</annotation></semantics></math> into <math alttext="|V|" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.8.m8.1"><semantics id="S3.SS0.SSS0.Px3.p1.8.m8.1a"><mrow id="S3.SS0.SSS0.Px3.p1.8.m8.1.2.2" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.2.1.cmml"><mo id="S3.SS0.SSS0.Px3.p1.8.m8.1.2.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.2.1.1.cmml">|</mo><mi id="S3.SS0.SSS0.Px3.p1.8.m8.1.1" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.1.cmml">V</mi><mo id="S3.SS0.SSS0.Px3.p1.8.m8.1.2.2.2" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.8.m8.1b"><apply id="S3.SS0.SSS0.Px3.p1.8.m8.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.2.2"><abs id="S3.SS0.SSS0.Px3.p1.8.m8.1.2.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.2.2.1"></abs><ci id="S3.SS0.SSS0.Px3.p1.8.m8.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.8.m8.1.1">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.8.m8.1c">|V|</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.8.m8.1d">| italic_V |</annotation></semantics></math> clusters according to the token class label. E.g., <math alttext="C_{v}=\{{\bm{z}}_{i}|i=1,\ldots,|\mathcal{Z}|,Y_{i}=v\}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.9.m9.5"><semantics id="S3.SS0.SSS0.Px3.p1.9.m9.5a"><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.cmml"><msub id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.cmml"><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.3.cmml">v</mi></msub><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.3.cmml">=</mo><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.cmml"><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.3" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.1.cmml">{</mo><msub id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.4" lspace="0em" rspace="0em" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.1.cmml">|</mo><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.3.cmml"><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.2.cmml">=</mo><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.2.cmml"><mn id="S3.SS0.SSS0.Px3.p1.9.m9.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.2.2.cmml">1</mn><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.2.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.9.m9.3.3" mathvariant="normal" xref="S3.SS0.SSS0.Px3.p1.9.m9.3.3.cmml">…</mi><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.2.cmml">,</mo><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.1.cmml"><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.1.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px3.p1.9.m9.1.1" xref="S3.SS0.SSS0.Px3.p1.9.m9.1.1.cmml">𝒵</mi><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.2.2" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.1.1.cmml">|</mo></mrow></mrow></mrow><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.3a.cmml">,</mo><mrow id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.cmml"><msub id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.2.cmml">Y</mi><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.1" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.1.cmml">=</mo><mi id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.3.cmml">v</mi></mrow></mrow><mo id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.5" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.9.m9.5b"><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5"><eq id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.3"></eq><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.2">𝐶</ci><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.4.3">𝑣</ci></apply><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2"><csymbol cd="latexml" id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.3">conditional-set</csymbol><apply id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.4.4.1.1.1.3">𝑖</ci></apply><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.3a.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.3">formulae-sequence</csymbol><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1"><eq id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.2"></eq><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.3">𝑖</ci><list id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1"><cn id="S3.SS0.SSS0.Px3.p1.9.m9.2.2.cmml" type="integer" xref="S3.SS0.SSS0.Px3.p1.9.m9.2.2">1</cn><ci id="S3.SS0.SSS0.Px3.p1.9.m9.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.3.3">…</ci><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.2"><abs id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.1.1.1.1.1.2.1"></abs><ci id="S3.SS0.SSS0.Px3.p1.9.m9.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.1.1">𝒵</ci></apply></list></apply><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2"><eq id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.1"></eq><apply id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.2">𝑌</ci><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.2.3">𝑖</ci></apply><ci id="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.9.m9.5.5.2.2.2.2.2.3">𝑣</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.9.m9.5c">C_{v}=\{{\bm{z}}_{i}|i=1,\ldots,|\mathcal{Z}|,Y_{i}=v\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.9.m9.5d">italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT = { bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_i = 1 , … , | caligraphic_Z | , italic_Y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_v }</annotation></semantics></math>, where <math alttext="C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.10.m10.1"><semantics id="S3.SS0.SSS0.Px3.p1.10.m10.1a"><msub id="S3.SS0.SSS0.Px3.p1.10.m10.1.1" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.2" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.3" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1.3.cmml">v</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.10.m10.1b"><apply id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1.2">𝐶</ci><ci id="S3.SS0.SSS0.Px3.p1.10.m10.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.10.m10.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.10.m10.1c">C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.10.m10.1d">italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math> is the context representation cluster of token <math alttext="v" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.11.m11.1"><semantics id="S3.SS0.SSS0.Px3.p1.11.m11.1a"><mi id="S3.SS0.SSS0.Px3.p1.11.m11.1.1" xref="S3.SS0.SSS0.Px3.p1.11.m11.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.11.m11.1b"><ci id="S3.SS0.SSS0.Px3.p1.11.m11.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.11.m11.1.1">𝑣</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.11.m11.1c">v</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.11.m11.1d">italic_v</annotation></semantics></math>. Thus, given any context representation <math alttext="{\bm{z}}\in\mathcal{Z}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.12.m12.1"><semantics id="S3.SS0.SSS0.Px3.p1.12.m12.1a"><mrow id="S3.SS0.SSS0.Px3.p1.12.m12.1.1" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.2" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.1" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.3" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.3.cmml">𝒵</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.12.m12.1b"><apply id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1"><in id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.1"></in><ci id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.12.m12.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.12.m12.1.1.3">𝒵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.12.m12.1c">{\bm{z}}\in\mathcal{Z}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.12.m12.1d">bold_italic_z ∈ caligraphic_Z</annotation></semantics></math> and its token label <math alttext="v" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.13.m13.1"><semantics id="S3.SS0.SSS0.Px3.p1.13.m13.1a"><mi id="S3.SS0.SSS0.Px3.p1.13.m13.1.1" xref="S3.SS0.SSS0.Px3.p1.13.m13.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.13.m13.1b"><ci id="S3.SS0.SSS0.Px3.p1.13.m13.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.13.m13.1.1">𝑣</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.13.m13.1c">v</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.13.m13.1d">italic_v</annotation></semantics></math>, we can construct M positive samples <math alttext="{\bm{z}}^{+}=\{{\bm{z}}_{1}^{+},\ldots,{\bm{z}}_{i}^{+},\ldots,{\bm{z}}_{M}^{+}\}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.14.m14.5"><semantics id="S3.SS0.SSS0.Px3.p1.14.m14.5a"><mrow id="S3.SS0.SSS0.Px3.p1.14.m14.5.5" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.cmml"><msup id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.cmml"><mi id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.2" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.3.cmml">+</mo></msup><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.4" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.4.cmml">=</mo><mrow id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml"><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.4" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">{</mo><msubsup id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.2" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.2.cmml">𝒛</mi><mn id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.3.cmml">1</mn><mo id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.3.cmml">+</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.5" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.14.m14.1.1" mathvariant="normal" xref="S3.SS0.SSS0.Px3.p1.14.m14.1.1.cmml">…</mi><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.6" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">,</mo><msubsup id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.3.cmml">+</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.7" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.14.m14.2.2" mathvariant="normal" xref="S3.SS0.SSS0.Px3.p1.14.m14.2.2.cmml">…</mi><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.8" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">,</mo><msubsup id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.cmml"><mi id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.2" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.3.cmml">M</mi><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.3" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.3.cmml">+</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.9" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.14.m14.5b"><apply id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5"><eq id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.4.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.4"></eq><apply id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.2">𝒛</ci><plus id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.5.3"></plus></apply><set id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.4.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3"><apply id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.2">𝒛</ci><cn id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.2.3">1</cn></apply><plus id="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.3.3.1.1.1.3"></plus></apply><ci id="S3.SS0.SSS0.Px3.p1.14.m14.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.1.1">…</ci><apply id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.2.3">𝑖</ci></apply><plus id="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.4.4.2.2.2.3"></plus></apply><ci id="S3.SS0.SSS0.Px3.p1.14.m14.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.2.2">…</ci><apply id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.2.3">𝑀</ci></apply><plus id="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.14.m14.5.5.3.3.3.3"></plus></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.14.m14.5c">{\bm{z}}^{+}=\{{\bm{z}}_{1}^{+},\ldots,{\bm{z}}_{i}^{+},\ldots,{\bm{z}}_{M}^{+}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.14.m14.5d">bold_italic_z start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT = { bold_italic_z start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT , … , bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT , … , bold_italic_z start_POSTSUBSCRIPT italic_M end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT }</annotation></semantics></math>, where <math alttext="{\bm{z}}_{i}^{+}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.15.m15.1"><semantics id="S3.SS0.SSS0.Px3.p1.15.m15.1a"><msubsup id="S3.SS0.SSS0.Px3.p1.15.m15.1.1" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.2" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.3" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.3" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.3.cmml">+</mo></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.15.m15.1b"><apply id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.2.3">𝑖</ci></apply><plus id="S3.SS0.SSS0.Px3.p1.15.m15.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.15.m15.1.1.3"></plus></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.15.m15.1c">{\bm{z}}_{i}^{+}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.15.m15.1d">bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT</annotation></semantics></math> is uniformly sampled from its owned cluster <math alttext="C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.16.m16.1"><semantics id="S3.SS0.SSS0.Px3.p1.16.m16.1a"><msub id="S3.SS0.SSS0.Px3.p1.16.m16.1.1" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.2" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.3" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1.3.cmml">v</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.16.m16.1b"><apply id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1.2">𝐶</ci><ci id="S3.SS0.SSS0.Px3.p1.16.m16.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.16.m16.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.16.m16.1c">C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.16.m16.1d">italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="{\bm{z}}_{i}^{+}\neq{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.17.m17.1"><semantics id="S3.SS0.SSS0.Px3.p1.17.m17.1a"><mrow id="S3.SS0.SSS0.Px3.p1.17.m17.1.1" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.cmml"><msubsup id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.2" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.3" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.3" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.3.cmml">+</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.1" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.1.cmml">≠</mo><mi id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.3" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.3.cmml">𝒛</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.17.m17.1b"><apply id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1"><neq id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.1"></neq><apply id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.2.3">𝑖</ci></apply><plus id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.2.3"></plus></apply><ci id="S3.SS0.SSS0.Px3.p1.17.m17.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.17.m17.1.1.3">𝒛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.17.m17.1c">{\bm{z}}_{i}^{+}\neq{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.17.m17.1d">bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ≠ bold_italic_z</annotation></semantics></math>.<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>We use sampling with replacement when <math alttext="|C_{v}|&lt;M" class="ltx_Math" display="inline" id="footnote2.m1.1"><semantics id="footnote2.m1.1b"><mrow id="footnote2.m1.1.1" xref="footnote2.m1.1.1.cmml"><mrow id="footnote2.m1.1.1.1.1" xref="footnote2.m1.1.1.1.2.cmml"><mo id="footnote2.m1.1.1.1.1.2" stretchy="false" xref="footnote2.m1.1.1.1.2.1.cmml">|</mo><msub id="footnote2.m1.1.1.1.1.1" xref="footnote2.m1.1.1.1.1.1.cmml"><mi id="footnote2.m1.1.1.1.1.1.2" xref="footnote2.m1.1.1.1.1.1.2.cmml">C</mi><mi id="footnote2.m1.1.1.1.1.1.3" xref="footnote2.m1.1.1.1.1.1.3.cmml">v</mi></msub><mo id="footnote2.m1.1.1.1.1.3" stretchy="false" xref="footnote2.m1.1.1.1.2.1.cmml">|</mo></mrow><mo id="footnote2.m1.1.1.2" xref="footnote2.m1.1.1.2.cmml">&lt;</mo><mi id="footnote2.m1.1.1.3" xref="footnote2.m1.1.1.3.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="footnote2.m1.1c"><apply id="footnote2.m1.1.1.cmml" xref="footnote2.m1.1.1"><lt id="footnote2.m1.1.1.2.cmml" xref="footnote2.m1.1.1.2"></lt><apply id="footnote2.m1.1.1.1.2.cmml" xref="footnote2.m1.1.1.1.1"><abs id="footnote2.m1.1.1.1.2.1.cmml" xref="footnote2.m1.1.1.1.1.2"></abs><apply id="footnote2.m1.1.1.1.1.1.cmml" xref="footnote2.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="footnote2.m1.1.1.1.1.1.1.cmml" xref="footnote2.m1.1.1.1.1.1">subscript</csymbol><ci id="footnote2.m1.1.1.1.1.1.2.cmml" xref="footnote2.m1.1.1.1.1.1.2">𝐶</ci><ci id="footnote2.m1.1.1.1.1.1.3.cmml" xref="footnote2.m1.1.1.1.1.1.3">𝑣</ci></apply></apply><ci id="footnote2.m1.1.1.3.cmml" xref="footnote2.m1.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="footnote2.m1.1d">|C_{v}|&lt;M</annotation><annotation encoding="application/x-llamapun" id="footnote2.m1.1e">| italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT | &lt; italic_M</annotation></semantics></math>.</span></span></span> Likely, we further construct N negative samples <math alttext="{\bm{z}}^{-}=\{{\bm{z}}_{1}^{-},\ldots,{\bm{z}}_{i}^{-},\ldots,{\bm{z}}_{N}^{-}\}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.18.m18.5"><semantics id="S3.SS0.SSS0.Px3.p1.18.m18.5a"><mrow id="S3.SS0.SSS0.Px3.p1.18.m18.5.5" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.cmml"><msup id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.cmml"><mi id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.2" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.3.cmml">−</mo></msup><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.4" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.4.cmml">=</mo><mrow id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml"><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.4" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">{</mo><msubsup id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.2" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.2.cmml">𝒛</mi><mn id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.3.cmml">1</mn><mo id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.3.cmml">−</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.5" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.18.m18.1.1" mathvariant="normal" xref="S3.SS0.SSS0.Px3.p1.18.m18.1.1.cmml">…</mi><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.6" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">,</mo><msubsup id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.3.cmml">i</mi><mo id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.3.cmml">−</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.7" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.18.m18.2.2" mathvariant="normal" xref="S3.SS0.SSS0.Px3.p1.18.m18.2.2.cmml">…</mi><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.8" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">,</mo><msubsup id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.cmml"><mi id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.2" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.3.cmml">N</mi><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.3" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.3.cmml">−</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.9" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.18.m18.5b"><apply id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5"><eq id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.4.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.4"></eq><apply id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.2">𝒛</ci><minus id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.5.3"></minus></apply><set id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.4.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3"><apply id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.2">𝒛</ci><cn id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.3.cmml" type="integer" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.2.3">1</cn></apply><minus id="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.3.3.1.1.1.3"></minus></apply><ci id="S3.SS0.SSS0.Px3.p1.18.m18.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.1.1">…</ci><apply id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.2.3">𝑖</ci></apply><minus id="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.4.4.2.2.2.3"></minus></apply><ci id="S3.SS0.SSS0.Px3.p1.18.m18.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.2.2">…</ci><apply id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3">superscript</csymbol><apply id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.2">𝒛</ci><ci id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.2.3">𝑁</ci></apply><minus id="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.18.m18.5.5.3.3.3.3"></minus></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.18.m18.5c">{\bm{z}}^{-}=\{{\bm{z}}_{1}^{-},\ldots,{\bm{z}}_{i}^{-},\ldots,{\bm{z}}_{N}^{-}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.18.m18.5d">bold_italic_z start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT = { bold_italic_z start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT , … , bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT , … , bold_italic_z start_POSTSUBSCRIPT italic_N end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT }</annotation></semantics></math>, where <math alttext="{\bm{z}}_{i}^{-}\in\backslash C_{v}" class="ltx_math_unparsed" display="inline" id="S3.SS0.SSS0.Px3.p1.19.m19.1"><semantics id="S3.SS0.SSS0.Px3.p1.19.m19.1a"><mrow id="S3.SS0.SSS0.Px3.p1.19.m19.1b"><msubsup id="S3.SS0.SSS0.Px3.p1.19.m19.1.1"><mi id="S3.SS0.SSS0.Px3.p1.19.m19.1.1.2.2">𝒛</mi><mi id="S3.SS0.SSS0.Px3.p1.19.m19.1.1.2.3">i</mi><mo id="S3.SS0.SSS0.Px3.p1.19.m19.1.1.3">−</mo></msubsup><mo id="S3.SS0.SSS0.Px3.p1.19.m19.1.2" rspace="0em">∈</mo><mo id="S3.SS0.SSS0.Px3.p1.19.m19.1.3" rspace="0.222em">\</mo><msub id="S3.SS0.SSS0.Px3.p1.19.m19.1.4"><mi id="S3.SS0.SSS0.Px3.p1.19.m19.1.4.2">C</mi><mi id="S3.SS0.SSS0.Px3.p1.19.m19.1.4.3">v</mi></msub></mrow><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.19.m19.1c">{\bm{z}}_{i}^{-}\in\backslash C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.19.m19.1d">bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT ∈ \ italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="\backslash C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.20.m20.1"><semantics id="S3.SS0.SSS0.Px3.p1.20.m20.1a"><mrow id="S3.SS0.SSS0.Px3.p1.20.m20.1.1" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.2" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.2.cmml"></mi><mo id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.1.cmml">\</mo><msub id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.cmml"><mi id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.2" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.3" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.3.cmml">v</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.20.m20.1b"><apply id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1"><ci id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.1">\</ci><csymbol cd="latexml" id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.2">absent</csymbol><apply id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.2">𝐶</ci><ci id="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.20.m20.1.1.3.3">𝑣</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.20.m20.1c">\backslash C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.20.m20.1d">\ italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math> denotes other clusters except <math alttext="C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.21.m21.1"><semantics id="S3.SS0.SSS0.Px3.p1.21.m21.1a"><msub id="S3.SS0.SSS0.Px3.p1.21.m21.1.1" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.2" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.3" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1.3.cmml">v</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.21.m21.1b"><apply id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1.2">𝐶</ci><ci id="S3.SS0.SSS0.Px3.p1.21.m21.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.21.m21.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.21.m21.1c">C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.21.m21.1d">italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math>. In the next part, we will describe how to build <math alttext="{\bm{z}}^{-}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.22.m22.1"><semantics id="S3.SS0.SSS0.Px3.p1.22.m22.1a"><msup id="S3.SS0.SSS0.Px3.p1.22.m22.1.1" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.2" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.3" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1.3.cmml">−</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.22.m22.1b"><apply id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1.2">𝒛</ci><minus id="S3.SS0.SSS0.Px3.p1.22.m22.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.22.m22.1.1.3"></minus></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.22.m22.1c">{\bm{z}}^{-}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.22.m22.1d">bold_italic_z start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT</annotation></semantics></math>.
Finally, given the anchor vector <math alttext="{\bm{z}}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.23.m23.1"><semantics id="S3.SS0.SSS0.Px3.p1.23.m23.1a"><mi id="S3.SS0.SSS0.Px3.p1.23.m23.1.1" xref="S3.SS0.SSS0.Px3.p1.23.m23.1.1.cmml">𝒛</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.23.m23.1b"><ci id="S3.SS0.SSS0.Px3.p1.23.m23.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.23.m23.1.1">𝒛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.23.m23.1c">{\bm{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.23.m23.1d">bold_italic_z</annotation></semantics></math>, its multiple positive samples <math alttext="{\bm{z}}^{+}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.24.m24.1"><semantics id="S3.SS0.SSS0.Px3.p1.24.m24.1a"><msup id="S3.SS0.SSS0.Px3.p1.24.m24.1.1" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.2" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.3" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1.3.cmml">+</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.24.m24.1b"><apply id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1.2">𝒛</ci><plus id="S3.SS0.SSS0.Px3.p1.24.m24.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.24.m24.1.1.3"></plus></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.24.m24.1c">{\bm{z}}^{+}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.24.m24.1d">bold_italic_z start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT</annotation></semantics></math> and multiple negative samples <math alttext="{\bm{z}}^{-}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.25.m25.1"><semantics id="S3.SS0.SSS0.Px3.p1.25.m25.1a"><msup id="S3.SS0.SSS0.Px3.p1.25.m25.1.1" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.2" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.3" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1.3.cmml">−</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.25.m25.1b"><apply id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1.2">𝒛</ci><minus id="S3.SS0.SSS0.Px3.p1.25.m25.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.25.m25.1.1.3"></minus></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.25.m25.1c">{\bm{z}}^{-}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.25.m25.1d">bold_italic_z start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT</annotation></semantics></math>, we learn the adapter network through the following contrastive learning loss:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="-\textrm{log}\frac{\sum\limits_{1\leq i\leq M}\textrm{exp}(s({\bm{z}},{\bm{z}}%
_{i}^{+}))}{\sum\limits_{1\leq i\leq M}\textrm{exp}(s({\bm{z}},{\bm{z}}_{i}^{+%
}))+\sum\limits_{1\leq j\leq N}\textrm{exp}(s({\bm{z}},{\bm{z}}_{j}^{-}))}," class="ltx_Math" display="block" id="S3.E6.m1.7"><semantics id="S3.E6.m1.7a"><mrow id="S3.E6.m1.7.7.1" xref="S3.E6.m1.7.7.1.1.cmml"><mrow id="S3.E6.m1.7.7.1.1" xref="S3.E6.m1.7.7.1.1.cmml"><mo id="S3.E6.m1.7.7.1.1a" xref="S3.E6.m1.7.7.1.1.cmml">−</mo><mrow id="S3.E6.m1.7.7.1.1.2" xref="S3.E6.m1.7.7.1.1.2.cmml"><mtext id="S3.E6.m1.7.7.1.1.2.2" xref="S3.E6.m1.7.7.1.1.2.2a.cmml">log</mtext><mo id="S3.E6.m1.7.7.1.1.2.1" xref="S3.E6.m1.7.7.1.1.2.1.cmml">⁢</mo><mfrac id="S3.E6.m1.6.6" xref="S3.E6.m1.6.6.cmml"><mrow id="S3.E6.m1.2.2.2" xref="S3.E6.m1.2.2.2.cmml"><munder id="S3.E6.m1.2.2.2.3" xref="S3.E6.m1.2.2.2.3.cmml"><mo id="S3.E6.m1.2.2.2.3.2" movablelimits="false" xref="S3.E6.m1.2.2.2.3.2.cmml">∑</mo><mrow id="S3.E6.m1.2.2.2.3.3" xref="S3.E6.m1.2.2.2.3.3.cmml"><mn id="S3.E6.m1.2.2.2.3.3.2" xref="S3.E6.m1.2.2.2.3.3.2.cmml">1</mn><mo id="S3.E6.m1.2.2.2.3.3.3" xref="S3.E6.m1.2.2.2.3.3.3.cmml">≤</mo><mi id="S3.E6.m1.2.2.2.3.3.4" xref="S3.E6.m1.2.2.2.3.3.4.cmml">i</mi><mo id="S3.E6.m1.2.2.2.3.3.5" xref="S3.E6.m1.2.2.2.3.3.5.cmml">≤</mo><mi id="S3.E6.m1.2.2.2.3.3.6" xref="S3.E6.m1.2.2.2.3.3.6.cmml">M</mi></mrow></munder><mrow id="S3.E6.m1.2.2.2.2" xref="S3.E6.m1.2.2.2.2.cmml"><mtext id="S3.E6.m1.2.2.2.2.3" xref="S3.E6.m1.2.2.2.2.3a.cmml">exp</mtext><mo id="S3.E6.m1.2.2.2.2.2" xref="S3.E6.m1.2.2.2.2.2.cmml">⁢</mo><mrow id="S3.E6.m1.2.2.2.2.1.1" xref="S3.E6.m1.2.2.2.2.1.1.1.cmml"><mo id="S3.E6.m1.2.2.2.2.1.1.2" stretchy="false" xref="S3.E6.m1.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.E6.m1.2.2.2.2.1.1.1" xref="S3.E6.m1.2.2.2.2.1.1.1.cmml"><mi id="S3.E6.m1.2.2.2.2.1.1.1.3" xref="S3.E6.m1.2.2.2.2.1.1.1.3.cmml">s</mi><mo id="S3.E6.m1.2.2.2.2.1.1.1.2" xref="S3.E6.m1.2.2.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.2.2.2.2.1.1.1.1.1" xref="S3.E6.m1.2.2.2.2.1.1.1.1.2.cmml"><mo id="S3.E6.m1.2.2.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.2.2.2.2.1.1.1.1.2.cmml">(</mo><mi id="S3.E6.m1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml">𝒛</mi><mo id="S3.E6.m1.2.2.2.2.1.1.1.1.1.3" xref="S3.E6.m1.2.2.2.2.1.1.1.1.2.cmml">,</mo><msubsup id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.2" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.2.cmml">𝒛</mi><mi id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.3" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.3.cmml">i</mi><mo id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.3" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.3.cmml">+</mo></msubsup><mo id="S3.E6.m1.2.2.2.2.1.1.1.1.1.4" stretchy="false" xref="S3.E6.m1.2.2.2.2.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.2.2.2.2.1.1.3" stretchy="false" xref="S3.E6.m1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mrow id="S3.E6.m1.6.6.6" xref="S3.E6.m1.6.6.6.cmml"><mrow id="S3.E6.m1.5.5.5.3" xref="S3.E6.m1.5.5.5.3.cmml"><munder id="S3.E6.m1.5.5.5.3.2" xref="S3.E6.m1.5.5.5.3.2.cmml"><mo id="S3.E6.m1.5.5.5.3.2.2" movablelimits="false" xref="S3.E6.m1.5.5.5.3.2.2.cmml">∑</mo><mrow id="S3.E6.m1.5.5.5.3.2.3" xref="S3.E6.m1.5.5.5.3.2.3.cmml"><mn id="S3.E6.m1.5.5.5.3.2.3.2" xref="S3.E6.m1.5.5.5.3.2.3.2.cmml">1</mn><mo id="S3.E6.m1.5.5.5.3.2.3.3" xref="S3.E6.m1.5.5.5.3.2.3.3.cmml">≤</mo><mi id="S3.E6.m1.5.5.5.3.2.3.4" xref="S3.E6.m1.5.5.5.3.2.3.4.cmml">i</mi><mo id="S3.E6.m1.5.5.5.3.2.3.5" xref="S3.E6.m1.5.5.5.3.2.3.5.cmml">≤</mo><mi id="S3.E6.m1.5.5.5.3.2.3.6" xref="S3.E6.m1.5.5.5.3.2.3.6.cmml">M</mi></mrow></munder><mrow id="S3.E6.m1.5.5.5.3.1" xref="S3.E6.m1.5.5.5.3.1.cmml"><mtext id="S3.E6.m1.5.5.5.3.1.3" xref="S3.E6.m1.5.5.5.3.1.3a.cmml">exp</mtext><mo id="S3.E6.m1.5.5.5.3.1.2" xref="S3.E6.m1.5.5.5.3.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.5.5.5.3.1.1.1" xref="S3.E6.m1.5.5.5.3.1.1.1.1.cmml"><mo id="S3.E6.m1.5.5.5.3.1.1.1.2" stretchy="false" xref="S3.E6.m1.5.5.5.3.1.1.1.1.cmml">(</mo><mrow id="S3.E6.m1.5.5.5.3.1.1.1.1" xref="S3.E6.m1.5.5.5.3.1.1.1.1.cmml"><mi id="S3.E6.m1.5.5.5.3.1.1.1.1.3" xref="S3.E6.m1.5.5.5.3.1.1.1.1.3.cmml">s</mi><mo id="S3.E6.m1.5.5.5.3.1.1.1.1.2" xref="S3.E6.m1.5.5.5.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.2.cmml"><mo id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.2.cmml">(</mo><mi id="S3.E6.m1.3.3.3.1" xref="S3.E6.m1.3.3.3.1.cmml">𝒛</mi><mo id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.3" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.2.cmml">,</mo><msubsup id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.2" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.2.cmml">𝒛</mi><mi id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.3" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.3.cmml">i</mi><mo id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.3" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.3.cmml">+</mo></msubsup><mo id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.4" stretchy="false" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.5.5.5.3.1.1.1.3" stretchy="false" xref="S3.E6.m1.5.5.5.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E6.m1.6.6.6.5" rspace="0.055em" xref="S3.E6.m1.6.6.6.5.cmml">+</mo><mrow id="S3.E6.m1.6.6.6.4" xref="S3.E6.m1.6.6.6.4.cmml"><munder id="S3.E6.m1.6.6.6.4.2" xref="S3.E6.m1.6.6.6.4.2.cmml"><mo id="S3.E6.m1.6.6.6.4.2.2" movablelimits="false" xref="S3.E6.m1.6.6.6.4.2.2.cmml">∑</mo><mrow id="S3.E6.m1.6.6.6.4.2.3" xref="S3.E6.m1.6.6.6.4.2.3.cmml"><mn id="S3.E6.m1.6.6.6.4.2.3.2" xref="S3.E6.m1.6.6.6.4.2.3.2.cmml">1</mn><mo id="S3.E6.m1.6.6.6.4.2.3.3" xref="S3.E6.m1.6.6.6.4.2.3.3.cmml">≤</mo><mi id="S3.E6.m1.6.6.6.4.2.3.4" xref="S3.E6.m1.6.6.6.4.2.3.4.cmml">j</mi><mo id="S3.E6.m1.6.6.6.4.2.3.5" xref="S3.E6.m1.6.6.6.4.2.3.5.cmml">≤</mo><mi id="S3.E6.m1.6.6.6.4.2.3.6" xref="S3.E6.m1.6.6.6.4.2.3.6.cmml">N</mi></mrow></munder><mrow id="S3.E6.m1.6.6.6.4.1" xref="S3.E6.m1.6.6.6.4.1.cmml"><mtext id="S3.E6.m1.6.6.6.4.1.3" xref="S3.E6.m1.6.6.6.4.1.3a.cmml">exp</mtext><mo id="S3.E6.m1.6.6.6.4.1.2" xref="S3.E6.m1.6.6.6.4.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.6.6.6.4.1.1.1" xref="S3.E6.m1.6.6.6.4.1.1.1.1.cmml"><mo id="S3.E6.m1.6.6.6.4.1.1.1.2" stretchy="false" xref="S3.E6.m1.6.6.6.4.1.1.1.1.cmml">(</mo><mrow id="S3.E6.m1.6.6.6.4.1.1.1.1" xref="S3.E6.m1.6.6.6.4.1.1.1.1.cmml"><mi id="S3.E6.m1.6.6.6.4.1.1.1.1.3" xref="S3.E6.m1.6.6.6.4.1.1.1.1.3.cmml">s</mi><mo id="S3.E6.m1.6.6.6.4.1.1.1.1.2" xref="S3.E6.m1.6.6.6.4.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.2.cmml"><mo id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.2.cmml">(</mo><mi id="S3.E6.m1.4.4.4.2" xref="S3.E6.m1.4.4.4.2.cmml">𝒛</mi><mo id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.3" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.2.cmml">,</mo><msubsup id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.2" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.2.cmml">𝒛</mi><mi id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.3" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.3.cmml">j</mi><mo id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.3" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.3.cmml">−</mo></msubsup><mo id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.4" stretchy="false" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.6.6.6.4.1.1.1.3" stretchy="false" xref="S3.E6.m1.6.6.6.4.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mrow></mrow><mo id="S3.E6.m1.7.7.1.2" xref="S3.E6.m1.7.7.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.7b"><apply id="S3.E6.m1.7.7.1.1.cmml" xref="S3.E6.m1.7.7.1"><minus id="S3.E6.m1.7.7.1.1.1.cmml" xref="S3.E6.m1.7.7.1"></minus><apply id="S3.E6.m1.7.7.1.1.2.cmml" xref="S3.E6.m1.7.7.1.1.2"><times id="S3.E6.m1.7.7.1.1.2.1.cmml" xref="S3.E6.m1.7.7.1.1.2.1"></times><ci id="S3.E6.m1.7.7.1.1.2.2a.cmml" xref="S3.E6.m1.7.7.1.1.2.2"><mtext id="S3.E6.m1.7.7.1.1.2.2.cmml" xref="S3.E6.m1.7.7.1.1.2.2">log</mtext></ci><apply id="S3.E6.m1.6.6.cmml" xref="S3.E6.m1.6.6"><divide id="S3.E6.m1.6.6.7.cmml" xref="S3.E6.m1.6.6"></divide><apply id="S3.E6.m1.2.2.2.cmml" xref="S3.E6.m1.2.2.2"><apply id="S3.E6.m1.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.3"><csymbol cd="ambiguous" id="S3.E6.m1.2.2.2.3.1.cmml" xref="S3.E6.m1.2.2.2.3">subscript</csymbol><sum id="S3.E6.m1.2.2.2.3.2.cmml" xref="S3.E6.m1.2.2.2.3.2"></sum><apply id="S3.E6.m1.2.2.2.3.3.cmml" xref="S3.E6.m1.2.2.2.3.3"><and id="S3.E6.m1.2.2.2.3.3a.cmml" xref="S3.E6.m1.2.2.2.3.3"></and><apply id="S3.E6.m1.2.2.2.3.3b.cmml" xref="S3.E6.m1.2.2.2.3.3"><leq id="S3.E6.m1.2.2.2.3.3.3.cmml" xref="S3.E6.m1.2.2.2.3.3.3"></leq><cn id="S3.E6.m1.2.2.2.3.3.2.cmml" type="integer" xref="S3.E6.m1.2.2.2.3.3.2">1</cn><ci id="S3.E6.m1.2.2.2.3.3.4.cmml" xref="S3.E6.m1.2.2.2.3.3.4">𝑖</ci></apply><apply id="S3.E6.m1.2.2.2.3.3c.cmml" xref="S3.E6.m1.2.2.2.3.3"><leq id="S3.E6.m1.2.2.2.3.3.5.cmml" xref="S3.E6.m1.2.2.2.3.3.5"></leq><share href="#S3.E6.m1.2.2.2.3.3.4.cmml" id="S3.E6.m1.2.2.2.3.3d.cmml" xref="S3.E6.m1.2.2.2.3.3"></share><ci id="S3.E6.m1.2.2.2.3.3.6.cmml" xref="S3.E6.m1.2.2.2.3.3.6">𝑀</ci></apply></apply></apply><apply id="S3.E6.m1.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2"><times id="S3.E6.m1.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2"></times><ci id="S3.E6.m1.2.2.2.2.3a.cmml" xref="S3.E6.m1.2.2.2.2.3"><mtext id="S3.E6.m1.2.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2.3">exp</mtext></ci><apply id="S3.E6.m1.2.2.2.2.1.1.1.cmml" xref="S3.E6.m1.2.2.2.2.1.1"><times id="S3.E6.m1.2.2.2.2.1.1.1.2.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.2"></times><ci id="S3.E6.m1.2.2.2.2.1.1.1.3.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.3">𝑠</ci><interval closure="open" id="S3.E6.m1.2.2.2.2.1.1.1.1.2.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1"><ci id="S3.E6.m1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1">𝒛</ci><apply id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.2">𝒛</ci><ci id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.2.3">𝑖</ci></apply><plus id="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.2.2.2.2.1.1.1.1.1.1.3"></plus></apply></interval></apply></apply></apply><apply id="S3.E6.m1.6.6.6.cmml" xref="S3.E6.m1.6.6.6"><plus id="S3.E6.m1.6.6.6.5.cmml" xref="S3.E6.m1.6.6.6.5"></plus><apply id="S3.E6.m1.5.5.5.3.cmml" xref="S3.E6.m1.5.5.5.3"><apply id="S3.E6.m1.5.5.5.3.2.cmml" xref="S3.E6.m1.5.5.5.3.2"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.5.3.2.1.cmml" xref="S3.E6.m1.5.5.5.3.2">subscript</csymbol><sum id="S3.E6.m1.5.5.5.3.2.2.cmml" xref="S3.E6.m1.5.5.5.3.2.2"></sum><apply id="S3.E6.m1.5.5.5.3.2.3.cmml" xref="S3.E6.m1.5.5.5.3.2.3"><and id="S3.E6.m1.5.5.5.3.2.3a.cmml" xref="S3.E6.m1.5.5.5.3.2.3"></and><apply id="S3.E6.m1.5.5.5.3.2.3b.cmml" xref="S3.E6.m1.5.5.5.3.2.3"><leq id="S3.E6.m1.5.5.5.3.2.3.3.cmml" xref="S3.E6.m1.5.5.5.3.2.3.3"></leq><cn id="S3.E6.m1.5.5.5.3.2.3.2.cmml" type="integer" xref="S3.E6.m1.5.5.5.3.2.3.2">1</cn><ci id="S3.E6.m1.5.5.5.3.2.3.4.cmml" xref="S3.E6.m1.5.5.5.3.2.3.4">𝑖</ci></apply><apply id="S3.E6.m1.5.5.5.3.2.3c.cmml" xref="S3.E6.m1.5.5.5.3.2.3"><leq id="S3.E6.m1.5.5.5.3.2.3.5.cmml" xref="S3.E6.m1.5.5.5.3.2.3.5"></leq><share href="#S3.E6.m1.5.5.5.3.2.3.4.cmml" id="S3.E6.m1.5.5.5.3.2.3d.cmml" xref="S3.E6.m1.5.5.5.3.2.3"></share><ci id="S3.E6.m1.5.5.5.3.2.3.6.cmml" xref="S3.E6.m1.5.5.5.3.2.3.6">𝑀</ci></apply></apply></apply><apply id="S3.E6.m1.5.5.5.3.1.cmml" xref="S3.E6.m1.5.5.5.3.1"><times id="S3.E6.m1.5.5.5.3.1.2.cmml" xref="S3.E6.m1.5.5.5.3.1.2"></times><ci id="S3.E6.m1.5.5.5.3.1.3a.cmml" xref="S3.E6.m1.5.5.5.3.1.3"><mtext id="S3.E6.m1.5.5.5.3.1.3.cmml" xref="S3.E6.m1.5.5.5.3.1.3">exp</mtext></ci><apply id="S3.E6.m1.5.5.5.3.1.1.1.1.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1"><times id="S3.E6.m1.5.5.5.3.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.2"></times><ci id="S3.E6.m1.5.5.5.3.1.1.1.1.3.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.3">𝑠</ci><interval closure="open" id="S3.E6.m1.5.5.5.3.1.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1"><ci id="S3.E6.m1.3.3.3.1.cmml" xref="S3.E6.m1.3.3.3.1">𝒛</ci><apply id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.2">𝒛</ci><ci id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.2.3">𝑖</ci></apply><plus id="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.5.5.5.3.1.1.1.1.1.1.1.3"></plus></apply></interval></apply></apply></apply><apply id="S3.E6.m1.6.6.6.4.cmml" xref="S3.E6.m1.6.6.6.4"><apply id="S3.E6.m1.6.6.6.4.2.cmml" xref="S3.E6.m1.6.6.6.4.2"><csymbol cd="ambiguous" id="S3.E6.m1.6.6.6.4.2.1.cmml" xref="S3.E6.m1.6.6.6.4.2">subscript</csymbol><sum id="S3.E6.m1.6.6.6.4.2.2.cmml" xref="S3.E6.m1.6.6.6.4.2.2"></sum><apply id="S3.E6.m1.6.6.6.4.2.3.cmml" xref="S3.E6.m1.6.6.6.4.2.3"><and id="S3.E6.m1.6.6.6.4.2.3a.cmml" xref="S3.E6.m1.6.6.6.4.2.3"></and><apply id="S3.E6.m1.6.6.6.4.2.3b.cmml" xref="S3.E6.m1.6.6.6.4.2.3"><leq id="S3.E6.m1.6.6.6.4.2.3.3.cmml" xref="S3.E6.m1.6.6.6.4.2.3.3"></leq><cn id="S3.E6.m1.6.6.6.4.2.3.2.cmml" type="integer" xref="S3.E6.m1.6.6.6.4.2.3.2">1</cn><ci id="S3.E6.m1.6.6.6.4.2.3.4.cmml" xref="S3.E6.m1.6.6.6.4.2.3.4">𝑗</ci></apply><apply id="S3.E6.m1.6.6.6.4.2.3c.cmml" xref="S3.E6.m1.6.6.6.4.2.3"><leq id="S3.E6.m1.6.6.6.4.2.3.5.cmml" xref="S3.E6.m1.6.6.6.4.2.3.5"></leq><share href="#S3.E6.m1.6.6.6.4.2.3.4.cmml" id="S3.E6.m1.6.6.6.4.2.3d.cmml" xref="S3.E6.m1.6.6.6.4.2.3"></share><ci id="S3.E6.m1.6.6.6.4.2.3.6.cmml" xref="S3.E6.m1.6.6.6.4.2.3.6">𝑁</ci></apply></apply></apply><apply id="S3.E6.m1.6.6.6.4.1.cmml" xref="S3.E6.m1.6.6.6.4.1"><times id="S3.E6.m1.6.6.6.4.1.2.cmml" xref="S3.E6.m1.6.6.6.4.1.2"></times><ci id="S3.E6.m1.6.6.6.4.1.3a.cmml" xref="S3.E6.m1.6.6.6.4.1.3"><mtext id="S3.E6.m1.6.6.6.4.1.3.cmml" xref="S3.E6.m1.6.6.6.4.1.3">exp</mtext></ci><apply id="S3.E6.m1.6.6.6.4.1.1.1.1.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1"><times id="S3.E6.m1.6.6.6.4.1.1.1.1.2.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.2"></times><ci id="S3.E6.m1.6.6.6.4.1.1.1.1.3.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.3">𝑠</ci><interval closure="open" id="S3.E6.m1.6.6.6.4.1.1.1.1.1.2.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1"><ci id="S3.E6.m1.4.4.4.2.cmml" xref="S3.E6.m1.4.4.4.2">𝒛</ci><apply id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.2">𝒛</ci><ci id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.2.3">𝑗</ci></apply><minus id="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.6.6.6.4.1.1.1.1.1.1.1.3"></minus></apply></interval></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.7c">-\textrm{log}\frac{\sum\limits_{1\leq i\leq M}\textrm{exp}(s({\bm{z}},{\bm{z}}%
_{i}^{+}))}{\sum\limits_{1\leq i\leq M}\textrm{exp}(s({\bm{z}},{\bm{z}}_{i}^{+%
}))+\sum\limits_{1\leq j\leq N}\textrm{exp}(s({\bm{z}},{\bm{z}}_{j}^{-}))},</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.7d">- log divide start_ARG ∑ start_POSTSUBSCRIPT 1 ≤ italic_i ≤ italic_M end_POSTSUBSCRIPT exp ( italic_s ( bold_italic_z , bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT 1 ≤ italic_i ≤ italic_M end_POSTSUBSCRIPT exp ( italic_s ( bold_italic_z , bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) ) + ∑ start_POSTSUBSCRIPT 1 ≤ italic_j ≤ italic_N end_POSTSUBSCRIPT exp ( italic_s ( bold_italic_z , bold_italic_z start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT ) ) end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS0.SSS0.Px3.p1.30">where
<math alttext="s(\cdot)" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.26.m1.1"><semantics id="S3.SS0.SSS0.Px3.p1.26.m1.1a"><mrow id="S3.SS0.SSS0.Px3.p1.26.m1.1.2" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.2" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.2.cmml">s</mi><mo id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.1" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.1.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.3.2" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.cmml"><mo id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.cmml">(</mo><mo id="S3.SS0.SSS0.Px3.p1.26.m1.1.1" lspace="0em" rspace="0em" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.1.cmml">⋅</mo><mo id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.3.2.2" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.26.m1.1b"><apply id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2"><times id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.1"></times><ci id="S3.SS0.SSS0.Px3.p1.26.m1.1.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.2.2">𝑠</ci><ci id="S3.SS0.SSS0.Px3.p1.26.m1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.26.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.26.m1.1c">s(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.26.m1.1d">italic_s ( ⋅ )</annotation></semantics></math> is the score function implemented as cosine similarity with temperature <math alttext="T^{\prime}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.27.m2.1"><semantics id="S3.SS0.SSS0.Px3.p1.27.m2.1a"><msup id="S3.SS0.SSS0.Px3.p1.27.m2.1.1" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.2" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1.2.cmml">T</mi><mo id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.3" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.27.m2.1b"><apply id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1.2">𝑇</ci><ci id="S3.SS0.SSS0.Px3.p1.27.m2.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.27.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.27.m2.1c">T^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.27.m2.1d">italic_T start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>: <math alttext="s({\bm{a}},{\bm{b}})=\frac{1}{T^{\prime}}\times\frac{{\bm{a}}^{T}{\bm{b}}}{\|{%
\bm{a}}\|\cdot\|{\bm{b}}\|}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.28.m3.4"><semantics id="S3.SS0.SSS0.Px3.p1.28.m3.4a"><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.4.5" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.cmml"><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.2.cmml">s</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.1" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.1.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.1.cmml"><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.1.cmml">(</mo><mi id="S3.SS0.SSS0.Px3.p1.28.m3.3.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.3.3.cmml">𝒂</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.1.cmml">,</mo><mi id="S3.SS0.SSS0.Px3.p1.28.m3.4.4" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.4.cmml">𝒃</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.2.3" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.1" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.1.cmml">=</mo><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.cmml"><mfrac id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.cmml"><mn id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.2.cmml">1</mn><msup id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.cmml"><mi id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.2.cmml">T</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.3.cmml">′</mo></msup></mfrac><mo id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.1.cmml">×</mo><mfrac id="S3.SS0.SSS0.Px3.p1.28.m3.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.cmml"><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.cmml"><msup id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.cmml"><mi id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.2.cmml">𝒂</mi><mi id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.3.cmml">T</mi></msup><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.1" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.1.cmml">⁢</mo><mi id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.3" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.3.cmml">𝒃</mi></mrow><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.cmml"><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.1.cmml"><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.1.1.cmml">‖</mo><mi id="S3.SS0.SSS0.Px3.p1.28.m3.1.1.1.1" xref="S3.SS0.SSS0.Px3.p1.28.m3.1.1.1.1.cmml">𝒂</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.2.2" rspace="0.055em" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.1.1.cmml">‖</mo></mrow><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.3" rspace="0.222em" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.3.cmml">⋅</mo><mrow id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.1.cmml"><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.2.1" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.1.1.cmml">‖</mo><mi id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.2" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.2.cmml">𝒃</mi><mo id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.2.2" stretchy="false" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.1.1.cmml">‖</mo></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.28.m3.4b"><apply id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5"><eq id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.1"></eq><apply id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2"><times id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.1"></times><ci id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.2">𝑠</ci><interval closure="open" id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.2.3.2"><ci id="S3.SS0.SSS0.Px3.p1.28.m3.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.3.3">𝒂</ci><ci id="S3.SS0.SSS0.Px3.p1.28.m3.4.4.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.4">𝒃</ci></interval></apply><apply id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3"><times id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.1"></times><apply id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2"><divide id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2"></divide><cn id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.2.cmml" type="integer" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.2">1</cn><apply id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.2">𝑇</ci><ci id="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.4.5.3.2.3.3">′</ci></apply></apply><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2"><divide id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2"></divide><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4"><times id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.1"></times><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.2">𝒂</ci><ci id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.2.3">𝑇</ci></apply><ci id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.4.3">𝒃</ci></apply><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2"><ci id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.3">⋅</ci><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.2"><csymbol cd="latexml" id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.4.2.1">norm</csymbol><ci id="S3.SS0.SSS0.Px3.p1.28.m3.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.1.1.1.1">𝒂</ci></apply><apply id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.2"><csymbol cd="latexml" id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.5.2.1">norm</csymbol><ci id="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.2.cmml" xref="S3.SS0.SSS0.Px3.p1.28.m3.2.2.2.2">𝒃</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.28.m3.4c">s({\bm{a}},{\bm{b}})=\frac{1}{T^{\prime}}\times\frac{{\bm{a}}^{T}{\bm{b}}}{\|{%
\bm{a}}\|\cdot\|{\bm{b}}\|}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.28.m3.4d">italic_s ( bold_italic_a , bold_italic_b ) = divide start_ARG 1 end_ARG start_ARG italic_T start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG × divide start_ARG bold_italic_a start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT bold_italic_b end_ARG start_ARG ∥ bold_italic_a ∥ ⋅ ∥ bold_italic_b ∥ end_ARG</annotation></semantics></math>.
Note that <math alttext="T^{\prime}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.29.m4.1"><semantics id="S3.SS0.SSS0.Px3.p1.29.m4.1a"><msup id="S3.SS0.SSS0.Px3.p1.29.m4.1.1" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1.cmml"><mi id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.2" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1.2.cmml">T</mi><mo id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.3" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.29.m4.1b"><apply id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.2.cmml" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1.2">𝑇</ci><ci id="S3.SS0.SSS0.Px3.p1.29.m4.1.1.3.cmml" xref="S3.SS0.SSS0.Px3.p1.29.m4.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.29.m4.1c">T^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.29.m4.1d">italic_T start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is the temperature in training, which is different from the inference temperature <math alttext="T" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px3.p1.30.m5.1"><semantics id="S3.SS0.SSS0.Px3.p1.30.m5.1a"><mi id="S3.SS0.SSS0.Px3.p1.30.m5.1.1" xref="S3.SS0.SSS0.Px3.p1.30.m5.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px3.p1.30.m5.1b"><ci id="S3.SS0.SSS0.Px3.p1.30.m5.1.1.cmml" xref="S3.SS0.SSS0.Px3.p1.30.m5.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px3.p1.30.m5.1c">T</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px3.p1.30.m5.1d">italic_T</annotation></semantics></math> in Eq. <a class="ltx_ref" href="#S2.E4" title="4 ‣ kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a>.</p>
</div>
<figure class="ltx_table" id="S3.T1">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S3.T1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T1.1.2.1">
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.1">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.1.1">Dataset</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.2">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.2.1">Medical</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.3">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.3.1">Law</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.4">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.4.1">IT</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.5">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.5.1">Koran</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.6">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.6.1">Subtitle</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T1.1.2.1.7">
<span class="ltx_text ltx_font_bold" id="S3.T1.1.2.1.7.1">NC+Euro</span></td>
</tr>
<tr class="ltx_tr" id="S3.T1.1.3.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S3.T1.1.3.2.1">Train</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.2">248K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.3">467K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.4">222K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.5">52K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.6">500K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T1.1.3.2.7">2M</td>
</tr>
<tr class="ltx_tr" id="S3.T1.1.4.3">
<td class="ltx_td ltx_align_left" id="S3.T1.1.4.3.1">Valid</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.2">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.3">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.4">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.5">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.6">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.4.3.7">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.1.5.4">
<td class="ltx_td ltx_align_left" id="S3.T1.1.5.4.1">Test</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.2">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.3">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.4">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.5">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.6">2000</td>
<td class="ltx_td ltx_align_center" id="S3.T1.1.5.4.7">-</td>
</tr>
<tr class="ltx_tr" id="S3.T1.1.1">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S3.T1.1.1.2">Datastore</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.3">6.9M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.4">19.0M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.5">3.6M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.6">0.5M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.7">6.2M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S3.T1.1.1.1">5M<math alttext="{}^{\dagger}" class="ltx_Math" display="inline" id="S3.T1.1.1.1.m1.1"><semantics id="S3.T1.1.1.1.m1.1a"><msup id="S3.T1.1.1.1.m1.1.1" xref="S3.T1.1.1.1.m1.1.1.cmml"><mi id="S3.T1.1.1.1.m1.1.1a" xref="S3.T1.1.1.1.m1.1.1.cmml"></mi><mo id="S3.T1.1.1.1.m1.1.1.1" xref="S3.T1.1.1.1.m1.1.1.1.cmml">†</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T1.1.1.1.m1.1b"><apply id="S3.T1.1.1.1.m1.1.1.cmml" xref="S3.T1.1.1.1.m1.1.1"><ci id="S3.T1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.1.1.1.m1.1.1.1">†</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.1.1.1.m1.1c">{}^{\dagger}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.1.1.1.m1.1d">start_FLOATSUPERSCRIPT † end_FLOATSUPERSCRIPT</annotation></semantics></math>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Statistics of datasets in different domains. <math alttext="\dagger" class="ltx_Math" display="inline" id="S3.T1.3.m1.1"><semantics id="S3.T1.3.m1.1b"><mo id="S3.T1.3.m1.1.1" xref="S3.T1.3.m1.1.1.cmml">†</mo><annotation-xml encoding="MathML-Content" id="S3.T1.3.m1.1c"><ci id="S3.T1.3.m1.1.1.cmml" xref="S3.T1.3.m1.1.1">†</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.3.m1.1d">\dagger</annotation><annotation encoding="application/x-llamapun" id="S3.T1.3.m1.1e">†</annotation></semantics></math>: Due to limited memory, we randomly sampled 5M samples from a total of 65.7M samples in NC+Euro for training.</figcaption>
</figure>
<figure class="ltx_table" id="S3.T2">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S3.T2.3" style="width:346.9pt;height:113.8pt;vertical-align:-0.6pt;"><span class="ltx_transformed_inner" style="transform:translate(-102.4pt,33.4pt) scale(0.628847236499407,0.628847236499407) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S3.T2.3.3">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T2.3.3.4.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_tt" id="S3.T2.3.3.4.1.1">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.1.1">Method</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.2">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.2.1">Medical</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.3">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.3.1">Law</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.4">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.4.1">IT</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.5">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.5.1">Koran</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.6">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.6.1">Subtitle</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S3.T2.3.3.4.1.7">
<span class="ltx_text ltx_font_bold" id="S3.T2.3.3.4.1.7.1">Avg.</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S3.T2.3.3.5.2.1">Baseline (WMT19 winner, <cite class="ltx_cite ltx_citemacro_citet">Ng et al. (<a class="ltx_ref" href="#bib.bib9" title="">2019</a>)</cite>)</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.2">39.91</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.3">45.71</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.4">37.98</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.5">16.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.6">29.21</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.5.2.7">33.82</td>
</tr>
<tr class="ltx_tr" id="S3.T2.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T2.1.1.1.2">
<span class="ltx_text ltx_font_italic" id="S3.T2.1.1.1.2.1">k</span>NN-MT <cite class="ltx_cite ltx_citemacro_cite">Khandelwal et al. (<a class="ltx_ref" href="#bib.bib6" title="">2021</a>)</cite>
</th>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.3">54.35</td>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.4">61.78</td>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.5">45.82</td>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.6">19.45</td>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.1"><span class="ltx_text ltx_font_bold" id="S3.T2.1.1.1.1.1">31.73<math alttext="{}^{\dagger}" class="ltx_Math" display="inline" id="S3.T2.1.1.1.1.1.m1.1"><semantics id="S3.T2.1.1.1.1.1.m1.1a"><msup id="S3.T2.1.1.1.1.1.m1.1.1" xref="S3.T2.1.1.1.1.1.m1.1.1.cmml"><mi id="S3.T2.1.1.1.1.1.m1.1.1a" xref="S3.T2.1.1.1.1.1.m1.1.1.cmml"></mi><mo id="S3.T2.1.1.1.1.1.m1.1.1.1" mathvariant="normal" xref="S3.T2.1.1.1.1.1.m1.1.1.1.cmml">†</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T2.1.1.1.1.1.m1.1b"><apply id="S3.T2.1.1.1.1.1.m1.1.1.cmml" xref="S3.T2.1.1.1.1.1.m1.1.1"><ci id="S3.T2.1.1.1.1.1.m1.1.1.1.cmml" xref="S3.T2.1.1.1.1.1.m1.1.1.1">normal-†</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.1.1.1.1.1.m1.1c">{}^{\dagger}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.1.1.1.1.1.m1.1d">start_FLOATSUPERSCRIPT † end_FLOATSUPERSCRIPT</annotation></semantics></math></span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.1.1.1.7">42.63</td>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.6.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T2.3.3.6.3.1">
<span class="ltx_text ltx_font_italic" id="S3.T2.3.3.6.3.1.1">k</span>NN-MT (our implementation)</th>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.2">54.41</td>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.3">61.01</td>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.4">45.20</td>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.5">21.07</td>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.6">29.67</td>
<td class="ltx_td ltx_align_center" id="S3.T2.3.3.6.3.7">42.27</td>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.7.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="7" id="S3.T2.3.3.7.4.1">
<span class="ltx_text ltx_font_italic" id="S3.T2.3.3.7.4.1.1">train by out-domain data</span></th>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.8.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S3.T2.3.3.8.5.1"><span class="ltx_text ltx_font_smallcaps" id="S3.T2.3.3.8.5.1.1">Clknn</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.2">56.37</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.3">61.54</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.4">46.50</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.5">21.52</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.6">30.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.8.5.7">43.35</td>
</tr>
<tr class="ltx_tr" id="S3.T2.2.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T2.2.2.2.1">
<span class="ltx_text ltx_font_smallcaps" id="S3.T2.2.2.2.1.1">Clknn</span> + <math alttext="\lambda^{*}" class="ltx_Math" display="inline" id="S3.T2.2.2.2.1.m1.1"><semantics id="S3.T2.2.2.2.1.m1.1a"><msup id="S3.T2.2.2.2.1.m1.1.1" xref="S3.T2.2.2.2.1.m1.1.1.cmml"><mi id="S3.T2.2.2.2.1.m1.1.1.2" xref="S3.T2.2.2.2.1.m1.1.1.2.cmml">λ</mi><mo id="S3.T2.2.2.2.1.m1.1.1.3" xref="S3.T2.2.2.2.1.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T2.2.2.2.1.m1.1b"><apply id="S3.T2.2.2.2.1.m1.1.1.cmml" xref="S3.T2.2.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T2.2.2.2.1.m1.1.1.1.cmml" xref="S3.T2.2.2.2.1.m1.1.1">superscript</csymbol><ci id="S3.T2.2.2.2.1.m1.1.1.2.cmml" xref="S3.T2.2.2.2.1.m1.1.1.2">𝜆</ci><times id="S3.T2.2.2.2.1.m1.1.1.3.cmml" xref="S3.T2.2.2.2.1.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.2.2.2.1.m1.1c">\lambda^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.2.2.2.1.m1.1d">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.2"><span class="ltx_text ltx_font_bold" id="S3.T2.2.2.2.2.1">56.52</span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.3">61.63</td>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.4">46.68</td>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.5">21.60</td>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.6">30.86</td>
<td class="ltx_td ltx_align_center" id="S3.T2.2.2.2.7">43.46</td>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.9.6">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" colspan="7" id="S3.T2.3.3.9.6.1">
<span class="ltx_text ltx_font_italic" id="S3.T2.3.3.9.6.1.1">train by in-domain data</span></th>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.10.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S3.T2.3.3.10.7.1"><span class="ltx_text ltx_font_smallcaps" id="S3.T2.3.3.10.7.1.1">Clknn</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.2">55.86</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.3">61.92</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.4">47.77</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.5">21.46</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.6">31.02</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.10.7.7">43.61</td>
</tr>
<tr class="ltx_tr" id="S3.T2.3.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S3.T2.3.3.3.1">
<span class="ltx_text ltx_font_smallcaps" id="S3.T2.3.3.3.1.1">Clknn</span> + <math alttext="\lambda^{*}" class="ltx_Math" display="inline" id="S3.T2.3.3.3.1.m1.1"><semantics id="S3.T2.3.3.3.1.m1.1a"><msup id="S3.T2.3.3.3.1.m1.1.1" xref="S3.T2.3.3.3.1.m1.1.1.cmml"><mi id="S3.T2.3.3.3.1.m1.1.1.2" xref="S3.T2.3.3.3.1.m1.1.1.2.cmml">λ</mi><mo id="S3.T2.3.3.3.1.m1.1.1.3" xref="S3.T2.3.3.3.1.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T2.3.3.3.1.m1.1b"><apply id="S3.T2.3.3.3.1.m1.1.1.cmml" xref="S3.T2.3.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T2.3.3.3.1.m1.1.1.1.cmml" xref="S3.T2.3.3.3.1.m1.1.1">superscript</csymbol><ci id="S3.T2.3.3.3.1.m1.1.1.2.cmml" xref="S3.T2.3.3.3.1.m1.1.1.2">𝜆</ci><times id="S3.T2.3.3.3.1.m1.1.1.3.cmml" xref="S3.T2.3.3.3.1.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.3.3.3.1.m1.1c">\lambda^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.3.3.3.1.m1.1d">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.2">55.87</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.3"><span class="ltx_text ltx_font_bold" id="S3.T2.3.3.3.3.1">62.01</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.4"><span class="ltx_text ltx_font_bold" id="S3.T2.3.3.3.4.1">47.84</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.5"><span class="ltx_text ltx_font_bold" id="S3.T2.3.3.3.5.1">21.81</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.6">31.05</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.3.3.3.7"><span class="ltx_text ltx_font_bold" id="S3.T2.3.3.3.7.1">43.72</span></td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>The SacreBLEU scores of our proposed <span class="ltx_text ltx_font_smallcaps" id="S3.T2.13.1">Clknn</span> and the baseline methods in five domains. <math alttext="\lambda^{*}" class="ltx_Math" display="inline" id="S3.T2.7.m1.1"><semantics id="S3.T2.7.m1.1b"><msup id="S3.T2.7.m1.1.1" xref="S3.T2.7.m1.1.1.cmml"><mi id="S3.T2.7.m1.1.1.2" xref="S3.T2.7.m1.1.1.2.cmml">λ</mi><mo id="S3.T2.7.m1.1.1.3" xref="S3.T2.7.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T2.7.m1.1c"><apply id="S3.T2.7.m1.1.1.cmml" xref="S3.T2.7.m1.1.1"><csymbol cd="ambiguous" id="S3.T2.7.m1.1.1.1.cmml" xref="S3.T2.7.m1.1.1">superscript</csymbol><ci id="S3.T2.7.m1.1.1.2.cmml" xref="S3.T2.7.m1.1.1.2">𝜆</ci><times id="S3.T2.7.m1.1.1.3.cmml" xref="S3.T2.7.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.7.m1.1d">\lambda^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.7.m1.1e">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> denotes using retrieval confidence aware interpolation coefficient. <math alttext="{}^{\dagger}" class="ltx_Math" display="inline" id="S3.T2.8.m2.1"><semantics id="S3.T2.8.m2.1b"><msup id="S3.T2.8.m2.1.1" xref="S3.T2.8.m2.1.1.cmml"><mi id="S3.T2.8.m2.1.1b" xref="S3.T2.8.m2.1.1.cmml"></mi><mo id="S3.T2.8.m2.1.1.1" xref="S3.T2.8.m2.1.1.1.cmml">†</mo></msup><annotation-xml encoding="MathML-Content" id="S3.T2.8.m2.1c"><apply id="S3.T2.8.m2.1.1.cmml" xref="S3.T2.8.m2.1.1"><ci id="S3.T2.8.m2.1.1.1.cmml" xref="S3.T2.8.m2.1.1.1">†</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.8.m2.1d">{}^{\dagger}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.8.m2.1e">start_FLOATSUPERSCRIPT † end_FLOATSUPERSCRIPT</annotation></semantics></math> denotes the number is not comparable because <cite class="ltx_cite ltx_citemacro_citet">Khandelwal et al. (<a class="ltx_ref" href="#bib.bib6" title="">2021</a>)</cite> use full-size subtitle data than ours.
All the <span class="ltx_text ltx_font_smallcaps" id="S3.T2.14.2">Clknn</span> results are significantly better (p<math alttext="&lt;" class="ltx_Math" display="inline" id="S3.T2.9.m3.1"><semantics id="S3.T2.9.m3.1b"><mo id="S3.T2.9.m3.1.1" xref="S3.T2.9.m3.1.1.cmml">&lt;</mo><annotation-xml encoding="MathML-Content" id="S3.T2.9.m3.1c"><lt id="S3.T2.9.m3.1.1.cmml" xref="S3.T2.9.m3.1.1"></lt></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.9.m3.1d">&lt;</annotation><annotation encoding="application/x-llamapun" id="S3.T2.9.m3.1e">&lt;</annotation></semantics></math>0.01) than our re-implemented <span class="ltx_text ltx_font_italic" id="S3.T2.15.3">k</span>NN-MT, measured by paired bootstrap resampling <cite class="ltx_cite ltx_citemacro_cite">Koehn (<a class="ltx_ref" href="#bib.bib7" title="">2004</a>)</cite>.</figcaption>
</figure>
</section>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px4">
<h3 class="ltx_title ltx_title_paragraph">Fast hard negative sample</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px4.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px4.p1.9">The key for Eq. <a class="ltx_ref" href="#S3.E6" title="6 ‣ Supervised contrastive learning ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">6</span></a> is the construction of negative samples <math alttext="{\bm{z}}^{-}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.1.m1.1"><semantics id="S3.SS0.SSS0.Px4.p1.1.m1.1a"><msup id="S3.SS0.SSS0.Px4.p1.1.m1.1.1" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1.cmml"><mi id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.2" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.3" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1.3.cmml">−</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.1.m1.1b"><apply id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1.2">𝒛</ci><minus id="S3.SS0.SSS0.Px4.p1.1.m1.1.1.3.cmml" xref="S3.SS0.SSS0.Px4.p1.1.m1.1.1.3"></minus></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.1.m1.1c">{\bm{z}}^{-}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.1.m1.1d">bold_italic_z start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT</annotation></semantics></math>.
A trivial solution is randomly sampling from the entire space of <math alttext="\backslash C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.2.m2.1"><semantics id="S3.SS0.SSS0.Px4.p1.2.m2.1a"><mrow id="S3.SS0.SSS0.Px4.p1.2.m2.1.1" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.cmml"><mi id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.2" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.2.cmml"></mi><mo id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.1.cmml">\</mo><msub id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.cmml"><mi id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.2" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.3" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.3.cmml">v</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.2.m2.1b"><apply id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1"><ci id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.1">\</ci><csymbol cd="latexml" id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.2">absent</csymbol><apply id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.2">𝐶</ci><ci id="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px4.p1.2.m2.1.1.3.3">𝑣</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.2.m2.1c">\backslash C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.2.m2.1d">\ italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math>. However, this negative sample may be too easy to provide the effective learning signal <cite class="ltx_cite ltx_citemacro_cite">Robinson et al. (<a class="ltx_ref" href="#bib.bib11" title="">2020</a>)</cite>. On the contrary, an extreme method for hard negative samples is to traverse <math alttext="\backslash C_{v}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.3.m3.1"><semantics id="S3.SS0.SSS0.Px4.p1.3.m3.1a"><mrow id="S3.SS0.SSS0.Px4.p1.3.m3.1.1" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.cmml"><mi id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.2" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.2.cmml"></mi><mo id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.1.cmml">\</mo><msub id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.cmml"><mi id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.2" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.3" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.3.cmml">v</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.3.m3.1b"><apply id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1"><ci id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.1">\</ci><csymbol cd="latexml" id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.2">absent</csymbol><apply id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.2">𝐶</ci><ci id="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.3.cmml" xref="S3.SS0.SSS0.Px4.p1.3.m3.1.1.3.3">𝑣</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.3.m3.1c">\backslash C_{v}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.3.m3.1d">\ italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT</annotation></semantics></math> to find the most similar negative samples for the anchor.
The problem is that <math alttext="|\backslash C_{v}|" class="ltx_math_unparsed" display="inline" id="S3.SS0.SSS0.Px4.p1.4.m4.1"><semantics id="S3.SS0.SSS0.Px4.p1.4.m4.1a"><mrow id="S3.SS0.SSS0.Px4.p1.4.m4.1b"><mo fence="false" id="S3.SS0.SSS0.Px4.p1.4.m4.1.1" stretchy="false">|</mo><mo id="S3.SS0.SSS0.Px4.p1.4.m4.1.2" rspace="0.222em">\</mo><msub id="S3.SS0.SSS0.Px4.p1.4.m4.1.3"><mi id="S3.SS0.SSS0.Px4.p1.4.m4.1.3.2">C</mi><mi id="S3.SS0.SSS0.Px4.p1.4.m4.1.3.3">v</mi></msub><mo fence="false" id="S3.SS0.SSS0.Px4.p1.4.m4.1.4" stretchy="false">|</mo></mrow><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.4.m4.1c">|\backslash C_{v}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.4.m4.1d">| \ italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT |</annotation></semantics></math> is close to <math alttext="|\mathcal{Z}|" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.5.m5.1"><semantics id="S3.SS0.SSS0.Px4.p1.5.m5.1a"><mrow id="S3.SS0.SSS0.Px4.p1.5.m5.1.2.2" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.2.1.cmml"><mo id="S3.SS0.SSS0.Px4.p1.5.m5.1.2.2.1" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.2.1.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px4.p1.5.m5.1.1" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.1.cmml">𝒵</mi><mo id="S3.SS0.SSS0.Px4.p1.5.m5.1.2.2.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.5.m5.1b"><apply id="S3.SS0.SSS0.Px4.p1.5.m5.1.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.2.2"><abs id="S3.SS0.SSS0.Px4.p1.5.m5.1.2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.2.2.1"></abs><ci id="S3.SS0.SSS0.Px4.p1.5.m5.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.5.m5.1.1">𝒵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.5.m5.1c">|\mathcal{Z}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.5.m5.1d">| caligraphic_Z |</annotation></semantics></math>, with a scale of millions or more, resulting in enormous computational complexity.
To solve it, we propose a fast and cheap approach to constructing hard negative samples. Specifically, we first collect the cluster centre <math alttext="\bar{C}_{v}=\frac{1}{|C_{v}|}\sum_{i=1}^{|\mathcal{Z}|}\mathbbm{1}_{Y_{i}=v}{%
\bm{z}}_{i}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.6.m6.2"><semantics id="S3.SS0.SSS0.Px4.p1.6.m6.2a"><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.cmml"><msub id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.cmml"><mover accent="true" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.cmml"><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.2.cmml">C</mi><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.1.cmml">¯</mo></mover><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.3.cmml">v</mi></msub><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.1.cmml">=</mo><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.cmml"><mfrac id="S3.SS0.SSS0.Px4.p1.6.m6.1.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.cmml"><mn id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.3.cmml">1</mn><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.2.cmml"><mo id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.2.1.cmml">|</mo><msub id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.cmml"><mi id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.2.cmml">C</mi><mi id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.3.cmml">v</mi></msub><mo id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.3" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.1.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.cmml"><msubsup id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.cmml"><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.2.cmml">∑</mo><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.cmml"><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.2.cmml">i</mi><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.1.cmml">=</mo><mn id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.3.cmml">1</mn></mrow><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.2.cmml"><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.3.1" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.1.cmml">𝒵</mi><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.3.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.2.1.cmml">|</mo></mrow></msubsup><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.cmml"><msub id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.cmml"><mn id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.2.cmml">𝟙</mn><mrow id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.cmml"><msub id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.cmml"><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.2.cmml">Y</mi><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.3.cmml">i</mi></msub><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.1.cmml">=</mo><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.3.cmml">v</mi></mrow></msub><mo id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.1" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.1.cmml">⁢</mo><msub id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.cmml"><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.2" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.2.cmml">𝒛</mi><mi id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.3" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.6.m6.2b"><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3"><eq id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.1"></eq><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2">subscript</csymbol><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2"><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.1">¯</ci><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.2.2">𝐶</ci></apply><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.2.3">𝑣</ci></apply><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3"><times id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.1"></times><apply id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1"><divide id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1"></divide><cn id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.3.cmml" type="integer" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.3">1</cn><apply id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1"><abs id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.2"></abs><apply id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1">subscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.2">𝐶</ci><ci id="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.1.1.1.1.1.3">𝑣</ci></apply></apply></apply><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2"><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1">superscript</csymbol><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1">subscript</csymbol><sum id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.2"></sum><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3"><eq id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.1"></eq><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.2">𝑖</ci><cn id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.3.cmml" type="integer" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.1.2.3.3">1</cn></apply></apply><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.3"><abs id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.3.1"></abs><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.2.1.1">𝒵</ci></apply></apply><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2"><times id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.1"></times><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2">subscript</csymbol><cn id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.2.cmml" type="integer" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.2">1</cn><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3"><eq id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.1"></eq><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2">subscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.2">𝑌</ci><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.2.3">𝑖</ci></apply><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.2.3.3">𝑣</ci></apply></apply><apply id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3">subscript</csymbol><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.2.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.2">𝒛</ci><ci id="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.3.cmml" xref="S3.SS0.SSS0.Px4.p1.6.m6.2.3.3.2.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.6.m6.2c">\bar{C}_{v}=\frac{1}{|C_{v}|}\sum_{i=1}^{|\mathcal{Z}|}\mathbbm{1}_{Y_{i}=v}{%
\bm{z}}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.6.m6.2d">over¯ start_ARG italic_C end_ARG start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT = divide start_ARG 1 end_ARG start_ARG | italic_C start_POSTSUBSCRIPT italic_v end_POSTSUBSCRIPT | end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | caligraphic_Z | end_POSTSUPERSCRIPT blackboard_1 start_POSTSUBSCRIPT italic_Y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = italic_v end_POSTSUBSCRIPT bold_italic_z start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. We calculate the nearest K (K<math alttext="&gt;=" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.7.m7.1"><semantics id="S3.SS0.SSS0.Px4.p1.7.m7.1a"><mo id="S3.SS0.SSS0.Px4.p1.7.m7.1.1" mathvariant="italic" xref="S3.SS0.SSS0.Px4.p1.7.m7.1.1.cmml">&gt;=</mo><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.7.m7.1b"><geq id="S3.SS0.SSS0.Px4.p1.7.m7.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.7.m7.1.1"></geq></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.7.m7.1c">&gt;=</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.7.m7.1d">&gt; =</annotation></semantics></math>N) cluster centers w.r.t the anchor and randomly sample N clusters to make the source of the negative sample diverse. Then we randomly sample one point from the corresponding cluster as a negative sample. As the anchor vector only involves querying <math alttext="|C|" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.8.m8.1"><semantics id="S3.SS0.SSS0.Px4.p1.8.m8.1a"><mrow id="S3.SS0.SSS0.Px4.p1.8.m8.1.2.2" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.2.1.cmml"><mo id="S3.SS0.SSS0.Px4.p1.8.m8.1.2.2.1" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.2.1.1.cmml">|</mo><mi id="S3.SS0.SSS0.Px4.p1.8.m8.1.1" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.1.cmml">C</mi><mo id="S3.SS0.SSS0.Px4.p1.8.m8.1.2.2.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.8.m8.1b"><apply id="S3.SS0.SSS0.Px4.p1.8.m8.1.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.2.2"><abs id="S3.SS0.SSS0.Px4.p1.8.m8.1.2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.2.2.1"></abs><ci id="S3.SS0.SSS0.Px4.p1.8.m8.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.8.m8.1.1">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.8.m8.1c">|C|</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.8.m8.1d">| italic_C |</annotation></semantics></math> cluster centers and <math alttext="|C|&lt;&lt;|\mathcal{Z}|" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px4.p1.9.m9.2"><semantics id="S3.SS0.SSS0.Px4.p1.9.m9.2a"><mrow id="S3.SS0.SSS0.Px4.p1.9.m9.2.3" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.cmml"><mrow id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.2" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.1.cmml"><mo id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.2.1" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.1.1.cmml">|</mo><mi id="S3.SS0.SSS0.Px4.p1.9.m9.1.1" xref="S3.SS0.SSS0.Px4.p1.9.m9.1.1.cmml">C</mi><mo id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.2.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.1.1.cmml">|</mo></mrow><mo id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.1" mathvariant="italic" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.1.cmml">&lt;&lt;</mo><mrow id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.2" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.1.cmml"><mo id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.1.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px4.p1.9.m9.2.2" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.2.cmml">𝒵</mi><mo id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.2.2" stretchy="false" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.1.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px4.p1.9.m9.2b"><apply id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3"><csymbol cd="latexml" id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.1">much-less-than</csymbol><apply id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.2"><abs id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.2.2.1"></abs><ci id="S3.SS0.SSS0.Px4.p1.9.m9.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.1.1">𝐶</ci></apply><apply id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.2"><abs id="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.1.1.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.3.3.2.1"></abs><ci id="S3.SS0.SSS0.Px4.p1.9.m9.2.2.cmml" xref="S3.SS0.SSS0.Px4.p1.9.m9.2.2">𝒵</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px4.p1.9.m9.2c">|C|&lt;&lt;|\mathcal{Z}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px4.p1.9.m9.2d">| italic_C | &lt; &lt; | caligraphic_Z |</annotation></semantics></math>, our approach runs faster than the exact global search.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px5">
<h3 class="ltx_title ltx_title_paragraph">Inference</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px5.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px5.p1.3">After training, we use the well-trained <span class="ltx_text ltx_markedasmath" id="S3.SS0.SSS0.Px5.p1.3.1">FFN</span> to rebuild the retrieval datastore <math alttext="\mathcal{H}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.2.m2.1"><semantics id="S3.SS0.SSS0.Px5.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px5.p1.2.m2.1.1" xref="S3.SS0.SSS0.Px5.p1.2.m2.1.1.cmml">ℋ</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.2.m2.1b"><ci id="S3.SS0.SSS0.Px5.p1.2.m2.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.2.m2.1.1">ℋ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.2.m2.1c">\mathcal{H}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.2.m2.1d">caligraphic_H</annotation></semantics></math> into <math alttext="\mathcal{Z}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.3.m3.1"><semantics id="S3.SS0.SSS0.Px5.p1.3.m3.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px5.p1.3.m3.1.1" xref="S3.SS0.SSS0.Px5.p1.3.m3.1.1.cmml">𝒵</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.3.m3.1b"><ci id="S3.SS0.SSS0.Px5.p1.3.m3.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.3.m3.1.1">𝒵</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.3.m3.1c">\mathcal{Z}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.3.m3.1d">caligraphic_Z</annotation></semantics></math>. To further reduce calculation cost at test time, we introduce PCA to reduce the dimension of the retrieval vector. We also add normalization after PCA to guarantee the numerical stability of the input to the inner product. Another difference with Eq. <a class="ltx_ref" href="#S2.E4" title="4 ‣ kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a> is that we use the inner product instead of the L2 distance as distance metrics. The reason is that using consistent distance metrics in training and inference improves performance in primitive experiments.
Concretely, we modify the original <span class="ltx_text ltx_font_italic" id="S3.SS0.SSS0.Px5.p1.3.2">k</span>NN-MT in Eq. <a class="ltx_ref" href="#S2.E4" title="4 ‣ kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a> as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{r}(\hat{{\bm{y}}}_{t}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})\propto\sum_{i=1}^{k}%
\mathbbm{1}_{\hat{y}_{t}=\tilde{v}_{i}}\textrm{exp}\Big{(}\frac{g(\tilde{{\bm{%
z}}}_{i})\otimes g(\hat{{\bm{z}}}_{t})}{T}\Big{)}," class="ltx_Math" display="block" id="S3.E7.m1.4"><semantics id="S3.E7.m1.4a"><mrow id="S3.E7.m1.4.4.1" xref="S3.E7.m1.4.4.1.1.cmml"><mrow id="S3.E7.m1.4.4.1.1" xref="S3.E7.m1.4.4.1.1.cmml"><mrow id="S3.E7.m1.4.4.1.1.1" xref="S3.E7.m1.4.4.1.1.1.cmml"><msub id="S3.E7.m1.4.4.1.1.1.3" xref="S3.E7.m1.4.4.1.1.1.3.cmml"><mi id="S3.E7.m1.4.4.1.1.1.3.2" xref="S3.E7.m1.4.4.1.1.1.3.2.cmml">p</mi><mi id="S3.E7.m1.4.4.1.1.1.3.3" xref="S3.E7.m1.4.4.1.1.1.3.3.cmml">r</mi></msub><mo id="S3.E7.m1.4.4.1.1.1.2" xref="S3.E7.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="S3.E7.m1.4.4.1.1.1.1.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.cmml"><mo id="S3.E7.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S3.E7.m1.4.4.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E7.m1.4.4.1.1.1.1.1.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.cmml"><msub id="S3.E7.m1.4.4.1.1.1.1.1.1.3" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.cmml"><mover accent="true" id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.cmml"><mi id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.2.cmml">𝒚</mi><mo id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.1.cmml">^</mo></mover><mi id="S3.E7.m1.4.4.1.1.1.1.1.1.3.3" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.3.cmml">t</mi></msub><mo fence="false" id="S3.E7.m1.4.4.1.1.1.1.1.1.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.2.cmml">|</mo><mrow id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E7.m1.3.3" xref="S3.E7.m1.3.3.cmml">𝒙</mi><mo id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml">𝒚</mi><mo id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.3.cmml">t</mi></mrow></msub></mrow></mrow><mo id="S3.E7.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S3.E7.m1.4.4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E7.m1.4.4.1.1.2" rspace="0.111em" xref="S3.E7.m1.4.4.1.1.2.cmml">∝</mo><mrow id="S3.E7.m1.4.4.1.1.3" xref="S3.E7.m1.4.4.1.1.3.cmml"><munderover id="S3.E7.m1.4.4.1.1.3.1" xref="S3.E7.m1.4.4.1.1.3.1.cmml"><mo id="S3.E7.m1.4.4.1.1.3.1.2.2" movablelimits="false" xref="S3.E7.m1.4.4.1.1.3.1.2.2.cmml">∑</mo><mrow id="S3.E7.m1.4.4.1.1.3.1.2.3" xref="S3.E7.m1.4.4.1.1.3.1.2.3.cmml"><mi id="S3.E7.m1.4.4.1.1.3.1.2.3.2" xref="S3.E7.m1.4.4.1.1.3.1.2.3.2.cmml">i</mi><mo id="S3.E7.m1.4.4.1.1.3.1.2.3.1" xref="S3.E7.m1.4.4.1.1.3.1.2.3.1.cmml">=</mo><mn id="S3.E7.m1.4.4.1.1.3.1.2.3.3" xref="S3.E7.m1.4.4.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E7.m1.4.4.1.1.3.1.3" xref="S3.E7.m1.4.4.1.1.3.1.3.cmml">k</mi></munderover><mrow id="S3.E7.m1.4.4.1.1.3.2" xref="S3.E7.m1.4.4.1.1.3.2.cmml"><msub id="S3.E7.m1.4.4.1.1.3.2.2" xref="S3.E7.m1.4.4.1.1.3.2.2.cmml"><mn id="S3.E7.m1.4.4.1.1.3.2.2.2" xref="S3.E7.m1.4.4.1.1.3.2.2.2.cmml">𝟙</mn><mrow id="S3.E7.m1.4.4.1.1.3.2.2.3" xref="S3.E7.m1.4.4.1.1.3.2.2.3.cmml"><msub id="S3.E7.m1.4.4.1.1.3.2.2.3.2" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.cmml"><mover accent="true" id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.cmml"><mi id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.2" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.2.cmml">y</mi><mo id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.1" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.1.cmml">^</mo></mover><mi id="S3.E7.m1.4.4.1.1.3.2.2.3.2.3" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.3.cmml">t</mi></msub><mo id="S3.E7.m1.4.4.1.1.3.2.2.3.1" xref="S3.E7.m1.4.4.1.1.3.2.2.3.1.cmml">=</mo><msub id="S3.E7.m1.4.4.1.1.3.2.2.3.3" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.cmml"><mover accent="true" id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.cmml"><mi id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.2" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.2.cmml">v</mi><mo id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.1" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.1.cmml">~</mo></mover><mi id="S3.E7.m1.4.4.1.1.3.2.2.3.3.3" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.3.cmml">i</mi></msub></mrow></msub><mo id="S3.E7.m1.4.4.1.1.3.2.1" xref="S3.E7.m1.4.4.1.1.3.2.1.cmml">⁢</mo><mtext id="S3.E7.m1.4.4.1.1.3.2.3" xref="S3.E7.m1.4.4.1.1.3.2.3a.cmml">exp</mtext><mo id="S3.E7.m1.4.4.1.1.3.2.1a" xref="S3.E7.m1.4.4.1.1.3.2.1.cmml">⁢</mo><mrow id="S3.E7.m1.4.4.1.1.3.2.4.2" xref="S3.E7.m1.2.2.cmml"><mo id="S3.E7.m1.4.4.1.1.3.2.4.2.1" maxsize="160%" minsize="160%" xref="S3.E7.m1.2.2.cmml">(</mo><mfrac id="S3.E7.m1.2.2" xref="S3.E7.m1.2.2.cmml"><mrow id="S3.E7.m1.2.2.2" xref="S3.E7.m1.2.2.2.cmml"><mrow id="S3.E7.m1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.cmml"><mrow id="S3.E7.m1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.cmml"><mi id="S3.E7.m1.1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.1.3.cmml">g</mi><mo id="S3.E7.m1.1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E7.m1.1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E7.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E7.m1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E7.m1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E7.m1.1.1.1.1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E7.m1.1.1.1.1.1.1.1.1.2.2" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2.2.cmml">𝒛</mi><mo id="S3.E7.m1.1.1.1.1.1.1.1.1.2.1" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2.1.cmml">~</mo></mover><mi id="S3.E7.m1.1.1.1.1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E7.m1.1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.E7.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E7.m1.1.1.1.1.2" rspace="0.222em" xref="S3.E7.m1.1.1.1.1.2.cmml">⊗</mo><mi id="S3.E7.m1.1.1.1.1.3" xref="S3.E7.m1.1.1.1.1.3.cmml">g</mi></mrow><mo id="S3.E7.m1.2.2.2.3" xref="S3.E7.m1.2.2.2.3.cmml">⁢</mo><mrow id="S3.E7.m1.2.2.2.2.1" xref="S3.E7.m1.2.2.2.2.1.1.cmml"><mo id="S3.E7.m1.2.2.2.2.1.2" stretchy="false" xref="S3.E7.m1.2.2.2.2.1.1.cmml">(</mo><msub id="S3.E7.m1.2.2.2.2.1.1" xref="S3.E7.m1.2.2.2.2.1.1.cmml"><mover accent="true" id="S3.E7.m1.2.2.2.2.1.1.2" xref="S3.E7.m1.2.2.2.2.1.1.2.cmml"><mi id="S3.E7.m1.2.2.2.2.1.1.2.2" xref="S3.E7.m1.2.2.2.2.1.1.2.2.cmml">𝒛</mi><mo id="S3.E7.m1.2.2.2.2.1.1.2.1" xref="S3.E7.m1.2.2.2.2.1.1.2.1.cmml">^</mo></mover><mi id="S3.E7.m1.2.2.2.2.1.1.3" xref="S3.E7.m1.2.2.2.2.1.1.3.cmml">t</mi></msub><mo id="S3.E7.m1.2.2.2.2.1.3" stretchy="false" xref="S3.E7.m1.2.2.2.2.1.1.cmml">)</mo></mrow></mrow><mi id="S3.E7.m1.2.2.4" xref="S3.E7.m1.2.2.4.cmml">T</mi></mfrac><mo id="S3.E7.m1.4.4.1.1.3.2.4.2.2" maxsize="160%" minsize="160%" xref="S3.E7.m1.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.E7.m1.4.4.1.2" xref="S3.E7.m1.4.4.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E7.m1.4b"><apply id="S3.E7.m1.4.4.1.1.cmml" xref="S3.E7.m1.4.4.1"><csymbol cd="latexml" id="S3.E7.m1.4.4.1.1.2.cmml" xref="S3.E7.m1.4.4.1.1.2">proportional-to</csymbol><apply id="S3.E7.m1.4.4.1.1.1.cmml" xref="S3.E7.m1.4.4.1.1.1"><times id="S3.E7.m1.4.4.1.1.1.2.cmml" xref="S3.E7.m1.4.4.1.1.1.2"></times><apply id="S3.E7.m1.4.4.1.1.1.3.cmml" xref="S3.E7.m1.4.4.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.1.3.1.cmml" xref="S3.E7.m1.4.4.1.1.1.3">subscript</csymbol><ci id="S3.E7.m1.4.4.1.1.1.3.2.cmml" xref="S3.E7.m1.4.4.1.1.1.3.2">𝑝</ci><ci id="S3.E7.m1.4.4.1.1.1.3.3.cmml" xref="S3.E7.m1.4.4.1.1.1.3.3">𝑟</ci></apply><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S3.E7.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.2">conditional</csymbol><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3">subscript</csymbol><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2"><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.1">^</ci><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.2.2">𝒚</ci></apply><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.3.3">𝑡</ci></apply><list id="S3.E7.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1"><ci id="S3.E7.m1.3.3.cmml" xref="S3.E7.m1.3.3">𝒙</ci><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.2.2">𝒚</ci></apply><apply id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3"><lt id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.4.4.1.1.1.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></list></apply></apply><apply id="S3.E7.m1.4.4.1.1.3.cmml" xref="S3.E7.m1.4.4.1.1.3"><apply id="S3.E7.m1.4.4.1.1.3.1.cmml" xref="S3.E7.m1.4.4.1.1.3.1"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.3.1.1.cmml" xref="S3.E7.m1.4.4.1.1.3.1">superscript</csymbol><apply id="S3.E7.m1.4.4.1.1.3.1.2.cmml" xref="S3.E7.m1.4.4.1.1.3.1"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.3.1.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.1">subscript</csymbol><sum id="S3.E7.m1.4.4.1.1.3.1.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.1.2.2"></sum><apply id="S3.E7.m1.4.4.1.1.3.1.2.3.cmml" xref="S3.E7.m1.4.4.1.1.3.1.2.3"><eq id="S3.E7.m1.4.4.1.1.3.1.2.3.1.cmml" xref="S3.E7.m1.4.4.1.1.3.1.2.3.1"></eq><ci id="S3.E7.m1.4.4.1.1.3.1.2.3.2.cmml" xref="S3.E7.m1.4.4.1.1.3.1.2.3.2">𝑖</ci><cn id="S3.E7.m1.4.4.1.1.3.1.2.3.3.cmml" type="integer" xref="S3.E7.m1.4.4.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E7.m1.4.4.1.1.3.1.3.cmml" xref="S3.E7.m1.4.4.1.1.3.1.3">𝑘</ci></apply><apply id="S3.E7.m1.4.4.1.1.3.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2"><times id="S3.E7.m1.4.4.1.1.3.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.1"></times><apply id="S3.E7.m1.4.4.1.1.3.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.3.2.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2">subscript</csymbol><cn id="S3.E7.m1.4.4.1.1.3.2.2.2.cmml" type="integer" xref="S3.E7.m1.4.4.1.1.3.2.2.2">1</cn><apply id="S3.E7.m1.4.4.1.1.3.2.2.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3"><eq id="S3.E7.m1.4.4.1.1.3.2.2.3.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.1"></eq><apply id="S3.E7.m1.4.4.1.1.3.2.2.3.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.3.2.2.3.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2">subscript</csymbol><apply id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2"><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.1">^</ci><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.2.2">𝑦</ci></apply><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.2.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.2.3">𝑡</ci></apply><apply id="S3.E7.m1.4.4.1.1.3.2.2.3.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3"><csymbol cd="ambiguous" id="S3.E7.m1.4.4.1.1.3.2.2.3.3.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3">subscript</csymbol><apply id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2"><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.1.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.1">~</ci><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.2.2">𝑣</ci></apply><ci id="S3.E7.m1.4.4.1.1.3.2.2.3.3.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.2.3.3.3">𝑖</ci></apply></apply></apply><ci id="S3.E7.m1.4.4.1.1.3.2.3a.cmml" xref="S3.E7.m1.4.4.1.1.3.2.3"><mtext id="S3.E7.m1.4.4.1.1.3.2.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.3">exp</mtext></ci><apply id="S3.E7.m1.2.2.cmml" xref="S3.E7.m1.4.4.1.1.3.2.4.2"><divide id="S3.E7.m1.2.2.3.cmml" xref="S3.E7.m1.4.4.1.1.3.2.4.2"></divide><apply id="S3.E7.m1.2.2.2.cmml" xref="S3.E7.m1.2.2.2"><times id="S3.E7.m1.2.2.2.3.cmml" xref="S3.E7.m1.2.2.2.3"></times><apply id="S3.E7.m1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1"><csymbol cd="latexml" id="S3.E7.m1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.2">tensor-product</csymbol><apply id="S3.E7.m1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1"><times id="S3.E7.m1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.1.2"></times><ci id="S3.E7.m1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.1.3">𝑔</ci><apply id="S3.E7.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E7.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2"><ci id="S3.E7.m1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2.1">~</ci><ci id="S3.E7.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.2.2">𝒛</ci></apply><ci id="S3.E7.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><ci id="S3.E7.m1.1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.1.3">𝑔</ci></apply><apply id="S3.E7.m1.2.2.2.2.1.1.cmml" xref="S3.E7.m1.2.2.2.2.1"><csymbol cd="ambiguous" id="S3.E7.m1.2.2.2.2.1.1.1.cmml" xref="S3.E7.m1.2.2.2.2.1">subscript</csymbol><apply id="S3.E7.m1.2.2.2.2.1.1.2.cmml" xref="S3.E7.m1.2.2.2.2.1.1.2"><ci id="S3.E7.m1.2.2.2.2.1.1.2.1.cmml" xref="S3.E7.m1.2.2.2.2.1.1.2.1">^</ci><ci id="S3.E7.m1.2.2.2.2.1.1.2.2.cmml" xref="S3.E7.m1.2.2.2.2.1.1.2.2">𝒛</ci></apply><ci id="S3.E7.m1.2.2.2.2.1.1.3.cmml" xref="S3.E7.m1.2.2.2.2.1.1.3">𝑡</ci></apply></apply><ci id="S3.E7.m1.2.2.4.cmml" xref="S3.E7.m1.2.2.4">𝑇</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E7.m1.4c">p_{r}(\hat{{\bm{y}}}_{t}|{\bm{x}},\hat{{\bm{y}}}_{&lt;t})\propto\sum_{i=1}^{k}%
\mathbbm{1}_{\hat{y}_{t}=\tilde{v}_{i}}\textrm{exp}\Big{(}\frac{g(\tilde{{\bm{%
z}}}_{i})\otimes g(\hat{{\bm{z}}}_{t})}{T}\Big{)},</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.4d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT | bold_italic_x , over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_t end_POSTSUBSCRIPT ) ∝ ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT blackboard_1 start_POSTSUBSCRIPT over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = over~ start_ARG italic_v end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT exp ( divide start_ARG italic_g ( over~ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ⊗ italic_g ( over^ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) end_ARG start_ARG italic_T end_ARG ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS0.SSS0.Px5.p1.11">where <math alttext="g(x)=\textrm{Norm}(\textrm{PCA}(x))" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.4.m1.3"><semantics id="S3.SS0.SSS0.Px5.p1.4.m1.3a"><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.cmml"><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.cmml"><mi id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.2.cmml">g</mi><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.1.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.3.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.cmml"><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.cmml">(</mo><mi id="S3.SS0.SSS0.Px5.p1.4.m1.1.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.1.1.cmml">x</mi><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.3.2.2" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.cmml">)</mo></mrow></mrow><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.2.cmml">=</mo><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.cmml"><mtext id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3a.cmml">Norm</mtext><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.2.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml"><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.2" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml"><mtext id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2a.cmml">PCA</mtext><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.1" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.3.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml"><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml">(</mo><mi id="S3.SS0.SSS0.Px5.p1.4.m1.2.2" xref="S3.SS0.SSS0.Px5.p1.4.m1.2.2.cmml">x</mi><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.3.2.2" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.3" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.4.m1.3b"><apply id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3"><eq id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.2.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.2"></eq><apply id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3"><times id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.1.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.1"></times><ci id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.2.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.3.2">𝑔</ci><ci id="S3.SS0.SSS0.Px5.p1.4.m1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.1.1">𝑥</ci></apply><apply id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1"><times id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.2.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.2"></times><ci id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3a.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3"><mtext id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.3">Norm</mtext></ci><apply id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1"><times id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.1"></times><ci id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2a.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2"><mtext id="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.3.3.1.1.1.1.2">PCA</mtext></ci><ci id="S3.SS0.SSS0.Px5.p1.4.m1.2.2.cmml" xref="S3.SS0.SSS0.Px5.p1.4.m1.2.2">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.4.m1.3c">g(x)=\textrm{Norm}(\textrm{PCA}(x))</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.4.m1.3d">italic_g ( italic_x ) = Norm ( PCA ( italic_x ) )</annotation></semantics></math>, <math alttext="\otimes" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.5.m2.1"><semantics id="S3.SS0.SSS0.Px5.p1.5.m2.1a"><mo id="S3.SS0.SSS0.Px5.p1.5.m2.1.1" xref="S3.SS0.SSS0.Px5.p1.5.m2.1.1.cmml">⊗</mo><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.5.m2.1b"><csymbol cd="latexml" id="S3.SS0.SSS0.Px5.p1.5.m2.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.5.m2.1.1">tensor-product</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.5.m2.1c">\otimes</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.5.m2.1d">⊗</annotation></semantics></math> denotes inner product operation, <math alttext="\tilde{{\bm{z}}}_{i}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.6.m3.1"><semantics id="S3.SS0.SSS0.Px5.p1.6.m3.1a"><msub id="S3.SS0.SSS0.Px5.p1.6.m3.1.1" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.cmml"><mover accent="true" id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.2" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.1" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.1.cmml">~</mo></mover><mi id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.3" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.6.m3.1b"><apply id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1">subscript</csymbol><apply id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2"><ci id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.1">~</ci><ci id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.2.2">𝒛</ci></apply><ci id="S3.SS0.SSS0.Px5.p1.6.m3.1.1.3.cmml" xref="S3.SS0.SSS0.Px5.p1.6.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.6.m3.1c">\tilde{{\bm{z}}}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.6.m3.1d">over~ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.7.m4.1"><semantics id="S3.SS0.SSS0.Px5.p1.7.m4.1a"><mi id="S3.SS0.SSS0.Px5.p1.7.m4.1.1" xref="S3.SS0.SSS0.Px5.p1.7.m4.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.7.m4.1b"><ci id="S3.SS0.SSS0.Px5.p1.7.m4.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.7.m4.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.7.m4.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.7.m4.1d">italic_i</annotation></semantics></math>-th nearest neighbor in <math alttext="\mathcal{Z}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.8.m5.1"><semantics id="S3.SS0.SSS0.Px5.p1.8.m5.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS0.SSS0.Px5.p1.8.m5.1.1" xref="S3.SS0.SSS0.Px5.p1.8.m5.1.1.cmml">𝒵</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.8.m5.1b"><ci id="S3.SS0.SSS0.Px5.p1.8.m5.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.8.m5.1.1">𝒵</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.8.m5.1c">\mathcal{Z}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.8.m5.1d">caligraphic_Z</annotation></semantics></math> for the current retrieval representation <math alttext="\hat{{\bm{z}}}_{t}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.9.m6.1"><semantics id="S3.SS0.SSS0.Px5.p1.9.m6.1a"><msub id="S3.SS0.SSS0.Px5.p1.9.m6.1.1" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.cmml"><mover accent="true" id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.cmml"><mi id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.2" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.2.cmml">𝒛</mi><mo id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.1" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.1.cmml">^</mo></mover><mi id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.3" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.9.m6.1b"><apply id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1">subscript</csymbol><apply id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2"><ci id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.1.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.1">^</ci><ci id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.2.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.2.2">𝒛</ci></apply><ci id="S3.SS0.SSS0.Px5.p1.9.m6.1.1.3.cmml" xref="S3.SS0.SSS0.Px5.p1.9.m6.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.9.m6.1c">\hat{{\bm{z}}}_{t}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.9.m6.1d">over^ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>.
As a bonus, since the numeric range of the normalized inner product is <math alttext="[0,1]" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.10.m7.2"><semantics id="S3.SS0.SSS0.Px5.p1.10.m7.2a"><mrow id="S3.SS0.SSS0.Px5.p1.10.m7.2.3.2" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.3.1.cmml"><mo id="S3.SS0.SSS0.Px5.p1.10.m7.2.3.2.1" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.3.1.cmml">[</mo><mn id="S3.SS0.SSS0.Px5.p1.10.m7.1.1" xref="S3.SS0.SSS0.Px5.p1.10.m7.1.1.cmml">0</mn><mo id="S3.SS0.SSS0.Px5.p1.10.m7.2.3.2.2" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.3.1.cmml">,</mo><mn id="S3.SS0.SSS0.Px5.p1.10.m7.2.2" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.2.cmml">1</mn><mo id="S3.SS0.SSS0.Px5.p1.10.m7.2.3.2.3" stretchy="false" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.10.m7.2b"><interval closure="closed" id="S3.SS0.SSS0.Px5.p1.10.m7.2.3.1.cmml" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.3.2"><cn id="S3.SS0.SSS0.Px5.p1.10.m7.1.1.cmml" type="integer" xref="S3.SS0.SSS0.Px5.p1.10.m7.1.1">0</cn><cn id="S3.SS0.SSS0.Px5.p1.10.m7.2.2.cmml" type="integer" xref="S3.SS0.SSS0.Px5.p1.10.m7.2.2">1</cn></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.10.m7.2c">[0,1]</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.10.m7.2d">[ 0 , 1 ]</annotation></semantics></math>, which can be seen as the confidence in retrieving.<span class="ltx_note ltx_role_footnote" id="footnote3"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span>L2 distance lacks this feature because its numeric range is too broad, e.g., 0~1000 in our observation.</span></span></span> We leverage this nature to modify the interpolation coefficient <math alttext="\lambda" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.11.m8.1"><semantics id="S3.SS0.SSS0.Px5.p1.11.m8.1a"><mi id="S3.SS0.SSS0.Px5.p1.11.m8.1.1" xref="S3.SS0.SSS0.Px5.p1.11.m8.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.11.m8.1b"><ci id="S3.SS0.SSS0.Px5.p1.11.m8.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.11.m8.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.11.m8.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.11.m8.1d">italic_λ</annotation></semantics></math> in Eq. <a class="ltx_ref" href="#S2.E2" title="2 ‣ kNN-MT ‣ 2 Background ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a> to be aware of retrieval confidence:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\lambda^{*}=\lambda\times\frac{\sum_{i=1}^{k}g(\tilde{{\bm{z}}}_{i})\otimes g(%
\hat{{\bm{z}}}_{t})}{k}." class="ltx_Math" display="block" id="S3.E8.m1.3"><semantics id="S3.E8.m1.3a"><mrow id="S3.E8.m1.3.3.1" xref="S3.E8.m1.3.3.1.1.cmml"><mrow id="S3.E8.m1.3.3.1.1" xref="S3.E8.m1.3.3.1.1.cmml"><msup id="S3.E8.m1.3.3.1.1.2" xref="S3.E8.m1.3.3.1.1.2.cmml"><mi id="S3.E8.m1.3.3.1.1.2.2" xref="S3.E8.m1.3.3.1.1.2.2.cmml">λ</mi><mo id="S3.E8.m1.3.3.1.1.2.3" xref="S3.E8.m1.3.3.1.1.2.3.cmml">*</mo></msup><mo id="S3.E8.m1.3.3.1.1.1" xref="S3.E8.m1.3.3.1.1.1.cmml">=</mo><mrow id="S3.E8.m1.3.3.1.1.3" xref="S3.E8.m1.3.3.1.1.3.cmml"><mi id="S3.E8.m1.3.3.1.1.3.2" xref="S3.E8.m1.3.3.1.1.3.2.cmml">λ</mi><mo id="S3.E8.m1.3.3.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E8.m1.3.3.1.1.3.1.cmml">×</mo><mfrac id="S3.E8.m1.2.2" xref="S3.E8.m1.2.2.cmml"><mrow id="S3.E8.m1.2.2.2" xref="S3.E8.m1.2.2.2.cmml"><msubsup id="S3.E8.m1.2.2.2.3" xref="S3.E8.m1.2.2.2.3.cmml"><mo id="S3.E8.m1.2.2.2.3.2.2" xref="S3.E8.m1.2.2.2.3.2.2.cmml">∑</mo><mrow id="S3.E8.m1.2.2.2.3.2.3" xref="S3.E8.m1.2.2.2.3.2.3.cmml"><mi id="S3.E8.m1.2.2.2.3.2.3.2" xref="S3.E8.m1.2.2.2.3.2.3.2.cmml">i</mi><mo id="S3.E8.m1.2.2.2.3.2.3.1" xref="S3.E8.m1.2.2.2.3.2.3.1.cmml">=</mo><mn id="S3.E8.m1.2.2.2.3.2.3.3" xref="S3.E8.m1.2.2.2.3.2.3.3.cmml">1</mn></mrow><mi id="S3.E8.m1.2.2.2.3.3" xref="S3.E8.m1.2.2.2.3.3.cmml">k</mi></msubsup><mrow id="S3.E8.m1.2.2.2.2" xref="S3.E8.m1.2.2.2.2.cmml"><mrow id="S3.E8.m1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.cmml"><mrow id="S3.E8.m1.1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.1.cmml"><mi id="S3.E8.m1.1.1.1.1.1.1.3" xref="S3.E8.m1.1.1.1.1.1.1.3.cmml">g</mi><mo id="S3.E8.m1.1.1.1.1.1.1.2" xref="S3.E8.m1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E8.m1.1.1.1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E8.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E8.m1.1.1.1.1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.2.cmml">𝒛</mi><mo id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.1" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.1.cmml">~</mo></mover><mi id="S3.E8.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E8.m1.1.1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E8.m1.1.1.1.1.1.2" rspace="0.222em" xref="S3.E8.m1.1.1.1.1.1.2.cmml">⊗</mo><mi id="S3.E8.m1.1.1.1.1.1.3" xref="S3.E8.m1.1.1.1.1.1.3.cmml">g</mi></mrow><mo id="S3.E8.m1.2.2.2.2.3" xref="S3.E8.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="S3.E8.m1.2.2.2.2.2.1" xref="S3.E8.m1.2.2.2.2.2.1.1.cmml"><mo id="S3.E8.m1.2.2.2.2.2.1.2" stretchy="false" xref="S3.E8.m1.2.2.2.2.2.1.1.cmml">(</mo><msub id="S3.E8.m1.2.2.2.2.2.1.1" xref="S3.E8.m1.2.2.2.2.2.1.1.cmml"><mover accent="true" id="S3.E8.m1.2.2.2.2.2.1.1.2" xref="S3.E8.m1.2.2.2.2.2.1.1.2.cmml"><mi id="S3.E8.m1.2.2.2.2.2.1.1.2.2" xref="S3.E8.m1.2.2.2.2.2.1.1.2.2.cmml">𝒛</mi><mo id="S3.E8.m1.2.2.2.2.2.1.1.2.1" xref="S3.E8.m1.2.2.2.2.2.1.1.2.1.cmml">^</mo></mover><mi id="S3.E8.m1.2.2.2.2.2.1.1.3" xref="S3.E8.m1.2.2.2.2.2.1.1.3.cmml">t</mi></msub><mo id="S3.E8.m1.2.2.2.2.2.1.3" stretchy="false" xref="S3.E8.m1.2.2.2.2.2.1.1.cmml">)</mo></mrow></mrow></mrow><mi id="S3.E8.m1.2.2.4" xref="S3.E8.m1.2.2.4.cmml">k</mi></mfrac></mrow></mrow><mo id="S3.E8.m1.3.3.1.2" lspace="0em" xref="S3.E8.m1.3.3.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E8.m1.3b"><apply id="S3.E8.m1.3.3.1.1.cmml" xref="S3.E8.m1.3.3.1"><eq id="S3.E8.m1.3.3.1.1.1.cmml" xref="S3.E8.m1.3.3.1.1.1"></eq><apply id="S3.E8.m1.3.3.1.1.2.cmml" xref="S3.E8.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.3.3.1.1.2.1.cmml" xref="S3.E8.m1.3.3.1.1.2">superscript</csymbol><ci id="S3.E8.m1.3.3.1.1.2.2.cmml" xref="S3.E8.m1.3.3.1.1.2.2">𝜆</ci><times id="S3.E8.m1.3.3.1.1.2.3.cmml" xref="S3.E8.m1.3.3.1.1.2.3"></times></apply><apply id="S3.E8.m1.3.3.1.1.3.cmml" xref="S3.E8.m1.3.3.1.1.3"><times id="S3.E8.m1.3.3.1.1.3.1.cmml" xref="S3.E8.m1.3.3.1.1.3.1"></times><ci id="S3.E8.m1.3.3.1.1.3.2.cmml" xref="S3.E8.m1.3.3.1.1.3.2">𝜆</ci><apply id="S3.E8.m1.2.2.cmml" xref="S3.E8.m1.2.2"><divide id="S3.E8.m1.2.2.3.cmml" xref="S3.E8.m1.2.2"></divide><apply id="S3.E8.m1.2.2.2.cmml" xref="S3.E8.m1.2.2.2"><apply id="S3.E8.m1.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.3"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.3.1.cmml" xref="S3.E8.m1.2.2.2.3">superscript</csymbol><apply id="S3.E8.m1.2.2.2.3.2.cmml" xref="S3.E8.m1.2.2.2.3"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.3.2.1.cmml" xref="S3.E8.m1.2.2.2.3">subscript</csymbol><sum id="S3.E8.m1.2.2.2.3.2.2.cmml" xref="S3.E8.m1.2.2.2.3.2.2"></sum><apply id="S3.E8.m1.2.2.2.3.2.3.cmml" xref="S3.E8.m1.2.2.2.3.2.3"><eq id="S3.E8.m1.2.2.2.3.2.3.1.cmml" xref="S3.E8.m1.2.2.2.3.2.3.1"></eq><ci id="S3.E8.m1.2.2.2.3.2.3.2.cmml" xref="S3.E8.m1.2.2.2.3.2.3.2">𝑖</ci><cn id="S3.E8.m1.2.2.2.3.2.3.3.cmml" type="integer" xref="S3.E8.m1.2.2.2.3.2.3.3">1</cn></apply></apply><ci id="S3.E8.m1.2.2.2.3.3.cmml" xref="S3.E8.m1.2.2.2.3.3">𝑘</ci></apply><apply id="S3.E8.m1.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2"><times id="S3.E8.m1.2.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.2.3"></times><apply id="S3.E8.m1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.E8.m1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.1.1.1.1.1.2">tensor-product</csymbol><apply id="S3.E8.m1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1"><times id="S3.E8.m1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.1.1.1.1.1.1.2"></times><ci id="S3.E8.m1.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.1.1.1.1.1.1.3">𝑔</ci><apply id="S3.E8.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.1">~</ci><ci id="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.2.2">𝒛</ci></apply><ci id="S3.E8.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></apply><ci id="S3.E8.m1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.1.1.1.1.1.3">𝑔</ci></apply><apply id="S3.E8.m1.2.2.2.2.2.1.1.cmml" xref="S3.E8.m1.2.2.2.2.2.1"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.2.2.1.1.1.cmml" xref="S3.E8.m1.2.2.2.2.2.1">subscript</csymbol><apply id="S3.E8.m1.2.2.2.2.2.1.1.2.cmml" xref="S3.E8.m1.2.2.2.2.2.1.1.2"><ci id="S3.E8.m1.2.2.2.2.2.1.1.2.1.cmml" xref="S3.E8.m1.2.2.2.2.2.1.1.2.1">^</ci><ci id="S3.E8.m1.2.2.2.2.2.1.1.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2.1.1.2.2">𝒛</ci></apply><ci id="S3.E8.m1.2.2.2.2.2.1.1.3.cmml" xref="S3.E8.m1.2.2.2.2.2.1.1.3">𝑡</ci></apply></apply></apply><ci id="S3.E8.m1.2.2.4.cmml" xref="S3.E8.m1.2.2.4">𝑘</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E8.m1.3c">\lambda^{*}=\lambda\times\frac{\sum_{i=1}^{k}g(\tilde{{\bm{z}}}_{i})\otimes g(%
\hat{{\bm{z}}}_{t})}{k}.</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.3d">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT = italic_λ × divide start_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT italic_g ( over~ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ⊗ italic_g ( over^ start_ARG bold_italic_z end_ARG start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) end_ARG start_ARG italic_k end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS0.SSS0.Px5.p1.12"><math alttext="\lambda^{*}" class="ltx_Math" display="inline" id="S3.SS0.SSS0.Px5.p1.12.m1.1"><semantics id="S3.SS0.SSS0.Px5.p1.12.m1.1a"><msup id="S3.SS0.SSS0.Px5.p1.12.m1.1.1" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1.cmml"><mi id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.2" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1.2.cmml">λ</mi><mo id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.3" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS0.SSS0.Px5.p1.12.m1.1b"><apply id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1"><csymbol cd="ambiguous" id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.1.cmml" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1">superscript</csymbol><ci id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.2.cmml" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1.2">𝜆</ci><times id="S3.SS0.SSS0.Px5.p1.12.m1.1.1.3.cmml" xref="S3.SS0.SSS0.Px5.p1.12.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS0.SSS0.Px5.p1.12.m1.1c">\lambda^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.SS0.SSS0.Px5.p1.12.m1.1d">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> can be considered a simple adaptive coefficient like <cite class="ltx_cite ltx_citemacro_citet">Zheng et al. (<a class="ltx_ref" href="#bib.bib19" title="">2021</a>); Jiang et al. (<a class="ltx_ref" href="#bib.bib5" title="">2021</a>); Wang et al. (<a class="ltx_ref" href="#bib.bib13" title="">2022</a>)</cite>, but does not require training.</p>
</div>
<figure class="ltx_figure" id="S3.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="155" id="S3.F1.g1" src="extracted/5121566/difference_v2.png" width="287"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Illustration the differences between CKMT and <span class="ltx_text ltx_font_smallcaps" id="S3.F1.5.1">Clknn</span> in constructing positive and negative samples. Different colors indicate different tokens. <span class="ltx_text ltx_font_typewriter" id="S3.F1.6.2">A</span>/<span class="ltx_text ltx_font_typewriter" id="S3.F1.7.3">P</span>/<span class="ltx_text ltx_font_typewriter" id="S3.F1.8.4">N</span> means anchor, positive sample and negative sample, respectively. </figcaption>
</figure>
</section>
<section class="ltx_paragraph" id="S3.SS0.SSS0.Px6">
<h3 class="ltx_title ltx_title_paragraph">Discussion</h3>
<div class="ltx_para" id="S3.SS0.SSS0.Px6.p1">
<p class="ltx_p" id="S3.SS0.SSS0.Px6.p1.1">The closest work with us is CKMT <cite class="ltx_cite ltx_citemacro_cite">Wang et al. (<a class="ltx_ref" href="#bib.bib13" title="">2022</a>)</cite>. As illustrated in Figure <a class="ltx_ref" href="#S3.F1" title="Figure 1 ‣ Inference ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>, there are two major differences compared with CKMT:
(1) <span class="ltx_text ltx_font_smallcaps" id="S3.SS0.SSS0.Px6.p1.1.1">Clknn</span> uses multiple positive and negative samples, while CKMT only considers a single positive and negative sample, limiting the exploration of representation space.
(2) CKMT requires to partition clusters through cost-expensive clustering in full-scale datastore, while <span class="ltx_text ltx_font_smallcaps" id="S3.SS0.SSS0.Px6.p1.1.2">Clknn</span> predefines clusters based on vocabulary labels and only involves calculating cluster centers.
In practice, we spent about 6 hours on the CPU to complete the cluster operation in CKMT, while <span class="ltx_text ltx_font_smallcaps" id="S3.SS0.SSS0.Px6.p1.1.3">Clknn</span> only takes about 3 minutes.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<section class="ltx_paragraph" id="S4.SS0.SSS0.Px1">
<h3 class="ltx_title ltx_title_paragraph">Setup</h3>
<figure class="ltx_figure" id="S4.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<div class="ltx_inline-block ltx_flex_size_1 ltx_align_center ltx_transformed_outer" id="S4.F2.1" style="width:346.9pt;height:127.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-26.7pt,9.8pt) scale(0.866684302082241,0.866684302082241) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.F2.1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.F2.1.1.1.1">
<td class="ltx_td ltx_align_justify" id="S4.F2.1.1.1.1.1" style="width:130.1pt;">
<p class="ltx_p ltx_align_top" id="S4.F2.1.1.1.1.1.1"></p>
</td>
<td class="ltx_td ltx_align_justify" id="S4.F2.1.1.1.1.2" style="width:130.1pt;">
<p class="ltx_p ltx_align_top" id="S4.F2.1.1.1.1.2.1"></p>
</td>
<td class="ltx_td ltx_align_justify" id="S4.F2.1.1.1.1.3" style="width:130.1pt;">
<p class="ltx_p ltx_align_top" id="S4.F2.1.1.1.1.3.1"></p>
</td>
</tr>
</tbody>
</table>
</span></div>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_flex_size_3 ltx_align_center" id="S4.F2.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="135" id="S4.F2.sf1.g1" src="extracted/5121566/high.png" width="180"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span>High</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_flex_size_3 ltx_align_center" id="S4.F2.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="135" id="S4.F2.sf2.g1" src="extracted/5121566/middle.png" width="180"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span>Middle
</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_flex_size_3 ltx_align_center" id="S4.F2.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="135" id="S4.F2.sf3.g1" src="extracted/5121566/low.png" width="180"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(c) </span>Low
</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Visualization of retrieval vector on different frequency words by t-SNE. We uniformly sample 10 classes in each category, and each class contains ten random representations. The same color denotes the same class. </figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS0.SSS0.Px1.p1.1">To fairly compared with previous work <cite class="ltx_cite ltx_citemacro_cite">Khandelwal et al. (<a class="ltx_ref" href="#bib.bib6" title="">2021</a>)</cite>,
we use WMT’19 German-English news translation task winner <cite class="ltx_cite ltx_citemacro_cite">Ng et al. (<a class="ltx_ref" href="#bib.bib9" title="">2019</a>)</cite> as our strong general domain baseline.
We use the same German-English multi-domain datasets, consisting of five domains, including <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px1.p1.1.1">Medical</span>, <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px1.p1.1.2">Law</span>, <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px1.p1.1.3">IT</span>, <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px1.p1.1.4">Koran</span> and <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px1.p1.1.5">Subtitles</span> <span class="ltx_note ltx_role_footnote" id="footnote4"><sup class="ltx_note_mark">4</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">4</sup><span class="ltx_tag ltx_tag_note">4</span>We use the provided 500K sentence pairs version subtitle data rather than full size 12.4M due to memory limitation.</span></span></span>. Besides, to test the proposed training approach robust in out-domain scenery, we also use a 2M subset of the baseline’s training data, including <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px1.p1.1.6">News Commentary v14</span> and <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px1.p1.1.7">Europarl v9</span>, and randomly sample 5M samples out of 65.7M samples from its datastore. See Table <a class="ltx_ref" href="#S3.T1" title="Table 1 ‣ Supervised contrastive learning ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a> for detailed data statistics.
</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS0.SSS0.Px2">
<h3 class="ltx_title ltx_title_paragraph">Implementation details</h3>
<div class="ltx_para ltx_noindent" id="S4.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS0.SSS0.Px2.p1.4">All experiments run on a single NVIDIA 2080 Ti GPU. We use <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px2.p1.4.1">Faiss</span> <span class="ltx_note ltx_role_footnote" id="footnote5"><sup class="ltx_note_mark">5</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">5</sup><span class="ltx_tag ltx_tag_note">5</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/facebookresearch/faiss" title="">https://github.com/facebookresearch/faiss</a></span></span></span> for vector retrieval. For <span class="ltx_text ltx_font_smallcaps" id="S4.SS0.SSS0.Px2.p1.4.2">Clknn</span>, the number of positive samples is M=2, and the number of negative samples is N=32. We sample N negative samples from K=128 nearest clusters. The training batch size is 32. During training, we set <math alttext="T^{{}^{\prime}}" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px2.p1.1.m1.1"><semantics id="S4.SS0.SSS0.Px2.p1.1.m1.1a"><msup id="S4.SS0.SSS0.Px2.p1.1.m1.1.1" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.cmml"><mi id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.2" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml">T</mi><msup id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml"><mi id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3a" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml"></mi><mo id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.1" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.1.cmml">′</mo></msup></msup><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px2.p1.1.m1.1b"><apply id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.2">𝑇</ci><apply id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3"><ci id="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.1.cmml" xref="S4.SS0.SSS0.Px2.p1.1.m1.1.1.3.1">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px2.p1.1.m1.1c">T^{{}^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px2.p1.1.m1.1d">italic_T start_POSTSUPERSCRIPT start_FLOATSUPERSCRIPT ′ end_FLOATSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>=0.01, while we vary <math alttext="T" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px2.p1.2.m2.1"><semantics id="S4.SS0.SSS0.Px2.p1.2.m2.1a"><mi id="S4.SS0.SSS0.Px2.p1.2.m2.1.1" xref="S4.SS0.SSS0.Px2.p1.2.m2.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px2.p1.2.m2.1b"><ci id="S4.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.2.m2.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px2.p1.2.m2.1c">T</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px2.p1.2.m2.1d">italic_T</annotation></semantics></math> according to the validation set at test time. The hidden state size <math alttext="d_{f}" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px2.p1.3.m3.1"><semantics id="S4.SS0.SSS0.Px2.p1.3.m3.1a"><msub id="S4.SS0.SSS0.Px2.p1.3.m3.1.1" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1.cmml"><mi id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.2" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml">d</mi><mi id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.3" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml">f</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px2.p1.3.m3.1b"><apply id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1.2">𝑑</ci><ci id="S4.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="S4.SS0.SSS0.Px2.p1.3.m3.1.1.3">𝑓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px2.p1.3.m3.1c">d_{f}</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px2.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT italic_f end_POSTSUBSCRIPT</annotation></semantics></math> and output size <math alttext="d_{o}" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px2.p1.4.m4.1"><semantics id="S4.SS0.SSS0.Px2.p1.4.m4.1a"><msub id="S4.SS0.SSS0.Px2.p1.4.m4.1.1" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1.cmml"><mi id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.2" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml">d</mi><mi id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.3" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml">o</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px2.p1.4.m4.1b"><apply id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1.2">𝑑</ci><ci id="S4.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="S4.SS0.SSS0.Px2.p1.4.m4.1.1.3">𝑜</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px2.p1.4.m4.1c">d_{o}</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px2.p1.4.m4.1d">italic_d start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT</annotation></semantics></math> of adapter is 4096 and 512, respectively. The output dimension of PCA is 128.
We train all models for 500k steps and select the best model on the validation set. We use a beam size of 5 and a length penalty of 1.0 for all experiments for inference.
We measure case-sensitive detokenized BLEU by SacreBLEU.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS0.SSS0.Px3">
<h3 class="ltx_title ltx_title_paragraph">Experimental results</h3>
<div class="ltx_para" id="S4.SS0.SSS0.Px3.p1">
<p class="ltx_p" id="S4.SS0.SSS0.Px3.p1.2">Table <a class="ltx_ref" href="#S3.T2" title="Table 2 ‣ Supervised contrastive learning ‣ 3 Approach ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a> reports the SacreBLEU scores in five domains. We can see that: (1) <span class="ltx_text ltx_font_smallcaps" id="S4.SS0.SSS0.Px3.p1.2.1">Clknn</span> is robust about training data: using out-domain or in-domain average improves 1+ points than our <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px3.p1.2.2">k</span>NN-MT; (2) The gap between in-domain and out-domain is small (about 0.3 points), meaning that our approach does not rely on in-domain data and is more practical than <cite class="ltx_cite ltx_citemacro_citet">Zheng et al. (<a class="ltx_ref" href="#bib.bib19" title="">2021</a>); Jiang et al. (<a class="ltx_ref" href="#bib.bib5" title="">2021</a>)</cite>; (3) using proposed <math alttext="\lambda^{*}" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px3.p1.1.m1.1"><semantics id="S4.SS0.SSS0.Px3.p1.1.m1.1a"><msup id="S4.SS0.SSS0.Px3.p1.1.m1.1.1" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1.cmml"><mi id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.2" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1.2.cmml">λ</mi><mo id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.3" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px3.p1.1.m1.1b"><apply id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.1.cmml" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.2.cmml" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1.2">𝜆</ci><times id="S4.SS0.SSS0.Px3.p1.1.m1.1.1.3.cmml" xref="S4.SS0.SSS0.Px3.p1.1.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px3.p1.1.m1.1c">\lambda^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px3.p1.1.m1.1d">italic_λ start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> slightly improve the performance across the board. These results show that learning independent retrieval representation is helpful for vanilla <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px3.p1.2.3">k</span>NN-MT. Besides, we also compare the inference speed between <span class="ltx_text ltx_font_smallcaps" id="S4.SS0.SSS0.Px3.p1.2.4">Clknn</span> and <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px3.p1.2.5">k</span>NN-MT through running five times on <span class="ltx_text ltx_font_typewriter" id="S4.SS0.SSS0.Px3.p1.2.6">IT</span> test set. The results show that <span class="ltx_text ltx_font_smallcaps" id="S4.SS0.SSS0.Px3.p1.2.7">Clknn</span> has a comparable speed (97%<math alttext="\pm" class="ltx_Math" display="inline" id="S4.SS0.SSS0.Px3.p1.2.m2.1"><semantics id="S4.SS0.SSS0.Px3.p1.2.m2.1a"><mo id="S4.SS0.SSS0.Px3.p1.2.m2.1.1" xref="S4.SS0.SSS0.Px3.p1.2.m2.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="S4.SS0.SSS0.Px3.p1.2.m2.1b"><csymbol cd="latexml" id="S4.SS0.SSS0.Px3.p1.2.m2.1.1.cmml" xref="S4.SS0.SSS0.Px3.p1.2.m2.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.SS0.SSS0.Px3.p1.2.m2.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="S4.SS0.SSS0.Px3.p1.2.m2.1d">±</annotation></semantics></math>2%) to that of <span class="ltx_text ltx_font_italic" id="S4.SS0.SSS0.Px3.p1.2.8">k</span>NN-MT because the adapter in <span class="ltx_text ltx_font_smallcaps" id="S4.SS0.SSS0.Px3.p1.2.9">Clknn</span> is very lightweight.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Analysis</h2>
<section class="ltx_paragraph" id="S5.SS0.SSS0.Px1">
<h3 class="ltx_title ltx_title_paragraph">Effect of the number of contrastive samples</h3>
<figure class="ltx_table" id="S5.T3">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T3.1" style="width:151.8pt;height:118.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(18.2pt,-14.2pt) scale(1.31655388269479,1.31655388269479) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T3.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T3.1.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T3.1.1.1.1.1">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.1.1">M</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T3.1.1.1.1.2">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.2.1">N</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="S5.T3.1.1.1.1.3">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.3.1">BLEU</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T3.1.1.1.1.4">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.4.1">M</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T3.1.1.1.1.5">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.5.1">N</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T3.1.1.1.1.6">
<span class="ltx_text ltx_font_bold" id="S5.T3.1.1.1.1.6.1">BLEU</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T3.1.1.2.1">
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.1">1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.2">1</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.1.2.1.3">45.54</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.4">2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.5">16</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.6">46.37</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.3.2">
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.1">1</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.2">16</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.3.2.3">45.91</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.4">2</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.5">32</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.6">46.68</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.4.3">
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.1">1</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.2">32</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.4.3.3">46.13</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.4">2</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.5">64</td>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.6">46.55</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.5.4">
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.1.1.5.4.1">1</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.1.1.5.4.2">64</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T3.1.1.5.4.3">45.88</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.1.1.5.4.4">4</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.1.1.5.4.5">32</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.1.1.5.4.6">46.29</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>The BLEU scores on <span class="ltx_text ltx_font_typewriter" id="S5.T3.3.1">IT</span> test set against the number of the positive (M) and negative (N) samples.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S5.SS0.SSS0.Px1.p1.1">One of the main differences between <cite class="ltx_cite ltx_citemacro_citet">Wang et al. (<a class="ltx_ref" href="#bib.bib13" title="">2022</a>)</cite> and us is that we use multiple positive and negative samples in our training objective. We vary the number of M and N and report the BLEU scores in Table <a class="ltx_ref" href="#S5.T3" title="Table 3 ‣ Effect of the number of contrastive samples ‣ 5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a>. As we can see, increasing M and N is helpful for our method. However, large M cannot befit more than increasing N. We attribute it to positive samples that are too easy to learn because most are close in embedding space.
On the contrary, negative samples from different clusters can provide a stronger learning signal. To further validate the effectiveness of multiple samples, we also conduct experiments on <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px1.p1.1.1">Medical</span>. The results are similar to that of <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px1.p1.1.2">IT</span>: using M=2, N=32 is 1.64 BLEU points higher than using M=1, N=1 (56.52 vs. 54.88). It indicates that using multiple positive and negative samples is necessary to achieve good performance for contrastive learning.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS0.SSS0.Px2">
<h3 class="ltx_title ltx_title_paragraph">Retrieval accuracy</h3>
<div class="ltx_para" id="S5.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S5.SS0.SSS0.Px2.p1.1">Intuitively, our approach can learn more accurate retrieval representation than vanilla <span class="ltx_text ltx_font_italic" id="S5.SS0.SSS0.Px2.p1.1.1">k</span>NN-MT. To validate this hypothesis, we use <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px2.p1.1.2">IT</span> validation as the datastore and plot the retrieval accuracy on top-k in Figure <a class="ltx_ref" href="#S5.F3" title="Figure 3 ‣ Retrieval accuracy ‣ 5 Analysis ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a>. We can see that <span class="ltx_text ltx_font_smallcaps" id="S5.SS0.SSS0.Px2.p1.1.3">Clknn</span> has more robust retrieval accuracy than <span class="ltx_text ltx_font_italic" id="S5.SS0.SSS0.Px2.p1.1.4">k</span>NN-MT no matter how k changes. It indicates that the performance improvement comes from our better retrieval representation.</p>
</div>
<figure class="ltx_figure" id="S5.F3">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S5.F3.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.F3.1.1.1">
<td class="ltx_td ltx_align_center" id="S5.F3.1.1.1.1" style="padding:-5pt 1.0pt;">
<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.1">{tikzpicture}</span>baseline

<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.2">{axis}</span>[
xmajorgrids,
ylabel near ticks,
width=.4height=.2legend style=at=(0.62,0.7), anchor=south west,
xlabel=top-k,
ylabel=Acc.,
ylabel style=yshift=-0em,xlabel style=yshift=0.0em,
ymin=0.2,ymax=0.6,legend style=yshift=-12pt, legend plot pos=left,font=,cells=anchor=west
]

<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.3">\addplot</span>[red,mark=otimes*,line width=0.5pt] coordinates (1, 0.5076) (2, 0.4931) (4, 0.4687) (8, 0.4305) (16,0.3822) (32,0.3301) (64,0.2792);
<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.4">\addlegendentry</span>KNN-MT
<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.5">\addplot</span>[blue,mark=square,line width=0.5pt] coordinates (1, 0.5657) (2, 0.5494) (4, 0.5247) (8, 0.4888) (16,0.4420) (32,0.3884) (64,0.3343);
<span class="ltx_ERROR undefined" id="S5.F3.1.1.1.1.6">\addlegendentry</span>CLKNN
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Retrieval accuracy curve against top-k.</figcaption>
</figure>
</section>
<section class="ltx_paragraph" id="S5.SS0.SSS0.Px3">
<h3 class="ltx_title ltx_title_paragraph">Visualization</h3>
<div class="ltx_para" id="S5.SS0.SSS0.Px3.p1">
<p class="ltx_p" id="S5.SS0.SSS0.Px3.p1.1">We visually present the differences between baseline and <span class="ltx_text ltx_font_smallcaps" id="S5.SS0.SSS0.Px3.p1.1.1">Clknn</span> on embedding space. Specifically, we split three categories according to the word frequency in <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px3.p1.1.2">IT</span> training set: <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px3.p1.1.3">HIGH</span>(the first 1%), <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px3.p1.1.4">Middle</span>(40%-60%) and <span class="ltx_text ltx_font_typewriter" id="S5.SS0.SSS0.Px3.p1.1.5">LOW</span>(the last 1%) <span class="ltx_note ltx_role_footnote" id="footnote6"><sup class="ltx_note_mark">6</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">6</sup><span class="ltx_tag ltx_tag_note">6</span>We filter words whose frequency is less than 10.</span></span></span>. We uniformly sample 10 unique words in each category and randomly sample 10 unique vector representations from the training datastore. We use t-SNE to plot these representations, as illustrated in Figure <a class="ltx_ref" href="#S4.F2" title="Figure 2 ‣ Setup ‣ 4 Experiments ‣ Learning Decoupled Retrieval Representation for Nearest Neighbour Neural Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a>. We can see that: (1) high-frequency words’ representations are prone to distinguish for both baseline and <span class="ltx_text ltx_font_smallcaps" id="S5.SS0.SSS0.Px3.p1.1.6">Clknn</span>; (2) <span class="ltx_text ltx_font_smallcaps" id="S5.SS0.SSS0.Px3.p1.1.7">Clknn</span> has more close distances in the same vocabulary than baseline; (3) <span class="ltx_text ltx_font_smallcaps" id="S5.SS0.SSS0.Px3.p1.1.8">Clknn</span> has more robust accuracy for low-frequency words. </p>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">In this work, we proposed to use supervised contrastive learning to decouple the context representation from vanilla <span class="ltx_text ltx_font_italic" id="S6.p1.1.1">k</span>NN-MT. Experimental results on several tasks show that our approach outperforms <span class="ltx_text ltx_font_italic" id="S6.p1.1.2">k</span>NN-MT and learns a more accurate retrieval representation.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We would like to thank the anonymous reviewers for the helpful comments. We also thank Shuqin Pan for the writing suggestions. </p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bahdanau et al. (2015)</span>
<span class="ltx_bibblock">
Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua Bengio. 2015.

</span>
<span class="ltx_bibblock">Neural machine translation by jointly learning to align and
translate.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">3rd International Conference on Learning Representations,
ICLR 2015</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cao and Xiong (2018)</span>
<span class="ltx_bibblock">
Qian Cao and Deyi Xiong. 2018.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/D18-1340" title="">Encoding gated
translation memory into neural machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">Proceedings of the 2018 Conference on Empirical Methods in
Natural Language Processing</em>, pages 3042–3047, Brussels, Belgium.
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grill et al. (2020)</span>
<span class="ltx_bibblock">
Jean-Bastien Grill, Florian Strub, Florent Altché, Corentin Tallec, Pierre
Richemond, Elena Buchatskaya, Carl Doersch, Bernardo Avila Pires, Zhaohan
Guo, Mohammad Gheshlaghi Azar, Bilal Piot, koray kavukcuoglu, Remi Munos, and
Michal Valko. 2020.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://proceedings.neurips.cc/paper/2020/file/f3ada80d5c4ee70142b17b8192b2958e-Paper.pdf" title="">Bootstrap your own latent - a new approach to self-supervised learning</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Advances in Neural Information Processing Systems</em>,
volume 33, pages 21271–21284. Curran Associates, Inc.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gu et al. (2018)</span>
<span class="ltx_bibblock">
Jiatao Gu, Yong Wang, Kyunghyun Cho, and Victor O. K. Li. 2018.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://www.aaai.org/ocs/index.php/AAAI/AAAI18/paper/view/17282" title="">Search
engine guided neural machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Proceedings of the Thirty-Second AAAI Conference on
Artificial Intelligence, (AAAI-18), the 30th innovative Applications of
Artificial Intelligence (IAAI-18), and the 8th AAAI Symposium on
Educational Advances in Artificial Intelligence (EAAI-18), New Orleans,
Louisiana, USA, February 2-7, 2018</em>, pages 5133–5140. AAAI Press.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. (2021)</span>
<span class="ltx_bibblock">
Qingnan Jiang, Mingxuan Wang, Jun Cao, Shanbo Cheng, Shujian Huang, and Lei Li.
2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/2021.emnlp-main.579" title="">Learning
kernel-smoothed machine translation with retrieved examples</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Proceedings of the 2021 Conference on Empirical Methods in
Natural Language Processing</em>, pages 7280–7290, Online and Punta Cana,
Dominican Republic. Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khandelwal et al. (2021)</span>
<span class="ltx_bibblock">
Urvashi Khandelwal, Angela Fan, Dan Jurafsky, Luke Zettlemoyer, and Mike Lewis.
2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://openreview.net/forum?id=7wCBOfJ8hJM" title="">Nearest neighbor
machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">International Conference on Learning Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Koehn (2004)</span>
<span class="ltx_bibblock">
Philipp Koehn. 2004.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://www.aclweb.org/anthology/W04-3250" title="">Statistical
significance tests for machine translation evaluation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the 2004 Conference on Empirical Methods in
Natural Language Processing</em>, pages 388–395, Barcelona, Spain. Association
for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Koehn and Knowles (2017)</span>
<span class="ltx_bibblock">
Philipp Koehn and Rebecca Knowles. 2017.

</span>
<span class="ltx_bibblock">Six challenges for neural machine translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">Proceedings of the First Workshop on Neural Machine
Translation</em>, pages 28–39.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ng et al. (2019)</span>
<span class="ltx_bibblock">
Nathan Ng, Kyra Yee, Alexei Baevski, Myle Ott, Michael Auli, and Sergey Edunov.
2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/W19-5333" title="">Facebook FAIR’s
WMT19 news translation task submission</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">Proceedings of the Fourth Conference on Machine Translation
(Volume 2: Shared Task Papers, Day 1)</em>, pages 314–319, Florence, Italy.
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pan et al. (2021)</span>
<span class="ltx_bibblock">
Xiao Pan, Mingxuan Wang, Liwei Wu, and Lei Li. 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/2021.acl-long.21" title="">Contrastive
learning for many-to-many multilingual neural machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">Proceedings of the 59th Annual Meeting of the Association
for Computational Linguistics and the 11th International Joint Conference on
Natural Language Processing (Volume 1: Long Papers)</em>, pages 244–258, Online.
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Robinson et al. (2020)</span>
<span class="ltx_bibblock">
Joshua David Robinson, Ching-Yao Chuang, Suvrit Sra, and Stefanie Jegelka.
2020.

</span>
<span class="ltx_bibblock">Contrastive learning with hard negative samples.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">International Conference on Learning Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones,
Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">Advances in Neural Information Processing Systems</em>, pages
6000–6010.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2022)</span>
<span class="ltx_bibblock">
Dexin Wang, Kai Fan, Boxing Chen, and Deyi Xiong. 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.48550/arXiv.2204.06175" title="">Efficient
cluster-based k-nearest-neighbor machine translation</a>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">CoRR</em>, abs/2204.06175.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wei et al. (2021)</span>
<span class="ltx_bibblock">
Xiangpeng Wei, Rongxiang Weng, Yue Hu, Luxi Xing, Heng Yu, and Weihua Luo.
2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://openreview.net/forum?id=Uu1Nw-eeTxJ" title="">On learning
universal representations across languages</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">International Conference on Learning Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2019)</span>
<span class="ltx_bibblock">
Mengzhou Xia, Guoping Huang, Lemao Liu, and Shuming Shi. 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.1609/aaai.v33i01.33017297" title="">Graph based
translation memory for neural machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">The Thirty-Third AAAI Conference on Artificial
Intelligence, AAAI 2019, The Thirty-First Innovative Applications of
Artificial Intelligence Conference, IAAI 2019, The Ninth AAAI Symposium
on Educational Advances in Artificial Intelligence, EAAI 2019, Honolulu,
Hawaii, USA, January 27 - February 1, 2019</em>, pages 7297–7304. AAAI Press.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ye et al. (2022)</span>
<span class="ltx_bibblock">
Rong Ye, Mingxuan Wang, and Lei Li. 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/2022.naacl-main.376" title="">Cross-modal
contrastive learning for speech translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Proceedings of the 2022 Conference of the North American
Chapter of the Association for Computational Linguistics: Human Language
Technologies</em>, pages 5099–5113, Seattle, United States. Association for
Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2018)</span>
<span class="ltx_bibblock">
Jingyi Zhang, Masao Utiyama, Eiichro Sumita, Graham Neubig, and Satoshi
Nakamura. 2018.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/N18-1120" title="">Guiding neural machine
translation with retrieved translation pieces</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Proceedings of the 2018 Conference of the North American
Chapter of the Association for Computational Linguistics: Human Language
Technologies, Volume 1 (Long Papers)</em>, pages 1325–1335, New Orleans,
Louisiana. Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2021)</span>
<span class="ltx_bibblock">
Tong Zhang, Wei Ye, Baosong Yang, Long Zhang, Xingzhang Ren, Dayiheng Liu,
Jinan Sun, Shikun Zhang, Haibo Zhang, and Wen Zhao. 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="http://arxiv.org/abs/2112.14484" title="">Frequency-aware contrastive
learning for neural machine translation</a>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">CoRR</em>, abs/2112.14484.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al. (2021)</span>
<span class="ltx_bibblock">
Xin Zheng, Zhirui Zhang, Junliang Guo, Shujian Huang, Boxing Chen, Weihua Luo,
and Jiajun Chen. 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/2021.acl-short.47" title="">Adaptive
nearest neighbor machine translation</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Proceedings of the 59th Annual Meeting of the Association
for Computational Linguistics and the 11th International Joint Conference on
Natural Language Processing (Volume 2: Short Papers)</em>, pages 368–374,
Online. Association for Computational Linguistics.

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Sep 19 04:25:53 2023 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span style="font-size:70%;position:relative; bottom:2.2pt;">A</span>T<span style="position:relative; bottom:-0.4ex;">E</span></span><span class="ltx_font_smallcaps">xml</span><img alt="[LOGO]" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>

<div class="package-alerts" role="alert">
<button aria-label="Dismiss alert" onclick="closePopup()">
<span aria-hidden="true"><svg aria-hidden="true" focusable="false" height="30" role="presentation" viewbox="0 0 44 44" width="30">
<path d="M0.549989 4.44999L4.44999 0.549988L43.45 39.55L39.55 43.45L0.549989 4.44999Z"></path>
<path d="M39.55 0.549988L43.45 4.44999L4.44999 43.45L0.549988 39.55L39.55 0.549988Z"></path>
</svg></span>
</button>
<p>This paper uses the following packages that do not yet convert to HTML. These are known issues and are being worked on. Have free development cycles? <a href="https://github.com/brucemiller/LaTeXML/issues" target="_blank">We welcome contributors</a>.</p>
<ul>
<li>failed: arydshln</li>
</ul>
</div>
<script> 
            function closePopup() {
                document.querySelector('.package-alerts').style.display = 'none';
            }
        </script>
</body>
</html>
