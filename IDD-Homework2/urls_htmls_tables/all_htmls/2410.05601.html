<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>ReFIR: Grounding Large Restoration Models with Retrieval Augmentation</title>
<!--Generated on Tue Oct  8 01:23:53 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.05601v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S1" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Works</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2.SS1" title="In 2 Related Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Diffusion Model for Image Restoration</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2.SS2" title="In 2 Related Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Reference-based Image Super-resolution</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2.SS3" title="In 2 Related Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.3 </span>Retrieval Augmented Generation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S3" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Probing Large Restoration Models</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Methodology</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.SS1" title="In 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Nearest Neighbor Lookup for Reference Image Retrieval</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.SS2" title="In 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Cross Image Injection for High-fidelity Image Restoration</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS1" title="In 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Experiments Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS2" title="In 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Comparison to State-of-the-Arts</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS3" title="In 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Ablation Studies</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS3.SSS0.Px1" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Domain preference problem.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS4" title="In 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4 </span>Discussions</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S6" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A1" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Adaptive Multi-reference Injection</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A1.SS0.SSS0.Px1" title="In Appendix A Adaptive Multi-reference Injection ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Technical details.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A1.SS0.SSS0.Px2" title="In Appendix A Adaptive Multi-reference Injection ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Experiments with multiple reference images.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>More Discussions</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.SS0.SSS0.Px1" title="In Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Difference from the other methods.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.SS0.SSS0.Px2" title="In Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Performance under extreme conditions.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.SS0.SSS0.Px3" title="In Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Why use the self-attention as the external knowledge?</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.SS0.SSS0.Px4" title="In Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">What about the quality of cross-image attention?</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>More Ablation Results</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3.SS0.SSS0.Px1" title="In Appendix C More Ablation Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Quantitative ablation on the control scale.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3.SS0.SSS0.Px2" title="In Appendix C More Ablation Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title">Other choices for cross image injection.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A4" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>Statistical Significance on Performance</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A5" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">E </span>Extension to Specific Restoration Scenarios</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A6" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">F </span>Limitation and Future Works</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A7" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">G </span>Broader Impact</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8" title="In ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">H </span>Additional Visual Results</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">ReFIR: Grounding Large Restoration Models 
<br class="ltx_break"/>with Retrieval Augmentation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hang Guo<sup class="ltx_sup" id="id14.13.id1"><span class="ltx_text ltx_font_italic" id="id14.13.id1.1">1</span></sup>  Tao Dai<span class="ltx_note ltx_role_footnote" id="footnotex1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>Corresponding author: Tao Dai</span></span></span> <sup class="ltx_sup" id="id15.14.id2"><span class="ltx_text ltx_font_italic" id="id15.14.id2.1"> 2</span></sup>  Zhihao Ouyang<sup class="ltx_sup" id="id16.15.id3"><span class="ltx_text ltx_font_italic" id="id16.15.id3.1">3</span></sup>  Taolin Zhang<sup class="ltx_sup" id="id17.16.id4"><span class="ltx_text ltx_font_italic" id="id17.16.id4.1">1</span></sup>
<br class="ltx_break"/><span class="ltx_text ltx_font_bold" id="id7.7.3"> Yaohua Zha<sup class="ltx_sup" id="id7.7.3.1"><span class="ltx_text ltx_font_medium ltx_font_italic" id="id7.7.3.1.1">1</span></sup>  Bin Chen<sup class="ltx_sup" id="id7.7.3.2"><span class="ltx_text ltx_font_medium ltx_font_italic" id="id7.7.3.2.1">4</span></sup>  Shu-tao Xia<sup class="ltx_sup" id="id7.7.3.3"><span class="ltx_text ltx_font_medium ltx_font_italic" id="id7.7.3.3.1">1,5</span></sup> </span>
<br class="ltx_break"/><sup class="ltx_sup" id="id18.17.id5">1</sup>Tsinghua University  <sup class="ltx_sup" id="id19.18.id6">2</sup>Shenzhen University  <sup class="ltx_sup" id="id20.19.id7">3</sup>Aitist.ai 
<br class="ltx_break"/><sup class="ltx_sup" id="id21.20.id8">4</sup>Harbin Institute of Technology  <sup class="ltx_sup" id="id22.21.id9">5</sup>Peng Cheng Laboratory  
<br class="ltx_break"/><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/csguoh/ReFIR" title="">https://github.com/csguoh/ReFIR</a>
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id13.1">Recent advances in diffusion-based Large Restoration Models (LRMs) have significantly improved photo-realistic image restoration by leveraging the <span class="ltx_text ltx_font_italic" id="id13.1.1">internal knowledge</span> embedded within model weights. However, existing LRMs often suffer from the <span class="ltx_text ltx_font_italic" id="id13.1.2">hallucination</span> dilemma, <span class="ltx_text ltx_markedasmath ltx_font_italic" id="id13.1.3">i.e.</span>, producing incorrect contents or textures when dealing with severe degradations, due to their heavy reliance on limited internal knowledge. In this paper, we propose an orthogonal solution called the <span class="ltx_text ltx_font_bold" id="id13.1.4">Re</span>trieval-augmented <span class="ltx_text ltx_font_bold" id="id13.1.5">F</span>ramework for <span class="ltx_text ltx_font_bold" id="id13.1.6">I</span>mage <span class="ltx_text ltx_font_bold" id="id13.1.7">R</span>estoration (ReFIR), which incorporates retrieved images as <span class="ltx_text ltx_font_italic" id="id13.1.8">external knowledge</span> to extend the knowledge boundary of existing LRMs in generating details faithful to the original scene. Specifically, we first introduce the nearest neighbor lookup to retrieve content-relevant high-quality images as reference, after which we propose the cross-image injection to modify existing LRMs to utilize high-quality textures from retrieved images. Thanks to the additional external knowledge, our ReFIR can well handle the hallucination challenge and facilitate faithfully results. Extensive experiments demonstrate that ReFIR can achieve not only high-fidelity but also realistic restoration results. Importantly, our ReFIR requires no training and is adaptable to various LRMs.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Restoring a high-quality image (HQ) from its low-quality counterpart (LQ) is a well-known ill-posed problem and has been studied over the years <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib1" title=""><span class="ltx_text" style="font-size:90%;">1</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib2" title=""><span class="ltx_text" style="font-size:90%;">2</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib3" title=""><span class="ltx_text" style="font-size:90%;">3</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib4" title=""><span class="ltx_text" style="font-size:90%;">4</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib5" title=""><span class="ltx_text" style="font-size:90%;">5</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib6" title=""><span class="ltx_text" style="font-size:90%;">6</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib7" title=""><span class="ltx_text" style="font-size:90%;">7</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib8" title=""><span class="ltx_text" style="font-size:90%;">8</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib9" title=""><span class="ltx_text" style="font-size:90%;">9</span></a>]</cite>. Previous efforts attempt to handle this problem through employing various neural network architectures, including CNNs, GANs and Transformers. Recently, diffusion models <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib10" title=""><span class="ltx_text" style="font-size:90%;">10</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib11" title=""><span class="ltx_text" style="font-size:90%;">11</span></a>]</cite> have emerged as a promising alternative, delivering noteworthy results in real-world image restoration <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib12" title=""><span class="ltx_text" style="font-size:90%;">12</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib13" title=""><span class="ltx_text" style="font-size:90%;">13</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib14" title=""><span class="ltx_text" style="font-size:90%;">14</span></a>]</cite>. In particular, some works <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib15" title=""><span class="ltx_text" style="font-size:90%;">15</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib18" title=""><span class="ltx_text" style="font-size:90%;">18</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> have successfully leveraged the powerful generative prior of pre-trained text-to-image (T2I) diffusion models for scaling up, to obtain the Large Restoration Model (LRM) with billions of parameters, bringing significant progress in restoring photo-realistic images.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Although scaling up restoration models has achieved remarkable success, existing LRMs may not always produce results that are faithful to the original scene, particularly when faced with heavily degraded images that surpass the LRMs’ capabilities (see <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S1.F1" title="In 1 Introduction ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">1</span></a>). This issue is similar to the hallucination problem observed in large language models (LLMs) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib21" title=""><span class="ltx_text" style="font-size:90%;">21</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib22" title=""><span class="ltx_text" style="font-size:90%;">22</span></a>]</cite>, <span class="ltx_text ltx_font_italic" id="S1.p2.1.1">e.g.</span> ChatGPT might generate nonsense responses when highly specialized questions exceed its knowledge boundary. Similarly, if one LRM has never seen a specific scene, it will struggle to restore corresponding images faithfully. By analogizing LLM to LRM, we define the phenomenon where LRMs generate textures inconsistent with the original scene when facing hard samples as the hallucination of LRMs.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">To address the hallucination problem in LRMs, simply expanding the <span class="ltx_text ltx_font_italic" id="S1.p3.1.1">internal knowledge</span> through additional training data and parameters might seem straightforward, but it can significantly increase computational and storage costs. Instead, this work considers another orthogonal strategy that enhances the <span class="ltx_text ltx_font_italic" id="S1.p3.1.2">external knowledge</span> of LRMs without adding parameter counts. Drawing inspiration from the retrieval-augmented generation (RAG) used in LLMs <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib23" title=""><span class="ltx_text" style="font-size:90%;">23</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib24" title=""><span class="ltx_text" style="font-size:90%;">24</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib25" title=""><span class="ltx_text" style="font-size:90%;">25</span></a>]</cite>, we aim to use the retrieved high-quality content-relevant images as external knowledge to alleviate the hallucination of LRMs. However, applying RAG to image restoration poses specific challenges. Specifically, in natural language, simply feeding the retrieved documents along with the original user query to LLMs can allow it to produce grounded responses. However, in the context of image restoration, allowing low-quality images to attend to retrieved images during their restoration process is non-trivial, which motivates us to develop novel techniques to enable LRMs to utilize external knowledge in restoration.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="359" id="S1.F1.g1" src="x1.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S1.F1.3.1.1" style="font-size:90%;">Figure 1</span>: </span><span class="ltx_text" id="S1.F1.4.2" style="font-size:90%;">Existing LRMs encounter hallucination issues, <span class="ltx_text ltx_font_italic" id="S1.F1.4.2.1">i.e.</span>, generating contents or details that deviate from the original scene, when dealing with challenging degradations. By incorporating the proposed ReFIR to existing LRMs <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> without any training, the additional external knowledge facilitates producing more faithful results. Please zoom in for better visualization.</span></figcaption>
</figure>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">To this end, we delve deep into the working mechanisms of LRMs for insightful observations. Details of the experimental setup are described in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S3" title="3 Probing Large Restoration Models ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">3</span></a>. Our key findings indicate that the workflow of LRMs can be divided into two distinct stages: the <span class="ltx_text ltx_font_bold" id="S1.p4.1.1">Denoising Structure Reconstruction</span> stage, during which the self-attention in the ControlNet <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib26" title=""><span class="ltx_text" style="font-size:90%;">26</span></a>]</cite> reconstructs a clear overall structure from the noised representation. After that, in the <span class="ltx_text ltx_font_bold" id="S1.p4.1.2">Detail Texture Restoration</span> stage, the self-attention in the UNet <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib27" title=""><span class="ltx_text" style="font-size:90%;">27</span></a>]</cite> decoder fills scene-specific textures based on the denoised structure map. Based on these findings, a natural solution emerged: we can transfer high-quality, scene-specific textures from the retrieved images to the low-quality images during the detail texture restoration stage. In this way, the restored image is allowed a consistent texture with the retrieved image, thus mitigating the hallucination.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">Inspired by the above observation, in this work, we propose the Retrieval-augmented Framework for Image Restoration, dubbed ReFIR, to offer a simple but effective way to expand the knowledge boundary of LRMs using the external knowledge from the retrieved images. Specifically, we first construct the retriever which employs the nearest neighbor lookup in the semantic embedding space to retrieve content-relevant reference images in the high-quality image database. After that, we develop the cross image injection which modifies the self-attention layer of original LRMs to enable the queries from the low-quality denoising chain to attend to the keys and values from the denoising chain of retrieved reference. To avoid the domain preference problem during injection, we propose separate attention to perform intra-chain and inter-chain attention, respectively. Given the spatial misalignment between the LQ and the retrieved HQ, we further adopt spatial adaptive gating to mask meaningless pixels during injection. At last, we employ the distribution alignment to narrow the domain gap between LQ and retrieved images. Thanks to the proposed ReFIR, the restoration of the LQ image can make full use of the external knowledge from the reference to generate high-fidelity images. Notably, the proposed pipeline is training-free and can be applied to multiple LRMs.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">The contribution of this paper can be summarized as:
<span class="ltx_text ltx_font_bold" id="S1.p6.1.1">(i)</span> We introduce retrieval-augmented restoration, a novel concept to mitigate the hallucination problems in existing LRMs.
<span class="ltx_text ltx_font_bold" id="S1.p6.1.2">(ii)</span> We conduct an in-depth analysis of the working mechanisms of LRMs, based on which we propose a training-free framework to utilize the retrieved images.
<span class="ltx_text ltx_font_bold" id="S1.p6.1.3">(iii)</span> Extensive experiments validate that our proposed method effectively mitigates hallucination and is applicable to a broad spectrum of existing LRMs.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Works</h2>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Diffusion Model for Image Restoration</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">Diffusion models have recently achieved significant advancements across various computer vision tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib28" title=""><span class="ltx_text" style="font-size:90%;">28</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib29" title=""><span class="ltx_text" style="font-size:90%;">29</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib30" title=""><span class="ltx_text" style="font-size:90%;">30</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib31" title=""><span class="ltx_text" style="font-size:90%;">31</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib32" title=""><span class="ltx_text" style="font-size:90%;">32</span></a>]</cite>. In the realm of image restoration, early explorations often involved training diffusion models from scratch to obtain the restoration tailored models <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib33" title=""><span class="ltx_text" style="font-size:90%;">33</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib34" title=""><span class="ltx_text" style="font-size:90%;">34</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib35" title=""><span class="ltx_text" style="font-size:90%;">35</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib36" title=""><span class="ltx_text" style="font-size:90%;">36</span></a>]</cite>. While these models are capable of producing high-fidelity results, they usually fall short of generating perceptually pleasing images. To leverage the powerful generative capabilities of large pre-trained text-to-image diffusion models like Stable Diffusion <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib33" title=""><span class="ltx_text" style="font-size:90%;">33</span></a>]</cite>, recent attempts <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib15" title=""><span class="ltx_text" style="font-size:90%;">15</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib18" title=""><span class="ltx_text" style="font-size:90%;">18</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> have focused on using the ControlNet <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib37" title=""><span class="ltx_text" style="font-size:90%;">37</span></a>]</cite> with a LQ image as the condition to generate HQ images. Benefiting from the scaling law <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib38" title=""><span class="ltx_text" style="font-size:90%;">38</span></a>]</cite>, these large restoration models with billions of parameters have shown impressive restoration results with photo-realistic textures and details. However, similar to the large language models, when the user query, <span class="ltx_text ltx_font_italic" id="S2.SS1.p1.1.1">i.e.</span>, the LQ image in this setting, exceeds the knowledge boundary of the large models, the models often fail to generate meaningful or correct responses, which is unacceptable for image restoration tasks that pursue high-fidelity.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="185" id="S2.F2.g1" src="x2.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S2.F2.4.1.1" style="font-size:90%;">Figure 2</span>: </span><span class="ltx_text" id="S2.F2.5.2" style="font-size:90%;">In-depth visualization about the working mechanism of LRM. <span class="ltx_text ltx_font_bold" id="S2.F2.5.2.1">Left</span>: we use PCA to visualize the top three principal components of latent extracted from the self-attention layer of the ControlNet and UNet decoder.
<span class="ltx_text ltx_font_bold" id="S2.F2.5.2.2">Right</span>: quantitative power spectrum of the corresponding latent using Fourier analysis. More visualization can be found in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8" title="Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">H</span></a>.
</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Reference-based Image Super-resolution</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Compared with single image super-resolution <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib1" title=""><span class="ltx_text" style="font-size:90%;">1</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib4" title=""><span class="ltx_text" style="font-size:90%;">4</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib2" title=""><span class="ltx_text" style="font-size:90%;">2</span></a>]</cite>, Reference-based Image Super-Resolution (RefSR) can achieve enhanced performance by employing content-similar reference images as the additional input, and has attracted great research interests in the past few years <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib39" title=""><span class="ltx_text" style="font-size:90%;">39</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib40" title=""><span class="ltx_text" style="font-size:90%;">40</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>]</cite>. For instance, C2-Matching <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>]</cite> introduces a teacher-student correlation distillation and a dynamic DCN aggregation module for more precise alignment between low-quality and reference images. Following this, DATSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib42" title=""><span class="ltx_text" style="font-size:90%;">42</span></a>]</cite> employs reciprocal learning and SwinTransformer to further boost performance. Additionally, MRefSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib43" title=""><span class="ltx_text" style="font-size:90%;">43</span></a>]</cite> introduces a simple baseline to facilitate RefSR with multiple reference images. It is worth mentioning that despite both using additional images as references, our proposed retrieval augmented restoration pipeline differs from previous RefSR methods in several key aspects. Firstly, current RefSR models are typically small-scale due to limited training data, leading to performance degradation under challenging real-world conditions. Secondly, most RefSR methods can only use one single reference image and even fail to work in the absence of reference images. Thirdly, different from RefSR models that require training, our method can inject image-specific external knowledge into LRMs in a training-free manner. We give a detailed discussion about the difference in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.SS0.SSS0.Px1" title="Difference from the other methods. ‣ Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">B</span></a>.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3 </span>Retrieval Augmented Generation</h3>
<div class="ltx_para" id="S2.SS3.p1">
<p class="ltx_p" id="S2.SS3.p1.1">In the domain of natural language processing, Retrieval-Augmented Generation (RAG) leverages the strengths of pre-trained Large Language Models (LLMs) combined with knowledge retrieved from an external document database to enhance the quality of generated content <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib21" title=""><span class="ltx_text" style="font-size:90%;">21</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib22" title=""><span class="ltx_text" style="font-size:90%;">22</span></a>]</cite>. Typically, a RAG system initially retrieves documents relevant to the user’s query from the knowledge base and then integrates the retrieved document along with the original user query into the LLMs without any tuning to generate a response. Even when no relevant document is available, this system can still operate by using the internal knowledge embedded in the LLMs’ parameters. The integration of RAG allows LLMs to produce outputs that are not only contextually rich but also factually accurate, effectively mitigating the hallucination problem in knowledge-intensive tasks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib23" title=""><span class="ltx_text" style="font-size:90%;">23</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib24" title=""><span class="ltx_text" style="font-size:90%;">24</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib25" title=""><span class="ltx_text" style="font-size:90%;">25</span></a>]</cite>. In this work, we extend the concept of RAG to image processing and propose retrieval-augmented restoration to alleviate the hallucination issues in LRMs. By utilizing external textures embedded in the retrieved reference images, our tuning-free framework significantly facilitates faithful restoration results.</p>
</div>
<figure class="ltx_figure" id="S2.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="187" id="S2.F3.g1" src="x3.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S2.F3.10.4.1" style="font-size:90%;">Figure 3</span>: </span><span class="ltx_text" id="S2.F3.6.3" style="font-size:90%;">Our ReFIR consists of two stages: the <span class="ltx_text ltx_font_bold" id="S2.F3.6.3.1">Reference Image Retrieval</span> stage employs the retriever <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S2.F3.4.1.m1.1"><semantics id="S2.F3.4.1.m1.1b"><mi class="ltx_font_mathcaligraphic" id="S2.F3.4.1.m1.1.1" xref="S2.F3.4.1.m1.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S2.F3.4.1.m1.1c"><ci id="S2.F3.4.1.m1.1.1.cmml" xref="S2.F3.4.1.m1.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.4.1.m1.1d">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.4.1.m1.1e">caligraphic_R</annotation></semantics></math> to search content-relevant images from high-quality image database <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S2.F3.5.2.m2.1"><semantics id="S2.F3.5.2.m2.1b"><mi class="ltx_font_mathcaligraphic" id="S2.F3.5.2.m2.1.1" xref="S2.F3.5.2.m2.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S2.F3.5.2.m2.1c"><ci id="S2.F3.5.2.m2.1.1.cmml" xref="S2.F3.5.2.m2.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.5.2.m2.1d">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.5.2.m2.1e">caligraphic_D</annotation></semantics></math>, and then the <span class="ltx_text ltx_font_bold" id="S2.F3.6.3.2">High-fidelity Image Restoration</span> stage restores HQ image with reference images <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S2.F3.6.3.m3.1"><semantics id="S2.F3.6.3.m3.1b"><msub id="S2.F3.6.3.m3.1.1" xref="S2.F3.6.3.m3.1.1.cmml"><mi id="S2.F3.6.3.m3.1.1.2" xref="S2.F3.6.3.m3.1.1.2.cmml">𝐈</mi><mi id="S2.F3.6.3.m3.1.1.3" xref="S2.F3.6.3.m3.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S2.F3.6.3.m3.1c"><apply id="S2.F3.6.3.m3.1.1.cmml" xref="S2.F3.6.3.m3.1.1"><csymbol cd="ambiguous" id="S2.F3.6.3.m3.1.1.1.cmml" xref="S2.F3.6.3.m3.1.1">subscript</csymbol><ci id="S2.F3.6.3.m3.1.1.2.cmml" xref="S2.F3.6.3.m3.1.1.2">𝐈</ci><ci id="S2.F3.6.3.m3.1.1.3.cmml" xref="S2.F3.6.3.m3.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.6.3.m3.1d">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.6.3.m3.1e">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> as condition. The proposed framework is highly generic and can be applied to multiple existing LRMs without any training or fine-tuning. </span></figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Probing Large Restoration Models</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">In order to manipulate the LRM so that it can utilize the retrieved reference images as external knowledge, we first delve into the underlying mechanism of existing LRMs to find useful insights. We choose the current popular LRM method SUPIR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> as a representative. Inspired by previous image editing efforts  <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib44" title=""><span class="ltx_text" style="font-size:90%;">44</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib31" title=""><span class="ltx_text" style="font-size:90%;">31</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib30" title=""><span class="ltx_text" style="font-size:90%;">30</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib29" title=""><span class="ltx_text" style="font-size:90%;">29</span></a>]</cite>, which show that the self-attention layer of diffusion models contains important spatial correlation of an image, we thus follow this clue and employ the PCA to visualize the principal components of the latent from self-attention layers of SUPIR. We further utilize the Fourier analysis <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib45" title=""><span class="ltx_text" style="font-size:90%;">45</span></a>]</cite> to allow for quantitative results. The results are shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2.F2" title="In 2.1 Diffusion Model for Image Restoration ‣ 2 Related Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p" id="S3.p2.1">It can be seen that the ControlNet of the LRM can denoise the latent as the layers deepen, facilitating the reconstruction of a clear overall structure. However, this process is accompanied by a reduction in the high-frequency meaningful texture of the original image. This qualitative visualization can be also verified by the frequency characteristic plots, with high-frequency components decaying as layer number increases.
On the other hand, the role of the UNet decoder is significantly different. Based on the previous clear structural map, the decoder restores the high-frequency details and textures with the help of skip connections, which is also shown through the strengthening high-frequency component in the decoder’s frequency curve.</p>
</div>
<div class="ltx_para" id="S3.p3">
<p class="ltx_p" id="S3.p3.1">Considering the above observations, we can divide the image restoration process of the LRM into two phases: the Denosing Structure Reconstruction phase in the ControlNet, and the Detail Texture Restoration phase in the UNet decoder. Inspired by these probing experiments, in this work, we employ the detail texture restoration nature in the self-attention layer of the decoder to inject the high-fidelity textures of retrieved images into the restoration process of the low-quality image.</p>
</div>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Methodology</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">This work considers using retrieved reference images as an explicit part of the model. In contrast to the existing restoration pipeline, our ReFIR is parameterized by not only the internal knowledge from the network weights but also the external knowledge retrieved from suitable data representations. <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S2.F3" title="In 2.3 Retrieval Augmented Generation ‣ 2 Related Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">3</span></a> gives an overview of our ReFIR. In the following part, we will first give the technical details of the retriever for reference image retrieval in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.SS1" title="4.1 Nearest Neighbor Lookup for Reference Image Retrieval ‣ 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">4.1</span></a>, followed by the cross image injection to inject the external data knowledge into the restoration process of LRMs in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.SS2" title="4.2 Cross Image Injection for High-fidelity Image Restoration ‣ 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">4.2</span></a>.</p>
</div>
<figure class="ltx_figure" id="S4.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="364" id="S4.F4.g1" src="x4.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F4.6.3.1" style="font-size:90%;">Figure 4</span>: </span><span class="ltx_text" id="S4.F4.4.2" style="font-size:90%;">An illustration of cross image injection. Both <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.F4.3.1.m1.1"><semantics id="S4.F4.3.1.m1.1b"><msub id="S4.F4.3.1.m1.1.1" xref="S4.F4.3.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.F4.3.1.m1.1.1.2" xref="S4.F4.3.1.m1.1.1.2.cmml">𝒞</mi><mi id="S4.F4.3.1.m1.1.1.3" xref="S4.F4.3.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.F4.3.1.m1.1c"><apply id="S4.F4.3.1.m1.1.1.cmml" xref="S4.F4.3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.F4.3.1.m1.1.1.1.cmml" xref="S4.F4.3.1.m1.1.1">subscript</csymbol><ci id="S4.F4.3.1.m1.1.1.2.cmml" xref="S4.F4.3.1.m1.1.1.2">𝒞</ci><ci id="S4.F4.3.1.m1.1.1.3.cmml" xref="S4.F4.3.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.3.1.m1.1d">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.F4.3.1.m1.1e">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.F4.4.2.m2.1"><semantics id="S4.F4.4.2.m2.1b"><msub id="S4.F4.4.2.m2.1.1" xref="S4.F4.4.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.F4.4.2.m2.1.1.2" xref="S4.F4.4.2.m2.1.1.2.cmml">𝒞</mi><mi id="S4.F4.4.2.m2.1.1.3" xref="S4.F4.4.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.F4.4.2.m2.1c"><apply id="S4.F4.4.2.m2.1.1.cmml" xref="S4.F4.4.2.m2.1.1"><csymbol cd="ambiguous" id="S4.F4.4.2.m2.1.1.1.cmml" xref="S4.F4.4.2.m2.1.1">subscript</csymbol><ci id="S4.F4.4.2.m2.1.1.2.cmml" xref="S4.F4.4.2.m2.1.1.2">𝒞</ci><ci id="S4.F4.4.2.m2.1.1.3.cmml" xref="S4.F4.4.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.4.2.m2.1d">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.F4.4.2.m2.1e">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> share the same model weights.</span></figcaption>
</figure>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Nearest Neighbor Lookup for Reference Image Retrieval</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.12">Our reference image retrieval system can be represented as a binary set <math alttext="\{\mathcal{D},\mathcal{R}\}" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.2"><semantics id="S4.SS1.p1.1.m1.2a"><mrow id="S4.SS1.p1.1.m1.2.3.2" xref="S4.SS1.p1.1.m1.2.3.1.cmml"><mo id="S4.SS1.p1.1.m1.2.3.2.1" stretchy="false" xref="S4.SS1.p1.1.m1.2.3.1.cmml">{</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml">𝒟</mi><mo id="S4.SS1.p1.1.m1.2.3.2.2" xref="S4.SS1.p1.1.m1.2.3.1.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.1.m1.2.2" xref="S4.SS1.p1.1.m1.2.2.cmml">ℛ</mi><mo id="S4.SS1.p1.1.m1.2.3.2.3" stretchy="false" xref="S4.SS1.p1.1.m1.2.3.1.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.2b"><set id="S4.SS1.p1.1.m1.2.3.1.cmml" xref="S4.SS1.p1.1.m1.2.3.2"><ci id="S4.SS1.p1.1.m1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1">𝒟</ci><ci id="S4.SS1.p1.1.m1.2.2.cmml" xref="S4.SS1.p1.1.m1.2.2">ℛ</ci></set></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.2c">\{\mathcal{D},\mathcal{R}\}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.2d">{ caligraphic_D , caligraphic_R }</annotation></semantics></math>, where <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p1.2.m2.1"><semantics id="S4.SS1.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.2.m2.1.1" xref="S4.SS1.p1.2.m2.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.2.m2.1b"><ci id="S4.SS1.p1.2.m2.1.1.cmml" xref="S4.SS1.p1.2.m2.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.2.m2.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.2.m2.1d">caligraphic_D</annotation></semantics></math> is a fixed database containing a large number of HQ images, and <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S4.SS1.p1.3.m3.1"><semantics id="S4.SS1.p1.3.m3.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.3.m3.1.1" xref="S4.SS1.p1.3.m3.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.3.m3.1b"><ci id="S4.SS1.p1.3.m3.1.1.cmml" xref="S4.SS1.p1.3.m3.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.3.m3.1c">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.3.m3.1d">caligraphic_R</annotation></semantics></math> denotes a non-parametric retriever to obtain the retrieved image set <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS1.p1.4.m4.1"><semantics id="S4.SS1.p1.4.m4.1a"><msub id="S4.SS1.p1.4.m4.1.1" xref="S4.SS1.p1.4.m4.1.1.cmml"><mi id="S4.SS1.p1.4.m4.1.1.2" xref="S4.SS1.p1.4.m4.1.1.2.cmml">𝐈</mi><mi id="S4.SS1.p1.4.m4.1.1.3" xref="S4.SS1.p1.4.m4.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.4.m4.1b"><apply id="S4.SS1.p1.4.m4.1.1.cmml" xref="S4.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.4.m4.1.1.1.cmml" xref="S4.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.p1.4.m4.1.1.2.cmml" xref="S4.SS1.p1.4.m4.1.1.2">𝐈</ci><ci id="S4.SS1.p1.4.m4.1.1.3.cmml" xref="S4.SS1.p1.4.m4.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.4.m4.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.4.m4.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> which consists of <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p1.5.m5.1"><semantics id="S4.SS1.p1.5.m5.1a"><mi id="S4.SS1.p1.5.m5.1.1" xref="S4.SS1.p1.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.5.m5.1b"><ci id="S4.SS1.p1.5.m5.1.1.cmml" xref="S4.SS1.p1.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.5.m5.1d">italic_k</annotation></semantics></math> elements and is a subset of <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p1.6.m6.1"><semantics id="S4.SS1.p1.6.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.6.m6.1.1" xref="S4.SS1.p1.6.m6.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.6.m6.1b"><ci id="S4.SS1.p1.6.m6.1.1.cmml" xref="S4.SS1.p1.6.m6.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.6.m6.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.6.m6.1d">caligraphic_D</annotation></semantics></math> given a query LQ image <math alttext="I_{LQ}\in\mathbb{R}^{3\times H\times W}" class="ltx_Math" display="inline" id="S4.SS1.p1.7.m7.1"><semantics id="S4.SS1.p1.7.m7.1a"><mrow id="S4.SS1.p1.7.m7.1.1" xref="S4.SS1.p1.7.m7.1.1.cmml"><msub id="S4.SS1.p1.7.m7.1.1.2" xref="S4.SS1.p1.7.m7.1.1.2.cmml"><mi id="S4.SS1.p1.7.m7.1.1.2.2" xref="S4.SS1.p1.7.m7.1.1.2.2.cmml">I</mi><mrow id="S4.SS1.p1.7.m7.1.1.2.3" xref="S4.SS1.p1.7.m7.1.1.2.3.cmml"><mi id="S4.SS1.p1.7.m7.1.1.2.3.2" xref="S4.SS1.p1.7.m7.1.1.2.3.2.cmml">L</mi><mo id="S4.SS1.p1.7.m7.1.1.2.3.1" xref="S4.SS1.p1.7.m7.1.1.2.3.1.cmml">⁢</mo><mi id="S4.SS1.p1.7.m7.1.1.2.3.3" xref="S4.SS1.p1.7.m7.1.1.2.3.3.cmml">Q</mi></mrow></msub><mo id="S4.SS1.p1.7.m7.1.1.1" xref="S4.SS1.p1.7.m7.1.1.1.cmml">∈</mo><msup id="S4.SS1.p1.7.m7.1.1.3" xref="S4.SS1.p1.7.m7.1.1.3.cmml"><mi id="S4.SS1.p1.7.m7.1.1.3.2" xref="S4.SS1.p1.7.m7.1.1.3.2.cmml">ℝ</mi><mrow id="S4.SS1.p1.7.m7.1.1.3.3" xref="S4.SS1.p1.7.m7.1.1.3.3.cmml"><mn id="S4.SS1.p1.7.m7.1.1.3.3.2" xref="S4.SS1.p1.7.m7.1.1.3.3.2.cmml">3</mn><mo id="S4.SS1.p1.7.m7.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S4.SS1.p1.7.m7.1.1.3.3.1.cmml">×</mo><mi id="S4.SS1.p1.7.m7.1.1.3.3.3" xref="S4.SS1.p1.7.m7.1.1.3.3.3.cmml">H</mi><mo id="S4.SS1.p1.7.m7.1.1.3.3.1a" lspace="0.222em" rspace="0.222em" xref="S4.SS1.p1.7.m7.1.1.3.3.1.cmml">×</mo><mi id="S4.SS1.p1.7.m7.1.1.3.3.4" xref="S4.SS1.p1.7.m7.1.1.3.3.4.cmml">W</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.7.m7.1b"><apply id="S4.SS1.p1.7.m7.1.1.cmml" xref="S4.SS1.p1.7.m7.1.1"><in id="S4.SS1.p1.7.m7.1.1.1.cmml" xref="S4.SS1.p1.7.m7.1.1.1"></in><apply id="S4.SS1.p1.7.m7.1.1.2.cmml" xref="S4.SS1.p1.7.m7.1.1.2"><csymbol cd="ambiguous" id="S4.SS1.p1.7.m7.1.1.2.1.cmml" xref="S4.SS1.p1.7.m7.1.1.2">subscript</csymbol><ci id="S4.SS1.p1.7.m7.1.1.2.2.cmml" xref="S4.SS1.p1.7.m7.1.1.2.2">𝐼</ci><apply id="S4.SS1.p1.7.m7.1.1.2.3.cmml" xref="S4.SS1.p1.7.m7.1.1.2.3"><times id="S4.SS1.p1.7.m7.1.1.2.3.1.cmml" xref="S4.SS1.p1.7.m7.1.1.2.3.1"></times><ci id="S4.SS1.p1.7.m7.1.1.2.3.2.cmml" xref="S4.SS1.p1.7.m7.1.1.2.3.2">𝐿</ci><ci id="S4.SS1.p1.7.m7.1.1.2.3.3.cmml" xref="S4.SS1.p1.7.m7.1.1.2.3.3">𝑄</ci></apply></apply><apply id="S4.SS1.p1.7.m7.1.1.3.cmml" xref="S4.SS1.p1.7.m7.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.p1.7.m7.1.1.3.1.cmml" xref="S4.SS1.p1.7.m7.1.1.3">superscript</csymbol><ci id="S4.SS1.p1.7.m7.1.1.3.2.cmml" xref="S4.SS1.p1.7.m7.1.1.3.2">ℝ</ci><apply id="S4.SS1.p1.7.m7.1.1.3.3.cmml" xref="S4.SS1.p1.7.m7.1.1.3.3"><times id="S4.SS1.p1.7.m7.1.1.3.3.1.cmml" xref="S4.SS1.p1.7.m7.1.1.3.3.1"></times><cn id="S4.SS1.p1.7.m7.1.1.3.3.2.cmml" type="integer" xref="S4.SS1.p1.7.m7.1.1.3.3.2">3</cn><ci id="S4.SS1.p1.7.m7.1.1.3.3.3.cmml" xref="S4.SS1.p1.7.m7.1.1.3.3.3">𝐻</ci><ci id="S4.SS1.p1.7.m7.1.1.3.3.4.cmml" xref="S4.SS1.p1.7.m7.1.1.3.3.4">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.7.m7.1c">I_{LQ}\in\mathbb{R}^{3\times H\times W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.7.m7.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT 3 × italic_H × italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>, <span class="ltx_text ltx_font_italic" id="S4.SS1.p1.12.1">i.e.</span>, <math alttext="\mathcal{R}:I_{LQ},\mathcal{D}\mapsto\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS1.p1.8.m8.2"><semantics id="S4.SS1.p1.8.m8.2a"><mrow id="S4.SS1.p1.8.m8.2.2" xref="S4.SS1.p1.8.m8.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.8.m8.2.2.3" xref="S4.SS1.p1.8.m8.2.2.3.cmml">ℛ</mi><mo id="S4.SS1.p1.8.m8.2.2.2" lspace="0.278em" rspace="0.278em" xref="S4.SS1.p1.8.m8.2.2.2.cmml">:</mo><mrow id="S4.SS1.p1.8.m8.2.2.1" xref="S4.SS1.p1.8.m8.2.2.1.cmml"><mrow id="S4.SS1.p1.8.m8.2.2.1.1.1" xref="S4.SS1.p1.8.m8.2.2.1.1.2.cmml"><msub id="S4.SS1.p1.8.m8.2.2.1.1.1.1" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.cmml"><mi id="S4.SS1.p1.8.m8.2.2.1.1.1.1.2" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.2.cmml">I</mi><mrow id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.cmml"><mi id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.2" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.2.cmml">L</mi><mo id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.1" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.3" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.3.cmml">Q</mi></mrow></msub><mo id="S4.SS1.p1.8.m8.2.2.1.1.1.2" xref="S4.SS1.p1.8.m8.2.2.1.1.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.8.m8.1.1" xref="S4.SS1.p1.8.m8.1.1.cmml">𝒟</mi></mrow><mo id="S4.SS1.p1.8.m8.2.2.1.2" stretchy="false" xref="S4.SS1.p1.8.m8.2.2.1.2.cmml">↦</mo><msub id="S4.SS1.p1.8.m8.2.2.1.3" xref="S4.SS1.p1.8.m8.2.2.1.3.cmml"><mi id="S4.SS1.p1.8.m8.2.2.1.3.2" xref="S4.SS1.p1.8.m8.2.2.1.3.2.cmml">𝐈</mi><mi id="S4.SS1.p1.8.m8.2.2.1.3.3" xref="S4.SS1.p1.8.m8.2.2.1.3.3.cmml">𝐑</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.8.m8.2b"><apply id="S4.SS1.p1.8.m8.2.2.cmml" xref="S4.SS1.p1.8.m8.2.2"><ci id="S4.SS1.p1.8.m8.2.2.2.cmml" xref="S4.SS1.p1.8.m8.2.2.2">:</ci><ci id="S4.SS1.p1.8.m8.2.2.3.cmml" xref="S4.SS1.p1.8.m8.2.2.3">ℛ</ci><apply id="S4.SS1.p1.8.m8.2.2.1.cmml" xref="S4.SS1.p1.8.m8.2.2.1"><csymbol cd="latexml" id="S4.SS1.p1.8.m8.2.2.1.2.cmml" xref="S4.SS1.p1.8.m8.2.2.1.2">maps-to</csymbol><list id="S4.SS1.p1.8.m8.2.2.1.1.2.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1"><apply id="S4.SS1.p1.8.m8.2.2.1.1.1.1.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.8.m8.2.2.1.1.1.1.1.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1">subscript</csymbol><ci id="S4.SS1.p1.8.m8.2.2.1.1.1.1.2.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.2">𝐼</ci><apply id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3"><times id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.1.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.1"></times><ci id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.2.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.2">𝐿</ci><ci id="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.3.cmml" xref="S4.SS1.p1.8.m8.2.2.1.1.1.1.3.3">𝑄</ci></apply></apply><ci id="S4.SS1.p1.8.m8.1.1.cmml" xref="S4.SS1.p1.8.m8.1.1">𝒟</ci></list><apply id="S4.SS1.p1.8.m8.2.2.1.3.cmml" xref="S4.SS1.p1.8.m8.2.2.1.3"><csymbol cd="ambiguous" id="S4.SS1.p1.8.m8.2.2.1.3.1.cmml" xref="S4.SS1.p1.8.m8.2.2.1.3">subscript</csymbol><ci id="S4.SS1.p1.8.m8.2.2.1.3.2.cmml" xref="S4.SS1.p1.8.m8.2.2.1.3.2">𝐈</ci><ci id="S4.SS1.p1.8.m8.2.2.1.3.3.cmml" xref="S4.SS1.p1.8.m8.2.2.1.3.3">𝐑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.8.m8.2c">\mathcal{R}:I_{LQ},\mathcal{D}\mapsto\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.8.m8.2d">caligraphic_R : italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT , caligraphic_D ↦ bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math>, where <math alttext="\mathbf{I_{R}}\subseteq\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p1.9.m9.1"><semantics id="S4.SS1.p1.9.m9.1a"><mrow id="S4.SS1.p1.9.m9.1.1" xref="S4.SS1.p1.9.m9.1.1.cmml"><msub id="S4.SS1.p1.9.m9.1.1.2" xref="S4.SS1.p1.9.m9.1.1.2.cmml"><mi id="S4.SS1.p1.9.m9.1.1.2.2" xref="S4.SS1.p1.9.m9.1.1.2.2.cmml">𝐈</mi><mi id="S4.SS1.p1.9.m9.1.1.2.3" xref="S4.SS1.p1.9.m9.1.1.2.3.cmml">𝐑</mi></msub><mo id="S4.SS1.p1.9.m9.1.1.1" xref="S4.SS1.p1.9.m9.1.1.1.cmml">⊆</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.9.m9.1.1.3" xref="S4.SS1.p1.9.m9.1.1.3.cmml">𝒟</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.9.m9.1b"><apply id="S4.SS1.p1.9.m9.1.1.cmml" xref="S4.SS1.p1.9.m9.1.1"><subset id="S4.SS1.p1.9.m9.1.1.1.cmml" xref="S4.SS1.p1.9.m9.1.1.1"></subset><apply id="S4.SS1.p1.9.m9.1.1.2.cmml" xref="S4.SS1.p1.9.m9.1.1.2"><csymbol cd="ambiguous" id="S4.SS1.p1.9.m9.1.1.2.1.cmml" xref="S4.SS1.p1.9.m9.1.1.2">subscript</csymbol><ci id="S4.SS1.p1.9.m9.1.1.2.2.cmml" xref="S4.SS1.p1.9.m9.1.1.2.2">𝐈</ci><ci id="S4.SS1.p1.9.m9.1.1.2.3.cmml" xref="S4.SS1.p1.9.m9.1.1.2.3">𝐑</ci></apply><ci id="S4.SS1.p1.9.m9.1.1.3.cmml" xref="S4.SS1.p1.9.m9.1.1.3">𝒟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.9.m9.1c">\mathbf{I_{R}}\subseteq\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.9.m9.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT ⊆ caligraphic_D</annotation></semantics></math> and <math alttext="|\mathbf{I_{R}}|=k" class="ltx_Math" display="inline" id="S4.SS1.p1.10.m10.1"><semantics id="S4.SS1.p1.10.m10.1a"><mrow id="S4.SS1.p1.10.m10.1.1" xref="S4.SS1.p1.10.m10.1.1.cmml"><mrow id="S4.SS1.p1.10.m10.1.1.1.1" xref="S4.SS1.p1.10.m10.1.1.1.2.cmml"><mo id="S4.SS1.p1.10.m10.1.1.1.1.2" stretchy="false" xref="S4.SS1.p1.10.m10.1.1.1.2.1.cmml">|</mo><msub id="S4.SS1.p1.10.m10.1.1.1.1.1" xref="S4.SS1.p1.10.m10.1.1.1.1.1.cmml"><mi id="S4.SS1.p1.10.m10.1.1.1.1.1.2" xref="S4.SS1.p1.10.m10.1.1.1.1.1.2.cmml">𝐈</mi><mi id="S4.SS1.p1.10.m10.1.1.1.1.1.3" xref="S4.SS1.p1.10.m10.1.1.1.1.1.3.cmml">𝐑</mi></msub><mo id="S4.SS1.p1.10.m10.1.1.1.1.3" stretchy="false" xref="S4.SS1.p1.10.m10.1.1.1.2.1.cmml">|</mo></mrow><mo id="S4.SS1.p1.10.m10.1.1.2" xref="S4.SS1.p1.10.m10.1.1.2.cmml">=</mo><mi id="S4.SS1.p1.10.m10.1.1.3" xref="S4.SS1.p1.10.m10.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.10.m10.1b"><apply id="S4.SS1.p1.10.m10.1.1.cmml" xref="S4.SS1.p1.10.m10.1.1"><eq id="S4.SS1.p1.10.m10.1.1.2.cmml" xref="S4.SS1.p1.10.m10.1.1.2"></eq><apply id="S4.SS1.p1.10.m10.1.1.1.2.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1"><abs id="S4.SS1.p1.10.m10.1.1.1.2.1.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1.2"></abs><apply id="S4.SS1.p1.10.m10.1.1.1.1.1.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.10.m10.1.1.1.1.1.1.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1.1">subscript</csymbol><ci id="S4.SS1.p1.10.m10.1.1.1.1.1.2.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1.1.2">𝐈</ci><ci id="S4.SS1.p1.10.m10.1.1.1.1.1.3.cmml" xref="S4.SS1.p1.10.m10.1.1.1.1.1.3">𝐑</ci></apply></apply><ci id="S4.SS1.p1.10.m10.1.1.3.cmml" xref="S4.SS1.p1.10.m10.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.10.m10.1c">|\mathbf{I_{R}}|=k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.10.m10.1d">| bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT | = italic_k</annotation></semantics></math>. Ideally, <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S4.SS1.p1.11.m11.1"><semantics id="S4.SS1.p1.11.m11.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.11.m11.1.1" xref="S4.SS1.p1.11.m11.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.11.m11.1b"><ci id="S4.SS1.p1.11.m11.1.1.cmml" xref="S4.SS1.p1.11.m11.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.11.m11.1c">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.11.m11.1d">caligraphic_R</annotation></semantics></math> has to be designed such that it provides the model with beneficial data representations from <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p1.12.m12.1"><semantics id="S4.SS1.p1.12.m12.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p1.12.m12.1.1" xref="S4.SS1.p1.12.m12.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.12.m12.1b"><ci id="S4.SS1.p1.12.m12.1.1.cmml" xref="S4.SS1.p1.12.m12.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.12.m12.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.12.m12.1d">caligraphic_D</annotation></semantics></math> to help restore images containing details faithful to the original scenes.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.8">In this work, we implement a conceptually simple solution of <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><ci id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">caligraphic_R</annotation></semantics></math>, which uses the query image <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS1.p2.2.m2.1"><semantics id="S4.SS1.p2.2.m2.1a"><msub id="S4.SS1.p2.2.m2.1.1" xref="S4.SS1.p2.2.m2.1.1.cmml"><mi id="S4.SS1.p2.2.m2.1.1.2" xref="S4.SS1.p2.2.m2.1.1.2.cmml">I</mi><mrow id="S4.SS1.p2.2.m2.1.1.3" xref="S4.SS1.p2.2.m2.1.1.3.cmml"><mi id="S4.SS1.p2.2.m2.1.1.3.2" xref="S4.SS1.p2.2.m2.1.1.3.2.cmml">L</mi><mo id="S4.SS1.p2.2.m2.1.1.3.1" xref="S4.SS1.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.2.m2.1.1.3.3" xref="S4.SS1.p2.2.m2.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.2.m2.1b"><apply id="S4.SS1.p2.2.m2.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.2.m2.1.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.p2.2.m2.1.1.2.cmml" xref="S4.SS1.p2.2.m2.1.1.2">𝐼</ci><apply id="S4.SS1.p2.2.m2.1.1.3.cmml" xref="S4.SS1.p2.2.m2.1.1.3"><times id="S4.SS1.p2.2.m2.1.1.3.1.cmml" xref="S4.SS1.p2.2.m2.1.1.3.1"></times><ci id="S4.SS1.p2.2.m2.1.1.3.2.cmml" xref="S4.SS1.p2.2.m2.1.1.3.2">𝐿</ci><ci id="S4.SS1.p2.2.m2.1.1.3.3.cmml" xref="S4.SS1.p2.2.m2.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.2.m2.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.2.m2.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> to retrieve its <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p2.3.m3.1"><semantics id="S4.SS1.p2.3.m3.1a"><mi id="S4.SS1.p2.3.m3.1.1" xref="S4.SS1.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.3.m3.1b"><ci id="S4.SS1.p2.3.m3.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.3.m3.1d">italic_k</annotation></semantics></math> nearest neighbor in <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p2.4.m4.1"><semantics id="S4.SS1.p2.4.m4.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.4.m4.1.1" xref="S4.SS1.p2.4.m4.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.4.m4.1b"><ci id="S4.SS1.p2.4.m4.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.4.m4.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.4.m4.1d">caligraphic_D</annotation></semantics></math> using cosine similarity in the compact feature space derived from any feature extractors, such as VGG <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib46" title=""><span class="ltx_text" style="font-size:90%;">46</span></a>]</cite>, ResNet <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib47" title=""><span class="ltx_text" style="font-size:90%;">47</span></a>]</cite> or CLIP <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib48" title=""><span class="ltx_text" style="font-size:90%;">48</span></a>]</cite>. Since the <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p2.5.m5.1"><semantics id="S4.SS1.p2.5.m5.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.5.m5.1.1" xref="S4.SS1.p2.5.m5.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.5.m5.1b"><ci id="S4.SS1.p2.5.m5.1.1.cmml" xref="S4.SS1.p2.5.m5.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.5.m5.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.5.m5.1d">caligraphic_D</annotation></semantics></math> is fixed, in practice, we can pre-extract and store the compact feature before training. Given a sufficiently large database <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.SS1.p2.6.m6.1"><semantics id="S4.SS1.p2.6.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.6.m6.1.1" xref="S4.SS1.p2.6.m6.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.6.m6.1b"><ci id="S4.SS1.p2.6.m6.1.1.cmml" xref="S4.SS1.p2.6.m6.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.6.m6.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.6.m6.1d">caligraphic_D</annotation></semantics></math>, this strategy ensures that the set of neighbors <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS1.p2.7.m7.1"><semantics id="S4.SS1.p2.7.m7.1a"><msub id="S4.SS1.p2.7.m7.1.1" xref="S4.SS1.p2.7.m7.1.1.cmml"><mi id="S4.SS1.p2.7.m7.1.1.2" xref="S4.SS1.p2.7.m7.1.1.2.cmml">𝐈</mi><mi id="S4.SS1.p2.7.m7.1.1.3" xref="S4.SS1.p2.7.m7.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.7.m7.1b"><apply id="S4.SS1.p2.7.m7.1.1.cmml" xref="S4.SS1.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.7.m7.1.1.1.cmml" xref="S4.SS1.p2.7.m7.1.1">subscript</csymbol><ci id="S4.SS1.p2.7.m7.1.1.2.cmml" xref="S4.SS1.p2.7.m7.1.1.2">𝐈</ci><ci id="S4.SS1.p2.7.m7.1.1.3.cmml" xref="S4.SS1.p2.7.m7.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.7.m7.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.7.m7.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> shares sufficient semantic consistency with <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS1.p2.8.m8.1"><semantics id="S4.SS1.p2.8.m8.1a"><msub id="S4.SS1.p2.8.m8.1.1" xref="S4.SS1.p2.8.m8.1.1.cmml"><mi id="S4.SS1.p2.8.m8.1.1.2" xref="S4.SS1.p2.8.m8.1.1.2.cmml">I</mi><mrow id="S4.SS1.p2.8.m8.1.1.3" xref="S4.SS1.p2.8.m8.1.1.3.cmml"><mi id="S4.SS1.p2.8.m8.1.1.3.2" xref="S4.SS1.p2.8.m8.1.1.3.2.cmml">L</mi><mo id="S4.SS1.p2.8.m8.1.1.3.1" xref="S4.SS1.p2.8.m8.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.8.m8.1.1.3.3" xref="S4.SS1.p2.8.m8.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.8.m8.1b"><apply id="S4.SS1.p2.8.m8.1.1.cmml" xref="S4.SS1.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.8.m8.1.1.1.cmml" xref="S4.SS1.p2.8.m8.1.1">subscript</csymbol><ci id="S4.SS1.p2.8.m8.1.1.2.cmml" xref="S4.SS1.p2.8.m8.1.1.2">𝐼</ci><apply id="S4.SS1.p2.8.m8.1.1.3.cmml" xref="S4.SS1.p2.8.m8.1.1.3"><times id="S4.SS1.p2.8.m8.1.1.3.1.cmml" xref="S4.SS1.p2.8.m8.1.1.3.1"></times><ci id="S4.SS1.p2.8.m8.1.1.3.2.cmml" xref="S4.SS1.p2.8.m8.1.1.3.2">𝐿</ci><ci id="S4.SS1.p2.8.m8.1.1.3.3.cmml" xref="S4.SS1.p2.8.m8.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.8.m8.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.8.m8.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> and thus provides useful visual information for the restoration. Although this scheme seems simple, we show that it is efficient and effective, please see <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS3" title="5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">5.3</span></a> for discussion.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Cross Image Injection for High-fidelity Image Restoration</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.6">Given the retrieved reference images <math alttext="\mathbf{I_{R}}=\mathcal{R}(I_{LQ},\mathcal{D})" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.2"><semantics id="S4.SS2.p1.1.m1.2a"><mrow id="S4.SS2.p1.1.m1.2.2" xref="S4.SS2.p1.1.m1.2.2.cmml"><msub id="S4.SS2.p1.1.m1.2.2.3" xref="S4.SS2.p1.1.m1.2.2.3.cmml"><mi id="S4.SS2.p1.1.m1.2.2.3.2" xref="S4.SS2.p1.1.m1.2.2.3.2.cmml">𝐈</mi><mi id="S4.SS2.p1.1.m1.2.2.3.3" xref="S4.SS2.p1.1.m1.2.2.3.3.cmml">𝐑</mi></msub><mo id="S4.SS2.p1.1.m1.2.2.2" xref="S4.SS2.p1.1.m1.2.2.2.cmml">=</mo><mrow id="S4.SS2.p1.1.m1.2.2.1" xref="S4.SS2.p1.1.m1.2.2.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p1.1.m1.2.2.1.3" xref="S4.SS2.p1.1.m1.2.2.1.3.cmml">ℛ</mi><mo id="S4.SS2.p1.1.m1.2.2.1.2" xref="S4.SS2.p1.1.m1.2.2.1.2.cmml">⁢</mo><mrow id="S4.SS2.p1.1.m1.2.2.1.1.1" xref="S4.SS2.p1.1.m1.2.2.1.1.2.cmml"><mo id="S4.SS2.p1.1.m1.2.2.1.1.1.2" stretchy="false" xref="S4.SS2.p1.1.m1.2.2.1.1.2.cmml">(</mo><msub id="S4.SS2.p1.1.m1.2.2.1.1.1.1" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.cmml"><mi id="S4.SS2.p1.1.m1.2.2.1.1.1.1.2" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.2.cmml">I</mi><mrow id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.cmml"><mi id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.2" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.2.cmml">L</mi><mo id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.1" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.3" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.3.cmml">Q</mi></mrow></msub><mo id="S4.SS2.p1.1.m1.2.2.1.1.1.3" xref="S4.SS2.p1.1.m1.2.2.1.1.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml">𝒟</mi><mo id="S4.SS2.p1.1.m1.2.2.1.1.1.4" stretchy="false" xref="S4.SS2.p1.1.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.2b"><apply id="S4.SS2.p1.1.m1.2.2.cmml" xref="S4.SS2.p1.1.m1.2.2"><eq id="S4.SS2.p1.1.m1.2.2.2.cmml" xref="S4.SS2.p1.1.m1.2.2.2"></eq><apply id="S4.SS2.p1.1.m1.2.2.3.cmml" xref="S4.SS2.p1.1.m1.2.2.3"><csymbol cd="ambiguous" id="S4.SS2.p1.1.m1.2.2.3.1.cmml" xref="S4.SS2.p1.1.m1.2.2.3">subscript</csymbol><ci id="S4.SS2.p1.1.m1.2.2.3.2.cmml" xref="S4.SS2.p1.1.m1.2.2.3.2">𝐈</ci><ci id="S4.SS2.p1.1.m1.2.2.3.3.cmml" xref="S4.SS2.p1.1.m1.2.2.3.3">𝐑</ci></apply><apply id="S4.SS2.p1.1.m1.2.2.1.cmml" xref="S4.SS2.p1.1.m1.2.2.1"><times id="S4.SS2.p1.1.m1.2.2.1.2.cmml" xref="S4.SS2.p1.1.m1.2.2.1.2"></times><ci id="S4.SS2.p1.1.m1.2.2.1.3.cmml" xref="S4.SS2.p1.1.m1.2.2.1.3">ℛ</ci><interval closure="open" id="S4.SS2.p1.1.m1.2.2.1.1.2.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1"><apply id="S4.SS2.p1.1.m1.2.2.1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.1.m1.2.2.1.1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S4.SS2.p1.1.m1.2.2.1.1.1.1.2.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.2">𝐼</ci><apply id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3"><times id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.1.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.1"></times><ci id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.2.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.2">𝐿</ci><ci id="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.3.cmml" xref="S4.SS2.p1.1.m1.2.2.1.1.1.1.3.3">𝑄</ci></apply></apply><ci id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1">𝒟</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.2c">\mathbf{I_{R}}=\mathcal{R}(I_{LQ},\mathcal{D})</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.2d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT = caligraphic_R ( italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT , caligraphic_D )</annotation></semantics></math>, we further propose the cross image injection to allow the original LRMs to use the external knowledge from <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS2.p1.2.m2.1"><semantics id="S4.SS2.p1.2.m2.1a"><msub id="S4.SS2.p1.2.m2.1.1" xref="S4.SS2.p1.2.m2.1.1.cmml"><mi id="S4.SS2.p1.2.m2.1.1.2" xref="S4.SS2.p1.2.m2.1.1.2.cmml">𝐈</mi><mi id="S4.SS2.p1.2.m2.1.1.3" xref="S4.SS2.p1.2.m2.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.2.m2.1b"><apply id="S4.SS2.p1.2.m2.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.p1.2.m2.1.1.2">𝐈</ci><ci id="S4.SS2.p1.2.m2.1.1.3.cmml" xref="S4.SS2.p1.2.m2.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.2.m2.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.2.m2.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math>.
As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.F4" title="In 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a>, we first construct two parallel denoising chains: the target restoration chain <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p1.3.m3.1"><semantics id="S4.SS2.p1.3.m3.1a"><msub id="S4.SS2.p1.3.m3.1.1" xref="S4.SS2.p1.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p1.3.m3.1.1.2" xref="S4.SS2.p1.3.m3.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p1.3.m3.1.1.3" xref="S4.SS2.p1.3.m3.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.3.m3.1b"><apply id="S4.SS2.p1.3.m3.1.1.cmml" xref="S4.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.3.m3.1.1.1.cmml" xref="S4.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p1.3.m3.1.1.2.cmml" xref="S4.SS2.p1.3.m3.1.1.2">𝒞</ci><ci id="S4.SS2.p1.3.m3.1.1.3.cmml" xref="S4.SS2.p1.3.m3.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.3.m3.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> which is used to restore <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS2.p1.4.m4.1"><semantics id="S4.SS2.p1.4.m4.1a"><msub id="S4.SS2.p1.4.m4.1.1" xref="S4.SS2.p1.4.m4.1.1.cmml"><mi id="S4.SS2.p1.4.m4.1.1.2" xref="S4.SS2.p1.4.m4.1.1.2.cmml">I</mi><mrow id="S4.SS2.p1.4.m4.1.1.3" xref="S4.SS2.p1.4.m4.1.1.3.cmml"><mi id="S4.SS2.p1.4.m4.1.1.3.2" xref="S4.SS2.p1.4.m4.1.1.3.2.cmml">L</mi><mo id="S4.SS2.p1.4.m4.1.1.3.1" xref="S4.SS2.p1.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.4.m4.1.1.3.3" xref="S4.SS2.p1.4.m4.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.4.m4.1b"><apply id="S4.SS2.p1.4.m4.1.1.cmml" xref="S4.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.4.m4.1.1.1.cmml" xref="S4.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p1.4.m4.1.1.2.cmml" xref="S4.SS2.p1.4.m4.1.1.2">𝐼</ci><apply id="S4.SS2.p1.4.m4.1.1.3.cmml" xref="S4.SS2.p1.4.m4.1.1.3"><times id="S4.SS2.p1.4.m4.1.1.3.1.cmml" xref="S4.SS2.p1.4.m4.1.1.3.1"></times><ci id="S4.SS2.p1.4.m4.1.1.3.2.cmml" xref="S4.SS2.p1.4.m4.1.1.3.2">𝐿</ci><ci id="S4.SS2.p1.4.m4.1.1.3.3.cmml" xref="S4.SS2.p1.4.m4.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.4.m4.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.4.m4.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math>, and the source reference chain <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p1.5.m5.1"><semantics id="S4.SS2.p1.5.m5.1a"><msub id="S4.SS2.p1.5.m5.1.1" xref="S4.SS2.p1.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p1.5.m5.1.1.2" xref="S4.SS2.p1.5.m5.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p1.5.m5.1.1.3" xref="S4.SS2.p1.5.m5.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.5.m5.1b"><apply id="S4.SS2.p1.5.m5.1.1.cmml" xref="S4.SS2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.5.m5.1.1.1.cmml" xref="S4.SS2.p1.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.p1.5.m5.1.1.2.cmml" xref="S4.SS2.p1.5.m5.1.1.2">𝒞</ci><ci id="S4.SS2.p1.5.m5.1.1.3.cmml" xref="S4.SS2.p1.5.m5.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.5.m5.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> which unfolds <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS2.p1.6.m6.1"><semantics id="S4.SS2.p1.6.m6.1a"><msub id="S4.SS2.p1.6.m6.1.1" xref="S4.SS2.p1.6.m6.1.1.cmml"><mi id="S4.SS2.p1.6.m6.1.1.2" xref="S4.SS2.p1.6.m6.1.1.2.cmml">𝐈</mi><mi id="S4.SS2.p1.6.m6.1.1.3" xref="S4.SS2.p1.6.m6.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.6.m6.1b"><apply id="S4.SS2.p1.6.m6.1.1.cmml" xref="S4.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.6.m6.1.1.1.cmml" xref="S4.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p1.6.m6.1.1.2.cmml" xref="S4.SS2.p1.6.m6.1.1.2">𝐈</ci><ci id="S4.SS2.p1.6.m6.1.1.3.cmml" xref="S4.SS2.p1.6.m6.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.6.m6.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.6.m6.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> into denoising time steps. After that, we introduce separate attention to separately perform attention within and between chains, followed by spatial adaptive gating to filter out irrelevant pixels. At last, we use the distribution alignment to mitigate the domain gap between chains. More details are given below.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.22"><span class="ltx_text ltx_font_bold" id="S4.SS2.p2.22.1">Separate attention.</span>
To allow the <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.1.m1.1"><semantics id="S4.SS2.p2.1.m1.1a"><msub id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.1.m1.1.1.2" xref="S4.SS2.p2.1.m1.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.1.m1.1.1.3" xref="S4.SS2.p2.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><apply id="S4.SS2.p2.1.m1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.1.m1.1.1.2">𝒞</ci><ci id="S4.SS2.p2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.1.m1.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to learn the knowledge from the <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.2.m2.1"><semantics id="S4.SS2.p2.2.m2.1a"><msub id="S4.SS2.p2.2.m2.1.1" xref="S4.SS2.p2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.2.m2.1.1.2" xref="S4.SS2.p2.2.m2.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.2.m2.1.1.3" xref="S4.SS2.p2.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.2.m2.1b"><apply id="S4.SS2.p2.2.m2.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.2.m2.1.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p2.2.m2.1.1.2.cmml" xref="S4.SS2.p2.2.m2.1.1.2">𝒞</ci><ci id="S4.SS2.p2.2.m2.1.1.3.cmml" xref="S4.SS2.p2.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.2.m2.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, an effective interaction between the latents is crucial.
Inspired by the observation in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S3" title="3 Probing Large Restoration Models ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">3</span></a>, we aim to transfer the knowledge embedded in the self-attention layer of <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.3.m3.1"><semantics id="S4.SS2.p2.3.m3.1a"><msub id="S4.SS2.p2.3.m3.1.1" xref="S4.SS2.p2.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.3.m3.1.1.2" xref="S4.SS2.p2.3.m3.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.3.m3.1.1.3" xref="S4.SS2.p2.3.m3.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.3.m3.1b"><apply id="S4.SS2.p2.3.m3.1.1.cmml" xref="S4.SS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.3.m3.1.1.1.cmml" xref="S4.SS2.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p2.3.m3.1.1.2.cmml" xref="S4.SS2.p2.3.m3.1.1.2">𝒞</ci><ci id="S4.SS2.p2.3.m3.1.1.3.cmml" xref="S4.SS2.p2.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.3.m3.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>’s decoder to the counterpart of <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.4.m4.1"><semantics id="S4.SS2.p2.4.m4.1a"><msub id="S4.SS2.p2.4.m4.1.1" xref="S4.SS2.p2.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.4.m4.1.1.2" xref="S4.SS2.p2.4.m4.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.4.m4.1.1.3" xref="S4.SS2.p2.4.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.4.m4.1b"><apply id="S4.SS2.p2.4.m4.1.1.cmml" xref="S4.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.4.m4.1.1.1.cmml" xref="S4.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p2.4.m4.1.1.2.cmml" xref="S4.SS2.p2.4.m4.1.1.2">𝒞</ci><ci id="S4.SS2.p2.4.m4.1.1.3.cmml" xref="S4.SS2.p2.4.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.4.m4.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>.
To this end, we modify the original self-attention in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.5.m5.1"><semantics id="S4.SS2.p2.5.m5.1a"><msub id="S4.SS2.p2.5.m5.1.1" xref="S4.SS2.p2.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.5.m5.1.1.2" xref="S4.SS2.p2.5.m5.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.5.m5.1.1.3" xref="S4.SS2.p2.5.m5.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.5.m5.1b"><apply id="S4.SS2.p2.5.m5.1.1.cmml" xref="S4.SS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.5.m5.1.1.1.cmml" xref="S4.SS2.p2.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.p2.5.m5.1.1.2.cmml" xref="S4.SS2.p2.5.m5.1.1.2">𝒞</ci><ci id="S4.SS2.p2.5.m5.1.1.3.cmml" xref="S4.SS2.p2.5.m5.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.5.m5.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to our proposed separate attention.
The core idea of our separate attention is to add “inter-chain cross-attention” to the original “intra-chain self-attention” so that <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.6.m6.1"><semantics id="S4.SS2.p2.6.m6.1a"><msub id="S4.SS2.p2.6.m6.1.1" xref="S4.SS2.p2.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.6.m6.1.1.2" xref="S4.SS2.p2.6.m6.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.6.m6.1.1.3" xref="S4.SS2.p2.6.m6.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.6.m6.1b"><apply id="S4.SS2.p2.6.m6.1.1.cmml" xref="S4.SS2.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.6.m6.1.1.1.cmml" xref="S4.SS2.p2.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p2.6.m6.1.1.2.cmml" xref="S4.SS2.p2.6.m6.1.1.2">𝒞</ci><ci id="S4.SS2.p2.6.m6.1.1.3.cmml" xref="S4.SS2.p2.6.m6.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.6.m6.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.6.m6.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> can attend high-quality texture knowledge from <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.7.m7.1"><semantics id="S4.SS2.p2.7.m7.1a"><msub id="S4.SS2.p2.7.m7.1.1" xref="S4.SS2.p2.7.m7.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.7.m7.1.1.2" xref="S4.SS2.p2.7.m7.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.7.m7.1.1.3" xref="S4.SS2.p2.7.m7.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.7.m7.1b"><apply id="S4.SS2.p2.7.m7.1.1.cmml" xref="S4.SS2.p2.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.7.m7.1.1.1.cmml" xref="S4.SS2.p2.7.m7.1.1">subscript</csymbol><ci id="S4.SS2.p2.7.m7.1.1.2.cmml" xref="S4.SS2.p2.7.m7.1.1.2">𝒞</ci><ci id="S4.SS2.p2.7.m7.1.1.3.cmml" xref="S4.SS2.p2.7.m7.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.7.m7.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.7.m7.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> while preserving its original features.
As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.F4" title="In 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a>(a), formally, denote <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.8.m8.1"><semantics id="S4.SS2.p2.8.m8.1a"><msub id="S4.SS2.p2.8.m8.1.1" xref="S4.SS2.p2.8.m8.1.1.cmml"><mi id="S4.SS2.p2.8.m8.1.1.2" xref="S4.SS2.p2.8.m8.1.1.2.cmml">Q</mi><mi id="S4.SS2.p2.8.m8.1.1.3" xref="S4.SS2.p2.8.m8.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.8.m8.1b"><apply id="S4.SS2.p2.8.m8.1.1.cmml" xref="S4.SS2.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.8.m8.1.1.1.cmml" xref="S4.SS2.p2.8.m8.1.1">subscript</csymbol><ci id="S4.SS2.p2.8.m8.1.1.2.cmml" xref="S4.SS2.p2.8.m8.1.1.2">𝑄</ci><ci id="S4.SS2.p2.8.m8.1.1.3.cmml" xref="S4.SS2.p2.8.m8.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.8.m8.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.8.m8.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="K_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.9.m9.1"><semantics id="S4.SS2.p2.9.m9.1a"><msub id="S4.SS2.p2.9.m9.1.1" xref="S4.SS2.p2.9.m9.1.1.cmml"><mi id="S4.SS2.p2.9.m9.1.1.2" xref="S4.SS2.p2.9.m9.1.1.2.cmml">K</mi><mi id="S4.SS2.p2.9.m9.1.1.3" xref="S4.SS2.p2.9.m9.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.9.m9.1b"><apply id="S4.SS2.p2.9.m9.1.1.cmml" xref="S4.SS2.p2.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.9.m9.1.1.1.cmml" xref="S4.SS2.p2.9.m9.1.1">subscript</csymbol><ci id="S4.SS2.p2.9.m9.1.1.2.cmml" xref="S4.SS2.p2.9.m9.1.1.2">𝐾</ci><ci id="S4.SS2.p2.9.m9.1.1.3.cmml" xref="S4.SS2.p2.9.m9.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.9.m9.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.9.m9.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="V_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.10.m10.1"><semantics id="S4.SS2.p2.10.m10.1a"><msub id="S4.SS2.p2.10.m10.1.1" xref="S4.SS2.p2.10.m10.1.1.cmml"><mi id="S4.SS2.p2.10.m10.1.1.2" xref="S4.SS2.p2.10.m10.1.1.2.cmml">V</mi><mi id="S4.SS2.p2.10.m10.1.1.3" xref="S4.SS2.p2.10.m10.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.10.m10.1b"><apply id="S4.SS2.p2.10.m10.1.1.cmml" xref="S4.SS2.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.10.m10.1.1.1.cmml" xref="S4.SS2.p2.10.m10.1.1">subscript</csymbol><ci id="S4.SS2.p2.10.m10.1.1.2.cmml" xref="S4.SS2.p2.10.m10.1.1.2">𝑉</ci><ci id="S4.SS2.p2.10.m10.1.1.3.cmml" xref="S4.SS2.p2.10.m10.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.10.m10.1c">V_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.10.m10.1d">italic_V start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> as the query, key and value from the <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.11.m11.1"><semantics id="S4.SS2.p2.11.m11.1a"><msub id="S4.SS2.p2.11.m11.1.1" xref="S4.SS2.p2.11.m11.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.11.m11.1.1.2" xref="S4.SS2.p2.11.m11.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.11.m11.1.1.3" xref="S4.SS2.p2.11.m11.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.11.m11.1b"><apply id="S4.SS2.p2.11.m11.1.1.cmml" xref="S4.SS2.p2.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.11.m11.1.1.1.cmml" xref="S4.SS2.p2.11.m11.1.1">subscript</csymbol><ci id="S4.SS2.p2.11.m11.1.1.2.cmml" xref="S4.SS2.p2.11.m11.1.1.2">𝒞</ci><ci id="S4.SS2.p2.11.m11.1.1.3.cmml" xref="S4.SS2.p2.11.m11.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.11.m11.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.11.m11.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="K_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.12.m12.1"><semantics id="S4.SS2.p2.12.m12.1a"><msub id="S4.SS2.p2.12.m12.1.1" xref="S4.SS2.p2.12.m12.1.1.cmml"><mi id="S4.SS2.p2.12.m12.1.1.2" xref="S4.SS2.p2.12.m12.1.1.2.cmml">K</mi><mi id="S4.SS2.p2.12.m12.1.1.3" xref="S4.SS2.p2.12.m12.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.12.m12.1b"><apply id="S4.SS2.p2.12.m12.1.1.cmml" xref="S4.SS2.p2.12.m12.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.12.m12.1.1.1.cmml" xref="S4.SS2.p2.12.m12.1.1">subscript</csymbol><ci id="S4.SS2.p2.12.m12.1.1.2.cmml" xref="S4.SS2.p2.12.m12.1.1.2">𝐾</ci><ci id="S4.SS2.p2.12.m12.1.1.3.cmml" xref="S4.SS2.p2.12.m12.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.12.m12.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.12.m12.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="V_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.13.m13.1"><semantics id="S4.SS2.p2.13.m13.1a"><msub id="S4.SS2.p2.13.m13.1.1" xref="S4.SS2.p2.13.m13.1.1.cmml"><mi id="S4.SS2.p2.13.m13.1.1.2" xref="S4.SS2.p2.13.m13.1.1.2.cmml">V</mi><mi id="S4.SS2.p2.13.m13.1.1.3" xref="S4.SS2.p2.13.m13.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.13.m13.1b"><apply id="S4.SS2.p2.13.m13.1.1.cmml" xref="S4.SS2.p2.13.m13.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.13.m13.1.1.1.cmml" xref="S4.SS2.p2.13.m13.1.1">subscript</csymbol><ci id="S4.SS2.p2.13.m13.1.1.2.cmml" xref="S4.SS2.p2.13.m13.1.1.2">𝑉</ci><ci id="S4.SS2.p2.13.m13.1.1.3.cmml" xref="S4.SS2.p2.13.m13.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.13.m13.1c">V_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.13.m13.1d">italic_V start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> as the key and value from the <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.14.m14.1"><semantics id="S4.SS2.p2.14.m14.1a"><msub id="S4.SS2.p2.14.m14.1.1" xref="S4.SS2.p2.14.m14.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.14.m14.1.1.2" xref="S4.SS2.p2.14.m14.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.14.m14.1.1.3" xref="S4.SS2.p2.14.m14.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.14.m14.1b"><apply id="S4.SS2.p2.14.m14.1.1.cmml" xref="S4.SS2.p2.14.m14.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.14.m14.1.1.1.cmml" xref="S4.SS2.p2.14.m14.1.1">subscript</csymbol><ci id="S4.SS2.p2.14.m14.1.1.2.cmml" xref="S4.SS2.p2.14.m14.1.1.2">𝒞</ci><ci id="S4.SS2.p2.14.m14.1.1.3.cmml" xref="S4.SS2.p2.14.m14.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.14.m14.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.14.m14.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, the intra-chain self-attention preserves the original attention of <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.15.m15.1"><semantics id="S4.SS2.p2.15.m15.1a"><msub id="S4.SS2.p2.15.m15.1.1" xref="S4.SS2.p2.15.m15.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.15.m15.1.1.2" xref="S4.SS2.p2.15.m15.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.15.m15.1.1.3" xref="S4.SS2.p2.15.m15.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.15.m15.1b"><apply id="S4.SS2.p2.15.m15.1.1.cmml" xref="S4.SS2.p2.15.m15.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.15.m15.1.1.1.cmml" xref="S4.SS2.p2.15.m15.1.1">subscript</csymbol><ci id="S4.SS2.p2.15.m15.1.1.2.cmml" xref="S4.SS2.p2.15.m15.1.1.2">𝒞</ci><ci id="S4.SS2.p2.15.m15.1.1.3.cmml" xref="S4.SS2.p2.15.m15.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.15.m15.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.15.m15.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to obtain the output <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p2.16.m16.1"><semantics id="S4.SS2.p2.16.m16.1a"><msub id="S4.SS2.p2.16.m16.1.1" xref="S4.SS2.p2.16.m16.1.1.cmml"><mi id="S4.SS2.p2.16.m16.1.1.2" xref="S4.SS2.p2.16.m16.1.1.2.cmml">O</mi><mrow id="S4.SS2.p2.16.m16.1.1.3" xref="S4.SS2.p2.16.m16.1.1.3.cmml"><mi id="S4.SS2.p2.16.m16.1.1.3.2" xref="S4.SS2.p2.16.m16.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p2.16.m16.1.1.3.1" xref="S4.SS2.p2.16.m16.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.16.m16.1.1.3.3" xref="S4.SS2.p2.16.m16.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p2.16.m16.1.1.3.1a" xref="S4.SS2.p2.16.m16.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.16.m16.1.1.3.4" xref="S4.SS2.p2.16.m16.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p2.16.m16.1.1.3.1b" xref="S4.SS2.p2.16.m16.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.16.m16.1.1.3.5" xref="S4.SS2.p2.16.m16.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p2.16.m16.1.1.3.1c" xref="S4.SS2.p2.16.m16.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.16.m16.1.1.3.6" xref="S4.SS2.p2.16.m16.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.16.m16.1b"><apply id="S4.SS2.p2.16.m16.1.1.cmml" xref="S4.SS2.p2.16.m16.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.16.m16.1.1.1.cmml" xref="S4.SS2.p2.16.m16.1.1">subscript</csymbol><ci id="S4.SS2.p2.16.m16.1.1.2.cmml" xref="S4.SS2.p2.16.m16.1.1.2">𝑂</ci><apply id="S4.SS2.p2.16.m16.1.1.3.cmml" xref="S4.SS2.p2.16.m16.1.1.3"><times id="S4.SS2.p2.16.m16.1.1.3.1.cmml" xref="S4.SS2.p2.16.m16.1.1.3.1"></times><ci id="S4.SS2.p2.16.m16.1.1.3.2.cmml" xref="S4.SS2.p2.16.m16.1.1.3.2">𝑖</ci><ci id="S4.SS2.p2.16.m16.1.1.3.3.cmml" xref="S4.SS2.p2.16.m16.1.1.3.3">𝑛</ci><ci id="S4.SS2.p2.16.m16.1.1.3.4.cmml" xref="S4.SS2.p2.16.m16.1.1.3.4">𝑡</ci><ci id="S4.SS2.p2.16.m16.1.1.3.5.cmml" xref="S4.SS2.p2.16.m16.1.1.3.5">𝑟</ci><ci id="S4.SS2.p2.16.m16.1.1.3.6.cmml" xref="S4.SS2.p2.16.m16.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.16.m16.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.16.m16.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math>, and the inter-chain cross-attention uses the <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.17.m17.1"><semantics id="S4.SS2.p2.17.m17.1a"><msub id="S4.SS2.p2.17.m17.1.1" xref="S4.SS2.p2.17.m17.1.1.cmml"><mi id="S4.SS2.p2.17.m17.1.1.2" xref="S4.SS2.p2.17.m17.1.1.2.cmml">Q</mi><mi id="S4.SS2.p2.17.m17.1.1.3" xref="S4.SS2.p2.17.m17.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.17.m17.1b"><apply id="S4.SS2.p2.17.m17.1.1.cmml" xref="S4.SS2.p2.17.m17.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.17.m17.1.1.1.cmml" xref="S4.SS2.p2.17.m17.1.1">subscript</csymbol><ci id="S4.SS2.p2.17.m17.1.1.2.cmml" xref="S4.SS2.p2.17.m17.1.1.2">𝑄</ci><ci id="S4.SS2.p2.17.m17.1.1.3.cmml" xref="S4.SS2.p2.17.m17.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.17.m17.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.17.m17.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to query the <math alttext="K_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.18.m18.1"><semantics id="S4.SS2.p2.18.m18.1a"><msub id="S4.SS2.p2.18.m18.1.1" xref="S4.SS2.p2.18.m18.1.1.cmml"><mi id="S4.SS2.p2.18.m18.1.1.2" xref="S4.SS2.p2.18.m18.1.1.2.cmml">K</mi><mi id="S4.SS2.p2.18.m18.1.1.3" xref="S4.SS2.p2.18.m18.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.18.m18.1b"><apply id="S4.SS2.p2.18.m18.1.1.cmml" xref="S4.SS2.p2.18.m18.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.18.m18.1.1.1.cmml" xref="S4.SS2.p2.18.m18.1.1">subscript</csymbol><ci id="S4.SS2.p2.18.m18.1.1.2.cmml" xref="S4.SS2.p2.18.m18.1.1.2">𝐾</ci><ci id="S4.SS2.p2.18.m18.1.1.3.cmml" xref="S4.SS2.p2.18.m18.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.18.m18.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.18.m18.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="V_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.19.m19.1"><semantics id="S4.SS2.p2.19.m19.1a"><msub id="S4.SS2.p2.19.m19.1.1" xref="S4.SS2.p2.19.m19.1.1.cmml"><mi id="S4.SS2.p2.19.m19.1.1.2" xref="S4.SS2.p2.19.m19.1.1.2.cmml">V</mi><mi id="S4.SS2.p2.19.m19.1.1.3" xref="S4.SS2.p2.19.m19.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.19.m19.1b"><apply id="S4.SS2.p2.19.m19.1.1.cmml" xref="S4.SS2.p2.19.m19.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.19.m19.1.1.1.cmml" xref="S4.SS2.p2.19.m19.1.1">subscript</csymbol><ci id="S4.SS2.p2.19.m19.1.1.2.cmml" xref="S4.SS2.p2.19.m19.1.1.2">𝑉</ci><ci id="S4.SS2.p2.19.m19.1.1.3.cmml" xref="S4.SS2.p2.19.m19.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.19.m19.1c">V_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.19.m19.1d">italic_V start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> to facilitate <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p2.20.m20.1"><semantics id="S4.SS2.p2.20.m20.1a"><msub id="S4.SS2.p2.20.m20.1.1" xref="S4.SS2.p2.20.m20.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.20.m20.1.1.2" xref="S4.SS2.p2.20.m20.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.20.m20.1.1.3" xref="S4.SS2.p2.20.m20.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.20.m20.1b"><apply id="S4.SS2.p2.20.m20.1.1.cmml" xref="S4.SS2.p2.20.m20.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.20.m20.1.1.1.cmml" xref="S4.SS2.p2.20.m20.1.1">subscript</csymbol><ci id="S4.SS2.p2.20.m20.1.1.2.cmml" xref="S4.SS2.p2.20.m20.1.1.2">𝒞</ci><ci id="S4.SS2.p2.20.m20.1.1.3.cmml" xref="S4.SS2.p2.20.m20.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.20.m20.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.20.m20.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> utilizing the knowledge from <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.21.m21.1"><semantics id="S4.SS2.p2.21.m21.1a"><msub id="S4.SS2.p2.21.m21.1.1" xref="S4.SS2.p2.21.m21.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.21.m21.1.1.2" xref="S4.SS2.p2.21.m21.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p2.21.m21.1.1.3" xref="S4.SS2.p2.21.m21.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.21.m21.1b"><apply id="S4.SS2.p2.21.m21.1.1.cmml" xref="S4.SS2.p2.21.m21.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.21.m21.1.1.1.cmml" xref="S4.SS2.p2.21.m21.1.1">subscript</csymbol><ci id="S4.SS2.p2.21.m21.1.1.2.cmml" xref="S4.SS2.p2.21.m21.1.1.2">𝒞</ci><ci id="S4.SS2.p2.21.m21.1.1.3.cmml" xref="S4.SS2.p2.21.m21.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.21.m21.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.21.m21.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> to get the result <math alttext="O_{inter}" class="ltx_Math" display="inline" id="S4.SS2.p2.22.m22.1"><semantics id="S4.SS2.p2.22.m22.1a"><msub id="S4.SS2.p2.22.m22.1.1" xref="S4.SS2.p2.22.m22.1.1.cmml"><mi id="S4.SS2.p2.22.m22.1.1.2" xref="S4.SS2.p2.22.m22.1.1.2.cmml">O</mi><mrow id="S4.SS2.p2.22.m22.1.1.3" xref="S4.SS2.p2.22.m22.1.1.3.cmml"><mi id="S4.SS2.p2.22.m22.1.1.3.2" xref="S4.SS2.p2.22.m22.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p2.22.m22.1.1.3.1" xref="S4.SS2.p2.22.m22.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.22.m22.1.1.3.3" xref="S4.SS2.p2.22.m22.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p2.22.m22.1.1.3.1a" xref="S4.SS2.p2.22.m22.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.22.m22.1.1.3.4" xref="S4.SS2.p2.22.m22.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p2.22.m22.1.1.3.1b" xref="S4.SS2.p2.22.m22.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.22.m22.1.1.3.5" xref="S4.SS2.p2.22.m22.1.1.3.5.cmml">e</mi><mo id="S4.SS2.p2.22.m22.1.1.3.1c" xref="S4.SS2.p2.22.m22.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p2.22.m22.1.1.3.6" xref="S4.SS2.p2.22.m22.1.1.3.6.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.22.m22.1b"><apply id="S4.SS2.p2.22.m22.1.1.cmml" xref="S4.SS2.p2.22.m22.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.22.m22.1.1.1.cmml" xref="S4.SS2.p2.22.m22.1.1">subscript</csymbol><ci id="S4.SS2.p2.22.m22.1.1.2.cmml" xref="S4.SS2.p2.22.m22.1.1.2">𝑂</ci><apply id="S4.SS2.p2.22.m22.1.1.3.cmml" xref="S4.SS2.p2.22.m22.1.1.3"><times id="S4.SS2.p2.22.m22.1.1.3.1.cmml" xref="S4.SS2.p2.22.m22.1.1.3.1"></times><ci id="S4.SS2.p2.22.m22.1.1.3.2.cmml" xref="S4.SS2.p2.22.m22.1.1.3.2">𝑖</ci><ci id="S4.SS2.p2.22.m22.1.1.3.3.cmml" xref="S4.SS2.p2.22.m22.1.1.3.3">𝑛</ci><ci id="S4.SS2.p2.22.m22.1.1.3.4.cmml" xref="S4.SS2.p2.22.m22.1.1.3.4">𝑡</ci><ci id="S4.SS2.p2.22.m22.1.1.3.5.cmml" xref="S4.SS2.p2.22.m22.1.1.3.5">𝑒</ci><ci id="S4.SS2.p2.22.m22.1.1.3.6.cmml" xref="S4.SS2.p2.22.m22.1.1.3.6">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.22.m22.1c">O_{inter}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.22.m22.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math>. In short, the proposed separate attention can be formalized as follows:</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S4.E1">
<tbody>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="S4.E1X">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle O_{intra}=\mathtt{Attention}({\color[rgb]{%
0.80078125,0.4140625,0.109375}Q_{T}},{\color[rgb]{%
0.80078125,0.4140625,0.109375}K_{T}},{\color[rgb]{%
0.80078125,0.4140625,0.109375}V_{T}}),\quad O_{inter}=\mathtt{Attention}({%
\color[rgb]{0.80078125,0.4140625,0.109375}Q_{T}},{\color[rgb]{%
0.34375,0.609375,0.87109375}K_{S}},{\color[rgb]{0.34375,0.609375,0.87109375}V_%
{S}})." class="ltx_Math" display="inline" id="S4.E1X.2.1.1.m1.1"><semantics id="S4.E1X.2.1.1.m1.1a"><mrow id="S4.E1X.2.1.1.m1.1.1.1"><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.3.cmml"><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.1.1" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.cmml"><msub id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.2.cmml">O</mi><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.2.cmml">i</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.3.cmml">n</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1a" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.4.cmml">t</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1b" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.5.cmml">r</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1c" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.6" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.6.cmml">a</mi></mrow></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.4.cmml">=</mo><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.5.cmml">𝙰𝚝𝚝𝚎𝚗𝚝𝚒𝚘𝚗</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.4.cmml">⁢</mo><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml"><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.4" stretchy="false" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml">(</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.2" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">Q</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.3" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">T</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml">,</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.2" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.2.cmml">K</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.3" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.3.cmml">T</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.6" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml">,</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.2" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.2.cmml">V</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.3" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.3.cmml">T</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.7" stretchy="false" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml">)</mo></mrow></mrow></mrow><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.3" rspace="1.167em" xref="S4.E1X.2.1.1.m1.1.1.1.1.3a.cmml">,</mo><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.2.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.cmml"><msub id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.2.cmml">O</mi><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.2.cmml">i</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.3.cmml">n</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1a" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.4.cmml">t</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1b" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.5.cmml">e</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1c" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1.cmml">⁢</mo><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.6" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.6.cmml">r</mi></mrow></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.4.cmml">=</mo><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.5.cmml">𝙰𝚝𝚝𝚎𝚗𝚝𝚒𝚘𝚗</mi><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.4" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.4.cmml">⁢</mo><mrow id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml"><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.4" stretchy="false" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml">(</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.2" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.2.cmml">Q</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.3" mathcolor="#CC6A1C" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.3.cmml">T</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.5" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml">,</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.2" mathcolor="#589BDE" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.2.cmml">K</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.3" mathcolor="#589BDE" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">S</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.6" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml">,</mo><msub id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.cmml"><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.2" mathcolor="#589BDE" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.2.cmml">V</mi><mi id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.3" mathcolor="#589BDE" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.3.cmml">S</mi></msub><mo id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.7" stretchy="false" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S4.E1X.2.1.1.m1.1.1.1.2" lspace="0em">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E1X.2.1.1.m1.1b"><apply id="S4.E1X.2.1.1.m1.1.1.1.1.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.3a.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.3">formulae-sequence</csymbol><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1"><eq id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.4"></eq><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.2">𝑂</ci><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3"><times id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.1"></times><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.2">𝑖</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.3">𝑛</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.4">𝑡</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.5">𝑟</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.6.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.5.3.6">𝑎</ci></apply></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3"><times id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.4"></times><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.5">𝙰𝚝𝚝𝚎𝚗𝚝𝚒𝚘𝚗</ci><vector id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3"><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.2">𝑄</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.3">𝑇</ci></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.2">𝐾</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.2.2.2.2.3">𝑇</ci></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.2">𝑉</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.1.1.3.3.3.3.3">𝑇</ci></apply></vector></apply></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2"><eq id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.4"></eq><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.2">𝑂</ci><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3"><times id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.1"></times><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.2">𝑖</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.3">𝑛</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.4">𝑡</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.5">𝑒</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.6.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.5.3.6">𝑟</ci></apply></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3"><times id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.4"></times><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.5.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.5">𝙰𝚝𝚝𝚎𝚗𝚝𝚒𝚘𝚗</ci><vector id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.4.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3"><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.2">𝑄</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.1.1.1.1.3">𝑇</ci></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.2">𝐾</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.2.2.2.2.3">𝑆</ci></apply><apply id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3"><csymbol cd="ambiguous" id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.1.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3">subscript</csymbol><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.2.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.2">𝑉</ci><ci id="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.3.cmml" xref="S4.E1X.2.1.1.m1.1.1.1.1.2.2.3.3.3.3.3">𝑆</ci></apply></vector></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E1X.2.1.1.m1.1c">\displaystyle O_{intra}=\mathtt{Attention}({\color[rgb]{%
0.80078125,0.4140625,0.109375}Q_{T}},{\color[rgb]{%
0.80078125,0.4140625,0.109375}K_{T}},{\color[rgb]{%
0.80078125,0.4140625,0.109375}V_{T}}),\quad O_{inter}=\mathtt{Attention}({%
\color[rgb]{0.80078125,0.4140625,0.109375}Q_{T}},{\color[rgb]{%
0.34375,0.609375,0.87109375}K_{S}},{\color[rgb]{0.34375,0.609375,0.87109375}V_%
{S}}).</annotation><annotation encoding="application/x-llamapun" id="S4.E1X.2.1.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT = typewriter_Attention ( italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT , italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT , italic_V start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT ) , italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT = typewriter_Attention ( italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT , italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT , italic_V start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equationgroup ltx_align_right">(1)</span></td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_para" id="S4.SS2.p3">
<p class="ltx_p" id="S4.SS2.p3.9">It is worth mentioning that directly using <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.1.m1.1"><semantics id="S4.SS2.p3.1.m1.1a"><msub id="S4.SS2.p3.1.m1.1.1" xref="S4.SS2.p3.1.m1.1.1.cmml"><mi id="S4.SS2.p3.1.m1.1.1.2" xref="S4.SS2.p3.1.m1.1.1.2.cmml">Q</mi><mi id="S4.SS2.p3.1.m1.1.1.3" xref="S4.SS2.p3.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.1.m1.1b"><apply id="S4.SS2.p3.1.m1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.1.m1.1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p3.1.m1.1.1.2.cmml" xref="S4.SS2.p3.1.m1.1.1.2">𝑄</ci><ci id="S4.SS2.p3.1.m1.1.1.3.cmml" xref="S4.SS2.p3.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.1.m1.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.1.m1.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to query the concatenate results of <math alttext="K_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.2.m2.1"><semantics id="S4.SS2.p3.2.m2.1a"><msub id="S4.SS2.p3.2.m2.1.1" xref="S4.SS2.p3.2.m2.1.1.cmml"><mi id="S4.SS2.p3.2.m2.1.1.2" xref="S4.SS2.p3.2.m2.1.1.2.cmml">K</mi><mi id="S4.SS2.p3.2.m2.1.1.3" xref="S4.SS2.p3.2.m2.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.2.m2.1b"><apply id="S4.SS2.p3.2.m2.1.1.cmml" xref="S4.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.2.m2.1.1.1.cmml" xref="S4.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p3.2.m2.1.1.2.cmml" xref="S4.SS2.p3.2.m2.1.1.2">𝐾</ci><ci id="S4.SS2.p3.2.m2.1.1.3.cmml" xref="S4.SS2.p3.2.m2.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.2.m2.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.2.m2.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="S4.SS2.p3.3.m3.1"><semantics id="S4.SS2.p3.3.m3.1a"><msub id="S4.SS2.p3.3.m3.1.1" xref="S4.SS2.p3.3.m3.1.1.cmml"><mi id="S4.SS2.p3.3.m3.1.1.2" xref="S4.SS2.p3.3.m3.1.1.2.cmml">K</mi><mi id="S4.SS2.p3.3.m3.1.1.3" xref="S4.SS2.p3.3.m3.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.3.m3.1b"><apply id="S4.SS2.p3.3.m3.1.1.cmml" xref="S4.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.3.m3.1.1.1.cmml" xref="S4.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p3.3.m3.1.1.2.cmml" xref="S4.SS2.p3.3.m3.1.1.2">𝐾</ci><ci id="S4.SS2.p3.3.m3.1.1.3.cmml" xref="S4.SS2.p3.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.3.m3.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.3.m3.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>
can only yield sub-optimal results due to the domain preference issue, <span class="ltx_text ltx_font_italic" id="S4.SS2.p3.9.1">i.e.</span>, <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.4.m4.1"><semantics id="S4.SS2.p3.4.m4.1a"><msub id="S4.SS2.p3.4.m4.1.1" xref="S4.SS2.p3.4.m4.1.1.cmml"><mi id="S4.SS2.p3.4.m4.1.1.2" xref="S4.SS2.p3.4.m4.1.1.2.cmml">Q</mi><mi id="S4.SS2.p3.4.m4.1.1.3" xref="S4.SS2.p3.4.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.4.m4.1b"><apply id="S4.SS2.p3.4.m4.1.1.cmml" xref="S4.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.4.m4.1.1.1.cmml" xref="S4.SS2.p3.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p3.4.m4.1.1.2.cmml" xref="S4.SS2.p3.4.m4.1.1.2">𝑄</ci><ci id="S4.SS2.p3.4.m4.1.1.3.cmml" xref="S4.SS2.p3.4.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.4.m4.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.4.m4.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> will prefer latent from the same domain <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.5.m5.1"><semantics id="S4.SS2.p3.5.m5.1a"><msub id="S4.SS2.p3.5.m5.1.1" xref="S4.SS2.p3.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p3.5.m5.1.1.2" xref="S4.SS2.p3.5.m5.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p3.5.m5.1.1.3" xref="S4.SS2.p3.5.m5.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.5.m5.1b"><apply id="S4.SS2.p3.5.m5.1.1.cmml" xref="S4.SS2.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.5.m5.1.1.1.cmml" xref="S4.SS2.p3.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.p3.5.m5.1.1.2.cmml" xref="S4.SS2.p3.5.m5.1.1.2">𝒞</ci><ci id="S4.SS2.p3.5.m5.1.1.3.cmml" xref="S4.SS2.p3.5.m5.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.5.m5.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> even though <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p3.6.m6.1"><semantics id="S4.SS2.p3.6.m6.1a"><msub id="S4.SS2.p3.6.m6.1.1" xref="S4.SS2.p3.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p3.6.m6.1.1.2" xref="S4.SS2.p3.6.m6.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p3.6.m6.1.1.3" xref="S4.SS2.p3.6.m6.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.6.m6.1b"><apply id="S4.SS2.p3.6.m6.1.1.cmml" xref="S4.SS2.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.6.m6.1.1.1.cmml" xref="S4.SS2.p3.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p3.6.m6.1.1.2.cmml" xref="S4.SS2.p3.6.m6.1.1.2">𝒞</ci><ci id="S4.SS2.p3.6.m6.1.1.3.cmml" xref="S4.SS2.p3.6.m6.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.6.m6.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.6.m6.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> is more helpful for reconstruction. By using the proposed separate attention, the <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.7.m7.1"><semantics id="S4.SS2.p3.7.m7.1a"><msub id="S4.SS2.p3.7.m7.1.1" xref="S4.SS2.p3.7.m7.1.1.cmml"><mi id="S4.SS2.p3.7.m7.1.1.2" xref="S4.SS2.p3.7.m7.1.1.2.cmml">Q</mi><mi id="S4.SS2.p3.7.m7.1.1.3" xref="S4.SS2.p3.7.m7.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.7.m7.1b"><apply id="S4.SS2.p3.7.m7.1.1.cmml" xref="S4.SS2.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.7.m7.1.1.1.cmml" xref="S4.SS2.p3.7.m7.1.1">subscript</csymbol><ci id="S4.SS2.p3.7.m7.1.1.2.cmml" xref="S4.SS2.p3.7.m7.1.1.2">𝑄</ci><ci id="S4.SS2.p3.7.m7.1.1.3.cmml" xref="S4.SS2.p3.7.m7.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.7.m7.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.7.m7.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> is separated to attend <math alttext="K_{T}" class="ltx_Math" display="inline" id="S4.SS2.p3.8.m8.1"><semantics id="S4.SS2.p3.8.m8.1a"><msub id="S4.SS2.p3.8.m8.1.1" xref="S4.SS2.p3.8.m8.1.1.cmml"><mi id="S4.SS2.p3.8.m8.1.1.2" xref="S4.SS2.p3.8.m8.1.1.2.cmml">K</mi><mi id="S4.SS2.p3.8.m8.1.1.3" xref="S4.SS2.p3.8.m8.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.8.m8.1b"><apply id="S4.SS2.p3.8.m8.1.1.cmml" xref="S4.SS2.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.8.m8.1.1.1.cmml" xref="S4.SS2.p3.8.m8.1.1">subscript</csymbol><ci id="S4.SS2.p3.8.m8.1.1.2.cmml" xref="S4.SS2.p3.8.m8.1.1.2">𝐾</ci><ci id="S4.SS2.p3.8.m8.1.1.3.cmml" xref="S4.SS2.p3.8.m8.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.8.m8.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.8.m8.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="S4.SS2.p3.9.m9.1"><semantics id="S4.SS2.p3.9.m9.1a"><msub id="S4.SS2.p3.9.m9.1.1" xref="S4.SS2.p3.9.m9.1.1.cmml"><mi id="S4.SS2.p3.9.m9.1.1.2" xref="S4.SS2.p3.9.m9.1.1.2.cmml">K</mi><mi id="S4.SS2.p3.9.m9.1.1.3" xref="S4.SS2.p3.9.m9.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.9.m9.1b"><apply id="S4.SS2.p3.9.m9.1.1.cmml" xref="S4.SS2.p3.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.9.m9.1.1.1.cmml" xref="S4.SS2.p3.9.m9.1.1">subscript</csymbol><ci id="S4.SS2.p3.9.m9.1.1.2.cmml" xref="S4.SS2.p3.9.m9.1.1.2">𝐾</ci><ci id="S4.SS2.p3.9.m9.1.1.3.cmml" xref="S4.SS2.p3.9.m9.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.9.m9.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.9.m9.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, thus effectively mitigating this problem. We give more discussion in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.SS3.SSS0.Px1" title="Domain preference problem. ‣ 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">5.3</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p4">
<p class="ltx_p" id="S4.SS2.p4.11"><span class="ltx_text ltx_font_bold" id="S4.SS2.p4.11.1">Spatial adaptive gating.</span>
We then consider fusing the separate attention results <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p4.1.m1.1"><semantics id="S4.SS2.p4.1.m1.1a"><msub id="S4.SS2.p4.1.m1.1.1" xref="S4.SS2.p4.1.m1.1.1.cmml"><mi id="S4.SS2.p4.1.m1.1.1.2" xref="S4.SS2.p4.1.m1.1.1.2.cmml">O</mi><mrow id="S4.SS2.p4.1.m1.1.1.3" xref="S4.SS2.p4.1.m1.1.1.3.cmml"><mi id="S4.SS2.p4.1.m1.1.1.3.2" xref="S4.SS2.p4.1.m1.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p4.1.m1.1.1.3.1" xref="S4.SS2.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.1.m1.1.1.3.3" xref="S4.SS2.p4.1.m1.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p4.1.m1.1.1.3.1a" xref="S4.SS2.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.1.m1.1.1.3.4" xref="S4.SS2.p4.1.m1.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p4.1.m1.1.1.3.1b" xref="S4.SS2.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.1.m1.1.1.3.5" xref="S4.SS2.p4.1.m1.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p4.1.m1.1.1.3.1c" xref="S4.SS2.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.1.m1.1.1.3.6" xref="S4.SS2.p4.1.m1.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.1.m1.1b"><apply id="S4.SS2.p4.1.m1.1.1.cmml" xref="S4.SS2.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.1.m1.1.1.1.cmml" xref="S4.SS2.p4.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p4.1.m1.1.1.2.cmml" xref="S4.SS2.p4.1.m1.1.1.2">𝑂</ci><apply id="S4.SS2.p4.1.m1.1.1.3.cmml" xref="S4.SS2.p4.1.m1.1.1.3"><times id="S4.SS2.p4.1.m1.1.1.3.1.cmml" xref="S4.SS2.p4.1.m1.1.1.3.1"></times><ci id="S4.SS2.p4.1.m1.1.1.3.2.cmml" xref="S4.SS2.p4.1.m1.1.1.3.2">𝑖</ci><ci id="S4.SS2.p4.1.m1.1.1.3.3.cmml" xref="S4.SS2.p4.1.m1.1.1.3.3">𝑛</ci><ci id="S4.SS2.p4.1.m1.1.1.3.4.cmml" xref="S4.SS2.p4.1.m1.1.1.3.4">𝑡</ci><ci id="S4.SS2.p4.1.m1.1.1.3.5.cmml" xref="S4.SS2.p4.1.m1.1.1.3.5">𝑟</ci><ci id="S4.SS2.p4.1.m1.1.1.3.6.cmml" xref="S4.SS2.p4.1.m1.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.1.m1.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="O_{inter}" class="ltx_Math" display="inline" id="S4.SS2.p4.2.m2.1"><semantics id="S4.SS2.p4.2.m2.1a"><msub id="S4.SS2.p4.2.m2.1.1" xref="S4.SS2.p4.2.m2.1.1.cmml"><mi id="S4.SS2.p4.2.m2.1.1.2" xref="S4.SS2.p4.2.m2.1.1.2.cmml">O</mi><mrow id="S4.SS2.p4.2.m2.1.1.3" xref="S4.SS2.p4.2.m2.1.1.3.cmml"><mi id="S4.SS2.p4.2.m2.1.1.3.2" xref="S4.SS2.p4.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p4.2.m2.1.1.3.1" xref="S4.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.2.m2.1.1.3.3" xref="S4.SS2.p4.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p4.2.m2.1.1.3.1a" xref="S4.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.2.m2.1.1.3.4" xref="S4.SS2.p4.2.m2.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p4.2.m2.1.1.3.1b" xref="S4.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.2.m2.1.1.3.5" xref="S4.SS2.p4.2.m2.1.1.3.5.cmml">e</mi><mo id="S4.SS2.p4.2.m2.1.1.3.1c" xref="S4.SS2.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.2.m2.1.1.3.6" xref="S4.SS2.p4.2.m2.1.1.3.6.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.2.m2.1b"><apply id="S4.SS2.p4.2.m2.1.1.cmml" xref="S4.SS2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.2.m2.1.1.1.cmml" xref="S4.SS2.p4.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p4.2.m2.1.1.2.cmml" xref="S4.SS2.p4.2.m2.1.1.2">𝑂</ci><apply id="S4.SS2.p4.2.m2.1.1.3.cmml" xref="S4.SS2.p4.2.m2.1.1.3"><times id="S4.SS2.p4.2.m2.1.1.3.1.cmml" xref="S4.SS2.p4.2.m2.1.1.3.1"></times><ci id="S4.SS2.p4.2.m2.1.1.3.2.cmml" xref="S4.SS2.p4.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS2.p4.2.m2.1.1.3.3.cmml" xref="S4.SS2.p4.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS2.p4.2.m2.1.1.3.4.cmml" xref="S4.SS2.p4.2.m2.1.1.3.4">𝑡</ci><ci id="S4.SS2.p4.2.m2.1.1.3.5.cmml" xref="S4.SS2.p4.2.m2.1.1.3.5">𝑒</ci><ci id="S4.SS2.p4.2.m2.1.1.3.6.cmml" xref="S4.SS2.p4.2.m2.1.1.3.6">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.2.m2.1c">O_{inter}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.2.m2.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math>. The main challenge is the spatial misalignment between <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS2.p4.3.m3.1"><semantics id="S4.SS2.p4.3.m3.1a"><msub id="S4.SS2.p4.3.m3.1.1" xref="S4.SS2.p4.3.m3.1.1.cmml"><mi id="S4.SS2.p4.3.m3.1.1.2" xref="S4.SS2.p4.3.m3.1.1.2.cmml">I</mi><mrow id="S4.SS2.p4.3.m3.1.1.3" xref="S4.SS2.p4.3.m3.1.1.3.cmml"><mi id="S4.SS2.p4.3.m3.1.1.3.2" xref="S4.SS2.p4.3.m3.1.1.3.2.cmml">L</mi><mo id="S4.SS2.p4.3.m3.1.1.3.1" xref="S4.SS2.p4.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.3.m3.1.1.3.3" xref="S4.SS2.p4.3.m3.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.3.m3.1b"><apply id="S4.SS2.p4.3.m3.1.1.cmml" xref="S4.SS2.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.3.m3.1.1.1.cmml" xref="S4.SS2.p4.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p4.3.m3.1.1.2.cmml" xref="S4.SS2.p4.3.m3.1.1.2">𝐼</ci><apply id="S4.SS2.p4.3.m3.1.1.3.cmml" xref="S4.SS2.p4.3.m3.1.1.3"><times id="S4.SS2.p4.3.m3.1.1.3.1.cmml" xref="S4.SS2.p4.3.m3.1.1.3.1"></times><ci id="S4.SS2.p4.3.m3.1.1.3.2.cmml" xref="S4.SS2.p4.3.m3.1.1.3.2">𝐿</ci><ci id="S4.SS2.p4.3.m3.1.1.3.3.cmml" xref="S4.SS2.p4.3.m3.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.3.m3.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.3.m3.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS2.p4.4.m4.1"><semantics id="S4.SS2.p4.4.m4.1a"><msub id="S4.SS2.p4.4.m4.1.1" xref="S4.SS2.p4.4.m4.1.1.cmml"><mi id="S4.SS2.p4.4.m4.1.1.2" xref="S4.SS2.p4.4.m4.1.1.2.cmml">𝐈</mi><mi id="S4.SS2.p4.4.m4.1.1.3" xref="S4.SS2.p4.4.m4.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.4.m4.1b"><apply id="S4.SS2.p4.4.m4.1.1.cmml" xref="S4.SS2.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.4.m4.1.1.1.cmml" xref="S4.SS2.p4.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p4.4.m4.1.1.2.cmml" xref="S4.SS2.p4.4.m4.1.1.2">𝐈</ci><ci id="S4.SS2.p4.4.m4.1.1.3.cmml" xref="S4.SS2.p4.4.m4.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.4.m4.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.4.m4.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math>. For instance, the same objects may appear in different locations in <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS2.p4.5.m5.1"><semantics id="S4.SS2.p4.5.m5.1a"><msub id="S4.SS2.p4.5.m5.1.1" xref="S4.SS2.p4.5.m5.1.1.cmml"><mi id="S4.SS2.p4.5.m5.1.1.2" xref="S4.SS2.p4.5.m5.1.1.2.cmml">I</mi><mrow id="S4.SS2.p4.5.m5.1.1.3" xref="S4.SS2.p4.5.m5.1.1.3.cmml"><mi id="S4.SS2.p4.5.m5.1.1.3.2" xref="S4.SS2.p4.5.m5.1.1.3.2.cmml">L</mi><mo id="S4.SS2.p4.5.m5.1.1.3.1" xref="S4.SS2.p4.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.5.m5.1.1.3.3" xref="S4.SS2.p4.5.m5.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.5.m5.1b"><apply id="S4.SS2.p4.5.m5.1.1.cmml" xref="S4.SS2.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.5.m5.1.1.1.cmml" xref="S4.SS2.p4.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.p4.5.m5.1.1.2.cmml" xref="S4.SS2.p4.5.m5.1.1.2">𝐼</ci><apply id="S4.SS2.p4.5.m5.1.1.3.cmml" xref="S4.SS2.p4.5.m5.1.1.3"><times id="S4.SS2.p4.5.m5.1.1.3.1.cmml" xref="S4.SS2.p4.5.m5.1.1.3.1"></times><ci id="S4.SS2.p4.5.m5.1.1.3.2.cmml" xref="S4.SS2.p4.5.m5.1.1.3.2">𝐿</ci><ci id="S4.SS2.p4.5.m5.1.1.3.3.cmml" xref="S4.SS2.p4.5.m5.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.5.m5.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.5.m5.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS2.p4.6.m6.1"><semantics id="S4.SS2.p4.6.m6.1a"><msub id="S4.SS2.p4.6.m6.1.1" xref="S4.SS2.p4.6.m6.1.1.cmml"><mi id="S4.SS2.p4.6.m6.1.1.2" xref="S4.SS2.p4.6.m6.1.1.2.cmml">𝐈</mi><mi id="S4.SS2.p4.6.m6.1.1.3" xref="S4.SS2.p4.6.m6.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.6.m6.1b"><apply id="S4.SS2.p4.6.m6.1.1.cmml" xref="S4.SS2.p4.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.6.m6.1.1.1.cmml" xref="S4.SS2.p4.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p4.6.m6.1.1.2.cmml" xref="S4.SS2.p4.6.m6.1.1.2">𝐈</ci><ci id="S4.SS2.p4.6.m6.1.1.3.cmml" xref="S4.SS2.p4.6.m6.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.6.m6.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.6.m6.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math>, or some objects in <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S4.SS2.p4.7.m7.1"><semantics id="S4.SS2.p4.7.m7.1a"><msub id="S4.SS2.p4.7.m7.1.1" xref="S4.SS2.p4.7.m7.1.1.cmml"><mi id="S4.SS2.p4.7.m7.1.1.2" xref="S4.SS2.p4.7.m7.1.1.2.cmml">I</mi><mrow id="S4.SS2.p4.7.m7.1.1.3" xref="S4.SS2.p4.7.m7.1.1.3.cmml"><mi id="S4.SS2.p4.7.m7.1.1.3.2" xref="S4.SS2.p4.7.m7.1.1.3.2.cmml">L</mi><mo id="S4.SS2.p4.7.m7.1.1.3.1" xref="S4.SS2.p4.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.7.m7.1.1.3.3" xref="S4.SS2.p4.7.m7.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.7.m7.1b"><apply id="S4.SS2.p4.7.m7.1.1.cmml" xref="S4.SS2.p4.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.7.m7.1.1.1.cmml" xref="S4.SS2.p4.7.m7.1.1">subscript</csymbol><ci id="S4.SS2.p4.7.m7.1.1.2.cmml" xref="S4.SS2.p4.7.m7.1.1.2">𝐼</ci><apply id="S4.SS2.p4.7.m7.1.1.3.cmml" xref="S4.SS2.p4.7.m7.1.1.3"><times id="S4.SS2.p4.7.m7.1.1.3.1.cmml" xref="S4.SS2.p4.7.m7.1.1.3.1"></times><ci id="S4.SS2.p4.7.m7.1.1.3.2.cmml" xref="S4.SS2.p4.7.m7.1.1.3.2">𝐿</ci><ci id="S4.SS2.p4.7.m7.1.1.3.3.cmml" xref="S4.SS2.p4.7.m7.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.7.m7.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.7.m7.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> may not present in <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S4.SS2.p4.8.m8.1"><semantics id="S4.SS2.p4.8.m8.1a"><msub id="S4.SS2.p4.8.m8.1.1" xref="S4.SS2.p4.8.m8.1.1.cmml"><mi id="S4.SS2.p4.8.m8.1.1.2" xref="S4.SS2.p4.8.m8.1.1.2.cmml">𝐈</mi><mi id="S4.SS2.p4.8.m8.1.1.3" xref="S4.SS2.p4.8.m8.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.8.m8.1b"><apply id="S4.SS2.p4.8.m8.1.1.cmml" xref="S4.SS2.p4.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.8.m8.1.1.1.cmml" xref="S4.SS2.p4.8.m8.1.1">subscript</csymbol><ci id="S4.SS2.p4.8.m8.1.1.2.cmml" xref="S4.SS2.p4.8.m8.1.1.2">𝐈</ci><ci id="S4.SS2.p4.8.m8.1.1.3.cmml" xref="S4.SS2.p4.8.m8.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.8.m8.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.8.m8.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> and vice versa. As a result, some pixels in <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S4.SS2.p4.9.m9.1"><semantics id="S4.SS2.p4.9.m9.1a"><msub id="S4.SS2.p4.9.m9.1.1" xref="S4.SS2.p4.9.m9.1.1.cmml"><mi id="S4.SS2.p4.9.m9.1.1.2" xref="S4.SS2.p4.9.m9.1.1.2.cmml">Q</mi><mi id="S4.SS2.p4.9.m9.1.1.3" xref="S4.SS2.p4.9.m9.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.9.m9.1b"><apply id="S4.SS2.p4.9.m9.1.1.cmml" xref="S4.SS2.p4.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.9.m9.1.1.1.cmml" xref="S4.SS2.p4.9.m9.1.1">subscript</csymbol><ci id="S4.SS2.p4.9.m9.1.1.2.cmml" xref="S4.SS2.p4.9.m9.1.1.2">𝑄</ci><ci id="S4.SS2.p4.9.m9.1.1.3.cmml" xref="S4.SS2.p4.9.m9.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.9.m9.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.9.m9.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> may not find the corresponding reference in <math alttext="K_{S}" class="ltx_Math" display="inline" id="S4.SS2.p4.10.m10.1"><semantics id="S4.SS2.p4.10.m10.1a"><msub id="S4.SS2.p4.10.m10.1.1" xref="S4.SS2.p4.10.m10.1.1.cmml"><mi id="S4.SS2.p4.10.m10.1.1.2" xref="S4.SS2.p4.10.m10.1.1.2.cmml">K</mi><mi id="S4.SS2.p4.10.m10.1.1.3" xref="S4.SS2.p4.10.m10.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.10.m10.1b"><apply id="S4.SS2.p4.10.m10.1.1.cmml" xref="S4.SS2.p4.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.10.m10.1.1.1.cmml" xref="S4.SS2.p4.10.m10.1.1">subscript</csymbol><ci id="S4.SS2.p4.10.m10.1.1.2.cmml" xref="S4.SS2.p4.10.m10.1.1.2">𝐾</ci><ci id="S4.SS2.p4.10.m10.1.1.3.cmml" xref="S4.SS2.p4.10.m10.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.10.m10.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.10.m10.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, resulting in some pixels in <math alttext="O_{inter}" class="ltx_Math" display="inline" id="S4.SS2.p4.11.m11.1"><semantics id="S4.SS2.p4.11.m11.1a"><msub id="S4.SS2.p4.11.m11.1.1" xref="S4.SS2.p4.11.m11.1.1.cmml"><mi id="S4.SS2.p4.11.m11.1.1.2" xref="S4.SS2.p4.11.m11.1.1.2.cmml">O</mi><mrow id="S4.SS2.p4.11.m11.1.1.3" xref="S4.SS2.p4.11.m11.1.1.3.cmml"><mi id="S4.SS2.p4.11.m11.1.1.3.2" xref="S4.SS2.p4.11.m11.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p4.11.m11.1.1.3.1" xref="S4.SS2.p4.11.m11.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.11.m11.1.1.3.3" xref="S4.SS2.p4.11.m11.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p4.11.m11.1.1.3.1a" xref="S4.SS2.p4.11.m11.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.11.m11.1.1.3.4" xref="S4.SS2.p4.11.m11.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p4.11.m11.1.1.3.1b" xref="S4.SS2.p4.11.m11.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.11.m11.1.1.3.5" xref="S4.SS2.p4.11.m11.1.1.3.5.cmml">e</mi><mo id="S4.SS2.p4.11.m11.1.1.3.1c" xref="S4.SS2.p4.11.m11.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p4.11.m11.1.1.3.6" xref="S4.SS2.p4.11.m11.1.1.3.6.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p4.11.m11.1b"><apply id="S4.SS2.p4.11.m11.1.1.cmml" xref="S4.SS2.p4.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS2.p4.11.m11.1.1.1.cmml" xref="S4.SS2.p4.11.m11.1.1">subscript</csymbol><ci id="S4.SS2.p4.11.m11.1.1.2.cmml" xref="S4.SS2.p4.11.m11.1.1.2">𝑂</ci><apply id="S4.SS2.p4.11.m11.1.1.3.cmml" xref="S4.SS2.p4.11.m11.1.1.3"><times id="S4.SS2.p4.11.m11.1.1.3.1.cmml" xref="S4.SS2.p4.11.m11.1.1.3.1"></times><ci id="S4.SS2.p4.11.m11.1.1.3.2.cmml" xref="S4.SS2.p4.11.m11.1.1.3.2">𝑖</ci><ci id="S4.SS2.p4.11.m11.1.1.3.3.cmml" xref="S4.SS2.p4.11.m11.1.1.3.3">𝑛</ci><ci id="S4.SS2.p4.11.m11.1.1.3.4.cmml" xref="S4.SS2.p4.11.m11.1.1.3.4">𝑡</ci><ci id="S4.SS2.p4.11.m11.1.1.3.5.cmml" xref="S4.SS2.p4.11.m11.1.1.3.5">𝑒</ci><ci id="S4.SS2.p4.11.m11.1.1.3.6.cmml" xref="S4.SS2.p4.11.m11.1.1.3.6">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p4.11.m11.1c">O_{inter}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p4.11.m11.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math> meaningless.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p5">
<p class="ltx_p" id="S4.SS2.p5.22">To address this spatial misalignment, we propose the spatial adaptive gating to selectively fuse <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p5.1.m1.1"><semantics id="S4.SS2.p5.1.m1.1a"><msub id="S4.SS2.p5.1.m1.1.1" xref="S4.SS2.p5.1.m1.1.1.cmml"><mi id="S4.SS2.p5.1.m1.1.1.2" xref="S4.SS2.p5.1.m1.1.1.2.cmml">O</mi><mrow id="S4.SS2.p5.1.m1.1.1.3" xref="S4.SS2.p5.1.m1.1.1.3.cmml"><mi id="S4.SS2.p5.1.m1.1.1.3.2" xref="S4.SS2.p5.1.m1.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p5.1.m1.1.1.3.1" xref="S4.SS2.p5.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.1.m1.1.1.3.3" xref="S4.SS2.p5.1.m1.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p5.1.m1.1.1.3.1a" xref="S4.SS2.p5.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.1.m1.1.1.3.4" xref="S4.SS2.p5.1.m1.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p5.1.m1.1.1.3.1b" xref="S4.SS2.p5.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.1.m1.1.1.3.5" xref="S4.SS2.p5.1.m1.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p5.1.m1.1.1.3.1c" xref="S4.SS2.p5.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.1.m1.1.1.3.6" xref="S4.SS2.p5.1.m1.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.1.m1.1b"><apply id="S4.SS2.p5.1.m1.1.1.cmml" xref="S4.SS2.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.1.m1.1.1.1.cmml" xref="S4.SS2.p5.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p5.1.m1.1.1.2.cmml" xref="S4.SS2.p5.1.m1.1.1.2">𝑂</ci><apply id="S4.SS2.p5.1.m1.1.1.3.cmml" xref="S4.SS2.p5.1.m1.1.1.3"><times id="S4.SS2.p5.1.m1.1.1.3.1.cmml" xref="S4.SS2.p5.1.m1.1.1.3.1"></times><ci id="S4.SS2.p5.1.m1.1.1.3.2.cmml" xref="S4.SS2.p5.1.m1.1.1.3.2">𝑖</ci><ci id="S4.SS2.p5.1.m1.1.1.3.3.cmml" xref="S4.SS2.p5.1.m1.1.1.3.3">𝑛</ci><ci id="S4.SS2.p5.1.m1.1.1.3.4.cmml" xref="S4.SS2.p5.1.m1.1.1.3.4">𝑡</ci><ci id="S4.SS2.p5.1.m1.1.1.3.5.cmml" xref="S4.SS2.p5.1.m1.1.1.3.5">𝑟</ci><ci id="S4.SS2.p5.1.m1.1.1.3.6.cmml" xref="S4.SS2.p5.1.m1.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.1.m1.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="O_{inter}" class="ltx_Math" display="inline" id="S4.SS2.p5.2.m2.1"><semantics id="S4.SS2.p5.2.m2.1a"><msub id="S4.SS2.p5.2.m2.1.1" xref="S4.SS2.p5.2.m2.1.1.cmml"><mi id="S4.SS2.p5.2.m2.1.1.2" xref="S4.SS2.p5.2.m2.1.1.2.cmml">O</mi><mrow id="S4.SS2.p5.2.m2.1.1.3" xref="S4.SS2.p5.2.m2.1.1.3.cmml"><mi id="S4.SS2.p5.2.m2.1.1.3.2" xref="S4.SS2.p5.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p5.2.m2.1.1.3.1" xref="S4.SS2.p5.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.2.m2.1.1.3.3" xref="S4.SS2.p5.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p5.2.m2.1.1.3.1a" xref="S4.SS2.p5.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.2.m2.1.1.3.4" xref="S4.SS2.p5.2.m2.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p5.2.m2.1.1.3.1b" xref="S4.SS2.p5.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.2.m2.1.1.3.5" xref="S4.SS2.p5.2.m2.1.1.3.5.cmml">e</mi><mo id="S4.SS2.p5.2.m2.1.1.3.1c" xref="S4.SS2.p5.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.2.m2.1.1.3.6" xref="S4.SS2.p5.2.m2.1.1.3.6.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.2.m2.1b"><apply id="S4.SS2.p5.2.m2.1.1.cmml" xref="S4.SS2.p5.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.2.m2.1.1.1.cmml" xref="S4.SS2.p5.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p5.2.m2.1.1.2.cmml" xref="S4.SS2.p5.2.m2.1.1.2">𝑂</ci><apply id="S4.SS2.p5.2.m2.1.1.3.cmml" xref="S4.SS2.p5.2.m2.1.1.3"><times id="S4.SS2.p5.2.m2.1.1.3.1.cmml" xref="S4.SS2.p5.2.m2.1.1.3.1"></times><ci id="S4.SS2.p5.2.m2.1.1.3.2.cmml" xref="S4.SS2.p5.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS2.p5.2.m2.1.1.3.3.cmml" xref="S4.SS2.p5.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS2.p5.2.m2.1.1.3.4.cmml" xref="S4.SS2.p5.2.m2.1.1.3.4">𝑡</ci><ci id="S4.SS2.p5.2.m2.1.1.3.5.cmml" xref="S4.SS2.p5.2.m2.1.1.3.5">𝑒</ci><ci id="S4.SS2.p5.2.m2.1.1.3.6.cmml" xref="S4.SS2.p5.2.m2.1.1.3.6">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.2.m2.1c">O_{inter}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.2.m2.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math> without introducing additional parameters (<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.F4" title="In 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">4</span></a>(b)). Specifically, given latents at specific denoising blocks from <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p5.3.m3.1"><semantics id="S4.SS2.p5.3.m3.1a"><msub id="S4.SS2.p5.3.m3.1.1" xref="S4.SS2.p5.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p5.3.m3.1.1.2" xref="S4.SS2.p5.3.m3.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p5.3.m3.1.1.3" xref="S4.SS2.p5.3.m3.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.3.m3.1b"><apply id="S4.SS2.p5.3.m3.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.3.m3.1.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p5.3.m3.1.1.2.cmml" xref="S4.SS2.p5.3.m3.1.1.2">𝒞</ci><ci id="S4.SS2.p5.3.m3.1.1.3.cmml" xref="S4.SS2.p5.3.m3.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.3.m3.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p5.4.m4.1"><semantics id="S4.SS2.p5.4.m4.1a"><msub id="S4.SS2.p5.4.m4.1.1" xref="S4.SS2.p5.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p5.4.m4.1.1.2" xref="S4.SS2.p5.4.m4.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p5.4.m4.1.1.3" xref="S4.SS2.p5.4.m4.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.4.m4.1b"><apply id="S4.SS2.p5.4.m4.1.1.cmml" xref="S4.SS2.p5.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.4.m4.1.1.1.cmml" xref="S4.SS2.p5.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p5.4.m4.1.1.2.cmml" xref="S4.SS2.p5.4.m4.1.1.2">𝒞</ci><ci id="S4.SS2.p5.4.m4.1.1.3.cmml" xref="S4.SS2.p5.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.4.m4.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>, respectively, we first flatten them along the spatial dimension to obtain <math alttext="\mathbf{h_{T}},\mathbf{h_{S}}\in\mathbb{R}^{C\times HW}" class="ltx_Math" display="inline" id="S4.SS2.p5.5.m5.2"><semantics id="S4.SS2.p5.5.m5.2a"><mrow id="S4.SS2.p5.5.m5.2.2" xref="S4.SS2.p5.5.m5.2.2.cmml"><mrow id="S4.SS2.p5.5.m5.2.2.2.2" xref="S4.SS2.p5.5.m5.2.2.2.3.cmml"><msub id="S4.SS2.p5.5.m5.1.1.1.1.1" xref="S4.SS2.p5.5.m5.1.1.1.1.1.cmml"><mi id="S4.SS2.p5.5.m5.1.1.1.1.1.2" xref="S4.SS2.p5.5.m5.1.1.1.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.5.m5.1.1.1.1.1.3" xref="S4.SS2.p5.5.m5.1.1.1.1.1.3.cmml">𝐓</mi></msub><mo id="S4.SS2.p5.5.m5.2.2.2.2.3" xref="S4.SS2.p5.5.m5.2.2.2.3.cmml">,</mo><msub id="S4.SS2.p5.5.m5.2.2.2.2.2" xref="S4.SS2.p5.5.m5.2.2.2.2.2.cmml"><mi id="S4.SS2.p5.5.m5.2.2.2.2.2.2" xref="S4.SS2.p5.5.m5.2.2.2.2.2.2.cmml">𝐡</mi><mi id="S4.SS2.p5.5.m5.2.2.2.2.2.3" xref="S4.SS2.p5.5.m5.2.2.2.2.2.3.cmml">𝐒</mi></msub></mrow><mo id="S4.SS2.p5.5.m5.2.2.3" xref="S4.SS2.p5.5.m5.2.2.3.cmml">∈</mo><msup id="S4.SS2.p5.5.m5.2.2.4" xref="S4.SS2.p5.5.m5.2.2.4.cmml"><mi id="S4.SS2.p5.5.m5.2.2.4.2" xref="S4.SS2.p5.5.m5.2.2.4.2.cmml">ℝ</mi><mrow id="S4.SS2.p5.5.m5.2.2.4.3" xref="S4.SS2.p5.5.m5.2.2.4.3.cmml"><mrow id="S4.SS2.p5.5.m5.2.2.4.3.2" xref="S4.SS2.p5.5.m5.2.2.4.3.2.cmml"><mi id="S4.SS2.p5.5.m5.2.2.4.3.2.2" xref="S4.SS2.p5.5.m5.2.2.4.3.2.2.cmml">C</mi><mo id="S4.SS2.p5.5.m5.2.2.4.3.2.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p5.5.m5.2.2.4.3.2.1.cmml">×</mo><mi id="S4.SS2.p5.5.m5.2.2.4.3.2.3" xref="S4.SS2.p5.5.m5.2.2.4.3.2.3.cmml">H</mi></mrow><mo id="S4.SS2.p5.5.m5.2.2.4.3.1" xref="S4.SS2.p5.5.m5.2.2.4.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.5.m5.2.2.4.3.3" xref="S4.SS2.p5.5.m5.2.2.4.3.3.cmml">W</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.5.m5.2b"><apply id="S4.SS2.p5.5.m5.2.2.cmml" xref="S4.SS2.p5.5.m5.2.2"><in id="S4.SS2.p5.5.m5.2.2.3.cmml" xref="S4.SS2.p5.5.m5.2.2.3"></in><list id="S4.SS2.p5.5.m5.2.2.2.3.cmml" xref="S4.SS2.p5.5.m5.2.2.2.2"><apply id="S4.SS2.p5.5.m5.1.1.1.1.1.cmml" xref="S4.SS2.p5.5.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.5.m5.1.1.1.1.1.1.cmml" xref="S4.SS2.p5.5.m5.1.1.1.1.1">subscript</csymbol><ci id="S4.SS2.p5.5.m5.1.1.1.1.1.2.cmml" xref="S4.SS2.p5.5.m5.1.1.1.1.1.2">𝐡</ci><ci id="S4.SS2.p5.5.m5.1.1.1.1.1.3.cmml" xref="S4.SS2.p5.5.m5.1.1.1.1.1.3">𝐓</ci></apply><apply id="S4.SS2.p5.5.m5.2.2.2.2.2.cmml" xref="S4.SS2.p5.5.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.SS2.p5.5.m5.2.2.2.2.2.1.cmml" xref="S4.SS2.p5.5.m5.2.2.2.2.2">subscript</csymbol><ci id="S4.SS2.p5.5.m5.2.2.2.2.2.2.cmml" xref="S4.SS2.p5.5.m5.2.2.2.2.2.2">𝐡</ci><ci id="S4.SS2.p5.5.m5.2.2.2.2.2.3.cmml" xref="S4.SS2.p5.5.m5.2.2.2.2.2.3">𝐒</ci></apply></list><apply id="S4.SS2.p5.5.m5.2.2.4.cmml" xref="S4.SS2.p5.5.m5.2.2.4"><csymbol cd="ambiguous" id="S4.SS2.p5.5.m5.2.2.4.1.cmml" xref="S4.SS2.p5.5.m5.2.2.4">superscript</csymbol><ci id="S4.SS2.p5.5.m5.2.2.4.2.cmml" xref="S4.SS2.p5.5.m5.2.2.4.2">ℝ</ci><apply id="S4.SS2.p5.5.m5.2.2.4.3.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3"><times id="S4.SS2.p5.5.m5.2.2.4.3.1.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.1"></times><apply id="S4.SS2.p5.5.m5.2.2.4.3.2.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.2"><times id="S4.SS2.p5.5.m5.2.2.4.3.2.1.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.2.1"></times><ci id="S4.SS2.p5.5.m5.2.2.4.3.2.2.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.2.2">𝐶</ci><ci id="S4.SS2.p5.5.m5.2.2.4.3.2.3.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.2.3">𝐻</ci></apply><ci id="S4.SS2.p5.5.m5.2.2.4.3.3.cmml" xref="S4.SS2.p5.5.m5.2.2.4.3.3">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.5.m5.2c">\mathbf{h_{T}},\mathbf{h_{S}}\in\mathbb{R}^{C\times HW}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.5.m5.2d">bold_h start_POSTSUBSCRIPT bold_T end_POSTSUBSCRIPT , bold_h start_POSTSUBSCRIPT bold_S end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_C × italic_H italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>. Next, we compute their pixel-wise cosine similarity to obtain the similarity matrix <math alttext="\mathrm{sim}\in\mathbb{R}^{HW\times HW}" class="ltx_Math" display="inline" id="S4.SS2.p5.6.m6.1"><semantics id="S4.SS2.p5.6.m6.1a"><mrow id="S4.SS2.p5.6.m6.1.1" xref="S4.SS2.p5.6.m6.1.1.cmml"><mi id="S4.SS2.p5.6.m6.1.1.2" xref="S4.SS2.p5.6.m6.1.1.2.cmml">sim</mi><mo id="S4.SS2.p5.6.m6.1.1.1" xref="S4.SS2.p5.6.m6.1.1.1.cmml">∈</mo><msup id="S4.SS2.p5.6.m6.1.1.3" xref="S4.SS2.p5.6.m6.1.1.3.cmml"><mi id="S4.SS2.p5.6.m6.1.1.3.2" xref="S4.SS2.p5.6.m6.1.1.3.2.cmml">ℝ</mi><mrow id="S4.SS2.p5.6.m6.1.1.3.3" xref="S4.SS2.p5.6.m6.1.1.3.3.cmml"><mrow id="S4.SS2.p5.6.m6.1.1.3.3.2" xref="S4.SS2.p5.6.m6.1.1.3.3.2.cmml"><mrow id="S4.SS2.p5.6.m6.1.1.3.3.2.2" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.cmml"><mi id="S4.SS2.p5.6.m6.1.1.3.3.2.2.2" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.2.cmml">H</mi><mo id="S4.SS2.p5.6.m6.1.1.3.3.2.2.1" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.1.cmml">⁢</mo><mi id="S4.SS2.p5.6.m6.1.1.3.3.2.2.3" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.3.cmml">W</mi></mrow><mo id="S4.SS2.p5.6.m6.1.1.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p5.6.m6.1.1.3.3.2.1.cmml">×</mo><mi id="S4.SS2.p5.6.m6.1.1.3.3.2.3" xref="S4.SS2.p5.6.m6.1.1.3.3.2.3.cmml">H</mi></mrow><mo id="S4.SS2.p5.6.m6.1.1.3.3.1" xref="S4.SS2.p5.6.m6.1.1.3.3.1.cmml">⁢</mo><mi id="S4.SS2.p5.6.m6.1.1.3.3.3" xref="S4.SS2.p5.6.m6.1.1.3.3.3.cmml">W</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.6.m6.1b"><apply id="S4.SS2.p5.6.m6.1.1.cmml" xref="S4.SS2.p5.6.m6.1.1"><in id="S4.SS2.p5.6.m6.1.1.1.cmml" xref="S4.SS2.p5.6.m6.1.1.1"></in><ci id="S4.SS2.p5.6.m6.1.1.2.cmml" xref="S4.SS2.p5.6.m6.1.1.2">sim</ci><apply id="S4.SS2.p5.6.m6.1.1.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.p5.6.m6.1.1.3.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3">superscript</csymbol><ci id="S4.SS2.p5.6.m6.1.1.3.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.2">ℝ</ci><apply id="S4.SS2.p5.6.m6.1.1.3.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3"><times id="S4.SS2.p5.6.m6.1.1.3.3.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.1"></times><apply id="S4.SS2.p5.6.m6.1.1.3.3.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2"><times id="S4.SS2.p5.6.m6.1.1.3.3.2.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.1"></times><apply id="S4.SS2.p5.6.m6.1.1.3.3.2.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2"><times id="S4.SS2.p5.6.m6.1.1.3.3.2.2.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.1"></times><ci id="S4.SS2.p5.6.m6.1.1.3.3.2.2.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.2">𝐻</ci><ci id="S4.SS2.p5.6.m6.1.1.3.3.2.2.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.2.3">𝑊</ci></apply><ci id="S4.SS2.p5.6.m6.1.1.3.3.2.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2.3">𝐻</ci></apply><ci id="S4.SS2.p5.6.m6.1.1.3.3.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.3">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.6.m6.1c">\mathrm{sim}\in\mathbb{R}^{HW\times HW}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.6.m6.1d">roman_sim ∈ blackboard_R start_POSTSUPERSCRIPT italic_H italic_W × italic_H italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>. Since the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.7.m7.1"><semantics id="S4.SS2.p5.7.m7.1a"><mi id="S4.SS2.p5.7.m7.1.1" xref="S4.SS2.p5.7.m7.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.7.m7.1b"><ci id="S4.SS2.p5.7.m7.1.1.cmml" xref="S4.SS2.p5.7.m7.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.7.m7.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.7.m7.1d">italic_i</annotation></semantics></math>-th row of <math alttext="\mathrm{sim}" class="ltx_Math" display="inline" id="S4.SS2.p5.8.m8.1"><semantics id="S4.SS2.p5.8.m8.1a"><mi id="S4.SS2.p5.8.m8.1.1" xref="S4.SS2.p5.8.m8.1.1.cmml">sim</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.8.m8.1b"><ci id="S4.SS2.p5.8.m8.1.1.cmml" xref="S4.SS2.p5.8.m8.1.1">sim</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.8.m8.1c">\mathrm{sim}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.8.m8.1d">roman_sim</annotation></semantics></math> represents the similarity of the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.9.m9.1"><semantics id="S4.SS2.p5.9.m9.1a"><mi id="S4.SS2.p5.9.m9.1.1" xref="S4.SS2.p5.9.m9.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.9.m9.1b"><ci id="S4.SS2.p5.9.m9.1.1.cmml" xref="S4.SS2.p5.9.m9.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.9.m9.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.9.m9.1d">italic_i</annotation></semantics></math>-th pixel in <math alttext="\mathbf{h_{T}}" class="ltx_Math" display="inline" id="S4.SS2.p5.10.m10.1"><semantics id="S4.SS2.p5.10.m10.1a"><msub id="S4.SS2.p5.10.m10.1.1" xref="S4.SS2.p5.10.m10.1.1.cmml"><mi id="S4.SS2.p5.10.m10.1.1.2" xref="S4.SS2.p5.10.m10.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.10.m10.1.1.3" xref="S4.SS2.p5.10.m10.1.1.3.cmml">𝐓</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.10.m10.1b"><apply id="S4.SS2.p5.10.m10.1.1.cmml" xref="S4.SS2.p5.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.10.m10.1.1.1.cmml" xref="S4.SS2.p5.10.m10.1.1">subscript</csymbol><ci id="S4.SS2.p5.10.m10.1.1.2.cmml" xref="S4.SS2.p5.10.m10.1.1.2">𝐡</ci><ci id="S4.SS2.p5.10.m10.1.1.3.cmml" xref="S4.SS2.p5.10.m10.1.1.3">𝐓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.10.m10.1c">\mathbf{h_{T}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.10.m10.1d">bold_h start_POSTSUBSCRIPT bold_T end_POSTSUBSCRIPT</annotation></semantics></math> to all the pixels in <math alttext="\mathbf{h_{S}}" class="ltx_Math" display="inline" id="S4.SS2.p5.11.m11.1"><semantics id="S4.SS2.p5.11.m11.1a"><msub id="S4.SS2.p5.11.m11.1.1" xref="S4.SS2.p5.11.m11.1.1.cmml"><mi id="S4.SS2.p5.11.m11.1.1.2" xref="S4.SS2.p5.11.m11.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.11.m11.1.1.3" xref="S4.SS2.p5.11.m11.1.1.3.cmml">𝐒</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.11.m11.1b"><apply id="S4.SS2.p5.11.m11.1.1.cmml" xref="S4.SS2.p5.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.11.m11.1.1.1.cmml" xref="S4.SS2.p5.11.m11.1.1">subscript</csymbol><ci id="S4.SS2.p5.11.m11.1.1.2.cmml" xref="S4.SS2.p5.11.m11.1.1.2">𝐡</ci><ci id="S4.SS2.p5.11.m11.1.1.3.cmml" xref="S4.SS2.p5.11.m11.1.1.3">𝐒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.11.m11.1c">\mathbf{h_{S}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.11.m11.1d">bold_h start_POSTSUBSCRIPT bold_S end_POSTSUBSCRIPT</annotation></semantics></math>, therefore, a large sum of the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.12.m12.1"><semantics id="S4.SS2.p5.12.m12.1a"><mi id="S4.SS2.p5.12.m12.1.1" xref="S4.SS2.p5.12.m12.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.12.m12.1b"><ci id="S4.SS2.p5.12.m12.1.1.cmml" xref="S4.SS2.p5.12.m12.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.12.m12.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.12.m12.1d">italic_i</annotation></semantics></math>-th row indicates a large impact of <math alttext="\mathbf{h_{S}}" class="ltx_Math" display="inline" id="S4.SS2.p5.13.m13.1"><semantics id="S4.SS2.p5.13.m13.1a"><msub id="S4.SS2.p5.13.m13.1.1" xref="S4.SS2.p5.13.m13.1.1.cmml"><mi id="S4.SS2.p5.13.m13.1.1.2" xref="S4.SS2.p5.13.m13.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.13.m13.1.1.3" xref="S4.SS2.p5.13.m13.1.1.3.cmml">𝐒</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.13.m13.1b"><apply id="S4.SS2.p5.13.m13.1.1.cmml" xref="S4.SS2.p5.13.m13.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.13.m13.1.1.1.cmml" xref="S4.SS2.p5.13.m13.1.1">subscript</csymbol><ci id="S4.SS2.p5.13.m13.1.1.2.cmml" xref="S4.SS2.p5.13.m13.1.1.2">𝐡</ci><ci id="S4.SS2.p5.13.m13.1.1.3.cmml" xref="S4.SS2.p5.13.m13.1.1.3">𝐒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.13.m13.1c">\mathbf{h_{S}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.13.m13.1d">bold_h start_POSTSUBSCRIPT bold_S end_POSTSUBSCRIPT</annotation></semantics></math> in restoring the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.14.m14.1"><semantics id="S4.SS2.p5.14.m14.1a"><mi id="S4.SS2.p5.14.m14.1.1" xref="S4.SS2.p5.14.m14.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.14.m14.1b"><ci id="S4.SS2.p5.14.m14.1.1.cmml" xref="S4.SS2.p5.14.m14.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.14.m14.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.14.m14.1d">italic_i</annotation></semantics></math>-th pixel of <math alttext="\mathbf{h_{T}}" class="ltx_Math" display="inline" id="S4.SS2.p5.15.m15.1"><semantics id="S4.SS2.p5.15.m15.1a"><msub id="S4.SS2.p5.15.m15.1.1" xref="S4.SS2.p5.15.m15.1.1.cmml"><mi id="S4.SS2.p5.15.m15.1.1.2" xref="S4.SS2.p5.15.m15.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.15.m15.1.1.3" xref="S4.SS2.p5.15.m15.1.1.3.cmml">𝐓</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.15.m15.1b"><apply id="S4.SS2.p5.15.m15.1.1.cmml" xref="S4.SS2.p5.15.m15.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.15.m15.1.1.1.cmml" xref="S4.SS2.p5.15.m15.1.1">subscript</csymbol><ci id="S4.SS2.p5.15.m15.1.1.2.cmml" xref="S4.SS2.p5.15.m15.1.1.2">𝐡</ci><ci id="S4.SS2.p5.15.m15.1.1.3.cmml" xref="S4.SS2.p5.15.m15.1.1.3">𝐓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.15.m15.1c">\mathbf{h_{T}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.15.m15.1d">bold_h start_POSTSUBSCRIPT bold_T end_POSTSUBSCRIPT</annotation></semantics></math>. Following this idea, we summation over the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.16.m16.1"><semantics id="S4.SS2.p5.16.m16.1a"><mi id="S4.SS2.p5.16.m16.1.1" xref="S4.SS2.p5.16.m16.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.16.m16.1b"><ci id="S4.SS2.p5.16.m16.1.1.cmml" xref="S4.SS2.p5.16.m16.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.16.m16.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.16.m16.1d">italic_i</annotation></semantics></math>-th row of the <math alttext="\mathrm{sim}" class="ltx_Math" display="inline" id="S4.SS2.p5.17.m17.1"><semantics id="S4.SS2.p5.17.m17.1a"><mi id="S4.SS2.p5.17.m17.1.1" xref="S4.SS2.p5.17.m17.1.1.cmml">sim</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.17.m17.1b"><ci id="S4.SS2.p5.17.m17.1.1.cmml" xref="S4.SS2.p5.17.m17.1.1">sim</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.17.m17.1c">\mathrm{sim}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.17.m17.1d">roman_sim</annotation></semantics></math> to approximate the utility of <math alttext="\mathbf{h_{S}}" class="ltx_Math" display="inline" id="S4.SS2.p5.18.m18.1"><semantics id="S4.SS2.p5.18.m18.1a"><msub id="S4.SS2.p5.18.m18.1.1" xref="S4.SS2.p5.18.m18.1.1.cmml"><mi id="S4.SS2.p5.18.m18.1.1.2" xref="S4.SS2.p5.18.m18.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.18.m18.1.1.3" xref="S4.SS2.p5.18.m18.1.1.3.cmml">𝐒</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.18.m18.1b"><apply id="S4.SS2.p5.18.m18.1.1.cmml" xref="S4.SS2.p5.18.m18.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.18.m18.1.1.1.cmml" xref="S4.SS2.p5.18.m18.1.1">subscript</csymbol><ci id="S4.SS2.p5.18.m18.1.1.2.cmml" xref="S4.SS2.p5.18.m18.1.1.2">𝐡</ci><ci id="S4.SS2.p5.18.m18.1.1.3.cmml" xref="S4.SS2.p5.18.m18.1.1.3">𝐒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.18.m18.1c">\mathbf{h_{S}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.18.m18.1d">bold_h start_POSTSUBSCRIPT bold_S end_POSTSUBSCRIPT</annotation></semantics></math> to the <math alttext="i" class="ltx_Math" display="inline" id="S4.SS2.p5.19.m19.1"><semantics id="S4.SS2.p5.19.m19.1a"><mi id="S4.SS2.p5.19.m19.1.1" xref="S4.SS2.p5.19.m19.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.19.m19.1b"><ci id="S4.SS2.p5.19.m19.1.1.cmml" xref="S4.SS2.p5.19.m19.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.19.m19.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.19.m19.1d">italic_i</annotation></semantics></math>-th pixel of <math alttext="\mathbf{h_{T}}" class="ltx_Math" display="inline" id="S4.SS2.p5.20.m20.1"><semantics id="S4.SS2.p5.20.m20.1a"><msub id="S4.SS2.p5.20.m20.1.1" xref="S4.SS2.p5.20.m20.1.1.cmml"><mi id="S4.SS2.p5.20.m20.1.1.2" xref="S4.SS2.p5.20.m20.1.1.2.cmml">𝐡</mi><mi id="S4.SS2.p5.20.m20.1.1.3" xref="S4.SS2.p5.20.m20.1.1.3.cmml">𝐓</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.20.m20.1b"><apply id="S4.SS2.p5.20.m20.1.1.cmml" xref="S4.SS2.p5.20.m20.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.20.m20.1.1.1.cmml" xref="S4.SS2.p5.20.m20.1.1">subscript</csymbol><ci id="S4.SS2.p5.20.m20.1.1.2.cmml" xref="S4.SS2.p5.20.m20.1.1.2">𝐡</ci><ci id="S4.SS2.p5.20.m20.1.1.3.cmml" xref="S4.SS2.p5.20.m20.1.1.3">𝐓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.20.m20.1c">\mathbf{h_{T}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.20.m20.1d">bold_h start_POSTSUBSCRIPT bold_T end_POSTSUBSCRIPT</annotation></semantics></math>. Finally, we reshape this summation results back to 2D shape and use min-max normalization to restrict the range to <math alttext="[0,1]" class="ltx_Math" display="inline" id="S4.SS2.p5.21.m21.2"><semantics id="S4.SS2.p5.21.m21.2a"><mrow id="S4.SS2.p5.21.m21.2.3.2" xref="S4.SS2.p5.21.m21.2.3.1.cmml"><mo id="S4.SS2.p5.21.m21.2.3.2.1" stretchy="false" xref="S4.SS2.p5.21.m21.2.3.1.cmml">[</mo><mn id="S4.SS2.p5.21.m21.1.1" xref="S4.SS2.p5.21.m21.1.1.cmml">0</mn><mo id="S4.SS2.p5.21.m21.2.3.2.2" xref="S4.SS2.p5.21.m21.2.3.1.cmml">,</mo><mn id="S4.SS2.p5.21.m21.2.2" xref="S4.SS2.p5.21.m21.2.2.cmml">1</mn><mo id="S4.SS2.p5.21.m21.2.3.2.3" stretchy="false" xref="S4.SS2.p5.21.m21.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.21.m21.2b"><interval closure="closed" id="S4.SS2.p5.21.m21.2.3.1.cmml" xref="S4.SS2.p5.21.m21.2.3.2"><cn id="S4.SS2.p5.21.m21.1.1.cmml" type="integer" xref="S4.SS2.p5.21.m21.1.1">0</cn><cn id="S4.SS2.p5.21.m21.2.2.cmml" type="integer" xref="S4.SS2.p5.21.m21.2.2">1</cn></interval></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.21.m21.2c">[0,1]</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.21.m21.2d">[ 0 , 1 ]</annotation></semantics></math>, to get the pixel-wise mask <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS2.p5.22.m22.1"><semantics id="S4.SS2.p5.22.m22.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p5.22.m22.1.1" xref="S4.SS2.p5.22.m22.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.22.m22.1b"><ci id="S4.SS2.p5.22.m22.1.1.cmml" xref="S4.SS2.p5.22.m22.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.22.m22.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.22.m22.1d">caligraphic_M</annotation></semantics></math> for adaptive gated fusion:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="O_{fuse}=(\mathbf{1}-s\mathcal{M})\otimes O_{intra}+s\mathcal{M}\otimes O_{%
inter}," class="ltx_Math" display="block" id="S4.E2.m1.1"><semantics id="S4.E2.m1.1a"><mrow id="S4.E2.m1.1.1.1" xref="S4.E2.m1.1.1.1.1.cmml"><mrow id="S4.E2.m1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.cmml"><msub id="S4.E2.m1.1.1.1.1.3" xref="S4.E2.m1.1.1.1.1.3.cmml"><mi id="S4.E2.m1.1.1.1.1.3.2" xref="S4.E2.m1.1.1.1.1.3.2.cmml">O</mi><mrow id="S4.E2.m1.1.1.1.1.3.3" xref="S4.E2.m1.1.1.1.1.3.3.cmml"><mi id="S4.E2.m1.1.1.1.1.3.3.2" xref="S4.E2.m1.1.1.1.1.3.3.2.cmml">f</mi><mo id="S4.E2.m1.1.1.1.1.3.3.1" xref="S4.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.3.3.3" xref="S4.E2.m1.1.1.1.1.3.3.3.cmml">u</mi><mo id="S4.E2.m1.1.1.1.1.3.3.1a" xref="S4.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.3.3.4" xref="S4.E2.m1.1.1.1.1.3.3.4.cmml">s</mi><mo id="S4.E2.m1.1.1.1.1.3.3.1b" xref="S4.E2.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.3.3.5" xref="S4.E2.m1.1.1.1.1.3.3.5.cmml">e</mi></mrow></msub><mo id="S4.E2.m1.1.1.1.1.2" xref="S4.E2.m1.1.1.1.1.2.cmml">=</mo><mrow id="S4.E2.m1.1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.1.cmml"><mrow id="S4.E2.m1.1.1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.1.1.cmml"><mrow id="S4.E2.m1.1.1.1.1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S4.E2.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E2.m1.1.1.1.1.1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.cmml"><mn id="S4.E2.m1.1.1.1.1.1.1.1.1.1.2" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.2.cmml">𝟏</mn><mo id="S4.E2.m1.1.1.1.1.1.1.1.1.1.1" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml">−</mo><mrow id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.2" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.2.cmml">s</mi><mo id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.1" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.3" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.3.cmml">ℳ</mi></mrow></mrow><mo id="S4.E2.m1.1.1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S4.E2.m1.1.1.1.1.1.1.2" rspace="0.222em" xref="S4.E2.m1.1.1.1.1.1.1.2.cmml">⊗</mo><msub id="S4.E2.m1.1.1.1.1.1.1.3" xref="S4.E2.m1.1.1.1.1.1.1.3.cmml"><mi id="S4.E2.m1.1.1.1.1.1.1.3.2" xref="S4.E2.m1.1.1.1.1.1.1.3.2.cmml">O</mi><mrow id="S4.E2.m1.1.1.1.1.1.1.3.3" xref="S4.E2.m1.1.1.1.1.1.1.3.3.cmml"><mi id="S4.E2.m1.1.1.1.1.1.1.3.3.2" xref="S4.E2.m1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="S4.E2.m1.1.1.1.1.1.1.3.3.1" xref="S4.E2.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.1.3.3.3" xref="S4.E2.m1.1.1.1.1.1.1.3.3.3.cmml">n</mi><mo id="S4.E2.m1.1.1.1.1.1.1.3.3.1a" xref="S4.E2.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.1.3.3.4" xref="S4.E2.m1.1.1.1.1.1.1.3.3.4.cmml">t</mi><mo id="S4.E2.m1.1.1.1.1.1.1.3.3.1b" xref="S4.E2.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.1.3.3.5" xref="S4.E2.m1.1.1.1.1.1.1.3.3.5.cmml">r</mi><mo id="S4.E2.m1.1.1.1.1.1.1.3.3.1c" xref="S4.E2.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.1.3.3.6" xref="S4.E2.m1.1.1.1.1.1.1.3.3.6.cmml">a</mi></mrow></msub></mrow><mo id="S4.E2.m1.1.1.1.1.1.2" xref="S4.E2.m1.1.1.1.1.1.2.cmml">+</mo><mrow id="S4.E2.m1.1.1.1.1.1.3" xref="S4.E2.m1.1.1.1.1.1.3.cmml"><mrow id="S4.E2.m1.1.1.1.1.1.3.2" xref="S4.E2.m1.1.1.1.1.1.3.2.cmml"><mi id="S4.E2.m1.1.1.1.1.1.3.2.2" xref="S4.E2.m1.1.1.1.1.1.3.2.2.cmml">s</mi><mo id="S4.E2.m1.1.1.1.1.1.3.2.1" xref="S4.E2.m1.1.1.1.1.1.3.2.1.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S4.E2.m1.1.1.1.1.1.3.2.3" xref="S4.E2.m1.1.1.1.1.1.3.2.3.cmml">ℳ</mi></mrow><mo id="S4.E2.m1.1.1.1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S4.E2.m1.1.1.1.1.1.3.1.cmml">⊗</mo><msub id="S4.E2.m1.1.1.1.1.1.3.3" xref="S4.E2.m1.1.1.1.1.1.3.3.cmml"><mi id="S4.E2.m1.1.1.1.1.1.3.3.2" xref="S4.E2.m1.1.1.1.1.1.3.3.2.cmml">O</mi><mrow id="S4.E2.m1.1.1.1.1.1.3.3.3" xref="S4.E2.m1.1.1.1.1.1.3.3.3.cmml"><mi id="S4.E2.m1.1.1.1.1.1.3.3.3.2" xref="S4.E2.m1.1.1.1.1.1.3.3.3.2.cmml">i</mi><mo id="S4.E2.m1.1.1.1.1.1.3.3.3.1" xref="S4.E2.m1.1.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.3.3.3.3" xref="S4.E2.m1.1.1.1.1.1.3.3.3.3.cmml">n</mi><mo id="S4.E2.m1.1.1.1.1.1.3.3.3.1a" xref="S4.E2.m1.1.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.3.3.3.4" xref="S4.E2.m1.1.1.1.1.1.3.3.3.4.cmml">t</mi><mo id="S4.E2.m1.1.1.1.1.1.3.3.3.1b" xref="S4.E2.m1.1.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.3.3.3.5" xref="S4.E2.m1.1.1.1.1.1.3.3.3.5.cmml">e</mi><mo id="S4.E2.m1.1.1.1.1.1.3.3.3.1c" xref="S4.E2.m1.1.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S4.E2.m1.1.1.1.1.1.3.3.3.6" xref="S4.E2.m1.1.1.1.1.1.3.3.3.6.cmml">r</mi></mrow></msub></mrow></mrow></mrow><mo id="S4.E2.m1.1.1.1.2" xref="S4.E2.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E2.m1.1b"><apply id="S4.E2.m1.1.1.1.1.cmml" xref="S4.E2.m1.1.1.1"><eq id="S4.E2.m1.1.1.1.1.2.cmml" xref="S4.E2.m1.1.1.1.1.2"></eq><apply id="S4.E2.m1.1.1.1.1.3.cmml" xref="S4.E2.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E2.m1.1.1.1.1.3.1.cmml" xref="S4.E2.m1.1.1.1.1.3">subscript</csymbol><ci id="S4.E2.m1.1.1.1.1.3.2.cmml" xref="S4.E2.m1.1.1.1.1.3.2">𝑂</ci><apply id="S4.E2.m1.1.1.1.1.3.3.cmml" xref="S4.E2.m1.1.1.1.1.3.3"><times id="S4.E2.m1.1.1.1.1.3.3.1.cmml" xref="S4.E2.m1.1.1.1.1.3.3.1"></times><ci id="S4.E2.m1.1.1.1.1.3.3.2.cmml" xref="S4.E2.m1.1.1.1.1.3.3.2">𝑓</ci><ci id="S4.E2.m1.1.1.1.1.3.3.3.cmml" xref="S4.E2.m1.1.1.1.1.3.3.3">𝑢</ci><ci id="S4.E2.m1.1.1.1.1.3.3.4.cmml" xref="S4.E2.m1.1.1.1.1.3.3.4">𝑠</ci><ci id="S4.E2.m1.1.1.1.1.3.3.5.cmml" xref="S4.E2.m1.1.1.1.1.3.3.5">𝑒</ci></apply></apply><apply id="S4.E2.m1.1.1.1.1.1.cmml" xref="S4.E2.m1.1.1.1.1.1"><plus id="S4.E2.m1.1.1.1.1.1.2.cmml" xref="S4.E2.m1.1.1.1.1.1.2"></plus><apply id="S4.E2.m1.1.1.1.1.1.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="S4.E2.m1.1.1.1.1.1.1.2.cmml" xref="S4.E2.m1.1.1.1.1.1.1.2">tensor-product</csymbol><apply id="S4.E2.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1"><minus id="S4.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.1"></minus><cn id="S4.E2.m1.1.1.1.1.1.1.1.1.1.2.cmml" type="integer" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.2">1</cn><apply id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3"><times id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.2">𝑠</ci><ci id="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.1.1.1.1.3.3">ℳ</ci></apply></apply><apply id="S4.E2.m1.1.1.1.1.1.1.3.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E2.m1.1.1.1.1.1.1.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S4.E2.m1.1.1.1.1.1.1.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.2">𝑂</ci><apply id="S4.E2.m1.1.1.1.1.1.1.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3"><times id="S4.E2.m1.1.1.1.1.1.1.3.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.1"></times><ci id="S4.E2.m1.1.1.1.1.1.1.3.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.2">𝑖</ci><ci id="S4.E2.m1.1.1.1.1.1.1.3.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.3">𝑛</ci><ci id="S4.E2.m1.1.1.1.1.1.1.3.3.4.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.4">𝑡</ci><ci id="S4.E2.m1.1.1.1.1.1.1.3.3.5.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.5">𝑟</ci><ci id="S4.E2.m1.1.1.1.1.1.1.3.3.6.cmml" xref="S4.E2.m1.1.1.1.1.1.1.3.3.6">𝑎</ci></apply></apply></apply><apply id="S4.E2.m1.1.1.1.1.1.3.cmml" xref="S4.E2.m1.1.1.1.1.1.3"><csymbol cd="latexml" id="S4.E2.m1.1.1.1.1.1.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.3.1">tensor-product</csymbol><apply id="S4.E2.m1.1.1.1.1.1.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.3.2"><times id="S4.E2.m1.1.1.1.1.1.3.2.1.cmml" xref="S4.E2.m1.1.1.1.1.1.3.2.1"></times><ci id="S4.E2.m1.1.1.1.1.1.3.2.2.cmml" xref="S4.E2.m1.1.1.1.1.1.3.2.2">𝑠</ci><ci id="S4.E2.m1.1.1.1.1.1.3.2.3.cmml" xref="S4.E2.m1.1.1.1.1.1.3.2.3">ℳ</ci></apply><apply id="S4.E2.m1.1.1.1.1.1.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S4.E2.m1.1.1.1.1.1.3.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3">subscript</csymbol><ci id="S4.E2.m1.1.1.1.1.1.3.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.2">𝑂</ci><apply id="S4.E2.m1.1.1.1.1.1.3.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3"><times id="S4.E2.m1.1.1.1.1.1.3.3.3.1.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.1"></times><ci id="S4.E2.m1.1.1.1.1.1.3.3.3.2.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.2">𝑖</ci><ci id="S4.E2.m1.1.1.1.1.1.3.3.3.3.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.3">𝑛</ci><ci id="S4.E2.m1.1.1.1.1.1.3.3.3.4.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.4">𝑡</ci><ci id="S4.E2.m1.1.1.1.1.1.3.3.3.5.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.5">𝑒</ci><ci id="S4.E2.m1.1.1.1.1.1.3.3.3.6.cmml" xref="S4.E2.m1.1.1.1.1.1.3.3.3.6">𝑟</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E2.m1.1c">O_{fuse}=(\mathbf{1}-s\mathcal{M})\otimes O_{intra}+s\mathcal{M}\otimes O_{%
inter},</annotation><annotation encoding="application/x-llamapun" id="S4.E2.m1.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT = ( bold_1 - italic_s caligraphic_M ) ⊗ italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT + italic_s caligraphic_M ⊗ italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS2.p5.26">where <math alttext="s" class="ltx_Math" display="inline" id="S4.SS2.p5.23.m1.1"><semantics id="S4.SS2.p5.23.m1.1a"><mi id="S4.SS2.p5.23.m1.1.1" xref="S4.SS2.p5.23.m1.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.23.m1.1b"><ci id="S4.SS2.p5.23.m1.1.1.cmml" xref="S4.SS2.p5.23.m1.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.23.m1.1c">s</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.23.m1.1d">italic_s</annotation></semantics></math> is a user-defined scalar to control the degree to which the restored image attends the retrieved images, <math alttext="\otimes" class="ltx_Math" display="inline" id="S4.SS2.p5.24.m2.1"><semantics id="S4.SS2.p5.24.m2.1a"><mo id="S4.SS2.p5.24.m2.1.1" xref="S4.SS2.p5.24.m2.1.1.cmml">⊗</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.24.m2.1b"><csymbol cd="latexml" id="S4.SS2.p5.24.m2.1.1.cmml" xref="S4.SS2.p5.24.m2.1.1">tensor-product</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.24.m2.1c">\otimes</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.24.m2.1d">⊗</annotation></semantics></math> denotes the Hardamard product, and <math alttext="\mathbf{1}" class="ltx_Math" display="inline" id="S4.SS2.p5.25.m3.1"><semantics id="S4.SS2.p5.25.m3.1a"><mn id="S4.SS2.p5.25.m3.1.1" xref="S4.SS2.p5.25.m3.1.1.cmml">𝟏</mn><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.25.m3.1b"><cn id="S4.SS2.p5.25.m3.1.1.cmml" type="integer" xref="S4.SS2.p5.25.m3.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.25.m3.1c">\mathbf{1}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.25.m3.1d">bold_1</annotation></semantics></math> is an all one tensor with the same shape as <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS2.p5.26.m4.1"><semantics id="S4.SS2.p5.26.m4.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p5.26.m4.1.1" xref="S4.SS2.p5.26.m4.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.26.m4.1b"><ci id="S4.SS2.p5.26.m4.1.1.cmml" xref="S4.SS2.p5.26.m4.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.26.m4.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.26.m4.1d">caligraphic_M</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p6">
<p class="ltx_p" id="S4.SS2.p6.8"><span class="ltx_text ltx_font_bold" id="S4.SS2.p6.8.1">Distribution alignment.</span>
Using the <math alttext="O_{fuse}" class="ltx_Math" display="inline" id="S4.SS2.p6.1.m1.1"><semantics id="S4.SS2.p6.1.m1.1a"><msub id="S4.SS2.p6.1.m1.1.1" xref="S4.SS2.p6.1.m1.1.1.cmml"><mi id="S4.SS2.p6.1.m1.1.1.2" xref="S4.SS2.p6.1.m1.1.1.2.cmml">O</mi><mrow id="S4.SS2.p6.1.m1.1.1.3" xref="S4.SS2.p6.1.m1.1.1.3.cmml"><mi id="S4.SS2.p6.1.m1.1.1.3.2" xref="S4.SS2.p6.1.m1.1.1.3.2.cmml">f</mi><mo id="S4.SS2.p6.1.m1.1.1.3.1" xref="S4.SS2.p6.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.1.m1.1.1.3.3" xref="S4.SS2.p6.1.m1.1.1.3.3.cmml">u</mi><mo id="S4.SS2.p6.1.m1.1.1.3.1a" xref="S4.SS2.p6.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.1.m1.1.1.3.4" xref="S4.SS2.p6.1.m1.1.1.3.4.cmml">s</mi><mo id="S4.SS2.p6.1.m1.1.1.3.1b" xref="S4.SS2.p6.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.1.m1.1.1.3.5" xref="S4.SS2.p6.1.m1.1.1.3.5.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.1.m1.1b"><apply id="S4.SS2.p6.1.m1.1.1.cmml" xref="S4.SS2.p6.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.1.m1.1.1.1.cmml" xref="S4.SS2.p6.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p6.1.m1.1.1.2.cmml" xref="S4.SS2.p6.1.m1.1.1.2">𝑂</ci><apply id="S4.SS2.p6.1.m1.1.1.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3"><times id="S4.SS2.p6.1.m1.1.1.3.1.cmml" xref="S4.SS2.p6.1.m1.1.1.3.1"></times><ci id="S4.SS2.p6.1.m1.1.1.3.2.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2">𝑓</ci><ci id="S4.SS2.p6.1.m1.1.1.3.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3.3">𝑢</ci><ci id="S4.SS2.p6.1.m1.1.1.3.4.cmml" xref="S4.SS2.p6.1.m1.1.1.3.4">𝑠</ci><ci id="S4.SS2.p6.1.m1.1.1.3.5.cmml" xref="S4.SS2.p6.1.m1.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.1.m1.1c">O_{fuse}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT</annotation></semantics></math> to replace the original intra-chain self-attention results <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p6.2.m2.1"><semantics id="S4.SS2.p6.2.m2.1a"><msub id="S4.SS2.p6.2.m2.1.1" xref="S4.SS2.p6.2.m2.1.1.cmml"><mi id="S4.SS2.p6.2.m2.1.1.2" xref="S4.SS2.p6.2.m2.1.1.2.cmml">O</mi><mrow id="S4.SS2.p6.2.m2.1.1.3" xref="S4.SS2.p6.2.m2.1.1.3.cmml"><mi id="S4.SS2.p6.2.m2.1.1.3.2" xref="S4.SS2.p6.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p6.2.m2.1.1.3.1" xref="S4.SS2.p6.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.2.m2.1.1.3.3" xref="S4.SS2.p6.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p6.2.m2.1.1.3.1a" xref="S4.SS2.p6.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.2.m2.1.1.3.4" xref="S4.SS2.p6.2.m2.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p6.2.m2.1.1.3.1b" xref="S4.SS2.p6.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.2.m2.1.1.3.5" xref="S4.SS2.p6.2.m2.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p6.2.m2.1.1.3.1c" xref="S4.SS2.p6.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.2.m2.1.1.3.6" xref="S4.SS2.p6.2.m2.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.2.m2.1b"><apply id="S4.SS2.p6.2.m2.1.1.cmml" xref="S4.SS2.p6.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.2.m2.1.1.1.cmml" xref="S4.SS2.p6.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p6.2.m2.1.1.2.cmml" xref="S4.SS2.p6.2.m2.1.1.2">𝑂</ci><apply id="S4.SS2.p6.2.m2.1.1.3.cmml" xref="S4.SS2.p6.2.m2.1.1.3"><times id="S4.SS2.p6.2.m2.1.1.3.1.cmml" xref="S4.SS2.p6.2.m2.1.1.3.1"></times><ci id="S4.SS2.p6.2.m2.1.1.3.2.cmml" xref="S4.SS2.p6.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS2.p6.2.m2.1.1.3.3.cmml" xref="S4.SS2.p6.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS2.p6.2.m2.1.1.3.4.cmml" xref="S4.SS2.p6.2.m2.1.1.3.4">𝑡</ci><ci id="S4.SS2.p6.2.m2.1.1.3.5.cmml" xref="S4.SS2.p6.2.m2.1.1.3.5">𝑟</ci><ci id="S4.SS2.p6.2.m2.1.1.3.6.cmml" xref="S4.SS2.p6.2.m2.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.2.m2.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.2.m2.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math> seems to be a promising way to integrate useful external knowledge from <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p6.3.m3.1"><semantics id="S4.SS2.p6.3.m3.1a"><msub id="S4.SS2.p6.3.m3.1.1" xref="S4.SS2.p6.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p6.3.m3.1.1.2" xref="S4.SS2.p6.3.m3.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p6.3.m3.1.1.3" xref="S4.SS2.p6.3.m3.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.3.m3.1b"><apply id="S4.SS2.p6.3.m3.1.1.cmml" xref="S4.SS2.p6.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.3.m3.1.1.1.cmml" xref="S4.SS2.p6.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p6.3.m3.1.1.2.cmml" xref="S4.SS2.p6.3.m3.1.1.2">𝒞</ci><ci id="S4.SS2.p6.3.m3.1.1.3.cmml" xref="S4.SS2.p6.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.3.m3.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>.
However, it should be noticed that there is a domain gap between <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p6.4.m4.1"><semantics id="S4.SS2.p6.4.m4.1a"><msub id="S4.SS2.p6.4.m4.1.1" xref="S4.SS2.p6.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p6.4.m4.1.1.2" xref="S4.SS2.p6.4.m4.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p6.4.m4.1.1.3" xref="S4.SS2.p6.4.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.4.m4.1b"><apply id="S4.SS2.p6.4.m4.1.1.cmml" xref="S4.SS2.p6.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.4.m4.1.1.1.cmml" xref="S4.SS2.p6.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p6.4.m4.1.1.2.cmml" xref="S4.SS2.p6.4.m4.1.1.2">𝒞</ci><ci id="S4.SS2.p6.4.m4.1.1.3.cmml" xref="S4.SS2.p6.4.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.4.m4.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S4.SS2.p6.5.m5.1"><semantics id="S4.SS2.p6.5.m5.1a"><msub id="S4.SS2.p6.5.m5.1.1" xref="S4.SS2.p6.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p6.5.m5.1.1.2" xref="S4.SS2.p6.5.m5.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p6.5.m5.1.1.3" xref="S4.SS2.p6.5.m5.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.5.m5.1b"><apply id="S4.SS2.p6.5.m5.1.1.cmml" xref="S4.SS2.p6.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.5.m5.1.1.1.cmml" xref="S4.SS2.p6.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.p6.5.m5.1.1.2.cmml" xref="S4.SS2.p6.5.m5.1.1.2">𝒞</ci><ci id="S4.SS2.p6.5.m5.1.1.3.cmml" xref="S4.SS2.p6.5.m5.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.5.m5.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> due to the image quality and content differences, and thus
a direct insertion of <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p6.6.m6.1"><semantics id="S4.SS2.p6.6.m6.1a"><msub id="S4.SS2.p6.6.m6.1.1" xref="S4.SS2.p6.6.m6.1.1.cmml"><mi id="S4.SS2.p6.6.m6.1.1.2" xref="S4.SS2.p6.6.m6.1.1.2.cmml">O</mi><mrow id="S4.SS2.p6.6.m6.1.1.3" xref="S4.SS2.p6.6.m6.1.1.3.cmml"><mi id="S4.SS2.p6.6.m6.1.1.3.2" xref="S4.SS2.p6.6.m6.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p6.6.m6.1.1.3.1" xref="S4.SS2.p6.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.6.m6.1.1.3.3" xref="S4.SS2.p6.6.m6.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p6.6.m6.1.1.3.1a" xref="S4.SS2.p6.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.6.m6.1.1.3.4" xref="S4.SS2.p6.6.m6.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p6.6.m6.1.1.3.1b" xref="S4.SS2.p6.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.6.m6.1.1.3.5" xref="S4.SS2.p6.6.m6.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p6.6.m6.1.1.3.1c" xref="S4.SS2.p6.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p6.6.m6.1.1.3.6" xref="S4.SS2.p6.6.m6.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.6.m6.1b"><apply id="S4.SS2.p6.6.m6.1.1.cmml" xref="S4.SS2.p6.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.6.m6.1.1.1.cmml" xref="S4.SS2.p6.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p6.6.m6.1.1.2.cmml" xref="S4.SS2.p6.6.m6.1.1.2">𝑂</ci><apply id="S4.SS2.p6.6.m6.1.1.3.cmml" xref="S4.SS2.p6.6.m6.1.1.3"><times id="S4.SS2.p6.6.m6.1.1.3.1.cmml" xref="S4.SS2.p6.6.m6.1.1.3.1"></times><ci id="S4.SS2.p6.6.m6.1.1.3.2.cmml" xref="S4.SS2.p6.6.m6.1.1.3.2">𝑖</ci><ci id="S4.SS2.p6.6.m6.1.1.3.3.cmml" xref="S4.SS2.p6.6.m6.1.1.3.3">𝑛</ci><ci id="S4.SS2.p6.6.m6.1.1.3.4.cmml" xref="S4.SS2.p6.6.m6.1.1.3.4">𝑡</ci><ci id="S4.SS2.p6.6.m6.1.1.3.5.cmml" xref="S4.SS2.p6.6.m6.1.1.3.5">𝑟</ci><ci id="S4.SS2.p6.6.m6.1.1.3.6.cmml" xref="S4.SS2.p6.6.m6.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.6.m6.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.6.m6.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math> into <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p6.7.m7.1"><semantics id="S4.SS2.p6.7.m7.1a"><msub id="S4.SS2.p6.7.m7.1.1" xref="S4.SS2.p6.7.m7.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p6.7.m7.1.1.2" xref="S4.SS2.p6.7.m7.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p6.7.m7.1.1.3" xref="S4.SS2.p6.7.m7.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.7.m7.1b"><apply id="S4.SS2.p6.7.m7.1.1.cmml" xref="S4.SS2.p6.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.7.m7.1.1.1.cmml" xref="S4.SS2.p6.7.m7.1.1">subscript</csymbol><ci id="S4.SS2.p6.7.m7.1.1.2.cmml" xref="S4.SS2.p6.7.m7.1.1.2">𝒞</ci><ci id="S4.SS2.p6.7.m7.1.1.3.cmml" xref="S4.SS2.p6.7.m7.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.7.m7.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.7.m7.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> will result in a distribution shift of the original denoising chain in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p6.8.m8.1"><semantics id="S4.SS2.p6.8.m8.1a"><msub id="S4.SS2.p6.8.m8.1.1" xref="S4.SS2.p6.8.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p6.8.m8.1.1.2" xref="S4.SS2.p6.8.m8.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p6.8.m8.1.1.3" xref="S4.SS2.p6.8.m8.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.8.m8.1b"><apply id="S4.SS2.p6.8.m8.1.1.cmml" xref="S4.SS2.p6.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS2.p6.8.m8.1.1.1.cmml" xref="S4.SS2.p6.8.m8.1.1">subscript</csymbol><ci id="S4.SS2.p6.8.m8.1.1.2.cmml" xref="S4.SS2.p6.8.m8.1.1.2">𝒞</ci><ci id="S4.SS2.p6.8.m8.1.1.3.cmml" xref="S4.SS2.p6.8.m8.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.8.m8.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p6.8.m8.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p7">
<p class="ltx_p" id="S4.SS2.p7.2">To this end, we propose the distribution alignment as a complementary to calibrate the distribution shift. Specifically, considering the latent in the diffusion chain is a Gaussian, we propose to use the Adaptive Instance Normalization (AdaIN) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib49" title=""><span class="ltx_text" style="font-size:90%;">49</span></a>]</cite> to align the mean and variance of <math alttext="O_{fuse}" class="ltx_Math" display="inline" id="S4.SS2.p7.1.m1.1"><semantics id="S4.SS2.p7.1.m1.1a"><msub id="S4.SS2.p7.1.m1.1.1" xref="S4.SS2.p7.1.m1.1.1.cmml"><mi id="S4.SS2.p7.1.m1.1.1.2" xref="S4.SS2.p7.1.m1.1.1.2.cmml">O</mi><mrow id="S4.SS2.p7.1.m1.1.1.3" xref="S4.SS2.p7.1.m1.1.1.3.cmml"><mi id="S4.SS2.p7.1.m1.1.1.3.2" xref="S4.SS2.p7.1.m1.1.1.3.2.cmml">f</mi><mo id="S4.SS2.p7.1.m1.1.1.3.1" xref="S4.SS2.p7.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.1.m1.1.1.3.3" xref="S4.SS2.p7.1.m1.1.1.3.3.cmml">u</mi><mo id="S4.SS2.p7.1.m1.1.1.3.1a" xref="S4.SS2.p7.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.1.m1.1.1.3.4" xref="S4.SS2.p7.1.m1.1.1.3.4.cmml">s</mi><mo id="S4.SS2.p7.1.m1.1.1.3.1b" xref="S4.SS2.p7.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.1.m1.1.1.3.5" xref="S4.SS2.p7.1.m1.1.1.3.5.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.1.m1.1b"><apply id="S4.SS2.p7.1.m1.1.1.cmml" xref="S4.SS2.p7.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p7.1.m1.1.1.1.cmml" xref="S4.SS2.p7.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p7.1.m1.1.1.2.cmml" xref="S4.SS2.p7.1.m1.1.1.2">𝑂</ci><apply id="S4.SS2.p7.1.m1.1.1.3.cmml" xref="S4.SS2.p7.1.m1.1.1.3"><times id="S4.SS2.p7.1.m1.1.1.3.1.cmml" xref="S4.SS2.p7.1.m1.1.1.3.1"></times><ci id="S4.SS2.p7.1.m1.1.1.3.2.cmml" xref="S4.SS2.p7.1.m1.1.1.3.2">𝑓</ci><ci id="S4.SS2.p7.1.m1.1.1.3.3.cmml" xref="S4.SS2.p7.1.m1.1.1.3.3">𝑢</ci><ci id="S4.SS2.p7.1.m1.1.1.3.4.cmml" xref="S4.SS2.p7.1.m1.1.1.3.4">𝑠</ci><ci id="S4.SS2.p7.1.m1.1.1.3.5.cmml" xref="S4.SS2.p7.1.m1.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.1.m1.1c">O_{fuse}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT</annotation></semantics></math> to the original statistics of <math alttext="O_{intra}" class="ltx_Math" display="inline" id="S4.SS2.p7.2.m2.1"><semantics id="S4.SS2.p7.2.m2.1a"><msub id="S4.SS2.p7.2.m2.1.1" xref="S4.SS2.p7.2.m2.1.1.cmml"><mi id="S4.SS2.p7.2.m2.1.1.2" xref="S4.SS2.p7.2.m2.1.1.2.cmml">O</mi><mrow id="S4.SS2.p7.2.m2.1.1.3" xref="S4.SS2.p7.2.m2.1.1.3.cmml"><mi id="S4.SS2.p7.2.m2.1.1.3.2" xref="S4.SS2.p7.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p7.2.m2.1.1.3.1" xref="S4.SS2.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.2.m2.1.1.3.3" xref="S4.SS2.p7.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p7.2.m2.1.1.3.1a" xref="S4.SS2.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.2.m2.1.1.3.4" xref="S4.SS2.p7.2.m2.1.1.3.4.cmml">t</mi><mo id="S4.SS2.p7.2.m2.1.1.3.1b" xref="S4.SS2.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.2.m2.1.1.3.5" xref="S4.SS2.p7.2.m2.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p7.2.m2.1.1.3.1c" xref="S4.SS2.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.2.m2.1.1.3.6" xref="S4.SS2.p7.2.m2.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.2.m2.1b"><apply id="S4.SS2.p7.2.m2.1.1.cmml" xref="S4.SS2.p7.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p7.2.m2.1.1.1.cmml" xref="S4.SS2.p7.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p7.2.m2.1.1.2.cmml" xref="S4.SS2.p7.2.m2.1.1.2">𝑂</ci><apply id="S4.SS2.p7.2.m2.1.1.3.cmml" xref="S4.SS2.p7.2.m2.1.1.3"><times id="S4.SS2.p7.2.m2.1.1.3.1.cmml" xref="S4.SS2.p7.2.m2.1.1.3.1"></times><ci id="S4.SS2.p7.2.m2.1.1.3.2.cmml" xref="S4.SS2.p7.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS2.p7.2.m2.1.1.3.3.cmml" xref="S4.SS2.p7.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS2.p7.2.m2.1.1.3.4.cmml" xref="S4.SS2.p7.2.m2.1.1.3.4">𝑡</ci><ci id="S4.SS2.p7.2.m2.1.1.3.5.cmml" xref="S4.SS2.p7.2.m2.1.1.3.5">𝑟</ci><ci id="S4.SS2.p7.2.m2.1.1.3.6.cmml" xref="S4.SS2.p7.2.m2.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.2.m2.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.2.m2.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="O^{\prime}_{fuse}=\mathtt{AdaIN}(O_{fuse},O_{intra})," class="ltx_Math" display="block" id="S4.E3.m1.1"><semantics id="S4.E3.m1.1a"><mrow id="S4.E3.m1.1.1.1" xref="S4.E3.m1.1.1.1.1.cmml"><mrow id="S4.E3.m1.1.1.1.1" xref="S4.E3.m1.1.1.1.1.cmml"><msubsup id="S4.E3.m1.1.1.1.1.4" xref="S4.E3.m1.1.1.1.1.4.cmml"><mi id="S4.E3.m1.1.1.1.1.4.2.2" xref="S4.E3.m1.1.1.1.1.4.2.2.cmml">O</mi><mrow id="S4.E3.m1.1.1.1.1.4.3" xref="S4.E3.m1.1.1.1.1.4.3.cmml"><mi id="S4.E3.m1.1.1.1.1.4.3.2" xref="S4.E3.m1.1.1.1.1.4.3.2.cmml">f</mi><mo id="S4.E3.m1.1.1.1.1.4.3.1" xref="S4.E3.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.4.3.3" xref="S4.E3.m1.1.1.1.1.4.3.3.cmml">u</mi><mo id="S4.E3.m1.1.1.1.1.4.3.1a" xref="S4.E3.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.4.3.4" xref="S4.E3.m1.1.1.1.1.4.3.4.cmml">s</mi><mo id="S4.E3.m1.1.1.1.1.4.3.1b" xref="S4.E3.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.4.3.5" xref="S4.E3.m1.1.1.1.1.4.3.5.cmml">e</mi></mrow><mo id="S4.E3.m1.1.1.1.1.4.2.3" xref="S4.E3.m1.1.1.1.1.4.2.3.cmml">′</mo></msubsup><mo id="S4.E3.m1.1.1.1.1.3" xref="S4.E3.m1.1.1.1.1.3.cmml">=</mo><mrow id="S4.E3.m1.1.1.1.1.2" xref="S4.E3.m1.1.1.1.1.2.cmml"><mi id="S4.E3.m1.1.1.1.1.2.4" xref="S4.E3.m1.1.1.1.1.2.4.cmml">𝙰𝚍𝚊𝙸𝙽</mi><mo id="S4.E3.m1.1.1.1.1.2.3" xref="S4.E3.m1.1.1.1.1.2.3.cmml">⁢</mo><mrow id="S4.E3.m1.1.1.1.1.2.2.2" xref="S4.E3.m1.1.1.1.1.2.2.3.cmml"><mo id="S4.E3.m1.1.1.1.1.2.2.2.3" stretchy="false" xref="S4.E3.m1.1.1.1.1.2.2.3.cmml">(</mo><msub id="S4.E3.m1.1.1.1.1.1.1.1.1" xref="S4.E3.m1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E3.m1.1.1.1.1.1.1.1.1.2" xref="S4.E3.m1.1.1.1.1.1.1.1.1.2.cmml">O</mi><mrow id="S4.E3.m1.1.1.1.1.1.1.1.1.3" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S4.E3.m1.1.1.1.1.1.1.1.1.3.2" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.2.cmml">f</mi><mo id="S4.E3.m1.1.1.1.1.1.1.1.1.3.1" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.1.1.1.1.3.3" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.3.cmml">u</mi><mo id="S4.E3.m1.1.1.1.1.1.1.1.1.3.1a" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.1.1.1.1.3.4" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.4.cmml">s</mi><mo id="S4.E3.m1.1.1.1.1.1.1.1.1.3.1b" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.1.1.1.1.3.5" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.5.cmml">e</mi></mrow></msub><mo id="S4.E3.m1.1.1.1.1.2.2.2.4" xref="S4.E3.m1.1.1.1.1.2.2.3.cmml">,</mo><msub id="S4.E3.m1.1.1.1.1.2.2.2.2" xref="S4.E3.m1.1.1.1.1.2.2.2.2.cmml"><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.2" xref="S4.E3.m1.1.1.1.1.2.2.2.2.2.cmml">O</mi><mrow id="S4.E3.m1.1.1.1.1.2.2.2.2.3" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.cmml"><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.3.2" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.2.cmml">i</mi><mo id="S4.E3.m1.1.1.1.1.2.2.2.2.3.1" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.3.3" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.3.cmml">n</mi><mo id="S4.E3.m1.1.1.1.1.2.2.2.2.3.1a" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.3.4" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.4.cmml">t</mi><mo id="S4.E3.m1.1.1.1.1.2.2.2.2.3.1b" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.3.5" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.5.cmml">r</mi><mo id="S4.E3.m1.1.1.1.1.2.2.2.2.3.1c" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S4.E3.m1.1.1.1.1.2.2.2.2.3.6" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.6.cmml">a</mi></mrow></msub><mo id="S4.E3.m1.1.1.1.1.2.2.2.5" stretchy="false" xref="S4.E3.m1.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S4.E3.m1.1.1.1.2" xref="S4.E3.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E3.m1.1b"><apply id="S4.E3.m1.1.1.1.1.cmml" xref="S4.E3.m1.1.1.1"><eq id="S4.E3.m1.1.1.1.1.3.cmml" xref="S4.E3.m1.1.1.1.1.3"></eq><apply id="S4.E3.m1.1.1.1.1.4.cmml" xref="S4.E3.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E3.m1.1.1.1.1.4.1.cmml" xref="S4.E3.m1.1.1.1.1.4">subscript</csymbol><apply id="S4.E3.m1.1.1.1.1.4.2.cmml" xref="S4.E3.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S4.E3.m1.1.1.1.1.4.2.1.cmml" xref="S4.E3.m1.1.1.1.1.4">superscript</csymbol><ci id="S4.E3.m1.1.1.1.1.4.2.2.cmml" xref="S4.E3.m1.1.1.1.1.4.2.2">𝑂</ci><ci id="S4.E3.m1.1.1.1.1.4.2.3.cmml" xref="S4.E3.m1.1.1.1.1.4.2.3">′</ci></apply><apply id="S4.E3.m1.1.1.1.1.4.3.cmml" xref="S4.E3.m1.1.1.1.1.4.3"><times id="S4.E3.m1.1.1.1.1.4.3.1.cmml" xref="S4.E3.m1.1.1.1.1.4.3.1"></times><ci id="S4.E3.m1.1.1.1.1.4.3.2.cmml" xref="S4.E3.m1.1.1.1.1.4.3.2">𝑓</ci><ci id="S4.E3.m1.1.1.1.1.4.3.3.cmml" xref="S4.E3.m1.1.1.1.1.4.3.3">𝑢</ci><ci id="S4.E3.m1.1.1.1.1.4.3.4.cmml" xref="S4.E3.m1.1.1.1.1.4.3.4">𝑠</ci><ci id="S4.E3.m1.1.1.1.1.4.3.5.cmml" xref="S4.E3.m1.1.1.1.1.4.3.5">𝑒</ci></apply></apply><apply id="S4.E3.m1.1.1.1.1.2.cmml" xref="S4.E3.m1.1.1.1.1.2"><times id="S4.E3.m1.1.1.1.1.2.3.cmml" xref="S4.E3.m1.1.1.1.1.2.3"></times><ci id="S4.E3.m1.1.1.1.1.2.4.cmml" xref="S4.E3.m1.1.1.1.1.2.4">𝙰𝚍𝚊𝙸𝙽</ci><interval closure="open" id="S4.E3.m1.1.1.1.1.2.2.3.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2"><apply id="S4.E3.m1.1.1.1.1.1.1.1.1.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E3.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E3.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.2">𝑂</ci><apply id="S4.E3.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3"><times id="S4.E3.m1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S4.E3.m1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.2">𝑓</ci><ci id="S4.E3.m1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.3">𝑢</ci><ci id="S4.E3.m1.1.1.1.1.1.1.1.1.3.4.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.4">𝑠</ci><ci id="S4.E3.m1.1.1.1.1.1.1.1.1.3.5.cmml" xref="S4.E3.m1.1.1.1.1.1.1.1.1.3.5">𝑒</ci></apply></apply><apply id="S4.E3.m1.1.1.1.1.2.2.2.2.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S4.E3.m1.1.1.1.1.2.2.2.2.1.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2">subscript</csymbol><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.2">𝑂</ci><apply id="S4.E3.m1.1.1.1.1.2.2.2.2.3.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3"><times id="S4.E3.m1.1.1.1.1.2.2.2.2.3.1.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.1"></times><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.3.2.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.2">𝑖</ci><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.3.3.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.3">𝑛</ci><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.3.4.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.4">𝑡</ci><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.3.5.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.5">𝑟</ci><ci id="S4.E3.m1.1.1.1.1.2.2.2.2.3.6.cmml" xref="S4.E3.m1.1.1.1.1.2.2.2.2.3.6">𝑎</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E3.m1.1c">O^{\prime}_{fuse}=\mathtt{AdaIN}(O_{fuse},O_{intra}),</annotation><annotation encoding="application/x-llamapun" id="S4.E3.m1.1d">italic_O start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT = typewriter_AdaIN ( italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT , italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS2.p7.7">where <math alttext="\mathtt{AdaIN}(u,v)" class="ltx_Math" display="inline" id="S4.SS2.p7.3.m1.2"><semantics id="S4.SS2.p7.3.m1.2a"><mrow id="S4.SS2.p7.3.m1.2.3" xref="S4.SS2.p7.3.m1.2.3.cmml"><mi id="S4.SS2.p7.3.m1.2.3.2" xref="S4.SS2.p7.3.m1.2.3.2.cmml">𝙰𝚍𝚊𝙸𝙽</mi><mo id="S4.SS2.p7.3.m1.2.3.1" xref="S4.SS2.p7.3.m1.2.3.1.cmml">⁢</mo><mrow id="S4.SS2.p7.3.m1.2.3.3.2" xref="S4.SS2.p7.3.m1.2.3.3.1.cmml"><mo id="S4.SS2.p7.3.m1.2.3.3.2.1" stretchy="false" xref="S4.SS2.p7.3.m1.2.3.3.1.cmml">(</mo><mi id="S4.SS2.p7.3.m1.1.1" xref="S4.SS2.p7.3.m1.1.1.cmml">u</mi><mo id="S4.SS2.p7.3.m1.2.3.3.2.2" xref="S4.SS2.p7.3.m1.2.3.3.1.cmml">,</mo><mi id="S4.SS2.p7.3.m1.2.2" xref="S4.SS2.p7.3.m1.2.2.cmml">v</mi><mo id="S4.SS2.p7.3.m1.2.3.3.2.3" stretchy="false" xref="S4.SS2.p7.3.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.3.m1.2b"><apply id="S4.SS2.p7.3.m1.2.3.cmml" xref="S4.SS2.p7.3.m1.2.3"><times id="S4.SS2.p7.3.m1.2.3.1.cmml" xref="S4.SS2.p7.3.m1.2.3.1"></times><ci id="S4.SS2.p7.3.m1.2.3.2.cmml" xref="S4.SS2.p7.3.m1.2.3.2">𝙰𝚍𝚊𝙸𝙽</ci><interval closure="open" id="S4.SS2.p7.3.m1.2.3.3.1.cmml" xref="S4.SS2.p7.3.m1.2.3.3.2"><ci id="S4.SS2.p7.3.m1.1.1.cmml" xref="S4.SS2.p7.3.m1.1.1">𝑢</ci><ci id="S4.SS2.p7.3.m1.2.2.cmml" xref="S4.SS2.p7.3.m1.2.2">𝑣</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.3.m1.2c">\mathtt{AdaIN}(u,v)</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.3.m1.2d">typewriter_AdaIN ( italic_u , italic_v )</annotation></semantics></math> denotes replacing the mean and variance of <math alttext="u" class="ltx_Math" display="inline" id="S4.SS2.p7.4.m2.1"><semantics id="S4.SS2.p7.4.m2.1a"><mi id="S4.SS2.p7.4.m2.1.1" xref="S4.SS2.p7.4.m2.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.4.m2.1b"><ci id="S4.SS2.p7.4.m2.1.1.cmml" xref="S4.SS2.p7.4.m2.1.1">𝑢</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.4.m2.1c">u</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.4.m2.1d">italic_u</annotation></semantics></math> with the corresponding part of <math alttext="v" class="ltx_Math" display="inline" id="S4.SS2.p7.5.m3.1"><semantics id="S4.SS2.p7.5.m3.1a"><mi id="S4.SS2.p7.5.m3.1.1" xref="S4.SS2.p7.5.m3.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.5.m3.1b"><ci id="S4.SS2.p7.5.m3.1.1.cmml" xref="S4.SS2.p7.5.m3.1.1">𝑣</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.5.m3.1c">v</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.5.m3.1d">italic_v</annotation></semantics></math>. Finally, we replace the original self-attention result in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S4.SS2.p7.6.m4.1"><semantics id="S4.SS2.p7.6.m4.1a"><msub id="S4.SS2.p7.6.m4.1.1" xref="S4.SS2.p7.6.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p7.6.m4.1.1.2" xref="S4.SS2.p7.6.m4.1.1.2.cmml">𝒞</mi><mi id="S4.SS2.p7.6.m4.1.1.3" xref="S4.SS2.p7.6.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.6.m4.1b"><apply id="S4.SS2.p7.6.m4.1.1.cmml" xref="S4.SS2.p7.6.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p7.6.m4.1.1.1.cmml" xref="S4.SS2.p7.6.m4.1.1">subscript</csymbol><ci id="S4.SS2.p7.6.m4.1.1.2.cmml" xref="S4.SS2.p7.6.m4.1.1.2">𝒞</ci><ci id="S4.SS2.p7.6.m4.1.1.3.cmml" xref="S4.SS2.p7.6.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.6.m4.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.6.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> with the well-aligned <math alttext="O^{\prime}_{fuse}" class="ltx_Math" display="inline" id="S4.SS2.p7.7.m5.1"><semantics id="S4.SS2.p7.7.m5.1a"><msubsup id="S4.SS2.p7.7.m5.1.1" xref="S4.SS2.p7.7.m5.1.1.cmml"><mi id="S4.SS2.p7.7.m5.1.1.2.2" xref="S4.SS2.p7.7.m5.1.1.2.2.cmml">O</mi><mrow id="S4.SS2.p7.7.m5.1.1.3" xref="S4.SS2.p7.7.m5.1.1.3.cmml"><mi id="S4.SS2.p7.7.m5.1.1.3.2" xref="S4.SS2.p7.7.m5.1.1.3.2.cmml">f</mi><mo id="S4.SS2.p7.7.m5.1.1.3.1" xref="S4.SS2.p7.7.m5.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.7.m5.1.1.3.3" xref="S4.SS2.p7.7.m5.1.1.3.3.cmml">u</mi><mo id="S4.SS2.p7.7.m5.1.1.3.1a" xref="S4.SS2.p7.7.m5.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.7.m5.1.1.3.4" xref="S4.SS2.p7.7.m5.1.1.3.4.cmml">s</mi><mo id="S4.SS2.p7.7.m5.1.1.3.1b" xref="S4.SS2.p7.7.m5.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p7.7.m5.1.1.3.5" xref="S4.SS2.p7.7.m5.1.1.3.5.cmml">e</mi></mrow><mo id="S4.SS2.p7.7.m5.1.1.2.3" xref="S4.SS2.p7.7.m5.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.7.m5.1b"><apply id="S4.SS2.p7.7.m5.1.1.cmml" xref="S4.SS2.p7.7.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p7.7.m5.1.1.1.cmml" xref="S4.SS2.p7.7.m5.1.1">subscript</csymbol><apply id="S4.SS2.p7.7.m5.1.1.2.cmml" xref="S4.SS2.p7.7.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.p7.7.m5.1.1.2.1.cmml" xref="S4.SS2.p7.7.m5.1.1">superscript</csymbol><ci id="S4.SS2.p7.7.m5.1.1.2.2.cmml" xref="S4.SS2.p7.7.m5.1.1.2.2">𝑂</ci><ci id="S4.SS2.p7.7.m5.1.1.2.3.cmml" xref="S4.SS2.p7.7.m5.1.1.2.3">′</ci></apply><apply id="S4.SS2.p7.7.m5.1.1.3.cmml" xref="S4.SS2.p7.7.m5.1.1.3"><times id="S4.SS2.p7.7.m5.1.1.3.1.cmml" xref="S4.SS2.p7.7.m5.1.1.3.1"></times><ci id="S4.SS2.p7.7.m5.1.1.3.2.cmml" xref="S4.SS2.p7.7.m5.1.1.3.2">𝑓</ci><ci id="S4.SS2.p7.7.m5.1.1.3.3.cmml" xref="S4.SS2.p7.7.m5.1.1.3.3">𝑢</ci><ci id="S4.SS2.p7.7.m5.1.1.3.4.cmml" xref="S4.SS2.p7.7.m5.1.1.3.4">𝑠</ci><ci id="S4.SS2.p7.7.m5.1.1.3.5.cmml" xref="S4.SS2.p7.7.m5.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.7.m5.1c">O^{\prime}_{fuse}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p7.7.m5.1d">italic_O start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT</annotation></semantics></math> to finish the cross image injection process.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Experiments</h2>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Experiments Setup</h3>
<div class="ltx_para ltx_noindent" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1"><span class="ltx_text ltx_font_bold" id="S5.SS1.p1.1.1">Datasets and metrics.</span>
In this work, we include experiments with two difficulty levels for performance evaluation. The first setup considers restoration with manually provided ideal reference images, which share a high content similarity with the LQ image, to evaluate the ability to utilize the reference knowledge. The datasets for this setting employ the widely used RefSR dataset including CUFED5 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib50" title=""><span class="ltx_text" style="font-size:90%;">50</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib51" title=""><span class="ltx_text" style="font-size:90%;">51</span></a>]</cite> and WR-SR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>]</cite>, in which the reference images are already provided. Since these datasets only contain HQ images, we thus use the second-order degradation model from Real-ESRGAN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib8" title=""><span class="ltx_text" style="font-size:90%;">8</span></a>]</cite> with <math alttext="\times 4" class="ltx_Math" display="inline" id="S5.SS1.p1.1.m1.1"><semantics id="S5.SS1.p1.1.m1.1a"><mrow id="S5.SS1.p1.1.m1.1.1" xref="S5.SS1.p1.1.m1.1.1.cmml"><mi id="S5.SS1.p1.1.m1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.2.cmml"></mi><mo id="S5.SS1.p1.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S5.SS1.p1.1.m1.1.1.1.cmml">×</mo><mn id="S5.SS1.p1.1.m1.1.1.3" xref="S5.SS1.p1.1.m1.1.1.3.cmml">4</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.1.m1.1b"><apply id="S5.SS1.p1.1.m1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1"><times id="S5.SS1.p1.1.m1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1"></times><csymbol cd="latexml" id="S5.SS1.p1.1.m1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.2">absent</csymbol><cn id="S5.SS1.p1.1.m1.1.1.3.cmml" type="integer" xref="S5.SS1.p1.1.m1.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.1.m1.1c">\times 4</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.1.m1.1d">× 4</annotation></semantics></math> down-sampling scale to generate the real-world degraded images. The second setup turns to more challenging practice where the reference images have to be retrieved using the retriever, and we use the RealPhoto60 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> which contains 60 real-world degraded images without ground truth for evaluation. And we use DIV2K <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib52" title=""><span class="ltx_text" style="font-size:90%;">52</span></a>]</cite> as the high-quality image database for retrieval and employ the image encoder of VGG16 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib46" title=""><span class="ltx_text" style="font-size:90%;">46</span></a>]</cite> as the feature extractor. As for the evaluation metrics, we use both the fidelity metrics containing PSNR and SSIM, as well as the perceptual metrics including LPIPS <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib53" title=""><span class="ltx_text" style="font-size:90%;">53</span></a>]</cite>, NIQE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib54" title=""><span class="ltx_text" style="font-size:90%;">54</span></a>]</cite>, FID <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib55" title=""><span class="ltx_text" style="font-size:90%;">55</span></a>]</cite>, MUISQ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib56" title=""><span class="ltx_text" style="font-size:90%;">56</span></a>]</cite>, and CLIPIQA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib57" title=""><span class="ltx_text" style="font-size:90%;">57</span></a>]</cite>, to assess the performance of the different methods.</p>
</div>
<figure class="ltx_table" id="S5.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T1.14.1.1" style="font-size:90%;">Table 1</span>: </span><span class="ltx_text" id="S5.T1.15.2" style="font-size:90%;">Quantitative comparison with state-of-the-art RefSR methods, GAN-based methods, and Diffusion-based methods on real-world image super-resolution. Our ReFIR achieves consistent performance improvements in both fidelity and perceptual quality.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T1.12" style="width:544.8pt;height:253.4pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-37.1pt,17.3pt) scale(0.88,0.88) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.T1.12.12">
<tr class="ltx_tr" id="S5.T1.12.12.13">
<td class="ltx_td ltx_border_r ltx_border_tt" id="S5.T1.12.12.13.1" style="padding-left:2.5pt;padding-right:2.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="5" id="S5.T1.12.12.13.2" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.13.2.1">CUFED5</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="5" id="S5.T1.12.12.13.3" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.13.3.1">WR-SR</span></td>
</tr>
<tr class="ltx_tr" id="S5.T1.10.10.10">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.10.10.10.11" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text" id="S5.T1.10.10.10.11.1">Method</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.1.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T1.1.1.1.1.m1.1"><semantics id="S5.T1.1.1.1.1.m1.1a"><mo id="S5.T1.1.1.1.1.m1.1.1" stretchy="false" xref="S5.T1.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T1.1.1.1.1.m1.1b"><ci id="S5.T1.1.1.1.1.m1.1.1.cmml" xref="S5.T1.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.2.2.2.2" style="padding-left:2.5pt;padding-right:2.5pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T1.2.2.2.2.m1.1"><semantics id="S5.T1.2.2.2.2.m1.1a"><mo id="S5.T1.2.2.2.2.m1.1.1" stretchy="false" xref="S5.T1.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T1.2.2.2.2.m1.1b"><ci id="S5.T1.2.2.2.2.m1.1.1.cmml" xref="S5.T1.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.3.3.3.3" style="padding-left:2.5pt;padding-right:2.5pt;">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.3.3.3.3.m1.1"><semantics id="S5.T1.3.3.3.3.m1.1a"><mo id="S5.T1.3.3.3.3.m1.1.1" stretchy="false" xref="S5.T1.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.3.3.3.3.m1.1b"><ci id="S5.T1.3.3.3.3.m1.1.1.cmml" xref="S5.T1.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.4.4.4.4" style="padding-left:2.5pt;padding-right:2.5pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.4.4.4.4.m1.1"><semantics id="S5.T1.4.4.4.4.m1.1a"><mo id="S5.T1.4.4.4.4.m1.1.1" stretchy="false" xref="S5.T1.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.4.4.4.4.m1.1b"><ci id="S5.T1.4.4.4.4.m1.1.1.cmml" xref="S5.T1.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.5.5.5.5" style="padding-left:2.5pt;padding-right:2.5pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.5.5.5.5.m1.1"><semantics id="S5.T1.5.5.5.5.m1.1a"><mo id="S5.T1.5.5.5.5.m1.1.1" stretchy="false" xref="S5.T1.5.5.5.5.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.5.5.5.5.m1.1b"><ci id="S5.T1.5.5.5.5.m1.1.1.cmml" xref="S5.T1.5.5.5.5.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.5.5.5.5.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.5.5.5.5.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.6.6.6.6" style="padding-left:2.5pt;padding-right:2.5pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T1.6.6.6.6.m1.1"><semantics id="S5.T1.6.6.6.6.m1.1a"><mo id="S5.T1.6.6.6.6.m1.1.1" stretchy="false" xref="S5.T1.6.6.6.6.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T1.6.6.6.6.m1.1b"><ci id="S5.T1.6.6.6.6.m1.1.1.cmml" xref="S5.T1.6.6.6.6.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.6.6.6.6.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.6.6.6.6.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.7.7.7.7" style="padding-left:2.5pt;padding-right:2.5pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T1.7.7.7.7.m1.1"><semantics id="S5.T1.7.7.7.7.m1.1a"><mo id="S5.T1.7.7.7.7.m1.1.1" stretchy="false" xref="S5.T1.7.7.7.7.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T1.7.7.7.7.m1.1b"><ci id="S5.T1.7.7.7.7.m1.1.1.cmml" xref="S5.T1.7.7.7.7.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.7.7.7.7.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.7.7.7.7.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.8.8.8.8" style="padding-left:2.5pt;padding-right:2.5pt;">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.8.8.8.8.m1.1"><semantics id="S5.T1.8.8.8.8.m1.1a"><mo id="S5.T1.8.8.8.8.m1.1.1" stretchy="false" xref="S5.T1.8.8.8.8.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.8.8.8.8.m1.1b"><ci id="S5.T1.8.8.8.8.m1.1.1.cmml" xref="S5.T1.8.8.8.8.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.8.8.8.8.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.8.8.8.8.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.9.9.9.9" style="padding-left:2.5pt;padding-right:2.5pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.9.9.9.9.m1.1"><semantics id="S5.T1.9.9.9.9.m1.1a"><mo id="S5.T1.9.9.9.9.m1.1.1" stretchy="false" xref="S5.T1.9.9.9.9.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.9.9.9.9.m1.1b"><ci id="S5.T1.9.9.9.9.m1.1.1.cmml" xref="S5.T1.9.9.9.9.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.9.9.9.9.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.9.9.9.9.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.10.10.10.10" style="padding-left:2.5pt;padding-right:2.5pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T1.10.10.10.10.m1.1"><semantics id="S5.T1.10.10.10.10.m1.1a"><mo id="S5.T1.10.10.10.10.m1.1.1" stretchy="false" xref="S5.T1.10.10.10.10.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T1.10.10.10.10.m1.1b"><ci id="S5.T1.10.10.10.10.m1.1.1.cmml" xref="S5.T1.10.10.10.10.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.10.10.10.10.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T1.10.10.10.10.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.14">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T1.12.12.14.1" style="padding-left:2.5pt;padding-right:2.5pt;">C2-Matching <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.77</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5169</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.7282</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.5" style="padding-left:2.5pt;padding-right:2.5pt;">8.4438</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T1.12.12.14.6" style="padding-left:2.5pt;padding-right:2.5pt;">282.43</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.7" style="padding-left:2.5pt;padding-right:2.5pt;">22.63</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5627</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.7177</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.14.10" style="padding-left:2.5pt;padding-right:2.5pt;">8.3238</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.12.12.14.11" style="padding-left:2.5pt;padding-right:2.5pt;">157.61</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.15">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.15.1" style="padding-left:2.5pt;padding-right:2.5pt;">DATSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib42" title=""><span class="ltx_text" style="font-size:90%;">42</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.75</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5130</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.7301</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.5" style="padding-left:2.5pt;padding-right:2.5pt;">8.6765</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.15.6" style="padding-left:2.5pt;padding-right:2.5pt;">282.19</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.7" style="padding-left:2.5pt;padding-right:2.5pt;">22.62</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5620</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.7210</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.15.10" style="padding-left:2.5pt;padding-right:2.5pt;">8.4329</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.15.11" style="padding-left:2.5pt;padding-right:2.5pt;">157.54</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.16">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.16.1" style="padding-left:2.5pt;padding-right:2.5pt;">MrefSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib43" title=""><span class="ltx_text" style="font-size:90%;">43</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.84</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5218</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.7853</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.5" style="padding-left:2.5pt;padding-right:2.5pt;">9.6524</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.16.6" style="padding-left:2.5pt;padding-right:2.5pt;">286.44</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.7" style="padding-left:2.5pt;padding-right:2.5pt;">22.68</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5703</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.7748</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.16.10" style="padding-left:2.5pt;padding-right:2.5pt;">9.7742</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.16.11" style="padding-left:2.5pt;padding-right:2.5pt;">156.57</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.17">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T1.12.12.17.1" style="padding-left:2.5pt;padding-right:2.5pt;">BSRGAN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib9" title=""><span class="ltx_text" style="font-size:90%;">9</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.22</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5256</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.4135</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.5" style="padding-left:2.5pt;padding-right:2.5pt;">4.2204</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T1.12.12.17.6" style="padding-left:2.5pt;padding-right:2.5pt;">203.17</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.7" style="padding-left:2.5pt;padding-right:2.5pt;">22.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5735</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.4073</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.17.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.8703</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.12.12.17.11" style="padding-left:2.5pt;padding-right:2.5pt;">133.50</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.18">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.18.1" style="padding-left:2.5pt;padding-right:2.5pt;">Real-ESRGAN <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib8" title=""><span class="ltx_text" style="font-size:90%;">8</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.31</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5543</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3698</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.5" style="padding-left:2.5pt;padding-right:2.5pt;">3.8832</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.18.6" style="padding-left:2.5pt;padding-right:2.5pt;">175.91</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.7" style="padding-left:2.5pt;padding-right:2.5pt;">22.14</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5974</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3631</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.18.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.7001</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.18.11" style="padding-left:2.5pt;padding-right:2.5pt;">97.88</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.19">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.19.1" style="padding-left:2.5pt;padding-right:2.5pt;">StableSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.46</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4480</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.6532</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.5" style="padding-left:2.5pt;padding-right:2.5pt;">6.3433</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.19.6" style="padding-left:2.5pt;padding-right:2.5pt;">292.69</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.22</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.4421</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.5899</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.19.10" style="padding-left:2.5pt;padding-right:2.5pt;">5.2040</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.19.11" style="padding-left:2.5pt;padding-right:2.5pt;">145.07</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.20">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.20.1" style="padding-left:2.5pt;padding-right:2.5pt;">DiffBIR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib15" title=""><span class="ltx_text" style="font-size:90%;">15</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.76</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4886</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3820</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.5" style="padding-left:2.5pt;padding-right:2.5pt;">3.5629</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.20.6" style="padding-left:2.5pt;padding-right:2.5pt;">154.75</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.30</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5284</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3938</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.20.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.8736</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.20.11" style="padding-left:2.5pt;padding-right:2.5pt;">76.05</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.21">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.21.1" style="padding-left:2.5pt;padding-right:2.5pt;">PASD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.22</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4959</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.5252</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.5" style="padding-left:2.5pt;padding-right:2.5pt;">5.4828</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.21.6" style="padding-left:2.5pt;padding-right:2.5pt;">208.64</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.12</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5254</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.4292</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.21.10" style="padding-left:2.5pt;padding-right:2.5pt;">4.2505</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.21.11" style="padding-left:2.5pt;padding-right:2.5pt;">98.16</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.22">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T1.12.12.22.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.12.12.22.1.1">\rowcolor</span>[HTML]EFEFEF
SeeSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.94</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5195</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3660</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.5" style="padding-left:2.5pt;padding-right:2.5pt;">3.7912</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T1.12.12.22.6" style="padding-left:2.5pt;padding-right:2.5pt;">142.92</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.73</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5658</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3501</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.22.10" style="padding-left:2.5pt;padding-right:2.5pt;">4.0155</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.12.12.22.11" style="padding-left:2.5pt;padding-right:2.5pt;">65.78</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.23">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.23.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.12.12.23.1.1">\rowcolor</span>[HTML]EFEFEF
SeeSR+ReFIR</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.32</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5289</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3338</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.5" style="padding-left:2.5pt;padding-right:2.5pt;">3.7831</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.23.6" style="padding-left:2.5pt;padding-right:2.5pt;">134.62</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.86</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5664</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3460</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.23.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.9089</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.23.11" style="padding-left:2.5pt;padding-right:2.5pt;">61.22</td>
</tr>
<tr class="ltx_tr" id="S5.T1.11.11.11">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.11.11.11.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.11.11.11.1.1">\rowcolor</span>[HTML]EFEFEF
<math alttext="\Delta" class="ltx_Math" display="inline" id="S5.T1.11.11.11.1.m1.1"><semantics id="S5.T1.11.11.11.1.m1.1a"><mi id="S5.T1.11.11.11.1.m1.1.1" mathcolor="#339955" mathvariant="normal" xref="S5.T1.11.11.11.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.T1.11.11.11.1.m1.1b"><ci id="S5.T1.11.11.11.1.m1.1.1.cmml" xref="S5.T1.11.11.11.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.11.11.11.1.m1.1c">\Delta</annotation><annotation encoding="application/x-llamapun" id="S5.T1.11.11.11.1.m1.1d">roman_Δ</annotation></semantics></math><span class="ltx_text ltx_font_bold ltx_font_italic" id="S5.T1.11.11.11.1.2" style="color:#339955;">improvement</span>
</td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.2" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.2.1" style="color:#339955;">+0.38</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.3" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.3.1" style="color:#339955;">+0.0094</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.4" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.4.1" style="color:#339955;">+0.0322</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.5" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.5.1" style="color:#339955;">+0.0081</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.11.11.11.6" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.6.1" style="color:#339955;">+8.30</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.7" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.7.1" style="color:#339955;">+0.13</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.8" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.8.1" style="color:#339955;">+0.0006</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.9" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.9.1" style="color:#339955;">+0.0041</span></td>
<td class="ltx_td ltx_align_center" id="S5.T1.11.11.11.10" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.10.1" style="color:#339955;">+0.1066</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.11.11.11.11" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.11.11.11.11.1" style="color:#339955;">+4.56</span></td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.24">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T1.12.12.24.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.12.12.24.1.1">\rowcolor</span>[HTML]EFEFEF
SUPIR</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.2" style="padding-left:2.5pt;padding-right:2.5pt;">18.97</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4665</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.4807</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.5" style="padding-left:2.5pt;padding-right:2.5pt;">4.5624</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T1.12.12.24.6" style="padding-left:2.5pt;padding-right:2.5pt;">168.26</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.7" style="padding-left:2.5pt;padding-right:2.5pt;">20.91</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5426</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3791</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T1.12.12.24.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.7587</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T1.12.12.24.11" style="padding-left:2.5pt;padding-right:2.5pt;">75.85</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.25">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T1.12.12.25.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.12.12.25.1.1">\rowcolor</span>[HTML]EFEFEF
SUPIR+ReFIR</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.00</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4729</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.4341</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.5" style="padding-left:2.5pt;padding-right:2.5pt;">4.2085</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T1.12.12.25.6" style="padding-left:2.5pt;padding-right:2.5pt;">148.69</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.7" style="padding-left:2.5pt;padding-right:2.5pt;">21.02</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.8" style="padding-left:2.5pt;padding-right:2.5pt;">0.5497</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.9" style="padding-left:2.5pt;padding-right:2.5pt;">0.3785</td>
<td class="ltx_td ltx_align_center" id="S5.T1.12.12.25.10" style="padding-left:2.5pt;padding-right:2.5pt;">3.7478</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T1.12.12.25.11" style="padding-left:2.5pt;padding-right:2.5pt;">71.82</td>
</tr>
<tr class="ltx_tr" id="S5.T1.12.12.12">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S5.T1.12.12.12.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T1.12.12.12.1.1">\rowcolor</span>[HTML]EFEFEF
<math alttext="\Delta" class="ltx_Math" display="inline" id="S5.T1.12.12.12.1.m1.1"><semantics id="S5.T1.12.12.12.1.m1.1a"><mi id="S5.T1.12.12.12.1.m1.1.1" mathcolor="#339955" mathvariant="normal" xref="S5.T1.12.12.12.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S5.T1.12.12.12.1.m1.1b"><ci id="S5.T1.12.12.12.1.m1.1.1.cmml" xref="S5.T1.12.12.12.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.12.12.12.1.m1.1c">\Delta</annotation><annotation encoding="application/x-llamapun" id="S5.T1.12.12.12.1.m1.1d">roman_Δ</annotation></semantics></math><span class="ltx_text ltx_font_bold ltx_font_italic" id="S5.T1.12.12.12.1.2" style="color:#339955;">improvement</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.2" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.2.1" style="color:#339955;">+0.03</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.3" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.3.1" style="color:#339955;">+0.0064</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.4" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.4.1" style="color:#339955;">+0.0466</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.5" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.5.1" style="color:#339955;">+0.3539</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T1.12.12.12.6" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.6.1" style="color:#339955;">+19.57</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.7" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.7.1" style="color:#339955;">+0.11</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.8" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.8.1" style="color:#339955;">+0.0071</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.9" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.9.1" style="color:#339955;">+0.0006</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.10" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.10.1" style="color:#339955;">+0.0109</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T1.12.12.12.11" style="padding-left:2.5pt;padding-right:2.5pt;"><span class="ltx_text ltx_font_bold" id="S5.T1.12.12.12.11.1" style="color:#339955;">+4.03</span></td>
</tr>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="240" id="S5.F5.g1" src="x5.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F5.3.1.1" style="font-size:90%;">Figure 5</span>: </span><span class="ltx_text" id="S5.F5.4.2" style="font-size:90%;">Quantitative comparison on RefSR dataset. The results using our ReFIR are <span class="ltx_text ltx_font_bold" id="S5.F5.4.2.1">bolded</span>. Please zoom in for better visualization.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.3"><span class="ltx_text ltx_font_bold" id="S5.SS1.p2.3.1">Implementation details.</span>
For a fair comparison, we use one reference image if not specified. Experiments with multiple reference images are given in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A1" title="Appendix A Adaptive Multi-reference Injection ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">A</span></a>. Following the common practice of existing LRMs <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>]</cite>, the <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S5.SS1.p2.1.m1.1"><semantics id="S5.SS1.p2.1.m1.1a"><msub id="S5.SS1.p2.1.m1.1.1" xref="S5.SS1.p2.1.m1.1.1.cmml"><mi id="S5.SS1.p2.1.m1.1.1.2" xref="S5.SS1.p2.1.m1.1.1.2.cmml">I</mi><mrow id="S5.SS1.p2.1.m1.1.1.3" xref="S5.SS1.p2.1.m1.1.1.3.cmml"><mi id="S5.SS1.p2.1.m1.1.1.3.2" xref="S5.SS1.p2.1.m1.1.1.3.2.cmml">L</mi><mo id="S5.SS1.p2.1.m1.1.1.3.1" xref="S5.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS1.p2.1.m1.1.1.3.3" xref="S5.SS1.p2.1.m1.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.1.m1.1b"><apply id="S5.SS1.p2.1.m1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.1.m1.1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS1.p2.1.m1.1.1.2.cmml" xref="S5.SS1.p2.1.m1.1.1.2">𝐼</ci><apply id="S5.SS1.p2.1.m1.1.1.3.cmml" xref="S5.SS1.p2.1.m1.1.1.3"><times id="S5.SS1.p2.1.m1.1.1.3.1.cmml" xref="S5.SS1.p2.1.m1.1.1.3.1"></times><ci id="S5.SS1.p2.1.m1.1.1.3.2.cmml" xref="S5.SS1.p2.1.m1.1.1.3.2">𝐿</ci><ci id="S5.SS1.p2.1.m1.1.1.3.3.cmml" xref="S5.SS1.p2.1.m1.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.1.m1.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.1.m1.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> is up-sampled to the desired size using Bicubic before going through the LRMs.
We use reflective padding to ensure the input size of <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS1.p2.2.m2.1"><semantics id="S5.SS1.p2.2.m2.1a"><msub id="S5.SS1.p2.2.m2.1.1" xref="S5.SS1.p2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS1.p2.2.m2.1.1.2" xref="S5.SS1.p2.2.m2.1.1.2.cmml">𝒞</mi><mi id="S5.SS1.p2.2.m2.1.1.3" xref="S5.SS1.p2.2.m2.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.2.m2.1b"><apply id="S5.SS1.p2.2.m2.1.1.cmml" xref="S5.SS1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.2.m2.1.1.1.cmml" xref="S5.SS1.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS1.p2.2.m2.1.1.2.cmml" xref="S5.SS1.p2.2.m2.1.1.2">𝒞</ci><ci id="S5.SS1.p2.2.m2.1.1.3.cmml" xref="S5.SS1.p2.2.m2.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.2.m2.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS1.p2.3.m3.1"><semantics id="S5.SS1.p2.3.m3.1a"><msub id="S5.SS1.p2.3.m3.1.1" xref="S5.SS1.p2.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS1.p2.3.m3.1.1.2" xref="S5.SS1.p2.3.m3.1.1.2.cmml">𝒞</mi><mi id="S5.SS1.p2.3.m3.1.1.3" xref="S5.SS1.p2.3.m3.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.3.m3.1b"><apply id="S5.SS1.p2.3.m3.1.1.cmml" xref="S5.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.3.m3.1.1.1.cmml" xref="S5.SS1.p2.3.m3.1.1">subscript</csymbol><ci id="S5.SS1.p2.3.m3.1.1.2.cmml" xref="S5.SS1.p2.3.m3.1.1.2">𝒞</ci><ci id="S5.SS1.p2.3.m3.1.1.3.cmml" xref="S5.SS1.p2.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.3.m3.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> are the same. We use fixed random seeds for results reproducibility in all experiments. The hyperparameters of different baselines follow their original settings. We apply the proposed retrieval augmented restoration framework to two popular LRMs, namely SeeSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>]</cite> and SUPIR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite>, and denoted the models augmented with our ReFIR as “SeeSR+ReFIR” and “SUPIR+ReFIR”, respectively.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Comparison to State-of-the-Arts</h3>
<div class="ltx_para ltx_noindent" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.p1.1.1">Restoration with ideal reference.</span>
We first compare on the RefSR dataset with real-world degradation. The compared methods includes state-of-the-art RefSR methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib42" title=""><span class="ltx_text" style="font-size:90%;">42</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib43" title=""><span class="ltx_text" style="font-size:90%;">43</span></a>]</cite>, GAN-based methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib9" title=""><span class="ltx_text" style="font-size:90%;">9</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib8" title=""><span class="ltx_text" style="font-size:90%;">8</span></a>]</cite>, and recent Diffusion-based methods <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib15" title=""><span class="ltx_text" style="font-size:90%;">15</span></a>]</cite>. <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T1" title="In 5.1 Experiments Setup ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">1</span></a> gives the results. It can be seen that our method brings significant gains in <span class="ltx_text ltx_font_italic" id="S5.SS2.p1.1.2">all</span> metrics on both fidelity (PSNR, SSIM) and perceptual quality (LPIPS, NIQE, FID) for the LRMs. Taking SUPIR as an example, our method brings a FID improvement of even 19.57 on the CUFED5 dataset. Moreover, similar performance gains can also be observed in SeeSR. For instance, equipping our ReFIR to SeeSR can lead to 0.38dB PSNR improvement, demonstrating the generalization of our ReFIR. It is noteworthy that the above superiority is obtained without any training or fine-tuning. Moreover, we also give visual comparisons in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F5" title="In 5.1 Experiments Setup ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">5</span></a>, and it can be seen that our method can generate details that are faithful to the original scene with the help of external knowledge from retrieved reference images.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.p2">
<p class="ltx_p" id="S5.SS2.p2.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.p2.1.1">Restoration in the wild.</span>
The above experiments on RefSR datasets focus on utilizing the already provided reference images from the dataset, which applies when the user has relevant HQ images. In this section, we turn to more challenging scenarios in which the reference image has to be obtained by retrieval. Since the ground truth of RealPhoto datasets is unavailable, we use non-reference image quality assessment metrics, <span class="ltx_text ltx_font_italic" id="S5.SS2.p2.1.2">i.e.</span> NIQE, MUSIQ, and CLIPIQA for evaluation. As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T2" title="In 5.2 Comparison to State-of-the-Arts ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">2</span></a>, our approach continues to produce significant gains over its non-ReFIR counterparts. For instance, our SeeSR+ReFIR surpasses the original SeeSR by 0.2866 NIQE and 1.59 MUSIQ. Since the retrieved image can not serve as an ideal reference, the above favorable results demonstrate the robustness of our ReFIR in the face of real-world retrieved images. We also give quantitative results in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F6" title="In 5.2 Comparison to State-of-the-Arts ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">6</span></a>. Even under severe real-world degradation, our method maintains good perceptual quality.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.p3">
<p class="ltx_p" id="S5.SS2.p3.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.p3.1.1">Complexity analysis.</span>
<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T3" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">3</span></a> gives the comparison of the computational complexity, including the number of parameters, GPU cost, and the inference latency. We also give the restoration performance for a more comprehensive comparison. As for the parameters, our ReFIR can facilitate both fidelity and realistic image restoration using the same #param as the original base LRMs. For the GPU memory, since our ReFIR uses two images as input, <span class="ltx_text ltx_font_italic" id="S5.SS2.p3.1.2">i.e.</span>, one LQ image, and one reference image, the GPU cost will become larger than the original one. For instance, it rises 1.38 times the increase of SUPIR+ReFIR than the original SUPIR model. Moreover, the inference time also increases due to more inputs as well as the additional interaction between two chains. In the future, we will delve deep into the effective utilization of retrieved images while maintaining efficiency.</p>
</div>
<figure class="ltx_table" id="S5.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T2.5.1.1" style="font-size:90%;">Table 2</span>: </span><span class="ltx_text" id="S5.T2.6.2" style="font-size:90%;">Quantitative comparison on real-world degradation with RealPhoto datasets.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T2.3" style="width:1048.6pt;height:95.4pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(0.0pt,0.0pt) scale(1.0,1.0) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.T2.3.3">
<tr class="ltx_tr" id="S5.T2.3.3.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="S5.T2.3.3.4.1" style="padding-left:2.5pt;padding-right:2.5pt;">Metrics</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.2" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.2.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.2.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.2.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.2.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.2.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">StableSR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.2.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.2.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib16" title=""><span class="ltx_text" style="font-size:90%;">16</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.2.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.3" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.3.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.3.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.3.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.3.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.3.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">DiffBIR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.3.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.3.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib15" title=""><span class="ltx_text" style="font-size:90%;">15</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.3.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.4" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.4.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.4.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.4.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.4.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.4.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">PASD</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.4.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.4.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib17" title=""><span class="ltx_text" style="font-size:90%;">17</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.4.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.5" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.5.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.5.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.5.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.5.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.5.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">CCSR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.5.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.5.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib18" title=""><span class="ltx_text" style="font-size:90%;">18</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.5.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.6" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.6.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.6.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.6.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.6.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.6.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">SeeSR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.6.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.6.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.6.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.7" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_text" id="S5.T2.3.3.4.7.1"></span> <span class="ltx_text" id="S5.T2.3.3.4.7.2">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.7.2.1">
<span class="ltx_tr" id="S5.T2.3.3.4.7.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.7.2.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">SUPIR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.7.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.7.2.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;"><cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite></span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.7.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.8" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.3.3.4.8.1">\cellcolor</span>Gray<span class="ltx_text" id="S5.T2.3.3.4.8.2"></span> <span class="ltx_text" id="S5.T2.3.3.4.8.3">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.8.3.1">
<span class="ltx_tr" id="S5.T2.3.3.4.8.3.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.8.3.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">SeeSR+ReFIR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.8.3.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.8.3.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;">(Ours)</span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.8.4"></span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T2.3.3.4.9" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.3.3.4.9.1">\cellcolor</span>Gray<span class="ltx_text" id="S5.T2.3.3.4.9.2"></span> <span class="ltx_text" id="S5.T2.3.3.4.9.3">
<span class="ltx_tabular ltx_align_middle" id="S5.T2.3.3.4.9.3.1">
<span class="ltx_tr" id="S5.T2.3.3.4.9.3.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.9.3.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">SUPIR+ReFIR</span></span>
<span class="ltx_tr" id="S5.T2.3.3.4.9.3.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.3.3.4.9.3.1.2.1" style="padding-left:2.5pt;padding-right:2.5pt;">(Ours)</span></span>
</span></span><span class="ltx_text" id="S5.T2.3.3.4.9.4"></span></td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T2.1.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T2.1.1.1.1.m1.1"><semantics id="S5.T2.1.1.1.1.m1.1a"><mo id="S5.T2.1.1.1.1.m1.1.1" stretchy="false" xref="S5.T2.1.1.1.1.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T2.1.1.1.1.m1.1b"><ci id="S5.T2.1.1.1.1.m1.1.1.cmml" xref="S5.T2.1.1.1.1.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.1.1.1.1.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T2.1.1.1.1.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.2" style="padding-left:2.5pt;padding-right:2.5pt;">3.7695</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.3" style="padding-left:2.5pt;padding-right:2.5pt;">2.8458</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.4" style="padding-left:2.5pt;padding-right:2.5pt;">5.1603</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.5" style="padding-left:2.5pt;padding-right:2.5pt;">5.5082</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.6" style="padding-left:2.5pt;padding-right:2.5pt;">4.7432</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.7" style="padding-left:2.5pt;padding-right:2.5pt;">3.5076</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.1.8" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.1.1.1.8.1">\cellcolor</span>Gray4.4566<span class="ltx_text ltx_font_bold" id="S5.T2.1.1.1.8.2" style="font-size:90%;color:#339955;">(+0.2866)</span>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T2.1.1.1.9" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.1.1.1.9.1">\cellcolor</span>Gray3.4593<span class="ltx_text ltx_font_bold" id="S5.T2.1.1.1.9.2" style="font-size:90%;color:#339955;">(+0.0483)</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T2.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T2.2.2.2.1" style="padding-left:2.5pt;padding-right:2.5pt;">MUSIQ<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T2.2.2.2.1.m1.1"><semantics id="S5.T2.2.2.2.1.m1.1a"><mo id="S5.T2.2.2.2.1.m1.1.1" stretchy="false" xref="S5.T2.2.2.2.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T2.2.2.2.1.m1.1b"><ci id="S5.T2.2.2.2.1.m1.1.1.cmml" xref="S5.T2.2.2.2.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.2.2.2.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T2.2.2.2.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.2" style="padding-left:2.5pt;padding-right:2.5pt;">51.95</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.3" style="padding-left:2.5pt;padding-right:2.5pt;">65.20</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.4" style="padding-left:2.5pt;padding-right:2.5pt;">49.01</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.5" style="padding-left:2.5pt;padding-right:2.5pt;">32.26</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.6" style="padding-left:2.5pt;padding-right:2.5pt;">55.54</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.7" style="padding-left:2.5pt;padding-right:2.5pt;">59.84</td>
<td class="ltx_td ltx_align_center" id="S5.T2.2.2.2.8" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.2.2.2.8.1">\cellcolor</span>Gray57.13<span class="ltx_text ltx_font_bold" id="S5.T2.2.2.2.8.2" style="font-size:90%;color:#339955;">(+1.59)</span>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T2.2.2.2.9" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.2.2.2.9.1">\cellcolor</span>Gray60.49<span class="ltx_text ltx_font_bold" id="S5.T2.2.2.2.9.2" style="font-size:90%;color:#339955;">(+0.65)</span>
</td>
</tr>
<tr class="ltx_tr" id="S5.T2.3.3.3">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S5.T2.3.3.3.1" style="padding-left:2.5pt;padding-right:2.5pt;">CLIPIQA<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T2.3.3.3.1.m1.1"><semantics id="S5.T2.3.3.3.1.m1.1a"><mo id="S5.T2.3.3.3.1.m1.1.1" stretchy="false" xref="S5.T2.3.3.3.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T2.3.3.3.1.m1.1b"><ci id="S5.T2.3.3.3.1.m1.1.1.cmml" xref="S5.T2.3.3.3.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T2.3.3.3.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T2.3.3.3.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.2" style="padding-left:2.5pt;padding-right:2.5pt;">0.6852</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.7845</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.5863</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.5" style="padding-left:2.5pt;padding-right:2.5pt;">0.4568</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.6" style="padding-left:2.5pt;padding-right:2.5pt;">0.6575</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.7" style="padding-left:2.5pt;padding-right:2.5pt;">0.5692</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.8" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.3.3.3.8.1">\cellcolor</span>Gray0.6732<span class="ltx_text ltx_font_bold" id="S5.T2.3.3.3.8.2" style="font-size:90%;color:#339955;">(+0.0157)</span>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T2.3.3.3.9" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T2.3.3.3.9.1">\cellcolor</span>Gray0.5722<span class="ltx_text ltx_font_bold" id="S5.T2.3.3.3.9.2" style="font-size:90%;color:#339955;">(+0.003)</span>
</td>
</tr>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="150" id="S5.F6.g1" src="x6.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F6.2.1.1" style="font-size:90%;">Figure 6</span>: </span><span class="ltx_text" id="S5.F6.3.2" style="font-size:90%;">Quantitative comparison on RealPhoto dataset. More results are provided in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8" title="Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">H</span></a>.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Ablation Studies</h3>
<div class="ltx_para ltx_noindent" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.2"><span class="ltx_text ltx_font_bold" id="S5.SS3.p1.2.1">Effectiveness of the reference retriever.</span>

In order to obtain content-relevant retrieved images, we present a simple but inference-efficient retriever <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S5.SS3.p1.1.m1.1"><semantics id="S5.SS3.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.p1.1.m1.1.1" xref="S5.SS3.p1.1.m1.1.1.cmml">ℛ</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.1.m1.1b"><ci id="S5.SS3.p1.1.m1.1.1.cmml" xref="S5.SS3.p1.1.m1.1.1">ℛ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.1.m1.1c">\mathcal{R}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.1.m1.1d">caligraphic_R</annotation></semantics></math> that uses the high-level semantic vectors from the pre-trained deep models for similarity matching in the high-quality image dataset <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S5.SS3.p1.2.m2.1"><semantics id="S5.SS3.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.p1.2.m2.1.1" xref="S5.SS3.p1.2.m2.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p1.2.m2.1b"><ci id="S5.SS3.p1.2.m2.1.1.cmml" xref="S5.SS3.p1.2.m2.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p1.2.m2.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p1.2.m2.1d">caligraphic_D</annotation></semantics></math>. Despite the simple design, we here demonstrate its effectiveness in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F7" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">7</span></a>. Since semantically consistent images usually contain similar textures, <span class="ltx_text ltx_font_italic" id="S5.SS3.p1.2.2">e.g.</span>, the texture in the first elephant image can help in the restoration of the LQ elephant image, and thus the proposed retriever can yield satisfactory retrieval results. Although texture-based retrieval may be a better choice for image restoration, it usually necessitates additional training of new retrieval models. For simplicity, we adopt semantic-based retrieval and leave the exploration of more advanced reference retrievers for future work.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.4"><span class="ltx_text ltx_font_bold" id="S5.SS3.p2.4.1">Ablation on cross image injection.</span>
In the proposed cross image injection, we use separate attention (SA), spatial adaptive gating (SG), and distribution alignment (DA) for effective external knowledge injection. Here, we ablate to validate the effectiveness of different components. We use SUPIR+ReFIR as a representative on the CUFED5 dataset and use the scalar weighted sum when SG is removed. The results are shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T4" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">4</span></a>. One can see that using fixed scalar weights instead of spatial adaptive gating results in a 0.18 NIQE drop. This is because not all pixels of the reference image are useful, and thus fine-grain gated mask is needed. Moreover, removing the distribution alignment also impairs performance, <span class="ltx_text ltx_font_italic" id="S5.SS3.p2.4.2">e.g.</span>, 4.36 FID drop, since the distribution of raw fusion results <math alttext="O_{fuse}" class="ltx_Math" display="inline" id="S5.SS3.p2.1.m1.1"><semantics id="S5.SS3.p2.1.m1.1a"><msub id="S5.SS3.p2.1.m1.1.1" xref="S5.SS3.p2.1.m1.1.1.cmml"><mi id="S5.SS3.p2.1.m1.1.1.2" xref="S5.SS3.p2.1.m1.1.1.2.cmml">O</mi><mrow id="S5.SS3.p2.1.m1.1.1.3" xref="S5.SS3.p2.1.m1.1.1.3.cmml"><mi id="S5.SS3.p2.1.m1.1.1.3.2" xref="S5.SS3.p2.1.m1.1.1.3.2.cmml">f</mi><mo id="S5.SS3.p2.1.m1.1.1.3.1" xref="S5.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.1.m1.1.1.3.3" xref="S5.SS3.p2.1.m1.1.1.3.3.cmml">u</mi><mo id="S5.SS3.p2.1.m1.1.1.3.1a" xref="S5.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.1.m1.1.1.3.4" xref="S5.SS3.p2.1.m1.1.1.3.4.cmml">s</mi><mo id="S5.SS3.p2.1.m1.1.1.3.1b" xref="S5.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.1.m1.1.1.3.5" xref="S5.SS3.p2.1.m1.1.1.3.5.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.1.m1.1b"><apply id="S5.SS3.p2.1.m1.1.1.cmml" xref="S5.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p2.1.m1.1.1.1.cmml" xref="S5.SS3.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.p2.1.m1.1.1.2.cmml" xref="S5.SS3.p2.1.m1.1.1.2">𝑂</ci><apply id="S5.SS3.p2.1.m1.1.1.3.cmml" xref="S5.SS3.p2.1.m1.1.1.3"><times id="S5.SS3.p2.1.m1.1.1.3.1.cmml" xref="S5.SS3.p2.1.m1.1.1.3.1"></times><ci id="S5.SS3.p2.1.m1.1.1.3.2.cmml" xref="S5.SS3.p2.1.m1.1.1.3.2">𝑓</ci><ci id="S5.SS3.p2.1.m1.1.1.3.3.cmml" xref="S5.SS3.p2.1.m1.1.1.3.3">𝑢</ci><ci id="S5.SS3.p2.1.m1.1.1.3.4.cmml" xref="S5.SS3.p2.1.m1.1.1.3.4">𝑠</ci><ci id="S5.SS3.p2.1.m1.1.1.3.5.cmml" xref="S5.SS3.p2.1.m1.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.1.m1.1c">O_{fuse}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.1.m1.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT</annotation></semantics></math> does not match <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS3.p2.2.m2.1"><semantics id="S5.SS3.p2.2.m2.1a"><msub id="S5.SS3.p2.2.m2.1.1" xref="S5.SS3.p2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.p2.2.m2.1.1.2" xref="S5.SS3.p2.2.m2.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.p2.2.m2.1.1.3" xref="S5.SS3.p2.2.m2.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.2.m2.1b"><apply id="S5.SS3.p2.2.m2.1.1.cmml" xref="S5.SS3.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p2.2.m2.1.1.1.cmml" xref="S5.SS3.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.p2.2.m2.1.1.2.cmml" xref="S5.SS3.p2.2.m2.1.1.2">𝒞</ci><ci id="S5.SS3.p2.2.m2.1.1.3.cmml" xref="S5.SS3.p2.2.m2.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.2.m2.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, and directly inject <math alttext="O_{fuse}" class="ltx_Math" display="inline" id="S5.SS3.p2.3.m3.1"><semantics id="S5.SS3.p2.3.m3.1a"><msub id="S5.SS3.p2.3.m3.1.1" xref="S5.SS3.p2.3.m3.1.1.cmml"><mi id="S5.SS3.p2.3.m3.1.1.2" xref="S5.SS3.p2.3.m3.1.1.2.cmml">O</mi><mrow id="S5.SS3.p2.3.m3.1.1.3" xref="S5.SS3.p2.3.m3.1.1.3.cmml"><mi id="S5.SS3.p2.3.m3.1.1.3.2" xref="S5.SS3.p2.3.m3.1.1.3.2.cmml">f</mi><mo id="S5.SS3.p2.3.m3.1.1.3.1" xref="S5.SS3.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.3.m3.1.1.3.3" xref="S5.SS3.p2.3.m3.1.1.3.3.cmml">u</mi><mo id="S5.SS3.p2.3.m3.1.1.3.1a" xref="S5.SS3.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.3.m3.1.1.3.4" xref="S5.SS3.p2.3.m3.1.1.3.4.cmml">s</mi><mo id="S5.SS3.p2.3.m3.1.1.3.1b" xref="S5.SS3.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.p2.3.m3.1.1.3.5" xref="S5.SS3.p2.3.m3.1.1.3.5.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.3.m3.1b"><apply id="S5.SS3.p2.3.m3.1.1.cmml" xref="S5.SS3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.p2.3.m3.1.1.1.cmml" xref="S5.SS3.p2.3.m3.1.1">subscript</csymbol><ci id="S5.SS3.p2.3.m3.1.1.2.cmml" xref="S5.SS3.p2.3.m3.1.1.2">𝑂</ci><apply id="S5.SS3.p2.3.m3.1.1.3.cmml" xref="S5.SS3.p2.3.m3.1.1.3"><times id="S5.SS3.p2.3.m3.1.1.3.1.cmml" xref="S5.SS3.p2.3.m3.1.1.3.1"></times><ci id="S5.SS3.p2.3.m3.1.1.3.2.cmml" xref="S5.SS3.p2.3.m3.1.1.3.2">𝑓</ci><ci id="S5.SS3.p2.3.m3.1.1.3.3.cmml" xref="S5.SS3.p2.3.m3.1.1.3.3">𝑢</ci><ci id="S5.SS3.p2.3.m3.1.1.3.4.cmml" xref="S5.SS3.p2.3.m3.1.1.3.4">𝑠</ci><ci id="S5.SS3.p2.3.m3.1.1.3.5.cmml" xref="S5.SS3.p2.3.m3.1.1.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.3.m3.1c">O_{fuse}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.3.m3.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT</annotation></semantics></math> to the denoising chain of <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS3.p2.4.m4.1"><semantics id="S5.SS3.p2.4.m4.1a"><msub id="S5.SS3.p2.4.m4.1.1" xref="S5.SS3.p2.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.p2.4.m4.1.1.2" xref="S5.SS3.p2.4.m4.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.p2.4.m4.1.1.3" xref="S5.SS3.p2.4.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.4.m4.1b"><apply id="S5.SS3.p2.4.m4.1.1.cmml" xref="S5.SS3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.p2.4.m4.1.1.1.cmml" xref="S5.SS3.p2.4.m4.1.1">subscript</csymbol><ci id="S5.SS3.p2.4.m4.1.1.2.cmml" xref="S5.SS3.p2.4.m4.1.1.2">𝒞</ci><ci id="S5.SS3.p2.4.m4.1.1.3.cmml" xref="S5.SS3.p2.4.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.4.m4.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> can cause sub-optimal results.</p>
</div>
<figure class="ltx_table" id="S5.T3">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T3.11.2.1" style="font-size:90%;">Table 3</span>: </span><span class="ltx_text" id="S5.T3.2.1" style="font-size:90%;">Comparison of model complexity before and after incorporating our ReFIR. We use an input image with the resolution of <math alttext="2048\times 2048" class="ltx_Math" display="inline" id="S5.T3.2.1.m1.1"><semantics id="S5.T3.2.1.m1.1b"><mrow id="S5.T3.2.1.m1.1.1" xref="S5.T3.2.1.m1.1.1.cmml"><mn id="S5.T3.2.1.m1.1.1.2" xref="S5.T3.2.1.m1.1.1.2.cmml">2048</mn><mo id="S5.T3.2.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S5.T3.2.1.m1.1.1.1.cmml">×</mo><mn id="S5.T3.2.1.m1.1.1.3" xref="S5.T3.2.1.m1.1.1.3.cmml">2048</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.T3.2.1.m1.1c"><apply id="S5.T3.2.1.m1.1.1.cmml" xref="S5.T3.2.1.m1.1.1"><times id="S5.T3.2.1.m1.1.1.1.cmml" xref="S5.T3.2.1.m1.1.1.1"></times><cn id="S5.T3.2.1.m1.1.1.2.cmml" type="integer" xref="S5.T3.2.1.m1.1.1.2">2048</cn><cn id="S5.T3.2.1.m1.1.1.3.cmml" type="integer" xref="S5.T3.2.1.m1.1.1.3">2048</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.2.1.m1.1d">2048\times 2048</annotation><annotation encoding="application/x-llamapun" id="S5.T3.2.1.m1.1e">2048 × 2048</annotation></semantics></math> to evaluate the GPU memory and the inference time on one single 80G NVIDIA A100 GPU.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T3.9" style="width:493.1pt;height:90pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(0.0pt,0.0pt) scale(1.0,1.0) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.T3.9.7">
<tr class="ltx_tr" id="S5.T3.9.7.7">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="S5.T3.9.7.7.8" style="padding-left:2.5pt;padding-right:2.5pt;">Method</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T3.3.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T3.3.1.1.1.m1.1"><semantics id="S5.T3.3.1.1.1.m1.1a"><mo id="S5.T3.3.1.1.1.m1.1.1" stretchy="false" xref="S5.T3.3.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T3.3.1.1.1.m1.1b"><ci id="S5.T3.3.1.1.1.m1.1.1.cmml" xref="S5.T3.3.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.3.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.3.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T3.4.2.2.2" style="padding-left:2.5pt;padding-right:2.5pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.T3.4.2.2.2.m1.1"><semantics id="S5.T3.4.2.2.2.m1.1a"><mo id="S5.T3.4.2.2.2.m1.1.1" stretchy="false" xref="S5.T3.4.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.T3.4.2.2.2.m1.1b"><ci id="S5.T3.4.2.2.2.m1.1.1.cmml" xref="S5.T3.4.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.4.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.4.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T3.5.3.3.3" style="padding-left:2.5pt;padding-right:2.5pt;">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T3.5.3.3.3.m1.1"><semantics id="S5.T3.5.3.3.3.m1.1a"><mo id="S5.T3.5.3.3.3.m1.1.1" stretchy="false" xref="S5.T3.5.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T3.5.3.3.3.m1.1b"><ci id="S5.T3.5.3.3.3.m1.1.1.cmml" xref="S5.T3.5.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.5.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.5.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S5.T3.6.4.4.4" style="padding-left:2.5pt;padding-right:2.5pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T3.6.4.4.4.m1.1"><semantics id="S5.T3.6.4.4.4.m1.1a"><mo id="S5.T3.6.4.4.4.m1.1.1" stretchy="false" xref="S5.T3.6.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T3.6.4.4.4.m1.1b"><ci id="S5.T3.6.4.4.4.m1.1.1.cmml" xref="S5.T3.6.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.6.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.6.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T3.7.5.5.5" style="padding-left:2.5pt;padding-right:2.5pt;">#param<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T3.7.5.5.5.m1.1"><semantics id="S5.T3.7.5.5.5.m1.1a"><mo id="S5.T3.7.5.5.5.m1.1.1" stretchy="false" xref="S5.T3.7.5.5.5.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T3.7.5.5.5.m1.1b"><ci id="S5.T3.7.5.5.5.m1.1.1.cmml" xref="S5.T3.7.5.5.5.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.7.5.5.5.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.7.5.5.5.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T3.8.6.6.6" style="padding-left:2.5pt;padding-right:2.5pt;">GPU Memory<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T3.8.6.6.6.m1.1"><semantics id="S5.T3.8.6.6.6.m1.1a"><mo id="S5.T3.8.6.6.6.m1.1.1" stretchy="false" xref="S5.T3.8.6.6.6.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T3.8.6.6.6.m1.1b"><ci id="S5.T3.8.6.6.6.m1.1.1.cmml" xref="S5.T3.8.6.6.6.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.8.6.6.6.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.8.6.6.6.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T3.9.7.7.7" style="padding-left:2.5pt;padding-right:2.5pt;">Inference Time<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.T3.9.7.7.7.m1.1"><semantics id="S5.T3.9.7.7.7.m1.1a"><mo id="S5.T3.9.7.7.7.m1.1.1" stretchy="false" xref="S5.T3.9.7.7.7.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.T3.9.7.7.7.m1.1b"><ci id="S5.T3.9.7.7.7.m1.1.1.cmml" xref="S5.T3.9.7.7.7.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T3.9.7.7.7.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.T3.9.7.7.7.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S5.T3.9.7.8">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S5.T3.9.7.8.1" style="padding-left:2.5pt;padding-right:2.5pt;">SeeSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.9.7.8.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.94</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.9.7.8.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5195</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.9.7.8.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3660</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.9.7.8.5" style="padding-left:2.5pt;padding-right:2.5pt;">142.92</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.9.7.8.6" style="padding-left:2.5pt;padding-right:2.5pt;">2.04B</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.9.7.8.7" style="padding-left:2.5pt;padding-right:2.5pt;">24.4G</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T3.9.7.8.8" style="padding-left:2.5pt;padding-right:2.5pt;">76.5s</td>
</tr>
<tr class="ltx_tr" id="S5.T3.9.7.9">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T3.9.7.9.1" style="padding-left:2.5pt;padding-right:2.5pt;">SUPIR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.9.2" style="padding-left:2.5pt;padding-right:2.5pt;">18.97</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.9.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4665</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.9.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.4807</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.9.7.9.5" style="padding-left:2.5pt;padding-right:2.5pt;">168.26</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.9.6" style="padding-left:2.5pt;padding-right:2.5pt;">3.87B</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.9.7" style="padding-left:2.5pt;padding-right:2.5pt;">37.3G</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.9.7.9.8" style="padding-left:2.5pt;padding-right:2.5pt;">146.4s</td>
</tr>
<tr class="ltx_tr" id="S5.T3.9.7.10">
<td class="ltx_td ltx_align_left ltx_border_r" id="S5.T3.9.7.10.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T3.9.7.10.1.1">\rowcolor</span>[HTML]EFEFEF
SeeSR+ReFIR</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.10.2" style="padding-left:2.5pt;padding-right:2.5pt;">20.32</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.10.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.5289</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.10.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.3338</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.9.7.10.5" style="padding-left:2.5pt;padding-right:2.5pt;">134.62</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.10.6" style="padding-left:2.5pt;padding-right:2.5pt;">2.04B</td>
<td class="ltx_td ltx_align_center" id="S5.T3.9.7.10.7" style="padding-left:2.5pt;padding-right:2.5pt;">40.9G</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.T3.9.7.10.8" style="padding-left:2.5pt;padding-right:2.5pt;">170.7s</td>
</tr>
<tr class="ltx_tr" id="S5.T3.9.7.11">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S5.T3.9.7.11.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="S5.T3.9.7.11.1.1">\rowcolor</span>[HTML]EFEFEF
SUPIR+RefIR</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.00</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4729</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.4341</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T3.9.7.11.5" style="padding-left:2.5pt;padding-right:2.5pt;">148.69</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.6" style="padding-left:2.5pt;padding-right:2.5pt;">3.87B</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.7" style="padding-left:2.5pt;padding-right:2.5pt;">51.4G</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T3.9.7.11.8" style="padding-left:2.5pt;padding-right:2.5pt;">322.8s</td>
</tr>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="S5.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="274" id="S5.F7.g1" src="x7.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F7.2.1.1" style="font-size:90%;">Figure 7</span>: </span><span class="ltx_text" id="S5.F7.3.2" style="font-size:90%;">The retrieval results with RealPhoto60 dataset <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite> as the query images and DIV2K <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib52" title=""><span class="ltx_text" style="font-size:90%;">52</span></a>]</cite> as the HQ image database.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S5.SS3.8">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S5.SS3.4.4" style="width:208.1pt;">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_table ltx_figure_panel" id="S5.T4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T4.2.1.1" style="font-size:90%;">Table 4</span>: </span><span class="ltx_text" id="S5.T4.3.2" style="font-size:90%;">Effectiveness of different components in cross image injection.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="S5.SS3.4.4.4" style="width:215.3pt;height:71.9pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-27.1pt,9.0pt) scale(0.799,0.799) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.SS3.4.4.4.4">
<tr class="ltx_tr" id="S5.SS3.4.4.4.4.4">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.4.4.4.4.4.5" style="padding-left:1.8pt;padding-right:1.8pt;">SA</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.4.4.4.4.4.6" style="padding-left:1.8pt;padding-right:1.8pt;">SG</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_tt" id="S5.SS3.4.4.4.4.4.7" style="padding-left:1.8pt;padding-right:1.8pt;">DA</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.1.1.1.1.1.1" style="padding-left:1.8pt;padding-right:1.8pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.SS3.1.1.1.1.1.1.m1.1"><semantics id="S5.SS3.1.1.1.1.1.1.m1.1a"><mo id="S5.SS3.1.1.1.1.1.1.m1.1.1" stretchy="false" xref="S5.SS3.1.1.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.1.1.1.1.1.1.m1.1b"><ci id="S5.SS3.1.1.1.1.1.1.m1.1.1.cmml" xref="S5.SS3.1.1.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.1.1.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.1.1.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.2.2.2.2.2.2" style="padding-left:1.8pt;padding-right:1.8pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.SS3.2.2.2.2.2.2.m1.1"><semantics id="S5.SS3.2.2.2.2.2.2.m1.1a"><mo id="S5.SS3.2.2.2.2.2.2.m1.1.1" stretchy="false" xref="S5.SS3.2.2.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.2.2.2.2.2.2.m1.1b"><ci id="S5.SS3.2.2.2.2.2.2.m1.1.1.cmml" xref="S5.SS3.2.2.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.2.2.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.2.2.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.3.3.3.3.3.3" style="padding-left:1.8pt;padding-right:1.8pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.SS3.3.3.3.3.3.3.m1.1"><semantics id="S5.SS3.3.3.3.3.3.3.m1.1a"><mo id="S5.SS3.3.3.3.3.3.3.m1.1.1" stretchy="false" xref="S5.SS3.3.3.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.3.3.3.3.3.3.m1.1b"><ci id="S5.SS3.3.3.3.3.3.3.m1.1.1.cmml" xref="S5.SS3.3.3.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.3.3.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.3.3.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.4.4.4.4.4.4" style="padding-left:1.8pt;padding-right:1.8pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.SS3.4.4.4.4.4.4.m1.1"><semantics id="S5.SS3.4.4.4.4.4.4.m1.1a"><mo id="S5.SS3.4.4.4.4.4.4.m1.1.1" stretchy="false" xref="S5.SS3.4.4.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.4.4.4.4.4.4.m1.1b"><ci id="S5.SS3.4.4.4.4.4.4.m1.1.1.cmml" xref="S5.SS3.4.4.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.4.4.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.4.4.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.4.4.4.4.5">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_t" id="S5.SS3.4.4.4.4.5.1" style="padding-left:1.8pt;padding-right:1.8pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_t" id="S5.SS3.4.4.4.4.5.2" style="padding-left:1.8pt;padding-right:1.8pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_r ltx_border_t" id="S5.SS3.4.4.4.4.5.3" style="padding-left:1.8pt;padding-right:1.8pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.4.4.4.4.5.4" style="padding-left:1.8pt;padding-right:1.8pt;">18.97</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.4.4.4.4.5.5" style="padding-left:1.8pt;padding-right:1.8pt;">0.4665</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.4.4.4.4.5.6" style="padding-left:1.8pt;padding-right:1.8pt;">4.5624</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.4.4.4.4.5.7" style="padding-left:1.8pt;padding-right:1.8pt;">168.26</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.4.4.4.4.6">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.6.1" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.SS3.4.4.4.4.6.2" style="padding-left:1.8pt;padding-right:1.8pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.SS3.4.4.4.4.6.3" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.6.4" style="padding-left:1.8pt;padding-right:1.8pt;">19.09</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.6.5" style="padding-left:1.8pt;padding-right:1.8pt;">0.4799</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.6.6" style="padding-left:1.8pt;padding-right:1.8pt;">4.3893</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.6.7" style="padding-left:1.8pt;padding-right:1.8pt;">150.81</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.4.4.4.4.7">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.1" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.2" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_r" id="S5.SS3.4.4.4.4.7.3" style="padding-left:1.8pt;padding-right:1.8pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.4" style="padding-left:1.8pt;padding-right:1.8pt;">19.12</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.5" style="padding-left:1.8pt;padding-right:1.8pt;">0.4724</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.6" style="padding-left:1.8pt;padding-right:1.8pt;">4.2275</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.4.4.4.4.7.7" style="padding-left:1.8pt;padding-right:1.8pt;">153.05</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.4.4.4.4.8">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.1" style="padding-left:1.8pt;padding-right:1.8pt;">
<span class="ltx_ERROR undefined" id="S5.SS3.4.4.4.4.8.1.1">\rowcolor</span>[HTML]EFEFEF
✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.2" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_r" id="S5.SS3.4.4.4.4.8.3" style="padding-left:1.8pt;padding-right:1.8pt;">✓</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.4" style="padding-left:1.8pt;padding-right:1.8pt;">19.00</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.5" style="padding-left:1.8pt;padding-right:1.8pt;">0.4729</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.6" style="padding-left:1.8pt;padding-right:1.8pt;">4.2085</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.4.4.4.4.8.7" style="padding-left:1.8pt;padding-right:1.8pt;">148.69</td>
</tr>
</table>
</span></div>
</div>
</div>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S5.SS3.8.8" style="width:208.1pt;">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_table ltx_figure_panel" id="S5.T5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T5.2.1.1" style="font-size:90%;">Table 5</span>: </span><span class="ltx_text" id="S5.T5.3.2" style="font-size:90%;">Ablation experiments on different positions of cross-image injection.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="S5.SS3.8.8.4" style="width:228.6pt;height:71.9pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-28.8pt,9.0pt) scale(0.799,0.799) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.SS3.8.8.4.4">
<tr class="ltx_tr" id="S5.SS3.8.8.4.4.4">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_tt" id="S5.SS3.8.8.4.4.4.5" style="padding-left:1.8pt;padding-right:1.8pt;">Injection Position</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.5.5.1.1.1.1" style="padding-left:1.8pt;padding-right:1.8pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.SS3.5.5.1.1.1.1.m1.1"><semantics id="S5.SS3.5.5.1.1.1.1.m1.1a"><mo id="S5.SS3.5.5.1.1.1.1.m1.1.1" stretchy="false" xref="S5.SS3.5.5.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.5.5.1.1.1.1.m1.1b"><ci id="S5.SS3.5.5.1.1.1.1.m1.1.1.cmml" xref="S5.SS3.5.5.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.5.5.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.5.5.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.6.6.2.2.2.2" style="padding-left:1.8pt;padding-right:1.8pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.SS3.6.6.2.2.2.2.m1.1"><semantics id="S5.SS3.6.6.2.2.2.2.m1.1a"><mo id="S5.SS3.6.6.2.2.2.2.m1.1.1" stretchy="false" xref="S5.SS3.6.6.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.6.6.2.2.2.2.m1.1b"><ci id="S5.SS3.6.6.2.2.2.2.m1.1.1.cmml" xref="S5.SS3.6.6.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.6.6.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.6.6.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.7.7.3.3.3.3" style="padding-left:1.8pt;padding-right:1.8pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.SS3.7.7.3.3.3.3.m1.1"><semantics id="S5.SS3.7.7.3.3.3.3.m1.1a"><mo id="S5.SS3.7.7.3.3.3.3.m1.1.1" stretchy="false" xref="S5.SS3.7.7.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.7.7.3.3.3.3.m1.1b"><ci id="S5.SS3.7.7.3.3.3.3.m1.1.1.cmml" xref="S5.SS3.7.7.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.7.7.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.7.7.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.SS3.8.8.4.4.4.4" style="padding-left:1.8pt;padding-right:1.8pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.SS3.8.8.4.4.4.4.m1.1"><semantics id="S5.SS3.8.8.4.4.4.4.m1.1a"><mo id="S5.SS3.8.8.4.4.4.4.m1.1.1" stretchy="false" xref="S5.SS3.8.8.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.8.8.4.4.4.4.m1.1b"><ci id="S5.SS3.8.8.4.4.4.4.m1.1.1.cmml" xref="S5.SS3.8.8.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.8.8.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.8.8.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.8.8.4.4.5">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.SS3.8.8.4.4.5.1" style="padding-left:1.8pt;padding-right:1.8pt;">No Injection</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.8.8.4.4.5.2" style="padding-left:1.8pt;padding-right:1.8pt;">18.97</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.8.8.4.4.5.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4665</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.8.8.4.4.5.4" style="padding-left:1.8pt;padding-right:1.8pt;">4.5624</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.SS3.8.8.4.4.5.5" style="padding-left:1.8pt;padding-right:1.8pt;">168.26</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.8.8.4.4.6">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.SS3.8.8.4.4.6.1" style="padding-left:1.8pt;padding-right:1.8pt;">Encoder&amp;Decoder</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.6.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.09</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.6.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4773</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.6.4" style="padding-left:1.8pt;padding-right:1.8pt;">4.5241</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.6.5" style="padding-left:1.8pt;padding-right:1.8pt;">153.43</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.8.8.4.4.7">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.SS3.8.8.4.4.7.1" style="padding-left:1.8pt;padding-right:1.8pt;">Encoder Only</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.7.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.08</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.7.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4689</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.7.4" style="padding-left:1.8pt;padding-right:1.8pt;">4.6977</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.SS3.8.8.4.4.7.5" style="padding-left:1.8pt;padding-right:1.8pt;">168.26</td>
</tr>
<tr class="ltx_tr" id="S5.SS3.8.8.4.4.8">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_bb ltx_border_r" id="S5.SS3.8.8.4.4.8.1" style="padding-left:1.8pt;padding-right:1.8pt;">
<span class="ltx_ERROR undefined" id="S5.SS3.8.8.4.4.8.1.1">\rowcolor</span>[HTML]EFEFEF
Decoder Only</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.8.8.4.4.8.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.00</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.8.8.4.4.8.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4729</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.8.8.4.4.8.4" style="padding-left:1.8pt;padding-right:1.8pt;">4.2085</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.SS3.8.8.4.4.8.5" style="padding-left:1.8pt;padding-right:1.8pt;">148.69</td>
</tr>
</table>
</span></div>
</div>
</div>
</figure>
</div>
</div>
</figure>
<figure class="ltx_figure ltx_align_floatright" id="S5.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="552" id="S5.F8.g1" src="x8.png" width="663"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F8.3.1.1" style="font-size:90%;">Figure 8</span>: </span><span class="ltx_text" id="S5.F8.4.2" style="font-size:90%;">The normalized attention scores are obtained by averaging all samples and all time steps.</span></figcaption>
</figure>
<section class="ltx_paragraph" id="S5.SS3.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Domain preference problem.</h4>
<div class="ltx_para" id="S5.SS3.SSS0.Px1.p1">
<p class="ltx_p" id="S5.SS3.SSS0.Px1.p1.15">The motivation behind the proposed separate attention is to address the domain preference problem, <span class="ltx_text ltx_font_italic" id="S5.SS3.SSS0.Px1.p1.15.1">i.e.</span>, the attention in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.1.m1.1"><semantics id="S5.SS3.SSS0.Px1.p1.1.m1.1a"><msub id="S5.SS3.SSS0.Px1.p1.1.m1.1.1" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.2" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.3" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.1.m1.1b"><apply id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p1.1.m1.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.1.m1.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.1.m1.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> will prefer to use latent from the same chain even though the latent from <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.2.m2.1"><semantics id="S5.SS3.SSS0.Px1.p1.2.m2.1a"><msub id="S5.SS3.SSS0.Px1.p1.2.m2.1.1" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.2" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.3" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.2.m2.1b"><apply id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.2.m2.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> is more helpful for reconstruction. To verify the existence of the domain preference, we use the ground truth <math alttext="I_{HR}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.3.m3.1"><semantics id="S5.SS3.SSS0.Px1.p1.3.m3.1a"><msub id="S5.SS3.SSS0.Px1.p1.3.m3.1.1" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.2" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.2.cmml">I</mi><mrow id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.cmml"><mi id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.2" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.2.cmml">H</mi><mo id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.1" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.3" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.3.cmml">R</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.3.m3.1b"><apply id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.2">𝐼</ci><apply id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3"><times id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.1.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.1"></times><ci id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.2.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.2">𝐻</ci><ci id="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.3.cmml" xref="S5.SS3.SSS0.Px1.p1.3.m3.1.1.3.3">𝑅</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.3.m3.1c">I_{HR}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.3.m3.1d">italic_I start_POSTSUBSCRIPT italic_H italic_R end_POSTSUBSCRIPT</annotation></semantics></math> as the input of <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.4.m4.1"><semantics id="S5.SS3.SSS0.Px1.p1.4.m4.1a"><msub id="S5.SS3.SSS0.Px1.p1.4.m4.1.1" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.2" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.3" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.4.m4.1b"><apply id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.4.m4.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> and compute the normalized attention scores between <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.5.m5.1"><semantics id="S5.SS3.SSS0.Px1.p1.5.m5.1a"><msub id="S5.SS3.SSS0.Px1.p1.5.m5.1.1" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.2" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1.2.cmml">Q</mi><mi id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.3" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.5.m5.1b"><apply id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1.2">𝑄</ci><ci id="S5.SS3.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.5.m5.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.5.m5.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.5.m5.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.6.m6.1"><semantics id="S5.SS3.SSS0.Px1.p1.6.m6.1a"><msub id="S5.SS3.SSS0.Px1.p1.6.m6.1.1" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.2" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1.2.cmml">K</mi><mi id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.3" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.6.m6.1b"><apply id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1.2">𝐾</ci><ci id="S5.SS3.SSS0.Px1.p1.6.m6.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.6.m6.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.6.m6.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.6.m6.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.7.m7.1"><semantics id="S5.SS3.SSS0.Px1.p1.7.m7.1a"><msub id="S5.SS3.SSS0.Px1.p1.7.m7.1.1" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.2" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1.2.cmml">Q</mi><mi id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.3" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.7.m7.1b"><apply id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1.2">𝑄</ci><ci id="S5.SS3.SSS0.Px1.p1.7.m7.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.7.m7.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.7.m7.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.7.m7.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.8.m8.1"><semantics id="S5.SS3.SSS0.Px1.p1.8.m8.1a"><msub id="S5.SS3.SSS0.Px1.p1.8.m8.1.1" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.2" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1.2.cmml">K</mi><mi id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.3" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.8.m8.1b"><apply id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1.2">𝐾</ci><ci id="S5.SS3.SSS0.Px1.p1.8.m8.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.8.m8.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.8.m8.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.8.m8.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>. It can be seen in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F8" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">8</span></a> that even using the spatially strictly aligned <math alttext="I_{HQ}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.9.m9.1"><semantics id="S5.SS3.SSS0.Px1.p1.9.m9.1a"><msub id="S5.SS3.SSS0.Px1.p1.9.m9.1.1" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.2" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.2.cmml">I</mi><mrow id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.cmml"><mi id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.2" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.2.cmml">H</mi><mo id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.1" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.1.cmml">⁢</mo><mi id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.3" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.9.m9.1b"><apply id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.2">𝐼</ci><apply id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3"><times id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.1.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.1"></times><ci id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.2.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.2">𝐻</ci><ci id="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.3.cmml" xref="S5.SS3.SSS0.Px1.p1.9.m9.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.9.m9.1c">I_{HQ}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.9.m9.1d">italic_I start_POSTSUBSCRIPT italic_H italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> as the reference, <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.10.m10.1"><semantics id="S5.SS3.SSS0.Px1.p1.10.m10.1a"><msub id="S5.SS3.SSS0.Px1.p1.10.m10.1.1" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.2" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1.2.cmml">Q</mi><mi id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.3" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.10.m10.1b"><apply id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1.2">𝑄</ci><ci id="S5.SS3.SSS0.Px1.p1.10.m10.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.10.m10.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.10.m10.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.10.m10.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> still has significantly high attention for the latent from the same chain, indicating that the domain preference problem interferes with the <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.11.m11.1"><semantics id="S5.SS3.SSS0.Px1.p1.11.m11.1a"><msub id="S5.SS3.SSS0.Px1.p1.11.m11.1.1" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.2" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.3" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.11.m11.1b"><apply id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p1.11.m11.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.11.m11.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.11.m11.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.11.m11.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>’s utilization of external knowledge in <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.12.m12.1"><semantics id="S5.SS3.SSS0.Px1.p1.12.m12.1a"><msub id="S5.SS3.SSS0.Px1.p1.12.m12.1.1" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.2" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.3" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.12.m12.1b"><apply id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p1.12.m12.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.12.m12.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.12.m12.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.12.m12.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>. By contrast, the proposed separate attention can effectively mitigate this problem by forcing the <math alttext="Q_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.13.m13.1"><semantics id="S5.SS3.SSS0.Px1.p1.13.m13.1a"><msub id="S5.SS3.SSS0.Px1.p1.13.m13.1.1" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.2" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1.2.cmml">Q</mi><mi id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.3" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.13.m13.1b"><apply id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1.2">𝑄</ci><ci id="S5.SS3.SSS0.Px1.p1.13.m13.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.13.m13.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.13.m13.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.13.m13.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to separately attend <math alttext="K_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.14.m14.1"><semantics id="S5.SS3.SSS0.Px1.p1.14.m14.1a"><msub id="S5.SS3.SSS0.Px1.p1.14.m14.1.1" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.2" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1.2.cmml">K</mi><mi id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.3" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.14.m14.1b"><apply id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1.2">𝐾</ci><ci id="S5.SS3.SSS0.Px1.p1.14.m14.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.14.m14.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.14.m14.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.14.m14.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p1.15.m15.1"><semantics id="S5.SS3.SSS0.Px1.p1.15.m15.1a"><msub id="S5.SS3.SSS0.Px1.p1.15.m15.1.1" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1.cmml"><mi id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.2" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1.2.cmml">K</mi><mi id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.3" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p1.15.m15.1b"><apply id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1.2">𝐾</ci><ci id="S5.SS3.SSS0.Px1.p1.15.m15.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p1.15.m15.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p1.15.m15.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p1.15.m15.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS3.SSS0.Px1.p2">
<p class="ltx_p" id="S5.SS3.SSS0.Px1.p2.3"><span class="ltx_text ltx_font_bold" id="S5.SS3.SSS0.Px1.p2.3.1">Other choices on injection position.</span>
In <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S3" title="3 Probing Large Restoration Models ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Sec.</span> <span class="ltx_text ltx_ref_tag">3</span></a>, we find the diffusion decoder is responsible for restoring textures. Based on this observation we propose to apply cross-image injection on the UNet decoder. Here, we ablate to analyze the impact of different cross-image injection positions. The results are shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T5" title="In 5.3 Ablation Studies ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">5</span></a>. It can be seen that performing cross-image injection only on the encoder will cause 19.57 FID drops. This is because the encoder focuses on the structure reconstruction, thus transferring the structure of <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p2.1.m1.1"><semantics id="S5.SS3.SSS0.Px1.p2.1.m1.1a"><msub id="S5.SS3.SSS0.Px1.p2.1.m1.1.1" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.2" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.3" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p2.1.m1.1b"><apply id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p2.1.m1.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p2.1.m1.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p2.1.m1.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p2.1.m1.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> will destroy the layout of the <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p2.2.m2.1"><semantics id="S5.SS3.SSS0.Px1.p2.2.m2.1a"><msub id="S5.SS3.SSS0.Px1.p2.2.m2.1.1" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.2" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.3" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p2.2.m2.1b"><apply id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p2.2.m2.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p2.2.m2.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p2.2.m2.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p2.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>. Moreover, performing injection only in the decoder achieves the best results since it can transfer the high-quality textures from the <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="S5.SS3.SSS0.Px1.p2.3.m3.1"><semantics id="S5.SS3.SSS0.Px1.p2.3.m3.1a"><msub id="S5.SS3.SSS0.Px1.p2.3.m3.1.1" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.2" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1.2.cmml">𝒞</mi><mi id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.3" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.SSS0.Px1.p2.3.m3.1b"><apply id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.1.cmml" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1">subscript</csymbol><ci id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.2.cmml" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1.2">𝒞</ci><ci id="S5.SS3.SSS0.Px1.p2.3.m3.1.1.3.cmml" xref="S5.SS3.SSS0.Px1.p2.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.SSS0.Px1.p2.3.m3.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.SSS0.Px1.p2.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>. Due to the page limit, more ablation experiments can be seen in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3" title="Appendix C More Ablation Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">C</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S5.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4 </span>Discussions</h3>
<div class="ltx_para ltx_noindent" id="S5.SS4.p1">
<p class="ltx_p" id="S5.SS4.p1.6"><span class="ltx_text ltx_font_bold" id="S5.SS4.p1.6.1">What is the impact of the control scale?</span>
The scale <math alttext="s" class="ltx_Math" display="inline" id="S5.SS4.p1.1.m1.1"><semantics id="S5.SS4.p1.1.m1.1a"><mi id="S5.SS4.p1.1.m1.1.1" xref="S5.SS4.p1.1.m1.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.1.m1.1b"><ci id="S5.SS4.p1.1.m1.1.1.cmml" xref="S5.SS4.p1.1.m1.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.1.m1.1c">s</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.1.m1.1d">italic_s</annotation></semantics></math> in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.E2" title="In 4.2 Cross Image Injection for High-fidelity Image Restoration ‣ 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">2</span></a> can control the extent to which the LRMs use external knowledge from the retrieved reference image for restoration. Here, we conduct an ablation study to explore the effect of <math alttext="s" class="ltx_Math" display="inline" id="S5.SS4.p1.2.m2.1"><semantics id="S5.SS4.p1.2.m2.1a"><mi id="S5.SS4.p1.2.m2.1.1" xref="S5.SS4.p1.2.m2.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.2.m2.1b"><ci id="S5.SS4.p1.2.m2.1.1.cmml" xref="S5.SS4.p1.2.m2.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.2.m2.1c">s</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.2.m2.1d">italic_s</annotation></semantics></math>. The results are shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F9" title="In 5.4 Discussions ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">9</span></a>. It can be seen that when <math alttext="s" class="ltx_Math" display="inline" id="S5.SS4.p1.3.m3.1"><semantics id="S5.SS4.p1.3.m3.1a"><mi id="S5.SS4.p1.3.m3.1.1" xref="S5.SS4.p1.3.m3.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.3.m3.1b"><ci id="S5.SS4.p1.3.m3.1.1.cmml" xref="S5.SS4.p1.3.m3.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.3.m3.1c">s</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.3.m3.1d">italic_s</annotation></semantics></math> takes smaller values, the model mainly uses the internal knowledge embedded in its own parameters, which can make the model hallucinate when the degradation is severe. For example, the model produces incorrect textures when <math alttext="s=0" class="ltx_Math" display="inline" id="S5.SS4.p1.4.m4.1"><semantics id="S5.SS4.p1.4.m4.1a"><mrow id="S5.SS4.p1.4.m4.1.1" xref="S5.SS4.p1.4.m4.1.1.cmml"><mi id="S5.SS4.p1.4.m4.1.1.2" xref="S5.SS4.p1.4.m4.1.1.2.cmml">s</mi><mo id="S5.SS4.p1.4.m4.1.1.1" xref="S5.SS4.p1.4.m4.1.1.1.cmml">=</mo><mn id="S5.SS4.p1.4.m4.1.1.3" xref="S5.SS4.p1.4.m4.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.4.m4.1b"><apply id="S5.SS4.p1.4.m4.1.1.cmml" xref="S5.SS4.p1.4.m4.1.1"><eq id="S5.SS4.p1.4.m4.1.1.1.cmml" xref="S5.SS4.p1.4.m4.1.1.1"></eq><ci id="S5.SS4.p1.4.m4.1.1.2.cmml" xref="S5.SS4.p1.4.m4.1.1.2">𝑠</ci><cn id="S5.SS4.p1.4.m4.1.1.3.cmml" type="integer" xref="S5.SS4.p1.4.m4.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.4.m4.1c">s=0</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.4.m4.1d">italic_s = 0</annotation></semantics></math>. As <math alttext="s" class="ltx_Math" display="inline" id="S5.SS4.p1.5.m5.1"><semantics id="S5.SS4.p1.5.m5.1a"><mi id="S5.SS4.p1.5.m5.1.1" xref="S5.SS4.p1.5.m5.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.5.m5.1b"><ci id="S5.SS4.p1.5.m5.1.1.cmml" xref="S5.SS4.p1.5.m5.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.5.m5.1c">s</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.5.m5.1d">italic_s</annotation></semantics></math> increases, the model starts to use external knowledge from the retrieved reference image, from which the model’s hallucination problem can be alleviated. We also provide quantitative ablation experiments on <math alttext="s" class="ltx_Math" display="inline" id="S5.SS4.p1.6.m6.1"><semantics id="S5.SS4.p1.6.m6.1a"><mi id="S5.SS4.p1.6.m6.1.1" xref="S5.SS4.p1.6.m6.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p1.6.m6.1b"><ci id="S5.SS4.p1.6.m6.1.1.cmml" xref="S5.SS4.p1.6.m6.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p1.6.m6.1c">s</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p1.6.m6.1d">italic_s</annotation></semantics></math> in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3.SS0.SSS0.Px1" title="Quantitative ablation on the control scale. ‣ Appendix C More Ablation Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Appendix</span> <span class="ltx_text ltx_ref_tag">C</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS4.p2">
<p class="ltx_p" id="S5.SS4.p2.5"><span class="ltx_text ltx_font_bold" id="S5.SS4.p2.5.1">How much do the reference images affect performance?</span>
In the proposed framework, the retrieved images <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S5.SS4.p2.1.m1.1"><semantics id="S5.SS4.p2.1.m1.1a"><msub id="S5.SS4.p2.1.m1.1.1" xref="S5.SS4.p2.1.m1.1.1.cmml"><mi id="S5.SS4.p2.1.m1.1.1.2" xref="S5.SS4.p2.1.m1.1.1.2.cmml">𝐈</mi><mi id="S5.SS4.p2.1.m1.1.1.3" xref="S5.SS4.p2.1.m1.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.1.m1.1b"><apply id="S5.SS4.p2.1.m1.1.1.cmml" xref="S5.SS4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.1.m1.1.1.1.cmml" xref="S5.SS4.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS4.p2.1.m1.1.1.2.cmml" xref="S5.SS4.p2.1.m1.1.1.2">𝐈</ci><ci id="S5.SS4.p2.1.m1.1.1.3.cmml" xref="S5.SS4.p2.1.m1.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.1.m1.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.1.m1.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> is crucial in alleviating hallucinations. Here, we try to answer the role of <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S5.SS4.p2.2.m2.1"><semantics id="S5.SS4.p2.2.m2.1a"><msub id="S5.SS4.p2.2.m2.1.1" xref="S5.SS4.p2.2.m2.1.1.cmml"><mi id="S5.SS4.p2.2.m2.1.1.2" xref="S5.SS4.p2.2.m2.1.1.2.cmml">𝐈</mi><mi id="S5.SS4.p2.2.m2.1.1.3" xref="S5.SS4.p2.2.m2.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.2.m2.1b"><apply id="S5.SS4.p2.2.m2.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.2.m2.1.1.1.cmml" xref="S5.SS4.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS4.p2.2.m2.1.1.2.cmml" xref="S5.SS4.p2.2.m2.1.1.2">𝐈</ci><ci id="S5.SS4.p2.2.m2.1.1.3.cmml" xref="S5.SS4.p2.2.m2.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.2.m2.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.2.m2.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> during restoration process, by manually controlling different types of retrieved images.
As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T6" title="In Figure 10 ‣ 5.4 Discussions ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">6</span></a>, we find that using the exact ground truth <math alttext="I_{HQ}" class="ltx_Math" display="inline" id="S5.SS4.p2.3.m3.1"><semantics id="S5.SS4.p2.3.m3.1a"><msub id="S5.SS4.p2.3.m3.1.1" xref="S5.SS4.p2.3.m3.1.1.cmml"><mi id="S5.SS4.p2.3.m3.1.1.2" xref="S5.SS4.p2.3.m3.1.1.2.cmml">I</mi><mrow id="S5.SS4.p2.3.m3.1.1.3" xref="S5.SS4.p2.3.m3.1.1.3.cmml"><mi id="S5.SS4.p2.3.m3.1.1.3.2" xref="S5.SS4.p2.3.m3.1.1.3.2.cmml">H</mi><mo id="S5.SS4.p2.3.m3.1.1.3.1" xref="S5.SS4.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.3.m3.1.1.3.3" xref="S5.SS4.p2.3.m3.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.3.m3.1b"><apply id="S5.SS4.p2.3.m3.1.1.cmml" xref="S5.SS4.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.3.m3.1.1.1.cmml" xref="S5.SS4.p2.3.m3.1.1">subscript</csymbol><ci id="S5.SS4.p2.3.m3.1.1.2.cmml" xref="S5.SS4.p2.3.m3.1.1.2">𝐼</ci><apply id="S5.SS4.p2.3.m3.1.1.3.cmml" xref="S5.SS4.p2.3.m3.1.1.3"><times id="S5.SS4.p2.3.m3.1.1.3.1.cmml" xref="S5.SS4.p2.3.m3.1.1.3.1"></times><ci id="S5.SS4.p2.3.m3.1.1.3.2.cmml" xref="S5.SS4.p2.3.m3.1.1.3.2">𝐻</ci><ci id="S5.SS4.p2.3.m3.1.1.3.3.cmml" xref="S5.SS4.p2.3.m3.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.3.m3.1c">I_{HQ}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.3.m3.1d">italic_I start_POSTSUBSCRIPT italic_H italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> as the <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="S5.SS4.p2.4.m4.1"><semantics id="S5.SS4.p2.4.m4.1a"><msub id="S5.SS4.p2.4.m4.1.1" xref="S5.SS4.p2.4.m4.1.1.cmml"><mi id="S5.SS4.p2.4.m4.1.1.2" xref="S5.SS4.p2.4.m4.1.1.2.cmml">𝐈</mi><mi id="S5.SS4.p2.4.m4.1.1.3" xref="S5.SS4.p2.4.m4.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.4.m4.1b"><apply id="S5.SS4.p2.4.m4.1.1.cmml" xref="S5.SS4.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.4.m4.1.1.1.cmml" xref="S5.SS4.p2.4.m4.1.1">subscript</csymbol><ci id="S5.SS4.p2.4.m4.1.1.2.cmml" xref="S5.SS4.p2.4.m4.1.1.2">𝐈</ci><ci id="S5.SS4.p2.4.m4.1.1.3.cmml" xref="S5.SS4.p2.4.m4.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.4.m4.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.4.m4.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> can further improve the performance, which can be seen as an ideal up-bound. Interestingly, using <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S5.SS4.p2.5.m5.1"><semantics id="S5.SS4.p2.5.m5.1a"><msub id="S5.SS4.p2.5.m5.1.1" xref="S5.SS4.p2.5.m5.1.1.cmml"><mi id="S5.SS4.p2.5.m5.1.1.2" xref="S5.SS4.p2.5.m5.1.1.2.cmml">I</mi><mrow id="S5.SS4.p2.5.m5.1.1.3" xref="S5.SS4.p2.5.m5.1.1.3.cmml"><mi id="S5.SS4.p2.5.m5.1.1.3.2" xref="S5.SS4.p2.5.m5.1.1.3.2.cmml">L</mi><mo id="S5.SS4.p2.5.m5.1.1.3.1" xref="S5.SS4.p2.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S5.SS4.p2.5.m5.1.1.3.3" xref="S5.SS4.p2.5.m5.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS4.p2.5.m5.1b"><apply id="S5.SS4.p2.5.m5.1.1.cmml" xref="S5.SS4.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS4.p2.5.m5.1.1.1.cmml" xref="S5.SS4.p2.5.m5.1.1">subscript</csymbol><ci id="S5.SS4.p2.5.m5.1.1.2.cmml" xref="S5.SS4.p2.5.m5.1.1.2">𝐼</ci><apply id="S5.SS4.p2.5.m5.1.1.3.cmml" xref="S5.SS4.p2.5.m5.1.1.3"><times id="S5.SS4.p2.5.m5.1.1.3.1.cmml" xref="S5.SS4.p2.5.m5.1.1.3.1"></times><ci id="S5.SS4.p2.5.m5.1.1.3.2.cmml" xref="S5.SS4.p2.5.m5.1.1.3.2">𝐿</ci><ci id="S5.SS4.p2.5.m5.1.1.3.3.cmml" xref="S5.SS4.p2.5.m5.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p2.5.m5.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p2.5.m5.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> itself as its own retrieved image instead brings a slight improvement compared with no retrieval, which we attribute to the regularization effect from the distribution alignment strategy. Finally, randomly selecting a high-quality reference image even resulted in a huge performance degradation, suggesting that the content correlation is more important than the image quality for a favorable retrieved reference image.</p>
</div>
<figure class="ltx_figure" id="S5.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="276" id="S5.F9.g1" src="x9.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F9.6.3.1" style="font-size:90%;">Figure 9</span>: </span><span class="ltx_text" id="S5.F9.4.2" style="font-size:90%;">Ablation visualization on the control scale <math alttext="s" class="ltx_Math" display="inline" id="S5.F9.3.1.m1.1"><semantics id="S5.F9.3.1.m1.1b"><mi id="S5.F9.3.1.m1.1.1" xref="S5.F9.3.1.m1.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.F9.3.1.m1.1c"><ci id="S5.F9.3.1.m1.1.1.cmml" xref="S5.F9.3.1.m1.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F9.3.1.m1.1d">s</annotation><annotation encoding="application/x-llamapun" id="S5.F9.3.1.m1.1e">italic_s</annotation></semantics></math>. As <math alttext="s" class="ltx_Math" display="inline" id="S5.F9.4.2.m2.1"><semantics id="S5.F9.4.2.m2.1b"><mi id="S5.F9.4.2.m2.1.1" xref="S5.F9.4.2.m2.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.F9.4.2.m2.1c"><ci id="S5.F9.4.2.m2.1.1.cmml" xref="S5.F9.4.2.m2.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F9.4.2.m2.1d">s</annotation><annotation encoding="application/x-llamapun" id="S5.F9.4.2.m2.1e">italic_s</annotation></semantics></math> increases, the LRM utilizes the external knowledge from retrieved reference images to mitigate hallucination. Zoom in for better effects.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S5.F10">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S5.F10.5" style="width:208.1pt;">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_table ltx_figure_panel" id="S5.T6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S5.T6.8.4.1" style="font-size:90%;">Table 6</span>: </span><span class="ltx_text" id="S5.T6.6.3" style="font-size:90%;">The performance impact of reference images. NoRef means no reference image is used. HQRef denotes the corresponding <math alttext="I_{HQ}" class="ltx_Math" display="inline" id="S5.T6.4.1.m1.1"><semantics id="S5.T6.4.1.m1.1b"><msub id="S5.T6.4.1.m1.1.1" xref="S5.T6.4.1.m1.1.1.cmml"><mi id="S5.T6.4.1.m1.1.1.2" xref="S5.T6.4.1.m1.1.1.2.cmml">I</mi><mrow id="S5.T6.4.1.m1.1.1.3" xref="S5.T6.4.1.m1.1.1.3.cmml"><mi id="S5.T6.4.1.m1.1.1.3.2" xref="S5.T6.4.1.m1.1.1.3.2.cmml">H</mi><mo id="S5.T6.4.1.m1.1.1.3.1" xref="S5.T6.4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S5.T6.4.1.m1.1.1.3.3" xref="S5.T6.4.1.m1.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T6.4.1.m1.1c"><apply id="S5.T6.4.1.m1.1.1.cmml" xref="S5.T6.4.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T6.4.1.m1.1.1.1.cmml" xref="S5.T6.4.1.m1.1.1">subscript</csymbol><ci id="S5.T6.4.1.m1.1.1.2.cmml" xref="S5.T6.4.1.m1.1.1.2">𝐼</ci><apply id="S5.T6.4.1.m1.1.1.3.cmml" xref="S5.T6.4.1.m1.1.1.3"><times id="S5.T6.4.1.m1.1.1.3.1.cmml" xref="S5.T6.4.1.m1.1.1.3.1"></times><ci id="S5.T6.4.1.m1.1.1.3.2.cmml" xref="S5.T6.4.1.m1.1.1.3.2">𝐻</ci><ci id="S5.T6.4.1.m1.1.1.3.3.cmml" xref="S5.T6.4.1.m1.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.4.1.m1.1d">I_{HQ}</annotation><annotation encoding="application/x-llamapun" id="S5.T6.4.1.m1.1e">italic_I start_POSTSUBSCRIPT italic_H italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> is used as the reference. SelfRef represents using <math alttext="\times 4" class="ltx_Math" display="inline" id="S5.T6.5.2.m2.1"><semantics id="S5.T6.5.2.m2.1b"><mrow id="S5.T6.5.2.m2.1.1" xref="S5.T6.5.2.m2.1.1.cmml"><mi id="S5.T6.5.2.m2.1.1.2" xref="S5.T6.5.2.m2.1.1.2.cmml"></mi><mo id="S5.T6.5.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S5.T6.5.2.m2.1.1.1.cmml">×</mo><mn id="S5.T6.5.2.m2.1.1.3" xref="S5.T6.5.2.m2.1.1.3.cmml">4</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.T6.5.2.m2.1c"><apply id="S5.T6.5.2.m2.1.1.cmml" xref="S5.T6.5.2.m2.1.1"><times id="S5.T6.5.2.m2.1.1.1.cmml" xref="S5.T6.5.2.m2.1.1.1"></times><csymbol cd="latexml" id="S5.T6.5.2.m2.1.1.2.cmml" xref="S5.T6.5.2.m2.1.1.2">absent</csymbol><cn id="S5.T6.5.2.m2.1.1.3.cmml" type="integer" xref="S5.T6.5.2.m2.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.5.2.m2.1d">\times 4</annotation><annotation encoding="application/x-llamapun" id="S5.T6.5.2.m2.1e">× 4</annotation></semantics></math> bicubic upsampling of <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="S5.T6.6.3.m3.1"><semantics id="S5.T6.6.3.m3.1b"><msub id="S5.T6.6.3.m3.1.1" xref="S5.T6.6.3.m3.1.1.cmml"><mi id="S5.T6.6.3.m3.1.1.2" xref="S5.T6.6.3.m3.1.1.2.cmml">I</mi><mrow id="S5.T6.6.3.m3.1.1.3" xref="S5.T6.6.3.m3.1.1.3.cmml"><mi id="S5.T6.6.3.m3.1.1.3.2" xref="S5.T6.6.3.m3.1.1.3.2.cmml">L</mi><mo id="S5.T6.6.3.m3.1.1.3.1" xref="S5.T6.6.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.T6.6.3.m3.1.1.3.3" xref="S5.T6.6.3.m3.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T6.6.3.m3.1c"><apply id="S5.T6.6.3.m3.1.1.cmml" xref="S5.T6.6.3.m3.1.1"><csymbol cd="ambiguous" id="S5.T6.6.3.m3.1.1.1.cmml" xref="S5.T6.6.3.m3.1.1">subscript</csymbol><ci id="S5.T6.6.3.m3.1.1.2.cmml" xref="S5.T6.6.3.m3.1.1.2">𝐼</ci><apply id="S5.T6.6.3.m3.1.1.3.cmml" xref="S5.T6.6.3.m3.1.1.3"><times id="S5.T6.6.3.m3.1.1.3.1.cmml" xref="S5.T6.6.3.m3.1.1.3.1"></times><ci id="S5.T6.6.3.m3.1.1.3.2.cmml" xref="S5.T6.6.3.m3.1.1.3.2">𝐿</ci><ci id="S5.T6.6.3.m3.1.1.3.3.cmml" xref="S5.T6.6.3.m3.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.6.3.m3.1d">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="S5.T6.6.3.m3.1e">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> for reference. Random means randomly selecting a high-quality image as the reference.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="S5.F10.5.5" style="width:196.1pt;height:86.3pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-24.7pt,10.9pt) scale(0.799,0.799) ;">
<table class="ltx_tabular ltx_align_middle" id="S5.F10.5.5.5">
<tr class="ltx_tr" id="S5.F10.5.5.5.5">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_tt" id="S5.F10.5.5.5.5.6" style="padding-left:1.8pt;padding-right:1.8pt;">Settings</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.F10.1.1.1.1.1" style="padding-left:1.8pt;padding-right:1.8pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.F10.1.1.1.1.1.m1.1"><semantics id="S5.F10.1.1.1.1.1.m1.1a"><mo id="S5.F10.1.1.1.1.1.m1.1.1" stretchy="false" xref="S5.F10.1.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.F10.1.1.1.1.1.m1.1b"><ci id="S5.F10.1.1.1.1.1.m1.1.1.cmml" xref="S5.F10.1.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.1.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.F10.1.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.F10.2.2.2.2.2" style="padding-left:1.8pt;padding-right:1.8pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.F10.2.2.2.2.2.m1.1"><semantics id="S5.F10.2.2.2.2.2.m1.1a"><mo id="S5.F10.2.2.2.2.2.m1.1.1" stretchy="false" xref="S5.F10.2.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.F10.2.2.2.2.2.m1.1b"><ci id="S5.F10.2.2.2.2.2.m1.1.1.cmml" xref="S5.F10.2.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.2.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.F10.2.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.F10.3.3.3.3.3" style="padding-left:1.8pt;padding-right:1.8pt;">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.F10.3.3.3.3.3.m1.1"><semantics id="S5.F10.3.3.3.3.3.m1.1a"><mo id="S5.F10.3.3.3.3.3.m1.1.1" stretchy="false" xref="S5.F10.3.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.F10.3.3.3.3.3.m1.1b"><ci id="S5.F10.3.3.3.3.3.m1.1.1.cmml" xref="S5.F10.3.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.3.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.F10.3.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.F10.4.4.4.4.4" style="padding-left:1.8pt;padding-right:1.8pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.F10.4.4.4.4.4.m1.1"><semantics id="S5.F10.4.4.4.4.4.m1.1a"><mo id="S5.F10.4.4.4.4.4.m1.1.1" stretchy="false" xref="S5.F10.4.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.F10.4.4.4.4.4.m1.1b"><ci id="S5.F10.4.4.4.4.4.m1.1.1.cmml" xref="S5.F10.4.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.4.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.F10.4.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.F10.5.5.5.5.5" style="padding-left:1.8pt;padding-right:1.8pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="S5.F10.5.5.5.5.5.m1.1"><semantics id="S5.F10.5.5.5.5.5.m1.1a"><mo id="S5.F10.5.5.5.5.5.m1.1.1" stretchy="false" xref="S5.F10.5.5.5.5.5.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="S5.F10.5.5.5.5.5.m1.1b"><ci id="S5.F10.5.5.5.5.5.m1.1.1.cmml" xref="S5.F10.5.5.5.5.5.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.5.5.5.5.5.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="S5.F10.5.5.5.5.5.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S5.F10.5.5.5.6">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.F10.5.5.5.6.1" style="padding-left:1.8pt;padding-right:1.8pt;">NoRef</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.F10.5.5.5.6.2" style="padding-left:1.8pt;padding-right:1.8pt;">18.97</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.F10.5.5.5.6.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4665</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.F10.5.5.5.6.4" style="padding-left:1.8pt;padding-right:1.8pt;">0.4807</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.F10.5.5.5.6.5" style="padding-left:1.8pt;padding-right:1.8pt;">4.5624</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.F10.5.5.5.6.6" style="padding-left:1.8pt;padding-right:1.8pt;">168.26</td>
</tr>
<tr class="ltx_tr" id="S5.F10.5.5.5.7">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.F10.5.5.5.7.1" style="padding-left:1.8pt;padding-right:1.8pt;">HQRef</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.7.2" style="padding-left:1.8pt;padding-right:1.8pt;">19,41</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.7.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.5033</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.7.4" style="padding-left:1.8pt;padding-right:1.8pt;">0.3928</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.7.5" style="padding-left:1.8pt;padding-right:1.8pt;">4.0764</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.7.6" style="padding-left:1.8pt;padding-right:1.8pt;">137.52</td>
</tr>
<tr class="ltx_tr" id="S5.F10.5.5.5.8">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.F10.5.5.5.8.1" style="padding-left:1.8pt;padding-right:1.8pt;">SelfRef</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.8.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.16</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.8.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4795</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.8.4" style="padding-left:1.8pt;padding-right:1.8pt;">0.4761</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.8.5" style="padding-left:1.8pt;padding-right:1.8pt;">4.5501</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.8.6" style="padding-left:1.8pt;padding-right:1.8pt;">163.94</td>
</tr>
<tr class="ltx_tr" id="S5.F10.5.5.5.9">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.F10.5.5.5.9.1" style="padding-left:1.8pt;padding-right:1.8pt;">Random</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.9.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.53</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.9.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.5138</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.9.4" style="padding-left:1.8pt;padding-right:1.8pt;">0.5354</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.9.5" style="padding-left:1.8pt;padding-right:1.8pt;">5.3796</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.F10.5.5.5.9.6" style="padding-left:1.8pt;padding-right:1.8pt;">223.47</td>
</tr>
<tr class="ltx_tr" id="S5.F10.5.5.5.10">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_bb ltx_border_r" id="S5.F10.5.5.5.10.1" style="padding-left:1.8pt;padding-right:1.8pt;">
<span class="ltx_ERROR undefined" id="S5.F10.5.5.5.10.1.1">\rowcolor</span>Gray
Baseline</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.F10.5.5.5.10.2" style="padding-left:1.8pt;padding-right:1.8pt;">19.00</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.F10.5.5.5.10.3" style="padding-left:1.8pt;padding-right:1.8pt;">0.4729</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.F10.5.5.5.10.4" style="padding-left:1.8pt;padding-right:1.8pt;">0.4341</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.F10.5.5.5.10.5" style="padding-left:1.8pt;padding-right:1.8pt;">4.2085</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.F10.5.5.5.10.6" style="padding-left:1.8pt;padding-right:1.8pt;">148.69</td>
</tr>
</table>
</span></div>
</div>
</div>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S5.F10.6" style="width:208.1pt;">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F10.6.1.1.1" style="font-size:90%;">Figure 10</span>: </span><span class="ltx_text" id="S5.F10.6.2.2" style="font-size:90%;">An explanation of how the proposed retrieval augmented framework affects the restoration process of existing LRMs.</span></figcaption><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="428" id="S5.F10.6.g1" src="x10.png" width="664"/>
</figure>
</div>
</div>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS4.p3">
<p class="ltx_p" id="S5.SS4.p3.2"><span class="ltx_text ltx_font_bold" id="S5.SS4.p3.2.1">How does the proposed ReFIR work?</span>
Extensive experiments have shown the state-of-the-art performance of our ReFIR. However, it seems not straightforward to understand how the retrieved reference images influence the image restoration process of the original LRMs. Here, we give an intuitive explanation. As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.F10" title="In 5.4 Discussions ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">10</span></a>, for the latent at the <math alttext="t" class="ltx_Math" display="inline" id="S5.SS4.p3.1.m1.1"><semantics id="S5.SS4.p3.1.m1.1a"><mi id="S5.SS4.p3.1.m1.1.1" xref="S5.SS4.p3.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S5.SS4.p3.1.m1.1b"><ci id="S5.SS4.p3.1.m1.1.1.cmml" xref="S5.SS4.p3.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p3.1.m1.1c">t</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p3.1.m1.1d">italic_t</annotation></semantics></math>-th time step on the latent manifold, there are two forces in different directions pulling it to produce the latent at the next <math alttext="t-1" class="ltx_Math" display="inline" id="S5.SS4.p3.2.m2.1"><semantics id="S5.SS4.p3.2.m2.1a"><mrow id="S5.SS4.p3.2.m2.1.1" xref="S5.SS4.p3.2.m2.1.1.cmml"><mi id="S5.SS4.p3.2.m2.1.1.2" xref="S5.SS4.p3.2.m2.1.1.2.cmml">t</mi><mo id="S5.SS4.p3.2.m2.1.1.1" xref="S5.SS4.p3.2.m2.1.1.1.cmml">−</mo><mn id="S5.SS4.p3.2.m2.1.1.3" xref="S5.SS4.p3.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS4.p3.2.m2.1b"><apply id="S5.SS4.p3.2.m2.1.1.cmml" xref="S5.SS4.p3.2.m2.1.1"><minus id="S5.SS4.p3.2.m2.1.1.1.cmml" xref="S5.SS4.p3.2.m2.1.1.1"></minus><ci id="S5.SS4.p3.2.m2.1.1.2.cmml" xref="S5.SS4.p3.2.m2.1.1.2">𝑡</ci><cn id="S5.SS4.p3.2.m2.1.1.3.cmml" type="integer" xref="S5.SS4.p3.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS4.p3.2.m2.1c">t-1</annotation><annotation encoding="application/x-llamapun" id="S5.SS4.p3.2.m2.1d">italic_t - 1</annotation></semantics></math>-th time step. One force is from the internal knowledge of frozen weights in LRMs, and the other is the external knowledge from the retrieved reference image through the proposed cross image injection mechanism. These two forces ultimately determine the latent of the next time step. Therefore, a restored image from our ReFIR can utilize both the internal knowledge in the original LRMs as well as the external knowledge in the retrieved image, thus alleviating the hallucination of the LRMs.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">This paper presents ReFIR, a training-free and generic framework that can alleviate the hallucination of LRMs to facilitate high-fidelity and photo-realistic restoration results through retrieval augmentation. We introduce the nearest neighbor lookup as a simple retriever to obtain relevant high-quality images and further propose the cross-image injection which employs separate attention to transfer knowledge while avoiding the domain preference problem, the spatial adaptive gating to address the spatial misalignment, and the distribution alignment to mitigate the domain gap during injection. Through expanding the knowledge boundary using the additional external knowledge from retrieved images, our ReFIR exhibits significant improvements on both fidelity and perceptual quality, as demonstrated through extensive qualitative and quantitative evaluations. Moreover, with its training-free and generic nature, our ReFIR can be easily applied to multiple LRMs.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">This work is supported in part by the National Natural Science Foundation of China, under Grant (62302309,62171248), Shenzhen Science and Technology Program (JCYJ20220818101014030, JCYJ20220818101012025), and the PCNL KEY project (PCL2023AS6-1).</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography" style="font-size:90%;">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib1.2.2.1" style="font-size:90%;">[1]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib1.4.1" style="font-size:90%;">
Chao Dong, Chen Change Loy, Kaiming He, and Xiaoou Tang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib1.5.1" style="font-size:90%;">Learning a deep convolutional network for image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib1.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib1.7.2" style="font-size:90%;">ECCV</span><span class="ltx_text" id="bib.bib1.8.3" style="font-size:90%;">, pages 184–199. Springer, 2014.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib2.2.2.1" style="font-size:90%;">[2]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.4.1" style="font-size:90%;">
Tao Dai, Jianrui Cai, Yongbing Zhang, Shu-Tao Xia, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.5.1" style="font-size:90%;">Second-order attention network for single image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib2.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib2.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib2.8.3" style="font-size:90%;">, pages 11065–11074, 2019.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib3.2.2.1" style="font-size:90%;">[3]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib3.4.1" style="font-size:90%;">
Hang Guo, Jinmin Li, Tao Dai, Zhihao Ouyang, Xudong Ren, and Shu-Tao Xia.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib3.5.1" style="font-size:90%;">MambaIR: A simple baseline for image restoration with state-space model.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib3.6.1" style="font-size:90%;">arXiv preprint arXiv:2402.15648</span><span class="ltx_text" id="bib.bib3.7.2" style="font-size:90%;">, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib4.2.2.1" style="font-size:90%;">[4]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.4.1" style="font-size:90%;">
Kai Zhang, Wangmeng Zuo, Shuhang Gu, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.5.1" style="font-size:90%;">Learning deep cnn denoiser prior for image restoration.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib4.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib4.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib4.8.3" style="font-size:90%;">, pages 3929–3938, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib5.2.2.1" style="font-size:90%;">[5]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.4.1" style="font-size:90%;">
Hanting Chen, Yunhe Wang, Tianyu Guo, Chang Xu, Yiping Deng, Zhenhua Liu, Siwei Ma, Chunjing Xu, Chao Xu, and Wen Gao.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.5.1" style="font-size:90%;">Pre-trained image processing transformer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib5.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib5.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib5.8.3" style="font-size:90%;">, pages 12299–12310, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib6.2.2.1" style="font-size:90%;">[6]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib6.4.1" style="font-size:90%;">
Wenbo Li, Xin Lu, Shengju Qian, Jiangbo Lu, Xiangyu Zhang, and Jiaya Jia.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib6.5.1" style="font-size:90%;">On efficient transformer-based image pre-training for low-level vision.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib6.6.1" style="font-size:90%;">arXiv preprint arXiv:2112.10175</span><span class="ltx_text" id="bib.bib6.7.2" style="font-size:90%;">, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib7.2.2.1" style="font-size:90%;">[7]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.4.1" style="font-size:90%;">
Jingyun Liang, Jiezhang Cao, Guolei Sun, Kai Zhang, Luc Van Gool, and Radu Timofte.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.5.1" style="font-size:90%;">SwinIR: Image restoration using swin transformer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib7.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib7.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib7.8.3" style="font-size:90%;">, pages 1833–1844, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib8.2.2.1" style="font-size:90%;">[8]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib8.4.1" style="font-size:90%;">
Xintao Wang, Liangbin Xie, Chao Dong, and Ying Shan.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib8.5.1" style="font-size:90%;">Real-ESRGAN: Training real-world blind super-resolution with pure synthetic data.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib8.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib8.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib8.8.3" style="font-size:90%;">, pages 1905–1914, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib9.2.2.1" style="font-size:90%;">[9]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.4.1" style="font-size:90%;">
Kai Zhang, Jingyun Liang, Luc Van Gool, and Radu Timofte.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.5.1" style="font-size:90%;">Designing a practical degradation model for deep blind image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib9.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib9.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib9.8.3" style="font-size:90%;">, pages 4791–4800, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib10.2.2.1" style="font-size:90%;">[10]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib10.4.1" style="font-size:90%;">
Jonathan Ho, Ajay Jain, and Pieter Abbeel.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib10.5.1" style="font-size:90%;">Denoising diffusion probabilistic models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib10.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib10.7.2" style="font-size:90%;">, 33:6840–6851, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib11.2.2.1" style="font-size:90%;">[11]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib11.4.1" style="font-size:90%;">
Jiaming Song, Chenlin Meng, and Stefano Ermon.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib11.5.1" style="font-size:90%;">Denoising diffusion implicit models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib11.6.1" style="font-size:90%;">arXiv preprint arXiv:2010.02502</span><span class="ltx_text" id="bib.bib11.7.2" style="font-size:90%;">, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib12.2.2.1" style="font-size:90%;">[12]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.4.1" style="font-size:90%;">
Ben Fei, Zhaoyang Lyu, Liang Pan, Junzhe Zhang, Weidong Yang, Tianyue Luo, Bo Zhang, and Bo Dai.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.5.1" style="font-size:90%;">Generative diffusion prior for unified image restoration and enhancement.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib12.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib12.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib12.8.3" style="font-size:90%;">, pages 9935–9946, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib13.2.2.1" style="font-size:90%;">[13]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib13.4.1" style="font-size:90%;">
Bahjat Kawar, Michael Elad, Stefano Ermon, and Jiaming Song.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib13.5.1" style="font-size:90%;">Denoising diffusion restoration models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib13.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib13.7.2" style="font-size:90%;">, 35:23593–23606, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib14.2.2.1" style="font-size:90%;">[14]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib14.4.1" style="font-size:90%;">
Yinhuai Wang, Jiwen Yu, and Jian Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib14.5.1" style="font-size:90%;">Zero-shot image restoration using denoising diffusion null-space model.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib14.6.1" style="font-size:90%;">arXiv preprint arXiv:2212.00490</span><span class="ltx_text" id="bib.bib14.7.2" style="font-size:90%;">, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib15.2.2.1" style="font-size:90%;">[15]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib15.4.1" style="font-size:90%;">
Xinqi Lin, Jingwen He, Ziyan Chen, Zhaoyang Lyu, Ben Fei, Bo Dai, Wanli Ouyang, Yu Qiao, and Chao Dong.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib15.5.1" style="font-size:90%;">DiffBIR: Towards blind image restoration with generative diffusion prior.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib15.6.1" style="font-size:90%;">arXiv preprint arXiv:2308.15070</span><span class="ltx_text" id="bib.bib15.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib16.2.2.1" style="font-size:90%;">[16]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib16.4.1" style="font-size:90%;">
Jianyi Wang, Zongsheng Yue, Shangchen Zhou, Kelvin CK Chan, and Chen Change Loy.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib16.5.1" style="font-size:90%;">Exploiting diffusion prior for real-world image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib16.6.1" style="font-size:90%;">arXiv preprint arXiv:2305.07015</span><span class="ltx_text" id="bib.bib16.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib17.2.2.1" style="font-size:90%;">[17]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.4.1" style="font-size:90%;">
Tao Yang, Peiran Ren, Xuansong Xie, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib17.5.1" style="font-size:90%;">Pixel-aware stable diffusion for realistic image super-resolution and personalized stylization.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib17.6.1" style="font-size:90%;">arXiv preprint arXiv:2308.14469</span><span class="ltx_text" id="bib.bib17.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib18.2.2.1" style="font-size:90%;">[18]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib18.4.1" style="font-size:90%;">
Lingchen Sun, Rongyuan Wu, Zhengqiang Zhang, Hongwei Yong, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib18.5.1" style="font-size:90%;">Improving the stability of diffusion models for content consistent super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib18.6.1" style="font-size:90%;">arXiv preprint arXiv:2401.00877</span><span class="ltx_text" id="bib.bib18.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib19.2.2.1" style="font-size:90%;">[19]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib19.4.1" style="font-size:90%;">
Rongyuan Wu, Tao Yang, Lingchen Sun, Zhengqiang Zhang, Shuai Li, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib19.5.1" style="font-size:90%;">SeeSR: Towards semantics-aware real-world image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib19.6.1" style="font-size:90%;">arXiv preprint arXiv:2311.16518</span><span class="ltx_text" id="bib.bib19.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib20.2.2.1" style="font-size:90%;">[20]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib20.4.1" style="font-size:90%;">
Fanghua Yu, Jinjin Gu, Zheyuan Li, Jinfan Hu, Xiangtao Kong, Xintao Wang, Jingwen He, Yu Qiao, and Chao Dong.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib20.5.1" style="font-size:90%;">Scaling Up to Excellence: Practicing model scaling for photo-realistic image restoration in the wild.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib20.6.1" style="font-size:90%;">arXiv preprint arXiv:2401.13627</span><span class="ltx_text" id="bib.bib20.7.2" style="font-size:90%;">, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib21.2.2.1" style="font-size:90%;">[21]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib21.4.1" style="font-size:90%;">
Sewon Min, Kalpesh Krishna, Xinxi Lyu, Mike Lewis, Wen-tau Yih, Pang Wei Koh, Mohit Iyyer, Luke Zettlemoyer, and Hannaneh Hajishirzi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib21.5.1" style="font-size:90%;">FactScore: Fine-grained atomic evaluation of factual precision in long form text generation.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib21.6.1" style="font-size:90%;">arXiv preprint arXiv:2305.14251</span><span class="ltx_text" id="bib.bib21.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib22.2.2.1" style="font-size:90%;">[22]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib22.4.1" style="font-size:90%;">
Alex Mallen, Akari Asai, Victor Zhong, Rajarshi Das, Daniel Khashabi, and Hannaneh Hajishirzi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib22.5.1" style="font-size:90%;">When not to trust language models: Investigating effectiveness of parametric and non-parametric memories.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib22.6.1" style="font-size:90%;">arXiv preprint arXiv:2212.10511</span><span class="ltx_text" id="bib.bib22.7.2" style="font-size:90%;">, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib23.2.2.1" style="font-size:90%;">[23]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib23.4.1" style="font-size:90%;">
Ori Ram, Yoav Levine, Itay Dalmedigos, Dor Muhlgay, Amnon Shashua, Kevin Leyton-Brown, and Yoav Shoham.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib23.5.1" style="font-size:90%;">In-context retrieval-augmented language models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib23.6.1" style="font-size:90%;">Transactions of the Association for Computational Linguistics</span><span class="ltx_text" id="bib.bib23.7.2" style="font-size:90%;">, 11:1316–1331, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib24.2.2.1" style="font-size:90%;">[24]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib24.4.1" style="font-size:90%;">
Akari Asai, Zeqiu Wu, Yizhong Wang, Avirup Sil, and Hannaneh Hajishirzi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib24.5.1" style="font-size:90%;">Self-RAG: Learning to retrieve, generate, and critique through self-reflection.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib24.6.1" style="font-size:90%;">arXiv preprint arXiv:2310.11511</span><span class="ltx_text" id="bib.bib24.7.2" style="font-size:90%;">, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib25.2.2.1" style="font-size:90%;">[25]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib25.4.1" style="font-size:90%;">
Akari Asai, Sewon Min, Zexuan Zhong, and Danqi Chen.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib25.5.1" style="font-size:90%;">Retrieval-based language models and applications.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib25.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib25.7.2" style="font-size:90%;">ACL</span><span class="ltx_text" id="bib.bib25.8.3" style="font-size:90%;">, pages 41–46, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib26.2.2.1" style="font-size:90%;">[26]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.4.1" style="font-size:90%;">
Lvmin Zhang, Anyi Rao, and Maneesh Agrawala.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.5.1" style="font-size:90%;">Adding conditional control to text-to-image diffusion models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib26.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib26.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib26.8.3" style="font-size:90%;">, pages 3836–3847, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib27.2.2.1" style="font-size:90%;">[27]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.4.1" style="font-size:90%;">
Olaf Ronneberger, Philipp Fischer, and Thomas Brox.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.5.1" style="font-size:90%;">U-Net: Convolutional networks for biomedical image segmentation.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib27.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib27.7.2" style="font-size:90%;">MICCAI</span><span class="ltx_text" id="bib.bib27.8.3" style="font-size:90%;">, pages 234–241. Springer, 2015.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib28.2.2.1" style="font-size:90%;">[28]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.4.1" style="font-size:90%;">
William Peebles and Saining Xie.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.5.1" style="font-size:90%;">Scalable diffusion models with transformers.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib28.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib28.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib28.8.3" style="font-size:90%;">, pages 4195–4205, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib29.2.2.1" style="font-size:90%;">[29]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.4.1" style="font-size:90%;">
Mingdeng Cao, Xintao Wang, Zhongang Qi, Ying Shan, Xiaohu Qie, and Yinqiang Zheng.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.5.1" style="font-size:90%;">MasaCtrl: Tuning-free mutual self-attention control for consistent image synthesis and editing.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib29.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib29.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib29.8.3" style="font-size:90%;">, pages 22560–22570, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib30.2.2.1" style="font-size:90%;">[30]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib30.4.1" style="font-size:90%;">
Yuechen Zhang, Jinbo Xing, Eric Lo, and Jiaya Jia.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib30.5.1" style="font-size:90%;">Real-world image variation by aligning diffusion inversion chain.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib30.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib30.7.2" style="font-size:90%;">, 36, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib31.2.2.1" style="font-size:90%;">[31]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib31.4.1" style="font-size:90%;">
Jing Gu, Yilin Wang, Nanxuan Zhao, Tsu-Jui Fu, Wei Xiong, Qing Liu, Zhifei Zhang, He Zhang, Jianming Zhang, HyunJoon Jung, et al.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib31.5.1" style="font-size:90%;">PhotoSwap: Personalized subject swapping in images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib31.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib31.7.2" style="font-size:90%;">, 36, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib32.2.2.1" style="font-size:90%;">[32]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib32.4.1" style="font-size:90%;">
Andreas Blattmann, Robin Rombach, Kaan Oktay, Jonas Müller, and Björn Ommer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib32.5.1" style="font-size:90%;">Retrieval-augmented diffusion models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib32.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib32.7.2" style="font-size:90%;">, 35:15309–15324, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib33.2.2.1" style="font-size:90%;">[33]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.4.1" style="font-size:90%;">
Robin Rombach, Andreas Blattmann, Dominik Lorenz, Patrick Esser, and Björn Ommer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.5.1" style="font-size:90%;">High-resolution image synthesis with latent diffusion models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib33.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib33.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib33.8.3" style="font-size:90%;">, pages 10684–10695, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib34.2.2.1" style="font-size:90%;">[34]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.4.1" style="font-size:90%;">
Shuyao Shang, Zhengyang Shan, Guangxing Liu, LunQian Wang, XingHua Wang, Zekai Zhang, and Jinglin Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.5.1" style="font-size:90%;">ResDiff: Combining cnn and diffusion model for image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib34.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib34.7.2" style="font-size:90%;">Proceedings of the AAAI Conference on Artificial Intelligence</span><span class="ltx_text" id="bib.bib34.8.3" style="font-size:90%;">, volume 38, pages 8975–8983, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib35.2.2.1" style="font-size:90%;">[35]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib35.4.1" style="font-size:90%;">
Zongsheng Yue, Jianyi Wang, and Chen Change Loy.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib35.5.1" style="font-size:90%;">ResShift: Efficient diffusion model for image super-resolution by residual shifting.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib35.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib35.7.2" style="font-size:90%;">, 36, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib36.2.2.1" style="font-size:90%;">[36]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib36.4.1" style="font-size:90%;">
Yi Zhang, Xiaoyu Shi, Dasong Li, Xiaogang Wang, Jian Wang, and Hongsheng Li.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib36.5.1" style="font-size:90%;">A unified conditional framework for diffusion-based image restoration.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib36.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib36.7.2" style="font-size:90%;">, 36, 2024.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib37.2.2.1" style="font-size:90%;">[37]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.4.1" style="font-size:90%;">
Lvmin Zhang, Anyi Rao, and Maneesh Agrawala.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.5.1" style="font-size:90%;">Adding conditional control to text-to-image diffusion models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib37.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib37.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib37.8.3" style="font-size:90%;">, pages 3836–3847, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib38.2.2.1" style="font-size:90%;">[38]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib38.4.1" style="font-size:90%;">
Jared Kaplan, Sam McCandlish, Tom Henighan, Tom B Brown, Benjamin Chess, Rewon Child, Scott Gray, Alec Radford, Jeffrey Wu, and Dario Amodei.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib38.5.1" style="font-size:90%;">Scaling laws for neural language models.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib38.6.1" style="font-size:90%;">arXiv preprint arXiv:2001.08361</span><span class="ltx_text" id="bib.bib38.7.2" style="font-size:90%;">, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib39.2.2.1" style="font-size:90%;">[39]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib39.4.1" style="font-size:90%;">
Fuzhi Yang, Huan Yang, Jianlong Fu, Hongtao Lu, and Baining Guo.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib39.5.1" style="font-size:90%;">Learning texture transformer network for image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib39.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib39.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib39.8.3" style="font-size:90%;">, pages 5791–5800, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib40.2.2.1" style="font-size:90%;">[40]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.4.1" style="font-size:90%;">
Liying Lu, Wenbo Li, Xin Tao, Jiangbo Lu, and Jiaya Jia.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.5.1" style="font-size:90%;">Masa-SR: Matching acceleration and spatial adaptation for reference-based image super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib40.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib40.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib40.8.3" style="font-size:90%;">, pages 6368–6377, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib41.2.2.1" style="font-size:90%;">[41]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.4.1" style="font-size:90%;">
Yuming Jiang, Kelvin CK Chan, Xintao Wang, Chen Change Loy, and Ziwei Liu.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.5.1" style="font-size:90%;">Robust reference-based super-resolution via C2-matching.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib41.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib41.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib41.8.3" style="font-size:90%;">, pages 2103–2112, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib42.2.2.1" style="font-size:90%;">[42]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.4.1" style="font-size:90%;">
Jiezhang Cao, Jingyun Liang, Kai Zhang, Yawei Li, Yulun Zhang, Wenguan Wang, and Luc Van Gool.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.5.1" style="font-size:90%;">Reference-based image super-resolution with deformable attention transformer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib42.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib42.7.2" style="font-size:90%;">ECCV</span><span class="ltx_text" id="bib.bib42.8.3" style="font-size:90%;">, pages 325–342. Springer, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib43.2.2.1" style="font-size:90%;">[43]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.4.1" style="font-size:90%;">
Lin Zhang, Xin Li, Dongliang He, Fu Li, Errui Ding, and Zhaoxiang Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.5.1" style="font-size:90%;">Lmr: A large-scale multi-reference dataset for reference-based super-resolution.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib43.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib43.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib43.8.3" style="font-size:90%;">, pages 13118–13127, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib44.2.2.1" style="font-size:90%;">[44]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib44.4.1" style="font-size:90%;">
Amir Hertz, Ron Mokady, Jay Tenenbaum, Kfir Aberman, Yael Pritch, and Daniel Cohen-Or.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib44.5.1" style="font-size:90%;">Prompt-to-prompt image editing with cross attention control.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib44.6.1" style="font-size:90%;">arXiv preprint arXiv:2208.01626</span><span class="ltx_text" id="bib.bib44.7.2" style="font-size:90%;">, 2022.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib45.2.2.1" style="font-size:90%;">[45]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib45.4.1" style="font-size:90%;">
Namuk Park and Songkuk Kim.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib45.5.1" style="font-size:90%;">How do vision transformers work?
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib45.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib45.7.2" style="font-size:90%;">ICLR</span><span class="ltx_text" id="bib.bib45.8.3" style="font-size:90%;">, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib46.2.2.1" style="font-size:90%;">[46]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib46.4.1" style="font-size:90%;">
Karen Simonyan and Andrew Zisserman.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib46.5.1" style="font-size:90%;">Very deep convolutional networks for large-scale image recognition.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib46.6.1" style="font-size:90%;">arXiv preprint arXiv:1409.1556</span><span class="ltx_text" id="bib.bib46.7.2" style="font-size:90%;">, 2014.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib47.2.2.1" style="font-size:90%;">[47]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.4.1" style="font-size:90%;">
Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.5.1" style="font-size:90%;">Deep residual learning for image recognition.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib47.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib47.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib47.8.3" style="font-size:90%;">, pages 770–778, 2016.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib48.2.2.1" style="font-size:90%;">[48]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib48.4.1" style="font-size:90%;">
Alec Radford, Jong Wook Kim, Chris Hallacy, Aditya Ramesh, Gabriel Goh, Sandhini Agarwal, Girish Sastry, Amanda Askell, Pamela Mishkin, Jack Clark, et al.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib48.5.1" style="font-size:90%;">Learning transferable visual models from natural language supervision.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib48.6.1" style="font-size:90%;">pages 8748–8763. PMLR, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib49.2.2.1" style="font-size:90%;">[49]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib49.4.1" style="font-size:90%;">
Xun Huang and Serge Belongie.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib49.5.1" style="font-size:90%;">Arbitrary style transfer in real-time with adaptive instance normalization.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib49.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib49.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib49.8.3" style="font-size:90%;">, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib50.2.2.1" style="font-size:90%;">[50]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib50.4.1" style="font-size:90%;">
Zhifei Zhang, Zhaowen Wang, Zhe Lin, and Hairong Qi.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib50.5.1" style="font-size:90%;">Image super-resolution by neural texture transfer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib50.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib50.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib50.8.3" style="font-size:90%;">, pages 7982–7991, 2019.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib51.2.2.1" style="font-size:90%;">[51]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib51.4.1" style="font-size:90%;">
Yufei Wang, Zhe Lin, Xiaohui Shen, Radomir Mech, Gavin Miller, and Garrison W Cottrell.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib51.5.1" style="font-size:90%;">Event-specific image importance.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib51.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib51.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib51.8.3" style="font-size:90%;">, pages 4810–4819, 2016.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib52.2.2.1" style="font-size:90%;">[52]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib52.4.1" style="font-size:90%;">
Radu Timofte, Eirikur Agustsson, Luc Van Gool, Ming-Hsuan Yang, and Lei Zhang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib52.5.1" style="font-size:90%;">NTIRE 2017 challenge on single image super-resolution: Methods and results.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib52.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib52.7.2" style="font-size:90%;">CVPRW</span><span class="ltx_text" id="bib.bib52.8.3" style="font-size:90%;">, pages 114–125, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib53.2.2.1" style="font-size:90%;">[53]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib53.4.1" style="font-size:90%;">
Richard Zhang, Phillip Isola, Alexei A Efros, Eli Shechtman, and Oliver Wang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib53.5.1" style="font-size:90%;">The unreasonable effectiveness of deep features as a perceptual metric.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib53.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib53.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib53.8.3" style="font-size:90%;">, pages 586–595, 2018.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib54.2.2.1" style="font-size:90%;">[54]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib54.4.1" style="font-size:90%;">
Anish Mittal, Rajiv Soundararajan, and Alan C Bovik.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib54.5.1" style="font-size:90%;">Making a “completely blind” image quality analyzer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib54.6.1" style="font-size:90%;">IEEE Signal processing letters</span><span class="ltx_text" id="bib.bib54.7.2" style="font-size:90%;">, 20(3):209–212, 2012.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib55.2.2.1" style="font-size:90%;">[55]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib55.4.1" style="font-size:90%;">
Martin Heusel, Hubert Ramsauer, Thomas Unterthiner, Bernhard Nessler, and Sepp Hochreiter.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib55.5.1" style="font-size:90%;">Gans trained by a two time-scale update rule converge to a local nash equilibrium.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib55.6.1" style="font-size:90%;">NeurIPS</span><span class="ltx_text" id="bib.bib55.7.2" style="font-size:90%;">, 30, 2017.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib56.2.2.1" style="font-size:90%;">[56]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib56.4.1" style="font-size:90%;">
Junjie Ke, Qifei Wang, Yilin Wang, Peyman Milanfar, and Feng Yang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib56.5.1" style="font-size:90%;">MUSIQ: Multi-scale image quality transformer.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib56.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib56.7.2" style="font-size:90%;">ICCV</span><span class="ltx_text" id="bib.bib56.8.3" style="font-size:90%;">, pages 5148–5157, 2021.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib57.2.2.1" style="font-size:90%;">[57]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib57.4.1" style="font-size:90%;">
Jianyi Wang, Kelvin CK Chan, and Chen Change Loy.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib57.5.1" style="font-size:90%;">Exploring CLIP for assessing the look and feel of images.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib57.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib57.7.2" style="font-size:90%;">AAAI</span><span class="ltx_text" id="bib.bib57.8.3" style="font-size:90%;">, volume 37, pages 2555–2563, 2023.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib58.2.2.1" style="font-size:90%;">[58]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib58.4.1" style="font-size:90%;">
Chenggang Yan, Biao Gong, Yuxuan Wei, and Yue Gao.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib58.5.1" style="font-size:90%;">Deep multi-view enhancement hashing for image retrieval.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib58.6.1" style="font-size:90%;">IEEE TPAMI</span><span class="ltx_text" id="bib.bib58.7.2" style="font-size:90%;">, 43(4):1445–1451, 2020.
</span>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem"><span class="ltx_text" id="bib.bib59.2.2.1" style="font-size:90%;">[59]</span></span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib59.4.1" style="font-size:90%;">
Siteng Huang, Biao Gong, Yulin Pan, Jianwen Jiang, Yiliang Lv, Yuyuan Li, and Donglin Wang.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib59.5.1" style="font-size:90%;">VoP: Text-video co-operative prompt tuning for cross-modal retrieval.
</span>
</span>
<span class="ltx_bibblock"><span class="ltx_text" id="bib.bib59.6.1" style="font-size:90%;">In </span><span class="ltx_text ltx_font_italic" id="bib.bib59.7.2" style="font-size:90%;">CVPR</span><span class="ltx_text" id="bib.bib59.8.3" style="font-size:90%;">, pages 6565–6574, 2023.
</span>
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="Ax1">
<h2 class="ltx_title ltx_title_appendix" style="font-size:144%;">Appendix</h2>
</section>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Adaptive Multi-reference Injection</h2>
<section class="ltx_paragraph" id="A1.SS0.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Technical details.</h4>
<div class="ltx_para ltx_noindent" id="A1.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="A1.SS0.SSS0.Px1.p1.7">In the main paper, we mainly focus on the case of one single retrieved image. However, in practice, there may be multiple available reference images at hand, and using multiple reference images for resemblance could intuitively gain better performance. To this end, we extend the original cross-image injection to allow to incorporation of multiple reference images for reconstruction.
Our key idea is to modify the scale factor <math alttext="s" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.1.m1.1"><semantics id="A1.SS0.SSS0.Px1.p1.1.m1.1a"><mi id="A1.SS0.SSS0.Px1.p1.1.m1.1.1" xref="A1.SS0.SSS0.Px1.p1.1.m1.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.1.m1.1b"><ci id="A1.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.1.m1.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.1.m1.1c">s</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.1.m1.1d">italic_s</annotation></semantics></math> in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.E2" title="In 4.2 Cross Image Injection for High-fidelity Image Restoration ‣ 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">2</span></a> from a scalar into a vector: <math alttext="\mathbf{s}=\{s_{1},s_{2},\cdots,s_{k}\}" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.2.m2.4"><semantics id="A1.SS0.SSS0.Px1.p1.2.m2.4a"><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.4.4" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.5" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.5.cmml">𝐬</mi><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.4" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.4.cmml">=</mo><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml"><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.4" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">{</mo><msub id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml">s</mi><mn id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml">1</mn></msub><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.5" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml">s</mi><mn id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml">2</mn></msub><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.6" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><mi id="A1.SS0.SSS0.Px1.p1.2.m2.1.1" mathvariant="normal" xref="A1.SS0.SSS0.Px1.p1.2.m2.1.1.cmml">⋯</mi><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.7" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">,</mo><msub id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml">s</mi><mi id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml">k</mi></msub><mo id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.8" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.2.m2.4b"><apply id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4"><eq id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.4.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.4"></eq><ci id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.5.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.5">𝐬</ci><set id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.4.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3"><apply id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.2">𝑠</ci><cn id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3.cmml" type="integer" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.1.1.1.3">1</cn></apply><apply id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.2">𝑠</ci><cn id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3.cmml" type="integer" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.2.2.3">2</cn></apply><ci id="A1.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.1.1">⋯</ci><apply id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.2">𝑠</ci><ci id="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.4.4.3.3.3.3">𝑘</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.2.m2.4c">\mathbf{s}=\{s_{1},s_{2},\cdots,s_{k}\}</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.2.m2.4d">bold_s = { italic_s start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_s start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT }</annotation></semantics></math>, where <math alttext="\sum s_{n}=1" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.3.m3.1"><semantics id="A1.SS0.SSS0.Px1.p1.3.m3.1a"><mrow id="A1.SS0.SSS0.Px1.p1.3.m3.1.1" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.cmml"><mrow id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml"><mo id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.1" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.1.cmml">∑</mo><msub id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.cmml"><mi id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.2.cmml">s</mi><mi id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.3" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.3.cmml">n</mi></msub></mrow><mo id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.cmml">=</mo><mn id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.3" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.3.m3.1b"><apply id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1"><eq id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1"></eq><apply id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2"><sum id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.1"></sum><apply id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.2">𝑠</ci><ci id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.3.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.2.2.3">𝑛</ci></apply></apply><cn id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.3.cmml" type="integer" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.3.m3.1c">\sum s_{n}=1</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.3.m3.1d">∑ italic_s start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT = 1</annotation></semantics></math>. Each <math alttext="s_{n}" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.4.m4.1"><semantics id="A1.SS0.SSS0.Px1.p1.4.m4.1a"><msub id="A1.SS0.SSS0.Px1.p1.4.m4.1.1" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml">s</mi><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml">n</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.4.m4.1b"><apply id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2">𝑠</ci><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3">𝑛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.4.m4.1c">s_{n}</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.4.m4.1d">italic_s start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT</annotation></semantics></math> can be obtained by computing the cosine similarity between <math alttext="I_{LQ}" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.5.m5.1"><semantics id="A1.SS0.SSS0.Px1.p1.5.m5.1a"><msub id="A1.SS0.SSS0.Px1.p1.5.m5.1.1" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.2" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.2.cmml">I</mi><mrow id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.cmml"><mi id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.2" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.2.cmml">L</mi><mo id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.1" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.3" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.3.cmml">Q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.5.m5.1b"><apply id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.2">𝐼</ci><apply id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3"><times id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.1.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.1"></times><ci id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.2.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.2">𝐿</ci><ci id="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.3.cmml" xref="A1.SS0.SSS0.Px1.p1.5.m5.1.1.3.3">𝑄</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.5.m5.1c">I_{LQ}</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.5.m5.1d">italic_I start_POSTSUBSCRIPT italic_L italic_Q end_POSTSUBSCRIPT</annotation></semantics></math> and the corresponding <math alttext="n" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.6.m6.1"><semantics id="A1.SS0.SSS0.Px1.p1.6.m6.1a"><mi id="A1.SS0.SSS0.Px1.p1.6.m6.1.1" xref="A1.SS0.SSS0.Px1.p1.6.m6.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.6.m6.1b"><ci id="A1.SS0.SSS0.Px1.p1.6.m6.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.6.m6.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.6.m6.1c">n</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.6.m6.1d">italic_n</annotation></semantics></math>-th retrieved image in <math alttext="\mathbf{I_{R}}" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.7.m7.1"><semantics id="A1.SS0.SSS0.Px1.p1.7.m7.1a"><msub id="A1.SS0.SSS0.Px1.p1.7.m7.1.1" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.2" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1.2.cmml">𝐈</mi><mi id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.3" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1.3.cmml">𝐑</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.7.m7.1b"><apply id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1.2">𝐈</ci><ci id="A1.SS0.SSS0.Px1.p1.7.m7.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.7.m7.1.1.3">𝐑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.7.m7.1c">\mathbf{I_{R}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.7.m7.1d">bold_I start_POSTSUBSCRIPT bold_R end_POSTSUBSCRIPT</annotation></semantics></math> followed by Softmax normalization. Then we can modify the original single-reference
cross-image injection of <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S4.E2" title="In 4.2 Cross Image Injection for High-fidelity Image Restoration ‣ 4 Methodology ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">2</span></a> to the following multi-reference version:</p>
<table class="ltx_equation ltx_eqn_table" id="A1.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="O_{fuse}=(\mathbf{1}-\sum_{n=1}^{k}s_{n}\mathcal{M}_{n})\otimes O_{inter}+(%
\sum_{n=1}^{k}s_{n}\mathcal{M}_{n})\otimes O_{intra}," class="ltx_Math" display="block" id="A1.E4.m1.1"><semantics id="A1.E4.m1.1a"><mrow id="A1.E4.m1.1.1.1" xref="A1.E4.m1.1.1.1.1.cmml"><mrow id="A1.E4.m1.1.1.1.1" xref="A1.E4.m1.1.1.1.1.cmml"><msub id="A1.E4.m1.1.1.1.1.4" xref="A1.E4.m1.1.1.1.1.4.cmml"><mi id="A1.E4.m1.1.1.1.1.4.2" xref="A1.E4.m1.1.1.1.1.4.2.cmml">O</mi><mrow id="A1.E4.m1.1.1.1.1.4.3" xref="A1.E4.m1.1.1.1.1.4.3.cmml"><mi id="A1.E4.m1.1.1.1.1.4.3.2" xref="A1.E4.m1.1.1.1.1.4.3.2.cmml">f</mi><mo id="A1.E4.m1.1.1.1.1.4.3.1" xref="A1.E4.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.4.3.3" xref="A1.E4.m1.1.1.1.1.4.3.3.cmml">u</mi><mo id="A1.E4.m1.1.1.1.1.4.3.1a" xref="A1.E4.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.4.3.4" xref="A1.E4.m1.1.1.1.1.4.3.4.cmml">s</mi><mo id="A1.E4.m1.1.1.1.1.4.3.1b" xref="A1.E4.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.4.3.5" xref="A1.E4.m1.1.1.1.1.4.3.5.cmml">e</mi></mrow></msub><mo id="A1.E4.m1.1.1.1.1.3" xref="A1.E4.m1.1.1.1.1.3.cmml">=</mo><mrow id="A1.E4.m1.1.1.1.1.2" xref="A1.E4.m1.1.1.1.1.2.cmml"><mrow id="A1.E4.m1.1.1.1.1.1.1" xref="A1.E4.m1.1.1.1.1.1.1.cmml"><mrow id="A1.E4.m1.1.1.1.1.1.1.1.1" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E4.m1.1.1.1.1.1.1.1.1.1" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.cmml"><mn id="A1.E4.m1.1.1.1.1.1.1.1.1.1.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.2.cmml">𝟏</mn><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.1.1" rspace="0.055em" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.1.cmml">−</mo><mrow id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.cmml"><munderover id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.cmml"><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.2" movablelimits="false" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.2.cmml">∑</mo><mrow id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.cmml"><mi id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.2.cmml">n</mi><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.1" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.1.cmml">=</mo><mn id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.3.cmml">k</mi></munderover><mrow id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.cmml"><msub id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml"><mi id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.2.cmml">s</mi><mi id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.3.cmml">n</mi></msub><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.1" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.1.cmml">⁢</mo><msub id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.2" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.2.cmml">ℳ</mi><mi id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.3" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.3.cmml">n</mi></msub></mrow></mrow></mrow><mo id="A1.E4.m1.1.1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="A1.E4.m1.1.1.1.1.1.1.2" rspace="0.222em" xref="A1.E4.m1.1.1.1.1.1.1.2.cmml">⊗</mo><msub id="A1.E4.m1.1.1.1.1.1.1.3" xref="A1.E4.m1.1.1.1.1.1.1.3.cmml"><mi id="A1.E4.m1.1.1.1.1.1.1.3.2" xref="A1.E4.m1.1.1.1.1.1.1.3.2.cmml">O</mi><mrow id="A1.E4.m1.1.1.1.1.1.1.3.3" xref="A1.E4.m1.1.1.1.1.1.1.3.3.cmml"><mi id="A1.E4.m1.1.1.1.1.1.1.3.3.2" xref="A1.E4.m1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="A1.E4.m1.1.1.1.1.1.1.3.3.1" xref="A1.E4.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.1.1.3.3.3" xref="A1.E4.m1.1.1.1.1.1.1.3.3.3.cmml">n</mi><mo id="A1.E4.m1.1.1.1.1.1.1.3.3.1a" xref="A1.E4.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.1.1.3.3.4" xref="A1.E4.m1.1.1.1.1.1.1.3.3.4.cmml">t</mi><mo id="A1.E4.m1.1.1.1.1.1.1.3.3.1b" xref="A1.E4.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.1.1.3.3.5" xref="A1.E4.m1.1.1.1.1.1.1.3.3.5.cmml">e</mi><mo id="A1.E4.m1.1.1.1.1.1.1.3.3.1c" xref="A1.E4.m1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.1.1.3.3.6" xref="A1.E4.m1.1.1.1.1.1.1.3.3.6.cmml">r</mi></mrow></msub></mrow><mo id="A1.E4.m1.1.1.1.1.2.3" xref="A1.E4.m1.1.1.1.1.2.3.cmml">+</mo><mrow id="A1.E4.m1.1.1.1.1.2.2" xref="A1.E4.m1.1.1.1.1.2.2.cmml"><mrow id="A1.E4.m1.1.1.1.1.2.2.1.1" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.cmml"><mo id="A1.E4.m1.1.1.1.1.2.2.1.1.2" stretchy="false" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.cmml">(</mo><mrow id="A1.E4.m1.1.1.1.1.2.2.1.1.1" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.cmml"><munderover id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.cmml"><mo id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.2" lspace="0em" movablelimits="false" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.2.cmml">∑</mo><mrow id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.cmml"><mi id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.2" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.2.cmml">n</mi><mo id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.1" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.1.cmml">=</mo><mn id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.3.cmml">1</mn></mrow><mi id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.3.cmml">k</mi></munderover><mrow id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.cmml"><msub id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.cmml"><mi id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.2" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.2.cmml">s</mi><mi id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.3.cmml">n</mi></msub><mo id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.1" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.1.cmml">⁢</mo><msub id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.2" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.2.cmml">ℳ</mi><mi id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.3" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.3.cmml">n</mi></msub></mrow></mrow><mo id="A1.E4.m1.1.1.1.1.2.2.1.1.3" rspace="0.055em" stretchy="false" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.cmml">)</mo></mrow><mo id="A1.E4.m1.1.1.1.1.2.2.2" rspace="0.222em" xref="A1.E4.m1.1.1.1.1.2.2.2.cmml">⊗</mo><msub id="A1.E4.m1.1.1.1.1.2.2.3" xref="A1.E4.m1.1.1.1.1.2.2.3.cmml"><mi id="A1.E4.m1.1.1.1.1.2.2.3.2" xref="A1.E4.m1.1.1.1.1.2.2.3.2.cmml">O</mi><mrow id="A1.E4.m1.1.1.1.1.2.2.3.3" xref="A1.E4.m1.1.1.1.1.2.2.3.3.cmml"><mi id="A1.E4.m1.1.1.1.1.2.2.3.3.2" xref="A1.E4.m1.1.1.1.1.2.2.3.3.2.cmml">i</mi><mo id="A1.E4.m1.1.1.1.1.2.2.3.3.1" xref="A1.E4.m1.1.1.1.1.2.2.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.2.2.3.3.3" xref="A1.E4.m1.1.1.1.1.2.2.3.3.3.cmml">n</mi><mo id="A1.E4.m1.1.1.1.1.2.2.3.3.1a" xref="A1.E4.m1.1.1.1.1.2.2.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.2.2.3.3.4" xref="A1.E4.m1.1.1.1.1.2.2.3.3.4.cmml">t</mi><mo id="A1.E4.m1.1.1.1.1.2.2.3.3.1b" xref="A1.E4.m1.1.1.1.1.2.2.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.2.2.3.3.5" xref="A1.E4.m1.1.1.1.1.2.2.3.3.5.cmml">r</mi><mo id="A1.E4.m1.1.1.1.1.2.2.3.3.1c" xref="A1.E4.m1.1.1.1.1.2.2.3.3.1.cmml">⁢</mo><mi id="A1.E4.m1.1.1.1.1.2.2.3.3.6" xref="A1.E4.m1.1.1.1.1.2.2.3.3.6.cmml">a</mi></mrow></msub></mrow></mrow></mrow><mo id="A1.E4.m1.1.1.1.2" xref="A1.E4.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.E4.m1.1b"><apply id="A1.E4.m1.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1"><eq id="A1.E4.m1.1.1.1.1.3.cmml" xref="A1.E4.m1.1.1.1.1.3"></eq><apply id="A1.E4.m1.1.1.1.1.4.cmml" xref="A1.E4.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.4.1.cmml" xref="A1.E4.m1.1.1.1.1.4">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.4.2.cmml" xref="A1.E4.m1.1.1.1.1.4.2">𝑂</ci><apply id="A1.E4.m1.1.1.1.1.4.3.cmml" xref="A1.E4.m1.1.1.1.1.4.3"><times id="A1.E4.m1.1.1.1.1.4.3.1.cmml" xref="A1.E4.m1.1.1.1.1.4.3.1"></times><ci id="A1.E4.m1.1.1.1.1.4.3.2.cmml" xref="A1.E4.m1.1.1.1.1.4.3.2">𝑓</ci><ci id="A1.E4.m1.1.1.1.1.4.3.3.cmml" xref="A1.E4.m1.1.1.1.1.4.3.3">𝑢</ci><ci id="A1.E4.m1.1.1.1.1.4.3.4.cmml" xref="A1.E4.m1.1.1.1.1.4.3.4">𝑠</ci><ci id="A1.E4.m1.1.1.1.1.4.3.5.cmml" xref="A1.E4.m1.1.1.1.1.4.3.5">𝑒</ci></apply></apply><apply id="A1.E4.m1.1.1.1.1.2.cmml" xref="A1.E4.m1.1.1.1.1.2"><plus id="A1.E4.m1.1.1.1.1.2.3.cmml" xref="A1.E4.m1.1.1.1.1.2.3"></plus><apply id="A1.E4.m1.1.1.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E4.m1.1.1.1.1.1.1.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.2">tensor-product</csymbol><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1"><minus id="A1.E4.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.1"></minus><cn id="A1.E4.m1.1.1.1.1.1.1.1.1.1.2.cmml" type="integer" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.2">1</cn><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3"><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1">superscript</csymbol><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1">subscript</csymbol><sum id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.2"></sum><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3"><eq id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.1"></eq><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.2">𝑛</ci><cn id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.3.cmml" type="integer" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.1.3">𝑘</ci></apply><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2"><times id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.1"></times><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.2">𝑠</ci><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.2.3">𝑛</ci></apply><apply id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.2">ℳ</ci><ci id="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.1.1.1.3.2.3.3">𝑛</ci></apply></apply></apply></apply><apply id="A1.E4.m1.1.1.1.1.1.1.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.1.1.3.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.1.1.3.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.2">𝑂</ci><apply id="A1.E4.m1.1.1.1.1.1.1.3.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3"><times id="A1.E4.m1.1.1.1.1.1.1.3.3.1.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.1"></times><ci id="A1.E4.m1.1.1.1.1.1.1.3.3.2.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.2">𝑖</ci><ci id="A1.E4.m1.1.1.1.1.1.1.3.3.3.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.3">𝑛</ci><ci id="A1.E4.m1.1.1.1.1.1.1.3.3.4.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.4">𝑡</ci><ci id="A1.E4.m1.1.1.1.1.1.1.3.3.5.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.5">𝑒</ci><ci id="A1.E4.m1.1.1.1.1.1.1.3.3.6.cmml" xref="A1.E4.m1.1.1.1.1.1.1.3.3.6">𝑟</ci></apply></apply></apply><apply id="A1.E4.m1.1.1.1.1.2.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2"><csymbol cd="latexml" id="A1.E4.m1.1.1.1.1.2.2.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.2">tensor-product</csymbol><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1"><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1">superscript</csymbol><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1">subscript</csymbol><sum id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.2"></sum><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3"><eq id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.1"></eq><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.2">𝑛</ci><cn id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.3.cmml" type="integer" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.2.3.3">1</cn></apply></apply><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.1.3">𝑘</ci></apply><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2"><times id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.1"></times><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.2">𝑠</ci><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.2.3">𝑛</ci></apply><apply id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.2">ℳ</ci><ci id="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.1.1.1.2.3.3">𝑛</ci></apply></apply></apply><apply id="A1.E4.m1.1.1.1.1.2.2.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3"><csymbol cd="ambiguous" id="A1.E4.m1.1.1.1.1.2.2.3.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3">subscript</csymbol><ci id="A1.E4.m1.1.1.1.1.2.2.3.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.2">𝑂</ci><apply id="A1.E4.m1.1.1.1.1.2.2.3.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3"><times id="A1.E4.m1.1.1.1.1.2.2.3.3.1.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.1"></times><ci id="A1.E4.m1.1.1.1.1.2.2.3.3.2.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.2">𝑖</ci><ci id="A1.E4.m1.1.1.1.1.2.2.3.3.3.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.3">𝑛</ci><ci id="A1.E4.m1.1.1.1.1.2.2.3.3.4.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.4">𝑡</ci><ci id="A1.E4.m1.1.1.1.1.2.2.3.3.5.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.5">𝑟</ci><ci id="A1.E4.m1.1.1.1.1.2.2.3.3.6.cmml" xref="A1.E4.m1.1.1.1.1.2.2.3.3.6">𝑎</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E4.m1.1c">O_{fuse}=(\mathbf{1}-\sum_{n=1}^{k}s_{n}\mathcal{M}_{n})\otimes O_{inter}+(%
\sum_{n=1}^{k}s_{n}\mathcal{M}_{n})\otimes O_{intra},</annotation><annotation encoding="application/x-llamapun" id="A1.E4.m1.1d">italic_O start_POSTSUBSCRIPT italic_f italic_u italic_s italic_e end_POSTSUBSCRIPT = ( bold_1 - ∑ start_POSTSUBSCRIPT italic_n = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT italic_s start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT ) ⊗ italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_e italic_r end_POSTSUBSCRIPT + ( ∑ start_POSTSUBSCRIPT italic_n = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT italic_s start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT ) ⊗ italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS0.SSS0.Px1.p1.9">where <math alttext="\mathcal{M}_{n}" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.8.m1.1"><semantics id="A1.SS0.SSS0.Px1.p1.8.m1.1a"><msub id="A1.SS0.SSS0.Px1.p1.8.m1.1.1" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.2" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1.2.cmml">ℳ</mi><mi id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.3" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1.3.cmml">n</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.8.m1.1b"><apply id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1.2">ℳ</ci><ci id="A1.SS0.SSS0.Px1.p1.8.m1.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.8.m1.1.1.3">𝑛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.8.m1.1c">\mathcal{M}_{n}</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.8.m1.1d">caligraphic_M start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT</annotation></semantics></math> denotes the gated mask of the <math alttext="n" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.9.m2.1"><semantics id="A1.SS0.SSS0.Px1.p1.9.m2.1a"><mi id="A1.SS0.SSS0.Px1.p1.9.m2.1.1" xref="A1.SS0.SSS0.Px1.p1.9.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.9.m2.1b"><ci id="A1.SS0.SSS0.Px1.p1.9.m2.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.9.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.9.m2.1c">n</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.9.m2.1d">italic_n</annotation></semantics></math>-th reference image.</p>
</div>
</section>
<section class="ltx_paragraph" id="A1.SS0.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Experiments with multiple reference images.</h4>
<div class="ltx_para" id="A1.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="A1.SS0.SSS0.Px2.p1.1">For experiments with multiple reference images, we use SUPIR+ReFIR as a representative. Since the CUFED5 dataset contains multiple reference images, we directly use the provided images as the retrieved reference for reproducibility. <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.T8" title="In Performance under extreme conditions. ‣ Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">8</span></a> gives the results. It can be seen that using multiple reference images produces better results than one single reference image, <span class="ltx_text ltx_font_italic" id="A1.SS0.SSS0.Px2.p1.1.1">e.g.</span> the 2.08 improvement in FID. However, it is worth noting that the marginal gain from adding reference images is diminishing, accompanied by a notable increase in computational cost. Therefore, in practice, we use one single reference image to balance the model performance and inference efficiency.</p>
</div>
</section>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>More Discussions</h2>
<section class="ltx_paragraph" id="A2.SS0.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Difference from the other methods.</h4>
<div class="ltx_para" id="A2.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="A2.SS0.SSS0.Px1.p1.1">Our ReFIR uses retrieved images as the reference for high-fidelity restoration. Despite both RefSR methods and ours appears the reference image, we would like to clarify the difference between our ReFIR and previous RefSR methods. <span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px1.p1.1.1">Firstly</span>, current RefSR models <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib41" title=""><span class="ltx_text" style="font-size:90%;">41</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib42" title=""><span class="ltx_text" style="font-size:90%;">42</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib43" title=""><span class="ltx_text" style="font-size:90%;">43</span></a>]</cite> are typically small-scale (#param &lt;50M) and use simple Bicubic degradation, while our ReFIR focuses on the recent diffusion-based large-scale restoration model (#param &gt;1B) for more challenging real-world SR. <span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px1.p1.1.2">Secondly</span>, most RefSR methods can only use one reference image and even fail to work in the absence of reference images, by contrast, our ReFIR can flexibly use <math alttext="0\sim k" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px1.p1.1.m1.1"><semantics id="A2.SS0.SSS0.Px1.p1.1.m1.1a"><mrow id="A2.SS0.SSS0.Px1.p1.1.m1.1.1" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.cmml"><mn id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.2" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.2.cmml">0</mn><mo id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.1" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.1.cmml">∼</mo><mi id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.3" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px1.p1.1.m1.1b"><apply id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1"><csymbol cd="latexml" id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.1.cmml" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.1">similar-to</csymbol><cn id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.2.cmml" type="integer" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.2">0</cn><ci id="A2.SS0.SSS0.Px1.p1.1.m1.1.1.3.cmml" xref="A2.SS0.SSS0.Px1.p1.1.m1.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px1.p1.1.m1.1c">0\sim k</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px1.p1.1.m1.1d">0 ∼ italic_k</annotation></semantics></math> images. <span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px1.p1.1.3">Thirdly</span>, different from RefSR models that require training, our method can be applied in various LRMs in a training-free manner.</p>
</div>
<figure class="ltx_figure ltx_align_floatright" id="A2.SS0.SSS0.Px1.3">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_table ltx_figure_panel" id="A2.T7">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="A2.T7.3.1.1" style="font-size:90%;">Table 7</span>: </span><span class="ltx_text" id="A2.T7.4.2" style="font-size:90%;">Results of all LR images using the fallback strategies.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="A2.SS0.SSS0.Px1.3.3" style="width:228.4pt;height:81pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-12.7pt,4.5pt) scale(0.9,0.9) ;">
<table class="ltx_tabular ltx_align_middle" id="A2.SS0.SSS0.Px1.3.3.3">
<tr class="ltx_tr" id="A2.SS0.SSS0.Px1.3.3.3.3">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A2.SS0.SSS0.Px1.3.3.3.3.4" style="padding-left:2.5pt;padding-right:2.5pt;">setup</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.SS0.SSS0.Px1.1.1.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1"><semantics id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1a"><mo id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1" stretchy="false" xref="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1b"><ci id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1.cmml" xref="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px1.1.1.1.1.1.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.SS0.SSS0.Px1.2.2.2.2.2" style="padding-left:2.5pt;padding-right:2.5pt;">MUSIQ<math alttext="\uparrow" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1"><semantics id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1a"><mo id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1" stretchy="false" xref="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1b"><ci id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1.cmml" xref="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px1.2.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="A2.SS0.SSS0.Px1.3.3.3.3.3" style="padding-left:2.5pt;padding-right:2.5pt;">CLIPIQA<math alttext="\uparrow" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1"><semantics id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1a"><mo id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1" stretchy="false" xref="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1b"><ci id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1.cmml" xref="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px1.3.3.3.3.3.m1.1d">↑</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="A2.SS0.SSS0.Px1.3.3.3.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A2.SS0.SSS0.Px1.3.3.3.4.1" style="padding-left:2.5pt;padding-right:2.5pt;">origin_lrm</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.SS0.SSS0.Px1.3.3.3.4.2" style="padding-left:2.5pt;padding-right:2.5pt;">4.7432</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.SS0.SSS0.Px1.3.3.3.4.3" style="padding-left:2.5pt;padding-right:2.5pt;">55.54</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A2.SS0.SSS0.Px1.3.3.3.4.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.6575</td>
</tr>
<tr class="ltx_tr" id="A2.SS0.SSS0.Px1.3.3.3.5">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.SS0.SSS0.Px1.3.3.3.5.1" style="padding-left:2.5pt;padding-right:2.5pt;">gen_ref</td>
<td class="ltx_td ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.5.2" style="padding-left:2.5pt;padding-right:2.5pt;">4.6923</td>
<td class="ltx_td ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.5.3" style="padding-left:2.5pt;padding-right:2.5pt;">55.98</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.5.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.6602</td>
</tr>
<tr class="ltx_tr" id="A2.SS0.SSS0.Px1.3.3.3.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.SS0.SSS0.Px1.3.3.3.6.1" style="padding-left:2.5pt;padding-right:2.5pt;">ada_gen_ref</td>
<td class="ltx_td ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.6.2" style="padding-left:2.5pt;padding-right:2.5pt;">4.3464</td>
<td class="ltx_td ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.6.3" style="padding-left:2.5pt;padding-right:2.5pt;">57.68</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A2.SS0.SSS0.Px1.3.3.3.6.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.6942</td>
</tr>
<tr class="ltx_tr" id="A2.SS0.SSS0.Px1.3.3.3.7">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="A2.SS0.SSS0.Px1.3.3.3.7.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="A2.SS0.SSS0.Px1.3.3.3.7.1.1">\rowcolor</span>[HTML]EFEFEF
ReFIR</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.SS0.SSS0.Px1.3.3.3.7.2" style="padding-left:2.5pt;padding-right:2.5pt;">4.4986</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.SS0.SSS0.Px1.3.3.3.7.3" style="padding-left:2.5pt;padding-right:2.5pt;">57.01</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="A2.SS0.SSS0.Px1.3.3.3.7.4" style="padding-left:2.5pt;padding-right:2.5pt;">0.6759</td>
</tr>
</table>
</span></div>
</div>
</div>
</figure>
</section>
<section class="ltx_paragraph" id="A2.SS0.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Performance under extreme conditions.</h4>
<div class="ltx_para" id="A2.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="A2.SS0.SSS0.Px2.p1.4">Since our ReFIR relies on the retrieved images, it is interesting to explore extreme situations when highly relevant and high-quality reference images are scarce or even unavailable. To this end, we introduce the fallback strategies to handle this situation. Specifically, since our method does not modify the parameters of LRMs, we can directly use the original inference pipeline of the LRM without using reference images. We denote this as <math alttext="\mathrm{origin\_lrm}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px2.p1.1.m1.1"><semantics id="A2.SS0.SSS0.Px2.p1.1.m1.1a"><mrow id="A2.SS0.SSS0.Px2.p1.1.m1.1.1" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml"><mi id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.2" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml">origin</mi><mo id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.3" mathvariant="normal" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml">_</mi><mo id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1a" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.4" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.4.cmml">lrm</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px2.p1.1.m1.1b"><apply id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1"><times id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.1"></times><ci id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.2">origin</ci><ci id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.3">_</ci><ci id="A2.SS0.SSS0.Px2.p1.1.m1.1.1.4.cmml" xref="A2.SS0.SSS0.Px2.p1.1.m1.1.1.4">lrm</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px2.p1.1.m1.1c">\mathrm{origin\_lrm}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px2.p1.1.m1.1d">roman_origin _ roman_lrm</annotation></semantics></math>. In addition, we also use the BLIP model to caption the LR image to obtain the text prompt, which will then be fed into the StableDiffusion2.0 model to generate semantic-similar high-quality images as the reference. We denote this as <math alttext="\mathrm{gen\_ref}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px2.p1.2.m2.1"><semantics id="A2.SS0.SSS0.Px2.p1.2.m2.1a"><mrow id="A2.SS0.SSS0.Px2.p1.2.m2.1.1" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml"><mi id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.2" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml">gen</mi><mo id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.3" mathvariant="normal" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml">_</mi><mo id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1a" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.4" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.4.cmml">ref</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px2.p1.2.m2.1b"><apply id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1"><times id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.1"></times><ci id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.2">gen</ci><ci id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.3">_</ci><ci id="A2.SS0.SSS0.Px2.p1.2.m2.1.1.4.cmml" xref="A2.SS0.SSS0.Px2.p1.2.m2.1.1.4">ref</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px2.p1.2.m2.1c">\mathrm{gen\_ref}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px2.p1.2.m2.1d">roman_gen _ roman_ref</annotation></semantics></math>. We use SeeSR <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib19" title=""><span class="ltx_text" style="font-size:90%;">19</span></a>]</cite> as a representative, on the real-world degradation dataset RealPhoto60 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite>. We first give the results in which all LR images adopt the fallback strategies in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.T7" title="In Difference from the other methods. ‣ Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">7</span></a>. It can be seen that using the SD2.0 generated images as the fallback image can bring slightly improvement compared with noReference. After that, we further develop task-oriented adaptive strategies to enhance the performance of ReFIR in real-world scenarios. In detial, we respectively use the retrieved images and the <math alttext="\mathrm{gen\_ref}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px2.p1.3.m3.1"><semantics id="A2.SS0.SSS0.Px2.p1.3.m3.1a"><mrow id="A2.SS0.SSS0.Px2.p1.3.m3.1.1" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.cmml"><mi id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.2" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml">gen</mi><mo id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.3" mathvariant="normal" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml">_</mi><mo id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1a" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.4" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.4.cmml">ref</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px2.p1.3.m3.1b"><apply id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1"><times id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.1"></times><ci id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.2">gen</ci><ci id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.3">_</ci><ci id="A2.SS0.SSS0.Px2.p1.3.m3.1.1.4.cmml" xref="A2.SS0.SSS0.Px2.p1.3.m3.1.1.4">ref</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px2.p1.3.m3.1c">\mathrm{gen\_ref}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px2.p1.3.m3.1d">roman_gen _ roman_ref</annotation></semantics></math> to generate the results. And then we select the one with a larger task score as the final result. We denote it as <math alttext="\mathrm{ada\_gen\_ref}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px2.p1.4.m4.1"><semantics id="A2.SS0.SSS0.Px2.p1.4.m4.1a"><mrow id="A2.SS0.SSS0.Px2.p1.4.m4.1.1" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.cmml"><mi id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.2" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml">ada</mi><mo id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.3" mathvariant="normal" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml">_</mi><mo id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1a" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.4" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.4.cmml">gen</mi><mo id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1b" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.5" mathvariant="normal" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.5.cmml">_</mi><mo id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1c" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml">⁢</mo><mi id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.6" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.6.cmml">ref</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px2.p1.4.m4.1b"><apply id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1"><times id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.1"></times><ci id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.2">ada</ci><ci id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.3">_</ci><ci id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.4.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.4">gen</ci><ci id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.5.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.5">_</ci><ci id="A2.SS0.SSS0.Px2.p1.4.m4.1.1.6.cmml" xref="A2.SS0.SSS0.Px2.p1.4.m4.1.1.6">ref</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px2.p1.4.m4.1c">\mathrm{ada\_gen\_ref}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px2.p1.4.m4.1d">roman_ada _ roman_gen _ roman_ref</annotation></semantics></math>. From <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.T7" title="In Difference from the other methods. ‣ Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">7</span></a>, it can be seen that the task-oriented strategy achieves a significant performance improvement against previous ReFIR baselines, <span class="ltx_text ltx_font_italic" id="A2.SS0.SSS0.Px2.p1.4.1">e.g.</span>, 0.0183 CLIPIQA improvements, due to the fact that it works in the output end. However, this setup is accompanied by a larger inference time, and further acceleration on this fallback strategies can be an promising future work.</p>
</div>
<div class="ltx_para ltx_noindent" id="A2.SS0.SSS0.Px2.p2">
<p class="ltx_p" id="A2.SS0.SSS0.Px2.p2.1"><span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px2.p2.1.1">Computational overhead from retrieval and attention modification.</span>
Since we employ additional Ref images as input and modify the attention layers, we adiscuss the impact of these trchnuques on the inferenve efficiency. First, in order to reduce the computational overhead of the retrieval process, we pre-calculated the feature vectors of all images in the retrieval database before inference. Furthermore, the cosine similarity between the LR image vectors and all retrieval vectors is computed in parallel. These strategy results in an almost negligible (less than 3% inference time) cost of computational overhead. Second, the modification of self-attention layers only happens in the last 20 timestep in the decoder layers, <span class="ltx_text ltx_font_italic" id="A2.SS0.SSS0.Px2.p2.1.2">i.e.</span>, only 12% attention layers are modified while the left is kept intact. These analysis is also supported by practice, in which we find these two process only take up &lt;5% inference time, with most computational cost coming from the original LRM. Future LRM acceleration (<span class="ltx_text ltx_font_italic" id="A2.SS0.SSS0.Px2.p2.1.3">e.g.</span> pruning, quantization, one-step diffusion) will benefit our ReFIR, and we will explore more efficient implementation in the future.</p>
</div>
<figure class="ltx_table" id="A2.T8">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="A2.T8.9.1.1" style="font-size:90%;">Table 8</span>: </span><span class="ltx_text" id="A2.T8.10.2" style="font-size:90%;">Experiments on extending to use multiple retrieved images for restoration. The inference time is evaluated on A100 GPU.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A2.T8.7" style="width:390.3pt;height:67.7pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-12.3pt,2.1pt) scale(0.940719127571667,0.940719127571667) ;">
<table class="ltx_tabular ltx_align_middle" id="A2.T8.7.7">
<tr class="ltx_tr" id="A2.T8.7.7.7">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A2.T8.7.7.7.8">settings</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.T8.1.1.1.1">GPU Memory<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.T8.1.1.1.1.m1.1"><semantics id="A2.T8.1.1.1.1.m1.1a"><mo id="A2.T8.1.1.1.1.m1.1.1" stretchy="false" xref="A2.T8.1.1.1.1.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.T8.1.1.1.1.m1.1b"><ci id="A2.T8.1.1.1.1.m1.1.1.cmml" xref="A2.T8.1.1.1.1.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.1.1.1.1.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.1.1.1.1.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.2.2.2.2">Inference Time<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.T8.2.2.2.2.m1.1"><semantics id="A2.T8.2.2.2.2.m1.1a"><mo id="A2.T8.2.2.2.2.m1.1.1" stretchy="false" xref="A2.T8.2.2.2.2.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.T8.2.2.2.2.m1.1b"><ci id="A2.T8.2.2.2.2.m1.1.1.cmml" xref="A2.T8.2.2.2.2.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.2.2.2.2.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.2.2.2.2.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.T8.3.3.3.3">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="A2.T8.3.3.3.3.m1.1"><semantics id="A2.T8.3.3.3.3.m1.1a"><mo id="A2.T8.3.3.3.3.m1.1.1" stretchy="false" xref="A2.T8.3.3.3.3.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A2.T8.3.3.3.3.m1.1b"><ci id="A2.T8.3.3.3.3.m1.1.1.cmml" xref="A2.T8.3.3.3.3.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.3.3.3.3.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.3.3.3.3.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.T8.4.4.4.4">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="A2.T8.4.4.4.4.m1.1"><semantics id="A2.T8.4.4.4.4.m1.1a"><mo id="A2.T8.4.4.4.4.m1.1.1" stretchy="false" xref="A2.T8.4.4.4.4.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A2.T8.4.4.4.4.m1.1b"><ci id="A2.T8.4.4.4.4.m1.1.1.cmml" xref="A2.T8.4.4.4.4.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.4.4.4.4.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.4.4.4.4.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.T8.5.5.5.5">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.T8.5.5.5.5.m1.1"><semantics id="A2.T8.5.5.5.5.m1.1a"><mo id="A2.T8.5.5.5.5.m1.1.1" stretchy="false" xref="A2.T8.5.5.5.5.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.T8.5.5.5.5.m1.1b"><ci id="A2.T8.5.5.5.5.m1.1.1.cmml" xref="A2.T8.5.5.5.5.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.5.5.5.5.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.5.5.5.5.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A2.T8.6.6.6.6">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.T8.6.6.6.6.m1.1"><semantics id="A2.T8.6.6.6.6.m1.1a"><mo id="A2.T8.6.6.6.6.m1.1.1" stretchy="false" xref="A2.T8.6.6.6.6.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.T8.6.6.6.6.m1.1b"><ci id="A2.T8.6.6.6.6.m1.1.1.cmml" xref="A2.T8.6.6.6.6.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.6.6.6.6.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.6.6.6.6.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="A2.T8.7.7.7.7">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="A2.T8.7.7.7.7.m1.1"><semantics id="A2.T8.7.7.7.7.m1.1a"><mo id="A2.T8.7.7.7.7.m1.1.1" stretchy="false" xref="A2.T8.7.7.7.7.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A2.T8.7.7.7.7.m1.1b"><ci id="A2.T8.7.7.7.7.m1.1.1.cmml" xref="A2.T8.7.7.7.7.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.7.7.7.7.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A2.T8.7.7.7.7.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="A2.T8.7.7.8">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A2.T8.7.7.8.1">NoRef</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.T8.7.7.8.2">37.3G</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.7.7.8.3">146.4s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.T8.7.7.8.4">18.97</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.T8.7.7.8.5">0.4665</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.T8.7.7.8.6">0.4807</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A2.T8.7.7.8.7">4.5624</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A2.T8.7.7.8.8">168.26</td>
</tr>
<tr class="ltx_tr" id="A2.T8.7.7.9">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T8.7.7.9.1">OneRef</td>
<td class="ltx_td ltx_align_center" id="A2.T8.7.7.9.2">51.4G</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T8.7.7.9.3">322.8s</td>
<td class="ltx_td ltx_align_center" id="A2.T8.7.7.9.4">18.86</td>
<td class="ltx_td ltx_align_center" id="A2.T8.7.7.9.5">0.4623</td>
<td class="ltx_td ltx_align_center" id="A2.T8.7.7.9.6">0.4492</td>
<td class="ltx_td ltx_align_center" id="A2.T8.7.7.9.7">4.2317</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A2.T8.7.7.9.8">156.10</td>
</tr>
<tr class="ltx_tr" id="A2.T8.7.7.10">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="A2.T8.7.7.10.1">TwoRef</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.2">65.5G</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="A2.T8.7.7.10.3">499.2s</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.4">18.78</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.5">0.4676</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.6">0.4296</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.7">4.2315</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="A2.T8.7.7.10.8">154.02</td>
</tr>
</table>
</span></div>
</figure>
<figure class="ltx_figure" id="A2.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="398" id="A2.F11.g1" src="x11.png" width="747"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A2.F11.2.1.1" style="font-size:90%;">Figure 11</span>: </span><span class="ltx_text" id="A2.F11.3.2" style="font-size:90%;">Quantitative ablation results on the control scales using SUPIR+ReFIR on CUFED5.</span></figcaption>
</figure>
</section>
<section class="ltx_paragraph" id="A2.SS0.SSS0.Px3">
<h4 class="ltx_title ltx_title_paragraph">Why use the self-attention as the external knowledge?</h4>
<div class="ltx_para" id="A2.SS0.SSS0.Px3.p1">
<p class="ltx_p" id="A2.SS0.SSS0.Px3.p1.5">In the proposed cross-image injection, we use the features of the self-attention layer of the <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px3.p1.1.m1.1"><semantics id="A2.SS0.SSS0.Px3.p1.1.m1.1a"><msub id="A2.SS0.SSS0.Px3.p1.1.m1.1.1" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.2" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.3" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px3.p1.1.m1.1b"><apply id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.2.cmml" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px3.p1.1.m1.1.1.3.cmml" xref="A2.SS0.SSS0.Px3.p1.1.m1.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px3.p1.1.m1.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px3.p1.1.m1.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>’s decoder as external knowledge to guide <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px3.p1.2.m2.1"><semantics id="A2.SS0.SSS0.Px3.p1.2.m2.1a"><msub id="A2.SS0.SSS0.Px3.p1.2.m2.1.1" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.2" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.3" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px3.p1.2.m2.1b"><apply id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.2.cmml" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px3.p1.2.m2.1.1.3.cmml" xref="A2.SS0.SSS0.Px3.p1.2.m2.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px3.p1.2.m2.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px3.p1.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to produce textures faithful to the original scene. Here, we give the reason behind this. <span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px3.p1.5.1">Firstly</span>, previous image-to-image efforts <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib29" title=""><span class="ltx_text" style="font-size:90%;">29</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib31" title=""><span class="ltx_text" style="font-size:90%;">31</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib30" title=""><span class="ltx_text" style="font-size:90%;">30</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib44" title=""><span class="ltx_text" style="font-size:90%;">44</span></a>]</cite>, <span class="ltx_text ltx_font_italic" id="A2.SS0.SSS0.Px3.p1.5.2">e.g.</span>, image editing, has demonstrated through extensive experiments that the self-attention layer of the diffusion model contains important spatial correlations in images, which inspired us to follow this clue to utilize this prior. <span class="ltx_text ltx_font_bold" id="A2.SS0.SSS0.Px3.p1.5.3">Secondly</span>, leveraging the attention mechanism allows <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px3.p1.3.m3.1"><semantics id="A2.SS0.SSS0.Px3.p1.3.m3.1a"><msub id="A2.SS0.SSS0.Px3.p1.3.m3.1.1" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.2" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.3" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px3.p1.3.m3.1b"><apply id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.2.cmml" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px3.p1.3.m3.1.1.3.cmml" xref="A2.SS0.SSS0.Px3.p1.3.m3.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px3.p1.3.m3.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px3.p1.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to query features in <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px3.p1.4.m4.1"><semantics id="A2.SS0.SSS0.Px3.p1.4.m4.1a"><msub id="A2.SS0.SSS0.Px3.p1.4.m4.1.1" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.2" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.3" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px3.p1.4.m4.1b"><apply id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.2.cmml" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px3.p1.4.m4.1.1.3.cmml" xref="A2.SS0.SSS0.Px3.p1.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px3.p1.4.m4.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px3.p1.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> without any training, whereas using features from other parts of <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px3.p1.5.m5.1"><semantics id="A2.SS0.SSS0.Px3.p1.5.m5.1a"><msub id="A2.SS0.SSS0.Px3.p1.5.m5.1.1" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.2" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.3" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px3.p1.5.m5.1b"><apply id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.1.cmml" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.2.cmml" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px3.p1.5.m5.1.1.3.cmml" xref="A2.SS0.SSS0.Px3.p1.5.m5.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px3.p1.5.m5.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px3.p1.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> may require introducing additional training.</p>
</div>
</section>
<section class="ltx_paragraph" id="A2.SS0.SSS0.Px4">
<h4 class="ltx_title ltx_title_paragraph">What about the quality of cross-image attention?</h4>
<div class="ltx_para" id="A2.SS0.SSS0.Px4.p1">
<p class="ltx_p" id="A2.SS0.SSS0.Px4.p1.6">In the proposed cross-image injection, the inter-chain attention is used to perform attention between <math alttext="Q_{T}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.1.m1.1"><semantics id="A2.SS0.SSS0.Px4.p1.1.m1.1a"><msub id="A2.SS0.SSS0.Px4.p1.1.m1.1.1" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1.cmml"><mi id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.2" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1.2.cmml">Q</mi><mi id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.3" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.1.m1.1b"><apply id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1.2">𝑄</ci><ci id="A2.SS0.SSS0.Px4.p1.1.m1.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.1.m1.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.1.m1.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.2.m2.1"><semantics id="A2.SS0.SSS0.Px4.p1.2.m2.1a"><msub id="A2.SS0.SSS0.Px4.p1.2.m2.1.1" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1.cmml"><mi id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.2" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1.2.cmml">K</mi><mi id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.3" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.2.m2.1b"><apply id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1.2">𝐾</ci><ci id="A2.SS0.SSS0.Px4.p1.2.m2.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.2.m2.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.2.m2.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>. Considering the domain gap between <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.3.m3.1"><semantics id="A2.SS0.SSS0.Px4.p1.3.m3.1a"><msub id="A2.SS0.SSS0.Px4.p1.3.m3.1.1" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.2" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.3" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.3.m3.1b"><apply id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px4.p1.3.m3.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.3.m3.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.3.m3.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.3.m3.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.4.m4.1"><semantics id="A2.SS0.SSS0.Px4.p1.4.m4.1a"><msub id="A2.SS0.SSS0.Px4.p1.4.m4.1.1" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.2" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.3" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.4.m4.1b"><apply id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px4.p1.4.m4.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.4.m4.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> due to the input quality difference, one may ask whether the results of the inter-chain attention are meaningful. Here, We visualize the attention map to validate the effectiveness of the inter-chain attention (see <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F13" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">13</span></a>). It can be seen that for a given query pixel query in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.5.m5.1"><semantics id="A2.SS0.SSS0.Px4.p1.5.m5.1a"><msub id="A2.SS0.SSS0.Px4.p1.5.m5.1.1" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.2" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.3" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.5.m5.1b"><apply id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px4.p1.5.m5.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.5.m5.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.5.m5.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, the inter-chain attention can effectively overcome the spatial misalignment, and find relevant pixel features in <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A2.SS0.SSS0.Px4.p1.6.m6.1"><semantics id="A2.SS0.SSS0.Px4.p1.6.m6.1a"><msub id="A2.SS0.SSS0.Px4.p1.6.m6.1.1" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.2" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1.2.cmml">𝒞</mi><mi id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.3" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A2.SS0.SSS0.Px4.p1.6.m6.1b"><apply id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1"><csymbol cd="ambiguous" id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.1.cmml" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1">subscript</csymbol><ci id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.2.cmml" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1.2">𝒞</ci><ci id="A2.SS0.SSS0.Px4.p1.6.m6.1.1.3.cmml" xref="A2.SS0.SSS0.Px4.p1.6.m6.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.SS0.SSS0.Px4.p1.6.m6.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A2.SS0.SSS0.Px4.p1.6.m6.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> for reference.</p>
</div>
</section>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>More Ablation Results</h2>
<section class="ltx_paragraph" id="A3.SS0.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Quantitative ablation on the control scale.</h4>
<div class="ltx_para" id="A3.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="A3.SS0.SSS0.Px1.p1.4">We also provide quantitative ablation results on the control scale <math alttext="s" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.p1.1.m1.1"><semantics id="A3.SS0.SSS0.Px1.p1.1.m1.1a"><mi id="A3.SS0.SSS0.Px1.p1.1.m1.1.1" xref="A3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.p1.1.m1.1b"><ci id="A3.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="A3.SS0.SSS0.Px1.p1.1.m1.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.p1.1.m1.1c">s</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.p1.1.m1.1d">italic_s</annotation></semantics></math> in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A2.F11" title="In Performance under extreme conditions. ‣ Appendix B More Discussions ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">11</span></a>. It can be seen that when <math alttext="s" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.p1.2.m2.1"><semantics id="A3.SS0.SSS0.Px1.p1.2.m2.1a"><mi id="A3.SS0.SSS0.Px1.p1.2.m2.1.1" xref="A3.SS0.SSS0.Px1.p1.2.m2.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.p1.2.m2.1b"><ci id="A3.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="A3.SS0.SSS0.Px1.p1.2.m2.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.p1.2.m2.1c">s</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.p1.2.m2.1d">italic_s</annotation></semantics></math> is too small, the LRM will mainly use the knowledge contained within its parameters to restore high-quality images, which can lead to performance degradation due to the hallucination problem. On the other hand, when <math alttext="s" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.p1.3.m3.1"><semantics id="A3.SS0.SSS0.Px1.p1.3.m3.1a"><mi id="A3.SS0.SSS0.Px1.p1.3.m3.1.1" xref="A3.SS0.SSS0.Px1.p1.3.m3.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.p1.3.m3.1b"><ci id="A3.SS0.SSS0.Px1.p1.3.m3.1.1.cmml" xref="A3.SS0.SSS0.Px1.p1.3.m3.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.p1.3.m3.1c">s</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.p1.3.m3.1d">italic_s</annotation></semantics></math> is too large, the LRM will overuse the content in the retrieved reference image, thus producing patterns that are not present in the original LQ image. In practice, we adopt a moderate <math alttext="s=0.5" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.p1.4.m4.1"><semantics id="A3.SS0.SSS0.Px1.p1.4.m4.1a"><mrow id="A3.SS0.SSS0.Px1.p1.4.m4.1.1" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.cmml"><mi id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.2" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml">s</mi><mo id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.1" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.1.cmml">=</mo><mn id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.3" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml">0.5</mn></mrow><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.p1.4.m4.1b"><apply id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.cmml" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1"><eq id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.1"></eq><ci id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.2">𝑠</ci><cn id="A3.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml" type="float" xref="A3.SS0.SSS0.Px1.p1.4.m4.1.1.3">0.5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.p1.4.m4.1c">s=0.5</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.p1.4.m4.1d">italic_s = 0.5</annotation></semantics></math> to trade off the hallucination and the overuse of the reference image.</p>
</div>
<figure class="ltx_figure ltx_align_floatright" id="A3.SS0.SSS0.Px1.4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_table ltx_figure_panel" id="A3.T9">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="A3.T9.3.1.1" style="font-size:90%;">Table 9</span>: </span><span class="ltx_text" id="A3.T9.4.2" style="font-size:90%;">Ablation experiments on different cross image injection designs.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="A3.SS0.SSS0.Px1.4.4" style="width:239.8pt;height:64.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-13.3pt,3.6pt) scale(0.9,0.9) ;">
<table class="ltx_tabular ltx_align_middle" id="A3.SS0.SSS0.Px1.4.4.4">
<tr class="ltx_tr" id="A3.SS0.SSS0.Px1.4.4.4.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A3.SS0.SSS0.Px1.4.4.4.4.5" style="padding-left:2.5pt;padding-right:2.5pt;">settings</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A3.SS0.SSS0.Px1.1.1.1.1.1" style="padding-left:2.5pt;padding-right:2.5pt;">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1"><semantics id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1a"><mo id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1" stretchy="false" xref="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1b"><ci id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1.cmml" xref="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.1.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A3.SS0.SSS0.Px1.2.2.2.2.2" style="padding-left:2.5pt;padding-right:2.5pt;">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1"><semantics id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1a"><mo id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1" stretchy="false" xref="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1b"><ci id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1.cmml" xref="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.2.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A3.SS0.SSS0.Px1.3.3.3.3.3" style="padding-left:2.5pt;padding-right:2.5pt;">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1"><semantics id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1a"><mo id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1" stretchy="false" xref="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1b"><ci id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1.cmml" xref="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.3.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="A3.SS0.SSS0.Px1.4.4.4.4.4" style="padding-left:2.5pt;padding-right:2.5pt;">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1"><semantics id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1a"><mo id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1.1" stretchy="false" xref="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1b"><ci id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1.1.cmml" xref="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px1.4.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="A3.SS0.SSS0.Px1.4.4.4.5">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A3.SS0.SSS0.Px1.4.4.4.5.1" style="padding-left:2.5pt;padding-right:2.5pt;">replace</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.SS0.SSS0.Px1.4.4.4.5.2" style="padding-left:2.5pt;padding-right:2.5pt;">18.84</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.SS0.SSS0.Px1.4.4.4.5.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4385</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.SS0.SSS0.Px1.4.4.4.5.4" style="padding-left:2.5pt;padding-right:2.5pt;">4.26</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A3.SS0.SSS0.Px1.4.4.4.5.5" style="padding-left:2.5pt;padding-right:2.5pt;">182.82</td>
</tr>
<tr class="ltx_tr" id="A3.SS0.SSS0.Px1.4.4.4.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.SS0.SSS0.Px1.4.4.4.6.1" style="padding-left:2.5pt;padding-right:2.5pt;">concat</td>
<td class="ltx_td ltx_align_center" id="A3.SS0.SSS0.Px1.4.4.4.6.2" style="padding-left:2.5pt;padding-right:2.5pt;">18.89</td>
<td class="ltx_td ltx_align_center" id="A3.SS0.SSS0.Px1.4.4.4.6.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4691</td>
<td class="ltx_td ltx_align_center" id="A3.SS0.SSS0.Px1.4.4.4.6.4" style="padding-left:2.5pt;padding-right:2.5pt;">4.19</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A3.SS0.SSS0.Px1.4.4.4.6.5" style="padding-left:2.5pt;padding-right:2.5pt;">156.03</td>
</tr>
<tr class="ltx_tr" id="A3.SS0.SSS0.Px1.4.4.4.7">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="A3.SS0.SSS0.Px1.4.4.4.7.1" style="padding-left:2.5pt;padding-right:2.5pt;">
<span class="ltx_ERROR undefined" id="A3.SS0.SSS0.Px1.4.4.4.7.1.1">\rowcolor</span>[HTML]EFEFEF
baseline</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A3.SS0.SSS0.Px1.4.4.4.7.2" style="padding-left:2.5pt;padding-right:2.5pt;">19.00</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A3.SS0.SSS0.Px1.4.4.4.7.3" style="padding-left:2.5pt;padding-right:2.5pt;">0.4729</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A3.SS0.SSS0.Px1.4.4.4.7.4" style="padding-left:2.5pt;padding-right:2.5pt;">4.21</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="A3.SS0.SSS0.Px1.4.4.4.7.5" style="padding-left:2.5pt;padding-right:2.5pt;">148.69</td>
</tr>
</table>
</span></div>
</div>
</div>
</figure>
</section>
<section class="ltx_paragraph" id="A3.SS0.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Other choices for cross image injection.</h4>
<div class="ltx_para" id="A3.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="A3.SS0.SSS0.Px2.p1.12">The proposed cross image injection mitigates the domain preference problem by using separate attention to promote latent in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.1.m1.1"><semantics id="A3.SS0.SSS0.Px2.p1.1.m1.1a"><msub id="A3.SS0.SSS0.Px2.p1.1.m1.1.1" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.2" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.3" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.1.m1.1b"><apply id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.1.m1.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.1.m1.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to attend <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.2.m2.1"><semantics id="A3.SS0.SSS0.Px2.p1.2.m2.1a"><msub id="A3.SS0.SSS0.Px2.p1.2.m2.1.1" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.2" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.3" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.2.m2.1b"><apply id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.2.m2.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.2.m2.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>. Here, we conduct ablation to study the impact of different design choices of cross image injection. As shown in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A3.T9" title="In Quantitative ablation on the control scale. ‣ Appendix C More Ablation Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">9</span></a>, directly replacing the original self-attention results from <math alttext="O_{intra}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.3.m3.1"><semantics id="A3.SS0.SSS0.Px2.p1.3.m3.1a"><msub id="A3.SS0.SSS0.Px2.p1.3.m3.1.1" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.cmml"><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.2" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml">O</mi><mrow id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml"><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.2" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.2.cmml">i</mi><mo id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.3" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.3.cmml">n</mi><mo id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1a" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.4" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.4.cmml">t</mi><mo id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1b" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.5" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.5.cmml">r</mi><mo id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1c" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.6" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.6.cmml">a</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.3.m3.1b"><apply id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.2">𝑂</ci><apply id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3"><times id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.1"></times><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.2.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.2">𝑖</ci><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.3.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.3">𝑛</ci><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.4.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.4">𝑡</ci><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.5.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.5">𝑟</ci><ci id="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.6.cmml" xref="A3.SS0.SSS0.Px2.p1.3.m3.1.1.3.6">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.3.m3.1c">O_{intra}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.3.m3.1d">italic_O start_POSTSUBSCRIPT italic_i italic_n italic_t italic_r italic_a end_POSTSUBSCRIPT</annotation></semantics></math> in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.4.m4.1"><semantics id="A3.SS0.SSS0.Px2.p1.4.m4.1a"><msub id="A3.SS0.SSS0.Px2.p1.4.m4.1.1" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.2" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.3" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.4.m4.1b"><apply id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.4.m4.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.4.m4.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.4.m4.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> with corresponding latent in <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.5.m5.1"><semantics id="A3.SS0.SSS0.Px2.p1.5.m5.1a"><msub id="A3.SS0.SSS0.Px2.p1.5.m5.1.1" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.2" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.3" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.5.m5.1b"><apply id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.5.m5.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.5.m5.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.5.m5.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.5.m5.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> causes severe performance degradation, due to the significant loss of original knowledge in <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.6.m6.1"><semantics id="A3.SS0.SSS0.Px2.p1.6.m6.1a"><msub id="A3.SS0.SSS0.Px2.p1.6.m6.1.1" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.2" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.3" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.6.m6.1b"><apply id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.6.m6.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.6.m6.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.6.m6.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.6.m6.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>.
In addition, using <math alttext="Q_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.7.m7.1"><semantics id="A3.SS0.SSS0.Px2.p1.7.m7.1a"><msub id="A3.SS0.SSS0.Px2.p1.7.m7.1.1" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1.cmml"><mi id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.2" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1.2.cmml">Q</mi><mi id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.3" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.7.m7.1b"><apply id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1.2">𝑄</ci><ci id="A3.SS0.SSS0.Px2.p1.7.m7.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.7.m7.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.7.m7.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.7.m7.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> to query the concatenation results of <math alttext="K_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.8.m8.1"><semantics id="A3.SS0.SSS0.Px2.p1.8.m8.1a"><msub id="A3.SS0.SSS0.Px2.p1.8.m8.1.1" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1.cmml"><mi id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.2" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1.2.cmml">K</mi><mi id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.3" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.8.m8.1b"><apply id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1.2">𝐾</ci><ci id="A3.SS0.SSS0.Px2.p1.8.m8.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.8.m8.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.8.m8.1c">K_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.8.m8.1d">italic_K start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="K_{S}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.9.m9.1"><semantics id="A3.SS0.SSS0.Px2.p1.9.m9.1a"><msub id="A3.SS0.SSS0.Px2.p1.9.m9.1.1" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1.cmml"><mi id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.2" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1.2.cmml">K</mi><mi id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.3" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.9.m9.1b"><apply id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1.2">𝐾</ci><ci id="A3.SS0.SSS0.Px2.p1.9.m9.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.9.m9.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.9.m9.1c">K_{S}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.9.m9.1d">italic_K start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> also causes a performance drop, which further confirms that the domain preference problem, <span class="ltx_text ltx_font_italic" id="A3.SS0.SSS0.Px2.p1.12.1">i.e.</span>, <math alttext="Q_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.10.m10.1"><semantics id="A3.SS0.SSS0.Px2.p1.10.m10.1a"><msub id="A3.SS0.SSS0.Px2.p1.10.m10.1.1" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1.cmml"><mi id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.2" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1.2.cmml">Q</mi><mi id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.3" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.10.m10.1b"><apply id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1.2">𝑄</ci><ci id="A3.SS0.SSS0.Px2.p1.10.m10.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.10.m10.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.10.m10.1c">Q_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.10.m10.1d">italic_Q start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> prefers to use latent from the same chain <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.11.m11.1"><semantics id="A3.SS0.SSS0.Px2.p1.11.m11.1a"><msub id="A3.SS0.SSS0.Px2.p1.11.m11.1.1" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.2" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.3" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.11.m11.1b"><apply id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.11.m11.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.11.m11.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.11.m11.1c">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.11.m11.1d">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, even though <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A3.SS0.SSS0.Px2.p1.12.m12.1"><semantics id="A3.SS0.SSS0.Px2.p1.12.m12.1a"><msub id="A3.SS0.SSS0.Px2.p1.12.m12.1.1" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.2" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1.2.cmml">𝒞</mi><mi id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.3" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A3.SS0.SSS0.Px2.p1.12.m12.1b"><apply id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1"><csymbol cd="ambiguous" id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.1.cmml" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1">subscript</csymbol><ci id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.2.cmml" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1.2">𝒞</ci><ci id="A3.SS0.SSS0.Px2.p1.12.m12.1.1.3.cmml" xref="A3.SS0.SSS0.Px2.p1.12.m12.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS0.SSS0.Px2.p1.12.m12.1c">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A3.SS0.SSS0.Px2.p1.12.m12.1d">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> is more helpful for reconstruction.</p>
</div>
</section>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>Statistical Significance on Performance</h2>
<div class="ltx_para" id="A4.p1">
<p class="ltx_p" id="A4.p1.1">In <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#S5.T1" title="In 5.1 Experiments Setup ‣ 5 Experiments ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">1</span></a> of the main paper, we give the performance gains of incorporating the proposed ReFIR into the existing LRMs. Considering the randomness of the generative models, we give the performance fluctuations of ReFIR under multiple trials with exactly the same experimental setting and random seed. The results are given in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A6.T10" title="In Appendix F Limitation and Future Works ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Tab.</span> <span class="ltx_text ltx_ref_tag">10</span></a>. It can be seen that the randomness of the diffusion-based generative model is very small when using a fixed seed, reducing the disturbance from noise errors for evaluation. In addition, we further use hypothesis testing to verify the significance of performance gains, and the test results reject the original hypothesis H0 at 95% confidence level on all metrics and datasets, indicating that the performance gains from the proposed method are statistically significant.</p>
</div>
</section>
<section class="ltx_appendix" id="A5">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix E </span>Extension to Specific Restoration Scenarios</h2>
<div class="ltx_para" id="A5.p1">
<p class="ltx_p" id="A5.p1.1">An important application of our method is in scenarios with high fidelity demands, such as scene text images with a specific stylistic structure, or face images with identity preservation, and here we preliminarily explore the application of the proposed ReFIR to real-world face image restoration. The results are given in <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F15" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">15</span></a>. It can be seen that by using a high quality image of a specific person’s identity as a reference, the resulting restoration results can better preserve the person’s attributes. However, it should be noted that this experiment is just a preliminary attempt, and we will leave the further improvement of our ReFIR for specific downstream restoration tasks for future work.</p>
</div>
</section>
<section class="ltx_appendix" id="A6">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix F </span>Limitation and Future Works</h2>
<div class="ltx_para" id="A6.p1">
<p class="ltx_p" id="A6.p1.1">Although the proposed ReFIR can effectively mitigate the hallucination of LRMs by introducing external knowledge from retrieved reference images, the proposed framework can be further improved in the following aspects. First, since the computational complexity of the current LRMs is costly, the computational complexity will be further increased when using the proposed method, which may hinder the use of resource-constrained mobile devices. With the advent of accelerated diffusion-based image restoration methods in the future, we believe that the proposed method can further improve its efficiency. In addition, this paper proposes a simple retriever based on semantic vector matching for presentation. With the development of image retrieval techniques <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib58" title=""><span class="ltx_text" style="font-size:90%;">58</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib59" title=""><span class="ltx_text" style="font-size:90%;">59</span></a>]</cite>, designing specialized retrievers, <span class="ltx_text ltx_font_italic" id="A6.p1.1.1">e.g</span>., using textures as key matching cues, will further improve the performance. Finally, for some slightly degraded images, which can already be handled well by only using the internal knowledge of the LRMs, designing hyper-networks to adaptively decide whether to use retrieval augmentation or not is also promising. We leave the above considerations for future work.</p>
</div>
<figure class="ltx_table" id="A6.T10">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="A6.T10.32.1.1" style="font-size:90%;">Table 10</span>: </span><span class="ltx_text" id="A6.T10.33.2" style="font-size:90%;">Performance fluctuations under different experiment trials. We use ten trails to obtain a stable fluctuation range.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A6.T10.30" style="width:433.6pt;height:82.6pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-66.5pt,12.7pt) scale(0.765247644931073,0.765247644931073) ;">
<table class="ltx_tabular ltx_align_middle" id="A6.T10.30.30">
<tr class="ltx_tr" id="A6.T10.30.30.31">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A6.T10.30.30.31.1" rowspan="2"><span class="ltx_text" id="A6.T10.30.30.31.1.1">settings</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="5" id="A6.T10.30.30.31.2"><span class="ltx_text ltx_font_bold" id="A6.T10.30.30.31.2.1">CUDED5</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="5" id="A6.T10.30.30.31.3"><span class="ltx_text ltx_font_bold" id="A6.T10.30.30.31.3.1">WR-SR</span></td>
</tr>
<tr class="ltx_tr" id="A6.T10.10.10.10">
<td class="ltx_td ltx_align_center" id="A6.T10.1.1.1.1">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="A6.T10.1.1.1.1.m1.1"><semantics id="A6.T10.1.1.1.1.m1.1a"><mo id="A6.T10.1.1.1.1.m1.1.1" stretchy="false" xref="A6.T10.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A6.T10.1.1.1.1.m1.1b"><ci id="A6.T10.1.1.1.1.m1.1.1.cmml" xref="A6.T10.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.2.2.2.2">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="A6.T10.2.2.2.2.m1.1"><semantics id="A6.T10.2.2.2.2.m1.1a"><mo id="A6.T10.2.2.2.2.m1.1.1" stretchy="false" xref="A6.T10.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A6.T10.2.2.2.2.m1.1b"><ci id="A6.T10.2.2.2.2.m1.1.1.cmml" xref="A6.T10.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.3.3.3.3">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.3.3.3.3.m1.1"><semantics id="A6.T10.3.3.3.3.m1.1a"><mo id="A6.T10.3.3.3.3.m1.1.1" stretchy="false" xref="A6.T10.3.3.3.3.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.3.3.3.3.m1.1b"><ci id="A6.T10.3.3.3.3.m1.1.1.cmml" xref="A6.T10.3.3.3.3.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.3.3.3.3.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.3.3.3.3.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.4.4.4.4">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.4.4.4.4.m1.1"><semantics id="A6.T10.4.4.4.4.m1.1a"><mo id="A6.T10.4.4.4.4.m1.1.1" stretchy="false" xref="A6.T10.4.4.4.4.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.4.4.4.4.m1.1b"><ci id="A6.T10.4.4.4.4.m1.1.1.cmml" xref="A6.T10.4.4.4.4.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.4.4.4.4.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.4.4.4.4.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A6.T10.5.5.5.5">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.5.5.5.5.m1.1"><semantics id="A6.T10.5.5.5.5.m1.1a"><mo id="A6.T10.5.5.5.5.m1.1.1" stretchy="false" xref="A6.T10.5.5.5.5.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.5.5.5.5.m1.1b"><ci id="A6.T10.5.5.5.5.m1.1.1.cmml" xref="A6.T10.5.5.5.5.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.5.5.5.5.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.5.5.5.5.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.6.6.6.6">PSNR<math alttext="\uparrow" class="ltx_Math" display="inline" id="A6.T10.6.6.6.6.m1.1"><semantics id="A6.T10.6.6.6.6.m1.1a"><mo id="A6.T10.6.6.6.6.m1.1.1" stretchy="false" xref="A6.T10.6.6.6.6.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A6.T10.6.6.6.6.m1.1b"><ci id="A6.T10.6.6.6.6.m1.1.1.cmml" xref="A6.T10.6.6.6.6.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.6.6.6.6.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.6.6.6.6.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.7.7.7.7">SSIM<math alttext="\uparrow" class="ltx_Math" display="inline" id="A6.T10.7.7.7.7.m1.1"><semantics id="A6.T10.7.7.7.7.m1.1a"><mo id="A6.T10.7.7.7.7.m1.1.1" stretchy="false" xref="A6.T10.7.7.7.7.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A6.T10.7.7.7.7.m1.1b"><ci id="A6.T10.7.7.7.7.m1.1.1.cmml" xref="A6.T10.7.7.7.7.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.7.7.7.7.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.7.7.7.7.m1.1d">↑</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.8.8.8.8">LPIPS<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.8.8.8.8.m1.1"><semantics id="A6.T10.8.8.8.8.m1.1a"><mo id="A6.T10.8.8.8.8.m1.1.1" stretchy="false" xref="A6.T10.8.8.8.8.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.8.8.8.8.m1.1b"><ci id="A6.T10.8.8.8.8.m1.1.1.cmml" xref="A6.T10.8.8.8.8.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.8.8.8.8.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.8.8.8.8.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="A6.T10.9.9.9.9">NIQE<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.9.9.9.9.m1.1"><semantics id="A6.T10.9.9.9.9.m1.1a"><mo id="A6.T10.9.9.9.9.m1.1.1" stretchy="false" xref="A6.T10.9.9.9.9.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.9.9.9.9.m1.1b"><ci id="A6.T10.9.9.9.9.m1.1.1.cmml" xref="A6.T10.9.9.9.9.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.9.9.9.9.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.9.9.9.9.m1.1d">↓</annotation></semantics></math>
</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A6.T10.10.10.10.10">FID<math alttext="\downarrow" class="ltx_Math" display="inline" id="A6.T10.10.10.10.10.m1.1"><semantics id="A6.T10.10.10.10.10.m1.1a"><mo id="A6.T10.10.10.10.10.m1.1.1" stretchy="false" xref="A6.T10.10.10.10.10.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A6.T10.10.10.10.10.m1.1b"><ci id="A6.T10.10.10.10.10.m1.1.1.cmml" xref="A6.T10.10.10.10.10.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.10.10.10.10.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A6.T10.10.10.10.10.m1.1d">↓</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.30.30.32">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A6.T10.30.30.32.1">SeeSR+ReFIR</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.2">20.32</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.3">0.5289</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.4">0.3338</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.5">3.7831</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A6.T10.30.30.32.6">134.62</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.7">21.86</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.8">0.5664</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.9">0.3460</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.32.10">3.9089</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A6.T10.30.30.32.11">61.22</td>
</tr>
<tr class="ltx_tr" id="A6.T10.20.20.20">
<td class="ltx_td ltx_align_left ltx_border_r" id="A6.T10.20.20.20.11">Numerical fluctuations</td>
<td class="ltx_td ltx_align_center" id="A6.T10.11.11.11.1">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.11.11.11.1.m1.1"><semantics id="A6.T10.11.11.11.1.m1.1a"><mo id="A6.T10.11.11.11.1.m1.1.1" xref="A6.T10.11.11.11.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.11.11.11.1.m1.1b"><csymbol cd="latexml" id="A6.T10.11.11.11.1.m1.1.1.cmml" xref="A6.T10.11.11.11.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.11.11.11.1.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.11.11.11.1.m1.1d">±</annotation></semantics></math>0.0013</td>
<td class="ltx_td ltx_align_center" id="A6.T10.12.12.12.2">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.12.12.12.2.m1.1"><semantics id="A6.T10.12.12.12.2.m1.1a"><mo id="A6.T10.12.12.12.2.m1.1.1" xref="A6.T10.12.12.12.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.12.12.12.2.m1.1b"><csymbol cd="latexml" id="A6.T10.12.12.12.2.m1.1.1.cmml" xref="A6.T10.12.12.12.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.12.12.12.2.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.12.12.12.2.m1.1d">±</annotation></semantics></math>0.0001</td>
<td class="ltx_td ltx_align_center" id="A6.T10.13.13.13.3">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.13.13.13.3.m1.1"><semantics id="A6.T10.13.13.13.3.m1.1a"><mo id="A6.T10.13.13.13.3.m1.1.1" xref="A6.T10.13.13.13.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.13.13.13.3.m1.1b"><csymbol cd="latexml" id="A6.T10.13.13.13.3.m1.1.1.cmml" xref="A6.T10.13.13.13.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.13.13.13.3.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.13.13.13.3.m1.1d">±</annotation></semantics></math>0.0002</td>
<td class="ltx_td ltx_align_center" id="A6.T10.14.14.14.4">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.14.14.14.4.m1.1"><semantics id="A6.T10.14.14.14.4.m1.1a"><mo id="A6.T10.14.14.14.4.m1.1.1" xref="A6.T10.14.14.14.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.14.14.14.4.m1.1b"><csymbol cd="latexml" id="A6.T10.14.14.14.4.m1.1.1.cmml" xref="A6.T10.14.14.14.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.14.14.14.4.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.14.14.14.4.m1.1d">±</annotation></semantics></math>0.0001</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A6.T10.15.15.15.5">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.15.15.15.5.m1.1"><semantics id="A6.T10.15.15.15.5.m1.1a"><mo id="A6.T10.15.15.15.5.m1.1.1" xref="A6.T10.15.15.15.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.15.15.15.5.m1.1b"><csymbol cd="latexml" id="A6.T10.15.15.15.5.m1.1.1.cmml" xref="A6.T10.15.15.15.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.15.15.15.5.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.15.15.15.5.m1.1d">±</annotation></semantics></math>0.03</td>
<td class="ltx_td ltx_align_center" id="A6.T10.16.16.16.6">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.16.16.16.6.m1.1"><semantics id="A6.T10.16.16.16.6.m1.1a"><mo id="A6.T10.16.16.16.6.m1.1.1" xref="A6.T10.16.16.16.6.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.16.16.16.6.m1.1b"><csymbol cd="latexml" id="A6.T10.16.16.16.6.m1.1.1.cmml" xref="A6.T10.16.16.16.6.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.16.16.16.6.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.16.16.16.6.m1.1d">±</annotation></semantics></math>0.001</td>
<td class="ltx_td ltx_align_center" id="A6.T10.17.17.17.7">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.17.17.17.7.m1.1"><semantics id="A6.T10.17.17.17.7.m1.1a"><mo id="A6.T10.17.17.17.7.m1.1.1" xref="A6.T10.17.17.17.7.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.17.17.17.7.m1.1b"><csymbol cd="latexml" id="A6.T10.17.17.17.7.m1.1.1.cmml" xref="A6.T10.17.17.17.7.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.17.17.17.7.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.17.17.17.7.m1.1d">±</annotation></semantics></math> 0.0001</td>
<td class="ltx_td ltx_align_center" id="A6.T10.18.18.18.8">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.18.18.18.8.m1.1"><semantics id="A6.T10.18.18.18.8.m1.1a"><mo id="A6.T10.18.18.18.8.m1.1.1" xref="A6.T10.18.18.18.8.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.18.18.18.8.m1.1b"><csymbol cd="latexml" id="A6.T10.18.18.18.8.m1.1.1.cmml" xref="A6.T10.18.18.18.8.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.18.18.18.8.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.18.18.18.8.m1.1d">±</annotation></semantics></math>0.0002</td>
<td class="ltx_td ltx_align_center" id="A6.T10.19.19.19.9">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.19.19.19.9.m1.1"><semantics id="A6.T10.19.19.19.9.m1.1a"><mo id="A6.T10.19.19.19.9.m1.1.1" xref="A6.T10.19.19.19.9.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.19.19.19.9.m1.1b"><csymbol cd="latexml" id="A6.T10.19.19.19.9.m1.1.1.cmml" xref="A6.T10.19.19.19.9.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.19.19.19.9.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.19.19.19.9.m1.1d">±</annotation></semantics></math>0.0001</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A6.T10.20.20.20.10">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.20.20.20.10.m1.1"><semantics id="A6.T10.20.20.20.10.m1.1a"><mo id="A6.T10.20.20.20.10.m1.1.1" xref="A6.T10.20.20.20.10.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.20.20.20.10.m1.1b"><csymbol cd="latexml" id="A6.T10.20.20.20.10.m1.1.1.cmml" xref="A6.T10.20.20.20.10.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.20.20.20.10.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.20.20.20.10.m1.1d">±</annotation></semantics></math> 0.02</td>
</tr>
<tr class="ltx_tr" id="A6.T10.30.30.33">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A6.T10.30.30.33.1">SUPIR+ReFIR</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.2">19.00</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.3">0.4729</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.4">0.4341</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.5">4.2085</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A6.T10.30.30.33.6">148.69</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.7">21.02</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.8">0.5497</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.9">0.3785</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A6.T10.30.30.33.10">3.7478</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A6.T10.30.30.33.11">71.82</td>
</tr>
<tr class="ltx_tr" id="A6.T10.30.30.30">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="A6.T10.30.30.30.11">Numerical fluctuations</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.21.21.21.1">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.21.21.21.1.m1.1"><semantics id="A6.T10.21.21.21.1.m1.1a"><mo id="A6.T10.21.21.21.1.m1.1.1" xref="A6.T10.21.21.21.1.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.21.21.21.1.m1.1b"><csymbol cd="latexml" id="A6.T10.21.21.21.1.m1.1.1.cmml" xref="A6.T10.21.21.21.1.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.21.21.21.1.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.21.21.21.1.m1.1d">±</annotation></semantics></math>0.005</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.22.22.22.2">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.22.22.22.2.m1.1"><semantics id="A6.T10.22.22.22.2.m1.1a"><mo id="A6.T10.22.22.22.2.m1.1.1" xref="A6.T10.22.22.22.2.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.22.22.22.2.m1.1b"><csymbol cd="latexml" id="A6.T10.22.22.22.2.m1.1.1.cmml" xref="A6.T10.22.22.22.2.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.22.22.22.2.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.22.22.22.2.m1.1d">±</annotation></semantics></math>0.0003</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.23.23.23.3">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.23.23.23.3.m1.1"><semantics id="A6.T10.23.23.23.3.m1.1a"><mo id="A6.T10.23.23.23.3.m1.1.1" xref="A6.T10.23.23.23.3.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.23.23.23.3.m1.1b"><csymbol cd="latexml" id="A6.T10.23.23.23.3.m1.1.1.cmml" xref="A6.T10.23.23.23.3.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.23.23.23.3.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.23.23.23.3.m1.1d">±</annotation></semantics></math>0.001</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.24.24.24.4">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.24.24.24.4.m1.1"><semantics id="A6.T10.24.24.24.4.m1.1a"><mo id="A6.T10.24.24.24.4.m1.1.1" xref="A6.T10.24.24.24.4.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.24.24.24.4.m1.1b"><csymbol cd="latexml" id="A6.T10.24.24.24.4.m1.1.1.cmml" xref="A6.T10.24.24.24.4.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.24.24.24.4.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.24.24.24.4.m1.1d">±</annotation></semantics></math>0.012</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="A6.T10.25.25.25.5">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.25.25.25.5.m1.1"><semantics id="A6.T10.25.25.25.5.m1.1a"><mo id="A6.T10.25.25.25.5.m1.1.1" xref="A6.T10.25.25.25.5.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.25.25.25.5.m1.1b"><csymbol cd="latexml" id="A6.T10.25.25.25.5.m1.1.1.cmml" xref="A6.T10.25.25.25.5.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.25.25.25.5.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.25.25.25.5.m1.1d">±</annotation></semantics></math>0.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.26.26.26.6">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.26.26.26.6.m1.1"><semantics id="A6.T10.26.26.26.6.m1.1a"><mo id="A6.T10.26.26.26.6.m1.1.1" xref="A6.T10.26.26.26.6.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.26.26.26.6.m1.1b"><csymbol cd="latexml" id="A6.T10.26.26.26.6.m1.1.1.cmml" xref="A6.T10.26.26.26.6.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.26.26.26.6.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.26.26.26.6.m1.1d">±</annotation></semantics></math>0.002</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.27.27.27.7">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.27.27.27.7.m1.1"><semantics id="A6.T10.27.27.27.7.m1.1a"><mo id="A6.T10.27.27.27.7.m1.1.1" xref="A6.T10.27.27.27.7.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.27.27.27.7.m1.1b"><csymbol cd="latexml" id="A6.T10.27.27.27.7.m1.1.1.cmml" xref="A6.T10.27.27.27.7.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.27.27.27.7.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.27.27.27.7.m1.1d">±</annotation></semantics></math>0.0003</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.28.28.28.8">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.28.28.28.8.m1.1"><semantics id="A6.T10.28.28.28.8.m1.1a"><mo id="A6.T10.28.28.28.8.m1.1.1" xref="A6.T10.28.28.28.8.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.28.28.28.8.m1.1b"><csymbol cd="latexml" id="A6.T10.28.28.28.8.m1.1.1.cmml" xref="A6.T10.28.28.28.8.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.28.28.28.8.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.28.28.28.8.m1.1d">±</annotation></semantics></math>0.0006</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A6.T10.29.29.29.9">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.29.29.29.9.m1.1"><semantics id="A6.T10.29.29.29.9.m1.1a"><mo id="A6.T10.29.29.29.9.m1.1.1" xref="A6.T10.29.29.29.9.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.29.29.29.9.m1.1b"><csymbol cd="latexml" id="A6.T10.29.29.29.9.m1.1.1.cmml" xref="A6.T10.29.29.29.9.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.29.29.29.9.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.29.29.29.9.m1.1d">±</annotation></semantics></math>0.007</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="A6.T10.30.30.30.10">
<math alttext="\pm" class="ltx_Math" display="inline" id="A6.T10.30.30.30.10.m1.1"><semantics id="A6.T10.30.30.30.10.m1.1a"><mo id="A6.T10.30.30.30.10.m1.1.1" xref="A6.T10.30.30.30.10.m1.1.1.cmml">±</mo><annotation-xml encoding="MathML-Content" id="A6.T10.30.30.30.10.m1.1b"><csymbol cd="latexml" id="A6.T10.30.30.30.10.m1.1.1.cmml" xref="A6.T10.30.30.30.10.m1.1.1">plus-or-minus</csymbol></annotation-xml><annotation encoding="application/x-tex" id="A6.T10.30.30.30.10.m1.1c">\pm</annotation><annotation encoding="application/x-llamapun" id="A6.T10.30.30.30.10.m1.1d">±</annotation></semantics></math>0.3</td>
</tr>
</table>
</span></div>
</figure>
</section>
<section class="ltx_appendix" id="A7">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix G </span>Broader Impact</h2>
<div class="ltx_para" id="A7.p1">
<p class="ltx_p" id="A7.p1.1">The development of our ReFIR offers significant positive societal impacts, including advancements in medical imaging, historical preservation, and media restoration by enhancing the fidelity and realism of image restoration. However, it also poses potential negative societal impacts, such as the misuse of improved restoration capabilities for generating disinformation, deepfakes, and surveillance, raising ethical concerns about privacy, security, and fairness. To mitigate these risks, implementing safeguards like gated releases of models, monitoring mechanisms, and transparency in model training and deployment is crucial. Continuous ethical evaluation and adherence to strict guidelines are essential to prevent potential harms.</p>
</div>
</section>
<section class="ltx_appendix" id="A8">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix H </span>Additional Visual Results</h2>
<div class="ltx_para" id="A8.p1">
<p class="ltx_p" id="A8.p1.1">In this section, we provide more visual results, which are organized as follows:</p>
</div>
<div class="ltx_para ltx_noindent" id="A8.p2">
<ul class="ltx_itemize" id="A8.I1">
<li class="ltx_item" id="A8.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="A8.I1.i1.p1">
<p class="ltx_p" id="A8.I1.i1.p1.1">In <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F12" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">12</span></a>, we give more samples of the PCA visualization on the top three principal components of the self-attention layer latent.</p>
</div>
</li>
<li class="ltx_item" id="A8.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="A8.I1.i2.p1">
<p class="ltx_p" id="A8.I1.i2.p1.1">In <a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F13" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">13</span></a>, we give a visualization of the attention map from the cross-image injection, to help better understand the feasibility of cross-image attention.</p>
</div>
</li>
<li class="ltx_item" id="A8.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="A8.I1.i3.p1">
<p class="ltx_p" id="A8.I1.i3.p1.1"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F14" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">14</span></a> gives more quantitative comparison results against the state-of-the-art method on real-world degradation without ground truth.</p>
</div>
</li>
<li class="ltx_item" id="A8.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="A8.I1.i4.p1">
<p class="ltx_p" id="A8.I1.i4.p1.1"><a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#A8.F15" title="In Appendix H Additional Visual Results ‣ ReFIR: Grounding Large Restoration Models with Retrieval Augmentation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">15</span></a> gives the visualization results of the extension experiments of applying the proposed ReFIR to blind face image restoration.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_figure" id="A8.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1043" id="A8.F12.g1" src="x12.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A8.F12.2.1.1" style="font-size:90%;">Figure 12</span>: </span><span class="ltx_text" id="A8.F12.3.2" style="font-size:90%;">Additional visualization on the top three principal components of the self-attention layer latent of PCA. The latent is extracted from the first self-attention layer within blocks of the control net and unet decoder.</span></figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_figure" id="A8.F13"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1150" id="A8.F13.g1" src="x13.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A8.F13.6.3.1" style="font-size:90%;">Figure 13</span>: </span><span class="ltx_text" id="A8.F13.4.2" style="font-size:90%;">Additional visualization on the attention maps from the cross image injection. It can be seen that the query pixel in the <math alttext="\mathcal{C}_{T}" class="ltx_Math" display="inline" id="A8.F13.3.1.m1.1"><semantics id="A8.F13.3.1.m1.1b"><msub id="A8.F13.3.1.m1.1.1" xref="A8.F13.3.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A8.F13.3.1.m1.1.1.2" xref="A8.F13.3.1.m1.1.1.2.cmml">𝒞</mi><mi id="A8.F13.3.1.m1.1.1.3" xref="A8.F13.3.1.m1.1.1.3.cmml">T</mi></msub><annotation-xml encoding="MathML-Content" id="A8.F13.3.1.m1.1c"><apply id="A8.F13.3.1.m1.1.1.cmml" xref="A8.F13.3.1.m1.1.1"><csymbol cd="ambiguous" id="A8.F13.3.1.m1.1.1.1.cmml" xref="A8.F13.3.1.m1.1.1">subscript</csymbol><ci id="A8.F13.3.1.m1.1.1.2.cmml" xref="A8.F13.3.1.m1.1.1.2">𝒞</ci><ci id="A8.F13.3.1.m1.1.1.3.cmml" xref="A8.F13.3.1.m1.1.1.3">𝑇</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A8.F13.3.1.m1.1d">\mathcal{C}_{T}</annotation><annotation encoding="application/x-llamapun" id="A8.F13.3.1.m1.1e">caligraphic_C start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math> can well attend similarly region from <math alttext="\mathcal{C}_{S}" class="ltx_Math" display="inline" id="A8.F13.4.2.m2.1"><semantics id="A8.F13.4.2.m2.1b"><msub id="A8.F13.4.2.m2.1.1" xref="A8.F13.4.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A8.F13.4.2.m2.1.1.2" xref="A8.F13.4.2.m2.1.1.2.cmml">𝒞</mi><mi id="A8.F13.4.2.m2.1.1.3" xref="A8.F13.4.2.m2.1.1.3.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="A8.F13.4.2.m2.1c"><apply id="A8.F13.4.2.m2.1.1.cmml" xref="A8.F13.4.2.m2.1.1"><csymbol cd="ambiguous" id="A8.F13.4.2.m2.1.1.1.cmml" xref="A8.F13.4.2.m2.1.1">subscript</csymbol><ci id="A8.F13.4.2.m2.1.1.2.cmml" xref="A8.F13.4.2.m2.1.1.2">𝒞</ci><ci id="A8.F13.4.2.m2.1.1.3.cmml" xref="A8.F13.4.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A8.F13.4.2.m2.1d">\mathcal{C}_{S}</annotation><annotation encoding="application/x-llamapun" id="A8.F13.4.2.m2.1e">caligraphic_C start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math>.</span></figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_figure" id="A8.F14"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1241" id="A8.F14.g1" src="x14.png" width="831"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A8.F14.2.1.1" style="font-size:90%;">Figure 14</span>: </span><span class="ltx_text" id="A8.F14.3.2" style="font-size:90%;">Additional qualitative comparison with state-of-the-art methods on RealPhoto60 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2410.05601v1#bib.bib20" title=""><span class="ltx_text" style="font-size:90%;">20</span></a>]</cite>. Please zoom in for better effects.</span></figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_figure" id="A8.F15"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="730" id="A8.F15.g1" src="x15.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A8.F15.2.1.1" style="font-size:90%;">Figure 15</span>: </span><span class="ltx_text" id="A8.F15.3.2" style="font-size:90%;">Visualization results of applying the proposed ReFIR to the downstream specific domain of blind face image restoration. Please zoom in for better effects.</span></figcaption>
</figure>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Oct  8 01:23:53 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
