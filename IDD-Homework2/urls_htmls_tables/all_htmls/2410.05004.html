<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Fast State Restoration in LLM Serving with HCache</title>
<!--Generated on Mon Oct  7 13:00:22 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="LLM,  machine learning system,  state management" lang="en" name="keywords"/>
<base href="/html/2410.05004v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S1" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Background and Motivation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS1" title="In 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Transformer Architecture</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS2" title="In 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>LLM Serving</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS3" title="In 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.3 </span>Stateful LLM Applications</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS4" title="In 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.4 </span>State Restoration and Its Overhead</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span><span class="ltx_text ltx_font_smallcaps">HCache</span>: Caching the Hidden States</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.SS1" title="In 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span><span class="ltx_text ltx_font_smallcaps">HCache</span> Overview</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.SS2" title="In 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Restoration Cost Analysis</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span><span class="ltx_text ltx_font_smallcaps">HCache</span> Design</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1" title="In 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Bubble-Free Restoration Scheduler</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1.SSS1" title="In 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.1 </span>State Partition Method</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1.SSS2" title="In 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.2 </span>State Partition Algorithm</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS2" title="In 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span><span class="ltx_text ltx_font_smallcaps">HCache</span> Storage Manager</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS2.SSS1" title="In 4.2. HCache Storage Manager ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.1 </span>Storage Format</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS2.SSS2" title="In 4.2. HCache Storage Manager ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.2 </span>Two-Stage State Saving</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S5" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Implementation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Evaluation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS1" title="In 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1 </span>Overall Performance</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS1.SSS1" title="In 6.1. Overall Performance ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1.1 </span>Multi-Round Conversation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS1.SSS2" title="In 6.1. Overall Performance ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1.2 </span>Long-Context Applications</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS1.SSS3" title="In 6.1. Overall Performance ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1.3 </span>In-Depth Analysis</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS2" title="In 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2 </span>Sensitivity Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS2.SSS1" title="In 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2.1 </span>Varying GPU Devices</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS2.SSS2" title="In 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2.2 </span>Varying Storage Bandwidth</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS2.SSS3" title="In 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2.3 </span>Varying Sequence Length</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS3" title="In 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3 </span>Ablation Study</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS3.SSS1" title="In 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3.1 </span>Bubble-Free Scheduler</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS3.SSS2" title="In 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3.2 </span>State Partition Methods</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS3.SSS3" title="In 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3.3 </span>Two-stage State Saving</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS4" title="In 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.4 </span>Performace with on GPU KV Reusing</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S7" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S8" title="In Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">8 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Fast State Restoration in LLM Serving with <span class="ltx_text ltx_font_smallcaps" id="id4.id1">HCache</span>
</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Shiwei Gao
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id5.1.id1">Tsinghua University</span>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Youmin Chen
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id6.1.id1">Tsinghua University</span>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Jiwu Shu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id7.1.id1">Tsinghua University</span>
</span></span></span>
</div>
<div class="ltx_dates">(2025)</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id8.id1">The growing complexity of LLM usage today, e.g., multi-round conversation and
retrieval-augmented generation (RAG), makes contextual states (i.e., <span class="ltx_text" id="id8.id1.1">KV cache</span>) reusable across user requests.
Given the capacity constraints of GPU memory, only a limited number of contexts can be cached on GPU for reusing. Existing inference systems typically evict part of the KV cache and restore it by
recomputing it from the original tokens or offloading it to host storage for later retrieval, both of which introduce substantial computational or I/O overheads.</p>
<p class="ltx_p" id="id3.3">We propose <span class="ltx_text ltx_font_smallcaps" id="id3.3.1">HCache</span>, a novel LLM state restoration method. Its key idea is to restore LLM states from intermediate activations and thus utilize
computational and I/O resources with low overhead. We enhance <span class="ltx_text ltx_font_smallcaps" id="id3.3.2">HCache</span> with two techniques,
including i) a <em class="ltx_emph ltx_font_italic" id="id3.3.3">bubble-free restoration scheduler</em> that integrates resource-complementary methods
to optimize the balance between computation
and IO tasks; and ii) a <em class="ltx_emph ltx_font_italic" id="id3.3.4">chunk-based storage manager</em> to address the layout
mismatch issue (i.e., layer-before-token saving versus token-before-layer restoration).
Our evaluations, conducted using real-world tasks,
show that <span class="ltx_text ltx_font_smallcaps" id="id3.3.5">HCache</span> reduces the TTFT by up to 1.93<math alttext="\times" class="ltx_Math" display="inline" id="id1.1.m1.1"><semantics id="id1.1.m1.1a"><mo id="id1.1.m1.1.1" xref="id1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id1.1.m1.1b"><times id="id1.1.m1.1.1.cmml" xref="id1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id1.1.m1.1d">×</annotation></semantics></math>
compared to KV offload while consuming 1.92-2.40<math alttext="\times" class="ltx_Math" display="inline" id="id2.2.m2.1"><semantics id="id2.2.m2.1a"><mo id="id2.2.m2.1.1" xref="id2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id2.2.m2.1b"><times id="id2.2.m2.1.1.cmml" xref="id2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id2.2.m2.1d">×</annotation></semantics></math> less storage space;
compared to token recomputation, <span class="ltx_text ltx_font_smallcaps" id="id3.3.6">HCache</span> achieves up to 5.73<math alttext="\times" class="ltx_Math" display="inline" id="id3.3.m3.1"><semantics id="id3.3.m3.1a"><mo id="id3.3.m3.1.1" xref="id3.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id3.3.m3.1b"><times id="id3.3.m3.1.1.cmml" xref="id3.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id3.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id3.3.m3.1d">×</annotation></semantics></math> reduction in TTFT.</p>
</div>
<div class="ltx_keywords">LLM, machine learning system, state management
</div>
<span class="ltx_note ltx_note_frontmatter ltx_role_journalyear" id="id1"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2025</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_copyright" id="id2"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>rightsretained</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_conference" id="id3"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>Twentieth European Conference on Computer Systems; March 30–April 3, 2025; Rotterdam, Netherlands</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_booktitle" id="id4"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">booktitle: </span>Twentieth European Conference on Computer Systems (EuroSys ’25), March 30–April 3, 2025, Rotterdam, Netherlands</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_doi" id="id5"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>10.1145/3689031.3696072</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_isbn" id="id6"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>979-8-4007-1196-1/25/03</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id7"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Information systems Storage management</span></span></span>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="301" id="S1.F1.g1" src="x1.png" width="748"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>State Restoration Method Comparison. <em class="ltx_emph ltx_font_italic" id="S1.F1.4.2" style="font-size:90%;">
Recomputation: compute <span class="ltx_text" id="S1.F1.4.2.3">KV cache</span> from history tokens when reused;
<span class="ltx_text" id="S1.F1.4.2.4">KV cache</span> offload: save <span class="ltx_text" id="S1.F1.4.2.5">KV cache</span> at host storage and fetch them to GPU memory when reused;
<span class="ltx_text ltx_font_smallcaps" id="S1.F1.4.2.6">HCache</span> saves 6<math alttext="\times" class="ltx_Math" display="inline" id="S1.F1.3.1.1.m1.1"><semantics id="S1.F1.3.1.1.m1.1b"><mo id="S1.F1.3.1.1.m1.1.1" xref="S1.F1.3.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.F1.3.1.1.m1.1c"><times id="S1.F1.3.1.1.m1.1.1.cmml" xref="S1.F1.3.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.3.1.1.m1.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S1.F1.3.1.1.m1.1e">×</annotation></semantics></math> computational and 2<math alttext="\times" class="ltx_Math" display="inline" id="S1.F1.4.2.2.m2.1"><semantics id="S1.F1.4.2.2.m2.1b"><mo id="S1.F1.4.2.2.m2.1.1" xref="S1.F1.4.2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.F1.4.2.2.m2.1c"><times id="S1.F1.4.2.2.m2.1.1.cmml" xref="S1.F1.4.2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.4.2.2.m2.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S1.F1.4.2.2.m2.1e">×</annotation></semantics></math> IO resources.
</em></figcaption>
</figure>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large Language Models (LLMs) <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib41" title="">2024</a>; Touvron et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib50" title="">2023</a>; Team et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib48" title="">2024</a>; Javaheripi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib26" title="">2023</a>)</cite> have demonstrated substantial potential across a wide array of applications, such as content generation <cite class="ltx_cite ltx_citemacro_citep">(Cao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib12" title="">2023</a>; Zhao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib67" title="">2023b</a>)</cite>, code comprehension <cite class="ltx_cite ltx_citemacro_citep">(Nam et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib36" title="">2024</a>; Chen et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib14" title="">2021</a>)</cite>, and the development of intelligent agents <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib52" title="">2024</a>; Xi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib54" title="">2023</a>)</cite>.
LLMs commonly serve user queries in two phases, including a <em class="ltx_emph ltx_font_italic" id="S1.p1.1.1">prefill phase</em> to process a user’s prompt and
a <em class="ltx_emph ltx_font_italic" id="S1.p1.1.2">generation phase</em> that sequentially generates new tokens autoregressively.
During both phases, intermediate states (a.k.a., <span class="ltx_text" id="S1.p1.1.3">KV cache</span>) are generated and cached for each token to avoid their recomputation.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Many existing LLM serving systems are stateless among user requests; the <span class="ltx_text" id="S1.p2.1.1">KV cache</span> is discarded once the request is finished. Some recent techniques aim at
optimizing individual requests, such as request batching <cite class="ltx_cite ltx_citemacro_citep">(Yu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib62" title="">2022</a>)</cite>, GPU memory management <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>)</cite>,
and request scheduling <cite class="ltx_cite ltx_citemacro_citep">(Holmes et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib23" title="">2024</a>; Agrawal et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib4" title="">2024</a>; Wu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib53" title="">2023</a>)</cite>, among others. However, the increasing complexity of LLM usage today
makes user requests depend on historical contexts.
For example, in multi-round conversational chatbots, the historical dialogue, including a user’s
prompts and the LLM’s outputs, is accumulated as contextual states to enhance the LLM’s understanding
of the conversation background. In typical LLM chatbots such as Claude <cite class="ltx_cite ltx_citemacro_citep">(anthropic, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib7" title="">2024</a>)</cite>, the length of history dialogues
can reach 200K <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib39" title="">2024b</a>)</cite>. There are also long-context applications, such as Retrieval-Augmented Generation (RAG).
RAG applications search domain-specific knowledge related to user requests and use it to help LLMs generate more accurate answers and alleviate the hallucination problem <cite class="ltx_cite ltx_citemacro_citep">(Huang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib25" title="">2023</a>; Tonmoy et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib49" title="">2024</a>)</cite>.
We call these applications as <em class="ltx_emph ltx_font_italic" id="S1.p2.1.2">stateful</em> LLMs.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">Yet, stateful LLMs raise new challenges for managing the states of their historical contexts.
When serving new user requests, simply prefilling the prompt with historical contexts
(i.e., token recomputation) will significantly increase computing overhead, potentially causing response time
to multiply by tens of times. Recent work proposes directly reusing the <span class="ltx_text" id="S1.p3.1.1">KV cache</span> among user requests <cite class="ltx_cite ltx_citemacro_citep">(Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib21" title="">2024</a>; Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib68" title="">2023</a>; Ye et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib61" title="">2024</a>)</cite>.
Nevertheless, our analysis of two popular LLM traces, i.e., ShareGPT4 <cite class="ltx_cite ltx_citemacro_citep">(sha, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib2" title="">2024</a>)</cite> and L-Eval <cite class="ltx_cite ltx_citemacro_citep">(An et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib6" title="">2023</a>)</cite>,
shows that a single A100-40GB GPU can keep up to 7-20 multi-round conversations or 1-3 long contexts.
As a result, large-volume <span class="ltx_text" id="S1.p3.1.2">KV cache</span>s of historical contexts must be offloaded to host storage (i.e.,
KV offload <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>; Yu and Li, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib63" title="">2023</a>; Abhyankar et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib3" title="">2024</a>)</cite>),
which again introduces high latencies when loading <span class="ltx_text" id="S1.p3.1.3">KV cache</span>s from host storage to GPU memory.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">We observe that both token recomputation and KV offload adhere to the standard LLM inference process, maintaining the LLM forward pass or <span class="ltx_text" id="S1.p4.1.1">KV cache</span> <span class="ltx_text ltx_font_italic" id="S1.p4.1.2">as is</span> to manage and restore historical contextual states. Consequently, these approaches occupy the
extreme ends of the design spectrum, solely utilizing GPU computational or I/O
capabilities, thus leaving system resources underutilized.
In this paper, we introduce <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.3">HCache</span>, a novel LLM state restoration method
to break this conventional wisdom by using GPU computational and IO resources simultaneously in a low overhead manner compared with existing methods (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">1</span></a>).</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.2">At the core of <span class="ltx_text ltx_font_smallcaps" id="S1.p5.2.1">HCache</span> is to exploit LLM’s <span class="ltx_text ltx_font_italic" id="S1.p5.2.2">intrinsic</span> structure characteristic –
regaining the <span class="ltx_text" id="S1.p5.2.3">KV cache</span> by computing it from rather smaller intermediate activations – for fast state restoration.
Fortunately, the <span class="ltx_text" id="S1.p5.2.4">hidden states</span> between adjacent LLM layers have such good properties and can be used
as an alternative to the <span class="ltx_text" id="S1.p5.2.5">KV cache</span>.
Specifically, the <span class="ltx_text" id="S1.p5.2.6">hidden states</span> are half the size of the <span class="ltx_text" id="S1.p5.2.7">KV cache</span>, thus reducing the IO transmission time
by 2<math alttext="\times" class="ltx_Math" display="inline" id="S1.p5.1.m1.1"><semantics id="S1.p5.1.m1.1a"><mo id="S1.p5.1.m1.1.1" xref="S1.p5.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p5.1.m1.1b"><times id="S1.p5.1.m1.1.1.cmml" xref="S1.p5.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p5.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p5.1.m1.1d">×</annotation></semantics></math> compared to KV offload. Furthermore, recomputing <span class="ltx_text" id="S1.p5.2.8">KV cache</span> from <span class="ltx_text" id="S1.p5.2.9">hidden states</span>
instead of original tokens eliminates two computationally intensive modules in LLM, including
the quadratic complexity attention mechanism and the feed-forward network (FFN);
hence, <span class="ltx_text ltx_font_smallcaps" id="S1.p5.2.10">HCache</span> reduces the computation cost by at least 6<math alttext="\times" class="ltx_Math" display="inline" id="S1.p5.2.m2.1"><semantics id="S1.p5.2.m2.1a"><mo id="S1.p5.2.m2.1.1" xref="S1.p5.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p5.2.m2.1b"><times id="S1.p5.2.m2.1.1.cmml" xref="S1.p5.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p5.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p5.2.m2.1d">×</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">Restoring the contextual states with <span class="ltx_text ltx_font_smallcaps" id="S1.p6.1.1">HCache</span>
involves two parts – transmitting the <span class="ltx_text" id="S1.p6.1.2">hidden states</span> to GPU memory and recomputing it into <span class="ltx_text" id="S1.p6.1.3">KV cache</span> via common GEMM operations. By applying pipeline techniques, the above two steps can be performed concurrently to utilize both the IO and computational resources, further reducing state restoration time.
As a whole, <span class="ltx_text ltx_font_smallcaps" id="S1.p6.1.4">HCache</span> significantly reduces the computation and IO overhead and is faster
than existing approaches on mainstream platforms.
However, fully leveraging the capabilities of <span class="ltx_text ltx_font_smallcaps" id="S1.p6.1.5">HCache</span> presents two technical challenges and
we design techniques tailored to each issue.</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.1">First, state restoration with <span class="ltx_text ltx_font_smallcaps" id="S1.p7.1.1">HCache</span> involves both recomputation and IO transmission, whose completion times are
not always the same under varying hardware setups, producing pipeline bubbles. The actual restoration
speed is bounded by the slower one of the two steps. To address this problem, we introduce the
bubble-free restoration scheduler, which incorporates a resource-complementary restoration method to
eliminate pipeline bubbles. Second, <span class="ltx_text" id="S1.p7.1.2">hidden states</span> are generated and saved autoregressively in a <em class="ltx_emph ltx_font_italic" id="S1.p7.1.3">layer-before-token</em> order,
but are fetched as a whole batch in a <em class="ltx_emph ltx_font_italic" id="S1.p7.1.4">token-before-layer</em> order in restoration.
This incurs mismatched storage visiting orders in saving and restoration,
presenting a hard design trade-off in the storage format to manage <span class="ltx_text" id="S1.p7.1.5">hidden states</span> effectively.
A storage format optimized for one stage inevitably results in small and random IOs for the other stage.
In <span class="ltx_text ltx_font_smallcaps" id="S1.p7.1.6">HCache</span>, we introduce a chunk-based storage format tailored for fast state restoration since
reducing state restoration time is our primary design goal.</p>
</div>
<div class="ltx_para" id="S1.p8">
<p class="ltx_p" id="S1.p8.1">To mitigate the performance impact on the generation phase,
we use a two-stage saving strategy to store newly generated <span class="ltx_text" id="S1.p8.1.1">hidden states</span>.</p>
</div>
<div class="ltx_para" id="S1.p9">
<p class="ltx_p" id="S1.p9.3">We implement <span class="ltx_text ltx_font_smallcaps" id="S1.p9.3.1">HCache</span> by integrating it into an LLM serving system and evaluating it
with varying models and real-world LLM traces.
Evaluation results show that <span class="ltx_text ltx_font_smallcaps" id="S1.p9.3.2">HCache</span> reduces the TTFT (Time To First Token) by up to 1.93<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.1.m1.1"><semantics id="S1.p9.1.m1.1a"><mo id="S1.p9.1.m1.1.1" xref="S1.p9.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.1.m1.1b"><times id="S1.p9.1.m1.1.1.cmml" xref="S1.p9.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.1.m1.1d">×</annotation></semantics></math> against
KV offload, adding less than 4% overhead on TBT (Time Between Token). Compared to token recomputation,
<span class="ltx_text ltx_font_smallcaps" id="S1.p9.3.3">HCache</span> reduces TTFT by up to 5.73<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.2.m2.1"><semantics id="S1.p9.2.m2.1a"><mo id="S1.p9.2.m2.1.1" xref="S1.p9.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.2.m2.1b"><times id="S1.p9.2.m2.1.1.cmml" xref="S1.p9.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.2.m2.1d">×</annotation></semantics></math>. We also evaluated <span class="ltx_text ltx_font_smallcaps" id="S1.p9.3.4">HCache</span>
on platforms with various computing and transmission speeds.
With different hardware configurations, <span class="ltx_text ltx_font_smallcaps" id="S1.p9.3.5">HCache</span> improves the restoration speed by 1.33-2.66<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.3.m3.1"><semantics id="S1.p9.3.m3.1a"><mo id="S1.p9.3.m3.1.1" xref="S1.p9.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.3.m3.1b"><times id="S1.p9.3.m3.1.1.cmml" xref="S1.p9.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.3.m3.1d">×</annotation></semantics></math>
against KV offload.</p>
</div>
<div class="ltx_para" id="S1.p10">
<p class="ltx_p" id="S1.p10.1">In summary, we make the following contributions:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S1.I1.i1.1.1.m1.1"><semantics id="S1.I1.i1.1.1.m1.1b"><mo id="S1.I1.i1.1.1.m1.1.1" mathsize="70%" xref="S1.I1.i1.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i1.1.1.m1.1c"><ci id="S1.I1.i1.1.1.m1.1.1.cmml" xref="S1.I1.i1.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i1.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i1.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We propose <span class="ltx_text ltx_font_smallcaps" id="S1.I1.i1.p1.1.1">HCache</span>, a novel method to restore historical LLM states utilizing intermediate activations.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S1.I1.i2.1.1.m1.1"><semantics id="S1.I1.i2.1.1.m1.1b"><mo id="S1.I1.i2.1.1.m1.1.1" mathsize="70%" xref="S1.I1.i2.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i2.1.1.m1.1c"><ci id="S1.I1.i2.1.1.m1.1.1.cmml" xref="S1.I1.i2.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i2.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i2.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">We introduce the bubble-free restoration scheduler and chunk-based storage management to enhance <span class="ltx_text ltx_font_smallcaps" id="S1.I1.i2.p1.1.1">HCache</span>.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S1.I1.i3.1.1.m1.1"><semantics id="S1.I1.i3.1.1.m1.1b"><mo id="S1.I1.i3.1.1.m1.1.1" mathsize="70%" xref="S1.I1.i3.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i3.1.1.m1.1c"><ci id="S1.I1.i3.1.1.m1.1.1.cmml" xref="S1.I1.i3.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i3.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i3.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">We evaluate <span class="ltx_text ltx_font_smallcaps" id="S1.I1.i3.p1.1.1">HCache</span> on various hardware setups and show that it outperforms the state-of-the-art solutions such as AttentionStore <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite> and DeepSpeed-MII <cite class="ltx_cite ltx_citemacro_citep">(DeepSpeed, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib16" title="">2024</a>)</cite>.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Background and Motivation</h2>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1. </span>Transformer Architecture</h3>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="531" id="S2.F2.g1" src="x2.png" width="832"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2. </span>Transformer Architecture. </figcaption>
</figure>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">In this section, we first provide the background on the transformer architecture
(§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS1" title="2.1. Transformer Architecture ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2.1</span></a>) and LLM serving systems (§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS2" title="2.2. LLM Serving ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2.2</span></a>).
Then, we show the examples, characteristics, and overhead of stateful LLM
applications in §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS3" title="2.3. Stateful LLM Applications ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2.3</span></a> and §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS4" title="2.4. State Restoration and Its Overhead ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2.4</span></a>.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.1">Most LLMs today adopt the transformer architecture as their building block. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.F2" title="Figure 2 ‣ 2.1. Transformer Architecture ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2</span></a>,
LLM has N repetitive transformer layers,
each comprising two major components: the attention module and the FFN (feed-forward network).</p>
</div>
<div class="ltx_para" id="S2.SS1.p3">
<p class="ltx_p" id="S2.SS1.p3.3">An LLM forward pass is conducted with a batch of tokens. At the start of each layer,
each token has a high-dimension representation, we call it the <em class="ltx_emph ltx_font_italic" id="S2.SS1.p3.3.1">hidden states</em>.
The first layer’s <span class="ltx_text" id="S2.SS1.p3.3.2">hidden states</span> come from the embedding table. The <span class="ltx_text" id="S2.SS1.p3.3.3">hidden states</span> in other layers are the output of the previous transformer layer.
The attention module projects each token’s hidden states to three different tensors: K, Q, and V.
The model then uses the muti-head-attention (MHA) <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib51" title="">2017</a>)</cite> to interact information between tokens.
Every token first computes its attention score by getting the softmaxed inner product of their <math alttext="Q" class="ltx_Math" display="inline" id="S2.SS1.p3.1.m1.1"><semantics id="S2.SS1.p3.1.m1.1a"><mi id="S2.SS1.p3.1.m1.1.1" xref="S2.SS1.p3.1.m1.1.1.cmml">Q</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.1.m1.1b"><ci id="S2.SS1.p3.1.m1.1.1.cmml" xref="S2.SS1.p3.1.m1.1.1">𝑄</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.1.m1.1c">Q</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.1.m1.1d">italic_Q</annotation></semantics></math> with the <math alttext="K" class="ltx_Math" display="inline" id="S2.SS1.p3.2.m2.1"><semantics id="S2.SS1.p3.2.m2.1a"><mi id="S2.SS1.p3.2.m2.1.1" xref="S2.SS1.p3.2.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.2.m2.1b"><ci id="S2.SS1.p3.2.m2.1.1.cmml" xref="S2.SS1.p3.2.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.2.m2.1c">K</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.2.m2.1d">italic_K</annotation></semantics></math>
of other tokens. Next, the token computes the weighted average of <math alttext="V" class="ltx_Math" display="inline" id="S2.SS1.p3.3.m3.1"><semantics id="S2.SS1.p3.3.m3.1a"><mi id="S2.SS1.p3.3.m3.1.1" xref="S2.SS1.p3.3.m3.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.3.m3.1b"><ci id="S2.SS1.p3.3.m3.1.1.cmml" xref="S2.SS1.p3.3.m3.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.3.m3.1c">V</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.3.m3.1d">italic_V</annotation></semantics></math> of other tokens using their corresponding attention score. The weighted average is then multiplied by the out projection to get the final attention result.
The attention module in one layer can be summarized by the following equations:</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S2.Ex1">
<tbody id="S2.Ex1X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle Q_{L}^{i},K_{L}^{i},V_{L}^{i}" class="ltx_Math" display="inline" id="S2.Ex1X.2.1.1.m1.3"><semantics id="S2.Ex1X.2.1.1.m1.3a"><mrow id="S2.Ex1X.2.1.1.m1.3.3.3" xref="S2.Ex1X.2.1.1.m1.3.3.4.cmml"><msubsup id="S2.Ex1X.2.1.1.m1.1.1.1.1" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.cmml"><mi id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.2" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.2.2.cmml">Q</mi><mi id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.3" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.2.3.cmml">L</mi><mi id="S2.Ex1X.2.1.1.m1.1.1.1.1.3" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.3.cmml">i</mi></msubsup><mo id="S2.Ex1X.2.1.1.m1.3.3.3.4" xref="S2.Ex1X.2.1.1.m1.3.3.4.cmml">,</mo><msubsup id="S2.Ex1X.2.1.1.m1.2.2.2.2" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.cmml"><mi id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.2" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.2.2.cmml">K</mi><mi id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.3" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.2.3.cmml">L</mi><mi id="S2.Ex1X.2.1.1.m1.2.2.2.2.3" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.3.cmml">i</mi></msubsup><mo id="S2.Ex1X.2.1.1.m1.3.3.3.5" xref="S2.Ex1X.2.1.1.m1.3.3.4.cmml">,</mo><msubsup id="S2.Ex1X.2.1.1.m1.3.3.3.3" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.cmml"><mi id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.2" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.2.2.cmml">V</mi><mi id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.3" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.2.3.cmml">L</mi><mi id="S2.Ex1X.2.1.1.m1.3.3.3.3.3" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.3.cmml">i</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1X.2.1.1.m1.3b"><list id="S2.Ex1X.2.1.1.m1.3.3.4.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3"><apply id="S2.Ex1X.2.1.1.m1.1.1.1.1.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.1.1.1.1.1.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1">superscript</csymbol><apply id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.1.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1">subscript</csymbol><ci id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.2.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.2.2">𝑄</ci><ci id="S2.Ex1X.2.1.1.m1.1.1.1.1.2.3.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.2.3">𝐿</ci></apply><ci id="S2.Ex1X.2.1.1.m1.1.1.1.1.3.cmml" xref="S2.Ex1X.2.1.1.m1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.Ex1X.2.1.1.m1.2.2.2.2.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.2.2.2.2.1.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2">superscript</csymbol><apply id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.1.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2">subscript</csymbol><ci id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.2.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.2.2">𝐾</ci><ci id="S2.Ex1X.2.1.1.m1.2.2.2.2.2.3.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.2.3">𝐿</ci></apply><ci id="S2.Ex1X.2.1.1.m1.2.2.2.2.3.cmml" xref="S2.Ex1X.2.1.1.m1.2.2.2.2.3">𝑖</ci></apply><apply id="S2.Ex1X.2.1.1.m1.3.3.3.3.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.3.3.3.3.1.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3">superscript</csymbol><apply id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3"><csymbol cd="ambiguous" id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.1.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3">subscript</csymbol><ci id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.2.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.2.2">𝑉</ci><ci id="S2.Ex1X.2.1.1.m1.3.3.3.3.2.3.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.2.3">𝐿</ci></apply><ci id="S2.Ex1X.2.1.1.m1.3.3.3.3.3.cmml" xref="S2.Ex1X.2.1.1.m1.3.3.3.3.3">𝑖</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1X.2.1.1.m1.3c">\displaystyle Q_{L}^{i},K_{L}^{i},V_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1X.2.1.1.m1.3d">italic_Q start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT , italic_K start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT , italic_V start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W_{L}^{q,k,v}*H_{L}^{i}" class="ltx_Math" display="inline" id="S2.Ex1X.3.2.2.m1.3"><semantics id="S2.Ex1X.3.2.2.m1.3a"><mrow id="S2.Ex1X.3.2.2.m1.3.4" xref="S2.Ex1X.3.2.2.m1.3.4.cmml"><mi id="S2.Ex1X.3.2.2.m1.3.4.2" xref="S2.Ex1X.3.2.2.m1.3.4.2.cmml"></mi><mo id="S2.Ex1X.3.2.2.m1.3.4.1" xref="S2.Ex1X.3.2.2.m1.3.4.1.cmml">=</mo><mrow id="S2.Ex1X.3.2.2.m1.3.4.3" xref="S2.Ex1X.3.2.2.m1.3.4.3.cmml"><msubsup id="S2.Ex1X.3.2.2.m1.3.4.3.2" xref="S2.Ex1X.3.2.2.m1.3.4.3.2.cmml"><mi id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.2" xref="S2.Ex1X.3.2.2.m1.3.4.3.2.2.2.cmml">W</mi><mi id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.3" xref="S2.Ex1X.3.2.2.m1.3.4.3.2.2.3.cmml">L</mi><mrow id="S2.Ex1X.3.2.2.m1.3.3.3.5" xref="S2.Ex1X.3.2.2.m1.3.3.3.4.cmml"><mi id="S2.Ex1X.3.2.2.m1.1.1.1.1" xref="S2.Ex1X.3.2.2.m1.1.1.1.1.cmml">q</mi><mo id="S2.Ex1X.3.2.2.m1.3.3.3.5.1" xref="S2.Ex1X.3.2.2.m1.3.3.3.4.cmml">,</mo><mi id="S2.Ex1X.3.2.2.m1.2.2.2.2" xref="S2.Ex1X.3.2.2.m1.2.2.2.2.cmml">k</mi><mo id="S2.Ex1X.3.2.2.m1.3.3.3.5.2" xref="S2.Ex1X.3.2.2.m1.3.3.3.4.cmml">,</mo><mi id="S2.Ex1X.3.2.2.m1.3.3.3.3" xref="S2.Ex1X.3.2.2.m1.3.3.3.3.cmml">v</mi></mrow></msubsup><mo id="S2.Ex1X.3.2.2.m1.3.4.3.1" lspace="0.222em" rspace="0.222em" xref="S2.Ex1X.3.2.2.m1.3.4.3.1.cmml">∗</mo><msubsup id="S2.Ex1X.3.2.2.m1.3.4.3.3" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.cmml"><mi id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.2" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.2.2.cmml">H</mi><mi id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.3" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.2.3.cmml">L</mi><mi id="S2.Ex1X.3.2.2.m1.3.4.3.3.3" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.3.cmml">i</mi></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1X.3.2.2.m1.3b"><apply id="S2.Ex1X.3.2.2.m1.3.4.cmml" xref="S2.Ex1X.3.2.2.m1.3.4"><eq id="S2.Ex1X.3.2.2.m1.3.4.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.1"></eq><csymbol cd="latexml" id="S2.Ex1X.3.2.2.m1.3.4.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.2">absent</csymbol><apply id="S2.Ex1X.3.2.2.m1.3.4.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3"><times id="S2.Ex1X.3.2.2.m1.3.4.3.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.1"></times><apply id="S2.Ex1X.3.2.2.m1.3.4.3.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2"><csymbol cd="ambiguous" id="S2.Ex1X.3.2.2.m1.3.4.3.2.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2">superscript</csymbol><apply id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2"><csymbol cd="ambiguous" id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2">subscript</csymbol><ci id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2.2.2">𝑊</ci><ci id="S2.Ex1X.3.2.2.m1.3.4.3.2.2.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.2.2.3">𝐿</ci></apply><list id="S2.Ex1X.3.2.2.m1.3.3.3.4.cmml" xref="S2.Ex1X.3.2.2.m1.3.3.3.5"><ci id="S2.Ex1X.3.2.2.m1.1.1.1.1.cmml" xref="S2.Ex1X.3.2.2.m1.1.1.1.1">𝑞</ci><ci id="S2.Ex1X.3.2.2.m1.2.2.2.2.cmml" xref="S2.Ex1X.3.2.2.m1.2.2.2.2">𝑘</ci><ci id="S2.Ex1X.3.2.2.m1.3.3.3.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.3.3.3">𝑣</ci></list></apply><apply id="S2.Ex1X.3.2.2.m1.3.4.3.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3"><csymbol cd="ambiguous" id="S2.Ex1X.3.2.2.m1.3.4.3.3.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3">superscript</csymbol><apply id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3"><csymbol cd="ambiguous" id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.1.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3">subscript</csymbol><ci id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.2.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.2.2">𝐻</ci><ci id="S2.Ex1X.3.2.2.m1.3.4.3.3.2.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.2.3">𝐿</ci></apply><ci id="S2.Ex1X.3.2.2.m1.3.4.3.3.3.cmml" xref="S2.Ex1X.3.2.2.m1.3.4.3.3.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1X.3.2.2.m1.3c">\displaystyle=W_{L}^{q,k,v}*H_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1X.3.2.2.m1.3d">= italic_W start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_q , italic_k , italic_v end_POSTSUPERSCRIPT ∗ italic_H start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S2.Ex1Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathit{Attention}_{L}^{i}(q,k,v)" class="ltx_Math" display="inline" id="S2.Ex1Xa.2.1.1.m1.3"><semantics id="S2.Ex1Xa.2.1.1.m1.3a"><mrow id="S2.Ex1Xa.2.1.1.m1.3.4" xref="S2.Ex1Xa.2.1.1.m1.3.4.cmml"><msubsup id="S2.Ex1Xa.2.1.1.m1.3.4.2" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.cmml"><mi id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.2" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.2.2.cmml">𝐴𝑡𝑡𝑒𝑛𝑡𝑖𝑜𝑛</mi><mi id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.3" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.2.3.cmml">L</mi><mi id="S2.Ex1Xa.2.1.1.m1.3.4.2.3" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.3.cmml">i</mi></msubsup><mo id="S2.Ex1Xa.2.1.1.m1.3.4.1" xref="S2.Ex1Xa.2.1.1.m1.3.4.1.cmml">⁢</mo><mrow id="S2.Ex1Xa.2.1.1.m1.3.4.3.2" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml"><mo id="S2.Ex1Xa.2.1.1.m1.3.4.3.2.1" stretchy="false" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml">(</mo><mi id="S2.Ex1Xa.2.1.1.m1.1.1" xref="S2.Ex1Xa.2.1.1.m1.1.1.cmml">q</mi><mo id="S2.Ex1Xa.2.1.1.m1.3.4.3.2.2" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml">,</mo><mi id="S2.Ex1Xa.2.1.1.m1.2.2" xref="S2.Ex1Xa.2.1.1.m1.2.2.cmml">k</mi><mo id="S2.Ex1Xa.2.1.1.m1.3.4.3.2.3" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml">,</mo><mi id="S2.Ex1Xa.2.1.1.m1.3.3" xref="S2.Ex1Xa.2.1.1.m1.3.3.cmml">v</mi><mo id="S2.Ex1Xa.2.1.1.m1.3.4.3.2.4" stretchy="false" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1Xa.2.1.1.m1.3b"><apply id="S2.Ex1Xa.2.1.1.m1.3.4.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4"><times id="S2.Ex1Xa.2.1.1.m1.3.4.1.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.1"></times><apply id="S2.Ex1Xa.2.1.1.m1.3.4.2.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.2.1.1.m1.3.4.2.1.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2">superscript</csymbol><apply id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.1.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2">subscript</csymbol><ci id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.2.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.2.2">𝐴𝑡𝑡𝑒𝑛𝑡𝑖𝑜𝑛</ci><ci id="S2.Ex1Xa.2.1.1.m1.3.4.2.2.3.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.2.3">𝐿</ci></apply><ci id="S2.Ex1Xa.2.1.1.m1.3.4.2.3.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.2.3">𝑖</ci></apply><vector id="S2.Ex1Xa.2.1.1.m1.3.4.3.1.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.4.3.2"><ci id="S2.Ex1Xa.2.1.1.m1.1.1.cmml" xref="S2.Ex1Xa.2.1.1.m1.1.1">𝑞</ci><ci id="S2.Ex1Xa.2.1.1.m1.2.2.cmml" xref="S2.Ex1Xa.2.1.1.m1.2.2">𝑘</ci><ci id="S2.Ex1Xa.2.1.1.m1.3.3.cmml" xref="S2.Ex1Xa.2.1.1.m1.3.3">𝑣</ci></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1Xa.2.1.1.m1.3c">\displaystyle\mathit{Attention}_{L}^{i}(q,k,v)</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1Xa.2.1.1.m1.3d">italic_Attention start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ( italic_q , italic_k , italic_v )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{m=1}^{i-1}\frac{e^{Q_{L}^{i}*K_{m}}}{\sum_{n=1}^{i-1}e^{Q_%
{L}^{i}*K_{n}}}*V_{i}" class="ltx_Math" display="inline" id="S2.Ex1Xa.3.2.2.m1.1"><semantics id="S2.Ex1Xa.3.2.2.m1.1a"><mrow id="S2.Ex1Xa.3.2.2.m1.1.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.2.cmml"></mi><mo id="S2.Ex1Xa.3.2.2.m1.1.1.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.1.cmml">=</mo><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.cmml"><mstyle displaystyle="true" id="S2.Ex1Xa.3.2.2.m1.1.1.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.cmml"><munderover id="S2.Ex1Xa.3.2.2.m1.1.1.3.1a" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.cmml"><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.2" movablelimits="false" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.2.cmml">∑</mo><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.2.cmml">m</mi><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.1.cmml">=</mo><mn id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.3.cmml">1</mn></mrow><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.2.cmml">i</mi><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.1.cmml">−</mo><mn id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.3.cmml">1</mn></mrow></munderover></mstyle><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.cmml"><mstyle displaystyle="true" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.cmml"><mfrac id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2a" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.cmml"><msup id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.2.cmml">e</mi><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.cmml"><msubsup id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.2.cmml">Q</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.3.cmml">L</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.3.cmml">i</mi></msubsup><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.1" lspace="0.222em" rspace="0.222em" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.1.cmml">∗</mo><msub id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.2.cmml">K</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.3.cmml">m</mi></msub></mrow></msup><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.cmml"><msubsup id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml"><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.2.cmml">∑</mo><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.2.cmml">n</mi><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.1.cmml">=</mo><mn id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.3.cmml">1</mn></mrow><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.2.cmml">i</mi><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.1" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.1.cmml">−</mo><mn id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.3.cmml">1</mn></mrow></msubsup><msup id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.2.cmml">e</mi><mrow id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.cmml"><msubsup id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.2.cmml">Q</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.3.cmml">L</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.3.cmml">i</mi></msubsup><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.1" lspace="0.222em" rspace="0.222em" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.1.cmml">∗</mo><msub id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.2.cmml">K</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.3.cmml">n</mi></msub></mrow></msup></mrow></mfrac></mstyle><mo id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.1.cmml">∗</mo><msub id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.cmml"><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.2" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.2.cmml">V</mi><mi id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.3" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1Xa.3.2.2.m1.1b"><apply id="S2.Ex1Xa.3.2.2.m1.1.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1"><eq id="S2.Ex1Xa.3.2.2.m1.1.1.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.1"></eq><csymbol cd="latexml" id="S2.Ex1Xa.3.2.2.m1.1.1.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.2">absent</csymbol><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3"><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1">superscript</csymbol><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1">subscript</csymbol><sum id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.2"></sum><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3"><eq id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.1"></eq><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.2">𝑚</ci><cn id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.3.cmml" type="integer" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.2.3.3">1</cn></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3"><minus id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.1"></minus><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.2">𝑖</ci><cn id="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.3.cmml" type="integer" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.1.3.3">1</cn></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2"><times id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.1"></times><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2"><divide id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2"></divide><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2">superscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.2">𝑒</ci><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3"><times id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.1"></times><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2">superscript</csymbol><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2">subscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.2">𝑄</ci><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.2.3">𝐿</ci></apply><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.2.3">𝑖</ci></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3">subscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.2">𝐾</ci><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.2.3.3.3">𝑚</ci></apply></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3"><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1">superscript</csymbol><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1">subscript</csymbol><sum id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.2"></sum><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3"><eq id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.1"></eq><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.2">𝑛</ci><cn id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.3.cmml" type="integer" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.2.3.3">1</cn></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3"><minus id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.1"></minus><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.2">𝑖</ci><cn id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.3.cmml" type="integer" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.1.3.3">1</cn></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2">superscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.2">𝑒</ci><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3"><times id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.1"></times><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2">superscript</csymbol><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2">subscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.2">𝑄</ci><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.2.3">𝐿</ci></apply><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.2.3">𝑖</ci></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3">subscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.2">𝐾</ci><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.2.3.2.3.3.3">𝑛</ci></apply></apply></apply></apply></apply><apply id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3"><csymbol cd="ambiguous" id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.1.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3">subscript</csymbol><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.2.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.2">𝑉</ci><ci id="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.3.cmml" xref="S2.Ex1Xa.3.2.2.m1.1.1.3.2.3.3">𝑖</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1Xa.3.2.2.m1.1c">\displaystyle=\sum_{m=1}^{i-1}\frac{e^{Q_{L}^{i}*K_{m}}}{\sum_{n=1}^{i-1}e^{Q_%
{L}^{i}*K_{n}}}*V_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1Xa.3.2.2.m1.1d">= ∑ start_POSTSUBSCRIPT italic_m = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i - 1 end_POSTSUPERSCRIPT divide start_ARG italic_e start_POSTSUPERSCRIPT italic_Q start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ∗ italic_K start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT end_POSTSUPERSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_n = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i - 1 end_POSTSUPERSCRIPT italic_e start_POSTSUPERSCRIPT italic_Q start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ∗ italic_K start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUPERSCRIPT end_ARG ∗ italic_V start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S2.Ex1Xb"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle Out_{L}^{i}" class="ltx_Math" display="inline" id="S2.Ex1Xb.2.1.1.m1.1"><semantics id="S2.Ex1Xb.2.1.1.m1.1a"><mrow id="S2.Ex1Xb.2.1.1.m1.1.1" xref="S2.Ex1Xb.2.1.1.m1.1.1.cmml"><mi id="S2.Ex1Xb.2.1.1.m1.1.1.2" xref="S2.Ex1Xb.2.1.1.m1.1.1.2.cmml">O</mi><mo id="S2.Ex1Xb.2.1.1.m1.1.1.1" xref="S2.Ex1Xb.2.1.1.m1.1.1.1.cmml">⁢</mo><mi id="S2.Ex1Xb.2.1.1.m1.1.1.3" xref="S2.Ex1Xb.2.1.1.m1.1.1.3.cmml">u</mi><mo id="S2.Ex1Xb.2.1.1.m1.1.1.1a" xref="S2.Ex1Xb.2.1.1.m1.1.1.1.cmml">⁢</mo><msubsup id="S2.Ex1Xb.2.1.1.m1.1.1.4" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.cmml"><mi id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.2" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.2.2.cmml">t</mi><mi id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.3" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.2.3.cmml">L</mi><mi id="S2.Ex1Xb.2.1.1.m1.1.1.4.3" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.3.cmml">i</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1Xb.2.1.1.m1.1b"><apply id="S2.Ex1Xb.2.1.1.m1.1.1.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1"><times id="S2.Ex1Xb.2.1.1.m1.1.1.1.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.1"></times><ci id="S2.Ex1Xb.2.1.1.m1.1.1.2.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.2">𝑂</ci><ci id="S2.Ex1Xb.2.1.1.m1.1.1.3.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.3">𝑢</ci><apply id="S2.Ex1Xb.2.1.1.m1.1.1.4.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4"><csymbol cd="ambiguous" id="S2.Ex1Xb.2.1.1.m1.1.1.4.1.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4">superscript</csymbol><apply id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4"><csymbol cd="ambiguous" id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.1.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4">subscript</csymbol><ci id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.2.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.2.2">𝑡</ci><ci id="S2.Ex1Xb.2.1.1.m1.1.1.4.2.3.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.2.3">𝐿</ci></apply><ci id="S2.Ex1Xb.2.1.1.m1.1.1.4.3.cmml" xref="S2.Ex1Xb.2.1.1.m1.1.1.4.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1Xb.2.1.1.m1.1c">\displaystyle Out_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1Xb.2.1.1.m1.1d">italic_O italic_u italic_t start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W_{L}^{o}*\mathit{Attention}_{L}^{i}(q,k,v)" class="ltx_Math" display="inline" id="S2.Ex1Xb.3.2.2.m1.3"><semantics id="S2.Ex1Xb.3.2.2.m1.3a"><mrow id="S2.Ex1Xb.3.2.2.m1.3.4" xref="S2.Ex1Xb.3.2.2.m1.3.4.cmml"><mi id="S2.Ex1Xb.3.2.2.m1.3.4.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.2.cmml"></mi><mo id="S2.Ex1Xb.3.2.2.m1.3.4.1" xref="S2.Ex1Xb.3.2.2.m1.3.4.1.cmml">=</mo><mrow id="S2.Ex1Xb.3.2.2.m1.3.4.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.cmml"><mrow id="S2.Ex1Xb.3.2.2.m1.3.4.3.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.cmml"><msubsup id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.cmml"><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.2.cmml">W</mi><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.3.cmml">L</mi><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.3.cmml">o</mi></msubsup><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.1" lspace="0.222em" rspace="0.222em" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.1.cmml">∗</mo><msubsup id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.cmml"><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.2.cmml">𝐴𝑡𝑡𝑒𝑛𝑡𝑖𝑜𝑛</mi><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.3.cmml">L</mi><mi id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.3.cmml">i</mi></msubsup></mrow><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.1" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.1.cmml">⁢</mo><mrow id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml"><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2.1" stretchy="false" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml">(</mo><mi id="S2.Ex1Xb.3.2.2.m1.1.1" xref="S2.Ex1Xb.3.2.2.m1.1.1.cmml">q</mi><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2.2" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml">,</mo><mi id="S2.Ex1Xb.3.2.2.m1.2.2" xref="S2.Ex1Xb.3.2.2.m1.2.2.cmml">k</mi><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2.3" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml">,</mo><mi id="S2.Ex1Xb.3.2.2.m1.3.3" xref="S2.Ex1Xb.3.2.2.m1.3.3.cmml">v</mi><mo id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2.4" stretchy="false" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1Xb.3.2.2.m1.3b"><apply id="S2.Ex1Xb.3.2.2.m1.3.4.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4"><eq id="S2.Ex1Xb.3.2.2.m1.3.4.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.1"></eq><csymbol cd="latexml" id="S2.Ex1Xb.3.2.2.m1.3.4.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.2">absent</csymbol><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3"><times id="S2.Ex1Xb.3.2.2.m1.3.4.3.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.1"></times><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2"><times id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.1"></times><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2"><csymbol cd="ambiguous" id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2">superscript</csymbol><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2"><csymbol cd="ambiguous" id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2">subscript</csymbol><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.2">𝑊</ci><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.2.3">𝐿</ci></apply><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.2.3">𝑜</ci></apply><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3"><csymbol cd="ambiguous" id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3">superscript</csymbol><apply id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3"><csymbol cd="ambiguous" id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3">subscript</csymbol><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.2">𝐴𝑡𝑡𝑒𝑛𝑡𝑖𝑜𝑛</ci><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.2.3">𝐿</ci></apply><ci id="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.2.3.3">𝑖</ci></apply></apply><vector id="S2.Ex1Xb.3.2.2.m1.3.4.3.3.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.4.3.3.2"><ci id="S2.Ex1Xb.3.2.2.m1.1.1.cmml" xref="S2.Ex1Xb.3.2.2.m1.1.1">𝑞</ci><ci id="S2.Ex1Xb.3.2.2.m1.2.2.cmml" xref="S2.Ex1Xb.3.2.2.m1.2.2">𝑘</ci><ci id="S2.Ex1Xb.3.2.2.m1.3.3.cmml" xref="S2.Ex1Xb.3.2.2.m1.3.3">𝑣</ci></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1Xb.3.2.2.m1.3c">\displaystyle=W_{L}^{o}*\mathit{Attention}_{L}^{i}(q,k,v)</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1Xb.3.2.2.m1.3d">= italic_W start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_o end_POSTSUPERSCRIPT ∗ italic_Attention start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ( italic_q , italic_k , italic_v )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S2.SS1.p4">
<p class="ltx_p" id="S2.SS1.p4.1">FFN module consists of two linear projections with an activation function in between.
The output of the FFN module (i.e., <span class="ltx_text" id="S2.SS1.p4.1.1">hidden states</span>) is the input of the next transformer layer.</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S2.Ex2">
<tbody id="S2.Ex2X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle H_{L+1}^{i}=\mathit{FC2}~{}(\mathit{FC1}~{}(Out_{L}^{i}))" class="ltx_Math" display="inline" id="S2.Ex2X.2.1.1.m1.1"><semantics id="S2.Ex2X.2.1.1.m1.1a"><mrow id="S2.Ex2X.2.1.1.m1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.cmml"><msubsup id="S2.Ex2X.2.1.1.m1.1.1.3" xref="S2.Ex2X.2.1.1.m1.1.1.3.cmml"><mi id="S2.Ex2X.2.1.1.m1.1.1.3.2.2" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.2.cmml">H</mi><mrow id="S2.Ex2X.2.1.1.m1.1.1.3.2.3" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.cmml"><mi id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.2" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.2.cmml">L</mi><mo id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.1" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.1.cmml">+</mo><mn id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.3" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.3.cmml">1</mn></mrow><mi id="S2.Ex2X.2.1.1.m1.1.1.3.3" xref="S2.Ex2X.2.1.1.m1.1.1.3.3.cmml">i</mi></msubsup><mo id="S2.Ex2X.2.1.1.m1.1.1.2" xref="S2.Ex2X.2.1.1.m1.1.1.2.cmml">=</mo><mrow id="S2.Ex2X.2.1.1.m1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.cmml"><mi class="ltx_mathvariant_italic" id="S2.Ex2X.2.1.1.m1.1.1.1.3" mathvariant="italic" xref="S2.Ex2X.2.1.1.m1.1.1.1.3.cmml">FC2</mi><mo id="S2.Ex2X.2.1.1.m1.1.1.1.2" lspace="0.330em" xref="S2.Ex2X.2.1.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="S2.Ex2X.2.1.1.m1.1.1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.cmml"><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.2" stretchy="false" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.cmml"><mi class="ltx_mathvariant_italic" id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.3" mathvariant="italic" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.3.cmml">FC1</mi><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.2" lspace="0.330em" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.2" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.2.cmml">O</mi><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.3" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.3.cmml">u</mi><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1a" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><msubsup id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.cmml"><mi id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.2" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.2.cmml">t</mi><mi id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.3" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.3.cmml">L</mi><mi id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.3" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.3.cmml">i</mi></msubsup></mrow><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.3" stretchy="false" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex2X.2.1.1.m1.1b"><apply id="S2.Ex2X.2.1.1.m1.1.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1"><eq id="S2.Ex2X.2.1.1.m1.1.1.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.2"></eq><apply id="S2.Ex2X.2.1.1.m1.1.1.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2X.2.1.1.m1.1.1.3.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3">superscript</csymbol><apply id="S2.Ex2X.2.1.1.m1.1.1.3.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2X.2.1.1.m1.1.1.3.2.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3">subscript</csymbol><ci id="S2.Ex2X.2.1.1.m1.1.1.3.2.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.2">𝐻</ci><apply id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3"><plus id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.1"></plus><ci id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.2">𝐿</ci><cn id="S2.Ex2X.2.1.1.m1.1.1.3.2.3.3.cmml" type="integer" xref="S2.Ex2X.2.1.1.m1.1.1.3.2.3.3">1</cn></apply></apply><ci id="S2.Ex2X.2.1.1.m1.1.1.3.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.3.3">𝑖</ci></apply><apply id="S2.Ex2X.2.1.1.m1.1.1.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1"><times id="S2.Ex2X.2.1.1.m1.1.1.1.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.2"></times><ci id="S2.Ex2X.2.1.1.m1.1.1.1.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.3">italic-FC2</ci><apply id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1"><times id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.2"></times><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.3">italic-FC1</ci><apply id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1"><times id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.1"></times><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.2">𝑂</ci><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.3">𝑢</ci><apply id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4">superscript</csymbol><apply id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.1.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4">subscript</csymbol><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.2.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.2">𝑡</ci><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.2.3">𝐿</ci></apply><ci id="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.3.cmml" xref="S2.Ex2X.2.1.1.m1.1.1.1.1.1.1.1.1.1.4.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex2X.2.1.1.m1.1c">\displaystyle H_{L+1}^{i}=\mathit{FC2}~{}(\mathit{FC1}~{}(Out_{L}^{i}))</annotation><annotation encoding="application/x-llamapun" id="S2.Ex2X.2.1.1.m1.1d">italic_H start_POSTSUBSCRIPT italic_L + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT = italic_FC2 ( italic_FC1 ( italic_O italic_u italic_t start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S2.SS1.p5">
<p class="ltx_p" id="S2.SS1.p5.1">The above equations ignore less compute-intensive modules, including residual connection,
layer norm, input embedding, and position embeddings.
The internal architectures vary between different LLMs. We only discuss the common
transformer structure in LLMs without loss of generality.</p>
</div>
<div class="ltx_para" id="S2.SS1.p6">
<p class="ltx_p" id="S2.SS1.p6.1"><span class="ltx_text" id="S2.SS1.p6.1.1">KV cache</span> is an important design to speed up existing LLM inference engines.
In the attention module, the attention computation of a token depends on all previous
KV values in the sequence. To avoid redundant KV recomputation, once a token’s
key and value are generated, they are stored in a dedicated storage area on GPU, i.e., the <span class="ltx_text" id="S2.SS1.p6.1.2">KV cache</span>. The generation for
the latter tokens of the sequence can visit <span class="ltx_text" id="S2.SS1.p6.1.3">KV cache</span> instead of recomputing KV values of history tokens.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2. </span>LLM Serving</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Once trained, LLMs can be deployed as a service to respond to user requests.
LLM inference systems process a user request in two phases –
<em class="ltx_emph ltx_font_italic" id="S2.SS2.p1.1.1">prompt prefilling</em> and <em class="ltx_emph ltx_font_italic" id="S2.SS2.p1.1.2">response generation</em>.
During the prompt prefilling phase, LLM performs a transformer forward pass with input prompt tokens,
generating the <span class="ltx_text" id="S2.SS2.p1.1.3">KV cache</span> for them. In the response generation phase, LLM generates new
tokens autoregressively and puts the key-value tensors of the newly generated token
into the <span class="ltx_text" id="S2.SS2.p1.1.4">KV cache</span>. One sequence’s generation process continues until reaching an end-of-sequence (EOS)
token or a maximum token budget.</p>
</div>
<div class="ltx_para" id="S2.SS2.p2">
<p class="ltx_p" id="S2.SS2.p2.1">Inference systems typically process user requests in batch to improve LLM serving efficiency.
Instead of a stop-wait batching mechanism, which may incur high latency for early-arrived requests,
most current LLMs use continuous batching <cite class="ltx_cite ltx_citemacro_citep">(Yu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib62" title="">2022</a>)</cite>. Specifically,
the inference engine batches multiple requests in the generation phase at a fine-grained iteration level,
where new requests can be added (exited) to (from) a batch dynamically at each iteration.
TTFT (Time To First Token) and TBT (Time Between Token) are important metrics describing the LLM serving quality. TTFT is the time it takes to generate the first token;
TBT represents the average time to generate a token for each request except for the first token.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3. </span>Stateful LLM Applications</h3>
<div class="ltx_para" id="S2.SS3.p1">
<p class="ltx_p" id="S2.SS3.p1.1">The basic usage of LLM assumes that LLM inference is <em class="ltx_emph ltx_font_italic" id="S2.SS3.p1.1.1">stateless</em> – user requests are independent and
irrelevant to previous ones, and the <span class="ltx_text" id="S2.SS3.p1.1.2">KV cache</span> is discarded when the generation is finished. However, the increasing complexity of LLM usage today provides user requests with
rich contextual contents, such as chat history and auxiliary documents, to help LLMs provide context-dependent,
accurate, and informative responses. Hence, a request may rely on the context previously assimilated by the engine, making LLM inference a <em class="ltx_emph ltx_font_italic" id="S2.SS3.p1.1.3">stateful</em> task. Below, we characterize different stateful LLM tasks.</p>
</div>
<figure class="ltx_figure" id="S2.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="308" id="S2.F3.g1" src="x3.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3. </span>Charactreistic of Multi-Round Conversation.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S2.SS3.p2">
<p class="ltx_p" id="S2.SS3.p2.1"><span class="ltx_text ltx_font_bold" id="S2.SS3.p2.1.1">Multi-round conversations.</span>
Taking ChatGPT <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib41" title="">2024</a>)</cite> as an example, a user starts a conversation by creating
a “New Chat” session. In this session, the user keys in an instruction and waits for the response from ChatGPT;
based on the response, the user can further send new questions to start a next-round conversation.
To produce better answers in a multi-round conversation, the LLM generates a new response by considering both the
tokens from all previous conversation rounds and the tokens from the current input.</p>
</div>
<div class="ltx_para" id="S2.SS3.p3">
<p class="ltx_p" id="S2.SS3.p3.1">A representative dataset of multi-round conversation is ShareGPT4 <cite class="ltx_cite ltx_citemacro_citep">(sha, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib2" title="">2024</a>)</cite>, a trace of human conversations with GPT-4.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.F3" title="Figure 3 ‣ 2.3. Stateful LLM Applications ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">3</span></a>a shows the average length of new prompt tokens and
output tokens in one round. The average input length of each round is 66.8 tokens, and the output is 358.8 tokens.
Though one round’s input and output length is relatively short, they gradually accumulate in the conversation’s history as
the dialogue progresses. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.F3" title="Figure 3 ‣ 2.3. Stateful LLM Applications ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">3</span></a>b depicts the CDF of the length of history tokens (truncated at 16K), and we can see that
the length of half of the conversations is over 2.5K.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p4">
<p class="ltx_p" id="S2.SS3.p4.1"><span class="ltx_text ltx_font_bold" id="S2.SS3.p4.1.1">Long-context applications.</span>
Many LLM applications (e.g., LangChain <cite class="ltx_cite ltx_citemacro_citep">(Chase, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib13" title="">2022</a>)</cite>) also supplement
user prompts with additional contexts to help LLM react better.</p>
</div>
<div class="ltx_para" id="S2.SS3.p5">
<ul class="ltx_itemize" id="S2.I1">
<li class="ltx_item" id="S2.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S2.I1.i1.1.1.m1.1"><semantics id="S2.I1.i1.1.1.m1.1b"><mo id="S2.I1.i1.1.1.m1.1.1" mathsize="70%" xref="S2.I1.i1.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S2.I1.i1.1.1.m1.1c"><ci id="S2.I1.i1.1.1.m1.1.1.cmml" xref="S2.I1.i1.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.I1.i1.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S2.I1.i1.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S2.I1.i1.p1">
<p class="ltx_p" id="S2.I1.i1.p1.1">In contextual question and answer (Q&amp;A) applications,
LLMs receive a long context text, such as an academic paper, law document, or textbook, and answer related user questions.
For example, a user can upload a PDF of a language programming guide; after processing it,
the LLM can answer the demo usage of different APIs.</p>
</div>
</li>
<li class="ltx_item" id="S2.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S2.I1.i2.1.1.m1.1"><semantics id="S2.I1.i2.1.1.m1.1b"><mo id="S2.I1.i2.1.1.m1.1.1" mathsize="70%" xref="S2.I1.i2.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S2.I1.i2.1.1.m1.1c"><ci id="S2.I1.i2.1.1.m1.1.1.cmml" xref="S2.I1.i2.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.I1.i2.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S2.I1.i2.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S2.I1.i2.p1">
<p class="ltx_p" id="S2.I1.i2.p1.1">Retrieval-Augmented Generation (RAG) application is also a popular workflow of LLMs <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib30" title="">2020</a>; Liu, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib32" title="">2022</a>; Borgeaud et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib11" title="">2021</a>)</cite>.
In response to user requests, RAG applications first search question-related content in their
inner databases or on the Internet. Then, the retried documents and the user question
are supplemented to the LLM. LLM uses the retrieved auxiliary knowledge to generate more accurate results for user questions.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_table" id="S2.T1">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S2.T1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S2.T1.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.1" style="padding-left:8.5pt;padding-right:8.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.1.1">Tasktype</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.2" style="padding-left:8.5pt;padding-right:8.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.2.1">Context</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.3" style="padding-left:8.5pt;padding-right:8.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.3.1">Input</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T1.1.1.1.4" style="padding-left:8.5pt;padding-right:8.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.1.1.1.4.1">Output</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S2.T1.1.2.1">
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.2.1.1" style="padding-left:8.5pt;padding-right:8.5pt;">Paper Assistant</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.2.1.2" style="padding-left:8.5pt;padding-right:8.5pt;">10603.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.2.1.3" style="padding-left:8.5pt;padding-right:8.5pt;">142.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.1.2.1.4" style="padding-left:8.5pt;padding-right:8.5pt;">404.8</td>
</tr>
<tr class="ltx_tr" id="S2.T1.1.3.2">
<td class="ltx_td ltx_align_center" id="S2.T1.1.3.2.1" style="padding-left:8.5pt;padding-right:8.5pt;">GSM-100 <cite class="ltx_cite ltx_citemacro_citep">(Cobbe et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib15" title="">2021</a>)</cite>
</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.3.2.2" style="padding-left:8.5pt;padding-right:8.5pt;">5451.7</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.3.2.3" style="padding-left:8.5pt;padding-right:8.5pt;">77.4</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.3.2.4" style="padding-left:8.5pt;padding-right:8.5pt;">4.3</td>
</tr>
<tr class="ltx_tr" id="S2.T1.1.4.3">
<td class="ltx_td ltx_align_center" id="S2.T1.1.4.3.1" style="padding-left:8.5pt;padding-right:8.5pt;">QuALITY <cite class="ltx_cite ltx_citemacro_citep">(Pang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib42" title="">2022</a>)</cite>
</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.4.3.2" style="padding-left:8.5pt;padding-right:8.5pt;">7053.9</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.4.3.3" style="padding-left:8.5pt;padding-right:8.5pt;">92.4</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.4.3.4" style="padding-left:8.5pt;padding-right:8.5pt;">19.2</td>
</tr>
<tr class="ltx_tr" id="S2.T1.1.5.4">
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.5.4.1" style="padding-left:8.5pt;padding-right:8.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.1.5.4.1.1">AVG. (20 sub-tasks)</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.5.4.2" style="padding-left:8.5pt;padding-right:8.5pt;">16340.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.5.4.3" style="padding-left:8.5pt;padding-right:8.5pt;">44.7</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.1.5.4.4" style="padding-left:8.5pt;padding-right:8.5pt;">50.2</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1. </span>Statistics of the L-Eval <cite class="ltx_cite ltx_citemacro_citep">(An et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib6" title="">2023</a>)</cite> Dataset.</figcaption>
</figure>
<div class="ltx_para" id="S2.SS3.p6">
<p class="ltx_p" id="S2.SS3.p6.1">L-Eval <cite class="ltx_cite ltx_citemacro_citep">(An et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib6" title="">2023</a>)</cite> is an open-sourced dataset tailored for long-context LLM evaluation.
It contains 20 sub-tasks, including long context Q&amp;A, few-shot examples helped reasoning, and deducing the output of a piece of code. In Table <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.T1" title="Table 1 ‣ 2.3. Stateful LLM Applications ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">1</span></a>,
we present the statistics of three representative sub-tasks in L-Eval.
These traces exhibit bimodal characteristics – the average length of context contents
can extend up to 16K. In contrast, the lengths of instructions and outputs typically remain below 100.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.4. </span>State Restoration and Its Overhead</h3>
<div class="ltx_para" id="S2.SS4.p1">
<p class="ltx_p" id="S2.SS4.p1.1">In stateful LLM inference, the <span class="ltx_text" id="S2.SS4.p1.1.1">KV cache</span> of shared tokens can be reused across different requests. Recent studies <cite class="ltx_cite ltx_citemacro_citep">(authors, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib9" title="">2024b</a>; Ye et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib61" title="">2024</a>; Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib21" title="">2024</a>)</cite> have explored caching and reusing the <span class="ltx_text" id="S2.SS4.p1.1.2">KV cache</span> between different requests on GPU to reduce the TTFT of user requests. However, the limited memory capacity of GPUs poses a significant challenge in retaining all necessary <span class="ltx_text" id="S2.SS4.p1.1.3">KV cache</span>. For instance, PagedAttention <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>)</cite>, a state-of-the-art <span class="ltx_text" id="S2.SS4.p1.1.4">KV cache</span> management technique, enables an A100-40G GPU to store up to 17K tokens with Llama2-13B and 48K tokens with Llama2-7B, which equates to only 1–3 extended contexts or 7–20 conversation sessions.</p>
</div>
<div class="ltx_para" id="S2.SS4.p2">
<p class="ltx_p" id="S2.SS4.p2.1">Due to the GPU memory limitation <cite class="ltx_cite ltx_citemacro_citep">(Xie et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib58" title="">2020</a>)</cite>, current inference systems often evict less frequently accessed <span class="ltx_text" id="S2.SS4.p2.1.1">KV cache</span> to free up space for more immediate contexts <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib68" title="">2023</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>)</cite>. When evicted <span class="ltx_text" id="S2.SS4.p2.1.2">KV cache</span> is needed again, it must be restored. We refer to this process as <em class="ltx_emph ltx_font_italic" id="S2.SS4.p2.1.3">state restoration</em> in stateful LLM serving. Prior work has demonstrated that state restoration is a prevalent issue in inference systems. In multi-turn conversations, the interval between interactions often leads to a low GPU cache hit ratio <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite>, and in long context applications, the same context may be reused hours apart <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib33" title="">2024a</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S2.SS4.p3">
<p class="ltx_p" id="S2.SS4.p3.1">Two primary approaches exist for restoring LLM state. The first method is recomputation, which involves re-executing the prefill phase to regenerate the <span class="ltx_text" id="S2.SS4.p3.1.1">KV cache</span> from the original tokens <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib40" title="">2024c</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>; DeepSpeed, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib16" title="">2024</a>; authors, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib8" title="">2024a</a>)</cite>. The second method is offloading the <span class="ltx_text" id="S2.SS4.p3.1.2">KV cache</span> to host memory or storage devices <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib33" title="">2024a</a>; Jin et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib27" title="">2024</a>; Abhyankar et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib3" title="">2024</a>)</cite>, with it being transmitted back to GPU memory when needed for subsequent requests.</p>
</div>
<div class="ltx_para" id="S2.SS4.p4">
<p class="ltx_p" id="S2.SS4.p4.2">Both state restoration methods result in substantial performance degradation compared to the ideal case where no restoration is needed. Our evaluation in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.F4" title="Figure 4 ‣ 2.4. State Restoration and Its Overhead ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4</span></a> shows that the TTFT for recomputation is 20.0-26.0<math alttext="\times" class="ltx_Math" display="inline" id="S2.SS4.p4.1.m1.1"><semantics id="S2.SS4.p4.1.m1.1a"><mo id="S2.SS4.p4.1.m1.1.1" xref="S2.SS4.p4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.SS4.p4.1.m1.1b"><times id="S2.SS4.p4.1.m1.1.1.cmml" xref="S2.SS4.p4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.SS4.p4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS4.p4.1.m1.1d">×</annotation></semantics></math> slower than the ideal case, while KV offloading is 6.5-13.0<math alttext="\times" class="ltx_Math" display="inline" id="S2.SS4.p4.2.m2.1"><semantics id="S2.SS4.p4.2.m2.1a"><mo id="S2.SS4.p4.2.m2.1.1" xref="S2.SS4.p4.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.SS4.p4.2.m2.1b"><times id="S2.SS4.p4.2.m2.1.1.cmml" xref="S2.SS4.p4.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.SS4.p4.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS4.p4.2.m2.1d">×</annotation></semantics></math> slower.</p>
</div>
<figure class="ltx_figure" id="S2.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="285" id="S2.F4.g1" src="x4.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4. </span>Comparison of State Restoration Overhead.
<em class="ltx_emph ltx_font_italic" id="S2.F4.4.2" style="font-size:90%;">
We use the L-Eval trace;
Opt-30B runs on 4<math alttext="\times" class="ltx_Math" display="inline" id="S2.F4.3.1.1.m1.1"><semantics id="S2.F4.3.1.1.m1.1b"><mo id="S2.F4.3.1.1.m1.1.1" xref="S2.F4.3.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.F4.3.1.1.m1.1c"><times id="S2.F4.3.1.1.m1.1.1.cmml" xref="S2.F4.3.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.F4.3.1.1.m1.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S2.F4.3.1.1.m1.1e">×</annotation></semantics></math> A100-40G GPUs with tensor parallelism, while the rest two run on one A100;
4<math alttext="\times" class="ltx_Math" display="inline" id="S2.F4.4.2.2.m2.1"><semantics id="S2.F4.4.2.2.m2.1b"><mo id="S2.F4.4.2.2.m2.1.1" xref="S2.F4.4.2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.F4.4.2.2.m2.1c"><times id="S2.F4.4.2.2.m2.1.1.cmml" xref="S2.F4.4.2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.F4.4.2.2.m2.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S2.F4.4.2.2.m2.1e">×</annotation></semantics></math> PM9A3 SSDs are used as the storage backend to save offloaded <span class="ltx_text" id="S2.F4.4.2.3">KV cache</span>s.
</em></figcaption>
</figure>
<div class="ltx_para" id="S2.SS4.p5">
<p class="ltx_p" id="S2.SS4.p5.1">A key point of the inefficiency of current state restoration methods relates to how they utilize the
hardware resources. At one extreme, recomputation solely relies on GPU’s computation capability to restore
the <span class="ltx_text" id="S2.SS4.p5.1.1">KV cache</span> from tokens, whose computational complexity increases quadratically <cite class="ltx_cite ltx_citemacro_citep">(Peng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib43" title="">2023</a>)</cite> with the
sequence’s length. As the contrasting approach, KV offload solely relies on
host storage and PCIe bus to load large-volume <span class="ltx_text" id="S2.SS4.p5.1.2">KV cache</span>, whose size is <math alttext="10^{5}" class="ltx_Math" display="inline" id="S2.SS4.p5.1.m1.1"><semantics id="S2.SS4.p5.1.m1.1a"><msup id="S2.SS4.p5.1.m1.1.1" xref="S2.SS4.p5.1.m1.1.1.cmml"><mn id="S2.SS4.p5.1.m1.1.1.2" xref="S2.SS4.p5.1.m1.1.1.2.cmml">10</mn><mn id="S2.SS4.p5.1.m1.1.1.3" xref="S2.SS4.p5.1.m1.1.1.3.cmml">5</mn></msup><annotation-xml encoding="MathML-Content" id="S2.SS4.p5.1.m1.1b"><apply id="S2.SS4.p5.1.m1.1.1.cmml" xref="S2.SS4.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS4.p5.1.m1.1.1.1.cmml" xref="S2.SS4.p5.1.m1.1.1">superscript</csymbol><cn id="S2.SS4.p5.1.m1.1.1.2.cmml" type="integer" xref="S2.SS4.p5.1.m1.1.1.2">10</cn><cn id="S2.SS4.p5.1.m1.1.1.3.cmml" type="integer" xref="S2.SS4.p5.1.m1.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS4.p5.1.m1.1c">10^{5}</annotation><annotation encoding="application/x-llamapun" id="S2.SS4.p5.1.m1.1d">10 start_POSTSUPERSCRIPT 5 end_POSTSUPERSCRIPT</annotation></semantics></math> larger than
that of history tokens in typical LLM models <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib33" title="">2024a</a>)</cite>.
As a result, both approaches incur non-negligible overhead for <span class="ltx_text" id="S2.SS4.p5.1.3">KV cache</span> restoration.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span><span class="ltx_text ltx_font_smallcaps" id="S3.1.1">HCache</span>: Caching the Hidden States</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">To accelerate the state restoration speed,
we aim to seek a new approach that <em class="ltx_emph ltx_font_italic" id="S3.p1.1.1">simultaneously utilizes the computation capability and transmission bandwidth,
while reducing unnecessary data transfers and recomputations</em>.
Our initial attempt is a
simple combination of recomputation and KV offload. Specifically, the contextual tokens
are divided into two parts, and we use recomputation and KV offload to restore them concurrently;
hence, the computation and transmission resources can be utilized in parallel.
However, this naive hybrid approach still keeps the LLM forward pass or KV cache as is,
which does not fundamentally reduce the computation and IO overhead, resulting in suboptimal performance (see §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS3.SSS1" title="6.3.1. Bubble-Free Scheduler ‣ 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">6.3.1</span></a>).</p>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p" id="S3.p2.1">To this end, we introduce <span class="ltx_text ltx_font_smallcaps" id="S3.p2.1.1">HCache</span>, a novel state restoration method that efficiently
utilizes both computational and I/O resources with reduced computing and transferring overhead.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span><span class="ltx_text ltx_font_smallcaps" id="S3.SS1.1.1">HCache</span> Overview</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">Instead of directly restoring the <span class="ltx_text" id="S3.SS1.p1.1.1">KV cache</span>,
the core idea behind <span class="ltx_text ltx_font_smallcaps" id="S3.SS1.p1.1.2">HCache</span> is to utilize the LLM’s intermediate
activations (i.e., hidden states) at each transformer layer for state restoration.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1">Recall from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.F2" title="Figure 2 ‣ 2.1. Transformer Architecture ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2</span></a> that the <span class="ltx_text" id="S3.SS1.p2.1.1">hidden states</span> represent the input to each transformer layer.
Within each transformer layer, the KV tensor pairs of each token are derived directly from the
<span class="ltx_text" id="S3.SS1.p2.1.2">hidden states</span> by performing the projection operation in the attention module. Specifically,
we can use the following equations to restore the <span class="ltx_text" id="S3.SS1.p2.1.3">KV cache</span> for token <math alttext="i" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mi id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><ci id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_i</annotation></semantics></math>:</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S3.Ex3">
<tbody id="S3.Ex3X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle K_{L}^{i}" class="ltx_Math" display="inline" id="S3.Ex3X.2.1.1.m1.1"><semantics id="S3.Ex3X.2.1.1.m1.1a"><msubsup id="S3.Ex3X.2.1.1.m1.1.1" xref="S3.Ex3X.2.1.1.m1.1.1.cmml"><mi id="S3.Ex3X.2.1.1.m1.1.1.2.2" xref="S3.Ex3X.2.1.1.m1.1.1.2.2.cmml">K</mi><mi id="S3.Ex3X.2.1.1.m1.1.1.2.3" xref="S3.Ex3X.2.1.1.m1.1.1.2.3.cmml">L</mi><mi id="S3.Ex3X.2.1.1.m1.1.1.3" xref="S3.Ex3X.2.1.1.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.Ex3X.2.1.1.m1.1b"><apply id="S3.Ex3X.2.1.1.m1.1.1.cmml" xref="S3.Ex3X.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex3X.2.1.1.m1.1.1.1.cmml" xref="S3.Ex3X.2.1.1.m1.1.1">superscript</csymbol><apply id="S3.Ex3X.2.1.1.m1.1.1.2.cmml" xref="S3.Ex3X.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex3X.2.1.1.m1.1.1.2.1.cmml" xref="S3.Ex3X.2.1.1.m1.1.1">subscript</csymbol><ci id="S3.Ex3X.2.1.1.m1.1.1.2.2.cmml" xref="S3.Ex3X.2.1.1.m1.1.1.2.2">𝐾</ci><ci id="S3.Ex3X.2.1.1.m1.1.1.2.3.cmml" xref="S3.Ex3X.2.1.1.m1.1.1.2.3">𝐿</ci></apply><ci id="S3.Ex3X.2.1.1.m1.1.1.3.cmml" xref="S3.Ex3X.2.1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex3X.2.1.1.m1.1c">\displaystyle K_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex3X.2.1.1.m1.1d">italic_K start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{k}_{L}\cdot H_{L}^{i}" class="ltx_Math" display="inline" id="S3.Ex3X.3.2.2.m1.1"><semantics id="S3.Ex3X.3.2.2.m1.1a"><mrow id="S3.Ex3X.3.2.2.m1.1.1" xref="S3.Ex3X.3.2.2.m1.1.1.cmml"><mi id="S3.Ex3X.3.2.2.m1.1.1.2" xref="S3.Ex3X.3.2.2.m1.1.1.2.cmml"></mi><mo id="S3.Ex3X.3.2.2.m1.1.1.1" xref="S3.Ex3X.3.2.2.m1.1.1.1.cmml">=</mo><mrow id="S3.Ex3X.3.2.2.m1.1.1.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.cmml"><msubsup id="S3.Ex3X.3.2.2.m1.1.1.3.2" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.cmml"><mi id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.2" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.2.2.cmml">W</mi><mi id="S3.Ex3X.3.2.2.m1.1.1.3.2.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.3.cmml">L</mi><mi id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.2.3.cmml">k</mi></msubsup><mo id="S3.Ex3X.3.2.2.m1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex3X.3.2.2.m1.1.1.3.1.cmml">⋅</mo><msubsup id="S3.Ex3X.3.2.2.m1.1.1.3.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.cmml"><mi id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.2" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.2.2.cmml">H</mi><mi id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.2.3.cmml">L</mi><mi id="S3.Ex3X.3.2.2.m1.1.1.3.3.3" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.3.cmml">i</mi></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex3X.3.2.2.m1.1b"><apply id="S3.Ex3X.3.2.2.m1.1.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1"><eq id="S3.Ex3X.3.2.2.m1.1.1.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex3X.3.2.2.m1.1.1.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.2">absent</csymbol><apply id="S3.Ex3X.3.2.2.m1.1.1.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3"><ci id="S3.Ex3X.3.2.2.m1.1.1.3.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.1">⋅</ci><apply id="S3.Ex3X.3.2.2.m1.1.1.3.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex3X.3.2.2.m1.1.1.3.2.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2">subscript</csymbol><apply id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2">superscript</csymbol><ci id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.2.2">𝑊</ci><ci id="S3.Ex3X.3.2.2.m1.1.1.3.2.2.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.2.3">𝑘</ci></apply><ci id="S3.Ex3X.3.2.2.m1.1.1.3.2.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.2.3">𝐿</ci></apply><apply id="S3.Ex3X.3.2.2.m1.1.1.3.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.Ex3X.3.2.2.m1.1.1.3.3.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3">superscript</csymbol><apply id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.1.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3">subscript</csymbol><ci id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.2.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.2.2">𝐻</ci><ci id="S3.Ex3X.3.2.2.m1.1.1.3.3.2.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.2.3">𝐿</ci></apply><ci id="S3.Ex3X.3.2.2.m1.1.1.3.3.3.cmml" xref="S3.Ex3X.3.2.2.m1.1.1.3.3.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex3X.3.2.2.m1.1c">\displaystyle=W^{k}_{L}\cdot H_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex3X.3.2.2.m1.1d">= italic_W start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT ⋅ italic_H start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.Ex3Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle V_{L}^{i}" class="ltx_Math" display="inline" id="S3.Ex3Xa.2.1.1.m1.1"><semantics id="S3.Ex3Xa.2.1.1.m1.1a"><msubsup id="S3.Ex3Xa.2.1.1.m1.1.1" xref="S3.Ex3Xa.2.1.1.m1.1.1.cmml"><mi id="S3.Ex3Xa.2.1.1.m1.1.1.2.2" xref="S3.Ex3Xa.2.1.1.m1.1.1.2.2.cmml">V</mi><mi id="S3.Ex3Xa.2.1.1.m1.1.1.2.3" xref="S3.Ex3Xa.2.1.1.m1.1.1.2.3.cmml">L</mi><mi id="S3.Ex3Xa.2.1.1.m1.1.1.3" xref="S3.Ex3Xa.2.1.1.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.Ex3Xa.2.1.1.m1.1b"><apply id="S3.Ex3Xa.2.1.1.m1.1.1.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex3Xa.2.1.1.m1.1.1.1.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1">superscript</csymbol><apply id="S3.Ex3Xa.2.1.1.m1.1.1.2.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex3Xa.2.1.1.m1.1.1.2.1.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1">subscript</csymbol><ci id="S3.Ex3Xa.2.1.1.m1.1.1.2.2.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1.2.2">𝑉</ci><ci id="S3.Ex3Xa.2.1.1.m1.1.1.2.3.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1.2.3">𝐿</ci></apply><ci id="S3.Ex3Xa.2.1.1.m1.1.1.3.cmml" xref="S3.Ex3Xa.2.1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex3Xa.2.1.1.m1.1c">\displaystyle V_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex3Xa.2.1.1.m1.1d">italic_V start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{v}_{L}\cdot H_{L}^{i}" class="ltx_Math" display="inline" id="S3.Ex3Xa.3.2.2.m1.1"><semantics id="S3.Ex3Xa.3.2.2.m1.1a"><mrow id="S3.Ex3Xa.3.2.2.m1.1.1" xref="S3.Ex3Xa.3.2.2.m1.1.1.cmml"><mi id="S3.Ex3Xa.3.2.2.m1.1.1.2" xref="S3.Ex3Xa.3.2.2.m1.1.1.2.cmml"></mi><mo id="S3.Ex3Xa.3.2.2.m1.1.1.1" xref="S3.Ex3Xa.3.2.2.m1.1.1.1.cmml">=</mo><mrow id="S3.Ex3Xa.3.2.2.m1.1.1.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.cmml"><msubsup id="S3.Ex3Xa.3.2.2.m1.1.1.3.2" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.cmml"><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.2" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.2.cmml">W</mi><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.3.cmml">L</mi><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.3.cmml">v</mi></msubsup><mo id="S3.Ex3Xa.3.2.2.m1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.1.cmml">⋅</mo><msubsup id="S3.Ex3Xa.3.2.2.m1.1.1.3.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.cmml"><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.2" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.2.cmml">H</mi><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.3.cmml">L</mi><mi id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.3" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.3.cmml">i</mi></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex3Xa.3.2.2.m1.1b"><apply id="S3.Ex3Xa.3.2.2.m1.1.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1"><eq id="S3.Ex3Xa.3.2.2.m1.1.1.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex3Xa.3.2.2.m1.1.1.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.2">absent</csymbol><apply id="S3.Ex3Xa.3.2.2.m1.1.1.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3"><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.1">⋅</ci><apply id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2">subscript</csymbol><apply id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2">superscript</csymbol><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.2">𝑊</ci><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.2.3">𝑣</ci></apply><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.2.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.2.3">𝐿</ci></apply><apply id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3">superscript</csymbol><apply id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.1.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3">subscript</csymbol><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.2.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.2">𝐻</ci><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.2.3">𝐿</ci></apply><ci id="S3.Ex3Xa.3.2.2.m1.1.1.3.3.3.cmml" xref="S3.Ex3Xa.3.2.2.m1.1.1.3.3.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex3Xa.3.2.2.m1.1c">\displaystyle=W^{v}_{L}\cdot H_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex3Xa.3.2.2.m1.1d">= italic_W start_POSTSUPERSCRIPT italic_v end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT ⋅ italic_H start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.9">where <math alttext="H_{L}^{i}" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m1.1"><semantics id="S3.SS1.p2.2.m1.1a"><msubsup id="S3.SS1.p2.2.m1.1.1" xref="S3.SS1.p2.2.m1.1.1.cmml"><mi id="S3.SS1.p2.2.m1.1.1.2.2" xref="S3.SS1.p2.2.m1.1.1.2.2.cmml">H</mi><mi id="S3.SS1.p2.2.m1.1.1.2.3" xref="S3.SS1.p2.2.m1.1.1.2.3.cmml">L</mi><mi id="S3.SS1.p2.2.m1.1.1.3" xref="S3.SS1.p2.2.m1.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m1.1b"><apply id="S3.SS1.p2.2.m1.1.1.cmml" xref="S3.SS1.p2.2.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.2.m1.1.1.1.cmml" xref="S3.SS1.p2.2.m1.1.1">superscript</csymbol><apply id="S3.SS1.p2.2.m1.1.1.2.cmml" xref="S3.SS1.p2.2.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.2.m1.1.1.2.1.cmml" xref="S3.SS1.p2.2.m1.1.1">subscript</csymbol><ci id="S3.SS1.p2.2.m1.1.1.2.2.cmml" xref="S3.SS1.p2.2.m1.1.1.2.2">𝐻</ci><ci id="S3.SS1.p2.2.m1.1.1.2.3.cmml" xref="S3.SS1.p2.2.m1.1.1.2.3">𝐿</ci></apply><ci id="S3.SS1.p2.2.m1.1.1.3.cmml" xref="S3.SS1.p2.2.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m1.1c">H_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m1.1d">italic_H start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math> is the hidden state for a token <math alttext="i" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m2.1"><semantics id="S3.SS1.p2.3.m2.1a"><mi id="S3.SS1.p2.3.m2.1.1" xref="S3.SS1.p2.3.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m2.1b"><ci id="S3.SS1.p2.3.m2.1.1.cmml" xref="S3.SS1.p2.3.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.m2.1d">italic_i</annotation></semantics></math> at layer <math alttext="L" class="ltx_Math" display="inline" id="S3.SS1.p2.4.m3.1"><semantics id="S3.SS1.p2.4.m3.1a"><mi id="S3.SS1.p2.4.m3.1.1" xref="S3.SS1.p2.4.m3.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.m3.1b"><ci id="S3.SS1.p2.4.m3.1.1.cmml" xref="S3.SS1.p2.4.m3.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.4.m3.1c">L</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.4.m3.1d">italic_L</annotation></semantics></math>, <math alttext="K_{L}^{i}" class="ltx_Math" display="inline" id="S3.SS1.p2.5.m4.1"><semantics id="S3.SS1.p2.5.m4.1a"><msubsup id="S3.SS1.p2.5.m4.1.1" xref="S3.SS1.p2.5.m4.1.1.cmml"><mi id="S3.SS1.p2.5.m4.1.1.2.2" xref="S3.SS1.p2.5.m4.1.1.2.2.cmml">K</mi><mi id="S3.SS1.p2.5.m4.1.1.2.3" xref="S3.SS1.p2.5.m4.1.1.2.3.cmml">L</mi><mi id="S3.SS1.p2.5.m4.1.1.3" xref="S3.SS1.p2.5.m4.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.m4.1b"><apply id="S3.SS1.p2.5.m4.1.1.cmml" xref="S3.SS1.p2.5.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.5.m4.1.1.1.cmml" xref="S3.SS1.p2.5.m4.1.1">superscript</csymbol><apply id="S3.SS1.p2.5.m4.1.1.2.cmml" xref="S3.SS1.p2.5.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.5.m4.1.1.2.1.cmml" xref="S3.SS1.p2.5.m4.1.1">subscript</csymbol><ci id="S3.SS1.p2.5.m4.1.1.2.2.cmml" xref="S3.SS1.p2.5.m4.1.1.2.2">𝐾</ci><ci id="S3.SS1.p2.5.m4.1.1.2.3.cmml" xref="S3.SS1.p2.5.m4.1.1.2.3">𝐿</ci></apply><ci id="S3.SS1.p2.5.m4.1.1.3.cmml" xref="S3.SS1.p2.5.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.5.m4.1c">K_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.5.m4.1d">italic_K start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="V_{L}^{i}" class="ltx_Math" display="inline" id="S3.SS1.p2.6.m5.1"><semantics id="S3.SS1.p2.6.m5.1a"><msubsup id="S3.SS1.p2.6.m5.1.1" xref="S3.SS1.p2.6.m5.1.1.cmml"><mi id="S3.SS1.p2.6.m5.1.1.2.2" xref="S3.SS1.p2.6.m5.1.1.2.2.cmml">V</mi><mi id="S3.SS1.p2.6.m5.1.1.2.3" xref="S3.SS1.p2.6.m5.1.1.2.3.cmml">L</mi><mi id="S3.SS1.p2.6.m5.1.1.3" xref="S3.SS1.p2.6.m5.1.1.3.cmml">i</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.m5.1b"><apply id="S3.SS1.p2.6.m5.1.1.cmml" xref="S3.SS1.p2.6.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.6.m5.1.1.1.cmml" xref="S3.SS1.p2.6.m5.1.1">superscript</csymbol><apply id="S3.SS1.p2.6.m5.1.1.2.cmml" xref="S3.SS1.p2.6.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.6.m5.1.1.2.1.cmml" xref="S3.SS1.p2.6.m5.1.1">subscript</csymbol><ci id="S3.SS1.p2.6.m5.1.1.2.2.cmml" xref="S3.SS1.p2.6.m5.1.1.2.2">𝑉</ci><ci id="S3.SS1.p2.6.m5.1.1.2.3.cmml" xref="S3.SS1.p2.6.m5.1.1.2.3">𝐿</ci></apply><ci id="S3.SS1.p2.6.m5.1.1.3.cmml" xref="S3.SS1.p2.6.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.6.m5.1c">V_{L}^{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.6.m5.1d">italic_V start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT</annotation></semantics></math> represents
the key and value tensors for token <math alttext="i" class="ltx_Math" display="inline" id="S3.SS1.p2.7.m6.1"><semantics id="S3.SS1.p2.7.m6.1a"><mi id="S3.SS1.p2.7.m6.1.1" xref="S3.SS1.p2.7.m6.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.m6.1b"><ci id="S3.SS1.p2.7.m6.1.1.cmml" xref="S3.SS1.p2.7.m6.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.7.m6.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.7.m6.1d">italic_i</annotation></semantics></math> at that layer, and <math alttext="W^{k}_{L}" class="ltx_Math" display="inline" id="S3.SS1.p2.8.m7.1"><semantics id="S3.SS1.p2.8.m7.1a"><msubsup id="S3.SS1.p2.8.m7.1.1" xref="S3.SS1.p2.8.m7.1.1.cmml"><mi id="S3.SS1.p2.8.m7.1.1.2.2" xref="S3.SS1.p2.8.m7.1.1.2.2.cmml">W</mi><mi id="S3.SS1.p2.8.m7.1.1.3" xref="S3.SS1.p2.8.m7.1.1.3.cmml">L</mi><mi id="S3.SS1.p2.8.m7.1.1.2.3" xref="S3.SS1.p2.8.m7.1.1.2.3.cmml">k</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.8.m7.1b"><apply id="S3.SS1.p2.8.m7.1.1.cmml" xref="S3.SS1.p2.8.m7.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.8.m7.1.1.1.cmml" xref="S3.SS1.p2.8.m7.1.1">subscript</csymbol><apply id="S3.SS1.p2.8.m7.1.1.2.cmml" xref="S3.SS1.p2.8.m7.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.8.m7.1.1.2.1.cmml" xref="S3.SS1.p2.8.m7.1.1">superscript</csymbol><ci id="S3.SS1.p2.8.m7.1.1.2.2.cmml" xref="S3.SS1.p2.8.m7.1.1.2.2">𝑊</ci><ci id="S3.SS1.p2.8.m7.1.1.2.3.cmml" xref="S3.SS1.p2.8.m7.1.1.2.3">𝑘</ci></apply><ci id="S3.SS1.p2.8.m7.1.1.3.cmml" xref="S3.SS1.p2.8.m7.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.8.m7.1c">W^{k}_{L}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.8.m7.1d">italic_W start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="W^{v}_{L}" class="ltx_Math" display="inline" id="S3.SS1.p2.9.m8.1"><semantics id="S3.SS1.p2.9.m8.1a"><msubsup id="S3.SS1.p2.9.m8.1.1" xref="S3.SS1.p2.9.m8.1.1.cmml"><mi id="S3.SS1.p2.9.m8.1.1.2.2" xref="S3.SS1.p2.9.m8.1.1.2.2.cmml">W</mi><mi id="S3.SS1.p2.9.m8.1.1.3" xref="S3.SS1.p2.9.m8.1.1.3.cmml">L</mi><mi id="S3.SS1.p2.9.m8.1.1.2.3" xref="S3.SS1.p2.9.m8.1.1.2.3.cmml">v</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.9.m8.1b"><apply id="S3.SS1.p2.9.m8.1.1.cmml" xref="S3.SS1.p2.9.m8.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.9.m8.1.1.1.cmml" xref="S3.SS1.p2.9.m8.1.1">subscript</csymbol><apply id="S3.SS1.p2.9.m8.1.1.2.cmml" xref="S3.SS1.p2.9.m8.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.9.m8.1.1.2.1.cmml" xref="S3.SS1.p2.9.m8.1.1">superscript</csymbol><ci id="S3.SS1.p2.9.m8.1.1.2.2.cmml" xref="S3.SS1.p2.9.m8.1.1.2.2">𝑊</ci><ci id="S3.SS1.p2.9.m8.1.1.2.3.cmml" xref="S3.SS1.p2.9.m8.1.1.2.3">𝑣</ci></apply><ci id="S3.SS1.p2.9.m8.1.1.3.cmml" xref="S3.SS1.p2.9.m8.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.9.m8.1c">W^{v}_{L}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.9.m8.1d">italic_W start_POSTSUPERSCRIPT italic_v end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT</annotation></semantics></math> are the
linear projection parameters.</p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1">An LLM serving system working with <span class="ltx_text ltx_font_smallcaps" id="S3.SS1.p3.1.1">HCache</span> makes the following changes to reuse contextual contents.
First, <span class="ltx_text" id="S3.SS1.p3.1.2">hidden states</span> should be saved for future reuse. Specifically, in multi-round conversations,
whenever a layer’s <span class="ltx_text" id="S3.SS1.p3.1.3">hidden states</span> is generated in a LLM forward pass,
it is dumped to the host storage concurrently with this layer’s computation;
in RAG applications, <span class="ltx_text" id="S3.SS1.p3.1.4">hidden states</span> can be generated and saved offline.
Upon new user requests arrive, the related <span class="ltx_text ltx_font_smallcaps" id="S3.SS1.p3.1.5">HCache</span> is retrieved from the
host storage into the GPU memory,
then, we can use the GEMM operator to restore the <span class="ltx_text" id="S3.SS1.p3.1.6">KV cache</span> from <span class="ltx_text" id="S3.SS1.p3.1.7">hidden states</span> with the above equation.</p>
</div>
<div class="ltx_para" id="S3.SS1.p4">
<p class="ltx_p" id="S3.SS1.p4.2">Importantly, transmission and computation can be pipelined to utilize both the computation capability
and transmission bandwidth at the same time. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.F5" title="Figure 5 ‣ 3.1. HCache Overview ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">5</span></a>,
the transmission of <math alttext="L_{n+1}" class="ltx_Math" display="inline" id="S3.SS1.p4.1.m1.1"><semantics id="S3.SS1.p4.1.m1.1a"><msub id="S3.SS1.p4.1.m1.1.1" xref="S3.SS1.p4.1.m1.1.1.cmml"><mi id="S3.SS1.p4.1.m1.1.1.2" xref="S3.SS1.p4.1.m1.1.1.2.cmml">L</mi><mrow id="S3.SS1.p4.1.m1.1.1.3" xref="S3.SS1.p4.1.m1.1.1.3.cmml"><mi id="S3.SS1.p4.1.m1.1.1.3.2" xref="S3.SS1.p4.1.m1.1.1.3.2.cmml">n</mi><mo id="S3.SS1.p4.1.m1.1.1.3.1" xref="S3.SS1.p4.1.m1.1.1.3.1.cmml">+</mo><mn id="S3.SS1.p4.1.m1.1.1.3.3" xref="S3.SS1.p4.1.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.1.m1.1b"><apply id="S3.SS1.p4.1.m1.1.1.cmml" xref="S3.SS1.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.1.m1.1.1.1.cmml" xref="S3.SS1.p4.1.m1.1.1">subscript</csymbol><ci id="S3.SS1.p4.1.m1.1.1.2.cmml" xref="S3.SS1.p4.1.m1.1.1.2">𝐿</ci><apply id="S3.SS1.p4.1.m1.1.1.3.cmml" xref="S3.SS1.p4.1.m1.1.1.3"><plus id="S3.SS1.p4.1.m1.1.1.3.1.cmml" xref="S3.SS1.p4.1.m1.1.1.3.1"></plus><ci id="S3.SS1.p4.1.m1.1.1.3.2.cmml" xref="S3.SS1.p4.1.m1.1.1.3.2">𝑛</ci><cn id="S3.SS1.p4.1.m1.1.1.3.3.cmml" type="integer" xref="S3.SS1.p4.1.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.1.m1.1c">L_{n+1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_n + 1 end_POSTSUBSCRIPT</annotation></semantics></math> and recomputation from the <span class="ltx_text" id="S3.SS1.p4.2.1">hidden states</span> to <span class="ltx_text" id="S3.SS1.p4.2.2">KV cache</span> of <math alttext="L_{n}" class="ltx_Math" display="inline" id="S3.SS1.p4.2.m2.1"><semantics id="S3.SS1.p4.2.m2.1a"><msub id="S3.SS1.p4.2.m2.1.1" xref="S3.SS1.p4.2.m2.1.1.cmml"><mi id="S3.SS1.p4.2.m2.1.1.2" xref="S3.SS1.p4.2.m2.1.1.2.cmml">L</mi><mi id="S3.SS1.p4.2.m2.1.1.3" xref="S3.SS1.p4.2.m2.1.1.3.cmml">n</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.2.m2.1b"><apply id="S3.SS1.p4.2.m2.1.1.cmml" xref="S3.SS1.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.2.m2.1.1.1.cmml" xref="S3.SS1.p4.2.m2.1.1">subscript</csymbol><ci id="S3.SS1.p4.2.m2.1.1.2.cmml" xref="S3.SS1.p4.2.m2.1.1.2">𝐿</ci><ci id="S3.SS1.p4.2.m2.1.1.3.cmml" xref="S3.SS1.p4.2.m2.1.1.3">𝑛</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.2.m2.1c">L_{n}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT</annotation></semantics></math> can be done concurrently.</p>
</div>
<div class="ltx_para" id="S3.SS1.p5">
<p class="ltx_p" id="S3.SS1.p5.1">Next, We theoretically analyze how caching <span class="ltx_text" id="S3.SS1.p5.1.1">hidden states</span> can reduce both computational and data transfer volumes.</p>
</div>
<figure class="ltx_figure" id="S3.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="207" id="S3.F5.g1" src="x5.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5. </span> Example of Pipelined Restoration with <span class="ltx_text ltx_font_smallcaps" id="S3.F5.2.1">HCache</span>.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Restoration Cost Analysis</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">We compare <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p1.1.1">HCache</span> with the two aforementioned methods: KV offload and recomputation. We analyze the restoration for one transformer layer that uses muti-head-attention (MHA).</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.7"><span class="ltx_text ltx_font_bold" id="S3.SS2.p2.7.1">Restoration time with <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p2.7.1.1">HCache</span></span>.
Restoration from <span class="ltx_text" id="S3.SS2.p2.7.2">hidden states</span> involves two parts: <span class="ltx_text" id="S3.SS2.p2.7.3">hidden states</span> transmission and
recomputation from the <span class="ltx_text" id="S3.SS2.p2.7.4">hidden states</span> to <span class="ltx_text" id="S3.SS2.p2.7.5">KV cache</span>. The time for transmitting <span class="ltx_text" id="S3.SS2.p2.7.6">hidden states</span> is:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="IO_{hidden}=\frac{N_{seq}*D_{hidden}}{BW}," class="ltx_Math" display="block" id="S3.Ex4.m1.1"><semantics id="S3.Ex4.m1.1a"><mrow id="S3.Ex4.m1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.cmml"><mrow id="S3.Ex4.m1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.cmml"><mrow id="S3.Ex4.m1.1.1.1.1.2" xref="S3.Ex4.m1.1.1.1.1.2.cmml"><mi id="S3.Ex4.m1.1.1.1.1.2.2" xref="S3.Ex4.m1.1.1.1.1.2.2.cmml">I</mi><mo id="S3.Ex4.m1.1.1.1.1.2.1" xref="S3.Ex4.m1.1.1.1.1.2.1.cmml">⁢</mo><msub id="S3.Ex4.m1.1.1.1.1.2.3" xref="S3.Ex4.m1.1.1.1.1.2.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.2.3.2" xref="S3.Ex4.m1.1.1.1.1.2.3.2.cmml">O</mi><mrow id="S3.Ex4.m1.1.1.1.1.2.3.3" xref="S3.Ex4.m1.1.1.1.1.2.3.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.2" xref="S3.Ex4.m1.1.1.1.1.2.3.3.2.cmml">h</mi><mo id="S3.Ex4.m1.1.1.1.1.2.3.3.1" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.3" xref="S3.Ex4.m1.1.1.1.1.2.3.3.3.cmml">i</mi><mo id="S3.Ex4.m1.1.1.1.1.2.3.3.1a" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.4" xref="S3.Ex4.m1.1.1.1.1.2.3.3.4.cmml">d</mi><mo id="S3.Ex4.m1.1.1.1.1.2.3.3.1b" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.5" xref="S3.Ex4.m1.1.1.1.1.2.3.3.5.cmml">d</mi><mo id="S3.Ex4.m1.1.1.1.1.2.3.3.1c" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.6" xref="S3.Ex4.m1.1.1.1.1.2.3.3.6.cmml">e</mi><mo id="S3.Ex4.m1.1.1.1.1.2.3.3.1d" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.2.3.3.7" xref="S3.Ex4.m1.1.1.1.1.2.3.3.7.cmml">n</mi></mrow></msub></mrow><mo id="S3.Ex4.m1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.cmml">=</mo><mfrac id="S3.Ex4.m1.1.1.1.1.3" xref="S3.Ex4.m1.1.1.1.1.3.cmml"><mrow id="S3.Ex4.m1.1.1.1.1.3.2" xref="S3.Ex4.m1.1.1.1.1.3.2.cmml"><msub id="S3.Ex4.m1.1.1.1.1.3.2.2" xref="S3.Ex4.m1.1.1.1.1.3.2.2.cmml"><mi id="S3.Ex4.m1.1.1.1.1.3.2.2.2" xref="S3.Ex4.m1.1.1.1.1.3.2.2.2.cmml">N</mi><mrow id="S3.Ex4.m1.1.1.1.1.3.2.2.3" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.3.2.2.3.2" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.2.cmml">s</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.2.3.1" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.2.3.3" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.3.cmml">e</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.2.3.1a" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.2.3.4" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex4.m1.1.1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex4.m1.1.1.1.1.3.2.1.cmml">∗</mo><msub id="S3.Ex4.m1.1.1.1.1.3.2.3" xref="S3.Ex4.m1.1.1.1.1.3.2.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.2" xref="S3.Ex4.m1.1.1.1.1.3.2.3.2.cmml">D</mi><mrow id="S3.Ex4.m1.1.1.1.1.3.2.3.3" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.2" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.2.cmml">h</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.3" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.3.cmml">i</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1a" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.4" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.4.cmml">d</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1b" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.5" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.5.cmml">d</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1c" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.6" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.6.cmml">e</mi><mo id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1d" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.2.3.3.7" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.7.cmml">n</mi></mrow></msub></mrow><mrow id="S3.Ex4.m1.1.1.1.1.3.3" xref="S3.Ex4.m1.1.1.1.1.3.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.3.3.2" xref="S3.Ex4.m1.1.1.1.1.3.3.2.cmml">B</mi><mo id="S3.Ex4.m1.1.1.1.1.3.3.1" xref="S3.Ex4.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex4.m1.1.1.1.1.3.3.3" xref="S3.Ex4.m1.1.1.1.1.3.3.3.cmml">W</mi></mrow></mfrac></mrow><mo id="S3.Ex4.m1.1.1.1.2" xref="S3.Ex4.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex4.m1.1b"><apply id="S3.Ex4.m1.1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1"><eq id="S3.Ex4.m1.1.1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1.1.1"></eq><apply id="S3.Ex4.m1.1.1.1.1.2.cmml" xref="S3.Ex4.m1.1.1.1.1.2"><times id="S3.Ex4.m1.1.1.1.1.2.1.cmml" xref="S3.Ex4.m1.1.1.1.1.2.1"></times><ci id="S3.Ex4.m1.1.1.1.1.2.2.cmml" xref="S3.Ex4.m1.1.1.1.1.2.2">𝐼</ci><apply id="S3.Ex4.m1.1.1.1.1.2.3.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.1.1.2.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3">subscript</csymbol><ci id="S3.Ex4.m1.1.1.1.1.2.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.2">𝑂</ci><apply id="S3.Ex4.m1.1.1.1.1.2.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3"><times id="S3.Ex4.m1.1.1.1.1.2.3.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.1"></times><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.2">ℎ</ci><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.3">𝑖</ci><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.4.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.4">𝑑</ci><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.5.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.5">𝑑</ci><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.6.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.6">𝑒</ci><ci id="S3.Ex4.m1.1.1.1.1.2.3.3.7.cmml" xref="S3.Ex4.m1.1.1.1.1.2.3.3.7">𝑛</ci></apply></apply></apply><apply id="S3.Ex4.m1.1.1.1.1.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3"><divide id="S3.Ex4.m1.1.1.1.1.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3"></divide><apply id="S3.Ex4.m1.1.1.1.1.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2"><times id="S3.Ex4.m1.1.1.1.1.3.2.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.1"></times><apply id="S3.Ex4.m1.1.1.1.1.3.2.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.1.1.3.2.2.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2">subscript</csymbol><ci id="S3.Ex4.m1.1.1.1.1.3.2.2.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.2">𝑁</ci><apply id="S3.Ex4.m1.1.1.1.1.3.2.2.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3"><times id="S3.Ex4.m1.1.1.1.1.3.2.2.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.1"></times><ci id="S3.Ex4.m1.1.1.1.1.3.2.2.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.2">𝑠</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.2.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.3">𝑒</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.2.3.4.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.2.3.4">𝑞</ci></apply></apply><apply id="S3.Ex4.m1.1.1.1.1.3.2.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.1.1.3.2.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3">subscript</csymbol><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.2">𝐷</ci><apply id="S3.Ex4.m1.1.1.1.1.3.2.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3"><times id="S3.Ex4.m1.1.1.1.1.3.2.3.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.1"></times><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.2">ℎ</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.3">𝑖</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.4.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.4">𝑑</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.5.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.5">𝑑</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.6.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.6">𝑒</ci><ci id="S3.Ex4.m1.1.1.1.1.3.2.3.3.7.cmml" xref="S3.Ex4.m1.1.1.1.1.3.2.3.3.7">𝑛</ci></apply></apply></apply><apply id="S3.Ex4.m1.1.1.1.1.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.3"><times id="S3.Ex4.m1.1.1.1.1.3.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.3.3.1"></times><ci id="S3.Ex4.m1.1.1.1.1.3.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.3.3.2">𝐵</ci><ci id="S3.Ex4.m1.1.1.1.1.3.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.3.3.3">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex4.m1.1c">IO_{hidden}=\frac{N_{seq}*D_{hidden}}{BW},</annotation><annotation encoding="application/x-llamapun" id="S3.Ex4.m1.1d">italic_I italic_O start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT = divide start_ARG italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_B italic_W end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p2.3">where <math alttext="N_{seq}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><msub id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.2.cmml">N</mi><mrow id="S3.SS2.p2.1.m1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.3.cmml"><mi id="S3.SS2.p2.1.m1.1.1.3.2" xref="S3.SS2.p2.1.m1.1.1.3.2.cmml">s</mi><mo id="S3.SS2.p2.1.m1.1.1.3.1" xref="S3.SS2.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.1.m1.1.1.3.3" xref="S3.SS2.p2.1.m1.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p2.1.m1.1.1.3.1a" xref="S3.SS2.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.1.m1.1.1.3.4" xref="S3.SS2.p2.1.m1.1.1.3.4.cmml">q</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><apply id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2">𝑁</ci><apply id="S3.SS2.p2.1.m1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3"><times id="S3.SS2.p2.1.m1.1.1.3.1.cmml" xref="S3.SS2.p2.1.m1.1.1.3.1"></times><ci id="S3.SS2.p2.1.m1.1.1.3.2.cmml" xref="S3.SS2.p2.1.m1.1.1.3.2">𝑠</ci><ci id="S3.SS2.p2.1.m1.1.1.3.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3.3">𝑒</ci><ci id="S3.SS2.p2.1.m1.1.1.3.4.cmml" xref="S3.SS2.p2.1.m1.1.1.3.4">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">N_{seq}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT</annotation></semantics></math> indicates the number of tokens in the sequence, <math alttext="D_{didden}" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><msub id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml"><mi id="S3.SS2.p2.2.m2.1.1.2" xref="S3.SS2.p2.2.m2.1.1.2.cmml">D</mi><mrow id="S3.SS2.p2.2.m2.1.1.3" xref="S3.SS2.p2.2.m2.1.1.3.cmml"><mi id="S3.SS2.p2.2.m2.1.1.3.2" xref="S3.SS2.p2.2.m2.1.1.3.2.cmml">d</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.3" xref="S3.SS2.p2.2.m2.1.1.3.3.cmml">i</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1a" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.4" xref="S3.SS2.p2.2.m2.1.1.3.4.cmml">d</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1b" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.5" xref="S3.SS2.p2.2.m2.1.1.3.5.cmml">d</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1c" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.6" xref="S3.SS2.p2.2.m2.1.1.3.6.cmml">e</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1d" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.7" xref="S3.SS2.p2.2.m2.1.1.3.7.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><apply id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.2.m2.1.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p2.2.m2.1.1.2.cmml" xref="S3.SS2.p2.2.m2.1.1.2">𝐷</ci><apply id="S3.SS2.p2.2.m2.1.1.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3"><times id="S3.SS2.p2.2.m2.1.1.3.1.cmml" xref="S3.SS2.p2.2.m2.1.1.3.1"></times><ci id="S3.SS2.p2.2.m2.1.1.3.2.cmml" xref="S3.SS2.p2.2.m2.1.1.3.2">𝑑</ci><ci id="S3.SS2.p2.2.m2.1.1.3.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3.3">𝑖</ci><ci id="S3.SS2.p2.2.m2.1.1.3.4.cmml" xref="S3.SS2.p2.2.m2.1.1.3.4">𝑑</ci><ci id="S3.SS2.p2.2.m2.1.1.3.5.cmml" xref="S3.SS2.p2.2.m2.1.1.3.5">𝑑</ci><ci id="S3.SS2.p2.2.m2.1.1.3.6.cmml" xref="S3.SS2.p2.2.m2.1.1.3.6">𝑒</ci><ci id="S3.SS2.p2.2.m2.1.1.3.7.cmml" xref="S3.SS2.p2.2.m2.1.1.3.7">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">D_{didden}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_D start_POSTSUBSCRIPT italic_d italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT</annotation></semantics></math> is the LLM hidden dimension, and
<math alttext="BW" class="ltx_Math" display="inline" id="S3.SS2.p2.3.m3.1"><semantics id="S3.SS2.p2.3.m3.1a"><mrow id="S3.SS2.p2.3.m3.1.1" xref="S3.SS2.p2.3.m3.1.1.cmml"><mi id="S3.SS2.p2.3.m3.1.1.2" xref="S3.SS2.p2.3.m3.1.1.2.cmml">B</mi><mo id="S3.SS2.p2.3.m3.1.1.1" xref="S3.SS2.p2.3.m3.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p2.3.m3.1.1.3" xref="S3.SS2.p2.3.m3.1.1.3.cmml">W</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.1b"><apply id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1"><times id="S3.SS2.p2.3.m3.1.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1.1"></times><ci id="S3.SS2.p2.3.m3.1.1.2.cmml" xref="S3.SS2.p2.3.m3.1.1.2">𝐵</ci><ci id="S3.SS2.p2.3.m3.1.1.3.cmml" xref="S3.SS2.p2.3.m3.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.1c">BW</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.3.m3.1d">italic_B italic_W</annotation></semantics></math> is the bandwidth between hidden states’ GPU and storage backend.
The computation time<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>A multiply-add operator is regarded as 2 float point operations.</span></span></span> from <span class="ltx_text" id="S3.SS2.p2.3.1">hidden states</span> to <span class="ltx_text" id="S3.SS2.p2.3.2">KV cache</span> is:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{hidden}=\frac{4*N_{seq}*D_{hidden}*D_{hidden}}{FLOPS}," class="ltx_Math" display="block" id="S3.Ex5.m1.1"><semantics id="S3.Ex5.m1.1a"><mrow id="S3.Ex5.m1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.cmml"><mrow id="S3.Ex5.m1.1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.cmml"><msub id="S3.Ex5.m1.1.1.1.1.2" xref="S3.Ex5.m1.1.1.1.1.2.cmml"><mi id="S3.Ex5.m1.1.1.1.1.2.2" xref="S3.Ex5.m1.1.1.1.1.2.2.cmml">C</mi><mrow id="S3.Ex5.m1.1.1.1.1.2.3" xref="S3.Ex5.m1.1.1.1.1.2.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.2.3.2" xref="S3.Ex5.m1.1.1.1.1.2.3.2.cmml">h</mi><mo id="S3.Ex5.m1.1.1.1.1.2.3.1" xref="S3.Ex5.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.2.3.3" xref="S3.Ex5.m1.1.1.1.1.2.3.3.cmml">i</mi><mo id="S3.Ex5.m1.1.1.1.1.2.3.1a" xref="S3.Ex5.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.2.3.4" xref="S3.Ex5.m1.1.1.1.1.2.3.4.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.2.3.1b" xref="S3.Ex5.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.2.3.5" xref="S3.Ex5.m1.1.1.1.1.2.3.5.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.2.3.1c" xref="S3.Ex5.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.2.3.6" xref="S3.Ex5.m1.1.1.1.1.2.3.6.cmml">e</mi><mo id="S3.Ex5.m1.1.1.1.1.2.3.1d" xref="S3.Ex5.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.2.3.7" xref="S3.Ex5.m1.1.1.1.1.2.3.7.cmml">n</mi></mrow></msub><mo id="S3.Ex5.m1.1.1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.1.cmml">=</mo><mfrac id="S3.Ex5.m1.1.1.1.1.3" xref="S3.Ex5.m1.1.1.1.1.3.cmml"><mrow id="S3.Ex5.m1.1.1.1.1.3.2" xref="S3.Ex5.m1.1.1.1.1.3.2.cmml"><mn id="S3.Ex5.m1.1.1.1.1.3.2.2" xref="S3.Ex5.m1.1.1.1.1.3.2.2.cmml">4</mn><mo id="S3.Ex5.m1.1.1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex5.m1.1.1.1.1.3.2.1.cmml">∗</mo><msub id="S3.Ex5.m1.1.1.1.1.3.2.3" xref="S3.Ex5.m1.1.1.1.1.3.2.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.3.2" xref="S3.Ex5.m1.1.1.1.1.3.2.3.2.cmml">N</mi><mrow id="S3.Ex5.m1.1.1.1.1.3.2.3.3" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.3.3.2" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.2.cmml">s</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.3.3.1" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.3.3.3" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.3.cmml">e</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.3.3.1a" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.3.3.4" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex5.m1.1.1.1.1.3.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex5.m1.1.1.1.1.3.2.1.cmml">∗</mo><msub id="S3.Ex5.m1.1.1.1.1.3.2.4" xref="S3.Ex5.m1.1.1.1.1.3.2.4.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.2" xref="S3.Ex5.m1.1.1.1.1.3.2.4.2.cmml">D</mi><mrow id="S3.Ex5.m1.1.1.1.1.3.2.4.3" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.2" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.2.cmml">h</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.3" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.3.cmml">i</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1a" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.4" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.4.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1b" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.5" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.5.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1c" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.6" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.6.cmml">e</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1d" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.4.3.7" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.7.cmml">n</mi></mrow></msub><mo id="S3.Ex5.m1.1.1.1.1.3.2.1b" lspace="0.222em" rspace="0.222em" xref="S3.Ex5.m1.1.1.1.1.3.2.1.cmml">∗</mo><msub id="S3.Ex5.m1.1.1.1.1.3.2.5" xref="S3.Ex5.m1.1.1.1.1.3.2.5.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.2" xref="S3.Ex5.m1.1.1.1.1.3.2.5.2.cmml">D</mi><mrow id="S3.Ex5.m1.1.1.1.1.3.2.5.3" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.2" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.2.cmml">h</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.3" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.3.cmml">i</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1a" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.4" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.4.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1b" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.5" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.5.cmml">d</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1c" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.6" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.6.cmml">e</mi><mo id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1d" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.2.5.3.7" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.7.cmml">n</mi></mrow></msub></mrow><mrow id="S3.Ex5.m1.1.1.1.1.3.3" xref="S3.Ex5.m1.1.1.1.1.3.3.cmml"><mi id="S3.Ex5.m1.1.1.1.1.3.3.2" xref="S3.Ex5.m1.1.1.1.1.3.3.2.cmml">F</mi><mo id="S3.Ex5.m1.1.1.1.1.3.3.1" xref="S3.Ex5.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.3.3" xref="S3.Ex5.m1.1.1.1.1.3.3.3.cmml">L</mi><mo id="S3.Ex5.m1.1.1.1.1.3.3.1a" xref="S3.Ex5.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.3.4" xref="S3.Ex5.m1.1.1.1.1.3.3.4.cmml">O</mi><mo id="S3.Ex5.m1.1.1.1.1.3.3.1b" xref="S3.Ex5.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.3.5" xref="S3.Ex5.m1.1.1.1.1.3.3.5.cmml">P</mi><mo id="S3.Ex5.m1.1.1.1.1.3.3.1c" xref="S3.Ex5.m1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex5.m1.1.1.1.1.3.3.6" xref="S3.Ex5.m1.1.1.1.1.3.3.6.cmml">S</mi></mrow></mfrac></mrow><mo id="S3.Ex5.m1.1.1.1.2" xref="S3.Ex5.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex5.m1.1b"><apply id="S3.Ex5.m1.1.1.1.1.cmml" xref="S3.Ex5.m1.1.1.1"><eq id="S3.Ex5.m1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.1.1.1.1.1"></eq><apply id="S3.Ex5.m1.1.1.1.1.2.cmml" xref="S3.Ex5.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex5.m1.1.1.1.1.2.1.cmml" xref="S3.Ex5.m1.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex5.m1.1.1.1.1.2.2.cmml" xref="S3.Ex5.m1.1.1.1.1.2.2">𝐶</ci><apply id="S3.Ex5.m1.1.1.1.1.2.3.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3"><times id="S3.Ex5.m1.1.1.1.1.2.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.1"></times><ci id="S3.Ex5.m1.1.1.1.1.2.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.2">ℎ</ci><ci id="S3.Ex5.m1.1.1.1.1.2.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.3">𝑖</ci><ci id="S3.Ex5.m1.1.1.1.1.2.3.4.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.4">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.2.3.5.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.5">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.2.3.6.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.6">𝑒</ci><ci id="S3.Ex5.m1.1.1.1.1.2.3.7.cmml" xref="S3.Ex5.m1.1.1.1.1.2.3.7">𝑛</ci></apply></apply><apply id="S3.Ex5.m1.1.1.1.1.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3"><divide id="S3.Ex5.m1.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3"></divide><apply id="S3.Ex5.m1.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2"><times id="S3.Ex5.m1.1.1.1.1.3.2.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.1"></times><cn id="S3.Ex5.m1.1.1.1.1.3.2.2.cmml" type="integer" xref="S3.Ex5.m1.1.1.1.1.3.2.2">4</cn><apply id="S3.Ex5.m1.1.1.1.1.3.2.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.1.1.1.1.3.2.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3">subscript</csymbol><ci id="S3.Ex5.m1.1.1.1.1.3.2.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.2">𝑁</ci><apply id="S3.Ex5.m1.1.1.1.1.3.2.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3"><times id="S3.Ex5.m1.1.1.1.1.3.2.3.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.1"></times><ci id="S3.Ex5.m1.1.1.1.1.3.2.3.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.2">𝑠</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.3.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.3">𝑒</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.3.3.4.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex5.m1.1.1.1.1.3.2.4.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4"><csymbol cd="ambiguous" id="S3.Ex5.m1.1.1.1.1.3.2.4.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4">subscript</csymbol><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.2">𝐷</ci><apply id="S3.Ex5.m1.1.1.1.1.3.2.4.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3"><times id="S3.Ex5.m1.1.1.1.1.3.2.4.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.1"></times><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.2">ℎ</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.3">𝑖</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.4.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.4">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.5.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.5">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.6.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.6">𝑒</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.4.3.7.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.4.3.7">𝑛</ci></apply></apply><apply id="S3.Ex5.m1.1.1.1.1.3.2.5.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5"><csymbol cd="ambiguous" id="S3.Ex5.m1.1.1.1.1.3.2.5.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5">subscript</csymbol><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.2">𝐷</ci><apply id="S3.Ex5.m1.1.1.1.1.3.2.5.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3"><times id="S3.Ex5.m1.1.1.1.1.3.2.5.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.1"></times><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.2">ℎ</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.3">𝑖</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.4.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.4">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.5.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.5">𝑑</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.6.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.6">𝑒</ci><ci id="S3.Ex5.m1.1.1.1.1.3.2.5.3.7.cmml" xref="S3.Ex5.m1.1.1.1.1.3.2.5.3.7">𝑛</ci></apply></apply></apply><apply id="S3.Ex5.m1.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3"><times id="S3.Ex5.m1.1.1.1.1.3.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.1"></times><ci id="S3.Ex5.m1.1.1.1.1.3.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.2">𝐹</ci><ci id="S3.Ex5.m1.1.1.1.1.3.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.3">𝐿</ci><ci id="S3.Ex5.m1.1.1.1.1.3.3.4.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.4">𝑂</ci><ci id="S3.Ex5.m1.1.1.1.1.3.3.5.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.5">𝑃</ci><ci id="S3.Ex5.m1.1.1.1.1.3.3.6.cmml" xref="S3.Ex5.m1.1.1.1.1.3.3.6">𝑆</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex5.m1.1c">C_{hidden}=\frac{4*N_{seq}*D_{hidden}*D_{hidden}}{FLOPS},</annotation><annotation encoding="application/x-llamapun" id="S3.Ex5.m1.1d">italic_C start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT = divide start_ARG 4 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_F italic_L italic_O italic_P italic_S end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p2.6">where <math alttext="FLOPS" class="ltx_Math" display="inline" id="S3.SS2.p2.4.m1.1"><semantics id="S3.SS2.p2.4.m1.1a"><mrow id="S3.SS2.p2.4.m1.1.1" xref="S3.SS2.p2.4.m1.1.1.cmml"><mi id="S3.SS2.p2.4.m1.1.1.2" xref="S3.SS2.p2.4.m1.1.1.2.cmml">F</mi><mo id="S3.SS2.p2.4.m1.1.1.1" xref="S3.SS2.p2.4.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m1.1.1.3" xref="S3.SS2.p2.4.m1.1.1.3.cmml">L</mi><mo id="S3.SS2.p2.4.m1.1.1.1a" xref="S3.SS2.p2.4.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m1.1.1.4" xref="S3.SS2.p2.4.m1.1.1.4.cmml">O</mi><mo id="S3.SS2.p2.4.m1.1.1.1b" xref="S3.SS2.p2.4.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m1.1.1.5" xref="S3.SS2.p2.4.m1.1.1.5.cmml">P</mi><mo id="S3.SS2.p2.4.m1.1.1.1c" xref="S3.SS2.p2.4.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m1.1.1.6" xref="S3.SS2.p2.4.m1.1.1.6.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.4.m1.1b"><apply id="S3.SS2.p2.4.m1.1.1.cmml" xref="S3.SS2.p2.4.m1.1.1"><times id="S3.SS2.p2.4.m1.1.1.1.cmml" xref="S3.SS2.p2.4.m1.1.1.1"></times><ci id="S3.SS2.p2.4.m1.1.1.2.cmml" xref="S3.SS2.p2.4.m1.1.1.2">𝐹</ci><ci id="S3.SS2.p2.4.m1.1.1.3.cmml" xref="S3.SS2.p2.4.m1.1.1.3">𝐿</ci><ci id="S3.SS2.p2.4.m1.1.1.4.cmml" xref="S3.SS2.p2.4.m1.1.1.4">𝑂</ci><ci id="S3.SS2.p2.4.m1.1.1.5.cmml" xref="S3.SS2.p2.4.m1.1.1.5">𝑃</ci><ci id="S3.SS2.p2.4.m1.1.1.6.cmml" xref="S3.SS2.p2.4.m1.1.1.6">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.4.m1.1c">FLOPS</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.4.m1.1d">italic_F italic_L italic_O italic_P italic_S</annotation></semantics></math> is the FLOPS of the GPU.
With the computation-transmission pipeline implemented in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.F5" title="Figure 5 ‣ 3.1. HCache Overview ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">5</span></a>,
the end-to-end restore time is dominated by the maximum of <math alttext="IO_{hidden}" class="ltx_Math" display="inline" id="S3.SS2.p2.5.m2.1"><semantics id="S3.SS2.p2.5.m2.1a"><mrow id="S3.SS2.p2.5.m2.1.1" xref="S3.SS2.p2.5.m2.1.1.cmml"><mi id="S3.SS2.p2.5.m2.1.1.2" xref="S3.SS2.p2.5.m2.1.1.2.cmml">I</mi><mo id="S3.SS2.p2.5.m2.1.1.1" xref="S3.SS2.p2.5.m2.1.1.1.cmml">⁢</mo><msub id="S3.SS2.p2.5.m2.1.1.3" xref="S3.SS2.p2.5.m2.1.1.3.cmml"><mi id="S3.SS2.p2.5.m2.1.1.3.2" xref="S3.SS2.p2.5.m2.1.1.3.2.cmml">O</mi><mrow id="S3.SS2.p2.5.m2.1.1.3.3" xref="S3.SS2.p2.5.m2.1.1.3.3.cmml"><mi id="S3.SS2.p2.5.m2.1.1.3.3.2" xref="S3.SS2.p2.5.m2.1.1.3.3.2.cmml">h</mi><mo id="S3.SS2.p2.5.m2.1.1.3.3.1" xref="S3.SS2.p2.5.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m2.1.1.3.3.3" xref="S3.SS2.p2.5.m2.1.1.3.3.3.cmml">i</mi><mo id="S3.SS2.p2.5.m2.1.1.3.3.1a" xref="S3.SS2.p2.5.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m2.1.1.3.3.4" xref="S3.SS2.p2.5.m2.1.1.3.3.4.cmml">d</mi><mo id="S3.SS2.p2.5.m2.1.1.3.3.1b" xref="S3.SS2.p2.5.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m2.1.1.3.3.5" xref="S3.SS2.p2.5.m2.1.1.3.3.5.cmml">d</mi><mo id="S3.SS2.p2.5.m2.1.1.3.3.1c" xref="S3.SS2.p2.5.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m2.1.1.3.3.6" xref="S3.SS2.p2.5.m2.1.1.3.3.6.cmml">e</mi><mo id="S3.SS2.p2.5.m2.1.1.3.3.1d" xref="S3.SS2.p2.5.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m2.1.1.3.3.7" xref="S3.SS2.p2.5.m2.1.1.3.3.7.cmml">n</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.5.m2.1b"><apply id="S3.SS2.p2.5.m2.1.1.cmml" xref="S3.SS2.p2.5.m2.1.1"><times id="S3.SS2.p2.5.m2.1.1.1.cmml" xref="S3.SS2.p2.5.m2.1.1.1"></times><ci id="S3.SS2.p2.5.m2.1.1.2.cmml" xref="S3.SS2.p2.5.m2.1.1.2">𝐼</ci><apply id="S3.SS2.p2.5.m2.1.1.3.cmml" xref="S3.SS2.p2.5.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m2.1.1.3.1.cmml" xref="S3.SS2.p2.5.m2.1.1.3">subscript</csymbol><ci id="S3.SS2.p2.5.m2.1.1.3.2.cmml" xref="S3.SS2.p2.5.m2.1.1.3.2">𝑂</ci><apply id="S3.SS2.p2.5.m2.1.1.3.3.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3"><times id="S3.SS2.p2.5.m2.1.1.3.3.1.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.1"></times><ci id="S3.SS2.p2.5.m2.1.1.3.3.2.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.2">ℎ</ci><ci id="S3.SS2.p2.5.m2.1.1.3.3.3.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.3">𝑖</ci><ci id="S3.SS2.p2.5.m2.1.1.3.3.4.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.4">𝑑</ci><ci id="S3.SS2.p2.5.m2.1.1.3.3.5.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.5">𝑑</ci><ci id="S3.SS2.p2.5.m2.1.1.3.3.6.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.6">𝑒</ci><ci id="S3.SS2.p2.5.m2.1.1.3.3.7.cmml" xref="S3.SS2.p2.5.m2.1.1.3.3.7">𝑛</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.5.m2.1c">IO_{hidden}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.5.m2.1d">italic_I italic_O start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="C_{hidden}" class="ltx_Math" display="inline" id="S3.SS2.p2.6.m3.1"><semantics id="S3.SS2.p2.6.m3.1a"><msub id="S3.SS2.p2.6.m3.1.1" xref="S3.SS2.p2.6.m3.1.1.cmml"><mi id="S3.SS2.p2.6.m3.1.1.2" xref="S3.SS2.p2.6.m3.1.1.2.cmml">C</mi><mrow id="S3.SS2.p2.6.m3.1.1.3" xref="S3.SS2.p2.6.m3.1.1.3.cmml"><mi id="S3.SS2.p2.6.m3.1.1.3.2" xref="S3.SS2.p2.6.m3.1.1.3.2.cmml">h</mi><mo id="S3.SS2.p2.6.m3.1.1.3.1" xref="S3.SS2.p2.6.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m3.1.1.3.3" xref="S3.SS2.p2.6.m3.1.1.3.3.cmml">i</mi><mo id="S3.SS2.p2.6.m3.1.1.3.1a" xref="S3.SS2.p2.6.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m3.1.1.3.4" xref="S3.SS2.p2.6.m3.1.1.3.4.cmml">d</mi><mo id="S3.SS2.p2.6.m3.1.1.3.1b" xref="S3.SS2.p2.6.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m3.1.1.3.5" xref="S3.SS2.p2.6.m3.1.1.3.5.cmml">d</mi><mo id="S3.SS2.p2.6.m3.1.1.3.1c" xref="S3.SS2.p2.6.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m3.1.1.3.6" xref="S3.SS2.p2.6.m3.1.1.3.6.cmml">e</mi><mo id="S3.SS2.p2.6.m3.1.1.3.1d" xref="S3.SS2.p2.6.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.6.m3.1.1.3.7" xref="S3.SS2.p2.6.m3.1.1.3.7.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.6.m3.1b"><apply id="S3.SS2.p2.6.m3.1.1.cmml" xref="S3.SS2.p2.6.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.6.m3.1.1.1.cmml" xref="S3.SS2.p2.6.m3.1.1">subscript</csymbol><ci id="S3.SS2.p2.6.m3.1.1.2.cmml" xref="S3.SS2.p2.6.m3.1.1.2">𝐶</ci><apply id="S3.SS2.p2.6.m3.1.1.3.cmml" xref="S3.SS2.p2.6.m3.1.1.3"><times id="S3.SS2.p2.6.m3.1.1.3.1.cmml" xref="S3.SS2.p2.6.m3.1.1.3.1"></times><ci id="S3.SS2.p2.6.m3.1.1.3.2.cmml" xref="S3.SS2.p2.6.m3.1.1.3.2">ℎ</ci><ci id="S3.SS2.p2.6.m3.1.1.3.3.cmml" xref="S3.SS2.p2.6.m3.1.1.3.3">𝑖</ci><ci id="S3.SS2.p2.6.m3.1.1.3.4.cmml" xref="S3.SS2.p2.6.m3.1.1.3.4">𝑑</ci><ci id="S3.SS2.p2.6.m3.1.1.3.5.cmml" xref="S3.SS2.p2.6.m3.1.1.3.5">𝑑</ci><ci id="S3.SS2.p2.6.m3.1.1.3.6.cmml" xref="S3.SS2.p2.6.m3.1.1.3.6">𝑒</ci><ci id="S3.SS2.p2.6.m3.1.1.3.7.cmml" xref="S3.SS2.p2.6.m3.1.1.3.7">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.6.m3.1c">C_{hidden}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.6.m3.1d">italic_C start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT</annotation></semantics></math>. Hence,
the state restoration time of <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p2.6.1">HCache</span> is:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="T_{hidden}=max(IO_{hidden},C_{hidden})." class="ltx_Math" display="block" id="S3.Ex6.m1.1"><semantics id="S3.Ex6.m1.1a"><mrow id="S3.Ex6.m1.1.1.1" xref="S3.Ex6.m1.1.1.1.1.cmml"><mrow id="S3.Ex6.m1.1.1.1.1" xref="S3.Ex6.m1.1.1.1.1.cmml"><msub id="S3.Ex6.m1.1.1.1.1.4" xref="S3.Ex6.m1.1.1.1.1.4.cmml"><mi id="S3.Ex6.m1.1.1.1.1.4.2" xref="S3.Ex6.m1.1.1.1.1.4.2.cmml">T</mi><mrow id="S3.Ex6.m1.1.1.1.1.4.3" xref="S3.Ex6.m1.1.1.1.1.4.3.cmml"><mi id="S3.Ex6.m1.1.1.1.1.4.3.2" xref="S3.Ex6.m1.1.1.1.1.4.3.2.cmml">h</mi><mo id="S3.Ex6.m1.1.1.1.1.4.3.1" xref="S3.Ex6.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.4.3.3" xref="S3.Ex6.m1.1.1.1.1.4.3.3.cmml">i</mi><mo id="S3.Ex6.m1.1.1.1.1.4.3.1a" xref="S3.Ex6.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.4.3.4" xref="S3.Ex6.m1.1.1.1.1.4.3.4.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.4.3.1b" xref="S3.Ex6.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.4.3.5" xref="S3.Ex6.m1.1.1.1.1.4.3.5.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.4.3.1c" xref="S3.Ex6.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.4.3.6" xref="S3.Ex6.m1.1.1.1.1.4.3.6.cmml">e</mi><mo id="S3.Ex6.m1.1.1.1.1.4.3.1d" xref="S3.Ex6.m1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.4.3.7" xref="S3.Ex6.m1.1.1.1.1.4.3.7.cmml">n</mi></mrow></msub><mo id="S3.Ex6.m1.1.1.1.1.3" xref="S3.Ex6.m1.1.1.1.1.3.cmml">=</mo><mrow id="S3.Ex6.m1.1.1.1.1.2" xref="S3.Ex6.m1.1.1.1.1.2.cmml"><mi id="S3.Ex6.m1.1.1.1.1.2.4" xref="S3.Ex6.m1.1.1.1.1.2.4.cmml">m</mi><mo id="S3.Ex6.m1.1.1.1.1.2.3" xref="S3.Ex6.m1.1.1.1.1.2.3.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.5" xref="S3.Ex6.m1.1.1.1.1.2.5.cmml">a</mi><mo id="S3.Ex6.m1.1.1.1.1.2.3a" xref="S3.Ex6.m1.1.1.1.1.2.3.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.6" xref="S3.Ex6.m1.1.1.1.1.2.6.cmml">x</mi><mo id="S3.Ex6.m1.1.1.1.1.2.3b" xref="S3.Ex6.m1.1.1.1.1.2.3.cmml">⁢</mo><mrow id="S3.Ex6.m1.1.1.1.1.2.2.2" xref="S3.Ex6.m1.1.1.1.1.2.2.3.cmml"><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.3" stretchy="false" xref="S3.Ex6.m1.1.1.1.1.2.2.3.cmml">(</mo><mrow id="S3.Ex6.m1.1.1.1.1.1.1.1.1" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.2" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.2.cmml">I</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.1" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><msub id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.2" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.2.cmml">O</mi><mrow id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.2" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.2.cmml">h</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.3" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.3.cmml">i</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1a" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.4" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.4.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1b" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.5" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.5.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1c" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.6" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.6.cmml">e</mi><mo id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1d" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.7" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.7.cmml">n</mi></mrow></msub></mrow><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.4" xref="S3.Ex6.m1.1.1.1.1.2.2.3.cmml">,</mo><msub id="S3.Ex6.m1.1.1.1.1.2.2.2.2" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.cmml"><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.2" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.2.cmml">C</mi><mrow id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.cmml"><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.2" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.2.cmml">h</mi><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.3" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.3.cmml">i</mi><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1a" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.4" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.4.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1b" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.5" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.5.cmml">d</mi><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1c" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.6" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.6.cmml">e</mi><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1d" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.7" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.7.cmml">n</mi></mrow></msub><mo id="S3.Ex6.m1.1.1.1.1.2.2.2.5" stretchy="false" xref="S3.Ex6.m1.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S3.Ex6.m1.1.1.1.2" lspace="0em" xref="S3.Ex6.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex6.m1.1b"><apply id="S3.Ex6.m1.1.1.1.1.cmml" xref="S3.Ex6.m1.1.1.1"><eq id="S3.Ex6.m1.1.1.1.1.3.cmml" xref="S3.Ex6.m1.1.1.1.1.3"></eq><apply id="S3.Ex6.m1.1.1.1.1.4.cmml" xref="S3.Ex6.m1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.Ex6.m1.1.1.1.1.4.1.cmml" xref="S3.Ex6.m1.1.1.1.1.4">subscript</csymbol><ci id="S3.Ex6.m1.1.1.1.1.4.2.cmml" xref="S3.Ex6.m1.1.1.1.1.4.2">𝑇</ci><apply id="S3.Ex6.m1.1.1.1.1.4.3.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3"><times id="S3.Ex6.m1.1.1.1.1.4.3.1.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.1"></times><ci id="S3.Ex6.m1.1.1.1.1.4.3.2.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.2">ℎ</ci><ci id="S3.Ex6.m1.1.1.1.1.4.3.3.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.3">𝑖</ci><ci id="S3.Ex6.m1.1.1.1.1.4.3.4.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.4">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.4.3.5.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.5">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.4.3.6.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.6">𝑒</ci><ci id="S3.Ex6.m1.1.1.1.1.4.3.7.cmml" xref="S3.Ex6.m1.1.1.1.1.4.3.7">𝑛</ci></apply></apply><apply id="S3.Ex6.m1.1.1.1.1.2.cmml" xref="S3.Ex6.m1.1.1.1.1.2"><times id="S3.Ex6.m1.1.1.1.1.2.3.cmml" xref="S3.Ex6.m1.1.1.1.1.2.3"></times><ci id="S3.Ex6.m1.1.1.1.1.2.4.cmml" xref="S3.Ex6.m1.1.1.1.1.2.4">𝑚</ci><ci id="S3.Ex6.m1.1.1.1.1.2.5.cmml" xref="S3.Ex6.m1.1.1.1.1.2.5">𝑎</ci><ci id="S3.Ex6.m1.1.1.1.1.2.6.cmml" xref="S3.Ex6.m1.1.1.1.1.2.6">𝑥</ci><interval closure="open" id="S3.Ex6.m1.1.1.1.1.2.2.3.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2"><apply id="S3.Ex6.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1"><times id="S3.Ex6.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.1"></times><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.2">𝐼</ci><apply id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.2">𝑂</ci><apply id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3"><times id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.1"></times><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.2">ℎ</ci><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.3.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.3">𝑖</ci><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.4.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.4">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.5.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.5">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.6.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.6">𝑒</ci><ci id="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.7.cmml" xref="S3.Ex6.m1.1.1.1.1.1.1.1.1.3.3.7">𝑛</ci></apply></apply></apply><apply id="S3.Ex6.m1.1.1.1.1.2.2.2.2.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S3.Ex6.m1.1.1.1.1.2.2.2.2.1.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2">subscript</csymbol><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.2">𝐶</ci><apply id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3"><times id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.1"></times><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.2.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.2">ℎ</ci><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.3.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.3">𝑖</ci><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.4.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.4">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.5.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.5">𝑑</ci><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.6.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.6">𝑒</ci><ci id="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.7.cmml" xref="S3.Ex6.m1.1.1.1.1.2.2.2.2.3.7">𝑛</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex6.m1.1c">T_{hidden}=max(IO_{hidden},C_{hidden}).</annotation><annotation encoding="application/x-llamapun" id="S3.Ex6.m1.1d">italic_T start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT = italic_m italic_a italic_x ( italic_I italic_O start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT , italic_C start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p3.1.1">Restoration time with KV offload</span>. The restoration process of KV offload only involves
transferring the <span class="ltx_text" id="S3.SS2.p3.1.2">KV cache</span> from the host to GPU memory, whose time is:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="T_{kv}=IO_{KV}=\frac{2*N_{seq}*D_{hidden}}{BW}." class="ltx_Math" display="block" id="S3.Ex7.m1.1"><semantics id="S3.Ex7.m1.1a"><mrow id="S3.Ex7.m1.1.1.1" xref="S3.Ex7.m1.1.1.1.1.cmml"><mrow id="S3.Ex7.m1.1.1.1.1" xref="S3.Ex7.m1.1.1.1.1.cmml"><msub id="S3.Ex7.m1.1.1.1.1.2" xref="S3.Ex7.m1.1.1.1.1.2.cmml"><mi id="S3.Ex7.m1.1.1.1.1.2.2" xref="S3.Ex7.m1.1.1.1.1.2.2.cmml">T</mi><mrow id="S3.Ex7.m1.1.1.1.1.2.3" xref="S3.Ex7.m1.1.1.1.1.2.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.2.3.2" xref="S3.Ex7.m1.1.1.1.1.2.3.2.cmml">k</mi><mo id="S3.Ex7.m1.1.1.1.1.2.3.1" xref="S3.Ex7.m1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.2.3.3" xref="S3.Ex7.m1.1.1.1.1.2.3.3.cmml">v</mi></mrow></msub><mo id="S3.Ex7.m1.1.1.1.1.3" xref="S3.Ex7.m1.1.1.1.1.3.cmml">=</mo><mrow id="S3.Ex7.m1.1.1.1.1.4" xref="S3.Ex7.m1.1.1.1.1.4.cmml"><mi id="S3.Ex7.m1.1.1.1.1.4.2" xref="S3.Ex7.m1.1.1.1.1.4.2.cmml">I</mi><mo id="S3.Ex7.m1.1.1.1.1.4.1" xref="S3.Ex7.m1.1.1.1.1.4.1.cmml">⁢</mo><msub id="S3.Ex7.m1.1.1.1.1.4.3" xref="S3.Ex7.m1.1.1.1.1.4.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.4.3.2" xref="S3.Ex7.m1.1.1.1.1.4.3.2.cmml">O</mi><mrow id="S3.Ex7.m1.1.1.1.1.4.3.3" xref="S3.Ex7.m1.1.1.1.1.4.3.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.4.3.3.2" xref="S3.Ex7.m1.1.1.1.1.4.3.3.2.cmml">K</mi><mo id="S3.Ex7.m1.1.1.1.1.4.3.3.1" xref="S3.Ex7.m1.1.1.1.1.4.3.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.4.3.3.3" xref="S3.Ex7.m1.1.1.1.1.4.3.3.3.cmml">V</mi></mrow></msub></mrow><mo id="S3.Ex7.m1.1.1.1.1.5" xref="S3.Ex7.m1.1.1.1.1.5.cmml">=</mo><mfrac id="S3.Ex7.m1.1.1.1.1.6" xref="S3.Ex7.m1.1.1.1.1.6.cmml"><mrow id="S3.Ex7.m1.1.1.1.1.6.2" xref="S3.Ex7.m1.1.1.1.1.6.2.cmml"><mn id="S3.Ex7.m1.1.1.1.1.6.2.2" xref="S3.Ex7.m1.1.1.1.1.6.2.2.cmml">2</mn><mo id="S3.Ex7.m1.1.1.1.1.6.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex7.m1.1.1.1.1.6.2.1.cmml">∗</mo><msub id="S3.Ex7.m1.1.1.1.1.6.2.3" xref="S3.Ex7.m1.1.1.1.1.6.2.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.6.2.3.2" xref="S3.Ex7.m1.1.1.1.1.6.2.3.2.cmml">N</mi><mrow id="S3.Ex7.m1.1.1.1.1.6.2.3.3" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.6.2.3.3.2" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.2.cmml">s</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.3.3.1" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.3.3.3" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.3.cmml">e</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.3.3.1a" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.3.3.4" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex7.m1.1.1.1.1.6.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex7.m1.1.1.1.1.6.2.1.cmml">∗</mo><msub id="S3.Ex7.m1.1.1.1.1.6.2.4" xref="S3.Ex7.m1.1.1.1.1.6.2.4.cmml"><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.2" xref="S3.Ex7.m1.1.1.1.1.6.2.4.2.cmml">D</mi><mrow id="S3.Ex7.m1.1.1.1.1.6.2.4.3" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.2" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.2.cmml">h</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.3" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.3.cmml">i</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1a" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.4" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.4.cmml">d</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1b" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.5" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.5.cmml">d</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1c" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.6" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.6.cmml">e</mi><mo id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1d" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.2.4.3.7" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.7.cmml">n</mi></mrow></msub></mrow><mrow id="S3.Ex7.m1.1.1.1.1.6.3" xref="S3.Ex7.m1.1.1.1.1.6.3.cmml"><mi id="S3.Ex7.m1.1.1.1.1.6.3.2" xref="S3.Ex7.m1.1.1.1.1.6.3.2.cmml">B</mi><mo id="S3.Ex7.m1.1.1.1.1.6.3.1" xref="S3.Ex7.m1.1.1.1.1.6.3.1.cmml">⁢</mo><mi id="S3.Ex7.m1.1.1.1.1.6.3.3" xref="S3.Ex7.m1.1.1.1.1.6.3.3.cmml">W</mi></mrow></mfrac></mrow><mo id="S3.Ex7.m1.1.1.1.2" lspace="0em" xref="S3.Ex7.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex7.m1.1b"><apply id="S3.Ex7.m1.1.1.1.1.cmml" xref="S3.Ex7.m1.1.1.1"><and id="S3.Ex7.m1.1.1.1.1a.cmml" xref="S3.Ex7.m1.1.1.1"></and><apply id="S3.Ex7.m1.1.1.1.1b.cmml" xref="S3.Ex7.m1.1.1.1"><eq id="S3.Ex7.m1.1.1.1.1.3.cmml" xref="S3.Ex7.m1.1.1.1.1.3"></eq><apply id="S3.Ex7.m1.1.1.1.1.2.cmml" xref="S3.Ex7.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex7.m1.1.1.1.1.2.1.cmml" xref="S3.Ex7.m1.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex7.m1.1.1.1.1.2.2.cmml" xref="S3.Ex7.m1.1.1.1.1.2.2">𝑇</ci><apply id="S3.Ex7.m1.1.1.1.1.2.3.cmml" xref="S3.Ex7.m1.1.1.1.1.2.3"><times id="S3.Ex7.m1.1.1.1.1.2.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.2.3.1"></times><ci id="S3.Ex7.m1.1.1.1.1.2.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.2.3.2">𝑘</ci><ci id="S3.Ex7.m1.1.1.1.1.2.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.2.3.3">𝑣</ci></apply></apply><apply id="S3.Ex7.m1.1.1.1.1.4.cmml" xref="S3.Ex7.m1.1.1.1.1.4"><times id="S3.Ex7.m1.1.1.1.1.4.1.cmml" xref="S3.Ex7.m1.1.1.1.1.4.1"></times><ci id="S3.Ex7.m1.1.1.1.1.4.2.cmml" xref="S3.Ex7.m1.1.1.1.1.4.2">𝐼</ci><apply id="S3.Ex7.m1.1.1.1.1.4.3.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3"><csymbol cd="ambiguous" id="S3.Ex7.m1.1.1.1.1.4.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3">subscript</csymbol><ci id="S3.Ex7.m1.1.1.1.1.4.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3.2">𝑂</ci><apply id="S3.Ex7.m1.1.1.1.1.4.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3.3"><times id="S3.Ex7.m1.1.1.1.1.4.3.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3.3.1"></times><ci id="S3.Ex7.m1.1.1.1.1.4.3.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3.3.2">𝐾</ci><ci id="S3.Ex7.m1.1.1.1.1.4.3.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.4.3.3.3">𝑉</ci></apply></apply></apply></apply><apply id="S3.Ex7.m1.1.1.1.1c.cmml" xref="S3.Ex7.m1.1.1.1"><eq id="S3.Ex7.m1.1.1.1.1.5.cmml" xref="S3.Ex7.m1.1.1.1.1.5"></eq><share href="https://arxiv.org/html/2410.05004v1#S3.Ex7.m1.1.1.1.1.4.cmml" id="S3.Ex7.m1.1.1.1.1d.cmml" xref="S3.Ex7.m1.1.1.1"></share><apply id="S3.Ex7.m1.1.1.1.1.6.cmml" xref="S3.Ex7.m1.1.1.1.1.6"><divide id="S3.Ex7.m1.1.1.1.1.6.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6"></divide><apply id="S3.Ex7.m1.1.1.1.1.6.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2"><times id="S3.Ex7.m1.1.1.1.1.6.2.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.1"></times><cn id="S3.Ex7.m1.1.1.1.1.6.2.2.cmml" type="integer" xref="S3.Ex7.m1.1.1.1.1.6.2.2">2</cn><apply id="S3.Ex7.m1.1.1.1.1.6.2.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3"><csymbol cd="ambiguous" id="S3.Ex7.m1.1.1.1.1.6.2.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3">subscript</csymbol><ci id="S3.Ex7.m1.1.1.1.1.6.2.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.2">𝑁</ci><apply id="S3.Ex7.m1.1.1.1.1.6.2.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3"><times id="S3.Ex7.m1.1.1.1.1.6.2.3.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.1"></times><ci id="S3.Ex7.m1.1.1.1.1.6.2.3.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.2">𝑠</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.3.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.3">𝑒</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.3.3.4.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex7.m1.1.1.1.1.6.2.4.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4"><csymbol cd="ambiguous" id="S3.Ex7.m1.1.1.1.1.6.2.4.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4">subscript</csymbol><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.2">𝐷</ci><apply id="S3.Ex7.m1.1.1.1.1.6.2.4.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3"><times id="S3.Ex7.m1.1.1.1.1.6.2.4.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.1"></times><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.2">ℎ</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.3">𝑖</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.4.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.4">𝑑</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.5.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.5">𝑑</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.6.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.6">𝑒</ci><ci id="S3.Ex7.m1.1.1.1.1.6.2.4.3.7.cmml" xref="S3.Ex7.m1.1.1.1.1.6.2.4.3.7">𝑛</ci></apply></apply></apply><apply id="S3.Ex7.m1.1.1.1.1.6.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.3"><times id="S3.Ex7.m1.1.1.1.1.6.3.1.cmml" xref="S3.Ex7.m1.1.1.1.1.6.3.1"></times><ci id="S3.Ex7.m1.1.1.1.1.6.3.2.cmml" xref="S3.Ex7.m1.1.1.1.1.6.3.2">𝐵</ci><ci id="S3.Ex7.m1.1.1.1.1.6.3.3.cmml" xref="S3.Ex7.m1.1.1.1.1.6.3.3">𝑊</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex7.m1.1c">T_{kv}=IO_{KV}=\frac{2*N_{seq}*D_{hidden}}{BW}.</annotation><annotation encoding="application/x-llamapun" id="S3.Ex7.m1.1d">italic_T start_POSTSUBSCRIPT italic_k italic_v end_POSTSUBSCRIPT = italic_I italic_O start_POSTSUBSCRIPT italic_K italic_V end_POSTSUBSCRIPT = divide start_ARG 2 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_B italic_W end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.3"><span class="ltx_text ltx_font_bold" id="S3.SS2.p4.3.1">Restoration time with recomputation.</span>
The restoration process of recomputation involves a full computation from history tokens to their <span class="ltx_text" id="S3.SS2.p4.3.2">KV cache</span>s.
We ignore the time required to transfer tokens to GPU since their size is small.</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="Sx1.EGx1">
<tbody id="S3.Ex8"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle C_{attn}" class="ltx_Math" display="inline" id="S3.Ex8.m1.1"><semantics id="S3.Ex8.m1.1a"><msub id="S3.Ex8.m1.1.1" xref="S3.Ex8.m1.1.1.cmml"><mi id="S3.Ex8.m1.1.1.2" xref="S3.Ex8.m1.1.1.2.cmml">C</mi><mrow id="S3.Ex8.m1.1.1.3" xref="S3.Ex8.m1.1.1.3.cmml"><mi id="S3.Ex8.m1.1.1.3.2" xref="S3.Ex8.m1.1.1.3.2.cmml">a</mi><mo id="S3.Ex8.m1.1.1.3.1" xref="S3.Ex8.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex8.m1.1.1.3.3" xref="S3.Ex8.m1.1.1.3.3.cmml">t</mi><mo id="S3.Ex8.m1.1.1.3.1a" xref="S3.Ex8.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex8.m1.1.1.3.4" xref="S3.Ex8.m1.1.1.3.4.cmml">t</mi><mo id="S3.Ex8.m1.1.1.3.1b" xref="S3.Ex8.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex8.m1.1.1.3.5" xref="S3.Ex8.m1.1.1.3.5.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.Ex8.m1.1b"><apply id="S3.Ex8.m1.1.1.cmml" xref="S3.Ex8.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex8.m1.1.1.1.cmml" xref="S3.Ex8.m1.1.1">subscript</csymbol><ci id="S3.Ex8.m1.1.1.2.cmml" xref="S3.Ex8.m1.1.1.2">𝐶</ci><apply id="S3.Ex8.m1.1.1.3.cmml" xref="S3.Ex8.m1.1.1.3"><times id="S3.Ex8.m1.1.1.3.1.cmml" xref="S3.Ex8.m1.1.1.3.1"></times><ci id="S3.Ex8.m1.1.1.3.2.cmml" xref="S3.Ex8.m1.1.1.3.2">𝑎</ci><ci id="S3.Ex8.m1.1.1.3.3.cmml" xref="S3.Ex8.m1.1.1.3.3">𝑡</ci><ci id="S3.Ex8.m1.1.1.3.4.cmml" xref="S3.Ex8.m1.1.1.3.4">𝑡</ci><ci id="S3.Ex8.m1.1.1.3.5.cmml" xref="S3.Ex8.m1.1.1.3.5">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex8.m1.1c">\displaystyle C_{attn}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex8.m1.1d">italic_C start_POSTSUBSCRIPT italic_a italic_t italic_t italic_n end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{8*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{FLOPS}" class="ltx_Math" display="inline" id="S3.Ex8.m2.1"><semantics id="S3.Ex8.m2.1a"><mrow id="S3.Ex8.m2.1.1" xref="S3.Ex8.m2.1.1.cmml"><mi id="S3.Ex8.m2.1.1.2" xref="S3.Ex8.m2.1.1.2.cmml"></mi><mo id="S3.Ex8.m2.1.1.1" xref="S3.Ex8.m2.1.1.1.cmml">=</mo><mstyle displaystyle="true" id="S3.Ex8.m2.1.1.3" xref="S3.Ex8.m2.1.1.3.cmml"><mfrac id="S3.Ex8.m2.1.1.3a" xref="S3.Ex8.m2.1.1.3.cmml"><mrow id="S3.Ex8.m2.1.1.3.2" xref="S3.Ex8.m2.1.1.3.2.cmml"><mrow id="S3.Ex8.m2.1.1.3.2.2" xref="S3.Ex8.m2.1.1.3.2.2.cmml"><mn id="S3.Ex8.m2.1.1.3.2.2.2" xref="S3.Ex8.m2.1.1.3.2.2.2.cmml">8</mn><mo id="S3.Ex8.m2.1.1.3.2.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex8.m2.1.1.3.2.2.1.cmml">∗</mo><msub id="S3.Ex8.m2.1.1.3.2.2.3" xref="S3.Ex8.m2.1.1.3.2.2.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.2.3.2" xref="S3.Ex8.m2.1.1.3.2.2.3.2.cmml">N</mi><mrow id="S3.Ex8.m2.1.1.3.2.2.3.3" xref="S3.Ex8.m2.1.1.3.2.2.3.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.2.3.3.2" xref="S3.Ex8.m2.1.1.3.2.2.3.3.2.cmml">s</mi><mo id="S3.Ex8.m2.1.1.3.2.2.3.3.1" xref="S3.Ex8.m2.1.1.3.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.3.3.3" xref="S3.Ex8.m2.1.1.3.2.2.3.3.3.cmml">e</mi><mo id="S3.Ex8.m2.1.1.3.2.2.3.3.1a" xref="S3.Ex8.m2.1.1.3.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.3.3.4" xref="S3.Ex8.m2.1.1.3.2.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex8.m2.1.1.3.2.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex8.m2.1.1.3.2.2.1.cmml">∗</mo><msubsup id="S3.Ex8.m2.1.1.3.2.2.4" xref="S3.Ex8.m2.1.1.3.2.2.4.cmml"><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.2" xref="S3.Ex8.m2.1.1.3.2.2.4.2.2.cmml">D</mi><mrow id="S3.Ex8.m2.1.1.3.2.2.4.2.3" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.2" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.2.cmml">h</mi><mo id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.3" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.3.cmml">i</mi><mo id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1a" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.4" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.4.cmml">d</mi><mo id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1b" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.5" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.5.cmml">d</mi><mo id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1c" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.6" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.6.cmml">e</mi><mo id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1d" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.2.4.2.3.7" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.7.cmml">n</mi></mrow><mn id="S3.Ex8.m2.1.1.3.2.2.4.3" xref="S3.Ex8.m2.1.1.3.2.2.4.3.cmml">2</mn></msubsup></mrow><mo id="S3.Ex8.m2.1.1.3.2.1" xref="S3.Ex8.m2.1.1.3.2.1.cmml">+</mo><mrow id="S3.Ex8.m2.1.1.3.2.3" xref="S3.Ex8.m2.1.1.3.2.3.cmml"><msubsup id="S3.Ex8.m2.1.1.3.2.3.2" xref="S3.Ex8.m2.1.1.3.2.3.2.cmml"><mi id="S3.Ex8.m2.1.1.3.2.3.2.2.2" xref="S3.Ex8.m2.1.1.3.2.3.2.2.2.cmml">N</mi><mrow id="S3.Ex8.m2.1.1.3.2.3.2.2.3" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.3.2.2.3.2" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.2.cmml">s</mi><mo id="S3.Ex8.m2.1.1.3.2.3.2.2.3.1" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.2.2.3.3" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.3.cmml">e</mi><mo id="S3.Ex8.m2.1.1.3.2.3.2.2.3.1a" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.2.2.3.4" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.4.cmml">q</mi></mrow><mn id="S3.Ex8.m2.1.1.3.2.3.2.3" xref="S3.Ex8.m2.1.1.3.2.3.2.3.cmml">2</mn></msubsup><mo id="S3.Ex8.m2.1.1.3.2.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex8.m2.1.1.3.2.3.1.cmml">∗</mo><msub id="S3.Ex8.m2.1.1.3.2.3.3" xref="S3.Ex8.m2.1.1.3.2.3.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.3.3.2" xref="S3.Ex8.m2.1.1.3.2.3.3.2.cmml">D</mi><mrow id="S3.Ex8.m2.1.1.3.2.3.3.3" xref="S3.Ex8.m2.1.1.3.2.3.3.3.cmml"><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.2" xref="S3.Ex8.m2.1.1.3.2.3.3.3.2.cmml">h</mi><mo id="S3.Ex8.m2.1.1.3.2.3.3.3.1" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.3" xref="S3.Ex8.m2.1.1.3.2.3.3.3.3.cmml">i</mi><mo id="S3.Ex8.m2.1.1.3.2.3.3.3.1a" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.4" xref="S3.Ex8.m2.1.1.3.2.3.3.3.4.cmml">d</mi><mo id="S3.Ex8.m2.1.1.3.2.3.3.3.1b" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.5" xref="S3.Ex8.m2.1.1.3.2.3.3.3.5.cmml">d</mi><mo id="S3.Ex8.m2.1.1.3.2.3.3.3.1c" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.6" xref="S3.Ex8.m2.1.1.3.2.3.3.3.6.cmml">e</mi><mo id="S3.Ex8.m2.1.1.3.2.3.3.3.1d" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.2.3.3.3.7" xref="S3.Ex8.m2.1.1.3.2.3.3.3.7.cmml">n</mi></mrow></msub></mrow></mrow><mrow id="S3.Ex8.m2.1.1.3.3" xref="S3.Ex8.m2.1.1.3.3.cmml"><mi id="S3.Ex8.m2.1.1.3.3.2" xref="S3.Ex8.m2.1.1.3.3.2.cmml">F</mi><mo id="S3.Ex8.m2.1.1.3.3.1" xref="S3.Ex8.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.3.3" xref="S3.Ex8.m2.1.1.3.3.3.cmml">L</mi><mo id="S3.Ex8.m2.1.1.3.3.1a" xref="S3.Ex8.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.3.4" xref="S3.Ex8.m2.1.1.3.3.4.cmml">O</mi><mo id="S3.Ex8.m2.1.1.3.3.1b" xref="S3.Ex8.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.3.5" xref="S3.Ex8.m2.1.1.3.3.5.cmml">P</mi><mo id="S3.Ex8.m2.1.1.3.3.1c" xref="S3.Ex8.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex8.m2.1.1.3.3.6" xref="S3.Ex8.m2.1.1.3.3.6.cmml">S</mi></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex8.m2.1b"><apply id="S3.Ex8.m2.1.1.cmml" xref="S3.Ex8.m2.1.1"><eq id="S3.Ex8.m2.1.1.1.cmml" xref="S3.Ex8.m2.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex8.m2.1.1.2.cmml" xref="S3.Ex8.m2.1.1.2">absent</csymbol><apply id="S3.Ex8.m2.1.1.3.cmml" xref="S3.Ex8.m2.1.1.3"><divide id="S3.Ex8.m2.1.1.3.1.cmml" xref="S3.Ex8.m2.1.1.3"></divide><apply id="S3.Ex8.m2.1.1.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2"><plus id="S3.Ex8.m2.1.1.3.2.1.cmml" xref="S3.Ex8.m2.1.1.3.2.1"></plus><apply id="S3.Ex8.m2.1.1.3.2.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2"><times id="S3.Ex8.m2.1.1.3.2.2.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.1"></times><cn id="S3.Ex8.m2.1.1.3.2.2.2.cmml" type="integer" xref="S3.Ex8.m2.1.1.3.2.2.2">8</cn><apply id="S3.Ex8.m2.1.1.3.2.2.3.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.2.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3">subscript</csymbol><ci id="S3.Ex8.m2.1.1.3.2.2.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.2">𝑁</ci><apply id="S3.Ex8.m2.1.1.3.2.2.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.3"><times id="S3.Ex8.m2.1.1.3.2.2.3.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.3.1"></times><ci id="S3.Ex8.m2.1.1.3.2.2.3.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.3.2">𝑠</ci><ci id="S3.Ex8.m2.1.1.3.2.2.3.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.3.3">𝑒</ci><ci id="S3.Ex8.m2.1.1.3.2.2.3.3.4.cmml" xref="S3.Ex8.m2.1.1.3.2.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex8.m2.1.1.3.2.2.4.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.2.4.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4">superscript</csymbol><apply id="S3.Ex8.m2.1.1.3.2.2.4.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.2.4.2.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4">subscript</csymbol><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.2">𝐷</ci><apply id="S3.Ex8.m2.1.1.3.2.2.4.2.3.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3"><times id="S3.Ex8.m2.1.1.3.2.2.4.2.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.1"></times><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.2">ℎ</ci><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.3">𝑖</ci><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.4.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.4">𝑑</ci><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.5.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.5">𝑑</ci><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.6.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.6">𝑒</ci><ci id="S3.Ex8.m2.1.1.3.2.2.4.2.3.7.cmml" xref="S3.Ex8.m2.1.1.3.2.2.4.2.3.7">𝑛</ci></apply></apply><cn id="S3.Ex8.m2.1.1.3.2.2.4.3.cmml" type="integer" xref="S3.Ex8.m2.1.1.3.2.2.4.3">2</cn></apply></apply><apply id="S3.Ex8.m2.1.1.3.2.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3"><times id="S3.Ex8.m2.1.1.3.2.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.1"></times><apply id="S3.Ex8.m2.1.1.3.2.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.3.2.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2">superscript</csymbol><apply id="S3.Ex8.m2.1.1.3.2.3.2.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.3.2.2.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2">subscript</csymbol><ci id="S3.Ex8.m2.1.1.3.2.3.2.2.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.2">𝑁</ci><apply id="S3.Ex8.m2.1.1.3.2.3.2.2.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3"><times id="S3.Ex8.m2.1.1.3.2.3.2.2.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.1"></times><ci id="S3.Ex8.m2.1.1.3.2.3.2.2.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.2">𝑠</ci><ci id="S3.Ex8.m2.1.1.3.2.3.2.2.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.3">𝑒</ci><ci id="S3.Ex8.m2.1.1.3.2.3.2.2.3.4.cmml" xref="S3.Ex8.m2.1.1.3.2.3.2.2.3.4">𝑞</ci></apply></apply><cn id="S3.Ex8.m2.1.1.3.2.3.2.3.cmml" type="integer" xref="S3.Ex8.m2.1.1.3.2.3.2.3">2</cn></apply><apply id="S3.Ex8.m2.1.1.3.2.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S3.Ex8.m2.1.1.3.2.3.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3">subscript</csymbol><ci id="S3.Ex8.m2.1.1.3.2.3.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.2">𝐷</ci><apply id="S3.Ex8.m2.1.1.3.2.3.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3"><times id="S3.Ex8.m2.1.1.3.2.3.3.3.1.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.1"></times><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.2.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.2">ℎ</ci><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.3.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.3">𝑖</ci><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.4.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.4">𝑑</ci><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.5.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.5">𝑑</ci><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.6.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.6">𝑒</ci><ci id="S3.Ex8.m2.1.1.3.2.3.3.3.7.cmml" xref="S3.Ex8.m2.1.1.3.2.3.3.3.7">𝑛</ci></apply></apply></apply></apply><apply id="S3.Ex8.m2.1.1.3.3.cmml" xref="S3.Ex8.m2.1.1.3.3"><times id="S3.Ex8.m2.1.1.3.3.1.cmml" xref="S3.Ex8.m2.1.1.3.3.1"></times><ci id="S3.Ex8.m2.1.1.3.3.2.cmml" xref="S3.Ex8.m2.1.1.3.3.2">𝐹</ci><ci id="S3.Ex8.m2.1.1.3.3.3.cmml" xref="S3.Ex8.m2.1.1.3.3.3">𝐿</ci><ci id="S3.Ex8.m2.1.1.3.3.4.cmml" xref="S3.Ex8.m2.1.1.3.3.4">𝑂</ci><ci id="S3.Ex8.m2.1.1.3.3.5.cmml" xref="S3.Ex8.m2.1.1.3.3.5">𝑃</ci><ci id="S3.Ex8.m2.1.1.3.3.6.cmml" xref="S3.Ex8.m2.1.1.3.3.6">𝑆</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex8.m2.1c">\displaystyle=\frac{8*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{FLOPS}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex8.m2.1d">= divide start_ARG 8 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_F italic_L italic_O italic_P italic_S end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.Ex9"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle C_{ffn}" class="ltx_Math" display="inline" id="S3.Ex9.m1.1"><semantics id="S3.Ex9.m1.1a"><msub id="S3.Ex9.m1.1.1" xref="S3.Ex9.m1.1.1.cmml"><mi id="S3.Ex9.m1.1.1.2" xref="S3.Ex9.m1.1.1.2.cmml">C</mi><mrow id="S3.Ex9.m1.1.1.3" xref="S3.Ex9.m1.1.1.3.cmml"><mi id="S3.Ex9.m1.1.1.3.2" xref="S3.Ex9.m1.1.1.3.2.cmml">f</mi><mo id="S3.Ex9.m1.1.1.3.1" xref="S3.Ex9.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex9.m1.1.1.3.3" xref="S3.Ex9.m1.1.1.3.3.cmml">f</mi><mo id="S3.Ex9.m1.1.1.3.1a" xref="S3.Ex9.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex9.m1.1.1.3.4" xref="S3.Ex9.m1.1.1.3.4.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.Ex9.m1.1b"><apply id="S3.Ex9.m1.1.1.cmml" xref="S3.Ex9.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex9.m1.1.1.1.cmml" xref="S3.Ex9.m1.1.1">subscript</csymbol><ci id="S3.Ex9.m1.1.1.2.cmml" xref="S3.Ex9.m1.1.1.2">𝐶</ci><apply id="S3.Ex9.m1.1.1.3.cmml" xref="S3.Ex9.m1.1.1.3"><times id="S3.Ex9.m1.1.1.3.1.cmml" xref="S3.Ex9.m1.1.1.3.1"></times><ci id="S3.Ex9.m1.1.1.3.2.cmml" xref="S3.Ex9.m1.1.1.3.2">𝑓</ci><ci id="S3.Ex9.m1.1.1.3.3.cmml" xref="S3.Ex9.m1.1.1.3.3">𝑓</ci><ci id="S3.Ex9.m1.1.1.3.4.cmml" xref="S3.Ex9.m1.1.1.3.4">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex9.m1.1c">\displaystyle C_{ffn}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex9.m1.1d">italic_C start_POSTSUBSCRIPT italic_f italic_f italic_n end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{16*N_{seq}*D_{hidden}^{2}}{FLOPS}" class="ltx_Math" display="inline" id="S3.Ex9.m2.1"><semantics id="S3.Ex9.m2.1a"><mrow id="S3.Ex9.m2.1.1" xref="S3.Ex9.m2.1.1.cmml"><mi id="S3.Ex9.m2.1.1.2" xref="S3.Ex9.m2.1.1.2.cmml"></mi><mo id="S3.Ex9.m2.1.1.1" xref="S3.Ex9.m2.1.1.1.cmml">=</mo><mstyle displaystyle="true" id="S3.Ex9.m2.1.1.3" xref="S3.Ex9.m2.1.1.3.cmml"><mfrac id="S3.Ex9.m2.1.1.3a" xref="S3.Ex9.m2.1.1.3.cmml"><mrow id="S3.Ex9.m2.1.1.3.2" xref="S3.Ex9.m2.1.1.3.2.cmml"><mn id="S3.Ex9.m2.1.1.3.2.2" xref="S3.Ex9.m2.1.1.3.2.2.cmml">16</mn><mo id="S3.Ex9.m2.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex9.m2.1.1.3.2.1.cmml">∗</mo><msub id="S3.Ex9.m2.1.1.3.2.3" xref="S3.Ex9.m2.1.1.3.2.3.cmml"><mi id="S3.Ex9.m2.1.1.3.2.3.2" xref="S3.Ex9.m2.1.1.3.2.3.2.cmml">N</mi><mrow id="S3.Ex9.m2.1.1.3.2.3.3" xref="S3.Ex9.m2.1.1.3.2.3.3.cmml"><mi id="S3.Ex9.m2.1.1.3.2.3.3.2" xref="S3.Ex9.m2.1.1.3.2.3.3.2.cmml">s</mi><mo id="S3.Ex9.m2.1.1.3.2.3.3.1" xref="S3.Ex9.m2.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.3.3.3" xref="S3.Ex9.m2.1.1.3.2.3.3.3.cmml">e</mi><mo id="S3.Ex9.m2.1.1.3.2.3.3.1a" xref="S3.Ex9.m2.1.1.3.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.3.3.4" xref="S3.Ex9.m2.1.1.3.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex9.m2.1.1.3.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex9.m2.1.1.3.2.1.cmml">∗</mo><msubsup id="S3.Ex9.m2.1.1.3.2.4" xref="S3.Ex9.m2.1.1.3.2.4.cmml"><mi id="S3.Ex9.m2.1.1.3.2.4.2.2" xref="S3.Ex9.m2.1.1.3.2.4.2.2.cmml">D</mi><mrow id="S3.Ex9.m2.1.1.3.2.4.2.3" xref="S3.Ex9.m2.1.1.3.2.4.2.3.cmml"><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.2" xref="S3.Ex9.m2.1.1.3.2.4.2.3.2.cmml">h</mi><mo id="S3.Ex9.m2.1.1.3.2.4.2.3.1" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.3" xref="S3.Ex9.m2.1.1.3.2.4.2.3.3.cmml">i</mi><mo id="S3.Ex9.m2.1.1.3.2.4.2.3.1a" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.4" xref="S3.Ex9.m2.1.1.3.2.4.2.3.4.cmml">d</mi><mo id="S3.Ex9.m2.1.1.3.2.4.2.3.1b" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.5" xref="S3.Ex9.m2.1.1.3.2.4.2.3.5.cmml">d</mi><mo id="S3.Ex9.m2.1.1.3.2.4.2.3.1c" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.6" xref="S3.Ex9.m2.1.1.3.2.4.2.3.6.cmml">e</mi><mo id="S3.Ex9.m2.1.1.3.2.4.2.3.1d" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.2.4.2.3.7" xref="S3.Ex9.m2.1.1.3.2.4.2.3.7.cmml">n</mi></mrow><mn id="S3.Ex9.m2.1.1.3.2.4.3" xref="S3.Ex9.m2.1.1.3.2.4.3.cmml">2</mn></msubsup></mrow><mrow id="S3.Ex9.m2.1.1.3.3" xref="S3.Ex9.m2.1.1.3.3.cmml"><mi id="S3.Ex9.m2.1.1.3.3.2" xref="S3.Ex9.m2.1.1.3.3.2.cmml">F</mi><mo id="S3.Ex9.m2.1.1.3.3.1" xref="S3.Ex9.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.3.3" xref="S3.Ex9.m2.1.1.3.3.3.cmml">L</mi><mo id="S3.Ex9.m2.1.1.3.3.1a" xref="S3.Ex9.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.3.4" xref="S3.Ex9.m2.1.1.3.3.4.cmml">O</mi><mo id="S3.Ex9.m2.1.1.3.3.1b" xref="S3.Ex9.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.3.5" xref="S3.Ex9.m2.1.1.3.3.5.cmml">P</mi><mo id="S3.Ex9.m2.1.1.3.3.1c" xref="S3.Ex9.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S3.Ex9.m2.1.1.3.3.6" xref="S3.Ex9.m2.1.1.3.3.6.cmml">S</mi></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex9.m2.1b"><apply id="S3.Ex9.m2.1.1.cmml" xref="S3.Ex9.m2.1.1"><eq id="S3.Ex9.m2.1.1.1.cmml" xref="S3.Ex9.m2.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex9.m2.1.1.2.cmml" xref="S3.Ex9.m2.1.1.2">absent</csymbol><apply id="S3.Ex9.m2.1.1.3.cmml" xref="S3.Ex9.m2.1.1.3"><divide id="S3.Ex9.m2.1.1.3.1.cmml" xref="S3.Ex9.m2.1.1.3"></divide><apply id="S3.Ex9.m2.1.1.3.2.cmml" xref="S3.Ex9.m2.1.1.3.2"><times id="S3.Ex9.m2.1.1.3.2.1.cmml" xref="S3.Ex9.m2.1.1.3.2.1"></times><cn id="S3.Ex9.m2.1.1.3.2.2.cmml" type="integer" xref="S3.Ex9.m2.1.1.3.2.2">16</cn><apply id="S3.Ex9.m2.1.1.3.2.3.cmml" xref="S3.Ex9.m2.1.1.3.2.3"><csymbol cd="ambiguous" id="S3.Ex9.m2.1.1.3.2.3.1.cmml" xref="S3.Ex9.m2.1.1.3.2.3">subscript</csymbol><ci id="S3.Ex9.m2.1.1.3.2.3.2.cmml" xref="S3.Ex9.m2.1.1.3.2.3.2">𝑁</ci><apply id="S3.Ex9.m2.1.1.3.2.3.3.cmml" xref="S3.Ex9.m2.1.1.3.2.3.3"><times id="S3.Ex9.m2.1.1.3.2.3.3.1.cmml" xref="S3.Ex9.m2.1.1.3.2.3.3.1"></times><ci id="S3.Ex9.m2.1.1.3.2.3.3.2.cmml" xref="S3.Ex9.m2.1.1.3.2.3.3.2">𝑠</ci><ci id="S3.Ex9.m2.1.1.3.2.3.3.3.cmml" xref="S3.Ex9.m2.1.1.3.2.3.3.3">𝑒</ci><ci id="S3.Ex9.m2.1.1.3.2.3.3.4.cmml" xref="S3.Ex9.m2.1.1.3.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex9.m2.1.1.3.2.4.cmml" xref="S3.Ex9.m2.1.1.3.2.4"><csymbol cd="ambiguous" id="S3.Ex9.m2.1.1.3.2.4.1.cmml" xref="S3.Ex9.m2.1.1.3.2.4">superscript</csymbol><apply id="S3.Ex9.m2.1.1.3.2.4.2.cmml" xref="S3.Ex9.m2.1.1.3.2.4"><csymbol cd="ambiguous" id="S3.Ex9.m2.1.1.3.2.4.2.1.cmml" xref="S3.Ex9.m2.1.1.3.2.4">subscript</csymbol><ci id="S3.Ex9.m2.1.1.3.2.4.2.2.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.2">𝐷</ci><apply id="S3.Ex9.m2.1.1.3.2.4.2.3.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3"><times id="S3.Ex9.m2.1.1.3.2.4.2.3.1.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.1"></times><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.2.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.2">ℎ</ci><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.3.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.3">𝑖</ci><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.4.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.4">𝑑</ci><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.5.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.5">𝑑</ci><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.6.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.6">𝑒</ci><ci id="S3.Ex9.m2.1.1.3.2.4.2.3.7.cmml" xref="S3.Ex9.m2.1.1.3.2.4.2.3.7">𝑛</ci></apply></apply><cn id="S3.Ex9.m2.1.1.3.2.4.3.cmml" type="integer" xref="S3.Ex9.m2.1.1.3.2.4.3">2</cn></apply></apply><apply id="S3.Ex9.m2.1.1.3.3.cmml" xref="S3.Ex9.m2.1.1.3.3"><times id="S3.Ex9.m2.1.1.3.3.1.cmml" xref="S3.Ex9.m2.1.1.3.3.1"></times><ci id="S3.Ex9.m2.1.1.3.3.2.cmml" xref="S3.Ex9.m2.1.1.3.3.2">𝐹</ci><ci id="S3.Ex9.m2.1.1.3.3.3.cmml" xref="S3.Ex9.m2.1.1.3.3.3">𝐿</ci><ci id="S3.Ex9.m2.1.1.3.3.4.cmml" xref="S3.Ex9.m2.1.1.3.3.4">𝑂</ci><ci id="S3.Ex9.m2.1.1.3.3.5.cmml" xref="S3.Ex9.m2.1.1.3.3.5">𝑃</ci><ci id="S3.Ex9.m2.1.1.3.3.6.cmml" xref="S3.Ex9.m2.1.1.3.3.6">𝑆</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex9.m2.1c">\displaystyle=\frac{16*N_{seq}*D_{hidden}^{2}}{FLOPS}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex9.m2.1d">= divide start_ARG 16 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT end_ARG start_ARG italic_F italic_L italic_O italic_P italic_S end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.Ex10"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle T_{rec}" class="ltx_Math" display="inline" id="S3.Ex10.m1.1"><semantics id="S3.Ex10.m1.1a"><msub id="S3.Ex10.m1.1.1" xref="S3.Ex10.m1.1.1.cmml"><mi id="S3.Ex10.m1.1.1.2" xref="S3.Ex10.m1.1.1.2.cmml">T</mi><mrow id="S3.Ex10.m1.1.1.3" xref="S3.Ex10.m1.1.1.3.cmml"><mi id="S3.Ex10.m1.1.1.3.2" xref="S3.Ex10.m1.1.1.3.2.cmml">r</mi><mo id="S3.Ex10.m1.1.1.3.1" xref="S3.Ex10.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex10.m1.1.1.3.3" xref="S3.Ex10.m1.1.1.3.3.cmml">e</mi><mo id="S3.Ex10.m1.1.1.3.1a" xref="S3.Ex10.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex10.m1.1.1.3.4" xref="S3.Ex10.m1.1.1.3.4.cmml">c</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.Ex10.m1.1b"><apply id="S3.Ex10.m1.1.1.cmml" xref="S3.Ex10.m1.1.1"><csymbol cd="ambiguous" id="S3.Ex10.m1.1.1.1.cmml" xref="S3.Ex10.m1.1.1">subscript</csymbol><ci id="S3.Ex10.m1.1.1.2.cmml" xref="S3.Ex10.m1.1.1.2">𝑇</ci><apply id="S3.Ex10.m1.1.1.3.cmml" xref="S3.Ex10.m1.1.1.3"><times id="S3.Ex10.m1.1.1.3.1.cmml" xref="S3.Ex10.m1.1.1.3.1"></times><ci id="S3.Ex10.m1.1.1.3.2.cmml" xref="S3.Ex10.m1.1.1.3.2">𝑟</ci><ci id="S3.Ex10.m1.1.1.3.3.cmml" xref="S3.Ex10.m1.1.1.3.3">𝑒</ci><ci id="S3.Ex10.m1.1.1.3.4.cmml" xref="S3.Ex10.m1.1.1.3.4">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex10.m1.1c">\displaystyle T_{rec}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex10.m1.1d">italic_T start_POSTSUBSCRIPT italic_r italic_e italic_c end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=C_{attn}+C_{ffn}+\epsilon" class="ltx_Math" display="inline" id="S3.Ex10.m2.1"><semantics id="S3.Ex10.m2.1a"><mrow id="S3.Ex10.m2.1.1" xref="S3.Ex10.m2.1.1.cmml"><mi id="S3.Ex10.m2.1.1.2" xref="S3.Ex10.m2.1.1.2.cmml"></mi><mo id="S3.Ex10.m2.1.1.1" xref="S3.Ex10.m2.1.1.1.cmml">=</mo><mrow id="S3.Ex10.m2.1.1.3" xref="S3.Ex10.m2.1.1.3.cmml"><msub id="S3.Ex10.m2.1.1.3.2" xref="S3.Ex10.m2.1.1.3.2.cmml"><mi id="S3.Ex10.m2.1.1.3.2.2" xref="S3.Ex10.m2.1.1.3.2.2.cmml">C</mi><mrow id="S3.Ex10.m2.1.1.3.2.3" xref="S3.Ex10.m2.1.1.3.2.3.cmml"><mi id="S3.Ex10.m2.1.1.3.2.3.2" xref="S3.Ex10.m2.1.1.3.2.3.2.cmml">a</mi><mo id="S3.Ex10.m2.1.1.3.2.3.1" xref="S3.Ex10.m2.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex10.m2.1.1.3.2.3.3" xref="S3.Ex10.m2.1.1.3.2.3.3.cmml">t</mi><mo id="S3.Ex10.m2.1.1.3.2.3.1a" xref="S3.Ex10.m2.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex10.m2.1.1.3.2.3.4" xref="S3.Ex10.m2.1.1.3.2.3.4.cmml">t</mi><mo id="S3.Ex10.m2.1.1.3.2.3.1b" xref="S3.Ex10.m2.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex10.m2.1.1.3.2.3.5" xref="S3.Ex10.m2.1.1.3.2.3.5.cmml">n</mi></mrow></msub><mo id="S3.Ex10.m2.1.1.3.1" xref="S3.Ex10.m2.1.1.3.1.cmml">+</mo><msub id="S3.Ex10.m2.1.1.3.3" xref="S3.Ex10.m2.1.1.3.3.cmml"><mi id="S3.Ex10.m2.1.1.3.3.2" xref="S3.Ex10.m2.1.1.3.3.2.cmml">C</mi><mrow id="S3.Ex10.m2.1.1.3.3.3" xref="S3.Ex10.m2.1.1.3.3.3.cmml"><mi id="S3.Ex10.m2.1.1.3.3.3.2" xref="S3.Ex10.m2.1.1.3.3.3.2.cmml">f</mi><mo id="S3.Ex10.m2.1.1.3.3.3.1" xref="S3.Ex10.m2.1.1.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex10.m2.1.1.3.3.3.3" xref="S3.Ex10.m2.1.1.3.3.3.3.cmml">f</mi><mo id="S3.Ex10.m2.1.1.3.3.3.1a" xref="S3.Ex10.m2.1.1.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex10.m2.1.1.3.3.3.4" xref="S3.Ex10.m2.1.1.3.3.3.4.cmml">n</mi></mrow></msub><mo id="S3.Ex10.m2.1.1.3.1a" xref="S3.Ex10.m2.1.1.3.1.cmml">+</mo><mi id="S3.Ex10.m2.1.1.3.4" xref="S3.Ex10.m2.1.1.3.4.cmml">ϵ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex10.m2.1b"><apply id="S3.Ex10.m2.1.1.cmml" xref="S3.Ex10.m2.1.1"><eq id="S3.Ex10.m2.1.1.1.cmml" xref="S3.Ex10.m2.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex10.m2.1.1.2.cmml" xref="S3.Ex10.m2.1.1.2">absent</csymbol><apply id="S3.Ex10.m2.1.1.3.cmml" xref="S3.Ex10.m2.1.1.3"><plus id="S3.Ex10.m2.1.1.3.1.cmml" xref="S3.Ex10.m2.1.1.3.1"></plus><apply id="S3.Ex10.m2.1.1.3.2.cmml" xref="S3.Ex10.m2.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex10.m2.1.1.3.2.1.cmml" xref="S3.Ex10.m2.1.1.3.2">subscript</csymbol><ci id="S3.Ex10.m2.1.1.3.2.2.cmml" xref="S3.Ex10.m2.1.1.3.2.2">𝐶</ci><apply id="S3.Ex10.m2.1.1.3.2.3.cmml" xref="S3.Ex10.m2.1.1.3.2.3"><times id="S3.Ex10.m2.1.1.3.2.3.1.cmml" xref="S3.Ex10.m2.1.1.3.2.3.1"></times><ci id="S3.Ex10.m2.1.1.3.2.3.2.cmml" xref="S3.Ex10.m2.1.1.3.2.3.2">𝑎</ci><ci id="S3.Ex10.m2.1.1.3.2.3.3.cmml" xref="S3.Ex10.m2.1.1.3.2.3.3">𝑡</ci><ci id="S3.Ex10.m2.1.1.3.2.3.4.cmml" xref="S3.Ex10.m2.1.1.3.2.3.4">𝑡</ci><ci id="S3.Ex10.m2.1.1.3.2.3.5.cmml" xref="S3.Ex10.m2.1.1.3.2.3.5">𝑛</ci></apply></apply><apply id="S3.Ex10.m2.1.1.3.3.cmml" xref="S3.Ex10.m2.1.1.3.3"><csymbol cd="ambiguous" id="S3.Ex10.m2.1.1.3.3.1.cmml" xref="S3.Ex10.m2.1.1.3.3">subscript</csymbol><ci id="S3.Ex10.m2.1.1.3.3.2.cmml" xref="S3.Ex10.m2.1.1.3.3.2">𝐶</ci><apply id="S3.Ex10.m2.1.1.3.3.3.cmml" xref="S3.Ex10.m2.1.1.3.3.3"><times id="S3.Ex10.m2.1.1.3.3.3.1.cmml" xref="S3.Ex10.m2.1.1.3.3.3.1"></times><ci id="S3.Ex10.m2.1.1.3.3.3.2.cmml" xref="S3.Ex10.m2.1.1.3.3.3.2">𝑓</ci><ci id="S3.Ex10.m2.1.1.3.3.3.3.cmml" xref="S3.Ex10.m2.1.1.3.3.3.3">𝑓</ci><ci id="S3.Ex10.m2.1.1.3.3.3.4.cmml" xref="S3.Ex10.m2.1.1.3.3.3.4">𝑛</ci></apply></apply><ci id="S3.Ex10.m2.1.1.3.4.cmml" xref="S3.Ex10.m2.1.1.3.4">italic-ϵ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex10.m2.1c">\displaystyle=C_{attn}+C_{ffn}+\epsilon</annotation><annotation encoding="application/x-llamapun" id="S3.Ex10.m2.1d">= italic_C start_POSTSUBSCRIPT italic_a italic_t italic_t italic_n end_POSTSUBSCRIPT + italic_C start_POSTSUBSCRIPT italic_f italic_f italic_n end_POSTSUBSCRIPT + italic_ϵ</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.Ex11"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{24*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{FLOPS}+\epsilon" class="ltx_Math" display="inline" id="S3.Ex11.m1.1"><semantics id="S3.Ex11.m1.1a"><mrow id="S3.Ex11.m1.1.1" xref="S3.Ex11.m1.1.1.cmml"><mi id="S3.Ex11.m1.1.1.2" xref="S3.Ex11.m1.1.1.2.cmml"></mi><mo id="S3.Ex11.m1.1.1.1" xref="S3.Ex11.m1.1.1.1.cmml">=</mo><mrow id="S3.Ex11.m1.1.1.3" xref="S3.Ex11.m1.1.1.3.cmml"><mstyle displaystyle="true" id="S3.Ex11.m1.1.1.3.2" xref="S3.Ex11.m1.1.1.3.2.cmml"><mfrac id="S3.Ex11.m1.1.1.3.2a" xref="S3.Ex11.m1.1.1.3.2.cmml"><mrow id="S3.Ex11.m1.1.1.3.2.2" xref="S3.Ex11.m1.1.1.3.2.2.cmml"><mrow id="S3.Ex11.m1.1.1.3.2.2.2" xref="S3.Ex11.m1.1.1.3.2.2.2.cmml"><mn id="S3.Ex11.m1.1.1.3.2.2.2.2" xref="S3.Ex11.m1.1.1.3.2.2.2.2.cmml">24</mn><mo id="S3.Ex11.m1.1.1.3.2.2.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex11.m1.1.1.3.2.2.2.1.cmml">∗</mo><msub id="S3.Ex11.m1.1.1.3.2.2.2.3" xref="S3.Ex11.m1.1.1.3.2.2.2.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.2.3.2" xref="S3.Ex11.m1.1.1.3.2.2.2.3.2.cmml">N</mi><mrow id="S3.Ex11.m1.1.1.3.2.2.2.3.3" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.2.3.3.2" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.2.cmml">s</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.3.3.1" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.3.3.3" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.3.cmml">e</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.3.3.1a" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.3.3.4" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex11.m1.1.1.3.2.2.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex11.m1.1.1.3.2.2.2.1.cmml">∗</mo><msubsup id="S3.Ex11.m1.1.1.3.2.2.2.4" xref="S3.Ex11.m1.1.1.3.2.2.2.4.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.2" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.2.cmml">D</mi><mrow id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.2" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.2.cmml">h</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.3" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.3.cmml">i</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1a" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.4" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.4.cmml">d</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1b" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.5" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.5.cmml">d</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1c" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.6" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.6.cmml">e</mi><mo id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1d" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.7" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.7.cmml">n</mi></mrow><mn id="S3.Ex11.m1.1.1.3.2.2.2.4.3" xref="S3.Ex11.m1.1.1.3.2.2.2.4.3.cmml">2</mn></msubsup></mrow><mo id="S3.Ex11.m1.1.1.3.2.2.1" xref="S3.Ex11.m1.1.1.3.2.2.1.cmml">+</mo><mrow id="S3.Ex11.m1.1.1.3.2.2.3" xref="S3.Ex11.m1.1.1.3.2.2.3.cmml"><msubsup id="S3.Ex11.m1.1.1.3.2.2.3.2" xref="S3.Ex11.m1.1.1.3.2.2.3.2.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.3.2.2.2" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.2.cmml">N</mi><mrow id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.2" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.2.cmml">s</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.3" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.3.cmml">e</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1a" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.4" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.4.cmml">q</mi></mrow><mn id="S3.Ex11.m1.1.1.3.2.2.3.2.3" xref="S3.Ex11.m1.1.1.3.2.2.3.2.3.cmml">2</mn></msubsup><mo id="S3.Ex11.m1.1.1.3.2.2.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex11.m1.1.1.3.2.2.3.1.cmml">∗</mo><msub id="S3.Ex11.m1.1.1.3.2.2.3.3" xref="S3.Ex11.m1.1.1.3.2.2.3.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.2" xref="S3.Ex11.m1.1.1.3.2.2.3.3.2.cmml">D</mi><mrow id="S3.Ex11.m1.1.1.3.2.2.3.3.3" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.2" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.2.cmml">h</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.3" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.3.cmml">i</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1a" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.4" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.4.cmml">d</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1b" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.5" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.5.cmml">d</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1c" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.6" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.6.cmml">e</mi><mo id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1d" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.2.3.3.3.7" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.7.cmml">n</mi></mrow></msub></mrow></mrow><mrow id="S3.Ex11.m1.1.1.3.2.3" xref="S3.Ex11.m1.1.1.3.2.3.cmml"><mi id="S3.Ex11.m1.1.1.3.2.3.2" xref="S3.Ex11.m1.1.1.3.2.3.2.cmml">F</mi><mo id="S3.Ex11.m1.1.1.3.2.3.1" xref="S3.Ex11.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.3.3" xref="S3.Ex11.m1.1.1.3.2.3.3.cmml">L</mi><mo id="S3.Ex11.m1.1.1.3.2.3.1a" xref="S3.Ex11.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.3.4" xref="S3.Ex11.m1.1.1.3.2.3.4.cmml">O</mi><mo id="S3.Ex11.m1.1.1.3.2.3.1b" xref="S3.Ex11.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.3.5" xref="S3.Ex11.m1.1.1.3.2.3.5.cmml">P</mi><mo id="S3.Ex11.m1.1.1.3.2.3.1c" xref="S3.Ex11.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex11.m1.1.1.3.2.3.6" xref="S3.Ex11.m1.1.1.3.2.3.6.cmml">S</mi></mrow></mfrac></mstyle><mo id="S3.Ex11.m1.1.1.3.1" xref="S3.Ex11.m1.1.1.3.1.cmml">+</mo><mi id="S3.Ex11.m1.1.1.3.3" xref="S3.Ex11.m1.1.1.3.3.cmml">ϵ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex11.m1.1b"><apply id="S3.Ex11.m1.1.1.cmml" xref="S3.Ex11.m1.1.1"><eq id="S3.Ex11.m1.1.1.1.cmml" xref="S3.Ex11.m1.1.1.1"></eq><csymbol cd="latexml" id="S3.Ex11.m1.1.1.2.cmml" xref="S3.Ex11.m1.1.1.2">absent</csymbol><apply id="S3.Ex11.m1.1.1.3.cmml" xref="S3.Ex11.m1.1.1.3"><plus id="S3.Ex11.m1.1.1.3.1.cmml" xref="S3.Ex11.m1.1.1.3.1"></plus><apply id="S3.Ex11.m1.1.1.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2"><divide id="S3.Ex11.m1.1.1.3.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2"></divide><apply id="S3.Ex11.m1.1.1.3.2.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2"><plus id="S3.Ex11.m1.1.1.3.2.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.1"></plus><apply id="S3.Ex11.m1.1.1.3.2.2.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2"><times id="S3.Ex11.m1.1.1.3.2.2.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.1"></times><cn id="S3.Ex11.m1.1.1.3.2.2.2.2.cmml" type="integer" xref="S3.Ex11.m1.1.1.3.2.2.2.2">24</cn><apply id="S3.Ex11.m1.1.1.3.2.2.2.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.2.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3">subscript</csymbol><ci id="S3.Ex11.m1.1.1.3.2.2.2.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.2">𝑁</ci><apply id="S3.Ex11.m1.1.1.3.2.2.2.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3"><times id="S3.Ex11.m1.1.1.3.2.2.2.3.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.1"></times><ci id="S3.Ex11.m1.1.1.3.2.2.2.3.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.2">𝑠</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.3.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.3">𝑒</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.3.3.4.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex11.m1.1.1.3.2.2.2.4.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.2.4.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4">superscript</csymbol><apply id="S3.Ex11.m1.1.1.3.2.2.2.4.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.2.4.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4">subscript</csymbol><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.2">𝐷</ci><apply id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3"><times id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.1"></times><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.2">ℎ</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.3">𝑖</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.4.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.4">𝑑</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.5.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.5">𝑑</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.6.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.6">𝑒</ci><ci id="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.7.cmml" xref="S3.Ex11.m1.1.1.3.2.2.2.4.2.3.7">𝑛</ci></apply></apply><cn id="S3.Ex11.m1.1.1.3.2.2.2.4.3.cmml" type="integer" xref="S3.Ex11.m1.1.1.3.2.2.2.4.3">2</cn></apply></apply><apply id="S3.Ex11.m1.1.1.3.2.2.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3"><times id="S3.Ex11.m1.1.1.3.2.2.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.1"></times><apply id="S3.Ex11.m1.1.1.3.2.2.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.3.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2">superscript</csymbol><apply id="S3.Ex11.m1.1.1.3.2.2.3.2.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.3.2.2.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2">subscript</csymbol><ci id="S3.Ex11.m1.1.1.3.2.2.3.2.2.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.2">𝑁</ci><apply id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3"><times id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.1"></times><ci id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.2">𝑠</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.3">𝑒</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.4.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.2.2.3.4">𝑞</ci></apply></apply><cn id="S3.Ex11.m1.1.1.3.2.2.3.2.3.cmml" type="integer" xref="S3.Ex11.m1.1.1.3.2.2.3.2.3">2</cn></apply><apply id="S3.Ex11.m1.1.1.3.2.2.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3"><csymbol cd="ambiguous" id="S3.Ex11.m1.1.1.3.2.2.3.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3">subscript</csymbol><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.2">𝐷</ci><apply id="S3.Ex11.m1.1.1.3.2.2.3.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3"><times id="S3.Ex11.m1.1.1.3.2.2.3.3.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.1"></times><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.2">ℎ</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.3">𝑖</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.4.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.4">𝑑</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.5.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.5">𝑑</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.6.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.6">𝑒</ci><ci id="S3.Ex11.m1.1.1.3.2.2.3.3.3.7.cmml" xref="S3.Ex11.m1.1.1.3.2.2.3.3.3.7">𝑛</ci></apply></apply></apply></apply><apply id="S3.Ex11.m1.1.1.3.2.3.cmml" xref="S3.Ex11.m1.1.1.3.2.3"><times id="S3.Ex11.m1.1.1.3.2.3.1.cmml" xref="S3.Ex11.m1.1.1.3.2.3.1"></times><ci id="S3.Ex11.m1.1.1.3.2.3.2.cmml" xref="S3.Ex11.m1.1.1.3.2.3.2">𝐹</ci><ci id="S3.Ex11.m1.1.1.3.2.3.3.cmml" xref="S3.Ex11.m1.1.1.3.2.3.3">𝐿</ci><ci id="S3.Ex11.m1.1.1.3.2.3.4.cmml" xref="S3.Ex11.m1.1.1.3.2.3.4">𝑂</ci><ci id="S3.Ex11.m1.1.1.3.2.3.5.cmml" xref="S3.Ex11.m1.1.1.3.2.3.5">𝑃</ci><ci id="S3.Ex11.m1.1.1.3.2.3.6.cmml" xref="S3.Ex11.m1.1.1.3.2.3.6">𝑆</ci></apply></apply><ci id="S3.Ex11.m1.1.1.3.3.cmml" xref="S3.Ex11.m1.1.1.3.3">italic-ϵ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex11.m1.1c">\displaystyle=\frac{24*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{FLOPS}+\epsilon</annotation><annotation encoding="application/x-llamapun" id="S3.Ex11.m1.1d">= divide start_ARG 24 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_F italic_L italic_O italic_P italic_S end_ARG + italic_ϵ</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p4.2">Here <math alttext="\epsilon" class="ltx_Math" display="inline" id="S3.SS2.p4.1.m1.1"><semantics id="S3.SS2.p4.1.m1.1a"><mi id="S3.SS2.p4.1.m1.1.1" xref="S3.SS2.p4.1.m1.1.1.cmml">ϵ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.1.m1.1b"><ci id="S3.SS2.p4.1.m1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1">italic-ϵ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.1.m1.1c">\epsilon</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.1.m1.1d">italic_ϵ</annotation></semantics></math> indicates the remaining computation overhead,
including normalization and residual connection, which are bounded by <math alttext="O(N_{seq}*D_{hidden})" class="ltx_Math" display="inline" id="S3.SS2.p4.2.m2.1"><semantics id="S3.SS2.p4.2.m2.1a"><mrow id="S3.SS2.p4.2.m2.1.1" xref="S3.SS2.p4.2.m2.1.1.cmml"><mi id="S3.SS2.p4.2.m2.1.1.3" xref="S3.SS2.p4.2.m2.1.1.3.cmml">O</mi><mo id="S3.SS2.p4.2.m2.1.1.2" xref="S3.SS2.p4.2.m2.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.p4.2.m2.1.1.1.1" xref="S3.SS2.p4.2.m2.1.1.1.1.1.cmml"><mo id="S3.SS2.p4.2.m2.1.1.1.1.2" stretchy="false" xref="S3.SS2.p4.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.p4.2.m2.1.1.1.1.1" xref="S3.SS2.p4.2.m2.1.1.1.1.1.cmml"><msub id="S3.SS2.p4.2.m2.1.1.1.1.1.2" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.cmml"><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.2.2" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.2.cmml">N</mi><mrow id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.cmml"><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.2" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.2.cmml">s</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.3" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.3.cmml">e</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1a" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.4" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.4.cmml">q</mi></mrow></msub><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.p4.2.m2.1.1.1.1.1.1.cmml">∗</mo><msub id="S3.SS2.p4.2.m2.1.1.1.1.1.3" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.cmml"><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.2" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.2.cmml">D</mi><mrow id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.cmml"><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.2" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.2.cmml">h</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.3" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.3.cmml">i</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1a" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.4" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.4.cmml">d</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1b" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.5" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.5.cmml">d</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1c" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.6" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.6.cmml">e</mi><mo id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1d" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.7" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.7.cmml">n</mi></mrow></msub></mrow><mo id="S3.SS2.p4.2.m2.1.1.1.1.3" stretchy="false" xref="S3.SS2.p4.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.2.m2.1b"><apply id="S3.SS2.p4.2.m2.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1"><times id="S3.SS2.p4.2.m2.1.1.2.cmml" xref="S3.SS2.p4.2.m2.1.1.2"></times><ci id="S3.SS2.p4.2.m2.1.1.3.cmml" xref="S3.SS2.p4.2.m2.1.1.3">𝑂</ci><apply id="S3.SS2.p4.2.m2.1.1.1.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1"><times id="S3.SS2.p4.2.m2.1.1.1.1.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.1"></times><apply id="S3.SS2.p4.2.m2.1.1.1.1.1.2.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.p4.2.m2.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.2">𝑁</ci><apply id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3"><times id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.1"></times><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.2.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.2">𝑠</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.3.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.3">𝑒</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.4.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.2.3.4">𝑞</ci></apply></apply><apply id="S3.SS2.p4.2.m2.1.1.1.1.1.3.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.p4.2.m2.1.1.1.1.1.3.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3">subscript</csymbol><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.2.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.2">𝐷</ci><apply id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3"><times id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.1"></times><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.2.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.2">ℎ</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.3.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.3">𝑖</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.4.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.4">𝑑</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.5.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.5">𝑑</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.6.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.6">𝑒</ci><ci id="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.7.cmml" xref="S3.SS2.p4.2.m2.1.1.1.1.1.3.3.7">𝑛</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.2.m2.1c">O(N_{seq}*D_{hidden})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.2.m2.1d">italic_O ( italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT )</annotation></semantics></math> and
can be negligible. 
<br class="ltx_break"/></p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p5">
<p class="ltx_p" id="S3.SS2.p5.3"><span class="ltx_text ltx_font_bold" id="S3.SS2.p5.3.1">Comparison.</span>

For the I/O transmission part, the hidden state tensors have the same shape as keys and
values in the <span class="ltx_text" id="S3.SS2.p5.3.2">KV cache</span>. Hence, the I/O time of transmitting <span class="ltx_text" id="S3.SS2.p5.3.3">hidden states</span> is half that of directly transmitting the <span class="ltx_text" id="S3.SS2.p5.3.4">KV cache</span>.
For the computation part. The relative speedup of <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p5.3.5">HCache</span> compared with recomputation is:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\frac{24*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{4*N_{seq}*D_{hidden}^{%
2}}=6+\frac{N_{seq}}{4*D_{hidden}}." class="ltx_Math" display="block" id="S3.Ex12.m1.1"><semantics id="S3.Ex12.m1.1a"><mrow id="S3.Ex12.m1.1.1.1" xref="S3.Ex12.m1.1.1.1.1.cmml"><mrow id="S3.Ex12.m1.1.1.1.1" xref="S3.Ex12.m1.1.1.1.1.cmml"><mfrac id="S3.Ex12.m1.1.1.1.1.2" xref="S3.Ex12.m1.1.1.1.1.2.cmml"><mrow id="S3.Ex12.m1.1.1.1.1.2.2" xref="S3.Ex12.m1.1.1.1.1.2.2.cmml"><mrow id="S3.Ex12.m1.1.1.1.1.2.2.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.cmml"><mn id="S3.Ex12.m1.1.1.1.1.2.2.2.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.2.cmml">24</mn><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.2.2.2.1.cmml">∗</mo><msub id="S3.Ex12.m1.1.1.1.1.2.2.2.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.2.cmml">N</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.2.cmml">s</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.3.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.4" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.2.2.2.1.cmml">∗</mo><msubsup id="S3.Ex12.m1.1.1.1.1.2.2.2.4" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.2.cmml">D</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.2.cmml">h</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.3.cmml">i</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.4" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.4.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1b" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.5" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.5.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1c" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.6" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.6.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1d" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.7" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.7.cmml">n</mi></mrow><mn id="S3.Ex12.m1.1.1.1.1.2.2.2.4.3" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.3.cmml">2</mn></msubsup></mrow><mo id="S3.Ex12.m1.1.1.1.1.2.2.1" xref="S3.Ex12.m1.1.1.1.1.2.2.1.cmml">+</mo><mrow id="S3.Ex12.m1.1.1.1.1.2.2.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.cmml"><msubsup id="S3.Ex12.m1.1.1.1.1.2.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.2" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.2.cmml">N</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.2.cmml">s</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.3.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.4" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.4.cmml">q</mi></mrow><mn id="S3.Ex12.m1.1.1.1.1.2.2.3.2.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.3.cmml">2</mn></msubsup><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.2.2.3.1.cmml">∗</mo><msub id="S3.Ex12.m1.1.1.1.1.2.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.2.cmml">D</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.2" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.2.cmml">h</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.3" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.3.cmml">i</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.4" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.4.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1b" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.5" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.5.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1c" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.6" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.6.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1d" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.7" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.7.cmml">n</mi></mrow></msub></mrow></mrow><mrow id="S3.Ex12.m1.1.1.1.1.2.3" xref="S3.Ex12.m1.1.1.1.1.2.3.cmml"><mn id="S3.Ex12.m1.1.1.1.1.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.3.2.cmml">4</mn><mo id="S3.Ex12.m1.1.1.1.1.2.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.2.3.1.cmml">∗</mo><msub id="S3.Ex12.m1.1.1.1.1.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.3.3.2" xref="S3.Ex12.m1.1.1.1.1.2.3.3.2.cmml">N</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.3.3.3" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.3.3.3.2" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.2.cmml">s</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.3.3.1" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.3.3.3" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.3.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.3.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.3.3.4" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.4.cmml">q</mi></mrow></msub><mo id="S3.Ex12.m1.1.1.1.1.2.3.1a" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.2.3.1.cmml">∗</mo><msubsup id="S3.Ex12.m1.1.1.1.1.2.3.4" xref="S3.Ex12.m1.1.1.1.1.2.3.4.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.2" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.2.cmml">D</mi><mrow id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.2" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.2.cmml">h</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.3" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.3.cmml">i</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1a" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.4" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.4.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1b" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.5" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.5.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1c" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.6" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.6.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1d" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.7" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.7.cmml">n</mi></mrow><mn id="S3.Ex12.m1.1.1.1.1.2.3.4.3" xref="S3.Ex12.m1.1.1.1.1.2.3.4.3.cmml">2</mn></msubsup></mrow></mfrac><mo id="S3.Ex12.m1.1.1.1.1.1" xref="S3.Ex12.m1.1.1.1.1.1.cmml">=</mo><mrow id="S3.Ex12.m1.1.1.1.1.3" xref="S3.Ex12.m1.1.1.1.1.3.cmml"><mn id="S3.Ex12.m1.1.1.1.1.3.2" xref="S3.Ex12.m1.1.1.1.1.3.2.cmml">6</mn><mo id="S3.Ex12.m1.1.1.1.1.3.1" xref="S3.Ex12.m1.1.1.1.1.3.1.cmml">+</mo><mfrac id="S3.Ex12.m1.1.1.1.1.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.cmml"><msub id="S3.Ex12.m1.1.1.1.1.3.3.2" xref="S3.Ex12.m1.1.1.1.1.3.3.2.cmml"><mi id="S3.Ex12.m1.1.1.1.1.3.3.2.2" xref="S3.Ex12.m1.1.1.1.1.3.3.2.2.cmml">N</mi><mrow id="S3.Ex12.m1.1.1.1.1.3.3.2.3" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.3.3.2.3.2" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.2.cmml">s</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.2.3.1" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.2.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.3.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.2.3.1a" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.2.3.4" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.4.cmml">q</mi></mrow></msub><mrow id="S3.Ex12.m1.1.1.1.1.3.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.3.cmml"><mn id="S3.Ex12.m1.1.1.1.1.3.3.3.2" xref="S3.Ex12.m1.1.1.1.1.3.3.3.2.cmml">4</mn><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex12.m1.1.1.1.1.3.3.3.1.cmml">∗</mo><msub id="S3.Ex12.m1.1.1.1.1.3.3.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.2" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.2.cmml">D</mi><mrow id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.cmml"><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.2" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.2.cmml">h</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.3" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.3.cmml">i</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1a" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.4" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.4.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1b" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.5" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.5.cmml">d</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1c" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.6" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.6.cmml">e</mi><mo id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1d" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml">⁢</mo><mi id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.7" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.7.cmml">n</mi></mrow></msub></mrow></mfrac></mrow></mrow><mo id="S3.Ex12.m1.1.1.1.2" lspace="0em" xref="S3.Ex12.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex12.m1.1b"><apply id="S3.Ex12.m1.1.1.1.1.cmml" xref="S3.Ex12.m1.1.1.1"><eq id="S3.Ex12.m1.1.1.1.1.1.cmml" xref="S3.Ex12.m1.1.1.1.1.1"></eq><apply id="S3.Ex12.m1.1.1.1.1.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2"><divide id="S3.Ex12.m1.1.1.1.1.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2"></divide><apply id="S3.Ex12.m1.1.1.1.1.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2"><plus id="S3.Ex12.m1.1.1.1.1.2.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.1"></plus><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2"><times id="S3.Ex12.m1.1.1.1.1.2.2.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.1"></times><cn id="S3.Ex12.m1.1.1.1.1.2.2.2.2.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.2.2.2.2">24</cn><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.2">𝑁</ci><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3"><times id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.2">𝑠</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.3">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.2.4.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4">superscript</csymbol><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.2">𝐷</ci><apply id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3"><times id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.2">ℎ</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.3">𝑖</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.4">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.5.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.5">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.6.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.6">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.7.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.2.3.7">𝑛</ci></apply></apply><cn id="S3.Ex12.m1.1.1.1.1.2.2.2.4.3.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.2.2.2.4.3">2</cn></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3"><times id="S3.Ex12.m1.1.1.1.1.2.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.1"></times><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.3.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2">superscript</csymbol><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.2">𝑁</ci><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3"><times id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.2">𝑠</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.3">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.2.3.4">𝑞</ci></apply></apply><cn id="S3.Ex12.m1.1.1.1.1.2.2.3.2.3.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.2.2.3.2.3">2</cn></apply><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.2.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.2">𝐷</ci><apply id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3"><times id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.2">ℎ</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.3">𝑖</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.4">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.5.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.5">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.6.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.6">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.7.cmml" xref="S3.Ex12.m1.1.1.1.1.2.2.3.3.3.7">𝑛</ci></apply></apply></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3"><times id="S3.Ex12.m1.1.1.1.1.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.1"></times><cn id="S3.Ex12.m1.1.1.1.1.2.3.2.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.2.3.2">4</cn><apply id="S3.Ex12.m1.1.1.1.1.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.2">𝑁</ci><apply id="S3.Ex12.m1.1.1.1.1.2.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3"><times id="S3.Ex12.m1.1.1.1.1.2.3.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.3.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.2">𝑠</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.3">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.3.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.3.3.4">𝑞</ci></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.2.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.3.4.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4">superscript</csymbol><apply id="S3.Ex12.m1.1.1.1.1.2.3.4.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.2.3.4.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.2">𝐷</ci><apply id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3"><times id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.2">ℎ</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.3">𝑖</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.4">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.5.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.5">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.6.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.6">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.7.cmml" xref="S3.Ex12.m1.1.1.1.1.2.3.4.2.3.7">𝑛</ci></apply></apply><cn id="S3.Ex12.m1.1.1.1.1.2.3.4.3.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.2.3.4.3">2</cn></apply></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3"><plus id="S3.Ex12.m1.1.1.1.1.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.1"></plus><cn id="S3.Ex12.m1.1.1.1.1.3.2.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.3.2">6</cn><apply id="S3.Ex12.m1.1.1.1.1.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3"><divide id="S3.Ex12.m1.1.1.1.1.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3"></divide><apply id="S3.Ex12.m1.1.1.1.1.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.3.3.2.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.3.3.2.2.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.2">𝑁</ci><apply id="S3.Ex12.m1.1.1.1.1.3.3.2.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3"><times id="S3.Ex12.m1.1.1.1.1.3.3.2.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.3.3.2.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.2">𝑠</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.2.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.3">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.2.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.2.3.4">𝑞</ci></apply></apply><apply id="S3.Ex12.m1.1.1.1.1.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3"><times id="S3.Ex12.m1.1.1.1.1.3.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.1"></times><cn id="S3.Ex12.m1.1.1.1.1.3.3.3.2.cmml" type="integer" xref="S3.Ex12.m1.1.1.1.1.3.3.3.2">4</cn><apply id="S3.Ex12.m1.1.1.1.1.3.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3"><csymbol cd="ambiguous" id="S3.Ex12.m1.1.1.1.1.3.3.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3">subscript</csymbol><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.2">𝐷</ci><apply id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3"><times id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.1"></times><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.2.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.2">ℎ</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.3.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.3">𝑖</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.4.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.4">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.5.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.5">𝑑</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.6.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.6">𝑒</ci><ci id="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.7.cmml" xref="S3.Ex12.m1.1.1.1.1.3.3.3.3.3.7">𝑛</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex12.m1.1c">\frac{24*N_{seq}*D_{hidden}^{2}+N_{seq}^{2}*D_{hidden}}{4*N_{seq}*D_{hidden}^{%
2}}=6+\frac{N_{seq}}{4*D_{hidden}}.</annotation><annotation encoding="application/x-llamapun" id="S3.Ex12.m1.1d">divide start_ARG 24 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG 4 ∗ italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT end_ARG = 6 + divide start_ARG italic_N start_POSTSUBSCRIPT italic_s italic_e italic_q end_POSTSUBSCRIPT end_ARG start_ARG 4 ∗ italic_D start_POSTSUBSCRIPT italic_h italic_i italic_d italic_d italic_e italic_n end_POSTSUBSCRIPT end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p5.2">Hence, the lower bound for the speed up is 6<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p5.1.m1.1"><semantics id="S3.SS2.p5.1.m1.1a"><mo id="S3.SS2.p5.1.m1.1.1" xref="S3.SS2.p5.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.1.m1.1b"><times id="S3.SS2.p5.1.m1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.1.m1.1d">×</annotation></semantics></math>.
The computational speedup is attributed to two factors. First, the FFN and attention modules
are highly compute-intensive, reflected by the constant 24 in the above equation.
In contrast, the projection of <span class="ltx_text" id="S3.SS2.p5.2.1">hidden states</span> to the <span class="ltx_text" id="S3.SS2.p5.2.2">KV cache</span> is relatively lightweight, corresponding to a constant of 4.
This ensures a minimum 6<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p5.2.m2.1"><semantics id="S3.SS2.p5.2.m2.1a"><mo id="S3.SS2.p5.2.m2.1.1" xref="S3.SS2.p5.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.2.m2.1b"><times id="S3.SS2.p5.2.m2.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.2.m2.1d">×</annotation></semantics></math> speed-up. Second, the quadratic complexity attention computation is the dominant component for long sequences but is unnecessary in restoring the hidden state. So <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p5.2.3">HCache</span> scales linearly with history length.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p6">
<p class="ltx_p" id="S3.SS2.p6.2"><span class="ltx_text ltx_font_bold" id="S3.SS2.p6.2.1">Conclusion.</span> As a whole, the transmission size of <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p6.2.2">HCache</span> is always 2<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p6.1.m1.1"><semantics id="S3.SS2.p6.1.m1.1a"><mo id="S3.SS2.p6.1.m1.1.1" xref="S3.SS2.p6.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.1.m1.1b"><times id="S3.SS2.p6.1.m1.1.1.cmml" xref="S3.SS2.p6.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p6.1.m1.1d">×</annotation></semantics></math> less than
that of transmitting the <span class="ltx_text" id="S3.SS2.p6.2.3">KV cache</span>,
while the recomputation of <span class="ltx_text" id="S3.SS2.p6.2.4">KV cache</span> from <span class="ltx_text" id="S3.SS2.p6.2.5">hidden states</span> is at least 6<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p6.2.m2.1"><semantics id="S3.SS2.p6.2.m2.1a"><mo id="S3.SS2.p6.2.m2.1.1" xref="S3.SS2.p6.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p6.2.m2.1b"><times id="S3.SS2.p6.2.m2.1.1.cmml" xref="S3.SS2.p6.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p6.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p6.2.m2.1d">×</annotation></semantics></math> faster than token recomputation.
This theoretical support makes <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p6.2.6">HCache</span> beneficial on mainstream platforms (see §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.SS2" title="6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">6.2</span></a>).</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p7">
<p class="ltx_p" id="S3.SS2.p7.1">Nevertheless, when employing <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p7.1.1">HCache</span> to existing LLM serving systems, we still face two main challenges:</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p8">
<p class="ltx_p" id="S3.SS2.p8.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p8.1.1">C1: Pipeline bubbles.</span> As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.F5" title="Figure 5 ‣ 3.1. HCache Overview ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">5</span></a>, the computation and transmission of <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p8.1.2">HCache</span> restoration
do not always take the same time. Hence, the actual restoration speed is bounded by the slower one, which creates
pipeline bubbles and wastes system resources.
In extreme hardware configurations, where the IO speed far exceeds computation speeds,
or vice versa, <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p8.1.3">HCache</span> may not offer any benefits.</p>
</div>
<figure class="ltx_figure" id="S3.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="330" id="S3.F6.g1" src="x6.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6. </span>State Generation and Restoration Order.
<em class="ltx_emph ltx_font_italic" id="S3.F6.4.2" style="font-size:90%;">The highlighted red block: the <span class="ltx_text" id="S3.F6.4.2.3">hidden states</span> of the <math alttext="2^{nd}" class="ltx_Math" display="inline" id="S3.F6.3.1.1.m1.1"><semantics id="S3.F6.3.1.1.m1.1b"><msup id="S3.F6.3.1.1.m1.1.1" xref="S3.F6.3.1.1.m1.1.1.cmml"><mn id="S3.F6.3.1.1.m1.1.1.2" xref="S3.F6.3.1.1.m1.1.1.2.cmml">2</mn><mrow id="S3.F6.3.1.1.m1.1.1.3" xref="S3.F6.3.1.1.m1.1.1.3.cmml"><mi id="S3.F6.3.1.1.m1.1.1.3.2" xref="S3.F6.3.1.1.m1.1.1.3.2.cmml">n</mi><mo id="S3.F6.3.1.1.m1.1.1.3.1" xref="S3.F6.3.1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.F6.3.1.1.m1.1.1.3.3" xref="S3.F6.3.1.1.m1.1.1.3.3.cmml">d</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.F6.3.1.1.m1.1c"><apply id="S3.F6.3.1.1.m1.1.1.cmml" xref="S3.F6.3.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.F6.3.1.1.m1.1.1.1.cmml" xref="S3.F6.3.1.1.m1.1.1">superscript</csymbol><cn id="S3.F6.3.1.1.m1.1.1.2.cmml" type="integer" xref="S3.F6.3.1.1.m1.1.1.2">2</cn><apply id="S3.F6.3.1.1.m1.1.1.3.cmml" xref="S3.F6.3.1.1.m1.1.1.3"><times id="S3.F6.3.1.1.m1.1.1.3.1.cmml" xref="S3.F6.3.1.1.m1.1.1.3.1"></times><ci id="S3.F6.3.1.1.m1.1.1.3.2.cmml" xref="S3.F6.3.1.1.m1.1.1.3.2">𝑛</ci><ci id="S3.F6.3.1.1.m1.1.1.3.3.cmml" xref="S3.F6.3.1.1.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.3.1.1.m1.1d">2^{nd}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.3.1.1.m1.1e">2 start_POSTSUPERSCRIPT italic_n italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> token at the <math alttext="2^{nd}" class="ltx_Math" display="inline" id="S3.F6.4.2.2.m2.1"><semantics id="S3.F6.4.2.2.m2.1b"><msup id="S3.F6.4.2.2.m2.1.1" xref="S3.F6.4.2.2.m2.1.1.cmml"><mn id="S3.F6.4.2.2.m2.1.1.2" xref="S3.F6.4.2.2.m2.1.1.2.cmml">2</mn><mrow id="S3.F6.4.2.2.m2.1.1.3" xref="S3.F6.4.2.2.m2.1.1.3.cmml"><mi id="S3.F6.4.2.2.m2.1.1.3.2" xref="S3.F6.4.2.2.m2.1.1.3.2.cmml">n</mi><mo id="S3.F6.4.2.2.m2.1.1.3.1" xref="S3.F6.4.2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.F6.4.2.2.m2.1.1.3.3" xref="S3.F6.4.2.2.m2.1.1.3.3.cmml">d</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.F6.4.2.2.m2.1c"><apply id="S3.F6.4.2.2.m2.1.1.cmml" xref="S3.F6.4.2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.F6.4.2.2.m2.1.1.1.cmml" xref="S3.F6.4.2.2.m2.1.1">superscript</csymbol><cn id="S3.F6.4.2.2.m2.1.1.2.cmml" type="integer" xref="S3.F6.4.2.2.m2.1.1.2">2</cn><apply id="S3.F6.4.2.2.m2.1.1.3.cmml" xref="S3.F6.4.2.2.m2.1.1.3"><times id="S3.F6.4.2.2.m2.1.1.3.1.cmml" xref="S3.F6.4.2.2.m2.1.1.3.1"></times><ci id="S3.F6.4.2.2.m2.1.1.3.2.cmml" xref="S3.F6.4.2.2.m2.1.1.3.2">𝑛</ci><ci id="S3.F6.4.2.2.m2.1.1.3.3.cmml" xref="S3.F6.4.2.2.m2.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.4.2.2.m2.1d">2^{nd}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.4.2.2.m2.1e">2 start_POSTSUPERSCRIPT italic_n italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> layer.</em></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS2.p9">
<p class="ltx_p" id="S3.SS2.p9.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p9.1.1">C2: Storage format.</span> Unlike <span class="ltx_text" id="S3.SS2.p9.1.2">KV cache</span> that owns dedicated GPU memory space,
hidden states are intermediate activations in temporary buffers repeatedly reused among transformer layers.
Therefore, these <span class="ltx_text" id="S3.SS2.p9.1.3">hidden states</span> should be dumped to host storage immediately once they are generated.
However, hidden states’ generation and restoration order are inconsistent, making it hard to design
an efficient storage format to manage <span class="ltx_text" id="S3.SS2.p9.1.4">hidden states</span>. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.F6" title="Figure 6 ‣ 3.2. Restoration Cost Analysis ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">6</span></a>a, the
<span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p9.1.5">HCache</span> is generated autoregressively, exhibiting a <em class="ltx_emph ltx_font_italic" id="S3.SS2.p9.1.6">layer-before-token</em> order.
In state restoration, instead, the <span class="ltx_text" id="S3.SS2.p9.1.7">hidden states</span> of multiple tokens are restored as a batch at each layer
(i.e., <em class="ltx_emph ltx_font_italic" id="S3.SS2.p9.1.8">token-before-layer</em>, Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.F6" title="Figure 6 ‣ 3.2. Restoration Cost Analysis ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">6</span></a>b).
As a result, a storage format optimized for state saving (i.e., placing a token’s <span class="ltx_text" id="S3.SS2.p9.1.9">hidden states</span> at different layers in a continuous place)
incurs random, small-sized IOs at restoration, or vice versa.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span><span class="ltx_text ltx_font_smallcaps" id="S4.1.1">HCache</span> Design</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">To address the above challenges, we further enhance <span class="ltx_text ltx_font_smallcaps" id="S4.p1.1.1">HCache</span> with bubble-free restoration and efficient storage management.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.F7" title="Figure 7 ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">7</span></a> depicts the overall architecture of <span class="ltx_text ltx_font_smallcaps" id="S4.p1.1.2">HCache</span> and
how it interacts with an LLM inference engine.
When a user request arrives, the inference engine first decides whether the request’s history states should be restored.
If so, the inference engine utilizes the bubble-free restoration scheduler (§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1" title="4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4.1</span></a>)
to generate an optimal restoration scheme
to restore its <span class="ltx_text" id="S4.p1.1.3">KV cache</span> (to solve <span class="ltx_text ltx_font_bold" id="S4.p1.1.4">C1</span>). With the restored <span class="ltx_text" id="S4.p1.1.5">KV cache</span>,
the user request is further processed with prompt prefilling and token generation
to generate an answer. During the prefilling and token generation phase, the storage manager (§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS2" title="4.2. HCache Storage Manager ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4.2</span></a>) efficiently
saves the newly computed <span class="ltx_text" id="S4.p1.1.6">hidden states</span> to host storage (to solve <span class="ltx_text ltx_font_bold" id="S4.p1.1.7">C2</span>). Since <span class="ltx_text ltx_font_smallcaps" id="S4.p1.1.8">HCache</span> focuses on state restoration speed, we do not cache and reuse <span class="ltx_text" id="S4.p1.1.9">KV cache</span> in GPU.</p>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1">By default, our storage manager utilizes SSDs as the backend storage devices.
SSDs are cost-effective, offer substantial capacity, and deliver high I/O bandwidth,
making them ideal for storing large volumes of <span class="ltx_text" id="S4.p2.1.1">hidden states</span>.
In environments lacking SSDs, host DRAM can be used as an alternative.
Previous research has suggested using a hierarchical storage backend that combines host DRAM and SSDs <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite>.
They also integrate prefetching and caching strategies, allowing frequently accessed contextual states to reside in the host DRAM.
Contextual state caching is orthogonal to our work and can be incorporated to enhance performance further.</p>
</div>
<figure class="ltx_figure" id="S4.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="414" id="S4.F7.g1" src="x7.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7. </span><span class="ltx_text ltx_font_smallcaps" id="S4.F7.2.1">HCache</span> Overview.</figcaption>
</figure>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1. </span>Bubble-Free Restoration Scheduler</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">The bubble-free restoration scheduler combines different restoration methods dynamically to eliminate
pipeline bubbles. Specifically, the scheduler partitions a model’s state across layers, with most states
be managed via <span class="ltx_text" id="S4.SS1.p1.1.1">hidden states</span>, while using a resource-complementary method (token recomputation or KV offload)
for other states to fill in the bubble.
For example, bubbles exist in transmission when the computation speed is slow, so we offload part
of the model’s state as <span class="ltx_text" id="S4.SS1.p1.1.2">KV cache</span> to prevent the need for computation.
<span class="ltx_text ltx_font_smallcaps" id="S4.SS1.p1.1.3">HCache</span> determines an optimal partition scheme via offline profiling of the
hardware characteristics. We further illustrate how a model’s state should be partitioned (§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1.SSS1" title="4.1.1. State Partition Method ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4.1.1</span></a>)
and the detailed partition algorithm (§<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1.SSS2" title="4.1.2. State Partition Algorithm ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4.1.2</span></a>).</p>
</div>
<section class="ltx_subsubsection" id="S4.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.1. </span>State Partition Method</h4>
<div class="ltx_para" id="S4.SS1.SSS1.p1">
<p class="ltx_p" id="S4.SS1.SSS1.p1.1">When employing different restoration methods to eliminate pipeline bubbles,
model states are partitioned like prior work <cite class="ltx_cite ltx_citemacro_citep">(Narayanan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib37" title="">2019</a>; Feng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib18" title="">2023</a>)</cite>, with each using a different restoration method.
There are two approaches to partitioning the model state: token-wise partition and layer-wise partition.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p2">
<p class="ltx_p" id="S4.SS1.SSS1.p2.2">Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.F8" title="Figure 8 ‣ 4.1.1. State Partition Method ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">8</span></a>a shows a LLM model with 6 layers and a history context containing 3 tokens.
With a token-wise partition scheme, these states are vertically split into two parts,
where the first two tokens are managed via <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS1.p2.2.1">HCache</span> and the rest one is managed using a
complementary method (e.g., KV offload). State restoration with token-wise
partition is shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.F8" title="Figure 8 ‣ 4.1.1. State Partition Method ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">8</span></a>c. At layer <math alttext="i" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p2.1.m1.1"><semantics id="S4.SS1.SSS1.p2.1.m1.1a"><mi id="S4.SS1.SSS1.p2.1.m1.1.1" xref="S4.SS1.SSS1.p2.1.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p2.1.m1.1b"><ci id="S4.SS1.SSS1.p2.1.m1.1.1.cmml" xref="S4.SS1.SSS1.p2.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p2.1.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p2.1.m1.1d">italic_i</annotation></semantics></math>, KV recomputation from
<span class="ltx_text" id="S4.SS1.SSS1.p2.2.2">hidden states</span> of the first two tokens is done concurrently with the transmission of layer <math alttext="i+1" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p2.2.m2.1"><semantics id="S4.SS1.SSS1.p2.2.m2.1a"><mrow id="S4.SS1.SSS1.p2.2.m2.1.1" xref="S4.SS1.SSS1.p2.2.m2.1.1.cmml"><mi id="S4.SS1.SSS1.p2.2.m2.1.1.2" xref="S4.SS1.SSS1.p2.2.m2.1.1.2.cmml">i</mi><mo id="S4.SS1.SSS1.p2.2.m2.1.1.1" xref="S4.SS1.SSS1.p2.2.m2.1.1.1.cmml">+</mo><mn id="S4.SS1.SSS1.p2.2.m2.1.1.3" xref="S4.SS1.SSS1.p2.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p2.2.m2.1b"><apply id="S4.SS1.SSS1.p2.2.m2.1.1.cmml" xref="S4.SS1.SSS1.p2.2.m2.1.1"><plus id="S4.SS1.SSS1.p2.2.m2.1.1.1.cmml" xref="S4.SS1.SSS1.p2.2.m2.1.1.1"></plus><ci id="S4.SS1.SSS1.p2.2.m2.1.1.2.cmml" xref="S4.SS1.SSS1.p2.2.m2.1.1.2">𝑖</ci><cn id="S4.SS1.SSS1.p2.2.m2.1.1.3.cmml" type="integer" xref="S4.SS1.SSS1.p2.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p2.2.m2.1c">i+1</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p2.2.m2.1d">italic_i + 1</annotation></semantics></math> (<span class="ltx_text" id="S4.SS1.SSS1.p2.2.3">hidden states</span>
of the first two tokens and <span class="ltx_text" id="S4.SS1.SSS1.p2.2.4">KV cache</span> of the 3rd token). In layer-wise partition, model states are horizontally
partitioned. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.F8" title="Figure 8 ‣ 4.1.1. State Partition Method ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">8</span></a>b, the first 4 layers of an LLM are managed with
<span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS1.p2.2.5">HCache</span> while the KV cache of the last two layers is offloaded to the host.
State restoration with token-wise partition is shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.F8" title="Figure 8 ‣ 4.1.1. State Partition Method ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">8</span></a>d,
where the transmission of hidden states can occur continuously without requiring synchronization
at each layer, provided it is faster than recomputation. Once complete, the <span class="ltx_text" id="S4.SS1.SSS1.p2.2.6">KV cache</span> of the last two
layers is fetched into GPU memory.</p>
</div>
<figure class="ltx_figure" id="S4.F8">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_figure_panel ltx_img_landscape" height="614" id="S4.F8.g1" src="x8.png" width="830"/></div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 8. </span>Two Ways to Combine <span class="ltx_text ltx_font_smallcaps" id="S4.F8.7.3">HCache</span> with <span class="ltx_text" id="S4.F8.8.4">KV cache</span>. <em class="ltx_emph ltx_font_italic" id="S4.F8.4.2" style="font-size:90%;">
<math alttext="\rm L_{i}" class="ltx_Math" display="inline" id="S4.F8.3.1.1.m1.1"><semantics id="S4.F8.3.1.1.m1.1b"><msub id="S4.F8.3.1.1.m1.1.1" xref="S4.F8.3.1.1.m1.1.1.cmml"><mi id="S4.F8.3.1.1.m1.1.1.2" mathvariant="normal" xref="S4.F8.3.1.1.m1.1.1.2.cmml">L</mi><mi id="S4.F8.3.1.1.m1.1.1.3" mathvariant="normal" xref="S4.F8.3.1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.F8.3.1.1.m1.1c"><apply id="S4.F8.3.1.1.m1.1.1.cmml" xref="S4.F8.3.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.F8.3.1.1.m1.1.1.1.cmml" xref="S4.F8.3.1.1.m1.1.1">subscript</csymbol><ci id="S4.F8.3.1.1.m1.1.1.2.cmml" xref="S4.F8.3.1.1.m1.1.1.2">L</ci><ci id="S4.F8.3.1.1.m1.1.1.3.cmml" xref="S4.F8.3.1.1.m1.1.1.3">i</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F8.3.1.1.m1.1d">\rm L_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.F8.3.1.1.m1.1e">roman_L start_POSTSUBSCRIPT roman_i end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\rm Tj" class="ltx_Math" display="inline" id="S4.F8.4.2.2.m2.1"><semantics id="S4.F8.4.2.2.m2.1b"><mi id="S4.F8.4.2.2.m2.1.1" xref="S4.F8.4.2.2.m2.1.1.cmml">Tj</mi><annotation-xml encoding="MathML-Content" id="S4.F8.4.2.2.m2.1c"><ci id="S4.F8.4.2.2.m2.1.1.cmml" xref="S4.F8.4.2.2.m2.1.1">Tj</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F8.4.2.2.m2.1d">\rm Tj</annotation><annotation encoding="application/x-llamapun" id="S4.F8.4.2.2.m2.1e">roman_Tj</annotation></semantics></math> indicate layer i and token j, respectively.
</em></figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<p class="ltx_p ltx_figure_panel" id="S4.F8.9">.</p>
</div>
</div>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSS1.p3">
<p class="ltx_p" id="S4.SS1.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSS1.p3.1.1">Performance considerations.</span>
In practice, token-wise partition does not always fully eliminate the bubbles in state restoration.
We observe that the execution time of GEMM operations does not vary proportionally with the number of tokens involved.
The GEMM kernel in the cuBLAS library is well-optimized for standard matrix sizes. However, the token-wise
partition can generate a scheme that forms an irregular matrix and is less optimized by cuBLAS.
As a result, executing a GEMM kernel with fewer tokens may consume a similar amount of time as one with more tokens.
Even if we round the partition scheme to the nearest optimized size, bubbles still exist in the computation
and transmission, resulting in suboptimal performance.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p4">
<p class="ltx_p" id="S4.SS1.SSS1.p4.1">Such a performance issue does not exist in layer-wise partition since all tokens at a layer are recomputed together.
Furthermore, current LLM engines typically set a fixed mini-batch length to limit the intermediate buffer size and
sequences larger than a mini-batch will be split and processed sequentially.
Hence, We use the layer-wise partition and set the mini-batch length to be an optimized size in cuBLAS.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.2. </span>State Partition Algorithm</h4>
<div class="ltx_para" id="S4.SS1.SSS2.p1">
<p class="ltx_p" id="S4.SS1.SSS2.p1.2">We introduce the state partition algorithm to generate a bubble-free restoration scheme according to the hardware
setups. We introduce two variables – <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p1.1.m1.1"><semantics id="S4.SS1.SSS2.p1.1.m1.1a"><msub id="S4.SS1.SSS2.p1.1.m1.1.1" xref="S4.SS1.SSS2.p1.1.m1.1.1.cmml"><mi id="S4.SS1.SSS2.p1.1.m1.1.1.2" xref="S4.SS1.SSS2.p1.1.m1.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p1.1.m1.1.1.3" xref="S4.SS1.SSS2.p1.1.m1.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p1.1.m1.1b"><apply id="S4.SS1.SSS2.p1.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p1.1.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p1.1.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p1.1.m1.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p1.1.m1.1.1.3.cmml" xref="S4.SS1.SSS2.p1.1.m1.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p1.1.m1.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p1.2.m2.1"><semantics id="S4.SS1.SSS2.p1.2.m2.1a"><msub id="S4.SS1.SSS2.p1.2.m2.1.1" xref="S4.SS1.SSS2.p1.2.m2.1.1.cmml"><mi id="S4.SS1.SSS2.p1.2.m2.1.1.2" xref="S4.SS1.SSS2.p1.2.m2.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p1.2.m2.1.1.3" xref="S4.SS1.SSS2.p1.2.m2.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p1.2.m2.1b"><apply id="S4.SS1.SSS2.p1.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p1.2.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p1.2.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p1.2.m2.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p1.2.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p1.2.m2.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p1.2.m2.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p1.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> – to indicate the
number of model layers managed with <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p1.2.1">HCache</span> and other methods, respectively.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p2">
<p class="ltx_p" id="S4.SS1.SSS2.p2.5">Specifically, on a platform with faster computation speed, <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p2.5.1">HCache</span> is combined with token recomputation,
where the first <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p2.1.m1.1"><semantics id="S4.SS1.SSS2.p2.1.m1.1a"><msub id="S4.SS1.SSS2.p2.1.m1.1.1" xref="S4.SS1.SSS2.p2.1.m1.1.1.cmml"><mi id="S4.SS1.SSS2.p2.1.m1.1.1.2" xref="S4.SS1.SSS2.p2.1.m1.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p2.1.m1.1.1.3" xref="S4.SS1.SSS2.p2.1.m1.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.1.m1.1b"><apply id="S4.SS1.SSS2.p2.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.1.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.1.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p2.1.m1.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p2.1.m1.1.1.3.cmml" xref="S4.SS1.SSS2.p2.1.m1.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.1.m1.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p2.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> layers are restored with token recomputation, and the
remaining <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p2.2.m2.1"><semantics id="S4.SS1.SSS2.p2.2.m2.1a"><msub id="S4.SS1.SSS2.p2.2.m2.1.1" xref="S4.SS1.SSS2.p2.2.m2.1.1.cmml"><mi id="S4.SS1.SSS2.p2.2.m2.1.1.2" xref="S4.SS1.SSS2.p2.2.m2.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p2.2.m2.1.1.3" xref="S4.SS1.SSS2.p2.2.m2.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.2.m2.1b"><apply id="S4.SS1.SSS2.p2.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.2.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.2.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p2.2.m2.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p2.2.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p2.2.m2.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.2.m2.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p2.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> layers with <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p2.5.2">HCache</span>. When recompute of the first <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p2.3.m3.1"><semantics id="S4.SS1.SSS2.p2.3.m3.1a"><msub id="S4.SS1.SSS2.p2.3.m3.1.1" xref="S4.SS1.SSS2.p2.3.m3.1.1.cmml"><mi id="S4.SS1.SSS2.p2.3.m3.1.1.2" xref="S4.SS1.SSS2.p2.3.m3.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p2.3.m3.1.1.3" xref="S4.SS1.SSS2.p2.3.m3.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.3.m3.1b"><apply id="S4.SS1.SSS2.p2.3.m3.1.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.3.m3.1.1.1.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.3.m3.1.1.2.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p2.3.m3.1.1.3.cmml" xref="S4.SS1.SSS2.p2.3.m3.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.3.m3.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p2.3.m3.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> layers. The <span class="ltx_text" id="S4.SS1.SSS2.p2.5.3">hidden states</span> of the
latter layers are prefetched. When token recomputation finishes, <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p2.5.4">HCache</span> restoration is started to continue the computation.
On a platform with faster I/O transmission speed, <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p2.5.5">HCache</span> is combined with KV offload.
For the first <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p2.4.m4.1"><semantics id="S4.SS1.SSS2.p2.4.m4.1a"><msub id="S4.SS1.SSS2.p2.4.m4.1.1" xref="S4.SS1.SSS2.p2.4.m4.1.1.cmml"><mi id="S4.SS1.SSS2.p2.4.m4.1.1.2" xref="S4.SS1.SSS2.p2.4.m4.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p2.4.m4.1.1.3" xref="S4.SS1.SSS2.p2.4.m4.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.4.m4.1b"><apply id="S4.SS1.SSS2.p2.4.m4.1.1.cmml" xref="S4.SS1.SSS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.4.m4.1.1.1.cmml" xref="S4.SS1.SSS2.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.4.m4.1.1.2.cmml" xref="S4.SS1.SSS2.p2.4.m4.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p2.4.m4.1.1.3.cmml" xref="S4.SS1.SSS2.p2.4.m4.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.4.m4.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p2.4.m4.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> layers, we copy their <span class="ltx_text" id="S4.SS1.SSS2.p2.5.6">hidden states</span> and recompute them to restore the <span class="ltx_text" id="S4.SS1.SSS2.p2.5.7">KV cache</span>.
Since the I/O transmission of <span class="ltx_text" id="S4.SS1.SSS2.p2.5.8">hidden states</span> is faster, it will finish earlier than the computation,
so we copy the <span class="ltx_text" id="S4.SS1.SSS2.p2.5.9">KV cache</span> of the rest <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p2.5.m5.1"><semantics id="S4.SS1.SSS2.p2.5.m5.1a"><msub id="S4.SS1.SSS2.p2.5.m5.1.1" xref="S4.SS1.SSS2.p2.5.m5.1.1.cmml"><mi id="S4.SS1.SSS2.p2.5.m5.1.1.2" xref="S4.SS1.SSS2.p2.5.m5.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p2.5.m5.1.1.3" xref="S4.SS1.SSS2.p2.5.m5.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p2.5.m5.1b"><apply id="S4.SS1.SSS2.p2.5.m5.1.1.cmml" xref="S4.SS1.SSS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p2.5.m5.1.1.1.cmml" xref="S4.SS1.SSS2.p2.5.m5.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p2.5.m5.1.1.2.cmml" xref="S4.SS1.SSS2.p2.5.m5.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p2.5.m5.1.1.3.cmml" xref="S4.SS1.SSS2.p2.5.m5.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p2.5.m5.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p2.5.m5.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> layers in the remaining time.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p3">
<p class="ltx_p" id="S4.SS1.SSS2.p3.8">Our state partition algorithm sets <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.1.m1.1"><semantics id="S4.SS1.SSS2.p3.1.m1.1a"><msub id="S4.SS1.SSS2.p3.1.m1.1.1" xref="S4.SS1.SSS2.p3.1.m1.1.1.cmml"><mi id="S4.SS1.SSS2.p3.1.m1.1.1.2" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.1.m1.1.1.3" xref="S4.SS1.SSS2.p3.1.m1.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.1.m1.1b"><apply id="S4.SS1.SSS2.p3.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.1.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.1.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.1.m1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.1.m1.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.2.m2.1"><semantics id="S4.SS1.SSS2.p3.2.m2.1a"><msub id="S4.SS1.SSS2.p3.2.m2.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.cmml"><mi id="S4.SS1.SSS2.p3.2.m2.1.1.2" xref="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.2.m2.1.1.3" xref="S4.SS1.SSS2.p3.2.m2.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.2.m2.1b"><apply id="S4.SS1.SSS2.p3.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.2.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.2.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.2.m2.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.2.m2.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> such that data transmission and computation
finish almost simultaneously, thus eliminating bubbles. To solve <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.3.m3.1"><semantics id="S4.SS1.SSS2.p3.3.m3.1a"><msub id="S4.SS1.SSS2.p3.3.m3.1.1" xref="S4.SS1.SSS2.p3.3.m3.1.1.cmml"><mi id="S4.SS1.SSS2.p3.3.m3.1.1.2" xref="S4.SS1.SSS2.p3.3.m3.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.3.m3.1.1.3" xref="S4.SS1.SSS2.p3.3.m3.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.3.m3.1b"><apply id="S4.SS1.SSS2.p3.3.m3.1.1.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.3.m3.1.1.1.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.3.m3.1.1.2.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.3.m3.1.1.3.cmml" xref="S4.SS1.SSS2.p3.3.m3.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.3.m3.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.3.m3.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.4.m4.1"><semantics id="S4.SS1.SSS2.p3.4.m4.1a"><msub id="S4.SS1.SSS2.p3.4.m4.1.1" xref="S4.SS1.SSS2.p3.4.m4.1.1.cmml"><mi id="S4.SS1.SSS2.p3.4.m4.1.1.2" xref="S4.SS1.SSS2.p3.4.m4.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.4.m4.1.1.3" xref="S4.SS1.SSS2.p3.4.m4.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.4.m4.1b"><apply id="S4.SS1.SSS2.p3.4.m4.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.4.m4.1.1.1.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.4.m4.1.1.2.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.4.m4.1.1.3.cmml" xref="S4.SS1.SSS2.p3.4.m4.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.4.m4.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.4.m4.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math>, we profile the transmission and computation speed of a
specific hardware platform offline, where the transmission time of <span class="ltx_text" id="S4.SS1.SSS2.p3.8.1">hidden states</span> is <math alttext="IO_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.5.m5.1"><semantics id="S4.SS1.SSS2.p3.5.m5.1a"><mrow id="S4.SS1.SSS2.p3.5.m5.1.1" xref="S4.SS1.SSS2.p3.5.m5.1.1.cmml"><mi id="S4.SS1.SSS2.p3.5.m5.1.1.2" xref="S4.SS1.SSS2.p3.5.m5.1.1.2.cmml">I</mi><mo id="S4.SS1.SSS2.p3.5.m5.1.1.1" xref="S4.SS1.SSS2.p3.5.m5.1.1.1.cmml">⁢</mo><msub id="S4.SS1.SSS2.p3.5.m5.1.1.3" xref="S4.SS1.SSS2.p3.5.m5.1.1.3.cmml"><mi id="S4.SS1.SSS2.p3.5.m5.1.1.3.2" xref="S4.SS1.SSS2.p3.5.m5.1.1.3.2.cmml">O</mi><mi id="S4.SS1.SSS2.p3.5.m5.1.1.3.3" xref="S4.SS1.SSS2.p3.5.m5.1.1.3.3.cmml">H</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.5.m5.1b"><apply id="S4.SS1.SSS2.p3.5.m5.1.1.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1"><times id="S4.SS1.SSS2.p3.5.m5.1.1.1.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.1"></times><ci id="S4.SS1.SSS2.p3.5.m5.1.1.2.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.2">𝐼</ci><apply id="S4.SS1.SSS2.p3.5.m5.1.1.3.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.5.m5.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.3">subscript</csymbol><ci id="S4.SS1.SSS2.p3.5.m5.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.3.2">𝑂</ci><ci id="S4.SS1.SSS2.p3.5.m5.1.1.3.3.cmml" xref="S4.SS1.SSS2.p3.5.m5.1.1.3.3">𝐻</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.5.m5.1c">IO_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.5.m5.1d">italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math>,
transmission time of <span class="ltx_text" id="S4.SS1.SSS2.p3.8.2">KV cache</span> is <math alttext="IO_{KV}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.6.m6.1"><semantics id="S4.SS1.SSS2.p3.6.m6.1a"><mrow id="S4.SS1.SSS2.p3.6.m6.1.1" xref="S4.SS1.SSS2.p3.6.m6.1.1.cmml"><mi id="S4.SS1.SSS2.p3.6.m6.1.1.2" xref="S4.SS1.SSS2.p3.6.m6.1.1.2.cmml">I</mi><mo id="S4.SS1.SSS2.p3.6.m6.1.1.1" xref="S4.SS1.SSS2.p3.6.m6.1.1.1.cmml">⁢</mo><msub id="S4.SS1.SSS2.p3.6.m6.1.1.3" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.cmml"><mi id="S4.SS1.SSS2.p3.6.m6.1.1.3.2" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.2.cmml">O</mi><mrow id="S4.SS1.SSS2.p3.6.m6.1.1.3.3" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.cmml"><mi id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.2" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.2.cmml">K</mi><mo id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.1" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.3" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.3.cmml">V</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.6.m6.1b"><apply id="S4.SS1.SSS2.p3.6.m6.1.1.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1"><times id="S4.SS1.SSS2.p3.6.m6.1.1.1.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.1"></times><ci id="S4.SS1.SSS2.p3.6.m6.1.1.2.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.2">𝐼</ci><apply id="S4.SS1.SSS2.p3.6.m6.1.1.3.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.6.m6.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3">subscript</csymbol><ci id="S4.SS1.SSS2.p3.6.m6.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.2">𝑂</ci><apply id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3"><times id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.1.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.1"></times><ci id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.2.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.2">𝐾</ci><ci id="S4.SS1.SSS2.p3.6.m6.1.1.3.3.3.cmml" xref="S4.SS1.SSS2.p3.6.m6.1.1.3.3.3">𝑉</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.6.m6.1c">IO_{KV}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.6.m6.1d">italic_I italic_O start_POSTSUBSCRIPT italic_K italic_V end_POSTSUBSCRIPT</annotation></semantics></math>, computation time from token is <math alttext="C_{Token}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.7.m7.1"><semantics id="S4.SS1.SSS2.p3.7.m7.1a"><msub id="S4.SS1.SSS2.p3.7.m7.1.1" xref="S4.SS1.SSS2.p3.7.m7.1.1.cmml"><mi id="S4.SS1.SSS2.p3.7.m7.1.1.2" xref="S4.SS1.SSS2.p3.7.m7.1.1.2.cmml">C</mi><mrow id="S4.SS1.SSS2.p3.7.m7.1.1.3" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.cmml"><mi id="S4.SS1.SSS2.p3.7.m7.1.1.3.2" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.2.cmml">T</mi><mo id="S4.SS1.SSS2.p3.7.m7.1.1.3.1" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.7.m7.1.1.3.3" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.3.cmml">o</mi><mo id="S4.SS1.SSS2.p3.7.m7.1.1.3.1a" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.7.m7.1.1.3.4" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.4.cmml">k</mi><mo id="S4.SS1.SSS2.p3.7.m7.1.1.3.1b" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.7.m7.1.1.3.5" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.5.cmml">e</mi><mo id="S4.SS1.SSS2.p3.7.m7.1.1.3.1c" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.7.m7.1.1.3.6" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.6.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.7.m7.1b"><apply id="S4.SS1.SSS2.p3.7.m7.1.1.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.7.m7.1.1.1.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.7.m7.1.1.2.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.2">𝐶</ci><apply id="S4.SS1.SSS2.p3.7.m7.1.1.3.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3"><times id="S4.SS1.SSS2.p3.7.m7.1.1.3.1.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.1"></times><ci id="S4.SS1.SSS2.p3.7.m7.1.1.3.2.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.2">𝑇</ci><ci id="S4.SS1.SSS2.p3.7.m7.1.1.3.3.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.3">𝑜</ci><ci id="S4.SS1.SSS2.p3.7.m7.1.1.3.4.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.4">𝑘</ci><ci id="S4.SS1.SSS2.p3.7.m7.1.1.3.5.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.5">𝑒</ci><ci id="S4.SS1.SSS2.p3.7.m7.1.1.3.6.cmml" xref="S4.SS1.SSS2.p3.7.m7.1.1.3.6">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.7.m7.1c">C_{Token}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.7.m7.1d">italic_C start_POSTSUBSCRIPT italic_T italic_o italic_k italic_e italic_n end_POSTSUBSCRIPT</annotation></semantics></math>, from <span class="ltx_text" id="S4.SS1.SSS2.p3.8.3">hidden states</span> to <span class="ltx_text" id="S4.SS1.SSS2.p3.8.4">KV cache</span> is <math alttext="C_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.8.m8.1"><semantics id="S4.SS1.SSS2.p3.8.m8.1a"><msub id="S4.SS1.SSS2.p3.8.m8.1.1" xref="S4.SS1.SSS2.p3.8.m8.1.1.cmml"><mi id="S4.SS1.SSS2.p3.8.m8.1.1.2" xref="S4.SS1.SSS2.p3.8.m8.1.1.2.cmml">C</mi><mi id="S4.SS1.SSS2.p3.8.m8.1.1.3" xref="S4.SS1.SSS2.p3.8.m8.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.8.m8.1b"><apply id="S4.SS1.SSS2.p3.8.m8.1.1.cmml" xref="S4.SS1.SSS2.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.8.m8.1.1.1.cmml" xref="S4.SS1.SSS2.p3.8.m8.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.8.m8.1.1.2.cmml" xref="S4.SS1.SSS2.p3.8.m8.1.1.2">𝐶</ci><ci id="S4.SS1.SSS2.p3.8.m8.1.1.3.cmml" xref="S4.SS1.SSS2.p3.8.m8.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.8.m8.1c">C_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.8.m8.1d">italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math>.
We formulate the bubble-free target as a min-max optimization problem. Below is an example of combining <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS2.p3.8.5">HCache</span> with <span class="ltx_text" id="S4.SS1.SSS2.p3.8.6">KV cache</span>:</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S4.Ex13">
<tbody id="S4.Ex13X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\operatorname*{argmin}_{L_{H},L_{O}}\max" class="ltx_Math" display="inline" id="S4.Ex13X.2.1.1.m1.2"><semantics id="S4.Ex13X.2.1.1.m1.2a"><mrow id="S4.Ex13X.2.1.1.m1.2.3" xref="S4.Ex13X.2.1.1.m1.2.3.cmml"><munder id="S4.Ex13X.2.1.1.m1.2.3.1" xref="S4.Ex13X.2.1.1.m1.2.3.1.cmml"><mo id="S4.Ex13X.2.1.1.m1.2.3.1.2" xref="S4.Ex13X.2.1.1.m1.2.3.1.2.cmml">argmin</mo><mrow id="S4.Ex13X.2.1.1.m1.2.2.2.2" xref="S4.Ex13X.2.1.1.m1.2.2.2.3.cmml"><msub id="S4.Ex13X.2.1.1.m1.1.1.1.1.1" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1.cmml"><mi id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.2" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1.2.cmml">L</mi><mi id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.3" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1.3.cmml">H</mi></msub><mo id="S4.Ex13X.2.1.1.m1.2.2.2.2.3" xref="S4.Ex13X.2.1.1.m1.2.2.2.3.cmml">,</mo><msub id="S4.Ex13X.2.1.1.m1.2.2.2.2.2" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2.cmml"><mi id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.2" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2.2.cmml">L</mi><mi id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.3" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2.3.cmml">O</mi></msub></mrow></munder><mi id="S4.Ex13X.2.1.1.m1.2.3.2" xref="S4.Ex13X.2.1.1.m1.2.3.2.cmml">max</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex13X.2.1.1.m1.2b"><apply id="S4.Ex13X.2.1.1.m1.2.3.cmml" xref="S4.Ex13X.2.1.1.m1.2.3"><apply id="S4.Ex13X.2.1.1.m1.2.3.1.cmml" xref="S4.Ex13X.2.1.1.m1.2.3.1"><csymbol cd="ambiguous" id="S4.Ex13X.2.1.1.m1.2.3.1.1.cmml" xref="S4.Ex13X.2.1.1.m1.2.3.1">subscript</csymbol><ci id="S4.Ex13X.2.1.1.m1.2.3.1.2.cmml" xref="S4.Ex13X.2.1.1.m1.2.3.1.2">argmin</ci><list id="S4.Ex13X.2.1.1.m1.2.2.2.3.cmml" xref="S4.Ex13X.2.1.1.m1.2.2.2.2"><apply id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.cmml" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.1.cmml" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.2.cmml" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1.2">𝐿</ci><ci id="S4.Ex13X.2.1.1.m1.1.1.1.1.1.3.cmml" xref="S4.Ex13X.2.1.1.m1.1.1.1.1.1.3">𝐻</ci></apply><apply id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.cmml" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.1.cmml" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2">subscript</csymbol><ci id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.2.cmml" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2.2">𝐿</ci><ci id="S4.Ex13X.2.1.1.m1.2.2.2.2.2.3.cmml" xref="S4.Ex13X.2.1.1.m1.2.2.2.2.2.3">𝑂</ci></apply></list></apply><max id="S4.Ex13X.2.1.1.m1.2.3.2.cmml" xref="S4.Ex13X.2.1.1.m1.2.3.2"></max></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex13X.2.1.1.m1.2c">\displaystyle\operatorname*{argmin}_{L_{H},L_{O}}\max</annotation><annotation encoding="application/x-llamapun" id="S4.Ex13X.2.1.1.m1.2d">roman_argmin start_POSTSUBSCRIPT italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT , italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT end_POSTSUBSCRIPT roman_max</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle(C_{H}*L_{H},IO_{H}*L_{H}+IO_{KV}*L_{O})" class="ltx_Math" display="inline" id="S4.Ex13X.3.2.2.m1.2"><semantics id="S4.Ex13X.3.2.2.m1.2a"><mrow id="S4.Ex13X.3.2.2.m1.2.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.3.cmml"><mo id="S4.Ex13X.3.2.2.m1.2.2.2.3" stretchy="false" xref="S4.Ex13X.3.2.2.m1.2.2.3.cmml">(</mo><mrow id="S4.Ex13X.3.2.2.m1.1.1.1.1" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.cmml"><msub id="S4.Ex13X.3.2.2.m1.1.1.1.1.2" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2.cmml"><mi id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.2" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2.2.cmml">C</mi><mi id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.3" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2.3.cmml">H</mi></msub><mo id="S4.Ex13X.3.2.2.m1.1.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.1.cmml">∗</mo><msub id="S4.Ex13X.3.2.2.m1.1.1.1.1.3" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.2" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3.2.cmml">L</mi><mi id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.3" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex13X.3.2.2.m1.2.2.2.4" xref="S4.Ex13X.3.2.2.m1.2.2.3.cmml">,</mo><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.cmml"><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.cmml"><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.2.cmml">I</mi><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.1" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.1.cmml">⁢</mo><msub id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.2.cmml">O</mi><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.1" lspace="0.222em" rspace="0.222em" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.1.cmml">∗</mo><msub id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.2.cmml">L</mi><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.1" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.1.cmml">+</mo><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.cmml"><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.2.cmml">I</mi><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.1" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.1.cmml">⁢</mo><msub id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.2.cmml">O</mi><mrow id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.2.cmml">K</mi><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.1" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.3.cmml">V</mi></mrow></msub></mrow><mo id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.1" lspace="0.222em" rspace="0.222em" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.1.cmml">∗</mo><msub id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.cmml"><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.2" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.2.cmml">L</mi><mi id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.3" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.3.cmml">O</mi></msub></mrow></mrow><mo id="S4.Ex13X.3.2.2.m1.2.2.2.5" stretchy="false" xref="S4.Ex13X.3.2.2.m1.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex13X.3.2.2.m1.2b"><interval closure="open" id="S4.Ex13X.3.2.2.m1.2.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2"><apply id="S4.Ex13X.3.2.2.m1.1.1.1.1.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1"><times id="S4.Ex13X.3.2.2.m1.1.1.1.1.1.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.1"></times><apply id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.1.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2.2">𝐶</ci><ci id="S4.Ex13X.3.2.2.m1.1.1.1.1.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.2.3">𝐻</ci></apply><apply id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3.2">𝐿</ci><ci id="S4.Ex13X.3.2.2.m1.1.1.1.1.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.1.1.1.1.3.3">𝐻</ci></apply></apply><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2"><plus id="S4.Ex13X.3.2.2.m1.2.2.2.2.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.1"></plus><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2"><times id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.1"></times><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2"><times id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.1"></times><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.2">𝐼</ci><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.2">𝑂</ci><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.2.3.3">𝐻</ci></apply></apply><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.2">𝐿</ci><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.2.3.3">𝐻</ci></apply></apply><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3"><times id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.1"></times><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2"><times id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.1"></times><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.2">𝐼</ci><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.2">𝑂</ci><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3"><times id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.1"></times><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.2">𝐾</ci><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.2.3.3.3">𝑉</ci></apply></apply></apply><apply id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3"><csymbol cd="ambiguous" id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.1.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3">subscript</csymbol><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.2.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.2">𝐿</ci><ci id="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.3.cmml" xref="S4.Ex13X.3.2.2.m1.2.2.2.2.3.3.3">𝑂</ci></apply></apply></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex13X.3.2.2.m1.2c">\displaystyle(C_{H}*L_{H},IO_{H}*L_{H}+IO_{KV}*L_{O})</annotation><annotation encoding="application/x-llamapun" id="S4.Ex13X.3.2.2.m1.2d">( italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT ∗ italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT , italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT ∗ italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT + italic_I italic_O start_POSTSUBSCRIPT italic_K italic_V end_POSTSUBSCRIPT ∗ italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S4.Ex13Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><span class="ltx_text ltx_markedasmath ltx_font_italic" id="S4.Ex13Xa.2.1.1.1">subject to</span></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\ L_{H}+L_{O}=N_{Layer}" class="ltx_Math" display="inline" id="S4.Ex13Xa.3.2.2.m1.1"><semantics id="S4.Ex13Xa.3.2.2.m1.1a"><mrow id="S4.Ex13Xa.3.2.2.m1.1.1" xref="S4.Ex13Xa.3.2.2.m1.1.1.cmml"><mrow id="S4.Ex13Xa.3.2.2.m1.1.1.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.cmml"><msub id="S4.Ex13Xa.3.2.2.m1.1.1.2.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2.cmml"><mi id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2.2.cmml">L</mi><mi id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2.3.cmml">H</mi></msub><mo id="S4.Ex13Xa.3.2.2.m1.1.1.2.1" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.1.cmml">+</mo><msub id="S4.Ex13Xa.3.2.2.m1.1.1.2.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3.cmml"><mi id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3.2.cmml">L</mi><mi id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3.3.cmml">O</mi></msub></mrow><mo id="S4.Ex13Xa.3.2.2.m1.1.1.1" xref="S4.Ex13Xa.3.2.2.m1.1.1.1.cmml">=</mo><msub id="S4.Ex13Xa.3.2.2.m1.1.1.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.cmml"><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.2.cmml">N</mi><mrow id="S4.Ex13Xa.3.2.2.m1.1.1.3.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.cmml"><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.2" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.2.cmml">L</mi><mo id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.3" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.3.cmml">a</mi><mo id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1a" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.4" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.4.cmml">y</mi><mo id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1b" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.5" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.5.cmml">e</mi><mo id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1c" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.6" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.6.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex13Xa.3.2.2.m1.1b"><apply id="S4.Ex13Xa.3.2.2.m1.1.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1"><eq id="S4.Ex13Xa.3.2.2.m1.1.1.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.1"></eq><apply id="S4.Ex13Xa.3.2.2.m1.1.1.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2"><plus id="S4.Ex13Xa.3.2.2.m1.1.1.2.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.1"></plus><apply id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2"><csymbol cd="ambiguous" id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2">subscript</csymbol><ci id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2.2">𝐿</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.2.2.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.2.3">𝐻</ci></apply><apply id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3"><csymbol cd="ambiguous" id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3">subscript</csymbol><ci id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3.2">𝐿</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.2.3.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.2.3.3">𝑂</ci></apply></apply><apply id="S4.Ex13Xa.3.2.2.m1.1.1.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3"><csymbol cd="ambiguous" id="S4.Ex13Xa.3.2.2.m1.1.1.3.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3">subscript</csymbol><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.2">𝑁</ci><apply id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3"><times id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.1"></times><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.2.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.2">𝐿</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.3.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.3">𝑎</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.4.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.4">𝑦</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.5.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.5">𝑒</ci><ci id="S4.Ex13Xa.3.2.2.m1.1.1.3.3.6.cmml" xref="S4.Ex13Xa.3.2.2.m1.1.1.3.3.6">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex13Xa.3.2.2.m1.1c">\displaystyle\ L_{H}+L_{O}=N_{Layer}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex13Xa.3.2.2.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT = italic_N start_POSTSUBSCRIPT italic_L italic_a italic_y italic_e italic_r end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.SSS2.p3.10">Given a hardware configuration, <math alttext="L_{H}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.9.m1.1"><semantics id="S4.SS1.SSS2.p3.9.m1.1a"><msub id="S4.SS1.SSS2.p3.9.m1.1.1" xref="S4.SS1.SSS2.p3.9.m1.1.1.cmml"><mi id="S4.SS1.SSS2.p3.9.m1.1.1.2" xref="S4.SS1.SSS2.p3.9.m1.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.9.m1.1.1.3" xref="S4.SS1.SSS2.p3.9.m1.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.9.m1.1b"><apply id="S4.SS1.SSS2.p3.9.m1.1.1.cmml" xref="S4.SS1.SSS2.p3.9.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.9.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.9.m1.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.9.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.9.m1.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.9.m1.1.1.3.cmml" xref="S4.SS1.SSS2.p3.9.m1.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.9.m1.1c">L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.9.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{O}" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.10.m2.1"><semantics id="S4.SS1.SSS2.p3.10.m2.1a"><msub id="S4.SS1.SSS2.p3.10.m2.1.1" xref="S4.SS1.SSS2.p3.10.m2.1.1.cmml"><mi id="S4.SS1.SSS2.p3.10.m2.1.1.2" xref="S4.SS1.SSS2.p3.10.m2.1.1.2.cmml">L</mi><mi id="S4.SS1.SSS2.p3.10.m2.1.1.3" xref="S4.SS1.SSS2.p3.10.m2.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.10.m2.1b"><apply id="S4.SS1.SSS2.p3.10.m2.1.1.cmml" xref="S4.SS1.SSS2.p3.10.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.SSS2.p3.10.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p3.10.m2.1.1">subscript</csymbol><ci id="S4.SS1.SSS2.p3.10.m2.1.1.2.cmml" xref="S4.SS1.SSS2.p3.10.m2.1.1.2">𝐿</ci><ci id="S4.SS1.SSS2.p3.10.m2.1.1.3.cmml" xref="S4.SS1.SSS2.p3.10.m2.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.10.m2.1c">L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.10.m2.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math> are derived via:</p>
<table class="ltx_equationgroup ltx_eqn_table" id="S4.Ex14">
<tbody id="S4.Ex14X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle L_{H}" class="ltx_Math" display="inline" id="S4.Ex14X.2.1.1.m1.1"><semantics id="S4.Ex14X.2.1.1.m1.1a"><msub id="S4.Ex14X.2.1.1.m1.1.1" xref="S4.Ex14X.2.1.1.m1.1.1.cmml"><mi id="S4.Ex14X.2.1.1.m1.1.1.2" xref="S4.Ex14X.2.1.1.m1.1.1.2.cmml">L</mi><mi id="S4.Ex14X.2.1.1.m1.1.1.3" xref="S4.Ex14X.2.1.1.m1.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.Ex14X.2.1.1.m1.1b"><apply id="S4.Ex14X.2.1.1.m1.1.1.cmml" xref="S4.Ex14X.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.Ex14X.2.1.1.m1.1.1.1.cmml" xref="S4.Ex14X.2.1.1.m1.1.1">subscript</csymbol><ci id="S4.Ex14X.2.1.1.m1.1.1.2.cmml" xref="S4.Ex14X.2.1.1.m1.1.1.2">𝐿</ci><ci id="S4.Ex14X.2.1.1.m1.1.1.3.cmml" xref="S4.Ex14X.2.1.1.m1.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14X.2.1.1.m1.1c">\displaystyle L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14X.2.1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\lceil\frac{N_{Layer}*IO_{KV}}{IO_{KV}+C_{H}-IO_{H}}\rceil,~{}~{%
}~{}\mathit{if}\ C_{H}&gt;IO_{H}" class="ltx_Math" display="inline" id="S4.Ex14X.3.2.2.m1.3"><semantics id="S4.Ex14X.3.2.2.m1.3a"><mrow id="S4.Ex14X.3.2.2.m1.3.3.2" xref="S4.Ex14X.3.2.2.m1.3.3.3.cmml"><mrow id="S4.Ex14X.3.2.2.m1.2.2.1.1" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.cmml"><mi id="S4.Ex14X.3.2.2.m1.2.2.1.1.2" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.2.cmml"></mi><mo id="S4.Ex14X.3.2.2.m1.2.2.1.1.1" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.1.cmml">=</mo><mrow id="S4.Ex14X.3.2.2.m1.2.2.1.1.3.2" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.3.1.cmml"><mo id="S4.Ex14X.3.2.2.m1.2.2.1.1.3.2.1" stretchy="false" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.3.1.1.cmml">⌈</mo><mstyle displaystyle="true" id="S4.Ex14X.3.2.2.m1.1.1" xref="S4.Ex14X.3.2.2.m1.1.1.cmml"><mfrac id="S4.Ex14X.3.2.2.m1.1.1a" xref="S4.Ex14X.3.2.2.m1.1.1.cmml"><mrow id="S4.Ex14X.3.2.2.m1.1.1.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.cmml"><mrow id="S4.Ex14X.3.2.2.m1.1.1.2.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.cmml"><msub id="S4.Ex14X.3.2.2.m1.1.1.2.2.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.2.cmml">N</mi><mrow id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.2.cmml">L</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.3.cmml">a</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1a" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.4" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.4.cmml">y</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1b" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.5" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.5.cmml">e</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1c" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.6" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.6.cmml">r</mi></mrow></msub><mo id="S4.Ex14X.3.2.2.m1.1.1.2.2.1" lspace="0.222em" rspace="0.222em" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.1.cmml">∗</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.2.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.3.cmml">I</mi></mrow><mo id="S4.Ex14X.3.2.2.m1.1.1.2.1" xref="S4.Ex14X.3.2.2.m1.1.1.2.1.cmml">⁢</mo><msub id="S4.Ex14X.3.2.2.m1.1.1.2.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.2.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.2.cmml">O</mi><mrow id="S4.Ex14X.3.2.2.m1.1.1.2.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.2.cmml">K</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.1" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.3.cmml">V</mi></mrow></msub></mrow><mrow id="S4.Ex14X.3.2.2.m1.1.1.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.cmml"><mrow id="S4.Ex14X.3.2.2.m1.1.1.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.cmml"><mrow id="S4.Ex14X.3.2.2.m1.1.1.3.2.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.2.cmml">I</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.1" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.1.cmml">⁢</mo><msub id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.2.cmml">O</mi><mrow id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.2.cmml">K</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.1" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.3.cmml">V</mi></mrow></msub></mrow><mo id="S4.Ex14X.3.2.2.m1.1.1.3.2.1" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.1.cmml">+</mo><msub id="S4.Ex14X.3.2.2.m1.1.1.3.2.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3.2.cmml">C</mi><mi id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex14X.3.2.2.m1.1.1.3.1" xref="S4.Ex14X.3.2.2.m1.1.1.3.1.cmml">−</mo><mrow id="S4.Ex14X.3.2.2.m1.1.1.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.2.cmml">I</mi><mo id="S4.Ex14X.3.2.2.m1.1.1.3.3.1" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.1.cmml">⁢</mo><msub id="S4.Ex14X.3.2.2.m1.1.1.3.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.2" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3.2.cmml">O</mi><mi id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.3" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3.3.cmml">H</mi></msub></mrow></mrow></mfrac></mstyle><mo id="S4.Ex14X.3.2.2.m1.2.2.1.1.3.2.2" stretchy="false" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.3.1.1.cmml">⌉</mo></mrow></mrow><mo id="S4.Ex14X.3.2.2.m1.3.3.2.3" rspace="1.157em" xref="S4.Ex14X.3.2.2.m1.3.3.3a.cmml">,</mo><mrow id="S4.Ex14X.3.2.2.m1.3.3.2.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.cmml"><mrow id="S4.Ex14X.3.2.2.m1.3.3.2.2.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.cmml"><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.2.cmml">𝑖𝑓</mi><mo id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.1" lspace="0.500em" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.1.cmml">⁢</mo><msub id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.2.cmml">C</mi><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.3" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex14X.3.2.2.m1.3.3.2.2.1" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.1.cmml">&gt;</mo><mrow id="S4.Ex14X.3.2.2.m1.3.3.2.2.3" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.2.cmml">I</mi><mo id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.1" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.1.cmml">⁢</mo><msub id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.cmml"><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.2" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.2.cmml">O</mi><mi id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.3" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.3.cmml">H</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex14X.3.2.2.m1.3b"><apply id="S4.Ex14X.3.2.2.m1.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.3.3.3a.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.3">formulae-sequence</csymbol><apply id="S4.Ex14X.3.2.2.m1.2.2.1.1.cmml" xref="S4.Ex14X.3.2.2.m1.2.2.1.1"><eq id="S4.Ex14X.3.2.2.m1.2.2.1.1.1.cmml" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.1"></eq><csymbol cd="latexml" id="S4.Ex14X.3.2.2.m1.2.2.1.1.2.cmml" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.2">absent</csymbol><apply id="S4.Ex14X.3.2.2.m1.2.2.1.1.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.3.2"><ceiling id="S4.Ex14X.3.2.2.m1.2.2.1.1.3.1.1.cmml" xref="S4.Ex14X.3.2.2.m1.2.2.1.1.3.2.1"></ceiling><apply id="S4.Ex14X.3.2.2.m1.1.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1"><divide id="S4.Ex14X.3.2.2.m1.1.1.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1"></divide><apply id="S4.Ex14X.3.2.2.m1.1.1.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2"><times id="S4.Ex14X.3.2.2.m1.1.1.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.1"></times><apply id="S4.Ex14X.3.2.2.m1.1.1.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2"><times id="S4.Ex14X.3.2.2.m1.1.1.2.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.1"></times><apply id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.2">𝑁</ci><apply id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3"><times id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.1"></times><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.2">𝐿</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.3">𝑎</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.4.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.4">𝑦</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.5.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.5">𝑒</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.6.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.2.3.6">𝑟</ci></apply></apply><ci id="S4.Ex14X.3.2.2.m1.1.1.2.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.2.3">𝐼</ci></apply><apply id="S4.Ex14X.3.2.2.m1.1.1.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.1.1.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.1.1.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.2">𝑂</ci><apply id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3"><times id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.1"></times><ci id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.2">𝐾</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.2.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.2.3.3.3">𝑉</ci></apply></apply></apply><apply id="S4.Ex14X.3.2.2.m1.1.1.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3"><minus id="S4.Ex14X.3.2.2.m1.1.1.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.1"></minus><apply id="S4.Ex14X.3.2.2.m1.1.1.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2"><plus id="S4.Ex14X.3.2.2.m1.1.1.3.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.1"></plus><apply id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2"><times id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.1"></times><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.2">𝐼</ci><apply id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.2">𝑂</ci><apply id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3"><times id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.1"></times><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.2">𝐾</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.2.3.3.3">𝑉</ci></apply></apply></apply><apply id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3.2">𝐶</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.3.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.2.3.3">𝐻</ci></apply></apply><apply id="S4.Ex14X.3.2.2.m1.1.1.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3"><times id="S4.Ex14X.3.2.2.m1.1.1.3.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.1"></times><ci id="S4.Ex14X.3.2.2.m1.1.1.3.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.2">𝐼</ci><apply id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3.2">𝑂</ci><ci id="S4.Ex14X.3.2.2.m1.1.1.3.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.1.1.3.3.3.3">𝐻</ci></apply></apply></apply></apply></apply></apply><apply id="S4.Ex14X.3.2.2.m1.3.3.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2"><gt id="S4.Ex14X.3.2.2.m1.3.3.2.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.1"></gt><apply id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2"><times id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.1.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.1"></times><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.2">𝑖𝑓</ci><apply id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.2">𝐶</ci><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.2.3.3">𝐻</ci></apply></apply><apply id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3"><times id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.1"></times><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.2">𝐼</ci><apply id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3"><csymbol cd="ambiguous" id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.1.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3">subscript</csymbol><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.2.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.2">𝑂</ci><ci id="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.3.cmml" xref="S4.Ex14X.3.2.2.m1.3.3.2.2.3.3.3">𝐻</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14X.3.2.2.m1.3c">\displaystyle=\lceil\frac{N_{Layer}*IO_{KV}}{IO_{KV}+C_{H}-IO_{H}}\rceil,~{}~{%
}~{}\mathit{if}\ C_{H}&gt;IO_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14X.3.2.2.m1.3d">= ⌈ divide start_ARG italic_N start_POSTSUBSCRIPT italic_L italic_a italic_y italic_e italic_r end_POSTSUBSCRIPT ∗ italic_I italic_O start_POSTSUBSCRIPT italic_K italic_V end_POSTSUBSCRIPT end_ARG start_ARG italic_I italic_O start_POSTSUBSCRIPT italic_K italic_V end_POSTSUBSCRIPT + italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT - italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT end_ARG ⌉ , italic_if italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT &gt; italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S4.Ex14Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle L_{H}" class="ltx_Math" display="inline" id="S4.Ex14Xa.2.1.1.m1.1"><semantics id="S4.Ex14Xa.2.1.1.m1.1a"><msub id="S4.Ex14Xa.2.1.1.m1.1.1" xref="S4.Ex14Xa.2.1.1.m1.1.1.cmml"><mi id="S4.Ex14Xa.2.1.1.m1.1.1.2" xref="S4.Ex14Xa.2.1.1.m1.1.1.2.cmml">L</mi><mi id="S4.Ex14Xa.2.1.1.m1.1.1.3" xref="S4.Ex14Xa.2.1.1.m1.1.1.3.cmml">H</mi></msub><annotation-xml encoding="MathML-Content" id="S4.Ex14Xa.2.1.1.m1.1b"><apply id="S4.Ex14Xa.2.1.1.m1.1.1.cmml" xref="S4.Ex14Xa.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.Ex14Xa.2.1.1.m1.1.1.1.cmml" xref="S4.Ex14Xa.2.1.1.m1.1.1">subscript</csymbol><ci id="S4.Ex14Xa.2.1.1.m1.1.1.2.cmml" xref="S4.Ex14Xa.2.1.1.m1.1.1.2">𝐿</ci><ci id="S4.Ex14Xa.2.1.1.m1.1.1.3.cmml" xref="S4.Ex14Xa.2.1.1.m1.1.1.3">𝐻</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14Xa.2.1.1.m1.1c">\displaystyle L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14Xa.2.1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\lceil\frac{N_{Layer}*C_{Token}}{C_{Token}+IO_{H}-C_{H}}\rceil,~%
{}~{}~{}\mathit{if}\ C_{H}\leq IO_{H}" class="ltx_Math" display="inline" id="S4.Ex14Xa.3.2.2.m1.3"><semantics id="S4.Ex14Xa.3.2.2.m1.3a"><mrow id="S4.Ex14Xa.3.2.2.m1.3.3.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.3.cmml"><mrow id="S4.Ex14Xa.3.2.2.m1.2.2.1.1" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.2" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.2.cmml"></mi><mo id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.1" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.1.cmml">=</mo><mrow id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.2" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.1.cmml"><mo id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.2.1" stretchy="false" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.1.1.cmml">⌈</mo><mstyle displaystyle="true" id="S4.Ex14Xa.3.2.2.m1.1.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.cmml"><mfrac id="S4.Ex14Xa.3.2.2.m1.1.1a" xref="S4.Ex14Xa.3.2.2.m1.1.1.cmml"><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.cmml"><msub id="S4.Ex14Xa.3.2.2.m1.1.1.2.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.2.cmml">N</mi><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.2.cmml">L</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.3.cmml">a</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1a" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.4" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.4.cmml">y</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1b" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.5" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.5.cmml">e</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1c" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.6" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.6.cmml">r</mi></mrow></msub><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.1" lspace="0.222em" rspace="0.222em" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.1.cmml">∗</mo><msub id="S4.Ex14Xa.3.2.2.m1.1.1.2.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.2.cmml">C</mi><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.2.cmml">T</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.3.cmml">o</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1a" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.4" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.4.cmml">k</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1b" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.5" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.5.cmml">e</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1c" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.6" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.6.cmml">n</mi></mrow></msub></mrow><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.cmml"><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.cmml"><msub id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.2.cmml">C</mi><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.2.cmml">T</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.3.cmml">o</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1a" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.4" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.4.cmml">k</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1b" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.5" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.5.cmml">e</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1c" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.6" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.6.cmml">n</mi></mrow></msub><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.1.cmml">+</mo><mrow id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.2.cmml">I</mi><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.1.cmml">⁢</mo><msub id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.2.cmml">O</mi><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.3.cmml">H</mi></msub></mrow></mrow><mo id="S4.Ex14Xa.3.2.2.m1.1.1.3.1" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.1.cmml">−</mo><msub id="S4.Ex14Xa.3.2.2.m1.1.1.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.2" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3.2.cmml">C</mi><mi id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.3" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3.3.cmml">H</mi></msub></mrow></mfrac></mstyle><mo id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.2.2" stretchy="false" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.1.1.cmml">⌉</mo></mrow></mrow><mo id="S4.Ex14Xa.3.2.2.m1.3.3.2.3" rspace="1.157em" xref="S4.Ex14Xa.3.2.2.m1.3.3.3a.cmml">,</mo><mrow id="S4.Ex14Xa.3.2.2.m1.3.3.2.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.cmml"><mrow id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.2.cmml">𝑖𝑓</mi><mo id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.1" lspace="0.500em" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.1.cmml">⁢</mo><msub id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.2.cmml">C</mi><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.3.cmml">H</mi></msub></mrow><mo id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.1" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.1.cmml">≤</mo><mrow id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.2.cmml">I</mi><mo id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.1" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.1.cmml">⁢</mo><msub id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.cmml"><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.2" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.2.cmml">O</mi><mi id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.3" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.3.cmml">H</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex14Xa.3.2.2.m1.3b"><apply id="S4.Ex14Xa.3.2.2.m1.3.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.3.3.3a.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.3">formulae-sequence</csymbol><apply id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1"><eq id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.1"></eq><csymbol cd="latexml" id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.2">absent</csymbol><apply id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.2"><ceiling id="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.1.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.2.2.1.1.3.2.1"></ceiling><apply id="S4.Ex14Xa.3.2.2.m1.1.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1"><divide id="S4.Ex14Xa.3.2.2.m1.1.1.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1"></divide><apply id="S4.Ex14Xa.3.2.2.m1.1.1.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2"><times id="S4.Ex14Xa.3.2.2.m1.1.1.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.1"></times><apply id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.2">𝑁</ci><apply id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3"><times id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.2">𝐿</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.3">𝑎</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.4.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.4">𝑦</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.5.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.5">𝑒</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.6.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.2.3.6">𝑟</ci></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.2">𝐶</ci><apply id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3"><times id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.2">𝑇</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.3">𝑜</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.4.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.4">𝑘</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.5.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.5">𝑒</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.6.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.2.3.3.6">𝑛</ci></apply></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3"><minus id="S4.Ex14Xa.3.2.2.m1.1.1.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.1"></minus><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2"><plus id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.1"></plus><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.2">𝐶</ci><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3"><times id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.2">𝑇</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.3">𝑜</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.4.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.4">𝑘</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.5.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.5">𝑒</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.6.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.2.3.6">𝑛</ci></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3"><times id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.2">𝐼</ci><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.2">𝑂</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.2.3.3.3">𝐻</ci></apply></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3.2">𝐶</ci><ci id="S4.Ex14Xa.3.2.2.m1.1.1.3.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.1.1.3.3.3">𝐻</ci></apply></apply></apply></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2"><leq id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.1"></leq><apply id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2"><times id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.2">𝑖𝑓</ci><apply id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.2">𝐶</ci><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.2.3.3">𝐻</ci></apply></apply><apply id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3"><times id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.1"></times><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.2">𝐼</ci><apply id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3"><csymbol cd="ambiguous" id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.1.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3">subscript</csymbol><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.2.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.2">𝑂</ci><ci id="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.3.cmml" xref="S4.Ex14Xa.3.2.2.m1.3.3.2.2.3.3.3">𝐻</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14Xa.3.2.2.m1.3c">\displaystyle=\lceil\frac{N_{Layer}*C_{Token}}{C_{Token}+IO_{H}-C_{H}}\rceil,~%
{}~{}~{}\mathit{if}\ C_{H}\leq IO_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14Xa.3.2.2.m1.3d">= ⌈ divide start_ARG italic_N start_POSTSUBSCRIPT italic_L italic_a italic_y italic_e italic_r end_POSTSUBSCRIPT ∗ italic_C start_POSTSUBSCRIPT italic_T italic_o italic_k italic_e italic_n end_POSTSUBSCRIPT end_ARG start_ARG italic_C start_POSTSUBSCRIPT italic_T italic_o italic_k italic_e italic_n end_POSTSUBSCRIPT + italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT - italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT end_ARG ⌉ , italic_if italic_C start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT ≤ italic_I italic_O start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S4.Ex14Xb"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle L_{O}" class="ltx_Math" display="inline" id="S4.Ex14Xb.2.1.1.m1.1"><semantics id="S4.Ex14Xb.2.1.1.m1.1a"><msub id="S4.Ex14Xb.2.1.1.m1.1.1" xref="S4.Ex14Xb.2.1.1.m1.1.1.cmml"><mi id="S4.Ex14Xb.2.1.1.m1.1.1.2" xref="S4.Ex14Xb.2.1.1.m1.1.1.2.cmml">L</mi><mi id="S4.Ex14Xb.2.1.1.m1.1.1.3" xref="S4.Ex14Xb.2.1.1.m1.1.1.3.cmml">O</mi></msub><annotation-xml encoding="MathML-Content" id="S4.Ex14Xb.2.1.1.m1.1b"><apply id="S4.Ex14Xb.2.1.1.m1.1.1.cmml" xref="S4.Ex14Xb.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.Ex14Xb.2.1.1.m1.1.1.1.cmml" xref="S4.Ex14Xb.2.1.1.m1.1.1">subscript</csymbol><ci id="S4.Ex14Xb.2.1.1.m1.1.1.2.cmml" xref="S4.Ex14Xb.2.1.1.m1.1.1.2">𝐿</ci><ci id="S4.Ex14Xb.2.1.1.m1.1.1.3.cmml" xref="S4.Ex14Xb.2.1.1.m1.1.1.3">𝑂</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14Xb.2.1.1.m1.1c">\displaystyle L_{O}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14Xb.2.1.1.m1.1d">italic_L start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=N_{layer}-L_{H}" class="ltx_Math" display="inline" id="S4.Ex14Xb.3.2.2.m1.1"><semantics id="S4.Ex14Xb.3.2.2.m1.1a"><mrow id="S4.Ex14Xb.3.2.2.m1.1.1" xref="S4.Ex14Xb.3.2.2.m1.1.1.cmml"><mi id="S4.Ex14Xb.3.2.2.m1.1.1.2" xref="S4.Ex14Xb.3.2.2.m1.1.1.2.cmml"></mi><mo id="S4.Ex14Xb.3.2.2.m1.1.1.1" xref="S4.Ex14Xb.3.2.2.m1.1.1.1.cmml">=</mo><mrow id="S4.Ex14Xb.3.2.2.m1.1.1.3" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.cmml"><msub id="S4.Ex14Xb.3.2.2.m1.1.1.3.2" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.cmml"><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.2" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.2.cmml">N</mi><mrow id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.cmml"><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.2" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.2.cmml">l</mi><mo id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.3" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.3.cmml">a</mi><mo id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1a" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.4" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.4.cmml">y</mi><mo id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1b" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.5" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.5.cmml">e</mi><mo id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1c" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.6" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.6.cmml">r</mi></mrow></msub><mo id="S4.Ex14Xb.3.2.2.m1.1.1.3.1" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.1.cmml">−</mo><msub id="S4.Ex14Xb.3.2.2.m1.1.1.3.3" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3.cmml"><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.2" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3.2.cmml">L</mi><mi id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.3" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3.3.cmml">H</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex14Xb.3.2.2.m1.1b"><apply id="S4.Ex14Xb.3.2.2.m1.1.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1"><eq id="S4.Ex14Xb.3.2.2.m1.1.1.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.1"></eq><csymbol cd="latexml" id="S4.Ex14Xb.3.2.2.m1.1.1.2.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.2">absent</csymbol><apply id="S4.Ex14Xb.3.2.2.m1.1.1.3.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3"><minus id="S4.Ex14Xb.3.2.2.m1.1.1.3.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.1"></minus><apply id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2"><csymbol cd="ambiguous" id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2">subscript</csymbol><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.2.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.2">𝑁</ci><apply id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3"><times id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.1"></times><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.2.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.2">𝑙</ci><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.3.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.3">𝑎</ci><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.4.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.4">𝑦</ci><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.5.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.5">𝑒</ci><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.6.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.2.3.6">𝑟</ci></apply></apply><apply id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3"><csymbol cd="ambiguous" id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.1.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3">subscript</csymbol><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.2.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3.2">𝐿</ci><ci id="S4.Ex14Xb.3.2.2.m1.1.1.3.3.3.cmml" xref="S4.Ex14Xb.3.2.2.m1.1.1.3.3.3">𝐻</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex14Xb.3.2.2.m1.1c">\displaystyle=N_{layer}-L_{H}</annotation><annotation encoding="application/x-llamapun" id="S4.Ex14Xb.3.2.2.m1.1d">= italic_N start_POSTSUBSCRIPT italic_l italic_a italic_y italic_e italic_r end_POSTSUBSCRIPT - italic_L start_POSTSUBSCRIPT italic_H end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2. </span><span class="ltx_text ltx_font_smallcaps" id="S4.SS2.1.1">HCache</span> Storage Manager</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">The storage manager is tasked with managing contextual states in host storage.
We have adopted a storage format optimized for state restoration, as reducing TTFT
is our primary design goal. Additionally, we introduce a two-stage state-saving mechanism
to mitigate the overhead associated with saving newly generated states.
Note that with our state partition algorithm in §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S4.SS1.SSS2" title="4.1.2. State Partition Algorithm ‣ 4.1. Bubble-Free Restoration Scheduler ‣ 4. HCache Design ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">4.1.2</span></a>,
the contextual states at each model layer are stored either in <span class="ltx_text" id="S4.SS2.p1.1.1">hidden states</span>, <span class="ltx_text" id="S4.SS2.p1.1.2">KV cache</span>, or original tokens.
Here, we focus on the management of <span class="ltx_text" id="S4.SS2.p1.1.3">hidden states</span> since the <span class="ltx_text" id="S4.SS2.p1.1.4">KV cache</span> can be managed similarly.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.1. </span>Storage Format</h4>
<div class="ltx_para" id="S4.SS2.SSS1.p1">
<p class="ltx_p" id="S4.SS2.SSS1.p1.1">We introduce a storage format designed for fast restoration.
Since we adopt a layer-wise approach to restore the states for the history context,
the <span class="ltx_text" id="S4.SS2.SSS1.p1.1.1">hidden states</span> of all tokens from the same layer are copied together.
Conceptually, the <span class="ltx_text" id="S4.SS2.SSS1.p1.1.2">hidden states</span> of tokens in the same layer is colocated in a continuous large data block to maximize transferring bandwidth. In practice, we split the tokens of one layer into multiple fix-sized (64 tokens) chunks. The chunks of a layer are distributed
on multiple SSDs following the round-robin manner. The chunk-based storage format is designed for the following reasons:
First, when multiple SSDs are present in the system, we should distribute the
data of a layer across all SSDs instead of a large continuous block on a single SSD. This can facilitate parallel I/O operations and
enhance the transmission speed of one layer through bandwidth aggregation.
Second, LLM generates tokens autoregressively, whose output length is unpredictable <cite class="ltx_cite ltx_citemacro_citep">(Yu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib62" title="">2022</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>)</cite>.
This forbids us from reserving the storage space for a layer’s <span class="ltx_text" id="S4.SS2.SSS1.p1.1.3">hidden states</span> as an entire buffer –
reserving space according to its maximum length would result in serious internal fragmentation.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.2. </span>Two-Stage State Saving</h4>
<div class="ltx_para" id="S4.SS2.SSS2.p1">
<p class="ltx_p" id="S4.SS2.SSS2.p1.1">Next, we explore how the storage manager saves newly generated hidden states using a chunk-based storage format.
As we mentioned before, hidden states are intermediate activations generated at each layer,
if they are not saved in a timely manner, computation tasks will be blocked.
In the token generation phase with continuous batching enabled, a batch generates <span class="ltx_text" id="S4.SS2.SSS2.p1.1.1">hidden states</span> of different sequences,
which should be organized into separate chunks before being saved.
Directly transferring these hidden states to different chunks at host storage can lead
to numerous small write operations, potentially compromising the efficiency of the generation task.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p2">
<p class="ltx_p" id="S4.SS2.SSS2.p2.1">We adopt a two-stage strategy to address this problem.
First, the <span class="ltx_text" id="S4.SS2.SSS2.p2.1.1">hidden states</span> of the batch, encompassing tokens from various sequences, are collectively copied to the
host memory using a single <span class="ltx_text ltx_font_typewriter" id="S4.SS2.SSS2.p2.1.2">cudaMemcpy</span> call. This method effectively snapshots the
hidden states to the host, allowing the GPU memory buffer to be properly reused for subsequent layers.
Second, a host daemon running on the CPU orchestrates chunk management. It copies <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS2.p2.1.3">HCache</span> to appropriate chunk buffers
and flushes them to storage devices.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p3">
<p class="ltx_p" id="S4.SS2.SSS2.p3.1">In this way, the overhead of saving <span class="ltx_text" id="S4.SS2.SSS2.p3.1.1">hidden states</span> to host storage is moved off the
critical path of LLM processing; meanwhile, small-sized writes are reorganized into large chunks,
which host storage (e.g., SSDs) favors.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Implementation</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">We implement <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.1">HCache</span> with 5731 lines of code in Cuda, C++, and Python. Our implementation is based on
DeepSpeed-MII v0.2.0 <cite class="ltx_cite ltx_citemacro_citep">(DeepSpeed, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib16" title="">2024</a>)</cite>, a state-of-the-art LLM serving system that supports the
SplitFuse <cite class="ltx_cite ltx_citemacro_citep">(Agrawal et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib4" title="">2024</a>)</cite> scheduling algorithm.
We add support restoring from <span class="ltx_text" id="S5.p1.1.2">hidden states</span> to <span class="ltx_text" id="S5.p1.1.3">KV cache</span> in DeepSpeed-MII.
Specifically, we use the cuBLAS library to project the <span class="ltx_text" id="S5.p1.1.4">hidden states</span> to primeval KV values.
Following prior work <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite>, we write a custom kernel to apply the
ROPE position embedding <cite class="ltx_cite ltx_citemacro_citep">(Su et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib47" title="">2024</a>)</cite> to the recomputed KV values and copy the result to the <span class="ltx_text" id="S5.p1.1.5">KV cache</span>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p2">
<p class="ltx_p" id="S5.p2.1"><span class="ltx_text ltx_font_bold" id="S5.p2.1.1">Request scheduling.</span>
The scheduler of <span class="ltx_text ltx_font_smallcaps" id="S5.p2.1.2">HCache</span> derives from the continuous batching <cite class="ltx_cite ltx_citemacro_citep">(Holmes et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib23" title="">2024</a>)</cite> method. There are two main phases in continuous batching, namely prefilling and decoding. <span class="ltx_text ltx_font_smallcaps" id="S5.p2.1.3">HCache</span> adds an extra restoration phase. The request arrived in the system with evited history <span class="ltx_text" id="S5.p2.1.4">KV cache</span> will first execute this phase with bubble-free restoration. When the restoration phase is finished, The prefill phase is then conducted using the request’s newly arrived prompt. Finally, the request is added to the decoding batch. We also apply the SplitFuse <cite class="ltx_cite ltx_citemacro_citep">(Agrawal et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib4" title="">2024</a>)</cite> scheduling algorithm to opportunistically fuse prefill with decoding generation to mitigate the interference between prefilling and decoding.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p3">
<p class="ltx_p" id="S5.p3.1"><span class="ltx_text ltx_font_bold" id="S5.p3.1.1">Pipelined state transmission.</span>
On the GPU side, we use dedicated streams for state transmission
– one for the upstream state transmission and the other for the downstream state snapshot.
We use cudaEvent to coordinate the ordering of operations among different streams.
For example, the snapshot of one layer’s <span class="ltx_text" id="S5.p3.1.2">hidden states</span> is followed by an event, which is
waited by the first compute operator of the next layer so as to keep the buffer a
consistent version when accessed.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p4">
<p class="ltx_p" id="S5.p4.1"><span class="ltx_text ltx_font_bold" id="S5.p4.1.1">Storage management.</span> To save <span class="ltx_text" id="S5.p4.1.2">hidden states</span>, we use 8 background threads on the host side
to collect dumped <span class="ltx_text" id="S5.p4.1.3">hidden states</span> and append them to corresponding data chunks.
Once a chunk is fully populated, it is promptly written to the NVMe device.
To restore <span class="ltx_text" id="S5.p4.1.4">hidden states</span>, similar to FlashNeuron <cite class="ltx_cite ltx_citemacro_citep">(Bae et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib10" title="">2021</a>)</cite>,
we co-use SPDK <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib60" title="">2017</a>)</cite> and GDRCopy <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib38" title="">2024a</a>)</cite> to realize GPUDirect Storage,
which transfers data between the GPU and SSD directly.
Specifically, we pin several memory buffers on the GPU’s BAR (Base Address Register) space in advance;
when the GPU reads data from the SSD, we set the NVMe read command’s destination address as the exposed GPU BAR address,
thus achieving a direct P2P copy, which eliminates redundant memory copies with minimized I/O latencies.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p5">
<p class="ltx_p" id="S5.p5.1"><span class="ltx_text ltx_font_bold" id="S5.p5.1.1">Multi-GPU support.</span> We also add support for <span class="ltx_text ltx_font_smallcaps" id="S5.p5.1.2">HCache</span> to
serve large models that run on multiple GPUs. With tensor parallelism,
each GPU node should have a full version of <span class="ltx_text" id="S5.p5.1.3">hidden states</span> to compute
the <span class="ltx_text" id="S5.p5.1.4">KV cache</span>. To avoid redundant read of the <span class="ltx_text" id="S5.p5.1.5">hidden states</span> from different GPUs, we
let all GPUs read <span class="ltx_text ltx_font_italic" id="S5.p5.1.6">disjoint</span> shards (split by token)
of hidden states concurrently.
This operation can aggregate the read bandwidth of all GPUs with no read amplification.
Then, GPUs run an all-gather communication operator to reconstruct the full hidden state from shards.
Since the GPU is connected via the fast NVlink interconnect, the all-gather operation will only incur a small overhead compared with the transmission part. With pipeline parallelism. The restoration of each layer’s <span class="ltx_text ltx_font_smallcaps" id="S5.p5.1.7">HCache</span> is independent of each other.
So, each GPU node can fetch the <span class="ltx_text" id="S5.p5.1.8">hidden states</span> of its responsible layers concurrently
and recompute it to attain the <span class="ltx_text" id="S5.p5.1.9">KV cache</span> of corresponding layers.</p>
</div>
<figure class="ltx_figure" id="S5.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="403" id="S5.F9.g1" src="x9.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 9. </span>Overall Performance Results On ShareGPT4 Trace.</figcaption>
</figure>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Evaluation</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">We evaluate <span class="ltx_text ltx_font_smallcaps" id="S6.p1.1.1">HCache</span> to answer the following questions:</p>
<ul class="ltx_itemize" id="S6.I1">
<li class="ltx_item" id="S6.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S6.I1.i1.1.1.m1.1"><semantics id="S6.I1.i1.1.1.m1.1b"><mo id="S6.I1.i1.1.1.m1.1.1" mathsize="70%" xref="S6.I1.i1.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S6.I1.i1.1.1.m1.1c"><ci id="S6.I1.i1.1.1.m1.1.1.cmml" xref="S6.I1.i1.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.I1.i1.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S6.I1.i1.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S6.I1.i1.p1">
<p class="ltx_p" id="S6.I1.i1.p1.1">How does <span class="ltx_text ltx_font_smallcaps" id="S6.I1.i1.p1.1.1">HCache</span> perform in terms of TTFT and TBT compared to state-of-the-art state restoration methods?</p>
</div>
</li>
<li class="ltx_item" id="S6.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S6.I1.i2.1.1.m1.1"><semantics id="S6.I1.i2.1.1.m1.1b"><mo id="S6.I1.i2.1.1.m1.1.1" mathsize="70%" xref="S6.I1.i2.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S6.I1.i2.1.1.m1.1c"><ci id="S6.I1.i2.1.1.m1.1.1.cmml" xref="S6.I1.i2.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.I1.i2.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S6.I1.i2.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S6.I1.i2.p1">
<p class="ltx_p" id="S6.I1.i2.p1.1">How does <span class="ltx_text ltx_font_smallcaps" id="S6.I1.i2.p1.1.1">HCache</span> perform on platforms with various GPUs, storage devices, and context length?</p>
</div>
</li>
<li class="ltx_item" id="S6.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item"><math alttext="\bullet" class="ltx_Math" display="inline" id="S6.I1.i3.1.1.m1.1"><semantics id="S6.I1.i3.1.1.m1.1b"><mo id="S6.I1.i3.1.1.m1.1.1" mathsize="70%" xref="S6.I1.i3.1.1.m1.1.1.cmml">∙</mo><annotation-xml encoding="MathML-Content" id="S6.I1.i3.1.1.m1.1c"><ci id="S6.I1.i3.1.1.m1.1.1.cmml" xref="S6.I1.i3.1.1.m1.1.1">∙</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.I1.i3.1.1.m1.1d">\bullet</annotation><annotation encoding="application/x-llamapun" id="S6.I1.i3.1.1.m1.1e">∙</annotation></semantics></math></span>
<div class="ltx_para" id="S6.I1.i3.p1">
<p class="ltx_p" id="S6.I1.i3.p1.1">How do <span class="ltx_text ltx_font_smallcaps" id="S6.I1.i3.p1.1.1">HCache</span>’s individual techniques affect <span class="ltx_text ltx_font_smallcaps" id="S6.I1.i3.p1.1.2">HCache</span>’s performance?</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para ltx_noindent" id="S6.p2">
<p class="ltx_p" id="S6.p2.3"><span class="ltx_text ltx_font_bold" id="S6.p2.3.1">Testbed.</span>
Unless otherwise stated, all our experiments are conducted on a server equipped with
4<math alttext="\times" class="ltx_Math" display="inline" id="S6.p2.1.m1.1"><semantics id="S6.p2.1.m1.1a"><mo id="S6.p2.1.m1.1.1" xref="S6.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.p2.1.m1.1b"><times id="S6.p2.1.m1.1.1.cmml" xref="S6.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.p2.1.m1.1d">×</annotation></semantics></math> A100-40G SXM4 connected via NVLink. The host has 2<math alttext="\times" class="ltx_Math" display="inline" id="S6.p2.2.m2.1"><semantics id="S6.p2.2.m2.1a"><mo id="S6.p2.2.m2.1.1" xref="S6.p2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.p2.2.m2.1b"><times id="S6.p2.2.m2.1.1.cmml" xref="S6.p2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.p2.2.m2.1d">×</annotation></semantics></math> AMD EPYC 7642
CPUs, 256G DDR4 memory, and <math alttext="4\times" class="ltx_math_unparsed" display="inline" id="S6.p2.3.m3.1"><semantics id="S6.p2.3.m3.1a"><mrow id="S6.p2.3.m3.1b"><mn id="S6.p2.3.m3.1.1">4</mn><mo id="S6.p2.3.m3.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S6.p2.3.m3.1c">4\times</annotation><annotation encoding="application/x-llamapun" id="S6.p2.3.m3.1d">4 ×</annotation></semantics></math> Samsung PM9A3 4TB enterprise SSDs. In our sensitivity experiments,
we change the hardware configuration by using cloud servers equipped with different GPUs.
For these cloud servers, we directly use the host DRAM as the storage backend.
The hardware characteristics of these GPUs are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.T2" title="Table 2 ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<figure class="ltx_table" id="S6.T2">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S6.T2.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S6.T2.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S6.T2.1.1.2" style="padding-left:6.3pt;padding-right:6.3pt;"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.2.1">GPU</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T2.1.1.3" style="padding-left:6.3pt;padding-right:6.3pt;"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.3.1">HBM Size</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T2.1.1.1" style="padding-left:6.3pt;padding-right:6.3pt;"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.1.1">FLOPS<sup class="ltx_sup" id="S6.T2.1.1.1.1.1"><span class="ltx_text ltx_font_medium ltx_font_italic" id="S6.T2.1.1.1.1.1.1">⋆</span></sup></span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T2.1.1.4" style="padding-left:6.3pt;padding-right:6.3pt;"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.4.1">Transmission Speed</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T2.1.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T2.1.2.1.1" style="padding-left:6.3pt;padding-right:6.3pt;">A100</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.1.2" style="padding-left:6.3pt;padding-right:6.3pt;">40G</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.1.3" style="padding-left:6.3pt;padding-right:6.3pt;">312T</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.1.4" style="padding-left:6.3pt;padding-right:6.3pt;">32GB/s</td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.3.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T2.1.3.2.1" style="padding-left:6.3pt;padding-right:6.3pt;">A30</th>
<td class="ltx_td ltx_align_center" id="S6.T2.1.3.2.2" style="padding-left:6.3pt;padding-right:6.3pt;">24G</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.3.2.3" style="padding-left:6.3pt;padding-right:6.3pt;">165T</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.3.2.4" style="padding-left:6.3pt;padding-right:6.3pt;">32GB/s</td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.4.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T2.1.4.3.1" style="padding-left:6.3pt;padding-right:6.3pt;">4090</th>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.3.2" style="padding-left:6.3pt;padding-right:6.3pt;">24G</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.3.3" style="padding-left:6.3pt;padding-right:6.3pt;">330T</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.3.4" style="padding-left:6.3pt;padding-right:6.3pt;">32GB/s</td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.5.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T2.1.5.4.1" style="padding-left:6.3pt;padding-right:6.3pt;">L20</th>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.4.2" style="padding-left:6.3pt;padding-right:6.3pt;">48G</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.4.3" style="padding-left:6.3pt;padding-right:6.3pt;">120T</td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.4.4" style="padding-left:6.3pt;padding-right:6.3pt;">32GB/s</td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.6.5">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b" id="S6.T2.1.6.5.1" style="padding-left:6.3pt;padding-right:6.3pt;">H800</th>
<td class="ltx_td ltx_align_center ltx_border_b" id="S6.T2.1.6.5.2" style="padding-left:6.3pt;padding-right:6.3pt;">80G</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S6.T2.1.6.5.3" style="padding-left:6.3pt;padding-right:6.3pt;">990T</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S6.T2.1.6.5.4" style="padding-left:6.3pt;padding-right:6.3pt;">64GB/s</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2. </span>Hardware Characteristics of Different Platforms. <em class="ltx_emph ltx_font_italic" id="S6.T2.3.1" style="font-size:90%;">
Note that <sup class="ltx_sup" id="S6.T2.3.1.2">⋆</sup> indicates the FLOPS of FP16 operations.
</em></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S6.p3">
<p class="ltx_p" id="S6.p3.1"><span class="ltx_text ltx_font_bold" id="S6.p3.1.1">Models</span>: We use Llama2-7B, Llama2-13B, OPT-30B as our test models. We
expand the maximum context length of these models to 16K to accommodate L-Eval benchmarks and long conversation history.
For Llama2-7B/13B, we use a single A100 GPU to serve them. For OPT-30B, we run it
on 4 A100 GPUs with tensor parallelism unless otherwise stated.
We use the ShareGPT4 and L-Eval described in §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S2.SS3" title="2.3. Stateful LLM Applications ‣ 2. Background and Motivation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">2.3</span></a> as our test traces to imitate the real-world LLM use cases like multi-round conversation chatbot or RAG application.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p4">
<p class="ltx_p" id="S6.p4.1"><span class="ltx_text ltx_font_bold" id="S6.p4.1.1">Metrics.</span> When evaluating the overall performance, we report TTFT (Time to First Token),
which is the duration of the restoration and prefill phase, and TBT (Time between Token), which
represents the average time taken to generate a token for each request except for the first token. TTFT
is highly related to user experiences, and we mainly report TTFT to show <span class="ltx_text ltx_font_smallcaps" id="S6.p4.1.2">HCache</span>’s performance improvements.
We report TBT to prove that <span class="ltx_text ltx_font_smallcaps" id="S6.p4.1.3">HCache</span> poses negligible impact on decoding requests.
In other case studies, we run restoration requests with a batch size equal to 1, so we report the restoration speed instead,
which is defined as the number of restored historical tokens divided by the restoration time.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p5">
<p class="ltx_p" id="S6.p5.1"><span class="ltx_text ltx_font_bold" id="S6.p5.1.1">Baselines.</span> We compare <span class="ltx_text ltx_font_smallcaps" id="S6.p5.1.2">HCache</span> to the following baselines.
<span class="ltx_text ltx_framed ltx_framed_underline" id="S6.p5.1.3">Recomputation</span>: DeepSpeed-MII<cite class="ltx_cite ltx_citemacro_citep">(DeepSpeed, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib16" title="">2024</a>)</cite> is an LLM serving system that supports the SplitFuse scheduling
algorithm and uses PagedAttention to manage <span class="ltx_text" id="S6.p5.1.4">KV cache</span>. We use it as the baseline for token recomputation.
<span class="ltx_text ltx_framed ltx_framed_underline" id="S6.p5.1.5">KV offload</span>: AttentionStore <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite> offloads <span class="ltx_text" id="S6.p5.1.6">KV cache</span> to multi-tiered secondary storage. We implement it on top of DeepSpeed-MII to serve as the KV offload baseline. We do not implement the decoupled position embedding because we already expand the context length for models.
<span class="ltx_text ltx_framed ltx_framed_underline" id="S6.p5.1.7">Ideal</span>: We also implement an ideal system without the restoration overhead.
Here, we do not keep all <span class="ltx_text" id="S6.p5.1.8">KV cache</span>s in GPU memory; instead, we allocate the placeholder KV values in GPU, which are used repeatedly across all user requests.
This achieves the theoretical lower bounds for the TTFT and TBT metrics, assuming all the history KV cache is cached on GPU and reused.</p>
</div>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1. </span>Overall Performance </h3>
<section class="ltx_subsubsection" id="S6.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.1.1. </span>Multi-Round Conversation</h4>
<div class="ltx_para" id="S6.SS1.SSS1.p1">
<p class="ltx_p" id="S6.SS1.SSS1.p1.1">We evaluate the overall performance of <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p1.1.1">HCache</span> against baseline methods
in the multi-round conversation setting with ShareGPT4.
In this experiment, we use 4 SSDs as the storage backend.
Following prior work <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib29" title="">2023</a>)</cite>, we set the arrival time of
different sessions with the Poisson distribution.
The interval between conversation rounds in one session is set to 30s. All restoration methods do not reuse the KV cache on GPU for a fair comparison. The <span class="ltx_text" id="S6.SS1.SSS1.p1.1.2">KV cache</span> are evicted when one round of conversation ends.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.SS1.SSS1.p2">
<p class="ltx_p" id="S6.SS1.SSS1.p2.4"><span class="ltx_text ltx_font_bold" id="S6.SS1.SSS1.p2.4.1">TTFT and throughput</span>.
Figures <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S5.F9" title="Figure 9 ‣ 5. Implementation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">9</span></a>a-c show the TTFT under different request rates in the multi-round conversation.
Overall, <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p2.4.2">HCache</span> can provide 1.27-1.90<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS1.p2.1.m1.1"><semantics id="S6.SS1.SSS1.p2.1.m1.1a"><mo id="S6.SS1.SSS1.p2.1.m1.1.1" xref="S6.SS1.SSS1.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS1.p2.1.m1.1b"><times id="S6.SS1.SSS1.p2.1.m1.1.1.cmml" xref="S6.SS1.SSS1.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS1.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS1.p2.1.m1.1d">×</annotation></semantics></math> TTFT speedup compared with the KV offload and 2.21-3.57<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS1.p2.2.m2.1"><semantics id="S6.SS1.SSS1.p2.2.m2.1a"><mo id="S6.SS1.SSS1.p2.2.m2.1.1" xref="S6.SS1.SSS1.p2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS1.p2.2.m2.1b"><times id="S6.SS1.SSS1.p2.2.m2.1.1.cmml" xref="S6.SS1.SSS1.p2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS1.p2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS1.p2.2.m2.1d">×</annotation></semantics></math> better than token recomputation.
For 7B/13B models, the one running GPU has 4 SSDs, providing sufficient IO bandwidth for state restoration. Hence, the KV offload method is fast, but our methods can still be 1.27-1.60<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS1.p2.3.m3.1"><semantics id="S6.SS1.SSS1.p2.3.m3.1a"><mo id="S6.SS1.SSS1.p2.3.m3.1.1" xref="S6.SS1.SSS1.p2.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS1.p2.3.m3.1b"><times id="S6.SS1.SSS1.p2.3.m3.1.1.cmml" xref="S6.SS1.SSS1.p2.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS1.p2.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS1.p2.3.m3.1d">×</annotation></semantics></math> faster than it.
Instead, OPT-30B runs on 4 GPUs, each with one SSD, so
the restoration time of OPT-30B is longer, and <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p2.4.3">HCache</span> can achieve up to 1.90<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS1.p2.4.m4.1"><semantics id="S6.SS1.SSS1.p2.4.m4.1a"><mo id="S6.SS1.SSS1.p2.4.m4.1.1" xref="S6.SS1.SSS1.p2.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS1.p2.4.m4.1b"><times id="S6.SS1.SSS1.p2.4.m4.1.1.cmml" xref="S6.SS1.SSS1.p2.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS1.p2.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS1.p2.4.m4.1d">×</annotation></semantics></math> TTFT speedup compared with KV offload.</p>
</div>
<div class="ltx_para" id="S6.SS1.SSS1.p3">
<p class="ltx_p" id="S6.SS1.SSS1.p3.1">The 13B model has a lower peak throughput compared to 7B/30B models.
This is bounded by the limited GPU memory for the <span class="ltx_text" id="S6.SS1.SSS1.p3.1.1">KV cache</span>.
The throughput of different restoration methods is nearly the same in this case.
For the 7B/30B model, <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p3.1.2">HCache</span> can sustain up to 11% more requests than
KV offloading since the restoration cost for <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p3.1.3">HCache</span> is lower.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.SS1.SSS1.p4">
<p class="ltx_p" id="S6.SS1.SSS1.p4.1"><span class="ltx_text ltx_font_bold" id="S6.SS1.SSS1.p4.1.1">TBT</span>.
Figures <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S5.F9" title="Figure 9 ‣ 5. Implementation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">9</span></a>d-f show the TBT of different models in the multi-round conversation setting.
Compared with the ideal case, in which no restoration is needed, <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p4.1.2">HCache</span>’s TBT is at most 4% higher,
almost the same as the ideal case. The low TBT overhead benefits from the high restoration speed of <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS1.p4.1.3">HCache</span>
, which reduces GPU time spent on the restoration, so the token generation is stalled long.</p>
</div>
<figure class="ltx_figure" id="S6.F10"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="593" id="S6.F10.g1" src="x10.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 10. </span>Performance of Long-Context Applications.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S6.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.1.2. </span>Long-Context Applications</h4>
<div class="ltx_para" id="S6.SS1.SSS2.p1">
<p class="ltx_p" id="S6.SS1.SSS2.p1.2">We evaluate the overall performance of <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS2.p1.2.1">HCache</span> against baseline methods in the
long-context applications setting with the L-Eval trace. Since the GPU HBM can
only serve 1-3 long-context requests, we evaluate different models with a batch
size equal to 1. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F10" title="Figure 10 ‣ 6.1.1. Multi-Round Conversation ‣ 6.1. Overall Performance ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">10</span></a> shows the TTFT of three representative
subtasks and the sampled 200 requests from the trace (i.e., mixed). <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS2.p1.2.2">HCache</span> can
achieve 1.62-1.93<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS2.p1.1.m1.1"><semantics id="S6.SS1.SSS2.p1.1.m1.1a"><mo id="S6.SS1.SSS2.p1.1.m1.1.1" xref="S6.SS1.SSS2.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS2.p1.1.m1.1b"><times id="S6.SS1.SSS2.p1.1.m1.1.1.cmml" xref="S6.SS1.SSS2.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS2.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS2.p1.1.m1.1d">×</annotation></semantics></math> speed up for TTFT compared over KV offload and 2.66-5.73<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS2.p1.2.m2.1"><semantics id="S6.SS1.SSS2.p1.2.m2.1a"><mo id="S6.SS1.SSS2.p1.2.m2.1.1" xref="S6.SS1.SSS2.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS2.p1.2.m2.1b"><times id="S6.SS1.SSS2.p1.2.m2.1.1.cmml" xref="S6.SS1.SSS2.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS2.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS2.p1.2.m2.1d">×</annotation></semantics></math> over token recomputation.
It is worth noticing that these tasks’ history length spans within a large range from 4K to 16K, demonstrating <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS2.p1.2.3">HCache</span>’s
excellent scalability.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S6.SS1.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.1.3. </span>In-Depth Analysis</h4>
<div class="ltx_para" id="S6.SS1.SSS3.p1">
<p class="ltx_p" id="S6.SS1.SSS3.p1.1">In Table <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.T3" title="Table 3 ‣ 6.1.3. In-Depth Analysis ‣ 6.1. Overall Performance ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">3</span></a>, we report the schedule results of <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS3.p1.1.1">HCache</span>, in terms of how
model layers are managed and the per-token storage space consumption. We also
report the storage cost of KV offload as a comparison.
Specifically, the 7B model on one A100 has balanced speed for recomputation from
<span class="ltx_text" id="S6.SS1.SSS3.p1.1.2">hidden states</span> into <span class="ltx_text" id="S6.SS1.SSS3.p1.1.3">KV cache</span> and the transmission of <span class="ltx_text" id="S6.SS1.SSS3.p1.1.4">hidden states</span>, so we use <span class="ltx_text" id="S6.SS1.SSS3.p1.1.5">hidden states</span>
for 31 layers and only transmit the <span class="ltx_text" id="S6.SS1.SSS3.p1.1.6">KV cache</span> for one layer to fill in the bubble.
For the 13B and 30B model, <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS3.p1.1.7">HCache</span> use <span class="ltx_text" id="S6.SS1.SSS3.p1.1.8">hidden states</span> for more than 80% layers,
while the rest of the layers are managed via different resource-complementary methods.
Regarding space consumption, the size of <span class="ltx_text" id="S6.SS1.SSS3.p1.1.9">hidden states</span> for one token is half that of <span class="ltx_text" id="S6.SS1.SSS3.p1.1.10">KV cache</span>.
Combined with the zero-bubble scheduler, some layers may not even need to be stored because they can be
recomputed from tokens. As a result, <span class="ltx_text ltx_font_smallcaps" id="S6.SS1.SSS3.p1.1.11">HCache</span>’s per token storage space is 1.92-2.40<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS1.SSS3.p1.1.m1.1"><semantics id="S6.SS1.SSS3.p1.1.m1.1a"><mo id="S6.SS1.SSS3.p1.1.m1.1.1" xref="S6.SS1.SSS3.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS1.SSS3.p1.1.m1.1b"><times id="S6.SS1.SSS3.p1.1.m1.1.1.cmml" xref="S6.SS1.SSS3.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.SSS3.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.SSS3.p1.1.m1.1d">×</annotation></semantics></math> lower than KV offload. To achieve a balanced speed between computation and transmission using only hidden states, approximately 24GB/s, 21GB/s, and 37GB/s of storage bandwidth are needed for the 7B, 13B, and 30B models, respectively.</p>
</div>
<figure class="ltx_table" id="S6.T3">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S6.T3.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S6.T3.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S6.T3.1.1.1.1" rowspan="2" style="padding-left:9.1pt;padding-right:9.1pt;"><span class="ltx_text ltx_font_bold" id="S6.T3.1.1.1.1.1">Model</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S6.T3.1.1.1.2" rowspan="2" style="padding-left:9.1pt;padding-right:9.1pt;"><span class="ltx_text ltx_font_bold" id="S6.T3.1.1.1.2.1">Schedule</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S6.T3.1.1.1.3" style="padding-left:9.1pt;padding-right:9.1pt;"><span class="ltx_text ltx_font_bold" id="S6.T3.1.1.1.3.1">Per Token Storage Cost</span></th>
</tr>
<tr class="ltx_tr" id="S6.T3.1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S6.T3.1.2.2.1" style="padding-left:9.1pt;padding-right:9.1pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="S6.T3.1.2.2.1.1">HCache</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S6.T3.1.2.2.2" style="padding-left:9.1pt;padding-right:9.1pt;"><span class="ltx_text ltx_font_bold" id="S6.T3.1.2.2.2.1">KV Offload</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T3.1.3.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S6.T3.1.3.1.1" style="padding-left:9.1pt;padding-right:9.1pt;">7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S6.T3.1.3.1.2" style="padding-left:9.1pt;padding-right:9.1pt;">31 H + 1 KV</th>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S6.T3.1.3.1.3" style="padding-left:9.1pt;padding-right:9.1pt;">132 KiB</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T3.1.3.1.4" style="padding-left:9.1pt;padding-right:9.1pt;">256 KiB</td>
</tr>
<tr class="ltx_tr" id="S6.T3.1.4.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S6.T3.1.4.2.1" style="padding-left:9.1pt;padding-right:9.1pt;">13B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S6.T3.1.4.2.2" style="padding-left:9.1pt;padding-right:9.1pt;">36 H + 4 KV</th>
<td class="ltx_td ltx_align_center ltx_border_r" id="S6.T3.1.4.2.3" style="padding-left:9.1pt;padding-right:9.1pt;">210 KiB</td>
<td class="ltx_td ltx_align_center" id="S6.T3.1.4.2.4" style="padding-left:9.1pt;padding-right:9.1pt;">400 KiB</td>
</tr>
<tr class="ltx_tr" id="S6.T3.1.5.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b ltx_border_r" id="S6.T3.1.5.3.1" style="padding-left:9.1pt;padding-right:9.1pt;">30B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_b ltx_border_r" id="S6.T3.1.5.3.2" style="padding-left:9.1pt;padding-right:9.1pt;">40 H + 8 RE</th>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r" id="S6.T3.1.5.3.3" style="padding-left:9.1pt;padding-right:9.1pt;">280 KiB</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S6.T3.1.5.3.4" style="padding-left:9.1pt;padding-right:9.1pt;">672 KiB</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3. </span>Scheduling Results and Storage Cost.<em class="ltx_emph ltx_font_italic" id="S6.T3.3.1" style="font-size:90%;">
H, KV, and RE indicate <span class="ltx_text" id="S6.T3.3.1.1">hidden states</span>, <span class="ltx_text" id="S6.T3.3.1.2">KV cache</span>, and recomputation, respectively.
</em></figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2. </span>Sensitivity Analysis</h3>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.1">The state restoration speed of an LLM is highly relevant to the model size, IO transmission bandwidth,
computation power, and historical context length. We vary them to analyze the sensitivity of <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.p1.1.1">HCache</span> against baseline methods.</p>
</div>
<figure class="ltx_figure" id="S6.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="394" id="S6.F11.g1" src="x11.png" width="789"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 11. </span>Sensitivity Analysis by Various Factors. <em class="ltx_emph ltx_font_italic" id="S6.F11.2.1" style="font-size:90%;">
(a-c): Varying GPU computation capability and using DRAM as the storage backend.
(d-f): Varying number of SSDs in the default testbed.
(g-i): Varying context length with the default testbed.
</em></figcaption>
</figure>
<section class="ltx_subsubsection" id="S6.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.2.1. </span>Varying GPU Devices</h4>
<div class="ltx_para" id="S6.SS2.SSS1.p1">
<p class="ltx_p" id="S6.SS2.SSS1.p1.6">The restoration phase of <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.1">HCache</span> includes the projection of <span class="ltx_text" id="S6.SS2.SSS1.p1.6.2">hidden states</span> to <span class="ltx_text" id="S6.SS2.SSS1.p1.6.3">KV cache</span>, so its performance
is sensitive to the computation power of GPU. We evaluate the restoration speed of <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.4">HCache</span> and baselines on various GPU platforms. We use host DRAM as the storage backend so that the transmission speed is not the bottleneck. Figures <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F11" title="Figure 11 ‣ 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">11</span></a>a-c shows that <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.5">HCache</span> outperforms KV offload by 1.33–1.81× and Recomputation by 5.04–9.05× in restoration speed across different platforms.
Platforms with low computation capability are unfriendly to <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.6">HCache</span>, such as running a 7B model on an A30 GPU.
In this case, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.7">HCache</span> computation is longer than transmission and makes the speed up less than 2<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.1.m1.1"><semantics id="S6.SS2.SSS1.p1.1.m1.1a"><mo id="S6.SS2.SSS1.p1.1.m1.1.1" xref="S6.SS2.SSS1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.1.m1.1b"><times id="S6.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S6.SS2.SSS1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.1.m1.1d">×</annotation></semantics></math>.
Even so, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.8">HCache</span> still restores 1.33<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.2.m2.1"><semantics id="S6.SS2.SSS1.p1.2.m2.1a"><mo id="S6.SS2.SSS1.p1.2.m2.1.1" xref="S6.SS2.SSS1.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.2.m2.1b"><times id="S6.SS2.SSS1.p1.2.m2.1.1.cmml" xref="S6.SS2.SSS1.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.2.m2.1d">×</annotation></semantics></math> faster than KV offload.
On platforms with faster computation speeds, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.9">HCache</span> shows improved performance, achieving a 1.66<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.3.m3.1"><semantics id="S6.SS2.SSS1.p1.3.m3.1a"><mo id="S6.SS2.SSS1.p1.3.m3.1.1" xref="S6.SS2.SSS1.p1.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.3.m3.1b"><times id="S6.SS2.SSS1.p1.3.m3.1.1.cmml" xref="S6.SS2.SSS1.p1.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.3.m3.1d">×</annotation></semantics></math> increase on A100 GPU
and a 1.77<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.4.m4.1"><semantics id="S6.SS2.SSS1.p1.4.m4.1a"><mo id="S6.SS2.SSS1.p1.4.m4.1.1" xref="S6.SS2.SSS1.p1.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.4.m4.1b"><times id="S6.SS2.SSS1.p1.4.m4.1.1.cmml" xref="S6.SS2.SSS1.p1.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.4.m4.1d">×</annotation></semantics></math> increase on the H800 GPU for 13B models compared to KV offload.
Compared to token recomputation, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS1.p1.6.10">HCache</span> achieves 5.04-9.05<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.5.m5.1"><semantics id="S6.SS2.SSS1.p1.5.m5.1a"><mo id="S6.SS2.SSS1.p1.5.m5.1.1" xref="S6.SS2.SSS1.p1.5.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.5.m5.1b"><times id="S6.SS2.SSS1.p1.5.m5.1.1.cmml" xref="S6.SS2.SSS1.p1.5.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.5.m5.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.5.m5.1d">×</annotation></semantics></math> speed up on different GPUs. This is attributed to the 6<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS1.p1.6.m6.1"><semantics id="S6.SS2.SSS1.p1.6.m6.1a"><mo id="S6.SS2.SSS1.p1.6.m6.1.1" xref="S6.SS2.SSS1.p1.6.m6.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS1.p1.6.m6.1b"><times id="S6.SS2.SSS1.p1.6.m6.1.1.cmml" xref="S6.SS2.SSS1.p1.6.m6.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS1.p1.6.m6.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS1.p1.6.m6.1d">×</annotation></semantics></math> theoretical speedup against token recomputation by skipping the attention and FFN modules.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S6.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.2.2. </span>Varying Storage Bandwidth</h4>
<div class="ltx_para" id="S6.SS2.SSS2.p1">
<p class="ltx_p" id="S6.SS2.SSS2.p1.1">LLM state restoration is sensitive to the transmission speed. We evaluate the restoration speed of <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS2.p1.1.1">HCache</span> and baselines with different numbers of disks. One PM9A3 SSD provides a read bandwidth of 6.9 GB/s, and using 4 disks can saturate the upstream PCIe bandwidth of the A100 GPU. For the 30B model, we use DRAM to simulate 8-16 disks since
our platform does not have enough PCIe slots. The history length is set to 1024.</p>
</div>
<div class="ltx_para" id="S6.SS2.SSS2.p2">
<p class="ltx_p" id="S6.SS2.SSS2.p2.7">Figures <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F11" title="Figure 11 ‣ 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">11</span></a>d-f present the sensitivity evaluation results related to transmission speed.
In terms of the restoration speed across various disk configurations,
<span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS2.p2.7.1">HCache</span> significantly outperforms KV offload, delivering a 1.7 to 2.6<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.1.m1.1"><semantics id="S6.SS2.SSS2.p2.1.m1.1a"><mo id="S6.SS2.SSS2.p2.1.m1.1.1" xref="S6.SS2.SSS2.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.1.m1.1b"><times id="S6.SS2.SSS2.p2.1.m1.1.1.cmml" xref="S6.SS2.SSS2.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.1.m1.1d">×</annotation></semantics></math> improvement
and surpasses recomputation with a 2.3-6.1<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.2.m2.1"><semantics id="S6.SS2.SSS2.p2.2.m2.1a"><mo id="S6.SS2.SSS2.p2.2.m2.1.1" xref="S6.SS2.SSS2.p2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.2.m2.1b"><times id="S6.SS2.SSS2.p2.2.m2.1.1.cmml" xref="S6.SS2.SSS2.p2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.2.m2.1d">×</annotation></semantics></math> enhancement.
For platforms with fewer disks, IO transmission can be slower than computation tasks;
based on our theoretical analysis, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS2.p2.7.2">HCache</span> can perform at least <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S6.SS2.SSS2.p2.3.m3.1"><semantics id="S6.SS2.SSS2.p2.3.m3.1a"><mrow id="S6.SS2.SSS2.p2.3.m3.1b"><mn id="S6.SS2.SSS2.p2.3.m3.1.1">2</mn><mo id="S6.SS2.SSS2.p2.3.m3.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.3.m3.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.3.m3.1d">2 ×</annotation></semantics></math> better, and
the bubble-free scheduler can bring extra speed up. For example, on the platform with one SSD per GPU,
the overall improvement of <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS2.p2.7.3">HCache</span> over KV offload is 2.09-2.66<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.4.m4.1"><semantics id="S6.SS2.SSS2.p2.4.m4.1a"><mo id="S6.SS2.SSS2.p2.4.m4.1.1" xref="S6.SS2.SSS2.p2.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.4.m4.1b"><times id="S6.SS2.SSS2.p2.4.m4.1.1.cmml" xref="S6.SS2.SSS2.p2.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.4.m4.1d">×</annotation></semantics></math>.
For platforms with more disks, instead, the recomputation operation in <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS2.p2.7.4">HCache</span> can be longer than the transmission in this setting, so the speed up can be less than 2<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.5.m5.1"><semantics id="S6.SS2.SSS2.p2.5.m5.1a"><mo id="S6.SS2.SSS2.p2.5.m5.1.1" xref="S6.SS2.SSS2.p2.5.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.5.m5.1b"><times id="S6.SS2.SSS2.p2.5.m5.1.1.cmml" xref="S6.SS2.SSS2.p2.5.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.5.m5.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.5.m5.1d">×</annotation></semantics></math>. However, the recomputation overhead is much lower than
token recomputation. The overall speedup is 1.33-1.81<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.6.m6.1"><semantics id="S6.SS2.SSS2.p2.6.m6.1a"><mo id="S6.SS2.SSS2.p2.6.m6.1.1" xref="S6.SS2.SSS2.p2.6.m6.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.6.m6.1b"><times id="S6.SS2.SSS2.p2.6.m6.1.1.cmml" xref="S6.SS2.SSS2.p2.6.m6.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.6.m6.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.6.m6.1d">×</annotation></semantics></math> on 7B-30B models compared with KV offload and 5.46-6.08<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS2.SSS2.p2.7.m7.1"><semantics id="S6.SS2.SSS2.p2.7.m7.1a"><mo id="S6.SS2.SSS2.p2.7.m7.1.1" xref="S6.SS2.SSS2.p2.7.m7.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS2.SSS2.p2.7.m7.1b"><times id="S6.SS2.SSS2.p2.7.m7.1.1.cmml" xref="S6.SS2.SSS2.p2.7.m7.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.SSS2.p2.7.m7.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.SSS2.p2.7.m7.1d">×</annotation></semantics></math> compared with recomputation from the token.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S6.SS2.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.2.3. </span>Varying Sequence Length</h4>
<div class="ltx_para" id="S6.SS2.SSS3.p1">
<p class="ltx_p" id="S6.SS2.SSS3.p1.1">We further investigate the impact of sequence length on <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS3.p1.1.1">HCache</span>’s restoration speed.
Following the same configuration as the overall experiment, we test different models’ restoration speeds on A100 GPUs
with 4 SSDs by varying the history length.
As shown in Figures <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F11" title="Figure 11 ‣ 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">11</span></a>g-i, token recomputation can not scale well with the increasing history length; the restoration speed of a 7B model drops by 28% as the history length increases from 1K to 16K.
Token recomputation’s quadratic complexity attention mechanism incurs a high overhead in contexts with a long history.
The <span class="ltx_text" id="S6.SS2.SSS3.p1.1.2">KV cache</span> can scale well with different history lengths because its transmission size is proportional to the number of tokens. <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS3.p1.1.3">HCache</span> also scales well with different history lengths for two reasons. First, the transmission size of <span class="ltx_text" id="S6.SS2.SSS3.p1.1.4">hidden states</span> and recomputation cost from it to <span class="ltx_text" id="S6.SS2.SSS3.p1.1.5">KV cache</span> are all proportional to the number of tokens (see  §<a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S3.SS2" title="3.2. Restoration Cost Analysis ‣ 3. HCache: Caching the Hidden States ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">3.2</span></a>). Second, <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS3.p1.1.6">HCache</span> has the bubble-free restoration scheduler and may opportunistically combine the usage of the token recomputation to fill in the bubble in the short context. With long historical contexts, the scheduler detects that token computation is very expensive and falls back to the <span class="ltx_text ltx_font_smallcaps" id="S6.SS2.SSS3.p1.1.7">HCache</span>-only approach.</p>
</div>
<figure class="ltx_figure" id="S6.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="332" id="S6.F12.g1" src="x12.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 12. </span>Ablation Study on Bubble-Free Scheduler.</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S6.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.3. </span>Ablation Study</h3>
<section class="ltx_subsubsection" id="S6.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.3.1. </span>Bubble-Free Scheduler</h4>
<div class="ltx_para" id="S6.SS3.SSS1.p1">
<p class="ltx_p" id="S6.SS3.SSS1.p1.1">We first compare different scheduling methods for state restoration.
We implement two variants of <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p1.1.1">HCache</span>, including <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p1.1.2">HCache</span>-O and Naive hybrid.
<span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p1.1.3">HCache</span>-O only uses <span class="ltx_text" id="S6.SS3.SSS1.p1.1.4">hidden states</span> for state restoration without the bubble-free scheduler.
Naive Hybrid uses the bubble-free restoration scheduler to mix token recomputation and KV offload without using <span class="ltx_text" id="S6.SS3.SSS1.p1.1.5">hidden states</span>.
We compare them under three hardware settings: balanced, compute-, and IO-sufficient.</p>
</div>
<div class="ltx_para" id="S6.SS3.SSS1.p2">
<p class="ltx_p" id="S6.SS3.SSS1.p2.1">The results are shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F12" title="Figure 12 ‣ 6.2.3. Varying Sequence Length ‣ 6.2. Sensitivity Analysis ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">12</span></a>.
Without <span class="ltx_text" id="S6.SS3.SSS1.p2.1.1">hidden states</span>, Naive hybrid is the best method that uses both compute and transmission resources.
<span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p2.1.2">HCache</span> outperforms this approach by 1.28-1.42<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS3.SSS1.p2.1.m1.1"><semantics id="S6.SS3.SSS1.p2.1.m1.1a"><mo id="S6.SS3.SSS1.p2.1.m1.1.1" xref="S6.SS3.SSS1.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS3.SSS1.p2.1.m1.1b"><times id="S6.SS3.SSS1.p2.1.m1.1.1.cmml" xref="S6.SS3.SSS1.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.SSS1.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.SSS1.p2.1.m1.1d">×</annotation></semantics></math>. Both methods have no bubbles,
so the performance gain of <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p2.1.3">HCache</span> comes from the <span class="ltx_text" id="S6.SS3.SSS1.p2.1.4">hidden states</span> as it has theoretically lower computational and IO overhead.</p>
</div>
<div class="ltx_para" id="S6.SS3.SSS1.p3">
<p class="ltx_p" id="S6.SS3.SSS1.p3.2">The bubble-free scheduler plays a key role on resource-skewed platforms.
<span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.1">HCache</span>-O incurs pipeline bubbles and waste resources.
For example, in the IO-sufficient setting, the bubble in the <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.2">HCache</span>-O lets it be 13% slower
than KV offload because the recomputation in <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.3">HCache</span> is slow and IO resources are wasted.
The bubble-free scheduler can integrate <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.4">HCache</span>-O with resource-complementary methods,
thus improving the speed of <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.5">HCache</span>-O by 1.35-1.64<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS3.SSS1.p3.1.m1.1"><semantics id="S6.SS3.SSS1.p3.1.m1.1a"><mo id="S6.SS3.SSS1.p3.1.m1.1.1" xref="S6.SS3.SSS1.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS3.SSS1.p3.1.m1.1b"><times id="S6.SS3.SSS1.p3.1.m1.1.1.cmml" xref="S6.SS3.SSS1.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.SSS1.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.SSS1.p3.1.m1.1d">×</annotation></semantics></math> in skewed hardware configuration
and making <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS1.p3.2.6">HCache</span> consistently perform better than KV offload by 1.45-2.66<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS3.SSS1.p3.2.m2.1"><semantics id="S6.SS3.SSS1.p3.2.m2.1a"><mo id="S6.SS3.SSS1.p3.2.m2.1.1" xref="S6.SS3.SSS1.p3.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS3.SSS1.p3.2.m2.1b"><times id="S6.SS3.SSS1.p3.2.m2.1.1.cmml" xref="S6.SS3.SSS1.p3.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.SSS1.p3.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.SSS1.p3.2.m2.1d">×</annotation></semantics></math>.</p>
</div>
<figure class="ltx_figure" id="S6.F13"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="308" id="S6.F13.g1" src="x13.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 13. </span>Ablation Study on State Partition Methods.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S6.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.3.2. </span>State Partition Methods</h4>
<div class="ltx_para" id="S6.SS3.SSS2.p1">
<p class="ltx_p" id="S6.SS3.SSS2.p1.1">We compare different methods to partition the state of the model. We measure the restoration speed
of the 13B model using history contexts with 1024 tokens. We run the model on one A100 with one SSD.
With the layer-wise partition, our algorithm produces a scheme that uses <span class="ltx_text" id="S6.SS3.SSS2.p1.1.1">hidden states</span> for 31 layers
and token recomputation for the remaining 9 layers. Instead, a naive token-wise partition uses <span class="ltx_text" id="S6.SS3.SSS2.p1.1.2">hidden states</span>
for 794 tokens and token recomputation for the remaining 230 tokens. A round-up optimization over the token-wise
partition uses the nearest optimal size (i.e., 768) to manage tokens with <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS2.p1.1.3">HCache</span>.
As Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F13" title="Figure 13 ‣ 6.3.1. Bubble-Free Scheduler ‣ 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">13</span></a> shows, the restoration speed with the naive token-wise partition is
12% slower. While the round-up optimization can improve performance by issuing a more performant cuBLAS kernel,
it is still 7% slower than layer-wise partition because of the unbalanced workload in computation and transmission.
As auxiliary information, we also report the restoration time of GEMM operation in one layer with varying numbers of
tokens (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F13" title="Figure 13 ‣ 6.3.1. Bubble-Free Scheduler ‣ 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">13</span></a>b).</p>
</div>
<figure class="ltx_figure" id="S6.F14"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="356" id="S6.F14.g1" src="x14.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 14. </span>Ablation Study on Two-Stage <span class="ltx_text ltx_font_smallcaps" id="S6.F14.2.1">HCache</span> Saving.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S6.SS3.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">6.3.3. </span>Two-stage State Saving</h4>
<div class="ltx_para" id="S6.SS3.SSS3.p1">
<p class="ltx_p" id="S6.SS3.SSS3.p1.1">To evaluate the effectiveness of the two-stage <span class="ltx_text" id="S6.SS3.SSS3.p1.1.1">hidden states</span> saving strategy. We implement a variant of <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS3.p1.1.2">HCache</span>, which directly saves <span class="ltx_text" id="S6.SS3.SSS3.p1.1.3">hidden states</span> to SSDs (i.e., DirectIO in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F14" title="Figure 14 ‣ 6.3.2. State Partition Methods ‣ 6.3. Ablation Study ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">14</span></a>).
We test the TBT with different numbers of sequences in the decoding batch and set the history length of each to 512.</p>
</div>
<div class="ltx_para" id="S6.SS3.SSS3.p2">
<p class="ltx_p" id="S6.SS3.SSS3.p2.1">As shown in the figure, <span class="ltx_text ltx_font_smallcaps" id="S6.SS3.SSS3.p2.1.1">HCache</span>’s TBT is consistent with the ideal case. This is because <span class="ltx_text ltx_font_typewriter" id="S6.SS3.SSS3.p2.1.2">cudaMemcpy</span> can efficiently copy the <span class="ltx_text" id="S6.SS3.SSS3.p2.1.3">hidden states</span> to host DRAM. DirectIO achieves a similar effect when the batch size is small because the I/O time is less than one layer’s decoding time. However, when the batch size is large, DirectIO can not store one batch’s <span class="ltx_text" id="S6.SS3.SSS3.p2.1.4">hidden states</span> to the device on time and will stall the decoding phase. DirectIO’s TBT can be 34% higher with the 7B model when the batch size reaches 16. With the 13B model,
DirectIO’s TBT is less significant because each layer’s decoding time becomes longer.
However, as the batch size increases to 32, DirectIO still increases TBT by 13%.</p>
</div>
<div class="ltx_para" id="S6.SS3.SSS3.p3">
<p class="ltx_p" id="S6.SS3.SSS3.p3.1">It is important to note that no stalling occurred during hidden state snapshots in our experiments. For example, prefilling 1,024 tokens in a single layer of the Llama2-13B model generates approximately 10MB of hidden states in 3ms. This results in an equivalent bandwidth of 3GB/s, which is lower than the PCIe bandwidth. The hidden state generation speed during the decoding phase is even slower.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S6.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.4. </span>Performace with on GPU KV Reusing</h3>
<div class="ltx_para" id="S6.SS4.p1">
<p class="ltx_p" id="S6.SS4.p1.1">Real-world LLM serving systems <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib68" title="">2023</a>; Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib21" title="">2024</a>)</cite> typically reuse the <span class="ltx_text" id="S6.SS4.p1.1.1">KV cache</span> on GPU. We evaluate the TTFT of <span class="ltx_text ltx_font_smallcaps" id="S6.SS4.p1.1.2">HCache</span> against baseline state restoration methods, along with a GPU-resident KV cache.</p>
</div>
<div class="ltx_para" id="S6.SS4.p2">
<p class="ltx_p" id="S6.SS4.p2.1">In this experiment, we use the L-Eval dataset and reuse the <span class="ltx_text" id="S6.SS4.p2.1.1">KV cache</span> for long-context tasks on the GPU, employing an LRU-based cache, as done in prior work <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib68" title="">2023</a>)</cite>. When a cache miss occurs on the GPU, the <span class="ltx_text" id="S6.SS4.p2.1.2">KV cache</span> is restored using different state restoration methods. Following prior work <cite class="ltx_cite ltx_citemacro_citep">(Song et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib46" title="">2023</a>; Xie et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib56" title="">2022</a>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib57" title="">2023</a>)</cite>, we synthetic the arrival pattern of contexts in the L-Eval dataset with varying Zipfian skewness values (<math alttext="\alpha" class="ltx_Math" display="inline" id="S6.SS4.p2.1.m1.1"><semantics id="S6.SS4.p2.1.m1.1a"><mi id="S6.SS4.p2.1.m1.1.1" xref="S6.SS4.p2.1.m1.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S6.SS4.p2.1.m1.1b"><ci id="S6.SS4.p2.1.m1.1.1.cmml" xref="S6.SS4.p2.1.m1.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p2.1.m1.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p2.1.m1.1d">italic_α</annotation></semantics></math>). We evaluate the 7B model with 4 SSDs, and we report both the cache hit ratio and TTFT under different skewness levels.</p>
</div>
<figure class="ltx_figure" id="S6.F15"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="332" id="S6.F15.g1" src="x15.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 15. </span>Performace with on GPU KV Reusing</figcaption>
</figure>
<div class="ltx_para" id="S6.SS4.p3">
<p class="ltx_p" id="S6.SS4.p3.6">The results are shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#S6.F15" title="Figure 15 ‣ 6.4. Performace with on GPU KV Reusing ‣ 6. Evaluation ‣ Fast State Restoration in LLM Serving with HCache"><span class="ltx_text ltx_ref_tag">15</span></a>. With a uniform arrival pattern, the cache hit ratio is 15%, and the TTFT is similar to the overall experiment, which does not incorporate caching. In the uniform setting, <span class="ltx_text ltx_font_smallcaps" id="S6.SS4.p3.6.1">HCache</span> is 1.67<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS4.p3.1.m1.1"><semantics id="S6.SS4.p3.1.m1.1a"><mo id="S6.SS4.p3.1.m1.1.1" xref="S6.SS4.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.1.m1.1b"><times id="S6.SS4.p3.1.m1.1.1.cmml" xref="S6.SS4.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.1.m1.1d">×</annotation></semantics></math> faster than KV offloading. As the skewness increases from uniform to <math alttext="\alpha=2.0" class="ltx_Math" display="inline" id="S6.SS4.p3.2.m2.1"><semantics id="S6.SS4.p3.2.m2.1a"><mrow id="S6.SS4.p3.2.m2.1.1" xref="S6.SS4.p3.2.m2.1.1.cmml"><mi id="S6.SS4.p3.2.m2.1.1.2" xref="S6.SS4.p3.2.m2.1.1.2.cmml">α</mi><mo id="S6.SS4.p3.2.m2.1.1.1" xref="S6.SS4.p3.2.m2.1.1.1.cmml">=</mo><mn id="S6.SS4.p3.2.m2.1.1.3" xref="S6.SS4.p3.2.m2.1.1.3.cmml">2.0</mn></mrow><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.2.m2.1b"><apply id="S6.SS4.p3.2.m2.1.1.cmml" xref="S6.SS4.p3.2.m2.1.1"><eq id="S6.SS4.p3.2.m2.1.1.1.cmml" xref="S6.SS4.p3.2.m2.1.1.1"></eq><ci id="S6.SS4.p3.2.m2.1.1.2.cmml" xref="S6.SS4.p3.2.m2.1.1.2">𝛼</ci><cn id="S6.SS4.p3.2.m2.1.1.3.cmml" type="float" xref="S6.SS4.p3.2.m2.1.1.3">2.0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.2.m2.1c">\alpha=2.0</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.2.m2.1d">italic_α = 2.0</annotation></semantics></math>, the cache hit ratio rises to 94%, allowing the GPU cache to significantly reduce TTFT by 3.76<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS4.p3.3.m3.1"><semantics id="S6.SS4.p3.3.m3.1a"><mo id="S6.SS4.p3.3.m3.1.1" xref="S6.SS4.p3.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.3.m3.1b"><times id="S6.SS4.p3.3.m3.1.1.cmml" xref="S6.SS4.p3.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.3.m3.1d">×</annotation></semantics></math> to 10.03<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS4.p3.4.m4.1"><semantics id="S6.SS4.p3.4.m4.1a"><mo id="S6.SS4.p3.4.m4.1.1" xref="S6.SS4.p3.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.4.m4.1b"><times id="S6.SS4.p3.4.m4.1.1.cmml" xref="S6.SS4.p3.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.4.m4.1d">×</annotation></semantics></math>. A high cache hit ratio diminishes the performance gains of <span class="ltx_text ltx_font_smallcaps" id="S6.SS4.p3.6.2">HCache</span> due to fewer state restoration events. Nevertheless, <span class="ltx_text ltx_font_smallcaps" id="S6.SS4.p3.6.3">HCache</span> remains 1.15<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS4.p3.5.m5.1"><semantics id="S6.SS4.p3.5.m5.1a"><mo id="S6.SS4.p3.5.m5.1.1" xref="S6.SS4.p3.5.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.5.m5.1b"><times id="S6.SS4.p3.5.m5.1.1.cmml" xref="S6.SS4.p3.5.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.5.m5.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.5.m5.1d">×</annotation></semantics></math> faster than KV offloading and 1.98<math alttext="\times" class="ltx_Math" display="inline" id="S6.SS4.p3.6.m6.1"><semantics id="S6.SS4.p3.6.m6.1a"><mo id="S6.SS4.p3.6.m6.1.1" xref="S6.SS4.p3.6.m6.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.SS4.p3.6.m6.1b"><times id="S6.SS4.p3.6.m6.1.1.cmml" xref="S6.SS4.p3.6.m6.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.SS4.p3.6.m6.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.SS4.p3.6.m6.1d">×</annotation></semantics></math> faster than recomputation in high-skewness workloads.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7. </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S7.p1">
<p class="ltx_p" id="S7.p1.1"><span class="ltx_text ltx_font_bold" id="S7.p1.1.1">Stateful LLM optimizations.</span>
Recent work optimized for stateful LLMs all maintain the <span class="ltx_text" id="S7.p1.1.2">KV cache</span> as is. PromptCache
 <cite class="ltx_cite ltx_citemacro_citep">(Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib21" title="">2024</a>)</cite>, SGLang <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib68" title="">2023</a>)</cite> and
ChunkAttention <cite class="ltx_cite ltx_citemacro_citep">(Ye et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib61" title="">2024</a>)</cite> proposes to cache and reuse the on-chip <span class="ltx_text" id="S7.p1.1.3">KV cache</span>
for shared tokens across different requests. They optimize the GPU cache hit path and are complementary to <span class="ltx_text ltx_font_smallcaps" id="S7.p1.1.4">HCache</span> which optimize the cache miss path. For larger than GPU memory <span class="ltx_text" id="S7.p1.1.5">KV cache</span> management,
AttenionStore <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib20" title="">2024</a>)</cite> offloads the <span class="ltx_text" id="S7.p1.1.6">KV cache</span> to tiered host storage, including DRAM and SSDs.
RAGCache<cite class="ltx_cite ltx_citemacro_citep">(Jin et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib27" title="">2024</a>)</cite>, Pensieve<cite class="ltx_cite ltx_citemacro_citep">(Yu and Li, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib63" title="">2023</a>)</cite>, and
APIServe <cite class="ltx_cite ltx_citemacro_citep">(Abhyankar et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib3" title="">2024</a>)</cite> maintain a multi-tier <span class="ltx_text" id="S7.p1.1.7">KV cache</span> storage
system across GPU memory and host DRAM based on hotness and restoration overhead.
FlexGen <cite class="ltx_cite ltx_citemacro_citep">(Sheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib45" title="">2023</a>)</cite> is an offline inference system that offloads both
<span class="ltx_text" id="S7.p1.1.8">KV cache</span> and output activations of each layer to facilitate batched inference.
Our work is distinguished from them by exploiting <span class="ltx_text" id="S7.p1.1.9">hidden states</span>, and the above
caching mechanisms can be further applied in our system to boost performance.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p2">
<p class="ltx_p" id="S7.p2.1"><span class="ltx_text ltx_font_bold" id="S7.p2.1.1">LLM state compression.</span>
One alternative to reducing LLM’s state restoration time is to compress the <span class="ltx_text" id="S7.p2.1.2">KV cache</span>, but at the cost of
compromised model accuracy. Instead, <span class="ltx_text ltx_font_smallcaps" id="S7.p2.1.3">HCache</span> is a <em class="ltx_emph ltx_font_italic" id="S7.p2.1.4">lossless</em> method for state restoration.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p3">
<p class="ltx_p" id="S7.p3.1"><span class="ltx_text ltx_framed ltx_framed_underline" id="S7.p3.1.1">Quantization</span> <cite class="ltx_cite ltx_citemacro_citep">(Gray and Neuhoff, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib22" title="">1998</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib34" title="">2024b</a>; Dong et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib17" title="">2024</a>; Hooper et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib24" title="">2024</a>; Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib64" title="">2024b</a>; Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib59" title="">2024</a>; Kang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib28" title="">2024</a>)</cite> is the representative methods for <span class="ltx_text" id="S7.p3.1.2">KV cache</span> compression.
These methods compress the <span class="ltx_text" id="S7.p3.1.3">KV cache</span> from 16-bit into 4-bit or even lower.
CacheGen <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib33" title="">2024a</a>)</cite> is the most relevant work that combines KV offload with quantization.
CacheGen mitigates the KV transferring overhead by reducing its size with quantization-based compression algorithms.
These quantization-based methods can be applied in <span class="ltx_text ltx_font_smallcaps" id="S7.p3.1.4">HCache</span> to reduce the size of <span class="ltx_text" id="S7.p3.1.5">hidden states</span>.
Moreover, LLM weight quantization methods <cite class="ltx_cite ltx_citemacro_citep">(Zhao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib66" title="">2023a</a>; Frantar et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib19" title="">2022</a>; Xiao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib55" title="">2023</a>; Lin et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib31" title="">2023</a>)</cite>
are also applicable to reduce computing overhead and can be combined
with <span class="ltx_text ltx_font_smallcaps" id="S7.p3.1.6">HCache</span> to improve state restoration speed.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p4">
<p class="ltx_p" id="S7.p4.1"><span class="ltx_text ltx_framed ltx_framed_underline" id="S7.p4.1.1">Token drop methods</span>. Some recent work <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib65" title="">2024a</a>; Mu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib35" title="">2023</a>)</cite> drops
the <span class="ltx_text" id="S7.p4.1.2">KV cache</span> of less important tokens directly
based on attention scores. These methods reduce the <span class="ltx_text" id="S7.p4.1.3">KV cache</span> size by reducing the
number of tokens that need to be stored.
They can also be integrated into <span class="ltx_text ltx_font_smallcaps" id="S7.p4.1.4">HCache</span> to reduce the transmission and computation overhead.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p5">
<p class="ltx_p" id="S7.p5.1"><span class="ltx_text ltx_framed ltx_framed_underline" id="S7.p5.1.1">MQA and GQA</span>. Algorithm improvements like MQA <cite class="ltx_cite ltx_citemacro_citep">(Shazeer, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib44" title="">2019</a>)</cite> and GQA <cite class="ltx_cite ltx_citemacro_citep">(Ainslie et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib5" title="">2023</a>)</cite> have been designed to reduce the sizes of <span class="ltx_text" id="S7.p5.1.2">KV cache</span> by using low-rank KV representation. These methods can apply to <span class="ltx_text ltx_font_smallcaps" id="S7.p5.1.3">HCache</span> by first projecting the <span class="ltx_text" id="S7.p5.1.4">hidden states</span> into a low-rank representation and then storing it. This involves changing the model structure, which is beyond the scope of this paper. <span class="ltx_text ltx_font_smallcaps" id="S7.p5.1.5">HCache</span> can currently support LLMs using the MHA mechanisms without any change of the model structure, including 20,000 famous LLM models on Hugging Face like Llama2 <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib50" title="">2023</a>)</cite>, Gemma <cite class="ltx_cite ltx_citemacro_citep">(Team et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib48" title="">2024</a>)</cite>, Phi2 <cite class="ltx_cite ltx_citemacro_citep">(Javaheripi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2410.05004v1#bib.bib26" title="">2023</a>)</cite>, and Qwen1.5.</p>
</div>
</section>
<section class="ltx_section" id="S8">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">8. </span>Conclusion</h2>
<div class="ltx_para" id="S8.p1">
<p class="ltx_p" id="S8.p1.3">We present <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.1">HCache</span>, a novel method for LLM state restoration. <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.2">HCache</span> stores the intermediate activation of LLM and combines the transmission and computation resources to restore the LLM state with low overhead.
To further improve <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.3">HCache</span>’s performance, we propose bubble-free restoration to use resource-complementary
methods to improve the restoration speed, and introduce a chunk-based storage layout for <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.4">HCache</span> and save the <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.5">HCache</span> using a two-stage strategy. We evaluate <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.6">HCache</span> with a range of models and hardware platforms. The experimental results show that <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.7">HCache</span> can reduce TTFT by up to 1.93<math alttext="\times" class="ltx_Math" display="inline" id="S8.p1.1.m1.1"><semantics id="S8.p1.1.m1.1a"><mo id="S8.p1.1.m1.1.1" xref="S8.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S8.p1.1.m1.1b"><times id="S8.p1.1.m1.1.1.cmml" xref="S8.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S8.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S8.p1.1.m1.1d">×</annotation></semantics></math> compared with KV offload and 5.73<math alttext="\times" class="ltx_Math" display="inline" id="S8.p1.2.m2.1"><semantics id="S8.p1.2.m2.1a"><mo id="S8.p1.2.m2.1.1" xref="S8.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S8.p1.2.m2.1b"><times id="S8.p1.2.m2.1.1.cmml" xref="S8.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S8.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S8.p1.2.m2.1d">×</annotation></semantics></math> compared with token recomputation. Moreover, <span class="ltx_text ltx_font_smallcaps" id="S8.p1.3.8">HCache</span> can also reduce the storage cost by 1.92-2.4<math alttext="\times" class="ltx_Math" display="inline" id="S8.p1.3.m3.1"><semantics id="S8.p1.3.m3.1a"><mo id="S8.p1.3.m3.1.1" xref="S8.p1.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S8.p1.3.m3.1b"><times id="S8.p1.3.m3.1.1.cmml" xref="S8.p1.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S8.p1.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S8.p1.3.m3.1d">×</annotation></semantics></math>.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We sincerely thank our shepherd Rong Chen and anonymous reviewers for their feedback and suggestions. This work is supported by the National Key R&amp;D Program of China (Grant No. 2022YFB4500302) and the National Natural Science Foundation of China (Grant No. U22B2023, 62202255).</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">sha (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">Sharegpt4 Dataset.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/datasets/openchat/openchat_sharegpt4_dataset" title="">https://huggingface.co/datasets/openchat/openchat_sharegpt4_dataset</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abhyankar et al<span class="ltx_text" id="bib.bib3.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Reyna Abhyankar, Zijian He, Vikranth Srivatsa, Hao Zhang, and Yiying Zhang. 2024.

</span>
<span class="ltx_bibblock">APIServe: Efficient API Support for Large-Language Model Inferencing.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2402.01869 [cs.LG]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Agrawal et al<span class="ltx_text" id="bib.bib4.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Amey Agrawal, Nitin Kedia, Ashish Panwar, Jayashree Mohan, Nipun Kwatra, Bhargav Gulavani, Alexey Tumanov, and Ramachandran Ramjee. 2024.

</span>
<span class="ltx_bibblock">Taming Throughput-Latency Tradeoff in LLM Inference with Sarathi-Serve. In <em class="ltx_emph ltx_font_italic" id="bib.bib4.3.1">18th USENIX Symposium on Operating Systems Design and Implementation (OSDI 24)</em>. USENIX Association, Santa Clara, CA, 117–134.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.usenix.org/conference/osdi24/presentation/agrawal" title="">https://www.usenix.org/conference/osdi24/presentation/agrawal</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ainslie et al<span class="ltx_text" id="bib.bib5.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Joshua Ainslie, James Lee-Thorp, Michiel de Jong, Yury Zemlyanskiy, Federico Lebron, and Sumit Sanghai. 2023.

</span>
<span class="ltx_bibblock">GQA: Training Generalized Multi-Query Transformer Models from Multi-Head Checkpoints. In <em class="ltx_emph ltx_font_italic" id="bib.bib5.3.1">Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing</em>. 4895–4901.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">An et al<span class="ltx_text" id="bib.bib6.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Chenxin An, Shansan Gong, Ming Zhong, Mukai Li, Jun Zhang, Lingpeng Kong, and Xipeng Qiu. 2023.

</span>
<span class="ltx_bibblock">L-Eval: Instituting Standardized Evaluation for Long Context Language Models.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2307.11088 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">anthropic (2024)</span>
<span class="ltx_bibblock">
anthropic. 2024.

</span>
<span class="ltx_bibblock">Claude.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://claude.ai/" title="">https://claude.ai/</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">authors (2024a)</span>
<span class="ltx_bibblock">
LightLLM authors. 2024a.

</span>
<span class="ltx_bibblock">LightLLM.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/ModelTC/lightllm" title="">https://github.com/ModelTC/lightllm</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">authors (2024b)</span>
<span class="ltx_bibblock">
RTP-LLM authors. 2024b.

</span>
<span class="ltx_bibblock">RTP-LLM.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/alibaba/rtp-llm" title="">https://github.com/alibaba/rtp-llm</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bae et al<span class="ltx_text" id="bib.bib10.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Jonghyun Bae, Jongsung Lee, Yunho Jin, Sam Son, Shine Kim, Hakbeom Jang, Tae Jun Ham, and Jae W. Lee. 2021.

</span>
<span class="ltx_bibblock">FlashNeuron: SSD-Enabled Large-Batch Training of Very Deep Neural Networks. In <em class="ltx_emph ltx_font_italic" id="bib.bib10.3.1">19th USENIX Conference on File and Storage Technologies (FAST 21)</em>. USENIX Association, 387–401.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.usenix.org/conference/fast21/presentation/bae" title="">https://www.usenix.org/conference/fast21/presentation/bae</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Borgeaud et al<span class="ltx_text" id="bib.bib11.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Sebastian Borgeaud, Arthur Mensch, Jordan Hoffmann, Trevor Cai, Eliza Rutherford, Katie Millican, George van den Driessche, Jean-Baptiste Lespiau, Bogdan Damoc, Aidan Clark, Diego de Las Casas, Aurelia Guy, Jacob Menick, Roman Ring, T. W. Hennigan, Saffron Huang, Lorenzo Maggiore, Chris Jones, Albin Cassirer, Andy Brock, Michela Paganini, Geoffrey Irving, Oriol Vinyals, Simon Osindero, Karen Simonyan, Jack W. Rae, Erich Elsen, and L. Sifre. 2021.

</span>
<span class="ltx_bibblock">Improving language models by retrieving from trillions of tokens. In <em class="ltx_emph ltx_font_italic" id="bib.bib11.3.1">International Conference on Machine Learning</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:244954723" title="">https://api.semanticscholar.org/CorpusID:244954723</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cao et al<span class="ltx_text" id="bib.bib12.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yihan Cao, Siyu Li, Yixin Liu, Zhiling Yan, Yutong Dai, Philip S Yu, and Lichao Sun. 2023.

</span>
<span class="ltx_bibblock">A comprehensive survey of ai-generated content (aigc): A history of generative ai from gan to chatgpt.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.3.1">arXiv preprint arXiv:2303.04226</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chase (2022)</span>
<span class="ltx_bibblock">
Harrison Chase. 2022.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">LangChain</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/langchain-ai/langchain" title="">https://github.com/langchain-ai/langchain</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span class="ltx_text" id="bib.bib14.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Mark Chen, Jerry Tworek, Heewoo Jun, Qiming Yuan, Henrique Ponde de Oliveira Pinto, Jared Kaplan, Harri Edwards, Yuri Burda, Nicholas Joseph, Greg Brockman, Alex Ray, Raul Puri, Gretchen Krueger, Michael Petrov, Heidy Khlaaf, Girish Sastry, Pamela Mishkin, Brooke Chan, Scott Gray, Nick Ryder, Mikhail Pavlov, Alethea Power, Lukasz Kaiser, Mohammad Bavarian, Clemens Winter, Philippe Tillet, Felipe Petroski Such, Dave Cummings, Matthias Plappert, Fotios Chantzis,
Elizabeth Barnes, Ariel Herbert-Voss, William Hebgen Guss, Alex Nichol, Alex Paino, Nikolas Tezak, Jie Tang, Igor Babuschkin, Suchir Balaji, Shantanu Jain, William Saunders, Christopher Hesse, Andrew N. Carr, Jan Leike, Josh Achiam, Vedant Misra, Evan Morikawa, Alec Radford, Matthew Knight, Miles Brundage, Mira Murati, Katie Mayer, Peter Welinder, Bob McGrew, Dario Amodei, Sam McCandlish, Ilya Sutskever, and Wojciech Zaremba. 2021.

</span>
<span class="ltx_bibblock">Evaluating Large Language Models Trained on Code.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2107.03374 [cs.LG]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cobbe et al<span class="ltx_text" id="bib.bib15.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Karl Cobbe, Vineet Kosaraju, Mohammad Bavarian, Mark Chen, Heewoo Jun, Lukasz Kaiser, Matthias Plappert, Jerry Tworek, Jacob Hilton, Reiichiro Nakano, et al<span class="ltx_text" id="bib.bib15.3.1">.</span> 2021.

</span>
<span class="ltx_bibblock">Training verifiers to solve math word problems.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib15.4.1">arXiv preprint arXiv:2110.14168</em> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">DeepSpeed (2024)</span>
<span class="ltx_bibblock">
DeepSpeed. 2024.

</span>
<span class="ltx_bibblock">DeepSpeed-MII.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/microsoft/DeepSpeed-MII" title="">https://github.com/microsoft/DeepSpeed-MII</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dong et al<span class="ltx_text" id="bib.bib17.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Shichen Dong, Wen Cheng, Jiayu Qin, and Wei Wang. 2024.

</span>
<span class="ltx_bibblock">QAQ: Quality Adaptive Quantization for LLM KV Cache.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.3.1">arXiv preprint arXiv:2403.04643</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Feng et al<span class="ltx_text" id="bib.bib18.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yangyang Feng, Minhui Xie, Zijie Tian, Shuo Wang, Youyou Lu, and Jiwu Shu. 2023.

</span>
<span class="ltx_bibblock">Mobius: Fine Tuning Large-Scale Models on Commodity GPU Servers. In <em class="ltx_emph ltx_font_italic" id="bib.bib18.3.1">Proceedings of the 28th ACM International Conference on Architectural Support for Programming Languages and Operating Systems, Volume 2</em> (Vancouver, BC, Canada) <em class="ltx_emph ltx_font_italic" id="bib.bib18.4.2">(ASPLOS 2023)</em>. Association for Computing Machinery, New York, NY, USA, 489–501.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3575693.3575703" title="">https://doi.org/10.1145/3575693.3575703</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Frantar et al<span class="ltx_text" id="bib.bib19.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Elias Frantar, Saleh Ashkboos, Torsten Hoefler, and Dan Alistarh. 2022.

</span>
<span class="ltx_bibblock">OPTQ: Accurate quantization for generative pre-trained transformers. In <em class="ltx_emph ltx_font_italic" id="bib.bib19.3.1">The Eleventh International Conference on Learning Representations</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al<span class="ltx_text" id="bib.bib20.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Bin Gao, Zhuomin He, Puru Sharma, Qingxuan Kang, Djordje Jevdjic, Junbo Deng, Xingkun Yang, Zhou Yu, and Pengfei Zuo. 2024.

</span>
<span class="ltx_bibblock">Cost-Efficient Large Language Model Serving for Multi-turn Conversations with CachedAttention. In <em class="ltx_emph ltx_font_italic" id="bib.bib20.3.1">2024 USENIX Annual Technical Conference (USENIX ATC 24)</em>. USENIX Association, Santa Clara, CA, 111–126.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.usenix.org/conference/atc24/presentation/gao-bin-cost" title="">https://www.usenix.org/conference/atc24/presentation/gao-bin-cost</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gim et al<span class="ltx_text" id="bib.bib21.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
In Gim, Guojun Chen, Seung-seob Lee, Nikhil Sarda, Anurag Khandelwal, and Lin Zhong. 2024.

</span>
<span class="ltx_bibblock">Prompt Cache: Modular Attention Reuse for Low-Latency Inference. In <em class="ltx_emph ltx_font_italic" id="bib.bib21.3.1">Proceedings of Machine Learning and Systems</em>, P. Gibbons, G. Pekhimenko, and C. De Sa (Eds.), Vol. 6. 325–338.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.mlsys.org/paper_files/paper/2024/file/a66caa1703fe34705a4368c3014c1966-Paper-Conference.pdf" title="">https://proceedings.mlsys.org/paper_files/paper/2024/file/a66caa1703fe34705a4368c3014c1966-Paper-Conference.pdf</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gray and Neuhoff (1998)</span>
<span class="ltx_bibblock">
Robert M. Gray and David L. Neuhoff. 1998.

</span>
<span class="ltx_bibblock">Quantization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">IEEE transactions on information theory</em> 44, 6 (1998), 2325–2383.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Holmes et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Connor Holmes, Masahiro Tanaka, Michael Wyatt, Ammar Ahmad Awan, Jeff Rasley, Samyam Rajbhandari, Reza Yazdani Aminabadi, Heyang Qin, Arash Bakhtiari, Lev Kurilenko, and Yuxiong He. 2024.

</span>
<span class="ltx_bibblock">DeepSpeed-FastGen: High-throughput Text Generation for LLMs via MII and DeepSpeed-Inference.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2401.08671 [cs.PF]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hooper et al<span class="ltx_text" id="bib.bib24.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Coleman Hooper, Sehoon Kim, Hiva Mohammadzadeh, Michael W Mahoney, Yakun Sophia Shao, Kurt Keutzer, and Amir Gholami. 2024.

</span>
<span class="ltx_bibblock">KVQuant: Towards 10 Million Context Length LLM Inference with KV Cache Quantization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.3.1">arXiv preprint arXiv:2401.18079</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Huang et al<span class="ltx_text" id="bib.bib25.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Lei Huang, Weijiang Yu, Weitao Ma, Weihong Zhong, Zhangyin Feng, Haotian Wang, Qianglong Chen, Weihua Peng, Xiaocheng Feng, Bing Qin, and Ting Liu. 2023.

</span>
<span class="ltx_bibblock">A Survey on Hallucination in Large Language Models: Principles, Taxonomy, Challenges, and Open Questions.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2311.05232 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Javaheripi et al<span class="ltx_text" id="bib.bib26.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Mojan Javaheripi, Sébastien Bubeck, Marah Abdin, Jyoti Aneja, Sebastien Bubeck, Caio César Teodoro Mendes, Weizhu Chen, Allie Del Giorno, Ronen Eldan, Sivakanth Gopi, et al<span class="ltx_text" id="bib.bib26.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Phi-2: The surprising power of small language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib26.4.1">Microsoft Research Blog</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jin et al<span class="ltx_text" id="bib.bib27.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Chao Jin, Zili Zhang, Xuanlin Jiang, Fangyue Liu, Xin Liu, Xuanzhe Liu, and Xin Jin. 2024.

</span>
<span class="ltx_bibblock">RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2404.12457 [cs.DC]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kang et al<span class="ltx_text" id="bib.bib28.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Hao Kang, Qingru Zhang, Souvik Kundu, Geonhwa Jeong, Zaoxing Liu, Tushar Krishna, and Tuo Zhao. 2024.

</span>
<span class="ltx_bibblock">GEAR: An Efficient KV Cache Compression Recipe for Near-Lossless Generative Inference of LLM.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2403.05527 [cs.LG]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwon et al<span class="ltx_text" id="bib.bib29.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Woosuk Kwon, Zhuohan Li, Siyuan Zhuang, Ying Sheng, Lianmin Zheng, Cody Hao Yu, Joseph Gonzalez, Hao Zhang, and Ion Stoica. 2023.

</span>
<span class="ltx_bibblock">Efficient Memory Management for Large Language Model Serving with PagedAttention. In <em class="ltx_emph ltx_font_italic" id="bib.bib29.3.1">Proceedings of the 29th Symposium on Operating Systems Principles</em> (, Koblenz, Germany,) <em class="ltx_emph ltx_font_italic" id="bib.bib29.4.2">(SOSP ’23)</em>. Association for Computing Machinery, New York, NY, USA, 611–626.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3600006.3613165" title="">https://doi.org/10.1145/3600006.3613165</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al<span class="ltx_text" id="bib.bib30.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, Mike Lewis, Wen-tau Yih, Tim Rocktäschel, et al<span class="ltx_text" id="bib.bib30.3.1">.</span> 2020.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for knowledge-intensive nlp tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.4.1">Advances in Neural Information Processing Systems</em> 33 (2020), 9459–9474.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al<span class="ltx_text" id="bib.bib31.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ji Lin, Jiaming Tang, Haotian Tang, Shang Yang, Xingyu Dang, and Song Han. 2023.

</span>
<span class="ltx_bibblock">Awq: Activation-aware weight quantization for llm compression and acceleration.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.3.1">arXiv preprint arXiv:2306.00978</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu (2022)</span>
<span class="ltx_bibblock">
Jerry Liu. 2022.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">LlamaIndex</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.5281/zenodo.1234" title="">https://doi.org/10.5281/zenodo.1234</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib33.2.2.1">.</span> (2024a)</span>
<span class="ltx_bibblock">
Yuhan Liu, Hanchen Li, Yihua Cheng, Siddhant Ray, Yuyang Huang, Qizheng Zhang, Kuntai Du, Jiayi Yao, Shan Lu, Ganesh Ananthanarayanan, Michael Maire, Henry Hoffmann, Ari Holtzman, and Junchen Jiang. 2024a.

</span>
<span class="ltx_bibblock">CacheGen: KV Cache Compression and Streaming for Fast Large Language Model Serving. In <em class="ltx_emph ltx_font_italic" id="bib.bib33.3.1">Proceedings of the ACM SIGCOMM 2024 Conference</em> (Sydney, NSW, Australia) <em class="ltx_emph ltx_font_italic" id="bib.bib33.4.2">(ACM SIGCOMM ’24)</em>. Association for Computing Machinery, New York, NY, USA, 38–56.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3651890.3672274" title="">https://doi.org/10.1145/3651890.3672274</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib34.2.2.1">.</span> (2024b)</span>
<span class="ltx_bibblock">
Zirui Liu, Jiayi Yuan, Hongye Jin, Shaochen Zhong, Zhaozhuo Xu, Vladimir Braverman, Beidi Chen, and Xia Hu. 2024b.

</span>
<span class="ltx_bibblock">KIVI: A Tuning-Free Asymmetric 2bit Quantization for KV Cache.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.3.1">arXiv preprint arXiv:2402.02750</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mu et al<span class="ltx_text" id="bib.bib35.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Jesse Mu, Xiang Lisa Li, and Noah Goodman. 2023.

</span>
<span class="ltx_bibblock">Learning to Compress Prompts with Gist Tokens. In <em class="ltx_emph ltx_font_italic" id="bib.bib35.3.1">Thirty-seventh Conference on Neural Information Processing Systems</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=2DtxPCL3T5" title="">https://openreview.net/forum?id=2DtxPCL3T5</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nam et al<span class="ltx_text" id="bib.bib36.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Daye Nam, Andrew Macvean, Vincent Hellendoorn, Bogdan Vasilescu, and Brad Myers. 2024.

</span>
<span class="ltx_bibblock">Using an llm to help with code understanding. In <em class="ltx_emph ltx_font_italic" id="bib.bib36.3.1">Proceedings of the IEEE/ACM 46th International Conference on Software Engineering</em>. 1–13.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Narayanan et al<span class="ltx_text" id="bib.bib37.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Deepak Narayanan, Aaron Harlap, Amar Phanishayee, Vivek Seshadri, Nikhil R. Devanur, Gregory R. Ganger, Phillip B. Gibbons, and Matei Zaharia. 2019.

</span>
<span class="ltx_bibblock">PipeDream: generalized pipeline parallelism for DNN training. In <em class="ltx_emph ltx_font_italic" id="bib.bib37.3.1">Proceedings of the 27th ACM Symposium on Operating Systems Principles</em> (Huntsville, Ontario, Canada) <em class="ltx_emph ltx_font_italic" id="bib.bib37.4.2">(SOSP ’19)</em>. Association for Computing Machinery, New York, NY, USA, 1–15.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3341301.3359646" title="">https://doi.org/10.1145/3341301.3359646</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2024a)</span>
<span class="ltx_bibblock">
NVIDIA. 2024a.

</span>
<span class="ltx_bibblock">gdrcopy.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/NVIDIA/gdrcopy" title="">https://github.com/NVIDIA/gdrcopy</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2024b)</span>
<span class="ltx_bibblock">
NVIDIA. 2024b.

</span>
<span class="ltx_bibblock">Long context prompting for Claude 2.1.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.anthropic.com/news/claude-2-1-prompting" title="">https://www.anthropic.com/news/claude-2-1-prompting</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Website].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2024c)</span>
<span class="ltx_bibblock">
NVIDIA. 2024c.

</span>
<span class="ltx_bibblock">TensorRT-LLM.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/NVIDIA/TensorRT-LLM" title="">https://github.com/NVIDIA/TensorRT-LLM</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024)</span>
<span class="ltx_bibblock">
OpenAI. 2024.

</span>
<span class="ltx_bibblock">ChatGPT.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://chat.openai.com/" title="">https://chat.openai.com/</a>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">[Computer software].

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pang et al<span class="ltx_text" id="bib.bib42.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Richard Yuanzhe Pang, Alicia Parrish, Nitish Joshi, Nikita Nangia, Jason Phang, Angelica Chen, Vishakh Padmakumar, Johnny Ma, Jana Thompson, He He, and Samuel Bowman. 2022.

</span>
<span class="ltx_bibblock">QuALITY: Question Answering with Long Input Texts, Yes!. In <em class="ltx_emph ltx_font_italic" id="bib.bib42.3.1">Proceedings of the 2022 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies</em>. Association for Computational Linguistics, Seattle, United States, 5336–5358.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.naacl-main.391" title="">https://aclanthology.org/2022.naacl-main.391</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et al<span class="ltx_text" id="bib.bib43.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Bo Peng, Eric Alcaide, Quentin Anthony, Alon Albalak, Samuel Arcadinho, Huanqi Cao, Xin Cheng, Michael Chung, Matteo Grella, Kranthi Kiran GV, et al<span class="ltx_text" id="bib.bib43.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Rwkv: Reinventing rnns for the transformer era.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib43.4.1">arXiv preprint arXiv:2305.13048</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer (2019)</span>
<span class="ltx_bibblock">
Noam Shazeer. 2019.

</span>
<span class="ltx_bibblock">Fast transformer decoding: One write-head is all you need.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:1911.02150</em> (2019).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sheng et al<span class="ltx_text" id="bib.bib45.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ying Sheng, Lianmin Zheng, Binhang Yuan, Zhuohan Li, Max Ryabinin, Beidi Chen, Percy Liang, Christopher Ré, Ion Stoica, and Ce Zhang. 2023.

</span>
<span class="ltx_bibblock">FlexGen: high-throughput generative inference of large language models with a single GPU. In <em class="ltx_emph ltx_font_italic" id="bib.bib45.3.1">Proceedings of the 40th International Conference on Machine Learning</em> (, Honolulu, Hawaii, USA,) <em class="ltx_emph ltx_font_italic" id="bib.bib45.4.2">(ICML’23)</em>. JMLR.org, Article 1288, 23 pages.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Song et al<span class="ltx_text" id="bib.bib46.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Xiaoniu Song, Yiwen Zhang, Rong Chen, and Haibo Chen. 2023.

</span>
<span class="ltx_bibblock">UGACHE: A Unified GPU Cache for Embedding-based Deep Learning. In <em class="ltx_emph ltx_font_italic" id="bib.bib46.3.1">Proceedings of the 29th Symposium on Operating Systems Principles</em> (Koblenz, Germany) <em class="ltx_emph ltx_font_italic" id="bib.bib46.4.2">(SOSP ’23)</em>. Association for Computing Machinery, New York, NY, USA, 627–641.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3600006.3613169" title="">https://doi.org/10.1145/3600006.3613169</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Su et al<span class="ltx_text" id="bib.bib47.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Jianlin Su, Murtadha Ahmed, Yu Lu, Shengfeng Pan, Wen Bo, and Yunfeng Liu. 2024.

</span>
<span class="ltx_bibblock">Roformer: Enhanced transformer with rotary position embedding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib47.3.1">Neurocomputing</em> 568 (2024), 127063.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Team et al<span class="ltx_text" id="bib.bib48.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Gemma Team, Thomas Mesnard, Cassidy Hardin, Robert Dadashi, Surya Bhupatiraju, Shreya Pathak, Laurent Sifre, Morgane Rivière, Mihir Sanjay Kale, Juliette Love, Pouya Tafti, Léonard Hussenot, Pier Giuseppe Sessa, Aakanksha Chowdhery, Adam Roberts, Aditya Barua, Alex Botev, Alex Castro-Ros, Ambrose Slone, Amélie Héliou, Andrea Tacchetti, Anna Bulanova, Antonia Paterson, Beth Tsai, Bobak Shahriari, Charline Le Lan, Christopher A. Choquette-Choo, Clément Crepy, Daniel Cer,
Daphne Ippolito, David Reid, Elena Buchatskaya, Eric Ni, Eric Noland, Geng Yan, George Tucker, George-Christian Muraru, Grigory Rozhdestvenskiy, Henryk Michalewski, Ian Tenney, Ivan Grishchenko, Jacob Austin, James Keeling, Jane Labanowski, Jean-Baptiste Lespiau, Jeff Stanway, Jenny Brennan, Jeremy Chen, Johan Ferret, Justin Chiu, Justin Mao-Jones, Katherine Lee, Kathy Yu, Katie Millican, Lars Lowe Sjoesund, Lisa Lee, Lucas Dixon, Machel Reid, Maciej Mikuła,
Mateo Wirth, Michael Sharman, Nikolai Chinaev, Nithum Thain, Olivier Bachem, Oscar Chang, Oscar Wahltinez, Paige Bailey, Paul Michel, Petko Yotov, Rahma Chaabouni, Ramona Comanescu, Reena Jana, Rohan Anil, Ross McIlroy, Ruibo Liu, Ryan Mullins, Samuel L Smith, Sebastian Borgeaud, Sertan Girgin, Sholto Douglas, Shree Pandya, Siamak Shakeri, Soham De, Ted Klimenko, Tom Hennigan, Vlad Feinberg, Wojciech Stokowiec, Yu hui Chen, Zafarali Ahmed, Zhitao Gong,
Tris Warkentin, Ludovic Peran, Minh Giang, Clément Farabet, Oriol Vinyals, Jeff Dean, Koray Kavukcuoglu, Demis Hassabis, Zoubin Ghahramani, Douglas Eck, Joelle Barral, Fernando Pereira, Eli Collins, Armand Joulin, Noah Fiedel, Evan Senter, Alek Andreev, and Kathleen Kenealy. 2024.

</span>
<span class="ltx_bibblock">Gemma: Open Models Based on Gemini Research and Technology.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2403.08295 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tonmoy et al<span class="ltx_text" id="bib.bib49.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
SM Tonmoy, SM Zaman, Vinija Jain, Anku Rani, Vipula Rawte, Aman Chadha, and Amitava Das. 2024.

</span>
<span class="ltx_bibblock">A comprehensive survey of hallucination mitigation techniques in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib49.3.1">arXiv preprint arXiv:2401.01313</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al<span class="ltx_text" id="bib.bib50.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, Dan Bikel, Lukas Blecher, Cristian Canton Ferrer, Moya Chen, Guillem Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller, Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez, Madian Khabsa,
Isabel Kloumann, Artem Korenev, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier Martinet, Todor Mihaylov, Pushkar Mishra, Igor Molybog, Yixin Nie, Andrew Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan Silva, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Adina Williams, Jian Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan Zarov, Yuchen
Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Sergey Edunov, and Thomas Scialom. 2023.

</span>
<span class="ltx_bibblock">Llama 2: Open Foundation and Fine-Tuned Chat Models.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2307.09288 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al<span class="ltx_text" id="bib.bib51.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib51.3.1">Advances in neural information processing systems</em> 30 (2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib52.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Lei Wang, Chen Ma, Xueyang Feng, Zeyu Zhang, Hao Yang, Jingsen Zhang, Zhiyuan Chen, Jiakai Tang, Xu Chen, Yankai Lin, Wayne Xin Zhao, Zhewei Wei, and Jirong Wen. 2024.

</span>
<span class="ltx_bibblock">A survey on large language model based autonomous agents.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib52.3.1">Frontiers of Computer Science</em> 18, 6 (March 2024).

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1007/s11704-024-40231-1" title="">https://doi.org/10.1007/s11704-024-40231-1</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al<span class="ltx_text" id="bib.bib53.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Bingyang Wu, Yinmin Zhong, Zili Zhang, Gang Huang, Xuanzhe Liu, and Xin Jin. 2023.

</span>
<span class="ltx_bibblock">Fast distributed inference serving for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib53.3.1">arXiv preprint arXiv:2305.05920</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xi et al<span class="ltx_text" id="bib.bib54.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Zhiheng Xi, Wenxiang Chen, Xin Guo, Wei He, Yiwen Ding, Boyang Hong, Ming Zhang, Junzhe Wang, Senjie Jin, Enyu Zhou, Rui Zheng, Xiaoran Fan, Xiao Wang, Limao Xiong, Yuhao Zhou, Weiran Wang, Changhao Jiang, Yicheng Zou, Xiangyang Liu, Zhangyue Yin, Shihan Dou, Rongxiang Weng, Wensen Cheng, Qi Zhang, Wenjuan Qin, Yongyan Zheng, Xipeng Qiu, Xuanjing Huang, and Tao Gui. 2023.

</span>
<span class="ltx_bibblock">The Rise and Potential of Large Language Model Based Agents: A Survey.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2309.07864 [cs.AI]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al<span class="ltx_text" id="bib.bib55.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Guangxuan Xiao, Ji Lin, Mickael Seznec, Hao Wu, Julien Demouth, and Song Han. 2023.

</span>
<span class="ltx_bibblock">SmoothQuant: Accurate and Efficient Post-Training Quantization for Large Language Models. In <em class="ltx_emph ltx_font_italic" id="bib.bib55.3.1">Proceedings of the 40th International Conference on Machine Learning</em> <em class="ltx_emph ltx_font_italic" id="bib.bib55.4.2">(Proceedings of Machine Learning Research, Vol. 202)</em>, Andreas Krause, Emma Brunskill, Kyunghyun Cho, Barbara Engelhardt, Sivan Sabato, and Jonathan Scarlett (Eds.). PMLR, 38087–38099.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.mlr.press/v202/xiao23c.html" title="">https://proceedings.mlr.press/v202/xiao23c.html</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al<span class="ltx_text" id="bib.bib56.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Minhui Xie, Youyou Lu, Jiazhen Lin, Qing Wang, Jian Gao, Kai Ren, and Jiwu Shu. 2022.

</span>
<span class="ltx_bibblock">Fleche: an efficient GPU embedding cache for personalized recommendations. In <em class="ltx_emph ltx_font_italic" id="bib.bib56.3.1">Proceedings of the Seventeenth European Conference on Computer Systems</em> (Rennes, France) <em class="ltx_emph ltx_font_italic" id="bib.bib56.4.2">(EuroSys ’22)</em>. Association for Computing Machinery, New York, NY, USA, 402–416.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3492321.3519554" title="">https://doi.org/10.1145/3492321.3519554</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al<span class="ltx_text" id="bib.bib57.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Minhui Xie, Youyou Lu, Qing Wang, Yangyang Feng, Jiaqiang Liu, Kai Ren, and Jiwu Shu. 2023.

</span>
<span class="ltx_bibblock">PetPS: Supporting huge embedding models with persistent memory.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib57.3.1">Proceedings of the VLDB Endowment</em> 16, 5 (2023), 1013–1022.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al<span class="ltx_text" id="bib.bib58.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Minhui Xie, Kai Ren, Youyou Lu, Guangxu Yang, Qingxing Xu, Bihai Wu, Jiazhen Lin, Hongbo Ao, Wanhong Xu, and Jiwu Shu. 2020.

</span>
<span class="ltx_bibblock">Kraken: memory-efficient continual learning for large-scale real-time recommendations. In <em class="ltx_emph ltx_font_italic" id="bib.bib58.3.1">SC20: International Conference for High Performance Computing, Networking, Storage and Analysis</em>. IEEE, 1–17.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span class="ltx_text" id="bib.bib59.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
June Yong Yang, Byeongwook Kim, Jeongin Bae, Beomseok Kwon, Gunho Park, Eunho Yang, Se Jung Kwon, and Dongsoo Lee. 2024.

</span>
<span class="ltx_bibblock">No Token Left Behind: Reliable KV Cache Compression via Importance-Aware Mixed Precision Quantization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib59.3.1">arXiv preprint arXiv:2402.18096</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib60">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span class="ltx_text" id="bib.bib60.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Ziye Yang, James R Harris, Benjamin Walker, Daniel Verkamp, Changpeng Liu, Cunyin Chang, Gang Cao, Jonathan Stern, Vishal Verma, and Luse E Paul. 2017.

</span>
<span class="ltx_bibblock">SPDK: A development kit to build high performance storage applications. In <em class="ltx_emph ltx_font_italic" id="bib.bib60.3.1">2017 IEEE International Conference on Cloud Computing Technology and Science (CloudCom)</em>. IEEE, 154–161.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib61">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ye et al<span class="ltx_text" id="bib.bib61.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Lu Ye, Ze Tao, Yong Huang, and Yang Li. 2024.

</span>
<span class="ltx_bibblock">ChunkAttention: Efficient Attention on KV Cache with Chunking Sharing and Batching.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=9k27IITeAZ" title="">https://openreview.net/forum?id=9k27IITeAZ</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib62">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu et al<span class="ltx_text" id="bib.bib62.4.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Gyeong-In Yu, Joo Seong Jeong, Geon-Woo Kim, Soojeong Kim, and Byung-Gon Chun. 2022.

</span>
<span class="ltx_bibblock">Orca: A distributed serving system for <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib62.1.m1.1"><semantics id="bib.bib62.1.m1.1a"><mo id="bib.bib62.1.m1.1.1" stretchy="false" xref="bib.bib62.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib62.1.m1.1b"><ci id="bib.bib62.1.m1.1.1.cmml" xref="bib.bib62.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib62.1.m1.1c">\{</annotation><annotation encoding="application/x-llamapun" id="bib.bib62.1.m1.1d">{</annotation></semantics></math>Transformer-Based<math alttext="\}" class="ltx_Math" display="inline" id="bib.bib62.2.m2.1"><semantics id="bib.bib62.2.m2.1a"><mo id="bib.bib62.2.m2.1.1" stretchy="false" xref="bib.bib62.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib62.2.m2.1b"><ci id="bib.bib62.2.m2.1.1.cmml" xref="bib.bib62.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib62.2.m2.1c">\}</annotation><annotation encoding="application/x-llamapun" id="bib.bib62.2.m2.1d">}</annotation></semantics></math> generative models. In <em class="ltx_emph ltx_font_italic" id="bib.bib62.5.1">16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)</em>. 521–538.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib63">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu and Li (2023)</span>
<span class="ltx_bibblock">
Lingfan Yu and Jinyang Li. 2023.

</span>
<span class="ltx_bibblock">Stateful Large Language Model Serving with Pensieve.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2312.05516 [cs.LG]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib64">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib64.2.2.1">.</span> (2024b)</span>
<span class="ltx_bibblock">
Tianyi Zhang, Jonah Yi, Zhaozhuo Xu, and Anshumali Shrivastava. 2024b.

</span>
<span class="ltx_bibblock">KV Cache is 1 Bit Per Channel: Efficient Large Language Model Inference with Coupled Quantization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib64.3.1">arXiv preprint arXiv:2405.03917</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib65">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib65.2.2.1">.</span> (2024a)</span>
<span class="ltx_bibblock">
Zhenyu Zhang, Ying Sheng, Tianyi Zhou, Tianlong Chen, Lianmin Zheng, Ruisi Cai, Zhao Song, Yuandong Tian, Christopher Ré, Clark Barrett, et al<span class="ltx_text" id="bib.bib65.3.1">.</span> 2024a.

</span>
<span class="ltx_bibblock">H2o: Heavy-hitter oracle for efficient generative inference of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib65.4.1">Advances in Neural Information Processing Systems</em> 36 (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib66">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhao et al<span class="ltx_text" id="bib.bib66.2.2.1">.</span> (2023a)</span>
<span class="ltx_bibblock">
Yilong Zhao, Chien-Yu Lin, Kan Zhu, Zihao Ye, Lequn Chen, Size Zheng, Luis Ceze, Arvind Krishnamurthy, Tianqi Chen, and Baris Kasikci. 2023a.

</span>
<span class="ltx_bibblock">Atom: Low-bit quantization for efficient and accurate llm serving.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib66.3.1">arXiv preprint arXiv:2310.19102</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib67">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhao et al<span class="ltx_text" id="bib.bib67.2.2.1">.</span> (2023b)</span>
<span class="ltx_bibblock">
Zoie Zhao, Sophie Song, Bridget Duah, Jamie Macbeth, Scott Carter, Monica P Van, Nayeli Suseth Bravo, Matthew Klenk, Kate Sick, and Alexandre LS Filipowicz. 2023b.

</span>
<span class="ltx_bibblock">More human than human: LLM-generated narratives outperform human-LLM interleaved narratives. In <em class="ltx_emph ltx_font_italic" id="bib.bib67.3.1">Proceedings of the 15th Conference on Creativity and Cognition</em>. 368–370.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib68">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al<span class="ltx_text" id="bib.bib68.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Lianmin Zheng, Liangsheng Yin, Zhiqiang Xie, Jeff Huang, Chuyue Sun, Cody Hao Yu, Shiyi Cao, Christos Kozyrakis, Ion Stoica, Joseph E. Gonzalez, Clark Barrett, and Ying Sheng. 2023.

</span>
<span class="ltx_bibblock">Efficiently Programming Large Language Models using SGLang.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2312.07104 [cs.AI]

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon Oct  7 13:00:22 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
