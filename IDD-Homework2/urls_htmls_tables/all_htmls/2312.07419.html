<!DOCTYPE html>

<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Towards Faster k-Nearest-Neighbor Machine Translation</title>
<!--Generated on Tue Dec 12 16:37:04 2023 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv_0.7.4.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2312.07419v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="#Sx1" title="Introduction ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#Sx2" title="Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Background</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx1" title="Neural Machine Translation ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Neural Machine Translation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx2" title="Domain Adaptation for NMT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Domain Adaptation for NMT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx3" title="Retrieval-Argmented Text Generation ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Retrieval-Argmented Text Generation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="#Sx2.SSx4" title="𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title"><math alttext="k" class="ltx_Math" display="inline"><semantics><mi>k</mi><annotation-xml encoding="MathML-Content"><ci>𝑘</ci></annotation-xml><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>NN-MT</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx2.SSx4.SSSx1" title="Datastore ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Datastore</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx2.SSx4.SSSx2" title="Estimation of Probability Distribution ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Estimation of Probability Distribution</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx5" title="Adaptive-kNN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Adaptive-kNN-MT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx6" title="PCK-kNN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">PCK-kNN-MT</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx7" title="Some Other 𝑘NN-MT Variants ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Some Other <math alttext="k" class="ltx_Math" display="inline"><semantics><mi>k</mi><annotation-xml encoding="MathML-Content"><ci>𝑘</ci></annotation-xml><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>NN-MT Variants</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx2.SSx8" title="kNN-BOX ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">kNN-BOX</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#Sx3" title="Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Methodolgy</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx3.SSx8.SSSx1" title="Our Mehtod ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Our Mehtod</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx3.SSx8.SSSx2" title="Training Procedures ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Training Procedures</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx3.SSx8.SSSx3" title="Metrics ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Metrics</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx3.SSx8.SSSx4" title="Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Integration</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#Sx4" title="Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#Sx4.SSx1" title="Hyper-parameters ‣ Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Hyper-parameters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="#Sx4.SSx2" title="Results ‣ Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Results</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx4.SSx2.SSSx1" title="The selector succeeds in discriminating samples that need retrievals. ‣ Results ‣ Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">The selector succeeds in discriminating samples that need retrievals.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx4.SSx2.SSSx2" title="The selector significantly speeds up existing 𝑘NN-MT system. ‣ Results ‣ Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">The selector significantly speeds up existing <math alttext="k" class="ltx_Math" display="inline"><semantics><mi>k</mi><annotation-xml encoding="MathML-Content"><ci>𝑘</ci></annotation-xml><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>NN-MT system.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx4.SSx2.SSSx3" title="Ablation for translation loss. ‣ Results ‣ Experiments ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Ablation for translation loss.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#Sx5" title="Discussion ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx5.SSx2.SSSx1" title="Different implementations of baselines from previous works ‣ Discussion ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Different implementations of baselines from previous works</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#Sx5.SSx2.SSSx2" title="Comments on our method ‣ Discussion ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Comments on our method</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="#Sx6" title="Conclusion ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_title">Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<div aria-label="”Conversion" been="" class="package-alerts ltx_document" errors="" found”="" have="" role="“status”">
<button aria-label="Dismiss alert" onclick="closePopup()">
<span aria-hidden="true"><svg aria-hidden="true" focusable="false" height="20" role="presentation" viewbox="0 0 44 44" width="20">
<path d="M0.549989 4.44999L4.44999 0.549988L43.45 39.55L39.55 43.45L0.549989 4.44999Z"></path>
<path d="M39.55 0.549988L43.45 4.44999L4.44999 43.45L0.549988 39.55L39.55 0.549988Z"></path>
</svg></span>
</button>
<p>HTML conversions <a href="https://info.dev.arxiv.org/about/accessibility_html_error_messages.html" target="_blank">sometimes display errors</a> due to content that did not convert correctly from the source. This paper uses the following packages that are not yet supported by the HTML conversion tool. Feedback on these issues are not necessary; they are known and are being worked on.</p>
<ul arial-label="Unsupported packages used in this paper">
<li>failed: bibentry</li>
</ul>
<p>Authors: achieve the best HTML results from your LaTeX submissions by selecting from this list of <a href="https://corpora.mathweb.org/corpus/arxmliv/tex_to_html/info/loaded_file" target="_blank">supported packages</a>.</p>
</div><div class="section" id="target-section"><div id="license-tr">License: CC BY 4.0</div><div id="watermark-tr">arXiv:2312.07419v1 [cs.CL] 12 Dec 2023</div></div>
<script>
            function closePopup() {
                document.querySelector('.package-alerts').style.display = 'none';
            }
        </script>
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Towards Faster k-Nearest-Neighbor Machine Translation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Xiangyu Shi<sup class="ltx_sup" id="id2.1.id1">1</sup>,
Yunlong Liang<sup class="ltx_sup" id="id3.2.id2">1</sup>,
Jinan Xu<sup class="ltx_sup" id="id4.3.id3">1</sup>,
Yufeng Chen<sup class="ltx_sup" id="id5.4.id4">1</sup>
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id1.1">Recent works have proven the effectiveness of k-nearest-neighbor machine translation(a.k.a kNN-MT) approaches
to produce remarkable improvement in cross-domain translations. However,
these models suffer from heavy retrieve overhead on the entire
datastore when decoding each token.
We observe that during the decoding phase,
about 67% to 84% of tokens are unvaried after
searching over the corpus datastore,
which means most of the tokens cause futile
retrievals and introduce unnecessary computational
costs by initiating k-nearest-neighbor searches.
We consider this phenomenon is explainable in linguistics
and propose a simple yet effective multi-layer perceptron (MLP) network to predict
whether a token should be translated jointly by the neural machine translation model
and probabilities produced by the kNN or just by the neural model.
The results show that our method succeeds in reducing redundant retrieval operations and
significantly reduces the overhead of <math alttext="k" class="ltx_Math" display="inline" id="id1.1.m1.1"><semantics id="id1.1.m1.1a"><mi id="id1.1.m1.1.1" xref="id1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id1.1.m1.1b"><ci id="id1.1.m1.1.1.cmml" xref="id1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="id1.1.m1.1d">italic_k</annotation></semantics></math>NN retrievals by up to 53%
at the expense of a slight decline in translation quality.
Moreover, our method could work together with all existing kNN-MT systems.</p>
</div>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Introduction</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.5">Transformer  <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al. <a class="ltx_ref" href="#bib.bib28" title="">2017</a>)</cite> based neural machine translation(NMT) have shown promising performance and evolved various methodologies for further improvements.
The neural translation models try to learn representations of the semantics on the upstream corpus and
generalize to downstream tasks by classifying representations to some tokens,
therefore out-of-domain issues occur.
The recent concerned <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p1.1.m1.1"><semantics id="Sx1.p1.1.m1.1a"><mi id="Sx1.p1.1.m1.1.1" xref="Sx1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p1.1.m1.1b"><ci id="Sx1.p1.1.m1.1.1.cmml" xref="Sx1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p1.1.m1.1d">italic_k</annotation></semantics></math> nearest neighbor machine translation(<math alttext="k" class="ltx_Math" display="inline" id="Sx1.p1.2.m2.1"><semantics id="Sx1.p1.2.m2.1a"><mi id="Sx1.p1.2.m2.1.1" xref="Sx1.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p1.2.m2.1b"><ci id="Sx1.p1.2.m2.1.1.cmml" xref="Sx1.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT)  <cite class="ltx_cite ltx_citemacro_citep">(Khandelwal et al. <a class="ltx_ref" href="#bib.bib12" title="">2021</a>)</cite>
proposes a non-parametric method to enhance NMT systems.
At each decoding phase <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p1.3.m3.1"><semantics id="Sx1.p1.3.m3.1a"><mi id="Sx1.p1.3.m3.1.1" xref="Sx1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p1.3.m3.1b"><ci id="Sx1.p1.3.m3.1.1.cmml" xref="Sx1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p1.3.m3.1d">italic_k</annotation></semantics></math>NN-MT retrieves by current latent representation
to potential target tokens in a pre-built key-value datastore,
it jointly considers the probabilities distribution of
each token given by the neural model and the <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p1.4.m4.1"><semantics id="Sx1.p1.4.m4.1a"><mi id="Sx1.p1.4.m4.1.1" xref="Sx1.p1.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p1.4.m4.1b"><ci id="Sx1.p1.4.m4.1.1.cmml" xref="Sx1.p1.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p1.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p1.4.m4.1d">italic_k</annotation></semantics></math> nearest reference tokens.
When using an out-of-domain neural translation model,
the datastore could be created from an
in-domain corpus, thus <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p1.5.m5.1"><semantics id="Sx1.p1.5.m5.1a"><mi id="Sx1.p1.5.m5.1.1" xref="Sx1.p1.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p1.5.m5.1b"><ci id="Sx1.p1.5.m5.1.1.cmml" xref="Sx1.p1.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p1.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p1.5.m5.1d">italic_k</annotation></semantics></math>NN-MT significantly rises the
performance on cross-domain machine translations.
Besides, it could also slightly boost the results of in-domain translations.</p>
</div>
<figure class="ltx_figure" id="Sx1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="758" id="Sx1.F1.g1" src="extracted/5290628/figures/inference.png" width="538"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Overview of our method. The selector predicts all the tokens to decide whether to revise the probability distribution. <math alttext="k" class="ltx_Math" display="inline" id="Sx1.F1.3.m1.1"><semantics id="Sx1.F1.3.m1.1b"><mi id="Sx1.F1.3.m1.1.1" xref="Sx1.F1.3.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.F1.3.m1.1c"><ci id="Sx1.F1.3.m1.1.1.cmml" xref="Sx1.F1.3.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.F1.3.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.F1.3.m1.1e">italic_k</annotation></semantics></math>NN retrievals only occur on parted tokens instead of all tokens, thus we speed up the <math alttext="k" class="ltx_Math" display="inline" id="Sx1.F1.4.m2.1"><semantics id="Sx1.F1.4.m2.1b"><mi id="Sx1.F1.4.m2.1.1" xref="Sx1.F1.4.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.F1.4.m2.1c"><ci id="Sx1.F1.4.m2.1.1.cmml" xref="Sx1.F1.4.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.F1.4.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.F1.4.m2.1e">italic_k</annotation></semantics></math>NN-MT systems.</figcaption>
</figure>
<div class="ltx_para" id="Sx1.p2">
<p class="ltx_p" id="Sx1.p2.4">However, massive retrievals from entire datastore
by high-dimension representations bring
non-negligible computational costs to <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p2.1.m1.1"><semantics id="Sx1.p2.1.m1.1a"><mi id="Sx1.p2.1.m1.1.1" xref="Sx1.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p2.1.m1.1b"><ci id="Sx1.p2.1.m1.1.1.cmml" xref="Sx1.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p2.1.m1.1d">italic_k</annotation></semantics></math>NN-MT systems.
According to the primitive paper of <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p2.2.m2.1"><semantics id="Sx1.p2.2.m2.1a"><mi id="Sx1.p2.2.m2.1.1" xref="Sx1.p2.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p2.2.m2.1b"><ci id="Sx1.p2.2.m2.1.1.cmml" xref="Sx1.p2.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p2.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p2.2.m2.1d">italic_k</annotation></semantics></math>NN-MT <cite class="ltx_cite ltx_citemacro_citep">(Khandelwal et al. <a class="ltx_ref" href="#bib.bib12" title="">2021</a>)</cite>,
<math alttext="k" class="ltx_Math" display="inline" id="Sx1.p2.3.m3.1"><semantics id="Sx1.p2.3.m3.1a"><mi id="Sx1.p2.3.m3.1.1" xref="Sx1.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p2.3.m3.1b"><ci id="Sx1.p2.3.m3.1.1.cmml" xref="Sx1.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p2.3.m3.1d">italic_k</annotation></semantics></math>NN introduces two-orders slower to original NMT models.
This overhead limits the applications of <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p2.4.m4.1"><semantics id="Sx1.p2.4.m4.1a"><mi id="Sx1.p2.4.m4.1.1" xref="Sx1.p2.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p2.4.m4.1b"><ci id="Sx1.p2.4.m4.1.1.cmml" xref="Sx1.p2.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p2.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p2.4.m4.1d">italic_k</annotation></semantics></math>NN-MT systems
to some practical scenarios, such as instant translation tasks.</p>
</div>
<figure class="ltx_table" id="Sx1.T1">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="Sx1.T1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx1.T1.1.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="Sx1.T1.1.1.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx1.T1.1.1.1.2">IT</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx1.T1.1.1.1.3">Koran</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx1.T1.1.1.1.4">Law</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx1.T1.1.1.1.5">Medical</td>
</tr>
<tr class="ltx_tr" id="Sx1.T1.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="Sx1.T1.1.2.2.1">Redundant</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx1.T1.1.2.2.2">0.80</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx1.T1.1.2.2.3">0.67</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx1.T1.1.2.2.4">0.84</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx1.T1.1.2.2.5">0.81</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Redundant ratio tested on multi-domain dataset
 <cite class="ltx_cite ltx_citemacro_citep">(Koehn and Knowles <a class="ltx_ref" href="#bib.bib14" title="">2017</a>; Aharoni and Goldberg <a class="ltx_ref" href="#bib.bib1" title="">2020</a>)</cite>. The results are measured on test set, and beam searching has been considered in. </figcaption>
</figure>
<div class="ltx_para" id="Sx1.p3">
<p class="ltx_p" id="Sx1.p3.3">Previous works for accelerating <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p3.1.m1.1"><semantics id="Sx1.p3.1.m1.1a"><mi id="Sx1.p3.1.m1.1.1" xref="Sx1.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p3.1.m1.1b"><ci id="Sx1.p3.1.m1.1.1.cmml" xref="Sx1.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p3.1.m1.1d">italic_k</annotation></semantics></math>NN-MT systems suggest
shrinking the size of the datastore <cite class="ltx_cite ltx_citemacro_citep">(Meng et al. <a class="ltx_ref" href="#bib.bib21" title="">2022</a>; Wang et al. <a class="ltx_ref" href="#bib.bib29" title="">2022</a>; Martins, Marinho, and Martins <a class="ltx_ref" href="#bib.bib19" title="">2022</a>)</cite>,
reducing the dimension of representation for retrieval <cite class="ltx_cite ltx_citemacro_citep">(Wang et al. <a class="ltx_ref" href="#bib.bib29" title="">2022</a>; Martins, Marinho, and Martins <a class="ltx_ref" href="#bib.bib19" title="">2022</a>)</cite>.
We observe that about 67%-84% predicted tokens
are kept unchanged on its datasets after being revised by the vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p3.2.m2.1"><semantics id="Sx1.p3.2.m2.1a"><mi id="Sx1.p3.2.m2.1.1" xref="Sx1.p3.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p3.2.m2.1b"><ci id="Sx1.p3.2.m2.1.1.cmml" xref="Sx1.p3.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p3.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p3.2.m2.1d">italic_k</annotation></semantics></math>NN-MT system, which means retrievals for these tokens
bring redundant computational overhead, as shown in table  <a class="ltx_ref" href="#Sx1.T1" title="Table 1 ‣ Introduction ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>. Towards faster <math alttext="k" class="ltx_Math" display="inline" id="Sx1.p3.3.m3.1"><semantics id="Sx1.p3.3.m3.1a"><mi id="Sx1.p3.3.m3.1.1" xref="Sx1.p3.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.p3.3.m3.1b"><ci id="Sx1.p3.3.m3.1.1.cmml" xref="Sx1.p3.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.p3.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.p3.3.m3.1d">italic_k</annotation></semantics></math>NN-MT,
we proposed a simple yet effective MLP to predict the necessity to retrieve each token.
The translation procedure is shown as figure  <a class="ltx_ref" href="#Sx1.F1" title="Figure 1 ‣ Introduction ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>. We only add an MLP (so-called selector) after an off-the-shelf NMT model.</p>
</div>
<div class="ltx_para" id="Sx1.p4">
<p class="ltx_p" id="Sx1.p4.1">We propose our contributions are:</p>
</div>
<div class="ltx_para" id="Sx1.p5">
<ul class="ltx_itemize" id="Sx1.I1">
<li class="ltx_item" id="Sx1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx1.I1.i1.p1">
<p class="ltx_p" id="Sx1.I1.i1.p1.1">We observe that most of the tokens do not require retrievals. This opens up a new idea for <math alttext="k" class="ltx_Math" display="inline" id="Sx1.I1.i1.p1.1.m1.1"><semantics id="Sx1.I1.i1.p1.1.m1.1a"><mi id="Sx1.I1.i1.p1.1.m1.1.1" xref="Sx1.I1.i1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.I1.i1.p1.1.m1.1b"><ci id="Sx1.I1.i1.p1.1.m1.1.1.cmml" xref="Sx1.I1.i1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.I1.i1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.I1.i1.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT.</p>
</div>
</li>
<li class="ltx_item" id="Sx1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx1.I1.i2.p1">
<p class="ltx_p" id="Sx1.I1.i2.p1.1">We provide a simple baseline model for this idea.</p>
</div>
</li>
<li class="ltx_item" id="Sx1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx1.I1.i3.p1">
<p class="ltx_p" id="Sx1.I1.i3.p1.1">Our method and potential similarity methods could work together with any existing <math alttext="k" class="ltx_Math" display="inline" id="Sx1.I1.i3.p1.1.m1.1"><semantics id="Sx1.I1.i3.p1.1.m1.1a"><mi id="Sx1.I1.i3.p1.1.m1.1.1" xref="Sx1.I1.i3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx1.I1.i3.p1.1.m1.1b"><ci id="Sx1.I1.i3.p1.1.m1.1.1.cmml" xref="Sx1.I1.i3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx1.I1.i3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx1.I1.i3.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT system for further accelerating.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="Sx2">
<h2 class="ltx_title ltx_title_section">Background</h2>
<div class="ltx_para" id="Sx2.p1">
<p class="ltx_p" id="Sx2.p1.2">This section briefly introduces the background of <math alttext="k" class="ltx_Math" display="inline" id="Sx2.p1.1.m1.1"><semantics id="Sx2.p1.1.m1.1a"><mi id="Sx2.p1.1.m1.1.1" xref="Sx2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.p1.1.m1.1b"><ci id="Sx2.p1.1.m1.1.1.cmml" xref="Sx2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT, including its previous works, methodologies, and diverse <math alttext="k" class="ltx_Math" display="inline" id="Sx2.p1.2.m2.1"><semantics id="Sx2.p1.2.m2.1a"><mi id="Sx2.p1.2.m2.1.1" xref="Sx2.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.p1.2.m2.1b"><ci id="Sx2.p1.2.m2.1.1.cmml" xref="Sx2.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT variants.</p>
</div>
<section class="ltx_subsection" id="Sx2.SSx1">
<h3 class="ltx_title ltx_title_subsection">Neural Machine Translation</h3>
<div class="ltx_para" id="Sx2.SSx1.p1">
<p class="ltx_p" id="Sx2.SSx1.p1.5">Currently, neural machine translation is implemented under sequence to sequence <cite class="ltx_cite ltx_citemacro_citep">(Sutskever, Vinyals, and Le <a class="ltx_ref" href="#bib.bib27" title="">2014</a>)</cite>
frameworks with attench mechanism <cite class="ltx_cite ltx_citemacro_citep">(Mnih et al. <a class="ltx_ref" href="#bib.bib22" title="">2014</a>; Bahdanau, Cho, and Bengio <a class="ltx_ref" href="#bib.bib2" title="">2015</a>)</cite>.
Given a source sequence <math alttext="\textbf{x}=\{x_{1},\cdots,x_{n}\}" class="ltx_Math" display="inline" id="Sx2.SSx1.p1.1.m1.3"><semantics id="Sx2.SSx1.p1.1.m1.3a"><mrow id="Sx2.SSx1.p1.1.m1.3.3" xref="Sx2.SSx1.p1.1.m1.3.3.cmml"><mtext id="Sx2.SSx1.p1.1.m1.3.3.4" xref="Sx2.SSx1.p1.1.m1.3.3.4a.cmml">𝐱</mtext><mo id="Sx2.SSx1.p1.1.m1.3.3.3" xref="Sx2.SSx1.p1.1.m1.3.3.3.cmml">=</mo><mrow id="Sx2.SSx1.p1.1.m1.3.3.2.2" xref="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml"><mo id="Sx2.SSx1.p1.1.m1.3.3.2.2.3" stretchy="false" xref="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml">{</mo><msub id="Sx2.SSx1.p1.1.m1.2.2.1.1.1" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1.cmml"><mi id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.2" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1.2.cmml">x</mi><mn id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.3" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1.3.cmml">1</mn></msub><mo id="Sx2.SSx1.p1.1.m1.3.3.2.2.4" xref="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml">,</mo><mi id="Sx2.SSx1.p1.1.m1.1.1" mathvariant="normal" xref="Sx2.SSx1.p1.1.m1.1.1.cmml">⋯</mi><mo id="Sx2.SSx1.p1.1.m1.3.3.2.2.5" xref="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml">,</mo><msub id="Sx2.SSx1.p1.1.m1.3.3.2.2.2" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2.cmml"><mi id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.2" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2.2.cmml">x</mi><mi id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.3" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2.3.cmml">n</mi></msub><mo id="Sx2.SSx1.p1.1.m1.3.3.2.2.6" stretchy="false" xref="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx1.p1.1.m1.3b"><apply id="Sx2.SSx1.p1.1.m1.3.3.cmml" xref="Sx2.SSx1.p1.1.m1.3.3"><eq id="Sx2.SSx1.p1.1.m1.3.3.3.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.3"></eq><ci id="Sx2.SSx1.p1.1.m1.3.3.4a.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.4"><mtext id="Sx2.SSx1.p1.1.m1.3.3.4.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.4">𝐱</mtext></ci><set id="Sx2.SSx1.p1.1.m1.3.3.2.3.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.2.2"><apply id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.cmml" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.1.cmml" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1">subscript</csymbol><ci id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.2.cmml" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1.2">𝑥</ci><cn id="Sx2.SSx1.p1.1.m1.2.2.1.1.1.3.cmml" type="integer" xref="Sx2.SSx1.p1.1.m1.2.2.1.1.1.3">1</cn></apply><ci id="Sx2.SSx1.p1.1.m1.1.1.cmml" xref="Sx2.SSx1.p1.1.m1.1.1">⋯</ci><apply id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.1.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2">subscript</csymbol><ci id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.2.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2.2">𝑥</ci><ci id="Sx2.SSx1.p1.1.m1.3.3.2.2.2.3.cmml" xref="Sx2.SSx1.p1.1.m1.3.3.2.2.2.3">𝑛</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx1.p1.1.m1.3c">\textbf{x}=\{x_{1},\cdots,x_{n}\}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx1.p1.1.m1.3d">x = { italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , ⋯ , italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math>, the NMT model <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="Sx2.SSx1.p1.2.m2.1"><semantics id="Sx2.SSx1.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="Sx2.SSx1.p1.2.m2.1.1" xref="Sx2.SSx1.p1.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx1.p1.2.m2.1b"><ci id="Sx2.SSx1.p1.2.m2.1.1.cmml" xref="Sx2.SSx1.p1.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx1.p1.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx1.p1.2.m2.1d">caligraphic_M</annotation></semantics></math> translates <span class="ltx_text ltx_markedasmath ltx_font_bold" id="Sx2.SSx1.p1.5.1">x</span> to
the target sequence <math alttext="\textbf{y}=\{y_{1},\cdots,y_{m}\}" class="ltx_Math" display="inline" id="Sx2.SSx1.p1.4.m4.3"><semantics id="Sx2.SSx1.p1.4.m4.3a"><mrow id="Sx2.SSx1.p1.4.m4.3.3" xref="Sx2.SSx1.p1.4.m4.3.3.cmml"><mtext id="Sx2.SSx1.p1.4.m4.3.3.4" xref="Sx2.SSx1.p1.4.m4.3.3.4a.cmml">𝐲</mtext><mo id="Sx2.SSx1.p1.4.m4.3.3.3" xref="Sx2.SSx1.p1.4.m4.3.3.3.cmml">=</mo><mrow id="Sx2.SSx1.p1.4.m4.3.3.2.2" xref="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml"><mo id="Sx2.SSx1.p1.4.m4.3.3.2.2.3" stretchy="false" xref="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml">{</mo><msub id="Sx2.SSx1.p1.4.m4.2.2.1.1.1" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1.cmml"><mi id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.2" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1.2.cmml">y</mi><mn id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.3" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1.3.cmml">1</mn></msub><mo id="Sx2.SSx1.p1.4.m4.3.3.2.2.4" xref="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml">,</mo><mi id="Sx2.SSx1.p1.4.m4.1.1" mathvariant="normal" xref="Sx2.SSx1.p1.4.m4.1.1.cmml">⋯</mi><mo id="Sx2.SSx1.p1.4.m4.3.3.2.2.5" xref="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml">,</mo><msub id="Sx2.SSx1.p1.4.m4.3.3.2.2.2" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2.cmml"><mi id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.2" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2.2.cmml">y</mi><mi id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.3" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2.3.cmml">m</mi></msub><mo id="Sx2.SSx1.p1.4.m4.3.3.2.2.6" stretchy="false" xref="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx1.p1.4.m4.3b"><apply id="Sx2.SSx1.p1.4.m4.3.3.cmml" xref="Sx2.SSx1.p1.4.m4.3.3"><eq id="Sx2.SSx1.p1.4.m4.3.3.3.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.3"></eq><ci id="Sx2.SSx1.p1.4.m4.3.3.4a.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.4"><mtext id="Sx2.SSx1.p1.4.m4.3.3.4.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.4">𝐲</mtext></ci><set id="Sx2.SSx1.p1.4.m4.3.3.2.3.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.2.2"><apply id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.cmml" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.1.cmml" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1">subscript</csymbol><ci id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.2.cmml" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1.2">𝑦</ci><cn id="Sx2.SSx1.p1.4.m4.2.2.1.1.1.3.cmml" type="integer" xref="Sx2.SSx1.p1.4.m4.2.2.1.1.1.3">1</cn></apply><ci id="Sx2.SSx1.p1.4.m4.1.1.cmml" xref="Sx2.SSx1.p1.4.m4.1.1">⋯</ci><apply id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.1.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2">subscript</csymbol><ci id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.2.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2.2">𝑦</ci><ci id="Sx2.SSx1.p1.4.m4.3.3.2.2.2.3.cmml" xref="Sx2.SSx1.p1.4.m4.3.3.2.2.2.3">𝑚</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx1.p1.4.m4.3c">\textbf{y}=\{y_{1},\cdots,y_{m}\}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx1.p1.4.m4.3d">y = { italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , ⋯ , italic_y start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT }</annotation></semantics></math> in another language.
At each step of decoding,
the NMT model produces the probability distribution over the vocabulary <math alttext="p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="Sx2.SSx1.p1.5.m5.2"><semantics id="Sx2.SSx1.p1.5.m5.2a"><mrow id="Sx2.SSx1.p1.5.m5.2.2" xref="Sx2.SSx1.p1.5.m5.2.2.cmml"><msub id="Sx2.SSx1.p1.5.m5.2.2.3" xref="Sx2.SSx1.p1.5.m5.2.2.3.cmml"><mi id="Sx2.SSx1.p1.5.m5.2.2.3.2" xref="Sx2.SSx1.p1.5.m5.2.2.3.2.cmml">p</mi><mrow id="Sx2.SSx1.p1.5.m5.2.2.3.3" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.cmml"><mi id="Sx2.SSx1.p1.5.m5.2.2.3.3.2" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.2.cmml">M</mi><mo id="Sx2.SSx1.p1.5.m5.2.2.3.3.1" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.1.cmml">⁢</mo><mi id="Sx2.SSx1.p1.5.m5.2.2.3.3.3" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.3.cmml">T</mi></mrow></msub><mo id="Sx2.SSx1.p1.5.m5.2.2.2" xref="Sx2.SSx1.p1.5.m5.2.2.2.cmml">⁢</mo><mrow id="Sx2.SSx1.p1.5.m5.2.2.1.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.cmml"><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.2" stretchy="false" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.cmml">(</mo><mrow id="Sx2.SSx1.p1.5.m5.2.2.1.1.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.cmml"><mover accent="true" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.cmml"><msub id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.cmml"><mi id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.3" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.2.cmml">|</mo><mrow id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.2.cmml"><mtext id="Sx2.SSx1.p1.5.m5.1.1" xref="Sx2.SSx1.p1.5.m5.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.2.cmml">,</mo><msub id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.cmml"><mtext id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.cmml"><mn id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.2" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.1" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.3" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx2.SSx1.p1.5.m5.2.2.1.1.3" stretchy="false" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx1.p1.5.m5.2b"><apply id="Sx2.SSx1.p1.5.m5.2.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2"><times id="Sx2.SSx1.p1.5.m5.2.2.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.2"></times><apply id="Sx2.SSx1.p1.5.m5.2.2.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.5.m5.2.2.3.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3">subscript</csymbol><ci id="Sx2.SSx1.p1.5.m5.2.2.3.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3.2">𝑝</ci><apply id="Sx2.SSx1.p1.5.m5.2.2.3.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3.3"><times id="Sx2.SSx1.p1.5.m5.2.2.3.3.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.1"></times><ci id="Sx2.SSx1.p1.5.m5.2.2.3.3.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.2">𝑀</ci><ci id="Sx2.SSx1.p1.5.m5.2.2.3.3.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.3.3.3">𝑇</ci></apply></apply><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1"><csymbol cd="latexml" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.2">conditional</csymbol><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3"><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.1">^</ci><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2">subscript</csymbol><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.2">𝑦</ci><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1"><ci id="Sx2.SSx1.p1.5.m5.1.1a.cmml" xref="Sx2.SSx1.p1.5.m5.1.1"><mtext id="Sx2.SSx1.p1.5.m5.1.1.cmml" xref="Sx2.SSx1.p1.5.m5.1.1">𝐱</mtext></ci><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2"><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2a.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2"><mtext id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3"><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3"><minus id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.SSx1.p1.5.m5.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx1.p1.5.m5.2c">p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx1.p1.5.m5.2d">italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math>. This probability will be used
in beam search for text generation.
NMT models trained on particular domains perform deterioration when
translating out-domain sentences<cite class="ltx_cite ltx_citemacro_citep">(Koehn and Knowles <a class="ltx_ref" href="#bib.bib14" title="">2017</a>; Chu and Wang <a class="ltx_ref" href="#bib.bib4" title="">2018</a>)</cite>.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx2">
<h3 class="ltx_title ltx_title_subsection">Domain Adaptation for NMT</h3>
<div class="ltx_para" id="Sx2.SSx2.p1">
<p class="ltx_p" id="Sx2.SSx2.p1.1">The most concerned approach to adapt a general domain NMT model to a partial domain is to continue
training the neural model on the in-domain corpus. However, this finetuning method
demands large computational resources and suffers from the notorious catastrophic forgetting issue <cite class="ltx_cite ltx_citemacro_citep">(McCloskey and Cohen <a class="ltx_ref" href="#bib.bib20" title="">1989</a>; Santoro et al. <a class="ltx_ref" href="#bib.bib26" title="">2016</a>)</cite>.
Moreover, in real applications scenarios, the domains of translating
sentences are rarely known ahead of the time.
So multi-domain neural machine translation in one architecture is proposed <cite class="ltx_cite ltx_citemacro_citep">(Farajian et al. <a class="ltx_ref" href="#bib.bib7" title="">2017</a>; Pham, Crego, and Yvon <a class="ltx_ref" href="#bib.bib24" title="">2021</a>; Lin et al. <a class="ltx_ref" href="#bib.bib18" title="">2021</a>)</cite>.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx3">
<h3 class="ltx_title ltx_title_subsection">Retrieval-Argmented Text Generation</h3>
<div class="ltx_para" id="Sx2.SSx3.p1">
<p class="ltx_p" id="Sx2.SSx3.p1.2">Retrieval-augmented methods are concerned in text generation tasks recently.
RetNRef  <cite class="ltx_cite ltx_citemacro_citep">(Weston, Dinan, and Miller <a class="ltx_ref" href="#bib.bib30" title="">2018</a>)</cite>
concatenate the representations of a generative LSTM with attention model and the embeddings of retrieved over dialogue history, then use it to generate as usual.
Knowledge-intensive question answering is augmented by retrieving similar documents from Wikipedia
as contexts <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al. <a class="ltx_ref" href="#bib.bib15" title="">2020</a>)</cite>. BERT-<math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx3.p1.1.m1.1"><semantics id="Sx2.SSx3.p1.1.m1.1a"><mi id="Sx2.SSx3.p1.1.m1.1.1" xref="Sx2.SSx3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx3.p1.1.m1.1b"><ci id="Sx2.SSx3.p1.1.m1.1.1.cmml" xref="Sx2.SSx3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx3.p1.1.m1.1d">italic_k</annotation></semantics></math>NN  <cite class="ltx_cite ltx_citemacro_citep">(Kassner and Schütze <a class="ltx_ref" href="#bib.bib11" title="">2020</a>)</cite>
adds a kNN searching over a large datastore after original BERT model <cite class="ltx_cite ltx_citemacro_citep">(Devlin et al. <a class="ltx_ref" href="#bib.bib6" title="">2019</a>)</cite>
and excels the BERT model on question answering by large margin.
BERT-<math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx3.p1.2.m2.1"><semantics id="Sx2.SSx3.p1.2.m2.1a"><mi id="Sx2.SSx3.p1.2.m2.1.1" xref="Sx2.SSx3.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx3.p1.2.m2.1b"><ci id="Sx2.SSx3.p1.2.m2.1.1.cmml" xref="Sx2.SSx3.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx3.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx3.p1.2.m2.1d">italic_k</annotation></semantics></math>NN model gives more precise answers than the baseline model and can learn new knowledge from the datastore without training.
As for machine translation,
Gu et al.  <cite class="ltx_cite ltx_citemacro_citep">(Gu et al. <a class="ltx_ref" href="#bib.bib8" title="">2018</a>)</cite> propose to retrieve several
parallel sentence pairs based on edit distance with source sequence to perform the translation.</p>
</div>
<div class="ltx_para" id="Sx2.SSx3.p2">
<p class="ltx_p" id="Sx2.SSx3.p2.1">The common pattern is to retrieve similar texts or embeddings in a datastore and use retrieving results to enhance generation.
Training a tuned neural translation model requires enormous computing power and a parallel corpus.
Non-parametric or few-parametric retrieval-based approaches offer opportunities to learn new knowledge and adapt to new domains at a low cost.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx4">
<h3 class="ltx_title ltx_title_subsection">
<math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx4.1.m1.1"><semantics id="Sx2.SSx4.1.m1.1b"><mi id="Sx2.SSx4.1.m1.1.1" xref="Sx2.SSx4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.1.m1.1c"><ci id="Sx2.SSx4.1.m1.1.1.cmml" xref="Sx2.SSx4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.1.m1.1e">italic_k</annotation></semantics></math>NN-MT</h3>
<div class="ltx_para" id="Sx2.SSx4.p1">
<p class="ltx_p" id="Sx2.SSx4.p1.1">The basis of <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx4.p1.1.m1.1"><semantics id="Sx2.SSx4.p1.1.m1.1a"><mi id="Sx2.SSx4.p1.1.m1.1.1" xref="Sx2.SSx4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.p1.1.m1.1b"><ci id="Sx2.SSx4.p1.1.m1.1.1.cmml" xref="Sx2.SSx4.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT is datastore creation and retrieving for probability distributions.</p>
</div>
<section class="ltx_subsubsection" id="Sx2.SSx4.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Datastore</h4>
<div class="ltx_para" id="Sx2.SSx4.SSSx1.p1">
<p class="ltx_p" id="Sx2.SSx4.SSSx1.p1.7"><math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.1.m1.1"><semantics id="Sx2.SSx4.SSSx1.p1.1.m1.1a"><mi id="Sx2.SSx4.SSSx1.p1.1.m1.1.1" xref="Sx2.SSx4.SSSx1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.1.m1.1b"><ci id="Sx2.SSx4.SSSx1.p1.1.m1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT first creates a datastore on corpus <math alttext="\mathcal{C}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.2.m2.1"><semantics id="Sx2.SSx4.SSSx1.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="Sx2.SSx4.SSSx1.p1.2.m2.1.1" xref="Sx2.SSx4.SSSx1.p1.2.m2.1.1.cmml">𝒞</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.2.m2.1b"><ci id="Sx2.SSx4.SSSx1.p1.2.m2.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.2.m2.1.1">𝒞</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.2.m2.1c">\mathcal{C}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.2.m2.1d">caligraphic_C</annotation></semantics></math>, for each parallel sequence pair <math alttext="(\textbf{x},\textbf{y})" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.3.m3.2"><semantics id="Sx2.SSx4.SSSx1.p1.3.m3.2a"><mrow id="Sx2.SSx4.SSSx1.p1.3.m3.2.3.2" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.3.1.cmml"><mo id="Sx2.SSx4.SSSx1.p1.3.m3.2.3.2.1" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.3.1.cmml">(</mo><mtext id="Sx2.SSx4.SSSx1.p1.3.m3.1.1" xref="Sx2.SSx4.SSSx1.p1.3.m3.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx4.SSSx1.p1.3.m3.2.3.2.2" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.3.1.cmml">,</mo><mtext id="Sx2.SSx4.SSSx1.p1.3.m3.2.2" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.2a.cmml">𝐲</mtext><mo id="Sx2.SSx4.SSSx1.p1.3.m3.2.3.2.3" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.3.m3.2b"><interval closure="open" id="Sx2.SSx4.SSSx1.p1.3.m3.2.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.3.2"><ci id="Sx2.SSx4.SSSx1.p1.3.m3.1.1a.cmml" xref="Sx2.SSx4.SSSx1.p1.3.m3.1.1"><mtext id="Sx2.SSx4.SSSx1.p1.3.m3.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.3.m3.1.1">𝐱</mtext></ci><ci id="Sx2.SSx4.SSSx1.p1.3.m3.2.2a.cmml" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.2"><mtext id="Sx2.SSx4.SSSx1.p1.3.m3.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.3.m3.2.2">𝐲</mtext></ci></interval></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.3.m3.2c">(\textbf{x},\textbf{y})</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.3.m3.2d">( x , y )</annotation></semantics></math>,
it adds several key-value pair
<math alttext="\{(f(\textbf{x},\textbf{y}_{1:i-1}),y_{i})|i=1,\cdots,m\}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.4.m4.6"><semantics id="Sx2.SSx4.SSSx1.p1.4.m4.6a"><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.cmml"><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.3" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.1.cmml">{</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.3.cmml"><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.3" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.3.cmml">(</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.cmml"><mi id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.3.cmml">f</mi><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.2.cmml"><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.2" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.2.cmml">(</mo><mtext id="Sx2.SSx4.SSSx1.p1.4.m4.1.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.2.cmml">,</mo><msub id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.cmml"><mtext id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.cmml"><mn id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.cmml"><mi id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.4" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.4" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.3.cmml">,</mo><msub id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.cmml"><mi id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.2.cmml">y</mi><mi id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.3" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.3.cmml">i</mi></msub><mo id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.5" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.3.cmml">)</mo></mrow><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.4" lspace="0em" rspace="0em" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.1.cmml">|</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.cmml"><mi id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.2.cmml">i</mi><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.1.cmml">=</mo><mrow id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.1.cmml"><mn id="Sx2.SSx4.SSSx1.p1.4.m4.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.2.2.cmml">1</mn><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.2.1" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.1.cmml">,</mo><mi id="Sx2.SSx4.SSSx1.p1.4.m4.3.3" mathvariant="normal" xref="Sx2.SSx4.SSSx1.p1.4.m4.3.3.cmml">⋯</mi><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.2.2" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.1.cmml">,</mo><mi id="Sx2.SSx4.SSSx1.p1.4.m4.4.4" xref="Sx2.SSx4.SSSx1.p1.4.m4.4.4.cmml">m</mi></mrow></mrow><mo id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.5" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.1.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.4.m4.6b"><apply id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2"><csymbol cd="latexml" id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.3">conditional-set</csymbol><interval closure="open" id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2"><apply id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1"><times id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.2"></times><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.3">𝑓</ci><interval closure="open" id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1"><ci id="Sx2.SSx4.SSSx1.p1.4.m4.1.1a.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.1.1"><mtext id="Sx2.SSx4.SSSx1.p1.4.m4.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.1.1">𝐱</mtext></ci><apply id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1">subscript</csymbol><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2a.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2"><mtext id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.2">𝐲</mtext></ci><apply id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3"><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.1">:</ci><cn id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.2">1</cn><apply id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3"><minus id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply><apply id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2">subscript</csymbol><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.2">𝑦</ci><ci id="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.5.5.1.1.2.2.3">𝑖</ci></apply></interval><apply id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2"><eq id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.1"></eq><ci id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.2">𝑖</ci><list id="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.6.6.2.2.3.2"><cn id="Sx2.SSx4.SSSx1.p1.4.m4.2.2.cmml" type="integer" xref="Sx2.SSx4.SSSx1.p1.4.m4.2.2">1</cn><ci id="Sx2.SSx4.SSSx1.p1.4.m4.3.3.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.3.3">⋯</ci><ci id="Sx2.SSx4.SSSx1.p1.4.m4.4.4.cmml" xref="Sx2.SSx4.SSSx1.p1.4.m4.4.4">𝑚</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.4.m4.6c">\{(f(\textbf{x},\textbf{y}_{1:i-1}),y_{i})|i=1,\cdots,m\}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.4.m4.6d">{ ( italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) | italic_i = 1 , ⋯ , italic_m }</annotation></semantics></math> into the datastore <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.5.m5.1"><semantics id="Sx2.SSx4.SSSx1.p1.5.m5.1a"><mi class="ltx_font_mathcaligraphic" id="Sx2.SSx4.SSSx1.p1.5.m5.1.1" xref="Sx2.SSx4.SSSx1.p1.5.m5.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.5.m5.1b"><ci id="Sx2.SSx4.SSSx1.p1.5.m5.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.5.m5.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.5.m5.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.5.m5.1d">caligraphic_D</annotation></semantics></math>,
where <math alttext="f(\textbf{x},\textbf{y}_{1:i-1})" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.6.m6.2"><semantics id="Sx2.SSx4.SSSx1.p1.6.m6.2a"><mrow id="Sx2.SSx4.SSSx1.p1.6.m6.2.2" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.cmml"><mi id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.3" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.3.cmml">f</mi><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.2" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.2.cmml">⁢</mo><mrow id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.2.cmml"><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.2" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.2.cmml">(</mo><mtext id="Sx2.SSx4.SSSx1.p1.6.m6.1.1" xref="Sx2.SSx4.SSSx1.p1.6.m6.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.3" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.2.cmml">,</mo><msub id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.cmml"><mtext id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.cmml"><mn id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.2" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.2.cmml">1</mn><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.cmml"><mi id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.2" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.1" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.3" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.4" stretchy="false" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.6.m6.2b"><apply id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2"><times id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.2.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.2"></times><ci id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.3.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.3">𝑓</ci><interval closure="open" id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.2.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1"><ci id="Sx2.SSx4.SSSx1.p1.6.m6.1.1a.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.1.1"><mtext id="Sx2.SSx4.SSSx1.p1.6.m6.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.1.1">𝐱</mtext></ci><apply id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1">subscript</csymbol><ci id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2a.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2"><mtext id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.2">𝐲</mtext></ci><apply id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3"><ci id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.1">:</ci><cn id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.2.cmml" type="integer" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.2">1</cn><apply id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3"><minus id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.1.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.1"></minus><ci id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.2.cmml" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.SSx4.SSSx1.p1.6.m6.2.2.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.6.m6.2c">f(\textbf{x},\textbf{y}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.6.m6.2d">italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> is the intermediate representation given by the decoder of <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx1.p1.7.m7.1"><semantics id="Sx2.SSx4.SSSx1.p1.7.m7.1a"><mi class="ltx_font_mathcaligraphic" id="Sx2.SSx4.SSSx1.p1.7.m7.1.1" xref="Sx2.SSx4.SSSx1.p1.7.m7.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx1.p1.7.m7.1b"><ci id="Sx2.SSx4.SSSx1.p1.7.m7.1.1.cmml" xref="Sx2.SSx4.SSSx1.p1.7.m7.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx1.p1.7.m7.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx1.p1.7.m7.1d">caligraphic_M</annotation></semantics></math>.
Therefore, the datastore could be created on any parallel corpus without any training step.</p>
</div>
</section>
<section class="ltx_subsubsection" id="Sx2.SSx4.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">Estimation of Probability Distribution</h4>
<div class="ltx_para" id="Sx2.SSx4.SSSx2.p1">
<p class="ltx_p" id="Sx2.SSx4.SSSx2.p1.8">At decoding time given input <math alttext="(\textbf{x},\hat{\textbf{y}}_{i-1})" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.1.m1.2"><semantics id="Sx2.SSx4.SSSx2.p1.1.m1.2a"><mrow id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.2.cmml"><mo id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.2" stretchy="false" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.2.cmml">(</mo><mtext id="Sx2.SSx4.SSSx2.p1.1.m1.1.1" xref="Sx2.SSx4.SSSx2.p1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.3" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.2.cmml">,</mo><msub id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.cmml"><mover accent="true" id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.cmml"><mtext id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.1" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.cmml"><mi id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.2" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.2.cmml">i</mi><mo id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.1" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.1.cmml">−</mo><mn id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.3" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.3.cmml">1</mn></mrow></msub><mo id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.4" stretchy="false" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.2.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.1.m1.2b"><interval closure="open" id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1"><ci id="Sx2.SSx4.SSSx2.p1.1.m1.1.1a.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.1.1"><mtext id="Sx2.SSx4.SSSx2.p1.1.m1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1">subscript</csymbol><apply id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2"><ci id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.1.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.1">^</ci><ci id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2a.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2"><mtext id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3"><minus id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.1.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.1"></minus><ci id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.2.cmml" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.2">𝑖</ci><cn id="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.3.cmml" type="integer" xref="Sx2.SSx4.SSSx2.p1.1.m1.2.2.1.1.3.3">1</cn></apply></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.1.m1.2c">(\textbf{x},\hat{\textbf{y}}_{i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.1.m1.2d">( x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math>,
it makes a query <math alttext="q=f(\textbf{x},\hat{\textbf{y}}_{i-1})" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.2.m2.2"><semantics id="Sx2.SSx4.SSSx2.p1.2.m2.2a"><mrow id="Sx2.SSx4.SSSx2.p1.2.m2.2.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.cmml"><mi id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.3" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.3.cmml">q</mi><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.2.cmml">=</mo><mrow id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.cmml"><mi id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.3" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.3.cmml">f</mi><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.2.cmml">⁢</mo><mrow id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.2.cmml"><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.2" stretchy="false" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.2.cmml">(</mo><mtext id="Sx2.SSx4.SSSx2.p1.2.m2.1.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.1.1a.cmml">𝐱</mtext><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.3" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.2.cmml">,</mo><msub id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.cmml"><mover accent="true" id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.cmml"><mtext id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.cmml"><mi id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.2" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.2.cmml">i</mi><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.1" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.1.cmml">−</mo><mn id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.3" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.3.cmml">1</mn></mrow></msub><mo id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.4" stretchy="false" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.2.m2.2b"><apply id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2"><eq id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.2"></eq><ci id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.3.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.3">𝑞</ci><apply id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1"><times id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.2"></times><ci id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.3.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.3">𝑓</ci><interval closure="open" id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1"><ci id="Sx2.SSx4.SSSx2.p1.2.m2.1.1a.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.1.1"><mtext id="Sx2.SSx4.SSSx2.p1.2.m2.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.1.1">𝐱</mtext></ci><apply id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1">subscript</csymbol><apply id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2"><ci id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.1">^</ci><ci id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2a.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2"><mtext id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3"><minus id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.1.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.1"></minus><ci id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.2.cmml" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.2">𝑖</ci><cn id="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.3.cmml" type="integer" xref="Sx2.SSx4.SSSx2.p1.2.m2.2.2.1.1.1.1.3.3">1</cn></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.2.m2.2c">q=f(\textbf{x},\hat{\textbf{y}}_{i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.2.m2.2d">italic_q = italic_f ( x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> and retrieves <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.3.m3.1"><semantics id="Sx2.SSx4.SSSx2.p1.3.m3.1a"><mi id="Sx2.SSx4.SSSx2.p1.3.m3.1.1" xref="Sx2.SSx4.SSSx2.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.3.m3.1b"><ci id="Sx2.SSx4.SSSx2.p1.3.m3.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.3.m3.1d">italic_k</annotation></semantics></math> nearest
neighbor <math alttext="k_{1},\cdot,k_{K}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.4.m4.3"><semantics id="Sx2.SSx4.SSSx2.p1.4.m4.3a"><mrow id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.3.cmml"><msub id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.cmml"><mi id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.2" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.2.cmml">k</mi><mn id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.3" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.3.cmml">1</mn></msub><mo id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.3" rspace="0em" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.3.cmml">,</mo><mo id="Sx2.SSx4.SSSx2.p1.4.m4.1.1" lspace="0em" rspace="0em" xref="Sx2.SSx4.SSSx2.p1.4.m4.1.1.cmml">⋅</mo><mo id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.4" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.3.cmml">,</mo><msub id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.cmml"><mi id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.2" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.2.cmml">k</mi><mi id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.3" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.3.cmml">K</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.4.m4.3b"><list id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.3.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2"><apply id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1">subscript</csymbol><ci id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.2">𝑘</ci><cn id="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.3.cmml" type="integer" xref="Sx2.SSx4.SSSx2.p1.4.m4.2.2.1.1.3">1</cn></apply><ci id="Sx2.SSx4.SSSx2.p1.4.m4.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.1.1">⋅</ci><apply id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.1.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2">subscript</csymbol><ci id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.2.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.2">𝑘</ci><ci id="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.3.cmml" xref="Sx2.SSx4.SSSx2.p1.4.m4.3.3.2.2.3">𝐾</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.4.m4.3c">k_{1},\cdot,k_{K}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.4.m4.3d">italic_k start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , ⋅ , italic_k start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT</annotation></semantics></math> with their corresponding target tokens. Thus, <math alttext="p_{kNN}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.5.m5.1"><semantics id="Sx2.SSx4.SSSx2.p1.5.m5.1a"><msub id="Sx2.SSx4.SSSx2.p1.5.m5.1.1" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.cmml"><mi id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.2" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.2.cmml">p</mi><mrow id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.cmml"><mi id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.2" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.2.cmml">k</mi><mo id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.3" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.3.cmml">N</mi><mo id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1a" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1.cmml">⁢</mo><mi id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.4" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.4.cmml">N</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.5.m5.1b"><apply id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1">subscript</csymbol><ci id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.2">𝑝</ci><apply id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3"><times id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.1"></times><ci id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.2.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.2">𝑘</ci><ci id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.3.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.3">𝑁</ci><ci id="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.4.cmml" xref="Sx2.SSx4.SSSx2.p1.5.m5.1.1.3.4">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.5.m5.1c">p_{kNN}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.5.m5.1d">italic_p start_POSTSUBSCRIPT italic_k italic_N italic_N end_POSTSUBSCRIPT</annotation></semantics></math> is estimated by <math alttext="L_{2}" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.6.m6.1"><semantics id="Sx2.SSx4.SSSx2.p1.6.m6.1a"><msub id="Sx2.SSx4.SSSx2.p1.6.m6.1.1" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1.cmml"><mi id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.2" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1.2.cmml">L</mi><mn id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.3" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.6.m6.1b"><apply id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1">subscript</csymbol><ci id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.2.cmml" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1.2">𝐿</ci><cn id="Sx2.SSx4.SSSx2.p1.6.m6.1.1.3.cmml" type="integer" xref="Sx2.SSx4.SSSx2.p1.6.m6.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.6.m6.1c">L_{2}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.6.m6.1d">italic_L start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> distances <math alttext="d" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.7.m7.1"><semantics id="Sx2.SSx4.SSSx2.p1.7.m7.1a"><mi id="Sx2.SSx4.SSSx2.p1.7.m7.1.1" xref="Sx2.SSx4.SSSx2.p1.7.m7.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.7.m7.1b"><ci id="Sx2.SSx4.SSSx2.p1.7.m7.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.7.m7.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.7.m7.1c">d</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.7.m7.1d">italic_d</annotation></semantics></math> and a temperature <math alttext="T" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p1.8.m8.1"><semantics id="Sx2.SSx4.SSSx2.p1.8.m8.1a"><mi id="Sx2.SSx4.SSSx2.p1.8.m8.1.1" xref="Sx2.SSx4.SSSx2.p1.8.m8.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p1.8.m8.1b"><ci id="Sx2.SSx4.SSSx2.p1.8.m8.1.1.cmml" xref="Sx2.SSx4.SSSx2.p1.8.m8.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p1.8.m8.1c">T</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p1.8.m8.1d">italic_T</annotation></semantics></math>,
normalizing retrieved set into a probability distribution over vocabulary by softmax:</p>
</div>
<div class="ltx_para" id="Sx2.SSx4.SSSx2.p2">
<table class="ltx_equation ltx_eqn_table" id="Sx2.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{KNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i-1})=\mathrm{sofmtax}(\frac{%
-d(q,k_{j})}{T}),j=1,\cdots,K" class="ltx_Math" display="block" id="Sx2.E1.m1.8"><semantics id="Sx2.E1.m1.8a"><mrow id="Sx2.E1.m1.8.8.2" xref="Sx2.E1.m1.8.8.3.cmml"><mrow id="Sx2.E1.m1.7.7.1.1" xref="Sx2.E1.m1.7.7.1.1.cmml"><mrow id="Sx2.E1.m1.7.7.1.1.1" xref="Sx2.E1.m1.7.7.1.1.1.cmml"><msub id="Sx2.E1.m1.7.7.1.1.1.3" xref="Sx2.E1.m1.7.7.1.1.1.3.cmml"><mi id="Sx2.E1.m1.7.7.1.1.1.3.2" xref="Sx2.E1.m1.7.7.1.1.1.3.2.cmml">p</mi><mrow id="Sx2.E1.m1.7.7.1.1.1.3.3" xref="Sx2.E1.m1.7.7.1.1.1.3.3.cmml"><mi id="Sx2.E1.m1.7.7.1.1.1.3.3.2" xref="Sx2.E1.m1.7.7.1.1.1.3.3.2.cmml">K</mi><mo id="Sx2.E1.m1.7.7.1.1.1.3.3.1" xref="Sx2.E1.m1.7.7.1.1.1.3.3.1.cmml">⁢</mo><mi id="Sx2.E1.m1.7.7.1.1.1.3.3.3" xref="Sx2.E1.m1.7.7.1.1.1.3.3.3.cmml">N</mi><mo id="Sx2.E1.m1.7.7.1.1.1.3.3.1a" xref="Sx2.E1.m1.7.7.1.1.1.3.3.1.cmml">⁢</mo><mi id="Sx2.E1.m1.7.7.1.1.1.3.3.4" xref="Sx2.E1.m1.7.7.1.1.1.3.3.4.cmml">N</mi></mrow></msub><mo id="Sx2.E1.m1.7.7.1.1.1.2" xref="Sx2.E1.m1.7.7.1.1.1.2.cmml">⁢</mo><mrow id="Sx2.E1.m1.7.7.1.1.1.1.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.cmml"><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.2" stretchy="false" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.cmml">(</mo><mrow id="Sx2.E1.m1.7.7.1.1.1.1.1.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.cmml"><msub id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.cmml"><mi id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.2.cmml">y</mi><mi id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.3" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.2.cmml">|</mo><mrow id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.2.cmml"><mtext id="Sx2.E1.m1.3.3" xref="Sx2.E1.m1.3.3a.cmml">𝐱</mtext><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.cmml"><mtext id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.2" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.1" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.1.cmml">−</mo><mn id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.3" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow></msub></mrow></mrow><mo id="Sx2.E1.m1.7.7.1.1.1.1.1.3" stretchy="false" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="Sx2.E1.m1.7.7.1.1.2" xref="Sx2.E1.m1.7.7.1.1.2.cmml">=</mo><mrow id="Sx2.E1.m1.7.7.1.1.3" xref="Sx2.E1.m1.7.7.1.1.3.cmml"><mi id="Sx2.E1.m1.7.7.1.1.3.2" xref="Sx2.E1.m1.7.7.1.1.3.2.cmml">sofmtax</mi><mo id="Sx2.E1.m1.7.7.1.1.3.1" xref="Sx2.E1.m1.7.7.1.1.3.1.cmml">⁢</mo><mrow id="Sx2.E1.m1.7.7.1.1.3.3.2" xref="Sx2.E1.m1.2.2.cmml"><mo id="Sx2.E1.m1.7.7.1.1.3.3.2.1" stretchy="false" xref="Sx2.E1.m1.2.2.cmml">(</mo><mfrac id="Sx2.E1.m1.2.2" xref="Sx2.E1.m1.2.2.cmml"><mrow id="Sx2.E1.m1.2.2.2" xref="Sx2.E1.m1.2.2.2.cmml"><mo id="Sx2.E1.m1.2.2.2a" xref="Sx2.E1.m1.2.2.2.cmml">−</mo><mrow id="Sx2.E1.m1.2.2.2.2" xref="Sx2.E1.m1.2.2.2.2.cmml"><mi id="Sx2.E1.m1.2.2.2.2.3" xref="Sx2.E1.m1.2.2.2.2.3.cmml">d</mi><mo id="Sx2.E1.m1.2.2.2.2.2" xref="Sx2.E1.m1.2.2.2.2.2.cmml">⁢</mo><mrow id="Sx2.E1.m1.2.2.2.2.1.1" xref="Sx2.E1.m1.2.2.2.2.1.2.cmml"><mo id="Sx2.E1.m1.2.2.2.2.1.1.2" stretchy="false" xref="Sx2.E1.m1.2.2.2.2.1.2.cmml">(</mo><mi id="Sx2.E1.m1.1.1.1.1" xref="Sx2.E1.m1.1.1.1.1.cmml">q</mi><mo id="Sx2.E1.m1.2.2.2.2.1.1.3" xref="Sx2.E1.m1.2.2.2.2.1.2.cmml">,</mo><msub id="Sx2.E1.m1.2.2.2.2.1.1.1" xref="Sx2.E1.m1.2.2.2.2.1.1.1.cmml"><mi id="Sx2.E1.m1.2.2.2.2.1.1.1.2" xref="Sx2.E1.m1.2.2.2.2.1.1.1.2.cmml">k</mi><mi id="Sx2.E1.m1.2.2.2.2.1.1.1.3" xref="Sx2.E1.m1.2.2.2.2.1.1.1.3.cmml">j</mi></msub><mo id="Sx2.E1.m1.2.2.2.2.1.1.4" stretchy="false" xref="Sx2.E1.m1.2.2.2.2.1.2.cmml">)</mo></mrow></mrow></mrow><mi id="Sx2.E1.m1.2.2.4" xref="Sx2.E1.m1.2.2.4.cmml">T</mi></mfrac><mo id="Sx2.E1.m1.7.7.1.1.3.3.2.2" stretchy="false" xref="Sx2.E1.m1.2.2.cmml">)</mo></mrow></mrow></mrow><mo id="Sx2.E1.m1.8.8.2.3" xref="Sx2.E1.m1.8.8.3a.cmml">,</mo><mrow id="Sx2.E1.m1.8.8.2.2" xref="Sx2.E1.m1.8.8.2.2.cmml"><mi id="Sx2.E1.m1.8.8.2.2.2" xref="Sx2.E1.m1.8.8.2.2.2.cmml">j</mi><mo id="Sx2.E1.m1.8.8.2.2.1" xref="Sx2.E1.m1.8.8.2.2.1.cmml">=</mo><mrow id="Sx2.E1.m1.8.8.2.2.3.2" xref="Sx2.E1.m1.8.8.2.2.3.1.cmml"><mn id="Sx2.E1.m1.4.4" xref="Sx2.E1.m1.4.4.cmml">1</mn><mo id="Sx2.E1.m1.8.8.2.2.3.2.1" xref="Sx2.E1.m1.8.8.2.2.3.1.cmml">,</mo><mi id="Sx2.E1.m1.5.5" mathvariant="normal" xref="Sx2.E1.m1.5.5.cmml">⋯</mi><mo id="Sx2.E1.m1.8.8.2.2.3.2.2" xref="Sx2.E1.m1.8.8.2.2.3.1.cmml">,</mo><mi id="Sx2.E1.m1.6.6" xref="Sx2.E1.m1.6.6.cmml">K</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.E1.m1.8b"><apply id="Sx2.E1.m1.8.8.3.cmml" xref="Sx2.E1.m1.8.8.2"><csymbol cd="ambiguous" id="Sx2.E1.m1.8.8.3a.cmml" xref="Sx2.E1.m1.8.8.2.3">formulae-sequence</csymbol><apply id="Sx2.E1.m1.7.7.1.1.cmml" xref="Sx2.E1.m1.7.7.1.1"><eq id="Sx2.E1.m1.7.7.1.1.2.cmml" xref="Sx2.E1.m1.7.7.1.1.2"></eq><apply id="Sx2.E1.m1.7.7.1.1.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1"><times id="Sx2.E1.m1.7.7.1.1.1.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.2"></times><apply id="Sx2.E1.m1.7.7.1.1.1.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3"><csymbol cd="ambiguous" id="Sx2.E1.m1.7.7.1.1.1.3.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3">subscript</csymbol><ci id="Sx2.E1.m1.7.7.1.1.1.3.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.2">𝑝</ci><apply id="Sx2.E1.m1.7.7.1.1.1.3.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.3"><times id="Sx2.E1.m1.7.7.1.1.1.3.3.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.3.1"></times><ci id="Sx2.E1.m1.7.7.1.1.1.3.3.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.3.2">𝐾</ci><ci id="Sx2.E1.m1.7.7.1.1.1.3.3.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.3.3">𝑁</ci><ci id="Sx2.E1.m1.7.7.1.1.1.3.3.4.cmml" xref="Sx2.E1.m1.7.7.1.1.1.3.3.4">𝑁</ci></apply></apply><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1"><csymbol cd="latexml" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.2">conditional</csymbol><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3"><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.1">^</ci><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2">subscript</csymbol><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.2">𝑦</ci><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1"><ci id="Sx2.E1.m1.3.3a.cmml" xref="Sx2.E1.m1.3.3"><mtext id="Sx2.E1.m1.3.3.cmml" xref="Sx2.E1.m1.3.3">𝐱</mtext></ci><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2"><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2a.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2"><mtext id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3"><minus id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.1"></minus><ci id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.2">𝑖</ci><cn id="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="Sx2.E1.m1.7.7.1.1.1.1.1.1.1.1.1.3.3">1</cn></apply></apply></list></apply></apply><apply id="Sx2.E1.m1.7.7.1.1.3.cmml" xref="Sx2.E1.m1.7.7.1.1.3"><times id="Sx2.E1.m1.7.7.1.1.3.1.cmml" xref="Sx2.E1.m1.7.7.1.1.3.1"></times><ci id="Sx2.E1.m1.7.7.1.1.3.2.cmml" xref="Sx2.E1.m1.7.7.1.1.3.2">sofmtax</ci><apply id="Sx2.E1.m1.2.2.cmml" xref="Sx2.E1.m1.7.7.1.1.3.3.2"><divide id="Sx2.E1.m1.2.2.3.cmml" xref="Sx2.E1.m1.7.7.1.1.3.3.2"></divide><apply id="Sx2.E1.m1.2.2.2.cmml" xref="Sx2.E1.m1.2.2.2"><minus id="Sx2.E1.m1.2.2.2.3.cmml" xref="Sx2.E1.m1.2.2.2"></minus><apply id="Sx2.E1.m1.2.2.2.2.cmml" xref="Sx2.E1.m1.2.2.2.2"><times id="Sx2.E1.m1.2.2.2.2.2.cmml" xref="Sx2.E1.m1.2.2.2.2.2"></times><ci id="Sx2.E1.m1.2.2.2.2.3.cmml" xref="Sx2.E1.m1.2.2.2.2.3">𝑑</ci><interval closure="open" id="Sx2.E1.m1.2.2.2.2.1.2.cmml" xref="Sx2.E1.m1.2.2.2.2.1.1"><ci id="Sx2.E1.m1.1.1.1.1.cmml" xref="Sx2.E1.m1.1.1.1.1">𝑞</ci><apply id="Sx2.E1.m1.2.2.2.2.1.1.1.cmml" xref="Sx2.E1.m1.2.2.2.2.1.1.1"><csymbol cd="ambiguous" id="Sx2.E1.m1.2.2.2.2.1.1.1.1.cmml" xref="Sx2.E1.m1.2.2.2.2.1.1.1">subscript</csymbol><ci id="Sx2.E1.m1.2.2.2.2.1.1.1.2.cmml" xref="Sx2.E1.m1.2.2.2.2.1.1.1.2">𝑘</ci><ci id="Sx2.E1.m1.2.2.2.2.1.1.1.3.cmml" xref="Sx2.E1.m1.2.2.2.2.1.1.1.3">𝑗</ci></apply></interval></apply></apply><ci id="Sx2.E1.m1.2.2.4.cmml" xref="Sx2.E1.m1.2.2.4">𝑇</ci></apply></apply></apply><apply id="Sx2.E1.m1.8.8.2.2.cmml" xref="Sx2.E1.m1.8.8.2.2"><eq id="Sx2.E1.m1.8.8.2.2.1.cmml" xref="Sx2.E1.m1.8.8.2.2.1"></eq><ci id="Sx2.E1.m1.8.8.2.2.2.cmml" xref="Sx2.E1.m1.8.8.2.2.2">𝑗</ci><list id="Sx2.E1.m1.8.8.2.2.3.1.cmml" xref="Sx2.E1.m1.8.8.2.2.3.2"><cn id="Sx2.E1.m1.4.4.cmml" type="integer" xref="Sx2.E1.m1.4.4">1</cn><ci id="Sx2.E1.m1.5.5.cmml" xref="Sx2.E1.m1.5.5">⋯</ci><ci id="Sx2.E1.m1.6.6.cmml" xref="Sx2.E1.m1.6.6">𝐾</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.E1.m1.8c">p_{KNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i-1})=\mathrm{sofmtax}(\frac{%
-d(q,k_{j})}{T}),j=1,\cdots,K</annotation><annotation encoding="application/x-llamapun" id="Sx2.E1.m1.8d">italic_p start_POSTSUBSCRIPT italic_K italic_N italic_N end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT ) = roman_sofmtax ( divide start_ARG - italic_d ( italic_q , italic_k start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) end_ARG start_ARG italic_T end_ARG ) , italic_j = 1 , ⋯ , italic_K</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx2.SSx4.SSSx2.p3">
<p class="ltx_p" id="Sx2.SSx4.SSSx2.p3.1">Temperature <math alttext="T" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p3.1.m1.1"><semantics id="Sx2.SSx4.SSSx2.p3.1.m1.1a"><mi id="Sx2.SSx4.SSSx2.p3.1.m1.1.1" xref="Sx2.SSx4.SSSx2.p3.1.m1.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p3.1.m1.1b"><ci id="Sx2.SSx4.SSSx2.p3.1.m1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p3.1.m1.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p3.1.m1.1c">T</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p3.1.m1.1d">italic_T</annotation></semantics></math> greater than one flattens the distribution and prevents overfitting to the only nearest retrieval <cite class="ltx_cite ltx_citemacro_citep">(Khandelwal et al. <a class="ltx_ref" href="#bib.bib12" title="">2021</a>)</cite>.</p>
</div>
<div class="ltx_para" id="Sx2.SSx4.SSSx2.p4">
<p class="ltx_p" id="Sx2.SSx4.SSSx2.p4.2">The probability distribution given by the NMT model and <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p4.1.m1.1"><semantics id="Sx2.SSx4.SSSx2.p4.1.m1.1a"><mi id="Sx2.SSx4.SSSx2.p4.1.m1.1.1" xref="Sx2.SSx4.SSSx2.p4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p4.1.m1.1b"><ci id="Sx2.SSx4.SSSx2.p4.1.m1.1.1.cmml" xref="Sx2.SSx4.SSSx2.p4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p4.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p4.1.m1.1d">italic_k</annotation></semantics></math>NN is finally interpolated with a hyper-parameter <math alttext="\lambda" class="ltx_Math" display="inline" id="Sx2.SSx4.SSSx2.p4.2.m2.1"><semantics id="Sx2.SSx4.SSSx2.p4.2.m2.1a"><mi id="Sx2.SSx4.SSSx2.p4.2.m2.1.1" xref="Sx2.SSx4.SSSx2.p4.2.m2.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx4.SSSx2.p4.2.m2.1b"><ci id="Sx2.SSx4.SSSx2.p4.2.m2.1.1.cmml" xref="Sx2.SSx4.SSSx2.p4.2.m2.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx4.SSSx2.p4.2.m2.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx4.SSSx2.p4.2.m2.1d">italic_λ</annotation></semantics></math>:</p>
</div>
<div class="ltx_para" id="Sx2.SSx4.SSSx2.p5">
<table class="ltx_equationgroup ltx_eqn_table" id="Sx2.E2">
<tbody>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx2.E2X">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p_{\text{{combined}}}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i%
-1})" class="ltx_Math" display="inline" id="Sx2.E2X.2.1.1.m1.2"><semantics id="Sx2.E2X.2.1.1.m1.2a"><mrow id="Sx2.E2X.2.1.1.m1.2.2" xref="Sx2.E2X.2.1.1.m1.2.2.cmml"><msub id="Sx2.E2X.2.1.1.m1.2.2.3" xref="Sx2.E2X.2.1.1.m1.2.2.3.cmml"><mi id="Sx2.E2X.2.1.1.m1.2.2.3.2" xref="Sx2.E2X.2.1.1.m1.2.2.3.2.cmml">p</mi><mtext id="Sx2.E2X.2.1.1.m1.2.2.3.3" xref="Sx2.E2X.2.1.1.m1.2.2.3.3a.cmml">𝑐𝑜𝑚𝑏𝑖𝑛𝑒𝑑</mtext></msub><mo id="Sx2.E2X.2.1.1.m1.2.2.2" xref="Sx2.E2X.2.1.1.m1.2.2.2.cmml">⁢</mo><mrow id="Sx2.E2X.2.1.1.m1.2.2.1.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.cmml"><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.2" stretchy="false" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.cmml">(</mo><mrow id="Sx2.E2X.2.1.1.m1.2.2.1.1.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.cmml"><mover accent="true" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.cmml"><msub id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.cmml"><mi id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.3" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.2.cmml"><mtext id="Sx2.E2X.2.1.1.m1.1.1" xref="Sx2.E2X.2.1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.cmml"><mi id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.2" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.1" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.1.cmml">−</mo><mn id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.3" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.3.cmml">1</mn></mrow></msub></mrow></mrow><mo id="Sx2.E2X.2.1.1.m1.2.2.1.1.3" stretchy="false" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.E2X.2.1.1.m1.2b"><apply id="Sx2.E2X.2.1.1.m1.2.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2"><times id="Sx2.E2X.2.1.1.m1.2.2.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.2"></times><apply id="Sx2.E2X.2.1.1.m1.2.2.3.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.3"><csymbol cd="ambiguous" id="Sx2.E2X.2.1.1.m1.2.2.3.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.3">subscript</csymbol><ci id="Sx2.E2X.2.1.1.m1.2.2.3.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.3.2">𝑝</ci><ci id="Sx2.E2X.2.1.1.m1.2.2.3.3a.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.3.3"><mtext id="Sx2.E2X.2.1.1.m1.2.2.3.3.cmml" mathsize="70%" xref="Sx2.E2X.2.1.1.m1.2.2.3.3">𝑐𝑜𝑚𝑏𝑖𝑛𝑒𝑑</mtext></ci></apply><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1"><csymbol cd="latexml" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.2">conditional</csymbol><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3"><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.1">^</ci><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.3.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1"><ci id="Sx2.E2X.2.1.1.m1.1.1a.cmml" xref="Sx2.E2X.2.1.1.m1.1.1"><mtext id="Sx2.E2X.2.1.1.m1.1.1.cmml" xref="Sx2.E2X.2.1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2"><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3"><minus id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.1"></minus><ci id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.2.cmml" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.2">𝑖</ci><cn id="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.3.cmml" type="integer" xref="Sx2.E2X.2.1.1.m1.2.2.1.1.1.1.1.1.3.3">1</cn></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.E2X.2.1.1.m1.2c">\displaystyle p_{\text{{combined}}}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i%
-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.E2X.2.1.1.m1.2d">italic_p start_POSTSUBSCRIPT combined end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\lambda p_{KNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i-1})" class="ltx_Math" display="inline" id="Sx2.E2X.3.2.2.m1.2"><semantics id="Sx2.E2X.3.2.2.m1.2a"><mrow id="Sx2.E2X.3.2.2.m1.2.2" xref="Sx2.E2X.3.2.2.m1.2.2.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.3" xref="Sx2.E2X.3.2.2.m1.2.2.3.cmml"></mi><mo id="Sx2.E2X.3.2.2.m1.2.2.2" xref="Sx2.E2X.3.2.2.m1.2.2.2.cmml">=</mo><mrow id="Sx2.E2X.3.2.2.m1.2.2.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.1.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.3.cmml">λ</mi><mo id="Sx2.E2X.3.2.2.m1.2.2.1.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.2.cmml">⁢</mo><msub id="Sx2.E2X.3.2.2.m1.2.2.1.4" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.1.4.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.2.cmml">p</mi><mrow id="Sx2.E2X.3.2.2.m1.2.2.1.4.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.2.cmml">K</mi><mo id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1.cmml">⁢</mo><mi id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.3.cmml">N</mi><mo id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1a" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1.cmml">⁢</mo><mi id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.4" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.4.cmml">N</mi></mrow></msub><mo id="Sx2.E2X.3.2.2.m1.2.2.1.2a" xref="Sx2.E2X.3.2.2.m1.2.2.1.2.cmml">⁢</mo><mrow id="Sx2.E2X.3.2.2.m1.2.2.1.1.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.cmml"><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.2" stretchy="false" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.cmml"><mover accent="true" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.cmml"><msub id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.2.cmml">y</mi><mi id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.2.cmml">|</mo><mrow id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.2.cmml"><mtext id="Sx2.E2X.3.2.2.m1.1.1" xref="Sx2.E2X.3.2.2.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.2.cmml">,</mo><msub id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.cmml"><mtext id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.2" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.1" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.1.cmml">−</mo><mn id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.3" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow></msub></mrow></mrow><mo id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.3" stretchy="false" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.E2X.3.2.2.m1.2b"><apply id="Sx2.E2X.3.2.2.m1.2.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2"><eq id="Sx2.E2X.3.2.2.m1.2.2.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.2"></eq><csymbol cd="latexml" id="Sx2.E2X.3.2.2.m1.2.2.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.3">absent</csymbol><apply id="Sx2.E2X.3.2.2.m1.2.2.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1"><times id="Sx2.E2X.3.2.2.m1.2.2.1.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.2"></times><ci id="Sx2.E2X.3.2.2.m1.2.2.1.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.3">𝜆</ci><apply id="Sx2.E2X.3.2.2.m1.2.2.1.4.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4"><csymbol cd="ambiguous" id="Sx2.E2X.3.2.2.m1.2.2.1.4.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4">subscript</csymbol><ci id="Sx2.E2X.3.2.2.m1.2.2.1.4.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.2">𝑝</ci><apply id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3"><times id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.1"></times><ci id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.2">𝐾</ci><ci id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.3">𝑁</ci><ci id="Sx2.E2X.3.2.2.m1.2.2.1.4.3.4.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.4.3.4">𝑁</ci></apply></apply><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1"><csymbol cd="latexml" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.2">conditional</csymbol><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3"><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.1">^</ci><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2">subscript</csymbol><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.2">𝑦</ci><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1"><ci id="Sx2.E2X.3.2.2.m1.1.1a.cmml" xref="Sx2.E2X.3.2.2.m1.1.1"><mtext id="Sx2.E2X.3.2.2.m1.1.1.cmml" xref="Sx2.E2X.3.2.2.m1.1.1">𝐱</mtext></ci><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1">subscript</csymbol><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2"><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.1">^</ci><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2a.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2"><mtext id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3"><minus id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.1"></minus><ci id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.2">𝑖</ci><cn id="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="Sx2.E2X.3.2.2.m1.2.2.1.1.1.1.1.1.1.3.3">1</cn></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.E2X.3.2.2.m1.2c">\displaystyle=\lambda p_{KNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.E2X.3.2.2.m1.2d">= italic_λ italic_p start_POSTSUBSCRIPT italic_K italic_N italic_N end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="2"><span class="ltx_tag ltx_tag_equationgroup ltx_align_right">(2)</span></td>
</tr>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx2.E2Xa">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle+(1-\lambda)p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="Sx2.E2Xa.2.1.1.m1.3"><semantics id="Sx2.E2Xa.2.1.1.m1.3a"><mrow id="Sx2.E2Xa.2.1.1.m1.3.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.cmml"><mo id="Sx2.E2Xa.2.1.1.m1.3.3a" xref="Sx2.E2Xa.2.1.1.m1.3.3.cmml">+</mo><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.cmml"><mrow id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.cmml"><mo id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.2" stretchy="false" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.cmml"><mn id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.2" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.2.cmml">1</mn><mo id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.1" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.1.cmml">−</mo><mi id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.3" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.3.cmml">λ</mi></mrow><mo id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.3" stretchy="false" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.cmml">)</mo></mrow><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.3.cmml">⁢</mo><msub id="Sx2.E2Xa.2.1.1.m1.3.3.2.4" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.cmml"><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.2.cmml">p</mi><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.cmml"><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.2.cmml">M</mi><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.1.cmml">⁢</mo><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.3.cmml">T</mi></mrow></msub><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.3a" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.3.cmml">⁢</mo><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.cmml"><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.2" stretchy="false" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.cmml">(</mo><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.cmml"><mover accent="true" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.cmml"><msub id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.cmml"><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.2.cmml">y</mi><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.2.cmml">|</mo><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.2.cmml"><mtext id="Sx2.E2Xa.2.1.1.m1.1.1" xref="Sx2.E2Xa.2.1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.2.cmml">,</mo><msub id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.cmml"><mtext id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.cmml"><mn id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.cmml"><mi id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.2" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.1" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.3" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.3" stretchy="false" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.E2Xa.2.1.1.m1.3b"><apply id="Sx2.E2Xa.2.1.1.m1.3.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3"><plus id="Sx2.E2Xa.2.1.1.m1.3.3.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3"></plus><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2"><times id="Sx2.E2Xa.2.1.1.m1.3.3.2.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.3"></times><apply id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1"><minus id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.1"></minus><cn id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.2.cmml" type="integer" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.2">1</cn><ci id="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.2.2.1.1.1.1.3">𝜆</ci></apply><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4"><csymbol cd="ambiguous" id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4">subscript</csymbol><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.2">𝑝</ci><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3"><times id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.1"></times><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.2">𝑀</ci><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.4.3.3">𝑇</ci></apply></apply><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1"><csymbol cd="latexml" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.2">conditional</csymbol><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3"><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.1">^</ci><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2">subscript</csymbol><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.2">𝑦</ci><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1"><ci id="Sx2.E2Xa.2.1.1.m1.1.1a.cmml" xref="Sx2.E2Xa.2.1.1.m1.1.1"><mtext id="Sx2.E2Xa.2.1.1.m1.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1">subscript</csymbol><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2"><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.1">^</ci><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2a.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2"><mtext id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3"><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.1">:</ci><cn id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.2">1</cn><apply id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3"><minus id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.1.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.2.cmml" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.E2Xa.2.1.1.m1.3.3.2.2.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.E2Xa.2.1.1.m1.3c">\displaystyle+(1-\lambda)p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.E2Xa.2.1.1.m1.3d">+ ( 1 - italic_λ ) italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section class="ltx_subsection" id="Sx2.SSx5">
<h3 class="ltx_title ltx_title_subsection">Adaptive-kNN-MT</h3>
<div class="ltx_para" id="Sx2.SSx5.p1">
<p class="ltx_p" id="Sx2.SSx5.p1.1">Adaptive variant <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al. <a class="ltx_ref" href="#bib.bib31" title="">2021</a>)</cite> adds a light-weight feed-forward network named <span class="ltx_text ltx_font_italic" id="Sx2.SSx5.p1.1.1">Meta-k</span> network
to dynamically assign weights for probability distributions given by the neural model and <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx5.p1.1.m1.1"><semantics id="Sx2.SSx5.p1.1.m1.1a"><mi id="Sx2.SSx5.p1.1.m1.1.1" xref="Sx2.SSx5.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p1.1.m1.1b"><ci id="Sx2.SSx5.p1.1.m1.1.1.cmml" xref="Sx2.SSx5.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p1.1.m1.1d">italic_k</annotation></semantics></math> nearest reference sample, the final prediction is obtained by</p>
</div>
<div class="ltx_para" id="Sx2.SSx5.p2">
<table class="ltx_equationgroup ltx_eqn_table" id="Sx2.Ex1">
<tbody id="Sx2.Ex1X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p_{\text{{combined}}}(\hat{y_{i}}|\textbf{x}," class="ltx_math_unparsed" display="inline" id="Sx2.Ex1X.2.1.1.m1.1"><semantics id="Sx2.Ex1X.2.1.1.m1.1a"><mrow id="Sx2.Ex1X.2.1.1.m1.1b"><msub id="Sx2.Ex1X.2.1.1.m1.1.1"><mi id="Sx2.Ex1X.2.1.1.m1.1.1.2">p</mi><mtext id="Sx2.Ex1X.2.1.1.m1.1.1.3">𝑐𝑜𝑚𝑏𝑖𝑛𝑒𝑑</mtext></msub><mrow id="Sx2.Ex1X.2.1.1.m1.1.2"><mo id="Sx2.Ex1X.2.1.1.m1.1.2.1" stretchy="false">(</mo><mover accent="true" id="Sx2.Ex1X.2.1.1.m1.1.2.2"><msub id="Sx2.Ex1X.2.1.1.m1.1.2.2.2"><mi id="Sx2.Ex1X.2.1.1.m1.1.2.2.2.2">y</mi><mi id="Sx2.Ex1X.2.1.1.m1.1.2.2.2.3">i</mi></msub><mo id="Sx2.Ex1X.2.1.1.m1.1.2.2.1">^</mo></mover><mo fence="false" id="Sx2.Ex1X.2.1.1.m1.1.2.3" rspace="0.167em" stretchy="false">|</mo><mtext id="Sx2.Ex1X.2.1.1.m1.1.2.4">𝐱</mtext><mo id="Sx2.Ex1X.2.1.1.m1.1.2.5">,</mo></mrow></mrow><annotation encoding="application/x-tex" id="Sx2.Ex1X.2.1.1.m1.1c">\displaystyle p_{\text{{combined}}}(\hat{y_{i}}|\textbf{x},</annotation><annotation encoding="application/x-llamapun" id="Sx2.Ex1X.2.1.1.m1.1d">italic_p start_POSTSUBSCRIPT combined end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x ,</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\hat{\textbf{y}}_{i-1})" class="ltx_math_unparsed" display="inline" id="Sx2.Ex1X.3.2.2.m1.1"><semantics id="Sx2.Ex1X.3.2.2.m1.1a"><mrow id="Sx2.Ex1X.3.2.2.m1.1b"><msub id="Sx2.Ex1X.3.2.2.m1.1.1"><mover accent="true" id="Sx2.Ex1X.3.2.2.m1.1.1.2"><mtext id="Sx2.Ex1X.3.2.2.m1.1.1.2.2">𝐲</mtext><mo id="Sx2.Ex1X.3.2.2.m1.1.1.2.1">^</mo></mover><mrow id="Sx2.Ex1X.3.2.2.m1.1.1.3"><mi id="Sx2.Ex1X.3.2.2.m1.1.1.3.2">i</mi><mo id="Sx2.Ex1X.3.2.2.m1.1.1.3.1">−</mo><mn id="Sx2.Ex1X.3.2.2.m1.1.1.3.3">1</mn></mrow></msub><mo id="Sx2.Ex1X.3.2.2.m1.1.2" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="Sx2.Ex1X.3.2.2.m1.1c">\displaystyle\hat{\textbf{y}}_{i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.Ex1X.3.2.2.m1.1d">over^ start_ARG y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="Sx2.Ex1Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=p_{\text{Meta}}(f(\textbf{x},\textbf{y}_{1:i-1}))\cdot p_{MT}(%
\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="Sx2.Ex1Xa.2.1.1.m1.4"><semantics id="Sx2.Ex1Xa.2.1.1.m1.4a"><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.4.4.4" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.4.cmml"></mi><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.3.cmml">=</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.cmml"><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.cmml"><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.cmml"><msub id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.2.cmml">p</mi><mtext id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3a.cmml">Meta</mtext></msub><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.2.cmml">⁢</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml"><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.2" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml">(</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.3.cmml">f</mi><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.2.cmml"><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.2" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.2.cmml">(</mo><mtext id="Sx2.Ex1Xa.2.1.1.m1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.cmml"><mtext id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml"><mn id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.4" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.2" rspace="0.222em" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.2.cmml">⋅</mo><msub id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.2.cmml">p</mi><mrow id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.2.cmml">M</mi><mo id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.1" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.1.cmml">⁢</mo><mi id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.3.cmml">T</mi></mrow></msub></mrow><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.3.cmml">⁢</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.cmml"><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.2" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.cmml">(</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.cmml"><mover accent="true" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.cmml"><msub id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.2.cmml">y</mi><mi id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.2.cmml">|</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.2.cmml"><mtext id="Sx2.Ex1Xa.2.1.1.m1.2.2" xref="Sx2.Ex1Xa.2.1.1.m1.2.2a.cmml">𝐱</mtext><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.2.cmml">,</mo><msub id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.cmml"><mtext id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.cmml"><mn id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.cmml"><mi id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.2" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.1" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.3" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.3" stretchy="false" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.Ex1Xa.2.1.1.m1.4b"><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4"><eq id="Sx2.Ex1Xa.2.1.1.m1.4.4.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.3"></eq><csymbol cd="latexml" id="Sx2.Ex1Xa.2.1.1.m1.4.4.4.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.4">absent</csymbol><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2"><times id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.3"></times><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1"><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.2">⋅</ci><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1"><times id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.2"></times><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3">subscript</csymbol><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.2">𝑝</ci><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3a.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3"><mtext id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3.cmml" mathsize="70%" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.3.3">Meta</mtext></ci></apply><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1"><times id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.2"></times><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.3">𝑓</ci><interval closure="open" id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1"><ci id="Sx2.Ex1Xa.2.1.1.m1.1.1a.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.1.1"><mtext id="Sx2.Ex1Xa.2.1.1.m1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2a.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2"><mtext id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.2">𝐲</mtext></ci><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3"><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.1">:</ci><cn id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.2">1</cn><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3"><minus id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></apply><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3">subscript</csymbol><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.2">𝑝</ci><apply id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3"><times id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.1"></times><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.2">𝑀</ci><ci id="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.3.3.1.1.3.3.3">𝑇</ci></apply></apply></apply><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1"><csymbol cd="latexml" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.2">conditional</csymbol><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3"><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.1">^</ci><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2">subscript</csymbol><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.2">𝑦</ci><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1"><ci id="Sx2.Ex1Xa.2.1.1.m1.2.2a.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.2.2"><mtext id="Sx2.Ex1Xa.2.1.1.m1.2.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.2.2">𝐱</mtext></ci><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1">subscript</csymbol><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2"><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.1">^</ci><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2a.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2"><mtext id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3"><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.1">:</ci><cn id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.2">1</cn><apply id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3"><minus id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.1.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.2.cmml" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.Ex1Xa.2.1.1.m1.4.4.2.2.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.Ex1Xa.2.1.1.m1.4c">\displaystyle=p_{\text{Meta}}(f(\textbf{x},\textbf{y}_{1:i-1}))\cdot p_{MT}(%
\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.Ex1Xa.2.1.1.m1.4d">= italic_p start_POSTSUBSCRIPT Meta end_POSTSUBSCRIPT ( italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ) ⋅ italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="Sx2.Ex1Xb"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle+\sum_{j=1}^{K}p_{\text{Meta}}(k_{j})\cdot p_{k_{i}NN}(\hat{y_{i}%
}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="Sx2.Ex1Xb.2.1.1.m1.3"><semantics id="Sx2.Ex1Xb.2.1.1.m1.3a"><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.cmml"><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3a" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.cmml">+</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.cmml"><mstyle displaystyle="true" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.cmml"><munderover id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3a" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.cmml"><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.2" movablelimits="false" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.2.cmml">∑</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.2.cmml">j</mi><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.1.cmml">=</mo><mn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.3.cmml">1</mn></mrow><mi id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.3.cmml">K</mi></munderover></mstyle><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.cmml"><mrow id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.cmml"><mrow id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.cmml"><msub id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.2.cmml">p</mi><mtext id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3a.cmml">Meta</mtext></msub><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><msub id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.2.cmml">k</mi><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.2" rspace="0.222em" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.2.cmml">⋅</mo><msub id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.2.cmml">p</mi><mrow id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.cmml"><msub id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.2" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.2.cmml">k</mi><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.3.cmml">i</mi></msub><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1.cmml">⁢</mo><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.3.cmml">N</mi><mo id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1a" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1.cmml">⁢</mo><mi id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.4" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.4.cmml">N</mi></mrow></msub></mrow><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.3.cmml">⁢</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.cmml"><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.2" stretchy="false" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.cmml">(</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.cmml"><mover accent="true" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.cmml"><msub id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.2.cmml">y</mi><mi id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.2.cmml">|</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.2.cmml"><mtext id="Sx2.Ex1Xb.2.1.1.m1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.2.cmml">,</mo><msub id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.cmml"><mover accent="true" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.cmml"><mtext id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.cmml"><mn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.cmml"><mi id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.2" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.1" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.3" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.3" stretchy="false" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx2.Ex1Xb.2.1.1.m1.3b"><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3"><plus id="Sx2.Ex1Xb.2.1.1.m1.3.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3"></plus><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2"><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3">superscript</csymbol><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3">subscript</csymbol><sum id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.2"></sum><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3"><eq id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.1"></eq><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.2">𝑗</ci><cn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.3.cmml" type="integer" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.2.3.3">1</cn></apply></apply><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.3.3">𝐾</ci></apply><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2"><times id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.3"></times><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1"><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.2">⋅</ci><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1"><times id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.2"></times><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3">subscript</csymbol><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.2">𝑝</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3a.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3"><mtext id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3.cmml" mathsize="70%" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.3.3">Meta</mtext></ci></apply><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.2">𝑘</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.1.1.1.1.3">𝑗</ci></apply></apply><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3">subscript</csymbol><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.2">𝑝</ci><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3"><times id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.1"></times><apply id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2">subscript</csymbol><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.2">𝑘</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.2.3">𝑖</ci></apply><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.3">𝑁</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.4.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.2.2.1.1.1.3.3.4">𝑁</ci></apply></apply></apply><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1"><csymbol cd="latexml" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.2">conditional</csymbol><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3"><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.1">^</ci><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2">subscript</csymbol><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.2">𝑦</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1"><ci id="Sx2.Ex1Xb.2.1.1.m1.1.1a.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.1.1"><mtext id="Sx2.Ex1Xb.2.1.1.m1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1">subscript</csymbol><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2"><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.1">^</ci><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2a.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2"><mtext id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3"><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.1">:</ci><cn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.2">1</cn><apply id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3"><minus id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.1.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.1"></minus><ci id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.2.cmml" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx2.Ex1Xb.2.1.1.m1.3.3.2.2.2.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.Ex1Xb.2.1.1.m1.3c">\displaystyle+\sum_{j=1}^{K}p_{\text{Meta}}(k_{j})\cdot p_{k_{i}NN}(\hat{y_{i}%
}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx2.Ex1Xb.2.1.1.m1.3d">+ ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT italic_p start_POSTSUBSCRIPT Meta end_POSTSUBSCRIPT ( italic_k start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) ⋅ italic_p start_POSTSUBSCRIPT italic_k start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_N italic_N end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx2.SSx5.p3">
<p class="ltx_p" id="Sx2.SSx5.p3.5">Here <math alttext="p_{\text{Meta}}" class="ltx_Math" display="inline" id="Sx2.SSx5.p3.1.m1.1"><semantics id="Sx2.SSx5.p3.1.m1.1a"><msub id="Sx2.SSx5.p3.1.m1.1.1" xref="Sx2.SSx5.p3.1.m1.1.1.cmml"><mi id="Sx2.SSx5.p3.1.m1.1.1.2" xref="Sx2.SSx5.p3.1.m1.1.1.2.cmml">p</mi><mtext id="Sx2.SSx5.p3.1.m1.1.1.3" xref="Sx2.SSx5.p3.1.m1.1.1.3a.cmml">Meta</mtext></msub><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p3.1.m1.1b"><apply id="Sx2.SSx5.p3.1.m1.1.1.cmml" xref="Sx2.SSx5.p3.1.m1.1.1"><csymbol cd="ambiguous" id="Sx2.SSx5.p3.1.m1.1.1.1.cmml" xref="Sx2.SSx5.p3.1.m1.1.1">subscript</csymbol><ci id="Sx2.SSx5.p3.1.m1.1.1.2.cmml" xref="Sx2.SSx5.p3.1.m1.1.1.2">𝑝</ci><ci id="Sx2.SSx5.p3.1.m1.1.1.3a.cmml" xref="Sx2.SSx5.p3.1.m1.1.1.3"><mtext id="Sx2.SSx5.p3.1.m1.1.1.3.cmml" mathsize="70%" xref="Sx2.SSx5.p3.1.m1.1.1.3">Meta</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p3.1.m1.1c">p_{\text{Meta}}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p3.1.m1.1d">italic_p start_POSTSUBSCRIPT Meta end_POSTSUBSCRIPT</annotation></semantics></math> is calculated by a simple feed-forward network with distances and distribution of target tokens of its <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx5.p3.2.m2.1"><semantics id="Sx2.SSx5.p3.2.m2.1a"><mi id="Sx2.SSx5.p3.2.m2.1.1" xref="Sx2.SSx5.p3.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p3.2.m2.1b"><ci id="Sx2.SSx5.p3.2.m2.1.1.cmml" xref="Sx2.SSx5.p3.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p3.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p3.2.m2.1d">italic_k</annotation></semantics></math> nearest neighbors,
<math alttext="p_{k_{i}NN}" class="ltx_Math" display="inline" id="Sx2.SSx5.p3.3.m3.1"><semantics id="Sx2.SSx5.p3.3.m3.1a"><msub id="Sx2.SSx5.p3.3.m3.1.1" xref="Sx2.SSx5.p3.3.m3.1.1.cmml"><mi id="Sx2.SSx5.p3.3.m3.1.1.2" xref="Sx2.SSx5.p3.3.m3.1.1.2.cmml">p</mi><mrow id="Sx2.SSx5.p3.3.m3.1.1.3" xref="Sx2.SSx5.p3.3.m3.1.1.3.cmml"><msub id="Sx2.SSx5.p3.3.m3.1.1.3.2" xref="Sx2.SSx5.p3.3.m3.1.1.3.2.cmml"><mi id="Sx2.SSx5.p3.3.m3.1.1.3.2.2" xref="Sx2.SSx5.p3.3.m3.1.1.3.2.2.cmml">k</mi><mi id="Sx2.SSx5.p3.3.m3.1.1.3.2.3" xref="Sx2.SSx5.p3.3.m3.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx2.SSx5.p3.3.m3.1.1.3.1" xref="Sx2.SSx5.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="Sx2.SSx5.p3.3.m3.1.1.3.3" xref="Sx2.SSx5.p3.3.m3.1.1.3.3.cmml">N</mi><mo id="Sx2.SSx5.p3.3.m3.1.1.3.1a" xref="Sx2.SSx5.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="Sx2.SSx5.p3.3.m3.1.1.3.4" xref="Sx2.SSx5.p3.3.m3.1.1.3.4.cmml">N</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p3.3.m3.1b"><apply id="Sx2.SSx5.p3.3.m3.1.1.cmml" xref="Sx2.SSx5.p3.3.m3.1.1"><csymbol cd="ambiguous" id="Sx2.SSx5.p3.3.m3.1.1.1.cmml" xref="Sx2.SSx5.p3.3.m3.1.1">subscript</csymbol><ci id="Sx2.SSx5.p3.3.m3.1.1.2.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.2">𝑝</ci><apply id="Sx2.SSx5.p3.3.m3.1.1.3.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3"><times id="Sx2.SSx5.p3.3.m3.1.1.3.1.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.1"></times><apply id="Sx2.SSx5.p3.3.m3.1.1.3.2.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.2"><csymbol cd="ambiguous" id="Sx2.SSx5.p3.3.m3.1.1.3.2.1.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.2">subscript</csymbol><ci id="Sx2.SSx5.p3.3.m3.1.1.3.2.2.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.2.2">𝑘</ci><ci id="Sx2.SSx5.p3.3.m3.1.1.3.2.3.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.2.3">𝑖</ci></apply><ci id="Sx2.SSx5.p3.3.m3.1.1.3.3.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.3">𝑁</ci><ci id="Sx2.SSx5.p3.3.m3.1.1.3.4.cmml" xref="Sx2.SSx5.p3.3.m3.1.1.3.4">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p3.3.m3.1c">p_{k_{i}NN}</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p3.3.m3.1d">italic_p start_POSTSUBSCRIPT italic_k start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_N italic_N end_POSTSUBSCRIPT</annotation></semantics></math> is also given by Eq.  <a class="ltx_ref" href="#Sx2.E1" title="1 ‣ Estimation of Probability Distribution ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>.
The Adaptive approach introduces almost no inference latency and achieves 1.44 <math alttext="\sim" class="ltx_Math" display="inline" id="Sx2.SSx5.p3.4.m4.1"><semantics id="Sx2.SSx5.p3.4.m4.1a"><mo id="Sx2.SSx5.p3.4.m4.1.1" xref="Sx2.SSx5.p3.4.m4.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p3.4.m4.1b"><csymbol cd="latexml" id="Sx2.SSx5.p3.4.m4.1.1.cmml" xref="Sx2.SSx5.p3.4.m4.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p3.4.m4.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p3.4.m4.1d">∼</annotation></semantics></math> 2.97 BLEU score improvements than the vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx5.p3.5.m5.1"><semantics id="Sx2.SSx5.p3.5.m5.1a"><mi id="Sx2.SSx5.p3.5.m5.1.1" xref="Sx2.SSx5.p3.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx5.p3.5.m5.1b"><ci id="Sx2.SSx5.p3.5.m5.1.1.cmml" xref="Sx2.SSx5.p3.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx5.p3.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx5.p3.5.m5.1d">italic_k</annotation></semantics></math>NN-MT.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx6">
<h3 class="ltx_title ltx_title_subsection">PCK-kNN-MT</h3>
<div class="ltx_para" id="Sx2.SSx6.p1">
<p class="ltx_p" id="Sx2.SSx6.p1.1">PCK variant <cite class="ltx_cite ltx_citemacro_citep">(Wang et al. <a class="ltx_ref" href="#bib.bib29" title="">2022</a>)</cite> extends the Adaptive method and
trains a compact network to reduce the dimension of key vectors.
It also makes margins between keys with different target tokens more discriminable.
Then it prunes the size of the datastore by deleting redundant key-value pairs.
It is a typical and effective accelerating method of reducing the query dimension and shrinking the datastore.
Compared with our method, which accelerates <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx6.p1.1.m1.1"><semantics id="Sx2.SSx6.p1.1.m1.1a"><mi id="Sx2.SSx6.p1.1.m1.1.1" xref="Sx2.SSx6.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx6.p1.1.m1.1b"><ci id="Sx2.SSx6.p1.1.m1.1.1.cmml" xref="Sx2.SSx6.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx6.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx6.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT by eliminating unnecessary retrievals and is simple also highly interpretable.</p>
</div>
<div class="ltx_para" id="Sx2.SSx6.p2">
<p class="ltx_p" id="Sx2.SSx6.p2.1">We will show that our method could work with the Adaptive and the PCK <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx6.p2.1.m1.1"><semantics id="Sx2.SSx6.p2.1.m1.1a"><mi id="Sx2.SSx6.p2.1.m1.1.1" xref="Sx2.SSx6.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx6.p2.1.m1.1b"><ci id="Sx2.SSx6.p2.1.m1.1.1.cmml" xref="Sx2.SSx6.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx6.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx6.p2.1.m1.1d">italic_k</annotation></semantics></math>NN-MT.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx7">
<h3 class="ltx_title ltx_title_subsection">Some Other <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx7.1.m1.1"><semantics id="Sx2.SSx7.1.m1.1b"><mi id="Sx2.SSx7.1.m1.1.1" xref="Sx2.SSx7.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx7.1.m1.1c"><ci id="Sx2.SSx7.1.m1.1.1.cmml" xref="Sx2.SSx7.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx7.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx7.1.m1.1e">italic_k</annotation></semantics></math>NN-MT Variants</h3>
<div class="ltx_para" id="Sx2.SSx7.p1">
<ul class="ltx_itemize" id="Sx2.I2">
<li class="ltx_item" id="Sx2.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx2.I2.i1.p1">
<p class="ltx_p" id="Sx2.I2.i1.p1.1"><span class="ltx_text ltx_font_bold" id="Sx2.I2.i1.p1.1.1">SK-MT</span> <cite class="ltx_cite ltx_citemacro_citep">(Dai et al. <a class="ltx_ref" href="#bib.bib5" title="">2023</a>)</cite>, a distance-ware adapter is introduced to adaptively incorporate retrieval results.</p>
</div>
</li>
<li class="ltx_item" id="Sx2.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx2.I2.i2.p1">
<p class="ltx_p" id="Sx2.I2.i2.p1.1"><span class="ltx_text ltx_font_bold" id="Sx2.I2.i2.p1.1.1">Revised Key KNN-MT</span> <cite class="ltx_cite ltx_citemacro_citep">(Cao et al. <a class="ltx_ref" href="#bib.bib3" title="">2023</a>)</cite>, a simple feed-forward netowrk is trained to add a revising vector to original query.
It improves the retrieving accuarcy and enhances the adaptation.</p>
</div>
</li>
<li class="ltx_item" id="Sx2.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx2.I2.i3.p1">
<p class="ltx_p" id="Sx2.I2.i3.p1.1"><span class="ltx_text ltx_font_bold" id="Sx2.I2.i3.p1.1.1">Robust KNN-MT</span>, introducing NMT condfidence to alleviate deterioration casued by noisy key-value pairs.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_subsection" id="Sx2.SSx8">
<h3 class="ltx_title ltx_title_subsection">kNN-BOX</h3>
<div class="ltx_para" id="Sx2.SSx8.p1">
<p class="ltx_p" id="Sx2.SSx8.p1.1">kNN-BOX <cite class="ltx_cite ltx_citemacro_citep">(Zhu et al. <a class="ltx_ref" href="#bib.bib32" title="">2023</a>)</cite> assembles various implementations of <math alttext="k" class="ltx_Math" display="inline" id="Sx2.SSx8.p1.1.m1.1"><semantics id="Sx2.SSx8.p1.1.m1.1a"><mi id="Sx2.SSx8.p1.1.m1.1.1" xref="Sx2.SSx8.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx2.SSx8.p1.1.m1.1b"><ci id="Sx2.SSx8.p1.1.m1.1.1.cmml" xref="Sx2.SSx8.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx2.SSx8.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx2.SSx8.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT systems, together with the baseline NMT model. It provides a unified
framework for modeling and evaluations. It uses FAISS <cite class="ltx_cite ltx_citemacro_citep">(Johnson, Douze, and Jégou <a class="ltx_ref" href="#bib.bib10" title="">2019</a>)</cite> for efficient high-dimensional vector retrievals implementations.
Our implementation and experiments are based on this framework.
It is a remarkable fact that kNN-BOX further optimizes the codes and significantly speeds up retrievals,
and we do not observe two-orders slower in speed as the original paper reports.</p>
</div>
</section>
</section>
<section class="ltx_section" id="Sx3">
<h2 class="ltx_title ltx_title_section">Methodolgy</h2>
<div class="ltx_para" id="Sx3.p1">
<p class="ltx_p" id="Sx3.p1.2">We consider that the reason why most tokens do not require <math alttext="k" class="ltx_Math" display="inline" id="Sx3.p1.1.m1.1"><semantics id="Sx3.p1.1.m1.1a"><mi id="Sx3.p1.1.m1.1.1" xref="Sx3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.p1.1.m1.1b"><ci id="Sx3.p1.1.m1.1.1.cmml" xref="Sx3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.p1.1.m1.1d">italic_k</annotation></semantics></math>NN retrieval in cross-domain
machine translation is that the frequent words always keep unvaried in diverse domains, for example, in English, they may be punctuations and prepositions. Meanwhile, the out-of-domain issue often
occurs in nouns and verbs.
We count these types of words, and the ratios keep unchanged after <math alttext="k" class="ltx_Math" display="inline" id="Sx3.p1.2.m2.1"><semantics id="Sx3.p1.2.m2.1a"><mi id="Sx3.p1.2.m2.1.1" xref="Sx3.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.p1.2.m2.1b"><ci id="Sx3.p1.2.m2.1.1.cmml" xref="Sx3.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.p1.2.m2.1d">italic_k</annotation></semantics></math>NN retrievals, for example, as shown in figure  <a class="ltx_ref" href="#Sx3.F2" title="Figure 2 ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a>
Thus, the idea is highly explainable.</p>
</div>
<figure class="ltx_figure" id="Sx3.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="289" id="Sx3.F2.g1" src="extracted/5290628/figures/top_redundants.png" width="586"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Top-8 tokens which cause futile retrievals on multi-domain IT dataset.
These tokens are always unchanged after <math alttext="k" class="ltx_Math" display="inline" id="Sx3.F2.2.m1.1"><semantics id="Sx3.F2.2.m1.1b"><mi id="Sx3.F2.2.m1.1.1" xref="Sx3.F2.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.F2.2.m1.1c"><ci id="Sx3.F2.2.m1.1.1.cmml" xref="Sx3.F2.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.F2.2.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.F2.2.m1.1e">italic_k</annotation></semantics></math>NN retrievals. </figcaption>
</figure>
<section class="ltx_subsubsection" id="Sx3.SSx8.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Our Mehtod</h4>
<div class="ltx_para" id="Sx3.SSx8.SSSx1.p1">
<p class="ltx_p" id="Sx3.SSx8.SSSx1.p1.1">We train a simple 3-layer MLP network called selector
to predict whether each token to retrieve or not.
We want the selector directly distinguish the latent representations of in-domain and out-domain semantics.
It gives the probabilities for the two options by</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx1.p2">
<table class="ltx_equationgroup ltx_eqn_table" id="Sx3.E3">
<tbody>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx3.E3X">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p(\mathcal{A}_{i}|f" class="ltx_math_unparsed" display="inline" id="Sx3.E3X.2.1.1.m1.1"><semantics id="Sx3.E3X.2.1.1.m1.1a"><mrow id="Sx3.E3X.2.1.1.m1.1b"><mi id="Sx3.E3X.2.1.1.m1.1.1">p</mi><mrow id="Sx3.E3X.2.1.1.m1.1.2"><mo id="Sx3.E3X.2.1.1.m1.1.2.1" stretchy="false">(</mo><msub id="Sx3.E3X.2.1.1.m1.1.2.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.E3X.2.1.1.m1.1.2.2.2">𝒜</mi><mi id="Sx3.E3X.2.1.1.m1.1.2.2.3">i</mi></msub><mo fence="false" id="Sx3.E3X.2.1.1.m1.1.2.3" rspace="0.167em" stretchy="false">|</mo><mi id="Sx3.E3X.2.1.1.m1.1.2.4">f</mi></mrow></mrow><annotation encoding="application/x-tex" id="Sx3.E3X.2.1.1.m1.1c">\displaystyle p(\mathcal{A}_{i}|f</annotation><annotation encoding="application/x-llamapun" id="Sx3.E3X.2.1.1.m1.1d">italic_p ( caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_f</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle(\textbf{x},\textbf{y}_{1:i-1}))" class="ltx_math_unparsed" display="inline" id="Sx3.E3X.3.2.2.m1.1"><semantics id="Sx3.E3X.3.2.2.m1.1a"><mrow id="Sx3.E3X.3.2.2.m1.1b"><mrow id="Sx3.E3X.3.2.2.m1.1.2"><mo id="Sx3.E3X.3.2.2.m1.1.2.1" stretchy="false">(</mo><mtext id="Sx3.E3X.3.2.2.m1.1.1">𝐱</mtext><mo id="Sx3.E3X.3.2.2.m1.1.2.2">,</mo><msub id="Sx3.E3X.3.2.2.m1.1.2.3"><mtext id="Sx3.E3X.3.2.2.m1.1.2.3.2">𝐲</mtext><mrow id="Sx3.E3X.3.2.2.m1.1.2.3.3"><mn id="Sx3.E3X.3.2.2.m1.1.2.3.3.2">1</mn><mo id="Sx3.E3X.3.2.2.m1.1.2.3.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E3X.3.2.2.m1.1.2.3.3.3"><mi id="Sx3.E3X.3.2.2.m1.1.2.3.3.3.2">i</mi><mo id="Sx3.E3X.3.2.2.m1.1.2.3.3.3.1">−</mo><mn id="Sx3.E3X.3.2.2.m1.1.2.3.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.E3X.3.2.2.m1.1.2.4" stretchy="false">)</mo></mrow><mo id="Sx3.E3X.3.2.2.m1.1.3" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="Sx3.E3X.3.2.2.m1.1c">\displaystyle(\textbf{x},\textbf{y}_{1:i-1}))</annotation><annotation encoding="application/x-llamapun" id="Sx3.E3X.3.2.2.m1.1d">( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="2"><span class="ltx_tag ltx_tag_equationgroup ltx_align_right">(3)</span></td>
</tr>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx3.E3Xa">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle=" class="ltx_Math" display="inline" id="Sx3.E3Xa.2.1.1.m1.1"><semantics id="Sx3.E3Xa.2.1.1.m1.1a"><mo id="Sx3.E3Xa.2.1.1.m1.1.1" xref="Sx3.E3Xa.2.1.1.m1.1.1.cmml">=</mo><annotation-xml encoding="MathML-Content" id="Sx3.E3Xa.2.1.1.m1.1b"><eq id="Sx3.E3Xa.2.1.1.m1.1.1.cmml" xref="Sx3.E3Xa.2.1.1.m1.1.1"></eq></annotation-xml><annotation encoding="application/x-tex" id="Sx3.E3Xa.2.1.1.m1.1c">\displaystyle=</annotation><annotation encoding="application/x-llamapun" id="Sx3.E3Xa.2.1.1.m1.1d">=</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathrm{softmax}(W_{2}^{T}[\mathrm{ReLU}(W_{1}^{T}\cdot f(\textbf%
{x},\textbf{y}_{1:i-1}))])" class="ltx_Math" display="inline" id="Sx3.E3Xa.3.2.2.m1.2"><semantics id="Sx3.E3Xa.3.2.2.m1.2a"><mrow id="Sx3.E3Xa.3.2.2.m1.2.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.cmml"><mi id="Sx3.E3Xa.3.2.2.m1.2.2.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.3.cmml">softmax</mi><mo id="Sx3.E3Xa.3.2.2.m1.2.2.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.2.cmml">⁢</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.cmml"><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.2" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.cmml">(</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.cmml"><msubsup id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.cmml"><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.2.cmml">W</mi><mn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.3.cmml">2</mn><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.3.cmml">T</mi></msubsup><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.2.cmml"><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.2.1.cmml">[</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.cmml"><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.3.cmml">ReLU</mi><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.2" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml"><msubsup id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.cmml"><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.2.cmml">W</mi><mn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.3.cmml">1</mn><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.3.cmml">T</mi></msubsup><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.1.cmml">⋅</mo><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.3.cmml">f</mi></mrow><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml"><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml">(</mo><mtext id="Sx3.E3Xa.3.2.2.m1.1.1" xref="Sx3.E3Xa.3.2.2.m1.1.1a.cmml">𝐱</mtext><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mtext id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml"><mn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.2" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.1" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.3" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.3" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.3" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.3" stretchy="false" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.E3Xa.3.2.2.m1.2b"><apply id="Sx3.E3Xa.3.2.2.m1.2.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2"><times id="Sx3.E3Xa.3.2.2.m1.2.2.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.2"></times><ci id="Sx3.E3Xa.3.2.2.m1.2.2.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.3">softmax</ci><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1"><times id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.2"></times><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3">superscript</csymbol><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3">subscript</csymbol><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.2">𝑊</ci><cn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.3.cmml" type="integer" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.2.3">2</cn></apply><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.3.3">𝑇</ci></apply><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1"><csymbol cd="latexml" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.2.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.2">delimited-[]</csymbol><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1"><times id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.2"></times><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.3">ReLU</ci><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1"><times id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.2"></times><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3"><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.1">⋅</ci><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2">superscript</csymbol><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2">subscript</csymbol><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.2">𝑊</ci><cn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.3.cmml" type="integer" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.2.3">1</cn></apply><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.2.3">𝑇</ci></apply><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.3.3">𝑓</ci></apply><interval closure="open" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1"><ci id="Sx3.E3Xa.3.2.2.m1.1.1a.cmml" xref="Sx3.E3Xa.3.2.2.m1.1.1"><mtext id="Sx3.E3Xa.3.2.2.m1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.1.1">𝐱</mtext></ci><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2a.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2"><mtext id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2">𝐲</mtext></ci><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3"><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.1">:</ci><cn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.2">1</cn><apply id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3"><minus id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx3.E3Xa.3.2.2.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.E3Xa.3.2.2.m1.2c">\displaystyle\mathrm{softmax}(W_{2}^{T}[\mathrm{ReLU}(W_{1}^{T}\cdot f(\textbf%
{x},\textbf{y}_{1:i-1}))])</annotation><annotation encoding="application/x-llamapun" id="Sx3.E3Xa.3.2.2.m1.2d">roman_softmax ( italic_W start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT [ roman_ReLU ( italic_W start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT ⋅ italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ) ] )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</tbody>
</table>
<p class="ltx_p" id="Sx3.SSx8.SSSx1.p2.5">where <math alttext="W_{1}\in\mathcal{R}^{d\times d^{\prime}}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx1.p2.1.m1.1"><semantics id="Sx3.SSx8.SSSx1.p2.1.m1.1a"><mrow id="Sx3.SSx8.SSSx1.p2.1.m1.1.1" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.cmml"><msub id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.cmml"><mi id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.2" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.2.cmml">W</mi><mn id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.3" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.3.cmml">1</mn></msub><mo id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.1" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.1.cmml">∈</mo><msup id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.2" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.2.cmml">ℛ</mi><mrow id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.cmml"><mi id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.2" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.2.cmml">d</mi><mo id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.1.cmml">×</mo><msup id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.cmml"><mi id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.2" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.2.cmml">d</mi><mo id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.3" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.3.cmml">′</mo></msup></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx1.p2.1.m1.1b"><apply id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1"><in id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.1"></in><apply id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2">subscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.2.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.2">𝑊</ci><cn id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.3.cmml" type="integer" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.2.3">1</cn></apply><apply id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3">superscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.2">ℛ</ci><apply id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3"><times id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.1"></times><ci id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.2">𝑑</ci><apply id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3">superscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.2">𝑑</ci><ci id="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.3.cmml" xref="Sx3.SSx8.SSSx1.p2.1.m1.1.1.3.3.3.3">′</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx1.p2.1.m1.1c">W_{1}\in\mathcal{R}^{d\times d^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx1.p2.1.m1.1d">italic_W start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d × italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="W_{2}\in\mathcal{R}^{d^{\prime}\times 2}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx1.p2.2.m2.1"><semantics id="Sx3.SSx8.SSSx1.p2.2.m2.1a"><mrow id="Sx3.SSx8.SSSx1.p2.2.m2.1.1" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.cmml"><msub id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.cmml"><mi id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.2" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.2.cmml">W</mi><mn id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.3" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.3.cmml">2</mn></msub><mo id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.1" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.1.cmml">∈</mo><msup id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.2" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.2.cmml">ℛ</mi><mrow id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.cmml"><msup id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.cmml"><mi id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.2" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.2.cmml">d</mi><mo id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.3" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.3.cmml">′</mo></msup><mo id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.1.cmml">×</mo><mn id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.3" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.3.cmml">2</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx1.p2.2.m2.1b"><apply id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1"><in id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.1"></in><apply id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2">subscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.2.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.2">𝑊</ci><cn id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.3.cmml" type="integer" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.2.3">2</cn></apply><apply id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3">superscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.2">ℛ</ci><apply id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3"><times id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.1"></times><apply id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.1.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2">superscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.2.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.2">𝑑</ci><ci id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.3.cmml" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.2.3">′</ci></apply><cn id="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.3.cmml" type="integer" xref="Sx3.SSx8.SSSx1.p2.2.m2.1.1.3.3.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx1.p2.2.m2.1c">W_{2}\in\mathcal{R}^{d^{\prime}\times 2}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx1.p2.2.m2.1d">italic_W start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∈ caligraphic_R start_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT × 2 end_POSTSUPERSCRIPT</annotation></semantics></math>.
<math alttext="d^{\prime}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx1.p2.3.m3.1"><semantics id="Sx3.SSx8.SSSx1.p2.3.m3.1a"><msup id="Sx3.SSx8.SSSx1.p2.3.m3.1.1" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1.cmml"><mi id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.2" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1.2.cmml">d</mi><mo id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.3" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx1.p2.3.m3.1b"><apply id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1">superscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.2.cmml" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1.2">𝑑</ci><ci id="Sx3.SSx8.SSSx1.p2.3.m3.1.1.3.cmml" xref="Sx3.SSx8.SSSx1.p2.3.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx1.p2.3.m3.1c">d^{\prime}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx1.p2.3.m3.1d">italic_d start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is the inner hidden dimension of the MLP.
<math alttext="\mathcal{A}_{i}\in\{0,1\}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx1.p2.4.m4.2"><semantics id="Sx3.SSx8.SSSx1.p2.4.m4.2a"><mrow id="Sx3.SSx8.SSSx1.p2.4.m4.2.3" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.cmml"><msub id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.2" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.2.cmml">𝒜</mi><mi id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.3" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.3.cmml">i</mi></msub><mo id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.1" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.1.cmml">∈</mo><mrow id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.2" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.1.cmml"><mo id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.2.1" stretchy="false" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.1.cmml">{</mo><mn id="Sx3.SSx8.SSSx1.p2.4.m4.1.1" xref="Sx3.SSx8.SSSx1.p2.4.m4.1.1.cmml">0</mn><mo id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.2.2" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.1.cmml">,</mo><mn id="Sx3.SSx8.SSSx1.p2.4.m4.2.2" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.2.cmml">1</mn><mo id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.2.3" stretchy="false" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx1.p2.4.m4.2b"><apply id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3"><in id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.1"></in><apply id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.1.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2">subscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.2.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.2">𝒜</ci><ci id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.3.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.2.3">𝑖</ci></apply><set id="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.1.cmml" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.3.3.2"><cn id="Sx3.SSx8.SSSx1.p2.4.m4.1.1.cmml" type="integer" xref="Sx3.SSx8.SSSx1.p2.4.m4.1.1">0</cn><cn id="Sx3.SSx8.SSSx1.p2.4.m4.2.2.cmml" type="integer" xref="Sx3.SSx8.SSSx1.p2.4.m4.2.2">1</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx1.p2.4.m4.2c">\mathcal{A}_{i}\in\{0,1\}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx1.p2.4.m4.2d">caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ { 0 , 1 }</annotation></semantics></math> is the decision of whether to retrieve for <math alttext="y_{i}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx1.p2.5.m5.1"><semantics id="Sx3.SSx8.SSSx1.p2.5.m5.1a"><msub id="Sx3.SSx8.SSSx1.p2.5.m5.1.1" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1.cmml"><mi id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.2" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1.2.cmml">y</mi><mi id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.3" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx1.p2.5.m5.1b"><apply id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.1.cmml" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1">subscript</csymbol><ci id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.2.cmml" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1.2">𝑦</ci><ci id="Sx3.SSx8.SSSx1.p2.5.m5.1.1.3.cmml" xref="Sx3.SSx8.SSSx1.p2.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx1.p2.5.m5.1c">y_{i}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx1.p2.5.m5.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>,
0 is to retrieve and 1 is not.</p>
</div>
<figure class="ltx_figure" id="Sx3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="471" id="Sx3.F3.g1" src="extracted/5290628/figures/train.png" width="515"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>The training procedure of our method.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="Sx3.SSx8.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">Training Procedures</h4>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p1">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p1.6">We make labels <math alttext="l" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p1.1.m1.1"><semantics id="Sx3.SSx8.SSSx2.p1.1.m1.1a"><mi id="Sx3.SSx8.SSSx2.p1.1.m1.1.1" xref="Sx3.SSx8.SSSx2.p1.1.m1.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p1.1.m1.1b"><ci id="Sx3.SSx8.SSSx2.p1.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.1.m1.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p1.1.m1.1c">l</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p1.1.m1.1d">italic_l</annotation></semantics></math> for the selector by observing the
predictions of the neural
translation model <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p1.2.m2.1"><semantics id="Sx3.SSx8.SSSx2.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx2.p1.2.m2.1.1" xref="Sx3.SSx8.SSSx2.p1.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p1.2.m2.1b"><ci id="Sx3.SSx8.SSSx2.p1.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p1.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p1.2.m2.1d">caligraphic_M</annotation></semantics></math> and the target sequences <span class="ltx_text ltx_markedasmath ltx_font_bold" id="Sx3.SSx8.SSSx2.p1.6.1">y</span>.
If <math alttext="\hat{y}_{i}=\mathcal{M}(f(\textbf{x},\textbf{y}_{1:i-1}))" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p1.4.m4.2"><semantics id="Sx3.SSx8.SSSx2.p1.4.m4.2a"><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.cmml"><msub id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.cmml"><mover accent="true" id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.cmml"><mi id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.2.cmml">y</mi><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.1.cmml">^</mo></mover><mi id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.3.cmml">i</mi></msub><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.2.cmml">=</mo><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.3.cmml">ℳ</mi><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.2.cmml">⁢</mo><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.cmml"><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.2" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.cmml">(</mo><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.cmml"><mi id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.3.cmml">f</mi><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.2.cmml"><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.2" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.2.cmml">(</mo><mtext id="Sx3.SSx8.SSSx2.p1.4.m4.1.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.1.1a.cmml">𝐱</mtext><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.2.cmml">,</mo><msub id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.cmml"><mtext id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.cmml"><mn id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.cmml"><mi id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.2" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.1" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.3" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.4" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.3" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p1.4.m4.2b"><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2"><eq id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.2"></eq><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3">subscript</csymbol><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2"><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.1">^</ci><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.2.2">𝑦</ci></apply><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.3.3">𝑖</ci></apply><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1"><times id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.2"></times><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.3">ℳ</ci><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1"><times id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.2"></times><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.3">𝑓</ci><interval closure="open" id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1"><ci id="Sx3.SSx8.SSSx2.p1.4.m4.1.1a.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.1.1"><mtext id="Sx3.SSx8.SSSx2.p1.4.m4.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.1.1">𝐱</mtext></ci><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2a.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2"><mtext id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.2">𝐲</mtext></ci><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3"><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.1">:</ci><cn id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.2">1</cn><apply id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3"><minus id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.1.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.2.cmml" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p1.4.m4.2.2.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p1.4.m4.2c">\hat{y}_{i}=\mathcal{M}(f(\textbf{x},\textbf{y}_{1:i-1}))</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p1.4.m4.2d">over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = caligraphic_M ( italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) )</annotation></semantics></math> is equal to <math alttext="y_{i}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p1.5.m5.1"><semantics id="Sx3.SSx8.SSSx2.p1.5.m5.1a"><msub id="Sx3.SSx8.SSSx2.p1.5.m5.1.1" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1.cmml"><mi id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.2" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1.2.cmml">y</mi><mi id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.3" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p1.5.m5.1b"><apply id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1">subscript</csymbol><ci id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1.2">𝑦</ci><ci id="Sx3.SSx8.SSSx2.p1.5.m5.1.1.3.cmml" xref="Sx3.SSx8.SSSx2.p1.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p1.5.m5.1c">y_{i}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p1.5.m5.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>,
we mark the label of <math alttext="f(\textbf{x},\textbf{y}_{1:i-1})" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p1.6.m6.2"><semantics id="Sx3.SSx8.SSSx2.p1.6.m6.2a"><mrow id="Sx3.SSx8.SSSx2.p1.6.m6.2.2" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.cmml"><mi id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.3" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.3.cmml">f</mi><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.2" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.2.cmml">⁢</mo><mrow id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.2.cmml"><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.2" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.2.cmml">(</mo><mtext id="Sx3.SSx8.SSSx2.p1.6.m6.1.1" xref="Sx3.SSx8.SSSx2.p1.6.m6.1.1a.cmml">𝐱</mtext><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.3" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.2.cmml">,</mo><msub id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.cmml"><mtext id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.cmml"><mn id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.2" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.2.cmml">1</mn><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.1.cmml">:</mo><mrow id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.cmml"><mi id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.2" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.2.cmml">i</mi><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.1" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.1.cmml">−</mo><mn id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.3" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.4" stretchy="false" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p1.6.m6.2b"><apply id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2"><times id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.2.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.2"></times><ci id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.3.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.3">𝑓</ci><interval closure="open" id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1"><ci id="Sx3.SSx8.SSSx2.p1.6.m6.1.1a.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.1.1"><mtext id="Sx3.SSx8.SSSx2.p1.6.m6.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.1.1">𝐱</mtext></ci><apply id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1">subscript</csymbol><ci id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2a.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2"><mtext id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.2">𝐲</mtext></ci><apply id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3"><ci id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.1.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.1">:</ci><cn id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.2.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.2">1</cn><apply id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3"><minus id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.1.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.1"></minus><ci id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.2.cmml" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.2">𝑖</ci><cn id="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.3.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p1.6.m6.2.2.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p1.6.m6.2c">f(\textbf{x},\textbf{y}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p1.6.m6.2d">italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> to be 1, otherwise 0.
Weighted cross-entropy loss is used as the criterion to train the network, the loss is measured by</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p2">
<table class="ltx_equationgroup ltx_eqn_table" id="Sx3.E4">
<tbody>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx3.E4X">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathcal{L}_{1}" class="ltx_Math" display="inline" id="Sx3.E4X.2.1.1.m1.1"><semantics id="Sx3.E4X.2.1.1.m1.1a"><msub id="Sx3.E4X.2.1.1.m1.1.1" xref="Sx3.E4X.2.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E4X.2.1.1.m1.1.1.2" xref="Sx3.E4X.2.1.1.m1.1.1.2.cmml">ℒ</mi><mn id="Sx3.E4X.2.1.1.m1.1.1.3" xref="Sx3.E4X.2.1.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="Sx3.E4X.2.1.1.m1.1b"><apply id="Sx3.E4X.2.1.1.m1.1.1.cmml" xref="Sx3.E4X.2.1.1.m1.1.1"><csymbol cd="ambiguous" id="Sx3.E4X.2.1.1.m1.1.1.1.cmml" xref="Sx3.E4X.2.1.1.m1.1.1">subscript</csymbol><ci id="Sx3.E4X.2.1.1.m1.1.1.2.cmml" xref="Sx3.E4X.2.1.1.m1.1.1.2">ℒ</ci><cn id="Sx3.E4X.2.1.1.m1.1.1.3.cmml" type="integer" xref="Sx3.E4X.2.1.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.E4X.2.1.1.m1.1c">\displaystyle\mathcal{L}_{1}</annotation><annotation encoding="application/x-llamapun" id="Sx3.E4X.2.1.1.m1.1d">caligraphic_L start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{i}[-\frac{N}{B}[l_{i}=0]\log p(\mathcal{A}_{i}=0|f(\textbf%
{x},\textbf{y}_{1:i-1}))" class="ltx_math_unparsed" display="inline" id="Sx3.E4X.3.2.2.m1.1"><semantics id="Sx3.E4X.3.2.2.m1.1a"><mrow id="Sx3.E4X.3.2.2.m1.1b"><mo id="Sx3.E4X.3.2.2.m1.1.2">=</mo><mstyle displaystyle="true" id="Sx3.E4X.3.2.2.m1.1.3"><munder id="Sx3.E4X.3.2.2.m1.1.3a"><mo id="Sx3.E4X.3.2.2.m1.1.3.2" movablelimits="false">∑</mo><mi id="Sx3.E4X.3.2.2.m1.1.3.3">i</mi></munder></mstyle><mrow id="Sx3.E4X.3.2.2.m1.1.4"><mo id="Sx3.E4X.3.2.2.m1.1.4.1" stretchy="false">[</mo><mo id="Sx3.E4X.3.2.2.m1.1.4.2" lspace="0em">−</mo><mstyle displaystyle="true" id="Sx3.E4X.3.2.2.m1.1.4.3"><mfrac id="Sx3.E4X.3.2.2.m1.1.4.3a"><mi id="Sx3.E4X.3.2.2.m1.1.4.3.2">N</mi><mi id="Sx3.E4X.3.2.2.m1.1.4.3.3">B</mi></mfrac></mstyle><mrow id="Sx3.E4X.3.2.2.m1.1.4.4"><mo id="Sx3.E4X.3.2.2.m1.1.4.4.1" stretchy="false">[</mo><msub id="Sx3.E4X.3.2.2.m1.1.4.4.2"><mi id="Sx3.E4X.3.2.2.m1.1.4.4.2.2">l</mi><mi id="Sx3.E4X.3.2.2.m1.1.4.4.2.3">i</mi></msub><mo id="Sx3.E4X.3.2.2.m1.1.4.4.3">=</mo><mn id="Sx3.E4X.3.2.2.m1.1.4.4.4">0</mn><mo id="Sx3.E4X.3.2.2.m1.1.4.4.5" rspace="0.167em" stretchy="false">]</mo></mrow><mi id="Sx3.E4X.3.2.2.m1.1.4.5">log</mi><mi id="Sx3.E4X.3.2.2.m1.1.4.6">p</mi><mrow id="Sx3.E4X.3.2.2.m1.1.4.7"><mo id="Sx3.E4X.3.2.2.m1.1.4.7.1" stretchy="false">(</mo><msub id="Sx3.E4X.3.2.2.m1.1.4.7.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.E4X.3.2.2.m1.1.4.7.2.2">𝒜</mi><mi id="Sx3.E4X.3.2.2.m1.1.4.7.2.3">i</mi></msub><mo id="Sx3.E4X.3.2.2.m1.1.4.7.3">=</mo><mn id="Sx3.E4X.3.2.2.m1.1.4.7.4">0</mn><mo fence="false" id="Sx3.E4X.3.2.2.m1.1.4.7.5" rspace="0.167em" stretchy="false">|</mo><mi id="Sx3.E4X.3.2.2.m1.1.4.7.6">f</mi><mrow id="Sx3.E4X.3.2.2.m1.1.4.7.7"><mo id="Sx3.E4X.3.2.2.m1.1.4.7.7.1" stretchy="false">(</mo><mtext id="Sx3.E4X.3.2.2.m1.1.1">𝐱</mtext><mo id="Sx3.E4X.3.2.2.m1.1.4.7.7.2">,</mo><msub id="Sx3.E4X.3.2.2.m1.1.4.7.7.3"><mtext id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.2">𝐲</mtext><mrow id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3"><mn id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.2">1</mn><mo id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.3"><mi id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.3.2">i</mi><mo id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.3.1">−</mo><mn id="Sx3.E4X.3.2.2.m1.1.4.7.7.3.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.E4X.3.2.2.m1.1.4.7.7.4" stretchy="false">)</mo></mrow><mo id="Sx3.E4X.3.2.2.m1.1.4.7.8" stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex" id="Sx3.E4X.3.2.2.m1.1c">\displaystyle=\sum_{i}[-\frac{N}{B}[l_{i}=0]\log p(\mathcal{A}_{i}=0|f(\textbf%
{x},\textbf{y}_{1:i-1}))</annotation><annotation encoding="application/x-llamapun" id="Sx3.E4X.3.2.2.m1.1d">= ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT [ - divide start_ARG italic_N end_ARG start_ARG italic_B end_ARG [ italic_l start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 0 ] roman_log italic_p ( caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 0 | italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="2"><span class="ltx_tag ltx_tag_equationgroup ltx_align_right">(4)</span></td>
</tr>
<tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="Sx3.E4Xa">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle-(1-\frac{N}{B})[l_{i}=1]\log p(\mathcal{A}_{i}=1|f(\textbf{x},%
\textbf{y}_{1:i-1}))]" class="ltx_math_unparsed" display="inline" id="Sx3.E4Xa.2.1.1.m1.1"><semantics id="Sx3.E4Xa.2.1.1.m1.1a"><mrow id="Sx3.E4Xa.2.1.1.m1.1b"><mo id="Sx3.E4Xa.2.1.1.m1.1.2">−</mo><mrow id="Sx3.E4Xa.2.1.1.m1.1.3"><mo id="Sx3.E4Xa.2.1.1.m1.1.3.1" stretchy="false">(</mo><mn id="Sx3.E4Xa.2.1.1.m1.1.3.2">1</mn><mo id="Sx3.E4Xa.2.1.1.m1.1.3.3">−</mo><mstyle displaystyle="true" id="Sx3.E4Xa.2.1.1.m1.1.3.4"><mfrac id="Sx3.E4Xa.2.1.1.m1.1.3.4a"><mi id="Sx3.E4Xa.2.1.1.m1.1.3.4.2">N</mi><mi id="Sx3.E4Xa.2.1.1.m1.1.3.4.3">B</mi></mfrac></mstyle><mo id="Sx3.E4Xa.2.1.1.m1.1.3.5" stretchy="false">)</mo></mrow><mrow id="Sx3.E4Xa.2.1.1.m1.1.4"><mo id="Sx3.E4Xa.2.1.1.m1.1.4.1" stretchy="false">[</mo><msub id="Sx3.E4Xa.2.1.1.m1.1.4.2"><mi id="Sx3.E4Xa.2.1.1.m1.1.4.2.2">l</mi><mi id="Sx3.E4Xa.2.1.1.m1.1.4.2.3">i</mi></msub><mo id="Sx3.E4Xa.2.1.1.m1.1.4.3">=</mo><mn id="Sx3.E4Xa.2.1.1.m1.1.4.4">1</mn><mo id="Sx3.E4Xa.2.1.1.m1.1.4.5" rspace="0.167em" stretchy="false">]</mo></mrow><mi id="Sx3.E4Xa.2.1.1.m1.1.5">log</mi><mi id="Sx3.E4Xa.2.1.1.m1.1.6">p</mi><mrow id="Sx3.E4Xa.2.1.1.m1.1.7"><mo id="Sx3.E4Xa.2.1.1.m1.1.7.1" stretchy="false">(</mo><msub id="Sx3.E4Xa.2.1.1.m1.1.7.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.E4Xa.2.1.1.m1.1.7.2.2">𝒜</mi><mi id="Sx3.E4Xa.2.1.1.m1.1.7.2.3">i</mi></msub><mo id="Sx3.E4Xa.2.1.1.m1.1.7.3">=</mo><mn id="Sx3.E4Xa.2.1.1.m1.1.7.4">1</mn><mo fence="false" id="Sx3.E4Xa.2.1.1.m1.1.7.5" rspace="0.167em" stretchy="false">|</mo><mi id="Sx3.E4Xa.2.1.1.m1.1.7.6">f</mi><mrow id="Sx3.E4Xa.2.1.1.m1.1.7.7"><mo id="Sx3.E4Xa.2.1.1.m1.1.7.7.1" stretchy="false">(</mo><mtext id="Sx3.E4Xa.2.1.1.m1.1.1">𝐱</mtext><mo id="Sx3.E4Xa.2.1.1.m1.1.7.7.2">,</mo><msub id="Sx3.E4Xa.2.1.1.m1.1.7.7.3"><mtext id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.2">𝐲</mtext><mrow id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3"><mn id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.2">1</mn><mo id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.3"><mi id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.3.2">i</mi><mo id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.3.1">−</mo><mn id="Sx3.E4Xa.2.1.1.m1.1.7.7.3.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.E4Xa.2.1.1.m1.1.7.7.4" stretchy="false">)</mo></mrow><mo id="Sx3.E4Xa.2.1.1.m1.1.7.8" stretchy="false">)</mo></mrow><mo id="Sx3.E4Xa.2.1.1.m1.1.8" stretchy="false">]</mo></mrow><annotation encoding="application/x-tex" id="Sx3.E4Xa.2.1.1.m1.1c">\displaystyle-(1-\frac{N}{B})[l_{i}=1]\log p(\mathcal{A}_{i}=1|f(\textbf{x},%
\textbf{y}_{1:i-1}))]</annotation><annotation encoding="application/x-llamapun" id="Sx3.E4Xa.2.1.1.m1.1d">- ( 1 - divide start_ARG italic_N end_ARG start_ARG italic_B end_ARG ) [ italic_l start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 1 ] roman_log italic_p ( caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 1 | italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p3">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p3.3">In Eq. <a class="ltx_ref" href="#Sx3.E4" title="4 ‣ Training Procedures ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a> <math alttext="B" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p3.1.m1.1"><semantics id="Sx3.SSx8.SSSx2.p3.1.m1.1a"><mi id="Sx3.SSx8.SSSx2.p3.1.m1.1.1" xref="Sx3.SSx8.SSSx2.p3.1.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p3.1.m1.1b"><ci id="Sx3.SSx8.SSSx2.p3.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p3.1.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p3.1.m1.1c">B</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p3.1.m1.1d">italic_B</annotation></semantics></math> is the number of the tokens in the training batch, and <math alttext="N" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p3.2.m2.1"><semantics id="Sx3.SSx8.SSSx2.p3.2.m2.1a"><mi id="Sx3.SSx8.SSSx2.p3.2.m2.1.1" xref="Sx3.SSx8.SSSx2.p3.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p3.2.m2.1b"><ci id="Sx3.SSx8.SSSx2.p3.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx2.p3.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p3.2.m2.1c">N</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p3.2.m2.1d">italic_N</annotation></semantics></math> is the number of negative samples where <math alttext="\mathcal{A}_{i}=1" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p3.3.m3.1"><semantics id="Sx3.SSx8.SSSx2.p3.3.m3.1a"><mrow id="Sx3.SSx8.SSSx2.p3.3.m3.1.1" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.cmml"><msub id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.2" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.2.cmml">𝒜</mi><mi id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.3" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.3.cmml">i</mi></msub><mo id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.1" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.1.cmml">=</mo><mn id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.3" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p3.3.m3.1b"><apply id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1"><eq id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.1"></eq><apply id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.1.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2">subscript</csymbol><ci id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.2.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.2">𝒜</ci><ci id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.3.cmml" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.2.3">𝑖</ci></apply><cn id="Sx3.SSx8.SSSx2.p3.3.m3.1.1.3.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p3.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p3.3.m3.1c">\mathcal{A}_{i}=1</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p3.3.m3.1d">caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 1</annotation></semantics></math></p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p4">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p4.2">The selector predicts each token and impacts the decoding results,
so we also want to train the network by translation loss. For each sample,
the selector selects those tokens requiring retrievals then revises their probability distributions by Eq.  <a class="ltx_ref" href="#Sx2.E2" title="2 ‣ Estimation of Probability Distribution ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a>,
the rest tokens keep their probability distributions unvaried. The final probability distribution over vocabulary <math alttext="V" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p4.1.m1.1"><semantics id="Sx3.SSx8.SSSx2.p4.1.m1.1a"><mi id="Sx3.SSx8.SSSx2.p4.1.m1.1.1" xref="Sx3.SSx8.SSSx2.p4.1.m1.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p4.1.m1.1b"><ci id="Sx3.SSx8.SSSx2.p4.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p4.1.m1.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p4.1.m1.1c">V</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p4.1.m1.1d">italic_V</annotation></semantics></math> for <math alttext="\hat{y}_{i}" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p4.2.m2.1"><semantics id="Sx3.SSx8.SSSx2.p4.2.m2.1a"><msub id="Sx3.SSx8.SSSx2.p4.2.m2.1.1" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.cmml"><mover accent="true" id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.cmml"><mi id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.2" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.2.cmml">y</mi><mo id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.1" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.1.cmml">^</mo></mover><mi id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.3" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p4.2.m2.1b"><apply id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1">subscript</csymbol><apply id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2"><ci id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.1.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.1">^</ci><ci id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.2.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.2.2">𝑦</ci></apply><ci id="Sx3.SSx8.SSSx2.p4.2.m2.1.1.3.cmml" xref="Sx3.SSx8.SSSx2.p4.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p4.2.m2.1c">\hat{y}_{i}</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p4.2.m2.1d">over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is:</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p5">
<table class="ltx_equation ltx_eqn_table" id="Sx3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})=\left\{\begin{matrix}p_{MT}%
(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})&amp;\mathcal{A}_{i}=0\\
p_{\text{{combined}}}(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})&amp;%
\mathcal{A}_{i}=1\end{matrix}\right." class="ltx_math_unparsed" display="block" id="Sx3.E5.m1.2"><semantics id="Sx3.E5.m1.2a"><mrow id="Sx3.E5.m1.2b"><mi id="Sx3.E5.m1.2.3">p</mi><mrow id="Sx3.E5.m1.2.4"><mo id="Sx3.E5.m1.2.4.1" stretchy="false">(</mo><msub id="Sx3.E5.m1.2.4.2"><mover accent="true" id="Sx3.E5.m1.2.4.2.2"><mi id="Sx3.E5.m1.2.4.2.2.2">y</mi><mo id="Sx3.E5.m1.2.4.2.2.1">^</mo></mover><mi id="Sx3.E5.m1.2.4.2.3">i</mi></msub><mo fence="false" id="Sx3.E5.m1.2.4.3" rspace="0.167em" stretchy="false">|</mo><mtext id="Sx3.E5.m1.2.2">𝐱</mtext><mo id="Sx3.E5.m1.2.4.4">,</mo><msub id="Sx3.E5.m1.2.4.5"><mover accent="true" id="Sx3.E5.m1.2.4.5.2"><mtext id="Sx3.E5.m1.2.4.5.2.2">𝐲</mtext><mo id="Sx3.E5.m1.2.4.5.2.1">^</mo></mover><mrow id="Sx3.E5.m1.2.4.5.3"><mn id="Sx3.E5.m1.2.4.5.3.2">1</mn><mo id="Sx3.E5.m1.2.4.5.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E5.m1.2.4.5.3.3"><mi id="Sx3.E5.m1.2.4.5.3.3.2">i</mi><mo id="Sx3.E5.m1.2.4.5.3.3.1">−</mo><mn id="Sx3.E5.m1.2.4.5.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.E5.m1.2.4.6" stretchy="false">)</mo></mrow><mo id="Sx3.E5.m1.2.5">=</mo><mrow id="Sx3.E5.m1.2.6"><mo id="Sx3.E5.m1.2.6.1">{</mo><mtable columnspacing="5pt" displaystyle="true" id="Sx3.E5.m1.1.1.1.1" rowspacing="0pt"><mtr id="Sx3.E5.m1.1.1.1.1a"><mtd id="Sx3.E5.m1.1.1.1.1b"><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2"><msub id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4"><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4.2">p</mi><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4.3"><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4.3.2">M</mi><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4.3.1">⁢</mo><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.4.3.3">T</mi></mrow></msub><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.3">⁢</mo><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1"><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.2" stretchy="false">(</mo><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1"><msub id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.3"><mover accent="true" id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.3.2"><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.3.2.2">y</mi><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.3.2.1">^</mo></mover><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.3.3">i</mi></msub><mo fence="false" id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.2">|</mo><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1"><mtext id="Sx3.E5.m1.1.1.1.1.1.1.1.1.1">𝐱</mtext><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.2">,</mo><msub id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1"><mover accent="true" id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.2"><mtext id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.2.2">𝐲</mtext><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.2.1">^</mo></mover><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3"><mn id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.2">1</mn><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.3"><mi id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.3.2">i</mi><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.3.1">−</mo><mn id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.1.1.1.1.3.3.3">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx3.E5.m1.1.1.1.1.2.2.2.2.2.1.3" stretchy="false">)</mo></mrow></mrow></mtd><mtd id="Sx3.E5.m1.1.1.1.1c"><mrow id="Sx3.E5.m1.1.1.1.1.2.2.3.1"><msub id="Sx3.E5.m1.1.1.1.1.2.2.3.1.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.E5.m1.1.1.1.1.2.2.3.1.2.2">𝒜</mi><mi id="Sx3.E5.m1.1.1.1.1.2.2.3.1.2.3">i</mi></msub><mo id="Sx3.E5.m1.1.1.1.1.2.2.3.1.1">=</mo><mn id="Sx3.E5.m1.1.1.1.1.2.2.3.1.3">0</mn></mrow></mtd></mtr><mtr id="Sx3.E5.m1.1.1.1.1d"><mtd id="Sx3.E5.m1.1.1.1.1e"><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2"><msub id="Sx3.E5.m1.1.1.1.1.4.4.2.2.4"><mi id="Sx3.E5.m1.1.1.1.1.4.4.2.2.4.2">p</mi><mtext id="Sx3.E5.m1.1.1.1.1.4.4.2.2.4.3">𝑐𝑜𝑚𝑏𝑖𝑛𝑒𝑑</mtext></msub><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.3">⁢</mo><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1"><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.2" stretchy="false">(</mo><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1"><msub id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.3"><mover accent="true" id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.3.2"><mi id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.3.2.2">y</mi><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.3.2.1">^</mo></mover><mi id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.3.3">i</mi></msub><mo fence="false" id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.2">|</mo><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1"><mtext id="Sx3.E5.m1.1.1.1.1.3.3.1.1.1">𝐱</mtext><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.2">,</mo><msub id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1"><mover accent="true" id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.2"><mtext id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.2.2">𝐲</mtext><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.2.1">^</mo></mover><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3"><mn id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.2">1</mn><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.3"><mi id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.3.2">i</mi><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.3.1">−</mo><mn id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.1.1.1.1.3.3.3">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx3.E5.m1.1.1.1.1.4.4.2.2.2.1.3" stretchy="false">)</mo></mrow></mrow></mtd><mtd id="Sx3.E5.m1.1.1.1.1f"><mrow id="Sx3.E5.m1.1.1.1.1.4.4.3.1"><msub id="Sx3.E5.m1.1.1.1.1.4.4.3.1.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.E5.m1.1.1.1.1.4.4.3.1.2.2">𝒜</mi><mi id="Sx3.E5.m1.1.1.1.1.4.4.3.1.2.3">i</mi></msub><mo id="Sx3.E5.m1.1.1.1.1.4.4.3.1.1">=</mo><mn id="Sx3.E5.m1.1.1.1.1.4.4.3.1.3">1</mn></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex" id="Sx3.E5.m1.2c">p(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})=\left\{\begin{matrix}p_{MT}%
(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})&amp;\mathcal{A}_{i}=0\\
p_{\text{{combined}}}(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})&amp;%
\mathcal{A}_{i}=1\end{matrix}\right.</annotation><annotation encoding="application/x-llamapun" id="Sx3.E5.m1.2d">italic_p ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) = { start_ARG start_ROW start_CELL italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) end_CELL start_CELL caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 0 end_CELL end_ROW start_ROW start_CELL italic_p start_POSTSUBSCRIPT combined end_POSTSUBSCRIPT ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) end_CELL start_CELL caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p6">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p6.1">Thus we could train the parameters by translation loss:</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p7">
<table class="ltx_equation ltx_eqn_table" id="Sx3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{2}=\sum_{i}[-\sum_{\hat{y}_{i}\in V}[y_{i}==\hat{y}_{i}]\log p(%
\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})]" class="ltx_math_unparsed" display="block" id="Sx3.E6.m1.1"><semantics id="Sx3.E6.m1.1a"><mrow id="Sx3.E6.m1.1b"><msub id="Sx3.E6.m1.1.1"><mi class="ltx_font_mathcaligraphic" id="Sx3.E6.m1.1.1.2">ℒ</mi><mn id="Sx3.E6.m1.1.1.3">2</mn></msub><mo id="Sx3.E6.m1.1.2" rspace="0.111em">=</mo><munder id="Sx3.E6.m1.1.3"><mo id="Sx3.E6.m1.1.3.2" movablelimits="false" rspace="0em">∑</mo><mi id="Sx3.E6.m1.1.3.3">i</mi></munder><mrow id="Sx3.E6.m1.1.4"><mo id="Sx3.E6.m1.1.4.1" stretchy="false">[</mo><mo id="Sx3.E6.m1.1.4.2" lspace="0em" rspace="0.055em">−</mo><munder id="Sx3.E6.m1.1.4.3"><mo id="Sx3.E6.m1.1.4.3.2" movablelimits="false" rspace="0em">∑</mo><mrow id="Sx3.E6.m1.1.4.3.3"><msub id="Sx3.E6.m1.1.4.3.3.2"><mover accent="true" id="Sx3.E6.m1.1.4.3.3.2.2"><mi id="Sx3.E6.m1.1.4.3.3.2.2.2">y</mi><mo id="Sx3.E6.m1.1.4.3.3.2.2.1">^</mo></mover><mi id="Sx3.E6.m1.1.4.3.3.2.3">i</mi></msub><mo id="Sx3.E6.m1.1.4.3.3.1">∈</mo><mi id="Sx3.E6.m1.1.4.3.3.3">V</mi></mrow></munder><mrow id="Sx3.E6.m1.1.4.4"><mo id="Sx3.E6.m1.1.4.4.1" stretchy="false">[</mo><msub id="Sx3.E6.m1.1.4.4.2"><mi id="Sx3.E6.m1.1.4.4.2.2">y</mi><mi id="Sx3.E6.m1.1.4.4.2.3">i</mi></msub><mo id="Sx3.E6.m1.1.4.4.3" rspace="0em">=</mo><mo id="Sx3.E6.m1.1.4.4.4" lspace="0em">=</mo><msub id="Sx3.E6.m1.1.4.4.5"><mover accent="true" id="Sx3.E6.m1.1.4.4.5.2"><mi id="Sx3.E6.m1.1.4.4.5.2.2">y</mi><mo id="Sx3.E6.m1.1.4.4.5.2.1">^</mo></mover><mi id="Sx3.E6.m1.1.4.4.5.3">i</mi></msub><mo id="Sx3.E6.m1.1.4.4.6" rspace="0.167em" stretchy="false">]</mo></mrow><mi id="Sx3.E6.m1.1.4.5">log</mi><mi id="Sx3.E6.m1.1.4.6">p</mi><mrow id="Sx3.E6.m1.1.4.7"><mo id="Sx3.E6.m1.1.4.7.1" stretchy="false">(</mo><msub id="Sx3.E6.m1.1.4.7.2"><mover accent="true" id="Sx3.E6.m1.1.4.7.2.2"><mi id="Sx3.E6.m1.1.4.7.2.2.2">y</mi><mo id="Sx3.E6.m1.1.4.7.2.2.1">^</mo></mover><mi id="Sx3.E6.m1.1.4.7.2.3">i</mi></msub><mo fence="false" id="Sx3.E6.m1.1.4.7.3" rspace="0.167em" stretchy="false">|</mo><mtext id="Sx3.E6.m1.1.4.7.4">𝐱</mtext><mo id="Sx3.E6.m1.1.4.7.5">,</mo><msub id="Sx3.E6.m1.1.4.7.6"><mover accent="true" id="Sx3.E6.m1.1.4.7.6.2"><mtext id="Sx3.E6.m1.1.4.7.6.2.2">𝐲</mtext><mo id="Sx3.E6.m1.1.4.7.6.2.1">^</mo></mover><mrow id="Sx3.E6.m1.1.4.7.6.3"><mn id="Sx3.E6.m1.1.4.7.6.3.2">1</mn><mo id="Sx3.E6.m1.1.4.7.6.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.E6.m1.1.4.7.6.3.3"><mi id="Sx3.E6.m1.1.4.7.6.3.3.2">i</mi><mo id="Sx3.E6.m1.1.4.7.6.3.3.1">−</mo><mn id="Sx3.E6.m1.1.4.7.6.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.E6.m1.1.4.7.7" stretchy="false">)</mo></mrow><mo id="Sx3.E6.m1.1.4.8" stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="Sx3.E6.m1.1c">\mathcal{L}_{2}=\sum_{i}[-\sum_{\hat{y}_{i}\in V}[y_{i}==\hat{y}_{i}]\log p(%
\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})]</annotation><annotation encoding="application/x-llamapun" id="Sx3.E6.m1.1d">caligraphic_L start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT [ - ∑ start_POSTSUBSCRIPT over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_V end_POSTSUBSCRIPT [ italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = = over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] roman_log italic_p ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p8">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p8.1">And the final loss:</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p9">
<table class="ltx_equation ltx_eqn_table" id="Sx3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}=\frac{\mathcal{L}_{1}}{N}+\frac{\mathcal{L}_{2}}{N}" class="ltx_Math" display="block" id="Sx3.E7.m1.1"><semantics id="Sx3.E7.m1.1a"><mrow id="Sx3.E7.m1.1.1" xref="Sx3.E7.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E7.m1.1.1.2" xref="Sx3.E7.m1.1.1.2.cmml">ℒ</mi><mo id="Sx3.E7.m1.1.1.1" xref="Sx3.E7.m1.1.1.1.cmml">=</mo><mrow id="Sx3.E7.m1.1.1.3" xref="Sx3.E7.m1.1.1.3.cmml"><mfrac id="Sx3.E7.m1.1.1.3.2" xref="Sx3.E7.m1.1.1.3.2.cmml"><msub id="Sx3.E7.m1.1.1.3.2.2" xref="Sx3.E7.m1.1.1.3.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E7.m1.1.1.3.2.2.2" xref="Sx3.E7.m1.1.1.3.2.2.2.cmml">ℒ</mi><mn id="Sx3.E7.m1.1.1.3.2.2.3" xref="Sx3.E7.m1.1.1.3.2.2.3.cmml">1</mn></msub><mi id="Sx3.E7.m1.1.1.3.2.3" xref="Sx3.E7.m1.1.1.3.2.3.cmml">N</mi></mfrac><mo id="Sx3.E7.m1.1.1.3.1" xref="Sx3.E7.m1.1.1.3.1.cmml">+</mo><mfrac id="Sx3.E7.m1.1.1.3.3" xref="Sx3.E7.m1.1.1.3.3.cmml"><msub id="Sx3.E7.m1.1.1.3.3.2" xref="Sx3.E7.m1.1.1.3.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E7.m1.1.1.3.3.2.2" xref="Sx3.E7.m1.1.1.3.3.2.2.cmml">ℒ</mi><mn id="Sx3.E7.m1.1.1.3.3.2.3" xref="Sx3.E7.m1.1.1.3.3.2.3.cmml">2</mn></msub><mi id="Sx3.E7.m1.1.1.3.3.3" xref="Sx3.E7.m1.1.1.3.3.3.cmml">N</mi></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.E7.m1.1b"><apply id="Sx3.E7.m1.1.1.cmml" xref="Sx3.E7.m1.1.1"><eq id="Sx3.E7.m1.1.1.1.cmml" xref="Sx3.E7.m1.1.1.1"></eq><ci id="Sx3.E7.m1.1.1.2.cmml" xref="Sx3.E7.m1.1.1.2">ℒ</ci><apply id="Sx3.E7.m1.1.1.3.cmml" xref="Sx3.E7.m1.1.1.3"><plus id="Sx3.E7.m1.1.1.3.1.cmml" xref="Sx3.E7.m1.1.1.3.1"></plus><apply id="Sx3.E7.m1.1.1.3.2.cmml" xref="Sx3.E7.m1.1.1.3.2"><divide id="Sx3.E7.m1.1.1.3.2.1.cmml" xref="Sx3.E7.m1.1.1.3.2"></divide><apply id="Sx3.E7.m1.1.1.3.2.2.cmml" xref="Sx3.E7.m1.1.1.3.2.2"><csymbol cd="ambiguous" id="Sx3.E7.m1.1.1.3.2.2.1.cmml" xref="Sx3.E7.m1.1.1.3.2.2">subscript</csymbol><ci id="Sx3.E7.m1.1.1.3.2.2.2.cmml" xref="Sx3.E7.m1.1.1.3.2.2.2">ℒ</ci><cn id="Sx3.E7.m1.1.1.3.2.2.3.cmml" type="integer" xref="Sx3.E7.m1.1.1.3.2.2.3">1</cn></apply><ci id="Sx3.E7.m1.1.1.3.2.3.cmml" xref="Sx3.E7.m1.1.1.3.2.3">𝑁</ci></apply><apply id="Sx3.E7.m1.1.1.3.3.cmml" xref="Sx3.E7.m1.1.1.3.3"><divide id="Sx3.E7.m1.1.1.3.3.1.cmml" xref="Sx3.E7.m1.1.1.3.3"></divide><apply id="Sx3.E7.m1.1.1.3.3.2.cmml" xref="Sx3.E7.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="Sx3.E7.m1.1.1.3.3.2.1.cmml" xref="Sx3.E7.m1.1.1.3.3.2">subscript</csymbol><ci id="Sx3.E7.m1.1.1.3.3.2.2.cmml" xref="Sx3.E7.m1.1.1.3.3.2.2">ℒ</ci><cn id="Sx3.E7.m1.1.1.3.3.2.3.cmml" type="integer" xref="Sx3.E7.m1.1.1.3.3.2.3">2</cn></apply><ci id="Sx3.E7.m1.1.1.3.3.3.cmml" xref="Sx3.E7.m1.1.1.3.3.3">𝑁</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.E7.m1.1c">\mathcal{L}=\frac{\mathcal{L}_{1}}{N}+\frac{\mathcal{L}_{2}}{N}</annotation><annotation encoding="application/x-llamapun" id="Sx3.E7.m1.1d">caligraphic_L = divide start_ARG caligraphic_L start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_ARG start_ARG italic_N end_ARG + divide start_ARG caligraphic_L start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_ARG start_ARG italic_N end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p10">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p10.1">Where N is the total number of tokens in the training batch, the entire training procedure is shown in figure  <a class="ltx_ref" href="#Sx3.F3" title="Figure 3 ‣ Our Mehtod ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a>.</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p11">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p11.1">Another problem is to determine</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p12">
<table class="ltx_equation ltx_eqn_table" id="Sx3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{A}_{i}=\mathrm{argmax}_{\mathcal{A}}p(\mathcal{A}|f(\textbf{x},%
\textbf{y}_{1:i-1})),\mathcal{A}\in\{0,1\}" class="ltx_Math" display="block" id="Sx3.E8.m1.5"><semantics id="Sx3.E8.m1.5a"><mrow id="Sx3.E8.m1.5.5.2" xref="Sx3.E8.m1.5.5.3.cmml"><mrow id="Sx3.E8.m1.4.4.1.1" xref="Sx3.E8.m1.4.4.1.1.cmml"><msub id="Sx3.E8.m1.4.4.1.1.3" xref="Sx3.E8.m1.4.4.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E8.m1.4.4.1.1.3.2" xref="Sx3.E8.m1.4.4.1.1.3.2.cmml">𝒜</mi><mi id="Sx3.E8.m1.4.4.1.1.3.3" xref="Sx3.E8.m1.4.4.1.1.3.3.cmml">i</mi></msub><mo id="Sx3.E8.m1.4.4.1.1.2" xref="Sx3.E8.m1.4.4.1.1.2.cmml">=</mo><mrow id="Sx3.E8.m1.4.4.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.cmml"><msub id="Sx3.E8.m1.4.4.1.1.1.3" xref="Sx3.E8.m1.4.4.1.1.1.3.cmml"><mi id="Sx3.E8.m1.4.4.1.1.1.3.2" xref="Sx3.E8.m1.4.4.1.1.1.3.2.cmml">argmax</mi><mi class="ltx_font_mathcaligraphic" id="Sx3.E8.m1.4.4.1.1.1.3.3" xref="Sx3.E8.m1.4.4.1.1.1.3.3.cmml">𝒜</mi></msub><mo id="Sx3.E8.m1.4.4.1.1.1.2" xref="Sx3.E8.m1.4.4.1.1.1.2.cmml">⁢</mo><mi id="Sx3.E8.m1.4.4.1.1.1.4" xref="Sx3.E8.m1.4.4.1.1.1.4.cmml">p</mi><mo id="Sx3.E8.m1.4.4.1.1.1.2a" xref="Sx3.E8.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.cmml"><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.cmml">(</mo><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E8.m1.4.4.1.1.1.1.1.1.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.3.cmml">𝒜</mi><mo fence="false" id="Sx3.E8.m1.4.4.1.1.1.1.1.1.2" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.2.cmml">|</mo><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.cmml"><mi id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.3.cmml">f</mi><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.2" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.2.cmml"><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">(</mo><mtext id="Sx3.E8.m1.1.1" xref="Sx3.E8.m1.1.1a.cmml">𝐱</mtext><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml"><mtext id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2a.cmml">𝐲</mtext><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml"><mn id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.2" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.2" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.1" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.3" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="Sx3.E8.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="Sx3.E8.m1.5.5.2.3" xref="Sx3.E8.m1.5.5.3a.cmml">,</mo><mrow id="Sx3.E8.m1.5.5.2.2" xref="Sx3.E8.m1.5.5.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="Sx3.E8.m1.5.5.2.2.2" xref="Sx3.E8.m1.5.5.2.2.2.cmml">𝒜</mi><mo id="Sx3.E8.m1.5.5.2.2.1" xref="Sx3.E8.m1.5.5.2.2.1.cmml">∈</mo><mrow id="Sx3.E8.m1.5.5.2.2.3.2" xref="Sx3.E8.m1.5.5.2.2.3.1.cmml"><mo id="Sx3.E8.m1.5.5.2.2.3.2.1" stretchy="false" xref="Sx3.E8.m1.5.5.2.2.3.1.cmml">{</mo><mn id="Sx3.E8.m1.2.2" xref="Sx3.E8.m1.2.2.cmml">0</mn><mo id="Sx3.E8.m1.5.5.2.2.3.2.2" xref="Sx3.E8.m1.5.5.2.2.3.1.cmml">,</mo><mn id="Sx3.E8.m1.3.3" xref="Sx3.E8.m1.3.3.cmml">1</mn><mo id="Sx3.E8.m1.5.5.2.2.3.2.3" stretchy="false" xref="Sx3.E8.m1.5.5.2.2.3.1.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.E8.m1.5b"><apply id="Sx3.E8.m1.5.5.3.cmml" xref="Sx3.E8.m1.5.5.2"><csymbol cd="ambiguous" id="Sx3.E8.m1.5.5.3a.cmml" xref="Sx3.E8.m1.5.5.2.3">formulae-sequence</csymbol><apply id="Sx3.E8.m1.4.4.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1"><eq id="Sx3.E8.m1.4.4.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.2"></eq><apply id="Sx3.E8.m1.4.4.1.1.3.cmml" xref="Sx3.E8.m1.4.4.1.1.3"><csymbol cd="ambiguous" id="Sx3.E8.m1.4.4.1.1.3.1.cmml" xref="Sx3.E8.m1.4.4.1.1.3">subscript</csymbol><ci id="Sx3.E8.m1.4.4.1.1.3.2.cmml" xref="Sx3.E8.m1.4.4.1.1.3.2">𝒜</ci><ci id="Sx3.E8.m1.4.4.1.1.3.3.cmml" xref="Sx3.E8.m1.4.4.1.1.3.3">𝑖</ci></apply><apply id="Sx3.E8.m1.4.4.1.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1"><times id="Sx3.E8.m1.4.4.1.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.2"></times><apply id="Sx3.E8.m1.4.4.1.1.1.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.3"><csymbol cd="ambiguous" id="Sx3.E8.m1.4.4.1.1.1.3.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.3">subscript</csymbol><ci id="Sx3.E8.m1.4.4.1.1.1.3.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.3.2">argmax</ci><ci id="Sx3.E8.m1.4.4.1.1.1.3.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.3.3">𝒜</ci></apply><ci id="Sx3.E8.m1.4.4.1.1.1.4.cmml" xref="Sx3.E8.m1.4.4.1.1.1.4">𝑝</ci><apply id="Sx3.E8.m1.4.4.1.1.1.1.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="Sx3.E8.m1.4.4.1.1.1.1.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.2">conditional</csymbol><ci id="Sx3.E8.m1.4.4.1.1.1.1.1.1.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.3">𝒜</ci><apply id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1"><times id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.2"></times><ci id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.3">𝑓</ci><interval closure="open" id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1"><ci id="Sx3.E8.m1.1.1a.cmml" xref="Sx3.E8.m1.1.1"><mtext id="Sx3.E8.m1.1.1.cmml" xref="Sx3.E8.m1.1.1">𝐱</mtext></ci><apply id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2a.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2"><mtext id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.2">𝐲</mtext></ci><apply id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3"><ci id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.1">:</ci><cn id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.2">1</cn><apply id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3"><minus id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx3.E8.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></apply></apply></apply><apply id="Sx3.E8.m1.5.5.2.2.cmml" xref="Sx3.E8.m1.5.5.2.2"><in id="Sx3.E8.m1.5.5.2.2.1.cmml" xref="Sx3.E8.m1.5.5.2.2.1"></in><ci id="Sx3.E8.m1.5.5.2.2.2.cmml" xref="Sx3.E8.m1.5.5.2.2.2">𝒜</ci><set id="Sx3.E8.m1.5.5.2.2.3.1.cmml" xref="Sx3.E8.m1.5.5.2.2.3.2"><cn id="Sx3.E8.m1.2.2.cmml" type="integer" xref="Sx3.E8.m1.2.2">0</cn><cn id="Sx3.E8.m1.3.3.cmml" type="integer" xref="Sx3.E8.m1.3.3">1</cn></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.E8.m1.5c">\mathcal{A}_{i}=\mathrm{argmax}_{\mathcal{A}}p(\mathcal{A}|f(\textbf{x},%
\textbf{y}_{1:i-1})),\mathcal{A}\in\{0,1\}</annotation><annotation encoding="application/x-llamapun" id="Sx3.E8.m1.5d">caligraphic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = roman_argmax start_POSTSUBSCRIPT caligraphic_A end_POSTSUBSCRIPT italic_p ( caligraphic_A | italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ) , caligraphic_A ∈ { 0 , 1 }</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p13">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p13.1">Undifferentiable argmax operation is used to address gradient intercept issues,
we use the gumbel-softmax <cite class="ltx_cite ltx_citemacro_citep">(Jang, Gu, and Poole <a class="ltx_ref" href="#bib.bib9" title="">2016</a>)</cite> trick to approximate a gradient for the argmax operation as follows:</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p14">
<table class="ltx_equationgroup ltx_eqn_table" id="Sx3.Ex2">
<tbody id="Sx3.Ex2X"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle G\approx" class="ltx_Math" display="inline" id="Sx3.Ex2X.2.1.1.m1.1"><semantics id="Sx3.Ex2X.2.1.1.m1.1a"><mrow id="Sx3.Ex2X.2.1.1.m1.1.1" xref="Sx3.Ex2X.2.1.1.m1.1.1.cmml"><mi id="Sx3.Ex2X.2.1.1.m1.1.1.2" xref="Sx3.Ex2X.2.1.1.m1.1.1.2.cmml">G</mi><mo id="Sx3.Ex2X.2.1.1.m1.1.1.1" xref="Sx3.Ex2X.2.1.1.m1.1.1.1.cmml">≈</mo><mi id="Sx3.Ex2X.2.1.1.m1.1.1.3" xref="Sx3.Ex2X.2.1.1.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="Sx3.Ex2X.2.1.1.m1.1b"><apply id="Sx3.Ex2X.2.1.1.m1.1.1.cmml" xref="Sx3.Ex2X.2.1.1.m1.1.1"><approx id="Sx3.Ex2X.2.1.1.m1.1.1.1.cmml" xref="Sx3.Ex2X.2.1.1.m1.1.1.1"></approx><ci id="Sx3.Ex2X.2.1.1.m1.1.1.2.cmml" xref="Sx3.Ex2X.2.1.1.m1.1.1.2">𝐺</ci><csymbol cd="latexml" id="Sx3.Ex2X.2.1.1.m1.1.1.3.cmml" xref="Sx3.Ex2X.2.1.1.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.Ex2X.2.1.1.m1.1c">\displaystyle G\approx</annotation><annotation encoding="application/x-llamapun" id="Sx3.Ex2X.2.1.1.m1.1d">italic_G ≈</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="Sx3.Ex2Xa"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\nabla_{W}\frac{\exp((\log p(\mathcal{A}|f(\textbf{x},\textbf{y}_%
{1:i-1});W))+g_{m}(\mathcal{A}^{\prime}))/\tau)}{\sum\limits_{\mathcal{A}^{%
\prime}\in\{0,1\}}\exp((\log p(\mathcal{A}^{\prime}|f(\textbf{x},\textbf{y}_{1%
:i-1});W))+g_{m}(\mathcal{A}^{\prime}))/\tau)}" class="ltx_math_unparsed" display="inline" id="Sx3.Ex2Xa.2.1.1.m1.8"><semantics id="Sx3.Ex2Xa.2.1.1.m1.8a"><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.9"><msub id="Sx3.Ex2Xa.2.1.1.m1.8.9.1"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.9.1.2">∇</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.8.9.1.3">W</mi></msub><mstyle displaystyle="true" id="Sx3.Ex2Xa.2.1.1.m1.8.8"><mfrac id="Sx3.Ex2Xa.2.1.1.m1.8.8a"><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3"><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.3">exp</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4"><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.1" stretchy="false">(</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2"><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.1" stretchy="false">(</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.2">log</mi><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.3">p</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4"><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.1" stretchy="false">(</mo><mi class="ltx_font_mathcaligraphic" id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.2">𝒜</mi><mo fence="false" id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.3" rspace="0.167em" stretchy="false">|</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.4">f</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5"><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.1" stretchy="false">(</mo><mtext id="Sx3.Ex2Xa.2.1.1.m1.1.1.1.1">𝐱</mtext><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.2">,</mo><msub id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3"><mtext id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.2">𝐲</mtext><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3"><mn id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.2">1</mn><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.3"><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.3.2">i</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.3.1">−</mo><mn id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.3.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.5.4" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.6">;</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.2.2.2.2">W</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.4.7" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.2.5" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.3">+</mo><msub id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.4"><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.4.2">g</mi><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.4.3">m</mi></msub><mrow id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5"><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5.1" stretchy="false">(</mo><msup id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5.2.2">𝒜</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5.2.3">′</mo></msup><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.5.3" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.4.6" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.5">/</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.6">τ</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.3.3.3.7" stretchy="false">)</mo></mrow><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8"><munder id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.6"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.6.2" movablelimits="false">∑</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2"><msup id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.4"><mi class="ltx_font_mathcaligraphic" id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.4.2">𝒜</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.4.3">′</mo></msup><mo id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.3">∈</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.5.2"><mo id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.5.2.1" stretchy="false">{</mo><mn id="Sx3.Ex2Xa.2.1.1.m1.4.4.4.1.1.1">0</mn><mo id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.5.2.2">,</mo><mn id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.2">1</mn><mo id="Sx3.Ex2Xa.2.1.1.m1.5.5.5.2.2.5.2.3" stretchy="false">}</mo></mrow></mrow></munder><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.5">exp</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.1" stretchy="false">(</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.1" stretchy="false">(</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.2">log</mi><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.3">p</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.1" stretchy="false">(</mo><msup id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.2.2">𝒜</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.2.3">′</mo></msup><mo fence="false" id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.3" rspace="0.167em" stretchy="false">|</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.4">f</mi><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.1" stretchy="false">(</mo><mtext id="Sx3.Ex2Xa.2.1.1.m1.6.6.6.3">𝐱</mtext><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.2">,</mo><msub id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3"><mtext id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.2">𝐲</mtext><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3"><mn id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.2">1</mn><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.1" lspace="0.278em" rspace="0.278em">:</mo><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.3"><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.3.2">i</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.3.1">−</mo><mn id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.3.3.3.3">1</mn></mrow></mrow></msub><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.5.4" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.6">;</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.7.7.7.4">W</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.4.7" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.2.5" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.3">+</mo><msub id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.4"><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.4.2">g</mi><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.4.3">m</mi></msub><mrow id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5"><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5.1" stretchy="false">(</mo><msup id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5.2"><mi class="ltx_font_mathcaligraphic" id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5.2.2">𝒜</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5.2.3">′</mo></msup><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.5.3" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.7.6" stretchy="false">)</mo></mrow><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.8">/</mo><mi id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.9">τ</mi><mo id="Sx3.Ex2Xa.2.1.1.m1.8.8.8.10" stretchy="false">)</mo></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex" id="Sx3.Ex2Xa.2.1.1.m1.8b">\displaystyle\nabla_{W}\frac{\exp((\log p(\mathcal{A}|f(\textbf{x},\textbf{y}_%
{1:i-1});W))+g_{m}(\mathcal{A}^{\prime}))/\tau)}{\sum\limits_{\mathcal{A}^{%
\prime}\in\{0,1\}}\exp((\log p(\mathcal{A}^{\prime}|f(\textbf{x},\textbf{y}_{1%
:i-1});W))+g_{m}(\mathcal{A}^{\prime}))/\tau)}</annotation><annotation encoding="application/x-llamapun" id="Sx3.Ex2Xa.2.1.1.m1.8c">∇ start_POSTSUBSCRIPT italic_W end_POSTSUBSCRIPT divide start_ARG roman_exp ( ( roman_log italic_p ( caligraphic_A | italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ; italic_W ) ) + italic_g start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT ( caligraphic_A start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ) ) / italic_τ ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT caligraphic_A start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ { 0 , 1 } end_POSTSUBSCRIPT roman_exp ( ( roman_log italic_p ( caligraphic_A start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT | italic_f ( x , y start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) ; italic_W ) ) + italic_g start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT ( caligraphic_A start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ) ) / italic_τ ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx2.p15">
<p class="ltx_p" id="Sx3.SSx8.SSSx2.p15.4">Where <math alttext="W" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p15.1.m1.1"><semantics id="Sx3.SSx8.SSSx2.p15.1.m1.1a"><mi id="Sx3.SSx8.SSSx2.p15.1.m1.1.1" xref="Sx3.SSx8.SSSx2.p15.1.m1.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p15.1.m1.1b"><ci id="Sx3.SSx8.SSSx2.p15.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p15.1.m1.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p15.1.m1.1c">W</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p15.1.m1.1d">italic_W</annotation></semantics></math> is the inner trainable parameters of the selector,
and <math alttext="g_{m}=-\log(-\log(u))" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p15.2.m2.4"><semantics id="Sx3.SSx8.SSSx2.p15.2.m2.4a"><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.cmml"><msub id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.cmml"><mi id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.2" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.2.cmml">g</mi><mi id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.3" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.3.cmml">m</mi></msub><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.2" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.2.cmml">=</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.cmml"><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1a" rspace="0.167em" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.cmml">−</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml"><mi id="Sx3.SSx8.SSSx2.p15.2.m2.3.3" xref="Sx3.SSx8.SSSx2.p15.2.m2.3.3.cmml">log</mi><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1a" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml">⁡</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml"><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.2" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml">(</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.cmml"><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1a" rspace="0.167em" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.cmml">−</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml"><mi id="Sx3.SSx8.SSSx2.p15.2.m2.1.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.1.1.cmml">log</mi><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2a" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml">⁡</mo><mrow id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2.1" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml"><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2.1.1" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml">(</mo><mi id="Sx3.SSx8.SSSx2.p15.2.m2.2.2" xref="Sx3.SSx8.SSSx2.p15.2.m2.2.2.cmml">u</mi><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2.1.2" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml">)</mo></mrow></mrow></mrow><mo id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.3" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p15.2.m2.4b"><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4"><eq id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.2.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.2"></eq><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3"><csymbol cd="ambiguous" id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3">subscript</csymbol><ci id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.2.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.2">𝑔</ci><ci id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.3.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.3.3">𝑚</ci></apply><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1"><minus id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.2.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1"></minus><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.2.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1"><log id="Sx3.SSx8.SSSx2.p15.2.m2.3.3.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.3.3"></log><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1"><minus id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1"></minus><apply id="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.4.4.1.1.1.1.1.2.2"><log id="Sx3.SSx8.SSSx2.p15.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.1.1"></log><ci id="Sx3.SSx8.SSSx2.p15.2.m2.2.2.cmml" xref="Sx3.SSx8.SSSx2.p15.2.m2.2.2">𝑢</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p15.2.m2.4c">g_{m}=-\log(-\log(u))</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p15.2.m2.4d">italic_g start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT = - roman_log ( - roman_log ( italic_u ) )</annotation></semantics></math> with <math alttext="u\sim U(0,1)" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p15.3.m3.2"><semantics id="Sx3.SSx8.SSSx2.p15.3.m3.2a"><mrow id="Sx3.SSx8.SSSx2.p15.3.m3.2.3" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.cmml"><mi id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.2" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.2.cmml">u</mi><mo id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.1" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.1.cmml">∼</mo><mrow id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.cmml"><mi id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.2" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.2.cmml">U</mi><mo id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.1" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.1.cmml">⁢</mo><mrow id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.2" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.1.cmml"><mo id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.2.1" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.1.cmml">(</mo><mn id="Sx3.SSx8.SSSx2.p15.3.m3.1.1" xref="Sx3.SSx8.SSSx2.p15.3.m3.1.1.cmml">0</mn><mo id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.2.2" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.1.cmml">,</mo><mn id="Sx3.SSx8.SSSx2.p15.3.m3.2.2" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.2.cmml">1</mn><mo id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.2.3" stretchy="false" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p15.3.m3.2b"><apply id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3"><csymbol cd="latexml" id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.1.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.1">similar-to</csymbol><ci id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.2.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.2">𝑢</ci><apply id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3"><times id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.1.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.1"></times><ci id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.2.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.2">𝑈</ci><interval closure="open" id="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.1.cmml" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.3.3.3.2"><cn id="Sx3.SSx8.SSSx2.p15.3.m3.1.1.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p15.3.m3.1.1">0</cn><cn id="Sx3.SSx8.SSSx2.p15.3.m3.2.2.cmml" type="integer" xref="Sx3.SSx8.SSSx2.p15.3.m3.2.2">1</cn></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p15.3.m3.2c">u\sim U(0,1)</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p15.3.m3.2d">italic_u ∼ italic_U ( 0 , 1 )</annotation></semantics></math>, <math alttext="\tau" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx2.p15.4.m4.1"><semantics id="Sx3.SSx8.SSSx2.p15.4.m4.1a"><mi id="Sx3.SSx8.SSSx2.p15.4.m4.1.1" xref="Sx3.SSx8.SSSx2.p15.4.m4.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx2.p15.4.m4.1b"><ci id="Sx3.SSx8.SSSx2.p15.4.m4.1.1.cmml" xref="Sx3.SSx8.SSSx2.p15.4.m4.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx2.p15.4.m4.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx2.p15.4.m4.1d">italic_τ</annotation></semantics></math> is the temperature hyper-parameter.</p>
</div>
</section>
<section class="ltx_subsubsection" id="Sx3.SSx8.SSSx3">
<h4 class="ltx_title ltx_title_subsubsection">Metrics</h4>
<div class="ltx_para" id="Sx3.SSx8.SSSx3.p1">
<p class="ltx_p" id="Sx3.SSx8.SSSx3.p1.1">To evaluate our method, we use the following metrics.
The time is measured three times and averaged.</p>
</div>
<div class="ltx_para" id="Sx3.SSx8.SSSx3.p2">
<ul class="ltx_itemize" id="Sx3.I3">
<li class="ltx_item" id="Sx3.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i1.p1">
<p class="ltx_p" id="Sx3.I3.i1.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i1.p1.1.1">Sacre-BLEU</span>  <cite class="ltx_cite ltx_citemacro_citep">(Post <a class="ltx_ref" href="#bib.bib25" title="">2018</a>)</cite> is the recommended by WMT to be the evaluating metrics.</p>
</div>
</li>
<li class="ltx_item" id="Sx3.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i2.p1">
<p class="ltx_p" id="Sx3.I3.i2.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i2.p1.1.1">Inference time</span>: The total time consumed for the neural model, selector(if exists) and <math alttext="k" class="ltx_Math" display="inline" id="Sx3.I3.i2.p1.1.m1.1"><semantics id="Sx3.I3.i2.p1.1.m1.1a"><mi id="Sx3.I3.i2.p1.1.m1.1.1" xref="Sx3.I3.i2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.I3.i2.p1.1.m1.1b"><ci id="Sx3.I3.i2.p1.1.m1.1.1.cmml" xref="Sx3.I3.i2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.I3.i2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.I3.i2.p1.1.m1.1d">italic_k</annotation></semantics></math>NN to translate all testing sequences.</p>
</div>
</li>
<li class="ltx_item" id="Sx3.I3.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i3.p1">
<p class="ltx_p" id="Sx3.I3.i3.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i3.p1.1.1">KNN overhead time</span>: A time composed of selector prediction, <math alttext="k" class="ltx_Math" display="inline" id="Sx3.I3.i3.p1.1.m1.1"><semantics id="Sx3.I3.i3.p1.1.m1.1a"><mi id="Sx3.I3.i3.p1.1.m1.1.1" xref="Sx3.I3.i3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.I3.i3.p1.1.m1.1b"><ci id="Sx3.I3.i3.p1.1.m1.1.1.cmml" xref="Sx3.I3.i3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.I3.i3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.I3.i3.p1.1.m1.1d">italic_k</annotation></semantics></math>NN retrievals and probability distribution revision. It is also a part contained in the total inference time.
The reason why we do not only use inference time or tokens per second metrics but also measure this indicator is discussed later.</p>
</div>
</li>
<li class="ltx_item" id="Sx3.I3.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i4.p1">
<p class="ltx_p" id="Sx3.I3.i4.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i4.p1.1.1">Tokens per second</span> The average tokens translated per second.
</p>
</div>
</li>
<li class="ltx_item" id="Sx3.I3.i5" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i5.p1">
<p class="ltx_p" id="Sx3.I3.i5.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i5.p1.1.1">Precision</span> and <span class="ltx_text ltx_font_bold" id="Sx3.I3.i5.p1.1.2">Recall</span>: We dictate that samples requiring retrievals are positive and others are negative. Therefore higher precision index indicates less futile retrievals and is closer to the speed of the pure NMT model. A high recall index means approaching full retrievals on <math alttext="k" class="ltx_Math" display="inline" id="Sx3.I3.i5.p1.1.m1.1"><semantics id="Sx3.I3.i5.p1.1.m1.1a"><mi id="Sx3.I3.i5.p1.1.m1.1.1" xref="Sx3.I3.i5.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.I3.i5.p1.1.m1.1b"><ci id="Sx3.I3.i5.p1.1.m1.1.1.cmml" xref="Sx3.I3.i5.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.I3.i5.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.I3.i5.p1.1.m1.1d">italic_k</annotation></semantics></math>NN and better translation quality.</p>
</div>
</li>
<li class="ltx_item" id="Sx3.I3.i6" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx3.I3.i6.p1">
<p class="ltx_p" id="Sx3.I3.i6.p1.1"><span class="ltx_text ltx_font_bold" id="Sx3.I3.i6.p1.1.1">Ratrieving ratio</span>: Besides, we introduce a new metric retrieving ratio for the selector, it is the ratio of tokens predicted not to retrieve to the total number of tokens.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_subsubsection" id="Sx3.SSx8.SSSx4">
<h4 class="ltx_title ltx_title_subsubsection">Integration</h4>
<div class="ltx_para" id="Sx3.SSx8.SSSx4.p1">
<p class="ltx_p" id="Sx3.SSx8.SSSx4.p1.3">Our selector could be integrated into any other
<math alttext="k" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx4.p1.1.m1.1"><semantics id="Sx3.SSx8.SSSx4.p1.1.m1.1a"><mi id="Sx3.SSx8.SSSx4.p1.1.m1.1.1" xref="Sx3.SSx8.SSSx4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx4.p1.1.m1.1b"><ci id="Sx3.SSx8.SSSx4.p1.1.m1.1.1.cmml" xref="Sx3.SSx8.SSSx4.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx4.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT systems by training the selector and
save its weights on vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx4.p1.2.m2.1"><semantics id="Sx3.SSx8.SSSx4.p1.2.m2.1a"><mi id="Sx3.SSx8.SSSx4.p1.2.m2.1.1" xref="Sx3.SSx8.SSSx4.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx4.p1.2.m2.1b"><ci id="Sx3.SSx8.SSSx4.p1.2.m2.1.1.cmml" xref="Sx3.SSx8.SSSx4.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx4.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx4.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT then loading it in any <math alttext="k" class="ltx_Math" display="inline" id="Sx3.SSx8.SSSx4.p1.3.m3.1"><semantics id="Sx3.SSx8.SSSx4.p1.3.m3.1a"><mi id="Sx3.SSx8.SSSx4.p1.3.m3.1.1" xref="Sx3.SSx8.SSSx4.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.SSx8.SSSx4.p1.3.m3.1b"><ci id="Sx3.SSx8.SSSx4.p1.3.m3.1.1.cmml" xref="Sx3.SSx8.SSSx4.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.SSx8.SSSx4.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.SSx8.SSSx4.p1.3.m3.1d">italic_k</annotation></semantics></math>NN-MT variants.
The procedure could be described as pseudo shown in algorithm  <a class="ltx_ref" href="#alg1" title="Algorithm 1 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.11.1.1">Algorithm 1</span> </span> Integrating the selector into <math alttext="k" class="ltx_Math" display="inline" id="alg1.2.m1.1"><semantics id="alg1.2.m1.1b"><mi id="alg1.2.m1.1.1" xref="alg1.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="alg1.2.m1.1c"><ci id="alg1.2.m1.1.1.cmml" xref="alg1.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.2.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="alg1.2.m1.1e">italic_k</annotation></semantics></math>NN-MT systems</figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_cell">
<p class="ltx_p" id="alg1.9"><span class="ltx_text ltx_font_bold" id="alg1.9.1">Input</span>: Source sequnece <span class="ltx_text ltx_markedasmath ltx_font_bold" id="alg1.9.2">x</span> and partial translated <math alttext="\hat{\textbf{y}}_{1:i-1}" class="ltx_Math" display="inline" id="alg1.4.m2.1"><semantics id="alg1.4.m2.1a"><msub id="alg1.4.m2.1.1" xref="alg1.4.m2.1.1.cmml"><mover accent="true" id="alg1.4.m2.1.1.2" xref="alg1.4.m2.1.1.2.cmml"><mtext id="alg1.4.m2.1.1.2.2" xref="alg1.4.m2.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.4.m2.1.1.2.1" xref="alg1.4.m2.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.4.m2.1.1.3" xref="alg1.4.m2.1.1.3.cmml"><mn id="alg1.4.m2.1.1.3.2" xref="alg1.4.m2.1.1.3.2.cmml">1</mn><mo id="alg1.4.m2.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.4.m2.1.1.3.1.cmml">:</mo><mrow id="alg1.4.m2.1.1.3.3" xref="alg1.4.m2.1.1.3.3.cmml"><mi id="alg1.4.m2.1.1.3.3.2" xref="alg1.4.m2.1.1.3.3.2.cmml">i</mi><mo id="alg1.4.m2.1.1.3.3.1" xref="alg1.4.m2.1.1.3.3.1.cmml">−</mo><mn id="alg1.4.m2.1.1.3.3.3" xref="alg1.4.m2.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><annotation-xml encoding="MathML-Content" id="alg1.4.m2.1b"><apply id="alg1.4.m2.1.1.cmml" xref="alg1.4.m2.1.1"><csymbol cd="ambiguous" id="alg1.4.m2.1.1.1.cmml" xref="alg1.4.m2.1.1">subscript</csymbol><apply id="alg1.4.m2.1.1.2.cmml" xref="alg1.4.m2.1.1.2"><ci id="alg1.4.m2.1.1.2.1.cmml" xref="alg1.4.m2.1.1.2.1">^</ci><ci id="alg1.4.m2.1.1.2.2a.cmml" xref="alg1.4.m2.1.1.2.2"><mtext id="alg1.4.m2.1.1.2.2.cmml" xref="alg1.4.m2.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.4.m2.1.1.3.cmml" xref="alg1.4.m2.1.1.3"><ci id="alg1.4.m2.1.1.3.1.cmml" xref="alg1.4.m2.1.1.3.1">:</ci><cn id="alg1.4.m2.1.1.3.2.cmml" type="integer" xref="alg1.4.m2.1.1.3.2">1</cn><apply id="alg1.4.m2.1.1.3.3.cmml" xref="alg1.4.m2.1.1.3.3"><minus id="alg1.4.m2.1.1.3.3.1.cmml" xref="alg1.4.m2.1.1.3.3.1"></minus><ci id="alg1.4.m2.1.1.3.3.2.cmml" xref="alg1.4.m2.1.1.3.3.2">𝑖</ci><cn id="alg1.4.m2.1.1.3.3.3.cmml" type="integer" xref="alg1.4.m2.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.4.m2.1c">\hat{\textbf{y}}_{1:i-1}</annotation><annotation encoding="application/x-llamapun" id="alg1.4.m2.1d">over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT</annotation></semantics></math>
<br class="ltx_break"/><span class="ltx_text ltx_font_bold" id="alg1.9.3">Parameter</span>: NMT Model <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg1.5.m3.1"><semantics id="alg1.5.m3.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.5.m3.1.1" xref="alg1.5.m3.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="alg1.5.m3.1b"><ci id="alg1.5.m3.1.1.cmml" xref="alg1.5.m3.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.5.m3.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg1.5.m3.1d">caligraphic_M</annotation></semantics></math>, Selector <math alttext="\mathcal{S}" class="ltx_Math" display="inline" id="alg1.6.m4.1"><semantics id="alg1.6.m4.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.6.m4.1.1" xref="alg1.6.m4.1.1.cmml">𝒮</mi><annotation-xml encoding="MathML-Content" id="alg1.6.m4.1b"><ci id="alg1.6.m4.1.1.cmml" xref="alg1.6.m4.1.1">𝒮</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.6.m4.1c">\mathcal{S}</annotation><annotation encoding="application/x-llamapun" id="alg1.6.m4.1d">caligraphic_S</annotation></semantics></math>, Datastore <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="alg1.7.m5.1"><semantics id="alg1.7.m5.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.7.m5.1.1" xref="alg1.7.m5.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="alg1.7.m5.1b"><ci id="alg1.7.m5.1.1.cmml" xref="alg1.7.m5.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.7.m5.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="alg1.7.m5.1d">caligraphic_D</annotation></semantics></math>, <math alttext="K" class="ltx_Math" display="inline" id="alg1.8.m6.1"><semantics id="alg1.8.m6.1a"><mi id="alg1.8.m6.1.1" xref="alg1.8.m6.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.8.m6.1b"><ci id="alg1.8.m6.1.1.cmml" xref="alg1.8.m6.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.8.m6.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg1.8.m6.1d">italic_K</annotation></semantics></math>
<br class="ltx_break"/><span class="ltx_text ltx_font_bold" id="alg1.9.4">Output</span>: <math alttext="p(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.9.m7.2"><semantics id="alg1.9.m7.2a"><mrow id="alg1.9.m7.2.2" xref="alg1.9.m7.2.2.cmml"><mi id="alg1.9.m7.2.2.3" xref="alg1.9.m7.2.2.3.cmml">p</mi><mo id="alg1.9.m7.2.2.2" xref="alg1.9.m7.2.2.2.cmml">⁢</mo><mrow id="alg1.9.m7.2.2.1.1" xref="alg1.9.m7.2.2.1.1.1.cmml"><mo id="alg1.9.m7.2.2.1.1.2" stretchy="false" xref="alg1.9.m7.2.2.1.1.1.cmml">(</mo><mrow id="alg1.9.m7.2.2.1.1.1" xref="alg1.9.m7.2.2.1.1.1.cmml"><msub id="alg1.9.m7.2.2.1.1.1.3" xref="alg1.9.m7.2.2.1.1.1.3.cmml"><mover accent="true" id="alg1.9.m7.2.2.1.1.1.3.2" xref="alg1.9.m7.2.2.1.1.1.3.2.cmml"><mi id="alg1.9.m7.2.2.1.1.1.3.2.2" xref="alg1.9.m7.2.2.1.1.1.3.2.2.cmml">y</mi><mo id="alg1.9.m7.2.2.1.1.1.3.2.1" xref="alg1.9.m7.2.2.1.1.1.3.2.1.cmml">^</mo></mover><mi id="alg1.9.m7.2.2.1.1.1.3.3" xref="alg1.9.m7.2.2.1.1.1.3.3.cmml">i</mi></msub><mo fence="false" id="alg1.9.m7.2.2.1.1.1.2" xref="alg1.9.m7.2.2.1.1.1.2.cmml">|</mo><mrow id="alg1.9.m7.2.2.1.1.1.1.1" xref="alg1.9.m7.2.2.1.1.1.1.2.cmml"><mtext id="alg1.9.m7.1.1" xref="alg1.9.m7.1.1a.cmml">𝐱</mtext><mo id="alg1.9.m7.2.2.1.1.1.1.1.2" xref="alg1.9.m7.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg1.9.m7.2.2.1.1.1.1.1.1" xref="alg1.9.m7.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.9.m7.2.2.1.1.1.1.1.1.2" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.cmml"><mtext id="alg1.9.m7.2.2.1.1.1.1.1.1.2.2" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.9.m7.2.2.1.1.1.1.1.1.2.1" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.9.m7.2.2.1.1.1.1.1.1.3" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.cmml"><mn id="alg1.9.m7.2.2.1.1.1.1.1.1.3.2" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.9.m7.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.2" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.1" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.3" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.9.m7.2.2.1.1.3" stretchy="false" xref="alg1.9.m7.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.9.m7.2b"><apply id="alg1.9.m7.2.2.cmml" xref="alg1.9.m7.2.2"><times id="alg1.9.m7.2.2.2.cmml" xref="alg1.9.m7.2.2.2"></times><ci id="alg1.9.m7.2.2.3.cmml" xref="alg1.9.m7.2.2.3">𝑝</ci><apply id="alg1.9.m7.2.2.1.1.1.cmml" xref="alg1.9.m7.2.2.1.1"><csymbol cd="latexml" id="alg1.9.m7.2.2.1.1.1.2.cmml" xref="alg1.9.m7.2.2.1.1.1.2">conditional</csymbol><apply id="alg1.9.m7.2.2.1.1.1.3.cmml" xref="alg1.9.m7.2.2.1.1.1.3"><csymbol cd="ambiguous" id="alg1.9.m7.2.2.1.1.1.3.1.cmml" xref="alg1.9.m7.2.2.1.1.1.3">subscript</csymbol><apply id="alg1.9.m7.2.2.1.1.1.3.2.cmml" xref="alg1.9.m7.2.2.1.1.1.3.2"><ci id="alg1.9.m7.2.2.1.1.1.3.2.1.cmml" xref="alg1.9.m7.2.2.1.1.1.3.2.1">^</ci><ci id="alg1.9.m7.2.2.1.1.1.3.2.2.cmml" xref="alg1.9.m7.2.2.1.1.1.3.2.2">𝑦</ci></apply><ci id="alg1.9.m7.2.2.1.1.1.3.3.cmml" xref="alg1.9.m7.2.2.1.1.1.3.3">𝑖</ci></apply><list id="alg1.9.m7.2.2.1.1.1.1.2.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1"><ci id="alg1.9.m7.1.1a.cmml" xref="alg1.9.m7.1.1"><mtext id="alg1.9.m7.1.1.cmml" xref="alg1.9.m7.1.1">𝐱</mtext></ci><apply id="alg1.9.m7.2.2.1.1.1.1.1.1.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.9.m7.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.9.m7.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2"><ci id="alg1.9.m7.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.9.m7.2.2.1.1.1.1.1.1.2.2a.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.2"><mtext id="alg1.9.m7.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.9.m7.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3"><ci id="alg1.9.m7.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.9.m7.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3"><minus id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.9.m7.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.9.m7.2c">p(\hat{y}_{i}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.9.m7.2d">italic_p ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math></p>
</div>
<div class="ltx_flex_cell">
<div class="ltx_listing ltx_listing" id="alg1.12">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline">1:</span>  Let <math alttext="z=f_{\mathcal{M}}(\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.l1.m1.2"><semantics id="alg1.l1.m1.2a"><mrow id="alg1.l1.m1.2.2" xref="alg1.l1.m1.2.2.cmml"><mi id="alg1.l1.m1.2.2.3" xref="alg1.l1.m1.2.2.3.cmml">z</mi><mo id="alg1.l1.m1.2.2.2" xref="alg1.l1.m1.2.2.2.cmml">=</mo><mrow id="alg1.l1.m1.2.2.1" xref="alg1.l1.m1.2.2.1.cmml"><msub id="alg1.l1.m1.2.2.1.3" xref="alg1.l1.m1.2.2.1.3.cmml"><mi id="alg1.l1.m1.2.2.1.3.2" xref="alg1.l1.m1.2.2.1.3.2.cmml">f</mi><mi class="ltx_font_mathcaligraphic" id="alg1.l1.m1.2.2.1.3.3" xref="alg1.l1.m1.2.2.1.3.3.cmml">ℳ</mi></msub><mo id="alg1.l1.m1.2.2.1.2" xref="alg1.l1.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg1.l1.m1.2.2.1.1.1" xref="alg1.l1.m1.2.2.1.1.2.cmml"><mo id="alg1.l1.m1.2.2.1.1.1.2" stretchy="false" xref="alg1.l1.m1.2.2.1.1.2.cmml">(</mo><mtext id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l1.m1.2.2.1.1.1.3" xref="alg1.l1.m1.2.2.1.1.2.cmml">,</mo><msub id="alg1.l1.m1.2.2.1.1.1.1" xref="alg1.l1.m1.2.2.1.1.1.1.cmml"><mover accent="true" id="alg1.l1.m1.2.2.1.1.1.1.2" xref="alg1.l1.m1.2.2.1.1.1.1.2.cmml"><mtext id="alg1.l1.m1.2.2.1.1.1.1.2.2" xref="alg1.l1.m1.2.2.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l1.m1.2.2.1.1.1.1.2.1" xref="alg1.l1.m1.2.2.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l1.m1.2.2.1.1.1.1.3" xref="alg1.l1.m1.2.2.1.1.1.1.3.cmml"><mn id="alg1.l1.m1.2.2.1.1.1.1.3.2" xref="alg1.l1.m1.2.2.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l1.m1.2.2.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l1.m1.2.2.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l1.m1.2.2.1.1.1.1.3.3" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.cmml"><mi id="alg1.l1.m1.2.2.1.1.1.1.3.3.2" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l1.m1.2.2.1.1.1.1.3.3.1" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l1.m1.2.2.1.1.1.1.3.3.3" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="alg1.l1.m1.2.2.1.1.1.4" stretchy="false" xref="alg1.l1.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.2b"><apply id="alg1.l1.m1.2.2.cmml" xref="alg1.l1.m1.2.2"><eq id="alg1.l1.m1.2.2.2.cmml" xref="alg1.l1.m1.2.2.2"></eq><ci id="alg1.l1.m1.2.2.3.cmml" xref="alg1.l1.m1.2.2.3">𝑧</ci><apply id="alg1.l1.m1.2.2.1.cmml" xref="alg1.l1.m1.2.2.1"><times id="alg1.l1.m1.2.2.1.2.cmml" xref="alg1.l1.m1.2.2.1.2"></times><apply id="alg1.l1.m1.2.2.1.3.cmml" xref="alg1.l1.m1.2.2.1.3"><csymbol cd="ambiguous" id="alg1.l1.m1.2.2.1.3.1.cmml" xref="alg1.l1.m1.2.2.1.3">subscript</csymbol><ci id="alg1.l1.m1.2.2.1.3.2.cmml" xref="alg1.l1.m1.2.2.1.3.2">𝑓</ci><ci id="alg1.l1.m1.2.2.1.3.3.cmml" xref="alg1.l1.m1.2.2.1.3.3">ℳ</ci></apply><interval closure="open" id="alg1.l1.m1.2.2.1.1.2.cmml" xref="alg1.l1.m1.2.2.1.1.1"><ci id="alg1.l1.m1.1.1a.cmml" xref="alg1.l1.m1.1.1"><mtext id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1">𝐱</mtext></ci><apply id="alg1.l1.m1.2.2.1.1.1.1.cmml" xref="alg1.l1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l1.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l1.m1.2.2.1.1.1.1">subscript</csymbol><apply id="alg1.l1.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.2"><ci id="alg1.l1.m1.2.2.1.1.1.1.2.1.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.2.1">^</ci><ci id="alg1.l1.m1.2.2.1.1.1.1.2.2a.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.2.2"><mtext id="alg1.l1.m1.2.2.1.1.1.1.2.2.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l1.m1.2.2.1.1.1.1.3.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.3"><ci id="alg1.l1.m1.2.2.1.1.1.1.3.1.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.3.1">:</ci><cn id="alg1.l1.m1.2.2.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l1.m1.2.2.1.1.1.1.3.2">1</cn><apply id="alg1.l1.m1.2.2.1.1.1.1.3.3.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.3.3"><minus id="alg1.l1.m1.2.2.1.1.1.1.3.3.1.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.1"></minus><ci id="alg1.l1.m1.2.2.1.1.1.1.3.3.2.cmml" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l1.m1.2.2.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l1.m1.2.2.1.1.1.1.3.3.3">1</cn></apply></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.2c">z=f_{\mathcal{M}}(\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.2d">italic_z = italic_f start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline">2:</span>  Let <math alttext="p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})=\mathcal{M}(z)" class="ltx_Math" display="inline" id="alg1.l2.m1.3"><semantics id="alg1.l2.m1.3a"><mrow id="alg1.l2.m1.3.3" xref="alg1.l2.m1.3.3.cmml"><mrow id="alg1.l2.m1.3.3.1" xref="alg1.l2.m1.3.3.1.cmml"><msub id="alg1.l2.m1.3.3.1.3" xref="alg1.l2.m1.3.3.1.3.cmml"><mi id="alg1.l2.m1.3.3.1.3.2" xref="alg1.l2.m1.3.3.1.3.2.cmml">p</mi><mrow id="alg1.l2.m1.3.3.1.3.3" xref="alg1.l2.m1.3.3.1.3.3.cmml"><mi id="alg1.l2.m1.3.3.1.3.3.2" xref="alg1.l2.m1.3.3.1.3.3.2.cmml">M</mi><mo id="alg1.l2.m1.3.3.1.3.3.1" xref="alg1.l2.m1.3.3.1.3.3.1.cmml">⁢</mo><mi id="alg1.l2.m1.3.3.1.3.3.3" xref="alg1.l2.m1.3.3.1.3.3.3.cmml">T</mi></mrow></msub><mo id="alg1.l2.m1.3.3.1.2" xref="alg1.l2.m1.3.3.1.2.cmml">⁢</mo><mrow id="alg1.l2.m1.3.3.1.1.1" xref="alg1.l2.m1.3.3.1.1.1.1.cmml"><mo id="alg1.l2.m1.3.3.1.1.1.2" stretchy="false" xref="alg1.l2.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="alg1.l2.m1.3.3.1.1.1.1" xref="alg1.l2.m1.3.3.1.1.1.1.cmml"><mover accent="true" id="alg1.l2.m1.3.3.1.1.1.1.3" xref="alg1.l2.m1.3.3.1.1.1.1.3.cmml"><msub id="alg1.l2.m1.3.3.1.1.1.1.3.2" xref="alg1.l2.m1.3.3.1.1.1.1.3.2.cmml"><mi id="alg1.l2.m1.3.3.1.1.1.1.3.2.2" xref="alg1.l2.m1.3.3.1.1.1.1.3.2.2.cmml">y</mi><mi id="alg1.l2.m1.3.3.1.1.1.1.3.2.3" xref="alg1.l2.m1.3.3.1.1.1.1.3.2.3.cmml">i</mi></msub><mo id="alg1.l2.m1.3.3.1.1.1.1.3.1" xref="alg1.l2.m1.3.3.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="alg1.l2.m1.3.3.1.1.1.1.2" xref="alg1.l2.m1.3.3.1.1.1.1.2.cmml">|</mo><mrow id="alg1.l2.m1.3.3.1.1.1.1.1.1" xref="alg1.l2.m1.3.3.1.1.1.1.1.2.cmml"><mtext id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l2.m1.3.3.1.1.1.1.1.1.2" xref="alg1.l2.m1.3.3.1.1.1.1.1.2.cmml">,</mo><msub id="alg1.l2.m1.3.3.1.1.1.1.1.1.1" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.cmml"><mtext id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.1" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.cmml"><mn id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.2" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.2" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.1" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.3" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.l2.m1.3.3.1.1.1.3" stretchy="false" xref="alg1.l2.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg1.l2.m1.3.3.2" xref="alg1.l2.m1.3.3.2.cmml">=</mo><mrow id="alg1.l2.m1.3.3.3" xref="alg1.l2.m1.3.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l2.m1.3.3.3.2" xref="alg1.l2.m1.3.3.3.2.cmml">ℳ</mi><mo id="alg1.l2.m1.3.3.3.1" xref="alg1.l2.m1.3.3.3.1.cmml">⁢</mo><mrow id="alg1.l2.m1.3.3.3.3.2" xref="alg1.l2.m1.3.3.3.cmml"><mo id="alg1.l2.m1.3.3.3.3.2.1" stretchy="false" xref="alg1.l2.m1.3.3.3.cmml">(</mo><mi id="alg1.l2.m1.2.2" xref="alg1.l2.m1.2.2.cmml">z</mi><mo id="alg1.l2.m1.3.3.3.3.2.2" stretchy="false" xref="alg1.l2.m1.3.3.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.3b"><apply id="alg1.l2.m1.3.3.cmml" xref="alg1.l2.m1.3.3"><eq id="alg1.l2.m1.3.3.2.cmml" xref="alg1.l2.m1.3.3.2"></eq><apply id="alg1.l2.m1.3.3.1.cmml" xref="alg1.l2.m1.3.3.1"><times id="alg1.l2.m1.3.3.1.2.cmml" xref="alg1.l2.m1.3.3.1.2"></times><apply id="alg1.l2.m1.3.3.1.3.cmml" xref="alg1.l2.m1.3.3.1.3"><csymbol cd="ambiguous" id="alg1.l2.m1.3.3.1.3.1.cmml" xref="alg1.l2.m1.3.3.1.3">subscript</csymbol><ci id="alg1.l2.m1.3.3.1.3.2.cmml" xref="alg1.l2.m1.3.3.1.3.2">𝑝</ci><apply id="alg1.l2.m1.3.3.1.3.3.cmml" xref="alg1.l2.m1.3.3.1.3.3"><times id="alg1.l2.m1.3.3.1.3.3.1.cmml" xref="alg1.l2.m1.3.3.1.3.3.1"></times><ci id="alg1.l2.m1.3.3.1.3.3.2.cmml" xref="alg1.l2.m1.3.3.1.3.3.2">𝑀</ci><ci id="alg1.l2.m1.3.3.1.3.3.3.cmml" xref="alg1.l2.m1.3.3.1.3.3.3">𝑇</ci></apply></apply><apply id="alg1.l2.m1.3.3.1.1.1.1.cmml" xref="alg1.l2.m1.3.3.1.1.1"><csymbol cd="latexml" id="alg1.l2.m1.3.3.1.1.1.1.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.2">conditional</csymbol><apply id="alg1.l2.m1.3.3.1.1.1.1.3.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3"><ci id="alg1.l2.m1.3.3.1.1.1.1.3.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3.1">^</ci><apply id="alg1.l2.m1.3.3.1.1.1.1.3.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l2.m1.3.3.1.1.1.1.3.2.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3.2">subscript</csymbol><ci id="alg1.l2.m1.3.3.1.1.1.1.3.2.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3.2.2">𝑦</ci><ci id="alg1.l2.m1.3.3.1.1.1.1.3.2.3.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="alg1.l2.m1.3.3.1.1.1.1.1.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1"><ci id="alg1.l2.m1.1.1a.cmml" xref="alg1.l2.m1.1.1"><mtext id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝐱</mtext></ci><apply id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2"><ci id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2a.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2"><mtext id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3"><ci id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3"><minus id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l2.m1.3.3.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply><apply id="alg1.l2.m1.3.3.3.cmml" xref="alg1.l2.m1.3.3.3"><times id="alg1.l2.m1.3.3.3.1.cmml" xref="alg1.l2.m1.3.3.3.1"></times><ci id="alg1.l2.m1.3.3.3.2.cmml" xref="alg1.l2.m1.3.3.3.2">ℳ</ci><ci id="alg1.l2.m1.2.2.cmml" xref="alg1.l2.m1.2.2">𝑧</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.3c">p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})=\mathcal{M}(z)</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.3d">italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT ) = caligraphic_M ( italic_z )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline">3:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l3.1">if</span> <math alttext="\mathcal{S}(z)==0" class="ltx_math_unparsed" display="inline" id="alg1.l3.m1.1"><semantics id="alg1.l3.m1.1a"><mrow id="alg1.l3.m1.1b"><mi class="ltx_font_mathcaligraphic" id="alg1.l3.m1.1.2">𝒮</mi><mrow id="alg1.l3.m1.1.3"><mo id="alg1.l3.m1.1.3.1" stretchy="false">(</mo><mi id="alg1.l3.m1.1.1">z</mi><mo id="alg1.l3.m1.1.3.2" stretchy="false">)</mo></mrow><mo id="alg1.l3.m1.1.4" rspace="0em">=</mo><mo id="alg1.l3.m1.1.5" lspace="0em">=</mo><mn id="alg1.l3.m1.1.6">0</mn></mrow><annotation encoding="application/x-tex" id="alg1.l3.m1.1c">\mathcal{S}(z)==0</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.1d">caligraphic_S ( italic_z ) = = 0</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l3.2">then</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline">4:</span>     Retrieve <math alttext="K" class="ltx_Math" display="inline" id="alg1.l4.m1.1"><semantics id="alg1.l4.m1.1a"><mi id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><ci id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.1d">italic_K</annotation></semantics></math> nearest neighbors from <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="alg1.l4.m2.1"><semantics id="alg1.l4.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.l4.m2.1.1" xref="alg1.l4.m2.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="alg1.l4.m2.1b"><ci id="alg1.l4.m2.1.1.cmml" xref="alg1.l4.m2.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m2.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m2.1d">caligraphic_D</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline">5:</span>     Estimated <math alttext="p_{kNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.l5.m1.2"><semantics id="alg1.l5.m1.2a"><mrow id="alg1.l5.m1.2.2" xref="alg1.l5.m1.2.2.cmml"><msub id="alg1.l5.m1.2.2.3" xref="alg1.l5.m1.2.2.3.cmml"><mi id="alg1.l5.m1.2.2.3.2" xref="alg1.l5.m1.2.2.3.2.cmml">p</mi><mrow id="alg1.l5.m1.2.2.3.3" xref="alg1.l5.m1.2.2.3.3.cmml"><mi id="alg1.l5.m1.2.2.3.3.2" xref="alg1.l5.m1.2.2.3.3.2.cmml">k</mi><mo id="alg1.l5.m1.2.2.3.3.1" xref="alg1.l5.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l5.m1.2.2.3.3.3" xref="alg1.l5.m1.2.2.3.3.3.cmml">N</mi><mo id="alg1.l5.m1.2.2.3.3.1a" xref="alg1.l5.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l5.m1.2.2.3.3.4" xref="alg1.l5.m1.2.2.3.3.4.cmml">N</mi></mrow></msub><mo id="alg1.l5.m1.2.2.2" xref="alg1.l5.m1.2.2.2.cmml">⁢</mo><mrow id="alg1.l5.m1.2.2.1.1" xref="alg1.l5.m1.2.2.1.1.1.cmml"><mo id="alg1.l5.m1.2.2.1.1.2" stretchy="false" xref="alg1.l5.m1.2.2.1.1.1.cmml">(</mo><mrow id="alg1.l5.m1.2.2.1.1.1" xref="alg1.l5.m1.2.2.1.1.1.cmml"><mover accent="true" id="alg1.l5.m1.2.2.1.1.1.3" xref="alg1.l5.m1.2.2.1.1.1.3.cmml"><msub id="alg1.l5.m1.2.2.1.1.1.3.2" xref="alg1.l5.m1.2.2.1.1.1.3.2.cmml"><mi id="alg1.l5.m1.2.2.1.1.1.3.2.2" xref="alg1.l5.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="alg1.l5.m1.2.2.1.1.1.3.2.3" xref="alg1.l5.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="alg1.l5.m1.2.2.1.1.1.3.1" xref="alg1.l5.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="alg1.l5.m1.2.2.1.1.1.2" xref="alg1.l5.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="alg1.l5.m1.2.2.1.1.1.1.1" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml"><mtext id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l5.m1.2.2.1.1.1.1.1.2" xref="alg1.l5.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg1.l5.m1.2.2.1.1.1.1.1.1" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l5.m1.2.2.1.1.1.1.1.1.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l5.m1.2.2.1.1.1.1.1.1.3" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.cmml"><mn id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.2" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.1" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.3" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.l5.m1.2.2.1.1.3" stretchy="false" xref="alg1.l5.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.2b"><apply id="alg1.l5.m1.2.2.cmml" xref="alg1.l5.m1.2.2"><times id="alg1.l5.m1.2.2.2.cmml" xref="alg1.l5.m1.2.2.2"></times><apply id="alg1.l5.m1.2.2.3.cmml" xref="alg1.l5.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.3.1.cmml" xref="alg1.l5.m1.2.2.3">subscript</csymbol><ci id="alg1.l5.m1.2.2.3.2.cmml" xref="alg1.l5.m1.2.2.3.2">𝑝</ci><apply id="alg1.l5.m1.2.2.3.3.cmml" xref="alg1.l5.m1.2.2.3.3"><times id="alg1.l5.m1.2.2.3.3.1.cmml" xref="alg1.l5.m1.2.2.3.3.1"></times><ci id="alg1.l5.m1.2.2.3.3.2.cmml" xref="alg1.l5.m1.2.2.3.3.2">𝑘</ci><ci id="alg1.l5.m1.2.2.3.3.3.cmml" xref="alg1.l5.m1.2.2.3.3.3">𝑁</ci><ci id="alg1.l5.m1.2.2.3.3.4.cmml" xref="alg1.l5.m1.2.2.3.3.4">𝑁</ci></apply></apply><apply id="alg1.l5.m1.2.2.1.1.1.cmml" xref="alg1.l5.m1.2.2.1.1"><csymbol cd="latexml" id="alg1.l5.m1.2.2.1.1.1.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.2">conditional</csymbol><apply id="alg1.l5.m1.2.2.1.1.1.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.3"><ci id="alg1.l5.m1.2.2.1.1.1.3.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.3.1">^</ci><apply id="alg1.l5.m1.2.2.1.1.1.3.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.1.1.1.3.2.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="alg1.l5.m1.2.2.1.1.1.3.2.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="alg1.l5.m1.2.2.1.1.1.3.2.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="alg1.l5.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1"><ci id="alg1.l5.m1.1.1a.cmml" xref="alg1.l5.m1.1.1"><mtext id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1">𝐱</mtext></ci><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2"><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3"><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3"><minus id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l5.m1.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.2c">p_{kNN}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.2d">italic_p start_POSTSUBSCRIPT italic_k italic_N italic_N end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> by Eq.  <a class="ltx_ref" href="#Sx2.E1" title="1 ‣ Estimation of Probability Distribution ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline">6:</span>     Caculate <math alttext="p_{combined}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.l6.m1.2"><semantics id="alg1.l6.m1.2a"><mrow id="alg1.l6.m1.2.2" xref="alg1.l6.m1.2.2.cmml"><msub id="alg1.l6.m1.2.2.3" xref="alg1.l6.m1.2.2.3.cmml"><mi id="alg1.l6.m1.2.2.3.2" xref="alg1.l6.m1.2.2.3.2.cmml">p</mi><mrow id="alg1.l6.m1.2.2.3.3" xref="alg1.l6.m1.2.2.3.3.cmml"><mi id="alg1.l6.m1.2.2.3.3.2" xref="alg1.l6.m1.2.2.3.3.2.cmml">c</mi><mo id="alg1.l6.m1.2.2.3.3.1" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.3" xref="alg1.l6.m1.2.2.3.3.3.cmml">o</mi><mo id="alg1.l6.m1.2.2.3.3.1a" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.4" xref="alg1.l6.m1.2.2.3.3.4.cmml">m</mi><mo id="alg1.l6.m1.2.2.3.3.1b" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.5" xref="alg1.l6.m1.2.2.3.3.5.cmml">b</mi><mo id="alg1.l6.m1.2.2.3.3.1c" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.6" xref="alg1.l6.m1.2.2.3.3.6.cmml">i</mi><mo id="alg1.l6.m1.2.2.3.3.1d" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.7" xref="alg1.l6.m1.2.2.3.3.7.cmml">n</mi><mo id="alg1.l6.m1.2.2.3.3.1e" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.8" xref="alg1.l6.m1.2.2.3.3.8.cmml">e</mi><mo id="alg1.l6.m1.2.2.3.3.1f" xref="alg1.l6.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l6.m1.2.2.3.3.9" xref="alg1.l6.m1.2.2.3.3.9.cmml">d</mi></mrow></msub><mo id="alg1.l6.m1.2.2.2" xref="alg1.l6.m1.2.2.2.cmml">⁢</mo><mrow id="alg1.l6.m1.2.2.1.1" xref="alg1.l6.m1.2.2.1.1.1.cmml"><mo id="alg1.l6.m1.2.2.1.1.2" stretchy="false" xref="alg1.l6.m1.2.2.1.1.1.cmml">(</mo><mrow id="alg1.l6.m1.2.2.1.1.1" xref="alg1.l6.m1.2.2.1.1.1.cmml"><mover accent="true" id="alg1.l6.m1.2.2.1.1.1.3" xref="alg1.l6.m1.2.2.1.1.1.3.cmml"><msub id="alg1.l6.m1.2.2.1.1.1.3.2" xref="alg1.l6.m1.2.2.1.1.1.3.2.cmml"><mi id="alg1.l6.m1.2.2.1.1.1.3.2.2" xref="alg1.l6.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="alg1.l6.m1.2.2.1.1.1.3.2.3" xref="alg1.l6.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="alg1.l6.m1.2.2.1.1.1.3.1" xref="alg1.l6.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="alg1.l6.m1.2.2.1.1.1.2" xref="alg1.l6.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="alg1.l6.m1.2.2.1.1.1.1.1" xref="alg1.l6.m1.2.2.1.1.1.1.2.cmml"><mtext id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l6.m1.2.2.1.1.1.1.1.2" xref="alg1.l6.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg1.l6.m1.2.2.1.1.1.1.1.1" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l6.m1.2.2.1.1.1.1.1.1.2" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.1" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l6.m1.2.2.1.1.1.1.1.1.3" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.cmml"><mn id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.2" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.2" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.1" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.3" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.l6.m1.2.2.1.1.3" stretchy="false" xref="alg1.l6.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.2b"><apply id="alg1.l6.m1.2.2.cmml" xref="alg1.l6.m1.2.2"><times id="alg1.l6.m1.2.2.2.cmml" xref="alg1.l6.m1.2.2.2"></times><apply id="alg1.l6.m1.2.2.3.cmml" xref="alg1.l6.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l6.m1.2.2.3.1.cmml" xref="alg1.l6.m1.2.2.3">subscript</csymbol><ci id="alg1.l6.m1.2.2.3.2.cmml" xref="alg1.l6.m1.2.2.3.2">𝑝</ci><apply id="alg1.l6.m1.2.2.3.3.cmml" xref="alg1.l6.m1.2.2.3.3"><times id="alg1.l6.m1.2.2.3.3.1.cmml" xref="alg1.l6.m1.2.2.3.3.1"></times><ci id="alg1.l6.m1.2.2.3.3.2.cmml" xref="alg1.l6.m1.2.2.3.3.2">𝑐</ci><ci id="alg1.l6.m1.2.2.3.3.3.cmml" xref="alg1.l6.m1.2.2.3.3.3">𝑜</ci><ci id="alg1.l6.m1.2.2.3.3.4.cmml" xref="alg1.l6.m1.2.2.3.3.4">𝑚</ci><ci id="alg1.l6.m1.2.2.3.3.5.cmml" xref="alg1.l6.m1.2.2.3.3.5">𝑏</ci><ci id="alg1.l6.m1.2.2.3.3.6.cmml" xref="alg1.l6.m1.2.2.3.3.6">𝑖</ci><ci id="alg1.l6.m1.2.2.3.3.7.cmml" xref="alg1.l6.m1.2.2.3.3.7">𝑛</ci><ci id="alg1.l6.m1.2.2.3.3.8.cmml" xref="alg1.l6.m1.2.2.3.3.8">𝑒</ci><ci id="alg1.l6.m1.2.2.3.3.9.cmml" xref="alg1.l6.m1.2.2.3.3.9">𝑑</ci></apply></apply><apply id="alg1.l6.m1.2.2.1.1.1.cmml" xref="alg1.l6.m1.2.2.1.1"><csymbol cd="latexml" id="alg1.l6.m1.2.2.1.1.1.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.2">conditional</csymbol><apply id="alg1.l6.m1.2.2.1.1.1.3.cmml" xref="alg1.l6.m1.2.2.1.1.1.3"><ci id="alg1.l6.m1.2.2.1.1.1.3.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.3.1">^</ci><apply id="alg1.l6.m1.2.2.1.1.1.3.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l6.m1.2.2.1.1.1.3.2.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="alg1.l6.m1.2.2.1.1.1.3.2.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="alg1.l6.m1.2.2.1.1.1.3.2.3.cmml" xref="alg1.l6.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="alg1.l6.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1"><ci id="alg1.l6.m1.1.1a.cmml" xref="alg1.l6.m1.1.1"><mtext id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1">𝐱</mtext></ci><apply id="alg1.l6.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l6.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2"><ci id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3"><ci id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3"><minus id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l6.m1.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.2c">p_{combined}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.2d">italic_p start_POSTSUBSCRIPT italic_c italic_o italic_m italic_b italic_i italic_n italic_e italic_d end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> by Eq.  <a class="ltx_ref" href="#Sx2.E2" title="2 ‣ Estimation of Probability Distribution ‣ 𝑘NN-MT ‣ Background ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline">7:</span>     <span class="ltx_text ltx_font_bold" id="alg1.l7.1">return</span> return <math alttext="p_{combined}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.l7.m1.2"><semantics id="alg1.l7.m1.2a"><mrow id="alg1.l7.m1.2.2" xref="alg1.l7.m1.2.2.cmml"><msub id="alg1.l7.m1.2.2.3" xref="alg1.l7.m1.2.2.3.cmml"><mi id="alg1.l7.m1.2.2.3.2" xref="alg1.l7.m1.2.2.3.2.cmml">p</mi><mrow id="alg1.l7.m1.2.2.3.3" xref="alg1.l7.m1.2.2.3.3.cmml"><mi id="alg1.l7.m1.2.2.3.3.2" xref="alg1.l7.m1.2.2.3.3.2.cmml">c</mi><mo id="alg1.l7.m1.2.2.3.3.1" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.3" xref="alg1.l7.m1.2.2.3.3.3.cmml">o</mi><mo id="alg1.l7.m1.2.2.3.3.1a" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.4" xref="alg1.l7.m1.2.2.3.3.4.cmml">m</mi><mo id="alg1.l7.m1.2.2.3.3.1b" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.5" xref="alg1.l7.m1.2.2.3.3.5.cmml">b</mi><mo id="alg1.l7.m1.2.2.3.3.1c" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.6" xref="alg1.l7.m1.2.2.3.3.6.cmml">i</mi><mo id="alg1.l7.m1.2.2.3.3.1d" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.7" xref="alg1.l7.m1.2.2.3.3.7.cmml">n</mi><mo id="alg1.l7.m1.2.2.3.3.1e" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.8" xref="alg1.l7.m1.2.2.3.3.8.cmml">e</mi><mo id="alg1.l7.m1.2.2.3.3.1f" xref="alg1.l7.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l7.m1.2.2.3.3.9" xref="alg1.l7.m1.2.2.3.3.9.cmml">d</mi></mrow></msub><mo id="alg1.l7.m1.2.2.2" xref="alg1.l7.m1.2.2.2.cmml">⁢</mo><mrow id="alg1.l7.m1.2.2.1.1" xref="alg1.l7.m1.2.2.1.1.1.cmml"><mo id="alg1.l7.m1.2.2.1.1.2" stretchy="false" xref="alg1.l7.m1.2.2.1.1.1.cmml">(</mo><mrow id="alg1.l7.m1.2.2.1.1.1" xref="alg1.l7.m1.2.2.1.1.1.cmml"><mover accent="true" id="alg1.l7.m1.2.2.1.1.1.3" xref="alg1.l7.m1.2.2.1.1.1.3.cmml"><msub id="alg1.l7.m1.2.2.1.1.1.3.2" xref="alg1.l7.m1.2.2.1.1.1.3.2.cmml"><mi id="alg1.l7.m1.2.2.1.1.1.3.2.2" xref="alg1.l7.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="alg1.l7.m1.2.2.1.1.1.3.2.3" xref="alg1.l7.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="alg1.l7.m1.2.2.1.1.1.3.1" xref="alg1.l7.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="alg1.l7.m1.2.2.1.1.1.2" xref="alg1.l7.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="alg1.l7.m1.2.2.1.1.1.1.1" xref="alg1.l7.m1.2.2.1.1.1.1.2.cmml"><mtext id="alg1.l7.m1.1.1" xref="alg1.l7.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l7.m1.2.2.1.1.1.1.1.2" xref="alg1.l7.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg1.l7.m1.2.2.1.1.1.1.1.1" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l7.m1.2.2.1.1.1.1.1.1.2" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.1" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l7.m1.2.2.1.1.1.1.1.1.3" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.cmml"><mn id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.2" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.2" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.1" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.3" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.l7.m1.2.2.1.1.3" stretchy="false" xref="alg1.l7.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.2b"><apply id="alg1.l7.m1.2.2.cmml" xref="alg1.l7.m1.2.2"><times id="alg1.l7.m1.2.2.2.cmml" xref="alg1.l7.m1.2.2.2"></times><apply id="alg1.l7.m1.2.2.3.cmml" xref="alg1.l7.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l7.m1.2.2.3.1.cmml" xref="alg1.l7.m1.2.2.3">subscript</csymbol><ci id="alg1.l7.m1.2.2.3.2.cmml" xref="alg1.l7.m1.2.2.3.2">𝑝</ci><apply id="alg1.l7.m1.2.2.3.3.cmml" xref="alg1.l7.m1.2.2.3.3"><times id="alg1.l7.m1.2.2.3.3.1.cmml" xref="alg1.l7.m1.2.2.3.3.1"></times><ci id="alg1.l7.m1.2.2.3.3.2.cmml" xref="alg1.l7.m1.2.2.3.3.2">𝑐</ci><ci id="alg1.l7.m1.2.2.3.3.3.cmml" xref="alg1.l7.m1.2.2.3.3.3">𝑜</ci><ci id="alg1.l7.m1.2.2.3.3.4.cmml" xref="alg1.l7.m1.2.2.3.3.4">𝑚</ci><ci id="alg1.l7.m1.2.2.3.3.5.cmml" xref="alg1.l7.m1.2.2.3.3.5">𝑏</ci><ci id="alg1.l7.m1.2.2.3.3.6.cmml" xref="alg1.l7.m1.2.2.3.3.6">𝑖</ci><ci id="alg1.l7.m1.2.2.3.3.7.cmml" xref="alg1.l7.m1.2.2.3.3.7">𝑛</ci><ci id="alg1.l7.m1.2.2.3.3.8.cmml" xref="alg1.l7.m1.2.2.3.3.8">𝑒</ci><ci id="alg1.l7.m1.2.2.3.3.9.cmml" xref="alg1.l7.m1.2.2.3.3.9">𝑑</ci></apply></apply><apply id="alg1.l7.m1.2.2.1.1.1.cmml" xref="alg1.l7.m1.2.2.1.1"><csymbol cd="latexml" id="alg1.l7.m1.2.2.1.1.1.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.2">conditional</csymbol><apply id="alg1.l7.m1.2.2.1.1.1.3.cmml" xref="alg1.l7.m1.2.2.1.1.1.3"><ci id="alg1.l7.m1.2.2.1.1.1.3.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.3.1">^</ci><apply id="alg1.l7.m1.2.2.1.1.1.3.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l7.m1.2.2.1.1.1.3.2.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="alg1.l7.m1.2.2.1.1.1.3.2.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="alg1.l7.m1.2.2.1.1.1.3.2.3.cmml" xref="alg1.l7.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="alg1.l7.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1"><ci id="alg1.l7.m1.1.1a.cmml" xref="alg1.l7.m1.1.1"><mtext id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1">𝐱</mtext></ci><apply id="alg1.l7.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l7.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2"><ci id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3"><ci id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3"><minus id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l7.m1.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.2c">p_{combined}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m1.2d">italic_p start_POSTSUBSCRIPT italic_c italic_o italic_m italic_b italic_i italic_n italic_e italic_d end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline">8:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l8.1">else</span>
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline">9:</span>     <span class="ltx_text ltx_font_bold" id="alg1.l9.1">return</span> <math alttext="p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="alg1.l9.m1.2"><semantics id="alg1.l9.m1.2a"><mrow id="alg1.l9.m1.2.2" xref="alg1.l9.m1.2.2.cmml"><msub id="alg1.l9.m1.2.2.3" xref="alg1.l9.m1.2.2.3.cmml"><mi id="alg1.l9.m1.2.2.3.2" xref="alg1.l9.m1.2.2.3.2.cmml">p</mi><mrow id="alg1.l9.m1.2.2.3.3" xref="alg1.l9.m1.2.2.3.3.cmml"><mi id="alg1.l9.m1.2.2.3.3.2" xref="alg1.l9.m1.2.2.3.3.2.cmml">M</mi><mo id="alg1.l9.m1.2.2.3.3.1" xref="alg1.l9.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l9.m1.2.2.3.3.3" xref="alg1.l9.m1.2.2.3.3.3.cmml">T</mi></mrow></msub><mo id="alg1.l9.m1.2.2.2" xref="alg1.l9.m1.2.2.2.cmml">⁢</mo><mrow id="alg1.l9.m1.2.2.1.1" xref="alg1.l9.m1.2.2.1.1.1.cmml"><mo id="alg1.l9.m1.2.2.1.1.2" stretchy="false" xref="alg1.l9.m1.2.2.1.1.1.cmml">(</mo><mrow id="alg1.l9.m1.2.2.1.1.1" xref="alg1.l9.m1.2.2.1.1.1.cmml"><mover accent="true" id="alg1.l9.m1.2.2.1.1.1.3" xref="alg1.l9.m1.2.2.1.1.1.3.cmml"><msub id="alg1.l9.m1.2.2.1.1.1.3.2" xref="alg1.l9.m1.2.2.1.1.1.3.2.cmml"><mi id="alg1.l9.m1.2.2.1.1.1.3.2.2" xref="alg1.l9.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="alg1.l9.m1.2.2.1.1.1.3.2.3" xref="alg1.l9.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="alg1.l9.m1.2.2.1.1.1.3.1" xref="alg1.l9.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="alg1.l9.m1.2.2.1.1.1.2" xref="alg1.l9.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="alg1.l9.m1.2.2.1.1.1.1.1" xref="alg1.l9.m1.2.2.1.1.1.1.2.cmml"><mtext id="alg1.l9.m1.1.1" xref="alg1.l9.m1.1.1a.cmml">𝐱</mtext><mo id="alg1.l9.m1.2.2.1.1.1.1.1.2" xref="alg1.l9.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="alg1.l9.m1.2.2.1.1.1.1.1.1" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="alg1.l9.m1.2.2.1.1.1.1.1.1.2" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.1" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="alg1.l9.m1.2.2.1.1.1.1.1.1.3" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.cmml"><mn id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.2" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.2" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.1" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.3" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="alg1.l9.m1.2.2.1.1.3" stretchy="false" xref="alg1.l9.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.2b"><apply id="alg1.l9.m1.2.2.cmml" xref="alg1.l9.m1.2.2"><times id="alg1.l9.m1.2.2.2.cmml" xref="alg1.l9.m1.2.2.2"></times><apply id="alg1.l9.m1.2.2.3.cmml" xref="alg1.l9.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l9.m1.2.2.3.1.cmml" xref="alg1.l9.m1.2.2.3">subscript</csymbol><ci id="alg1.l9.m1.2.2.3.2.cmml" xref="alg1.l9.m1.2.2.3.2">𝑝</ci><apply id="alg1.l9.m1.2.2.3.3.cmml" xref="alg1.l9.m1.2.2.3.3"><times id="alg1.l9.m1.2.2.3.3.1.cmml" xref="alg1.l9.m1.2.2.3.3.1"></times><ci id="alg1.l9.m1.2.2.3.3.2.cmml" xref="alg1.l9.m1.2.2.3.3.2">𝑀</ci><ci id="alg1.l9.m1.2.2.3.3.3.cmml" xref="alg1.l9.m1.2.2.3.3.3">𝑇</ci></apply></apply><apply id="alg1.l9.m1.2.2.1.1.1.cmml" xref="alg1.l9.m1.2.2.1.1"><csymbol cd="latexml" id="alg1.l9.m1.2.2.1.1.1.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.2">conditional</csymbol><apply id="alg1.l9.m1.2.2.1.1.1.3.cmml" xref="alg1.l9.m1.2.2.1.1.1.3"><ci id="alg1.l9.m1.2.2.1.1.1.3.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.3.1">^</ci><apply id="alg1.l9.m1.2.2.1.1.1.3.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="alg1.l9.m1.2.2.1.1.1.3.2.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="alg1.l9.m1.2.2.1.1.1.3.2.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="alg1.l9.m1.2.2.1.1.1.3.2.3.cmml" xref="alg1.l9.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="alg1.l9.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1"><ci id="alg1.l9.m1.1.1a.cmml" xref="alg1.l9.m1.1.1"><mtext id="alg1.l9.m1.1.1.cmml" xref="alg1.l9.m1.1.1">𝐱</mtext></ci><apply id="alg1.l9.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l9.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2"><ci id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3"><ci id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3"><minus id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="alg1.l9.m1.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.2c">p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.m1.2d">italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l10">
<span class="ltx_tag ltx_tag_listingline">10:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l10.1">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l10.2">if</span>
</div>
</div>
</div>
</div>
</figure>
<figure class="ltx_table" id="Sx3.T2">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="Sx3.T2.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T2.1.2.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="Sx3.T2.1.2.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T2.1.2.1.2">IT</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T2.1.2.1.3">Koran</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T2.1.2.1.4">Law</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T2.1.2.1.5">Medical</td>
</tr>
<tr class="ltx_tr" id="Sx3.T2.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="Sx3.T2.1.1.1"><math alttext="\lambda" class="ltx_Math" display="inline" id="Sx3.T2.1.1.1.m1.1"><semantics id="Sx3.T2.1.1.1.m1.1a"><mi id="Sx3.T2.1.1.1.m1.1.1" xref="Sx3.T2.1.1.1.m1.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="Sx3.T2.1.1.1.m1.1b"><ci id="Sx3.T2.1.1.1.m1.1.1.cmml" xref="Sx3.T2.1.1.1.m1.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T2.1.1.1.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="Sx3.T2.1.1.1.m1.1d">italic_λ</annotation></semantics></math></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T2.1.1.2">0.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T2.1.1.3">0.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T2.1.1.4">0.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T2.1.1.5">0.8</td>
</tr>
<tr class="ltx_tr" id="Sx3.T2.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="Sx3.T2.1.3.2.1">T</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T2.1.3.2.2">10</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T2.1.3.2.3">100</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T2.1.3.2.4">10</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T2.1.3.2.5">10</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>These values come from the original <math alttext="k" class="ltx_Math" display="inline" id="Sx3.T2.3.m1.1"><semantics id="Sx3.T2.3.m1.1b"><mi id="Sx3.T2.3.m1.1.1" xref="Sx3.T2.3.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.T2.3.m1.1c"><ci id="Sx3.T2.3.m1.1.1.cmml" xref="Sx3.T2.3.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T2.3.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.T2.3.m1.1e">italic_k</annotation></semantics></math>NN-MT paper <cite class="ltx_cite ltx_citemacro_citep">(Khandelwal et al. <a class="ltx_ref" href="#bib.bib12" title="">2021</a>)</cite> figure 5. </figcaption>
</figure>
<figure class="ltx_table" id="Sx3.T3">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="Sx3.T3.5">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T3.5.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="Sx3.T3.5.1.1.1" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.1.1.1.1">Systems</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T3.5.1.1.2">IT</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T3.5.1.1.3">Koran</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T3.5.1.1.4">Law</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T3.5.1.1.5">Medical</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T3.5.1.1.6">Averge</td>
</tr>
<tr class="ltx_tr" id="Sx3.T3.5.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.1">Total</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.2">KNN</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.3">Total</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.4">KNN</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.5">Total</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.6">KNN</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.7">Total</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T3.5.2.2.8">KNN</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.9">Total</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.2.2.10">KNN</td>
</tr>
<tr class="ltx_tr" id="Sx3.T3.5.3.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="Sx3.T3.5.3.3.1">Vanilla KNN-MT</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.2">18.83</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.3">4.04</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.4">28.90</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.5">5.02</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.6">64.53</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.7">22.22</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.8">39.33</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T3.5.3.3.9">9.43</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.10">37.90</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.3.3.11">10.18</td>
</tr>
<tr class="ltx_tr" id="Sx3.T3.5.4.4">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.1" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.1.1">Vanilla + Selector</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.2" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.2.1">16.77</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.4.4.3">2.41</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.4" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.4.1">27.77</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.4.4.5">3.74</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.6" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.6.1">52.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.4.4.7">10.38</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.8" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.8.1">34.63</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T3.5.4.4.9">5.97</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T3.5.4.4.10" rowspan="2"><span class="ltx_text" id="Sx3.T3.5.4.4.10.1">32.94</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T3.5.4.4.11">5.63</td>
</tr>
<tr class="ltx_tr" id="Sx3.T3.5.5.5">
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T3.5.5.5.1">(-40.3%)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T3.5.5.5.2">(-34.2%)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T3.5.5.5.3">(-53.3%)</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="Sx3.T3.5.5.5.4">(-36.7%)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T3.5.5.5.5">(-44.7%)</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span> Time comparison in seconds. For each dataset we measured the inference time(Total) and <math alttext="k" class="ltx_Math" display="inline" id="Sx3.T3.3.m1.1"><semantics id="Sx3.T3.3.m1.1b"><mi id="Sx3.T3.3.m1.1.1" xref="Sx3.T3.3.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.T3.3.m1.1c"><ci id="Sx3.T3.3.m1.1.1.cmml" xref="Sx3.T3.3.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T3.3.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.T3.3.m1.1e">italic_k</annotation></semantics></math>NN overhead time(KNN) metrics.
To measure the exact time, the global CUDA stream is synchronized before the boundary of the relevant code snippets, slightly reducing operational efficiency.
KNN overhead time comprises <math alttext="k" class="ltx_Math" display="inline" id="Sx3.T3.4.m2.1"><semantics id="Sx3.T3.4.m2.1b"><mi id="Sx3.T3.4.m2.1.1" xref="Sx3.T3.4.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.T3.4.m2.1c"><ci id="Sx3.T3.4.m2.1.1.cmml" xref="Sx3.T3.4.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T3.4.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.T3.4.m2.1e">italic_k</annotation></semantics></math>NN retrieving, selector predicting, and probability distribution revising.
The server equips with an Intel Core i9-12900K CPU and an Nvidia Quadro RTX8000 GPU. </figcaption>
</figure>
<figure class="ltx_table" id="Sx3.T4">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="Sx3.T4.3">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T4.3.4.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="Sx3.T4.3.4.1.1" rowspan="2"><span class="ltx_text" id="Sx3.T4.3.4.1.1.1">Systems</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T4.3.4.1.2">IT</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T4.3.4.1.3">Koran</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T4.3.4.1.4">Law</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T4.3.4.1.5">Medical</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="Sx3.T4.3.4.1.6">Averge</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.5.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.1">BLEU</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.2">Tokens/s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.3">BLEU</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.4">Tokens/s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.5">BLEU</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.6">Tokens/s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.7">BLEU</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T4.3.5.2.8">Tokens/s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.9">BLEU</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.5.2.10">Tokens/s</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.6.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="Sx3.T4.3.6.3.1">Pure NMT Model</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.2">38.35</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.3">2171.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.4">16.26</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.5">2199.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.6">45.48</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.7">1922.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.8">40.06</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T4.3.6.3.9">1919.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.10">35.04</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.6.3.11">2053.3</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.1.1">
<td class="ltx_td ltx_align_center ltx_border_t" colspan="11" id="Sx3.T4.1.1.1">Vanilla, <math alttext="K" class="ltx_Math" display="inline" id="Sx3.T4.1.1.1.m1.1"><semantics id="Sx3.T4.1.1.1.m1.1a"><mi id="Sx3.T4.1.1.1.m1.1.1" xref="Sx3.T4.1.1.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="Sx3.T4.1.1.1.m1.1b"><ci id="Sx3.T4.1.1.1.m1.1.1.cmml" xref="Sx3.T4.1.1.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T4.1.1.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="Sx3.T4.1.1.1.m1.1d">italic_K</annotation></semantics></math> = 8</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.7.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="Sx3.T4.3.7.4.1">Vanilla KNN-MT</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.2">45.52</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.3">1638.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.4">20.54</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.5">1720.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.6">61.08</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.7">1243.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.8">53.51</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T4.3.7.4.9">1347.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.10">45.16</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.7.4.11">1487.3</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.8.5">
<td class="ltx_td ltx_align_left" id="Sx3.T4.3.8.5.1">Vanilla + Selector</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.2">43.90</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.3">1843.1</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.4">18.55</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.5">1820.2</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.6">57.18</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.7">1509.1</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.8">48.70</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="Sx3.T4.3.8.5.9">1540.4</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.10">42.08</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.8.5.11">1678.2</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" colspan="11" id="Sx3.T4.2.2.1">Adaptive, maximum <math alttext="K" class="ltx_Math" display="inline" id="Sx3.T4.2.2.1.m1.1"><semantics id="Sx3.T4.2.2.1.m1.1a"><mi id="Sx3.T4.2.2.1.m1.1.1" xref="Sx3.T4.2.2.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="Sx3.T4.2.2.1.m1.1b"><ci id="Sx3.T4.2.2.1.m1.1.1.cmml" xref="Sx3.T4.2.2.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T4.2.2.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="Sx3.T4.2.2.1.m1.1d">italic_K</annotation></semantics></math> = 4</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.9.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="Sx3.T4.3.9.6.1">Adaptive KNN-MT</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.2">47.78</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.3">1676.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.4">20.23</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.5">1749.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.6">63.00</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.7">1230.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.8">56.31</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T4.3.9.6.9">1371.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.10">46.83</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.9.6.11">1506.7</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.10.7">
<td class="ltx_td ltx_align_left" id="Sx3.T4.3.10.7.1">Adaptive + Selector</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.2">46.12</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.3">1857.2</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.4">18.64</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.5">1847.0</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.6">58.71</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.7">1489.8</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.8">50.26</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="Sx3.T4.3.10.7.9">1619.5</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.10">43.43</td>
<td class="ltx_td ltx_align_center" id="Sx3.T4.3.10.7.11">1703.4</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.3">
<td class="ltx_td ltx_align_center ltx_border_t" colspan="11" id="Sx3.T4.3.3.1">PCK, maximum <math alttext="K" class="ltx_Math" display="inline" id="Sx3.T4.3.3.1.m1.1"><semantics id="Sx3.T4.3.3.1.m1.1a"><mi id="Sx3.T4.3.3.1.m1.1.1" xref="Sx3.T4.3.3.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="Sx3.T4.3.3.1.m1.1b"><ci id="Sx3.T4.3.3.1.m1.1.1.cmml" xref="Sx3.T4.3.3.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T4.3.3.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="Sx3.T4.3.3.1.m1.1d">italic_K</annotation></semantics></math> = 4</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.11.8">
<td class="ltx_td ltx_align_left ltx_border_t" id="Sx3.T4.3.11.8.1">PCK KNN-MT</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.2">47.61</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.3">1774.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.4">19.74</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.5">1788.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.6">62.95</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.7">1376.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.8">56.62</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="Sx3.T4.3.11.8.9">1510.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.10">46.73</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T4.3.11.8.11">1612.2</td>
</tr>
<tr class="ltx_tr" id="Sx3.T4.3.12.9">
<td class="ltx_td ltx_align_left ltx_border_bb" id="Sx3.T4.3.12.9.1">PCK + Selector</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.2">45.77</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.3">1891.8</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.4">18.67</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.5">1869.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.6">57.96</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.7">1552.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.8">50.38</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="Sx3.T4.3.12.9.9">1583.0</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.10">43.20</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T4.3.12.9.11">1724.1</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span> Domain adaption performance on the test dataset. For the PCK method, we do not perform a datastore prune to keep the same datastore scale.
So our selector remarkably improves translation speed for all these <math alttext="k" class="ltx_Math" display="inline" id="Sx3.T4.6.m1.1"><semantics id="Sx3.T4.6.m1.1b"><mi id="Sx3.T4.6.m1.1.1" xref="Sx3.T4.6.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.T4.6.m1.1c"><ci id="Sx3.T4.6.m1.1.1.cmml" xref="Sx3.T4.6.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T4.6.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.T4.6.m1.1e">italic_k</annotation></semantics></math>NN-MT variants.
The larger the size of the datastore and the number of neighbors <math alttext="K" class="ltx_Math" display="inline" id="Sx3.T4.7.m2.1"><semantics id="Sx3.T4.7.m2.1b"><mi id="Sx3.T4.7.m2.1.1" xref="Sx3.T4.7.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="Sx3.T4.7.m2.1c"><ci id="Sx3.T4.7.m2.1.1.cmml" xref="Sx3.T4.7.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T4.7.m2.1d">K</annotation><annotation encoding="application/x-llamapun" id="Sx3.T4.7.m2.1e">italic_K</annotation></semantics></math>, there is the more pronounced the advantage of reducing redundant retrievals. </figcaption>
</figure>
<figure class="ltx_table" id="Sx3.T5">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="Sx3.T5.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="Sx3.T5.1.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="Sx3.T5.1.1.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T5.1.1.1.2">Precision</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T5.1.1.1.3">Recall</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T5.1.1.1.4">Retrieving Ratio</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T5.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="Sx3.T5.1.2.1.1">IT</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T5.1.2.1.2">0.60</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T5.1.2.1.3">0.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T5.1.2.1.4">0.53</td>
</tr>
<tr class="ltx_tr" id="Sx3.T5.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="Sx3.T5.1.3.2.1">Koran</th>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.3.2.2">0.70</td>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.3.2.3">0.78</td>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.3.2.4">0.58</td>
</tr>
<tr class="ltx_tr" id="Sx3.T5.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="Sx3.T5.1.4.3.1">Law</th>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.4.3.2">0.53</td>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.4.3.3">0.81</td>
<td class="ltx_td ltx_align_center" id="Sx3.T5.1.4.3.4">0.48</td>
</tr>
<tr class="ltx_tr" id="Sx3.T5.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="Sx3.T5.1.5.4.1">Medical</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T5.1.5.4.2">0.64</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T5.1.5.4.3">0.80</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T5.1.5.4.4">0.49</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 5: </span>The metrics of the selector.</figcaption>
</figure>
<figure class="ltx_table" id="Sx3.T6">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="Sx3.T6.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="Sx3.T6.1.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="Sx3.T6.1.1.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T6.1.1.1.2">Precision</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T6.1.1.1.3">Recall</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="Sx3.T6.1.1.1.4">Retrieving Ratio</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T6.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="Sx3.T6.1.2.1.1">IT</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T6.1.2.1.2">0.68(+0.08)</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T6.1.2.1.3">0.60(-0.21)</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="Sx3.T6.1.2.1.4">0.35(-0.18)</td>
</tr>
<tr class="ltx_tr" id="Sx3.T6.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="Sx3.T6.1.3.2.1">Koran</th>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.3.2.2">0.76(+0.06)</td>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.3.2.3">0.62(-0.16)</td>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.3.2.4">0.42(-0.16)</td>
</tr>
<tr class="ltx_tr" id="Sx3.T6.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="Sx3.T6.1.4.3.1">Law</th>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.4.3.2">0.58(+0.05)</td>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.4.3.3">0.73(-0.08)</td>
<td class="ltx_td ltx_align_center" id="Sx3.T6.1.4.3.4">0.39(-0.09)</td>
</tr>
<tr class="ltx_tr" id="Sx3.T6.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="Sx3.T6.1.5.4.1">Medical</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T6.1.5.4.2">0.67(+0.03)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T6.1.5.4.3">0.77(-0.04)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="Sx3.T6.1.5.4.4">0.44(-0.05)</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 6: </span>The metrics of the selector trained without translation loss. (+/-*) compares with counterparts in table  <a class="ltx_ref" href="#Sx3.T5" title="Table 5 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">5</span></a>.</figcaption>
</figure>
<figure class="ltx_table" id="Sx3.T7">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="Sx3.T7.3">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="Sx3.T7.3.1.1">
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T7.3.1.1.1">IT</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T7.3.1.1.2">Koran</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T7.3.1.1.3">Law</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="Sx3.T7.3.1.1.4">Medical</td>
</tr>
<tr class="ltx_tr" id="Sx3.T7.3.2.2">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T7.3.2.2.1">41.53(-2.37)</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T7.3.2.2.2">17.91(-0.64)</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T7.3.2.2.3">54.90(-2.28)</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="Sx3.T7.3.2.2.4">47.59(-1.11)</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span> BLEU scores of vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx3.T7.2.m1.1"><semantics id="Sx3.T7.2.m1.1b"><mi id="Sx3.T7.2.m1.1.1" xref="Sx3.T7.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx3.T7.2.m1.1c"><ci id="Sx3.T7.2.m1.1.1.cmml" xref="Sx3.T7.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx3.T7.2.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx3.T7.2.m1.1e">italic_k</annotation></semantics></math>NN-MT involving a selector trained without translation loss. (-*) compares with counterparts in table  <a class="ltx_ref" href="#Sx3.T4" title="Table 4 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a> on the row ’Vanilla + Selector’.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="Sx4">
<h2 class="ltx_title ltx_title_section">Experiments</h2>
<section class="ltx_subsection" id="Sx4.SSx1">
<h3 class="ltx_title ltx_title_subsection">Hyper-parameters</h3>
<div class="ltx_para" id="Sx4.SSx1.p1">
<p class="ltx_p" id="Sx4.SSx1.p1.3">Adopting the WMT19 En-De model  <cite class="ltx_cite ltx_citemacro_citep">(Ng et al. <a class="ltx_ref" href="#bib.bib23" title="">2020</a>)</cite> and freezing its parameters during training, We employ the crucial hyper-parameters interpolating index <math alttext="\lambda" class="ltx_Math" display="inline" id="Sx4.SSx1.p1.1.m1.1"><semantics id="Sx4.SSx1.p1.1.m1.1a"><mi id="Sx4.SSx1.p1.1.m1.1.1" xref="Sx4.SSx1.p1.1.m1.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p1.1.m1.1b"><ci id="Sx4.SSx1.p1.1.m1.1.1.cmml" xref="Sx4.SSx1.p1.1.m1.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p1.1.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p1.1.m1.1d">italic_λ</annotation></semantics></math> and temperature <math alttext="T" class="ltx_Math" display="inline" id="Sx4.SSx1.p1.2.m2.1"><semantics id="Sx4.SSx1.p1.2.m2.1a"><mi id="Sx4.SSx1.p1.2.m2.1.1" xref="Sx4.SSx1.p1.2.m2.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p1.2.m2.1b"><ci id="Sx4.SSx1.p1.2.m2.1.1.cmml" xref="Sx4.SSx1.p1.2.m2.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p1.2.m2.1c">T</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p1.2.m2.1d">italic_T</annotation></semantics></math> the same values in the vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx1.p1.3.m3.1"><semantics id="Sx4.SSx1.p1.3.m3.1a"><mi id="Sx4.SSx1.p1.3.m3.1.1" xref="Sx4.SSx1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p1.3.m3.1b"><ci id="Sx4.SSx1.p1.3.m3.1.1.cmml" xref="Sx4.SSx1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p1.3.m3.1d">italic_k</annotation></semantics></math>NN-MT as table  <a class="ltx_ref" href="#Sx3.T2" title="Table 2 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">2</span></a></p>
</div>
<div class="ltx_para" id="Sx4.SSx1.p2">
<p class="ltx_p" id="Sx4.SSx1.p2.1">As for <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx1.p2.1.m1.1"><semantics id="Sx4.SSx1.p2.1.m1.1a"><mi id="Sx4.SSx1.p2.1.m1.1.1" xref="Sx4.SSx1.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p2.1.m1.1b"><ci id="Sx4.SSx1.p2.1.m1.1.1.cmml" xref="Sx4.SSx1.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p2.1.m1.1d">italic_k</annotation></semantics></math>NN-MT systems with adaptive <span class="ltx_text ltx_font_italic" id="Sx4.SSx1.p2.1.1">Meta-k</span> network, we set the maximum number of neighbors to 4,
and as for others, we form to retrieve fixed 8 nearest neighbors.</p>
</div>
<div class="ltx_para" id="Sx4.SSx1.p3">
<p class="ltx_p" id="Sx4.SSx1.p3.2">We create datastore on the training corpus and train the selector on the valid dataset
of each domain as <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx1.p3.1.m1.1"><semantics id="Sx4.SSx1.p3.1.m1.1a"><mi id="Sx4.SSx1.p3.1.m1.1.1" xref="Sx4.SSx1.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p3.1.m1.1b"><ci id="Sx4.SSx1.p3.1.m1.1.1.cmml" xref="Sx4.SSx1.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p3.1.m1.1d">italic_k</annotation></semantics></math>NN-BOX framework used to do. An Adam optimizer  <cite class="ltx_cite ltx_citemacro_citep">(Kingma and Ba <a class="ltx_ref" href="#bib.bib13" title="">2014</a>)</cite> is used for training
100 epochs with an initial learning rate to be 1e-4.
Temperature <math alttext="\tau" class="ltx_Math" display="inline" id="Sx4.SSx1.p3.2.m2.1"><semantics id="Sx4.SSx1.p3.2.m2.1a"><mi id="Sx4.SSx1.p3.2.m2.1.1" xref="Sx4.SSx1.p3.2.m2.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx1.p3.2.m2.1b"><ci id="Sx4.SSx1.p3.2.m2.1.1.cmml" xref="Sx4.SSx1.p3.2.m2.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx1.p3.2.m2.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx1.p3.2.m2.1d">italic_τ</annotation></semantics></math> for Gumbel-softmax is fixed at 0.1,
more details are reported in the appendix.</p>
</div>
</section>
<section class="ltx_subsection" id="Sx4.SSx2">
<h3 class="ltx_title ltx_title_subsection">Results</h3>
<section class="ltx_subsubsection" id="Sx4.SSx2.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">The selector succeeds in discriminating samples that need retrievals.</h4>
<div class="ltx_para" id="Sx4.SSx2.SSSx1.p1">
<p class="ltx_p" id="Sx4.SSx2.SSSx1.p1.3">Table  <a class="ltx_ref" href="#Sx3.T5" title="Table 5 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">5</span></a> shows the classifying quality of the selector.
These metrics indicate that the selector selects about 50% tokens to retrieve, and about 80% of them genuinely require retrievals. By contrast, if each sample is randomly
predicted, the Recall metric should be only about 50%. According to table  <a class="ltx_ref" href="#Sx1.T1" title="Table 1 ‣ Introduction ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">1</span></a>,
only 16%-33% tokens entail retrievals, but the selector performs much higher Precision metrics,
The results have proven the selector to be effective. Our approach is independent of both retrieving strategy and the datastore. Experiments only test the <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx1.p1.1.m1.1"><semantics id="Sx4.SSx2.SSSx1.p1.1.m1.1a"><mi id="Sx4.SSx2.SSSx1.p1.1.m1.1.1" xref="Sx4.SSx2.SSSx1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx1.p1.1.m1.1b"><ci id="Sx4.SSx2.SSSx1.p1.1.m1.1.1.cmml" xref="Sx4.SSx2.SSSx1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx1.p1.1.m1.1d">italic_k</annotation></semantics></math>NN overhead time reduction after adding the selector to the Vanilla <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx1.p1.2.m2.1"><semantics id="Sx4.SSx2.SSSx1.p1.2.m2.1a"><mi id="Sx4.SSx2.SSSx1.p1.2.m2.1.1" xref="Sx4.SSx2.SSSx1.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx1.p1.2.m2.1b"><ci id="Sx4.SSx2.SSSx1.p1.2.m2.1.1.cmml" xref="Sx4.SSx2.SSSx1.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx1.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx1.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT, but in theory,
there should also be speedups close to table  <a class="ltx_ref" href="#Sx3.T3" title="Table 3 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a> for any other <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx1.p1.3.m3.1"><semantics id="Sx4.SSx2.SSSx1.p1.3.m3.1a"><mi id="Sx4.SSx2.SSSx1.p1.3.m3.1.1" xref="Sx4.SSx2.SSSx1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx1.p1.3.m3.1b"><ci id="Sx4.SSx2.SSSx1.p1.3.m3.1.1.cmml" xref="Sx4.SSx2.SSSx1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx1.p1.3.m3.1d">italic_k</annotation></semantics></math>NN-MT systems.</p>
</div>
</section>
<section class="ltx_subsubsection" id="Sx4.SSx2.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">The selector significantly speeds up existing <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx2.1.m1.1"><semantics id="Sx4.SSx2.SSSx2.1.m1.1b"><mi id="Sx4.SSx2.SSSx2.1.m1.1.1" xref="Sx4.SSx2.SSSx2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx2.1.m1.1c"><ci id="Sx4.SSx2.SSSx2.1.m1.1.1.cmml" xref="Sx4.SSx2.SSSx2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx2.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx2.1.m1.1e">italic_k</annotation></semantics></math>NN-MT system.</h4>
<div class="ltx_para" id="Sx4.SSx2.SSSx2.p1">
<p class="ltx_p" id="Sx4.SSx2.SSSx2.p1.2">Table  <a class="ltx_ref" href="#Sx3.T3" title="Table 3 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a> indicates the selector optmizes 36.7% to 53.3% <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx2.p1.1.m1.1"><semantics id="Sx4.SSx2.SSSx2.p1.1.m1.1a"><mi id="Sx4.SSx2.SSSx2.p1.1.m1.1.1" xref="Sx4.SSx2.SSSx2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx2.p1.1.m1.1b"><ci id="Sx4.SSx2.SSSx2.p1.1.m1.1.1.cmml" xref="Sx4.SSx2.SSSx2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx2.p1.1.m1.1d">italic_k</annotation></semantics></math>NN overhead time.
Table  <a class="ltx_ref" href="#Sx3.T4" title="Table 4 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">4</span></a> represents the translation qualities and inference speed.
With a selector, all other <math alttext="k" class="ltx_Math" display="inline" id="Sx4.SSx2.SSSx2.p1.2.m2.1"><semantics id="Sx4.SSx2.SSSx2.p1.2.m2.1a"><mi id="Sx4.SSx2.SSSx2.p1.2.m2.1.1" xref="Sx4.SSx2.SSSx2.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx4.SSx2.SSSx2.p1.2.m2.1b"><ci id="Sx4.SSx2.SSSx2.p1.2.m2.1.1.cmml" xref="Sx4.SSx2.SSSx2.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx4.SSx2.SSSx2.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx4.SSx2.SSSx2.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT systems gain accelerated.</p>
</div>
</section>
<section class="ltx_subsubsection" id="Sx4.SSx2.SSSx3">
<h4 class="ltx_title ltx_title_subsubsection">Ablation for translation loss.</h4>
<div class="ltx_para" id="Sx4.SSx2.SSSx3.p1">
<p class="ltx_p" id="Sx4.SSx2.SSSx3.p1.1">We also train selectors without translation losses described by Eq.  <a class="ltx_ref" href="#Sx3.E6" title="6 ‣ Training Procedures ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">6</span></a>,
Note that Gumbel-softmax trick is turned off when translation losses are undesired.
the results are present in table  <a class="ltx_ref" href="#Sx3.T6" title="Table 6 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">6</span></a> and table  <a class="ltx_ref" href="#Sx3.T7" title="Table 7 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">7</span></a>.
We observe considerably lower translation quality on all the datasets,
however, remarkable variations of selector metrics occur on the IT and Koran dataset
while slight changes in selector metrics occur on Law and Medical dataset.
It is unclear how these metrics quantitatively affect translation quality,
but we can empirically conclude that translation losses do not, at the very least,
lead to model deterioration.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="Sx5">
<h2 class="ltx_title ltx_title_section">Discussion</h2>
<section class="ltx_subsubsection" id="Sx5.SSx2.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Different implementations of baselines from previous works</h4>
<div class="ltx_para" id="Sx5.SSx2.SSSx1.p1">
<p class="ltx_p" id="Sx5.SSx2.SSSx1.p1.5">It can be seen from table  <a class="ltx_ref" href="#Sx3.T3" title="Table 3 ‣ Integration ‣ Methodolgy ‣ Towards Faster k-Nearest-Neighbor Machine Translation"><span class="ltx_text ltx_ref_tag">3</span></a> that <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx1.p1.1.m1.1"><semantics id="Sx5.SSx2.SSSx1.p1.1.m1.1a"><mi id="Sx5.SSx2.SSSx1.p1.1.m1.1.1" xref="Sx5.SSx2.SSSx1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx1.p1.1.m1.1b"><ci id="Sx5.SSx2.SSSx1.p1.1.m1.1.1.cmml" xref="Sx5.SSx2.SSSx1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx1.p1.1.m1.1d">italic_k</annotation></semantics></math>NN retrievals only take up a small
part of the time in inference time, one reason is that we do not use too large datastore due to hardware limitations,
the other reason is that we adopt the KNN-BOX framework, which remarkably optimizes the retrieving performances as the baseline code implementations,
rather than comparing the results with the code of the original <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx1.p1.2.m2.1"><semantics id="Sx5.SSx2.SSSx1.p1.2.m2.1a"><mi id="Sx5.SSx2.SSSx1.p1.2.m2.1.1" xref="Sx5.SSx2.SSSx1.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx1.p1.2.m2.1b"><ci id="Sx5.SSx2.SSSx1.p1.2.m2.1.1.cmml" xref="Sx5.SSx2.SSSx1.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx1.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx1.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT paper.
Two-orders slower is reported in that paper,
which means <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx1.p1.3.m3.1"><semantics id="Sx5.SSx2.SSSx1.p1.3.m3.1a"><mi id="Sx5.SSx2.SSSx1.p1.3.m3.1.1" xref="Sx5.SSx2.SSSx1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx1.p1.3.m3.1b"><ci id="Sx5.SSx2.SSSx1.p1.3.m3.1.1.cmml" xref="Sx5.SSx2.SSSx1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx1.p1.3.m3.1d">italic_k</annotation></semantics></math>NN retrievals take up almost all the inference time,
therefore, based on the code of the original <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx1.p1.4.m4.1"><semantics id="Sx5.SSx2.SSSx1.p1.4.m4.1a"><mi id="Sx5.SSx2.SSSx1.p1.4.m4.1.1" xref="Sx5.SSx2.SSSx1.p1.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx1.p1.4.m4.1b"><ci id="Sx5.SSx2.SSSx1.p1.4.m4.1.1.cmml" xref="Sx5.SSx2.SSSx1.p1.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx1.p1.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx1.p1.4.m4.1d">italic_k</annotation></semantics></math>NN-MT, the improvements of metrics such as inference time or tokens per second
can be completely considered as an improvement from their methods,
but in our case, we could not do so. Therefore we measure and compare <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx1.p1.5.m5.1"><semantics id="Sx5.SSx2.SSSx1.p1.5.m5.1a"><mi id="Sx5.SSx2.SSSx1.p1.5.m5.1.1" xref="Sx5.SSx2.SSSx1.p1.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx1.p1.5.m5.1b"><ci id="Sx5.SSx2.SSSx1.p1.5.m5.1.1.cmml" xref="Sx5.SSx2.SSSx1.p1.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx1.p1.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx1.p1.5.m5.1d">italic_k</annotation></semantics></math>NN overhead times.</p>
</div>
</section>
<section class="ltx_subsubsection" id="Sx5.SSx2.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">Comments on our method</h4>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p1">
<p class="ltx_p" id="Sx5.SSx2.SSSx2.p1.1">Although the selector performs pretty, there is still room for improvement.
The idealized result is to distinguish all tokens that truly need retrievals and make no futile retrieval.
This motivation and mechanism are clear and explainable, rule-based and statistics-based techniques may help.</p>
</div>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p2">
<p class="ltx_p" id="Sx5.SSx2.SSSx2.p2.1">Reducing undesired retrievals is a promising research direction for fast <math alttext="k" class="ltx_Math" display="inline" id="Sx5.SSx2.SSSx2.p2.1.m1.1"><semantics id="Sx5.SSx2.SSSx2.p2.1.m1.1a"><mi id="Sx5.SSx2.SSSx2.p2.1.m1.1.1" xref="Sx5.SSx2.SSSx2.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx5.SSx2.SSSx2.p2.1.m1.1b"><ci id="Sx5.SSx2.SSSx2.p2.1.m1.1.1.cmml" xref="Sx5.SSx2.SSSx2.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.SSx2.SSSx2.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx5.SSx2.SSSx2.p2.1.m1.1d">italic_k</annotation></semantics></math>NN-MT.</p>
</div>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p3">
<p class="ltx_p" id="Sx5.SSx2.SSSx2.p3.1">Due to unbalanced positive and negative samples, complex and dense latent representations,
it is hard for a simple MLP network to learn strong discrimination,
while more complex models take more time.</p>
</div>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p4">
<p class="ltx_p" id="Sx5.SSx2.SSSx2.p4.1">These efforts have been applied to further improve the selector, but they do not make a difference.</p>
</div>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p5">
<ul class="ltx_itemize" id="Sx5.I4">
<li class="ltx_item" id="Sx5.I4.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx5.I4.i1.p1">
<p class="ltx_p" id="Sx5.I4.i1.p1.2">Use the probability distribution <math alttext="p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})" class="ltx_Math" display="inline" id="Sx5.I4.i1.p1.1.m1.2"><semantics id="Sx5.I4.i1.p1.1.m1.2a"><mrow id="Sx5.I4.i1.p1.1.m1.2.2" xref="Sx5.I4.i1.p1.1.m1.2.2.cmml"><msub id="Sx5.I4.i1.p1.1.m1.2.2.3" xref="Sx5.I4.i1.p1.1.m1.2.2.3.cmml"><mi id="Sx5.I4.i1.p1.1.m1.2.2.3.2" xref="Sx5.I4.i1.p1.1.m1.2.2.3.2.cmml">p</mi><mrow id="Sx5.I4.i1.p1.1.m1.2.2.3.3" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.cmml"><mi id="Sx5.I4.i1.p1.1.m1.2.2.3.3.2" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.2.cmml">M</mi><mo id="Sx5.I4.i1.p1.1.m1.2.2.3.3.1" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.1.cmml">⁢</mo><mi id="Sx5.I4.i1.p1.1.m1.2.2.3.3.3" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.3.cmml">T</mi></mrow></msub><mo id="Sx5.I4.i1.p1.1.m1.2.2.2" xref="Sx5.I4.i1.p1.1.m1.2.2.2.cmml">⁢</mo><mrow id="Sx5.I4.i1.p1.1.m1.2.2.1.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.cmml"><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.2" stretchy="false" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.cmml">(</mo><mrow id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.cmml"><mover accent="true" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.cmml"><msub id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.cmml"><mi id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.2.cmml">y</mi><mi id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.3" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.3.cmml">i</mi></msub><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.2.cmml"><mtext id="Sx5.I4.i1.p1.1.m1.1.1" xref="Sx5.I4.i1.p1.1.m1.1.1a.cmml">𝐱</mtext><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.2.cmml">,</mo><msub id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.cmml"><mtext id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2a.cmml">𝐲</mtext><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.cmml"><mn id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.2.cmml">1</mn><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.1.cmml">:</mo><mrow id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.cmml"><mi id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.2" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.2.cmml">i</mi><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.1" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.1.cmml">−</mo><mn id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.3" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="Sx5.I4.i1.p1.1.m1.2.2.1.1.3" stretchy="false" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Sx5.I4.i1.p1.1.m1.2b"><apply id="Sx5.I4.i1.p1.1.m1.2.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2"><times id="Sx5.I4.i1.p1.1.m1.2.2.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.2"></times><apply id="Sx5.I4.i1.p1.1.m1.2.2.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3"><csymbol cd="ambiguous" id="Sx5.I4.i1.p1.1.m1.2.2.3.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3">subscript</csymbol><ci id="Sx5.I4.i1.p1.1.m1.2.2.3.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3.2">𝑝</ci><apply id="Sx5.I4.i1.p1.1.m1.2.2.3.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3"><times id="Sx5.I4.i1.p1.1.m1.2.2.3.3.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.1"></times><ci id="Sx5.I4.i1.p1.1.m1.2.2.3.3.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.2">𝑀</ci><ci id="Sx5.I4.i1.p1.1.m1.2.2.3.3.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.3.3.3">𝑇</ci></apply></apply><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1"><csymbol cd="latexml" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.2">conditional</csymbol><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3"><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.1">^</ci><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2"><csymbol cd="ambiguous" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2">subscript</csymbol><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.2">𝑦</ci><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.3.2.3">𝑖</ci></apply></apply><list id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1"><ci id="Sx5.I4.i1.p1.1.m1.1.1a.cmml" xref="Sx5.I4.i1.p1.1.m1.1.1"><mtext id="Sx5.I4.i1.p1.1.m1.1.1.cmml" xref="Sx5.I4.i1.p1.1.m1.1.1">𝐱</mtext></ci><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2"><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.1">^</ci><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2a.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2"><mtext id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.2.2">𝐲</mtext></ci></apply><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3"><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.1">:</ci><cn id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.2.cmml" type="integer" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.2">1</cn><apply id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3"><minus id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.1.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.1"></minus><ci id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.2.cmml" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.2">𝑖</ci><cn id="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="Sx5.I4.i1.p1.1.m1.2.2.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Sx5.I4.i1.p1.1.m1.2c">p_{MT}(\hat{y_{i}}|\textbf{x},\hat{\textbf{y}}_{1:i-1})</annotation><annotation encoding="application/x-llamapun" id="Sx5.I4.i1.p1.1.m1.2d">italic_p start_POSTSUBSCRIPT italic_M italic_T end_POSTSUBSCRIPT ( over^ start_ARG italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG | x , over^ start_ARG y end_ARG start_POSTSUBSCRIPT 1 : italic_i - 1 end_POSTSUBSCRIPT )</annotation></semantics></math> given by <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="Sx5.I4.i1.p1.2.m2.1"><semantics id="Sx5.I4.i1.p1.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="Sx5.I4.i1.p1.2.m2.1.1" xref="Sx5.I4.i1.p1.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="Sx5.I4.i1.p1.2.m2.1b"><ci id="Sx5.I4.i1.p1.2.m2.1.1.cmml" xref="Sx5.I4.i1.p1.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx5.I4.i1.p1.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="Sx5.I4.i1.p1.2.m2.1d">caligraphic_M</annotation></semantics></math>
as the input of the selector, which greatly extends the number of parameters of the selector(about 40 times) and does not work.</p>
</div>
</li>
<li class="ltx_item" id="Sx5.I4.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx5.I4.i2.p1">
<p class="ltx_p" id="Sx5.I4.i2.p1.1">Add more one hidden layer in the selector.</p>
</div>
</li>
<li class="ltx_item" id="Sx5.I4.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx5.I4.i3.p1">
<p class="ltx_p" id="Sx5.I4.i3.p1.1">Train the selector on the train set trying to enhance generalization, but it fails to improve metrics.</p>
</div>
</li>
<li class="ltx_item" id="Sx5.I4.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="Sx5.I4.i4.p1">
<p class="ltx_p" id="Sx5.I4.i4.p1.1">Use DiceLoss <cite class="ltx_cite ltx_citemacro_citep">(Li et al. <a class="ltx_ref" href="#bib.bib16" title="">2019</a>)</cite> and FocalLoss <cite class="ltx_cite ltx_citemacro_citep">(Lin et al. <a class="ltx_ref" href="#bib.bib17" title="">2017</a>)</cite> instead of weighted cross-entropy loss.
They cause more fearful overfitting issues, the selector predicts nearly all the tokens to retrieve.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="Sx5.SSx2.SSSx2.p6">
<p class="ltx_p" id="Sx5.SSx2.SSSx2.p6.1">We do not rule out that the last two points are caused by inappropriate hyper-parameters or lack of training ticks.</p>
</div>
</section>
</section>
<section class="ltx_section" id="Sx6">
<h2 class="ltx_title ltx_title_section">Conclusion</h2>
<div class="ltx_para" id="Sx6.p1">
<p class="ltx_p" id="Sx6.p1.3">This paper opens a new idea for faster <math alttext="k" class="ltx_Math" display="inline" id="Sx6.p1.1.m1.1"><semantics id="Sx6.p1.1.m1.1a"><mi id="Sx6.p1.1.m1.1.1" xref="Sx6.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx6.p1.1.m1.1b"><ci id="Sx6.p1.1.m1.1.1.cmml" xref="Sx6.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx6.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx6.p1.1.m1.1d">italic_k</annotation></semantics></math>NN-MT.
We propose a simple yet effective selector to
reduce redundant retrievals. Experiment results on four
benchmark datasets show that the selector remarkably speeds up
other <math alttext="k" class="ltx_Math" display="inline" id="Sx6.p1.2.m2.1"><semantics id="Sx6.p1.2.m2.1a"><mi id="Sx6.p1.2.m2.1.1" xref="Sx6.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx6.p1.2.m2.1b"><ci id="Sx6.p1.2.m2.1.1.cmml" xref="Sx6.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx6.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx6.p1.2.m2.1d">italic_k</annotation></semantics></math>NN-MT systems and keeps acceptable translation qualities.
The limitation is that it could not outperform the depending <math alttext="k" class="ltx_Math" display="inline" id="Sx6.p1.3.m3.1"><semantics id="Sx6.p1.3.m3.1a"><mi id="Sx6.p1.3.m3.1.1" xref="Sx6.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="Sx6.p1.3.m3.1b"><ci id="Sx6.p1.3.m3.1.1.cmml" xref="Sx6.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="Sx6.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="Sx6.p1.3.m3.1d">italic_k</annotation></semantics></math>NN-MT system in translation quality.
Future work could further investigate the characteristics
of hidden representations from neural models of out-domain tokens to identify out-domain features better.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Aharoni and Goldberg (2020)</span>
<span class="ltx_bibblock">
Aharoni, R.; and Goldberg, Y. 2020.

</span>
<span class="ltx_bibblock">Unsupervised Domain Clusters in Pretrained Language Models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">Proceedings of the 58th Annual Meeting of the Association
for Computational Linguistics</em>. Online: Association for Computational
Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bahdanau, Cho, and Bengio (2015)</span>
<span class="ltx_bibblock">
Bahdanau, D.; Cho, K.; and Bengio, Y. 2015.

</span>
<span class="ltx_bibblock">Neural Machine Translation By Jointly Learning To Align And
Translate.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">International Conference on Learning Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cao et al. (2023)</span>
<span class="ltx_bibblock">
Cao, Z.; Yang, B.; Lin, H.; Wu, S.; Wei, X.; Liu, D.; Xie, J.; Zhang, M.; and
Su, J. 2023.

</span>
<span class="ltx_bibblock">Bridging the Domain Gaps in Context Representations for <math alttext="k" class="ltx_Math" display="inline" id="bib.bib3.1.m1.1"><semantics id="bib.bib3.1.m1.1a"><mi id="bib.bib3.1.m1.1.1" xref="bib.bib3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="bib.bib3.1.m1.1b"><ci id="bib.bib3.1.m1.1.1.cmml" xref="bib.bib3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="bib.bib3.1.m1.1d">italic_k</annotation></semantics></math>-Nearest
Neighbor Neural Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib3.2.1">Proceedings of the 61st Annual Meeting of the Association
for Computational Linguistics (Volume 1: Long Papers)</em>, 5841–5853. Toronto,
Canada: Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chu and Wang (2018)</span>
<span class="ltx_bibblock">
Chu, C.; and Wang, R. 2018.

</span>
<span class="ltx_bibblock">A Survey of Domain Adaptation for Neural Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Proceedings of the 27th International Conference on
Computational Linguistics</em>, 1304–1319. Santa Fe, New Mexico, USA:
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dai et al. (2023)</span>
<span class="ltx_bibblock">
Dai, Y.; Zhang, Z.; Liu, Q.; Cui, Q.; Li, W.; Du, Y.; and Xu, T. 2023.

</span>
<span class="ltx_bibblock">Simple and Scalable Nearest Neighbor Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">The Eleventh International Conference on Learning
Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Devlin et al. (2019)</span>
<span class="ltx_bibblock">
Devlin, J.; Chang, M.-W.; Lee, K.; and Toutanova, K. 2019.

</span>
<span class="ltx_bibblock">BERT: Pre-training of Deep Bidirectional Transformers for Language
Understanding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Proceedings of the 2019 Conference of the North American
Chapter of the Association for Computational Linguistics: Human Language
Technologies, Volume 1 (Long and Short Papers)</em>. Minneapolis, Minnesota:
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Farajian et al. (2017)</span>
<span class="ltx_bibblock">
Farajian, M. A.; Turchi, M.; Negri, M.; and Federico, M. 2017.

</span>
<span class="ltx_bibblock">Multi-Domain Neural Machine Translation through Unsupervised
Adaptation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the Second Conference on Machine
Translation</em>, 127–137. Copenhagen, Denmark: Association for Computational
Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gu et al. (2018)</span>
<span class="ltx_bibblock">
Gu, J.; Wang, Y.; Cho, K.; and Li, V. O. 2018.

</span>
<span class="ltx_bibblock">Search engine guided neural machine translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">Proceedings of the AAAI Conference on Artificial
Intelligence</em>, volume 32.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jang, Gu, and Poole (2016)</span>
<span class="ltx_bibblock">
Jang, E.; Gu, S.; and Poole, B. 2016.

</span>
<span class="ltx_bibblock">Categorical reparameterization with gumbel-softmax.

</span>
<span class="ltx_bibblock">arXiv:1611.01144.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Johnson, Douze, and Jégou (2019)</span>
<span class="ltx_bibblock">
Johnson, J.; Douze, M.; and Jégou, H. 2019.

</span>
<span class="ltx_bibblock">Billion-scale similarity search with GPUs.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">IEEE Transactions on Big Data</em>, 7(3): 535–547.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kassner and Schütze (2020)</span>
<span class="ltx_bibblock">
Kassner, N.; and Schütze, H. 2020.

</span>
<span class="ltx_bibblock">BERT-kNN: Adding a kNN Search Component to Pretrained Language
Models for Better QA.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Findings of the Association for Computational Linguistics:
EMNLP 2020</em>. Online: Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khandelwal et al. (2021)</span>
<span class="ltx_bibblock">
Khandelwal, U.; Fan, A.; Jurafsky, D.; Zettlemoyer, L.; and Lewis, M. 2021.

</span>
<span class="ltx_bibblock">Nearest Neighbor Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">International Conference on Learning Representations</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma and Ba (2014)</span>
<span class="ltx_bibblock">
Kingma, D. P.; and Ba, J. 2014.

</span>
<span class="ltx_bibblock">Adam: A method for stochastic optimization.

</span>
<span class="ltx_bibblock">arXiv:1412.6980.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Koehn and Knowles (2017)</span>
<span class="ltx_bibblock">
Koehn, P.; and Knowles, R. 2017.

</span>
<span class="ltx_bibblock">Six Challenges for Neural Machine Translation.

</span>
<span class="ltx_bibblock">arXiv:1706.03872.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al. (2020)</span>
<span class="ltx_bibblock">
Lewis, P.; Perez, E.; Piktus, A.; Petroni, F.; Karpukhin, V.; Goyal, N.;
Küttler, H.; Lewis, M.; Yih, W.-t.; Rocktäschel, T.; Riedel, S.; and
Kiela, D. 2020.

</span>
<span class="ltx_bibblock">Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks.

</span>
<span class="ltx_bibblock">In Larochelle, H.; Ranzato, M.; Hadsell, R.; Balcan, M.; and Lin, H.,
eds., <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Advances in Neural Information Processing Systems</em>, volume 33,
9459–9474. Curran Associates, Inc.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2019)</span>
<span class="ltx_bibblock">
Li, X.; Sun, X.; Meng, Y.; Liang, J.; Wu, F.; and Li, J. 2019.

</span>
<span class="ltx_bibblock">Dice loss for data-imbalanced NLP tasks.

</span>
<span class="ltx_bibblock">arXiv:1911.02855.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. (2017)</span>
<span class="ltx_bibblock">
Lin, T.-Y.; Goyal, P.; Girshick, R.; He, K.; and Dollár, P. 2017.

</span>
<span class="ltx_bibblock">Focal loss for dense object detection.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Proceedings of the IEEE international conference on computer
vision</em>, 2980–2988.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. (2021)</span>
<span class="ltx_bibblock">
Lin, Z.; Wu, L.; Wang, M.; and Li, L. 2021.

</span>
<span class="ltx_bibblock">Learning Language Specific Sub-network for Multilingual Machine
Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Proceedings of the 59th Annual Meeting of the Association
for Computational Linguistics and the 11th International Joint Conference on
Natural Language Processing (Volume 1: Long Papers)</em>. Online: Association for
Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Martins, Marinho, and Martins (2022)</span>
<span class="ltx_bibblock">
Martins, P.; Marinho, Z.; and Martins, A. 2022.

</span>
<span class="ltx_bibblock">Efficient Machine Translation Domain Adaptation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Proceedings of the 1st Workshop on Semiparametric Methods in
NLP: Decoupling Logic from Knowledge</em>, 23–29. Dublin, Ireland and Online:
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">McCloskey and Cohen (1989)</span>
<span class="ltx_bibblock">
McCloskey, M.; and Cohen, N. J. 1989.

</span>
<span class="ltx_bibblock">Catastrophic Interference in Connectionist Networks: The Sequential
Learning Problem.

</span>
<span class="ltx_bibblock">volume 24 of <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">Psychology of Learning and Motivation</em>, 109–165.
Academic Press.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Meng et al. (2022)</span>
<span class="ltx_bibblock">
Meng, Y.; Li, X.; Zheng, X.; Wu, F.; Sun, X.; Zhang, T.; and Li, J. 2022.

</span>
<span class="ltx_bibblock">Fast Nearest Neighbor Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">Findings of the Association for Computational Linguistics:
ACL 2022</em>. Dublin, Ireland: Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mnih et al. (2014)</span>
<span class="ltx_bibblock">
Mnih, V.; Heess, N.; Graves, A.; et al. 2014.

</span>
<span class="ltx_bibblock">Recurrent models of visual attention.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">Advances in neural information processing systems</em>, 27.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ng et al. (2020)</span>
<span class="ltx_bibblock">
Ng, N.; Yee, K.; Baevski, A.; Ott, M.; Auli, M.; and Edunov, S. 2020.

</span>
<span class="ltx_bibblock">Facebook FAIR’s WMT19 News Translation Task Submission.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">Proc. of WMT</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pham, Crego, and Yvon (2021)</span>
<span class="ltx_bibblock">
Pham, M.; Crego, J. M.; and Yvon, F. 2021.

</span>
<span class="ltx_bibblock">Revisiting Multi-Domain Machine Translation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Transactions of the Association for Computational Linguistics</em>,
9.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Post (2018)</span>
<span class="ltx_bibblock">
Post, M. 2018.

</span>
<span class="ltx_bibblock">A Call for Clarity in Reporting BLEU Scores.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Proceedings of the Third Conference on Machine Translation:
Research Papers</em>, 186–191. Belgium, Brussels: Association for Computational
Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Santoro et al. (2016)</span>
<span class="ltx_bibblock">
Santoro, A.; Bartunov, S.; Botvinick, M.; Wierstra, D.; and Lillicrap, T. 2016.

</span>
<span class="ltx_bibblock">One-shot Learning with Memory-Augmented Neural Networks.

</span>
<span class="ltx_bibblock">arXiv:1605.06065.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sutskever, Vinyals, and Le (2014)</span>
<span class="ltx_bibblock">
Sutskever, I.; Vinyals, O.; and Le, Q. V. 2014.

</span>
<span class="ltx_bibblock">Sequence to Sequence Learning with Neural Networks.

</span>
<span class="ltx_bibblock">In Ghahramani, Z.; Welling, M.; Cortes, C.; Lawrence, N.; and
Weinberger, K., eds., <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">Advances in Neural Information Processing
Systems</em>, volume 27. Curran Associates, Inc.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Vaswani, A.; Shazeer, N.; Parmar, N.; Uszkoreit, J.; Jones, L.; Gomez, A. N.;
Kaiser, L. u.; and Polosukhin, I. 2017.

</span>
<span class="ltx_bibblock">Attention Is All You Need.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Advances in Neural Information Processing Systems</em>,
volume 30.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2022)</span>
<span class="ltx_bibblock">
Wang, D.; Fan, K.; Chen, B.; and Xiong, D. 2022.

</span>
<span class="ltx_bibblock">Efficient Cluster-Based <math alttext="k" class="ltx_Math" display="inline" id="bib.bib29.1.m1.1"><semantics id="bib.bib29.1.m1.1a"><mi id="bib.bib29.1.m1.1.1" xref="bib.bib29.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="bib.bib29.1.m1.1b"><ci id="bib.bib29.1.m1.1.1.cmml" xref="bib.bib29.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib29.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="bib.bib29.1.m1.1d">italic_k</annotation></semantics></math>-Nearest-Neighbor Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib29.2.1">Proceedings of the 60th Annual Meeting of the Association
for Computational Linguistics (Volume 1: Long Papers)</em>. Dublin, Ireland:
Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Weston, Dinan, and Miller (2018)</span>
<span class="ltx_bibblock">
Weston, J.; Dinan, E.; and Miller, A. 2018.

</span>
<span class="ltx_bibblock">Retrieve and Refine: Improved Sequence Generation Models For
Dialogue.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">Proceedings of the 2018 EMNLP Workshop SCAI: The 2nd
International Workshop on Search-Oriented Conversational AI</em>. Brussels,
Belgium: Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al. (2021)</span>
<span class="ltx_bibblock">
Zheng, X.; Zhang, Z.; Guo, J.; Huang, S.; Chen, B.; Luo, W.; and Chen, J. 2021.

</span>
<span class="ltx_bibblock">Adaptive Nearest Neighbor Machine Translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">Proceedings of the 59th Annual Meeting of the Association
for Computational Linguistics and the 11th International Joint Conference on
Natural Language Processing (Volume 2: Short Papers)</em>. Online: Association
for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhu et al. (2023)</span>
<span class="ltx_bibblock">
Zhu, W.; Zhao, Q.; Lv, Y.; Huang, S.; Zhao, S.; Liu, S.; and Chen, J. 2023.

</span>
<span class="ltx_bibblock">kNN-BOX: A Unified Framework for Nearest Neighbor Generation.

</span>
<span class="ltx_bibblock">arXiv:2302.13574.

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Dec 12 16:37:04 2023 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span style="font-size:70%;position:relative; bottom:2.2pt;">A</span>T<span style="position:relative; bottom:-0.4ex;">E</span></span><span class="ltx_font_smallcaps">xml</span><img alt="[LOGO]" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
