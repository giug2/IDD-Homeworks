<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>[2409.13221] RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion</title><meta property="og:description" content="Reinforcement Learning from Human Feedback (RLHF) enhances the alignment between LLMs and human preference. The workflow of RLHF
typically involves several models and tasks in a series of distinct stages.
Existing RLHF…">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion">
<meta name="twitter:image:src" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta name="twitter:image:alt" content="ar5iv logo">
<meta property="og:title" content="RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion">
<meta property="og:site_name" content="ar5iv">
<meta property="og:image" content="https://ar5iv.labs.arxiv.org/assets/ar5iv_card.png">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ar5iv.labs.arxiv.org/html/2409.13221">

<!--Generated on Sat Oct  5 19:22:57 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script>
  function detectColorScheme(){
    var theme="light";
    var current_theme = localStorage.getItem("ar5iv_theme");
    if(current_theme){
      if(current_theme == "dark"){
        theme = "dark";
      } }
    else if(!window.matchMedia) { return false; }
    else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
      theme = "dark"; }
    if (theme=="dark") {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.setAttribute("data-theme", "light"); } }

  detectColorScheme();

  function toggleColorScheme(){
    var current_theme = localStorage.getItem("ar5iv_theme");
    if (current_theme) {
      if (current_theme == "light") {
        localStorage.setItem("ar5iv_theme", "dark"); }
      else {
        localStorage.setItem("ar5iv_theme", "light"); } }
    else {
        localStorage.setItem("ar5iv_theme", "dark"); }
    detectColorScheme(); }
</script>
<link media="all" rel="stylesheet" href="/assets/ar5iv-fonts.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv.0.8.0.min.css"><link media="all" rel="stylesheet" href="/assets/ar5iv-site.0.2.2.css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<div id="p1" class="ltx_para">
<span id="p1.1" class="ltx_ERROR undefined">\svgsetup</span>
<p id="p1.2" class="ltx_p">inkscapepath=i/svg-inkscape/

<span id="p1.2.1" class="ltx_ERROR undefined">\svgpath</span>svg/


























</p>
</div>
<h1 class="ltx_title ltx_title_document">RLHFuse: Efficient RLHF Training for Large Language Models 
<br class="ltx_break">with Inter- and Intra-Stage Fusion</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">

Yinmin Zhong<math id="id1.1.m1.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id1.1.m1.1a"><msup id="id1.1.m1.1.1" xref="id1.1.m1.1.1.cmml"><mi id="id1.1.m1.1.1a" xref="id1.1.m1.1.1.cmml"></mi><mtext id="id1.1.m1.1.1.1" xref="id1.1.m1.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id1.1.m1.1b"><apply id="id1.1.m1.1.1.cmml" xref="id1.1.m1.1.1"><ci id="id1.1.m1.1.1.1a.cmml" xref="id1.1.m1.1.1.1"><mtext mathsize="70%" id="id1.1.m1.1.1.1.cmml" xref="id1.1.m1.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id1.1.m1.1c">{}^{\text{1}}</annotation></semantics></math>  Zili Zhang<math id="id2.2.m2.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id2.2.m2.1a"><msup id="id2.2.m2.1.1" xref="id2.2.m2.1.1.cmml"><mi id="id2.2.m2.1.1a" xref="id2.2.m2.1.1.cmml"></mi><mtext id="id2.2.m2.1.1.1" xref="id2.2.m2.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id2.2.m2.1b"><apply id="id2.2.m2.1.1.cmml" xref="id2.2.m2.1.1"><ci id="id2.2.m2.1.1.1a.cmml" xref="id2.2.m2.1.1.1"><mtext mathsize="70%" id="id2.2.m2.1.1.1.cmml" xref="id2.2.m2.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id2.2.m2.1c">{}^{\text{1}}</annotation></semantics></math>  Bingyang Wu<math id="id3.3.m3.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id3.3.m3.1a"><msup id="id3.3.m3.1.1" xref="id3.3.m3.1.1.cmml"><mi id="id3.3.m3.1.1a" xref="id3.3.m3.1.1.cmml"></mi><mtext id="id3.3.m3.1.1.1" xref="id3.3.m3.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id3.3.m3.1b"><apply id="id3.3.m3.1.1.cmml" xref="id3.3.m3.1.1"><ci id="id3.3.m3.1.1.1a.cmml" xref="id3.3.m3.1.1.1"><mtext mathsize="70%" id="id3.3.m3.1.1.1.cmml" xref="id3.3.m3.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id3.3.m3.1c">{}^{\text{1}}</annotation></semantics></math>  Shengyu Liu<math id="id4.4.m4.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id4.4.m4.1a"><msup id="id4.4.m4.1.1" xref="id4.4.m4.1.1.cmml"><mi id="id4.4.m4.1.1a" xref="id4.4.m4.1.1.cmml"></mi><mtext id="id4.4.m4.1.1.1" xref="id4.4.m4.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id4.4.m4.1b"><apply id="id4.4.m4.1.1.cmml" xref="id4.4.m4.1.1"><ci id="id4.4.m4.1.1.1a.cmml" xref="id4.4.m4.1.1.1"><mtext mathsize="70%" id="id4.4.m4.1.1.1.cmml" xref="id4.4.m4.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id4.4.m4.1c">{}^{\text{1}}</annotation></semantics></math>  Yukun Chen<math id="id5.5.m5.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id5.5.m5.1a"><msup id="id5.5.m5.1.1" xref="id5.5.m5.1.1.cmml"><mi id="id5.5.m5.1.1a" xref="id5.5.m5.1.1.cmml"></mi><mtext id="id5.5.m5.1.1.1" xref="id5.5.m5.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id5.5.m5.1b"><apply id="id5.5.m5.1.1.cmml" xref="id5.5.m5.1.1"><ci id="id5.5.m5.1.1.1a.cmml" xref="id5.5.m5.1.1.1"><mtext mathsize="70%" id="id5.5.m5.1.1.1.cmml" xref="id5.5.m5.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id5.5.m5.1c">{}^{\text{2}}</annotation></semantics></math>  


<br class="ltx_break">
Changyi Wan<math id="id6.6.m6.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id6.6.m6.1a"><msup id="id6.6.m6.1.1" xref="id6.6.m6.1.1.cmml"><mi id="id6.6.m6.1.1a" xref="id6.6.m6.1.1.cmml"></mi><mtext id="id6.6.m6.1.1.1" xref="id6.6.m6.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id6.6.m6.1b"><apply id="id6.6.m6.1.1.cmml" xref="id6.6.m6.1.1"><ci id="id6.6.m6.1.1.1a.cmml" xref="id6.6.m6.1.1.1"><mtext mathsize="70%" id="id6.6.m6.1.1.1.cmml" xref="id6.6.m6.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id6.6.m6.1c">{}^{\text{2}}</annotation></semantics></math>  Hanpeng Hu<math id="id7.7.m7.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id7.7.m7.1a"><msup id="id7.7.m7.1.1" xref="id7.7.m7.1.1.cmml"><mi id="id7.7.m7.1.1a" xref="id7.7.m7.1.1.cmml"></mi><mtext id="id7.7.m7.1.1.1" xref="id7.7.m7.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id7.7.m7.1b"><apply id="id7.7.m7.1.1.cmml" xref="id7.7.m7.1.1"><ci id="id7.7.m7.1.1.1a.cmml" xref="id7.7.m7.1.1.1"><mtext mathsize="70%" id="id7.7.m7.1.1.1.cmml" xref="id7.7.m7.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id7.7.m7.1c">{}^{\text{2}}</annotation></semantics></math>  Lei Xia<math id="id8.8.m8.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id8.8.m8.1a"><msup id="id8.8.m8.1.1" xref="id8.8.m8.1.1.cmml"><mi id="id8.8.m8.1.1a" xref="id8.8.m8.1.1.cmml"></mi><mtext id="id8.8.m8.1.1.1" xref="id8.8.m8.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id8.8.m8.1b"><apply id="id8.8.m8.1.1.cmml" xref="id8.8.m8.1.1"><ci id="id8.8.m8.1.1.1a.cmml" xref="id8.8.m8.1.1.1"><mtext mathsize="70%" id="id8.8.m8.1.1.1.cmml" xref="id8.8.m8.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id8.8.m8.1c">{}^{\text{2}}</annotation></semantics></math>  Ranchen Ming<math id="id9.9.m9.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id9.9.m9.1a"><msup id="id9.9.m9.1.1" xref="id9.9.m9.1.1.cmml"><mi id="id9.9.m9.1.1a" xref="id9.9.m9.1.1.cmml"></mi><mtext id="id9.9.m9.1.1.1" xref="id9.9.m9.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id9.9.m9.1b"><apply id="id9.9.m9.1.1.cmml" xref="id9.9.m9.1.1"><ci id="id9.9.m9.1.1.1a.cmml" xref="id9.9.m9.1.1.1"><mtext mathsize="70%" id="id9.9.m9.1.1.1.cmml" xref="id9.9.m9.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id9.9.m9.1c">{}^{\text{2}}</annotation></semantics></math>  Yibo Zhu<math id="id10.10.m10.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id10.10.m10.1a"><msup id="id10.10.m10.1.1" xref="id10.10.m10.1.1.cmml"><mi id="id10.10.m10.1.1a" xref="id10.10.m10.1.1.cmml"></mi><mtext id="id10.10.m10.1.1.1" xref="id10.10.m10.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id10.10.m10.1b"><apply id="id10.10.m10.1.1.cmml" xref="id10.10.m10.1.1"><ci id="id10.10.m10.1.1.1a.cmml" xref="id10.10.m10.1.1.1"><mtext mathsize="70%" id="id10.10.m10.1.1.1.cmml" xref="id10.10.m10.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id10.10.m10.1c">{}^{\text{2}}</annotation></semantics></math>  Xin Jin<math id="id11.11.m11.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id11.11.m11.1a"><msup id="id11.11.m11.1.1" xref="id11.11.m11.1.1.cmml"><mi id="id11.11.m11.1.1a" xref="id11.11.m11.1.1.cmml"></mi><mtext id="id11.11.m11.1.1.1" xref="id11.11.m11.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id11.11.m11.1b"><apply id="id11.11.m11.1.1.cmml" xref="id11.11.m11.1.1"><ci id="id11.11.m11.1.1.1a.cmml" xref="id11.11.m11.1.1.1"><mtext mathsize="70%" id="id11.11.m11.1.1.1.cmml" xref="id11.11.m11.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id11.11.m11.1c">{}^{\text{1}}</annotation></semantics></math>  

<br class="ltx_break">
<math id="id12.12.m12.1" class="ltx_Math" alttext="{}^{\text{1}}" display="inline"><semantics id="id12.12.m12.1a"><msup id="id12.12.m12.1.1" xref="id12.12.m12.1.1.cmml"><mi id="id12.12.m12.1.1a" xref="id12.12.m12.1.1.cmml"></mi><mtext id="id12.12.m12.1.1.1" xref="id12.12.m12.1.1.1a.cmml">1</mtext></msup><annotation-xml encoding="MathML-Content" id="id12.12.m12.1b"><apply id="id12.12.m12.1.1.cmml" xref="id12.12.m12.1.1"><ci id="id12.12.m12.1.1.1a.cmml" xref="id12.12.m12.1.1.1"><mtext mathsize="70%" id="id12.12.m12.1.1.1.cmml" xref="id12.12.m12.1.1.1">1</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id12.12.m12.1c">{}^{\text{1}}</annotation></semantics></math><span id="id15.14.id1" class="ltx_text ltx_font_italic">Peking University</span> <math id="id13.13.m13.1" class="ltx_Math" alttext="{}^{\text{2}}" display="inline"><semantics id="id13.13.m13.1a"><msup id="id13.13.m13.1.1" xref="id13.13.m13.1.1.cmml"><mi id="id13.13.m13.1.1a" xref="id13.13.m13.1.1.cmml"></mi><mtext id="id13.13.m13.1.1.1" xref="id13.13.m13.1.1.1a.cmml">2</mtext></msup><annotation-xml encoding="MathML-Content" id="id13.13.m13.1b"><apply id="id13.13.m13.1.1.cmml" xref="id13.13.m13.1.1"><ci id="id13.13.m13.1.1.1a.cmml" xref="id13.13.m13.1.1.1"><mtext mathsize="70%" id="id13.13.m13.1.1.1.cmml" xref="id13.13.m13.1.1.1">2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id13.13.m13.1c">{}^{\text{2}}</annotation></semantics></math><span id="id16.15.id2" class="ltx_text ltx_font_italic">StepFun</span>
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation">
</span></span></span>
</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p id="id17.id1" class="ltx_p">Reinforcement Learning from Human Feedback (RLHF) enhances the alignment between LLMs and human preference. The workflow of RLHF
typically involves several models and tasks in a series of distinct stages.
Existing RLHF training systems view each task as the smallest execution unit and
thus overlooking the opportunities for subtask-level optimizations.
Due to the intrinsic nature of RLHF training, <span id="id17.id1.1" class="ltx_text ltx_font_italic">i.e.</span>, the data skewness in the generation stage, and the pipeline bubbles in the training stage, existing RLHF systems
suffer from low GPU utilization in production deployments.</p>
<p id="id14.1" class="ltx_p">RLHFuse breaks the traditional view of RLHF workflow as a composition of individual tasks, splitting each task into finer-grained subtasks, and performs <span id="id14.1.1" class="ltx_text ltx_font_italic">stage fusion</span> to improve GPU utilization.
RLHFuse contains two key ideas.
First, for generation and inference tasks, RLHFuse splits them into
sample-level subtasks, enabling efficient <span id="id14.1.2" class="ltx_text ltx_font_italic">inter-stage fusion</span> to mitigate the
original generation bottleneck dominated by long-tailed samples.
Second, for training tasks, RLHFuse breaks them into subtasks of micro-batches.
By leveraging the intuition that pipeline execution can be essentially complemented by another pipeline,
RLHFuse performs <span id="id14.1.3" class="ltx_text ltx_font_italic">intra-stage fusion</span> to concurrently execute these subtasks in the training stage
with a fused pipeline schedule, resulting in fewer pipeline bubbles.
In addition, RLHFuse incorporates a series of system optimizations tailored for each stage of RLHF, making it efficient and scalable for our internal product usage.
We evaluate RLHFuse on various popular LLMs and the results show that RLHFuse increases the
training throughput by up to <math id="id14.1.m1.1" class="ltx_math_unparsed" alttext="3.7\times" display="inline"><semantics id="id14.1.m1.1a"><mrow id="id14.1.m1.1b"><mn id="id14.1.m1.1.1">3.7</mn><mo lspace="0.222em" id="id14.1.m1.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="id14.1.m1.1c">3.7\times</annotation></semantics></math>, compared to existing state-of-the-art systems.</p>
</div>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>

<figure id="S1.F1" class="ltx_figure"><img src="/html/2409.13221/assets/x1.png" id="S1.F1.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="164" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S1.F1.2.1.1" class="ltx_text" style="font-size:90%;">Figure 1</span>: </span><span id="S1.F1.3.2" class="ltx_text" style="font-size:90%;">RLHF iteration breakdown of existing frameworks.</span></figcaption>
</figure>
<div id="S1.p1" class="ltx_para">
<p id="S1.p1.1" class="ltx_p">The rise of Large Language Models (LLMs) marks a revolutionary leap in
generative AI.
From search engines <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib1" title="" class="ltx_ref">1</a>]</cite> to
personal assistants <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib2" title="" class="ltx_ref">2</a>]</cite>, and from operating systems <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib3" title="" class="ltx_ref">3</a>]</cite> to
embodied AI <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib4" title="" class="ltx_ref">4</a>]</cite>, LLMs are redefining what is possible,
opening up new frontiers and possibilities.
Despite the impressive capabilities of LLMs, concerns around their safety, robustness, and reliability have been at the forefront since their inception.
Many studies <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib5" title="" class="ltx_ref">5</a>, <a href="#bib.bib6" title="" class="ltx_ref">6</a>, <a href="#bib.bib7" title="" class="ltx_ref">7</a>]</cite> have shown that LLMs often display unintended behaviors,
such as fabricating facts, generating biased or toxic content,
or failing to adhere to user instructions.
To address these issues,
Reinforcement Learning from Human Feedback (RLHF) <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib8" title="" class="ltx_ref">8</a>]</cite> has been introduced,
aiming to align LLMs with human intent after pre-training.
With a concrete and well-defined reward target,
RLHF enhances the ability of LLMs in multiple domains,
including following instructions, suppressing hallucinations,
and improving overall safety. It is known to be the key driving force behind
the evolution of GPT-3 <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib9" title="" class="ltx_ref">9</a>]</cite> into ChatGPT <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib2" title="" class="ltx_ref">2</a>]</cite>, and
almost all the leading LLMs <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib10" title="" class="ltx_ref">10</a>, <a href="#bib.bib11" title="" class="ltx_ref">11</a>, <a href="#bib.bib12" title="" class="ltx_ref">12</a>]</cite> incorporate RLHF to boost their model performance.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p id="S1.p2.1" class="ltx_p">Unlike pre-training, RLHF training is significantly more complex in terms of system design, since it involves four different LLMs, three stages, and six tasks in total.
As shown in Figure <a href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>,
each iteration begins with the
<span id="S1.p2.1.1" class="ltx_text ltx_font_typewriter">Actor</span> model, which generates
responses to a batch of input prompts
(known as the generation stage). These responses
are then passed to
the <span id="S1.p2.1.2" class="ltx_text ltx_font_typewriter">Reference</span>, <span id="S1.p2.1.3" class="ltx_text ltx_font_typewriter">Critic</span>, and <span id="S1.p2.1.4" class="ltx_text ltx_font_typewriter">Reward</span> model for processing, during the inference stage. Finally, the <span id="S1.p2.1.5" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S1.p2.1.6" class="ltx_text ltx_font_typewriter">Critic</span> models
compute loss and update their parameters,
completing the training stage. The data and weight dependencies create synchronization boundaries between stages.</p>
</div>
<div id="S1.p3" class="ltx_para">
<p id="S1.p3.1" class="ltx_p">To enable efficient training of RLHF, existing frameworks have proposed a
series of optimizations, such as selecting tailored parallel
strategies for each task <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>
and optimizing the data exchange during stage transitions <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib14" title="" class="ltx_ref">14</a>]</cite>.
However, these techniques <span id="S1.p3.1.1" class="ltx_text ltx_font_italic">fundamentally treat the RLHF workflow as a
simple composition of individual tasks</span>, failing to delve into the inherent
characteristics and structure inside the tasks, thereby missing
significant optimization opportunities. In production deployments, we have observed two issues
within current frameworks that severely impact training efficiency,
as indicated by the grey area in Figure <a href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<div id="S1.p4" class="ltx_para">
<p id="S1.p4.1" class="ltx_p">The first issue arises from the <span id="S1.p4.1.1" class="ltx_text ltx_font_italic">data skewness</span> in the generation stage,
where the output length of generated samples follows a long-tailed distribution.
This phenomenon is broadly observed during LLM generation (§<a href="#S2.SS2" title="2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2.2</span></a>)
and this data diversity is critical to the robustness of RL training.
As a result, the generation time is dominated by the longest sample
as shown in Figure <a href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>. During the latter part of the generation stage,
the GPUs remain idle or are engaged in processing
only a small number of long-tailed samples. Due to data dependencies,
the inference tasks cannot start in advance, leading to low GPU utilization.
Making the problem even worse, as the maximum output length of LLMs
continues to grow <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib15" title="" class="ltx_ref">15</a>]</cite>, this long-tail phenomenon will become more significant.</p>
</div>
<div id="S1.p5" class="ltx_para">
<p id="S1.p5.1" class="ltx_p">The second issue stems from the <span id="S1.p5.1.1" class="ltx_text ltx_font_italic">pipeline bubbles</span> in the training stage.
With the explosive growth in the size of LLMs, higher pipeline parallelism (PP) is needed to scale
training. When LLMs reach hundreds of billions of parameters,
it is quite common for PP size to reach a few dozen <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>, <a href="#bib.bib17" title="" class="ltx_ref">17</a>]</cite>.
However, the proportion of pipeline bubbles increases with PP size, significantly reducing
training efficiency. In RLHF, there are two training tasks, each may evolve a specific LLM
with hundreds of billions of parameters, which amplifies this inefficiency.
Despite that various approaches have been proposed
to reduce pipeline bubbles when training individual models <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib18" title="" class="ltx_ref">18</a>, <a href="#bib.bib19" title="" class="ltx_ref">19</a>, <a href="#bib.bib20" title="" class="ltx_ref">20</a>, <a href="#bib.bib21" title="" class="ltx_ref">21</a>]</cite>,
the remaining bubbles still pose a significant challenge under synchronous training semantics.</p>
</div>
<div id="S1.p6" class="ltx_para">
<p id="S1.p6.1" class="ltx_p">To this end, we propose RLHFuse, the first work to employ subtask-level
optimizations for RLHF training.
By breaking down the task into finer-grained subtasks,
RLHFuse opens up a new design space to <span id="S1.p6.1.1" class="ltx_text ltx_font_italic">fuse the stage execution</span>.
This is orthogonal to the state-of-the-art RLHF framework ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>
that optimizes the parallelism strategy for each task.
RLHFuse exploits the optimizations opportunities at the subtask level
with two new techniques, i.e.,
<span id="S1.p6.1.2" class="ltx_text ltx_font_italic">data-aware inter-stage fusion</span> and <span id="S1.p6.1.3" class="ltx_text ltx_font_italic">model-aware
intra-stage fusion</span>. These two techniques leverage the unique system characteristics
of RLHF training to address data skewness and pipeline bubbles, respectively.</p>
</div>
<div id="S1.p7" class="ltx_para">
<p id="S1.p7.1" class="ltx_p">For data skewness, we split the generation and inference tasks into
sample-level subtasks and then the dependency granularity between the
generation and inference stage can be refined from stage-level to sample-level.
This is due to the fact that the computation of the two stages is
essentially independent for different samples. To leverage this insight,
we design a lightweight and efficient migration algorithm to automatically
detect when the generation stage enters the inefficient long-tail processing phase
and migrates the remaining long-tailed samples to a limited number of GPUs.
The freed-up resources are used to launch the inference tasks.
This approach enables inter-stage fusion and dynamically adjusts the migration
timing in each iteration according to the workload, thereby maximizing overall efficiency.</p>
</div>
<div id="S1.p8" class="ltx_para">
<p id="S1.p8.1" class="ltx_p">For pipeline bubbles, we break the training task into subtasks of micro-batches.
Pipeline bubbles are essentially caused by dependencies between subtasks
of the same model. Fortunately, in the RLHF training stage,
there are two independent models, and their subtasks are naturally independent as well.
Based on this observation, we employ a fused pipeline schedule to
enable intra-stage fusion, which executes the training tasks
on the same set of GPUs, effectively filling each other’s
pipeline bubbles. We design a lightweight pipeline schedule generation
algorithm that can produce near-optimal schedules for <span id="S1.p8.1.1" class="ltx_text ltx_font_typewriter">Actor</span> and
<span id="S1.p8.1.2" class="ltx_text ltx_font_typewriter">Critic</span> models of any size and parallel configurations.</p>
</div>
<div id="S1.p9" class="ltx_para">
<p id="S1.p9.1" class="ltx_p">In addition, we apply a series of system optimizations covering each RLHF stage, transforming RLHFuse into a
production-ready framework to support the RLHF training of our internal products.
We evaluate RLHFuse on various LLMs and real-world datasets. Compared to state-of-the-art
solutions, RLHFuse improves the throughput up to <math id="S1.p9.1.m1.1" class="ltx_math_unparsed" alttext="3.7\times" display="inline"><semantics id="S1.p9.1.m1.1a"><mrow id="S1.p9.1.m1.1b"><mn id="S1.p9.1.m1.1.1">3.7</mn><mo lspace="0.222em" id="S1.p9.1.m1.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S1.p9.1.m1.1c">3.7\times</annotation></semantics></math>.</p>
</div>
<div id="S1.p10" class="ltx_para">
<p id="S1.p10.1" class="ltx_p">In summary, we make the following contributions:</p>
<ul id="S1.I1" class="ltx_itemize">
<li id="S1.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i1.p1" class="ltx_para">
<p id="S1.I1.i1.p1.1" class="ltx_p">We identify the key issues within current RLHF training frameworks and propose
to view the RLHF workflow from a finer-grained subtask-level perspective.</p>
</div>
</li>
<li id="S1.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i2.p1" class="ltx_para">
<p id="S1.I1.i2.p1.1" class="ltx_p">We present RLHFuse, a highly efficient RLHF training framework that utilizes
inter- and intra-stage fusion to improve the training throughput.</p>
</div>
</li>
<li id="S1.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I1.i3.p1" class="ltx_para">
<p id="S1.I1.i3.p1.1" class="ltx_p">We conduct a comprehensive evaluation of RLHFuse and compare it
with state-of-the-art RLHF training solutions.</p>
</div>
</li>
</ul>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Motivation</h2>

<div id="S2.p1" class="ltx_para">
<p id="S2.p1.1" class="ltx_p">In this section, we first introduce the basics of RLHF training (§<a href="#S2.SS1" title="2.1 Background ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2.1</span></a>) and then
point out the problems in existing RLHF training systems (§<a href="#S2.SS2" title="2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2.2</span></a>).</p>
</div>
<section id="S2.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Background</h3>

<div id="S2.SS1.p1" class="ltx_para">
<p id="S2.SS1.p1.1" class="ltx_p">One complete RLHF process consists of three key steps: supervised fine-tuning,
reward model training, and model alignment using the PPO algorithm <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib22" title="" class="ltx_ref">22</a>]</cite>.
The first two stages both train a single LLM, which has been studied by previous
work like Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite> and MegaScale <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib17" title="" class="ltx_ref">17</a>]</cite>. The third stage, which this
paper focuses on, is unique and complex in terms that it involves multiple
models and stages. Next, we provide a detailed overview of the RLHF models and
workflow.</p>
</div>
<div id="S2.SS1.p2" class="ltx_para ltx_noindent">
<p id="S2.SS1.p2.1" class="ltx_p"><span id="S2.SS1.p2.1.1" class="ltx_text ltx_font_bold">RLHF models.</span>
Typically, RLHF training involves four LLMs in total: <span id="S2.SS1.p2.1.2" class="ltx_text ltx_font_typewriter">Actor</span>,
<span id="S2.SS1.p2.1.3" class="ltx_text ltx_font_typewriter">Ref</span>, <span id="S2.SS1.p2.1.4" class="ltx_text ltx_font_typewriter">Critic</span>, and <span id="S2.SS1.p2.1.5" class="ltx_text ltx_font_typewriter">RW</span>. The <span id="S2.SS1.p2.1.6" class="ltx_text ltx_font_typewriter">Actor</span> model, which is the primary
model to be trained and the final product after RLHF, serves as the <span id="S2.SS1.p2.1.7" class="ltx_text ltx_font_italic">agent</span> in the RL semantics.
Given a prompt, each token it generates autoregressively is considered an <span id="S2.SS1.p2.1.8" class="ltx_text ltx_font_italic">action</span>,
and the goal of the PPO algorithm is to guide it to produce actions that align with the reward target.
The Reference model (<span id="S2.SS1.p2.1.9" class="ltx_text ltx_font_typewriter">Ref</span>) is initialized from the original <span id="S2.SS1.p2.1.10" class="ltx_text ltx_font_typewriter">Actor</span> model, but is frozen (<span id="S2.SS1.p2.1.11" class="ltx_text ltx_font_italic">i.e.</span>, weights do not update) during training.
It provides Kullback-Leibler (KL) divergence regularization to ensure the <span id="S2.SS1.p2.1.12" class="ltx_text ltx_font_typewriter">Actor</span> model does not
deviate excessively from its original version during training or generate nonsensical outputs.
The Reward model (<span id="S2.SS1.p2.1.13" class="ltx_text ltx_font_typewriter">RW</span>) is trained on human-labeled preference data to score each sample
generated by the <span id="S2.SS1.p2.1.14" class="ltx_text ltx_font_typewriter">Actor</span> model, which guides the <span id="S2.SS1.p2.1.15" class="ltx_text ltx_font_typewriter">Actor</span> model to generate responses that align with human preferences.
It is also frozen during the RLHF training. The <span id="S2.SS1.p2.1.16" class="ltx_text ltx_font_typewriter">Critic</span> model,
initialized from the <span id="S2.SS1.p2.1.17" class="ltx_text ltx_font_typewriter">RW</span> model, serves as the value model to evaluate the actions taken by the <span id="S2.SS1.p2.1.18" class="ltx_text ltx_font_typewriter">Actor</span>.
It provides finer-grained feedback on action level to guide <span id="S2.SS1.p2.1.19" class="ltx_text ltx_font_typewriter">Actor</span> towards better decisions.</p>
</div>
<div id="S2.SS1.p3" class="ltx_para ltx_noindent">
<p id="S2.SS1.p3.1" class="ltx_p"><span id="S2.SS1.p3.1.1" class="ltx_text ltx_font_bold">RLHF workflow.</span>
Figure <a href="#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a> illustrates the workflow of one training iteration in RLHF, which contains three main stages:
<span id="S2.SS1.p3.1.2" class="ltx_text ltx_font_italic">Generation</span>, <span id="S2.SS1.p3.1.3" class="ltx_text ltx_font_italic">Inference</span>, and <span id="S2.SS1.p3.1.4" class="ltx_text ltx_font_italic">Training</span>.</p>
</div>
<div id="S2.SS1.p4" class="ltx_para ltx_noindent">
<p id="S2.SS1.p4.1" class="ltx_p"><span id="S2.SS1.p4.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Generation stage.</span>
The <span id="S2.SS1.p4.1.2" class="ltx_text ltx_font_typewriter">Actor</span> model generates responses for the prompts in the
current batch. This process involves a prefill phase and a decoding phase. The prefill phase
processes the prompt, which is composed of a sequence of tokens, to generate the first output token.
Following this, the decoding phase sequentially generates subsequent tokens in multiple
steps autoregressively (i.e., each decoding step generates a new token based on tokens generated in previous
steps until reaching a termination token). Ultimately, each prompt and its corresponding response form
one training sample for this iteration, referred to as a <span id="S2.SS1.p4.1.3" class="ltx_text ltx_font_italic">rollout</span> or <span id="S2.SS1.p4.1.4" class="ltx_text ltx_font_italic">trajectory</span>
in the context of RL. To increase sample efficiency, it is common to generate
hundreds or even thousands of samples in each iteration.</p>
</div>
<div id="S2.SS1.p5" class="ltx_para ltx_noindent">
<p id="S2.SS1.p5.1" class="ltx_p"><span id="S2.SS1.p5.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Inference stage.</span>
The <span id="S2.SS1.p5.1.2" class="ltx_text ltx_font_typewriter">Ref</span>, <span id="S2.SS1.p5.1.3" class="ltx_text ltx_font_typewriter">RW</span>, and <span id="S2.SS1.p5.1.4" class="ltx_text ltx_font_typewriter">Critic</span> models each perform
a forward pass on the generated samples. It is similar to the prefill phase in the generation stage
but does not generate the next token. Instead, the output logits are used to calculate the
training loss in the <span id="S2.SS1.p5.1.5" class="ltx_text ltx_font_italic">Training</span> stage. Note that the execution time of each inference
task depends on the model size and is generally not the same.</p>
</div>
<div id="S2.SS1.p6" class="ltx_para ltx_noindent">
<p id="S2.SS1.p6.1" class="ltx_p"><span id="S2.SS1.p6.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Training stage.</span>
In the PPO algorithm, unlike traditional LLM training, all the samples are divided into several mini-batches and the model weights need to update after training on each mini-batch. Concretely, for each
mini-batch, the <span id="S2.SS1.p6.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S2.SS1.p6.1.3" class="ltx_text ltx_font_typewriter">Critic</span> models first perform a forward pass, then calculate
the loss using the results from the inference stage and perform a backward pass to update the parameters.
After the <span id="S2.SS1.p6.1.4" class="ltx_text ltx_font_typewriter">Actor</span> completes training on all mini-batches, it uses the <span id="S2.SS1.p6.1.5" class="ltx_text ltx_font_italic">up-to-date</span>
parameters for the generation in the next iteration.</p>
</div>
<div id="S2.SS1.p7" class="ltx_para ltx_noindent">
<p id="S2.SS1.p7.1" class="ltx_p"><span id="S2.SS1.p7.1.1" class="ltx_text ltx_font_bold">LLM parallelization.</span> Guided by the scaling law <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib23" title="" class="ltx_ref">23</a>]</cite>, the size of LLMs has increased
exponentially. Various parallelism methods are proposed to scale training,
including data parallelism, tensor parallelism, and pipeline parallelism.</p>
</div>
<div id="S2.SS1.p8" class="ltx_para ltx_noindent">
<p id="S2.SS1.p8.1" class="ltx_p"><span id="S2.SS1.p8.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Data Parallelism (DP).</span> DP replicates the model weights and distribute the
data among the replicas to execute in parallel.At the end of each iteration, all DP groups perform
all-reduce communication on the gradients before updating parameters.</p>
</div>
<div id="S2.SS1.p9" class="ltx_para ltx_noindent">
<p id="S2.SS1.p9.1" class="ltx_p"><span id="S2.SS1.p9.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Tensor Parallelism (TP).</span> TP partitions computationally intensive operators, mainly matrix
multiplications, across multiple GPUs to accelerate computation.
It requires significant communication, so it is typically used
within a node to leverage the high-bandwidth NVLINK connections.</p>
</div>
<div id="S2.SS1.p10" class="ltx_para ltx_noindent">
<p id="S2.SS1.p10.1" class="ltx_p"><span id="S2.SS1.p10.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Pipeline Parallelism (PP).</span> PP organizes LLM layers into stages, each running on a separate device
or node. It partitions the input batch into multiple “micro-batches” to form pipeline execution and
accumulates the gradients of the entire input batch.
PP features point-to-point communication and
incurs much less communication overhead than TP.</p>
</div>
<div id="S2.SS1.p11" class="ltx_para">
<p id="S2.SS1.p11.1" class="ltx_p">Since the above parallelism methods have their own
advantages, all three parallel strategies are used together to scale
training in practice, such as Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite> and
MegaScale <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib17" title="" class="ltx_ref">17</a>]</cite> in pre-training <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite>
and ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite> in RLHF training. We use an integer triple <math id="S2.SS1.p11.1.m1.3" class="ltx_Math" alttext="(dp,pp,tp)" display="inline"><semantics id="S2.SS1.p11.1.m1.3a"><mrow id="S2.SS1.p11.1.m1.3.3.3" xref="S2.SS1.p11.1.m1.3.3.4.cmml"><mo stretchy="false" id="S2.SS1.p11.1.m1.3.3.3.4" xref="S2.SS1.p11.1.m1.3.3.4.cmml">(</mo><mrow id="S2.SS1.p11.1.m1.1.1.1.1" xref="S2.SS1.p11.1.m1.1.1.1.1.cmml"><mi id="S2.SS1.p11.1.m1.1.1.1.1.2" xref="S2.SS1.p11.1.m1.1.1.1.1.2.cmml">d</mi><mo lspace="0em" rspace="0em" id="S2.SS1.p11.1.m1.1.1.1.1.1" xref="S2.SS1.p11.1.m1.1.1.1.1.1.cmml">​</mo><mi id="S2.SS1.p11.1.m1.1.1.1.1.3" xref="S2.SS1.p11.1.m1.1.1.1.1.3.cmml">p</mi></mrow><mo id="S2.SS1.p11.1.m1.3.3.3.5" xref="S2.SS1.p11.1.m1.3.3.4.cmml">,</mo><mrow id="S2.SS1.p11.1.m1.2.2.2.2" xref="S2.SS1.p11.1.m1.2.2.2.2.cmml"><mi id="S2.SS1.p11.1.m1.2.2.2.2.2" xref="S2.SS1.p11.1.m1.2.2.2.2.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S2.SS1.p11.1.m1.2.2.2.2.1" xref="S2.SS1.p11.1.m1.2.2.2.2.1.cmml">​</mo><mi id="S2.SS1.p11.1.m1.2.2.2.2.3" xref="S2.SS1.p11.1.m1.2.2.2.2.3.cmml">p</mi></mrow><mo id="S2.SS1.p11.1.m1.3.3.3.6" xref="S2.SS1.p11.1.m1.3.3.4.cmml">,</mo><mrow id="S2.SS1.p11.1.m1.3.3.3.3" xref="S2.SS1.p11.1.m1.3.3.3.3.cmml"><mi id="S2.SS1.p11.1.m1.3.3.3.3.2" xref="S2.SS1.p11.1.m1.3.3.3.3.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S2.SS1.p11.1.m1.3.3.3.3.1" xref="S2.SS1.p11.1.m1.3.3.3.3.1.cmml">​</mo><mi id="S2.SS1.p11.1.m1.3.3.3.3.3" xref="S2.SS1.p11.1.m1.3.3.3.3.3.cmml">p</mi></mrow><mo stretchy="false" id="S2.SS1.p11.1.m1.3.3.3.7" xref="S2.SS1.p11.1.m1.3.3.4.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.p11.1.m1.3b"><vector id="S2.SS1.p11.1.m1.3.3.4.cmml" xref="S2.SS1.p11.1.m1.3.3.3"><apply id="S2.SS1.p11.1.m1.1.1.1.1.cmml" xref="S2.SS1.p11.1.m1.1.1.1.1"><times id="S2.SS1.p11.1.m1.1.1.1.1.1.cmml" xref="S2.SS1.p11.1.m1.1.1.1.1.1"></times><ci id="S2.SS1.p11.1.m1.1.1.1.1.2.cmml" xref="S2.SS1.p11.1.m1.1.1.1.1.2">𝑑</ci><ci id="S2.SS1.p11.1.m1.1.1.1.1.3.cmml" xref="S2.SS1.p11.1.m1.1.1.1.1.3">𝑝</ci></apply><apply id="S2.SS1.p11.1.m1.2.2.2.2.cmml" xref="S2.SS1.p11.1.m1.2.2.2.2"><times id="S2.SS1.p11.1.m1.2.2.2.2.1.cmml" xref="S2.SS1.p11.1.m1.2.2.2.2.1"></times><ci id="S2.SS1.p11.1.m1.2.2.2.2.2.cmml" xref="S2.SS1.p11.1.m1.2.2.2.2.2">𝑝</ci><ci id="S2.SS1.p11.1.m1.2.2.2.2.3.cmml" xref="S2.SS1.p11.1.m1.2.2.2.2.3">𝑝</ci></apply><apply id="S2.SS1.p11.1.m1.3.3.3.3.cmml" xref="S2.SS1.p11.1.m1.3.3.3.3"><times id="S2.SS1.p11.1.m1.3.3.3.3.1.cmml" xref="S2.SS1.p11.1.m1.3.3.3.3.1"></times><ci id="S2.SS1.p11.1.m1.3.3.3.3.2.cmml" xref="S2.SS1.p11.1.m1.3.3.3.3.2">𝑡</ci><ci id="S2.SS1.p11.1.m1.3.3.3.3.3.cmml" xref="S2.SS1.p11.1.m1.3.3.3.3.3">𝑝</ci></apply></vector></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p11.1.m1.3c">(dp,pp,tp)</annotation></semantics></math> to denote the degrees of DP, PP, and TP in 3D-parallelism.</p>
</div>
</section>
<section id="S2.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Problems in RLHF Training</h3>

<div id="S2.SS2.p1" class="ltx_para">
<p id="S2.SS2.p1.1" class="ltx_p">During our practical deployment of RLHF training, we identified two key issues in the <span id="S2.SS2.p1.1.1" class="ltx_text ltx_font_italic">Generation</span>
and <span id="S2.SS2.p1.1.2" class="ltx_text ltx_font_italic">Training</span> stage within existing RLHF training systems that contribute to substantial GPU under-utilization.</p>
</div>
<div id="S2.SS2.p2" class="ltx_para ltx_noindent">
<p id="S2.SS2.p2.1" class="ltx_p"><span id="S2.SS2.p2.1.1" class="ltx_text ltx_font_bold">Generation Stage: data skewness.</span> One major problem in the generation stage is that the response length of generated samples
exhibits a long-tailed distribution, meaning that each batch will contain a few samples that are significantly longer than the others.
Due to data dependencies, the inference tasks cannot start until the generation task finishes.
Consequently, even only a few long-tailed samples force the inference tasks to wait.
This leads to significantly low GPU utilization in the generation stage
because the decoding phase of LLM generation is memory-bound, requiring a large
batch size (typically a few hundred) to maintain high GPU utilization.</p>
</div>
<div id="S2.SS2.p3" class="ltx_para">
<p id="S2.SS2.p3.1" class="ltx_p">This long-tail phenomenon is prevalent and pronounced in the LLM generation. Figure <a href="#S2.F2" title="Figure 2 ‣ 2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a> (left) shows the
CDF of output length distribution in LMSYS-Chat-1M dataset <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib24" title="" class="ltx_ref">24</a>]</cite>, which collects one million user requests and
corresponding responses from various models on the popular LLM evaluation platform Chatbot Arena.
We observe this long-tail distribution across models of varying sizes,
both open-source and proprietary.
The vertical dotted lines mark the 99.9-th percentile length corresponding to each model,
which is more than ten times the median length.
In practice, it is common to generate over 1,000 samples in each iteration,
meaning that almost every iteration will encounter long-tailed samples.</p>
</div>
<div id="S2.SS2.p4" class="ltx_para">
<p id="S2.SS2.p4.1" class="ltx_p">Internally, we also observe this pattern during the RLHF training of a proprietary model with
hundreds of billions of parameters.</p>
</div>
<figure id="S2.F2" class="ltx_figure"><img src="/html/2409.13221/assets/x2.png" id="S2.F2.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="173" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S2.F2.2.1.1" class="ltx_text" style="font-size:90%;">Figure 2</span>: </span><span id="S2.F2.3.2" class="ltx_text" style="font-size:90%;">Left: The output length CDF of models in the LMSYS-Chat-1M
dataset. The vertical dotted line indicates the P99.9 output length.
Right: The RLHF training iteration breakdown on the internal
model and datasets under different maximum output lengths.</span></figcaption>
</figure>
<div id="S2.SS2.p5" class="ltx_para">
<p id="S2.SS2.p5.1" class="ltx_p">Figure <a href="#S2.F2" title="Figure 2 ‣ 2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a> (right) presents
the iteration time breakdown under different maximum output length settings. The time spent
generating long-tailed samples (dark blue bar) accounts for more than half of the total generation time.
The situation gets worse as the maximum generation length increases, which leads to a
substantial rise in iteration time. It is worth noting that this change
only affects the long-tailed samples (<math id="S2.SS2.p5.1.m1.1" class="ltx_Math" alttext="&lt;1\%" display="inline"><semantics id="S2.SS2.p5.1.m1.1a"><mrow id="S2.SS2.p5.1.m1.1.1" xref="S2.SS2.p5.1.m1.1.1.cmml"><mi id="S2.SS2.p5.1.m1.1.1.2" xref="S2.SS2.p5.1.m1.1.1.2.cmml"></mi><mo id="S2.SS2.p5.1.m1.1.1.1" xref="S2.SS2.p5.1.m1.1.1.1.cmml">&lt;</mo><mrow id="S2.SS2.p5.1.m1.1.1.3" xref="S2.SS2.p5.1.m1.1.1.3.cmml"><mn id="S2.SS2.p5.1.m1.1.1.3.2" xref="S2.SS2.p5.1.m1.1.1.3.2.cmml">1</mn><mo id="S2.SS2.p5.1.m1.1.1.3.1" xref="S2.SS2.p5.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p5.1.m1.1b"><apply id="S2.SS2.p5.1.m1.1.1.cmml" xref="S2.SS2.p5.1.m1.1.1"><lt id="S2.SS2.p5.1.m1.1.1.1.cmml" xref="S2.SS2.p5.1.m1.1.1.1"></lt><csymbol cd="latexml" id="S2.SS2.p5.1.m1.1.1.2.cmml" xref="S2.SS2.p5.1.m1.1.1.2">absent</csymbol><apply id="S2.SS2.p5.1.m1.1.1.3.cmml" xref="S2.SS2.p5.1.m1.1.1.3"><csymbol cd="latexml" id="S2.SS2.p5.1.m1.1.1.3.1.cmml" xref="S2.SS2.p5.1.m1.1.1.3.1">percent</csymbol><cn type="integer" id="S2.SS2.p5.1.m1.1.1.3.2.cmml" xref="S2.SS2.p5.1.m1.1.1.3.2">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p5.1.m1.1c">&lt;1\%</annotation></semantics></math>),
but the results indicate that this very small portion of long-tail samples can have
a significant impact on the overall system performance. As user applications increasingly
demand lengthy outputs <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib15" title="" class="ltx_ref">15</a>]</cite>, the inclusion of samples with long response lengths in RLHF
training becomes more common and important, making the long-tail phenomenon an urgent problem
in real deployment.</p>
</div>
<div id="S2.SS2.p6" class="ltx_para ltx_noindent">
<p id="S2.SS2.p6.1" class="ltx_p"><span id="S2.SS2.p6.1.1" class="ltx_text ltx_font_bold">Training Stage: pipeline bubbles.</span> With the exponential growth in the size of LLMs,
higher parallelism is required to scale training.
While TP size is generally limited to the number of GPUs within a single node (typically 8)
due to the significant communication overhead,
and DP size increases the memory consumption of model weights linearly.
Consequently, PP has become a critical method for scale training.</p>
</div>
<div id="S2.SS2.p7" class="ltx_para">
<p id="S2.SS2.p7.7" class="ltx_p">Scaling the PP size is not a free lunch, as pipeline bubbles can significantly impact training
efficiency.
Concretely, in the most commonly used 1F1B pipeline schedule <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib25" title="" class="ltx_ref">25</a>]</cite>
as shown in Figure <a href="#S2.F3" title="Figure 3 ‣ 2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a> (upper),
the <span id="S2.SS2.p7.7.1" class="ltx_text ltx_font_italic">pipeline bubble percentage</span> is
<math id="S2.SS2.p7.1.m1.1" class="ltx_Math" alttext="\frac{N-1}{N-1+M}" display="inline"><semantics id="S2.SS2.p7.1.m1.1a"><mfrac id="S2.SS2.p7.1.m1.1.1" xref="S2.SS2.p7.1.m1.1.1.cmml"><mrow id="S2.SS2.p7.1.m1.1.1.2" xref="S2.SS2.p7.1.m1.1.1.2.cmml"><mi id="S2.SS2.p7.1.m1.1.1.2.2" xref="S2.SS2.p7.1.m1.1.1.2.2.cmml">N</mi><mo id="S2.SS2.p7.1.m1.1.1.2.1" xref="S2.SS2.p7.1.m1.1.1.2.1.cmml">−</mo><mn id="S2.SS2.p7.1.m1.1.1.2.3" xref="S2.SS2.p7.1.m1.1.1.2.3.cmml">1</mn></mrow><mrow id="S2.SS2.p7.1.m1.1.1.3" xref="S2.SS2.p7.1.m1.1.1.3.cmml"><mrow id="S2.SS2.p7.1.m1.1.1.3.2" xref="S2.SS2.p7.1.m1.1.1.3.2.cmml"><mi id="S2.SS2.p7.1.m1.1.1.3.2.2" xref="S2.SS2.p7.1.m1.1.1.3.2.2.cmml">N</mi><mo id="S2.SS2.p7.1.m1.1.1.3.2.1" xref="S2.SS2.p7.1.m1.1.1.3.2.1.cmml">−</mo><mn id="S2.SS2.p7.1.m1.1.1.3.2.3" xref="S2.SS2.p7.1.m1.1.1.3.2.3.cmml">1</mn></mrow><mo id="S2.SS2.p7.1.m1.1.1.3.1" xref="S2.SS2.p7.1.m1.1.1.3.1.cmml">+</mo><mi id="S2.SS2.p7.1.m1.1.1.3.3" xref="S2.SS2.p7.1.m1.1.1.3.3.cmml">M</mi></mrow></mfrac><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.1.m1.1b"><apply id="S2.SS2.p7.1.m1.1.1.cmml" xref="S2.SS2.p7.1.m1.1.1"><divide id="S2.SS2.p7.1.m1.1.1.1.cmml" xref="S2.SS2.p7.1.m1.1.1"></divide><apply id="S2.SS2.p7.1.m1.1.1.2.cmml" xref="S2.SS2.p7.1.m1.1.1.2"><minus id="S2.SS2.p7.1.m1.1.1.2.1.cmml" xref="S2.SS2.p7.1.m1.1.1.2.1"></minus><ci id="S2.SS2.p7.1.m1.1.1.2.2.cmml" xref="S2.SS2.p7.1.m1.1.1.2.2">𝑁</ci><cn type="integer" id="S2.SS2.p7.1.m1.1.1.2.3.cmml" xref="S2.SS2.p7.1.m1.1.1.2.3">1</cn></apply><apply id="S2.SS2.p7.1.m1.1.1.3.cmml" xref="S2.SS2.p7.1.m1.1.1.3"><plus id="S2.SS2.p7.1.m1.1.1.3.1.cmml" xref="S2.SS2.p7.1.m1.1.1.3.1"></plus><apply id="S2.SS2.p7.1.m1.1.1.3.2.cmml" xref="S2.SS2.p7.1.m1.1.1.3.2"><minus id="S2.SS2.p7.1.m1.1.1.3.2.1.cmml" xref="S2.SS2.p7.1.m1.1.1.3.2.1"></minus><ci id="S2.SS2.p7.1.m1.1.1.3.2.2.cmml" xref="S2.SS2.p7.1.m1.1.1.3.2.2">𝑁</ci><cn type="integer" id="S2.SS2.p7.1.m1.1.1.3.2.3.cmml" xref="S2.SS2.p7.1.m1.1.1.3.2.3">1</cn></apply><ci id="S2.SS2.p7.1.m1.1.1.3.3.cmml" xref="S2.SS2.p7.1.m1.1.1.3.3">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.1.m1.1c">\frac{N-1}{N-1+M}</annotation></semantics></math>
with <math id="S2.SS2.p7.2.m2.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S2.SS2.p7.2.m2.1a"><mi id="S2.SS2.p7.2.m2.1.1" xref="S2.SS2.p7.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.2.m2.1b"><ci id="S2.SS2.p7.2.m2.1.1.cmml" xref="S2.SS2.p7.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.2.m2.1c">N</annotation></semantics></math> PP stages and <math id="S2.SS2.p7.3.m3.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S2.SS2.p7.3.m3.1a"><mi id="S2.SS2.p7.3.m3.1.1" xref="S2.SS2.p7.3.m3.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.3.m3.1b"><ci id="S2.SS2.p7.3.m3.1.1.cmml" xref="S2.SS2.p7.3.m3.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.3.m3.1c">M</annotation></semantics></math> micro-batches.
One simple way to reduce the bubble
percentage is to increase <math id="S2.SS2.p7.4.m4.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S2.SS2.p7.4.m4.1a"><mi id="S2.SS2.p7.4.m4.1.1" xref="S2.SS2.p7.4.m4.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.4.m4.1b"><ci id="S2.SS2.p7.4.m4.1.1.cmml" xref="S2.SS2.p7.4.m4.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.4.m4.1c">M</annotation></semantics></math>. However, the global batch size
is constrained by the converging conditions and cannot be increased indefinitely.
Additionally, in RLHF, the global batch is first divided into several mini-batches,
then distributed among the DP groups, and finally split into micro-batches, further limiting <math id="S2.SS2.p7.5.m5.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S2.SS2.p7.5.m5.1a"><mi id="S2.SS2.p7.5.m5.1.1" xref="S2.SS2.p7.5.m5.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.5.m5.1b"><ci id="S2.SS2.p7.5.m5.1.1.cmml" xref="S2.SS2.p7.5.m5.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.5.m5.1c">M</annotation></semantics></math>.
As <math id="S2.SS2.p7.6.m6.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S2.SS2.p7.6.m6.1a"><mi id="S2.SS2.p7.6.m6.1.1" xref="S2.SS2.p7.6.m6.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.6.m6.1b"><ci id="S2.SS2.p7.6.m6.1.1.cmml" xref="S2.SS2.p7.6.m6.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.6.m6.1c">N</annotation></semantics></math> scales with the model size to approach <math id="S2.SS2.p7.7.m7.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S2.SS2.p7.7.m7.1a"><mi id="S2.SS2.p7.7.m7.1.1" xref="S2.SS2.p7.7.m7.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.7.m7.1b"><ci id="S2.SS2.p7.7.m7.1.1.cmml" xref="S2.SS2.p7.7.m7.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.7.m7.1c">M</annotation></semantics></math>, which is quite common when
scaling LLMs to hundreds of billions of parameters, the bubble percentage is about 50%.
This means that about half of the GPUs are idle during training,
leading to a significant waste of resources.</p>
</div>
<figure id="S2.F3" class="ltx_figure"><img src="/html/2409.13221/assets/x3.png" id="S2.F3.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="283" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S2.F3.2.1.1" class="ltx_text" style="font-size:90%;">Figure 3</span>: </span><span id="S2.F3.3.2" class="ltx_text" style="font-size:90%;">The timeline of 1F1B and interleaved 1F1B pipeline schedule with 4 pipeline stages
and 4 micro-batches. Interleaved 1F1B deploys two model chunks on each pipeline stage in this example.</span></figcaption>
</figure>
<div id="S2.SS2.p8" class="ltx_para">
<p id="S2.SS2.p8.4" class="ltx_p">Interleaved 1F1B scheduling <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite> is proposed to mitigate the pipeline bubbles.
As shown in Figure <a href="#S2.F3" title="Figure 3 ‣ 2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a> (bottom), it divides the LLM
into more fine-grained model chunks, with each stage hosting
<math id="S2.SS2.p8.1.m1.1" class="ltx_Math" alttext="K(K&gt;1)" display="inline"><semantics id="S2.SS2.p8.1.m1.1a"><mrow id="S2.SS2.p8.1.m1.1.1" xref="S2.SS2.p8.1.m1.1.1.cmml"><mi id="S2.SS2.p8.1.m1.1.1.3" xref="S2.SS2.p8.1.m1.1.1.3.cmml">K</mi><mo lspace="0em" rspace="0em" id="S2.SS2.p8.1.m1.1.1.2" xref="S2.SS2.p8.1.m1.1.1.2.cmml">​</mo><mrow id="S2.SS2.p8.1.m1.1.1.1.1" xref="S2.SS2.p8.1.m1.1.1.1.1.1.cmml"><mo stretchy="false" id="S2.SS2.p8.1.m1.1.1.1.1.2" xref="S2.SS2.p8.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.p8.1.m1.1.1.1.1.1" xref="S2.SS2.p8.1.m1.1.1.1.1.1.cmml"><mi id="S2.SS2.p8.1.m1.1.1.1.1.1.2" xref="S2.SS2.p8.1.m1.1.1.1.1.1.2.cmml">K</mi><mo id="S2.SS2.p8.1.m1.1.1.1.1.1.1" xref="S2.SS2.p8.1.m1.1.1.1.1.1.1.cmml">&gt;</mo><mn id="S2.SS2.p8.1.m1.1.1.1.1.1.3" xref="S2.SS2.p8.1.m1.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="S2.SS2.p8.1.m1.1.1.1.1.3" xref="S2.SS2.p8.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p8.1.m1.1b"><apply id="S2.SS2.p8.1.m1.1.1.cmml" xref="S2.SS2.p8.1.m1.1.1"><times id="S2.SS2.p8.1.m1.1.1.2.cmml" xref="S2.SS2.p8.1.m1.1.1.2"></times><ci id="S2.SS2.p8.1.m1.1.1.3.cmml" xref="S2.SS2.p8.1.m1.1.1.3">𝐾</ci><apply id="S2.SS2.p8.1.m1.1.1.1.1.1.cmml" xref="S2.SS2.p8.1.m1.1.1.1.1"><gt id="S2.SS2.p8.1.m1.1.1.1.1.1.1.cmml" xref="S2.SS2.p8.1.m1.1.1.1.1.1.1"></gt><ci id="S2.SS2.p8.1.m1.1.1.1.1.1.2.cmml" xref="S2.SS2.p8.1.m1.1.1.1.1.1.2">𝐾</ci><cn type="integer" id="S2.SS2.p8.1.m1.1.1.1.1.1.3.cmml" xref="S2.SS2.p8.1.m1.1.1.1.1.1.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p8.1.m1.1c">K(K&gt;1)</annotation></semantics></math> model chunks, reducing the pipeline bubble percentage to
<math id="S2.SS2.p8.2.m2.1" class="ltx_Math" alttext="\frac{N-1}{N-1+KM}" display="inline"><semantics id="S2.SS2.p8.2.m2.1a"><mfrac id="S2.SS2.p8.2.m2.1.1" xref="S2.SS2.p8.2.m2.1.1.cmml"><mrow id="S2.SS2.p8.2.m2.1.1.2" xref="S2.SS2.p8.2.m2.1.1.2.cmml"><mi id="S2.SS2.p8.2.m2.1.1.2.2" xref="S2.SS2.p8.2.m2.1.1.2.2.cmml">N</mi><mo id="S2.SS2.p8.2.m2.1.1.2.1" xref="S2.SS2.p8.2.m2.1.1.2.1.cmml">−</mo><mn id="S2.SS2.p8.2.m2.1.1.2.3" xref="S2.SS2.p8.2.m2.1.1.2.3.cmml">1</mn></mrow><mrow id="S2.SS2.p8.2.m2.1.1.3" xref="S2.SS2.p8.2.m2.1.1.3.cmml"><mrow id="S2.SS2.p8.2.m2.1.1.3.2" xref="S2.SS2.p8.2.m2.1.1.3.2.cmml"><mi id="S2.SS2.p8.2.m2.1.1.3.2.2" xref="S2.SS2.p8.2.m2.1.1.3.2.2.cmml">N</mi><mo id="S2.SS2.p8.2.m2.1.1.3.2.1" xref="S2.SS2.p8.2.m2.1.1.3.2.1.cmml">−</mo><mn id="S2.SS2.p8.2.m2.1.1.3.2.3" xref="S2.SS2.p8.2.m2.1.1.3.2.3.cmml">1</mn></mrow><mo id="S2.SS2.p8.2.m2.1.1.3.1" xref="S2.SS2.p8.2.m2.1.1.3.1.cmml">+</mo><mrow id="S2.SS2.p8.2.m2.1.1.3.3" xref="S2.SS2.p8.2.m2.1.1.3.3.cmml"><mi id="S2.SS2.p8.2.m2.1.1.3.3.2" xref="S2.SS2.p8.2.m2.1.1.3.3.2.cmml">K</mi><mo lspace="0em" rspace="0em" id="S2.SS2.p8.2.m2.1.1.3.3.1" xref="S2.SS2.p8.2.m2.1.1.3.3.1.cmml">​</mo><mi id="S2.SS2.p8.2.m2.1.1.3.3.3" xref="S2.SS2.p8.2.m2.1.1.3.3.3.cmml">M</mi></mrow></mrow></mfrac><annotation-xml encoding="MathML-Content" id="S2.SS2.p8.2.m2.1b"><apply id="S2.SS2.p8.2.m2.1.1.cmml" xref="S2.SS2.p8.2.m2.1.1"><divide id="S2.SS2.p8.2.m2.1.1.1.cmml" xref="S2.SS2.p8.2.m2.1.1"></divide><apply id="S2.SS2.p8.2.m2.1.1.2.cmml" xref="S2.SS2.p8.2.m2.1.1.2"><minus id="S2.SS2.p8.2.m2.1.1.2.1.cmml" xref="S2.SS2.p8.2.m2.1.1.2.1"></minus><ci id="S2.SS2.p8.2.m2.1.1.2.2.cmml" xref="S2.SS2.p8.2.m2.1.1.2.2">𝑁</ci><cn type="integer" id="S2.SS2.p8.2.m2.1.1.2.3.cmml" xref="S2.SS2.p8.2.m2.1.1.2.3">1</cn></apply><apply id="S2.SS2.p8.2.m2.1.1.3.cmml" xref="S2.SS2.p8.2.m2.1.1.3"><plus id="S2.SS2.p8.2.m2.1.1.3.1.cmml" xref="S2.SS2.p8.2.m2.1.1.3.1"></plus><apply id="S2.SS2.p8.2.m2.1.1.3.2.cmml" xref="S2.SS2.p8.2.m2.1.1.3.2"><minus id="S2.SS2.p8.2.m2.1.1.3.2.1.cmml" xref="S2.SS2.p8.2.m2.1.1.3.2.1"></minus><ci id="S2.SS2.p8.2.m2.1.1.3.2.2.cmml" xref="S2.SS2.p8.2.m2.1.1.3.2.2">𝑁</ci><cn type="integer" id="S2.SS2.p8.2.m2.1.1.3.2.3.cmml" xref="S2.SS2.p8.2.m2.1.1.3.2.3">1</cn></apply><apply id="S2.SS2.p8.2.m2.1.1.3.3.cmml" xref="S2.SS2.p8.2.m2.1.1.3.3"><times id="S2.SS2.p8.2.m2.1.1.3.3.1.cmml" xref="S2.SS2.p8.2.m2.1.1.3.3.1"></times><ci id="S2.SS2.p8.2.m2.1.1.3.3.2.cmml" xref="S2.SS2.p8.2.m2.1.1.3.3.2">𝐾</ci><ci id="S2.SS2.p8.2.m2.1.1.3.3.3.cmml" xref="S2.SS2.p8.2.m2.1.1.3.3.3">𝑀</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p8.2.m2.1c">\frac{N-1}{N-1+KM}</annotation></semantics></math>
.
However, it not only introduces a <math id="S2.SS2.p8.3.m3.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S2.SS2.p8.3.m3.1a"><mi id="S2.SS2.p8.3.m3.1.1" xref="S2.SS2.p8.3.m3.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p8.3.m3.1b"><ci id="S2.SS2.p8.3.m3.1.1.cmml" xref="S2.SS2.p8.3.m3.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p8.3.m3.1c">K</annotation></semantics></math>-fold communication overhead but also
exacerbates the imbalances across PP stages. As a result, <math id="S2.SS2.p8.4.m4.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S2.SS2.p8.4.m4.1a"><mi id="S2.SS2.p8.4.m4.1.1" xref="S2.SS2.p8.4.m4.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p8.4.m4.1b"><ci id="S2.SS2.p8.4.m4.1.1.cmml" xref="S2.SS2.p8.4.m4.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p8.4.m4.1c">K</annotation></semantics></math> is typically
set to 2 in practice, leaving room for further optimizations.</p>
</div>
<div id="S2.SS2.p9" class="ltx_para">
<p id="S2.SS2.p9.1" class="ltx_p">There are other works that aim to completely eliminate pipeline bubbles; however, they either
violate the synchronous training semantics <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib25" title="" class="ltx_ref">25</a>]</cite> or rely on specific, often unpractical,
assumptions <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib21" title="" class="ltx_ref">21</a>]</cite>. As a result, pipeline bubbles still pose a significant problem
in LLM training, especially when the model size keeps scaling.</p>
</div>
<div id="S2.SS2.p10" class="ltx_para ltx_noindent">
<p id="S2.SS2.p10.1" class="ltx_p"><span id="S2.SS2.p10.1.1" class="ltx_text ltx_font_bold">Summary.</span> Essentially, the above issues are caused by the inherent
characteristics of RLHF, which are difficult to eliminate
through task-level optimizations. Existing systems
treat the task as the smallest execution unit and overlook
its internal structure, thereby missing huge
optimization opportunities.</p>
</div>
</section>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>RLHFuse Overview</h2>

<div id="S3.p1" class="ltx_para">
<p id="S3.p1.1" class="ltx_p">To this end, we present RLHFuse to address
data skewness in the generation stage
through data-aware inter-stage fusion (§<a href="#S4" title="4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a>) and
mitigates pipeline bubbles in the
training stage with model-aware intra-stage fusion (§<a href="#S5" title="5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a>).
Additionally, RLHFuse adopts a
series of system optimizations (§<a href="#S6" title="6 System Implementation and Optimizations ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>)
tailored for RLHF training.
Here we provide a brief
overview of RLHFuse as shown in Figure <a href="#S3.F4" title="Figure 4 ‣ 3 RLHFuse Overview ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a>.</p>
</div>
<div id="S3.p2" class="ltx_para ltx_noindent">
<p id="S3.p2.6" class="ltx_p"><span id="S3.p2.6.1" class="ltx_text ltx_font_bold">Workflow.</span> With specific algorithm, model, and cluster configurations as input, RLHFuse first configures efficient
parallel and deployment strategies following
the approach in ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>. For each task within the RLHF workflow,
RLHFuse will assign it a tailored
parallel strategy <math id="S3.p2.1.m1.3" class="ltx_Math" alttext="P_{i}=(dp,pp,tp)" display="inline"><semantics id="S3.p2.1.m1.3a"><mrow id="S3.p2.1.m1.3.3" xref="S3.p2.1.m1.3.3.cmml"><msub id="S3.p2.1.m1.3.3.5" xref="S3.p2.1.m1.3.3.5.cmml"><mi id="S3.p2.1.m1.3.3.5.2" xref="S3.p2.1.m1.3.3.5.2.cmml">P</mi><mi id="S3.p2.1.m1.3.3.5.3" xref="S3.p2.1.m1.3.3.5.3.cmml">i</mi></msub><mo id="S3.p2.1.m1.3.3.4" xref="S3.p2.1.m1.3.3.4.cmml">=</mo><mrow id="S3.p2.1.m1.3.3.3.3" xref="S3.p2.1.m1.3.3.3.4.cmml"><mo stretchy="false" id="S3.p2.1.m1.3.3.3.3.4" xref="S3.p2.1.m1.3.3.3.4.cmml">(</mo><mrow id="S3.p2.1.m1.1.1.1.1.1" xref="S3.p2.1.m1.1.1.1.1.1.cmml"><mi id="S3.p2.1.m1.1.1.1.1.1.2" xref="S3.p2.1.m1.1.1.1.1.1.2.cmml">d</mi><mo lspace="0em" rspace="0em" id="S3.p2.1.m1.1.1.1.1.1.1" xref="S3.p2.1.m1.1.1.1.1.1.1.cmml">​</mo><mi id="S3.p2.1.m1.1.1.1.1.1.3" xref="S3.p2.1.m1.1.1.1.1.1.3.cmml">p</mi></mrow><mo id="S3.p2.1.m1.3.3.3.3.5" xref="S3.p2.1.m1.3.3.3.4.cmml">,</mo><mrow id="S3.p2.1.m1.2.2.2.2.2" xref="S3.p2.1.m1.2.2.2.2.2.cmml"><mi id="S3.p2.1.m1.2.2.2.2.2.2" xref="S3.p2.1.m1.2.2.2.2.2.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S3.p2.1.m1.2.2.2.2.2.1" xref="S3.p2.1.m1.2.2.2.2.2.1.cmml">​</mo><mi id="S3.p2.1.m1.2.2.2.2.2.3" xref="S3.p2.1.m1.2.2.2.2.2.3.cmml">p</mi></mrow><mo id="S3.p2.1.m1.3.3.3.3.6" xref="S3.p2.1.m1.3.3.3.4.cmml">,</mo><mrow id="S3.p2.1.m1.3.3.3.3.3" xref="S3.p2.1.m1.3.3.3.3.3.cmml"><mi id="S3.p2.1.m1.3.3.3.3.3.2" xref="S3.p2.1.m1.3.3.3.3.3.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S3.p2.1.m1.3.3.3.3.3.1" xref="S3.p2.1.m1.3.3.3.3.3.1.cmml">​</mo><mi id="S3.p2.1.m1.3.3.3.3.3.3" xref="S3.p2.1.m1.3.3.3.3.3.3.cmml">p</mi></mrow><mo stretchy="false" id="S3.p2.1.m1.3.3.3.3.7" xref="S3.p2.1.m1.3.3.3.4.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.3b"><apply id="S3.p2.1.m1.3.3.cmml" xref="S3.p2.1.m1.3.3"><eq id="S3.p2.1.m1.3.3.4.cmml" xref="S3.p2.1.m1.3.3.4"></eq><apply id="S3.p2.1.m1.3.3.5.cmml" xref="S3.p2.1.m1.3.3.5"><csymbol cd="ambiguous" id="S3.p2.1.m1.3.3.5.1.cmml" xref="S3.p2.1.m1.3.3.5">subscript</csymbol><ci id="S3.p2.1.m1.3.3.5.2.cmml" xref="S3.p2.1.m1.3.3.5.2">𝑃</ci><ci id="S3.p2.1.m1.3.3.5.3.cmml" xref="S3.p2.1.m1.3.3.5.3">𝑖</ci></apply><vector id="S3.p2.1.m1.3.3.3.4.cmml" xref="S3.p2.1.m1.3.3.3.3"><apply id="S3.p2.1.m1.1.1.1.1.1.cmml" xref="S3.p2.1.m1.1.1.1.1.1"><times id="S3.p2.1.m1.1.1.1.1.1.1.cmml" xref="S3.p2.1.m1.1.1.1.1.1.1"></times><ci id="S3.p2.1.m1.1.1.1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.1.1.1.2">𝑑</ci><ci id="S3.p2.1.m1.1.1.1.1.1.3.cmml" xref="S3.p2.1.m1.1.1.1.1.1.3">𝑝</ci></apply><apply id="S3.p2.1.m1.2.2.2.2.2.cmml" xref="S3.p2.1.m1.2.2.2.2.2"><times id="S3.p2.1.m1.2.2.2.2.2.1.cmml" xref="S3.p2.1.m1.2.2.2.2.2.1"></times><ci id="S3.p2.1.m1.2.2.2.2.2.2.cmml" xref="S3.p2.1.m1.2.2.2.2.2.2">𝑝</ci><ci id="S3.p2.1.m1.2.2.2.2.2.3.cmml" xref="S3.p2.1.m1.2.2.2.2.2.3">𝑝</ci></apply><apply id="S3.p2.1.m1.3.3.3.3.3.cmml" xref="S3.p2.1.m1.3.3.3.3.3"><times id="S3.p2.1.m1.3.3.3.3.3.1.cmml" xref="S3.p2.1.m1.3.3.3.3.3.1"></times><ci id="S3.p2.1.m1.3.3.3.3.3.2.cmml" xref="S3.p2.1.m1.3.3.3.3.3.2">𝑡</ci><ci id="S3.p2.1.m1.3.3.3.3.3.3.cmml" xref="S3.p2.1.m1.3.3.3.3.3.3">𝑝</ci></apply></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.3c">P_{i}=(dp,pp,tp)</annotation></semantics></math> to maximize the GPU utilization.
To deploy the task onto the physical cluster, we introduce the concept of <span id="S3.p2.6.2" class="ltx_text ltx_font_italic">device mesh</span>, which is
the unit for executing an individual task. A device mesh <math id="S3.p2.2.m2.2" class="ltx_Math" alttext="D=(N,M)" display="inline"><semantics id="S3.p2.2.m2.2a"><mrow id="S3.p2.2.m2.2.3" xref="S3.p2.2.m2.2.3.cmml"><mi id="S3.p2.2.m2.2.3.2" xref="S3.p2.2.m2.2.3.2.cmml">D</mi><mo id="S3.p2.2.m2.2.3.1" xref="S3.p2.2.m2.2.3.1.cmml">=</mo><mrow id="S3.p2.2.m2.2.3.3.2" xref="S3.p2.2.m2.2.3.3.1.cmml"><mo stretchy="false" id="S3.p2.2.m2.2.3.3.2.1" xref="S3.p2.2.m2.2.3.3.1.cmml">(</mo><mi id="S3.p2.2.m2.1.1" xref="S3.p2.2.m2.1.1.cmml">N</mi><mo id="S3.p2.2.m2.2.3.3.2.2" xref="S3.p2.2.m2.2.3.3.1.cmml">,</mo><mi id="S3.p2.2.m2.2.2" xref="S3.p2.2.m2.2.2.cmml">M</mi><mo stretchy="false" id="S3.p2.2.m2.2.3.3.2.3" xref="S3.p2.2.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.2.m2.2b"><apply id="S3.p2.2.m2.2.3.cmml" xref="S3.p2.2.m2.2.3"><eq id="S3.p2.2.m2.2.3.1.cmml" xref="S3.p2.2.m2.2.3.1"></eq><ci id="S3.p2.2.m2.2.3.2.cmml" xref="S3.p2.2.m2.2.3.2">𝐷</ci><interval closure="open" id="S3.p2.2.m2.2.3.3.1.cmml" xref="S3.p2.2.m2.2.3.3.2"><ci id="S3.p2.2.m2.1.1.cmml" xref="S3.p2.2.m2.1.1">𝑁</ci><ci id="S3.p2.2.m2.2.2.cmml" xref="S3.p2.2.m2.2.2">𝑀</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.2.m2.2c">D=(N,M)</annotation></semantics></math> is defined as a two-dimensional
grid of GPUs, covering <math id="S3.p2.3.m3.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S3.p2.3.m3.1a"><mi id="S3.p2.3.m3.1.1" xref="S3.p2.3.m3.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.p2.3.m3.1b"><ci id="S3.p2.3.m3.1.1.cmml" xref="S3.p2.3.m3.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.3.m3.1c">N</annotation></semantics></math> nodes where each is equipped with <math id="S3.p2.4.m4.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S3.p2.4.m4.1a"><mi id="S3.p2.4.m4.1.1" xref="S3.p2.4.m4.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S3.p2.4.m4.1b"><ci id="S3.p2.4.m4.1.1.cmml" xref="S3.p2.4.m4.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.4.m4.1c">M</annotation></semantics></math> devices.
RLHFuse will designate a device mesh <math id="S3.p2.5.m5.1" class="ltx_Math" alttext="D_{i}" display="inline"><semantics id="S3.p2.5.m5.1a"><msub id="S3.p2.5.m5.1.1" xref="S3.p2.5.m5.1.1.cmml"><mi id="S3.p2.5.m5.1.1.2" xref="S3.p2.5.m5.1.1.2.cmml">D</mi><mi id="S3.p2.5.m5.1.1.3" xref="S3.p2.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p2.5.m5.1b"><apply id="S3.p2.5.m5.1.1.cmml" xref="S3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p2.5.m5.1.1.1.cmml" xref="S3.p2.5.m5.1.1">subscript</csymbol><ci id="S3.p2.5.m5.1.1.2.cmml" xref="S3.p2.5.m5.1.1.2">𝐷</ci><ci id="S3.p2.5.m5.1.1.3.cmml" xref="S3.p2.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.5.m5.1c">D_{i}</annotation></semantics></math> to each task which can be executed with parallel strategy <math id="S3.p2.6.m6.1" class="ltx_Math" alttext="P_{i}" display="inline"><semantics id="S3.p2.6.m6.1a"><msub id="S3.p2.6.m6.1.1" xref="S3.p2.6.m6.1.1.cmml"><mi id="S3.p2.6.m6.1.1.2" xref="S3.p2.6.m6.1.1.2.cmml">P</mi><mi id="S3.p2.6.m6.1.1.3" xref="S3.p2.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p2.6.m6.1b"><apply id="S3.p2.6.m6.1.1.cmml" xref="S3.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S3.p2.6.m6.1.1.1.cmml" xref="S3.p2.6.m6.1.1">subscript</csymbol><ci id="S3.p2.6.m6.1.1.2.cmml" xref="S3.p2.6.m6.1.1.2">𝑃</ci><ci id="S3.p2.6.m6.1.1.3.cmml" xref="S3.p2.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.6.m6.1c">P_{i}</annotation></semantics></math>.
At runtime, RLHFuse will launch each task
with its corresponding parallel strategy on the designated device mesh following the workflow dependency and handle the weight redistribution
and data transmission between different tasks to ensure synchronous training semantics.
Meanwhile, RLHFuse utilizes data-aware inter-stage fusion to fuse the generation and inference tasks and model-aware intra-stage fusion to fuse the training tasks.</p>
</div>
<div id="S3.p3" class="ltx_para ltx_noindent">
<p id="S3.p3.1" class="ltx_p"><span id="S3.p3.1.1" class="ltx_text ltx_font_bold">Inter-stage fusion.</span> As depicted in the left part of Figure <a href="#S3.F4" title="Figure 4 ‣ 3 RLHFuse Overview ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a>, during the generation stage, there are multiple model instances, each
managing complete model weights and part of the samples. RLHFuse actively monitors each generation instance and triggers
migration when the number of remaining samples is below a particular threshold.
The remaining samples will be
migrated to some dedicated generation instances which are designated to handle
long-tailed samples. Subsequently, the resources of the original generation
instances are repurposed to launch inference tasks,
thereby allowing for the overlap of inference tasks with the generation of
long-tailed samples and fusing the execution of the two stages.</p>
</div>
<div id="S3.p4" class="ltx_para ltx_noindent">
<p id="S3.p4.1" class="ltx_p"><span id="S3.p4.1.1" class="ltx_text ltx_font_bold">Intra-stage fusion.</span> As shown in the right part of Figure <a href="#S3.F4" title="Figure 4 ‣ 3 RLHFuse Overview ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a>, in the training stage, RLHFuse leverages the insight that pipeline execution can be complemented by another pipeline and generates a fused pipeline schedule based on the model size and parallel strategies of <span id="S3.p4.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S3.p4.1.3" class="ltx_text ltx_font_typewriter">Critic</span> model. It utilizes a light-weight schedule generation algorithm to minimize the pipeline bubbles and activation memory usage, thus improving the training efficiency.</p>
</div>
<figure id="S3.F4" class="ltx_figure"><img src="/html/2409.13221/assets/x4.png" id="S3.F4.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="415" height="222" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S3.F4.2.1.1" class="ltx_text" style="font-size:90%;">Figure 4</span>: </span><span id="S3.F4.3.2" class="ltx_text" style="font-size:90%;">RLHFuse architecture.</span></figcaption>
</figure>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Data-aware Inter-Stage Fusion</h2>

<div id="S4.p1" class="ltx_para">
<p id="S4.p1.1" class="ltx_p">In this section, we first analyze the opportunities of fusing the generation
and inference stages (§<a href="#S4.SS1" title="4.1 Opportunities and Challenges ‣ 4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4.1</span></a>).
We then introduce the fused execution plan to
maximize the overlap between the two stages while preserving the data dependency
(§<a href="#S4.SS2" title="4.2 Fused Execution Plan ‣ 4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4.2</span></a>).</p>
</div>
<section id="S4.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Opportunities and Challenges</h3>

<div id="S4.SS1.p1" class="ltx_para ltx_noindent">
<p id="S4.SS1.p1.1" class="ltx_p"><span id="S4.SS1.p1.1.1" class="ltx_text ltx_font_bold">Opportunities.</span>
The dependency between the two stages is predicated on the sample level,
implying that once a sample completes its generation stage, it can seamlessly advance to the inference stage.
This key observation motivates us to break the task into sample-level subtasks
without violating original synchronous training semantics.
Consequently, we can initiate inference tasks as soon as there exist completed samples in the generation stage.</p>
</div>
<div id="S4.SS1.p2" class="ltx_para">
<p id="S4.SS1.p2.1" class="ltx_p">Based on this, we design a fused execution plan that overlaps the generation and inference stages.
Specifically, the fused plan first detects the point when the generation instance enters the long-tail decoding phase.
At this juncture, most of the samples have finished their generation stage but are waiting for the inference stage to start.
Each instance only leaves a few long-tailed samples to process, which is memory-bound as discussed in §<a href="#S2.SS2" title="2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2.2</span></a>.
This condition facilitates the migration of samples from all instances to a few designated instances.
This migration not only consolidates the GPU utilization of the receiving instances
but also releases resources from the sending instances.
The released resources are then promptly utilized to launch inference tasks in advance.
One example of a fused execution plan is shown in Figure <a href="#S4.F5" title="Figure 5 ‣ 4.1 Opportunities and Challenges ‣ 4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a>.
This approach greatly improves the GPU utilization and optimizes the overall execution time of the two stages.</p>
</div>
<div id="S4.SS1.p3" class="ltx_para ltx_noindent">
<p id="S4.SS1.p3.1" class="ltx_p"><span id="S4.SS1.p3.1.1" class="ltx_text ltx_font_bold">Challenges.</span>
With the inter-stage fusion, the problem now lies in generating an efficient
fused execution plan that decides the migration timing, destination, and mechanism.
These three factors significantly affect the overall execution time of the two stages,
and therefore must be chosen carefully.</p>
</div>
<div id="S4.SS1.p4" class="ltx_para">
<p id="S4.SS1.p4.1" class="ltx_p">Given that inter-stage fusion appears so promising, a natural question arises:
can we break the synchronization between the inference and training stages similarly? Unfortunately,
training tasks require each mini-batch to maintain the same data distribution,
which necessitates random sampling from all the generated samples. To satisfy
this requirement, it implicitly introduces an unavoidable synchronization boundary.</p>
</div>
<figure id="S4.F5" class="ltx_figure"><img src="/html/2409.13221/assets/x5.png" id="S4.F5.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="289" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S4.F5.2.1.1" class="ltx_text" style="font-size:90%;">Figure 5</span>: </span><span id="S4.F5.3.2" class="ltx_text" style="font-size:90%;">The timeline of serial (top) and fused (bottom) execution of generation and inference stages.</span></figcaption>
</figure>
</section>
<section id="S4.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Fused Execution Plan</h3>

<div id="S4.SS2.p1" class="ltx_para">
<p id="S4.SS2.p1.1" class="ltx_p">The objective of the inter-stage fusion is to overlap the execution of the two stages as much as possible
without affecting the original generation task’s execution time, thereby minimizing the overall execution time of the two stages.
Following this objective, we detail the migration triggering, destination, and mechanism below.</p>
</div>
<div id="S4.SS2.p2" class="ltx_para ltx_noindent">
<p id="S4.SS2.p2.3" class="ltx_p"><span id="S4.SS2.p2.3.2" class="ltx_text ltx_font_bold">Migration triggering.</span>
Triggering the migration significantly influences the efficiency of overlapping the two stages.
If migration is triggered too early, there remain excessive generation samples.
The migration results in only a few model instances remaining available to continue the generation task,
as most are redirected to handle inference tasks.
This scenario places an excessive load on the few generation instances,
leading to prolonged execution times for the original generation task and ultimately extending the overall process.
Conversely, if the migration is triggered too late, it loses most of the overlapping opportunity.
Based on the above analysis, we propose a migration threshold, denoted as <math id="S4.SS2.p2.1.m1.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p2.1.m1.1a"><msub id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml"><mi id="S4.SS2.p2.1.m1.1.1.2" xref="S4.SS2.p2.1.m1.1.1.2.cmml">R</mi><mi id="S4.SS2.p2.1.m1.1.1.3" xref="S4.SS2.p2.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><apply id="S4.SS2.p2.1.m1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.1.m1.1.1.2">𝑅</ci><ci id="S4.SS2.p2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">R_{t}</annotation></semantics></math>.
When <span id="S4.SS2.p2.2.1" class="ltx_text ltx_font_italic">the number of remaining samples in the generation stages falls below <math id="S4.SS2.p2.2.1.m1.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p2.2.1.m1.1a"><msub id="S4.SS2.p2.2.1.m1.1.1" xref="S4.SS2.p2.2.1.m1.1.1.cmml"><mi id="S4.SS2.p2.2.1.m1.1.1.2" xref="S4.SS2.p2.2.1.m1.1.1.2.cmml">R</mi><mi id="S4.SS2.p2.2.1.m1.1.1.3" xref="S4.SS2.p2.2.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.2.1.m1.1b"><apply id="S4.SS2.p2.2.1.m1.1.1.cmml" xref="S4.SS2.p2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.2.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p2.2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.2.1.m1.1.1.2">𝑅</ci><ci id="S4.SS2.p2.2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.2.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.2.1.m1.1c">R_{t}</annotation></semantics></math></span>, the migration is triggered.
To optimize system performance and minimize total execution time, carefully determining <math id="S4.SS2.p2.3.m2.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p2.3.m2.1a"><msub id="S4.SS2.p2.3.m2.1.1" xref="S4.SS2.p2.3.m2.1.1.cmml"><mi id="S4.SS2.p2.3.m2.1.1.2" xref="S4.SS2.p2.3.m2.1.1.2.cmml">R</mi><mi id="S4.SS2.p2.3.m2.1.1.3" xref="S4.SS2.p2.3.m2.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.3.m2.1b"><apply id="S4.SS2.p2.3.m2.1.1.cmml" xref="S4.SS2.p2.3.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.3.m2.1.1.1.cmml" xref="S4.SS2.p2.3.m2.1.1">subscript</csymbol><ci id="S4.SS2.p2.3.m2.1.1.2.cmml" xref="S4.SS2.p2.3.m2.1.1.2">𝑅</ci><ci id="S4.SS2.p2.3.m2.1.1.3.cmml" xref="S4.SS2.p2.3.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.3.m2.1c">R_{t}</annotation></semantics></math> is essential to
find the best trade-off.</p>
</div>
<div id="S4.SS2.p3" class="ltx_para">
<p id="S4.SS2.p3.4" class="ltx_p">To determine the optimal <math id="S4.SS2.p3.1.m1.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p3.1.m1.1a"><msub id="S4.SS2.p3.1.m1.1.1" xref="S4.SS2.p3.1.m1.1.1.cmml"><mi id="S4.SS2.p3.1.m1.1.1.2" xref="S4.SS2.p3.1.m1.1.1.2.cmml">R</mi><mi id="S4.SS2.p3.1.m1.1.1.3" xref="S4.SS2.p3.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.1.m1.1b"><apply id="S4.SS2.p3.1.m1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.1.m1.1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p3.1.m1.1.1.2.cmml" xref="S4.SS2.p3.1.m1.1.1.2">𝑅</ci><ci id="S4.SS2.p3.1.m1.1.1.3.cmml" xref="S4.SS2.p3.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.1.m1.1c">R_{t}</annotation></semantics></math>, we initially conducted offline generation trials to analyze
the length distribution of the generated samples. This analysis enables us to estimate the
computational load for both the generation and inference stages accurately.
We then systematically test <math id="S4.SS2.p3.2.m2.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p3.2.m2.1a"><msub id="S4.SS2.p3.2.m2.1.1" xref="S4.SS2.p3.2.m2.1.1.cmml"><mi id="S4.SS2.p3.2.m2.1.1.2" xref="S4.SS2.p3.2.m2.1.1.2.cmml">R</mi><mi id="S4.SS2.p3.2.m2.1.1.3" xref="S4.SS2.p3.2.m2.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.2.m2.1b"><apply id="S4.SS2.p3.2.m2.1.1.cmml" xref="S4.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.2.m2.1.1.1.cmml" xref="S4.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p3.2.m2.1.1.2.cmml" xref="S4.SS2.p3.2.m2.1.1.2">𝑅</ci><ci id="S4.SS2.p3.2.m2.1.1.3.cmml" xref="S4.SS2.p3.2.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.2.m2.1c">R_{t}</annotation></semantics></math> values ranging from 5% to 95% of the global batch size,
simulating the execution time for each value. The optimal <math id="S4.SS2.p3.3.m3.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p3.3.m3.1a"><msub id="S4.SS2.p3.3.m3.1.1" xref="S4.SS2.p3.3.m3.1.1.cmml"><mi id="S4.SS2.p3.3.m3.1.1.2" xref="S4.SS2.p3.3.m3.1.1.2.cmml">R</mi><mi id="S4.SS2.p3.3.m3.1.1.3" xref="S4.SS2.p3.3.m3.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.3.m3.1b"><apply id="S4.SS2.p3.3.m3.1.1.cmml" xref="S4.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.3.m3.1.1.1.cmml" xref="S4.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p3.3.m3.1.1.2.cmml" xref="S4.SS2.p3.3.m3.1.1.2">𝑅</ci><ci id="S4.SS2.p3.3.m3.1.1.3.cmml" xref="S4.SS2.p3.3.m3.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.3.m3.1c">R_{t}</annotation></semantics></math> is identified as the value that
yields the minimum simulated execution time. Additionally, during runtime, we
refine the distribution by incorporating new generation samples,
which allows us to update <math id="S4.SS2.p3.4.m4.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S4.SS2.p3.4.m4.1a"><msub id="S4.SS2.p3.4.m4.1.1" xref="S4.SS2.p3.4.m4.1.1.cmml"><mi id="S4.SS2.p3.4.m4.1.1.2" xref="S4.SS2.p3.4.m4.1.1.2.cmml">R</mi><mi id="S4.SS2.p3.4.m4.1.1.3" xref="S4.SS2.p3.4.m4.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.4.m4.1b"><apply id="S4.SS2.p3.4.m4.1.1.cmml" xref="S4.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.4.m4.1.1.1.cmml" xref="S4.SS2.p3.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p3.4.m4.1.1.2.cmml" xref="S4.SS2.p3.4.m4.1.1.2">𝑅</ci><ci id="S4.SS2.p3.4.m4.1.1.3.cmml" xref="S4.SS2.p3.4.m4.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.4.m4.1c">R_{t}</annotation></semantics></math> as needed to continually optimize performance.</p>
</div>
<div id="S4.SS2.p4" class="ltx_para">
<p id="S4.SS2.p4.1" class="ltx_p">Note that it is possible to achieve finer-grained overlapping by triggering migration
more than once. However, we find that in practice, the generation time of long-tailed samples
often exceeds the execution time of inference tasks, so one migration is usually sufficient
to fully overlap the entire inference stage, as shown in §<a href="#S7.SS2" title="7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.2</span></a>.</p>
</div>
<div id="S4.SS2.p5" class="ltx_para ltx_noindent">
<p id="S4.SS2.p5.7" class="ltx_p"><span id="S4.SS2.p5.7.1" class="ltx_text ltx_font_bold">Migration destination.</span>
Once the migration timing is determined, we need to select <math id="S4.SS2.p5.1.m1.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS2.p5.1.m1.1a"><mi id="S4.SS2.p5.1.m1.1.1" xref="S4.SS2.p5.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.1.m1.1b"><ci id="S4.SS2.p5.1.m1.1.1.cmml" xref="S4.SS2.p5.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.1.m1.1c">m</annotation></semantics></math> generation
instances to handle the remaining samples. Assume there are <math id="S4.SS2.p5.2.m2.1" class="ltx_Math" alttext="n" display="inline"><semantics id="S4.SS2.p5.2.m2.1a"><mi id="S4.SS2.p5.2.m2.1.1" xref="S4.SS2.p5.2.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.2.m2.1b"><ci id="S4.SS2.p5.2.m2.1.1.cmml" xref="S4.SS2.p5.2.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.2.m2.1c">n</annotation></semantics></math> generation instances in total,
then there will be <math id="S4.SS2.p5.3.m3.1" class="ltx_Math" alttext="n-m" display="inline"><semantics id="S4.SS2.p5.3.m3.1a"><mrow id="S4.SS2.p5.3.m3.1.1" xref="S4.SS2.p5.3.m3.1.1.cmml"><mi id="S4.SS2.p5.3.m3.1.1.2" xref="S4.SS2.p5.3.m3.1.1.2.cmml">n</mi><mo id="S4.SS2.p5.3.m3.1.1.1" xref="S4.SS2.p5.3.m3.1.1.1.cmml">−</mo><mi id="S4.SS2.p5.3.m3.1.1.3" xref="S4.SS2.p5.3.m3.1.1.3.cmml">m</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.3.m3.1b"><apply id="S4.SS2.p5.3.m3.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1"><minus id="S4.SS2.p5.3.m3.1.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1.1"></minus><ci id="S4.SS2.p5.3.m3.1.1.2.cmml" xref="S4.SS2.p5.3.m3.1.1.2">𝑛</ci><ci id="S4.SS2.p5.3.m3.1.1.3.cmml" xref="S4.SS2.p5.3.m3.1.1.3">𝑚</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.3.m3.1c">n-m</annotation></semantics></math> instances to be repurposed for inference tasks.
To determine <math id="S4.SS2.p5.4.m4.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS2.p5.4.m4.1a"><mi id="S4.SS2.p5.4.m4.1.1" xref="S4.SS2.p5.4.m4.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.4.m4.1b"><ci id="S4.SS2.p5.4.m4.1.1.cmml" xref="S4.SS2.p5.4.m4.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.4.m4.1c">m</annotation></semantics></math>, we revisit the computation characteristics of the generation task.
During the memory-bound decoding phase of generation,
as long as the batch size does not exceed a certain threshold that saturates the GPU
(denoted as <math id="S4.SS2.p5.5.m5.1" class="ltx_Math" alttext="BS_{max}" display="inline"><semantics id="S4.SS2.p5.5.m5.1a"><mrow id="S4.SS2.p5.5.m5.1.1" xref="S4.SS2.p5.5.m5.1.1.cmml"><mi id="S4.SS2.p5.5.m5.1.1.2" xref="S4.SS2.p5.5.m5.1.1.2.cmml">B</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.5.m5.1.1.1" xref="S4.SS2.p5.5.m5.1.1.1.cmml">​</mo><msub id="S4.SS2.p5.5.m5.1.1.3" xref="S4.SS2.p5.5.m5.1.1.3.cmml"><mi id="S4.SS2.p5.5.m5.1.1.3.2" xref="S4.SS2.p5.5.m5.1.1.3.2.cmml">S</mi><mrow id="S4.SS2.p5.5.m5.1.1.3.3" xref="S4.SS2.p5.5.m5.1.1.3.3.cmml"><mi id="S4.SS2.p5.5.m5.1.1.3.3.2" xref="S4.SS2.p5.5.m5.1.1.3.3.2.cmml">m</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.5.m5.1.1.3.3.1" xref="S4.SS2.p5.5.m5.1.1.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.5.m5.1.1.3.3.3" xref="S4.SS2.p5.5.m5.1.1.3.3.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.5.m5.1.1.3.3.1a" xref="S4.SS2.p5.5.m5.1.1.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.5.m5.1.1.3.3.4" xref="S4.SS2.p5.5.m5.1.1.3.3.4.cmml">x</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.5.m5.1b"><apply id="S4.SS2.p5.5.m5.1.1.cmml" xref="S4.SS2.p5.5.m5.1.1"><times id="S4.SS2.p5.5.m5.1.1.1.cmml" xref="S4.SS2.p5.5.m5.1.1.1"></times><ci id="S4.SS2.p5.5.m5.1.1.2.cmml" xref="S4.SS2.p5.5.m5.1.1.2">𝐵</ci><apply id="S4.SS2.p5.5.m5.1.1.3.cmml" xref="S4.SS2.p5.5.m5.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.p5.5.m5.1.1.3.1.cmml" xref="S4.SS2.p5.5.m5.1.1.3">subscript</csymbol><ci id="S4.SS2.p5.5.m5.1.1.3.2.cmml" xref="S4.SS2.p5.5.m5.1.1.3.2">𝑆</ci><apply id="S4.SS2.p5.5.m5.1.1.3.3.cmml" xref="S4.SS2.p5.5.m5.1.1.3.3"><times id="S4.SS2.p5.5.m5.1.1.3.3.1.cmml" xref="S4.SS2.p5.5.m5.1.1.3.3.1"></times><ci id="S4.SS2.p5.5.m5.1.1.3.3.2.cmml" xref="S4.SS2.p5.5.m5.1.1.3.3.2">𝑚</ci><ci id="S4.SS2.p5.5.m5.1.1.3.3.3.cmml" xref="S4.SS2.p5.5.m5.1.1.3.3.3">𝑎</ci><ci id="S4.SS2.p5.5.m5.1.1.3.3.4.cmml" xref="S4.SS2.p5.5.m5.1.1.3.3.4">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.5.m5.1c">BS_{max}</annotation></semantics></math>), the latency of each decoding iteration remains almost constant <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib26" title="" class="ltx_ref">26</a>, <a href="#bib.bib27" title="" class="ltx_ref">27</a>]</cite>.
The value of <math id="S4.SS2.p5.6.m6.1" class="ltx_Math" alttext="BS_{max}" display="inline"><semantics id="S4.SS2.p5.6.m6.1a"><mrow id="S4.SS2.p5.6.m6.1.1" xref="S4.SS2.p5.6.m6.1.1.cmml"><mi id="S4.SS2.p5.6.m6.1.1.2" xref="S4.SS2.p5.6.m6.1.1.2.cmml">B</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.6.m6.1.1.1" xref="S4.SS2.p5.6.m6.1.1.1.cmml">​</mo><msub id="S4.SS2.p5.6.m6.1.1.3" xref="S4.SS2.p5.6.m6.1.1.3.cmml"><mi id="S4.SS2.p5.6.m6.1.1.3.2" xref="S4.SS2.p5.6.m6.1.1.3.2.cmml">S</mi><mrow id="S4.SS2.p5.6.m6.1.1.3.3" xref="S4.SS2.p5.6.m6.1.1.3.3.cmml"><mi id="S4.SS2.p5.6.m6.1.1.3.3.2" xref="S4.SS2.p5.6.m6.1.1.3.3.2.cmml">m</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.6.m6.1.1.3.3.1" xref="S4.SS2.p5.6.m6.1.1.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.6.m6.1.1.3.3.3" xref="S4.SS2.p5.6.m6.1.1.3.3.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.6.m6.1.1.3.3.1a" xref="S4.SS2.p5.6.m6.1.1.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.6.m6.1.1.3.3.4" xref="S4.SS2.p5.6.m6.1.1.3.3.4.cmml">x</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.6.m6.1b"><apply id="S4.SS2.p5.6.m6.1.1.cmml" xref="S4.SS2.p5.6.m6.1.1"><times id="S4.SS2.p5.6.m6.1.1.1.cmml" xref="S4.SS2.p5.6.m6.1.1.1"></times><ci id="S4.SS2.p5.6.m6.1.1.2.cmml" xref="S4.SS2.p5.6.m6.1.1.2">𝐵</ci><apply id="S4.SS2.p5.6.m6.1.1.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.p5.6.m6.1.1.3.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3">subscript</csymbol><ci id="S4.SS2.p5.6.m6.1.1.3.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.2">𝑆</ci><apply id="S4.SS2.p5.6.m6.1.1.3.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3"><times id="S4.SS2.p5.6.m6.1.1.3.3.1.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.1"></times><ci id="S4.SS2.p5.6.m6.1.1.3.3.2.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.2">𝑚</ci><ci id="S4.SS2.p5.6.m6.1.1.3.3.3.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.3">𝑎</ci><ci id="S4.SS2.p5.6.m6.1.1.3.3.4.cmml" xref="S4.SS2.p5.6.m6.1.1.3.3.4">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.6.m6.1c">BS_{max}</annotation></semantics></math> depends on the specific GPU hardware and can be determined through prior profiling.
Based on this, we set the first constraint as
<math id="S4.SS2.p5.7.m7.1" class="ltx_Math" alttext="m\geq\frac{R_{t}}{BS_{max}}" display="inline"><semantics id="S4.SS2.p5.7.m7.1a"><mrow id="S4.SS2.p5.7.m7.1.1" xref="S4.SS2.p5.7.m7.1.1.cmml"><mi id="S4.SS2.p5.7.m7.1.1.2" xref="S4.SS2.p5.7.m7.1.1.2.cmml">m</mi><mo id="S4.SS2.p5.7.m7.1.1.1" xref="S4.SS2.p5.7.m7.1.1.1.cmml">≥</mo><mfrac id="S4.SS2.p5.7.m7.1.1.3" xref="S4.SS2.p5.7.m7.1.1.3.cmml"><msub id="S4.SS2.p5.7.m7.1.1.3.2" xref="S4.SS2.p5.7.m7.1.1.3.2.cmml"><mi id="S4.SS2.p5.7.m7.1.1.3.2.2" xref="S4.SS2.p5.7.m7.1.1.3.2.2.cmml">R</mi><mi id="S4.SS2.p5.7.m7.1.1.3.2.3" xref="S4.SS2.p5.7.m7.1.1.3.2.3.cmml">t</mi></msub><mrow id="S4.SS2.p5.7.m7.1.1.3.3" xref="S4.SS2.p5.7.m7.1.1.3.3.cmml"><mi id="S4.SS2.p5.7.m7.1.1.3.3.2" xref="S4.SS2.p5.7.m7.1.1.3.3.2.cmml">B</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.7.m7.1.1.3.3.1" xref="S4.SS2.p5.7.m7.1.1.3.3.1.cmml">​</mo><msub id="S4.SS2.p5.7.m7.1.1.3.3.3" xref="S4.SS2.p5.7.m7.1.1.3.3.3.cmml"><mi id="S4.SS2.p5.7.m7.1.1.3.3.3.2" xref="S4.SS2.p5.7.m7.1.1.3.3.3.2.cmml">S</mi><mrow id="S4.SS2.p5.7.m7.1.1.3.3.3.3" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.cmml"><mi id="S4.SS2.p5.7.m7.1.1.3.3.3.3.2" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.2.cmml">m</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.7.m7.1.1.3.3.3.3.1" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.7.m7.1.1.3.3.3.3.3" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="S4.SS2.p5.7.m7.1.1.3.3.3.3.1a" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.1.cmml">​</mo><mi id="S4.SS2.p5.7.m7.1.1.3.3.3.3.4" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.4.cmml">x</mi></mrow></msub></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.7.m7.1b"><apply id="S4.SS2.p5.7.m7.1.1.cmml" xref="S4.SS2.p5.7.m7.1.1"><geq id="S4.SS2.p5.7.m7.1.1.1.cmml" xref="S4.SS2.p5.7.m7.1.1.1"></geq><ci id="S4.SS2.p5.7.m7.1.1.2.cmml" xref="S4.SS2.p5.7.m7.1.1.2">𝑚</ci><apply id="S4.SS2.p5.7.m7.1.1.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3"><divide id="S4.SS2.p5.7.m7.1.1.3.1.cmml" xref="S4.SS2.p5.7.m7.1.1.3"></divide><apply id="S4.SS2.p5.7.m7.1.1.3.2.cmml" xref="S4.SS2.p5.7.m7.1.1.3.2"><csymbol cd="ambiguous" id="S4.SS2.p5.7.m7.1.1.3.2.1.cmml" xref="S4.SS2.p5.7.m7.1.1.3.2">subscript</csymbol><ci id="S4.SS2.p5.7.m7.1.1.3.2.2.cmml" xref="S4.SS2.p5.7.m7.1.1.3.2.2">𝑅</ci><ci id="S4.SS2.p5.7.m7.1.1.3.2.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3.2.3">𝑡</ci></apply><apply id="S4.SS2.p5.7.m7.1.1.3.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3"><times id="S4.SS2.p5.7.m7.1.1.3.3.1.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.1"></times><ci id="S4.SS2.p5.7.m7.1.1.3.3.2.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.2">𝐵</ci><apply id="S4.SS2.p5.7.m7.1.1.3.3.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.SS2.p5.7.m7.1.1.3.3.3.1.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3">subscript</csymbol><ci id="S4.SS2.p5.7.m7.1.1.3.3.3.2.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.2">𝑆</ci><apply id="S4.SS2.p5.7.m7.1.1.3.3.3.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3"><times id="S4.SS2.p5.7.m7.1.1.3.3.3.3.1.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.1"></times><ci id="S4.SS2.p5.7.m7.1.1.3.3.3.3.2.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.2">𝑚</ci><ci id="S4.SS2.p5.7.m7.1.1.3.3.3.3.3.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.3">𝑎</ci><ci id="S4.SS2.p5.7.m7.1.1.3.3.3.3.4.cmml" xref="S4.SS2.p5.7.m7.1.1.3.3.3.3.4">𝑥</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.7.m7.1c">m\geq\frac{R_{t}}{BS_{max}}</annotation></semantics></math>,
which ensures that the generation time of long-tailed
samples remain unchanged as before the migration.</p>
</div>
<div id="S4.SS2.p6" class="ltx_para">
<p id="S4.SS2.p6.4" class="ltx_p">Another factor to consider is the memory constraint.
During LLM generation, the key-value cache is maintained for each token position for
autoregressive generation.
When the sequence length is long, this memory consumption becomes non-negligible <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib28" title="" class="ltx_ref">28</a>]</cite>.
Therefore, we need to ensure that the target instances have sufficient memory to
accommodate the remaining long-tailed samples, avoiding out-of-memory
issue or blocking the sample processing. Thus, we set the second constraint
as <math id="S4.SS2.p6.1.m1.1" class="ltx_Math" alttext="m\geq\frac{R_{t}*M}{C}" display="inline"><semantics id="S4.SS2.p6.1.m1.1a"><mrow id="S4.SS2.p6.1.m1.1.1" xref="S4.SS2.p6.1.m1.1.1.cmml"><mi id="S4.SS2.p6.1.m1.1.1.2" xref="S4.SS2.p6.1.m1.1.1.2.cmml">m</mi><mo id="S4.SS2.p6.1.m1.1.1.1" xref="S4.SS2.p6.1.m1.1.1.1.cmml">≥</mo><mfrac id="S4.SS2.p6.1.m1.1.1.3" xref="S4.SS2.p6.1.m1.1.1.3.cmml"><mrow id="S4.SS2.p6.1.m1.1.1.3.2" xref="S4.SS2.p6.1.m1.1.1.3.2.cmml"><msub id="S4.SS2.p6.1.m1.1.1.3.2.2" xref="S4.SS2.p6.1.m1.1.1.3.2.2.cmml"><mi id="S4.SS2.p6.1.m1.1.1.3.2.2.2" xref="S4.SS2.p6.1.m1.1.1.3.2.2.2.cmml">R</mi><mi id="S4.SS2.p6.1.m1.1.1.3.2.2.3" xref="S4.SS2.p6.1.m1.1.1.3.2.2.3.cmml">t</mi></msub><mo lspace="0.222em" rspace="0.222em" id="S4.SS2.p6.1.m1.1.1.3.2.1" xref="S4.SS2.p6.1.m1.1.1.3.2.1.cmml">∗</mo><mi id="S4.SS2.p6.1.m1.1.1.3.2.3" xref="S4.SS2.p6.1.m1.1.1.3.2.3.cmml">M</mi></mrow><mi id="S4.SS2.p6.1.m1.1.1.3.3" xref="S4.SS2.p6.1.m1.1.1.3.3.cmml">C</mi></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.1.m1.1b"><apply id="S4.SS2.p6.1.m1.1.1.cmml" xref="S4.SS2.p6.1.m1.1.1"><geq id="S4.SS2.p6.1.m1.1.1.1.cmml" xref="S4.SS2.p6.1.m1.1.1.1"></geq><ci id="S4.SS2.p6.1.m1.1.1.2.cmml" xref="S4.SS2.p6.1.m1.1.1.2">𝑚</ci><apply id="S4.SS2.p6.1.m1.1.1.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3"><divide id="S4.SS2.p6.1.m1.1.1.3.1.cmml" xref="S4.SS2.p6.1.m1.1.1.3"></divide><apply id="S4.SS2.p6.1.m1.1.1.3.2.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2"><times id="S4.SS2.p6.1.m1.1.1.3.2.1.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.1"></times><apply id="S4.SS2.p6.1.m1.1.1.3.2.2.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.2"><csymbol cd="ambiguous" id="S4.SS2.p6.1.m1.1.1.3.2.2.1.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.2">subscript</csymbol><ci id="S4.SS2.p6.1.m1.1.1.3.2.2.2.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.2.2">𝑅</ci><ci id="S4.SS2.p6.1.m1.1.1.3.2.2.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.2.3">𝑡</ci></apply><ci id="S4.SS2.p6.1.m1.1.1.3.2.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3.2.3">𝑀</ci></apply><ci id="S4.SS2.p6.1.m1.1.1.3.3.cmml" xref="S4.SS2.p6.1.m1.1.1.3.3">𝐶</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.1.m1.1c">m\geq\frac{R_{t}*M}{C}</annotation></semantics></math>, where <math id="S4.SS2.p6.2.m2.1" class="ltx_Math" alttext="M" display="inline"><semantics id="S4.SS2.p6.2.m2.1a"><mi id="S4.SS2.p6.2.m2.1.1" xref="S4.SS2.p6.2.m2.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.2.m2.1b"><ci id="S4.SS2.p6.2.m2.1.1.cmml" xref="S4.SS2.p6.2.m2.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.2.m2.1c">M</annotation></semantics></math> denotes the key-value cache consumption of the sample with the maximum
output length and <math id="S4.SS2.p6.3.m3.1" class="ltx_Math" alttext="C" display="inline"><semantics id="S4.SS2.p6.3.m3.1a"><mi id="S4.SS2.p6.3.m3.1.1" xref="S4.SS2.p6.3.m3.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.3.m3.1b"><ci id="S4.SS2.p6.3.m3.1.1.cmml" xref="S4.SS2.p6.3.m3.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.3.m3.1c">C</annotation></semantics></math> is the available GPU memory of the target instance allocated for key-value cache.
In summary, the final <math id="S4.SS2.p6.4.m4.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS2.p6.4.m4.1a"><mi id="S4.SS2.p6.4.m4.1.1" xref="S4.SS2.p6.4.m4.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p6.4.m4.1b"><ci id="S4.SS2.p6.4.m4.1.1.cmml" xref="S4.SS2.p6.4.m4.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p6.4.m4.1c">m</annotation></semantics></math> is determined by the maximum of the two constraints.</p>
</div>
<div id="S4.SS2.p7" class="ltx_para">
<p id="S4.SS2.p7.3" class="ltx_p">Next, we need to determine which <math id="S4.SS2.p7.1.m1.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS2.p7.1.m1.1a"><mi id="S4.SS2.p7.1.m1.1.1" xref="S4.SS2.p7.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.1.m1.1b"><ci id="S4.SS2.p7.1.m1.1.1.cmml" xref="S4.SS2.p7.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.1.m1.1c">m</annotation></semantics></math> out of the
<math id="S4.SS2.p7.2.m2.1" class="ltx_Math" alttext="n" display="inline"><semantics id="S4.SS2.p7.2.m2.1a"><mi id="S4.SS2.p7.2.m2.1.1" xref="S4.SS2.p7.2.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.2.m2.1b"><ci id="S4.SS2.p7.2.m2.1.1.cmml" xref="S4.SS2.p7.2.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.2.m2.1c">n</annotation></semantics></math> generation instances to process the remaining
long-tailed samples. To minimize migration overhead,
we select the top <math id="S4.SS2.p7.3.m3.1" class="ltx_Math" alttext="m" display="inline"><semantics id="S4.SS2.p7.3.m3.1a"><mi id="S4.SS2.p7.3.m3.1.1" xref="S4.SS2.p7.3.m3.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p7.3.m3.1b"><ci id="S4.SS2.p7.3.m3.1.1.cmml" xref="S4.SS2.p7.3.m3.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p7.3.m3.1c">m</annotation></semantics></math> instances that have the most samples remaining.
This strategy minimizes the total number of samples requiring migration.</p>
</div>
<div id="S4.SS2.p8" class="ltx_para ltx_noindent">
<p id="S4.SS2.p8.1" class="ltx_p"><span id="S4.SS2.p8.1.1" class="ltx_text ltx_font_bold">Migration mechanism.</span> To migrate an unfinished sample to the target instance,
we have two choices. The first approach is to transfer the generated key-value
cache to the target instance over the network, allowing it to continue the subsequent
generation immediately upon receipt. The overhead in this case primarily comes from the
network transmission. The second approach is to discard the key-value cache and
only transmit the generated tokens of the sample.
Compared to the first approach, this method incurs minimal network latency but
comes at the cost of rerunning the prefill phase to generate the key-value cache.
The choice of migration mechanism depends on the GPU hardware and network bandwidth.
In our experiments, thanks to the high-bandwidth RDMA connections,
we choose the first approach and the migration overhead is
negligible compared to the iteration time, as shown in §<a href="#S7.SS2" title="7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.2</span></a>.</p>
</div>
<figure id="S4.F6" class="ltx_figure">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img src="/html/2409.13221/assets/x6.png" id="S4.F6.g1" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" width="438" height="110" alt="Refer to caption"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<p id="S4.F6.2" class="ltx_p ltx_figure_panel ltx_align_center">(a) Chimera                                                         (b) RLHFuse</p>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S4.F6.3.1.1" class="ltx_text" style="font-size:90%;">Figure 6</span>: </span><span id="S4.F6.4.2" class="ltx_text" style="font-size:90%;">(a) An example of the symmetric bi-directional pipeline schedule used in Chimera <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib20" title="" class="ltx_ref">20</a>]</cite> with four pipeline stages and four micro-batchs.
(b) An example to show our method can fuse two different models with four and two pipeline stages, respectively.</span></figcaption>
</figure>
<div id="S4.SS2.p9" class="ltx_para">
<p id="S4.SS2.p9.1" class="ltx_p">After completing the migration, we can release the GPU resources
of the remaining <math id="S4.SS2.p9.1.m1.1" class="ltx_Math" alttext="n-m" display="inline"><semantics id="S4.SS2.p9.1.m1.1a"><mrow id="S4.SS2.p9.1.m1.1.1" xref="S4.SS2.p9.1.m1.1.1.cmml"><mi id="S4.SS2.p9.1.m1.1.1.2" xref="S4.SS2.p9.1.m1.1.1.2.cmml">n</mi><mo id="S4.SS2.p9.1.m1.1.1.1" xref="S4.SS2.p9.1.m1.1.1.1.cmml">−</mo><mi id="S4.SS2.p9.1.m1.1.1.3" xref="S4.SS2.p9.1.m1.1.1.3.cmml">m</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p9.1.m1.1b"><apply id="S4.SS2.p9.1.m1.1.1.cmml" xref="S4.SS2.p9.1.m1.1.1"><minus id="S4.SS2.p9.1.m1.1.1.1.cmml" xref="S4.SS2.p9.1.m1.1.1.1"></minus><ci id="S4.SS2.p9.1.m1.1.1.2.cmml" xref="S4.SS2.p9.1.m1.1.1.2">𝑛</ci><ci id="S4.SS2.p9.1.m1.1.1.3.cmml" xref="S4.SS2.p9.1.m1.1.1.3">𝑚</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p9.1.m1.1c">n-m</annotation></semantics></math> generation instances to launch inference tasks.
This process involves weights redistribution and data transmission to prepare
the context of inference tasks, which we discuss in §<a href="#S6" title="6 System Implementation and Optimizations ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>.
Once the inference tasks are launched, the remaining long-tailed
samples can be streamed to the inference instances as soon as their generation stage
is completed, allowing for seamless processing.
Additionally, if the long-tail generation task finishes first,
we release its resources for the inference tasks.</p>
</div>
</section>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Model-aware Intra-Stage Fusion</h2>

<div id="S5.p1" class="ltx_para">
<p id="S5.p1.1" class="ltx_p">In this section, we first analyze the opportunities of fusing the
two tasks in the training stage (§<a href="#S5.SS1" title="5.1 Opportunities and Challenges ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5.1</span></a>).
Then we propose a lightweight algorithm to generate the fused pipeline schedule to minimize
the pipeline bubbles and memory usage (§<a href="#S5.SS2" title="5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5.2</span></a>).</p>
</div>
<section id="S5.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Opportunities and Challenges</h3>

<div id="S5.SS1.p1" class="ltx_para ltx_noindent">
<p id="S5.SS1.p1.1" class="ltx_p"><span id="S5.SS1.p1.1.1" class="ltx_text ltx_font_bold">Opportunities.</span>
During the RLHF training stage, the <span id="S5.SS1.p1.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S5.SS1.p1.1.3" class="ltx_text ltx_font_typewriter">Critic</span> models are trained
independently. Inspired by the bi-directional pipeline schedule <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib20" title="" class="ltx_ref">20</a>]</cite> from Chimera,
we can break the two training tasks into subtasks of micro-batches and co-locate
these subtasks to mutually fill the pipeline bubbles of each other.
Originally, Chimera enhances single-model training by replicating the model and trains
the replicated model with 1F1B schedule in opposite pipeline directions, as depicted in Figure <a href="#S4.F6" title="Figure 6 ‣ 4.2 Fused Execution Plan ‣ 4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>(a).
This approach not only mitigates pipeline bubbles but also brings a balanced distribution of activation memory.
RLHF training stage inherently involves two distinct models,
enabling us to apply the fused pipeline schedule without extra model replication.</p>
</div>
<div id="S5.SS1.p2" class="ltx_para ltx_noindent">
<p id="S5.SS1.p2.1" class="ltx_p"><span id="S5.SS1.p2.1.1" class="ltx_text ltx_font_bold">Challenges.</span>
In Chimera, the bi-directional pipeline schedule utilizes one identical model replica
with uniform size and parallel strategy, resulting in a symmetric execution flow.
In contrast, RLHF involves training heterogeneous <span id="S5.SS1.p2.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S5.SS1.p2.1.3" class="ltx_text ltx_font_typewriter">Critic</span> models,
which differ not only in size but also in their optimal parallel strategies.
Consequently, the symmetric schedule from Chimera is no longer applicable in
the face of model heterogeneity in terms of size and parallel configuration.
In the following, we introduce a lightweight and efficient algorithm to automatically generate
the fused pipeline schedule under this more generalized setting.</p>
</div>
</section>
<section id="S5.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Fused Pipeline Schedule</h3>

<div id="S5.SS2.p1" class="ltx_para ltx_noindent">
<p id="S5.SS2.p1.21" class="ltx_p"><span id="S5.SS2.p1.21.1" class="ltx_text ltx_font_bold">Problem transformation.</span>
Assume the parallel strategies for models <math id="S5.SS2.p1.1.m1.1" class="ltx_Math" alttext="A" display="inline"><semantics id="S5.SS2.p1.1.m1.1a"><mi id="S5.SS2.p1.1.m1.1.1" xref="S5.SS2.p1.1.m1.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.1.m1.1b"><ci id="S5.SS2.p1.1.m1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">A</annotation></semantics></math> and <math id="S5.SS2.p1.2.m2.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.SS2.p1.2.m2.1a"><mi id="S5.SS2.p1.2.m2.1.1" xref="S5.SS2.p1.2.m2.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.2.m2.1b"><ci id="S5.SS2.p1.2.m2.1.1.cmml" xref="S5.SS2.p1.2.m2.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.2.m2.1c">B</annotation></semantics></math> are <math id="S5.SS2.p1.3.m3.3" class="ltx_Math" alttext="(dp_{1},pp_{1},tp_{1})" display="inline"><semantics id="S5.SS2.p1.3.m3.3a"><mrow id="S5.SS2.p1.3.m3.3.3.3" xref="S5.SS2.p1.3.m3.3.3.4.cmml"><mo stretchy="false" id="S5.SS2.p1.3.m3.3.3.3.4" xref="S5.SS2.p1.3.m3.3.3.4.cmml">(</mo><mrow id="S5.SS2.p1.3.m3.1.1.1.1" xref="S5.SS2.p1.3.m3.1.1.1.1.cmml"><mi id="S5.SS2.p1.3.m3.1.1.1.1.2" xref="S5.SS2.p1.3.m3.1.1.1.1.2.cmml">d</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.3.m3.1.1.1.1.1" xref="S5.SS2.p1.3.m3.1.1.1.1.1.cmml">​</mo><msub id="S5.SS2.p1.3.m3.1.1.1.1.3" xref="S5.SS2.p1.3.m3.1.1.1.1.3.cmml"><mi id="S5.SS2.p1.3.m3.1.1.1.1.3.2" xref="S5.SS2.p1.3.m3.1.1.1.1.3.2.cmml">p</mi><mn id="S5.SS2.p1.3.m3.1.1.1.1.3.3" xref="S5.SS2.p1.3.m3.1.1.1.1.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p1.3.m3.3.3.3.5" xref="S5.SS2.p1.3.m3.3.3.4.cmml">,</mo><mrow id="S5.SS2.p1.3.m3.2.2.2.2" xref="S5.SS2.p1.3.m3.2.2.2.2.cmml"><mi id="S5.SS2.p1.3.m3.2.2.2.2.2" xref="S5.SS2.p1.3.m3.2.2.2.2.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.3.m3.2.2.2.2.1" xref="S5.SS2.p1.3.m3.2.2.2.2.1.cmml">​</mo><msub id="S5.SS2.p1.3.m3.2.2.2.2.3" xref="S5.SS2.p1.3.m3.2.2.2.2.3.cmml"><mi id="S5.SS2.p1.3.m3.2.2.2.2.3.2" xref="S5.SS2.p1.3.m3.2.2.2.2.3.2.cmml">p</mi><mn id="S5.SS2.p1.3.m3.2.2.2.2.3.3" xref="S5.SS2.p1.3.m3.2.2.2.2.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p1.3.m3.3.3.3.6" xref="S5.SS2.p1.3.m3.3.3.4.cmml">,</mo><mrow id="S5.SS2.p1.3.m3.3.3.3.3" xref="S5.SS2.p1.3.m3.3.3.3.3.cmml"><mi id="S5.SS2.p1.3.m3.3.3.3.3.2" xref="S5.SS2.p1.3.m3.3.3.3.3.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.3.m3.3.3.3.3.1" xref="S5.SS2.p1.3.m3.3.3.3.3.1.cmml">​</mo><msub id="S5.SS2.p1.3.m3.3.3.3.3.3" xref="S5.SS2.p1.3.m3.3.3.3.3.3.cmml"><mi id="S5.SS2.p1.3.m3.3.3.3.3.3.2" xref="S5.SS2.p1.3.m3.3.3.3.3.3.2.cmml">p</mi><mn id="S5.SS2.p1.3.m3.3.3.3.3.3.3" xref="S5.SS2.p1.3.m3.3.3.3.3.3.3.cmml">1</mn></msub></mrow><mo stretchy="false" id="S5.SS2.p1.3.m3.3.3.3.7" xref="S5.SS2.p1.3.m3.3.3.4.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.3.m3.3b"><vector id="S5.SS2.p1.3.m3.3.3.4.cmml" xref="S5.SS2.p1.3.m3.3.3.3"><apply id="S5.SS2.p1.3.m3.1.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1"><times id="S5.SS2.p1.3.m3.1.1.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.1"></times><ci id="S5.SS2.p1.3.m3.1.1.1.1.2.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.2">𝑑</ci><apply id="S5.SS2.p1.3.m3.1.1.1.1.3.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.1.1.1.1.3.1.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.3">subscript</csymbol><ci id="S5.SS2.p1.3.m3.1.1.1.1.3.2.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.3.m3.1.1.1.1.3.3.cmml" xref="S5.SS2.p1.3.m3.1.1.1.1.3.3">1</cn></apply></apply><apply id="S5.SS2.p1.3.m3.2.2.2.2.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2"><times id="S5.SS2.p1.3.m3.2.2.2.2.1.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.1"></times><ci id="S5.SS2.p1.3.m3.2.2.2.2.2.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.2">𝑝</ci><apply id="S5.SS2.p1.3.m3.2.2.2.2.3.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.3"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.2.2.2.2.3.1.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.3">subscript</csymbol><ci id="S5.SS2.p1.3.m3.2.2.2.2.3.2.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.3.m3.2.2.2.2.3.3.cmml" xref="S5.SS2.p1.3.m3.2.2.2.2.3.3">1</cn></apply></apply><apply id="S5.SS2.p1.3.m3.3.3.3.3.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3"><times id="S5.SS2.p1.3.m3.3.3.3.3.1.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.1"></times><ci id="S5.SS2.p1.3.m3.3.3.3.3.2.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.2">𝑡</ci><apply id="S5.SS2.p1.3.m3.3.3.3.3.3.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.3.3.3.3.3.1.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.3">subscript</csymbol><ci id="S5.SS2.p1.3.m3.3.3.3.3.3.2.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.3.m3.3.3.3.3.3.3.cmml" xref="S5.SS2.p1.3.m3.3.3.3.3.3.3">1</cn></apply></apply></vector></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.3.m3.3c">(dp_{1},pp_{1},tp_{1})</annotation></semantics></math>
and <math id="S5.SS2.p1.4.m4.3" class="ltx_Math" alttext="(dp_{2},pp_{2},tp_{2})" display="inline"><semantics id="S5.SS2.p1.4.m4.3a"><mrow id="S5.SS2.p1.4.m4.3.3.3" xref="S5.SS2.p1.4.m4.3.3.4.cmml"><mo stretchy="false" id="S5.SS2.p1.4.m4.3.3.3.4" xref="S5.SS2.p1.4.m4.3.3.4.cmml">(</mo><mrow id="S5.SS2.p1.4.m4.1.1.1.1" xref="S5.SS2.p1.4.m4.1.1.1.1.cmml"><mi id="S5.SS2.p1.4.m4.1.1.1.1.2" xref="S5.SS2.p1.4.m4.1.1.1.1.2.cmml">d</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.4.m4.1.1.1.1.1" xref="S5.SS2.p1.4.m4.1.1.1.1.1.cmml">​</mo><msub id="S5.SS2.p1.4.m4.1.1.1.1.3" xref="S5.SS2.p1.4.m4.1.1.1.1.3.cmml"><mi id="S5.SS2.p1.4.m4.1.1.1.1.3.2" xref="S5.SS2.p1.4.m4.1.1.1.1.3.2.cmml">p</mi><mn id="S5.SS2.p1.4.m4.1.1.1.1.3.3" xref="S5.SS2.p1.4.m4.1.1.1.1.3.3.cmml">2</mn></msub></mrow><mo id="S5.SS2.p1.4.m4.3.3.3.5" xref="S5.SS2.p1.4.m4.3.3.4.cmml">,</mo><mrow id="S5.SS2.p1.4.m4.2.2.2.2" xref="S5.SS2.p1.4.m4.2.2.2.2.cmml"><mi id="S5.SS2.p1.4.m4.2.2.2.2.2" xref="S5.SS2.p1.4.m4.2.2.2.2.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.4.m4.2.2.2.2.1" xref="S5.SS2.p1.4.m4.2.2.2.2.1.cmml">​</mo><msub id="S5.SS2.p1.4.m4.2.2.2.2.3" xref="S5.SS2.p1.4.m4.2.2.2.2.3.cmml"><mi id="S5.SS2.p1.4.m4.2.2.2.2.3.2" xref="S5.SS2.p1.4.m4.2.2.2.2.3.2.cmml">p</mi><mn id="S5.SS2.p1.4.m4.2.2.2.2.3.3" xref="S5.SS2.p1.4.m4.2.2.2.2.3.3.cmml">2</mn></msub></mrow><mo id="S5.SS2.p1.4.m4.3.3.3.6" xref="S5.SS2.p1.4.m4.3.3.4.cmml">,</mo><mrow id="S5.SS2.p1.4.m4.3.3.3.3" xref="S5.SS2.p1.4.m4.3.3.3.3.cmml"><mi id="S5.SS2.p1.4.m4.3.3.3.3.2" xref="S5.SS2.p1.4.m4.3.3.3.3.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.4.m4.3.3.3.3.1" xref="S5.SS2.p1.4.m4.3.3.3.3.1.cmml">​</mo><msub id="S5.SS2.p1.4.m4.3.3.3.3.3" xref="S5.SS2.p1.4.m4.3.3.3.3.3.cmml"><mi id="S5.SS2.p1.4.m4.3.3.3.3.3.2" xref="S5.SS2.p1.4.m4.3.3.3.3.3.2.cmml">p</mi><mn id="S5.SS2.p1.4.m4.3.3.3.3.3.3" xref="S5.SS2.p1.4.m4.3.3.3.3.3.3.cmml">2</mn></msub></mrow><mo stretchy="false" id="S5.SS2.p1.4.m4.3.3.3.7" xref="S5.SS2.p1.4.m4.3.3.4.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.4.m4.3b"><vector id="S5.SS2.p1.4.m4.3.3.4.cmml" xref="S5.SS2.p1.4.m4.3.3.3"><apply id="S5.SS2.p1.4.m4.1.1.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1"><times id="S5.SS2.p1.4.m4.1.1.1.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.1"></times><ci id="S5.SS2.p1.4.m4.1.1.1.1.2.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.2">𝑑</ci><apply id="S5.SS2.p1.4.m4.1.1.1.1.3.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.1.1.1.1.3.1.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.3">subscript</csymbol><ci id="S5.SS2.p1.4.m4.1.1.1.1.3.2.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.4.m4.1.1.1.1.3.3.cmml" xref="S5.SS2.p1.4.m4.1.1.1.1.3.3">2</cn></apply></apply><apply id="S5.SS2.p1.4.m4.2.2.2.2.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2"><times id="S5.SS2.p1.4.m4.2.2.2.2.1.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.1"></times><ci id="S5.SS2.p1.4.m4.2.2.2.2.2.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.2">𝑝</ci><apply id="S5.SS2.p1.4.m4.2.2.2.2.3.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.3"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.2.2.2.2.3.1.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.3">subscript</csymbol><ci id="S5.SS2.p1.4.m4.2.2.2.2.3.2.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.4.m4.2.2.2.2.3.3.cmml" xref="S5.SS2.p1.4.m4.2.2.2.2.3.3">2</cn></apply></apply><apply id="S5.SS2.p1.4.m4.3.3.3.3.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3"><times id="S5.SS2.p1.4.m4.3.3.3.3.1.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.1"></times><ci id="S5.SS2.p1.4.m4.3.3.3.3.2.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.2">𝑡</ci><apply id="S5.SS2.p1.4.m4.3.3.3.3.3.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.3.3.3.3.3.1.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.3">subscript</csymbol><ci id="S5.SS2.p1.4.m4.3.3.3.3.3.2.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.4.m4.3.3.3.3.3.3.cmml" xref="S5.SS2.p1.4.m4.3.3.3.3.3.3">2</cn></apply></apply></vector></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.4.m4.3c">(dp_{2},pp_{2},tp_{2})</annotation></semantics></math>. Each will utilize all the GPUs in the cluster.
We require that <math id="S5.SS2.p1.5.m5.1" class="ltx_Math" alttext="tp" display="inline"><semantics id="S5.SS2.p1.5.m5.1a"><mrow id="S5.SS2.p1.5.m5.1.1" xref="S5.SS2.p1.5.m5.1.1.cmml"><mi id="S5.SS2.p1.5.m5.1.1.2" xref="S5.SS2.p1.5.m5.1.1.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.5.m5.1.1.1" xref="S5.SS2.p1.5.m5.1.1.1.cmml">​</mo><mi id="S5.SS2.p1.5.m5.1.1.3" xref="S5.SS2.p1.5.m5.1.1.3.cmml">p</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.5.m5.1b"><apply id="S5.SS2.p1.5.m5.1.1.cmml" xref="S5.SS2.p1.5.m5.1.1"><times id="S5.SS2.p1.5.m5.1.1.1.cmml" xref="S5.SS2.p1.5.m5.1.1.1"></times><ci id="S5.SS2.p1.5.m5.1.1.2.cmml" xref="S5.SS2.p1.5.m5.1.1.2">𝑡</ci><ci id="S5.SS2.p1.5.m5.1.1.3.cmml" xref="S5.SS2.p1.5.m5.1.1.3">𝑝</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.5.m5.1c">tp</annotation></semantics></math> is the powers of two, which is
commonly adopted in practice.
For the case where <math id="S5.SS2.p1.6.m6.1" class="ltx_Math" alttext="tp_{1}\neq tp_{2}" display="inline"><semantics id="S5.SS2.p1.6.m6.1a"><mrow id="S5.SS2.p1.6.m6.1.1" xref="S5.SS2.p1.6.m6.1.1.cmml"><mrow id="S5.SS2.p1.6.m6.1.1.2" xref="S5.SS2.p1.6.m6.1.1.2.cmml"><mi id="S5.SS2.p1.6.m6.1.1.2.2" xref="S5.SS2.p1.6.m6.1.1.2.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.6.m6.1.1.2.1" xref="S5.SS2.p1.6.m6.1.1.2.1.cmml">​</mo><msub id="S5.SS2.p1.6.m6.1.1.2.3" xref="S5.SS2.p1.6.m6.1.1.2.3.cmml"><mi id="S5.SS2.p1.6.m6.1.1.2.3.2" xref="S5.SS2.p1.6.m6.1.1.2.3.2.cmml">p</mi><mn id="S5.SS2.p1.6.m6.1.1.2.3.3" xref="S5.SS2.p1.6.m6.1.1.2.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p1.6.m6.1.1.1" xref="S5.SS2.p1.6.m6.1.1.1.cmml">≠</mo><mrow id="S5.SS2.p1.6.m6.1.1.3" xref="S5.SS2.p1.6.m6.1.1.3.cmml"><mi id="S5.SS2.p1.6.m6.1.1.3.2" xref="S5.SS2.p1.6.m6.1.1.3.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.6.m6.1.1.3.1" xref="S5.SS2.p1.6.m6.1.1.3.1.cmml">​</mo><msub id="S5.SS2.p1.6.m6.1.1.3.3" xref="S5.SS2.p1.6.m6.1.1.3.3.cmml"><mi id="S5.SS2.p1.6.m6.1.1.3.3.2" xref="S5.SS2.p1.6.m6.1.1.3.3.2.cmml">p</mi><mn id="S5.SS2.p1.6.m6.1.1.3.3.3" xref="S5.SS2.p1.6.m6.1.1.3.3.3.cmml">2</mn></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.6.m6.1b"><apply id="S5.SS2.p1.6.m6.1.1.cmml" xref="S5.SS2.p1.6.m6.1.1"><neq id="S5.SS2.p1.6.m6.1.1.1.cmml" xref="S5.SS2.p1.6.m6.1.1.1"></neq><apply id="S5.SS2.p1.6.m6.1.1.2.cmml" xref="S5.SS2.p1.6.m6.1.1.2"><times id="S5.SS2.p1.6.m6.1.1.2.1.cmml" xref="S5.SS2.p1.6.m6.1.1.2.1"></times><ci id="S5.SS2.p1.6.m6.1.1.2.2.cmml" xref="S5.SS2.p1.6.m6.1.1.2.2">𝑡</ci><apply id="S5.SS2.p1.6.m6.1.1.2.3.cmml" xref="S5.SS2.p1.6.m6.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS2.p1.6.m6.1.1.2.3.1.cmml" xref="S5.SS2.p1.6.m6.1.1.2.3">subscript</csymbol><ci id="S5.SS2.p1.6.m6.1.1.2.3.2.cmml" xref="S5.SS2.p1.6.m6.1.1.2.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.6.m6.1.1.2.3.3.cmml" xref="S5.SS2.p1.6.m6.1.1.2.3.3">1</cn></apply></apply><apply id="S5.SS2.p1.6.m6.1.1.3.cmml" xref="S5.SS2.p1.6.m6.1.1.3"><times id="S5.SS2.p1.6.m6.1.1.3.1.cmml" xref="S5.SS2.p1.6.m6.1.1.3.1"></times><ci id="S5.SS2.p1.6.m6.1.1.3.2.cmml" xref="S5.SS2.p1.6.m6.1.1.3.2">𝑡</ci><apply id="S5.SS2.p1.6.m6.1.1.3.3.cmml" xref="S5.SS2.p1.6.m6.1.1.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.6.m6.1.1.3.3.1.cmml" xref="S5.SS2.p1.6.m6.1.1.3.3">subscript</csymbol><ci id="S5.SS2.p1.6.m6.1.1.3.3.2.cmml" xref="S5.SS2.p1.6.m6.1.1.3.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.6.m6.1.1.3.3.3.cmml" xref="S5.SS2.p1.6.m6.1.1.3.3.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.6.m6.1c">tp_{1}\neq tp_{2}</annotation></semantics></math>, the challenge for a fused pipeline schedule
lies in the fact that the pipeline stage of the two models contains a different number of GPUs.
Without loss of generality, we assume <math id="S5.SS2.p1.7.m7.1" class="ltx_Math" alttext="tp_{1}=s\times tp_{2}" display="inline"><semantics id="S5.SS2.p1.7.m7.1a"><mrow id="S5.SS2.p1.7.m7.1.1" xref="S5.SS2.p1.7.m7.1.1.cmml"><mrow id="S5.SS2.p1.7.m7.1.1.2" xref="S5.SS2.p1.7.m7.1.1.2.cmml"><mi id="S5.SS2.p1.7.m7.1.1.2.2" xref="S5.SS2.p1.7.m7.1.1.2.2.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.7.m7.1.1.2.1" xref="S5.SS2.p1.7.m7.1.1.2.1.cmml">​</mo><msub id="S5.SS2.p1.7.m7.1.1.2.3" xref="S5.SS2.p1.7.m7.1.1.2.3.cmml"><mi id="S5.SS2.p1.7.m7.1.1.2.3.2" xref="S5.SS2.p1.7.m7.1.1.2.3.2.cmml">p</mi><mn id="S5.SS2.p1.7.m7.1.1.2.3.3" xref="S5.SS2.p1.7.m7.1.1.2.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p1.7.m7.1.1.1" xref="S5.SS2.p1.7.m7.1.1.1.cmml">=</mo><mrow id="S5.SS2.p1.7.m7.1.1.3" xref="S5.SS2.p1.7.m7.1.1.3.cmml"><mrow id="S5.SS2.p1.7.m7.1.1.3.2" xref="S5.SS2.p1.7.m7.1.1.3.2.cmml"><mi id="S5.SS2.p1.7.m7.1.1.3.2.2" xref="S5.SS2.p1.7.m7.1.1.3.2.2.cmml">s</mi><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p1.7.m7.1.1.3.2.1" xref="S5.SS2.p1.7.m7.1.1.3.2.1.cmml">×</mo><mi id="S5.SS2.p1.7.m7.1.1.3.2.3" xref="S5.SS2.p1.7.m7.1.1.3.2.3.cmml">t</mi></mrow><mo lspace="0em" rspace="0em" id="S5.SS2.p1.7.m7.1.1.3.1" xref="S5.SS2.p1.7.m7.1.1.3.1.cmml">​</mo><msub id="S5.SS2.p1.7.m7.1.1.3.3" xref="S5.SS2.p1.7.m7.1.1.3.3.cmml"><mi id="S5.SS2.p1.7.m7.1.1.3.3.2" xref="S5.SS2.p1.7.m7.1.1.3.3.2.cmml">p</mi><mn id="S5.SS2.p1.7.m7.1.1.3.3.3" xref="S5.SS2.p1.7.m7.1.1.3.3.3.cmml">2</mn></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.7.m7.1b"><apply id="S5.SS2.p1.7.m7.1.1.cmml" xref="S5.SS2.p1.7.m7.1.1"><eq id="S5.SS2.p1.7.m7.1.1.1.cmml" xref="S5.SS2.p1.7.m7.1.1.1"></eq><apply id="S5.SS2.p1.7.m7.1.1.2.cmml" xref="S5.SS2.p1.7.m7.1.1.2"><times id="S5.SS2.p1.7.m7.1.1.2.1.cmml" xref="S5.SS2.p1.7.m7.1.1.2.1"></times><ci id="S5.SS2.p1.7.m7.1.1.2.2.cmml" xref="S5.SS2.p1.7.m7.1.1.2.2">𝑡</ci><apply id="S5.SS2.p1.7.m7.1.1.2.3.cmml" xref="S5.SS2.p1.7.m7.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS2.p1.7.m7.1.1.2.3.1.cmml" xref="S5.SS2.p1.7.m7.1.1.2.3">subscript</csymbol><ci id="S5.SS2.p1.7.m7.1.1.2.3.2.cmml" xref="S5.SS2.p1.7.m7.1.1.2.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.7.m7.1.1.2.3.3.cmml" xref="S5.SS2.p1.7.m7.1.1.2.3.3">1</cn></apply></apply><apply id="S5.SS2.p1.7.m7.1.1.3.cmml" xref="S5.SS2.p1.7.m7.1.1.3"><times id="S5.SS2.p1.7.m7.1.1.3.1.cmml" xref="S5.SS2.p1.7.m7.1.1.3.1"></times><apply id="S5.SS2.p1.7.m7.1.1.3.2.cmml" xref="S5.SS2.p1.7.m7.1.1.3.2"><times id="S5.SS2.p1.7.m7.1.1.3.2.1.cmml" xref="S5.SS2.p1.7.m7.1.1.3.2.1"></times><ci id="S5.SS2.p1.7.m7.1.1.3.2.2.cmml" xref="S5.SS2.p1.7.m7.1.1.3.2.2">𝑠</ci><ci id="S5.SS2.p1.7.m7.1.1.3.2.3.cmml" xref="S5.SS2.p1.7.m7.1.1.3.2.3">𝑡</ci></apply><apply id="S5.SS2.p1.7.m7.1.1.3.3.cmml" xref="S5.SS2.p1.7.m7.1.1.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.7.m7.1.1.3.3.1.cmml" xref="S5.SS2.p1.7.m7.1.1.3.3">subscript</csymbol><ci id="S5.SS2.p1.7.m7.1.1.3.3.2.cmml" xref="S5.SS2.p1.7.m7.1.1.3.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.7.m7.1.1.3.3.3.cmml" xref="S5.SS2.p1.7.m7.1.1.3.3.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.7.m7.1c">tp_{1}=s\times tp_{2}</annotation></semantics></math>.
In this situation, we merge every <math id="S5.SS2.p1.8.m8.1" class="ltx_Math" alttext="s" display="inline"><semantics id="S5.SS2.p1.8.m8.1a"><mi id="S5.SS2.p1.8.m8.1.1" xref="S5.SS2.p1.8.m8.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.8.m8.1b"><ci id="S5.SS2.p1.8.m8.1.1.cmml" xref="S5.SS2.p1.8.m8.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.8.m8.1c">s</annotation></semantics></math> consecutive pipeline stages of model <math id="S5.SS2.p1.9.m9.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.SS2.p1.9.m9.1a"><mi id="S5.SS2.p1.9.m9.1.1" xref="S5.SS2.p1.9.m9.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.9.m9.1b"><ci id="S5.SS2.p1.9.m9.1.1.cmml" xref="S5.SS2.p1.9.m9.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.9.m9.1c">B</annotation></semantics></math>
into one stage, redividing model <math id="S5.SS2.p1.10.m10.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.SS2.p1.10.m10.1a"><mi id="S5.SS2.p1.10.m10.1.1" xref="S5.SS2.p1.10.m10.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.10.m10.1b"><ci id="S5.SS2.p1.10.m10.1.1.cmml" xref="S5.SS2.p1.10.m10.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.10.m10.1c">B</annotation></semantics></math> into <math id="S5.SS2.p1.11.m11.1" class="ltx_Math" alttext="\frac{pp_{2}}{s}" display="inline"><semantics id="S5.SS2.p1.11.m11.1a"><mfrac id="S5.SS2.p1.11.m11.1.1" xref="S5.SS2.p1.11.m11.1.1.cmml"><mrow id="S5.SS2.p1.11.m11.1.1.2" xref="S5.SS2.p1.11.m11.1.1.2.cmml"><mi id="S5.SS2.p1.11.m11.1.1.2.2" xref="S5.SS2.p1.11.m11.1.1.2.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.11.m11.1.1.2.1" xref="S5.SS2.p1.11.m11.1.1.2.1.cmml">​</mo><msub id="S5.SS2.p1.11.m11.1.1.2.3" xref="S5.SS2.p1.11.m11.1.1.2.3.cmml"><mi id="S5.SS2.p1.11.m11.1.1.2.3.2" xref="S5.SS2.p1.11.m11.1.1.2.3.2.cmml">p</mi><mn id="S5.SS2.p1.11.m11.1.1.2.3.3" xref="S5.SS2.p1.11.m11.1.1.2.3.3.cmml">2</mn></msub></mrow><mi id="S5.SS2.p1.11.m11.1.1.3" xref="S5.SS2.p1.11.m11.1.1.3.cmml">s</mi></mfrac><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.11.m11.1b"><apply id="S5.SS2.p1.11.m11.1.1.cmml" xref="S5.SS2.p1.11.m11.1.1"><divide id="S5.SS2.p1.11.m11.1.1.1.cmml" xref="S5.SS2.p1.11.m11.1.1"></divide><apply id="S5.SS2.p1.11.m11.1.1.2.cmml" xref="S5.SS2.p1.11.m11.1.1.2"><times id="S5.SS2.p1.11.m11.1.1.2.1.cmml" xref="S5.SS2.p1.11.m11.1.1.2.1"></times><ci id="S5.SS2.p1.11.m11.1.1.2.2.cmml" xref="S5.SS2.p1.11.m11.1.1.2.2">𝑝</ci><apply id="S5.SS2.p1.11.m11.1.1.2.3.cmml" xref="S5.SS2.p1.11.m11.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS2.p1.11.m11.1.1.2.3.1.cmml" xref="S5.SS2.p1.11.m11.1.1.2.3">subscript</csymbol><ci id="S5.SS2.p1.11.m11.1.1.2.3.2.cmml" xref="S5.SS2.p1.11.m11.1.1.2.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.11.m11.1.1.2.3.3.cmml" xref="S5.SS2.p1.11.m11.1.1.2.3.3">2</cn></apply></apply><ci id="S5.SS2.p1.11.m11.1.1.3.cmml" xref="S5.SS2.p1.11.m11.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.11.m11.1c">\frac{pp_{2}}{s}</annotation></semantics></math> pipeline stages.
This ensures that each stage of both models uses the same number of GPU resources. Note
that here we require <math id="S5.SS2.p1.12.m12.1" class="ltx_Math" alttext="pp_{2}" display="inline"><semantics id="S5.SS2.p1.12.m12.1a"><mrow id="S5.SS2.p1.12.m12.1.1" xref="S5.SS2.p1.12.m12.1.1.cmml"><mi id="S5.SS2.p1.12.m12.1.1.2" xref="S5.SS2.p1.12.m12.1.1.2.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p1.12.m12.1.1.1" xref="S5.SS2.p1.12.m12.1.1.1.cmml">​</mo><msub id="S5.SS2.p1.12.m12.1.1.3" xref="S5.SS2.p1.12.m12.1.1.3.cmml"><mi id="S5.SS2.p1.12.m12.1.1.3.2" xref="S5.SS2.p1.12.m12.1.1.3.2.cmml">p</mi><mn id="S5.SS2.p1.12.m12.1.1.3.3" xref="S5.SS2.p1.12.m12.1.1.3.3.cmml">2</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.12.m12.1b"><apply id="S5.SS2.p1.12.m12.1.1.cmml" xref="S5.SS2.p1.12.m12.1.1"><times id="S5.SS2.p1.12.m12.1.1.1.cmml" xref="S5.SS2.p1.12.m12.1.1.1"></times><ci id="S5.SS2.p1.12.m12.1.1.2.cmml" xref="S5.SS2.p1.12.m12.1.1.2">𝑝</ci><apply id="S5.SS2.p1.12.m12.1.1.3.cmml" xref="S5.SS2.p1.12.m12.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p1.12.m12.1.1.3.1.cmml" xref="S5.SS2.p1.12.m12.1.1.3">subscript</csymbol><ci id="S5.SS2.p1.12.m12.1.1.3.2.cmml" xref="S5.SS2.p1.12.m12.1.1.3.2">𝑝</ci><cn type="integer" id="S5.SS2.p1.12.m12.1.1.3.3.cmml" xref="S5.SS2.p1.12.m12.1.1.3.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.12.m12.1c">pp_{2}</annotation></semantics></math> to be divisible by <math id="S5.SS2.p1.13.m13.1" class="ltx_Math" alttext="s" display="inline"><semantics id="S5.SS2.p1.13.m13.1a"><mi id="S5.SS2.p1.13.m13.1.1" xref="S5.SS2.p1.13.m13.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.13.m13.1b"><ci id="S5.SS2.p1.13.m13.1.1.cmml" xref="S5.SS2.p1.13.m13.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.13.m13.1c">s</annotation></semantics></math>, which is easy to realize in practice.
After that, we can transform the problem into fusing
<math id="S5.SS2.p1.14.m14.1" class="ltx_Math" alttext="K_{1}" display="inline"><semantics id="S5.SS2.p1.14.m14.1a"><msub id="S5.SS2.p1.14.m14.1.1" xref="S5.SS2.p1.14.m14.1.1.cmml"><mi id="S5.SS2.p1.14.m14.1.1.2" xref="S5.SS2.p1.14.m14.1.1.2.cmml">K</mi><mn id="S5.SS2.p1.14.m14.1.1.3" xref="S5.SS2.p1.14.m14.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.14.m14.1b"><apply id="S5.SS2.p1.14.m14.1.1.cmml" xref="S5.SS2.p1.14.m14.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.14.m14.1.1.1.cmml" xref="S5.SS2.p1.14.m14.1.1">subscript</csymbol><ci id="S5.SS2.p1.14.m14.1.1.2.cmml" xref="S5.SS2.p1.14.m14.1.1.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.14.m14.1.1.3.cmml" xref="S5.SS2.p1.14.m14.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.14.m14.1c">K_{1}</annotation></semantics></math> disjoint pipeline groups of model <math id="S5.SS2.p1.15.m15.1" class="ltx_Math" alttext="A" display="inline"><semantics id="S5.SS2.p1.15.m15.1a"><mi id="S5.SS2.p1.15.m15.1.1" xref="S5.SS2.p1.15.m15.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.15.m15.1b"><ci id="S5.SS2.p1.15.m15.1.1.cmml" xref="S5.SS2.p1.15.m15.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.15.m15.1c">A</annotation></semantics></math> with <math id="S5.SS2.p1.16.m16.1" class="ltx_Math" alttext="K_{2}" display="inline"><semantics id="S5.SS2.p1.16.m16.1a"><msub id="S5.SS2.p1.16.m16.1.1" xref="S5.SS2.p1.16.m16.1.1.cmml"><mi id="S5.SS2.p1.16.m16.1.1.2" xref="S5.SS2.p1.16.m16.1.1.2.cmml">K</mi><mn id="S5.SS2.p1.16.m16.1.1.3" xref="S5.SS2.p1.16.m16.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.16.m16.1b"><apply id="S5.SS2.p1.16.m16.1.1.cmml" xref="S5.SS2.p1.16.m16.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.16.m16.1.1.1.cmml" xref="S5.SS2.p1.16.m16.1.1">subscript</csymbol><ci id="S5.SS2.p1.16.m16.1.1.2.cmml" xref="S5.SS2.p1.16.m16.1.1.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.16.m16.1.1.3.cmml" xref="S5.SS2.p1.16.m16.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.16.m16.1c">K_{2}</annotation></semantics></math> pipeline groups
of model <math id="S5.SS2.p1.17.m17.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.SS2.p1.17.m17.1a"><mi id="S5.SS2.p1.17.m17.1.1" xref="S5.SS2.p1.17.m17.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.17.m17.1b"><ci id="S5.SS2.p1.17.m17.1.1.cmml" xref="S5.SS2.p1.17.m17.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.17.m17.1c">B</annotation></semantics></math>, where <math id="S5.SS2.p1.18.m18.1" class="ltx_Math" alttext="K" display="inline"><semantics id="S5.SS2.p1.18.m18.1a"><mi id="S5.SS2.p1.18.m18.1.1" xref="S5.SS2.p1.18.m18.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.18.m18.1b"><ci id="S5.SS2.p1.18.m18.1.1.cmml" xref="S5.SS2.p1.18.m18.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.18.m18.1c">K</annotation></semantics></math> denotes the fusion factor and <math id="S5.SS2.p1.19.m19.1" class="ltx_Math" alttext="K_{1}" display="inline"><semantics id="S5.SS2.p1.19.m19.1a"><msub id="S5.SS2.p1.19.m19.1.1" xref="S5.SS2.p1.19.m19.1.1.cmml"><mi id="S5.SS2.p1.19.m19.1.1.2" xref="S5.SS2.p1.19.m19.1.1.2.cmml">K</mi><mn id="S5.SS2.p1.19.m19.1.1.3" xref="S5.SS2.p1.19.m19.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.19.m19.1b"><apply id="S5.SS2.p1.19.m19.1.1.cmml" xref="S5.SS2.p1.19.m19.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.19.m19.1.1.1.cmml" xref="S5.SS2.p1.19.m19.1.1">subscript</csymbol><ci id="S5.SS2.p1.19.m19.1.1.2.cmml" xref="S5.SS2.p1.19.m19.1.1.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.19.m19.1.1.3.cmml" xref="S5.SS2.p1.19.m19.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.19.m19.1c">K_{1}</annotation></semantics></math> and <math id="S5.SS2.p1.20.m20.1" class="ltx_Math" alttext="K_{2}" display="inline"><semantics id="S5.SS2.p1.20.m20.1a"><msub id="S5.SS2.p1.20.m20.1.1" xref="S5.SS2.p1.20.m20.1.1.cmml"><mi id="S5.SS2.p1.20.m20.1.1.2" xref="S5.SS2.p1.20.m20.1.1.2.cmml">K</mi><mn id="S5.SS2.p1.20.m20.1.1.3" xref="S5.SS2.p1.20.m20.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.20.m20.1b"><apply id="S5.SS2.p1.20.m20.1.1.cmml" xref="S5.SS2.p1.20.m20.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.20.m20.1.1.1.cmml" xref="S5.SS2.p1.20.m20.1.1">subscript</csymbol><ci id="S5.SS2.p1.20.m20.1.1.2.cmml" xref="S5.SS2.p1.20.m20.1.1.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.20.m20.1.1.3.cmml" xref="S5.SS2.p1.20.m20.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.20.m20.1c">K_{2}</annotation></semantics></math> are coprime.
Figure <a href="#S4.F6" title="Figure 6 ‣ 4.2 Fused Execution Plan ‣ 4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>(b) illustrates an example of <math id="S5.SS2.p1.21.m21.4" class="ltx_Math" alttext="(K_{1},K_{2})=(1,2)" display="inline"><semantics id="S5.SS2.p1.21.m21.4a"><mrow id="S5.SS2.p1.21.m21.4.4" xref="S5.SS2.p1.21.m21.4.4.cmml"><mrow id="S5.SS2.p1.21.m21.4.4.2.2" xref="S5.SS2.p1.21.m21.4.4.2.3.cmml"><mo stretchy="false" id="S5.SS2.p1.21.m21.4.4.2.2.3" xref="S5.SS2.p1.21.m21.4.4.2.3.cmml">(</mo><msub id="S5.SS2.p1.21.m21.3.3.1.1.1" xref="S5.SS2.p1.21.m21.3.3.1.1.1.cmml"><mi id="S5.SS2.p1.21.m21.3.3.1.1.1.2" xref="S5.SS2.p1.21.m21.3.3.1.1.1.2.cmml">K</mi><mn id="S5.SS2.p1.21.m21.3.3.1.1.1.3" xref="S5.SS2.p1.21.m21.3.3.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p1.21.m21.4.4.2.2.4" xref="S5.SS2.p1.21.m21.4.4.2.3.cmml">,</mo><msub id="S5.SS2.p1.21.m21.4.4.2.2.2" xref="S5.SS2.p1.21.m21.4.4.2.2.2.cmml"><mi id="S5.SS2.p1.21.m21.4.4.2.2.2.2" xref="S5.SS2.p1.21.m21.4.4.2.2.2.2.cmml">K</mi><mn id="S5.SS2.p1.21.m21.4.4.2.2.2.3" xref="S5.SS2.p1.21.m21.4.4.2.2.2.3.cmml">2</mn></msub><mo stretchy="false" id="S5.SS2.p1.21.m21.4.4.2.2.5" xref="S5.SS2.p1.21.m21.4.4.2.3.cmml">)</mo></mrow><mo id="S5.SS2.p1.21.m21.4.4.3" xref="S5.SS2.p1.21.m21.4.4.3.cmml">=</mo><mrow id="S5.SS2.p1.21.m21.4.4.4.2" xref="S5.SS2.p1.21.m21.4.4.4.1.cmml"><mo stretchy="false" id="S5.SS2.p1.21.m21.4.4.4.2.1" xref="S5.SS2.p1.21.m21.4.4.4.1.cmml">(</mo><mn id="S5.SS2.p1.21.m21.1.1" xref="S5.SS2.p1.21.m21.1.1.cmml">1</mn><mo id="S5.SS2.p1.21.m21.4.4.4.2.2" xref="S5.SS2.p1.21.m21.4.4.4.1.cmml">,</mo><mn id="S5.SS2.p1.21.m21.2.2" xref="S5.SS2.p1.21.m21.2.2.cmml">2</mn><mo stretchy="false" id="S5.SS2.p1.21.m21.4.4.4.2.3" xref="S5.SS2.p1.21.m21.4.4.4.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.21.m21.4b"><apply id="S5.SS2.p1.21.m21.4.4.cmml" xref="S5.SS2.p1.21.m21.4.4"><eq id="S5.SS2.p1.21.m21.4.4.3.cmml" xref="S5.SS2.p1.21.m21.4.4.3"></eq><interval closure="open" id="S5.SS2.p1.21.m21.4.4.2.3.cmml" xref="S5.SS2.p1.21.m21.4.4.2.2"><apply id="S5.SS2.p1.21.m21.3.3.1.1.1.cmml" xref="S5.SS2.p1.21.m21.3.3.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.21.m21.3.3.1.1.1.1.cmml" xref="S5.SS2.p1.21.m21.3.3.1.1.1">subscript</csymbol><ci id="S5.SS2.p1.21.m21.3.3.1.1.1.2.cmml" xref="S5.SS2.p1.21.m21.3.3.1.1.1.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.21.m21.3.3.1.1.1.3.cmml" xref="S5.SS2.p1.21.m21.3.3.1.1.1.3">1</cn></apply><apply id="S5.SS2.p1.21.m21.4.4.2.2.2.cmml" xref="S5.SS2.p1.21.m21.4.4.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p1.21.m21.4.4.2.2.2.1.cmml" xref="S5.SS2.p1.21.m21.4.4.2.2.2">subscript</csymbol><ci id="S5.SS2.p1.21.m21.4.4.2.2.2.2.cmml" xref="S5.SS2.p1.21.m21.4.4.2.2.2.2">𝐾</ci><cn type="integer" id="S5.SS2.p1.21.m21.4.4.2.2.2.3.cmml" xref="S5.SS2.p1.21.m21.4.4.2.2.2.3">2</cn></apply></interval><interval closure="open" id="S5.SS2.p1.21.m21.4.4.4.1.cmml" xref="S5.SS2.p1.21.m21.4.4.4.2"><cn type="integer" id="S5.SS2.p1.21.m21.1.1.cmml" xref="S5.SS2.p1.21.m21.1.1">1</cn><cn type="integer" id="S5.SS2.p1.21.m21.2.2.cmml" xref="S5.SS2.p1.21.m21.2.2">2</cn></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.21.m21.4c">(K_{1},K_{2})=(1,2)</annotation></semantics></math>.
Next, we precisely define the fused pipeline schedule and formulate
the problem. Table <a href="#S5.T1" title="Table 1 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a> summarizes the key notations.</p>
</div>
<figure id="S5.T1" class="ltx_table">
<table id="S5.T1.17" class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S5.T1.17.18.1" class="ltx_tr">
<th id="S5.T1.17.18.1.1" class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><span id="S5.T1.17.18.1.1.1" class="ltx_text ltx_font_bold">Symbol</span></th>
<th id="S5.T1.17.18.1.2" class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r ltx_border_t"><span id="S5.T1.17.18.1.2.1" class="ltx_text ltx_font_bold">Description</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S5.T1.1.1" class="ltx_tr">
<th id="S5.T1.1.1.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.1.1.1.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.T1.1.1.1.m1.1a"><mi id="S5.T1.1.1.1.m1.1.1" xref="S5.T1.1.1.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.T1.1.1.1.m1.1b"><ci id="S5.T1.1.1.1.m1.1.1.cmml" xref="S5.T1.1.1.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.1.1.1.m1.1c">S</annotation></semantics></math></th>
<td id="S5.T1.1.1.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The fused pipeline schedule.</td>
</tr>
<tr id="S5.T1.3.3" class="ltx_tr">
<th id="S5.T1.2.2.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.2.2.1.m1.1" class="ltx_Math" alttext="l_{ij}" display="inline"><semantics id="S5.T1.2.2.1.m1.1a"><msub id="S5.T1.2.2.1.m1.1.1" xref="S5.T1.2.2.1.m1.1.1.cmml"><mi id="S5.T1.2.2.1.m1.1.1.2" xref="S5.T1.2.2.1.m1.1.1.2.cmml">l</mi><mrow id="S5.T1.2.2.1.m1.1.1.3" xref="S5.T1.2.2.1.m1.1.1.3.cmml"><mi id="S5.T1.2.2.1.m1.1.1.3.2" xref="S5.T1.2.2.1.m1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.T1.2.2.1.m1.1.1.3.1" xref="S5.T1.2.2.1.m1.1.1.3.1.cmml">​</mo><mi id="S5.T1.2.2.1.m1.1.1.3.3" xref="S5.T1.2.2.1.m1.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T1.2.2.1.m1.1b"><apply id="S5.T1.2.2.1.m1.1.1.cmml" xref="S5.T1.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.2.2.1.m1.1.1.1.cmml" xref="S5.T1.2.2.1.m1.1.1">subscript</csymbol><ci id="S5.T1.2.2.1.m1.1.1.2.cmml" xref="S5.T1.2.2.1.m1.1.1.2">𝑙</ci><apply id="S5.T1.2.2.1.m1.1.1.3.cmml" xref="S5.T1.2.2.1.m1.1.1.3"><times id="S5.T1.2.2.1.m1.1.1.3.1.cmml" xref="S5.T1.2.2.1.m1.1.1.3.1"></times><ci id="S5.T1.2.2.1.m1.1.1.3.2.cmml" xref="S5.T1.2.2.1.m1.1.1.3.2">𝑖</ci><ci id="S5.T1.2.2.1.m1.1.1.3.3.cmml" xref="S5.T1.2.2.1.m1.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.2.2.1.m1.1c">l_{ij}</annotation></semantics></math></th>
<td id="S5.T1.3.3.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The latency of subtask <math id="S5.T1.3.3.2.m1.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="S5.T1.3.3.2.m1.1a"><msub id="S5.T1.3.3.2.m1.1.1" xref="S5.T1.3.3.2.m1.1.1.cmml"><mi id="S5.T1.3.3.2.m1.1.1.2" xref="S5.T1.3.3.2.m1.1.1.2.cmml">S</mi><mrow id="S5.T1.3.3.2.m1.1.1.3" xref="S5.T1.3.3.2.m1.1.1.3.cmml"><mi id="S5.T1.3.3.2.m1.1.1.3.2" xref="S5.T1.3.3.2.m1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.T1.3.3.2.m1.1.1.3.1" xref="S5.T1.3.3.2.m1.1.1.3.1.cmml">​</mo><mi id="S5.T1.3.3.2.m1.1.1.3.3" xref="S5.T1.3.3.2.m1.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.T1.3.3.2.m1.1b"><apply id="S5.T1.3.3.2.m1.1.1.cmml" xref="S5.T1.3.3.2.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.3.3.2.m1.1.1.1.cmml" xref="S5.T1.3.3.2.m1.1.1">subscript</csymbol><ci id="S5.T1.3.3.2.m1.1.1.2.cmml" xref="S5.T1.3.3.2.m1.1.1.2">𝑆</ci><apply id="S5.T1.3.3.2.m1.1.1.3.cmml" xref="S5.T1.3.3.2.m1.1.1.3"><times id="S5.T1.3.3.2.m1.1.1.3.1.cmml" xref="S5.T1.3.3.2.m1.1.1.3.1"></times><ci id="S5.T1.3.3.2.m1.1.1.3.2.cmml" xref="S5.T1.3.3.2.m1.1.1.3.2">𝑖</ci><ci id="S5.T1.3.3.2.m1.1.1.3.3.cmml" xref="S5.T1.3.3.2.m1.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.3.3.2.m1.1c">S_{ij}</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.4.4" class="ltx_tr">
<th id="S5.T1.4.4.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.4.4.1.m1.1" class="ltx_Math" alttext="C" display="inline"><semantics id="S5.T1.4.4.1.m1.1a"><mi id="S5.T1.4.4.1.m1.1.1" xref="S5.T1.4.4.1.m1.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S5.T1.4.4.1.m1.1b"><ci id="S5.T1.4.4.1.m1.1.1.cmml" xref="S5.T1.4.4.1.m1.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.4.4.1.m1.1c">C</annotation></semantics></math></th>
<td id="S5.T1.4.4.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The activation memory capacity of each stage.</td>
</tr>
<tr id="S5.T1.6.6" class="ltx_tr">
<th id="S5.T1.5.5.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.5.5.1.m1.1" class="ltx_Math" alttext="K_{1}" display="inline"><semantics id="S5.T1.5.5.1.m1.1a"><msub id="S5.T1.5.5.1.m1.1.1" xref="S5.T1.5.5.1.m1.1.1.cmml"><mi id="S5.T1.5.5.1.m1.1.1.2" xref="S5.T1.5.5.1.m1.1.1.2.cmml">K</mi><mn id="S5.T1.5.5.1.m1.1.1.3" xref="S5.T1.5.5.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.5.5.1.m1.1b"><apply id="S5.T1.5.5.1.m1.1.1.cmml" xref="S5.T1.5.5.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.5.5.1.m1.1.1.1.cmml" xref="S5.T1.5.5.1.m1.1.1">subscript</csymbol><ci id="S5.T1.5.5.1.m1.1.1.2.cmml" xref="S5.T1.5.5.1.m1.1.1.2">𝐾</ci><cn type="integer" id="S5.T1.5.5.1.m1.1.1.3.cmml" xref="S5.T1.5.5.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.5.5.1.m1.1c">K_{1}</annotation></semantics></math></th>
<td id="S5.T1.6.6.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The fusion factor of model <math id="S5.T1.6.6.2.m1.1" class="ltx_Math" alttext="A" display="inline"><semantics id="S5.T1.6.6.2.m1.1a"><mi id="S5.T1.6.6.2.m1.1.1" xref="S5.T1.6.6.2.m1.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S5.T1.6.6.2.m1.1b"><ci id="S5.T1.6.6.2.m1.1.1.cmml" xref="S5.T1.6.6.2.m1.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.6.6.2.m1.1c">A</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.8.8" class="ltx_tr">
<th id="S5.T1.7.7.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.7.7.1.m1.1" class="ltx_Math" alttext="K_{2}" display="inline"><semantics id="S5.T1.7.7.1.m1.1a"><msub id="S5.T1.7.7.1.m1.1.1" xref="S5.T1.7.7.1.m1.1.1.cmml"><mi id="S5.T1.7.7.1.m1.1.1.2" xref="S5.T1.7.7.1.m1.1.1.2.cmml">K</mi><mn id="S5.T1.7.7.1.m1.1.1.3" xref="S5.T1.7.7.1.m1.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.7.7.1.m1.1b"><apply id="S5.T1.7.7.1.m1.1.1.cmml" xref="S5.T1.7.7.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.7.7.1.m1.1.1.1.cmml" xref="S5.T1.7.7.1.m1.1.1">subscript</csymbol><ci id="S5.T1.7.7.1.m1.1.1.2.cmml" xref="S5.T1.7.7.1.m1.1.1.2">𝐾</ci><cn type="integer" id="S5.T1.7.7.1.m1.1.1.3.cmml" xref="S5.T1.7.7.1.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.7.7.1.m1.1c">K_{2}</annotation></semantics></math></th>
<td id="S5.T1.8.8.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The fusion factor of model <math id="S5.T1.8.8.2.m1.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.T1.8.8.2.m1.1a"><mi id="S5.T1.8.8.2.m1.1.1" xref="S5.T1.8.8.2.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.T1.8.8.2.m1.1b"><ci id="S5.T1.8.8.2.m1.1.1.cmml" xref="S5.T1.8.8.2.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.8.8.2.m1.1c">B</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.9.9" class="ltx_tr">
<th id="S5.T1.9.9.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.9.9.1.m1.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S5.T1.9.9.1.m1.1a"><mi id="S5.T1.9.9.1.m1.1.1" xref="S5.T1.9.9.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S5.T1.9.9.1.m1.1b"><ci id="S5.T1.9.9.1.m1.1.1.cmml" xref="S5.T1.9.9.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.9.9.1.m1.1c">N</annotation></semantics></math></th>
<td id="S5.T1.9.9.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The total number of pipeline stages to be fused.</td>
</tr>
<tr id="S5.T1.11.11" class="ltx_tr">
<th id="S5.T1.10.10.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.10.10.1.m1.1" class="ltx_Math" alttext="N_{1}" display="inline"><semantics id="S5.T1.10.10.1.m1.1a"><msub id="S5.T1.10.10.1.m1.1.1" xref="S5.T1.10.10.1.m1.1.1.cmml"><mi id="S5.T1.10.10.1.m1.1.1.2" xref="S5.T1.10.10.1.m1.1.1.2.cmml">N</mi><mn id="S5.T1.10.10.1.m1.1.1.3" xref="S5.T1.10.10.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.10.10.1.m1.1b"><apply id="S5.T1.10.10.1.m1.1.1.cmml" xref="S5.T1.10.10.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.10.10.1.m1.1.1.1.cmml" xref="S5.T1.10.10.1.m1.1.1">subscript</csymbol><ci id="S5.T1.10.10.1.m1.1.1.2.cmml" xref="S5.T1.10.10.1.m1.1.1.2">𝑁</ci><cn type="integer" id="S5.T1.10.10.1.m1.1.1.3.cmml" xref="S5.T1.10.10.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.10.10.1.m1.1c">N_{1}</annotation></semantics></math></th>
<td id="S5.T1.11.11.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The number of pipeline stages of model <math id="S5.T1.11.11.2.m1.1" class="ltx_Math" alttext="A" display="inline"><semantics id="S5.T1.11.11.2.m1.1a"><mi id="S5.T1.11.11.2.m1.1.1" xref="S5.T1.11.11.2.m1.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S5.T1.11.11.2.m1.1b"><ci id="S5.T1.11.11.2.m1.1.1.cmml" xref="S5.T1.11.11.2.m1.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.11.11.2.m1.1c">A</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.13.13" class="ltx_tr">
<th id="S5.T1.12.12.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.12.12.1.m1.1" class="ltx_Math" alttext="N_{2}" display="inline"><semantics id="S5.T1.12.12.1.m1.1a"><msub id="S5.T1.12.12.1.m1.1.1" xref="S5.T1.12.12.1.m1.1.1.cmml"><mi id="S5.T1.12.12.1.m1.1.1.2" xref="S5.T1.12.12.1.m1.1.1.2.cmml">N</mi><mn id="S5.T1.12.12.1.m1.1.1.3" xref="S5.T1.12.12.1.m1.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.12.12.1.m1.1b"><apply id="S5.T1.12.12.1.m1.1.1.cmml" xref="S5.T1.12.12.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.12.12.1.m1.1.1.1.cmml" xref="S5.T1.12.12.1.m1.1.1">subscript</csymbol><ci id="S5.T1.12.12.1.m1.1.1.2.cmml" xref="S5.T1.12.12.1.m1.1.1.2">𝑁</ci><cn type="integer" id="S5.T1.12.12.1.m1.1.1.3.cmml" xref="S5.T1.12.12.1.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.12.12.1.m1.1c">N_{2}</annotation></semantics></math></th>
<td id="S5.T1.13.13.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The number of pipeline stages of model <math id="S5.T1.13.13.2.m1.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.T1.13.13.2.m1.1a"><mi id="S5.T1.13.13.2.m1.1.1" xref="S5.T1.13.13.2.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.T1.13.13.2.m1.1b"><ci id="S5.T1.13.13.2.m1.1.1.cmml" xref="S5.T1.13.13.2.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.13.13.2.m1.1c">B</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.15.15" class="ltx_tr">
<th id="S5.T1.14.14.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.14.14.1.m1.1" class="ltx_Math" alttext="M_{1}" display="inline"><semantics id="S5.T1.14.14.1.m1.1a"><msub id="S5.T1.14.14.1.m1.1.1" xref="S5.T1.14.14.1.m1.1.1.cmml"><mi id="S5.T1.14.14.1.m1.1.1.2" xref="S5.T1.14.14.1.m1.1.1.2.cmml">M</mi><mn id="S5.T1.14.14.1.m1.1.1.3" xref="S5.T1.14.14.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.14.14.1.m1.1b"><apply id="S5.T1.14.14.1.m1.1.1.cmml" xref="S5.T1.14.14.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.14.14.1.m1.1.1.1.cmml" xref="S5.T1.14.14.1.m1.1.1">subscript</csymbol><ci id="S5.T1.14.14.1.m1.1.1.2.cmml" xref="S5.T1.14.14.1.m1.1.1.2">𝑀</ci><cn type="integer" id="S5.T1.14.14.1.m1.1.1.3.cmml" xref="S5.T1.14.14.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.14.14.1.m1.1c">M_{1}</annotation></semantics></math></th>
<td id="S5.T1.15.15.2" class="ltx_td ltx_align_left ltx_border_r ltx_border_t">The number of micro-batches for model <math id="S5.T1.15.15.2.m1.1" class="ltx_Math" alttext="A" display="inline"><semantics id="S5.T1.15.15.2.m1.1a"><mi id="S5.T1.15.15.2.m1.1.1" xref="S5.T1.15.15.2.m1.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="S5.T1.15.15.2.m1.1b"><ci id="S5.T1.15.15.2.m1.1.1.cmml" xref="S5.T1.15.15.2.m1.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.15.15.2.m1.1c">A</annotation></semantics></math>.</td>
</tr>
<tr id="S5.T1.17.17" class="ltx_tr">
<th id="S5.T1.16.16.1" class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_rr ltx_border_t"><math id="S5.T1.16.16.1.m1.1" class="ltx_Math" alttext="M_{2}" display="inline"><semantics id="S5.T1.16.16.1.m1.1a"><msub id="S5.T1.16.16.1.m1.1.1" xref="S5.T1.16.16.1.m1.1.1.cmml"><mi id="S5.T1.16.16.1.m1.1.1.2" xref="S5.T1.16.16.1.m1.1.1.2.cmml">M</mi><mn id="S5.T1.16.16.1.m1.1.1.3" xref="S5.T1.16.16.1.m1.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.T1.16.16.1.m1.1b"><apply id="S5.T1.16.16.1.m1.1.1.cmml" xref="S5.T1.16.16.1.m1.1.1"><csymbol cd="ambiguous" id="S5.T1.16.16.1.m1.1.1.1.cmml" xref="S5.T1.16.16.1.m1.1.1">subscript</csymbol><ci id="S5.T1.16.16.1.m1.1.1.2.cmml" xref="S5.T1.16.16.1.m1.1.1.2">𝑀</ci><cn type="integer" id="S5.T1.16.16.1.m1.1.1.3.cmml" xref="S5.T1.16.16.1.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.16.16.1.m1.1c">M_{2}</annotation></semantics></math></th>
<td id="S5.T1.17.17.2" class="ltx_td ltx_align_left ltx_border_b ltx_border_r ltx_border_t">The number of micro-batches for model <math id="S5.T1.17.17.2.m1.1" class="ltx_Math" alttext="B" display="inline"><semantics id="S5.T1.17.17.2.m1.1a"><mi id="S5.T1.17.17.2.m1.1.1" xref="S5.T1.17.17.2.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S5.T1.17.17.2.m1.1b"><ci id="S5.T1.17.17.2.m1.1.1.cmml" xref="S5.T1.17.17.2.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.T1.17.17.2.m1.1c">B</annotation></semantics></math>.</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span id="S5.T1.19.1.1" class="ltx_text" style="font-size:90%;">Table 1</span>: </span><span id="S5.T1.20.2" class="ltx_text" style="font-size:90%;">Key notations in problem formulation.</span></figcaption>
</figure>
<div id="S5.SS2.p2" class="ltx_para ltx_noindent">
<p id="S5.SS2.p2.16" class="ltx_p"><span id="S5.SS2.p2.16.1" class="ltx_text ltx_font_bold">Problem formulation.</span>
We assume the two models to be fused
each has <math id="S5.SS2.p2.1.m1.1" class="ltx_Math" alttext="N_{1}" display="inline"><semantics id="S5.SS2.p2.1.m1.1a"><msub id="S5.SS2.p2.1.m1.1.1" xref="S5.SS2.p2.1.m1.1.1.cmml"><mi id="S5.SS2.p2.1.m1.1.1.2" xref="S5.SS2.p2.1.m1.1.1.2.cmml">N</mi><mn id="S5.SS2.p2.1.m1.1.1.3" xref="S5.SS2.p2.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.1.m1.1b"><apply id="S5.SS2.p2.1.m1.1.1.cmml" xref="S5.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.1.m1.1.1.1.cmml" xref="S5.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS2.p2.1.m1.1.1.2.cmml" xref="S5.SS2.p2.1.m1.1.1.2">𝑁</ci><cn type="integer" id="S5.SS2.p2.1.m1.1.1.3.cmml" xref="S5.SS2.p2.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.1.m1.1c">N_{1}</annotation></semantics></math> and <math id="S5.SS2.p2.2.m2.1" class="ltx_Math" alttext="N_{2}" display="inline"><semantics id="S5.SS2.p2.2.m2.1a"><msub id="S5.SS2.p2.2.m2.1.1" xref="S5.SS2.p2.2.m2.1.1.cmml"><mi id="S5.SS2.p2.2.m2.1.1.2" xref="S5.SS2.p2.2.m2.1.1.2.cmml">N</mi><mn id="S5.SS2.p2.2.m2.1.1.3" xref="S5.SS2.p2.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.2.m2.1b"><apply id="S5.SS2.p2.2.m2.1.1.cmml" xref="S5.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.2.m2.1.1.1.cmml" xref="S5.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS2.p2.2.m2.1.1.2.cmml" xref="S5.SS2.p2.2.m2.1.1.2">𝑁</ci><cn type="integer" id="S5.SS2.p2.2.m2.1.1.3.cmml" xref="S5.SS2.p2.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.2.m2.1c">N_{2}</annotation></semantics></math> pipeline stages (<math id="S5.SS2.p2.3.m3.1" class="ltx_Math" alttext="K_{1}\times N_{1}=K2\times N_{2}=N" display="inline"><semantics id="S5.SS2.p2.3.m3.1a"><mrow id="S5.SS2.p2.3.m3.1.1" xref="S5.SS2.p2.3.m3.1.1.cmml"><mrow id="S5.SS2.p2.3.m3.1.1.2" xref="S5.SS2.p2.3.m3.1.1.2.cmml"><msub id="S5.SS2.p2.3.m3.1.1.2.2" xref="S5.SS2.p2.3.m3.1.1.2.2.cmml"><mi id="S5.SS2.p2.3.m3.1.1.2.2.2" xref="S5.SS2.p2.3.m3.1.1.2.2.2.cmml">K</mi><mn id="S5.SS2.p2.3.m3.1.1.2.2.3" xref="S5.SS2.p2.3.m3.1.1.2.2.3.cmml">1</mn></msub><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p2.3.m3.1.1.2.1" xref="S5.SS2.p2.3.m3.1.1.2.1.cmml">×</mo><msub id="S5.SS2.p2.3.m3.1.1.2.3" xref="S5.SS2.p2.3.m3.1.1.2.3.cmml"><mi id="S5.SS2.p2.3.m3.1.1.2.3.2" xref="S5.SS2.p2.3.m3.1.1.2.3.2.cmml">N</mi><mn id="S5.SS2.p2.3.m3.1.1.2.3.3" xref="S5.SS2.p2.3.m3.1.1.2.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p2.3.m3.1.1.3" xref="S5.SS2.p2.3.m3.1.1.3.cmml">=</mo><mrow id="S5.SS2.p2.3.m3.1.1.4" xref="S5.SS2.p2.3.m3.1.1.4.cmml"><mrow id="S5.SS2.p2.3.m3.1.1.4.2" xref="S5.SS2.p2.3.m3.1.1.4.2.cmml"><mi id="S5.SS2.p2.3.m3.1.1.4.2.2" xref="S5.SS2.p2.3.m3.1.1.4.2.2.cmml">K</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p2.3.m3.1.1.4.2.1" xref="S5.SS2.p2.3.m3.1.1.4.2.1.cmml">​</mo><mn id="S5.SS2.p2.3.m3.1.1.4.2.3" xref="S5.SS2.p2.3.m3.1.1.4.2.3.cmml">2</mn></mrow><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p2.3.m3.1.1.4.1" xref="S5.SS2.p2.3.m3.1.1.4.1.cmml">×</mo><msub id="S5.SS2.p2.3.m3.1.1.4.3" xref="S5.SS2.p2.3.m3.1.1.4.3.cmml"><mi id="S5.SS2.p2.3.m3.1.1.4.3.2" xref="S5.SS2.p2.3.m3.1.1.4.3.2.cmml">N</mi><mn id="S5.SS2.p2.3.m3.1.1.4.3.3" xref="S5.SS2.p2.3.m3.1.1.4.3.3.cmml">2</mn></msub></mrow><mo id="S5.SS2.p2.3.m3.1.1.5" xref="S5.SS2.p2.3.m3.1.1.5.cmml">=</mo><mi id="S5.SS2.p2.3.m3.1.1.6" xref="S5.SS2.p2.3.m3.1.1.6.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.3.m3.1b"><apply id="S5.SS2.p2.3.m3.1.1.cmml" xref="S5.SS2.p2.3.m3.1.1"><and id="S5.SS2.p2.3.m3.1.1a.cmml" xref="S5.SS2.p2.3.m3.1.1"></and><apply id="S5.SS2.p2.3.m3.1.1b.cmml" xref="S5.SS2.p2.3.m3.1.1"><eq id="S5.SS2.p2.3.m3.1.1.3.cmml" xref="S5.SS2.p2.3.m3.1.1.3"></eq><apply id="S5.SS2.p2.3.m3.1.1.2.cmml" xref="S5.SS2.p2.3.m3.1.1.2"><times id="S5.SS2.p2.3.m3.1.1.2.1.cmml" xref="S5.SS2.p2.3.m3.1.1.2.1"></times><apply id="S5.SS2.p2.3.m3.1.1.2.2.cmml" xref="S5.SS2.p2.3.m3.1.1.2.2"><csymbol cd="ambiguous" id="S5.SS2.p2.3.m3.1.1.2.2.1.cmml" xref="S5.SS2.p2.3.m3.1.1.2.2">subscript</csymbol><ci id="S5.SS2.p2.3.m3.1.1.2.2.2.cmml" xref="S5.SS2.p2.3.m3.1.1.2.2.2">𝐾</ci><cn type="integer" id="S5.SS2.p2.3.m3.1.1.2.2.3.cmml" xref="S5.SS2.p2.3.m3.1.1.2.2.3">1</cn></apply><apply id="S5.SS2.p2.3.m3.1.1.2.3.cmml" xref="S5.SS2.p2.3.m3.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS2.p2.3.m3.1.1.2.3.1.cmml" xref="S5.SS2.p2.3.m3.1.1.2.3">subscript</csymbol><ci id="S5.SS2.p2.3.m3.1.1.2.3.2.cmml" xref="S5.SS2.p2.3.m3.1.1.2.3.2">𝑁</ci><cn type="integer" id="S5.SS2.p2.3.m3.1.1.2.3.3.cmml" xref="S5.SS2.p2.3.m3.1.1.2.3.3">1</cn></apply></apply><apply id="S5.SS2.p2.3.m3.1.1.4.cmml" xref="S5.SS2.p2.3.m3.1.1.4"><times id="S5.SS2.p2.3.m3.1.1.4.1.cmml" xref="S5.SS2.p2.3.m3.1.1.4.1"></times><apply id="S5.SS2.p2.3.m3.1.1.4.2.cmml" xref="S5.SS2.p2.3.m3.1.1.4.2"><times id="S5.SS2.p2.3.m3.1.1.4.2.1.cmml" xref="S5.SS2.p2.3.m3.1.1.4.2.1"></times><ci id="S5.SS2.p2.3.m3.1.1.4.2.2.cmml" xref="S5.SS2.p2.3.m3.1.1.4.2.2">𝐾</ci><cn type="integer" id="S5.SS2.p2.3.m3.1.1.4.2.3.cmml" xref="S5.SS2.p2.3.m3.1.1.4.2.3">2</cn></apply><apply id="S5.SS2.p2.3.m3.1.1.4.3.cmml" xref="S5.SS2.p2.3.m3.1.1.4.3"><csymbol cd="ambiguous" id="S5.SS2.p2.3.m3.1.1.4.3.1.cmml" xref="S5.SS2.p2.3.m3.1.1.4.3">subscript</csymbol><ci id="S5.SS2.p2.3.m3.1.1.4.3.2.cmml" xref="S5.SS2.p2.3.m3.1.1.4.3.2">𝑁</ci><cn type="integer" id="S5.SS2.p2.3.m3.1.1.4.3.3.cmml" xref="S5.SS2.p2.3.m3.1.1.4.3.3">2</cn></apply></apply></apply><apply id="S5.SS2.p2.3.m3.1.1c.cmml" xref="S5.SS2.p2.3.m3.1.1"><eq id="S5.SS2.p2.3.m3.1.1.5.cmml" xref="S5.SS2.p2.3.m3.1.1.5"></eq><share href="#S5.SS2.p2.3.m3.1.1.4.cmml" id="S5.SS2.p2.3.m3.1.1d.cmml" xref="S5.SS2.p2.3.m3.1.1"></share><ci id="S5.SS2.p2.3.m3.1.1.6.cmml" xref="S5.SS2.p2.3.m3.1.1.6">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.3.m3.1c">K_{1}\times N_{1}=K2\times N_{2}=N</annotation></semantics></math>),
and each pipeline needs to process <math id="S5.SS2.p2.4.m4.1" class="ltx_Math" alttext="M_{1}" display="inline"><semantics id="S5.SS2.p2.4.m4.1a"><msub id="S5.SS2.p2.4.m4.1.1" xref="S5.SS2.p2.4.m4.1.1.cmml"><mi id="S5.SS2.p2.4.m4.1.1.2" xref="S5.SS2.p2.4.m4.1.1.2.cmml">M</mi><mn id="S5.SS2.p2.4.m4.1.1.3" xref="S5.SS2.p2.4.m4.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.4.m4.1b"><apply id="S5.SS2.p2.4.m4.1.1.cmml" xref="S5.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.4.m4.1.1.1.cmml" xref="S5.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p2.4.m4.1.1.2.cmml" xref="S5.SS2.p2.4.m4.1.1.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.4.m4.1.1.3.cmml" xref="S5.SS2.p2.4.m4.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.4.m4.1c">M_{1}</annotation></semantics></math> and <math id="S5.SS2.p2.5.m5.1" class="ltx_Math" alttext="M_{2}" display="inline"><semantics id="S5.SS2.p2.5.m5.1a"><msub id="S5.SS2.p2.5.m5.1.1" xref="S5.SS2.p2.5.m5.1.1.cmml"><mi id="S5.SS2.p2.5.m5.1.1.2" xref="S5.SS2.p2.5.m5.1.1.2.cmml">M</mi><mn id="S5.SS2.p2.5.m5.1.1.3" xref="S5.SS2.p2.5.m5.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.5.m5.1b"><apply id="S5.SS2.p2.5.m5.1.1.cmml" xref="S5.SS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.5.m5.1.1.1.cmml" xref="S5.SS2.p2.5.m5.1.1">subscript</csymbol><ci id="S5.SS2.p2.5.m5.1.1.2.cmml" xref="S5.SS2.p2.5.m5.1.1.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.5.m5.1.1.3.cmml" xref="S5.SS2.p2.5.m5.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.5.m5.1c">M_{2}</annotation></semantics></math> micro-batches, respectively. Since the global batch size is fixed,
we have <math id="S5.SS2.p2.6.m6.1" class="ltx_Math" alttext="K_{1}\times M_{1}=K2\times M_{2}" display="inline"><semantics id="S5.SS2.p2.6.m6.1a"><mrow id="S5.SS2.p2.6.m6.1.1" xref="S5.SS2.p2.6.m6.1.1.cmml"><mrow id="S5.SS2.p2.6.m6.1.1.2" xref="S5.SS2.p2.6.m6.1.1.2.cmml"><msub id="S5.SS2.p2.6.m6.1.1.2.2" xref="S5.SS2.p2.6.m6.1.1.2.2.cmml"><mi id="S5.SS2.p2.6.m6.1.1.2.2.2" xref="S5.SS2.p2.6.m6.1.1.2.2.2.cmml">K</mi><mn id="S5.SS2.p2.6.m6.1.1.2.2.3" xref="S5.SS2.p2.6.m6.1.1.2.2.3.cmml">1</mn></msub><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p2.6.m6.1.1.2.1" xref="S5.SS2.p2.6.m6.1.1.2.1.cmml">×</mo><msub id="S5.SS2.p2.6.m6.1.1.2.3" xref="S5.SS2.p2.6.m6.1.1.2.3.cmml"><mi id="S5.SS2.p2.6.m6.1.1.2.3.2" xref="S5.SS2.p2.6.m6.1.1.2.3.2.cmml">M</mi><mn id="S5.SS2.p2.6.m6.1.1.2.3.3" xref="S5.SS2.p2.6.m6.1.1.2.3.3.cmml">1</mn></msub></mrow><mo id="S5.SS2.p2.6.m6.1.1.1" xref="S5.SS2.p2.6.m6.1.1.1.cmml">=</mo><mrow id="S5.SS2.p2.6.m6.1.1.3" xref="S5.SS2.p2.6.m6.1.1.3.cmml"><mrow id="S5.SS2.p2.6.m6.1.1.3.2" xref="S5.SS2.p2.6.m6.1.1.3.2.cmml"><mi id="S5.SS2.p2.6.m6.1.1.3.2.2" xref="S5.SS2.p2.6.m6.1.1.3.2.2.cmml">K</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p2.6.m6.1.1.3.2.1" xref="S5.SS2.p2.6.m6.1.1.3.2.1.cmml">​</mo><mn id="S5.SS2.p2.6.m6.1.1.3.2.3" xref="S5.SS2.p2.6.m6.1.1.3.2.3.cmml">2</mn></mrow><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p2.6.m6.1.1.3.1" xref="S5.SS2.p2.6.m6.1.1.3.1.cmml">×</mo><msub id="S5.SS2.p2.6.m6.1.1.3.3" xref="S5.SS2.p2.6.m6.1.1.3.3.cmml"><mi id="S5.SS2.p2.6.m6.1.1.3.3.2" xref="S5.SS2.p2.6.m6.1.1.3.3.2.cmml">M</mi><mn id="S5.SS2.p2.6.m6.1.1.3.3.3" xref="S5.SS2.p2.6.m6.1.1.3.3.3.cmml">2</mn></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.6.m6.1b"><apply id="S5.SS2.p2.6.m6.1.1.cmml" xref="S5.SS2.p2.6.m6.1.1"><eq id="S5.SS2.p2.6.m6.1.1.1.cmml" xref="S5.SS2.p2.6.m6.1.1.1"></eq><apply id="S5.SS2.p2.6.m6.1.1.2.cmml" xref="S5.SS2.p2.6.m6.1.1.2"><times id="S5.SS2.p2.6.m6.1.1.2.1.cmml" xref="S5.SS2.p2.6.m6.1.1.2.1"></times><apply id="S5.SS2.p2.6.m6.1.1.2.2.cmml" xref="S5.SS2.p2.6.m6.1.1.2.2"><csymbol cd="ambiguous" id="S5.SS2.p2.6.m6.1.1.2.2.1.cmml" xref="S5.SS2.p2.6.m6.1.1.2.2">subscript</csymbol><ci id="S5.SS2.p2.6.m6.1.1.2.2.2.cmml" xref="S5.SS2.p2.6.m6.1.1.2.2.2">𝐾</ci><cn type="integer" id="S5.SS2.p2.6.m6.1.1.2.2.3.cmml" xref="S5.SS2.p2.6.m6.1.1.2.2.3">1</cn></apply><apply id="S5.SS2.p2.6.m6.1.1.2.3.cmml" xref="S5.SS2.p2.6.m6.1.1.2.3"><csymbol cd="ambiguous" id="S5.SS2.p2.6.m6.1.1.2.3.1.cmml" xref="S5.SS2.p2.6.m6.1.1.2.3">subscript</csymbol><ci id="S5.SS2.p2.6.m6.1.1.2.3.2.cmml" xref="S5.SS2.p2.6.m6.1.1.2.3.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.6.m6.1.1.2.3.3.cmml" xref="S5.SS2.p2.6.m6.1.1.2.3.3">1</cn></apply></apply><apply id="S5.SS2.p2.6.m6.1.1.3.cmml" xref="S5.SS2.p2.6.m6.1.1.3"><times id="S5.SS2.p2.6.m6.1.1.3.1.cmml" xref="S5.SS2.p2.6.m6.1.1.3.1"></times><apply id="S5.SS2.p2.6.m6.1.1.3.2.cmml" xref="S5.SS2.p2.6.m6.1.1.3.2"><times id="S5.SS2.p2.6.m6.1.1.3.2.1.cmml" xref="S5.SS2.p2.6.m6.1.1.3.2.1"></times><ci id="S5.SS2.p2.6.m6.1.1.3.2.2.cmml" xref="S5.SS2.p2.6.m6.1.1.3.2.2">𝐾</ci><cn type="integer" id="S5.SS2.p2.6.m6.1.1.3.2.3.cmml" xref="S5.SS2.p2.6.m6.1.1.3.2.3">2</cn></apply><apply id="S5.SS2.p2.6.m6.1.1.3.3.cmml" xref="S5.SS2.p2.6.m6.1.1.3.3"><csymbol cd="ambiguous" id="S5.SS2.p2.6.m6.1.1.3.3.1.cmml" xref="S5.SS2.p2.6.m6.1.1.3.3">subscript</csymbol><ci id="S5.SS2.p2.6.m6.1.1.3.3.2.cmml" xref="S5.SS2.p2.6.m6.1.1.3.3.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.6.m6.1.1.3.3.3.cmml" xref="S5.SS2.p2.6.m6.1.1.3.3.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.6.m6.1c">K_{1}\times M_{1}=K2\times M_{2}</annotation></semantics></math>.
The fused pipeline schedule is represented as a matrix <math id="S5.SS2.p2.7.m7.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p2.7.m7.1a"><mi id="S5.SS2.p2.7.m7.1.1" xref="S5.SS2.p2.7.m7.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.7.m7.1b"><ci id="S5.SS2.p2.7.m7.1.1.cmml" xref="S5.SS2.p2.7.m7.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.7.m7.1c">S</annotation></semantics></math>,
where <math id="S5.SS2.p2.8.m8.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="S5.SS2.p2.8.m8.1a"><msub id="S5.SS2.p2.8.m8.1.1" xref="S5.SS2.p2.8.m8.1.1.cmml"><mi id="S5.SS2.p2.8.m8.1.1.2" xref="S5.SS2.p2.8.m8.1.1.2.cmml">S</mi><mrow id="S5.SS2.p2.8.m8.1.1.3" xref="S5.SS2.p2.8.m8.1.1.3.cmml"><mi id="S5.SS2.p2.8.m8.1.1.3.2" xref="S5.SS2.p2.8.m8.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p2.8.m8.1.1.3.1" xref="S5.SS2.p2.8.m8.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p2.8.m8.1.1.3.3" xref="S5.SS2.p2.8.m8.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.8.m8.1b"><apply id="S5.SS2.p2.8.m8.1.1.cmml" xref="S5.SS2.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.8.m8.1.1.1.cmml" xref="S5.SS2.p2.8.m8.1.1">subscript</csymbol><ci id="S5.SS2.p2.8.m8.1.1.2.cmml" xref="S5.SS2.p2.8.m8.1.1.2">𝑆</ci><apply id="S5.SS2.p2.8.m8.1.1.3.cmml" xref="S5.SS2.p2.8.m8.1.1.3"><times id="S5.SS2.p2.8.m8.1.1.3.1.cmml" xref="S5.SS2.p2.8.m8.1.1.3.1"></times><ci id="S5.SS2.p2.8.m8.1.1.3.2.cmml" xref="S5.SS2.p2.8.m8.1.1.3.2">𝑖</ci><ci id="S5.SS2.p2.8.m8.1.1.3.3.cmml" xref="S5.SS2.p2.8.m8.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.8.m8.1c">S_{ij}</annotation></semantics></math> represents the <math id="S5.SS2.p2.9.m9.1" class="ltx_Math" alttext="j" display="inline"><semantics id="S5.SS2.p2.9.m9.1a"><mi id="S5.SS2.p2.9.m9.1.1" xref="S5.SS2.p2.9.m9.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.9.m9.1b"><ci id="S5.SS2.p2.9.m9.1.1.cmml" xref="S5.SS2.p2.9.m9.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.9.m9.1c">j</annotation></semantics></math>-th subtask (micro-batch) to be scheduled in the <math id="S5.SS2.p2.10.m10.1" class="ltx_Math" alttext="i" display="inline"><semantics id="S5.SS2.p2.10.m10.1a"><mi id="S5.SS2.p2.10.m10.1.1" xref="S5.SS2.p2.10.m10.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.10.m10.1b"><ci id="S5.SS2.p2.10.m10.1.1.cmml" xref="S5.SS2.p2.10.m10.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.10.m10.1c">i</annotation></semantics></math>-th stage.
Since there are <math id="S5.SS2.p2.11.m11.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S5.SS2.p2.11.m11.1a"><mi id="S5.SS2.p2.11.m11.1.1" xref="S5.SS2.p2.11.m11.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.11.m11.1b"><ci id="S5.SS2.p2.11.m11.1.1.cmml" xref="S5.SS2.p2.11.m11.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.11.m11.1c">N</annotation></semantics></math> stages in total and each stage needs to process the forward and backward computation for all
micro-batches of the two models exactly once, the shape of <math id="S5.SS2.p2.12.m12.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p2.12.m12.1a"><mi id="S5.SS2.p2.12.m12.1.1" xref="S5.SS2.p2.12.m12.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.12.m12.1b"><ci id="S5.SS2.p2.12.m12.1.1.cmml" xref="S5.SS2.p2.12.m12.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.12.m12.1c">S</annotation></semantics></math> is <math id="S5.SS2.p2.13.m13.1" class="ltx_Math" alttext="N\times 2(M_{1}+M_{2})" display="inline"><semantics id="S5.SS2.p2.13.m13.1a"><mrow id="S5.SS2.p2.13.m13.1.1" xref="S5.SS2.p2.13.m13.1.1.cmml"><mrow id="S5.SS2.p2.13.m13.1.1.3" xref="S5.SS2.p2.13.m13.1.1.3.cmml"><mi id="S5.SS2.p2.13.m13.1.1.3.2" xref="S5.SS2.p2.13.m13.1.1.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p2.13.m13.1.1.3.1" xref="S5.SS2.p2.13.m13.1.1.3.1.cmml">×</mo><mn id="S5.SS2.p2.13.m13.1.1.3.3" xref="S5.SS2.p2.13.m13.1.1.3.3.cmml">2</mn></mrow><mo lspace="0em" rspace="0em" id="S5.SS2.p2.13.m13.1.1.2" xref="S5.SS2.p2.13.m13.1.1.2.cmml">​</mo><mrow id="S5.SS2.p2.13.m13.1.1.1.1" xref="S5.SS2.p2.13.m13.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.SS2.p2.13.m13.1.1.1.1.2" xref="S5.SS2.p2.13.m13.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS2.p2.13.m13.1.1.1.1.1" xref="S5.SS2.p2.13.m13.1.1.1.1.1.cmml"><msub id="S5.SS2.p2.13.m13.1.1.1.1.1.2" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2.cmml"><mi id="S5.SS2.p2.13.m13.1.1.1.1.1.2.2" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2.2.cmml">M</mi><mn id="S5.SS2.p2.13.m13.1.1.1.1.1.2.3" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S5.SS2.p2.13.m13.1.1.1.1.1.1" xref="S5.SS2.p2.13.m13.1.1.1.1.1.1.cmml">+</mo><msub id="S5.SS2.p2.13.m13.1.1.1.1.1.3" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3.cmml"><mi id="S5.SS2.p2.13.m13.1.1.1.1.1.3.2" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3.2.cmml">M</mi><mn id="S5.SS2.p2.13.m13.1.1.1.1.1.3.3" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3.3.cmml">2</mn></msub></mrow><mo stretchy="false" id="S5.SS2.p2.13.m13.1.1.1.1.3" xref="S5.SS2.p2.13.m13.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.13.m13.1b"><apply id="S5.SS2.p2.13.m13.1.1.cmml" xref="S5.SS2.p2.13.m13.1.1"><times id="S5.SS2.p2.13.m13.1.1.2.cmml" xref="S5.SS2.p2.13.m13.1.1.2"></times><apply id="S5.SS2.p2.13.m13.1.1.3.cmml" xref="S5.SS2.p2.13.m13.1.1.3"><times id="S5.SS2.p2.13.m13.1.1.3.1.cmml" xref="S5.SS2.p2.13.m13.1.1.3.1"></times><ci id="S5.SS2.p2.13.m13.1.1.3.2.cmml" xref="S5.SS2.p2.13.m13.1.1.3.2">𝑁</ci><cn type="integer" id="S5.SS2.p2.13.m13.1.1.3.3.cmml" xref="S5.SS2.p2.13.m13.1.1.3.3">2</cn></apply><apply id="S5.SS2.p2.13.m13.1.1.1.1.1.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1"><plus id="S5.SS2.p2.13.m13.1.1.1.1.1.1.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.1"></plus><apply id="S5.SS2.p2.13.m13.1.1.1.1.1.2.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.SS2.p2.13.m13.1.1.1.1.1.2.1.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2">subscript</csymbol><ci id="S5.SS2.p2.13.m13.1.1.1.1.1.2.2.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.13.m13.1.1.1.1.1.2.3.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.2.3">1</cn></apply><apply id="S5.SS2.p2.13.m13.1.1.1.1.1.3.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p2.13.m13.1.1.1.1.1.3.1.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3">subscript</csymbol><ci id="S5.SS2.p2.13.m13.1.1.1.1.1.3.2.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3.2">𝑀</ci><cn type="integer" id="S5.SS2.p2.13.m13.1.1.1.1.1.3.3.cmml" xref="S5.SS2.p2.13.m13.1.1.1.1.1.3.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.13.m13.1c">N\times 2(M_{1}+M_{2})</annotation></semantics></math>.
The latency of subtask <math id="S5.SS2.p2.14.m14.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="S5.SS2.p2.14.m14.1a"><msub id="S5.SS2.p2.14.m14.1.1" xref="S5.SS2.p2.14.m14.1.1.cmml"><mi id="S5.SS2.p2.14.m14.1.1.2" xref="S5.SS2.p2.14.m14.1.1.2.cmml">S</mi><mrow id="S5.SS2.p2.14.m14.1.1.3" xref="S5.SS2.p2.14.m14.1.1.3.cmml"><mi id="S5.SS2.p2.14.m14.1.1.3.2" xref="S5.SS2.p2.14.m14.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p2.14.m14.1.1.3.1" xref="S5.SS2.p2.14.m14.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p2.14.m14.1.1.3.3" xref="S5.SS2.p2.14.m14.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.14.m14.1b"><apply id="S5.SS2.p2.14.m14.1.1.cmml" xref="S5.SS2.p2.14.m14.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.14.m14.1.1.1.cmml" xref="S5.SS2.p2.14.m14.1.1">subscript</csymbol><ci id="S5.SS2.p2.14.m14.1.1.2.cmml" xref="S5.SS2.p2.14.m14.1.1.2">𝑆</ci><apply id="S5.SS2.p2.14.m14.1.1.3.cmml" xref="S5.SS2.p2.14.m14.1.1.3"><times id="S5.SS2.p2.14.m14.1.1.3.1.cmml" xref="S5.SS2.p2.14.m14.1.1.3.1"></times><ci id="S5.SS2.p2.14.m14.1.1.3.2.cmml" xref="S5.SS2.p2.14.m14.1.1.3.2">𝑖</ci><ci id="S5.SS2.p2.14.m14.1.1.3.3.cmml" xref="S5.SS2.p2.14.m14.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.14.m14.1c">S_{ij}</annotation></semantics></math> can be profiled in advance and is denoted as <math id="S5.SS2.p2.15.m15.1" class="ltx_Math" alttext="l_{ij}" display="inline"><semantics id="S5.SS2.p2.15.m15.1a"><msub id="S5.SS2.p2.15.m15.1.1" xref="S5.SS2.p2.15.m15.1.1.cmml"><mi id="S5.SS2.p2.15.m15.1.1.2" xref="S5.SS2.p2.15.m15.1.1.2.cmml">l</mi><mrow id="S5.SS2.p2.15.m15.1.1.3" xref="S5.SS2.p2.15.m15.1.1.3.cmml"><mi id="S5.SS2.p2.15.m15.1.1.3.2" xref="S5.SS2.p2.15.m15.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p2.15.m15.1.1.3.1" xref="S5.SS2.p2.15.m15.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p2.15.m15.1.1.3.3" xref="S5.SS2.p2.15.m15.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.15.m15.1b"><apply id="S5.SS2.p2.15.m15.1.1.cmml" xref="S5.SS2.p2.15.m15.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.15.m15.1.1.1.cmml" xref="S5.SS2.p2.15.m15.1.1">subscript</csymbol><ci id="S5.SS2.p2.15.m15.1.1.2.cmml" xref="S5.SS2.p2.15.m15.1.1.2">𝑙</ci><apply id="S5.SS2.p2.15.m15.1.1.3.cmml" xref="S5.SS2.p2.15.m15.1.1.3"><times id="S5.SS2.p2.15.m15.1.1.3.1.cmml" xref="S5.SS2.p2.15.m15.1.1.3.1"></times><ci id="S5.SS2.p2.15.m15.1.1.3.2.cmml" xref="S5.SS2.p2.15.m15.1.1.3.2">𝑖</ci><ci id="S5.SS2.p2.15.m15.1.1.3.3.cmml" xref="S5.SS2.p2.15.m15.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.15.m15.1c">l_{ij}</annotation></semantics></math>.
Note that not all <math id="S5.SS2.p2.16.m16.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p2.16.m16.1a"><mi id="S5.SS2.p2.16.m16.1.1" xref="S5.SS2.p2.16.m16.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.16.m16.1b"><ci id="S5.SS2.p2.16.m16.1.1.cmml" xref="S5.SS2.p2.16.m16.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.16.m16.1c">S</annotation></semantics></math> can be scheduled. A valid schedule must satisfy the
following constraints:</p>
<ul id="S5.I1" class="ltx_itemize">
<li id="S5.I1.ix1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="S5.I1.ix1.p1" class="ltx_para">
<p id="S5.I1.ix1.p1.1" class="ltx_p">Data dependency: the forward and backward of the same
micro-batch across different stages must be executed following the original data dependency.</p>
</div>
</li>
<li id="S5.I1.ix2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="S5.I1.ix2.p1" class="ltx_para">
<p id="S5.I1.ix2.p1.1" class="ltx_p">Deadlock avoidance: there exists no cycles in the overall dependency graph to avoid deadlocks.</p>
</div>
</li>
<li id="S5.I1.ix3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="S5.I1.ix3.p1" class="ltx_para">
<p id="S5.I1.ix3.p1.1" class="ltx_p">Memory constraint: the peak activation memory usage of each stage must be less than
<math id="S5.I1.ix3.p1.1.m1.1" class="ltx_Math" alttext="C" display="inline"><semantics id="S5.I1.ix3.p1.1.m1.1a"><mi id="S5.I1.ix3.p1.1.m1.1.1" xref="S5.I1.ix3.p1.1.m1.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S5.I1.ix3.p1.1.m1.1b"><ci id="S5.I1.ix3.p1.1.m1.1.1.cmml" xref="S5.I1.ix3.p1.1.m1.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.I1.ix3.p1.1.m1.1c">C</annotation></semantics></math> to avoid out-of-memory.</p>
</div>
</li>
</ul>
<p id="S5.SS2.p2.17" class="ltx_p">The main optimization target is to find a valid schedule <math id="S5.SS2.p2.17.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p2.17.m1.1a"><mi id="S5.SS2.p2.17.m1.1.1" xref="S5.SS2.p2.17.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.17.m1.1b"><ci id="S5.SS2.p2.17.m1.1.1.cmml" xref="S5.SS2.p2.17.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.17.m1.1c">S</annotation></semantics></math> that has the minimum latency.
Additionally, among schedules with the same latency, we prefer the ones with
lower peak activation memory to optimize resource usage.</p>
</div>
<figure id="alg1" class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="alg1.2.1.1" class="ltx_text ltx_font_bold">Algorithm 1</span> </span> Generate Fused Pipeline Schedule.</figcaption>
<div id="alg1.3" class="ltx_listing ltx_listing">
<div id="alg1.l1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l1.1.1.1" class="ltx_text" style="font-size:80%;">1:</span></span><span id="alg1.l1.2" class="ltx_text ltx_font_bold">function</span> <span id="alg1.l1.3" class="ltx_text ltx_font_smallcaps">GenerateFusedPipelineSchedule</span>(<math id="alg1.l1.m1.1" class="ltx_Math" alttext="S_{0}" display="inline"><semantics id="alg1.l1.m1.1a"><msub id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml"><mi id="alg1.l1.m1.1.1.2" xref="alg1.l1.m1.1.1.2.cmml">S</mi><mn id="alg1.l1.m1.1.1.3" xref="alg1.l1.m1.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><apply id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.1.cmml" xref="alg1.l1.m1.1.1">subscript</csymbol><ci id="alg1.l1.m1.1.1.2.cmml" xref="alg1.l1.m1.1.1.2">𝑆</ci><cn type="integer" id="alg1.l1.m1.1.1.3.cmml" xref="alg1.l1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">S_{0}</annotation></semantics></math>)

</div>
<div id="alg1.l2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l2.1.1.1" class="ltx_text" style="font-size:80%;">2:</span></span>     <math id="alg1.l2.m1.1" class="ltx_Math" alttext="s_{current}\leftarrow S_{0}" display="inline"><semantics id="alg1.l2.m1.1a"><mrow id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml"><msub id="alg1.l2.m1.1.1.2" xref="alg1.l2.m1.1.1.2.cmml"><mi id="alg1.l2.m1.1.1.2.2" xref="alg1.l2.m1.1.1.2.2.cmml">s</mi><mrow id="alg1.l2.m1.1.1.2.3" xref="alg1.l2.m1.1.1.2.3.cmml"><mi id="alg1.l2.m1.1.1.2.3.2" xref="alg1.l2.m1.1.1.2.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.3" xref="alg1.l2.m1.1.1.2.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1a" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.4" xref="alg1.l2.m1.1.1.2.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1b" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.5" xref="alg1.l2.m1.1.1.2.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1c" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.6" xref="alg1.l2.m1.1.1.2.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1d" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.7" xref="alg1.l2.m1.1.1.2.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l2.m1.1.1.2.3.1e" xref="alg1.l2.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l2.m1.1.1.2.3.8" xref="alg1.l2.m1.1.1.2.3.8.cmml">t</mi></mrow></msub><mo stretchy="false" id="alg1.l2.m1.1.1.1" xref="alg1.l2.m1.1.1.1.cmml">←</mo><msub id="alg1.l2.m1.1.1.3" xref="alg1.l2.m1.1.1.3.cmml"><mi id="alg1.l2.m1.1.1.3.2" xref="alg1.l2.m1.1.1.3.2.cmml">S</mi><mn id="alg1.l2.m1.1.1.3.3" xref="alg1.l2.m1.1.1.3.3.cmml">0</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><apply id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1"><ci id="alg1.l2.m1.1.1.1.cmml" xref="alg1.l2.m1.1.1.1">←</ci><apply id="alg1.l2.m1.1.1.2.cmml" xref="alg1.l2.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l2.m1.1.1.2.1.cmml" xref="alg1.l2.m1.1.1.2">subscript</csymbol><ci id="alg1.l2.m1.1.1.2.2.cmml" xref="alg1.l2.m1.1.1.2.2">𝑠</ci><apply id="alg1.l2.m1.1.1.2.3.cmml" xref="alg1.l2.m1.1.1.2.3"><times id="alg1.l2.m1.1.1.2.3.1.cmml" xref="alg1.l2.m1.1.1.2.3.1"></times><ci id="alg1.l2.m1.1.1.2.3.2.cmml" xref="alg1.l2.m1.1.1.2.3.2">𝑐</ci><ci id="alg1.l2.m1.1.1.2.3.3.cmml" xref="alg1.l2.m1.1.1.2.3.3">𝑢</ci><ci id="alg1.l2.m1.1.1.2.3.4.cmml" xref="alg1.l2.m1.1.1.2.3.4">𝑟</ci><ci id="alg1.l2.m1.1.1.2.3.5.cmml" xref="alg1.l2.m1.1.1.2.3.5">𝑟</ci><ci id="alg1.l2.m1.1.1.2.3.6.cmml" xref="alg1.l2.m1.1.1.2.3.6">𝑒</ci><ci id="alg1.l2.m1.1.1.2.3.7.cmml" xref="alg1.l2.m1.1.1.2.3.7">𝑛</ci><ci id="alg1.l2.m1.1.1.2.3.8.cmml" xref="alg1.l2.m1.1.1.2.3.8">𝑡</ci></apply></apply><apply id="alg1.l2.m1.1.1.3.cmml" xref="alg1.l2.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l2.m1.1.1.3.1.cmml" xref="alg1.l2.m1.1.1.3">subscript</csymbol><ci id="alg1.l2.m1.1.1.3.2.cmml" xref="alg1.l2.m1.1.1.3.2">𝑆</ci><cn type="integer" id="alg1.l2.m1.1.1.3.3.cmml" xref="alg1.l2.m1.1.1.3.3">0</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">s_{current}\leftarrow S_{0}</annotation></semantics></math>

</div>
<div id="alg1.l3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l3.1.1.1" class="ltx_text" style="font-size:80%;">3:</span></span>     <math id="alg1.l3.m1.1" class="ltx_Math" alttext="e_{current}\leftarrow\mathit{ComputeEnergy}(s)" display="inline"><semantics id="alg1.l3.m1.1a"><mrow id="alg1.l3.m1.1.2" xref="alg1.l3.m1.1.2.cmml"><msub id="alg1.l3.m1.1.2.2" xref="alg1.l3.m1.1.2.2.cmml"><mi id="alg1.l3.m1.1.2.2.2" xref="alg1.l3.m1.1.2.2.2.cmml">e</mi><mrow id="alg1.l3.m1.1.2.2.3" xref="alg1.l3.m1.1.2.2.3.cmml"><mi id="alg1.l3.m1.1.2.2.3.2" xref="alg1.l3.m1.1.2.2.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.3" xref="alg1.l3.m1.1.2.2.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1a" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.4" xref="alg1.l3.m1.1.2.2.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1b" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.5" xref="alg1.l3.m1.1.2.2.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1c" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.6" xref="alg1.l3.m1.1.2.2.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1d" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.7" xref="alg1.l3.m1.1.2.2.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.2.3.1e" xref="alg1.l3.m1.1.2.2.3.1.cmml">​</mo><mi id="alg1.l3.m1.1.2.2.3.8" xref="alg1.l3.m1.1.2.2.3.8.cmml">t</mi></mrow></msub><mo stretchy="false" id="alg1.l3.m1.1.2.1" xref="alg1.l3.m1.1.2.1.cmml">←</mo><mrow id="alg1.l3.m1.1.2.3" xref="alg1.l3.m1.1.2.3.cmml"><mi id="alg1.l3.m1.1.2.3.2" xref="alg1.l3.m1.1.2.3.2.cmml">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝐸𝑛𝑒𝑟𝑔𝑦</mi><mo lspace="0em" rspace="0em" id="alg1.l3.m1.1.2.3.1" xref="alg1.l3.m1.1.2.3.1.cmml">​</mo><mrow id="alg1.l3.m1.1.2.3.3.2" xref="alg1.l3.m1.1.2.3.cmml"><mo stretchy="false" id="alg1.l3.m1.1.2.3.3.2.1" xref="alg1.l3.m1.1.2.3.cmml">(</mo><mi id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml">s</mi><mo stretchy="false" id="alg1.l3.m1.1.2.3.3.2.2" xref="alg1.l3.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.1b"><apply id="alg1.l3.m1.1.2.cmml" xref="alg1.l3.m1.1.2"><ci id="alg1.l3.m1.1.2.1.cmml" xref="alg1.l3.m1.1.2.1">←</ci><apply id="alg1.l3.m1.1.2.2.cmml" xref="alg1.l3.m1.1.2.2"><csymbol cd="ambiguous" id="alg1.l3.m1.1.2.2.1.cmml" xref="alg1.l3.m1.1.2.2">subscript</csymbol><ci id="alg1.l3.m1.1.2.2.2.cmml" xref="alg1.l3.m1.1.2.2.2">𝑒</ci><apply id="alg1.l3.m1.1.2.2.3.cmml" xref="alg1.l3.m1.1.2.2.3"><times id="alg1.l3.m1.1.2.2.3.1.cmml" xref="alg1.l3.m1.1.2.2.3.1"></times><ci id="alg1.l3.m1.1.2.2.3.2.cmml" xref="alg1.l3.m1.1.2.2.3.2">𝑐</ci><ci id="alg1.l3.m1.1.2.2.3.3.cmml" xref="alg1.l3.m1.1.2.2.3.3">𝑢</ci><ci id="alg1.l3.m1.1.2.2.3.4.cmml" xref="alg1.l3.m1.1.2.2.3.4">𝑟</ci><ci id="alg1.l3.m1.1.2.2.3.5.cmml" xref="alg1.l3.m1.1.2.2.3.5">𝑟</ci><ci id="alg1.l3.m1.1.2.2.3.6.cmml" xref="alg1.l3.m1.1.2.2.3.6">𝑒</ci><ci id="alg1.l3.m1.1.2.2.3.7.cmml" xref="alg1.l3.m1.1.2.2.3.7">𝑛</ci><ci id="alg1.l3.m1.1.2.2.3.8.cmml" xref="alg1.l3.m1.1.2.2.3.8">𝑡</ci></apply></apply><apply id="alg1.l3.m1.1.2.3.cmml" xref="alg1.l3.m1.1.2.3"><times id="alg1.l3.m1.1.2.3.1.cmml" xref="alg1.l3.m1.1.2.3.1"></times><ci id="alg1.l3.m1.1.2.3.2.cmml" xref="alg1.l3.m1.1.2.3.2">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝐸𝑛𝑒𝑟𝑔𝑦</ci><ci id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1">𝑠</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.1c">e_{current}\leftarrow\mathit{ComputeEnergy}(s)</annotation></semantics></math>

</div>
<div id="alg1.l4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l4.1.1.1" class="ltx_text" style="font-size:80%;">4:</span></span>     <math id="alg1.l4.m1.1" class="ltx_Math" alttext="T\leftarrow e_{current}" display="inline"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><mi id="alg1.l4.m1.1.1.2" xref="alg1.l4.m1.1.1.2.cmml">T</mi><mo stretchy="false" id="alg1.l4.m1.1.1.1" xref="alg1.l4.m1.1.1.1.cmml">←</mo><msub id="alg1.l4.m1.1.1.3" xref="alg1.l4.m1.1.1.3.cmml"><mi id="alg1.l4.m1.1.1.3.2" xref="alg1.l4.m1.1.1.3.2.cmml">e</mi><mrow id="alg1.l4.m1.1.1.3.3" xref="alg1.l4.m1.1.1.3.3.cmml"><mi id="alg1.l4.m1.1.1.3.3.2" xref="alg1.l4.m1.1.1.3.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.3" xref="alg1.l4.m1.1.1.3.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1a" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.4" xref="alg1.l4.m1.1.1.3.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1b" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.5" xref="alg1.l4.m1.1.1.3.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1c" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.6" xref="alg1.l4.m1.1.1.3.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1d" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.7" xref="alg1.l4.m1.1.1.3.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l4.m1.1.1.3.3.1e" xref="alg1.l4.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l4.m1.1.1.3.3.8" xref="alg1.l4.m1.1.1.3.3.8.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><ci id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1">←</ci><ci id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2">𝑇</ci><apply id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.3.1.cmml" xref="alg1.l4.m1.1.1.3">subscript</csymbol><ci id="alg1.l4.m1.1.1.3.2.cmml" xref="alg1.l4.m1.1.1.3.2">𝑒</ci><apply id="alg1.l4.m1.1.1.3.3.cmml" xref="alg1.l4.m1.1.1.3.3"><times id="alg1.l4.m1.1.1.3.3.1.cmml" xref="alg1.l4.m1.1.1.3.3.1"></times><ci id="alg1.l4.m1.1.1.3.3.2.cmml" xref="alg1.l4.m1.1.1.3.3.2">𝑐</ci><ci id="alg1.l4.m1.1.1.3.3.3.cmml" xref="alg1.l4.m1.1.1.3.3.3">𝑢</ci><ci id="alg1.l4.m1.1.1.3.3.4.cmml" xref="alg1.l4.m1.1.1.3.3.4">𝑟</ci><ci id="alg1.l4.m1.1.1.3.3.5.cmml" xref="alg1.l4.m1.1.1.3.3.5">𝑟</ci><ci id="alg1.l4.m1.1.1.3.3.6.cmml" xref="alg1.l4.m1.1.1.3.3.6">𝑒</ci><ci id="alg1.l4.m1.1.1.3.3.7.cmml" xref="alg1.l4.m1.1.1.3.3.7">𝑛</ci><ci id="alg1.l4.m1.1.1.3.3.8.cmml" xref="alg1.l4.m1.1.1.3.3.8">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">T\leftarrow e_{current}</annotation></semantics></math>

</div>
<div id="alg1.l5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l5.1.1.1" class="ltx_text" style="font-size:80%;">5:</span></span>     <math id="alg1.l5.m1.1" class="ltx_Math" alttext="s^{*}\leftarrow s_{current}" display="inline"><semantics id="alg1.l5.m1.1a"><mrow id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml"><msup id="alg1.l5.m1.1.1.2" xref="alg1.l5.m1.1.1.2.cmml"><mi id="alg1.l5.m1.1.1.2.2" xref="alg1.l5.m1.1.1.2.2.cmml">s</mi><mo id="alg1.l5.m1.1.1.2.3" xref="alg1.l5.m1.1.1.2.3.cmml">∗</mo></msup><mo stretchy="false" id="alg1.l5.m1.1.1.1" xref="alg1.l5.m1.1.1.1.cmml">←</mo><msub id="alg1.l5.m1.1.1.3" xref="alg1.l5.m1.1.1.3.cmml"><mi id="alg1.l5.m1.1.1.3.2" xref="alg1.l5.m1.1.1.3.2.cmml">s</mi><mrow id="alg1.l5.m1.1.1.3.3" xref="alg1.l5.m1.1.1.3.3.cmml"><mi id="alg1.l5.m1.1.1.3.3.2" xref="alg1.l5.m1.1.1.3.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.3" xref="alg1.l5.m1.1.1.3.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1a" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.4" xref="alg1.l5.m1.1.1.3.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1b" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.5" xref="alg1.l5.m1.1.1.3.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1c" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.6" xref="alg1.l5.m1.1.1.3.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1d" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.7" xref="alg1.l5.m1.1.1.3.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l5.m1.1.1.3.3.1e" xref="alg1.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l5.m1.1.1.3.3.8" xref="alg1.l5.m1.1.1.3.3.8.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.1b"><apply id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1"><ci id="alg1.l5.m1.1.1.1.cmml" xref="alg1.l5.m1.1.1.1">←</ci><apply id="alg1.l5.m1.1.1.2.cmml" xref="alg1.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l5.m1.1.1.2.1.cmml" xref="alg1.l5.m1.1.1.2">superscript</csymbol><ci id="alg1.l5.m1.1.1.2.2.cmml" xref="alg1.l5.m1.1.1.2.2">𝑠</ci><times id="alg1.l5.m1.1.1.2.3.cmml" xref="alg1.l5.m1.1.1.2.3"></times></apply><apply id="alg1.l5.m1.1.1.3.cmml" xref="alg1.l5.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l5.m1.1.1.3.1.cmml" xref="alg1.l5.m1.1.1.3">subscript</csymbol><ci id="alg1.l5.m1.1.1.3.2.cmml" xref="alg1.l5.m1.1.1.3.2">𝑠</ci><apply id="alg1.l5.m1.1.1.3.3.cmml" xref="alg1.l5.m1.1.1.3.3"><times id="alg1.l5.m1.1.1.3.3.1.cmml" xref="alg1.l5.m1.1.1.3.3.1"></times><ci id="alg1.l5.m1.1.1.3.3.2.cmml" xref="alg1.l5.m1.1.1.3.3.2">𝑐</ci><ci id="alg1.l5.m1.1.1.3.3.3.cmml" xref="alg1.l5.m1.1.1.3.3.3">𝑢</ci><ci id="alg1.l5.m1.1.1.3.3.4.cmml" xref="alg1.l5.m1.1.1.3.3.4">𝑟</ci><ci id="alg1.l5.m1.1.1.3.3.5.cmml" xref="alg1.l5.m1.1.1.3.3.5">𝑟</ci><ci id="alg1.l5.m1.1.1.3.3.6.cmml" xref="alg1.l5.m1.1.1.3.3.6">𝑒</ci><ci id="alg1.l5.m1.1.1.3.3.7.cmml" xref="alg1.l5.m1.1.1.3.3.7">𝑛</ci><ci id="alg1.l5.m1.1.1.3.3.8.cmml" xref="alg1.l5.m1.1.1.3.3.8">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.1c">s^{*}\leftarrow s_{current}</annotation></semantics></math>

</div>
<div id="alg1.l6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l6.1.1.1" class="ltx_text" style="font-size:80%;">6:</span></span>     <math id="alg1.l6.m1.1" class="ltx_Math" alttext="e^{*}\leftarrow e_{current}" display="inline"><semantics id="alg1.l6.m1.1a"><mrow id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml"><msup id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml"><mi id="alg1.l6.m1.1.1.2.2" xref="alg1.l6.m1.1.1.2.2.cmml">e</mi><mo id="alg1.l6.m1.1.1.2.3" xref="alg1.l6.m1.1.1.2.3.cmml">∗</mo></msup><mo stretchy="false" id="alg1.l6.m1.1.1.1" xref="alg1.l6.m1.1.1.1.cmml">←</mo><msub id="alg1.l6.m1.1.1.3" xref="alg1.l6.m1.1.1.3.cmml"><mi id="alg1.l6.m1.1.1.3.2" xref="alg1.l6.m1.1.1.3.2.cmml">e</mi><mrow id="alg1.l6.m1.1.1.3.3" xref="alg1.l6.m1.1.1.3.3.cmml"><mi id="alg1.l6.m1.1.1.3.3.2" xref="alg1.l6.m1.1.1.3.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.3" xref="alg1.l6.m1.1.1.3.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1a" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.4" xref="alg1.l6.m1.1.1.3.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1b" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.5" xref="alg1.l6.m1.1.1.3.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1c" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.6" xref="alg1.l6.m1.1.1.3.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1d" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.7" xref="alg1.l6.m1.1.1.3.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l6.m1.1.1.3.3.1e" xref="alg1.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l6.m1.1.1.3.3.8" xref="alg1.l6.m1.1.1.3.3.8.cmml">t</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1"><ci id="alg1.l6.m1.1.1.1.cmml" xref="alg1.l6.m1.1.1.1">←</ci><apply id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.2.1.cmml" xref="alg1.l6.m1.1.1.2">superscript</csymbol><ci id="alg1.l6.m1.1.1.2.2.cmml" xref="alg1.l6.m1.1.1.2.2">𝑒</ci><times id="alg1.l6.m1.1.1.2.3.cmml" xref="alg1.l6.m1.1.1.2.3"></times></apply><apply id="alg1.l6.m1.1.1.3.cmml" xref="alg1.l6.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.3.1.cmml" xref="alg1.l6.m1.1.1.3">subscript</csymbol><ci id="alg1.l6.m1.1.1.3.2.cmml" xref="alg1.l6.m1.1.1.3.2">𝑒</ci><apply id="alg1.l6.m1.1.1.3.3.cmml" xref="alg1.l6.m1.1.1.3.3"><times id="alg1.l6.m1.1.1.3.3.1.cmml" xref="alg1.l6.m1.1.1.3.3.1"></times><ci id="alg1.l6.m1.1.1.3.3.2.cmml" xref="alg1.l6.m1.1.1.3.3.2">𝑐</ci><ci id="alg1.l6.m1.1.1.3.3.3.cmml" xref="alg1.l6.m1.1.1.3.3.3">𝑢</ci><ci id="alg1.l6.m1.1.1.3.3.4.cmml" xref="alg1.l6.m1.1.1.3.3.4">𝑟</ci><ci id="alg1.l6.m1.1.1.3.3.5.cmml" xref="alg1.l6.m1.1.1.3.3.5">𝑟</ci><ci id="alg1.l6.m1.1.1.3.3.6.cmml" xref="alg1.l6.m1.1.1.3.3.6">𝑒</ci><ci id="alg1.l6.m1.1.1.3.3.7.cmml" xref="alg1.l6.m1.1.1.3.3.7">𝑛</ci><ci id="alg1.l6.m1.1.1.3.3.8.cmml" xref="alg1.l6.m1.1.1.3.3.8">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">e^{*}\leftarrow e_{current}</annotation></semantics></math>

</div>
<div id="alg1.l7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l7.1.1.1" class="ltx_text" style="font-size:80%;">7:</span></span>     <span id="alg1.l7.2" class="ltx_text ltx_font_bold">while</span> <math id="alg1.l7.m1.1" class="ltx_Math" alttext="T&gt;\epsilon" display="inline"><semantics id="alg1.l7.m1.1a"><mrow id="alg1.l7.m1.1.1" xref="alg1.l7.m1.1.1.cmml"><mi id="alg1.l7.m1.1.1.2" xref="alg1.l7.m1.1.1.2.cmml">T</mi><mo id="alg1.l7.m1.1.1.1" xref="alg1.l7.m1.1.1.1.cmml">&gt;</mo><mi id="alg1.l7.m1.1.1.3" xref="alg1.l7.m1.1.1.3.cmml">ϵ</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.1b"><apply id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1"><gt id="alg1.l7.m1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1"></gt><ci id="alg1.l7.m1.1.1.2.cmml" xref="alg1.l7.m1.1.1.2">𝑇</ci><ci id="alg1.l7.m1.1.1.3.cmml" xref="alg1.l7.m1.1.1.3">italic-ϵ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.1c">T&gt;\epsilon</annotation></semantics></math> <span id="alg1.l7.3" class="ltx_text ltx_font_bold">do</span>

</div>
<div id="alg1.l8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l8.1.1.1" class="ltx_text" style="font-size:80%;">8:</span></span>         <math id="alg1.l8.m1.1" class="ltx_Math" alttext="s_{neighbor}\leftarrow\mathit{ComputeNeighbor(s_{current})}" display="inline"><semantics id="alg1.l8.m1.1a"><mrow id="alg1.l8.m1.1.1" xref="alg1.l8.m1.1.1.cmml"><msub id="alg1.l8.m1.1.1.3" xref="alg1.l8.m1.1.1.3.cmml"><mi id="alg1.l8.m1.1.1.3.2" xref="alg1.l8.m1.1.1.3.2.cmml">s</mi><mrow id="alg1.l8.m1.1.1.3.3" xref="alg1.l8.m1.1.1.3.3.cmml"><mi id="alg1.l8.m1.1.1.3.3.2" xref="alg1.l8.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.3" xref="alg1.l8.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1a" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.4" xref="alg1.l8.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1b" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.5" xref="alg1.l8.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1c" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.6" xref="alg1.l8.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1d" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.7" xref="alg1.l8.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1e" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.8" xref="alg1.l8.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.3.3.1f" xref="alg1.l8.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l8.m1.1.1.3.3.9" xref="alg1.l8.m1.1.1.3.3.9.cmml">r</mi></mrow></msub><mo stretchy="false" id="alg1.l8.m1.1.1.2" xref="alg1.l8.m1.1.1.2.cmml">←</mo><mrow id="alg1.l8.m1.1.1.1" xref="alg1.l8.m1.1.1.1.cmml"><mi id="alg1.l8.m1.1.1.1.3" xref="alg1.l8.m1.1.1.1.3.cmml">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝑁𝑒𝑖𝑔ℎ𝑏𝑜𝑟</mi><mo lspace="0em" rspace="0em" id="alg1.l8.m1.1.1.1.2" xref="alg1.l8.m1.1.1.1.2.cmml">​</mo><mrow id="alg1.l8.m1.1.1.1.1.1" xref="alg1.l8.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg1.l8.m1.1.1.1.1.1.2" xref="alg1.l8.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg1.l8.m1.1.1.1.1.1.1" xref="alg1.l8.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l8.m1.1.1.1.1.1.1.2" xref="alg1.l8.m1.1.1.1.1.1.1.2.cmml">s</mi><mi id="alg1.l8.m1.1.1.1.1.1.1.3" xref="alg1.l8.m1.1.1.1.1.1.1.3.cmml">𝑐𝑢𝑟𝑟𝑒𝑛𝑡</mi></msub><mo stretchy="false" id="alg1.l8.m1.1.1.1.1.1.3" xref="alg1.l8.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.1b"><apply id="alg1.l8.m1.1.1.cmml" xref="alg1.l8.m1.1.1"><ci id="alg1.l8.m1.1.1.2.cmml" xref="alg1.l8.m1.1.1.2">←</ci><apply id="alg1.l8.m1.1.1.3.cmml" xref="alg1.l8.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l8.m1.1.1.3.1.cmml" xref="alg1.l8.m1.1.1.3">subscript</csymbol><ci id="alg1.l8.m1.1.1.3.2.cmml" xref="alg1.l8.m1.1.1.3.2">𝑠</ci><apply id="alg1.l8.m1.1.1.3.3.cmml" xref="alg1.l8.m1.1.1.3.3"><times id="alg1.l8.m1.1.1.3.3.1.cmml" xref="alg1.l8.m1.1.1.3.3.1"></times><ci id="alg1.l8.m1.1.1.3.3.2.cmml" xref="alg1.l8.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l8.m1.1.1.3.3.3.cmml" xref="alg1.l8.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l8.m1.1.1.3.3.4.cmml" xref="alg1.l8.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l8.m1.1.1.3.3.5.cmml" xref="alg1.l8.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l8.m1.1.1.3.3.6.cmml" xref="alg1.l8.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l8.m1.1.1.3.3.7.cmml" xref="alg1.l8.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l8.m1.1.1.3.3.8.cmml" xref="alg1.l8.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l8.m1.1.1.3.3.9.cmml" xref="alg1.l8.m1.1.1.3.3.9">𝑟</ci></apply></apply><apply id="alg1.l8.m1.1.1.1.cmml" xref="alg1.l8.m1.1.1.1"><times id="alg1.l8.m1.1.1.1.2.cmml" xref="alg1.l8.m1.1.1.1.2"></times><ci id="alg1.l8.m1.1.1.1.3.cmml" xref="alg1.l8.m1.1.1.1.3">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝑁𝑒𝑖𝑔ℎ𝑏𝑜𝑟</ci><apply id="alg1.l8.m1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l8.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l8.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.2">𝑠</ci><ci id="alg1.l8.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.3">𝑐𝑢𝑟𝑟𝑒𝑛𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.1c">s_{neighbor}\leftarrow\mathit{ComputeNeighbor(s_{current})}</annotation></semantics></math>

</div>
<div id="alg1.l9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l9.1.1.1" class="ltx_text" style="font-size:80%;">9:</span></span>         <math id="alg1.l9.m1.1" class="ltx_Math" alttext="e_{neighbor}\leftarrow\mathit{ComputeEnergy(s_{neighbor})}" display="inline"><semantics id="alg1.l9.m1.1a"><mrow id="alg1.l9.m1.1.1" xref="alg1.l9.m1.1.1.cmml"><msub id="alg1.l9.m1.1.1.3" xref="alg1.l9.m1.1.1.3.cmml"><mi id="alg1.l9.m1.1.1.3.2" xref="alg1.l9.m1.1.1.3.2.cmml">e</mi><mrow id="alg1.l9.m1.1.1.3.3" xref="alg1.l9.m1.1.1.3.3.cmml"><mi id="alg1.l9.m1.1.1.3.3.2" xref="alg1.l9.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.3" xref="alg1.l9.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1a" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.4" xref="alg1.l9.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1b" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.5" xref="alg1.l9.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1c" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.6" xref="alg1.l9.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1d" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.7" xref="alg1.l9.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1e" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.8" xref="alg1.l9.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.3.3.1f" xref="alg1.l9.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l9.m1.1.1.3.3.9" xref="alg1.l9.m1.1.1.3.3.9.cmml">r</mi></mrow></msub><mo stretchy="false" id="alg1.l9.m1.1.1.2" xref="alg1.l9.m1.1.1.2.cmml">←</mo><mrow id="alg1.l9.m1.1.1.1" xref="alg1.l9.m1.1.1.1.cmml"><mi id="alg1.l9.m1.1.1.1.3" xref="alg1.l9.m1.1.1.1.3.cmml">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝐸𝑛𝑒𝑟𝑔𝑦</mi><mo lspace="0em" rspace="0em" id="alg1.l9.m1.1.1.1.2" xref="alg1.l9.m1.1.1.1.2.cmml">​</mo><mrow id="alg1.l9.m1.1.1.1.1.1" xref="alg1.l9.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg1.l9.m1.1.1.1.1.1.2" xref="alg1.l9.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg1.l9.m1.1.1.1.1.1.1" xref="alg1.l9.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l9.m1.1.1.1.1.1.1.2" xref="alg1.l9.m1.1.1.1.1.1.1.2.cmml">s</mi><mi id="alg1.l9.m1.1.1.1.1.1.1.3" xref="alg1.l9.m1.1.1.1.1.1.1.3.cmml">𝑛𝑒𝑖𝑔ℎ𝑏𝑜𝑟</mi></msub><mo stretchy="false" id="alg1.l9.m1.1.1.1.1.1.3" xref="alg1.l9.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.1b"><apply id="alg1.l9.m1.1.1.cmml" xref="alg1.l9.m1.1.1"><ci id="alg1.l9.m1.1.1.2.cmml" xref="alg1.l9.m1.1.1.2">←</ci><apply id="alg1.l9.m1.1.1.3.cmml" xref="alg1.l9.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l9.m1.1.1.3.1.cmml" xref="alg1.l9.m1.1.1.3">subscript</csymbol><ci id="alg1.l9.m1.1.1.3.2.cmml" xref="alg1.l9.m1.1.1.3.2">𝑒</ci><apply id="alg1.l9.m1.1.1.3.3.cmml" xref="alg1.l9.m1.1.1.3.3"><times id="alg1.l9.m1.1.1.3.3.1.cmml" xref="alg1.l9.m1.1.1.3.3.1"></times><ci id="alg1.l9.m1.1.1.3.3.2.cmml" xref="alg1.l9.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l9.m1.1.1.3.3.3.cmml" xref="alg1.l9.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l9.m1.1.1.3.3.4.cmml" xref="alg1.l9.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l9.m1.1.1.3.3.5.cmml" xref="alg1.l9.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l9.m1.1.1.3.3.6.cmml" xref="alg1.l9.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l9.m1.1.1.3.3.7.cmml" xref="alg1.l9.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l9.m1.1.1.3.3.8.cmml" xref="alg1.l9.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l9.m1.1.1.3.3.9.cmml" xref="alg1.l9.m1.1.1.3.3.9">𝑟</ci></apply></apply><apply id="alg1.l9.m1.1.1.1.cmml" xref="alg1.l9.m1.1.1.1"><times id="alg1.l9.m1.1.1.1.2.cmml" xref="alg1.l9.m1.1.1.1.2"></times><ci id="alg1.l9.m1.1.1.1.3.cmml" xref="alg1.l9.m1.1.1.1.3">𝐶𝑜𝑚𝑝𝑢𝑡𝑒𝐸𝑛𝑒𝑟𝑔𝑦</ci><apply id="alg1.l9.m1.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l9.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l9.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l9.m1.1.1.1.1.1.1.2">𝑠</ci><ci id="alg1.l9.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l9.m1.1.1.1.1.1.1.3">𝑛𝑒𝑖𝑔ℎ𝑏𝑜𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.1c">e_{neighbor}\leftarrow\mathit{ComputeEnergy(s_{neighbor})}</annotation></semantics></math>

</div>
<div id="alg1.l10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l10.1.1.1" class="ltx_text" style="font-size:80%;">10:</span></span>         <span id="alg1.l10.2" class="ltx_text ltx_font_bold">if</span> <math id="alg1.l10.m1.1" class="ltx_Math" alttext="e_{neighbor}&lt;e^{*}" display="inline"><semantics id="alg1.l10.m1.1a"><mrow id="alg1.l10.m1.1.1" xref="alg1.l10.m1.1.1.cmml"><msub id="alg1.l10.m1.1.1.2" xref="alg1.l10.m1.1.1.2.cmml"><mi id="alg1.l10.m1.1.1.2.2" xref="alg1.l10.m1.1.1.2.2.cmml">e</mi><mrow id="alg1.l10.m1.1.1.2.3" xref="alg1.l10.m1.1.1.2.3.cmml"><mi id="alg1.l10.m1.1.1.2.3.2" xref="alg1.l10.m1.1.1.2.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.3" xref="alg1.l10.m1.1.1.2.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1a" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.4" xref="alg1.l10.m1.1.1.2.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1b" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.5" xref="alg1.l10.m1.1.1.2.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1c" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.6" xref="alg1.l10.m1.1.1.2.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1d" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.7" xref="alg1.l10.m1.1.1.2.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1e" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.8" xref="alg1.l10.m1.1.1.2.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l10.m1.1.1.2.3.1f" xref="alg1.l10.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l10.m1.1.1.2.3.9" xref="alg1.l10.m1.1.1.2.3.9.cmml">r</mi></mrow></msub><mo id="alg1.l10.m1.1.1.1" xref="alg1.l10.m1.1.1.1.cmml">&lt;</mo><msup id="alg1.l10.m1.1.1.3" xref="alg1.l10.m1.1.1.3.cmml"><mi id="alg1.l10.m1.1.1.3.2" xref="alg1.l10.m1.1.1.3.2.cmml">e</mi><mo id="alg1.l10.m1.1.1.3.3" xref="alg1.l10.m1.1.1.3.3.cmml">∗</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg1.l10.m1.1b"><apply id="alg1.l10.m1.1.1.cmml" xref="alg1.l10.m1.1.1"><lt id="alg1.l10.m1.1.1.1.cmml" xref="alg1.l10.m1.1.1.1"></lt><apply id="alg1.l10.m1.1.1.2.cmml" xref="alg1.l10.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.2.1.cmml" xref="alg1.l10.m1.1.1.2">subscript</csymbol><ci id="alg1.l10.m1.1.1.2.2.cmml" xref="alg1.l10.m1.1.1.2.2">𝑒</ci><apply id="alg1.l10.m1.1.1.2.3.cmml" xref="alg1.l10.m1.1.1.2.3"><times id="alg1.l10.m1.1.1.2.3.1.cmml" xref="alg1.l10.m1.1.1.2.3.1"></times><ci id="alg1.l10.m1.1.1.2.3.2.cmml" xref="alg1.l10.m1.1.1.2.3.2">𝑛</ci><ci id="alg1.l10.m1.1.1.2.3.3.cmml" xref="alg1.l10.m1.1.1.2.3.3">𝑒</ci><ci id="alg1.l10.m1.1.1.2.3.4.cmml" xref="alg1.l10.m1.1.1.2.3.4">𝑖</ci><ci id="alg1.l10.m1.1.1.2.3.5.cmml" xref="alg1.l10.m1.1.1.2.3.5">𝑔</ci><ci id="alg1.l10.m1.1.1.2.3.6.cmml" xref="alg1.l10.m1.1.1.2.3.6">ℎ</ci><ci id="alg1.l10.m1.1.1.2.3.7.cmml" xref="alg1.l10.m1.1.1.2.3.7">𝑏</ci><ci id="alg1.l10.m1.1.1.2.3.8.cmml" xref="alg1.l10.m1.1.1.2.3.8">𝑜</ci><ci id="alg1.l10.m1.1.1.2.3.9.cmml" xref="alg1.l10.m1.1.1.2.3.9">𝑟</ci></apply></apply><apply id="alg1.l10.m1.1.1.3.cmml" xref="alg1.l10.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.3.1.cmml" xref="alg1.l10.m1.1.1.3">superscript</csymbol><ci id="alg1.l10.m1.1.1.3.2.cmml" xref="alg1.l10.m1.1.1.3.2">𝑒</ci><times id="alg1.l10.m1.1.1.3.3.cmml" xref="alg1.l10.m1.1.1.3.3"></times></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m1.1c">e_{neighbor}&lt;e^{*}</annotation></semantics></math> <span id="alg1.l10.3" class="ltx_text ltx_font_bold">then</span>

</div>
<div id="alg1.l11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l11.1.1.1" class="ltx_text" style="font-size:80%;">11:</span></span>              <math id="alg1.l11.m1.1" class="ltx_Math" alttext="s^{*}\leftarrow s_{neighbor}" display="inline"><semantics id="alg1.l11.m1.1a"><mrow id="alg1.l11.m1.1.1" xref="alg1.l11.m1.1.1.cmml"><msup id="alg1.l11.m1.1.1.2" xref="alg1.l11.m1.1.1.2.cmml"><mi id="alg1.l11.m1.1.1.2.2" xref="alg1.l11.m1.1.1.2.2.cmml">s</mi><mo id="alg1.l11.m1.1.1.2.3" xref="alg1.l11.m1.1.1.2.3.cmml">∗</mo></msup><mo stretchy="false" id="alg1.l11.m1.1.1.1" xref="alg1.l11.m1.1.1.1.cmml">←</mo><msub id="alg1.l11.m1.1.1.3" xref="alg1.l11.m1.1.1.3.cmml"><mi id="alg1.l11.m1.1.1.3.2" xref="alg1.l11.m1.1.1.3.2.cmml">s</mi><mrow id="alg1.l11.m1.1.1.3.3" xref="alg1.l11.m1.1.1.3.3.cmml"><mi id="alg1.l11.m1.1.1.3.3.2" xref="alg1.l11.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.3" xref="alg1.l11.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1a" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.4" xref="alg1.l11.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1b" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.5" xref="alg1.l11.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1c" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.6" xref="alg1.l11.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1d" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.7" xref="alg1.l11.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1e" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.8" xref="alg1.l11.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l11.m1.1.1.3.3.1f" xref="alg1.l11.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l11.m1.1.1.3.3.9" xref="alg1.l11.m1.1.1.3.3.9.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l11.m1.1b"><apply id="alg1.l11.m1.1.1.cmml" xref="alg1.l11.m1.1.1"><ci id="alg1.l11.m1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1">←</ci><apply id="alg1.l11.m1.1.1.2.cmml" xref="alg1.l11.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.2.1.cmml" xref="alg1.l11.m1.1.1.2">superscript</csymbol><ci id="alg1.l11.m1.1.1.2.2.cmml" xref="alg1.l11.m1.1.1.2.2">𝑠</ci><times id="alg1.l11.m1.1.1.2.3.cmml" xref="alg1.l11.m1.1.1.2.3"></times></apply><apply id="alg1.l11.m1.1.1.3.cmml" xref="alg1.l11.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.3.1.cmml" xref="alg1.l11.m1.1.1.3">subscript</csymbol><ci id="alg1.l11.m1.1.1.3.2.cmml" xref="alg1.l11.m1.1.1.3.2">𝑠</ci><apply id="alg1.l11.m1.1.1.3.3.cmml" xref="alg1.l11.m1.1.1.3.3"><times id="alg1.l11.m1.1.1.3.3.1.cmml" xref="alg1.l11.m1.1.1.3.3.1"></times><ci id="alg1.l11.m1.1.1.3.3.2.cmml" xref="alg1.l11.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l11.m1.1.1.3.3.3.cmml" xref="alg1.l11.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l11.m1.1.1.3.3.4.cmml" xref="alg1.l11.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l11.m1.1.1.3.3.5.cmml" xref="alg1.l11.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l11.m1.1.1.3.3.6.cmml" xref="alg1.l11.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l11.m1.1.1.3.3.7.cmml" xref="alg1.l11.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l11.m1.1.1.3.3.8.cmml" xref="alg1.l11.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l11.m1.1.1.3.3.9.cmml" xref="alg1.l11.m1.1.1.3.3.9">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l11.m1.1c">s^{*}\leftarrow s_{neighbor}</annotation></semantics></math>

</div>
<div id="alg1.l12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l12.1.1.1" class="ltx_text" style="font-size:80%;">12:</span></span>              <math id="alg1.l12.m1.1" class="ltx_Math" alttext="e^{*}\leftarrow e_{neighbor}" display="inline"><semantics id="alg1.l12.m1.1a"><mrow id="alg1.l12.m1.1.1" xref="alg1.l12.m1.1.1.cmml"><msup id="alg1.l12.m1.1.1.2" xref="alg1.l12.m1.1.1.2.cmml"><mi id="alg1.l12.m1.1.1.2.2" xref="alg1.l12.m1.1.1.2.2.cmml">e</mi><mo id="alg1.l12.m1.1.1.2.3" xref="alg1.l12.m1.1.1.2.3.cmml">∗</mo></msup><mo stretchy="false" id="alg1.l12.m1.1.1.1" xref="alg1.l12.m1.1.1.1.cmml">←</mo><msub id="alg1.l12.m1.1.1.3" xref="alg1.l12.m1.1.1.3.cmml"><mi id="alg1.l12.m1.1.1.3.2" xref="alg1.l12.m1.1.1.3.2.cmml">e</mi><mrow id="alg1.l12.m1.1.1.3.3" xref="alg1.l12.m1.1.1.3.3.cmml"><mi id="alg1.l12.m1.1.1.3.3.2" xref="alg1.l12.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.3" xref="alg1.l12.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1a" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.4" xref="alg1.l12.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1b" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.5" xref="alg1.l12.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1c" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.6" xref="alg1.l12.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1d" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.7" xref="alg1.l12.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1e" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.8" xref="alg1.l12.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l12.m1.1.1.3.3.1f" xref="alg1.l12.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l12.m1.1.1.3.3.9" xref="alg1.l12.m1.1.1.3.3.9.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l12.m1.1b"><apply id="alg1.l12.m1.1.1.cmml" xref="alg1.l12.m1.1.1"><ci id="alg1.l12.m1.1.1.1.cmml" xref="alg1.l12.m1.1.1.1">←</ci><apply id="alg1.l12.m1.1.1.2.cmml" xref="alg1.l12.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l12.m1.1.1.2.1.cmml" xref="alg1.l12.m1.1.1.2">superscript</csymbol><ci id="alg1.l12.m1.1.1.2.2.cmml" xref="alg1.l12.m1.1.1.2.2">𝑒</ci><times id="alg1.l12.m1.1.1.2.3.cmml" xref="alg1.l12.m1.1.1.2.3"></times></apply><apply id="alg1.l12.m1.1.1.3.cmml" xref="alg1.l12.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l12.m1.1.1.3.1.cmml" xref="alg1.l12.m1.1.1.3">subscript</csymbol><ci id="alg1.l12.m1.1.1.3.2.cmml" xref="alg1.l12.m1.1.1.3.2">𝑒</ci><apply id="alg1.l12.m1.1.1.3.3.cmml" xref="alg1.l12.m1.1.1.3.3"><times id="alg1.l12.m1.1.1.3.3.1.cmml" xref="alg1.l12.m1.1.1.3.3.1"></times><ci id="alg1.l12.m1.1.1.3.3.2.cmml" xref="alg1.l12.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l12.m1.1.1.3.3.3.cmml" xref="alg1.l12.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l12.m1.1.1.3.3.4.cmml" xref="alg1.l12.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l12.m1.1.1.3.3.5.cmml" xref="alg1.l12.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l12.m1.1.1.3.3.6.cmml" xref="alg1.l12.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l12.m1.1.1.3.3.7.cmml" xref="alg1.l12.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l12.m1.1.1.3.3.8.cmml" xref="alg1.l12.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l12.m1.1.1.3.3.9.cmml" xref="alg1.l12.m1.1.1.3.3.9">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l12.m1.1c">e^{*}\leftarrow e_{neighbor}</annotation></semantics></math>
         
</div>
<div id="alg1.l13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l13.1.1.1" class="ltx_text" style="font-size:80%;">13:</span></span>         <span id="alg1.l13.2" class="ltx_text ltx_font_bold">if</span> <math id="alg1.l13.m1.5" class="ltx_Math" alttext="P(e_{current},e_{neighbor},T)&gt;Rand(0,1)" display="inline"><semantics id="alg1.l13.m1.5a"><mrow id="alg1.l13.m1.5.5" xref="alg1.l13.m1.5.5.cmml"><mrow id="alg1.l13.m1.5.5.2" xref="alg1.l13.m1.5.5.2.cmml"><mi id="alg1.l13.m1.5.5.2.4" xref="alg1.l13.m1.5.5.2.4.cmml">P</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.3" xref="alg1.l13.m1.5.5.2.3.cmml">​</mo><mrow id="alg1.l13.m1.5.5.2.2.2" xref="alg1.l13.m1.5.5.2.2.3.cmml"><mo stretchy="false" id="alg1.l13.m1.5.5.2.2.2.3" xref="alg1.l13.m1.5.5.2.2.3.cmml">(</mo><msub id="alg1.l13.m1.4.4.1.1.1.1" xref="alg1.l13.m1.4.4.1.1.1.1.cmml"><mi id="alg1.l13.m1.4.4.1.1.1.1.2" xref="alg1.l13.m1.4.4.1.1.1.1.2.cmml">e</mi><mrow id="alg1.l13.m1.4.4.1.1.1.1.3" xref="alg1.l13.m1.4.4.1.1.1.1.3.cmml"><mi id="alg1.l13.m1.4.4.1.1.1.1.3.2" xref="alg1.l13.m1.4.4.1.1.1.1.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.3" xref="alg1.l13.m1.4.4.1.1.1.1.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1a" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.4" xref="alg1.l13.m1.4.4.1.1.1.1.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1b" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.5" xref="alg1.l13.m1.4.4.1.1.1.1.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1c" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.6" xref="alg1.l13.m1.4.4.1.1.1.1.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1d" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.7" xref="alg1.l13.m1.4.4.1.1.1.1.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.4.4.1.1.1.1.3.1e" xref="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml">​</mo><mi id="alg1.l13.m1.4.4.1.1.1.1.3.8" xref="alg1.l13.m1.4.4.1.1.1.1.3.8.cmml">t</mi></mrow></msub><mo id="alg1.l13.m1.5.5.2.2.2.4" xref="alg1.l13.m1.5.5.2.2.3.cmml">,</mo><msub id="alg1.l13.m1.5.5.2.2.2.2" xref="alg1.l13.m1.5.5.2.2.2.2.cmml"><mi id="alg1.l13.m1.5.5.2.2.2.2.2" xref="alg1.l13.m1.5.5.2.2.2.2.2.cmml">e</mi><mrow id="alg1.l13.m1.5.5.2.2.2.2.3" xref="alg1.l13.m1.5.5.2.2.2.2.3.cmml"><mi id="alg1.l13.m1.5.5.2.2.2.2.3.2" xref="alg1.l13.m1.5.5.2.2.2.2.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.3" xref="alg1.l13.m1.5.5.2.2.2.2.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1a" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.4" xref="alg1.l13.m1.5.5.2.2.2.2.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1b" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.5" xref="alg1.l13.m1.5.5.2.2.2.2.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1c" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.6" xref="alg1.l13.m1.5.5.2.2.2.2.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1d" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.7" xref="alg1.l13.m1.5.5.2.2.2.2.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1e" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.8" xref="alg1.l13.m1.5.5.2.2.2.2.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.2.2.2.2.3.1f" xref="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.2.2.2.2.3.9" xref="alg1.l13.m1.5.5.2.2.2.2.3.9.cmml">r</mi></mrow></msub><mo id="alg1.l13.m1.5.5.2.2.2.5" xref="alg1.l13.m1.5.5.2.2.3.cmml">,</mo><mi id="alg1.l13.m1.1.1" xref="alg1.l13.m1.1.1.cmml">T</mi><mo stretchy="false" id="alg1.l13.m1.5.5.2.2.2.6" xref="alg1.l13.m1.5.5.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg1.l13.m1.5.5.3" xref="alg1.l13.m1.5.5.3.cmml">&gt;</mo><mrow id="alg1.l13.m1.5.5.4" xref="alg1.l13.m1.5.5.4.cmml"><mi id="alg1.l13.m1.5.5.4.2" xref="alg1.l13.m1.5.5.4.2.cmml">R</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.4.1" xref="alg1.l13.m1.5.5.4.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.4.3" xref="alg1.l13.m1.5.5.4.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.4.1a" xref="alg1.l13.m1.5.5.4.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.4.4" xref="alg1.l13.m1.5.5.4.4.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.4.1b" xref="alg1.l13.m1.5.5.4.1.cmml">​</mo><mi id="alg1.l13.m1.5.5.4.5" xref="alg1.l13.m1.5.5.4.5.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg1.l13.m1.5.5.4.1c" xref="alg1.l13.m1.5.5.4.1.cmml">​</mo><mrow id="alg1.l13.m1.5.5.4.6.2" xref="alg1.l13.m1.5.5.4.6.1.cmml"><mo stretchy="false" id="alg1.l13.m1.5.5.4.6.2.1" xref="alg1.l13.m1.5.5.4.6.1.cmml">(</mo><mn id="alg1.l13.m1.2.2" xref="alg1.l13.m1.2.2.cmml">0</mn><mo id="alg1.l13.m1.5.5.4.6.2.2" xref="alg1.l13.m1.5.5.4.6.1.cmml">,</mo><mn id="alg1.l13.m1.3.3" xref="alg1.l13.m1.3.3.cmml">1</mn><mo stretchy="false" id="alg1.l13.m1.5.5.4.6.2.3" xref="alg1.l13.m1.5.5.4.6.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l13.m1.5b"><apply id="alg1.l13.m1.5.5.cmml" xref="alg1.l13.m1.5.5"><gt id="alg1.l13.m1.5.5.3.cmml" xref="alg1.l13.m1.5.5.3"></gt><apply id="alg1.l13.m1.5.5.2.cmml" xref="alg1.l13.m1.5.5.2"><times id="alg1.l13.m1.5.5.2.3.cmml" xref="alg1.l13.m1.5.5.2.3"></times><ci id="alg1.l13.m1.5.5.2.4.cmml" xref="alg1.l13.m1.5.5.2.4">𝑃</ci><vector id="alg1.l13.m1.5.5.2.2.3.cmml" xref="alg1.l13.m1.5.5.2.2.2"><apply id="alg1.l13.m1.4.4.1.1.1.1.cmml" xref="alg1.l13.m1.4.4.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l13.m1.4.4.1.1.1.1.1.cmml" xref="alg1.l13.m1.4.4.1.1.1.1">subscript</csymbol><ci id="alg1.l13.m1.4.4.1.1.1.1.2.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.2">𝑒</ci><apply id="alg1.l13.m1.4.4.1.1.1.1.3.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3"><times id="alg1.l13.m1.4.4.1.1.1.1.3.1.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.1"></times><ci id="alg1.l13.m1.4.4.1.1.1.1.3.2.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.2">𝑐</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.3.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.3">𝑢</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.4.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.4">𝑟</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.5.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.5">𝑟</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.6.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.6">𝑒</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.7.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.7">𝑛</ci><ci id="alg1.l13.m1.4.4.1.1.1.1.3.8.cmml" xref="alg1.l13.m1.4.4.1.1.1.1.3.8">𝑡</ci></apply></apply><apply id="alg1.l13.m1.5.5.2.2.2.2.cmml" xref="alg1.l13.m1.5.5.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l13.m1.5.5.2.2.2.2.1.cmml" xref="alg1.l13.m1.5.5.2.2.2.2">subscript</csymbol><ci id="alg1.l13.m1.5.5.2.2.2.2.2.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.2">𝑒</ci><apply id="alg1.l13.m1.5.5.2.2.2.2.3.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3"><times id="alg1.l13.m1.5.5.2.2.2.2.3.1.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.1"></times><ci id="alg1.l13.m1.5.5.2.2.2.2.3.2.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.2">𝑛</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.3.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.3">𝑒</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.4.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.4">𝑖</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.5.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.5">𝑔</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.6.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.6">ℎ</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.7.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.7">𝑏</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.8.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.8">𝑜</ci><ci id="alg1.l13.m1.5.5.2.2.2.2.3.9.cmml" xref="alg1.l13.m1.5.5.2.2.2.2.3.9">𝑟</ci></apply></apply><ci id="alg1.l13.m1.1.1.cmml" xref="alg1.l13.m1.1.1">𝑇</ci></vector></apply><apply id="alg1.l13.m1.5.5.4.cmml" xref="alg1.l13.m1.5.5.4"><times id="alg1.l13.m1.5.5.4.1.cmml" xref="alg1.l13.m1.5.5.4.1"></times><ci id="alg1.l13.m1.5.5.4.2.cmml" xref="alg1.l13.m1.5.5.4.2">𝑅</ci><ci id="alg1.l13.m1.5.5.4.3.cmml" xref="alg1.l13.m1.5.5.4.3">𝑎</ci><ci id="alg1.l13.m1.5.5.4.4.cmml" xref="alg1.l13.m1.5.5.4.4">𝑛</ci><ci id="alg1.l13.m1.5.5.4.5.cmml" xref="alg1.l13.m1.5.5.4.5">𝑑</ci><interval closure="open" id="alg1.l13.m1.5.5.4.6.1.cmml" xref="alg1.l13.m1.5.5.4.6.2"><cn type="integer" id="alg1.l13.m1.2.2.cmml" xref="alg1.l13.m1.2.2">0</cn><cn type="integer" id="alg1.l13.m1.3.3.cmml" xref="alg1.l13.m1.3.3">1</cn></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l13.m1.5c">P(e_{current},e_{neighbor},T)&gt;Rand(0,1)</annotation></semantics></math> <span id="alg1.l13.3" class="ltx_text ltx_font_bold">then</span>

</div>
<div id="alg1.l14" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l14.1.1.1" class="ltx_text" style="font-size:80%;">14:</span></span>              <math id="alg1.l14.m1.1" class="ltx_Math" alttext="s_{current}\leftarrow s_{neighbor}" display="inline"><semantics id="alg1.l14.m1.1a"><mrow id="alg1.l14.m1.1.1" xref="alg1.l14.m1.1.1.cmml"><msub id="alg1.l14.m1.1.1.2" xref="alg1.l14.m1.1.1.2.cmml"><mi id="alg1.l14.m1.1.1.2.2" xref="alg1.l14.m1.1.1.2.2.cmml">s</mi><mrow id="alg1.l14.m1.1.1.2.3" xref="alg1.l14.m1.1.1.2.3.cmml"><mi id="alg1.l14.m1.1.1.2.3.2" xref="alg1.l14.m1.1.1.2.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.3" xref="alg1.l14.m1.1.1.2.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1a" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.4" xref="alg1.l14.m1.1.1.2.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1b" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.5" xref="alg1.l14.m1.1.1.2.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1c" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.6" xref="alg1.l14.m1.1.1.2.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1d" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.7" xref="alg1.l14.m1.1.1.2.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.2.3.1e" xref="alg1.l14.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.2.3.8" xref="alg1.l14.m1.1.1.2.3.8.cmml">t</mi></mrow></msub><mo stretchy="false" id="alg1.l14.m1.1.1.1" xref="alg1.l14.m1.1.1.1.cmml">←</mo><msub id="alg1.l14.m1.1.1.3" xref="alg1.l14.m1.1.1.3.cmml"><mi id="alg1.l14.m1.1.1.3.2" xref="alg1.l14.m1.1.1.3.2.cmml">s</mi><mrow id="alg1.l14.m1.1.1.3.3" xref="alg1.l14.m1.1.1.3.3.cmml"><mi id="alg1.l14.m1.1.1.3.3.2" xref="alg1.l14.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.3" xref="alg1.l14.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1a" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.4" xref="alg1.l14.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1b" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.5" xref="alg1.l14.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1c" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.6" xref="alg1.l14.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1d" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.7" xref="alg1.l14.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1e" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.8" xref="alg1.l14.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l14.m1.1.1.3.3.1f" xref="alg1.l14.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l14.m1.1.1.3.3.9" xref="alg1.l14.m1.1.1.3.3.9.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l14.m1.1b"><apply id="alg1.l14.m1.1.1.cmml" xref="alg1.l14.m1.1.1"><ci id="alg1.l14.m1.1.1.1.cmml" xref="alg1.l14.m1.1.1.1">←</ci><apply id="alg1.l14.m1.1.1.2.cmml" xref="alg1.l14.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l14.m1.1.1.2.1.cmml" xref="alg1.l14.m1.1.1.2">subscript</csymbol><ci id="alg1.l14.m1.1.1.2.2.cmml" xref="alg1.l14.m1.1.1.2.2">𝑠</ci><apply id="alg1.l14.m1.1.1.2.3.cmml" xref="alg1.l14.m1.1.1.2.3"><times id="alg1.l14.m1.1.1.2.3.1.cmml" xref="alg1.l14.m1.1.1.2.3.1"></times><ci id="alg1.l14.m1.1.1.2.3.2.cmml" xref="alg1.l14.m1.1.1.2.3.2">𝑐</ci><ci id="alg1.l14.m1.1.1.2.3.3.cmml" xref="alg1.l14.m1.1.1.2.3.3">𝑢</ci><ci id="alg1.l14.m1.1.1.2.3.4.cmml" xref="alg1.l14.m1.1.1.2.3.4">𝑟</ci><ci id="alg1.l14.m1.1.1.2.3.5.cmml" xref="alg1.l14.m1.1.1.2.3.5">𝑟</ci><ci id="alg1.l14.m1.1.1.2.3.6.cmml" xref="alg1.l14.m1.1.1.2.3.6">𝑒</ci><ci id="alg1.l14.m1.1.1.2.3.7.cmml" xref="alg1.l14.m1.1.1.2.3.7">𝑛</ci><ci id="alg1.l14.m1.1.1.2.3.8.cmml" xref="alg1.l14.m1.1.1.2.3.8">𝑡</ci></apply></apply><apply id="alg1.l14.m1.1.1.3.cmml" xref="alg1.l14.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l14.m1.1.1.3.1.cmml" xref="alg1.l14.m1.1.1.3">subscript</csymbol><ci id="alg1.l14.m1.1.1.3.2.cmml" xref="alg1.l14.m1.1.1.3.2">𝑠</ci><apply id="alg1.l14.m1.1.1.3.3.cmml" xref="alg1.l14.m1.1.1.3.3"><times id="alg1.l14.m1.1.1.3.3.1.cmml" xref="alg1.l14.m1.1.1.3.3.1"></times><ci id="alg1.l14.m1.1.1.3.3.2.cmml" xref="alg1.l14.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l14.m1.1.1.3.3.3.cmml" xref="alg1.l14.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l14.m1.1.1.3.3.4.cmml" xref="alg1.l14.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l14.m1.1.1.3.3.5.cmml" xref="alg1.l14.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l14.m1.1.1.3.3.6.cmml" xref="alg1.l14.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l14.m1.1.1.3.3.7.cmml" xref="alg1.l14.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l14.m1.1.1.3.3.8.cmml" xref="alg1.l14.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l14.m1.1.1.3.3.9.cmml" xref="alg1.l14.m1.1.1.3.3.9">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l14.m1.1c">s_{current}\leftarrow s_{neighbor}</annotation></semantics></math>

</div>
<div id="alg1.l15" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l15.1.1.1" class="ltx_text" style="font-size:80%;">15:</span></span>              <math id="alg1.l15.m1.1" class="ltx_Math" alttext="e_{current}\leftarrow e_{neighbor}" display="inline"><semantics id="alg1.l15.m1.1a"><mrow id="alg1.l15.m1.1.1" xref="alg1.l15.m1.1.1.cmml"><msub id="alg1.l15.m1.1.1.2" xref="alg1.l15.m1.1.1.2.cmml"><mi id="alg1.l15.m1.1.1.2.2" xref="alg1.l15.m1.1.1.2.2.cmml">e</mi><mrow id="alg1.l15.m1.1.1.2.3" xref="alg1.l15.m1.1.1.2.3.cmml"><mi id="alg1.l15.m1.1.1.2.3.2" xref="alg1.l15.m1.1.1.2.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.3" xref="alg1.l15.m1.1.1.2.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1a" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.4" xref="alg1.l15.m1.1.1.2.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1b" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.5" xref="alg1.l15.m1.1.1.2.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1c" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.6" xref="alg1.l15.m1.1.1.2.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1d" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.7" xref="alg1.l15.m1.1.1.2.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.2.3.1e" xref="alg1.l15.m1.1.1.2.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.2.3.8" xref="alg1.l15.m1.1.1.2.3.8.cmml">t</mi></mrow></msub><mo stretchy="false" id="alg1.l15.m1.1.1.1" xref="alg1.l15.m1.1.1.1.cmml">←</mo><msub id="alg1.l15.m1.1.1.3" xref="alg1.l15.m1.1.1.3.cmml"><mi id="alg1.l15.m1.1.1.3.2" xref="alg1.l15.m1.1.1.3.2.cmml">e</mi><mrow id="alg1.l15.m1.1.1.3.3" xref="alg1.l15.m1.1.1.3.3.cmml"><mi id="alg1.l15.m1.1.1.3.3.2" xref="alg1.l15.m1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.3" xref="alg1.l15.m1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1a" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.4" xref="alg1.l15.m1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1b" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.5" xref="alg1.l15.m1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1c" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.6" xref="alg1.l15.m1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1d" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.7" xref="alg1.l15.m1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1e" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.8" xref="alg1.l15.m1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg1.l15.m1.1.1.3.3.1f" xref="alg1.l15.m1.1.1.3.3.1.cmml">​</mo><mi id="alg1.l15.m1.1.1.3.3.9" xref="alg1.l15.m1.1.1.3.3.9.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l15.m1.1b"><apply id="alg1.l15.m1.1.1.cmml" xref="alg1.l15.m1.1.1"><ci id="alg1.l15.m1.1.1.1.cmml" xref="alg1.l15.m1.1.1.1">←</ci><apply id="alg1.l15.m1.1.1.2.cmml" xref="alg1.l15.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l15.m1.1.1.2.1.cmml" xref="alg1.l15.m1.1.1.2">subscript</csymbol><ci id="alg1.l15.m1.1.1.2.2.cmml" xref="alg1.l15.m1.1.1.2.2">𝑒</ci><apply id="alg1.l15.m1.1.1.2.3.cmml" xref="alg1.l15.m1.1.1.2.3"><times id="alg1.l15.m1.1.1.2.3.1.cmml" xref="alg1.l15.m1.1.1.2.3.1"></times><ci id="alg1.l15.m1.1.1.2.3.2.cmml" xref="alg1.l15.m1.1.1.2.3.2">𝑐</ci><ci id="alg1.l15.m1.1.1.2.3.3.cmml" xref="alg1.l15.m1.1.1.2.3.3">𝑢</ci><ci id="alg1.l15.m1.1.1.2.3.4.cmml" xref="alg1.l15.m1.1.1.2.3.4">𝑟</ci><ci id="alg1.l15.m1.1.1.2.3.5.cmml" xref="alg1.l15.m1.1.1.2.3.5">𝑟</ci><ci id="alg1.l15.m1.1.1.2.3.6.cmml" xref="alg1.l15.m1.1.1.2.3.6">𝑒</ci><ci id="alg1.l15.m1.1.1.2.3.7.cmml" xref="alg1.l15.m1.1.1.2.3.7">𝑛</ci><ci id="alg1.l15.m1.1.1.2.3.8.cmml" xref="alg1.l15.m1.1.1.2.3.8">𝑡</ci></apply></apply><apply id="alg1.l15.m1.1.1.3.cmml" xref="alg1.l15.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l15.m1.1.1.3.1.cmml" xref="alg1.l15.m1.1.1.3">subscript</csymbol><ci id="alg1.l15.m1.1.1.3.2.cmml" xref="alg1.l15.m1.1.1.3.2">𝑒</ci><apply id="alg1.l15.m1.1.1.3.3.cmml" xref="alg1.l15.m1.1.1.3.3"><times id="alg1.l15.m1.1.1.3.3.1.cmml" xref="alg1.l15.m1.1.1.3.3.1"></times><ci id="alg1.l15.m1.1.1.3.3.2.cmml" xref="alg1.l15.m1.1.1.3.3.2">𝑛</ci><ci id="alg1.l15.m1.1.1.3.3.3.cmml" xref="alg1.l15.m1.1.1.3.3.3">𝑒</ci><ci id="alg1.l15.m1.1.1.3.3.4.cmml" xref="alg1.l15.m1.1.1.3.3.4">𝑖</ci><ci id="alg1.l15.m1.1.1.3.3.5.cmml" xref="alg1.l15.m1.1.1.3.3.5">𝑔</ci><ci id="alg1.l15.m1.1.1.3.3.6.cmml" xref="alg1.l15.m1.1.1.3.3.6">ℎ</ci><ci id="alg1.l15.m1.1.1.3.3.7.cmml" xref="alg1.l15.m1.1.1.3.3.7">𝑏</ci><ci id="alg1.l15.m1.1.1.3.3.8.cmml" xref="alg1.l15.m1.1.1.3.3.8">𝑜</ci><ci id="alg1.l15.m1.1.1.3.3.9.cmml" xref="alg1.l15.m1.1.1.3.3.9">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l15.m1.1c">e_{current}\leftarrow e_{neighbor}</annotation></semantics></math>
         
</div>
<div id="alg1.l16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l16.1.1.1" class="ltx_text" style="font-size:80%;">16:</span></span>         <math id="alg1.l16.m1.1" class="ltx_Math" alttext="T\leftarrow T\times\alpha" display="inline"><semantics id="alg1.l16.m1.1a"><mrow id="alg1.l16.m1.1.1" xref="alg1.l16.m1.1.1.cmml"><mi id="alg1.l16.m1.1.1.2" xref="alg1.l16.m1.1.1.2.cmml">T</mi><mo stretchy="false" id="alg1.l16.m1.1.1.1" xref="alg1.l16.m1.1.1.1.cmml">←</mo><mrow id="alg1.l16.m1.1.1.3" xref="alg1.l16.m1.1.1.3.cmml"><mi id="alg1.l16.m1.1.1.3.2" xref="alg1.l16.m1.1.1.3.2.cmml">T</mi><mo lspace="0.222em" rspace="0.222em" id="alg1.l16.m1.1.1.3.1" xref="alg1.l16.m1.1.1.3.1.cmml">×</mo><mi id="alg1.l16.m1.1.1.3.3" xref="alg1.l16.m1.1.1.3.3.cmml">α</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l16.m1.1b"><apply id="alg1.l16.m1.1.1.cmml" xref="alg1.l16.m1.1.1"><ci id="alg1.l16.m1.1.1.1.cmml" xref="alg1.l16.m1.1.1.1">←</ci><ci id="alg1.l16.m1.1.1.2.cmml" xref="alg1.l16.m1.1.1.2">𝑇</ci><apply id="alg1.l16.m1.1.1.3.cmml" xref="alg1.l16.m1.1.1.3"><times id="alg1.l16.m1.1.1.3.1.cmml" xref="alg1.l16.m1.1.1.3.1"></times><ci id="alg1.l16.m1.1.1.3.2.cmml" xref="alg1.l16.m1.1.1.3.2">𝑇</ci><ci id="alg1.l16.m1.1.1.3.3.cmml" xref="alg1.l16.m1.1.1.3.3">𝛼</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l16.m1.1c">T\leftarrow T\times\alpha</annotation></semantics></math>
     
</div>
<div id="alg1.l17" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg1.l17.1.1.1" class="ltx_text" style="font-size:80%;">17:</span></span>     <span id="alg1.l17.2" class="ltx_text ltx_font_bold">return</span> <math id="alg1.l17.m1.1" class="ltx_Math" alttext="s^{*}" display="inline"><semantics id="alg1.l17.m1.1a"><msup id="alg1.l17.m1.1.1" xref="alg1.l17.m1.1.1.cmml"><mi id="alg1.l17.m1.1.1.2" xref="alg1.l17.m1.1.1.2.cmml">s</mi><mo id="alg1.l17.m1.1.1.3" xref="alg1.l17.m1.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="alg1.l17.m1.1b"><apply id="alg1.l17.m1.1.1.cmml" xref="alg1.l17.m1.1.1"><csymbol cd="ambiguous" id="alg1.l17.m1.1.1.1.cmml" xref="alg1.l17.m1.1.1">superscript</csymbol><ci id="alg1.l17.m1.1.1.2.cmml" xref="alg1.l17.m1.1.1.2">𝑠</ci><times id="alg1.l17.m1.1.1.3.cmml" xref="alg1.l17.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l17.m1.1c">s^{*}</annotation></semantics></math>

</div>
</div>
</figure>
<div id="S5.SS2.p3" class="ltx_para ltx_noindent">
<p id="S5.SS2.p3.1" class="ltx_p"><span id="S5.SS2.p3.1.1" class="ltx_text ltx_font_bold">Algorithm overview:</span> The problem has many constraints and variables.
It can be reduced to a special case of flow job scheduling problem which
proves to be NP-hard <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib29" title="" class="ltx_ref">29</a>]</cite>.
A naive solution is to greedily fuse the 1F1B schedules of two models
with the bi-directional pipeline, which always schedules feasible micro-batches.
If the micro-batches of two models are both ready, it favors the larger model,
with the expectation that the smaller one can flexibly fill in the bubbles later.
However, the greedy method lacks a global perspective. For example,
certain micro-batches could be deliberately delayed to fill the bubbles
later. Moreover, it provides no optimization for memory usage.
Thus, the greedy approach does not yield optimal performance,
as we will demonstrate in §<a href="#S7.SS3" title="7.3 Effectiveness of Stage Fusion ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.3</span></a>.</p>
</div>
<div id="S5.SS2.p4" class="ltx_para">
<p id="S5.SS2.p4.1" class="ltx_p">Instead, we use simulated annealing <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib30" title="" class="ltx_ref">30</a>]</cite> to search for a better solution.
The motivation for using simulated annealing is that we have a huge search space
with many variables. Simulated annealing is effective in finding acceptable
local optimums in a reasonable amount of time while finding the global optimum
is computationally expensive.
Furthermore, we will show that our method can achieve
the theoretical lower bound most of the time as shown in §<a href="#S7.SS3" title="7.3 Effectiveness of Stage Fusion ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.3</span></a>.</p>
</div>
<div id="S5.SS2.p5" class="ltx_para">
<p id="S5.SS2.p5.1" class="ltx_p">At a high level, we use the fused pipeline schedule <math id="S5.SS2.p5.1.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p5.1.m1.1a"><mi id="S5.SS2.p5.1.m1.1.1" xref="S5.SS2.p5.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p5.1.m1.1b"><ci id="S5.SS2.p5.1.m1.1.1.cmml" xref="S5.SS2.p5.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p5.1.m1.1c">S</annotation></semantics></math> as the state in simulated
annealing. We use the schedule found by the greedy algorithm mentioned above as the
initial state and probabilistically jump to a neighbor state in each iteration,
aiming to find a schedule with the lowest latency.
Our approach has two benefits. First, it is easy to scale out. We can perform searching using different random seeds across
hundreds of CPU cores and select the best result among them. Second,
it can easily extend to more models, which arises in multimodal <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib31" title="" class="ltx_ref">31</a>]</cite>
and multi-agent <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib32" title="" class="ltx_ref">32</a>]</cite> training scenarios.
Now we describe the algorithm in more detail below.</p>
</div>
<figure id="alg2" class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="alg2.2.1.1" class="ltx_text ltx_font_bold">Algorithm 2</span> </span> Generate A Random Neighbor Schedule.</figcaption>
<div id="alg2.3" class="ltx_listing ltx_listing">
<div id="alg2.l1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l1.1.1.1" class="ltx_text" style="font-size:80%;">1:</span></span><span id="alg2.l1.2" class="ltx_text ltx_font_bold">function</span> <span id="alg2.l1.3" class="ltx_text ltx_font_smallcaps">ComputeNeighbor</span>(<math id="alg2.l1.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="alg2.l1.m1.1a"><mi id="alg2.l1.m1.1.1" xref="alg2.l1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg2.l1.m1.1b"><ci id="alg2.l1.m1.1.1.cmml" xref="alg2.l1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m1.1c">S</annotation></semantics></math>)

</div>
<div id="alg2.l2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l2.1.1.1" class="ltx_text" style="font-size:80%;">2:</span></span>     <span id="alg2.l2.2" class="ltx_text ltx_font_bold">while</span> <math id="alg2.l2.m1.1" class="ltx_Math" alttext="True" display="inline"><semantics id="alg2.l2.m1.1a"><mrow id="alg2.l2.m1.1.1" xref="alg2.l2.m1.1.1.cmml"><mi id="alg2.l2.m1.1.1.2" xref="alg2.l2.m1.1.1.2.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg2.l2.m1.1.1.1" xref="alg2.l2.m1.1.1.1.cmml">​</mo><mi id="alg2.l2.m1.1.1.3" xref="alg2.l2.m1.1.1.3.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg2.l2.m1.1.1.1a" xref="alg2.l2.m1.1.1.1.cmml">​</mo><mi id="alg2.l2.m1.1.1.4" xref="alg2.l2.m1.1.1.4.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg2.l2.m1.1.1.1b" xref="alg2.l2.m1.1.1.1.cmml">​</mo><mi id="alg2.l2.m1.1.1.5" xref="alg2.l2.m1.1.1.5.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l2.m1.1b"><apply id="alg2.l2.m1.1.1.cmml" xref="alg2.l2.m1.1.1"><times id="alg2.l2.m1.1.1.1.cmml" xref="alg2.l2.m1.1.1.1"></times><ci id="alg2.l2.m1.1.1.2.cmml" xref="alg2.l2.m1.1.1.2">𝑇</ci><ci id="alg2.l2.m1.1.1.3.cmml" xref="alg2.l2.m1.1.1.3">𝑟</ci><ci id="alg2.l2.m1.1.1.4.cmml" xref="alg2.l2.m1.1.1.4">𝑢</ci><ci id="alg2.l2.m1.1.1.5.cmml" xref="alg2.l2.m1.1.1.5">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l2.m1.1c">True</annotation></semantics></math> <span id="alg2.l2.3" class="ltx_text ltx_font_bold">do</span>

</div>
<div id="alg2.l3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l3.1.1.1" class="ltx_text" style="font-size:80%;">3:</span></span>         <math id="alg2.l3.m1.2" class="ltx_Math" alttext="i\leftarrow RandInt(1,N)" display="inline"><semantics id="alg2.l3.m1.2a"><mrow id="alg2.l3.m1.2.3" xref="alg2.l3.m1.2.3.cmml"><mi id="alg2.l3.m1.2.3.2" xref="alg2.l3.m1.2.3.2.cmml">i</mi><mo stretchy="false" id="alg2.l3.m1.2.3.1" xref="alg2.l3.m1.2.3.1.cmml">←</mo><mrow id="alg2.l3.m1.2.3.3" xref="alg2.l3.m1.2.3.3.cmml"><mi id="alg2.l3.m1.2.3.3.2" xref="alg2.l3.m1.2.3.3.2.cmml">R</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.3" xref="alg2.l3.m1.2.3.3.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1a" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.4" xref="alg2.l3.m1.2.3.3.4.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1b" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.5" xref="alg2.l3.m1.2.3.3.5.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1c" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.6" xref="alg2.l3.m1.2.3.3.6.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1d" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.7" xref="alg2.l3.m1.2.3.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1e" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mi id="alg2.l3.m1.2.3.3.8" xref="alg2.l3.m1.2.3.3.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg2.l3.m1.2.3.3.1f" xref="alg2.l3.m1.2.3.3.1.cmml">​</mo><mrow id="alg2.l3.m1.2.3.3.9.2" xref="alg2.l3.m1.2.3.3.9.1.cmml"><mo stretchy="false" id="alg2.l3.m1.2.3.3.9.2.1" xref="alg2.l3.m1.2.3.3.9.1.cmml">(</mo><mn id="alg2.l3.m1.1.1" xref="alg2.l3.m1.1.1.cmml">1</mn><mo id="alg2.l3.m1.2.3.3.9.2.2" xref="alg2.l3.m1.2.3.3.9.1.cmml">,</mo><mi id="alg2.l3.m1.2.2" xref="alg2.l3.m1.2.2.cmml">N</mi><mo stretchy="false" id="alg2.l3.m1.2.3.3.9.2.3" xref="alg2.l3.m1.2.3.3.9.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l3.m1.2b"><apply id="alg2.l3.m1.2.3.cmml" xref="alg2.l3.m1.2.3"><ci id="alg2.l3.m1.2.3.1.cmml" xref="alg2.l3.m1.2.3.1">←</ci><ci id="alg2.l3.m1.2.3.2.cmml" xref="alg2.l3.m1.2.3.2">𝑖</ci><apply id="alg2.l3.m1.2.3.3.cmml" xref="alg2.l3.m1.2.3.3"><times id="alg2.l3.m1.2.3.3.1.cmml" xref="alg2.l3.m1.2.3.3.1"></times><ci id="alg2.l3.m1.2.3.3.2.cmml" xref="alg2.l3.m1.2.3.3.2">𝑅</ci><ci id="alg2.l3.m1.2.3.3.3.cmml" xref="alg2.l3.m1.2.3.3.3">𝑎</ci><ci id="alg2.l3.m1.2.3.3.4.cmml" xref="alg2.l3.m1.2.3.3.4">𝑛</ci><ci id="alg2.l3.m1.2.3.3.5.cmml" xref="alg2.l3.m1.2.3.3.5">𝑑</ci><ci id="alg2.l3.m1.2.3.3.6.cmml" xref="alg2.l3.m1.2.3.3.6">𝐼</ci><ci id="alg2.l3.m1.2.3.3.7.cmml" xref="alg2.l3.m1.2.3.3.7">𝑛</ci><ci id="alg2.l3.m1.2.3.3.8.cmml" xref="alg2.l3.m1.2.3.3.8">𝑡</ci><interval closure="open" id="alg2.l3.m1.2.3.3.9.1.cmml" xref="alg2.l3.m1.2.3.3.9.2"><cn type="integer" id="alg2.l3.m1.1.1.cmml" xref="alg2.l3.m1.1.1">1</cn><ci id="alg2.l3.m1.2.2.cmml" xref="alg2.l3.m1.2.2">𝑁</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3.m1.2c">i\leftarrow RandInt(1,N)</annotation></semantics></math>

</div>
<div id="alg2.l4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l4.1.1.1" class="ltx_text" style="font-size:80%;">4:</span></span>         <math id="alg2.l4.m1.2" class="ltx_Math" alttext="j\leftarrow RandInt(1,2(M_{1}+M_{2})-1)" display="inline"><semantics id="alg2.l4.m1.2a"><mrow id="alg2.l4.m1.2.2" xref="alg2.l4.m1.2.2.cmml"><mi id="alg2.l4.m1.2.2.3" xref="alg2.l4.m1.2.2.3.cmml">j</mi><mo stretchy="false" id="alg2.l4.m1.2.2.2" xref="alg2.l4.m1.2.2.2.cmml">←</mo><mrow id="alg2.l4.m1.2.2.1" xref="alg2.l4.m1.2.2.1.cmml"><mi id="alg2.l4.m1.2.2.1.3" xref="alg2.l4.m1.2.2.1.3.cmml">R</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.4" xref="alg2.l4.m1.2.2.1.4.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2a" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.5" xref="alg2.l4.m1.2.2.1.5.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2b" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.6" xref="alg2.l4.m1.2.2.1.6.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2c" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.7" xref="alg2.l4.m1.2.2.1.7.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2d" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.8" xref="alg2.l4.m1.2.2.1.8.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2e" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mi id="alg2.l4.m1.2.2.1.9" xref="alg2.l4.m1.2.2.1.9.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.2f" xref="alg2.l4.m1.2.2.1.2.cmml">​</mo><mrow id="alg2.l4.m1.2.2.1.1.1" xref="alg2.l4.m1.2.2.1.1.2.cmml"><mo stretchy="false" id="alg2.l4.m1.2.2.1.1.1.2" xref="alg2.l4.m1.2.2.1.1.2.cmml">(</mo><mn id="alg2.l4.m1.1.1" xref="alg2.l4.m1.1.1.cmml">1</mn><mo id="alg2.l4.m1.2.2.1.1.1.3" xref="alg2.l4.m1.2.2.1.1.2.cmml">,</mo><mrow id="alg2.l4.m1.2.2.1.1.1.1" xref="alg2.l4.m1.2.2.1.1.1.1.cmml"><mrow id="alg2.l4.m1.2.2.1.1.1.1.1" xref="alg2.l4.m1.2.2.1.1.1.1.1.cmml"><mn id="alg2.l4.m1.2.2.1.1.1.1.1.3" xref="alg2.l4.m1.2.2.1.1.1.1.1.3.cmml">2</mn><mo lspace="0em" rspace="0em" id="alg2.l4.m1.2.2.1.1.1.1.1.2" xref="alg2.l4.m1.2.2.1.1.1.1.1.2.cmml">​</mo><mrow id="alg2.l4.m1.2.2.1.1.1.1.1.1.1" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.2" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.cmml"><msub id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.cmml"><mi id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.2" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.2.cmml">M</mi><mn id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.3" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.1" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.1.cmml">+</mo><msub id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.cmml"><mi id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.2" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.2.cmml">M</mi><mn id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.3" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.3.cmml">2</mn></msub></mrow><mo stretchy="false" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.3" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg2.l4.m1.2.2.1.1.1.1.2" xref="alg2.l4.m1.2.2.1.1.1.1.2.cmml">−</mo><mn id="alg2.l4.m1.2.2.1.1.1.1.3" xref="alg2.l4.m1.2.2.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="alg2.l4.m1.2.2.1.1.1.4" xref="alg2.l4.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l4.m1.2b"><apply id="alg2.l4.m1.2.2.cmml" xref="alg2.l4.m1.2.2"><ci id="alg2.l4.m1.2.2.2.cmml" xref="alg2.l4.m1.2.2.2">←</ci><ci id="alg2.l4.m1.2.2.3.cmml" xref="alg2.l4.m1.2.2.3">𝑗</ci><apply id="alg2.l4.m1.2.2.1.cmml" xref="alg2.l4.m1.2.2.1"><times id="alg2.l4.m1.2.2.1.2.cmml" xref="alg2.l4.m1.2.2.1.2"></times><ci id="alg2.l4.m1.2.2.1.3.cmml" xref="alg2.l4.m1.2.2.1.3">𝑅</ci><ci id="alg2.l4.m1.2.2.1.4.cmml" xref="alg2.l4.m1.2.2.1.4">𝑎</ci><ci id="alg2.l4.m1.2.2.1.5.cmml" xref="alg2.l4.m1.2.2.1.5">𝑛</ci><ci id="alg2.l4.m1.2.2.1.6.cmml" xref="alg2.l4.m1.2.2.1.6">𝑑</ci><ci id="alg2.l4.m1.2.2.1.7.cmml" xref="alg2.l4.m1.2.2.1.7">𝐼</ci><ci id="alg2.l4.m1.2.2.1.8.cmml" xref="alg2.l4.m1.2.2.1.8">𝑛</ci><ci id="alg2.l4.m1.2.2.1.9.cmml" xref="alg2.l4.m1.2.2.1.9">𝑡</ci><interval closure="open" id="alg2.l4.m1.2.2.1.1.2.cmml" xref="alg2.l4.m1.2.2.1.1.1"><cn type="integer" id="alg2.l4.m1.1.1.cmml" xref="alg2.l4.m1.1.1">1</cn><apply id="alg2.l4.m1.2.2.1.1.1.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1"><minus id="alg2.l4.m1.2.2.1.1.1.1.2.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.2"></minus><apply id="alg2.l4.m1.2.2.1.1.1.1.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1"><times id="alg2.l4.m1.2.2.1.1.1.1.1.2.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.2"></times><cn type="integer" id="alg2.l4.m1.2.2.1.1.1.1.1.3.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.3">2</cn><apply id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1"><plus id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.1"></plus><apply id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.2.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.2">𝑀</ci><cn type="integer" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.3.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.2.3">1</cn></apply><apply id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.1.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.2.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.2">𝑀</ci><cn type="integer" id="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.3.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.1.1.1.1.3.3">2</cn></apply></apply></apply><cn type="integer" id="alg2.l4.m1.2.2.1.1.1.1.3.cmml" xref="alg2.l4.m1.2.2.1.1.1.1.3">1</cn></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m1.2c">j\leftarrow RandInt(1,2(M_{1}+M_{2})-1)</annotation></semantics></math>

</div>
<div id="alg2.l5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l5.1.1.1" class="ltx_text" style="font-size:80%;">5:</span></span>         <math id="alg2.l5.m1.3" class="ltx_Math" alttext="S^{\prime}=Swap(S_{ij},S_{i(j+1)})" display="inline"><semantics id="alg2.l5.m1.3a"><mrow id="alg2.l5.m1.3.3" xref="alg2.l5.m1.3.3.cmml"><msup id="alg2.l5.m1.3.3.4" xref="alg2.l5.m1.3.3.4.cmml"><mi id="alg2.l5.m1.3.3.4.2" xref="alg2.l5.m1.3.3.4.2.cmml">S</mi><mo id="alg2.l5.m1.3.3.4.3" xref="alg2.l5.m1.3.3.4.3.cmml">′</mo></msup><mo id="alg2.l5.m1.3.3.3" xref="alg2.l5.m1.3.3.3.cmml">=</mo><mrow id="alg2.l5.m1.3.3.2" xref="alg2.l5.m1.3.3.2.cmml"><mi id="alg2.l5.m1.3.3.2.4" xref="alg2.l5.m1.3.3.2.4.cmml">S</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.3.3.2.3" xref="alg2.l5.m1.3.3.2.3.cmml">​</mo><mi id="alg2.l5.m1.3.3.2.5" xref="alg2.l5.m1.3.3.2.5.cmml">w</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.3.3.2.3a" xref="alg2.l5.m1.3.3.2.3.cmml">​</mo><mi id="alg2.l5.m1.3.3.2.6" xref="alg2.l5.m1.3.3.2.6.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.3.3.2.3b" xref="alg2.l5.m1.3.3.2.3.cmml">​</mo><mi id="alg2.l5.m1.3.3.2.7" xref="alg2.l5.m1.3.3.2.7.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.3.3.2.3c" xref="alg2.l5.m1.3.3.2.3.cmml">​</mo><mrow id="alg2.l5.m1.3.3.2.2.2" xref="alg2.l5.m1.3.3.2.2.3.cmml"><mo stretchy="false" id="alg2.l5.m1.3.3.2.2.2.3" xref="alg2.l5.m1.3.3.2.2.3.cmml">(</mo><msub id="alg2.l5.m1.2.2.1.1.1.1" xref="alg2.l5.m1.2.2.1.1.1.1.cmml"><mi id="alg2.l5.m1.2.2.1.1.1.1.2" xref="alg2.l5.m1.2.2.1.1.1.1.2.cmml">S</mi><mrow id="alg2.l5.m1.2.2.1.1.1.1.3" xref="alg2.l5.m1.2.2.1.1.1.1.3.cmml"><mi id="alg2.l5.m1.2.2.1.1.1.1.3.2" xref="alg2.l5.m1.2.2.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.2.2.1.1.1.1.3.1" xref="alg2.l5.m1.2.2.1.1.1.1.3.1.cmml">​</mo><mi id="alg2.l5.m1.2.2.1.1.1.1.3.3" xref="alg2.l5.m1.2.2.1.1.1.1.3.3.cmml">j</mi></mrow></msub><mo id="alg2.l5.m1.3.3.2.2.2.4" xref="alg2.l5.m1.3.3.2.2.3.cmml">,</mo><msub id="alg2.l5.m1.3.3.2.2.2.2" xref="alg2.l5.m1.3.3.2.2.2.2.cmml"><mi id="alg2.l5.m1.3.3.2.2.2.2.2" xref="alg2.l5.m1.3.3.2.2.2.2.2.cmml">S</mi><mrow id="alg2.l5.m1.1.1.1" xref="alg2.l5.m1.1.1.1.cmml"><mi id="alg2.l5.m1.1.1.1.3" xref="alg2.l5.m1.1.1.1.3.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg2.l5.m1.1.1.1.2" xref="alg2.l5.m1.1.1.1.2.cmml">​</mo><mrow id="alg2.l5.m1.1.1.1.1.1" xref="alg2.l5.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg2.l5.m1.1.1.1.1.1.2" xref="alg2.l5.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg2.l5.m1.1.1.1.1.1.1" xref="alg2.l5.m1.1.1.1.1.1.1.cmml"><mi id="alg2.l5.m1.1.1.1.1.1.1.2" xref="alg2.l5.m1.1.1.1.1.1.1.2.cmml">j</mi><mo id="alg2.l5.m1.1.1.1.1.1.1.1" xref="alg2.l5.m1.1.1.1.1.1.1.1.cmml">+</mo><mn id="alg2.l5.m1.1.1.1.1.1.1.3" xref="alg2.l5.m1.1.1.1.1.1.1.3.cmml">1</mn></mrow><mo stretchy="false" id="alg2.l5.m1.1.1.1.1.1.3" xref="alg2.l5.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo stretchy="false" id="alg2.l5.m1.3.3.2.2.2.5" xref="alg2.l5.m1.3.3.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m1.3b"><apply id="alg2.l5.m1.3.3.cmml" xref="alg2.l5.m1.3.3"><eq id="alg2.l5.m1.3.3.3.cmml" xref="alg2.l5.m1.3.3.3"></eq><apply id="alg2.l5.m1.3.3.4.cmml" xref="alg2.l5.m1.3.3.4"><csymbol cd="ambiguous" id="alg2.l5.m1.3.3.4.1.cmml" xref="alg2.l5.m1.3.3.4">superscript</csymbol><ci id="alg2.l5.m1.3.3.4.2.cmml" xref="alg2.l5.m1.3.3.4.2">𝑆</ci><ci id="alg2.l5.m1.3.3.4.3.cmml" xref="alg2.l5.m1.3.3.4.3">′</ci></apply><apply id="alg2.l5.m1.3.3.2.cmml" xref="alg2.l5.m1.3.3.2"><times id="alg2.l5.m1.3.3.2.3.cmml" xref="alg2.l5.m1.3.3.2.3"></times><ci id="alg2.l5.m1.3.3.2.4.cmml" xref="alg2.l5.m1.3.3.2.4">𝑆</ci><ci id="alg2.l5.m1.3.3.2.5.cmml" xref="alg2.l5.m1.3.3.2.5">𝑤</ci><ci id="alg2.l5.m1.3.3.2.6.cmml" xref="alg2.l5.m1.3.3.2.6">𝑎</ci><ci id="alg2.l5.m1.3.3.2.7.cmml" xref="alg2.l5.m1.3.3.2.7">𝑝</ci><interval closure="open" id="alg2.l5.m1.3.3.2.2.3.cmml" xref="alg2.l5.m1.3.3.2.2.2"><apply id="alg2.l5.m1.2.2.1.1.1.1.cmml" xref="alg2.l5.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l5.m1.2.2.1.1.1.1.1.cmml" xref="alg2.l5.m1.2.2.1.1.1.1">subscript</csymbol><ci id="alg2.l5.m1.2.2.1.1.1.1.2.cmml" xref="alg2.l5.m1.2.2.1.1.1.1.2">𝑆</ci><apply id="alg2.l5.m1.2.2.1.1.1.1.3.cmml" xref="alg2.l5.m1.2.2.1.1.1.1.3"><times id="alg2.l5.m1.2.2.1.1.1.1.3.1.cmml" xref="alg2.l5.m1.2.2.1.1.1.1.3.1"></times><ci id="alg2.l5.m1.2.2.1.1.1.1.3.2.cmml" xref="alg2.l5.m1.2.2.1.1.1.1.3.2">𝑖</ci><ci id="alg2.l5.m1.2.2.1.1.1.1.3.3.cmml" xref="alg2.l5.m1.2.2.1.1.1.1.3.3">𝑗</ci></apply></apply><apply id="alg2.l5.m1.3.3.2.2.2.2.cmml" xref="alg2.l5.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="alg2.l5.m1.3.3.2.2.2.2.1.cmml" xref="alg2.l5.m1.3.3.2.2.2.2">subscript</csymbol><ci id="alg2.l5.m1.3.3.2.2.2.2.2.cmml" xref="alg2.l5.m1.3.3.2.2.2.2.2">𝑆</ci><apply id="alg2.l5.m1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1"><times id="alg2.l5.m1.1.1.1.2.cmml" xref="alg2.l5.m1.1.1.1.2"></times><ci id="alg2.l5.m1.1.1.1.3.cmml" xref="alg2.l5.m1.1.1.1.3">𝑖</ci><apply id="alg2.l5.m1.1.1.1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1.1.1"><plus id="alg2.l5.m1.1.1.1.1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1.1.1.1.1"></plus><ci id="alg2.l5.m1.1.1.1.1.1.1.2.cmml" xref="alg2.l5.m1.1.1.1.1.1.1.2">𝑗</ci><cn type="integer" id="alg2.l5.m1.1.1.1.1.1.1.3.cmml" xref="alg2.l5.m1.1.1.1.1.1.1.3">1</cn></apply></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m1.3c">S^{\prime}=Swap(S_{ij},S_{i(j+1)})</annotation></semantics></math>

</div>
<div id="alg2.l6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l6.1.1.1" class="ltx_text" style="font-size:80%;">6:</span></span>         <span id="alg2.l6.2" class="ltx_text ltx_font_bold">if</span> <math id="alg2.l6.m1.1" class="ltx_Math" alttext="CheckValid(S^{\prime})" display="inline"><semantics id="alg2.l6.m1.1a"><mrow id="alg2.l6.m1.1.1" xref="alg2.l6.m1.1.1.cmml"><mi id="alg2.l6.m1.1.1.3" xref="alg2.l6.m1.1.1.3.cmml">C</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.4" xref="alg2.l6.m1.1.1.4.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2a" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.5" xref="alg2.l6.m1.1.1.5.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2b" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.6" xref="alg2.l6.m1.1.1.6.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2c" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.7" xref="alg2.l6.m1.1.1.7.cmml">k</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2d" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.8" xref="alg2.l6.m1.1.1.8.cmml">V</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2e" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.9" xref="alg2.l6.m1.1.1.9.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2f" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.10" xref="alg2.l6.m1.1.1.10.cmml">l</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2g" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.11" xref="alg2.l6.m1.1.1.11.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2h" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mi id="alg2.l6.m1.1.1.12" xref="alg2.l6.m1.1.1.12.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg2.l6.m1.1.1.2i" xref="alg2.l6.m1.1.1.2.cmml">​</mo><mrow id="alg2.l6.m1.1.1.1.1" xref="alg2.l6.m1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg2.l6.m1.1.1.1.1.2" xref="alg2.l6.m1.1.1.1.1.1.cmml">(</mo><msup id="alg2.l6.m1.1.1.1.1.1" xref="alg2.l6.m1.1.1.1.1.1.cmml"><mi id="alg2.l6.m1.1.1.1.1.1.2" xref="alg2.l6.m1.1.1.1.1.1.2.cmml">S</mi><mo id="alg2.l6.m1.1.1.1.1.1.3" xref="alg2.l6.m1.1.1.1.1.1.3.cmml">′</mo></msup><mo stretchy="false" id="alg2.l6.m1.1.1.1.1.3" xref="alg2.l6.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l6.m1.1b"><apply id="alg2.l6.m1.1.1.cmml" xref="alg2.l6.m1.1.1"><times id="alg2.l6.m1.1.1.2.cmml" xref="alg2.l6.m1.1.1.2"></times><ci id="alg2.l6.m1.1.1.3.cmml" xref="alg2.l6.m1.1.1.3">𝐶</ci><ci id="alg2.l6.m1.1.1.4.cmml" xref="alg2.l6.m1.1.1.4">ℎ</ci><ci id="alg2.l6.m1.1.1.5.cmml" xref="alg2.l6.m1.1.1.5">𝑒</ci><ci id="alg2.l6.m1.1.1.6.cmml" xref="alg2.l6.m1.1.1.6">𝑐</ci><ci id="alg2.l6.m1.1.1.7.cmml" xref="alg2.l6.m1.1.1.7">𝑘</ci><ci id="alg2.l6.m1.1.1.8.cmml" xref="alg2.l6.m1.1.1.8">𝑉</ci><ci id="alg2.l6.m1.1.1.9.cmml" xref="alg2.l6.m1.1.1.9">𝑎</ci><ci id="alg2.l6.m1.1.1.10.cmml" xref="alg2.l6.m1.1.1.10">𝑙</ci><ci id="alg2.l6.m1.1.1.11.cmml" xref="alg2.l6.m1.1.1.11">𝑖</ci><ci id="alg2.l6.m1.1.1.12.cmml" xref="alg2.l6.m1.1.1.12">𝑑</ci><apply id="alg2.l6.m1.1.1.1.1.1.cmml" xref="alg2.l6.m1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l6.m1.1.1.1.1.1.1.cmml" xref="alg2.l6.m1.1.1.1.1">superscript</csymbol><ci id="alg2.l6.m1.1.1.1.1.1.2.cmml" xref="alg2.l6.m1.1.1.1.1.1.2">𝑆</ci><ci id="alg2.l6.m1.1.1.1.1.1.3.cmml" xref="alg2.l6.m1.1.1.1.1.1.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.m1.1c">CheckValid(S^{\prime})</annotation></semantics></math> <span id="alg2.l6.3" class="ltx_text ltx_font_bold">then</span>

</div>
<div id="alg2.l7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg2.l7.1.1.1" class="ltx_text" style="font-size:80%;">7:</span></span>              <span id="alg2.l7.2" class="ltx_text ltx_font_bold">return</span> <math id="alg2.l7.m1.1" class="ltx_Math" alttext="S^{\prime}" display="inline"><semantics id="alg2.l7.m1.1a"><msup id="alg2.l7.m1.1.1" xref="alg2.l7.m1.1.1.cmml"><mi id="alg2.l7.m1.1.1.2" xref="alg2.l7.m1.1.1.2.cmml">S</mi><mo id="alg2.l7.m1.1.1.3" xref="alg2.l7.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="alg2.l7.m1.1b"><apply id="alg2.l7.m1.1.1.cmml" xref="alg2.l7.m1.1.1"><csymbol cd="ambiguous" id="alg2.l7.m1.1.1.1.cmml" xref="alg2.l7.m1.1.1">superscript</csymbol><ci id="alg2.l7.m1.1.1.2.cmml" xref="alg2.l7.m1.1.1.2">𝑆</ci><ci id="alg2.l7.m1.1.1.3.cmml" xref="alg2.l7.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m1.1c">S^{\prime}</annotation></semantics></math>
              
</div>
</div>
</figure>
<div id="S5.SS2.p6" class="ltx_para ltx_noindent">
<p id="S5.SS2.p6.15" class="ltx_p"><span id="S5.SS2.p6.15.1" class="ltx_text ltx_font_bold">Simulated Annealing (Algorithm <a href="#alg1" title="Algorithm 1 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>):</span> The algorithm uses
the solution found by the greedy algorithm as the initial state <math id="S5.SS2.p6.1.m1.1" class="ltx_Math" alttext="S_{0}" display="inline"><semantics id="S5.SS2.p6.1.m1.1a"><msub id="S5.SS2.p6.1.m1.1.1" xref="S5.SS2.p6.1.m1.1.1.cmml"><mi id="S5.SS2.p6.1.m1.1.1.2" xref="S5.SS2.p6.1.m1.1.1.2.cmml">S</mi><mn id="S5.SS2.p6.1.m1.1.1.3" xref="S5.SS2.p6.1.m1.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.1.m1.1b"><apply id="S5.SS2.p6.1.m1.1.1.cmml" xref="S5.SS2.p6.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.1.m1.1.1.1.cmml" xref="S5.SS2.p6.1.m1.1.1">subscript</csymbol><ci id="S5.SS2.p6.1.m1.1.1.2.cmml" xref="S5.SS2.p6.1.m1.1.1.2">𝑆</ci><cn type="integer" id="S5.SS2.p6.1.m1.1.1.3.cmml" xref="S5.SS2.p6.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.1.m1.1c">S_{0}</annotation></semantics></math>, and its execution time as the initial temperature (line 2-3). <math id="S5.SS2.p6.2.m2.1" class="ltx_Math" alttext="s^{*}" display="inline"><semantics id="S5.SS2.p6.2.m2.1a"><msup id="S5.SS2.p6.2.m2.1.1" xref="S5.SS2.p6.2.m2.1.1.cmml"><mi id="S5.SS2.p6.2.m2.1.1.2" xref="S5.SS2.p6.2.m2.1.1.2.cmml">s</mi><mo id="S5.SS2.p6.2.m2.1.1.3" xref="S5.SS2.p6.2.m2.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.2.m2.1b"><apply id="S5.SS2.p6.2.m2.1.1.cmml" xref="S5.SS2.p6.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.2.m2.1.1.1.cmml" xref="S5.SS2.p6.2.m2.1.1">superscript</csymbol><ci id="S5.SS2.p6.2.m2.1.1.2.cmml" xref="S5.SS2.p6.2.m2.1.1.2">𝑠</ci><times id="S5.SS2.p6.2.m2.1.1.3.cmml" xref="S5.SS2.p6.2.m2.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.2.m2.1c">s^{*}</annotation></semantics></math>
is used to store the schedule with the lowest latency and <math id="S5.SS2.p6.3.m3.1" class="ltx_Math" alttext="e^{*}" display="inline"><semantics id="S5.SS2.p6.3.m3.1a"><msup id="S5.SS2.p6.3.m3.1.1" xref="S5.SS2.p6.3.m3.1.1.cmml"><mi id="S5.SS2.p6.3.m3.1.1.2" xref="S5.SS2.p6.3.m3.1.1.2.cmml">e</mi><mo id="S5.SS2.p6.3.m3.1.1.3" xref="S5.SS2.p6.3.m3.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.3.m3.1b"><apply id="S5.SS2.p6.3.m3.1.1.cmml" xref="S5.SS2.p6.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.3.m3.1.1.1.cmml" xref="S5.SS2.p6.3.m3.1.1">superscript</csymbol><ci id="S5.SS2.p6.3.m3.1.1.2.cmml" xref="S5.SS2.p6.3.m3.1.1.2">𝑒</ci><times id="S5.SS2.p6.3.m3.1.1.3.cmml" xref="S5.SS2.p6.3.m3.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.3.m3.1c">e^{*}</annotation></semantics></math> is the energy (latency) of <math id="S5.SS2.p6.4.m4.1" class="ltx_Math" alttext="s^{*}" display="inline"><semantics id="S5.SS2.p6.4.m4.1a"><msup id="S5.SS2.p6.4.m4.1.1" xref="S5.SS2.p6.4.m4.1.1.cmml"><mi id="S5.SS2.p6.4.m4.1.1.2" xref="S5.SS2.p6.4.m4.1.1.2.cmml">s</mi><mo id="S5.SS2.p6.4.m4.1.1.3" xref="S5.SS2.p6.4.m4.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.4.m4.1b"><apply id="S5.SS2.p6.4.m4.1.1.cmml" xref="S5.SS2.p6.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.4.m4.1.1.1.cmml" xref="S5.SS2.p6.4.m4.1.1">superscript</csymbol><ci id="S5.SS2.p6.4.m4.1.1.2.cmml" xref="S5.SS2.p6.4.m4.1.1.2">𝑠</ci><times id="S5.SS2.p6.4.m4.1.1.3.cmml" xref="S5.SS2.p6.4.m4.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.4.m4.1c">s^{*}</annotation></semantics></math>.
The algorithm searches until temperature <math id="S5.SS2.p6.5.m5.1" class="ltx_Math" alttext="T" display="inline"><semantics id="S5.SS2.p6.5.m5.1a"><mi id="S5.SS2.p6.5.m5.1.1" xref="S5.SS2.p6.5.m5.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.5.m5.1b"><ci id="S5.SS2.p6.5.m5.1.1.cmml" xref="S5.SS2.p6.5.m5.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.5.m5.1c">T</annotation></semantics></math> is less than an epsilon value (line 7-16). <math id="S5.SS2.p6.6.m6.1" class="ltx_Math" alttext="T" display="inline"><semantics id="S5.SS2.p6.6.m6.1a"><mi id="S5.SS2.p6.6.m6.1.1" xref="S5.SS2.p6.6.m6.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.6.m6.1b"><ci id="S5.SS2.p6.6.m6.1.1.cmml" xref="S5.SS2.p6.6.m6.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.6.m6.1c">T</annotation></semantics></math> is decreased
by a factor of <math id="S5.SS2.p6.7.m7.1" class="ltx_Math" alttext="\alpha" display="inline"><semantics id="S5.SS2.p6.7.m7.1a"><mi id="S5.SS2.p6.7.m7.1.1" xref="S5.SS2.p6.7.m7.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.7.m7.1b"><ci id="S5.SS2.p6.7.m7.1.1.cmml" xref="S5.SS2.p6.7.m7.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.7.m7.1c">\alpha</annotation></semantics></math> in every iteration. At each iteration, it uses <math id="S5.SS2.p6.8.m8.1" class="ltx_Math" alttext="ComputeNeighbor" display="inline"><semantics id="S5.SS2.p6.8.m8.1a"><mrow id="S5.SS2.p6.8.m8.1.1" xref="S5.SS2.p6.8.m8.1.1.cmml"><mi id="S5.SS2.p6.8.m8.1.1.2" xref="S5.SS2.p6.8.m8.1.1.2.cmml">C</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.3" xref="S5.SS2.p6.8.m8.1.1.3.cmml">o</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1a" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.4" xref="S5.SS2.p6.8.m8.1.1.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1b" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.5" xref="S5.SS2.p6.8.m8.1.1.5.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1c" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.6" xref="S5.SS2.p6.8.m8.1.1.6.cmml">u</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1d" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.7" xref="S5.SS2.p6.8.m8.1.1.7.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1e" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.8" xref="S5.SS2.p6.8.m8.1.1.8.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1f" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.9" xref="S5.SS2.p6.8.m8.1.1.9.cmml">N</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1g" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.10" xref="S5.SS2.p6.8.m8.1.1.10.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1h" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.11" xref="S5.SS2.p6.8.m8.1.1.11.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1i" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.12" xref="S5.SS2.p6.8.m8.1.1.12.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1j" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.13" xref="S5.SS2.p6.8.m8.1.1.13.cmml">h</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1k" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.14" xref="S5.SS2.p6.8.m8.1.1.14.cmml">b</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1l" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.15" xref="S5.SS2.p6.8.m8.1.1.15.cmml">o</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.8.m8.1.1.1m" xref="S5.SS2.p6.8.m8.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.8.m8.1.1.16" xref="S5.SS2.p6.8.m8.1.1.16.cmml">r</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.8.m8.1b"><apply id="S5.SS2.p6.8.m8.1.1.cmml" xref="S5.SS2.p6.8.m8.1.1"><times id="S5.SS2.p6.8.m8.1.1.1.cmml" xref="S5.SS2.p6.8.m8.1.1.1"></times><ci id="S5.SS2.p6.8.m8.1.1.2.cmml" xref="S5.SS2.p6.8.m8.1.1.2">𝐶</ci><ci id="S5.SS2.p6.8.m8.1.1.3.cmml" xref="S5.SS2.p6.8.m8.1.1.3">𝑜</ci><ci id="S5.SS2.p6.8.m8.1.1.4.cmml" xref="S5.SS2.p6.8.m8.1.1.4">𝑚</ci><ci id="S5.SS2.p6.8.m8.1.1.5.cmml" xref="S5.SS2.p6.8.m8.1.1.5">𝑝</ci><ci id="S5.SS2.p6.8.m8.1.1.6.cmml" xref="S5.SS2.p6.8.m8.1.1.6">𝑢</ci><ci id="S5.SS2.p6.8.m8.1.1.7.cmml" xref="S5.SS2.p6.8.m8.1.1.7">𝑡</ci><ci id="S5.SS2.p6.8.m8.1.1.8.cmml" xref="S5.SS2.p6.8.m8.1.1.8">𝑒</ci><ci id="S5.SS2.p6.8.m8.1.1.9.cmml" xref="S5.SS2.p6.8.m8.1.1.9">𝑁</ci><ci id="S5.SS2.p6.8.m8.1.1.10.cmml" xref="S5.SS2.p6.8.m8.1.1.10">𝑒</ci><ci id="S5.SS2.p6.8.m8.1.1.11.cmml" xref="S5.SS2.p6.8.m8.1.1.11">𝑖</ci><ci id="S5.SS2.p6.8.m8.1.1.12.cmml" xref="S5.SS2.p6.8.m8.1.1.12">𝑔</ci><ci id="S5.SS2.p6.8.m8.1.1.13.cmml" xref="S5.SS2.p6.8.m8.1.1.13">ℎ</ci><ci id="S5.SS2.p6.8.m8.1.1.14.cmml" xref="S5.SS2.p6.8.m8.1.1.14">𝑏</ci><ci id="S5.SS2.p6.8.m8.1.1.15.cmml" xref="S5.SS2.p6.8.m8.1.1.15">𝑜</ci><ci id="S5.SS2.p6.8.m8.1.1.16.cmml" xref="S5.SS2.p6.8.m8.1.1.16">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.8.m8.1c">ComputeNeighbor</annotation></semantics></math>
subroutine to find a neighbor state of the current one and uses <math id="S5.SS2.p6.9.m9.1" class="ltx_Math" alttext="ComputeEnergy" display="inline"><semantics id="S5.SS2.p6.9.m9.1a"><mrow id="S5.SS2.p6.9.m9.1.1" xref="S5.SS2.p6.9.m9.1.1.cmml"><mi id="S5.SS2.p6.9.m9.1.1.2" xref="S5.SS2.p6.9.m9.1.1.2.cmml">C</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.3" xref="S5.SS2.p6.9.m9.1.1.3.cmml">o</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1a" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.4" xref="S5.SS2.p6.9.m9.1.1.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1b" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.5" xref="S5.SS2.p6.9.m9.1.1.5.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1c" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.6" xref="S5.SS2.p6.9.m9.1.1.6.cmml">u</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1d" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.7" xref="S5.SS2.p6.9.m9.1.1.7.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1e" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.8" xref="S5.SS2.p6.9.m9.1.1.8.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1f" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.9" xref="S5.SS2.p6.9.m9.1.1.9.cmml">E</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1g" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.10" xref="S5.SS2.p6.9.m9.1.1.10.cmml">n</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1h" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.11" xref="S5.SS2.p6.9.m9.1.1.11.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1i" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.12" xref="S5.SS2.p6.9.m9.1.1.12.cmml">r</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1j" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.13" xref="S5.SS2.p6.9.m9.1.1.13.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.9.m9.1.1.1k" xref="S5.SS2.p6.9.m9.1.1.1.cmml">​</mo><mi id="S5.SS2.p6.9.m9.1.1.14" xref="S5.SS2.p6.9.m9.1.1.14.cmml">y</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.9.m9.1b"><apply id="S5.SS2.p6.9.m9.1.1.cmml" xref="S5.SS2.p6.9.m9.1.1"><times id="S5.SS2.p6.9.m9.1.1.1.cmml" xref="S5.SS2.p6.9.m9.1.1.1"></times><ci id="S5.SS2.p6.9.m9.1.1.2.cmml" xref="S5.SS2.p6.9.m9.1.1.2">𝐶</ci><ci id="S5.SS2.p6.9.m9.1.1.3.cmml" xref="S5.SS2.p6.9.m9.1.1.3">𝑜</ci><ci id="S5.SS2.p6.9.m9.1.1.4.cmml" xref="S5.SS2.p6.9.m9.1.1.4">𝑚</ci><ci id="S5.SS2.p6.9.m9.1.1.5.cmml" xref="S5.SS2.p6.9.m9.1.1.5">𝑝</ci><ci id="S5.SS2.p6.9.m9.1.1.6.cmml" xref="S5.SS2.p6.9.m9.1.1.6">𝑢</ci><ci id="S5.SS2.p6.9.m9.1.1.7.cmml" xref="S5.SS2.p6.9.m9.1.1.7">𝑡</ci><ci id="S5.SS2.p6.9.m9.1.1.8.cmml" xref="S5.SS2.p6.9.m9.1.1.8">𝑒</ci><ci id="S5.SS2.p6.9.m9.1.1.9.cmml" xref="S5.SS2.p6.9.m9.1.1.9">𝐸</ci><ci id="S5.SS2.p6.9.m9.1.1.10.cmml" xref="S5.SS2.p6.9.m9.1.1.10">𝑛</ci><ci id="S5.SS2.p6.9.m9.1.1.11.cmml" xref="S5.SS2.p6.9.m9.1.1.11">𝑒</ci><ci id="S5.SS2.p6.9.m9.1.1.12.cmml" xref="S5.SS2.p6.9.m9.1.1.12">𝑟</ci><ci id="S5.SS2.p6.9.m9.1.1.13.cmml" xref="S5.SS2.p6.9.m9.1.1.13">𝑔</ci><ci id="S5.SS2.p6.9.m9.1.1.14.cmml" xref="S5.SS2.p6.9.m9.1.1.14">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.9.m9.1c">ComputeEnergy</annotation></semantics></math> to compute the
energy of the neighbor state. If the neighbor state has a lower energy than <math id="S5.SS2.p6.10.m10.1" class="ltx_Math" alttext="s^{*}" display="inline"><semantics id="S5.SS2.p6.10.m10.1a"><msup id="S5.SS2.p6.10.m10.1.1" xref="S5.SS2.p6.10.m10.1.1.cmml"><mi id="S5.SS2.p6.10.m10.1.1.2" xref="S5.SS2.p6.10.m10.1.1.2.cmml">s</mi><mo id="S5.SS2.p6.10.m10.1.1.3" xref="S5.SS2.p6.10.m10.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.10.m10.1b"><apply id="S5.SS2.p6.10.m10.1.1.cmml" xref="S5.SS2.p6.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.10.m10.1.1.1.cmml" xref="S5.SS2.p6.10.m10.1.1">superscript</csymbol><ci id="S5.SS2.p6.10.m10.1.1.2.cmml" xref="S5.SS2.p6.10.m10.1.1.2">𝑠</ci><times id="S5.SS2.p6.10.m10.1.1.3.cmml" xref="S5.SS2.p6.10.m10.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.10.m10.1c">s^{*}</annotation></semantics></math>,
it updates <math id="S5.SS2.p6.11.m11.1" class="ltx_Math" alttext="s^{*}" display="inline"><semantics id="S5.SS2.p6.11.m11.1a"><msup id="S5.SS2.p6.11.m11.1.1" xref="S5.SS2.p6.11.m11.1.1.cmml"><mi id="S5.SS2.p6.11.m11.1.1.2" xref="S5.SS2.p6.11.m11.1.1.2.cmml">s</mi><mo id="S5.SS2.p6.11.m11.1.1.3" xref="S5.SS2.p6.11.m11.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.11.m11.1b"><apply id="S5.SS2.p6.11.m11.1.1.cmml" xref="S5.SS2.p6.11.m11.1.1"><csymbol cd="ambiguous" id="S5.SS2.p6.11.m11.1.1.1.cmml" xref="S5.SS2.p6.11.m11.1.1">superscript</csymbol><ci id="S5.SS2.p6.11.m11.1.1.2.cmml" xref="S5.SS2.p6.11.m11.1.1.2">𝑠</ci><times id="S5.SS2.p6.11.m11.1.1.3.cmml" xref="S5.SS2.p6.11.m11.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.11.m11.1c">s^{*}</annotation></semantics></math> (line 10-12). The algorithm uses a probabilistic function <math id="S5.SS2.p6.12.m12.1" class="ltx_Math" alttext="P" display="inline"><semantics id="S5.SS2.p6.12.m12.1a"><mi id="S5.SS2.p6.12.m12.1.1" xref="S5.SS2.p6.12.m12.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.12.m12.1b"><ci id="S5.SS2.p6.12.m12.1.1.cmml" xref="S5.SS2.p6.12.m12.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.12.m12.1c">P</annotation></semantics></math> to decide
whether to transition from the current state to the neighbor state.
The probabilistic function <math id="S5.SS2.p6.13.m13.1" class="ltx_Math" alttext="P" display="inline"><semantics id="S5.SS2.p6.13.m13.1a"><mi id="S5.SS2.p6.13.m13.1.1" xref="S5.SS2.p6.13.m13.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.13.m13.1b"><ci id="S5.SS2.p6.13.m13.1.1.cmml" xref="S5.SS2.p6.13.m13.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.13.m13.1c">P</annotation></semantics></math> is defined as
follows: if the neighbor state has a lower energy than the current state, the probability is
<math id="S5.SS2.p6.14.m14.1" class="ltx_Math" alttext="1" display="inline"><semantics id="S5.SS2.p6.14.m14.1a"><mn id="S5.SS2.p6.14.m14.1.1" xref="S5.SS2.p6.14.m14.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.14.m14.1b"><cn type="integer" id="S5.SS2.p6.14.m14.1.1.cmml" xref="S5.SS2.p6.14.m14.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.14.m14.1c">1</annotation></semantics></math>; otherwise, the probability is <math id="S5.SS2.p6.15.m15.1" class="ltx_Math" alttext="e^{(e_{current}-e_{neighbor})/T}" display="inline"><semantics id="S5.SS2.p6.15.m15.1a"><msup id="S5.SS2.p6.15.m15.1.2" xref="S5.SS2.p6.15.m15.1.2.cmml"><mi id="S5.SS2.p6.15.m15.1.2.2" xref="S5.SS2.p6.15.m15.1.2.2.cmml">e</mi><mrow id="S5.SS2.p6.15.m15.1.1.1" xref="S5.SS2.p6.15.m15.1.1.1.cmml"><mrow id="S5.SS2.p6.15.m15.1.1.1.1.1" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.SS2.p6.15.m15.1.1.1.1.1.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS2.p6.15.m15.1.1.1.1.1.1" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.cmml"><msub id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.cmml"><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.2.cmml">e</mi><mrow id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.cmml"><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.2.cmml">c</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.3.cmml">u</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1a" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.4" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.4.cmml">r</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1b" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.5" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1c" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.6" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.6.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1d" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.7" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1e" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.8" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.8.cmml">t</mi></mrow></msub><mo id="S5.SS2.p6.15.m15.1.1.1.1.1.1.1" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.1.cmml">−</mo><msub id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.cmml"><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.2.cmml">e</mi><mrow id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.cmml"><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.2" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.2.cmml">n</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1a" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.4" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.4.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1b" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.5" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.5.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1c" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.6" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.6.cmml">h</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1d" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.7" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.7.cmml">b</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1e" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.8" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.8.cmml">o</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1f" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml">​</mo><mi id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.9" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.9.cmml">r</mi></mrow></msub></mrow><mo stretchy="false" id="S5.SS2.p6.15.m15.1.1.1.1.1.3" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.SS2.p6.15.m15.1.1.1.2" xref="S5.SS2.p6.15.m15.1.1.1.2.cmml">/</mo><mi id="S5.SS2.p6.15.m15.1.1.1.3" xref="S5.SS2.p6.15.m15.1.1.1.3.cmml">T</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p6.15.m15.1b"><apply id="S5.SS2.p6.15.m15.1.2.cmml" xref="S5.SS2.p6.15.m15.1.2"><csymbol cd="ambiguous" id="S5.SS2.p6.15.m15.1.2.1.cmml" xref="S5.SS2.p6.15.m15.1.2">superscript</csymbol><ci id="S5.SS2.p6.15.m15.1.2.2.cmml" xref="S5.SS2.p6.15.m15.1.2.2">𝑒</ci><apply id="S5.SS2.p6.15.m15.1.1.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1"><divide id="S5.SS2.p6.15.m15.1.1.1.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.2"></divide><apply id="S5.SS2.p6.15.m15.1.1.1.1.1.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1"><minus id="S5.SS2.p6.15.m15.1.1.1.1.1.1.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.1"></minus><apply id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.2">𝑒</ci><apply id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3"><times id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.1"></times><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.2">𝑐</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.3">𝑢</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.4.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.4">𝑟</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.5.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.5">𝑟</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.6.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.6">𝑒</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.7.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.7">𝑛</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.8.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.2.3.8">𝑡</ci></apply></apply><apply id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3">subscript</csymbol><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.2">𝑒</ci><apply id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3"><times id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.1"></times><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.2.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.2">𝑛</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.3">𝑒</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.4.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.4">𝑖</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.5.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.5">𝑔</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.6.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.6">ℎ</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.7.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.7">𝑏</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.8.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.8">𝑜</ci><ci id="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.9.cmml" xref="S5.SS2.p6.15.m15.1.1.1.1.1.1.3.3.9">𝑟</ci></apply></apply></apply><ci id="S5.SS2.p6.15.m15.1.1.1.3.cmml" xref="S5.SS2.p6.15.m15.1.1.1.3">𝑇</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p6.15.m15.1c">e^{(e_{current}-e_{neighbor})/T}</annotation></semantics></math>.</p>
</div>
<figure id="alg3" class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span id="alg3.2.1.1" class="ltx_text ltx_font_bold">Algorithm 3</span> </span> Compute Energy</figcaption>
<div id="alg3.3" class="ltx_listing ltx_listing">
<div id="alg3.l1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l1.1.1.1" class="ltx_text" style="font-size:80%;">1:</span></span><span id="alg3.l1.2" class="ltx_text ltx_font_bold">function</span> <span id="alg3.l1.3" class="ltx_text ltx_font_smallcaps">ComputeEnergy</span>(<math id="alg3.l1.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="alg3.l1.m1.1a"><mi id="alg3.l1.m1.1.1" xref="alg3.l1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="alg3.l1.m1.1b"><ci id="alg3.l1.m1.1.1.cmml" xref="alg3.l1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="alg3.l1.m1.1c">S</annotation></semantics></math>)

</div>
<div id="alg3.l2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l2.1.1.1" class="ltx_text" style="font-size:80%;">2:</span></span>     <span id="alg3.l2.2" class="ltx_text ltx_font_bold">return</span> <math id="alg3.l2.m1.1" class="ltx_Math" alttext="max_{1\leq i\leq N}" display="inline"><semantics id="alg3.l2.m1.1a"><mrow id="alg3.l2.m1.1.1" xref="alg3.l2.m1.1.1.cmml"><mi id="alg3.l2.m1.1.1.2" xref="alg3.l2.m1.1.1.2.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l2.m1.1.1.1" xref="alg3.l2.m1.1.1.1.cmml">​</mo><mi id="alg3.l2.m1.1.1.3" xref="alg3.l2.m1.1.1.3.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg3.l2.m1.1.1.1a" xref="alg3.l2.m1.1.1.1.cmml">​</mo><msub id="alg3.l2.m1.1.1.4" xref="alg3.l2.m1.1.1.4.cmml"><mi id="alg3.l2.m1.1.1.4.2" xref="alg3.l2.m1.1.1.4.2.cmml">x</mi><mrow id="alg3.l2.m1.1.1.4.3" xref="alg3.l2.m1.1.1.4.3.cmml"><mn id="alg3.l2.m1.1.1.4.3.2" xref="alg3.l2.m1.1.1.4.3.2.cmml">1</mn><mo id="alg3.l2.m1.1.1.4.3.3" xref="alg3.l2.m1.1.1.4.3.3.cmml">≤</mo><mi id="alg3.l2.m1.1.1.4.3.4" xref="alg3.l2.m1.1.1.4.3.4.cmml">i</mi><mo id="alg3.l2.m1.1.1.4.3.5" xref="alg3.l2.m1.1.1.4.3.5.cmml">≤</mo><mi id="alg3.l2.m1.1.1.4.3.6" xref="alg3.l2.m1.1.1.4.3.6.cmml">N</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg3.l2.m1.1b"><apply id="alg3.l2.m1.1.1.cmml" xref="alg3.l2.m1.1.1"><times id="alg3.l2.m1.1.1.1.cmml" xref="alg3.l2.m1.1.1.1"></times><ci id="alg3.l2.m1.1.1.2.cmml" xref="alg3.l2.m1.1.1.2">𝑚</ci><ci id="alg3.l2.m1.1.1.3.cmml" xref="alg3.l2.m1.1.1.3">𝑎</ci><apply id="alg3.l2.m1.1.1.4.cmml" xref="alg3.l2.m1.1.1.4"><csymbol cd="ambiguous" id="alg3.l2.m1.1.1.4.1.cmml" xref="alg3.l2.m1.1.1.4">subscript</csymbol><ci id="alg3.l2.m1.1.1.4.2.cmml" xref="alg3.l2.m1.1.1.4.2">𝑥</ci><apply id="alg3.l2.m1.1.1.4.3.cmml" xref="alg3.l2.m1.1.1.4.3"><and id="alg3.l2.m1.1.1.4.3a.cmml" xref="alg3.l2.m1.1.1.4.3"></and><apply id="alg3.l2.m1.1.1.4.3b.cmml" xref="alg3.l2.m1.1.1.4.3"><leq id="alg3.l2.m1.1.1.4.3.3.cmml" xref="alg3.l2.m1.1.1.4.3.3"></leq><cn type="integer" id="alg3.l2.m1.1.1.4.3.2.cmml" xref="alg3.l2.m1.1.1.4.3.2">1</cn><ci id="alg3.l2.m1.1.1.4.3.4.cmml" xref="alg3.l2.m1.1.1.4.3.4">𝑖</ci></apply><apply id="alg3.l2.m1.1.1.4.3c.cmml" xref="alg3.l2.m1.1.1.4.3"><leq id="alg3.l2.m1.1.1.4.3.5.cmml" xref="alg3.l2.m1.1.1.4.3.5"></leq><share href="#alg3.l2.m1.1.1.4.3.4.cmml" id="alg3.l2.m1.1.1.4.3d.cmml" xref="alg3.l2.m1.1.1.4.3"></share><ci id="alg3.l2.m1.1.1.4.3.6.cmml" xref="alg3.l2.m1.1.1.4.3.6">𝑁</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l2.m1.1c">max_{1\leq i\leq N}</annotation></semantics></math>ComputeFinishTime(<math id="alg3.l2.m2.2" class="ltx_Math" alttext="S_{i,M}" display="inline"><semantics id="alg3.l2.m2.2a"><msub id="alg3.l2.m2.2.3" xref="alg3.l2.m2.2.3.cmml"><mi id="alg3.l2.m2.2.3.2" xref="alg3.l2.m2.2.3.2.cmml">S</mi><mrow id="alg3.l2.m2.2.2.2.4" xref="alg3.l2.m2.2.2.2.3.cmml"><mi id="alg3.l2.m2.1.1.1.1" xref="alg3.l2.m2.1.1.1.1.cmml">i</mi><mo id="alg3.l2.m2.2.2.2.4.1" xref="alg3.l2.m2.2.2.2.3.cmml">,</mo><mi id="alg3.l2.m2.2.2.2.2" xref="alg3.l2.m2.2.2.2.2.cmml">M</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l2.m2.2b"><apply id="alg3.l2.m2.2.3.cmml" xref="alg3.l2.m2.2.3"><csymbol cd="ambiguous" id="alg3.l2.m2.2.3.1.cmml" xref="alg3.l2.m2.2.3">subscript</csymbol><ci id="alg3.l2.m2.2.3.2.cmml" xref="alg3.l2.m2.2.3.2">𝑆</ci><list id="alg3.l2.m2.2.2.2.3.cmml" xref="alg3.l2.m2.2.2.2.4"><ci id="alg3.l2.m2.1.1.1.1.cmml" xref="alg3.l2.m2.1.1.1.1">𝑖</ci><ci id="alg3.l2.m2.2.2.2.2.cmml" xref="alg3.l2.m2.2.2.2.2">𝑀</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l2.m2.2c">S_{i,M}</annotation></semantics></math>)

</div>
<div id="alg3.l3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l3.1.1.1" class="ltx_text" style="font-size:80%;">3:</span></span><span id="alg3.l3.2" class="ltx_text ltx_font_bold">function</span> <span id="alg3.l3.3" class="ltx_text ltx_font_smallcaps">ComputeFinishTime</span>(<math id="alg3.l3.m1.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="alg3.l3.m1.1a"><msub id="alg3.l3.m1.1.1" xref="alg3.l3.m1.1.1.cmml"><mi id="alg3.l3.m1.1.1.2" xref="alg3.l3.m1.1.1.2.cmml">S</mi><mrow id="alg3.l3.m1.1.1.3" xref="alg3.l3.m1.1.1.3.cmml"><mi id="alg3.l3.m1.1.1.3.2" xref="alg3.l3.m1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l3.m1.1.1.3.1" xref="alg3.l3.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l3.m1.1.1.3.3" xref="alg3.l3.m1.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l3.m1.1b"><apply id="alg3.l3.m1.1.1.cmml" xref="alg3.l3.m1.1.1"><csymbol cd="ambiguous" id="alg3.l3.m1.1.1.1.cmml" xref="alg3.l3.m1.1.1">subscript</csymbol><ci id="alg3.l3.m1.1.1.2.cmml" xref="alg3.l3.m1.1.1.2">𝑆</ci><apply id="alg3.l3.m1.1.1.3.cmml" xref="alg3.l3.m1.1.1.3"><times id="alg3.l3.m1.1.1.3.1.cmml" xref="alg3.l3.m1.1.1.3.1"></times><ci id="alg3.l3.m1.1.1.3.2.cmml" xref="alg3.l3.m1.1.1.3.2">𝑖</ci><ci id="alg3.l3.m1.1.1.3.3.cmml" xref="alg3.l3.m1.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l3.m1.1c">S_{ij}</annotation></semantics></math>)

</div>
<div id="alg3.l4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l4.1.1.1" class="ltx_text" style="font-size:80%;">4:</span></span>     <span id="alg3.l4.2" class="ltx_text ltx_font_bold">if</span> <math id="alg3.l4.m1.1" class="ltx_Math" alttext="S_{ij}\in Memo" display="inline"><semantics id="alg3.l4.m1.1a"><mrow id="alg3.l4.m1.1.1" xref="alg3.l4.m1.1.1.cmml"><msub id="alg3.l4.m1.1.1.2" xref="alg3.l4.m1.1.1.2.cmml"><mi id="alg3.l4.m1.1.1.2.2" xref="alg3.l4.m1.1.1.2.2.cmml">S</mi><mrow id="alg3.l4.m1.1.1.2.3" xref="alg3.l4.m1.1.1.2.3.cmml"><mi id="alg3.l4.m1.1.1.2.3.2" xref="alg3.l4.m1.1.1.2.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m1.1.1.2.3.1" xref="alg3.l4.m1.1.1.2.3.1.cmml">​</mo><mi id="alg3.l4.m1.1.1.2.3.3" xref="alg3.l4.m1.1.1.2.3.3.cmml">j</mi></mrow></msub><mo id="alg3.l4.m1.1.1.1" xref="alg3.l4.m1.1.1.1.cmml">∈</mo><mrow id="alg3.l4.m1.1.1.3" xref="alg3.l4.m1.1.1.3.cmml"><mi id="alg3.l4.m1.1.1.3.2" xref="alg3.l4.m1.1.1.3.2.cmml">M</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m1.1.1.3.1" xref="alg3.l4.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l4.m1.1.1.3.3" xref="alg3.l4.m1.1.1.3.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m1.1.1.3.1a" xref="alg3.l4.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l4.m1.1.1.3.4" xref="alg3.l4.m1.1.1.3.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m1.1.1.3.1b" xref="alg3.l4.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l4.m1.1.1.3.5" xref="alg3.l4.m1.1.1.3.5.cmml">o</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l4.m1.1b"><apply id="alg3.l4.m1.1.1.cmml" xref="alg3.l4.m1.1.1"><in id="alg3.l4.m1.1.1.1.cmml" xref="alg3.l4.m1.1.1.1"></in><apply id="alg3.l4.m1.1.1.2.cmml" xref="alg3.l4.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l4.m1.1.1.2.1.cmml" xref="alg3.l4.m1.1.1.2">subscript</csymbol><ci id="alg3.l4.m1.1.1.2.2.cmml" xref="alg3.l4.m1.1.1.2.2">𝑆</ci><apply id="alg3.l4.m1.1.1.2.3.cmml" xref="alg3.l4.m1.1.1.2.3"><times id="alg3.l4.m1.1.1.2.3.1.cmml" xref="alg3.l4.m1.1.1.2.3.1"></times><ci id="alg3.l4.m1.1.1.2.3.2.cmml" xref="alg3.l4.m1.1.1.2.3.2">𝑖</ci><ci id="alg3.l4.m1.1.1.2.3.3.cmml" xref="alg3.l4.m1.1.1.2.3.3">𝑗</ci></apply></apply><apply id="alg3.l4.m1.1.1.3.cmml" xref="alg3.l4.m1.1.1.3"><times id="alg3.l4.m1.1.1.3.1.cmml" xref="alg3.l4.m1.1.1.3.1"></times><ci id="alg3.l4.m1.1.1.3.2.cmml" xref="alg3.l4.m1.1.1.3.2">𝑀</ci><ci id="alg3.l4.m1.1.1.3.3.cmml" xref="alg3.l4.m1.1.1.3.3">𝑒</ci><ci id="alg3.l4.m1.1.1.3.4.cmml" xref="alg3.l4.m1.1.1.3.4">𝑚</ci><ci id="alg3.l4.m1.1.1.3.5.cmml" xref="alg3.l4.m1.1.1.3.5">𝑜</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l4.m1.1c">S_{ij}\in Memo</annotation></semantics></math> <span id="alg3.l4.3" class="ltx_text ltx_font_bold">then</span>
<span id="alg3.l4.4" class="ltx_text ltx_font_bold">return</span> <math id="alg3.l4.m2.2" class="ltx_Math" alttext="Memo.get(S_{ij})" display="inline"><semantics id="alg3.l4.m2.2a"><mrow id="alg3.l4.m2.2.2.2" xref="alg3.l4.m2.2.2.3.cmml"><mrow id="alg3.l4.m2.1.1.1.1" xref="alg3.l4.m2.1.1.1.1.cmml"><mi id="alg3.l4.m2.1.1.1.1.2" xref="alg3.l4.m2.1.1.1.1.2.cmml">M</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.1.1.1.1.1" xref="alg3.l4.m2.1.1.1.1.1.cmml">​</mo><mi id="alg3.l4.m2.1.1.1.1.3" xref="alg3.l4.m2.1.1.1.1.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.1.1.1.1.1a" xref="alg3.l4.m2.1.1.1.1.1.cmml">​</mo><mi id="alg3.l4.m2.1.1.1.1.4" xref="alg3.l4.m2.1.1.1.1.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.1.1.1.1.1b" xref="alg3.l4.m2.1.1.1.1.1.cmml">​</mo><mi id="alg3.l4.m2.1.1.1.1.5" xref="alg3.l4.m2.1.1.1.1.5.cmml">o</mi></mrow><mo lspace="0em" rspace="0.167em" id="alg3.l4.m2.2.2.2.3" xref="alg3.l4.m2.2.2.3a.cmml">.</mo><mrow id="alg3.l4.m2.2.2.2.2" xref="alg3.l4.m2.2.2.2.2.cmml"><mi id="alg3.l4.m2.2.2.2.2.3" xref="alg3.l4.m2.2.2.2.2.3.cmml">g</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.2.2.2.2.2" xref="alg3.l4.m2.2.2.2.2.2.cmml">​</mo><mi id="alg3.l4.m2.2.2.2.2.4" xref="alg3.l4.m2.2.2.2.2.4.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.2.2.2.2.2a" xref="alg3.l4.m2.2.2.2.2.2.cmml">​</mo><mi id="alg3.l4.m2.2.2.2.2.5" xref="alg3.l4.m2.2.2.2.2.5.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.2.2.2.2.2b" xref="alg3.l4.m2.2.2.2.2.2.cmml">​</mo><mrow id="alg3.l4.m2.2.2.2.2.1.1" xref="alg3.l4.m2.2.2.2.2.1.1.1.cmml"><mo stretchy="false" id="alg3.l4.m2.2.2.2.2.1.1.2" xref="alg3.l4.m2.2.2.2.2.1.1.1.cmml">(</mo><msub id="alg3.l4.m2.2.2.2.2.1.1.1" xref="alg3.l4.m2.2.2.2.2.1.1.1.cmml"><mi id="alg3.l4.m2.2.2.2.2.1.1.1.2" xref="alg3.l4.m2.2.2.2.2.1.1.1.2.cmml">S</mi><mrow id="alg3.l4.m2.2.2.2.2.1.1.1.3" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.cmml"><mi id="alg3.l4.m2.2.2.2.2.1.1.1.3.2" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l4.m2.2.2.2.2.1.1.1.3.1" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.1.cmml">​</mo><mi id="alg3.l4.m2.2.2.2.2.1.1.1.3.3" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.3.cmml">j</mi></mrow></msub><mo stretchy="false" id="alg3.l4.m2.2.2.2.2.1.1.3" xref="alg3.l4.m2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l4.m2.2b"><apply id="alg3.l4.m2.2.2.3.cmml" xref="alg3.l4.m2.2.2.2"><csymbol cd="ambiguous" id="alg3.l4.m2.2.2.3a.cmml" xref="alg3.l4.m2.2.2.2.3">formulae-sequence</csymbol><apply id="alg3.l4.m2.1.1.1.1.cmml" xref="alg3.l4.m2.1.1.1.1"><times id="alg3.l4.m2.1.1.1.1.1.cmml" xref="alg3.l4.m2.1.1.1.1.1"></times><ci id="alg3.l4.m2.1.1.1.1.2.cmml" xref="alg3.l4.m2.1.1.1.1.2">𝑀</ci><ci id="alg3.l4.m2.1.1.1.1.3.cmml" xref="alg3.l4.m2.1.1.1.1.3">𝑒</ci><ci id="alg3.l4.m2.1.1.1.1.4.cmml" xref="alg3.l4.m2.1.1.1.1.4">𝑚</ci><ci id="alg3.l4.m2.1.1.1.1.5.cmml" xref="alg3.l4.m2.1.1.1.1.5">𝑜</ci></apply><apply id="alg3.l4.m2.2.2.2.2.cmml" xref="alg3.l4.m2.2.2.2.2"><times id="alg3.l4.m2.2.2.2.2.2.cmml" xref="alg3.l4.m2.2.2.2.2.2"></times><ci id="alg3.l4.m2.2.2.2.2.3.cmml" xref="alg3.l4.m2.2.2.2.2.3">𝑔</ci><ci id="alg3.l4.m2.2.2.2.2.4.cmml" xref="alg3.l4.m2.2.2.2.2.4">𝑒</ci><ci id="alg3.l4.m2.2.2.2.2.5.cmml" xref="alg3.l4.m2.2.2.2.2.5">𝑡</ci><apply id="alg3.l4.m2.2.2.2.2.1.1.1.cmml" xref="alg3.l4.m2.2.2.2.2.1.1"><csymbol cd="ambiguous" id="alg3.l4.m2.2.2.2.2.1.1.1.1.cmml" xref="alg3.l4.m2.2.2.2.2.1.1">subscript</csymbol><ci id="alg3.l4.m2.2.2.2.2.1.1.1.2.cmml" xref="alg3.l4.m2.2.2.2.2.1.1.1.2">𝑆</ci><apply id="alg3.l4.m2.2.2.2.2.1.1.1.3.cmml" xref="alg3.l4.m2.2.2.2.2.1.1.1.3"><times id="alg3.l4.m2.2.2.2.2.1.1.1.3.1.cmml" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.1"></times><ci id="alg3.l4.m2.2.2.2.2.1.1.1.3.2.cmml" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.2">𝑖</ci><ci id="alg3.l4.m2.2.2.2.2.1.1.1.3.3.cmml" xref="alg3.l4.m2.2.2.2.2.1.1.1.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l4.m2.2c">Memo.get(S_{ij})</annotation></semantics></math>
     
</div>
<div id="alg3.l5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l5.1.1.1" class="ltx_text" style="font-size:80%;">5:</span></span>     <math id="alg3.l5.m1.1" class="ltx_Math" alttext="S^{intra}\leftarrow GetIntraDependency(S_{ij})" display="inline"><semantics id="alg3.l5.m1.1a"><mrow id="alg3.l5.m1.1.1" xref="alg3.l5.m1.1.1.cmml"><msup id="alg3.l5.m1.1.1.3" xref="alg3.l5.m1.1.1.3.cmml"><mi id="alg3.l5.m1.1.1.3.2" xref="alg3.l5.m1.1.1.3.2.cmml">S</mi><mrow id="alg3.l5.m1.1.1.3.3" xref="alg3.l5.m1.1.1.3.3.cmml"><mi id="alg3.l5.m1.1.1.3.3.2" xref="alg3.l5.m1.1.1.3.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.3.3.1" xref="alg3.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l5.m1.1.1.3.3.3" xref="alg3.l5.m1.1.1.3.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.3.3.1a" xref="alg3.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l5.m1.1.1.3.3.4" xref="alg3.l5.m1.1.1.3.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.3.3.1b" xref="alg3.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l5.m1.1.1.3.3.5" xref="alg3.l5.m1.1.1.3.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.3.3.1c" xref="alg3.l5.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l5.m1.1.1.3.3.6" xref="alg3.l5.m1.1.1.3.3.6.cmml">a</mi></mrow></msup><mo stretchy="false" id="alg3.l5.m1.1.1.2" xref="alg3.l5.m1.1.1.2.cmml">←</mo><mrow id="alg3.l5.m1.1.1.1" xref="alg3.l5.m1.1.1.1.cmml"><mi id="alg3.l5.m1.1.1.1.3" xref="alg3.l5.m1.1.1.1.3.cmml">G</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.4" xref="alg3.l5.m1.1.1.1.4.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2a" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.5" xref="alg3.l5.m1.1.1.1.5.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2b" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.6" xref="alg3.l5.m1.1.1.1.6.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2c" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.7" xref="alg3.l5.m1.1.1.1.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2d" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.8" xref="alg3.l5.m1.1.1.1.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2e" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.9" xref="alg3.l5.m1.1.1.1.9.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2f" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.10" xref="alg3.l5.m1.1.1.1.10.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2g" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.11" xref="alg3.l5.m1.1.1.1.11.cmml">D</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2h" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.12" xref="alg3.l5.m1.1.1.1.12.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2i" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.13" xref="alg3.l5.m1.1.1.1.13.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2j" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.14" xref="alg3.l5.m1.1.1.1.14.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2k" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.15" xref="alg3.l5.m1.1.1.1.15.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2l" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.16" xref="alg3.l5.m1.1.1.1.16.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2m" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.17" xref="alg3.l5.m1.1.1.1.17.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2n" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.18" xref="alg3.l5.m1.1.1.1.18.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2o" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.19" xref="alg3.l5.m1.1.1.1.19.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2p" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.20" xref="alg3.l5.m1.1.1.1.20.cmml">y</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.2q" xref="alg3.l5.m1.1.1.1.2.cmml">​</mo><mrow id="alg3.l5.m1.1.1.1.1.1" xref="alg3.l5.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg3.l5.m1.1.1.1.1.1.2" xref="alg3.l5.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg3.l5.m1.1.1.1.1.1.1" xref="alg3.l5.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l5.m1.1.1.1.1.1.1.2" xref="alg3.l5.m1.1.1.1.1.1.1.2.cmml">S</mi><mrow id="alg3.l5.m1.1.1.1.1.1.1.3" xref="alg3.l5.m1.1.1.1.1.1.1.3.cmml"><mi id="alg3.l5.m1.1.1.1.1.1.1.3.2" xref="alg3.l5.m1.1.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l5.m1.1.1.1.1.1.1.3.1" xref="alg3.l5.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l5.m1.1.1.1.1.1.1.3.3" xref="alg3.l5.m1.1.1.1.1.1.1.3.3.cmml">j</mi></mrow></msub><mo stretchy="false" id="alg3.l5.m1.1.1.1.1.1.3" xref="alg3.l5.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l5.m1.1b"><apply id="alg3.l5.m1.1.1.cmml" xref="alg3.l5.m1.1.1"><ci id="alg3.l5.m1.1.1.2.cmml" xref="alg3.l5.m1.1.1.2">←</ci><apply id="alg3.l5.m1.1.1.3.cmml" xref="alg3.l5.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l5.m1.1.1.3.1.cmml" xref="alg3.l5.m1.1.1.3">superscript</csymbol><ci id="alg3.l5.m1.1.1.3.2.cmml" xref="alg3.l5.m1.1.1.3.2">𝑆</ci><apply id="alg3.l5.m1.1.1.3.3.cmml" xref="alg3.l5.m1.1.1.3.3"><times id="alg3.l5.m1.1.1.3.3.1.cmml" xref="alg3.l5.m1.1.1.3.3.1"></times><ci id="alg3.l5.m1.1.1.3.3.2.cmml" xref="alg3.l5.m1.1.1.3.3.2">𝑖</ci><ci id="alg3.l5.m1.1.1.3.3.3.cmml" xref="alg3.l5.m1.1.1.3.3.3">𝑛</ci><ci id="alg3.l5.m1.1.1.3.3.4.cmml" xref="alg3.l5.m1.1.1.3.3.4">𝑡</ci><ci id="alg3.l5.m1.1.1.3.3.5.cmml" xref="alg3.l5.m1.1.1.3.3.5">𝑟</ci><ci id="alg3.l5.m1.1.1.3.3.6.cmml" xref="alg3.l5.m1.1.1.3.3.6">𝑎</ci></apply></apply><apply id="alg3.l5.m1.1.1.1.cmml" xref="alg3.l5.m1.1.1.1"><times id="alg3.l5.m1.1.1.1.2.cmml" xref="alg3.l5.m1.1.1.1.2"></times><ci id="alg3.l5.m1.1.1.1.3.cmml" xref="alg3.l5.m1.1.1.1.3">𝐺</ci><ci id="alg3.l5.m1.1.1.1.4.cmml" xref="alg3.l5.m1.1.1.1.4">𝑒</ci><ci id="alg3.l5.m1.1.1.1.5.cmml" xref="alg3.l5.m1.1.1.1.5">𝑡</ci><ci id="alg3.l5.m1.1.1.1.6.cmml" xref="alg3.l5.m1.1.1.1.6">𝐼</ci><ci id="alg3.l5.m1.1.1.1.7.cmml" xref="alg3.l5.m1.1.1.1.7">𝑛</ci><ci id="alg3.l5.m1.1.1.1.8.cmml" xref="alg3.l5.m1.1.1.1.8">𝑡</ci><ci id="alg3.l5.m1.1.1.1.9.cmml" xref="alg3.l5.m1.1.1.1.9">𝑟</ci><ci id="alg3.l5.m1.1.1.1.10.cmml" xref="alg3.l5.m1.1.1.1.10">𝑎</ci><ci id="alg3.l5.m1.1.1.1.11.cmml" xref="alg3.l5.m1.1.1.1.11">𝐷</ci><ci id="alg3.l5.m1.1.1.1.12.cmml" xref="alg3.l5.m1.1.1.1.12">𝑒</ci><ci id="alg3.l5.m1.1.1.1.13.cmml" xref="alg3.l5.m1.1.1.1.13">𝑝</ci><ci id="alg3.l5.m1.1.1.1.14.cmml" xref="alg3.l5.m1.1.1.1.14">𝑒</ci><ci id="alg3.l5.m1.1.1.1.15.cmml" xref="alg3.l5.m1.1.1.1.15">𝑛</ci><ci id="alg3.l5.m1.1.1.1.16.cmml" xref="alg3.l5.m1.1.1.1.16">𝑑</ci><ci id="alg3.l5.m1.1.1.1.17.cmml" xref="alg3.l5.m1.1.1.1.17">𝑒</ci><ci id="alg3.l5.m1.1.1.1.18.cmml" xref="alg3.l5.m1.1.1.1.18">𝑛</ci><ci id="alg3.l5.m1.1.1.1.19.cmml" xref="alg3.l5.m1.1.1.1.19">𝑐</ci><ci id="alg3.l5.m1.1.1.1.20.cmml" xref="alg3.l5.m1.1.1.1.20">𝑦</ci><apply id="alg3.l5.m1.1.1.1.1.1.1.cmml" xref="alg3.l5.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l5.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l5.m1.1.1.1.1.1">subscript</csymbol><ci id="alg3.l5.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l5.m1.1.1.1.1.1.1.2">𝑆</ci><apply id="alg3.l5.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l5.m1.1.1.1.1.1.1.3"><times id="alg3.l5.m1.1.1.1.1.1.1.3.1.cmml" xref="alg3.l5.m1.1.1.1.1.1.1.3.1"></times><ci id="alg3.l5.m1.1.1.1.1.1.1.3.2.cmml" xref="alg3.l5.m1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="alg3.l5.m1.1.1.1.1.1.1.3.3.cmml" xref="alg3.l5.m1.1.1.1.1.1.1.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l5.m1.1c">S^{intra}\leftarrow GetIntraDependency(S_{ij})</annotation></semantics></math>

</div>
<div id="alg3.l6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l6.1.1.1" class="ltx_text" style="font-size:80%;">6:</span></span>     <math id="alg3.l6.m1.1" class="ltx_Math" alttext="S^{inter}\leftarrow GetInterDependency(S_{ij})" display="inline"><semantics id="alg3.l6.m1.1a"><mrow id="alg3.l6.m1.1.1" xref="alg3.l6.m1.1.1.cmml"><msup id="alg3.l6.m1.1.1.3" xref="alg3.l6.m1.1.1.3.cmml"><mi id="alg3.l6.m1.1.1.3.2" xref="alg3.l6.m1.1.1.3.2.cmml">S</mi><mrow id="alg3.l6.m1.1.1.3.3" xref="alg3.l6.m1.1.1.3.3.cmml"><mi id="alg3.l6.m1.1.1.3.3.2" xref="alg3.l6.m1.1.1.3.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.3.3.1" xref="alg3.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l6.m1.1.1.3.3.3" xref="alg3.l6.m1.1.1.3.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.3.3.1a" xref="alg3.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l6.m1.1.1.3.3.4" xref="alg3.l6.m1.1.1.3.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.3.3.1b" xref="alg3.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l6.m1.1.1.3.3.5" xref="alg3.l6.m1.1.1.3.3.5.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.3.3.1c" xref="alg3.l6.m1.1.1.3.3.1.cmml">​</mo><mi id="alg3.l6.m1.1.1.3.3.6" xref="alg3.l6.m1.1.1.3.3.6.cmml">r</mi></mrow></msup><mo stretchy="false" id="alg3.l6.m1.1.1.2" xref="alg3.l6.m1.1.1.2.cmml">←</mo><mrow id="alg3.l6.m1.1.1.1" xref="alg3.l6.m1.1.1.1.cmml"><mi id="alg3.l6.m1.1.1.1.3" xref="alg3.l6.m1.1.1.1.3.cmml">G</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.4" xref="alg3.l6.m1.1.1.1.4.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2a" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.5" xref="alg3.l6.m1.1.1.1.5.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2b" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.6" xref="alg3.l6.m1.1.1.1.6.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2c" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.7" xref="alg3.l6.m1.1.1.1.7.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2d" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.8" xref="alg3.l6.m1.1.1.1.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2e" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.9" xref="alg3.l6.m1.1.1.1.9.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2f" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.10" xref="alg3.l6.m1.1.1.1.10.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2g" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.11" xref="alg3.l6.m1.1.1.1.11.cmml">D</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2h" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.12" xref="alg3.l6.m1.1.1.1.12.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2i" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.13" xref="alg3.l6.m1.1.1.1.13.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2j" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.14" xref="alg3.l6.m1.1.1.1.14.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2k" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.15" xref="alg3.l6.m1.1.1.1.15.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2l" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.16" xref="alg3.l6.m1.1.1.1.16.cmml">d</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2m" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.17" xref="alg3.l6.m1.1.1.1.17.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2n" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.18" xref="alg3.l6.m1.1.1.1.18.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2o" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.19" xref="alg3.l6.m1.1.1.1.19.cmml">c</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2p" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.20" xref="alg3.l6.m1.1.1.1.20.cmml">y</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.2q" xref="alg3.l6.m1.1.1.1.2.cmml">​</mo><mrow id="alg3.l6.m1.1.1.1.1.1" xref="alg3.l6.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg3.l6.m1.1.1.1.1.1.2" xref="alg3.l6.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg3.l6.m1.1.1.1.1.1.1" xref="alg3.l6.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l6.m1.1.1.1.1.1.1.2" xref="alg3.l6.m1.1.1.1.1.1.1.2.cmml">S</mi><mrow id="alg3.l6.m1.1.1.1.1.1.1.3" xref="alg3.l6.m1.1.1.1.1.1.1.3.cmml"><mi id="alg3.l6.m1.1.1.1.1.1.1.3.2" xref="alg3.l6.m1.1.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l6.m1.1.1.1.1.1.1.3.1" xref="alg3.l6.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l6.m1.1.1.1.1.1.1.3.3" xref="alg3.l6.m1.1.1.1.1.1.1.3.3.cmml">j</mi></mrow></msub><mo stretchy="false" id="alg3.l6.m1.1.1.1.1.1.3" xref="alg3.l6.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l6.m1.1b"><apply id="alg3.l6.m1.1.1.cmml" xref="alg3.l6.m1.1.1"><ci id="alg3.l6.m1.1.1.2.cmml" xref="alg3.l6.m1.1.1.2">←</ci><apply id="alg3.l6.m1.1.1.3.cmml" xref="alg3.l6.m1.1.1.3"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.3.1.cmml" xref="alg3.l6.m1.1.1.3">superscript</csymbol><ci id="alg3.l6.m1.1.1.3.2.cmml" xref="alg3.l6.m1.1.1.3.2">𝑆</ci><apply id="alg3.l6.m1.1.1.3.3.cmml" xref="alg3.l6.m1.1.1.3.3"><times id="alg3.l6.m1.1.1.3.3.1.cmml" xref="alg3.l6.m1.1.1.3.3.1"></times><ci id="alg3.l6.m1.1.1.3.3.2.cmml" xref="alg3.l6.m1.1.1.3.3.2">𝑖</ci><ci id="alg3.l6.m1.1.1.3.3.3.cmml" xref="alg3.l6.m1.1.1.3.3.3">𝑛</ci><ci id="alg3.l6.m1.1.1.3.3.4.cmml" xref="alg3.l6.m1.1.1.3.3.4">𝑡</ci><ci id="alg3.l6.m1.1.1.3.3.5.cmml" xref="alg3.l6.m1.1.1.3.3.5">𝑒</ci><ci id="alg3.l6.m1.1.1.3.3.6.cmml" xref="alg3.l6.m1.1.1.3.3.6">𝑟</ci></apply></apply><apply id="alg3.l6.m1.1.1.1.cmml" xref="alg3.l6.m1.1.1.1"><times id="alg3.l6.m1.1.1.1.2.cmml" xref="alg3.l6.m1.1.1.1.2"></times><ci id="alg3.l6.m1.1.1.1.3.cmml" xref="alg3.l6.m1.1.1.1.3">𝐺</ci><ci id="alg3.l6.m1.1.1.1.4.cmml" xref="alg3.l6.m1.1.1.1.4">𝑒</ci><ci id="alg3.l6.m1.1.1.1.5.cmml" xref="alg3.l6.m1.1.1.1.5">𝑡</ci><ci id="alg3.l6.m1.1.1.1.6.cmml" xref="alg3.l6.m1.1.1.1.6">𝐼</ci><ci id="alg3.l6.m1.1.1.1.7.cmml" xref="alg3.l6.m1.1.1.1.7">𝑛</ci><ci id="alg3.l6.m1.1.1.1.8.cmml" xref="alg3.l6.m1.1.1.1.8">𝑡</ci><ci id="alg3.l6.m1.1.1.1.9.cmml" xref="alg3.l6.m1.1.1.1.9">𝑒</ci><ci id="alg3.l6.m1.1.1.1.10.cmml" xref="alg3.l6.m1.1.1.1.10">𝑟</ci><ci id="alg3.l6.m1.1.1.1.11.cmml" xref="alg3.l6.m1.1.1.1.11">𝐷</ci><ci id="alg3.l6.m1.1.1.1.12.cmml" xref="alg3.l6.m1.1.1.1.12">𝑒</ci><ci id="alg3.l6.m1.1.1.1.13.cmml" xref="alg3.l6.m1.1.1.1.13">𝑝</ci><ci id="alg3.l6.m1.1.1.1.14.cmml" xref="alg3.l6.m1.1.1.1.14">𝑒</ci><ci id="alg3.l6.m1.1.1.1.15.cmml" xref="alg3.l6.m1.1.1.1.15">𝑛</ci><ci id="alg3.l6.m1.1.1.1.16.cmml" xref="alg3.l6.m1.1.1.1.16">𝑑</ci><ci id="alg3.l6.m1.1.1.1.17.cmml" xref="alg3.l6.m1.1.1.1.17">𝑒</ci><ci id="alg3.l6.m1.1.1.1.18.cmml" xref="alg3.l6.m1.1.1.1.18">𝑛</ci><ci id="alg3.l6.m1.1.1.1.19.cmml" xref="alg3.l6.m1.1.1.1.19">𝑐</ci><ci id="alg3.l6.m1.1.1.1.20.cmml" xref="alg3.l6.m1.1.1.1.20">𝑦</ci><apply id="alg3.l6.m1.1.1.1.1.1.1.cmml" xref="alg3.l6.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l6.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l6.m1.1.1.1.1.1">subscript</csymbol><ci id="alg3.l6.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l6.m1.1.1.1.1.1.1.2">𝑆</ci><apply id="alg3.l6.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l6.m1.1.1.1.1.1.1.3"><times id="alg3.l6.m1.1.1.1.1.1.1.3.1.cmml" xref="alg3.l6.m1.1.1.1.1.1.1.3.1"></times><ci id="alg3.l6.m1.1.1.1.1.1.1.3.2.cmml" xref="alg3.l6.m1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="alg3.l6.m1.1.1.1.1.1.1.3.3.cmml" xref="alg3.l6.m1.1.1.1.1.1.1.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l6.m1.1c">S^{inter}\leftarrow GetInterDependency(S_{ij})</annotation></semantics></math>

</div>
<div id="alg3.l7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l7.1.1.1" class="ltx_text" style="font-size:80%;">7:</span></span>     <math id="alg3.l7.m1.1" class="ltx_Math" alttext="IntraTime\leftarrow ComputeFinishTime(S^{intra})" display="inline"><semantics id="alg3.l7.m1.1a"><mrow id="alg3.l7.m1.1.1" xref="alg3.l7.m1.1.1.cmml"><mrow id="alg3.l7.m1.1.1.3" xref="alg3.l7.m1.1.1.3.cmml"><mi id="alg3.l7.m1.1.1.3.2" xref="alg3.l7.m1.1.1.3.2.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.3" xref="alg3.l7.m1.1.1.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1a" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.4" xref="alg3.l7.m1.1.1.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1b" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.5" xref="alg3.l7.m1.1.1.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1c" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.6" xref="alg3.l7.m1.1.1.3.6.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1d" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.7" xref="alg3.l7.m1.1.1.3.7.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1e" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.8" xref="alg3.l7.m1.1.1.3.8.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1f" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.9" xref="alg3.l7.m1.1.1.3.9.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.3.1g" xref="alg3.l7.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.3.10" xref="alg3.l7.m1.1.1.3.10.cmml">e</mi></mrow><mo stretchy="false" id="alg3.l7.m1.1.1.2" xref="alg3.l7.m1.1.1.2.cmml">←</mo><mrow id="alg3.l7.m1.1.1.1" xref="alg3.l7.m1.1.1.1.cmml"><mi id="alg3.l7.m1.1.1.1.3" xref="alg3.l7.m1.1.1.1.3.cmml">C</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.4" xref="alg3.l7.m1.1.1.1.4.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2a" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.5" xref="alg3.l7.m1.1.1.1.5.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2b" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.6" xref="alg3.l7.m1.1.1.1.6.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2c" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.7" xref="alg3.l7.m1.1.1.1.7.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2d" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.8" xref="alg3.l7.m1.1.1.1.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2e" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.9" xref="alg3.l7.m1.1.1.1.9.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2f" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.10" xref="alg3.l7.m1.1.1.1.10.cmml">F</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2g" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.11" xref="alg3.l7.m1.1.1.1.11.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2h" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.12" xref="alg3.l7.m1.1.1.1.12.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2i" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.13" xref="alg3.l7.m1.1.1.1.13.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2j" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.14" xref="alg3.l7.m1.1.1.1.14.cmml">s</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2k" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.15" xref="alg3.l7.m1.1.1.1.15.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2l" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.16" xref="alg3.l7.m1.1.1.1.16.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2m" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.17" xref="alg3.l7.m1.1.1.1.17.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2n" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.18" xref="alg3.l7.m1.1.1.1.18.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2o" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.19" xref="alg3.l7.m1.1.1.1.19.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.2p" xref="alg3.l7.m1.1.1.1.2.cmml">​</mo><mrow id="alg3.l7.m1.1.1.1.1.1" xref="alg3.l7.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg3.l7.m1.1.1.1.1.1.2" xref="alg3.l7.m1.1.1.1.1.1.1.cmml">(</mo><msup id="alg3.l7.m1.1.1.1.1.1.1" xref="alg3.l7.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l7.m1.1.1.1.1.1.1.2" xref="alg3.l7.m1.1.1.1.1.1.1.2.cmml">S</mi><mrow id="alg3.l7.m1.1.1.1.1.1.1.3" xref="alg3.l7.m1.1.1.1.1.1.1.3.cmml"><mi id="alg3.l7.m1.1.1.1.1.1.1.3.2" xref="alg3.l7.m1.1.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.1.1.1.3.1" xref="alg3.l7.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.1.1.1.3.3" xref="alg3.l7.m1.1.1.1.1.1.1.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.1.1.1.3.1a" xref="alg3.l7.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.1.1.1.3.4" xref="alg3.l7.m1.1.1.1.1.1.1.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.1.1.1.3.1b" xref="alg3.l7.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.1.1.1.3.5" xref="alg3.l7.m1.1.1.1.1.1.1.3.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l7.m1.1.1.1.1.1.1.3.1c" xref="alg3.l7.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l7.m1.1.1.1.1.1.1.3.6" xref="alg3.l7.m1.1.1.1.1.1.1.3.6.cmml">a</mi></mrow></msup><mo stretchy="false" id="alg3.l7.m1.1.1.1.1.1.3" xref="alg3.l7.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l7.m1.1b"><apply id="alg3.l7.m1.1.1.cmml" xref="alg3.l7.m1.1.1"><ci id="alg3.l7.m1.1.1.2.cmml" xref="alg3.l7.m1.1.1.2">←</ci><apply id="alg3.l7.m1.1.1.3.cmml" xref="alg3.l7.m1.1.1.3"><times id="alg3.l7.m1.1.1.3.1.cmml" xref="alg3.l7.m1.1.1.3.1"></times><ci id="alg3.l7.m1.1.1.3.2.cmml" xref="alg3.l7.m1.1.1.3.2">𝐼</ci><ci id="alg3.l7.m1.1.1.3.3.cmml" xref="alg3.l7.m1.1.1.3.3">𝑛</ci><ci id="alg3.l7.m1.1.1.3.4.cmml" xref="alg3.l7.m1.1.1.3.4">𝑡</ci><ci id="alg3.l7.m1.1.1.3.5.cmml" xref="alg3.l7.m1.1.1.3.5">𝑟</ci><ci id="alg3.l7.m1.1.1.3.6.cmml" xref="alg3.l7.m1.1.1.3.6">𝑎</ci><ci id="alg3.l7.m1.1.1.3.7.cmml" xref="alg3.l7.m1.1.1.3.7">𝑇</ci><ci id="alg3.l7.m1.1.1.3.8.cmml" xref="alg3.l7.m1.1.1.3.8">𝑖</ci><ci id="alg3.l7.m1.1.1.3.9.cmml" xref="alg3.l7.m1.1.1.3.9">𝑚</ci><ci id="alg3.l7.m1.1.1.3.10.cmml" xref="alg3.l7.m1.1.1.3.10">𝑒</ci></apply><apply id="alg3.l7.m1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1"><times id="alg3.l7.m1.1.1.1.2.cmml" xref="alg3.l7.m1.1.1.1.2"></times><ci id="alg3.l7.m1.1.1.1.3.cmml" xref="alg3.l7.m1.1.1.1.3">𝐶</ci><ci id="alg3.l7.m1.1.1.1.4.cmml" xref="alg3.l7.m1.1.1.1.4">𝑜</ci><ci id="alg3.l7.m1.1.1.1.5.cmml" xref="alg3.l7.m1.1.1.1.5">𝑚</ci><ci id="alg3.l7.m1.1.1.1.6.cmml" xref="alg3.l7.m1.1.1.1.6">𝑝</ci><ci id="alg3.l7.m1.1.1.1.7.cmml" xref="alg3.l7.m1.1.1.1.7">𝑢</ci><ci id="alg3.l7.m1.1.1.1.8.cmml" xref="alg3.l7.m1.1.1.1.8">𝑡</ci><ci id="alg3.l7.m1.1.1.1.9.cmml" xref="alg3.l7.m1.1.1.1.9">𝑒</ci><ci id="alg3.l7.m1.1.1.1.10.cmml" xref="alg3.l7.m1.1.1.1.10">𝐹</ci><ci id="alg3.l7.m1.1.1.1.11.cmml" xref="alg3.l7.m1.1.1.1.11">𝑖</ci><ci id="alg3.l7.m1.1.1.1.12.cmml" xref="alg3.l7.m1.1.1.1.12">𝑛</ci><ci id="alg3.l7.m1.1.1.1.13.cmml" xref="alg3.l7.m1.1.1.1.13">𝑖</ci><ci id="alg3.l7.m1.1.1.1.14.cmml" xref="alg3.l7.m1.1.1.1.14">𝑠</ci><ci id="alg3.l7.m1.1.1.1.15.cmml" xref="alg3.l7.m1.1.1.1.15">ℎ</ci><ci id="alg3.l7.m1.1.1.1.16.cmml" xref="alg3.l7.m1.1.1.1.16">𝑇</ci><ci id="alg3.l7.m1.1.1.1.17.cmml" xref="alg3.l7.m1.1.1.1.17">𝑖</ci><ci id="alg3.l7.m1.1.1.1.18.cmml" xref="alg3.l7.m1.1.1.1.18">𝑚</ci><ci id="alg3.l7.m1.1.1.1.19.cmml" xref="alg3.l7.m1.1.1.1.19">𝑒</ci><apply id="alg3.l7.m1.1.1.1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l7.m1.1.1.1.1.1">superscript</csymbol><ci id="alg3.l7.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.2">𝑆</ci><apply id="alg3.l7.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3"><times id="alg3.l7.m1.1.1.1.1.1.1.3.1.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.1"></times><ci id="alg3.l7.m1.1.1.1.1.1.1.3.2.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.3.3.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.3">𝑛</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.3.4.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.4">𝑡</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.3.5.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.5">𝑟</ci><ci id="alg3.l7.m1.1.1.1.1.1.1.3.6.cmml" xref="alg3.l7.m1.1.1.1.1.1.1.3.6">𝑎</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l7.m1.1c">IntraTime\leftarrow ComputeFinishTime(S^{intra})</annotation></semantics></math>

</div>
<div id="alg3.l8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l8.1.1.1" class="ltx_text" style="font-size:80%;">8:</span></span>     <math id="alg3.l8.m1.1" class="ltx_Math" alttext="InterTime\leftarrow ComputeFinishTime(S^{inter})" display="inline"><semantics id="alg3.l8.m1.1a"><mrow id="alg3.l8.m1.1.1" xref="alg3.l8.m1.1.1.cmml"><mrow id="alg3.l8.m1.1.1.3" xref="alg3.l8.m1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.3.2" xref="alg3.l8.m1.1.1.3.2.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.3" xref="alg3.l8.m1.1.1.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1a" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.4" xref="alg3.l8.m1.1.1.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1b" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.5" xref="alg3.l8.m1.1.1.3.5.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1c" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.6" xref="alg3.l8.m1.1.1.3.6.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1d" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.7" xref="alg3.l8.m1.1.1.3.7.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1e" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.8" xref="alg3.l8.m1.1.1.3.8.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1f" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.9" xref="alg3.l8.m1.1.1.3.9.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.3.1g" xref="alg3.l8.m1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.3.10" xref="alg3.l8.m1.1.1.3.10.cmml">e</mi></mrow><mo stretchy="false" id="alg3.l8.m1.1.1.2" xref="alg3.l8.m1.1.1.2.cmml">←</mo><mrow id="alg3.l8.m1.1.1.1" xref="alg3.l8.m1.1.1.1.cmml"><mi id="alg3.l8.m1.1.1.1.3" xref="alg3.l8.m1.1.1.1.3.cmml">C</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.4" xref="alg3.l8.m1.1.1.1.4.cmml">o</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2a" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.5" xref="alg3.l8.m1.1.1.1.5.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2b" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.6" xref="alg3.l8.m1.1.1.1.6.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2c" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.7" xref="alg3.l8.m1.1.1.1.7.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2d" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.8" xref="alg3.l8.m1.1.1.1.8.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2e" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.9" xref="alg3.l8.m1.1.1.1.9.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2f" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.10" xref="alg3.l8.m1.1.1.1.10.cmml">F</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2g" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.11" xref="alg3.l8.m1.1.1.1.11.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2h" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.12" xref="alg3.l8.m1.1.1.1.12.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2i" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.13" xref="alg3.l8.m1.1.1.1.13.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2j" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.14" xref="alg3.l8.m1.1.1.1.14.cmml">s</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2k" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.15" xref="alg3.l8.m1.1.1.1.15.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2l" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.16" xref="alg3.l8.m1.1.1.1.16.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2m" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.17" xref="alg3.l8.m1.1.1.1.17.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2n" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.18" xref="alg3.l8.m1.1.1.1.18.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2o" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.19" xref="alg3.l8.m1.1.1.1.19.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.2p" xref="alg3.l8.m1.1.1.1.2.cmml">​</mo><mrow id="alg3.l8.m1.1.1.1.1.1" xref="alg3.l8.m1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="alg3.l8.m1.1.1.1.1.1.2" xref="alg3.l8.m1.1.1.1.1.1.1.cmml">(</mo><msup id="alg3.l8.m1.1.1.1.1.1.1" xref="alg3.l8.m1.1.1.1.1.1.1.cmml"><mi id="alg3.l8.m1.1.1.1.1.1.1.2" xref="alg3.l8.m1.1.1.1.1.1.1.2.cmml">S</mi><mrow id="alg3.l8.m1.1.1.1.1.1.1.3" xref="alg3.l8.m1.1.1.1.1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.1.1.1.1.3.2" xref="alg3.l8.m1.1.1.1.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.1.1.1.3.1" xref="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.1.1.1.3.3" xref="alg3.l8.m1.1.1.1.1.1.1.3.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.1.1.1.3.1a" xref="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.1.1.1.3.4" xref="alg3.l8.m1.1.1.1.1.1.1.3.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.1.1.1.3.1b" xref="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.1.1.1.3.5" xref="alg3.l8.m1.1.1.1.1.1.1.3.5.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l8.m1.1.1.1.1.1.1.3.1c" xref="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml">​</mo><mi id="alg3.l8.m1.1.1.1.1.1.1.3.6" xref="alg3.l8.m1.1.1.1.1.1.1.3.6.cmml">r</mi></mrow></msup><mo stretchy="false" id="alg3.l8.m1.1.1.1.1.1.3" xref="alg3.l8.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l8.m1.1b"><apply id="alg3.l8.m1.1.1.cmml" xref="alg3.l8.m1.1.1"><ci id="alg3.l8.m1.1.1.2.cmml" xref="alg3.l8.m1.1.1.2">←</ci><apply id="alg3.l8.m1.1.1.3.cmml" xref="alg3.l8.m1.1.1.3"><times id="alg3.l8.m1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.3.1"></times><ci id="alg3.l8.m1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.3.2">𝐼</ci><ci id="alg3.l8.m1.1.1.3.3.cmml" xref="alg3.l8.m1.1.1.3.3">𝑛</ci><ci id="alg3.l8.m1.1.1.3.4.cmml" xref="alg3.l8.m1.1.1.3.4">𝑡</ci><ci id="alg3.l8.m1.1.1.3.5.cmml" xref="alg3.l8.m1.1.1.3.5">𝑒</ci><ci id="alg3.l8.m1.1.1.3.6.cmml" xref="alg3.l8.m1.1.1.3.6">𝑟</ci><ci id="alg3.l8.m1.1.1.3.7.cmml" xref="alg3.l8.m1.1.1.3.7">𝑇</ci><ci id="alg3.l8.m1.1.1.3.8.cmml" xref="alg3.l8.m1.1.1.3.8">𝑖</ci><ci id="alg3.l8.m1.1.1.3.9.cmml" xref="alg3.l8.m1.1.1.3.9">𝑚</ci><ci id="alg3.l8.m1.1.1.3.10.cmml" xref="alg3.l8.m1.1.1.3.10">𝑒</ci></apply><apply id="alg3.l8.m1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1"><times id="alg3.l8.m1.1.1.1.2.cmml" xref="alg3.l8.m1.1.1.1.2"></times><ci id="alg3.l8.m1.1.1.1.3.cmml" xref="alg3.l8.m1.1.1.1.3">𝐶</ci><ci id="alg3.l8.m1.1.1.1.4.cmml" xref="alg3.l8.m1.1.1.1.4">𝑜</ci><ci id="alg3.l8.m1.1.1.1.5.cmml" xref="alg3.l8.m1.1.1.1.5">𝑚</ci><ci id="alg3.l8.m1.1.1.1.6.cmml" xref="alg3.l8.m1.1.1.1.6">𝑝</ci><ci id="alg3.l8.m1.1.1.1.7.cmml" xref="alg3.l8.m1.1.1.1.7">𝑢</ci><ci id="alg3.l8.m1.1.1.1.8.cmml" xref="alg3.l8.m1.1.1.1.8">𝑡</ci><ci id="alg3.l8.m1.1.1.1.9.cmml" xref="alg3.l8.m1.1.1.1.9">𝑒</ci><ci id="alg3.l8.m1.1.1.1.10.cmml" xref="alg3.l8.m1.1.1.1.10">𝐹</ci><ci id="alg3.l8.m1.1.1.1.11.cmml" xref="alg3.l8.m1.1.1.1.11">𝑖</ci><ci id="alg3.l8.m1.1.1.1.12.cmml" xref="alg3.l8.m1.1.1.1.12">𝑛</ci><ci id="alg3.l8.m1.1.1.1.13.cmml" xref="alg3.l8.m1.1.1.1.13">𝑖</ci><ci id="alg3.l8.m1.1.1.1.14.cmml" xref="alg3.l8.m1.1.1.1.14">𝑠</ci><ci id="alg3.l8.m1.1.1.1.15.cmml" xref="alg3.l8.m1.1.1.1.15">ℎ</ci><ci id="alg3.l8.m1.1.1.1.16.cmml" xref="alg3.l8.m1.1.1.1.16">𝑇</ci><ci id="alg3.l8.m1.1.1.1.17.cmml" xref="alg3.l8.m1.1.1.1.17">𝑖</ci><ci id="alg3.l8.m1.1.1.1.18.cmml" xref="alg3.l8.m1.1.1.1.18">𝑚</ci><ci id="alg3.l8.m1.1.1.1.19.cmml" xref="alg3.l8.m1.1.1.1.19">𝑒</ci><apply id="alg3.l8.m1.1.1.1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg3.l8.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l8.m1.1.1.1.1.1">superscript</csymbol><ci id="alg3.l8.m1.1.1.1.1.1.1.2.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.2">𝑆</ci><apply id="alg3.l8.m1.1.1.1.1.1.1.3.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3"><times id="alg3.l8.m1.1.1.1.1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.1"></times><ci id="alg3.l8.m1.1.1.1.1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.2">𝑖</ci><ci id="alg3.l8.m1.1.1.1.1.1.1.3.3.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.3">𝑛</ci><ci id="alg3.l8.m1.1.1.1.1.1.1.3.4.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.4">𝑡</ci><ci id="alg3.l8.m1.1.1.1.1.1.1.3.5.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.5">𝑒</ci><ci id="alg3.l8.m1.1.1.1.1.1.1.3.6.cmml" xref="alg3.l8.m1.1.1.1.1.1.1.3.6">𝑟</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l8.m1.1c">InterTime\leftarrow ComputeFinishTime(S^{inter})</annotation></semantics></math>

</div>
<div id="alg3.l9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l9.1.1.1" class="ltx_text" style="font-size:80%;">9:</span></span>     <math id="alg3.l9.m1.2" class="ltx_Math" alttext="FinishTime=max(IntraTime,InterTime)+l_{ij}" display="inline"><semantics id="alg3.l9.m1.2a"><mrow id="alg3.l9.m1.2.2" xref="alg3.l9.m1.2.2.cmml"><mrow id="alg3.l9.m1.2.2.4" xref="alg3.l9.m1.2.2.4.cmml"><mi id="alg3.l9.m1.2.2.4.2" xref="alg3.l9.m1.2.2.4.2.cmml">F</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.3" xref="alg3.l9.m1.2.2.4.3.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1a" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.4" xref="alg3.l9.m1.2.2.4.4.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1b" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.5" xref="alg3.l9.m1.2.2.4.5.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1c" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.6" xref="alg3.l9.m1.2.2.4.6.cmml">s</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1d" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.7" xref="alg3.l9.m1.2.2.4.7.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1e" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.8" xref="alg3.l9.m1.2.2.4.8.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1f" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.9" xref="alg3.l9.m1.2.2.4.9.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1g" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.10" xref="alg3.l9.m1.2.2.4.10.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.4.1h" xref="alg3.l9.m1.2.2.4.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.4.11" xref="alg3.l9.m1.2.2.4.11.cmml">e</mi></mrow><mo id="alg3.l9.m1.2.2.3" xref="alg3.l9.m1.2.2.3.cmml">=</mo><mrow id="alg3.l9.m1.2.2.2" xref="alg3.l9.m1.2.2.2.cmml"><mrow id="alg3.l9.m1.2.2.2.2" xref="alg3.l9.m1.2.2.2.2.cmml"><mi id="alg3.l9.m1.2.2.2.2.4" xref="alg3.l9.m1.2.2.2.2.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.3" xref="alg3.l9.m1.2.2.2.2.3.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.5" xref="alg3.l9.m1.2.2.2.2.5.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.3a" xref="alg3.l9.m1.2.2.2.2.3.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.6" xref="alg3.l9.m1.2.2.2.2.6.cmml">x</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.3b" xref="alg3.l9.m1.2.2.2.2.3.cmml">​</mo><mrow id="alg3.l9.m1.2.2.2.2.2.2" xref="alg3.l9.m1.2.2.2.2.2.3.cmml"><mo stretchy="false" id="alg3.l9.m1.2.2.2.2.2.2.3" xref="alg3.l9.m1.2.2.2.2.2.3.cmml">(</mo><mrow id="alg3.l9.m1.1.1.1.1.1.1.1" xref="alg3.l9.m1.1.1.1.1.1.1.1.cmml"><mi id="alg3.l9.m1.1.1.1.1.1.1.1.2" xref="alg3.l9.m1.1.1.1.1.1.1.1.2.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.3" xref="alg3.l9.m1.1.1.1.1.1.1.1.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1a" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.4" xref="alg3.l9.m1.1.1.1.1.1.1.1.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1b" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.5" xref="alg3.l9.m1.1.1.1.1.1.1.1.5.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1c" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.6" xref="alg3.l9.m1.1.1.1.1.1.1.1.6.cmml">a</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1d" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.7" xref="alg3.l9.m1.1.1.1.1.1.1.1.7.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1e" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.8" xref="alg3.l9.m1.1.1.1.1.1.1.1.8.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1f" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.9" xref="alg3.l9.m1.1.1.1.1.1.1.1.9.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.1.1.1.1.1.1.1.1g" xref="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l9.m1.1.1.1.1.1.1.1.10" xref="alg3.l9.m1.1.1.1.1.1.1.1.10.cmml">e</mi></mrow><mo id="alg3.l9.m1.2.2.2.2.2.2.4" xref="alg3.l9.m1.2.2.2.2.2.3.cmml">,</mo><mrow id="alg3.l9.m1.2.2.2.2.2.2.2" xref="alg3.l9.m1.2.2.2.2.2.2.2.cmml"><mi id="alg3.l9.m1.2.2.2.2.2.2.2.2" xref="alg3.l9.m1.2.2.2.2.2.2.2.2.cmml">I</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.3" xref="alg3.l9.m1.2.2.2.2.2.2.2.3.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1a" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.4" xref="alg3.l9.m1.2.2.2.2.2.2.2.4.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1b" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.5" xref="alg3.l9.m1.2.2.2.2.2.2.2.5.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1c" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.6" xref="alg3.l9.m1.2.2.2.2.2.2.2.6.cmml">r</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1d" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.7" xref="alg3.l9.m1.2.2.2.2.2.2.2.7.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1e" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.8" xref="alg3.l9.m1.2.2.2.2.2.2.2.8.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1f" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.9" xref="alg3.l9.m1.2.2.2.2.2.2.2.9.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.2.2.2.2.1g" xref="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.2.2.2.2.10" xref="alg3.l9.m1.2.2.2.2.2.2.2.10.cmml">e</mi></mrow><mo stretchy="false" id="alg3.l9.m1.2.2.2.2.2.2.5" xref="alg3.l9.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg3.l9.m1.2.2.2.3" xref="alg3.l9.m1.2.2.2.3.cmml">+</mo><msub id="alg3.l9.m1.2.2.2.4" xref="alg3.l9.m1.2.2.2.4.cmml"><mi id="alg3.l9.m1.2.2.2.4.2" xref="alg3.l9.m1.2.2.2.4.2.cmml">l</mi><mrow id="alg3.l9.m1.2.2.2.4.3" xref="alg3.l9.m1.2.2.2.4.3.cmml"><mi id="alg3.l9.m1.2.2.2.4.3.2" xref="alg3.l9.m1.2.2.2.4.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l9.m1.2.2.2.4.3.1" xref="alg3.l9.m1.2.2.2.4.3.1.cmml">​</mo><mi id="alg3.l9.m1.2.2.2.4.3.3" xref="alg3.l9.m1.2.2.2.4.3.3.cmml">j</mi></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l9.m1.2b"><apply id="alg3.l9.m1.2.2.cmml" xref="alg3.l9.m1.2.2"><eq id="alg3.l9.m1.2.2.3.cmml" xref="alg3.l9.m1.2.2.3"></eq><apply id="alg3.l9.m1.2.2.4.cmml" xref="alg3.l9.m1.2.2.4"><times id="alg3.l9.m1.2.2.4.1.cmml" xref="alg3.l9.m1.2.2.4.1"></times><ci id="alg3.l9.m1.2.2.4.2.cmml" xref="alg3.l9.m1.2.2.4.2">𝐹</ci><ci id="alg3.l9.m1.2.2.4.3.cmml" xref="alg3.l9.m1.2.2.4.3">𝑖</ci><ci id="alg3.l9.m1.2.2.4.4.cmml" xref="alg3.l9.m1.2.2.4.4">𝑛</ci><ci id="alg3.l9.m1.2.2.4.5.cmml" xref="alg3.l9.m1.2.2.4.5">𝑖</ci><ci id="alg3.l9.m1.2.2.4.6.cmml" xref="alg3.l9.m1.2.2.4.6">𝑠</ci><ci id="alg3.l9.m1.2.2.4.7.cmml" xref="alg3.l9.m1.2.2.4.7">ℎ</ci><ci id="alg3.l9.m1.2.2.4.8.cmml" xref="alg3.l9.m1.2.2.4.8">𝑇</ci><ci id="alg3.l9.m1.2.2.4.9.cmml" xref="alg3.l9.m1.2.2.4.9">𝑖</ci><ci id="alg3.l9.m1.2.2.4.10.cmml" xref="alg3.l9.m1.2.2.4.10">𝑚</ci><ci id="alg3.l9.m1.2.2.4.11.cmml" xref="alg3.l9.m1.2.2.4.11">𝑒</ci></apply><apply id="alg3.l9.m1.2.2.2.cmml" xref="alg3.l9.m1.2.2.2"><plus id="alg3.l9.m1.2.2.2.3.cmml" xref="alg3.l9.m1.2.2.2.3"></plus><apply id="alg3.l9.m1.2.2.2.2.cmml" xref="alg3.l9.m1.2.2.2.2"><times id="alg3.l9.m1.2.2.2.2.3.cmml" xref="alg3.l9.m1.2.2.2.2.3"></times><ci id="alg3.l9.m1.2.2.2.2.4.cmml" xref="alg3.l9.m1.2.2.2.2.4">𝑚</ci><ci id="alg3.l9.m1.2.2.2.2.5.cmml" xref="alg3.l9.m1.2.2.2.2.5">𝑎</ci><ci id="alg3.l9.m1.2.2.2.2.6.cmml" xref="alg3.l9.m1.2.2.2.2.6">𝑥</ci><interval closure="open" id="alg3.l9.m1.2.2.2.2.2.3.cmml" xref="alg3.l9.m1.2.2.2.2.2.2"><apply id="alg3.l9.m1.1.1.1.1.1.1.1.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1"><times id="alg3.l9.m1.1.1.1.1.1.1.1.1.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.1"></times><ci id="alg3.l9.m1.1.1.1.1.1.1.1.2.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.2">𝐼</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.3.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.3">𝑛</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.4.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.4">𝑡</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.5.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.5">𝑟</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.6.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.6">𝑎</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.7.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.7">𝑇</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.8.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.8">𝑖</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.9.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.9">𝑚</ci><ci id="alg3.l9.m1.1.1.1.1.1.1.1.10.cmml" xref="alg3.l9.m1.1.1.1.1.1.1.1.10">𝑒</ci></apply><apply id="alg3.l9.m1.2.2.2.2.2.2.2.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2"><times id="alg3.l9.m1.2.2.2.2.2.2.2.1.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.1"></times><ci id="alg3.l9.m1.2.2.2.2.2.2.2.2.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.2">𝐼</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.3.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.3">𝑛</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.4.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.4">𝑡</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.5.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.5">𝑒</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.6.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.6">𝑟</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.7.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.7">𝑇</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.8.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.8">𝑖</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.9.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.9">𝑚</ci><ci id="alg3.l9.m1.2.2.2.2.2.2.2.10.cmml" xref="alg3.l9.m1.2.2.2.2.2.2.2.10">𝑒</ci></apply></interval></apply><apply id="alg3.l9.m1.2.2.2.4.cmml" xref="alg3.l9.m1.2.2.2.4"><csymbol cd="ambiguous" id="alg3.l9.m1.2.2.2.4.1.cmml" xref="alg3.l9.m1.2.2.2.4">subscript</csymbol><ci id="alg3.l9.m1.2.2.2.4.2.cmml" xref="alg3.l9.m1.2.2.2.4.2">𝑙</ci><apply id="alg3.l9.m1.2.2.2.4.3.cmml" xref="alg3.l9.m1.2.2.2.4.3"><times id="alg3.l9.m1.2.2.2.4.3.1.cmml" xref="alg3.l9.m1.2.2.2.4.3.1"></times><ci id="alg3.l9.m1.2.2.2.4.3.2.cmml" xref="alg3.l9.m1.2.2.2.4.3.2">𝑖</ci><ci id="alg3.l9.m1.2.2.2.4.3.3.cmml" xref="alg3.l9.m1.2.2.2.4.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l9.m1.2c">FinishTime=max(IntraTime,InterTime)+l_{ij}</annotation></semantics></math>

</div>
<div id="alg3.l10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l10.1.1.1" class="ltx_text" style="font-size:80%;">10:</span></span>     <math id="alg3.l10.m1.2" class="ltx_Math" alttext="Memo.put(S_{ij},FinishTime)" display="inline"><semantics id="alg3.l10.m1.2a"><mrow id="alg3.l10.m1.2.2.2" xref="alg3.l10.m1.2.2.3.cmml"><mrow id="alg3.l10.m1.1.1.1.1" xref="alg3.l10.m1.1.1.1.1.cmml"><mi id="alg3.l10.m1.1.1.1.1.2" xref="alg3.l10.m1.1.1.1.1.2.cmml">M</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.1.1.1.1.1" xref="alg3.l10.m1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l10.m1.1.1.1.1.3" xref="alg3.l10.m1.1.1.1.1.3.cmml">e</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.1.1.1.1.1a" xref="alg3.l10.m1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l10.m1.1.1.1.1.4" xref="alg3.l10.m1.1.1.1.1.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.1.1.1.1.1b" xref="alg3.l10.m1.1.1.1.1.1.cmml">​</mo><mi id="alg3.l10.m1.1.1.1.1.5" xref="alg3.l10.m1.1.1.1.1.5.cmml">o</mi></mrow><mo lspace="0em" rspace="0.167em" id="alg3.l10.m1.2.2.2.3" xref="alg3.l10.m1.2.2.3a.cmml">.</mo><mrow id="alg3.l10.m1.2.2.2.2" xref="alg3.l10.m1.2.2.2.2.cmml"><mi id="alg3.l10.m1.2.2.2.2.4" xref="alg3.l10.m1.2.2.2.2.4.cmml">p</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.3" xref="alg3.l10.m1.2.2.2.2.3.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.5" xref="alg3.l10.m1.2.2.2.2.5.cmml">u</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.3a" xref="alg3.l10.m1.2.2.2.2.3.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.6" xref="alg3.l10.m1.2.2.2.2.6.cmml">t</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.3b" xref="alg3.l10.m1.2.2.2.2.3.cmml">​</mo><mrow id="alg3.l10.m1.2.2.2.2.2.2" xref="alg3.l10.m1.2.2.2.2.2.3.cmml"><mo stretchy="false" id="alg3.l10.m1.2.2.2.2.2.2.3" xref="alg3.l10.m1.2.2.2.2.2.3.cmml">(</mo><msub id="alg3.l10.m1.2.2.2.2.1.1.1" xref="alg3.l10.m1.2.2.2.2.1.1.1.cmml"><mi id="alg3.l10.m1.2.2.2.2.1.1.1.2" xref="alg3.l10.m1.2.2.2.2.1.1.1.2.cmml">S</mi><mrow id="alg3.l10.m1.2.2.2.2.1.1.1.3" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.cmml"><mi id="alg3.l10.m1.2.2.2.2.1.1.1.3.2" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.1.1.1.3.1" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.1.1.1.3.3" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.3.cmml">j</mi></mrow></msub><mo id="alg3.l10.m1.2.2.2.2.2.2.4" xref="alg3.l10.m1.2.2.2.2.2.3.cmml">,</mo><mrow id="alg3.l10.m1.2.2.2.2.2.2.2" xref="alg3.l10.m1.2.2.2.2.2.2.2.cmml"><mi id="alg3.l10.m1.2.2.2.2.2.2.2.2" xref="alg3.l10.m1.2.2.2.2.2.2.2.2.cmml">F</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.3" xref="alg3.l10.m1.2.2.2.2.2.2.2.3.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1a" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.4" xref="alg3.l10.m1.2.2.2.2.2.2.2.4.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1b" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.5" xref="alg3.l10.m1.2.2.2.2.2.2.2.5.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1c" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.6" xref="alg3.l10.m1.2.2.2.2.2.2.2.6.cmml">s</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1d" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.7" xref="alg3.l10.m1.2.2.2.2.2.2.2.7.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1e" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.8" xref="alg3.l10.m1.2.2.2.2.2.2.2.8.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1f" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.9" xref="alg3.l10.m1.2.2.2.2.2.2.2.9.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1g" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.10" xref="alg3.l10.m1.2.2.2.2.2.2.2.10.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l10.m1.2.2.2.2.2.2.2.1h" xref="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml">​</mo><mi id="alg3.l10.m1.2.2.2.2.2.2.2.11" xref="alg3.l10.m1.2.2.2.2.2.2.2.11.cmml">e</mi></mrow><mo stretchy="false" id="alg3.l10.m1.2.2.2.2.2.2.5" xref="alg3.l10.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg3.l10.m1.2b"><apply id="alg3.l10.m1.2.2.3.cmml" xref="alg3.l10.m1.2.2.2"><csymbol cd="ambiguous" id="alg3.l10.m1.2.2.3a.cmml" xref="alg3.l10.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg3.l10.m1.1.1.1.1.cmml" xref="alg3.l10.m1.1.1.1.1"><times id="alg3.l10.m1.1.1.1.1.1.cmml" xref="alg3.l10.m1.1.1.1.1.1"></times><ci id="alg3.l10.m1.1.1.1.1.2.cmml" xref="alg3.l10.m1.1.1.1.1.2">𝑀</ci><ci id="alg3.l10.m1.1.1.1.1.3.cmml" xref="alg3.l10.m1.1.1.1.1.3">𝑒</ci><ci id="alg3.l10.m1.1.1.1.1.4.cmml" xref="alg3.l10.m1.1.1.1.1.4">𝑚</ci><ci id="alg3.l10.m1.1.1.1.1.5.cmml" xref="alg3.l10.m1.1.1.1.1.5">𝑜</ci></apply><apply id="alg3.l10.m1.2.2.2.2.cmml" xref="alg3.l10.m1.2.2.2.2"><times id="alg3.l10.m1.2.2.2.2.3.cmml" xref="alg3.l10.m1.2.2.2.2.3"></times><ci id="alg3.l10.m1.2.2.2.2.4.cmml" xref="alg3.l10.m1.2.2.2.2.4">𝑝</ci><ci id="alg3.l10.m1.2.2.2.2.5.cmml" xref="alg3.l10.m1.2.2.2.2.5">𝑢</ci><ci id="alg3.l10.m1.2.2.2.2.6.cmml" xref="alg3.l10.m1.2.2.2.2.6">𝑡</ci><interval closure="open" id="alg3.l10.m1.2.2.2.2.2.3.cmml" xref="alg3.l10.m1.2.2.2.2.2.2"><apply id="alg3.l10.m1.2.2.2.2.1.1.1.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1"><csymbol cd="ambiguous" id="alg3.l10.m1.2.2.2.2.1.1.1.1.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1">subscript</csymbol><ci id="alg3.l10.m1.2.2.2.2.1.1.1.2.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1.2">𝑆</ci><apply id="alg3.l10.m1.2.2.2.2.1.1.1.3.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1.3"><times id="alg3.l10.m1.2.2.2.2.1.1.1.3.1.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.1"></times><ci id="alg3.l10.m1.2.2.2.2.1.1.1.3.2.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.2">𝑖</ci><ci id="alg3.l10.m1.2.2.2.2.1.1.1.3.3.cmml" xref="alg3.l10.m1.2.2.2.2.1.1.1.3.3">𝑗</ci></apply></apply><apply id="alg3.l10.m1.2.2.2.2.2.2.2.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2"><times id="alg3.l10.m1.2.2.2.2.2.2.2.1.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.1"></times><ci id="alg3.l10.m1.2.2.2.2.2.2.2.2.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.2">𝐹</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.3.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.3">𝑖</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.4.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.4">𝑛</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.5.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.5">𝑖</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.6.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.6">𝑠</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.7.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.7">ℎ</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.8.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.8">𝑇</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.9.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.9">𝑖</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.10.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.10">𝑚</ci><ci id="alg3.l10.m1.2.2.2.2.2.2.2.11.cmml" xref="alg3.l10.m1.2.2.2.2.2.2.2.11">𝑒</ci></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l10.m1.2c">Memo.put(S_{ij},FinishTime)</annotation></semantics></math>

</div>
<div id="alg3.l11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline"><span id="alg3.l11.1.1.1" class="ltx_text" style="font-size:80%;">11:</span></span>     <span id="alg3.l11.2" class="ltx_text ltx_font_bold">return</span> <math id="alg3.l11.m1.1" class="ltx_Math" alttext="FinishTime" display="inline"><semantics id="alg3.l11.m1.1a"><mrow id="alg3.l11.m1.1.1" xref="alg3.l11.m1.1.1.cmml"><mi id="alg3.l11.m1.1.1.2" xref="alg3.l11.m1.1.1.2.cmml">F</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.3" xref="alg3.l11.m1.1.1.3.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1a" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.4" xref="alg3.l11.m1.1.1.4.cmml">n</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1b" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.5" xref="alg3.l11.m1.1.1.5.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1c" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.6" xref="alg3.l11.m1.1.1.6.cmml">s</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1d" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.7" xref="alg3.l11.m1.1.1.7.cmml">h</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1e" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.8" xref="alg3.l11.m1.1.1.8.cmml">T</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1f" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.9" xref="alg3.l11.m1.1.1.9.cmml">i</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1g" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.10" xref="alg3.l11.m1.1.1.10.cmml">m</mi><mo lspace="0em" rspace="0em" id="alg3.l11.m1.1.1.1h" xref="alg3.l11.m1.1.1.1.cmml">​</mo><mi id="alg3.l11.m1.1.1.11" xref="alg3.l11.m1.1.1.11.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l11.m1.1b"><apply id="alg3.l11.m1.1.1.cmml" xref="alg3.l11.m1.1.1"><times id="alg3.l11.m1.1.1.1.cmml" xref="alg3.l11.m1.1.1.1"></times><ci id="alg3.l11.m1.1.1.2.cmml" xref="alg3.l11.m1.1.1.2">𝐹</ci><ci id="alg3.l11.m1.1.1.3.cmml" xref="alg3.l11.m1.1.1.3">𝑖</ci><ci id="alg3.l11.m1.1.1.4.cmml" xref="alg3.l11.m1.1.1.4">𝑛</ci><ci id="alg3.l11.m1.1.1.5.cmml" xref="alg3.l11.m1.1.1.5">𝑖</ci><ci id="alg3.l11.m1.1.1.6.cmml" xref="alg3.l11.m1.1.1.6">𝑠</ci><ci id="alg3.l11.m1.1.1.7.cmml" xref="alg3.l11.m1.1.1.7">ℎ</ci><ci id="alg3.l11.m1.1.1.8.cmml" xref="alg3.l11.m1.1.1.8">𝑇</ci><ci id="alg3.l11.m1.1.1.9.cmml" xref="alg3.l11.m1.1.1.9">𝑖</ci><ci id="alg3.l11.m1.1.1.10.cmml" xref="alg3.l11.m1.1.1.10">𝑚</ci><ci id="alg3.l11.m1.1.1.11.cmml" xref="alg3.l11.m1.1.1.11">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l11.m1.1c">FinishTime</annotation></semantics></math>

</div>
</div>
</figure>
<div id="S5.SS2.p7" class="ltx_para ltx_noindent">
<p id="S5.SS2.p7.1" class="ltx_p"><span id="S5.SS2.p7.1.1" class="ltx_text ltx_font_bold">ComputeNeighbor (Algorithm <a href="#alg2" title="Algorithm 2 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>):</span> This routine finds
a neighbor state of the current state. It randomly swaps two adjacent subtasks from a random stage.
If the neighbor state is invalid, it will undo the change and repeat the random swapping until finding a valid schedule.
We select adjacent subtasks rather than any two subtasks in one stage primarily to control the degree
of disturbance, which is found to be more effective in practice.</p>
</div>
<div id="S5.SS2.p8" class="ltx_para ltx_noindent">
<p id="S5.SS2.p8.5" class="ltx_p"><span id="S5.SS2.p8.5.1" class="ltx_text ltx_font_bold">ComputeEnergy (Algorithm <a href="#alg3" title="Algorithm 3 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>):</span>
This function computes the execution time for a given valid schedule <math id="S5.SS2.p8.1.m1.1" class="ltx_Math" alttext="S" display="inline"><semantics id="S5.SS2.p8.1.m1.1a"><mi id="S5.SS2.p8.1.m1.1.1" xref="S5.SS2.p8.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.p8.1.m1.1b"><ci id="S5.SS2.p8.1.m1.1.1.cmml" xref="S5.SS2.p8.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p8.1.m1.1c">S</annotation></semantics></math>.
We use a memoized recursion to calculate the finish time of the last subtask
in each stage and pick the maximum as the execution time. For subtask <math id="S5.SS2.p8.2.m2.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="S5.SS2.p8.2.m2.1a"><msub id="S5.SS2.p8.2.m2.1.1" xref="S5.SS2.p8.2.m2.1.1.cmml"><mi id="S5.SS2.p8.2.m2.1.1.2" xref="S5.SS2.p8.2.m2.1.1.2.cmml">S</mi><mrow id="S5.SS2.p8.2.m2.1.1.3" xref="S5.SS2.p8.2.m2.1.1.3.cmml"><mi id="S5.SS2.p8.2.m2.1.1.3.2" xref="S5.SS2.p8.2.m2.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p8.2.m2.1.1.3.1" xref="S5.SS2.p8.2.m2.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p8.2.m2.1.1.3.3" xref="S5.SS2.p8.2.m2.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p8.2.m2.1b"><apply id="S5.SS2.p8.2.m2.1.1.cmml" xref="S5.SS2.p8.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p8.2.m2.1.1.1.cmml" xref="S5.SS2.p8.2.m2.1.1">subscript</csymbol><ci id="S5.SS2.p8.2.m2.1.1.2.cmml" xref="S5.SS2.p8.2.m2.1.1.2">𝑆</ci><apply id="S5.SS2.p8.2.m2.1.1.3.cmml" xref="S5.SS2.p8.2.m2.1.1.3"><times id="S5.SS2.p8.2.m2.1.1.3.1.cmml" xref="S5.SS2.p8.2.m2.1.1.3.1"></times><ci id="S5.SS2.p8.2.m2.1.1.3.2.cmml" xref="S5.SS2.p8.2.m2.1.1.3.2">𝑖</ci><ci id="S5.SS2.p8.2.m2.1.1.3.3.cmml" xref="S5.SS2.p8.2.m2.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p8.2.m2.1c">S_{ij}</annotation></semantics></math>, its start time is decided by two
dependencies: inter-stage data dependency and intra-stage data dependency.
The inter-stage dependency is the completion of subtask in the upstream pipeline stage
corresponding to the same micro-batch.
The intra-stage dependency is the completion of the preceding subtask in the same pipeline stage.
Consequently, the end time of <math id="S5.SS2.p8.3.m3.1" class="ltx_Math" alttext="S_{ij}" display="inline"><semantics id="S5.SS2.p8.3.m3.1a"><msub id="S5.SS2.p8.3.m3.1.1" xref="S5.SS2.p8.3.m3.1.1.cmml"><mi id="S5.SS2.p8.3.m3.1.1.2" xref="S5.SS2.p8.3.m3.1.1.2.cmml">S</mi><mrow id="S5.SS2.p8.3.m3.1.1.3" xref="S5.SS2.p8.3.m3.1.1.3.cmml"><mi id="S5.SS2.p8.3.m3.1.1.3.2" xref="S5.SS2.p8.3.m3.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p8.3.m3.1.1.3.1" xref="S5.SS2.p8.3.m3.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p8.3.m3.1.1.3.3" xref="S5.SS2.p8.3.m3.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p8.3.m3.1b"><apply id="S5.SS2.p8.3.m3.1.1.cmml" xref="S5.SS2.p8.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p8.3.m3.1.1.1.cmml" xref="S5.SS2.p8.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.p8.3.m3.1.1.2.cmml" xref="S5.SS2.p8.3.m3.1.1.2">𝑆</ci><apply id="S5.SS2.p8.3.m3.1.1.3.cmml" xref="S5.SS2.p8.3.m3.1.1.3"><times id="S5.SS2.p8.3.m3.1.1.3.1.cmml" xref="S5.SS2.p8.3.m3.1.1.3.1"></times><ci id="S5.SS2.p8.3.m3.1.1.3.2.cmml" xref="S5.SS2.p8.3.m3.1.1.3.2">𝑖</ci><ci id="S5.SS2.p8.3.m3.1.1.3.3.cmml" xref="S5.SS2.p8.3.m3.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p8.3.m3.1c">S_{ij}</annotation></semantics></math> is
determined by the maximum of these two dependencies plus its own computation time, <math id="S5.SS2.p8.4.m4.1" class="ltx_Math" alttext="l_{ij}" display="inline"><semantics id="S5.SS2.p8.4.m4.1a"><msub id="S5.SS2.p8.4.m4.1.1" xref="S5.SS2.p8.4.m4.1.1.cmml"><mi id="S5.SS2.p8.4.m4.1.1.2" xref="S5.SS2.p8.4.m4.1.1.2.cmml">l</mi><mrow id="S5.SS2.p8.4.m4.1.1.3" xref="S5.SS2.p8.4.m4.1.1.3.cmml"><mi id="S5.SS2.p8.4.m4.1.1.3.2" xref="S5.SS2.p8.4.m4.1.1.3.2.cmml">i</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p8.4.m4.1.1.3.1" xref="S5.SS2.p8.4.m4.1.1.3.1.cmml">​</mo><mi id="S5.SS2.p8.4.m4.1.1.3.3" xref="S5.SS2.p8.4.m4.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p8.4.m4.1b"><apply id="S5.SS2.p8.4.m4.1.1.cmml" xref="S5.SS2.p8.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p8.4.m4.1.1.1.cmml" xref="S5.SS2.p8.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p8.4.m4.1.1.2.cmml" xref="S5.SS2.p8.4.m4.1.1.2">𝑙</ci><apply id="S5.SS2.p8.4.m4.1.1.3.cmml" xref="S5.SS2.p8.4.m4.1.1.3"><times id="S5.SS2.p8.4.m4.1.1.3.1.cmml" xref="S5.SS2.p8.4.m4.1.1.3.1"></times><ci id="S5.SS2.p8.4.m4.1.1.3.2.cmml" xref="S5.SS2.p8.4.m4.1.1.3.2">𝑖</ci><ci id="S5.SS2.p8.4.m4.1.1.3.3.cmml" xref="S5.SS2.p8.4.m4.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p8.4.m4.1c">l_{ij}</annotation></semantics></math>.
The detailed algorithm is shown in Algorithm <a href="#alg3" title="Algorithm 3 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>.
It has time complexity of <math id="S5.SS2.p8.5.m5.1" class="ltx_Math" alttext="O(N\times(M_{1}+M_{2}))" display="inline"><semantics id="S5.SS2.p8.5.m5.1a"><mrow id="S5.SS2.p8.5.m5.1.1" xref="S5.SS2.p8.5.m5.1.1.cmml"><mi id="S5.SS2.p8.5.m5.1.1.3" xref="S5.SS2.p8.5.m5.1.1.3.cmml">O</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p8.5.m5.1.1.2" xref="S5.SS2.p8.5.m5.1.1.2.cmml">​</mo><mrow id="S5.SS2.p8.5.m5.1.1.1.1" xref="S5.SS2.p8.5.m5.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.SS2.p8.5.m5.1.1.1.1.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS2.p8.5.m5.1.1.1.1.1" xref="S5.SS2.p8.5.m5.1.1.1.1.1.cmml"><mi id="S5.SS2.p8.5.m5.1.1.1.1.1.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.3.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S5.SS2.p8.5.m5.1.1.1.1.1.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.2.cmml">×</mo><mrow id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.cmml"><mo stretchy="false" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.cmml"><msub id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.cmml"><mi id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.2.cmml">M</mi><mn id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.1" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.1.cmml">+</mo><msub id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.cmml"><mi id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.2" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.2.cmml">M</mi><mn id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.3.cmml">2</mn></msub></mrow><mo stretchy="false" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo stretchy="false" id="S5.SS2.p8.5.m5.1.1.1.1.3" xref="S5.SS2.p8.5.m5.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p8.5.m5.1b"><apply id="S5.SS2.p8.5.m5.1.1.cmml" xref="S5.SS2.p8.5.m5.1.1"><times id="S5.SS2.p8.5.m5.1.1.2.cmml" xref="S5.SS2.p8.5.m5.1.1.2"></times><ci id="S5.SS2.p8.5.m5.1.1.3.cmml" xref="S5.SS2.p8.5.m5.1.1.3">𝑂</ci><apply id="S5.SS2.p8.5.m5.1.1.1.1.1.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1"><times id="S5.SS2.p8.5.m5.1.1.1.1.1.2.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.2"></times><ci id="S5.SS2.p8.5.m5.1.1.1.1.1.3.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.3">𝑁</ci><apply id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1"><plus id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.1.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.1"></plus><apply id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.1.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.2.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.2">𝑀</ci><cn type="integer" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.3.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.2.3">1</cn></apply><apply id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.1.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.2.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.2">𝑀</ci><cn type="integer" id="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.3.cmml" xref="S5.SS2.p8.5.m5.1.1.1.1.1.1.1.1.3.3">2</cn></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p8.5.m5.1c">O(N\times(M_{1}+M_{2}))</annotation></semantics></math>.</p>
</div>
<div id="S5.SS2.p9" class="ltx_para ltx_noindent">
<p id="S5.SS2.p9.2" class="ltx_p"><span id="S5.SS2.p9.2.1" class="ltx_text ltx_font_bold">Optimizing memory usage.</span> When we obtain a latency-optimized solution
<math id="S5.SS2.p9.1.m1.1" class="ltx_Math" alttext="S^{*}" display="inline"><semantics id="S5.SS2.p9.1.m1.1a"><msup id="S5.SS2.p9.1.m1.1.1" xref="S5.SS2.p9.1.m1.1.1.cmml"><mi id="S5.SS2.p9.1.m1.1.1.2" xref="S5.SS2.p9.1.m1.1.1.2.cmml">S</mi><mo id="S5.SS2.p9.1.m1.1.1.3" xref="S5.SS2.p9.1.m1.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p9.1.m1.1b"><apply id="S5.SS2.p9.1.m1.1.1.cmml" xref="S5.SS2.p9.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p9.1.m1.1.1.1.cmml" xref="S5.SS2.p9.1.m1.1.1">superscript</csymbol><ci id="S5.SS2.p9.1.m1.1.1.2.cmml" xref="S5.SS2.p9.1.m1.1.1.2">𝑆</ci><times id="S5.SS2.p9.1.m1.1.1.3.cmml" xref="S5.SS2.p9.1.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p9.1.m1.1c">S^{*}</annotation></semantics></math>, we use it as the initial state to run another round of simulated annealing
similar to Algorithm <a href="#alg1" title="Algorithm 1 ‣ 5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>. However, this time
we replace the <math id="S5.SS2.p9.2.m2.1" class="ltx_Math" alttext="ComputeEnergy" display="inline"><semantics id="S5.SS2.p9.2.m2.1a"><mrow id="S5.SS2.p9.2.m2.1.1" xref="S5.SS2.p9.2.m2.1.1.cmml"><mi id="S5.SS2.p9.2.m2.1.1.2" xref="S5.SS2.p9.2.m2.1.1.2.cmml">C</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.3" xref="S5.SS2.p9.2.m2.1.1.3.cmml">o</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1a" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.4" xref="S5.SS2.p9.2.m2.1.1.4.cmml">m</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1b" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.5" xref="S5.SS2.p9.2.m2.1.1.5.cmml">p</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1c" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.6" xref="S5.SS2.p9.2.m2.1.1.6.cmml">u</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1d" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.7" xref="S5.SS2.p9.2.m2.1.1.7.cmml">t</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1e" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.8" xref="S5.SS2.p9.2.m2.1.1.8.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1f" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.9" xref="S5.SS2.p9.2.m2.1.1.9.cmml">E</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1g" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.10" xref="S5.SS2.p9.2.m2.1.1.10.cmml">n</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1h" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.11" xref="S5.SS2.p9.2.m2.1.1.11.cmml">e</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1i" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.12" xref="S5.SS2.p9.2.m2.1.1.12.cmml">r</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1j" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.13" xref="S5.SS2.p9.2.m2.1.1.13.cmml">g</mi><mo lspace="0em" rspace="0em" id="S5.SS2.p9.2.m2.1.1.1k" xref="S5.SS2.p9.2.m2.1.1.1.cmml">​</mo><mi id="S5.SS2.p9.2.m2.1.1.14" xref="S5.SS2.p9.2.m2.1.1.14.cmml">y</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p9.2.m2.1b"><apply id="S5.SS2.p9.2.m2.1.1.cmml" xref="S5.SS2.p9.2.m2.1.1"><times id="S5.SS2.p9.2.m2.1.1.1.cmml" xref="S5.SS2.p9.2.m2.1.1.1"></times><ci id="S5.SS2.p9.2.m2.1.1.2.cmml" xref="S5.SS2.p9.2.m2.1.1.2">𝐶</ci><ci id="S5.SS2.p9.2.m2.1.1.3.cmml" xref="S5.SS2.p9.2.m2.1.1.3">𝑜</ci><ci id="S5.SS2.p9.2.m2.1.1.4.cmml" xref="S5.SS2.p9.2.m2.1.1.4">𝑚</ci><ci id="S5.SS2.p9.2.m2.1.1.5.cmml" xref="S5.SS2.p9.2.m2.1.1.5">𝑝</ci><ci id="S5.SS2.p9.2.m2.1.1.6.cmml" xref="S5.SS2.p9.2.m2.1.1.6">𝑢</ci><ci id="S5.SS2.p9.2.m2.1.1.7.cmml" xref="S5.SS2.p9.2.m2.1.1.7">𝑡</ci><ci id="S5.SS2.p9.2.m2.1.1.8.cmml" xref="S5.SS2.p9.2.m2.1.1.8">𝑒</ci><ci id="S5.SS2.p9.2.m2.1.1.9.cmml" xref="S5.SS2.p9.2.m2.1.1.9">𝐸</ci><ci id="S5.SS2.p9.2.m2.1.1.10.cmml" xref="S5.SS2.p9.2.m2.1.1.10">𝑛</ci><ci id="S5.SS2.p9.2.m2.1.1.11.cmml" xref="S5.SS2.p9.2.m2.1.1.11">𝑒</ci><ci id="S5.SS2.p9.2.m2.1.1.12.cmml" xref="S5.SS2.p9.2.m2.1.1.12">𝑟</ci><ci id="S5.SS2.p9.2.m2.1.1.13.cmml" xref="S5.SS2.p9.2.m2.1.1.13">𝑔</ci><ci id="S5.SS2.p9.2.m2.1.1.14.cmml" xref="S5.SS2.p9.2.m2.1.1.14">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p9.2.m2.1c">ComputeEnergy</annotation></semantics></math> function with one that calculates the
peak activation memory for the given schedule.
Additionally, we only allow state transitions when the neighbor’s latency
does not degrade. In this way, we can achieve a solution that not only
has promising latency but also optimizes the activation memory usage.</p>
</div>
</section>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>System Implementation and Optimizations</h2>

<div id="S6.p1" class="ltx_para">
<p id="S6.p1.1" class="ltx_p">We implement RLHFuse based on Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite> with 7K lines of code
in Python, C++, and CUDA. Megatron-LM applies 3D-parallelism
for single-model training. We extend it to support multiple device meshes to launch
different tasks asynchronously with tailored parallelism and deployment strategy.</p>
</div>
<div id="S6.p2" class="ltx_para ltx_noindent">
<p id="S6.p2.1" class="ltx_p"><span id="S6.p2.1.1" class="ltx_text ltx_font_bold">Parallelism strategy configuration.</span> Optimizing the parallel strategy for LLM training is a well-studied problem <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib33" title="" class="ltx_ref">33</a>, <a href="#bib.bib16" title="" class="ltx_ref">16</a>, <a href="#bib.bib34" title="" class="ltx_ref">34</a>, <a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>.
Due to the deterministic nature of LLM computation, the execution time and memory cost can be accurately modeled through minimal profiling. An optimal solution can then be
found through optimizations <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib33" title="" class="ltx_ref">33</a>, <a href="#bib.bib25" title="" class="ltx_ref">25</a>, <a href="#bib.bib34" title="" class="ltx_ref">34</a>, <a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>.
The generation and inference task involves only the forward pass,
which is a subproblem of the LLM training.
ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite> is a state-of-the-art solution
that optimizes the parallel strategy for RLHF training and RLHFuse adopts a similar model-then-optimize approach.
We build a simulator to accurately estimate the runtime statistics of the tasks
under a specific parallel strategy and workload. Then we follow the
guidelines in the Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib16" title="" class="ltx_ref">16</a>]</cite> paper to prune the design space and brute-force search
the optimal strategy.</p>
</div>
<div id="S6.p3" class="ltx_para ltx_noindent">
<p id="S6.p3.1" class="ltx_p"><span id="S6.p3.1.1" class="ltx_text ltx_font_bold">Stage fusion.</span> For inter-stage fusion, we use the simulator mentioned above
to choose the best migration threshold <math id="S6.p3.1.m1.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S6.p3.1.m1.1a"><msub id="S6.p3.1.m1.1.1" xref="S6.p3.1.m1.1.1.cmml"><mi id="S6.p3.1.m1.1.1.2" xref="S6.p3.1.m1.1.1.2.cmml">R</mi><mi id="S6.p3.1.m1.1.1.3" xref="S6.p3.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S6.p3.1.m1.1b"><apply id="S6.p3.1.m1.1.1.cmml" xref="S6.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S6.p3.1.m1.1.1.1.cmml" xref="S6.p3.1.m1.1.1">subscript</csymbol><ci id="S6.p3.1.m1.1.1.2.cmml" xref="S6.p3.1.m1.1.1.2">𝑅</ci><ci id="S6.p3.1.m1.1.1.3.cmml" xref="S6.p3.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p3.1.m1.1c">R_{t}</annotation></semantics></math> to minimize the fused execution time
under a specific workload pattern. For intra-stage fusion, we use MPI <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib35" title="" class="ltx_ref">35</a>]</cite>
to parallelize the simulated annealing with different random seeds.
After finding the optimal solution, it will generate the
sequences of NCCL <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib36" title="" class="ltx_ref">36</a>]</cite> operations on each device following the schedule. The runtime will follow
the instruction flow to execute the fused pipeline schedule.</p>
</div>
<div id="S6.p4" class="ltx_para ltx_noindent">
<p id="S6.p4.1" class="ltx_p"><span id="S6.p4.1.1" class="ltx_text ltx_font_bold">System optimizations.</span>
Additionally, we adopt a series of system optimizations tailored for RLHF
training. These optimizations are implemented in our own system as well as
open-source RLHF frameworks like ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>. To separate the differences in low-level system implementations from the core
techniques (inter-stage fusion in §<a href="#S4" title="4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a> and intra-stage
fusion in §<a href="#S5" title="5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a>), our evaluation in §<a href="#S7" title="7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7</span></a> uses RLHFuse-Base that includes these optimizations but
without inter- and intra-stage fusion as an additional baseline.</p>
</div>
<div id="S6.p5" class="ltx_para ltx_noindent">
<p id="S6.p5.1" class="ltx_p"><span id="S6.p5.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Generation stage.</span>
We use an in-house inference engine with optimized CUDA kernels. It supports
continuous batching <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib37" title="" class="ltx_ref">37</a>]</cite> to allow the short samples to leave the
batch early. For samples that share the same prompt,
it supports prefix sharing <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib38" title="" class="ltx_ref">38</a>]</cite> to avoid key-value cache duplication.</p>
</div>
<div id="S6.p6" class="ltx_para ltx_noindent">
<p id="S6.p6.1" class="ltx_p"><span id="S6.p6.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Inference stage.</span>
During the post-processing of the inference stage, one metric called
Generalized Advantage Estimation <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib39" title="" class="ltx_ref">39</a>]</cite> is needed
which requires recursive computation along the output length dimension for each sample.
When the output length is long, it incurs numerous kernel launches which takes
even longer than the inference computation itself.
To address this, we unroll the recursive formula along the output length dimension
and precompute the coefficient matrix.
This trick transforms the original recursive computation into a single matrix multiplication,
successfully reducing the latency from tens of seconds to just tens of milliseconds.</p>
</div>
<div id="S6.p7" class="ltx_para ltx_noindent">
<p id="S6.p7.1" class="ltx_p"><span id="S6.p7.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Training stage.</span>
In RLHF training, DP groups need to synchronize after processing each mini-batch.
Due to data skewness, different DP groups may have varying workloads,
leading to stragglers and wasted GPU time. To mitigate this,
we evenly distribute each mini-batch across the DP groups based
on the sequence length of the samples, ensuring that the workloads are
roughly balanced across the DP groups. Note that this will not violate the
original training semantics.</p>
</div>
<div id="S6.p8" class="ltx_para ltx_noindent">
<p id="S6.p8.1" class="ltx_p"><span id="S6.p8.1.1" class="ltx_text ltx_font_italic ltx_framed ltx_framed_underline">Task switching.</span>
The primary overhead during task switching lies in model weights reloading.
For the <span id="S6.p8.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S6.p8.1.3" class="ltx_text ltx_font_typewriter">Critic</span> models, the latest weights after the training stage
need to be redistributed to the appropriate devices according
to the new parallel strategy for generation or inference.
This communication pattern is well-studied <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib40" title="" class="ltx_ref">40</a>, <a href="#bib.bib14" title="" class="ltx_ref">14</a>, <a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite>
and we adopt a similar all-to-all approach to minimize cross-node communication.
For the <span id="S6.p8.1.4" class="ltx_text ltx_font_typewriter">Ref</span> and <span id="S6.p8.1.5" class="ltx_text ltx_font_typewriter">RW</span> models whose weights remain unchanged,
we keep them in CPU memory and swap them into GPU memory as needed.
The swapping can overlap with the computation of previous tasks.
With these optimizations, the task switching overhead is negligible
compared to the total iteration time, as shown in §<a href="#S7.SS2" title="7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.2</span></a>.</p>
</div>
<figure id="S6.F7" class="ltx_figure"><img src="/html/2409.13221/assets/x7.png" id="S6.F7.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="438" height="115" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S6.F7.2.1.1" class="ltx_text" style="font-size:90%;">Figure 7</span>: </span><span id="S6.F7.3.2" class="ltx_text" style="font-size:90%;">End-to-end throughput of RLHF training systems under different
generation and model size settings.</span></figcaption>
</figure>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Evaluation</h2>

<div id="S7.p1" class="ltx_para">
<p id="S7.p1.1" class="ltx_p">In this section, we evaluate RLHFuse under different sizes of
LLMs ranging from 13B to 65B on real-world datasets. First, we
compare the end-to-end performance of RLHFuse to other RLHF training
frameworks (§<a href="#S7.SS1" title="7.1 End-to-End Results ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.1</span></a>). Then we present the
latency breakdown to delve into the performance improvement of
RLHFuse (§<a href="#S7.SS2" title="7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.2</span></a>) and conduct ablation studies of our
proposed techniques (§<a href="#S7.SS3" title="7.3 Effectiveness of Stage Fusion ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.3</span></a>). Finally, we provide
a case study to show one execution plan generated by RLHFuse (§<a href="#S7.SS4" title="7.4 Deep Dive ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7.4</span></a>).</p>
</div>
<div id="S7.p2" class="ltx_para ltx_noindent">
<p id="S7.p2.1" class="ltx_p"><span id="S7.p2.1.1" class="ltx_text ltx_font_bold">Cluster testbed.</span> We deploy RLHFuse on a production cluster for RLHF training
with 32 nodes and 256 GPUs. Each node has 2TB of memory and 8 NVIDIA SXM H100-80GB GPUs connected with 900GB/s NVLINK.
Nodes are connected by <math id="S7.p2.1.m1.1" class="ltx_Math" alttext="8*200" display="inline"><semantics id="S7.p2.1.m1.1a"><mrow id="S7.p2.1.m1.1.1" xref="S7.p2.1.m1.1.1.cmml"><mn id="S7.p2.1.m1.1.1.2" xref="S7.p2.1.m1.1.1.2.cmml">8</mn><mo lspace="0.222em" rspace="0.222em" id="S7.p2.1.m1.1.1.1" xref="S7.p2.1.m1.1.1.1.cmml">∗</mo><mn id="S7.p2.1.m1.1.1.3" xref="S7.p2.1.m1.1.1.3.cmml">200</mn></mrow><annotation-xml encoding="MathML-Content" id="S7.p2.1.m1.1b"><apply id="S7.p2.1.m1.1.1.cmml" xref="S7.p2.1.m1.1.1"><times id="S7.p2.1.m1.1.1.1.cmml" xref="S7.p2.1.m1.1.1.1"></times><cn type="integer" id="S7.p2.1.m1.1.1.2.cmml" xref="S7.p2.1.m1.1.1.2">8</cn><cn type="integer" id="S7.p2.1.m1.1.1.3.cmml" xref="S7.p2.1.m1.1.1.3">200</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.p2.1.m1.1c">8*200</annotation></semantics></math> Gbps RDMA network based on RoCEv2 with rail-optimized topology.
The simulated annealing algorithm in §<a href="#S5" title="5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a> is conducted on four
CPU nodes, each with 2 AMD 9654 CPUs and there are 768 physical cores in total.</p>
</div>
<div id="S7.p3" class="ltx_para ltx_noindent">
<p id="S7.p3.1" class="ltx_p"><span id="S7.p3.1.1" class="ltx_text ltx_font_bold">Models and datasets.</span> Following previous work <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib14" title="" class="ltx_ref">14</a>]</cite>,
we choose the LLaMA models <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib41" title="" class="ltx_ref">41</a>]</cite> ranging from 13B to 65B,
which is a popular LLM family used in academia and industry. The
detailed specifications are listed in Table <a href="#S7.T2" title="Table 2 ‣ 7.1 End-to-End Results ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a>.
We use the HH-RLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib42" title="" class="ltx_ref">42</a>]</cite> dataset,
which is open-sourced by Anthropic to train a helpful and harmless assistant
with RLHF.</p>
</div>
<div id="S7.p4" class="ltx_para ltx_noindent">
<p id="S7.p4.1" class="ltx_p"><span id="S7.p4.1.1" class="ltx_text ltx_font_bold">Settings.</span> Since the <span id="S7.p4.1.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S7.p4.1.3" class="ltx_text ltx_font_typewriter">Ref</span> models
are of the same size, as are the <span id="S7.p4.1.4" class="ltx_text ltx_font_typewriter">Critic</span> and <span id="S7.p4.1.5" class="ltx_text ltx_font_typewriter">RW</span> models,
we choose four different model size settings for <span id="S7.p4.1.6" class="ltx_text ltx_font_typewriter">Actor/Critic</span> pair
: 13B/33B, 33B/13B, 33B/65B, and 65B/33B.
We also vary the maximum output length to see the performance
under different generation settings.
In each training iteration, we use a global batch size of 512,
a mini-batch size of 64, and take one gradient step per mini-batch following the
LLaMA technical report <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib43" title="" class="ltx_ref">43</a>]</cite>.</p>
</div>
<div id="S7.p5" class="ltx_para ltx_noindent">
<p id="S7.p5.1" class="ltx_p"><span id="S7.p5.1.1" class="ltx_text ltx_font_bold">Metrics.</span> For the end-to-end experiment, we measure the <span id="S7.p5.1.2" class="ltx_text ltx_font_italic">sample throughput</span>
following previous work <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib14" title="" class="ltx_ref">14</a>]</cite>. Sample throughput is defined as the average number
of samples processed per second. Under each setting, we record the sample throughput
over 20 consecutive training iterations after warm-up.</p>
</div>
<section id="S7.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.1 </span>End-to-End Results</h3>

<figure id="S7.T2" class="ltx_table">
<div id="S7.T2.2" class="ltx_inline-block ltx_align_center ltx_transformed_outer" style="width:346.9pt;height:118.7pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(42.0pt,-14.4pt) scale(1.31927794882556,1.31927794882556) ;">
<table id="S7.T2.2.1" class="ltx_tabular ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr id="S7.T2.2.1.1.1" class="ltx_tr">
<th id="S7.T2.2.1.1.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" rowspan="2"><span id="S7.T2.2.1.1.1.1.1" class="ltx_text ltx_font_bold">Models</span></th>
<th id="S7.T2.2.1.1.1.2" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt"><span id="S7.T2.2.1.1.1.2.1" class="ltx_text ltx_font_bold"># of</span></th>
<th id="S7.T2.2.1.1.1.3" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt"><span id="S7.T2.2.1.1.1.3.1" class="ltx_text ltx_font_bold"># of</span></th>
<th id="S7.T2.2.1.1.1.4" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt"><span id="S7.T2.2.1.1.1.4.1" class="ltx_text ltx_font_bold">Hidden</span></th>
<th id="S7.T2.2.1.1.1.5" class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt"><span id="S7.T2.2.1.1.1.5.1" class="ltx_text ltx_font_bold">Intermediate</span></th>
</tr>
<tr id="S7.T2.2.1.2.2" class="ltx_tr">
<th id="S7.T2.2.1.2.2.1" class="ltx_td ltx_align_center ltx_th ltx_th_column"><span id="S7.T2.2.1.2.2.1.1" class="ltx_text ltx_font_bold">Layers</span></th>
<th id="S7.T2.2.1.2.2.2" class="ltx_td ltx_align_center ltx_th ltx_th_column"><span id="S7.T2.2.1.2.2.2.1" class="ltx_text ltx_font_bold">Heads</span></th>
<th id="S7.T2.2.1.2.2.3" class="ltx_td ltx_align_center ltx_th ltx_th_column"><span id="S7.T2.2.1.2.2.3.1" class="ltx_text ltx_font_bold">Size</span></th>
<th id="S7.T2.2.1.2.2.4" class="ltx_td ltx_align_center ltx_th ltx_th_column"><span id="S7.T2.2.1.2.2.4.1" class="ltx_text ltx_font_bold">Size</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr id="S7.T2.2.1.3.1" class="ltx_tr">
<th id="S7.T2.2.1.3.1.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t">LLaMA-13B</th>
<td id="S7.T2.2.1.3.1.2" class="ltx_td ltx_align_center ltx_border_t">40</td>
<td id="S7.T2.2.1.3.1.3" class="ltx_td ltx_align_center ltx_border_t">40</td>
<td id="S7.T2.2.1.3.1.4" class="ltx_td ltx_align_center ltx_border_t">5120</td>
<td id="S7.T2.2.1.3.1.5" class="ltx_td ltx_align_center ltx_border_t">20480</td>
</tr>
<tr id="S7.T2.2.1.4.2" class="ltx_tr">
<th id="S7.T2.2.1.4.2.1" class="ltx_td ltx_align_center ltx_th ltx_th_row">LLaMA-33B</th>
<td id="S7.T2.2.1.4.2.2" class="ltx_td ltx_align_center">60</td>
<td id="S7.T2.2.1.4.2.3" class="ltx_td ltx_align_center">52</td>
<td id="S7.T2.2.1.4.2.4" class="ltx_td ltx_align_center">6656</td>
<td id="S7.T2.2.1.4.2.5" class="ltx_td ltx_align_center">26624</td>
</tr>
<tr id="S7.T2.2.1.5.3" class="ltx_tr">
<th id="S7.T2.2.1.5.3.1" class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb">LLaMA-65B</th>
<td id="S7.T2.2.1.5.3.2" class="ltx_td ltx_align_center ltx_border_bb">80</td>
<td id="S7.T2.2.1.5.3.3" class="ltx_td ltx_align_center ltx_border_bb">64</td>
<td id="S7.T2.2.1.5.3.4" class="ltx_td ltx_align_center ltx_border_bb">8192</td>
<td id="S7.T2.2.1.5.3.5" class="ltx_td ltx_align_center ltx_border_bb">32768</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span id="S7.T2.3.1.1" class="ltx_text" style="font-size:90%;">Table 2</span>: </span><span id="S7.T2.4.2" class="ltx_text" style="font-size:90%;">LLM specifications.</span></figcaption>
</figure>
<div id="S7.SS1.p1" class="ltx_para">
<p id="S7.SS1.p1.1" class="ltx_p">We compare the end-to-end performance of RLHFuse against
the following RLHF training frameworks.
For baselines, we explore all feasible configurable options and
report the best performance achieved without out-of-memory errors.</p>
</div>
<div id="S7.SS1.p2" class="ltx_para">
<ul id="S7.I1" class="ltx_itemize">
<li id="S7.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S7.I1.i1.p1" class="ltx_para">
<p id="S7.I1.i1.p1.1" class="ltx_p"><span id="S7.I1.i1.p1.1.1" class="ltx_text ltx_font_bold">DeepSpeed-Chat <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib44" title="" class="ltx_ref">44</a>]</cite></span> (DSChat)
only supports ZeRO-3 data parallelism <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib45" title="" class="ltx_ref">45</a>]</cite> during training and
utilizes a <span id="S7.I1.i1.p1.1.2" class="ltx_text ltx_font_italic">HybridEngine</span> to switch from
ZeRO-3 DP to TP in the generation stage.
Since each GPU requires at least one sample during training and it only supports ZeRO-3 DP,
we increase its mini-batch size to 256
while maintaining the original global batch size in order to run it successfully on our cluster.
Note that with a larger batch size, this adjustment is more favorable for its throughput performance.</p>
</div>
</li>
<li id="S7.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S7.I1.i2.p1" class="ltx_para">
<p id="S7.I1.i2.p1.1" class="ltx_p"><span id="S7.I1.i2.p1.1.1" class="ltx_text ltx_font_bold">ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite></span> proposes parameter reallocation to
flexibly redistribute parameters between tasks, enabling tailored
3D-parallel strategy for each task.
However, as discussed in §<a href="#S2.SS2" title="2.2 Problems in RLHF Training ‣ 2 Motivation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2.2</span></a>,
it suffers from the issues of data skewness and pipeline bubbles
without employing the subtask-level optimizations.</p>
</div>
</li>
<li id="S7.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S7.I1.i3.p1" class="ltx_para">
<p id="S7.I1.i3.p1.1" class="ltx_p"><span id="S7.I1.i3.p1.1.1" class="ltx_text ltx_font_bold">RLHFuse-Base</span> is RLHFuse without inter- and intra-stage
fusion but with all the system optimizations enabled.
We include this baseline to demonstrate the performance improvements
brought by our core techniques in §<a href="#S4" title="4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a> and §<a href="#S5" title="5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a>,
eliminating any unfair comparisons caused by the differences in underlying framework implementations.</p>
</div>
</li>
</ul>
</div>
<figure id="S7.F8" class="ltx_figure"><img src="/html/2409.13221/assets/x8.png" id="S7.F8.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="452" height="152" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S7.F8.2.1.1" class="ltx_text" style="font-size:90%;">Figure 8</span>: </span><span id="S7.F8.3.2" class="ltx_text" style="font-size:90%;">The RLHF iteration breakdown under different generation and model size settings.</span></figcaption>
</figure>
<figure id="S7.F9" class="ltx_figure"><img src="/html/2409.13221/assets/x9.png" id="S7.F9.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="438" height="166" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S7.F9.2.1.1" class="ltx_text" style="font-size:90%;">Figure 9</span>: </span><span id="S7.F9.3.2" class="ltx_text" style="font-size:90%;">The fused generation and inference stage execution time of RLHFuse under different
migration ratio and model settings. The maximum generation length is set to 1024.</span></figcaption>
</figure>
<div id="S7.SS1.p3" class="ltx_para">
<p id="S7.SS1.p3.6" class="ltx_p">Figure <a href="#S6.F7" title="Figure 7 ‣ 6 System Implementation and Optimizations ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">7</span></a> shows the end-to-end performance of the RLHF training
systems under three generation settings. We set the maximum generation length to 512, 1024, and 2048, respectively.
Under a specific generation setting, the configuration X/Y denotes parameter counts in actor and critic models,
mirrored in the reference and reward models, respectively.
Compared to DSChat, RLHFuse achieves <math id="S7.SS1.p3.1.m1.1" class="ltx_math_unparsed" alttext="2.5\times" display="inline"><semantics id="S7.SS1.p3.1.m1.1a"><mrow id="S7.SS1.p3.1.m1.1b"><mn id="S7.SS1.p3.1.m1.1.1">2.5</mn><mo lspace="0.222em" id="S7.SS1.p3.1.m1.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.1.m1.1c">2.5\times</annotation></semantics></math>–<math id="S7.SS1.p3.2.m2.1" class="ltx_math_unparsed" alttext="3.7\times" display="inline"><semantics id="S7.SS1.p3.2.m2.1a"><mrow id="S7.SS1.p3.2.m2.1b"><mn id="S7.SS1.p3.2.m2.1.1">3.7</mn><mo lspace="0.222em" id="S7.SS1.p3.2.m2.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.2.m2.1c">3.7\times</annotation></semantics></math> higher throughput due to our
flexible execution plan generator, which selects the most efficient
3D-parallel strategy for each task.
Compared to ReaLHF, which also supports tailored parallel strategies,
RLHFuse achieves <math id="S7.SS1.p3.3.m3.1" class="ltx_math_unparsed" alttext="1.4\times" display="inline"><semantics id="S7.SS1.p3.3.m3.1a"><mrow id="S7.SS1.p3.3.m3.1b"><mn id="S7.SS1.p3.3.m3.1.1">1.4</mn><mo lspace="0.222em" id="S7.SS1.p3.3.m3.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.3.m3.1c">1.4\times</annotation></semantics></math>–<math id="S7.SS1.p3.4.m4.1" class="ltx_math_unparsed" alttext="2.4\times" display="inline"><semantics id="S7.SS1.p3.4.m4.1a"><mrow id="S7.SS1.p3.4.m4.1b"><mn id="S7.SS1.p3.4.m4.1.1">2.4</mn><mo lspace="0.222em" id="S7.SS1.p3.4.m4.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.4.m4.1c">2.4\times</annotation></semantics></math> higher throughput due to more fine-grained
system optimizations. Specifically, we observe that the primary speedup
comes from the customized kernels in the inference engine and the mini-batch
load balancing during the training stage.
Compared to RLHFuse-Base, our system achieves a relative improvement
of <math id="S7.SS1.p3.5.m5.1" class="ltx_math_unparsed" alttext="1.2\times" display="inline"><semantics id="S7.SS1.p3.5.m5.1a"><mrow id="S7.SS1.p3.5.m5.1b"><mn id="S7.SS1.p3.5.m5.1.1">1.2</mn><mo lspace="0.222em" id="S7.SS1.p3.5.m5.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.5.m5.1c">1.2\times</annotation></semantics></math>–<math id="S7.SS1.p3.6.m6.1" class="ltx_math_unparsed" alttext="1.4\times" display="inline"><semantics id="S7.SS1.p3.6.m6.1a"><mrow id="S7.SS1.p3.6.m6.1b"><mn id="S7.SS1.p3.6.m6.1.1">1.4</mn><mo lspace="0.222em" id="S7.SS1.p3.6.m6.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS1.p3.6.m6.1c">1.4\times</annotation></semantics></math> on the throughput.
This improvement is entirely from stage fusion,
which significantly alleviates the issues of data skewness in the generation stage
and pipeline bubbles in the training stage.
In the following, we conduct a detailed breakdown analysis
to show the performance improvement.</p>
</div>
</section>
<section id="S7.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.2 </span>Performance Analysis</h3>

<div id="S7.SS2.p1" class="ltx_para">
<p id="S7.SS2.p1.1" class="ltx_p">To further understand the performance improvement of RLHFuse, we show its
RLHF iteration breakdown and compare it with RLHFuse-Base.
As shown in Figure <a href="#S7.F8" title="Figure 8 ‣ 7.1 End-to-End Results ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">8</span></a>, each row represents a generation
setting, and each column represents a model setting X/Y. We divide one RLHF
iteration into three main parts: the generation plus inference stage
(<span id="S7.SS2.p1.1.1" class="ltx_text ltx_font_typewriter">Gen.+Inf.</span>), the training stage (<span id="S7.SS2.p1.1.2" class="ltx_text ltx_font_typewriter">Train</span>),
and all other overheads (<span id="S7.SS2.p1.1.3" class="ltx_text ltx_font_typewriter">Others</span>), such as the data transmission and weights redistribution time.</p>
</div>
<div id="S7.SS2.p2" class="ltx_para">
<p id="S7.SS2.p2.4" class="ltx_p">For <span id="S7.SS2.p2.4.1" class="ltx_text ltx_font_typewriter">Gen.+Inf.</span>, since RLHFuse-Base does not perform inter-stage fusion
and executes the two stages in serial,
we use light and dark colors to represent the time spent on the generation
and inference stages respectively to better show the speedup of inter-stage fusing.
It can be seen that as the maximum generation length increases, the processing time
of long-tailed samples is long enough for RLHFuse to fully overlap
the inference stage execution, achieving <math id="S7.SS2.p2.1.m1.1" class="ltx_math_unparsed" alttext="1.2\times" display="inline"><semantics id="S7.SS2.p2.1.m1.1a"><mrow id="S7.SS2.p2.1.m1.1b"><mn id="S7.SS2.p2.1.m1.1.1">1.2</mn><mo lspace="0.222em" id="S7.SS2.p2.1.m1.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS2.p2.1.m1.1c">1.2\times</annotation></semantics></math>–<math id="S7.SS2.p2.2.m2.1" class="ltx_math_unparsed" alttext="1.6\times" display="inline"><semantics id="S7.SS2.p2.2.m2.1a"><mrow id="S7.SS2.p2.2.m2.1b"><mn id="S7.SS2.p2.2.m2.1.1">1.6</mn><mo lspace="0.222em" id="S7.SS2.p2.2.m2.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS2.p2.2.m2.1c">1.6\times</annotation></semantics></math> speedup.
For the training stage, similarly, we use light and dark colors to represent the
<span id="S7.SS2.p2.4.2" class="ltx_text ltx_font_typewriter">Actor</span> and <span id="S7.SS2.p2.4.3" class="ltx_text ltx_font_typewriter">Critic</span> training time in RLHFuse-Base.
Through intra-stage fusion, RLHFuse greatly mitigates pipeline bubbles
and reduces the execution time of the training stage by <math id="S7.SS2.p2.3.m3.1" class="ltx_math_unparsed" alttext="1.2\times" display="inline"><semantics id="S7.SS2.p2.3.m3.1a"><mrow id="S7.SS2.p2.3.m3.1b"><mn id="S7.SS2.p2.3.m3.1.1">1.2</mn><mo lspace="0.222em" id="S7.SS2.p2.3.m3.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS2.p2.3.m3.1c">1.2\times</annotation></semantics></math>–<math id="S7.SS2.p2.4.m4.1" class="ltx_math_unparsed" alttext="1.3\times" display="inline"><semantics id="S7.SS2.p2.4.m4.1a"><mrow id="S7.SS2.p2.4.m4.1b"><mn id="S7.SS2.p2.4.m4.1.1">1.3</mn><mo lspace="0.222em" id="S7.SS2.p2.4.m4.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S7.SS2.p2.4.m4.1c">1.3\times</annotation></semantics></math>.
As for the other overhead, thanks to our optimizations in task switching (§<a href="#S6" title="6 System Implementation and Optimizations ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">6</span></a>),
it only accounts for less than 3% of the total iteration time,
and the migration overhead of inter-stage fusion is also negligible.</p>
</div>
<figure id="S7.F10" class="ltx_figure"><img src="/html/2409.13221/assets/x10.png" id="S7.F10.g1" class="ltx_graphics ltx_centering ltx_img_landscape" width="461" height="158" alt="Refer to caption">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span id="S7.F10.4.1.1" class="ltx_text" style="font-size:90%;">Figure 10</span>: </span><span id="S7.F10.5.2" class="ltx_text" style="font-size:90%;">The fused pipeline schedule of 65B <span id="S7.F10.5.2.1" class="ltx_text ltx_font_typewriter">Actor</span> and 33B <span id="S7.F10.5.2.2" class="ltx_text ltx_font_typewriter">Critic</span> model generated by RLHFuse.
The two models have 16 and 8 PP stages respectively and #micro-batches is set equal to PP.
Top: the GPU execution timeline. Bottom: the peak activation memory usage timeline. The dotted horizontal line denotes
the memory cost of serial 1F1B execution.</span></figcaption>
</figure>
</section>
<section id="S7.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.3 </span>Effectiveness of Stage Fusion</h3>

<div id="S7.SS3.p1" class="ltx_para">
<p id="S7.SS3.p1.1" class="ltx_p">In this section, we show the effectiveness of
RLHFuse’s key techniques in §<a href="#S4" title="4 Data-aware Inter-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">4</span></a> and §<a href="#S5" title="5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5</span></a>.</p>
</div>
<div id="S7.SS3.p2" class="ltx_para ltx_noindent">
<p id="S7.SS3.p2.6" class="ltx_p"><span id="S7.SS3.p2.6.1" class="ltx_text ltx_font_bold">Inter-stage fusion.</span> One key parameter in inter-stage fusion is the
migration threshold <math id="S7.SS3.p2.1.m1.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S7.SS3.p2.1.m1.1a"><msub id="S7.SS3.p2.1.m1.1.1" xref="S7.SS3.p2.1.m1.1.1.cmml"><mi id="S7.SS3.p2.1.m1.1.1.2" xref="S7.SS3.p2.1.m1.1.1.2.cmml">R</mi><mi id="S7.SS3.p2.1.m1.1.1.3" xref="S7.SS3.p2.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.1.m1.1b"><apply id="S7.SS3.p2.1.m1.1.1.cmml" xref="S7.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S7.SS3.p2.1.m1.1.1.1.cmml" xref="S7.SS3.p2.1.m1.1.1">subscript</csymbol><ci id="S7.SS3.p2.1.m1.1.1.2.cmml" xref="S7.SS3.p2.1.m1.1.1.2">𝑅</ci><ci id="S7.SS3.p2.1.m1.1.1.3.cmml" xref="S7.SS3.p2.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.1.m1.1c">R_{t}</annotation></semantics></math>. As <math id="S7.SS3.p2.2.m2.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S7.SS3.p2.2.m2.1a"><msub id="S7.SS3.p2.2.m2.1.1" xref="S7.SS3.p2.2.m2.1.1.cmml"><mi id="S7.SS3.p2.2.m2.1.1.2" xref="S7.SS3.p2.2.m2.1.1.2.cmml">R</mi><mi id="S7.SS3.p2.2.m2.1.1.3" xref="S7.SS3.p2.2.m2.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.2.m2.1b"><apply id="S7.SS3.p2.2.m2.1.1.cmml" xref="S7.SS3.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S7.SS3.p2.2.m2.1.1.1.cmml" xref="S7.SS3.p2.2.m2.1.1">subscript</csymbol><ci id="S7.SS3.p2.2.m2.1.1.2.cmml" xref="S7.SS3.p2.2.m2.1.1.2">𝑅</ci><ci id="S7.SS3.p2.2.m2.1.1.3.cmml" xref="S7.SS3.p2.2.m2.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.2.m2.1c">R_{t}</annotation></semantics></math> increases from zero, it shifts from
fully serial execution to more aggressive fused execution. However, if <math id="S7.SS3.p2.3.m3.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S7.SS3.p2.3.m3.1a"><msub id="S7.SS3.p2.3.m3.1.1" xref="S7.SS3.p2.3.m3.1.1.cmml"><mi id="S7.SS3.p2.3.m3.1.1.2" xref="S7.SS3.p2.3.m3.1.1.2.cmml">R</mi><mi id="S7.SS3.p2.3.m3.1.1.3" xref="S7.SS3.p2.3.m3.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.3.m3.1b"><apply id="S7.SS3.p2.3.m3.1.1.cmml" xref="S7.SS3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S7.SS3.p2.3.m3.1.1.1.cmml" xref="S7.SS3.p2.3.m3.1.1">subscript</csymbol><ci id="S7.SS3.p2.3.m3.1.1.2.cmml" xref="S7.SS3.p2.3.m3.1.1.2">𝑅</ci><ci id="S7.SS3.p2.3.m3.1.1.3.cmml" xref="S7.SS3.p2.3.m3.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.3.m3.1c">R_{t}</annotation></semantics></math> is set too
large, the long-tail generation instances may be overloaded,
extending the original generation time. We measure the execution time of fused generation and inference stage
under different migration ratios (<math id="S7.SS3.p2.4.m4.1" class="ltx_Math" alttext="R_{t}/BS" display="inline"><semantics id="S7.SS3.p2.4.m4.1a"><mrow id="S7.SS3.p2.4.m4.1.1" xref="S7.SS3.p2.4.m4.1.1.cmml"><mrow id="S7.SS3.p2.4.m4.1.1.2" xref="S7.SS3.p2.4.m4.1.1.2.cmml"><msub id="S7.SS3.p2.4.m4.1.1.2.2" xref="S7.SS3.p2.4.m4.1.1.2.2.cmml"><mi id="S7.SS3.p2.4.m4.1.1.2.2.2" xref="S7.SS3.p2.4.m4.1.1.2.2.2.cmml">R</mi><mi id="S7.SS3.p2.4.m4.1.1.2.2.3" xref="S7.SS3.p2.4.m4.1.1.2.2.3.cmml">t</mi></msub><mo id="S7.SS3.p2.4.m4.1.1.2.1" xref="S7.SS3.p2.4.m4.1.1.2.1.cmml">/</mo><mi id="S7.SS3.p2.4.m4.1.1.2.3" xref="S7.SS3.p2.4.m4.1.1.2.3.cmml">B</mi></mrow><mo lspace="0em" rspace="0em" id="S7.SS3.p2.4.m4.1.1.1" xref="S7.SS3.p2.4.m4.1.1.1.cmml">​</mo><mi id="S7.SS3.p2.4.m4.1.1.3" xref="S7.SS3.p2.4.m4.1.1.3.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.4.m4.1b"><apply id="S7.SS3.p2.4.m4.1.1.cmml" xref="S7.SS3.p2.4.m4.1.1"><times id="S7.SS3.p2.4.m4.1.1.1.cmml" xref="S7.SS3.p2.4.m4.1.1.1"></times><apply id="S7.SS3.p2.4.m4.1.1.2.cmml" xref="S7.SS3.p2.4.m4.1.1.2"><divide id="S7.SS3.p2.4.m4.1.1.2.1.cmml" xref="S7.SS3.p2.4.m4.1.1.2.1"></divide><apply id="S7.SS3.p2.4.m4.1.1.2.2.cmml" xref="S7.SS3.p2.4.m4.1.1.2.2"><csymbol cd="ambiguous" id="S7.SS3.p2.4.m4.1.1.2.2.1.cmml" xref="S7.SS3.p2.4.m4.1.1.2.2">subscript</csymbol><ci id="S7.SS3.p2.4.m4.1.1.2.2.2.cmml" xref="S7.SS3.p2.4.m4.1.1.2.2.2">𝑅</ci><ci id="S7.SS3.p2.4.m4.1.1.2.2.3.cmml" xref="S7.SS3.p2.4.m4.1.1.2.2.3">𝑡</ci></apply><ci id="S7.SS3.p2.4.m4.1.1.2.3.cmml" xref="S7.SS3.p2.4.m4.1.1.2.3">𝐵</ci></apply><ci id="S7.SS3.p2.4.m4.1.1.3.cmml" xref="S7.SS3.p2.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.4.m4.1c">R_{t}/BS</annotation></semantics></math>) as shown in Figure <a href="#S7.F9" title="Figure 9 ‣ 7.1 End-to-End Results ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">9</span></a>.
We can see the optimal latency is achieved when the remaining samples account for about 20% of the batch size.
Note that <math id="S7.SS3.p2.5.m5.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S7.SS3.p2.5.m5.1a"><msub id="S7.SS3.p2.5.m5.1.1" xref="S7.SS3.p2.5.m5.1.1.cmml"><mi id="S7.SS3.p2.5.m5.1.1.2" xref="S7.SS3.p2.5.m5.1.1.2.cmml">R</mi><mi id="S7.SS3.p2.5.m5.1.1.3" xref="S7.SS3.p2.5.m5.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.5.m5.1b"><apply id="S7.SS3.p2.5.m5.1.1.cmml" xref="S7.SS3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S7.SS3.p2.5.m5.1.1.1.cmml" xref="S7.SS3.p2.5.m5.1.1">subscript</csymbol><ci id="S7.SS3.p2.5.m5.1.1.2.cmml" xref="S7.SS3.p2.5.m5.1.1.2">𝑅</ci><ci id="S7.SS3.p2.5.m5.1.1.3.cmml" xref="S7.SS3.p2.5.m5.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.5.m5.1c">R_{t}</annotation></semantics></math> is related to the output length distribution of the model
and this experiment is conduct during the early stage of training.
As training progresses, <math id="S7.SS3.p2.6.m6.1" class="ltx_Math" alttext="R_{t}" display="inline"><semantics id="S7.SS3.p2.6.m6.1a"><msub id="S7.SS3.p2.6.m6.1.1" xref="S7.SS3.p2.6.m6.1.1.cmml"><mi id="S7.SS3.p2.6.m6.1.1.2" xref="S7.SS3.p2.6.m6.1.1.2.cmml">R</mi><mi id="S7.SS3.p2.6.m6.1.1.3" xref="S7.SS3.p2.6.m6.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.6.m6.1b"><apply id="S7.SS3.p2.6.m6.1.1.cmml" xref="S7.SS3.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S7.SS3.p2.6.m6.1.1.1.cmml" xref="S7.SS3.p2.6.m6.1.1">subscript</csymbol><ci id="S7.SS3.p2.6.m6.1.1.2.cmml" xref="S7.SS3.p2.6.m6.1.1.2">𝑅</ci><ci id="S7.SS3.p2.6.m6.1.1.3.cmml" xref="S7.SS3.p2.6.m6.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.6.m6.1c">R_{t}</annotation></semantics></math> requires periodic adjustments to
adapt the distribution change. In practice, such changes are usually not
too drastic, so the adjustment frequency remains low.</p>
</div>
<figure id="S7.T3" class="ltx_table">
<div id="S7.T3.2" class="ltx_inline-block ltx_align_center ltx_transformed_outer" style="width:433.6pt;height:205.4pt;vertical-align:-0.5pt;"><span class="ltx_transformed_inner" style="transform:translate(-179.2pt,84.7pt) scale(0.547488180088049,0.547488180088049) ;">
<table id="S7.T3.2.1" class="ltx_tabular ltx_align_middle">
<tbody class="ltx_tbody">
<tr id="S7.T3.2.1.1.1" class="ltx_tr">
<td id="S7.T3.2.1.1.1.1" class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="4" rowspan="2"><span id="S7.T3.2.1.1.1.1.1" class="ltx_text ltx_font_bold" style="font-size:298%;">Settings</span></td>
<td id="S7.T3.2.1.1.1.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="3"><span id="S7.T3.2.1.1.1.2.1" class="ltx_text ltx_font_bold" style="font-size:298%;">Latency Speedup</span></td>
<td id="S7.T3.2.1.1.1.3" class="ltx_td ltx_align_center ltx_border_tt" colspan="2">
<span id="S7.T3.2.1.1.1.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">Memory Usage</span><span id="S7.T3.2.1.1.1.3.2" class="ltx_text" style="font-size:298%;"></span>
</td>
</tr>
<tr id="S7.T3.2.1.2.2" class="ltx_tr">
<td id="S7.T3.2.1.2.2.1" class="ltx_td ltx_align_center ltx_border_r" colspan="3"><span id="S7.T3.2.1.2.2.1.1" class="ltx_text ltx_font_bold" style="font-size:298%;">relative to 1F1B</span></td>
<td id="S7.T3.2.1.2.2.2" class="ltx_td ltx_align_center" colspan="2">
<span id="S7.T3.2.1.2.2.2.1" class="ltx_text ltx_font_bold" style="font-size:298%;">relative to 1F1B</span><span id="S7.T3.2.1.2.2.2.2" class="ltx_text" style="font-size:298%;"></span>
</td>
</tr>
<tr id="S7.T3.2.1.3.3" class="ltx_tr">
<td id="S7.T3.2.1.3.3.1" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.1.1" class="ltx_text ltx_font_bold" style="font-size:298%;">Models</span></td>
<td id="S7.T3.2.1.3.3.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.2.1" class="ltx_text ltx_font_bold" style="font-size:298%;">PP0</span></td>
<td id="S7.T3.2.1.3.3.3" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">PP1</span></td>
<td id="S7.T3.2.1.3.3.4" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">#MB</span></td>
<td id="S7.T3.2.1.3.3.5" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.5.1" class="ltx_text ltx_font_bold" style="font-size:298%;">greedy</span></td>
<td id="S7.T3.2.1.3.3.6" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.6.1" class="ltx_text ltx_font_bold" style="font-size:298%;">ours</span></td>
<td id="S7.T3.2.1.3.3.7" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.7.1" class="ltx_text ltx_font_bold" style="font-size:298%;">optimal</span></td>
<td id="S7.T3.2.1.3.3.8" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.3.3.8.1" class="ltx_text ltx_font_bold" style="font-size:298%;">greedy</span></td>
<td id="S7.T3.2.1.3.3.9" class="ltx_td ltx_align_center ltx_border_t"><span id="S7.T3.2.1.3.3.9.1" class="ltx_text ltx_font_bold" style="font-size:298%;">ours</span></td>
</tr>
<tr id="S7.T3.2.1.4.4" class="ltx_tr">
<td id="S7.T3.2.1.4.4.1" class="ltx_td ltx_align_center ltx_border_r ltx_border_t" rowspan="6"><span id="S7.T3.2.1.4.4.1.1" class="ltx_text" style="font-size:298%;">33B/13B</span></td>
<td id="S7.T3.2.1.4.4.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_t" rowspan="6"><span id="S7.T3.2.1.4.4.2.1" class="ltx_text" style="font-size:298%;">8</span></td>
<td id="S7.T3.2.1.4.4.3" class="ltx_td ltx_align_center ltx_border_r ltx_border_t" rowspan="3"><span id="S7.T3.2.1.4.4.3.1" class="ltx_text" style="font-size:298%;">4</span></td>
<td id="S7.T3.2.1.4.4.4" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.4.4.4.1" class="ltx_text" style="font-size:298%;">8</span></td>
<td id="S7.T3.2.1.4.4.5" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.4.4.5.1" class="ltx_text" style="font-size:298%;">1.29</span></td>
<td id="S7.T3.2.1.4.4.6" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.4.4.6.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.38</span></td>
<td id="S7.T3.2.1.4.4.7" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.4.4.7.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.38</span></td>
<td id="S7.T3.2.1.4.4.8" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.4.4.8.1" class="ltx_text" style="font-size:298%;">1.51</span></td>
<td id="S7.T3.2.1.4.4.9" class="ltx_td ltx_align_center ltx_border_t"><span id="S7.T3.2.1.4.4.9.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.5.5" class="ltx_tr">
<td id="S7.T3.2.1.5.5.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.5.5.1.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.5.5.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.5.5.2.1" class="ltx_text" style="font-size:298%;">1.12</span></td>
<td id="S7.T3.2.1.5.5.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.5.5.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.30</span></td>
<td id="S7.T3.2.1.5.5.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.5.5.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.30</span></td>
<td id="S7.T3.2.1.5.5.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.5.5.5.1" class="ltx_text" style="font-size:298%;">2.14</span></td>
<td id="S7.T3.2.1.5.5.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.5.5.6.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.6.6" class="ltx_tr">
<td id="S7.T3.2.1.6.6.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.6.6.1.1" class="ltx_text" style="font-size:298%;">32</span></td>
<td id="S7.T3.2.1.6.6.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.6.6.2.1" class="ltx_text" style="font-size:298%;">1.10</span></td>
<td id="S7.T3.2.1.6.6.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.6.6.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.15</span></td>
<td id="S7.T3.2.1.6.6.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.6.6.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.15</span></td>
<td id="S7.T3.2.1.6.6.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.6.6.5.1" class="ltx_text" style="font-size:298%;">2.75</span></td>
<td id="S7.T3.2.1.6.6.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.6.6.6.1" class="ltx_text" style="font-size:298%;">1.26</span></td>
</tr>
<tr id="S7.T3.2.1.7.7" class="ltx_tr">
<td id="S7.T3.2.1.7.7.1" class="ltx_td ltx_align_center ltx_border_r ltx_border_t" rowspan="3"><span id="S7.T3.2.1.7.7.1.1" class="ltx_text" style="font-size:298%;">8</span></td>
<td id="S7.T3.2.1.7.7.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.7.7.2.1" class="ltx_text" style="font-size:298%;">8</span></td>
<td id="S7.T3.2.1.7.7.3" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.7.7.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.4</span></td>
<td id="S7.T3.2.1.7.7.4" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.7.7.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.4</span></td>
<td id="S7.T3.2.1.7.7.5" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.7.7.5.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.4</span></td>
<td id="S7.T3.2.1.7.7.6" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.7.7.6.1" class="ltx_text" style="font-size:298%;">1.51</span></td>
<td id="S7.T3.2.1.7.7.7" class="ltx_td ltx_align_center ltx_border_t"><span id="S7.T3.2.1.7.7.7.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.8.8" class="ltx_tr">
<td id="S7.T3.2.1.8.8.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.8.8.1.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.8.8.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.8.8.2.1" class="ltx_text" style="font-size:298%;">1.15</span></td>
<td id="S7.T3.2.1.8.8.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.8.8.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.32</span></td>
<td id="S7.T3.2.1.8.8.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.8.8.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.32</span></td>
<td id="S7.T3.2.1.8.8.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.8.8.5.1" class="ltx_text" style="font-size:298%;">2.00</span></td>
<td id="S7.T3.2.1.8.8.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.8.8.6.1" class="ltx_text" style="font-size:298%;">1.19</span></td>
</tr>
<tr id="S7.T3.2.1.9.9" class="ltx_tr">
<td id="S7.T3.2.1.9.9.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.9.9.1.1" class="ltx_text" style="font-size:298%;">32</span></td>
<td id="S7.T3.2.1.9.9.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.9.9.2.1" class="ltx_text" style="font-size:298%;">1.08</span></td>
<td id="S7.T3.2.1.9.9.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.9.9.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.17</span></td>
<td id="S7.T3.2.1.9.9.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.9.9.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.17</span></td>
<td id="S7.T3.2.1.9.9.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.9.9.5.1" class="ltx_text" style="font-size:298%;">2.75</span></td>
<td id="S7.T3.2.1.9.9.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.9.9.6.1" class="ltx_text" style="font-size:298%;">1.31</span></td>
</tr>
<tr id="S7.T3.2.1.10.10" class="ltx_tr">
<td id="S7.T3.2.1.10.10.1" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" rowspan="6"><span id="S7.T3.2.1.10.10.1.1" class="ltx_text" style="font-size:298%;">65B/33B</span></td>
<td id="S7.T3.2.1.10.10.2" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" rowspan="6"><span id="S7.T3.2.1.10.10.2.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.10.10.3" class="ltx_td ltx_align_center ltx_border_r ltx_border_t" rowspan="3"><span id="S7.T3.2.1.10.10.3.1" class="ltx_text" style="font-size:298%;">8</span></td>
<td id="S7.T3.2.1.10.10.4" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.10.10.4.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.10.10.5" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.10.10.5.1" class="ltx_text" style="font-size:298%;">1.28</span></td>
<td id="S7.T3.2.1.10.10.6" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.10.10.6.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.48</span></td>
<td id="S7.T3.2.1.10.10.7" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.10.10.7.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.48</span></td>
<td id="S7.T3.2.1.10.10.8" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.10.10.8.1" class="ltx_text" style="font-size:298%;">1.61</span></td>
<td id="S7.T3.2.1.10.10.9" class="ltx_td ltx_align_center ltx_border_t"><span id="S7.T3.2.1.10.10.9.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.11.11" class="ltx_tr">
<td id="S7.T3.2.1.11.11.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.11.11.1.1" class="ltx_text" style="font-size:298%;">32</span></td>
<td id="S7.T3.2.1.11.11.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.11.11.2.1" class="ltx_text" style="font-size:298%;">1.14</span></td>
<td id="S7.T3.2.1.11.11.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.11.11.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.27</span></td>
<td id="S7.T3.2.1.11.11.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.11.11.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.27</span></td>
<td id="S7.T3.2.1.11.11.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.11.11.5.1" class="ltx_text" style="font-size:298%;">2.23</span></td>
<td id="S7.T3.2.1.11.11.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.11.11.6.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.12.12" class="ltx_tr">
<td id="S7.T3.2.1.12.12.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.12.12.1.1" class="ltx_text" style="font-size:298%;">64</span></td>
<td id="S7.T3.2.1.12.12.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.12.12.2.1" class="ltx_text" style="font-size:298%;">1.12</span></td>
<td id="S7.T3.2.1.12.12.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.12.12.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.15</span></td>
<td id="S7.T3.2.1.12.12.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.12.12.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.15</span></td>
<td id="S7.T3.2.1.12.12.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.12.12.5.1" class="ltx_text" style="font-size:298%;">2.88</span></td>
<td id="S7.T3.2.1.12.12.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.12.12.6.1" class="ltx_text" style="font-size:298%;">1.26</span></td>
</tr>
<tr id="S7.T3.2.1.13.13" class="ltx_tr">
<td id="S7.T3.2.1.13.13.1" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" rowspan="3"><span id="S7.T3.2.1.13.13.1.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.13.13.2" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.13.13.2.1" class="ltx_text" style="font-size:298%;">16</span></td>
<td id="S7.T3.2.1.13.13.3" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.13.13.3.1" class="ltx_text" style="font-size:298%;">1.27</span></td>
<td id="S7.T3.2.1.13.13.4" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.13.13.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.5</span></td>
<td id="S7.T3.2.1.13.13.5" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.13.13.5.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.5</span></td>
<td id="S7.T3.2.1.13.13.6" class="ltx_td ltx_align_center ltx_border_r ltx_border_t"><span id="S7.T3.2.1.13.13.6.1" class="ltx_text" style="font-size:298%;">1.57</span></td>
<td id="S7.T3.2.1.13.13.7" class="ltx_td ltx_align_center ltx_border_t"><span id="S7.T3.2.1.13.13.7.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.0</span></td>
</tr>
<tr id="S7.T3.2.1.14.14" class="ltx_tr">
<td id="S7.T3.2.1.14.14.1" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.14.14.1.1" class="ltx_text" style="font-size:298%;">32</span></td>
<td id="S7.T3.2.1.14.14.2" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.14.14.2.1" class="ltx_text" style="font-size:298%;">1.16</span></td>
<td id="S7.T3.2.1.14.14.3" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.14.14.3.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.33</span></td>
<td id="S7.T3.2.1.14.14.4" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.14.14.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.33</span></td>
<td id="S7.T3.2.1.14.14.5" class="ltx_td ltx_align_center ltx_border_r"><span id="S7.T3.2.1.14.14.5.1" class="ltx_text" style="font-size:298%;">2.00</span></td>
<td id="S7.T3.2.1.14.14.6" class="ltx_td ltx_align_center"><span id="S7.T3.2.1.14.14.6.1" class="ltx_text" style="font-size:298%;">1.22</span></td>
</tr>
<tr id="S7.T3.2.1.15.15" class="ltx_tr">
<td id="S7.T3.2.1.15.15.1" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r"><span id="S7.T3.2.1.15.15.1.1" class="ltx_text" style="font-size:298%;">64</span></td>
<td id="S7.T3.2.1.15.15.2" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r"><span id="S7.T3.2.1.15.15.2.1" class="ltx_text" style="font-size:298%;">1.09</span></td>
<td id="S7.T3.2.1.15.15.3" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r"><span id="S7.T3.2.1.15.15.3.1" class="ltx_text" style="font-size:298%;">1.16</span></td>
<td id="S7.T3.2.1.15.15.4" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r"><span id="S7.T3.2.1.15.15.4.1" class="ltx_text ltx_font_bold" style="font-size:298%;">1.17</span></td>
<td id="S7.T3.2.1.15.15.5" class="ltx_td ltx_align_center ltx_border_bb ltx_border_r"><span id="S7.T3.2.1.15.15.5.1" class="ltx_text" style="font-size:298%;">2.88</span></td>
<td id="S7.T3.2.1.15.15.6" class="ltx_td ltx_align_center ltx_border_bb"><span id="S7.T3.2.1.15.15.6.1" class="ltx_text" style="font-size:298%;">1.47</span></td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span id="S7.T3.3.1.1" class="ltx_text" style="font-size:90%;">Table 3</span>: </span><span id="S7.T3.4.2" class="ltx_text" style="font-size:90%;">The latency speedup and peak activation memory cost of pipeline schedules found by different algorithms
under different model, pipeline stage, and micro-batch settings.</span></figcaption>
</figure>
<div id="S7.SS3.p3" class="ltx_para ltx_noindent">
<p id="S7.SS3.p3.1" class="ltx_p"><span id="S7.SS3.p3.1.1" class="ltx_text ltx_font_bold">Intra-stage fusion.</span> We compare RLHFuse’s simulated annealing algorithm against
the greedy approach mentioned in §<a href="#S5.SS2" title="5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5.2</span></a>
and show the latency speedup and peak activation memory usage
relative to the serial execution of the two models with 1F1B schedule in Table <a href="#S7.T3" title="Table 3 ‣ 7.3 Effectiveness of Stage Fusion ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3</span></a>.
For the latency, we also include a lower bound calculated as follows:
we first compute the earliest possible completion time on each stage,
which consists of three parts: the earliest possible arrival time of
the first task, the total time required to process all the tasks,
and the remaining time needed for the subsequent pipeline stages of the final task;
we then take the maximum of these times across all stages as the lower bound of
the fused pipeline schedule.
Note that there may not necessarily exist a schedule that reaches this lower bound,
but we can use it as a metric to assess how close our algorithm is to the optimal
solution. Under all the settings,
our approach outperforms the greedy method and achieves the theoretical lower bound
except for the last case.
As for the memory cost, the serial 1F1B execution serves as the lower bound for the
fused schedule. Our method also greatly outperforms the greedy approach and
often reaches the lower bound. Even when it does not achieve the lower bound,
the extra overhead remains within an acceptable range.</p>
</div>
</section>
<section id="S7.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.4 </span>Deep Dive</h3>

<div id="S7.SS4.p1" class="ltx_para">
<p id="S7.SS4.p1.1" class="ltx_p">In this section, we deep dive into RLHFuse by showing a fused pipeline schedule produced by RLHFuse for the
65B/33B model setting. The upper of Figure <a href="#S7.F10" title="Figure 10 ‣ 7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">10</span></a> shows
the GPU execution timeline, with forward and backward tasks in light and dark colors, respectively. With intra-stage fusion,
RLHFuse strategically fuses one 65B model of 16 PP stages (blue grids) with two 33B models
that each has 8 PP stages (pink grids) to fill the pipeline bubbles of each other
in reversed pipeline directions.
Ultimately, the execution time of this fused pipeline schedule is the same as individually executing the 65B model
using 1F1B schedule, which means we completely overlap the training of the
33B model, achieving the theoretical lower bound. Meanwhile, as shown in
the bottom of Figure <a href="#S7.F10" title="Figure 10 ‣ 7.2 Performance Analysis ‣ 7 Evaluation ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">10</span></a>, the peak activation
memory usage also achieves the lower bound of executing the two models
in serial with 1F1B schedule. This complex schedule, which achieves
optimal performance in both time and memory usage, is difficult to design manually,
further demonstrating the effectiveness of our fused pipeline schedule generation algorithm proposed in §<a href="#S5.SS2" title="5.2 Fused Pipeline Schedule ‣ 5 Model-aware Intra-Stage Fusion ‣ RLHFuse: Efficient RLHF Training for Large Language Models with Inter- and Intra-Stage Fusion" class="ltx_ref"><span class="ltx_text ltx_ref_tag">5.2</span></a>.</p>
</div>
</section>
</section>
<section id="S8" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">8 </span>Related Work</h2>

<div id="S8.p1" class="ltx_para ltx_noindent">
<p id="S8.p1.1" class="ltx_p"><span id="S8.p1.1.1" class="ltx_text ltx_font_bold">RLHF training systems.</span>
As RLHF gradually becomes the primary approach for LLM alignment,
many distributed frameworks are specifically designed for RLHF training.
trlX <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib46" title="" class="ltx_ref">46</a>]</cite> proposes algorithmic system enhancements to
reduce compute and memory requirements.
OpenRLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib47" title="" class="ltx_ref">47</a>]</cite>
notices that different RLHF training tasks have different resource requirements
and proposes to designate customized parallel strategies for different
tasks.
ReaLHF <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib13" title="" class="ltx_ref">13</a>]</cite> further proposes parameter reallocation to dynamically
redistribute LLM parameters on shared GPU devices to avoid under-utilization.
PUZZLE <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib14" title="" class="ltx_ref">14</a>]</cite> proposes lightweight context switching to reduce
the task switching overhead, which is orthogonal and partly integrated into RLHFuse.
However, all the above systems overlook the subtask-level optimization
opportunities and suffer from the data skewness and pipeline bubble issues.</p>
</div>
<div id="S8.p2" class="ltx_para ltx_noindent">
<p id="S8.p2.1" class="ltx_p"><span id="S8.p2.1.1" class="ltx_text ltx_font_bold">LLM generation optimizations.</span>
Many systems focus on optimizing the LLM generation performance <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib37" title="" class="ltx_ref">37</a>, <a href="#bib.bib48" title="" class="ltx_ref">48</a>, <a href="#bib.bib38" title="" class="ltx_ref">38</a>, <a href="#bib.bib49" title="" class="ltx_ref">49</a>, <a href="#bib.bib50" title="" class="ltx_ref">50</a>]</cite>,
and many of them have been adopted by RLHFuse to accelerate the generation stage.
Besides, AlpaServe <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib51" title="" class="ltx_ref">51</a>]</cite>
multiplexes the LLM execution with colocated parallelism to
improve the inference throughput under bursty workload.
FastServe <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib27" title="" class="ltx_ref">27</a>]</cite> proposes preemptive scheduling on iteration-level
to mitigate the head-of-line blocking caused by long-tailed samples.
Splitwise <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib52" title="" class="ltx_ref">52</a>]</cite> and DistServe <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib26" title="" class="ltx_ref">26</a>]</cite> split the prefill and decoding phases
to avoid interference between them.
These works are orthogonal to RLHFuse and can be integrated into RLHFuse.</p>
</div>
<div id="S8.p3" class="ltx_para ltx_noindent">
<p id="S8.p3.1" class="ltx_p"><span id="S8.p3.1.1" class="ltx_text ltx_font_bold">LLM training optimizations.</span>
LLM training has been studied by many research works from
various aspects. In particular, GPipe <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib18" title="" class="ltx_ref">18</a>]</cite> and (Interleaved) 1F1B <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib53" title="" class="ltx_ref">53</a>, <a href="#bib.bib54" title="" class="ltx_ref">54</a>]</cite>
use pipeline parallelism to improve the training throughput and
reduce memory footprint. Chimera <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib20" title="" class="ltx_ref">20</a>]</cite> combines bi-directional
pipeline parallelism to further reduce pipeline bubbles.
Alpa <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib55" title="" class="ltx_ref">55</a>]</cite> automatically generates the optimal
parallel strategy to improve training performance.
MegaScale <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib17" title="" class="ltx_ref">17</a>]</cite> provides a detailed experience in
building a production LLM training system at a large scale.
DistTrain <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib56" title="" class="ltx_ref">56</a>]</cite> focuses on addressing the model and data heterogeneity
in multimodal LLM training.
These works are agnostic to RLHF thus do not utilizes the
characteristics to optimize the RLHF training stage.</p>
</div>
</section>
<section id="S9" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">9 </span>Conclusion</h2>

<div id="S9.p1" class="ltx_para">
<p id="S9.p1.1" class="ltx_p">We present RLHFuse, a highly efficient RLHF training framework for LLMs.
By carefully revisiting the inherent characteristics and task dependencies,
RLHFuse views the RLHF workflow from a finer-grained subtask-level
perspective while preserving the original synchronous training semantics.
This opens up opportunities for efficient inter- and intra-stage fused execution,
greatly mitigating the data skewness and pipeline bubbles in existing systems.
The evaluation shows that RLHFuse can significantly
increase GPU utilization, boosting training throughput by up to <math id="S9.p1.1.m1.1" class="ltx_math_unparsed" alttext="3.7\times" display="inline"><semantics id="S9.p1.1.m1.1a"><mrow id="S9.p1.1.m1.1b"><mn id="S9.p1.1.m1.1.1">3.7</mn><mo lspace="0.222em" id="S9.p1.1.m1.1.2">×</mo></mrow><annotation encoding="application/x-tex" id="S9.p1.1.m1.1c">3.7\times</annotation></semantics></math>
compared to current state-of-the-art systems.</p>
</div>
</section>
<section id="bib" class="ltx_bibliography">
<h2 class="ltx_title ltx_title_bibliography">References</h2>

<ul class="ltx_biblist">
<li id="bib.bib1" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[1]</span>
<span class="ltx_bibblock">
“Perplexity is a free ai-powered answer engine that provides accurate, trusted, and real-time answers to any question..” <a target="_blank" href="https://perplexity.ai" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://perplexity.ai</a>, 2024.

</span>
</li>
<li id="bib.bib2" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[2]</span>
<span class="ltx_bibblock">
“Introducing chatgpt.” <a target="_blank" href="https://openai.com/blog/chatgpt" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://openai.com/blog/chatgpt</a>, 2022.

</span>
</li>
<li id="bib.bib3" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[3]</span>
<span class="ltx_bibblock">
“Apple intelligence preview.” <a target="_blank" href="https://www.apple.com/apple-intelligence/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://www.apple.com/apple-intelligence/</a>, 2024.

</span>
</li>
<li id="bib.bib4" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[4]</span>
<span class="ltx_bibblock">
“Figure is the first-of-its-kind ai robotics company bringing a general purpose humanoid to life..” <a target="_blank" href="https://figure.ai" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://figure.ai</a>, 2024.

</span>
</li>
<li id="bib.bib5" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[5]</span>
<span class="ltx_bibblock">
S. Gehman, S. Gururangan, M. Sap, Y. Choi, and N. A. Smith, “Realtoxicityprompts: Evaluating neural toxic degeneration in language models,” 2020.

</span>
</li>
<li id="bib.bib6" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[6]</span>
<span class="ltx_bibblock">
E. M. Bender, T. Gebru, A. McMillan-Major, and S. Shmitchell, “On the dangers of stochastic parrots: Can language models be too big?,” in <span id="bib.bib6.1.1" class="ltx_text ltx_font_italic">Proceedings of the 2021 ACM Conference on Fairness, Accountability, and Transparency</span>, (New York, NY, USA), pp. 610–623, 2021.

</span>
</li>
<li id="bib.bib7" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[7]</span>
<span class="ltx_bibblock">
S. Lin, J. Hilton, and O. Evans, “Truthfulqa: Measuring how models mimic human falsehoods,” 2022.

</span>
</li>
<li id="bib.bib8" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[8]</span>
<span class="ltx_bibblock">
L. Ouyang, J. Wu, X. Jiang, D. Almeida, C. L. Wainwright, P. Mishkin, C. Zhang, S. Agarwal, K. Slama, A. Ray, J. Schulman, J. Hilton, F. Kelton, L. Miller, M. Simens, A. Askell, P. Welinder, P. Christiano, J. Leike, and R. Lowe, “Training language models to follow instructions with human feedback,” 2022.

</span>
</li>
<li id="bib.bib9" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[9]</span>
<span class="ltx_bibblock">
T. Brown, B. Mann, N. Ryder, M. Subbiah, J. D. Kaplan, P. Dhariwal, A. Neelakantan, P. Shyam, G. Sastry, A. Askell, <span id="bib.bib9.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Language models are few-shot learners,” <span id="bib.bib9.2.2" class="ltx_text ltx_font_italic">Advances in neural information processing systems</span>, vol. 33, pp. 1877–1901, 2020.

</span>
</li>
<li id="bib.bib10" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[10]</span>
<span class="ltx_bibblock">
“Introducing gemini: our largest and most capable ai model.” <a target="_blank" href="https://blog.google/technology/ai/google-gemini-ai/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://blog.google/technology/ai/google-gemini-ai/</a>, 2023.

</span>
</li>
<li id="bib.bib11" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[11]</span>
<span class="ltx_bibblock">
“Introducing the next generation of claude.” <a target="_blank" href="https://www.anthropic.com/news/claude-3-family" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://www.anthropic.com/news/claude-3-family</a>, 2024.

</span>
</li>
<li id="bib.bib12" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[12]</span>
<span class="ltx_bibblock">
“Qwen2.5: A party of foundation models!.” <a target="_blank" href="https://qwenlm.github.io/blog/qwen2.5/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://qwenlm.github.io/blog/qwen2.5/</a>, 2024.

</span>
</li>
<li id="bib.bib13" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[13]</span>
<span class="ltx_bibblock">
Z. Mei, W. Fu, K. Li, G. Wang, H. Zhang, and Y. Wu, “Realhf: Optimized rlhf training for large language models through parameter reallocation,” <span id="bib.bib13.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2406.14088</span>, 2024.

</span>
</li>
<li id="bib.bib14" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[14]</span>
<span class="ltx_bibblock">
K. Lei, Y. Jin, M. Zhai, K. Huang, H. Ye, and J. Zhai, “<math id="bib.bib14.1.m1.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib14.1.m1.1a"><mo stretchy="false" id="bib.bib14.1.m1.1.1" xref="bib.bib14.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib14.1.m1.1b"><ci id="bib.bib14.1.m1.1.1.cmml" xref="bib.bib14.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib14.1.m1.1c">\{</annotation></semantics></math>PUZZLE<math id="bib.bib14.2.m2.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib14.2.m2.1a"><mo stretchy="false" id="bib.bib14.2.m2.1.1" xref="bib.bib14.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib14.2.m2.1b"><ci id="bib.bib14.2.m2.1.1.cmml" xref="bib.bib14.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib14.2.m2.1c">\}</annotation></semantics></math>: Efficiently aligning large language models through <math id="bib.bib14.3.m3.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib14.3.m3.1a"><mo stretchy="false" id="bib.bib14.3.m3.1.1" xref="bib.bib14.3.m3.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib14.3.m3.1b"><ci id="bib.bib14.3.m3.1.1.cmml" xref="bib.bib14.3.m3.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib14.3.m3.1c">\{</annotation></semantics></math>Light-Weight<math id="bib.bib14.4.m4.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib14.4.m4.1a"><mo stretchy="false" id="bib.bib14.4.m4.1.1" xref="bib.bib14.4.m4.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib14.4.m4.1b"><ci id="bib.bib14.4.m4.1.1.cmml" xref="bib.bib14.4.m4.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib14.4.m4.1c">\}</annotation></semantics></math> context switch,” in <span id="bib.bib14.5.1" class="ltx_text ltx_font_italic">2024 USENIX Annual Technical Conference (USENIX ATC 24)</span>, pp. 127–140, 2024.

</span>
</li>
<li id="bib.bib15" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[15]</span>
<span class="ltx_bibblock">
“Gpt-4o long output.” <a target="_blank" href="https://openai.com/gpt-4o-long-output/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://openai.com/gpt-4o-long-output/</a>, 2024.

</span>
</li>
<li id="bib.bib16" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[16]</span>
<span class="ltx_bibblock">
M. Shoeybi, M. Patwary, R. Puri, P. LeGresley, J. Casper, and B. Catanzaro, “Megatron-lm: Training multi-billion parameter language models using model parallelism,” 2020.

</span>
</li>
<li id="bib.bib17" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[17]</span>
<span class="ltx_bibblock">
Z. Jiang, H. Lin, Y. Zhong, Q. Huang, Y. Chen, Z. Zhang, Y. Peng, X. Li, C. Xie, S. Nong, <span id="bib.bib17.5.1" class="ltx_text ltx_font_italic">et al.</span>, “<math id="bib.bib17.1.m1.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib17.1.m1.1a"><mo stretchy="false" id="bib.bib17.1.m1.1.1" xref="bib.bib17.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib17.1.m1.1b"><ci id="bib.bib17.1.m1.1.1.cmml" xref="bib.bib17.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib17.1.m1.1c">\{</annotation></semantics></math>MegaScale<math id="bib.bib17.2.m2.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib17.2.m2.1a"><mo stretchy="false" id="bib.bib17.2.m2.1.1" xref="bib.bib17.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib17.2.m2.1b"><ci id="bib.bib17.2.m2.1.1.cmml" xref="bib.bib17.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib17.2.m2.1c">\}</annotation></semantics></math>: Scaling large language model training to more than 10,000 <math id="bib.bib17.3.m3.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib17.3.m3.1a"><mo stretchy="false" id="bib.bib17.3.m3.1.1" xref="bib.bib17.3.m3.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib17.3.m3.1b"><ci id="bib.bib17.3.m3.1.1.cmml" xref="bib.bib17.3.m3.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib17.3.m3.1c">\{</annotation></semantics></math>GPUs<math id="bib.bib17.4.m4.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib17.4.m4.1a"><mo stretchy="false" id="bib.bib17.4.m4.1.1" xref="bib.bib17.4.m4.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib17.4.m4.1b"><ci id="bib.bib17.4.m4.1.1.cmml" xref="bib.bib17.4.m4.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib17.4.m4.1c">\}</annotation></semantics></math>,” in <span id="bib.bib17.6.2" class="ltx_text ltx_font_italic">21st USENIX Symposium on Networked Systems Design and Implementation (NSDI 24)</span>, pp. 745–760, 2024.

</span>
</li>
<li id="bib.bib18" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[18]</span>
<span class="ltx_bibblock">
Y. Huang, Y. Cheng, A. Bapna, O. Firat, D. Chen, M. Chen, H. Lee, J. Ngiam, Q. V. Le, Y. Wu, <span id="bib.bib18.1.1" class="ltx_text ltx_font_italic">et al.</span>, “GPipe: Efficient Training of Giant Neural Networks using Pipeline Parallelism ,” in <span id="bib.bib18.2.2" class="ltx_text ltx_font_italic">NeurIPS</span>, 2019.

</span>
</li>
<li id="bib.bib19" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[19]</span>
<span class="ltx_bibblock">
D. Narayanan, A. Harlap, A. Phanishayee, V. Seshadri, N. R. Devanur, G. R. Ganger, P. B. Gibbons, and M. Zaharia, “PipeDream: generalized pipeline parallelism for DNN training,” in <span id="bib.bib19.1.1" class="ltx_text ltx_font_italic">SOSP</span>, 2019.

</span>
</li>
<li id="bib.bib20" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[20]</span>
<span class="ltx_bibblock">
S. Li and T. Hoefler, “Chimera: efficiently training large-scale neural networks with bidirectional pipelines,” in <span id="bib.bib20.1.1" class="ltx_text ltx_font_italic">Proceedings of the International Conference for High Performance Computing, Networking, Storage and Analysis</span>, pp. 1–14, 2021.

</span>
</li>
<li id="bib.bib21" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[21]</span>
<span class="ltx_bibblock">
P. Qi, X. Wan, G. Huang, and M. Lin, “Zero bubble pipeline parallelism,” <span id="bib.bib21.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2401.10241</span>, 2023.

</span>
</li>
<li id="bib.bib22" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[22]</span>
<span class="ltx_bibblock">
J. Schulman, F. Wolski, P. Dhariwal, A. Radford, and O. Klimov, “Proximal policy optimization algorithms,” 2017.

</span>
</li>
<li id="bib.bib23" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[23]</span>
<span class="ltx_bibblock">
J. Kaplan, S. McCandlish, T. Henighan, T. B. Brown, B. Chess, R. Child, S. Gray, A. Radford, J. Wu, and D. Amodei, “Scaling laws for neural language models,” 2020.

</span>
</li>
<li id="bib.bib24" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[24]</span>
<span class="ltx_bibblock">
L. Zheng, W.-L. Chiang, Y. Sheng, T. Li, S. Zhuang, Z. Wu, Y. Zhuang, Z. Li, Z. Lin, E. P. Xing, J. E. Gonzalez, I. Stoica, and H. Zhang, “Lmsys-chat-1m: A large-scale real-world llm conversation dataset,” 2024.

</span>
</li>
<li id="bib.bib25" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[25]</span>
<span class="ltx_bibblock">
D. Narayanan, A. Harlap, A. Phanishayee, V. Seshadri, N. R. Devanur, G. R. Ganger, P. B. Gibbons, and M. Zaharia, “Pipedream: Generalized pipeline parallelism for dnn training,” in <span id="bib.bib25.1.1" class="ltx_text ltx_font_italic">ACM SOSP</span>, 2019.

</span>
</li>
<li id="bib.bib26" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[26]</span>
<span class="ltx_bibblock">
Y. Zhong, S. Liu, J. Chen, J. Hu, Y. Zhu, X. Liu, X. Jin, and H. Zhang, “Distserve: Disaggregating prefill and decoding for goodput-optimized large language model serving,” <span id="bib.bib26.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2401.09670</span>, 2024.

</span>
</li>
<li id="bib.bib27" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[27]</span>
<span class="ltx_bibblock">
B. Wu, Y. Zhong, Z. Zhang, G. Huang, X. Liu, and X. Jin, “Fast distributed inference serving for large language models,” <span id="bib.bib27.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2305.05920</span>, 2023.

</span>
</li>
<li id="bib.bib28" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[28]</span>
<span class="ltx_bibblock">
W. Kwon, Z. Li, S. Zhuang, Y. Sheng, L. Zheng, C. H. Yu, J. Gonzalez, H. Zhang, and I. Stoica, “Efficient memory management for large language model serving with pagedattention,” in <span id="bib.bib28.1.1" class="ltx_text ltx_font_italic">Proceedings of the 29th Symposium on Operating Systems Principles</span>, pp. 611–626, 2023.

</span>
</li>
<li id="bib.bib29" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[29]</span>
<span class="ltx_bibblock">
H. Emmons and G. Vairaktarakis, <span id="bib.bib29.1.1" class="ltx_text ltx_font_italic">Flow shop scheduling: theoretical results, algorithms, and applications</span>.

</span>
<span class="ltx_bibblock">Springer Science &amp; Business Media, 2012.

</span>
</li>
<li id="bib.bib30" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[30]</span>
<span class="ltx_bibblock">
S. Kirkpatrick, C. D. Gelatt Jr, and M. P. Vecchi, “Optimization by simulated annealing,” <span id="bib.bib30.1.1" class="ltx_text ltx_font_italic">science</span>, pp. 671–680, 1983.

</span>
</li>
<li id="bib.bib31" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[31]</span>
<span class="ltx_bibblock">
Z. Zhang, Y. Zhong, R. Ming, H. Hu, J. Sun, Z. Ge, Y. Zhu, and X. Jin, “Disttrain: Addressing model and data heterogeneity with disaggregated training for multimodal large language models,” 2024.

</span>
</li>
<li id="bib.bib32" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[32]</span>
<span class="ltx_bibblock">
C. Sun, S. Huang, and D. Pompili, “Llm-based multi-agent reinforcement learning: Current and future directions,” <span id="bib.bib32.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2405.11106</span>, 2024.

</span>
</li>
<li id="bib.bib33" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[33]</span>
<span class="ltx_bibblock">
L. Zheng, Z. Li, H. Zhang, Y. Zhuang, Z. Chen, Y. Huang, Y. Wang, Y. Xu, D. Zhuo, E. P. Xing, J. E. Gonzalez, and I. Stoica, “Alpa: Automating inter- and Intra-Operator parallelism for distributed deep learning,” in <span id="bib.bib33.1.1" class="ltx_text ltx_font_italic">USENIX OSDI</span>, 2022.

</span>
</li>
<li id="bib.bib34" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[34]</span>
<span class="ltx_bibblock">
X. Miao, Y. Wang, Y. Jiang, C. Shi, X. Nie, H. Zhang, and B. Cui, “Galvatron: Efficient transformer training over multiple gpus using automatic parallelism,” <span id="bib.bib34.1.1" class="ltx_text ltx_font_italic">Proceedings of the VLDB Endowment</span>, pp. 470–479, 2022.

</span>
</li>
<li id="bib.bib35" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[35]</span>
<span class="ltx_bibblock">
E. Gabriel, G. E. Fagg, G. Bosilca, T. Angskun, J. J. Dongarra, J. M. Squyres, V. Sahay, P. Kambadur, B. Barrett, A. Lumsdaine, <span id="bib.bib35.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Open mpi: Goals, concept, and design of a next generation mpi implementation,” in <span id="bib.bib35.2.2" class="ltx_text ltx_font_italic">Recent Advances in Parallel Virtual Machine and Message Passing Interface</span>, 2004.

</span>
</li>
<li id="bib.bib36" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[36]</span>
<span class="ltx_bibblock">
“Optimized primitives for collective multi-gpu communication.” <a target="_blank" href="https://github.com/NVIDIA/nccl" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/NVIDIA/nccl</a>, 2024.

</span>
</li>
<li id="bib.bib37" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[37]</span>
<span class="ltx_bibblock">
G.-I. Yu, J. S. Jeong, G.-W. Kim, S. Kim, and B.-G. Chun, “Orca: A distributed serving system for <math id="bib.bib37.1.m1.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib37.1.m1.1a"><mo stretchy="false" id="bib.bib37.1.m1.1.1" xref="bib.bib37.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib37.1.m1.1b"><ci id="bib.bib37.1.m1.1.1.cmml" xref="bib.bib37.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib37.1.m1.1c">\{</annotation></semantics></math>Transformer-Based<math id="bib.bib37.2.m2.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib37.2.m2.1a"><mo stretchy="false" id="bib.bib37.2.m2.1.1" xref="bib.bib37.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib37.2.m2.1b"><ci id="bib.bib37.2.m2.1.1.cmml" xref="bib.bib37.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib37.2.m2.1c">\}</annotation></semantics></math> generative models,” in <span id="bib.bib37.3.1" class="ltx_text ltx_font_italic">USENIX OSDI</span>, 2022.

</span>
</li>
<li id="bib.bib38" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[38]</span>
<span class="ltx_bibblock">
L. Zheng, L. Yin, Z. Xie, C. Sun, J. Huang, C. H. Yu, S. Cao, C. Kozyrakis, I. Stoica, J. E. Gonzalez, C. Barrett, and Y. Sheng, “Sglang: Efficient execution of structured language model programs,” 2024.

</span>
</li>
<li id="bib.bib39" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[39]</span>
<span class="ltx_bibblock">
J. Schulman, P. Moritz, S. Levine, M. Jordan, and P. Abbeel, “High-dimensional continuous control using generalized advantage estimation,” 2018.

</span>
</li>
<li id="bib.bib40" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[40]</span>
<span class="ltx_bibblock">
Y. Zhuang, H. Zhao, L. Zheng, Z. Li, E. P. Xing, Q. Ho, J. E. Gonzalez, I. Stoica, and H. Zhang, “On optimizing the communication of model parallelism,” 2024.

</span>
</li>
<li id="bib.bib41" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[41]</span>
<span class="ltx_bibblock">
H. Touvron, T. Lavril, G. Izacard, X. Martinet, M.-A. Lachaux, T. Lacroix, B. Rozière, N. Goyal, E. Hambro, F. Azhar, A. Rodriguez, A. Joulin, E. Grave, and G. Lample, “Llama: Open and efficient foundation language models,” 2023.

</span>
</li>
<li id="bib.bib42" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[42]</span>
<span class="ltx_bibblock">
Y. Bai, A. Jones, K. Ndousse, A. Askell, A. Chen, N. DasSarma, D. Drain, S. Fort, D. Ganguli, T. Henighan, N. Joseph, S. Kadavath, J. Kernion, T. Conerly, S. El-Showk, N. Elhage, Z. Hatfield-Dodds, D. Hernandez, T. Hume, S. Johnston, S. Kravec, L. Lovitt, N. Nanda, C. Olsson, D. Amodei, T. Brown, J. Clark, S. McCandlish, C. Olah, B. Mann, and J. Kaplan, “Training a helpful and harmless assistant with reinforcement learning from human feedback,” 2022.

</span>
</li>
<li id="bib.bib43" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[43]</span>
<span class="ltx_bibblock">
H. Touvron, L. Martin, K. Stone, P. Albert, A. Almahairi, Y. Babaei, N. Bashlykov, S. Batra, P. Bhargava, S. Bhosale, D. Bikel, L. Blecher, C. C. Ferrer, M. Chen, G. Cucurull, D. Esiobu, J. Fernandes, J. Fu, W. Fu, B. Fuller, C. Gao, V. Goswami, N. Goyal, A. Hartshorn, S. Hosseini, R. Hou, H. Inan, M. Kardas, V. Kerkez, M. Khabsa, I. Kloumann, A. Korenev, P. S. Koura, M.-A. Lachaux, T. Lavril, J. Lee, D. Liskovich, Y. Lu, Y. Mao, X. Martinet, T. Mihaylov, P. Mishra, I. Molybog, Y. Nie, A. Poulton, J. Reizenstein, R. Rungta, K. Saladi, A. Schelten, R. Silva, E. M. Smith, R. Subramanian, X. E. Tan, B. Tang, R. Taylor, A. Williams, J. X. Kuan, P. Xu, Z. Yan, I. Zarov, Y. Zhang, A. Fan, M. Kambadur, S. Narang, A. Rodriguez, R. Stojnic, S. Edunov, and T. Scialom, “Llama 2: Open foundation and fine-tuned chat models,” 2023.

</span>
</li>
<li id="bib.bib44" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[44]</span>
<span class="ltx_bibblock">
Z. Yao, R. Y. Aminabadi, O. Ruwase, S. Rajbhandari, X. Wu, A. A. Awan, J. Rasley, M. Zhang, C. Li, C. Holmes, Z. Zhou, M. Wyatt, M. Smith, L. Kurilenko, H. Qin, M. Tanaka, S. Che, S. L. Song, and Y. He, “Deepspeed-chat: Easy, fast and affordable rlhf training of chatgpt-like models at all scales,” 2023.

</span>
</li>
<li id="bib.bib45" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[45]</span>
<span class="ltx_bibblock">
S. Rajbhandari, J. Rasley, O. Ruwase, and Y. He, “Zero: Memory optimizations toward training trillion parameter models.” ArXiv, May 2020.

</span>
</li>
<li id="bib.bib46" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[46]</span>
<span class="ltx_bibblock">
A. Havrilla, M. Zhuravinskyi, D. Phung, A. Tiwari, J. Tow, S. Biderman, Q. Anthony, and L. Castricato, “trlx: A framework for large scale reinforcement learning from human feedback,” in <span id="bib.bib46.1.1" class="ltx_text ltx_font_italic">Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing</span>, pp. 8578–8595, 2023.

</span>
</li>
<li id="bib.bib47" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[47]</span>
<span class="ltx_bibblock">
J. Hu, X. Wu, W. Wang, D. Zhang, Y. Cao, <span id="bib.bib47.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Openrlhf: An easy-to-use, scalable and high-performance rlhf framework,” <span id="bib.bib47.2.2" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2405.11143</span>, 2024.

</span>
</li>
<li id="bib.bib48" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[48]</span>
<span class="ltx_bibblock">
W. Kwon, Z. Li, S. Zhuang, Y. Sheng, L. Zheng, C. H. Yu, J. Gonzalez, H. Zhang, and I. Stoica, “Efficient memory management for large language model serving with pagedattention,” in <span id="bib.bib48.1.1" class="ltx_text ltx_font_italic">Proceedings of the 29th Symposium on Operating Systems Principles</span>, pp. 611–626, 2023.

</span>
</li>
<li id="bib.bib49" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[49]</span>
<span class="ltx_bibblock">
K. Hong, G. Dai, J. Xu, Q. Mao, X. Li, J. Liu, K. Chen, H. Dong, and Y. Wang, “Flashdecoding++: Faster large language model inference on gpus,” <span id="bib.bib49.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2311.01282</span>, 2023.

</span>
</li>
<li id="bib.bib50" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[50]</span>
<span class="ltx_bibblock">
L. Chang, W. Bao, Q. Hou, C. Jiang, N. Zheng, Y. Zhong, X. Zhang, Z. Song, Z. Jiang, H. Lin, <span id="bib.bib50.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Flux: Fast software-based communication overlap on gpus through kernel fusion,” <span id="bib.bib50.2.2" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2406.06858</span>, 2024.

</span>
</li>
<li id="bib.bib51" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[51]</span>
<span class="ltx_bibblock">
Z. Li, L. Zheng, Y. Zhong, V. Liu, Y. Sheng, X. Jin, Y. Huang, Z. Chen, H. Zhang, J. E. Gonzalez, <span id="bib.bib51.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Alpaserve: Statistical multiplexing with model parallelism for deep learning serving,” <span id="bib.bib51.2.2" class="ltx_text ltx_font_italic">arXiv</span>, 2023.

</span>
</li>
<li id="bib.bib52" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[52]</span>
<span class="ltx_bibblock">
P. Patel, E. Choukse, C. Zhang, A. Shah, Í. Goiri, S. Maleki, and R. Bianchini, “Splitwise: Efficient generative llm inference using phase splitting,” in <span id="bib.bib52.1.1" class="ltx_text ltx_font_italic">2024 ACM/IEEE 51st Annual International Symposium on Computer Architecture (ISCA)</span>, pp. 118–132, 2024.

</span>
</li>
<li id="bib.bib53" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[53]</span>
<span class="ltx_bibblock">
S. Fan, Y. Rong, C. Meng, Z. Cao, S. Wang, Z. Zheng, C. Wu, G. Long, J. Yang, L. Xia, <span id="bib.bib53.1.1" class="ltx_text ltx_font_italic">et al.</span>, “Dapple: A pipelined data parallel approach for training large models,” in <span id="bib.bib53.2.2" class="ltx_text ltx_font_italic">Proceedings of the 26th ACM SIGPLAN Symposium on Principles and Practice of Parallel Programming</span>, pp. 431–445, 2021.

</span>
</li>
<li id="bib.bib54" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[54]</span>
<span class="ltx_bibblock">
D. Narayanan, M. Shoeybi, J. Casper, P. LeGresley, M. Patwary, V. A. Korthikanti, D. Vainbrand, P. Kashinkunti, J. Bernauer, B. Catanzaro, A. Phanishayee, and M. Zaharia, “Efficient large-scale language model training on gpu clusters using megatron-lm,” 2021.

</span>
</li>
<li id="bib.bib55" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[55]</span>
<span class="ltx_bibblock">
L. Zheng, Z. Li, H. Zhang, Y. Zhuang, Z. Chen, Y. Huang, Y. Wang, Y. Xu, D. Zhuo, E. P. Xing, <span id="bib.bib55.3.1" class="ltx_text ltx_font_italic">et al.</span>, “Alpa: Automating inter-and <math id="bib.bib55.1.m1.1" class="ltx_Math" alttext="\{" display="inline"><semantics id="bib.bib55.1.m1.1a"><mo stretchy="false" id="bib.bib55.1.m1.1.1" xref="bib.bib55.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib55.1.m1.1b"><ci id="bib.bib55.1.m1.1.1.cmml" xref="bib.bib55.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib55.1.m1.1c">\{</annotation></semantics></math>Intra-Operator<math id="bib.bib55.2.m2.1" class="ltx_Math" alttext="\}" display="inline"><semantics id="bib.bib55.2.m2.1a"><mo stretchy="false" id="bib.bib55.2.m2.1.1" xref="bib.bib55.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib55.2.m2.1b"><ci id="bib.bib55.2.m2.1.1.cmml" xref="bib.bib55.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib55.2.m2.1c">\}</annotation></semantics></math> parallelism for distributed deep learning,” in <span id="bib.bib55.4.2" class="ltx_text ltx_font_italic">16th USENIX Symposium on Operating Systems Design and Implementation (OSDI 22)</span>, pp. 559–578, 2022.

</span>
</li>
<li id="bib.bib56" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[56]</span>
<span class="ltx_bibblock">
Z. Zhang, Y. Zhong, R. Ming, H. Hu, J. Sun, Z. Ge, Y. Zhu, and X. Jin, “Disttrain: Addressing model and data heterogeneity with disaggregated training for multimodal large language models,” <span id="bib.bib56.1.1" class="ltx_text ltx_font_italic">arXiv preprint arXiv:2408.04275</span>, 2024.

</span>
</li>
</ul>
</section>
</article>
</div>
<div class="ar5iv-footer"><a href="/html/2409.13219" class="ar5iv-nav-button ar5iv-nav-button-prev">◄</a>
    <a class="ar5iv-home-button" href="/"><img height="40" alt="ar5iv homepage" src="/assets/ar5iv.png"></a>
    <a href="/feeling_lucky" class="ar5iv-text-button">Feeling<br>lucky?</a>
    <a href="/log/2409.13221" class="ar5iv-text-button ar5iv-severity-error">Conversion<br>report</a>
    <a class="ar5iv-text-button" target="_blank" href="https://github.com/dginev/ar5iv/issues/new?template=improve-article--arxiv-id-.md&title=Improve+article+2409.13221">Report<br>an issue</a>
    <a href="https://arxiv.org/abs/2409.13221" class="ar5iv-text-button arxiv-ui-theme">View&nbsp;original<br>on&nbsp;arXiv</a><a href="/html/2409.13222" class="ar5iv-nav-button ar5iv-nav-button-next">►</a>
</div><footer class="ltx_page_footer">
<a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle ar5iv color scheme"><span class="color-scheme-icon"></span></a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/license" target="_blank">Copyright</a>
<a class="ar5iv-footer-button" href="https://arxiv.org/help/policies/privacy_policy" target="_blank">Privacy Policy</a>

<div class="ltx_page_logo">Generated  on Sat Oct  5 19:22:57 2024 by <a target="_blank" href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>

    <script>
      var canMathML = typeof(MathMLElement) == "function";
      if (!canMathML) {
        var body = document.querySelector("body");
        body.firstElementChild.setAttribute('style', 'opacity: 0;');
        var loading = document.createElement("div");
        loading.setAttribute("id", "mathjax-loading-spinner");
        var message = document.createElement("div");
        message.setAttribute("id", "mathjax-loading-message");
        message.innerText = "Typesetting Equations...";
        body.prepend(loading);
        body.prepend(message);

        var el = document.createElement("script");
        el.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
        document.querySelector("head").appendChild(el);

        window.MathJax = {
          startup: {
            pageReady: () => {
              return MathJax.startup.defaultPageReady().then(() => {
                body.removeChild(loading);
                body.removeChild(message);
                body.firstElementChild.removeAttribute('style');
              }); } } };
      }
    </script>
    <script>
    // Auxiliary function, building the preview feature when
    // an inline citation is clicked
    function clicked_cite(e) {
      e.preventDefault();
      let cite = this.closest('.ltx_cite');
      let next = cite.nextSibling;
      if (next && next.nodeType == Node.ELEMENT_NODE && next.getAttribute('class') == "ar5iv-bibitem-preview") {
        next.remove();
        return; }
      // Before adding a preview modal,
      // cleanup older previews, in case they're still open
      document.querySelectorAll('span.ar5iv-bibitem-preview').forEach(function(node) {
        node.remove();
      })

      // Create the preview
      preview = document.createElement('span');
      preview.setAttribute('class','ar5iv-bibitem-preview');
      let target = document.getElementById(this.getAttribute('href').slice(1));
      target.childNodes.forEach(function (child) {
        preview.append(child.cloneNode(true));
      });
      let close_x = document.createElement('button');
      close_x.setAttribute("aria-label","Close modal for bibliography item preview");
      close_x.textContent = "×";
      close_x.setAttribute('class', 'ar5iv-button-close-preview');
      close_x.setAttribute('onclick','this.parentNode.remove()');
      preview.append(close_x);
      preview.querySelectorAll('.ltx_tag_bibitem').forEach(function(node) {
        node.remove();
      });
      cite.parentNode.insertBefore(preview, cite.nextSibling);
      return;
    }
    // Global Document initialization:
    // - assign the preview feature to all inline citation links
    document.querySelectorAll(".ltx_cite .ltx_ref").forEach(function (link) {
      link.addEventListener("click", clicked_cite);
    });
    </script>
    </body>
</html>
