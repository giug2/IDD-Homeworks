<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search</title>
<!--Generated on Tue Aug  6 03:35:54 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="Real Time Vector Insertion,  Multi Stream GPU,  GPU Parallel System,  Approximate Nearest Neighborhood Search" lang="en" name="keywords"/>
<base href="/html/2408.02937v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S1" title="In A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S2" title="In A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S2.SS1" title="In 2. Related Work ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>GPU facilitated Approximate Nearest Neighbour Search</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S2.SS2" title="In 2. Related Work ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Online Vector Insertion Methods in CPU/GPU ANNS</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3" title="In A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>System Overview</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.SS1" title="In 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Memory Block Based Real-time Vector Insertion Algorithm</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.SS2" title="In 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Stream-Cached Multi-Stream Execution</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.SS3" title="In 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Deployment Detail</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4" title="In A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiment</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4.SS1" title="In 4. Experiment ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Performance on different QPS</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4.SS2" title="In 4. Experiment ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Affect of Rearrangement</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4.SS3" title="In 4. Experiment ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Comparison of Memory Block Parameters</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S5" title="In A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yiping Sun
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_email"><a href="mailto:sunyiping@xiaohongshu.com">sunyiping@xiaohongshu.com</a>
</span>
<span class="ltx_contact ltx_role_orcid"><a class="ltx_ref" href="https://orcid.org/0009-0000-9559-8268" title="ORCID identifier">0009-0000-9559-8268</a></span>
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id3.1.id1">Xiaohongshu Inc</span><span class="ltx_text ltx_affiliation_city" id="id4.2.id2">Shanghai</span><span class="ltx_text ltx_affiliation_country" id="id5.3.id3">China</span>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yang Shi
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_email"><a href="mailto:shiyang1@xiaohongshu.com">shiyang1@xiaohongshu.com</a>
</span>
<span class="ltx_contact ltx_role_orcid"><a class="ltx_ref" href="https://orcid.org/0009-0009-2042-5405" title="ORCID identifier">0009-0009-2042-5405</a></span>
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id6.1.id1">Xiaohongshu Inc</span><span class="ltx_text ltx_affiliation_city" id="id7.2.id2">Shanghai</span><span class="ltx_text ltx_affiliation_country" id="id8.3.id3">China</span>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Jiaolong Du
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_email"><a href="mailto:jiaolong@xiaohongshu.com">jiaolong@xiaohongshu.com</a>
</span>
<span class="ltx_contact ltx_role_orcid"><a class="ltx_ref" href="https://orcid.org/0009-0006-7993-4755" title="ORCID identifier">0009-0006-7993-4755</a></span>
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id9.1.id1">Xiaohongshu Inc</span><span class="ltx_text ltx_affiliation_city" id="id10.2.id2">Shanghai</span><span class="ltx_text ltx_affiliation_country" id="id11.3.id3">China</span>
</span></span></span>
</div>
<div class="ltx_dates">(2024)</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id2.2">In recent years, Approximate Nearest Neighbor Search (ANNS) has played a pivotal role in modern search and recommendation systems, especially in emerging LLM applications like Retrieval-Augmented Generation. There is a growing exploration into harnessing the parallel computing capabilities of GPUs to meet the substantial demands of ANNS. However, existing systems primarily focus on offline scenarios, overlooking the distinct requirements of online applications that necessitate real-time insertion of new vectors. This limitation renders such systems inefficient for real-world scenarios. Moreover, previous architectures struggled to effectively support real-time insertion due to their reliance on serial execution streams.
In this paper, we introduce a novel Real-Time Adaptive Multi-Stream GPU ANNS System (RTAMS-GANNS). Our architecture achieves its objectives through three key advancements: 1) We initially examined the real-time insertion mechanisms in existing GPU ANNS systems and discovered their reliance on repetitive copying and memory allocation, which significantly hinders real-time effectiveness on GPUs. As a solution, we introduce a dynamic vector insertion algorithm based on memory blocks, which includes in-place rearrangement. 2) To enable real-time vector insertion in parallel, we introduce a multi-stream parallel execution mode, which differs from existing systems that operate serially within a single stream. Our system utilizes a dynamic resource pool, allowing multiple streams to execute concurrently without additional execution blocking. 3) Through extensive experiments and comparisons, our approach effectively handles varying QPS levels across different datasets, reducing latency by up to <math alttext="40\%" class="ltx_Math" display="inline" id="id1.1.m1.1"><semantics id="id1.1.m1.1a"><mrow id="id1.1.m1.1.1" xref="id1.1.m1.1.1.cmml"><mn id="id1.1.m1.1.1.2" xref="id1.1.m1.1.1.2.cmml">40</mn><mo id="id1.1.m1.1.1.1" xref="id1.1.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="id1.1.m1.1b"><apply id="id1.1.m1.1.1.cmml" xref="id1.1.m1.1.1"><csymbol cd="latexml" id="id1.1.m1.1.1.1.cmml" xref="id1.1.m1.1.1.1">percent</csymbol><cn id="id1.1.m1.1.1.2.cmml" type="integer" xref="id1.1.m1.1.1.2">40</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id1.1.m1.1c">40\%</annotation><annotation encoding="application/x-llamapun" id="id1.1.m1.1d">40 %</annotation></semantics></math>-<math alttext="80\%" class="ltx_Math" display="inline" id="id2.2.m2.1"><semantics id="id2.2.m2.1a"><mrow id="id2.2.m2.1.1" xref="id2.2.m2.1.1.cmml"><mn id="id2.2.m2.1.1.2" xref="id2.2.m2.1.1.2.cmml">80</mn><mo id="id2.2.m2.1.1.1" xref="id2.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="id2.2.m2.1b"><apply id="id2.2.m2.1.1.cmml" xref="id2.2.m2.1.1"><csymbol cd="latexml" id="id2.2.m2.1.1.1.cmml" xref="id2.2.m2.1.1.1">percent</csymbol><cn id="id2.2.m2.1.1.2.cmml" type="integer" xref="id2.2.m2.1.1.2">80</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id2.2.m2.1c">80\%</annotation><annotation encoding="application/x-llamapun" id="id2.2.m2.1d">80 %</annotation></semantics></math>. The proposed system has also been deployed in real-world industrial search and recommendation systems, serving hundreds of millions of users daily, and has achieved significant results.</p>
</div>
<div class="ltx_keywords">Real Time Vector Insertion, Multi Stream GPU, GPU Parallel System, Approximate Nearest Neighborhood Search
</div>
<span class="ltx_note ltx_note_frontmatter ltx_role_journalyear" id="id1"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2024</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_copyright" id="id2"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>acmlicensed</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_conference" id="id3"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>Proceedings of the 33rd ACM International Conference on Information and Knowledge Management; October 21–25, 2024; Boise, ID, USA</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_booktitle" id="id4"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">booktitle: </span>Proceedings of the 33rd ACM International Conference on Information and Knowledge Management (CIKM ’24), October 21–25, 2024, Boise, ID, USA</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_doi" id="id5"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>10.1145/3627673.3680054</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_isbn" id="id6"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>979-8-4007-0436-9/24/10</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id7"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Information systems Search engine indexing</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id8"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computer systems organization Real-time system architecture</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id9"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computer systems organization Heterogeneous (hybrid) systems</span></span></span>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">The task of Approximate Nearest Neighbor Search (ANNS) <cite class="ltx_cite ltx_citemacro_citep">(Abbasifard et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib2" title="">2014</a>)</cite> has gained extensive application and research in modern contexts, such as search systems, recommendation systems, and information enhancement for Large Language Models (LLM), especially Retrieval-augmented generation (RAG) <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib7" title="">2023</a>)</cite>. Its objective is to efficiently identify approximate Top-K results through approximate algorithms like clustering <cite class="ltx_cite ltx_citemacro_citep">(Nolet et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib15" title="">2023</a>)</cite>, quantization <cite class="ltx_cite ltx_citemacro_citep">(Jegou et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib10" title="">2010</a>)</cite>, tree-based <cite class="ltx_cite ltx_citemacro_citep">(Silpa-Anan and Hartley, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib19" title="">2008</a>)</cite>, and graph-based methods <cite class="ltx_cite ltx_citemacro_citep">(Malkov, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib13" title="">2018</a>)</cite>. These methods, while sacrificing a marginal recall rate, significantly reduce the computational costs associated with distance calculations. This enables the expedited retrieval of approximate Top-K results within considerably large datasets in a shorter timeframe.
Furthermore, even with the adoption of efficient approximate algorithms, ANNS systems based on CPUs still face the challenge of high computational load and the bottleneck of modern CPU memory bandwidth. An increasing body of research is turning to the high computational power and memory bandwidth of GPUs to address the inadequacies in CPU performance. In the system Faiss <cite class="ltx_cite ltx_citemacro_citep">(Johnson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib11" title="">2019</a>)</cite> and Raft <cite class="ltx_cite ltx_citemacro_citep">(Rapidsai, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib18" title="">2022</a>)</cite>, the concept of utilizing GPUs for retrieval instead of CPUs was first introduced, achieving an huge performance improvement compared to CPUs. The implementation details are openly available and have gained widespread usage in the industry.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">However, we have identified that the aforementioned systems are only designed for offline scenarios, where vectors in the index are processed offline and loaded before performing search. These systems are unable to address the most common online scenarios in Approximate Nearest Neighbor Search (ANNS), which require high-frequency real-time insertions of vectors. This capability is crucial for search/recommendation applications <cite class="ltx_cite ltx_citemacro_citep">(Gong et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib8" title="">2022</a>)</cite>, where immediate updates ensure the most recent data is always available for accurate and relevant search results. These limitations arise from two main aspects.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">On the one hand, the memory arrangement of vector insertion is not well designed in existing systems (Faiss/Raft), which almost needs to be merged with existing vectors. This process is illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>a and detailed in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg1" title="Algorithm 1 ‣ 1. Introduction ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>. For typical inverted-index-based ANNS algorithms like Ivfflat and Ivfpq, vectors are initially partitioned into multiple clusters (line 3). During the search process, the vector lists belonging to the most relevant clusters to the query are computed, and the final top-k vectors are retrieved. When new vectors arrive, existing systems typically needs to copy the vector lists of the new vectors from the offline segment to the new segment (line 5 - 14). Such method, therefore, incurs significant overhead on the GPU, as both memory allocation and copying require triggering a kernel launch which consumes substantial resources. Additionally, it should be noted that in this article, we only discuss inverted-based ANNS algorithms, as graph-based ones <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib21" title="">2021</a>)</cite> are currently challenging to support in real-time, even on CPUs.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.2.1.1">Algorithm 1</span> </span> Ivfflat and Ivfpq Approximate Online Vector Operations on Existing GPU Systems (Faiss/Raft)</figcaption>
<div class="ltx_listing ltx_listing" id="alg1.3">
<div class="ltx_listingline" id="alg1.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0.1.1.1" style="font-size:80%;">0:</span></span>  offline vectors <math alttext="x_{i}\in X" class="ltx_Math" display="inline" id="alg1.l0.m1.1"><semantics id="alg1.l0.m1.1a"><mrow id="alg1.l0.m1.1.1" xref="alg1.l0.m1.1.1.cmml"><msub id="alg1.l0.m1.1.1.2" xref="alg1.l0.m1.1.1.2.cmml"><mi id="alg1.l0.m1.1.1.2.2" xref="alg1.l0.m1.1.1.2.2.cmml">x</mi><mi id="alg1.l0.m1.1.1.2.3" xref="alg1.l0.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg1.l0.m1.1.1.1" xref="alg1.l0.m1.1.1.1.cmml">∈</mo><mi id="alg1.l0.m1.1.1.3" xref="alg1.l0.m1.1.1.3.cmml">X</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0.m1.1b"><apply id="alg1.l0.m1.1.1.cmml" xref="alg1.l0.m1.1.1"><in id="alg1.l0.m1.1.1.1.cmml" xref="alg1.l0.m1.1.1.1"></in><apply id="alg1.l0.m1.1.1.2.cmml" xref="alg1.l0.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l0.m1.1.1.2.1.cmml" xref="alg1.l0.m1.1.1.2">subscript</csymbol><ci id="alg1.l0.m1.1.1.2.2.cmml" xref="alg1.l0.m1.1.1.2.2">𝑥</ci><ci id="alg1.l0.m1.1.1.2.3.cmml" xref="alg1.l0.m1.1.1.2.3">𝑖</ci></apply><ci id="alg1.l0.m1.1.1.3.cmml" xref="alg1.l0.m1.1.1.3">𝑋</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m1.1c">x_{i}\in X</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X</annotation></semantics></math>, new coming online vectors <math alttext="y_{i}\in Y" class="ltx_Math" display="inline" id="alg1.l0.m2.1"><semantics id="alg1.l0.m2.1a"><mrow id="alg1.l0.m2.1.1" xref="alg1.l0.m2.1.1.cmml"><msub id="alg1.l0.m2.1.1.2" xref="alg1.l0.m2.1.1.2.cmml"><mi id="alg1.l0.m2.1.1.2.2" xref="alg1.l0.m2.1.1.2.2.cmml">y</mi><mi id="alg1.l0.m2.1.1.2.3" xref="alg1.l0.m2.1.1.2.3.cmml">i</mi></msub><mo id="alg1.l0.m2.1.1.1" xref="alg1.l0.m2.1.1.1.cmml">∈</mo><mi id="alg1.l0.m2.1.1.3" xref="alg1.l0.m2.1.1.3.cmml">Y</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0.m2.1b"><apply id="alg1.l0.m2.1.1.cmml" xref="alg1.l0.m2.1.1"><in id="alg1.l0.m2.1.1.1.cmml" xref="alg1.l0.m2.1.1.1"></in><apply id="alg1.l0.m2.1.1.2.cmml" xref="alg1.l0.m2.1.1.2"><csymbol cd="ambiguous" id="alg1.l0.m2.1.1.2.1.cmml" xref="alg1.l0.m2.1.1.2">subscript</csymbol><ci id="alg1.l0.m2.1.1.2.2.cmml" xref="alg1.l0.m2.1.1.2.2">𝑦</ci><ci id="alg1.l0.m2.1.1.2.3.cmml" xref="alg1.l0.m2.1.1.2.3">𝑖</ci></apply><ci id="alg1.l0.m2.1.1.3.cmml" xref="alg1.l0.m2.1.1.3">𝑌</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m2.1c">y_{i}\in Y</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m2.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_Y</annotation></semantics></math> and number of new vectors <math alttext="M" class="ltx_Math" display="inline" id="alg1.l0.m3.1"><semantics id="alg1.l0.m3.1a"><mi id="alg1.l0.m3.1.1" xref="alg1.l0.m3.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="alg1.l0.m3.1b"><ci id="alg1.l0.m3.1.1.cmml" xref="alg1.l0.m3.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m3.1c">M</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m3.1d">italic_M</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0a.1.1.1" style="font-size:80%;">0:</span></span>  <math alttext="m_{k}.size" class="ltx_Math" display="inline" id="alg1.l0a.m1.2"><semantics id="alg1.l0a.m1.2a"><mrow id="alg1.l0a.m1.2.2.2" xref="alg1.l0a.m1.2.2.3.cmml"><msub id="alg1.l0a.m1.1.1.1.1" xref="alg1.l0a.m1.1.1.1.1.cmml"><mi id="alg1.l0a.m1.1.1.1.1.2" xref="alg1.l0a.m1.1.1.1.1.2.cmml">m</mi><mi id="alg1.l0a.m1.1.1.1.1.3" xref="alg1.l0a.m1.1.1.1.1.3.cmml">k</mi></msub><mo id="alg1.l0a.m1.2.2.2.3" lspace="0em" rspace="0.167em" xref="alg1.l0a.m1.2.2.3a.cmml">.</mo><mrow id="alg1.l0a.m1.2.2.2.2" xref="alg1.l0a.m1.2.2.2.2.cmml"><mi id="alg1.l0a.m1.2.2.2.2.2" xref="alg1.l0a.m1.2.2.2.2.2.cmml">s</mi><mo id="alg1.l0a.m1.2.2.2.2.1" xref="alg1.l0a.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l0a.m1.2.2.2.2.3" xref="alg1.l0a.m1.2.2.2.2.3.cmml">i</mi><mo id="alg1.l0a.m1.2.2.2.2.1a" xref="alg1.l0a.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l0a.m1.2.2.2.2.4" xref="alg1.l0a.m1.2.2.2.2.4.cmml">z</mi><mo id="alg1.l0a.m1.2.2.2.2.1b" xref="alg1.l0a.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l0a.m1.2.2.2.2.5" xref="alg1.l0a.m1.2.2.2.2.5.cmml">e</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0a.m1.2b"><apply id="alg1.l0a.m1.2.2.3.cmml" xref="alg1.l0a.m1.2.2.2"><csymbol cd="ambiguous" id="alg1.l0a.m1.2.2.3a.cmml" xref="alg1.l0a.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg1.l0a.m1.1.1.1.1.cmml" xref="alg1.l0a.m1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l0a.m1.1.1.1.1.1.cmml" xref="alg1.l0a.m1.1.1.1.1">subscript</csymbol><ci id="alg1.l0a.m1.1.1.1.1.2.cmml" xref="alg1.l0a.m1.1.1.1.1.2">𝑚</ci><ci id="alg1.l0a.m1.1.1.1.1.3.cmml" xref="alg1.l0a.m1.1.1.1.1.3">𝑘</ci></apply><apply id="alg1.l0a.m1.2.2.2.2.cmml" xref="alg1.l0a.m1.2.2.2.2"><times id="alg1.l0a.m1.2.2.2.2.1.cmml" xref="alg1.l0a.m1.2.2.2.2.1"></times><ci id="alg1.l0a.m1.2.2.2.2.2.cmml" xref="alg1.l0a.m1.2.2.2.2.2">𝑠</ci><ci id="alg1.l0a.m1.2.2.2.2.3.cmml" xref="alg1.l0a.m1.2.2.2.2.3">𝑖</ci><ci id="alg1.l0a.m1.2.2.2.2.4.cmml" xref="alg1.l0a.m1.2.2.2.2.4">𝑧</ci><ci id="alg1.l0a.m1.2.2.2.2.5.cmml" xref="alg1.l0a.m1.2.2.2.2.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0a.m1.2c">m_{k}.size</annotation><annotation encoding="application/x-llamapun" id="alg1.l0a.m1.2d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT . italic_s italic_i italic_z italic_e</annotation></semantics></math> for new allocated extra memory space size, <math alttext="wl_{k}" class="ltx_Math" display="inline" id="alg1.l0a.m2.1"><semantics id="alg1.l0a.m2.1a"><mrow id="alg1.l0a.m2.1.1" xref="alg1.l0a.m2.1.1.cmml"><mi id="alg1.l0a.m2.1.1.2" xref="alg1.l0a.m2.1.1.2.cmml">w</mi><mo id="alg1.l0a.m2.1.1.1" xref="alg1.l0a.m2.1.1.1.cmml">⁢</mo><msub id="alg1.l0a.m2.1.1.3" xref="alg1.l0a.m2.1.1.3.cmml"><mi id="alg1.l0a.m2.1.1.3.2" xref="alg1.l0a.m2.1.1.3.2.cmml">l</mi><mi id="alg1.l0a.m2.1.1.3.3" xref="alg1.l0a.m2.1.1.3.3.cmml">k</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0a.m2.1b"><apply id="alg1.l0a.m2.1.1.cmml" xref="alg1.l0a.m2.1.1"><times id="alg1.l0a.m2.1.1.1.cmml" xref="alg1.l0a.m2.1.1.1"></times><ci id="alg1.l0a.m2.1.1.2.cmml" xref="alg1.l0a.m2.1.1.2">𝑤</ci><apply id="alg1.l0a.m2.1.1.3.cmml" xref="alg1.l0a.m2.1.1.3"><csymbol cd="ambiguous" id="alg1.l0a.m2.1.1.3.1.cmml" xref="alg1.l0a.m2.1.1.3">subscript</csymbol><ci id="alg1.l0a.m2.1.1.3.2.cmml" xref="alg1.l0a.m2.1.1.3.2">𝑙</ci><ci id="alg1.l0a.m2.1.1.3.3.cmml" xref="alg1.l0a.m2.1.1.3.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0a.m2.1c">wl_{k}</annotation><annotation encoding="application/x-llamapun" id="alg1.l0a.m2.1d">italic_w italic_l start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> for temporary vector list assignment

</div>
<div class="ltx_listingline" id="alg1.l0b">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0b.1.1.1" style="font-size:80%;">0:</span></span>  vector lists <math alttext="l\in L" class="ltx_Math" display="inline" id="alg1.l0b.m1.1"><semantics id="alg1.l0b.m1.1a"><mrow id="alg1.l0b.m1.1.1" xref="alg1.l0b.m1.1.1.cmml"><mi id="alg1.l0b.m1.1.1.2" xref="alg1.l0b.m1.1.1.2.cmml">l</mi><mo id="alg1.l0b.m1.1.1.1" xref="alg1.l0b.m1.1.1.1.cmml">∈</mo><mi id="alg1.l0b.m1.1.1.3" xref="alg1.l0b.m1.1.1.3.cmml">L</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0b.m1.1b"><apply id="alg1.l0b.m1.1.1.cmml" xref="alg1.l0b.m1.1.1"><in id="alg1.l0b.m1.1.1.1.cmml" xref="alg1.l0b.m1.1.1.1"></in><ci id="alg1.l0b.m1.1.1.2.cmml" xref="alg1.l0b.m1.1.1.2">𝑙</ci><ci id="alg1.l0b.m1.1.1.3.cmml" xref="alg1.l0b.m1.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0b.m1.1c">l\in L</annotation><annotation encoding="application/x-llamapun" id="alg1.l0b.m1.1d">italic_l ∈ italic_L</annotation></semantics></math>, corresponding cluster <math alttext="c\in C" class="ltx_Math" display="inline" id="alg1.l0b.m2.1"><semantics id="alg1.l0b.m2.1a"><mrow id="alg1.l0b.m2.1.1" xref="alg1.l0b.m2.1.1.cmml"><mi id="alg1.l0b.m2.1.1.2" xref="alg1.l0b.m2.1.1.2.cmml">c</mi><mo id="alg1.l0b.m2.1.1.1" xref="alg1.l0b.m2.1.1.1.cmml">∈</mo><mi id="alg1.l0b.m2.1.1.3" xref="alg1.l0b.m2.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0b.m2.1b"><apply id="alg1.l0b.m2.1.1.cmml" xref="alg1.l0b.m2.1.1"><in id="alg1.l0b.m2.1.1.1.cmml" xref="alg1.l0b.m2.1.1.1"></in><ci id="alg1.l0b.m2.1.1.2.cmml" xref="alg1.l0b.m2.1.1.2">𝑐</ci><ci id="alg1.l0b.m2.1.1.3.cmml" xref="alg1.l0b.m2.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0b.m2.1c">c\in C</annotation><annotation encoding="application/x-llamapun" id="alg1.l0b.m2.1d">italic_c ∈ italic_C</annotation></semantics></math>, number of vector lists/clusters <math alttext="N" class="ltx_Math" display="inline" id="alg1.l0b.m3.1"><semantics id="alg1.l0b.m3.1a"><mi id="alg1.l0b.m3.1.1" xref="alg1.l0b.m3.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="alg1.l0b.m3.1b"><ci id="alg1.l0b.m3.1.1.cmml" xref="alg1.l0b.m3.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0b.m3.1c">N</annotation><annotation encoding="application/x-llamapun" id="alg1.l0b.m3.1d">italic_N</annotation></semantics></math>, <math alttext="C" class="ltx_Math" display="inline" id="alg1.l0b.m4.1"><semantics id="alg1.l0b.m4.1a"><mi id="alg1.l0b.m4.1.1" xref="alg1.l0b.m4.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="alg1.l0b.m4.1b"><ci id="alg1.l0b.m4.1.1.cmml" xref="alg1.l0b.m4.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0b.m4.1c">C</annotation><annotation encoding="application/x-llamapun" id="alg1.l0b.m4.1d">italic_C</annotation></semantics></math> is generated by Kmeans(<math alttext="X,N" class="ltx_Math" display="inline" id="alg1.l0b.m5.2"><semantics id="alg1.l0b.m5.2a"><mrow id="alg1.l0b.m5.2.3.2" xref="alg1.l0b.m5.2.3.1.cmml"><mi id="alg1.l0b.m5.1.1" xref="alg1.l0b.m5.1.1.cmml">X</mi><mo id="alg1.l0b.m5.2.3.2.1" xref="alg1.l0b.m5.2.3.1.cmml">,</mo><mi id="alg1.l0b.m5.2.2" xref="alg1.l0b.m5.2.2.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0b.m5.2b"><list id="alg1.l0b.m5.2.3.1.cmml" xref="alg1.l0b.m5.2.3.2"><ci id="alg1.l0b.m5.1.1.cmml" xref="alg1.l0b.m5.1.1">𝑋</ci><ci id="alg1.l0b.m5.2.2.cmml" xref="alg1.l0b.m5.2.2">𝑁</ci></list></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0b.m5.2c">X,N</annotation><annotation encoding="application/x-llamapun" id="alg1.l0b.m5.2d">italic_X , italic_N</annotation></semantics></math>)

</div>
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.1.1.1" style="font-size:80%;">1:</span></span>  // Calculate belonged vector list, GPU Block Execution

</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.1.1.1" style="font-size:80%;">2:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l2.2">for</span> <math alttext="i" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><mi id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_i</annotation></semantics></math> from <math alttext="0" class="ltx_Math" display="inline" id="alg1.l2.m2.1"><semantics id="alg1.l2.m2.1a"><mn id="alg1.l2.m2.1.1" xref="alg1.l2.m2.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="alg1.l2.m2.1b"><cn id="alg1.l2.m2.1.1.cmml" type="integer" xref="alg1.l2.m2.1.1">0</cn></annotation-xml></semantics></math> to <math alttext="M-1" class="ltx_Math" display="inline" id="alg1.l2.m3.1"><semantics id="alg1.l2.m3.1a"><mrow id="alg1.l2.m3.1.1" xref="alg1.l2.m3.1.1.cmml"><mi id="alg1.l2.m3.1.1.2" xref="alg1.l2.m3.1.1.2.cmml">M</mi><mo id="alg1.l2.m3.1.1.1" xref="alg1.l2.m3.1.1.1.cmml">−</mo><mn id="alg1.l2.m3.1.1.3" xref="alg1.l2.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg1.l2.m3.1b"><apply id="alg1.l2.m3.1.1.cmml" xref="alg1.l2.m3.1.1"><minus id="alg1.l2.m3.1.1.1.cmml" xref="alg1.l2.m3.1.1.1"></minus><ci id="alg1.l2.m3.1.1.2.cmml" xref="alg1.l2.m3.1.1.2">𝑀</ci><cn id="alg1.l2.m3.1.1.3.cmml" type="integer" xref="alg1.l2.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m3.1c">M-1</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m3.1d">italic_M - 1</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l2.3">do</span>
</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l3.1.1.1" style="font-size:80%;">3:</span></span>     <math alttext="k\leftarrow\min(c,y_{i})" class="ltx_Math" display="inline" id="alg1.l3.m1.3"><semantics id="alg1.l3.m1.3a"><mrow id="alg1.l3.m1.3.3" xref="alg1.l3.m1.3.3.cmml"><mi id="alg1.l3.m1.3.3.3" xref="alg1.l3.m1.3.3.3.cmml">k</mi><mo id="alg1.l3.m1.3.3.2" stretchy="false" xref="alg1.l3.m1.3.3.2.cmml">←</mo><mrow id="alg1.l3.m1.3.3.1.1" xref="alg1.l3.m1.3.3.1.2.cmml"><mi id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml">min</mi><mo id="alg1.l3.m1.3.3.1.1a" xref="alg1.l3.m1.3.3.1.2.cmml">⁡</mo><mrow id="alg1.l3.m1.3.3.1.1.1" xref="alg1.l3.m1.3.3.1.2.cmml"><mo id="alg1.l3.m1.3.3.1.1.1.2" stretchy="false" xref="alg1.l3.m1.3.3.1.2.cmml">(</mo><mi id="alg1.l3.m1.2.2" xref="alg1.l3.m1.2.2.cmml">c</mi><mo id="alg1.l3.m1.3.3.1.1.1.3" xref="alg1.l3.m1.3.3.1.2.cmml">,</mo><msub id="alg1.l3.m1.3.3.1.1.1.1" xref="alg1.l3.m1.3.3.1.1.1.1.cmml"><mi id="alg1.l3.m1.3.3.1.1.1.1.2" xref="alg1.l3.m1.3.3.1.1.1.1.2.cmml">y</mi><mi id="alg1.l3.m1.3.3.1.1.1.1.3" xref="alg1.l3.m1.3.3.1.1.1.1.3.cmml">i</mi></msub><mo id="alg1.l3.m1.3.3.1.1.1.4" stretchy="false" xref="alg1.l3.m1.3.3.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.3b"><apply id="alg1.l3.m1.3.3.cmml" xref="alg1.l3.m1.3.3"><ci id="alg1.l3.m1.3.3.2.cmml" xref="alg1.l3.m1.3.3.2">←</ci><ci id="alg1.l3.m1.3.3.3.cmml" xref="alg1.l3.m1.3.3.3">𝑘</ci><apply id="alg1.l3.m1.3.3.1.2.cmml" xref="alg1.l3.m1.3.3.1.1"><min id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1"></min><ci id="alg1.l3.m1.2.2.cmml" xref="alg1.l3.m1.2.2">𝑐</ci><apply id="alg1.l3.m1.3.3.1.1.1.1.cmml" xref="alg1.l3.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l3.m1.3.3.1.1.1.1.1.cmml" xref="alg1.l3.m1.3.3.1.1.1.1">subscript</csymbol><ci id="alg1.l3.m1.3.3.1.1.1.1.2.cmml" xref="alg1.l3.m1.3.3.1.1.1.1.2">𝑦</ci><ci id="alg1.l3.m1.3.3.1.1.1.1.3.cmml" xref="alg1.l3.m1.3.3.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.3c">k\leftarrow\min(c,y_{i})</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.3d">italic_k ← roman_min ( italic_c , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> // where <math alttext="\forall c\in C" class="ltx_Math" display="inline" id="alg1.l3.m2.1"><semantics id="alg1.l3.m2.1a"><mrow id="alg1.l3.m2.1.1" xref="alg1.l3.m2.1.1.cmml"><mrow id="alg1.l3.m2.1.1.2" xref="alg1.l3.m2.1.1.2.cmml"><mo id="alg1.l3.m2.1.1.2.1" rspace="0.167em" xref="alg1.l3.m2.1.1.2.1.cmml">∀</mo><mi id="alg1.l3.m2.1.1.2.2" xref="alg1.l3.m2.1.1.2.2.cmml">c</mi></mrow><mo id="alg1.l3.m2.1.1.1" xref="alg1.l3.m2.1.1.1.cmml">∈</mo><mi id="alg1.l3.m2.1.1.3" xref="alg1.l3.m2.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m2.1b"><apply id="alg1.l3.m2.1.1.cmml" xref="alg1.l3.m2.1.1"><in id="alg1.l3.m2.1.1.1.cmml" xref="alg1.l3.m2.1.1.1"></in><apply id="alg1.l3.m2.1.1.2.cmml" xref="alg1.l3.m2.1.1.2"><csymbol cd="latexml" id="alg1.l3.m2.1.1.2.1.cmml" xref="alg1.l3.m2.1.1.2.1">for-all</csymbol><ci id="alg1.l3.m2.1.1.2.2.cmml" xref="alg1.l3.m2.1.1.2.2">𝑐</ci></apply><ci id="alg1.l3.m2.1.1.3.cmml" xref="alg1.l3.m2.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m2.1c">\forall c\in C</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m2.1d">∀ italic_c ∈ italic_C</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l4.1.1.1" style="font-size:80%;">4:</span></span>     <math alttext="m_{k}.size\leftarrow m_{k}.size+1" class="ltx_Math" display="inline" id="alg1.l4.m1.3"><semantics id="alg1.l4.m1.3a"><mrow id="alg1.l4.m1.3.3.3" xref="alg1.l4.m1.3.3.4.cmml"><msub id="alg1.l4.m1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.cmml"><mi id="alg1.l4.m1.1.1.1.1.2" xref="alg1.l4.m1.1.1.1.1.2.cmml">m</mi><mi id="alg1.l4.m1.1.1.1.1.3" xref="alg1.l4.m1.1.1.1.1.3.cmml">k</mi></msub><mo id="alg1.l4.m1.3.3.3.4" lspace="0em" rspace="0.167em" xref="alg1.l4.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l4.m1.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.cmml"><mrow id="alg1.l4.m1.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.cmml"><mi id="alg1.l4.m1.2.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.2.cmml">s</mi><mo id="alg1.l4.m1.2.2.2.2.2.1" xref="alg1.l4.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.2.2.3" xref="alg1.l4.m1.2.2.2.2.2.3.cmml">i</mi><mo id="alg1.l4.m1.2.2.2.2.2.1a" xref="alg1.l4.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.2.2.4" xref="alg1.l4.m1.2.2.2.2.2.4.cmml">z</mi><mo id="alg1.l4.m1.2.2.2.2.2.1b" xref="alg1.l4.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.2.2.2.2.2.5" xref="alg1.l4.m1.2.2.2.2.2.5.cmml">e</mi></mrow><mo id="alg1.l4.m1.2.2.2.2.1" stretchy="false" xref="alg1.l4.m1.2.2.2.2.1.cmml">←</mo><msub id="alg1.l4.m1.2.2.2.2.3" xref="alg1.l4.m1.2.2.2.2.3.cmml"><mi id="alg1.l4.m1.2.2.2.2.3.2" xref="alg1.l4.m1.2.2.2.2.3.2.cmml">m</mi><mi id="alg1.l4.m1.2.2.2.2.3.3" xref="alg1.l4.m1.2.2.2.2.3.3.cmml">k</mi></msub></mrow><mo id="alg1.l4.m1.3.3.3.5" lspace="0em" rspace="0.167em" xref="alg1.l4.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l4.m1.3.3.3.3" xref="alg1.l4.m1.3.3.3.3.cmml"><mrow id="alg1.l4.m1.3.3.3.3.2" xref="alg1.l4.m1.3.3.3.3.2.cmml"><mi id="alg1.l4.m1.3.3.3.3.2.2" xref="alg1.l4.m1.3.3.3.3.2.2.cmml">s</mi><mo id="alg1.l4.m1.3.3.3.3.2.1" xref="alg1.l4.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.3.3.3.3.2.3" xref="alg1.l4.m1.3.3.3.3.2.3.cmml">i</mi><mo id="alg1.l4.m1.3.3.3.3.2.1a" xref="alg1.l4.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.3.3.3.3.2.4" xref="alg1.l4.m1.3.3.3.3.2.4.cmml">z</mi><mo id="alg1.l4.m1.3.3.3.3.2.1b" xref="alg1.l4.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l4.m1.3.3.3.3.2.5" xref="alg1.l4.m1.3.3.3.3.2.5.cmml">e</mi></mrow><mo id="alg1.l4.m1.3.3.3.3.1" xref="alg1.l4.m1.3.3.3.3.1.cmml">+</mo><mn id="alg1.l4.m1.3.3.3.3.3" xref="alg1.l4.m1.3.3.3.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.3b"><apply id="alg1.l4.m1.3.3.4.cmml" xref="alg1.l4.m1.3.3.3"><csymbol cd="ambiguous" id="alg1.l4.m1.3.3.4a.cmml" xref="alg1.l4.m1.3.3.3.4">formulae-sequence</csymbol><apply id="alg1.l4.m1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1">subscript</csymbol><ci id="alg1.l4.m1.1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.1.2">𝑚</ci><ci id="alg1.l4.m1.1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.1.3">𝑘</ci></apply><apply id="alg1.l4.m1.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2"><ci id="alg1.l4.m1.2.2.2.2.1.cmml" xref="alg1.l4.m1.2.2.2.2.1">←</ci><apply id="alg1.l4.m1.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2"><times id="alg1.l4.m1.2.2.2.2.2.1.cmml" xref="alg1.l4.m1.2.2.2.2.2.1"></times><ci id="alg1.l4.m1.2.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2.2">𝑠</ci><ci id="alg1.l4.m1.2.2.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2.2.3">𝑖</ci><ci id="alg1.l4.m1.2.2.2.2.2.4.cmml" xref="alg1.l4.m1.2.2.2.2.2.4">𝑧</ci><ci id="alg1.l4.m1.2.2.2.2.2.5.cmml" xref="alg1.l4.m1.2.2.2.2.2.5">𝑒</ci></apply><apply id="alg1.l4.m1.2.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2.3"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.2.2.3.1.cmml" xref="alg1.l4.m1.2.2.2.2.3">subscript</csymbol><ci id="alg1.l4.m1.2.2.2.2.3.2.cmml" xref="alg1.l4.m1.2.2.2.2.3.2">𝑚</ci><ci id="alg1.l4.m1.2.2.2.2.3.3.cmml" xref="alg1.l4.m1.2.2.2.2.3.3">𝑘</ci></apply></apply><apply id="alg1.l4.m1.3.3.3.3.cmml" xref="alg1.l4.m1.3.3.3.3"><plus id="alg1.l4.m1.3.3.3.3.1.cmml" xref="alg1.l4.m1.3.3.3.3.1"></plus><apply id="alg1.l4.m1.3.3.3.3.2.cmml" xref="alg1.l4.m1.3.3.3.3.2"><times id="alg1.l4.m1.3.3.3.3.2.1.cmml" xref="alg1.l4.m1.3.3.3.3.2.1"></times><ci id="alg1.l4.m1.3.3.3.3.2.2.cmml" xref="alg1.l4.m1.3.3.3.3.2.2">𝑠</ci><ci id="alg1.l4.m1.3.3.3.3.2.3.cmml" xref="alg1.l4.m1.3.3.3.3.2.3">𝑖</ci><ci id="alg1.l4.m1.3.3.3.3.2.4.cmml" xref="alg1.l4.m1.3.3.3.3.2.4">𝑧</ci><ci id="alg1.l4.m1.3.3.3.3.2.5.cmml" xref="alg1.l4.m1.3.3.3.3.2.5">𝑒</ci></apply><cn id="alg1.l4.m1.3.3.3.3.3.cmml" type="integer" xref="alg1.l4.m1.3.3.3.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.3c">m_{k}.size\leftarrow m_{k}.size+1</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.3d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT . italic_s italic_i italic_z italic_e ← italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT . italic_s italic_i italic_z italic_e + 1</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l5.1.1.1" style="font-size:80%;">5:</span></span>     <math alttext="\text{append}(wl_{k},y_{i})" class="ltx_Math" display="inline" id="alg1.l5.m1.2"><semantics id="alg1.l5.m1.2a"><mrow id="alg1.l5.m1.2.2" xref="alg1.l5.m1.2.2.cmml"><mtext id="alg1.l5.m1.2.2.4" xref="alg1.l5.m1.2.2.4a.cmml">append</mtext><mo id="alg1.l5.m1.2.2.3" xref="alg1.l5.m1.2.2.3.cmml">⁢</mo><mrow id="alg1.l5.m1.2.2.2.2" xref="alg1.l5.m1.2.2.2.3.cmml"><mo id="alg1.l5.m1.2.2.2.2.3" stretchy="false" xref="alg1.l5.m1.2.2.2.3.cmml">(</mo><mrow id="alg1.l5.m1.1.1.1.1.1" xref="alg1.l5.m1.1.1.1.1.1.cmml"><mi id="alg1.l5.m1.1.1.1.1.1.2" xref="alg1.l5.m1.1.1.1.1.1.2.cmml">w</mi><mo id="alg1.l5.m1.1.1.1.1.1.1" xref="alg1.l5.m1.1.1.1.1.1.1.cmml">⁢</mo><msub id="alg1.l5.m1.1.1.1.1.1.3" xref="alg1.l5.m1.1.1.1.1.1.3.cmml"><mi id="alg1.l5.m1.1.1.1.1.1.3.2" xref="alg1.l5.m1.1.1.1.1.1.3.2.cmml">l</mi><mi id="alg1.l5.m1.1.1.1.1.1.3.3" xref="alg1.l5.m1.1.1.1.1.1.3.3.cmml">k</mi></msub></mrow><mo id="alg1.l5.m1.2.2.2.2.4" xref="alg1.l5.m1.2.2.2.3.cmml">,</mo><msub id="alg1.l5.m1.2.2.2.2.2" xref="alg1.l5.m1.2.2.2.2.2.cmml"><mi id="alg1.l5.m1.2.2.2.2.2.2" xref="alg1.l5.m1.2.2.2.2.2.2.cmml">y</mi><mi id="alg1.l5.m1.2.2.2.2.2.3" xref="alg1.l5.m1.2.2.2.2.2.3.cmml">i</mi></msub><mo id="alg1.l5.m1.2.2.2.2.5" stretchy="false" xref="alg1.l5.m1.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.2b"><apply id="alg1.l5.m1.2.2.cmml" xref="alg1.l5.m1.2.2"><times id="alg1.l5.m1.2.2.3.cmml" xref="alg1.l5.m1.2.2.3"></times><ci id="alg1.l5.m1.2.2.4a.cmml" xref="alg1.l5.m1.2.2.4"><mtext id="alg1.l5.m1.2.2.4.cmml" xref="alg1.l5.m1.2.2.4">append</mtext></ci><interval closure="open" id="alg1.l5.m1.2.2.2.3.cmml" xref="alg1.l5.m1.2.2.2.2"><apply id="alg1.l5.m1.1.1.1.1.1.cmml" xref="alg1.l5.m1.1.1.1.1.1"><times id="alg1.l5.m1.1.1.1.1.1.1.cmml" xref="alg1.l5.m1.1.1.1.1.1.1"></times><ci id="alg1.l5.m1.1.1.1.1.1.2.cmml" xref="alg1.l5.m1.1.1.1.1.1.2">𝑤</ci><apply id="alg1.l5.m1.1.1.1.1.1.3.cmml" xref="alg1.l5.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l5.m1.1.1.1.1.1.3.1.cmml" xref="alg1.l5.m1.1.1.1.1.1.3">subscript</csymbol><ci id="alg1.l5.m1.1.1.1.1.1.3.2.cmml" xref="alg1.l5.m1.1.1.1.1.1.3.2">𝑙</ci><ci id="alg1.l5.m1.1.1.1.1.1.3.3.cmml" xref="alg1.l5.m1.1.1.1.1.1.3.3">𝑘</ci></apply></apply><apply id="alg1.l5.m1.2.2.2.2.2.cmml" xref="alg1.l5.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l5.m1.2.2.2.2.2.1.cmml" xref="alg1.l5.m1.2.2.2.2.2">subscript</csymbol><ci id="alg1.l5.m1.2.2.2.2.2.2.cmml" xref="alg1.l5.m1.2.2.2.2.2.2">𝑦</ci><ci id="alg1.l5.m1.2.2.2.2.2.3.cmml" xref="alg1.l5.m1.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.2c">\text{append}(wl_{k},y_{i})</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.2d">append ( italic_w italic_l start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l6.1.1.1" style="font-size:80%;">6:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l6.2">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l6.3">for</span>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l7.1.1.1" style="font-size:80%;">7:</span></span>  // Append to new lists, GPU Block Execution

</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l8.1.1.1" style="font-size:80%;">8:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l8.2">for</span> <math alttext="j" class="ltx_Math" display="inline" id="alg1.l8.m1.1"><semantics id="alg1.l8.m1.1a"><mi id="alg1.l8.m1.1.1" xref="alg1.l8.m1.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.1b"><ci id="alg1.l8.m1.1.1.cmml" xref="alg1.l8.m1.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.1c">j</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.m1.1d">italic_j</annotation></semantics></math> from <math alttext="0" class="ltx_Math" display="inline" id="alg1.l8.m2.1"><semantics id="alg1.l8.m2.1a"><mn id="alg1.l8.m2.1.1" xref="alg1.l8.m2.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="alg1.l8.m2.1b"><cn id="alg1.l8.m2.1.1.cmml" type="integer" xref="alg1.l8.m2.1.1">0</cn></annotation-xml></semantics></math> to <math alttext="N-1" class="ltx_Math" display="inline" id="alg1.l8.m3.1"><semantics id="alg1.l8.m3.1a"><mrow id="alg1.l8.m3.1.1" xref="alg1.l8.m3.1.1.cmml"><mi id="alg1.l8.m3.1.1.2" xref="alg1.l8.m3.1.1.2.cmml">N</mi><mo id="alg1.l8.m3.1.1.1" xref="alg1.l8.m3.1.1.1.cmml">−</mo><mn id="alg1.l8.m3.1.1.3" xref="alg1.l8.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg1.l8.m3.1b"><apply id="alg1.l8.m3.1.1.cmml" xref="alg1.l8.m3.1.1"><minus id="alg1.l8.m3.1.1.1.cmml" xref="alg1.l8.m3.1.1.1"></minus><ci id="alg1.l8.m3.1.1.2.cmml" xref="alg1.l8.m3.1.1.2">𝑁</ci><cn id="alg1.l8.m3.1.1.3.cmml" type="integer" xref="alg1.l8.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m3.1c">N-1</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.m3.1d">italic_N - 1</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l8.3">do</span>
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l9.1.1.1" style="font-size:80%;">9:</span></span>     <span class="ltx_text ltx_font_bold" id="alg1.l9.2">if</span> Reallocation needed <span class="ltx_text ltx_font_bold" id="alg1.l9.3">then</span>
</div>
<div class="ltx_listingline" id="alg1.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l10.1.1.1" style="font-size:80%;">10:</span></span>        Allocate new space <math alttext="l_{j}^{\prime}" class="ltx_Math" display="inline" id="alg1.l10.m1.1"><semantics id="alg1.l10.m1.1a"><msubsup id="alg1.l10.m1.1.1" xref="alg1.l10.m1.1.1.cmml"><mi id="alg1.l10.m1.1.1.2.2" xref="alg1.l10.m1.1.1.2.2.cmml">l</mi><mi id="alg1.l10.m1.1.1.2.3" xref="alg1.l10.m1.1.1.2.3.cmml">j</mi><mo id="alg1.l10.m1.1.1.3" xref="alg1.l10.m1.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.l10.m1.1b"><apply id="alg1.l10.m1.1.1.cmml" xref="alg1.l10.m1.1.1"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.1.cmml" xref="alg1.l10.m1.1.1">superscript</csymbol><apply id="alg1.l10.m1.1.1.2.cmml" xref="alg1.l10.m1.1.1"><csymbol cd="ambiguous" id="alg1.l10.m1.1.1.2.1.cmml" xref="alg1.l10.m1.1.1">subscript</csymbol><ci id="alg1.l10.m1.1.1.2.2.cmml" xref="alg1.l10.m1.1.1.2.2">𝑙</ci><ci id="alg1.l10.m1.1.1.2.3.cmml" xref="alg1.l10.m1.1.1.2.3">𝑗</ci></apply><ci id="alg1.l10.m1.1.1.3.cmml" xref="alg1.l10.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m1.1c">l_{j}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg1.l10.m1.1d">italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> of <math alttext="l_{j}.size+m_{k}.size" class="ltx_Math" display="inline" id="alg1.l10.m2.3"><semantics id="alg1.l10.m2.3a"><mrow id="alg1.l10.m2.3.3.3" xref="alg1.l10.m2.3.3.4.cmml"><msub id="alg1.l10.m2.1.1.1.1" xref="alg1.l10.m2.1.1.1.1.cmml"><mi id="alg1.l10.m2.1.1.1.1.2" xref="alg1.l10.m2.1.1.1.1.2.cmml">l</mi><mi id="alg1.l10.m2.1.1.1.1.3" xref="alg1.l10.m2.1.1.1.1.3.cmml">j</mi></msub><mo id="alg1.l10.m2.3.3.3.4" lspace="0em" rspace="0.167em" xref="alg1.l10.m2.3.3.4a.cmml">.</mo><mrow id="alg1.l10.m2.2.2.2.2" xref="alg1.l10.m2.2.2.2.2.cmml"><mrow id="alg1.l10.m2.2.2.2.2.2" xref="alg1.l10.m2.2.2.2.2.2.cmml"><mi id="alg1.l10.m2.2.2.2.2.2.2" xref="alg1.l10.m2.2.2.2.2.2.2.cmml">s</mi><mo id="alg1.l10.m2.2.2.2.2.2.1" xref="alg1.l10.m2.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m2.2.2.2.2.2.3" xref="alg1.l10.m2.2.2.2.2.2.3.cmml">i</mi><mo id="alg1.l10.m2.2.2.2.2.2.1a" xref="alg1.l10.m2.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m2.2.2.2.2.2.4" xref="alg1.l10.m2.2.2.2.2.2.4.cmml">z</mi><mo id="alg1.l10.m2.2.2.2.2.2.1b" xref="alg1.l10.m2.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m2.2.2.2.2.2.5" xref="alg1.l10.m2.2.2.2.2.2.5.cmml">e</mi></mrow><mo id="alg1.l10.m2.2.2.2.2.1" xref="alg1.l10.m2.2.2.2.2.1.cmml">+</mo><msub id="alg1.l10.m2.2.2.2.2.3" xref="alg1.l10.m2.2.2.2.2.3.cmml"><mi id="alg1.l10.m2.2.2.2.2.3.2" xref="alg1.l10.m2.2.2.2.2.3.2.cmml">m</mi><mi id="alg1.l10.m2.2.2.2.2.3.3" xref="alg1.l10.m2.2.2.2.2.3.3.cmml">k</mi></msub></mrow><mo id="alg1.l10.m2.3.3.3.5" lspace="0em" rspace="0.167em" xref="alg1.l10.m2.3.3.4a.cmml">.</mo><mrow id="alg1.l10.m2.3.3.3.3" xref="alg1.l10.m2.3.3.3.3.cmml"><mi id="alg1.l10.m2.3.3.3.3.2" xref="alg1.l10.m2.3.3.3.3.2.cmml">s</mi><mo id="alg1.l10.m2.3.3.3.3.1" xref="alg1.l10.m2.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l10.m2.3.3.3.3.3" xref="alg1.l10.m2.3.3.3.3.3.cmml">i</mi><mo id="alg1.l10.m2.3.3.3.3.1a" xref="alg1.l10.m2.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l10.m2.3.3.3.3.4" xref="alg1.l10.m2.3.3.3.3.4.cmml">z</mi><mo id="alg1.l10.m2.3.3.3.3.1b" xref="alg1.l10.m2.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l10.m2.3.3.3.3.5" xref="alg1.l10.m2.3.3.3.3.5.cmml">e</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l10.m2.3b"><apply id="alg1.l10.m2.3.3.4.cmml" xref="alg1.l10.m2.3.3.3"><csymbol cd="ambiguous" id="alg1.l10.m2.3.3.4a.cmml" xref="alg1.l10.m2.3.3.3.4">formulae-sequence</csymbol><apply id="alg1.l10.m2.1.1.1.1.cmml" xref="alg1.l10.m2.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l10.m2.1.1.1.1.1.cmml" xref="alg1.l10.m2.1.1.1.1">subscript</csymbol><ci id="alg1.l10.m2.1.1.1.1.2.cmml" xref="alg1.l10.m2.1.1.1.1.2">𝑙</ci><ci id="alg1.l10.m2.1.1.1.1.3.cmml" xref="alg1.l10.m2.1.1.1.1.3">𝑗</ci></apply><apply id="alg1.l10.m2.2.2.2.2.cmml" xref="alg1.l10.m2.2.2.2.2"><plus id="alg1.l10.m2.2.2.2.2.1.cmml" xref="alg1.l10.m2.2.2.2.2.1"></plus><apply id="alg1.l10.m2.2.2.2.2.2.cmml" xref="alg1.l10.m2.2.2.2.2.2"><times id="alg1.l10.m2.2.2.2.2.2.1.cmml" xref="alg1.l10.m2.2.2.2.2.2.1"></times><ci id="alg1.l10.m2.2.2.2.2.2.2.cmml" xref="alg1.l10.m2.2.2.2.2.2.2">𝑠</ci><ci id="alg1.l10.m2.2.2.2.2.2.3.cmml" xref="alg1.l10.m2.2.2.2.2.2.3">𝑖</ci><ci id="alg1.l10.m2.2.2.2.2.2.4.cmml" xref="alg1.l10.m2.2.2.2.2.2.4">𝑧</ci><ci id="alg1.l10.m2.2.2.2.2.2.5.cmml" xref="alg1.l10.m2.2.2.2.2.2.5">𝑒</ci></apply><apply id="alg1.l10.m2.2.2.2.2.3.cmml" xref="alg1.l10.m2.2.2.2.2.3"><csymbol cd="ambiguous" id="alg1.l10.m2.2.2.2.2.3.1.cmml" xref="alg1.l10.m2.2.2.2.2.3">subscript</csymbol><ci id="alg1.l10.m2.2.2.2.2.3.2.cmml" xref="alg1.l10.m2.2.2.2.2.3.2">𝑚</ci><ci id="alg1.l10.m2.2.2.2.2.3.3.cmml" xref="alg1.l10.m2.2.2.2.2.3.3">𝑘</ci></apply></apply><apply id="alg1.l10.m2.3.3.3.3.cmml" xref="alg1.l10.m2.3.3.3.3"><times id="alg1.l10.m2.3.3.3.3.1.cmml" xref="alg1.l10.m2.3.3.3.3.1"></times><ci id="alg1.l10.m2.3.3.3.3.2.cmml" xref="alg1.l10.m2.3.3.3.3.2">𝑠</ci><ci id="alg1.l10.m2.3.3.3.3.3.cmml" xref="alg1.l10.m2.3.3.3.3.3">𝑖</ci><ci id="alg1.l10.m2.3.3.3.3.4.cmml" xref="alg1.l10.m2.3.3.3.3.4">𝑧</ci><ci id="alg1.l10.m2.3.3.3.3.5.cmml" xref="alg1.l10.m2.3.3.3.3.5">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m2.3c">l_{j}.size+m_{k}.size</annotation><annotation encoding="application/x-llamapun" id="alg1.l10.m2.3d">italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT . italic_s italic_i italic_z italic_e + italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT . italic_s italic_i italic_z italic_e</annotation></semantics></math> allocated

</div>
<div class="ltx_listingline" id="alg1.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l11.1.1.1" style="font-size:80%;">11:</span></span>        <math alttext="{l_{j}^{\prime}}\leftarrow Merge(l_{j},wl_{j})" class="ltx_Math" display="inline" id="alg1.l11.m1.2"><semantics id="alg1.l11.m1.2a"><mrow id="alg1.l11.m1.2.2" xref="alg1.l11.m1.2.2.cmml"><msubsup id="alg1.l11.m1.2.2.4" xref="alg1.l11.m1.2.2.4.cmml"><mi id="alg1.l11.m1.2.2.4.2.2" xref="alg1.l11.m1.2.2.4.2.2.cmml">l</mi><mi id="alg1.l11.m1.2.2.4.2.3" xref="alg1.l11.m1.2.2.4.2.3.cmml">j</mi><mo id="alg1.l11.m1.2.2.4.3" xref="alg1.l11.m1.2.2.4.3.cmml">′</mo></msubsup><mo id="alg1.l11.m1.2.2.3" stretchy="false" xref="alg1.l11.m1.2.2.3.cmml">←</mo><mrow id="alg1.l11.m1.2.2.2" xref="alg1.l11.m1.2.2.2.cmml"><mi id="alg1.l11.m1.2.2.2.4" xref="alg1.l11.m1.2.2.2.4.cmml">M</mi><mo id="alg1.l11.m1.2.2.2.3" xref="alg1.l11.m1.2.2.2.3.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.5" xref="alg1.l11.m1.2.2.2.5.cmml">e</mi><mo id="alg1.l11.m1.2.2.2.3a" xref="alg1.l11.m1.2.2.2.3.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.6" xref="alg1.l11.m1.2.2.2.6.cmml">r</mi><mo id="alg1.l11.m1.2.2.2.3b" xref="alg1.l11.m1.2.2.2.3.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.7" xref="alg1.l11.m1.2.2.2.7.cmml">g</mi><mo id="alg1.l11.m1.2.2.2.3c" xref="alg1.l11.m1.2.2.2.3.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.8" xref="alg1.l11.m1.2.2.2.8.cmml">e</mi><mo id="alg1.l11.m1.2.2.2.3d" xref="alg1.l11.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg1.l11.m1.2.2.2.2.2" xref="alg1.l11.m1.2.2.2.2.3.cmml"><mo id="alg1.l11.m1.2.2.2.2.2.3" stretchy="false" xref="alg1.l11.m1.2.2.2.2.3.cmml">(</mo><msub id="alg1.l11.m1.1.1.1.1.1.1" xref="alg1.l11.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l11.m1.1.1.1.1.1.1.2" xref="alg1.l11.m1.1.1.1.1.1.1.2.cmml">l</mi><mi id="alg1.l11.m1.1.1.1.1.1.1.3" xref="alg1.l11.m1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="alg1.l11.m1.2.2.2.2.2.4" xref="alg1.l11.m1.2.2.2.2.3.cmml">,</mo><mrow id="alg1.l11.m1.2.2.2.2.2.2" xref="alg1.l11.m1.2.2.2.2.2.2.cmml"><mi id="alg1.l11.m1.2.2.2.2.2.2.2" xref="alg1.l11.m1.2.2.2.2.2.2.2.cmml">w</mi><mo id="alg1.l11.m1.2.2.2.2.2.2.1" xref="alg1.l11.m1.2.2.2.2.2.2.1.cmml">⁢</mo><msub id="alg1.l11.m1.2.2.2.2.2.2.3" xref="alg1.l11.m1.2.2.2.2.2.2.3.cmml"><mi id="alg1.l11.m1.2.2.2.2.2.2.3.2" xref="alg1.l11.m1.2.2.2.2.2.2.3.2.cmml">l</mi><mi id="alg1.l11.m1.2.2.2.2.2.2.3.3" xref="alg1.l11.m1.2.2.2.2.2.2.3.3.cmml">j</mi></msub></mrow><mo id="alg1.l11.m1.2.2.2.2.2.5" stretchy="false" xref="alg1.l11.m1.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l11.m1.2b"><apply id="alg1.l11.m1.2.2.cmml" xref="alg1.l11.m1.2.2"><ci id="alg1.l11.m1.2.2.3.cmml" xref="alg1.l11.m1.2.2.3">←</ci><apply id="alg1.l11.m1.2.2.4.cmml" xref="alg1.l11.m1.2.2.4"><csymbol cd="ambiguous" id="alg1.l11.m1.2.2.4.1.cmml" xref="alg1.l11.m1.2.2.4">superscript</csymbol><apply id="alg1.l11.m1.2.2.4.2.cmml" xref="alg1.l11.m1.2.2.4"><csymbol cd="ambiguous" id="alg1.l11.m1.2.2.4.2.1.cmml" xref="alg1.l11.m1.2.2.4">subscript</csymbol><ci id="alg1.l11.m1.2.2.4.2.2.cmml" xref="alg1.l11.m1.2.2.4.2.2">𝑙</ci><ci id="alg1.l11.m1.2.2.4.2.3.cmml" xref="alg1.l11.m1.2.2.4.2.3">𝑗</ci></apply><ci id="alg1.l11.m1.2.2.4.3.cmml" xref="alg1.l11.m1.2.2.4.3">′</ci></apply><apply id="alg1.l11.m1.2.2.2.cmml" xref="alg1.l11.m1.2.2.2"><times id="alg1.l11.m1.2.2.2.3.cmml" xref="alg1.l11.m1.2.2.2.3"></times><ci id="alg1.l11.m1.2.2.2.4.cmml" xref="alg1.l11.m1.2.2.2.4">𝑀</ci><ci id="alg1.l11.m1.2.2.2.5.cmml" xref="alg1.l11.m1.2.2.2.5">𝑒</ci><ci id="alg1.l11.m1.2.2.2.6.cmml" xref="alg1.l11.m1.2.2.2.6">𝑟</ci><ci id="alg1.l11.m1.2.2.2.7.cmml" xref="alg1.l11.m1.2.2.2.7">𝑔</ci><ci id="alg1.l11.m1.2.2.2.8.cmml" xref="alg1.l11.m1.2.2.2.8">𝑒</ci><interval closure="open" id="alg1.l11.m1.2.2.2.2.3.cmml" xref="alg1.l11.m1.2.2.2.2.2"><apply id="alg1.l11.m1.1.1.1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l11.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l11.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l11.m1.1.1.1.1.1.1.2">𝑙</ci><ci id="alg1.l11.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l11.m1.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="alg1.l11.m1.2.2.2.2.2.2.cmml" xref="alg1.l11.m1.2.2.2.2.2.2"><times id="alg1.l11.m1.2.2.2.2.2.2.1.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.1"></times><ci id="alg1.l11.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.2">𝑤</ci><apply id="alg1.l11.m1.2.2.2.2.2.2.3.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="alg1.l11.m1.2.2.2.2.2.2.3.1.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.3">subscript</csymbol><ci id="alg1.l11.m1.2.2.2.2.2.2.3.2.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.3.2">𝑙</ci><ci id="alg1.l11.m1.2.2.2.2.2.2.3.3.cmml" xref="alg1.l11.m1.2.2.2.2.2.2.3.3">𝑗</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l11.m1.2c">{l_{j}^{\prime}}\leftarrow Merge(l_{j},wl_{j})</annotation><annotation encoding="application/x-llamapun" id="alg1.l11.m1.2d">italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← italic_M italic_e italic_r italic_g italic_e ( italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , italic_w italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l12.1.1.1" style="font-size:80%;">12:</span></span>        free <math alttext="l_{j}" class="ltx_Math" display="inline" id="alg1.l12.m1.1"><semantics id="alg1.l12.m1.1a"><msub id="alg1.l12.m1.1.1" xref="alg1.l12.m1.1.1.cmml"><mi id="alg1.l12.m1.1.1.2" xref="alg1.l12.m1.1.1.2.cmml">l</mi><mi id="alg1.l12.m1.1.1.3" xref="alg1.l12.m1.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l12.m1.1b"><apply id="alg1.l12.m1.1.1.cmml" xref="alg1.l12.m1.1.1"><csymbol cd="ambiguous" id="alg1.l12.m1.1.1.1.cmml" xref="alg1.l12.m1.1.1">subscript</csymbol><ci id="alg1.l12.m1.1.1.2.cmml" xref="alg1.l12.m1.1.1.2">𝑙</ci><ci id="alg1.l12.m1.1.1.3.cmml" xref="alg1.l12.m1.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l12.m1.1c">l_{j}</annotation><annotation encoding="application/x-llamapun" id="alg1.l12.m1.1d">italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="l_{j}\leftarrow l_{j}^{\prime}" class="ltx_Math" display="inline" id="alg1.l12.m2.1"><semantics id="alg1.l12.m2.1a"><mrow id="alg1.l12.m2.1.1" xref="alg1.l12.m2.1.1.cmml"><msub id="alg1.l12.m2.1.1.2" xref="alg1.l12.m2.1.1.2.cmml"><mi id="alg1.l12.m2.1.1.2.2" xref="alg1.l12.m2.1.1.2.2.cmml">l</mi><mi id="alg1.l12.m2.1.1.2.3" xref="alg1.l12.m2.1.1.2.3.cmml">j</mi></msub><mo id="alg1.l12.m2.1.1.1" stretchy="false" xref="alg1.l12.m2.1.1.1.cmml">←</mo><msubsup id="alg1.l12.m2.1.1.3" xref="alg1.l12.m2.1.1.3.cmml"><mi id="alg1.l12.m2.1.1.3.2.2" xref="alg1.l12.m2.1.1.3.2.2.cmml">l</mi><mi id="alg1.l12.m2.1.1.3.2.3" xref="alg1.l12.m2.1.1.3.2.3.cmml">j</mi><mo id="alg1.l12.m2.1.1.3.3" xref="alg1.l12.m2.1.1.3.3.cmml">′</mo></msubsup></mrow><annotation-xml encoding="MathML-Content" id="alg1.l12.m2.1b"><apply id="alg1.l12.m2.1.1.cmml" xref="alg1.l12.m2.1.1"><ci id="alg1.l12.m2.1.1.1.cmml" xref="alg1.l12.m2.1.1.1">←</ci><apply id="alg1.l12.m2.1.1.2.cmml" xref="alg1.l12.m2.1.1.2"><csymbol cd="ambiguous" id="alg1.l12.m2.1.1.2.1.cmml" xref="alg1.l12.m2.1.1.2">subscript</csymbol><ci id="alg1.l12.m2.1.1.2.2.cmml" xref="alg1.l12.m2.1.1.2.2">𝑙</ci><ci id="alg1.l12.m2.1.1.2.3.cmml" xref="alg1.l12.m2.1.1.2.3">𝑗</ci></apply><apply id="alg1.l12.m2.1.1.3.cmml" xref="alg1.l12.m2.1.1.3"><csymbol cd="ambiguous" id="alg1.l12.m2.1.1.3.1.cmml" xref="alg1.l12.m2.1.1.3">superscript</csymbol><apply id="alg1.l12.m2.1.1.3.2.cmml" xref="alg1.l12.m2.1.1.3"><csymbol cd="ambiguous" id="alg1.l12.m2.1.1.3.2.1.cmml" xref="alg1.l12.m2.1.1.3">subscript</csymbol><ci id="alg1.l12.m2.1.1.3.2.2.cmml" xref="alg1.l12.m2.1.1.3.2.2">𝑙</ci><ci id="alg1.l12.m2.1.1.3.2.3.cmml" xref="alg1.l12.m2.1.1.3.2.3">𝑗</ci></apply><ci id="alg1.l12.m2.1.1.3.3.cmml" xref="alg1.l12.m2.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l12.m2.1c">l_{j}\leftarrow l_{j}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg1.l12.m2.1d">italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ← italic_l start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l13.1.1.1" style="font-size:80%;">13:</span></span>     <span class="ltx_text ltx_font_bold" id="alg1.l13.2">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l13.3">if</span>
</div>
<div class="ltx_listingline" id="alg1.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l14.1.1.1" style="font-size:80%;">14:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l14.2">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l14.3">for</span>
</div>
<div class="ltx_listingline" id="alg1.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l15.1.1.1" style="font-size:80%;">15:</span></span>  <span class="ltx_text ltx_font_bold" id="alg1.l15.2">return</span>  purely new and complete id lists <math alttext="L" class="ltx_Math" display="inline" id="alg1.l15.m1.1"><semantics id="alg1.l15.m1.1a"><mi id="alg1.l15.m1.1.1" xref="alg1.l15.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="alg1.l15.m1.1b"><ci id="alg1.l15.m1.1.1.cmml" xref="alg1.l15.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l15.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="alg1.l15.m1.1d">italic_L</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">On the other hand, existing systems employ a single-stream serial execution mode for ANNS. In scenarios where tasks are singular and dependent on each other (e.g., the current kernel relies on the output of the previous kernel), the execution is highly ordered, with data processed one by one as a batch to maximize throughput. However, in cases where GPU tasks are diverse and independent, this execution mechanism may not suffice for handling complex scenarios. As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F2" title="Figure 2 ‣ 3.2. Stream-Cached Multi-Stream Execution ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a>, systems that rely on serial execution need to wait separately for real-time vector extension. If the volume of data being copied is substantial, this waiting period can be prolonged, which could block the execution of the incoming search. For example, in the case of a long vector list (hot data), a single real-time vector insertion could take tens of milliseconds due to repeated copying, thereby obstructing normal retrieval operations.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">So we want to design such a system to tackle the above shortcomings: 1) online vector insertions can be updated real-time 2) online vector insertions require the least extra memory 3) online vector insertions can be processed parallel with online search procedure.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">In this article, we introduce a novel <span class="ltx_text ltx_font_bold" id="S1.p6.1.1">R</span>eal-<span class="ltx_text ltx_font_bold" id="S1.p6.1.2">T</span>ime Adaptive <span class="ltx_text ltx_font_bold" id="S1.p6.1.3">M</span>ulti-<span class="ltx_text ltx_font_bold" id="S1.p6.1.4">S</span>tream System for Online <span class="ltx_text ltx_font_bold" id="S1.p6.1.5">G</span>PU <span class="ltx_text ltx_font_bold" id="S1.p6.1.6">A</span>pproximate <span class="ltx_text ltx_font_bold" id="S1.p6.1.7">N</span>earest <span class="ltx_text ltx_font_bold" id="S1.p6.1.8">N</span>eighbor <span class="ltx_text ltx_font_bold" id="S1.p6.1.9">S</span>earch (<span class="ltx_text ltx_font_bold" id="S1.p6.1.10">RTMS-GANNS</span>). Our innovation includes a well-designed dynamic vector operation algorithm along with a novel execution mode which leverages the parallelism inherent in GPU streams, enabling a high-performance concurrent execution of vector search and real-time vector insertion. Our contributions can be summarized as follows:</p>
</div>
<div class="ltx_para" id="S1.p7">
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We propose an innovative approach to handle real-time vector insertion, utilizing a dynamic algorithm based on memory blocks. This method not only allows for the seamless integration of new vectors but also incorporates in-place rearrangement, optimizing memory utilization. By minimizing the need for costly GPU memory allocation and copying, our solution ensures efficient real-time insertions without compromising performance.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">In addition to the dynamic vector insertion algorithm, we introduce a multi-stream parallel execution mode to enable real-time insertions. Unlike traditional systems that execute tasks sequentially within a single stream, our architecture embraces parallelism by utilizing a stream-cached dynamic resource pool. This innovative design enables different streams to execute concurrently, eliminating the need for additional execution blocking.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">Extensive experiments and comparisons validate the effectiveness of our approach in benchmark dataset and industrial dataset. Our solution effectively handles varying QPS levels across different datasets, reducing latency by up to <math alttext="40\%-80\%" class="ltx_Math" display="inline" id="S1.I1.i3.p1.1.m1.1"><semantics id="S1.I1.i3.p1.1.m1.1a"><mrow id="S1.I1.i3.p1.1.m1.1.1" xref="S1.I1.i3.p1.1.m1.1.1.cmml"><mrow id="S1.I1.i3.p1.1.m1.1.1.2" xref="S1.I1.i3.p1.1.m1.1.1.2.cmml"><mn id="S1.I1.i3.p1.1.m1.1.1.2.2" xref="S1.I1.i3.p1.1.m1.1.1.2.2.cmml">40</mn><mo id="S1.I1.i3.p1.1.m1.1.1.2.1" xref="S1.I1.i3.p1.1.m1.1.1.2.1.cmml">%</mo></mrow><mo id="S1.I1.i3.p1.1.m1.1.1.1" xref="S1.I1.i3.p1.1.m1.1.1.1.cmml">−</mo><mrow id="S1.I1.i3.p1.1.m1.1.1.3" xref="S1.I1.i3.p1.1.m1.1.1.3.cmml"><mn id="S1.I1.i3.p1.1.m1.1.1.3.2" xref="S1.I1.i3.p1.1.m1.1.1.3.2.cmml">80</mn><mo id="S1.I1.i3.p1.1.m1.1.1.3.1" xref="S1.I1.i3.p1.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.I1.i3.p1.1.m1.1b"><apply id="S1.I1.i3.p1.1.m1.1.1.cmml" xref="S1.I1.i3.p1.1.m1.1.1"><minus id="S1.I1.i3.p1.1.m1.1.1.1.cmml" xref="S1.I1.i3.p1.1.m1.1.1.1"></minus><apply id="S1.I1.i3.p1.1.m1.1.1.2.cmml" xref="S1.I1.i3.p1.1.m1.1.1.2"><csymbol cd="latexml" id="S1.I1.i3.p1.1.m1.1.1.2.1.cmml" xref="S1.I1.i3.p1.1.m1.1.1.2.1">percent</csymbol><cn id="S1.I1.i3.p1.1.m1.1.1.2.2.cmml" type="integer" xref="S1.I1.i3.p1.1.m1.1.1.2.2">40</cn></apply><apply id="S1.I1.i3.p1.1.m1.1.1.3.cmml" xref="S1.I1.i3.p1.1.m1.1.1.3"><csymbol cd="latexml" id="S1.I1.i3.p1.1.m1.1.1.3.1.cmml" xref="S1.I1.i3.p1.1.m1.1.1.3.1">percent</csymbol><cn id="S1.I1.i3.p1.1.m1.1.1.3.2.cmml" type="integer" xref="S1.I1.i3.p1.1.m1.1.1.3.2">80</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i3.p1.1.m1.1c">40\%-80\%</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i3.p1.1.m1.1d">40 % - 80 %</annotation></semantics></math>. With successful deployment in real-world industrial search and recommendation systems, our solution has proven instrumental in serving hundreds of millions of users daily, yielding remarkable outcomes.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="291" id="S1.F1.g1" src="x1.png" width="747"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>(a) Inverted Id List and Vector Arrangement in Faiss/Raft: new vectors are appended, and new memory space is allocated. Old memory space is freed after the new one is ready. (b) Inverted Id List and Vector Arrangement in Proposed Method: the memory block is applied when new vectors need to be inserted. Each memory block has a header indicating its previous and next blocks. In this example, the IDs 0, 2, 6, 7, 9, and 10 can be connected as a single ID list. (c) Inverted Id List and Vector Arrangement after In-place Rearrangement: if the memory block list Exceed(<math alttext="m^{\prime}" class="ltx_Math" display="inline" id="S1.F1.2.m1.1"><semantics id="S1.F1.2.m1.1b"><msup id="S1.F1.2.m1.1.1" xref="S1.F1.2.m1.1.1.cmml"><mi id="S1.F1.2.m1.1.1.2" xref="S1.F1.2.m1.1.1.2.cmml">m</mi><mo id="S1.F1.2.m1.1.1.3" xref="S1.F1.2.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S1.F1.2.m1.1c"><apply id="S1.F1.2.m1.1.1.cmml" xref="S1.F1.2.m1.1.1"><csymbol cd="ambiguous" id="S1.F1.2.m1.1.1.1.cmml" xref="S1.F1.2.m1.1.1">superscript</csymbol><ci id="S1.F1.2.m1.1.1.2.cmml" xref="S1.F1.2.m1.1.1.2">𝑚</ci><ci id="S1.F1.2.m1.1.1.3.cmml" xref="S1.F1.2.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.2.m1.1d">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.2.m1.1e">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>), dynamic rearrangement of fragmented memory blocks are executed. Temporary segments are utilized in this process. In this example, the IDs 4, 5, 8, and ”pad” are aggregated, optimizing the header jump from twice to one.</figcaption>
</figure>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Related Work</h2>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1. </span>GPU facilitated Approximate Nearest Neighbour Search</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">As mentioned earlier, Faiss <cite class="ltx_cite ltx_citemacro_citep">(Johnson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib11" title="">2019</a>)</cite> and Raft <cite class="ltx_cite ltx_citemacro_citep">(Rapidsai, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib18" title="">2022</a>)</cite> are pioneering works that elevated vector retrieval systems from CPU to GPU, inaugurating the era of GPU-accelerated Approximate Nearest Neighbor Search (ANNS). Subsequent endeavors have built upon this foundation, focusing on either algorithmic enhancements or system architecture. In the realm of algorithms, RobustiQ <cite class="ltx_cite ltx_citemacro_citep">(Chen et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib5" title="">2019</a>)</cite> optimized and extended quantization algorithms for GPU implementation, while works such as <cite class="ltx_cite ltx_citemacro_citep">(Ootomo et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib16" title="">2023</a>)</cite><cite class="ltx_cite ltx_citemacro_citep">(Yu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib25" title="">2022</a>)</cite><cite class="ltx_cite ltx_citemacro_citep">(Zhao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib27" title="">2020</a>)</cite> made significant strides in improving GPU-based graph algorithms. Regarding system design optimization, <cite class="ltx_cite ltx_citemacro_citep">(Karthik et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib12" title="">2024</a>)</cite><cite class="ltx_cite ltx_citemacro_citep">(Souza et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib20" title="">2021</a>)</cite><cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib26" title="">2024</a>)</cite> independently converged on integrating heterogeneous CPU-GPU scheduling, distributing data between GPU and CPU, and establishing periodic synchronization mechanisms. Despite these optimizations, all existing approaches still rely on a serial offline system and fall short of effectively addressing the challenges posed by real-time vector insertions.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.1">In this study, we shift our focus from theoretical algorithmic improvements to system architecture. We present the first GPU ANNS system operating on a parallel architecture, providing an effective solution for online scenarios and marking a clear distinction from the aforementioned systems. This approach addresses the critical need for high-frequency real-time vector insertions, ensuring up-to-date and accurate search results in dynamic environments.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2. </span>Online Vector Insertion Methods in CPU/GPU ANNS</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">In CPU systems, inserting a vector into memory is a straightforward process. For inverted-based algorithms, SPFresh <cite class="ltx_cite ltx_citemacro_citep">(Xu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib24" title="">2023</a>)</cite> proposed an incremental rebalancing tool to split vector partitions and reassign vectors in nearby partitions, adapting to shifts in data distribution. Since this algorithm is applied in CPU systems, their optimization focus differs from ours. They mainly focus on optimizing the balance of the id list, which is another real-time concern while we are concerned with reducing the expensive memory allocation overhead, non-aligned memory access, and blocking execution frameworks in GPUs. Therefore it is still difficult to apply this methods on GPUs without a feasible framework before our system is proposed. For graph-based algorithms, FreshDiskANN <cite class="ltx_cite ltx_citemacro_citep">(Aditi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib3" title="">2021</a>)</cite> designed a novel two-pass Streaming-Merge algorithm for efficiently merging the in-memory index with the SSD-index. This algorithm is designed for SSD-based disk indexing, proposing real-time update methods primarily focused on updates under large data scenarios rather than making the update mechanism more tailored to disks. Additionally, due to significant differences between GPU and CPU graph algorithms, this method cannot be directly applied to GPUs. In this paper, we only focus on the currently more widely-used IVF methods instead of graph based methods. In addition, <cite class="ltx_cite ltx_citemacro_citep">(Andrade et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib4" title="">2023</a>)</cite><cite class="ltx_cite ltx_citemacro_citep">(Karthik et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib12" title="">2024</a>)</cite> focus on using heterogeneous hardware, combining CPUs and GPUs to facilitate computations. While they may load the latest vectors during the process of exchanging data from CPU to the GPU, these methods themselves do not aim to address the real-time vector insertion problem. Moreover, they still encounter issues with expensive copying and reallocation, as illustrated in the previous section, making such approaches difficult to implement in practice.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>System Overview</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Memory Block Based Real-time Vector Insertion Algorithm</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.9">In this section, we will primarily introduce our proposed memory block based dynamic vector insertion algorithm. The overview memory layout is depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>b and the main algorithm process is illustrated in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg2" title="Algorithm 2 ‣ 3.1. Memory Block Based Real-time Vector Insertion Algorithm ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a>. Instead of arranging all vectors in continuous memory as in existing systems, we link them as a list using the header of each memory block <math alttext="m" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><mi id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><ci id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_m</annotation></semantics></math> for the vector id list <math alttext="l" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><mi id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><ci id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">l</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_l</annotation></semantics></math> of a certain cluster <math alttext="c" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><mi id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><ci id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">italic_c</annotation></semantics></math> in ivfflat and ivfpq, which are represented by the same color in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>b. To mitigate memory allocation overhead <cite class="ltx_cite ltx_citemacro_citep">(Winter et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib23" title="">2021</a>)</cite> during processing, we have designed a memory allocation method in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg2" title="Algorithm 2 ‣ 3.1. Memory Block Based Real-time Vector Insertion Algorithm ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a> (line 13). It comprises the central memory pool <math alttext="P" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><mi id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><ci id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">P</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">italic_P</annotation></semantics></math> (occupying almost the entire GPU memory) and the memory block <math alttext="m" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><mi id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><ci id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">italic_m</annotation></semantics></math> (the smallest unit). The central memory pool <math alttext="P" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><mi id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><ci id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">P</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">italic_P</annotation></semantics></math> has been pre-split by memory blocks, which are labeled from 0, 1 … to <math alttext="|P|" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><mrow id="S3.SS1.p1.7.m7.1.2.2" xref="S3.SS1.p1.7.m7.1.2.1.cmml"><mo id="S3.SS1.p1.7.m7.1.2.2.1" stretchy="false" xref="S3.SS1.p1.7.m7.1.2.1.1.cmml">|</mo><mi id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml">P</mi><mo id="S3.SS1.p1.7.m7.1.2.2.2" stretchy="false" xref="S3.SS1.p1.7.m7.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><apply id="S3.SS1.p1.7.m7.1.2.1.cmml" xref="S3.SS1.p1.7.m7.1.2.2"><abs id="S3.SS1.p1.7.m7.1.2.1.1.cmml" xref="S3.SS1.p1.7.m7.1.2.2.1"></abs><ci id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1">𝑃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">|P|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">| italic_P |</annotation></semantics></math>. The <math alttext="cur_{P}" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m8.1"><semantics id="S3.SS1.p1.8.m8.1a"><mrow id="S3.SS1.p1.8.m8.1.1" xref="S3.SS1.p1.8.m8.1.1.cmml"><mi id="S3.SS1.p1.8.m8.1.1.2" xref="S3.SS1.p1.8.m8.1.1.2.cmml">c</mi><mo id="S3.SS1.p1.8.m8.1.1.1" xref="S3.SS1.p1.8.m8.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.8.m8.1.1.3" xref="S3.SS1.p1.8.m8.1.1.3.cmml">u</mi><mo id="S3.SS1.p1.8.m8.1.1.1a" xref="S3.SS1.p1.8.m8.1.1.1.cmml">⁢</mo><msub id="S3.SS1.p1.8.m8.1.1.4" xref="S3.SS1.p1.8.m8.1.1.4.cmml"><mi id="S3.SS1.p1.8.m8.1.1.4.2" xref="S3.SS1.p1.8.m8.1.1.4.2.cmml">r</mi><mi id="S3.SS1.p1.8.m8.1.1.4.3" xref="S3.SS1.p1.8.m8.1.1.4.3.cmml">P</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m8.1b"><apply id="S3.SS1.p1.8.m8.1.1.cmml" xref="S3.SS1.p1.8.m8.1.1"><times id="S3.SS1.p1.8.m8.1.1.1.cmml" xref="S3.SS1.p1.8.m8.1.1.1"></times><ci id="S3.SS1.p1.8.m8.1.1.2.cmml" xref="S3.SS1.p1.8.m8.1.1.2">𝑐</ci><ci id="S3.SS1.p1.8.m8.1.1.3.cmml" xref="S3.SS1.p1.8.m8.1.1.3">𝑢</ci><apply id="S3.SS1.p1.8.m8.1.1.4.cmml" xref="S3.SS1.p1.8.m8.1.1.4"><csymbol cd="ambiguous" id="S3.SS1.p1.8.m8.1.1.4.1.cmml" xref="S3.SS1.p1.8.m8.1.1.4">subscript</csymbol><ci id="S3.SS1.p1.8.m8.1.1.4.2.cmml" xref="S3.SS1.p1.8.m8.1.1.4.2">𝑟</ci><ci id="S3.SS1.p1.8.m8.1.1.4.3.cmml" xref="S3.SS1.p1.8.m8.1.1.4.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m8.1c">cur_{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m8.1d">italic_c italic_u italic_r start_POSTSUBSCRIPT italic_P end_POSTSUBSCRIPT</annotation></semantics></math> represents the current position of latest allocated memory block. When allocating a memory block, we would atomicAdd the <math alttext="cur_{P}" class="ltx_Math" display="inline" id="S3.SS1.p1.9.m9.1"><semantics id="S3.SS1.p1.9.m9.1a"><mrow id="S3.SS1.p1.9.m9.1.1" xref="S3.SS1.p1.9.m9.1.1.cmml"><mi id="S3.SS1.p1.9.m9.1.1.2" xref="S3.SS1.p1.9.m9.1.1.2.cmml">c</mi><mo id="S3.SS1.p1.9.m9.1.1.1" xref="S3.SS1.p1.9.m9.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.9.m9.1.1.3" xref="S3.SS1.p1.9.m9.1.1.3.cmml">u</mi><mo id="S3.SS1.p1.9.m9.1.1.1a" xref="S3.SS1.p1.9.m9.1.1.1.cmml">⁢</mo><msub id="S3.SS1.p1.9.m9.1.1.4" xref="S3.SS1.p1.9.m9.1.1.4.cmml"><mi id="S3.SS1.p1.9.m9.1.1.4.2" xref="S3.SS1.p1.9.m9.1.1.4.2.cmml">r</mi><mi id="S3.SS1.p1.9.m9.1.1.4.3" xref="S3.SS1.p1.9.m9.1.1.4.3.cmml">P</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.9.m9.1b"><apply id="S3.SS1.p1.9.m9.1.1.cmml" xref="S3.SS1.p1.9.m9.1.1"><times id="S3.SS1.p1.9.m9.1.1.1.cmml" xref="S3.SS1.p1.9.m9.1.1.1"></times><ci id="S3.SS1.p1.9.m9.1.1.2.cmml" xref="S3.SS1.p1.9.m9.1.1.2">𝑐</ci><ci id="S3.SS1.p1.9.m9.1.1.3.cmml" xref="S3.SS1.p1.9.m9.1.1.3">𝑢</ci><apply id="S3.SS1.p1.9.m9.1.1.4.cmml" xref="S3.SS1.p1.9.m9.1.1.4"><csymbol cd="ambiguous" id="S3.SS1.p1.9.m9.1.1.4.1.cmml" xref="S3.SS1.p1.9.m9.1.1.4">subscript</csymbol><ci id="S3.SS1.p1.9.m9.1.1.4.2.cmml" xref="S3.SS1.p1.9.m9.1.1.4.2">𝑟</ci><ci id="S3.SS1.p1.9.m9.1.1.4.3.cmml" xref="S3.SS1.p1.9.m9.1.1.4.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.9.m9.1c">cur_{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.9.m9.1d">italic_c italic_u italic_r start_POSTSUBSCRIPT italic_P end_POSTSUBSCRIPT</annotation></semantics></math> and locate the memory block logically without any real extra memory allocation.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.3.1.1">Algorithm 2</span> </span> Memory Block Based Dynamic Vector <span class="ltx_text ltx_font_bold" id="alg2.4.2">Insertion</span></figcaption>
<div class="ltx_listing ltx_listing" id="alg2.5">
<div class="ltx_listingline" id="alg2.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0.1.1.1" style="font-size:80%;">0:</span></span>  offline vectors <math alttext="x_{i}\in X" class="ltx_Math" display="inline" id="alg2.l0.m1.1"><semantics id="alg2.l0.m1.1a"><mrow id="alg2.l0.m1.1.1" xref="alg2.l0.m1.1.1.cmml"><msub id="alg2.l0.m1.1.1.2" xref="alg2.l0.m1.1.1.2.cmml"><mi id="alg2.l0.m1.1.1.2.2" xref="alg2.l0.m1.1.1.2.2.cmml">x</mi><mi id="alg2.l0.m1.1.1.2.3" xref="alg2.l0.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg2.l0.m1.1.1.1" xref="alg2.l0.m1.1.1.1.cmml">∈</mo><mi id="alg2.l0.m1.1.1.3" xref="alg2.l0.m1.1.1.3.cmml">X</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0.m1.1b"><apply id="alg2.l0.m1.1.1.cmml" xref="alg2.l0.m1.1.1"><in id="alg2.l0.m1.1.1.1.cmml" xref="alg2.l0.m1.1.1.1"></in><apply id="alg2.l0.m1.1.1.2.cmml" xref="alg2.l0.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l0.m1.1.1.2.1.cmml" xref="alg2.l0.m1.1.1.2">subscript</csymbol><ci id="alg2.l0.m1.1.1.2.2.cmml" xref="alg2.l0.m1.1.1.2.2">𝑥</ci><ci id="alg2.l0.m1.1.1.2.3.cmml" xref="alg2.l0.m1.1.1.2.3">𝑖</ci></apply><ci id="alg2.l0.m1.1.1.3.cmml" xref="alg2.l0.m1.1.1.3">𝑋</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m1.1c">x_{i}\in X</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X</annotation></semantics></math>, new coming online vectors <math alttext="y_{i}\in Y" class="ltx_Math" display="inline" id="alg2.l0.m2.1"><semantics id="alg2.l0.m2.1a"><mrow id="alg2.l0.m2.1.1" xref="alg2.l0.m2.1.1.cmml"><msub id="alg2.l0.m2.1.1.2" xref="alg2.l0.m2.1.1.2.cmml"><mi id="alg2.l0.m2.1.1.2.2" xref="alg2.l0.m2.1.1.2.2.cmml">y</mi><mi id="alg2.l0.m2.1.1.2.3" xref="alg2.l0.m2.1.1.2.3.cmml">i</mi></msub><mo id="alg2.l0.m2.1.1.1" xref="alg2.l0.m2.1.1.1.cmml">∈</mo><mi id="alg2.l0.m2.1.1.3" xref="alg2.l0.m2.1.1.3.cmml">Y</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0.m2.1b"><apply id="alg2.l0.m2.1.1.cmml" xref="alg2.l0.m2.1.1"><in id="alg2.l0.m2.1.1.1.cmml" xref="alg2.l0.m2.1.1.1"></in><apply id="alg2.l0.m2.1.1.2.cmml" xref="alg2.l0.m2.1.1.2"><csymbol cd="ambiguous" id="alg2.l0.m2.1.1.2.1.cmml" xref="alg2.l0.m2.1.1.2">subscript</csymbol><ci id="alg2.l0.m2.1.1.2.2.cmml" xref="alg2.l0.m2.1.1.2.2">𝑦</ci><ci id="alg2.l0.m2.1.1.2.3.cmml" xref="alg2.l0.m2.1.1.2.3">𝑖</ci></apply><ci id="alg2.l0.m2.1.1.3.cmml" xref="alg2.l0.m2.1.1.3">𝑌</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m2.1c">y_{i}\in Y</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m2.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_Y</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0a.1.1.1" style="font-size:80%;">0:</span></span>  vector id lists num <math alttext="nl\in NL" class="ltx_Math" display="inline" id="alg2.l0a.m1.1"><semantics id="alg2.l0a.m1.1a"><mrow id="alg2.l0a.m1.1.1" xref="alg2.l0a.m1.1.1.cmml"><mrow id="alg2.l0a.m1.1.1.2" xref="alg2.l0a.m1.1.1.2.cmml"><mi id="alg2.l0a.m1.1.1.2.2" xref="alg2.l0a.m1.1.1.2.2.cmml">n</mi><mo id="alg2.l0a.m1.1.1.2.1" xref="alg2.l0a.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l0a.m1.1.1.2.3" xref="alg2.l0a.m1.1.1.2.3.cmml">l</mi></mrow><mo id="alg2.l0a.m1.1.1.1" xref="alg2.l0a.m1.1.1.1.cmml">∈</mo><mrow id="alg2.l0a.m1.1.1.3" xref="alg2.l0a.m1.1.1.3.cmml"><mi id="alg2.l0a.m1.1.1.3.2" xref="alg2.l0a.m1.1.1.3.2.cmml">N</mi><mo id="alg2.l0a.m1.1.1.3.1" xref="alg2.l0a.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l0a.m1.1.1.3.3" xref="alg2.l0a.m1.1.1.3.3.cmml">L</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0a.m1.1b"><apply id="alg2.l0a.m1.1.1.cmml" xref="alg2.l0a.m1.1.1"><in id="alg2.l0a.m1.1.1.1.cmml" xref="alg2.l0a.m1.1.1.1"></in><apply id="alg2.l0a.m1.1.1.2.cmml" xref="alg2.l0a.m1.1.1.2"><times id="alg2.l0a.m1.1.1.2.1.cmml" xref="alg2.l0a.m1.1.1.2.1"></times><ci id="alg2.l0a.m1.1.1.2.2.cmml" xref="alg2.l0a.m1.1.1.2.2">𝑛</ci><ci id="alg2.l0a.m1.1.1.2.3.cmml" xref="alg2.l0a.m1.1.1.2.3">𝑙</ci></apply><apply id="alg2.l0a.m1.1.1.3.cmml" xref="alg2.l0a.m1.1.1.3"><times id="alg2.l0a.m1.1.1.3.1.cmml" xref="alg2.l0a.m1.1.1.3.1"></times><ci id="alg2.l0a.m1.1.1.3.2.cmml" xref="alg2.l0a.m1.1.1.3.2">𝑁</ci><ci id="alg2.l0a.m1.1.1.3.3.cmml" xref="alg2.l0a.m1.1.1.3.3">𝐿</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m1.1c">nl\in NL</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m1.1d">italic_n italic_l ∈ italic_N italic_L</annotation></semantics></math>, corresponding cluster <math alttext="c\in C" class="ltx_Math" display="inline" id="alg2.l0a.m2.1"><semantics id="alg2.l0a.m2.1a"><mrow id="alg2.l0a.m2.1.1" xref="alg2.l0a.m2.1.1.cmml"><mi id="alg2.l0a.m2.1.1.2" xref="alg2.l0a.m2.1.1.2.cmml">c</mi><mo id="alg2.l0a.m2.1.1.1" xref="alg2.l0a.m2.1.1.1.cmml">∈</mo><mi id="alg2.l0a.m2.1.1.3" xref="alg2.l0a.m2.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0a.m2.1b"><apply id="alg2.l0a.m2.1.1.cmml" xref="alg2.l0a.m2.1.1"><in id="alg2.l0a.m2.1.1.1.cmml" xref="alg2.l0a.m2.1.1.1"></in><ci id="alg2.l0a.m2.1.1.2.cmml" xref="alg2.l0a.m2.1.1.2">𝑐</ci><ci id="alg2.l0a.m2.1.1.3.cmml" xref="alg2.l0a.m2.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m2.1c">c\in C</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m2.1d">italic_c ∈ italic_C</annotation></semantics></math>, number of clusters <math alttext="N" class="ltx_Math" display="inline" id="alg2.l0a.m3.1"><semantics id="alg2.l0a.m3.1a"><mi id="alg2.l0a.m3.1.1" xref="alg2.l0a.m3.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="alg2.l0a.m3.1b"><ci id="alg2.l0a.m3.1.1.cmml" xref="alg2.l0a.m3.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m3.1c">N</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m3.1d">italic_N</annotation></semantics></math>, <math alttext="C" class="ltx_Math" display="inline" id="alg2.l0a.m4.1"><semantics id="alg2.l0a.m4.1a"><mi id="alg2.l0a.m4.1.1" xref="alg2.l0a.m4.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="alg2.l0a.m4.1b"><ci id="alg2.l0a.m4.1.1.cmml" xref="alg2.l0a.m4.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m4.1c">C</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m4.1d">italic_C</annotation></semantics></math> is generated by Kmeans(<math alttext="X,N" class="ltx_Math" display="inline" id="alg2.l0a.m5.2"><semantics id="alg2.l0a.m5.2a"><mrow id="alg2.l0a.m5.2.3.2" xref="alg2.l0a.m5.2.3.1.cmml"><mi id="alg2.l0a.m5.1.1" xref="alg2.l0a.m5.1.1.cmml">X</mi><mo id="alg2.l0a.m5.2.3.2.1" xref="alg2.l0a.m5.2.3.1.cmml">,</mo><mi id="alg2.l0a.m5.2.2" xref="alg2.l0a.m5.2.2.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0a.m5.2b"><list id="alg2.l0a.m5.2.3.1.cmml" xref="alg2.l0a.m5.2.3.2"><ci id="alg2.l0a.m5.1.1.cmml" xref="alg2.l0a.m5.1.1">𝑋</ci><ci id="alg2.l0a.m5.2.2.cmml" xref="alg2.l0a.m5.2.2">𝑁</ci></list></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0a.m5.2c">X,N</annotation><annotation encoding="application/x-llamapun" id="alg2.l0a.m5.2d">italic_X , italic_N</annotation></semantics></math>)

</div>
<div class="ltx_listingline" id="alg2.l0b">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0b.1.1.1" style="font-size:80%;">0:</span></span>  memory block <math alttext="m\in M" class="ltx_Math" display="inline" id="alg2.l0b.m1.1"><semantics id="alg2.l0b.m1.1a"><mrow id="alg2.l0b.m1.1.1" xref="alg2.l0b.m1.1.1.cmml"><mi id="alg2.l0b.m1.1.1.2" xref="alg2.l0b.m1.1.1.2.cmml">m</mi><mo id="alg2.l0b.m1.1.1.1" xref="alg2.l0b.m1.1.1.1.cmml">∈</mo><mi id="alg2.l0b.m1.1.1.3" xref="alg2.l0b.m1.1.1.3.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0b.m1.1b"><apply id="alg2.l0b.m1.1.1.cmml" xref="alg2.l0b.m1.1.1"><in id="alg2.l0b.m1.1.1.1.cmml" xref="alg2.l0b.m1.1.1.1"></in><ci id="alg2.l0b.m1.1.1.2.cmml" xref="alg2.l0b.m1.1.1.2">𝑚</ci><ci id="alg2.l0b.m1.1.1.3.cmml" xref="alg2.l0b.m1.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0b.m1.1c">m\in M</annotation><annotation encoding="application/x-llamapun" id="alg2.l0b.m1.1d">italic_m ∈ italic_M</annotation></semantics></math>, memory block list <math alttext="m^{\prime}\in M^{\prime}" class="ltx_Math" display="inline" id="alg2.l0b.m2.1"><semantics id="alg2.l0b.m2.1a"><mrow id="alg2.l0b.m2.1.1" xref="alg2.l0b.m2.1.1.cmml"><msup id="alg2.l0b.m2.1.1.2" xref="alg2.l0b.m2.1.1.2.cmml"><mi id="alg2.l0b.m2.1.1.2.2" xref="alg2.l0b.m2.1.1.2.2.cmml">m</mi><mo id="alg2.l0b.m2.1.1.2.3" xref="alg2.l0b.m2.1.1.2.3.cmml">′</mo></msup><mo id="alg2.l0b.m2.1.1.1" xref="alg2.l0b.m2.1.1.1.cmml">∈</mo><msup id="alg2.l0b.m2.1.1.3" xref="alg2.l0b.m2.1.1.3.cmml"><mi id="alg2.l0b.m2.1.1.3.2" xref="alg2.l0b.m2.1.1.3.2.cmml">M</mi><mo id="alg2.l0b.m2.1.1.3.3" xref="alg2.l0b.m2.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0b.m2.1b"><apply id="alg2.l0b.m2.1.1.cmml" xref="alg2.l0b.m2.1.1"><in id="alg2.l0b.m2.1.1.1.cmml" xref="alg2.l0b.m2.1.1.1"></in><apply id="alg2.l0b.m2.1.1.2.cmml" xref="alg2.l0b.m2.1.1.2"><csymbol cd="ambiguous" id="alg2.l0b.m2.1.1.2.1.cmml" xref="alg2.l0b.m2.1.1.2">superscript</csymbol><ci id="alg2.l0b.m2.1.1.2.2.cmml" xref="alg2.l0b.m2.1.1.2.2">𝑚</ci><ci id="alg2.l0b.m2.1.1.2.3.cmml" xref="alg2.l0b.m2.1.1.2.3">′</ci></apply><apply id="alg2.l0b.m2.1.1.3.cmml" xref="alg2.l0b.m2.1.1.3"><csymbol cd="ambiguous" id="alg2.l0b.m2.1.1.3.1.cmml" xref="alg2.l0b.m2.1.1.3">superscript</csymbol><ci id="alg2.l0b.m2.1.1.3.2.cmml" xref="alg2.l0b.m2.1.1.3.2">𝑀</ci><ci id="alg2.l0b.m2.1.1.3.3.cmml" xref="alg2.l0b.m2.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0b.m2.1c">m^{\prime}\in M^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0b.m2.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ italic_M start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l0c">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0c.1.1.1" style="font-size:80%;">0:</span></span>  central memory pool <math alttext="P" class="ltx_Math" display="inline" id="alg2.l0c.m1.1"><semantics id="alg2.l0c.m1.1a"><mi id="alg2.l0c.m1.1.1" xref="alg2.l0c.m1.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="alg2.l0c.m1.1b"><ci id="alg2.l0c.m1.1.1.cmml" xref="alg2.l0c.m1.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0c.m1.1c">P</annotation><annotation encoding="application/x-llamapun" id="alg2.l0c.m1.1d">italic_P</annotation></semantics></math>, latest allocated memory block position <math alttext="cur_{P}" class="ltx_Math" display="inline" id="alg2.l0c.m2.1"><semantics id="alg2.l0c.m2.1a"><mrow id="alg2.l0c.m2.1.1" xref="alg2.l0c.m2.1.1.cmml"><mi id="alg2.l0c.m2.1.1.2" xref="alg2.l0c.m2.1.1.2.cmml">c</mi><mo id="alg2.l0c.m2.1.1.1" xref="alg2.l0c.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l0c.m2.1.1.3" xref="alg2.l0c.m2.1.1.3.cmml">u</mi><mo id="alg2.l0c.m2.1.1.1a" xref="alg2.l0c.m2.1.1.1.cmml">⁢</mo><msub id="alg2.l0c.m2.1.1.4" xref="alg2.l0c.m2.1.1.4.cmml"><mi id="alg2.l0c.m2.1.1.4.2" xref="alg2.l0c.m2.1.1.4.2.cmml">r</mi><mi id="alg2.l0c.m2.1.1.4.3" xref="alg2.l0c.m2.1.1.4.3.cmml">P</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0c.m2.1b"><apply id="alg2.l0c.m2.1.1.cmml" xref="alg2.l0c.m2.1.1"><times id="alg2.l0c.m2.1.1.1.cmml" xref="alg2.l0c.m2.1.1.1"></times><ci id="alg2.l0c.m2.1.1.2.cmml" xref="alg2.l0c.m2.1.1.2">𝑐</ci><ci id="alg2.l0c.m2.1.1.3.cmml" xref="alg2.l0c.m2.1.1.3">𝑢</ci><apply id="alg2.l0c.m2.1.1.4.cmml" xref="alg2.l0c.m2.1.1.4"><csymbol cd="ambiguous" id="alg2.l0c.m2.1.1.4.1.cmml" xref="alg2.l0c.m2.1.1.4">subscript</csymbol><ci id="alg2.l0c.m2.1.1.4.2.cmml" xref="alg2.l0c.m2.1.1.4.2">𝑟</ci><ci id="alg2.l0c.m2.1.1.4.3.cmml" xref="alg2.l0c.m2.1.1.4.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0c.m2.1c">cur_{P}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0c.m2.1d">italic_c italic_u italic_r start_POSTSUBSCRIPT italic_P end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l1.1.1.1" style="font-size:80%;">1:</span></span>  <math alttext="gid=\sum_{nl}nl,\forall nl\in NL" class="ltx_Math" display="inline" id="alg2.l1.m1.2"><semantics id="alg2.l1.m1.2a"><mrow id="alg2.l1.m1.2.2.2" xref="alg2.l1.m1.2.2.3.cmml"><mrow id="alg2.l1.m1.1.1.1.1" xref="alg2.l1.m1.1.1.1.1.cmml"><mrow id="alg2.l1.m1.1.1.1.1.2" xref="alg2.l1.m1.1.1.1.1.2.cmml"><mi id="alg2.l1.m1.1.1.1.1.2.2" xref="alg2.l1.m1.1.1.1.1.2.2.cmml">g</mi><mo id="alg2.l1.m1.1.1.1.1.2.1" xref="alg2.l1.m1.1.1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.1.1.2.3" xref="alg2.l1.m1.1.1.1.1.2.3.cmml">i</mi><mo id="alg2.l1.m1.1.1.1.1.2.1a" xref="alg2.l1.m1.1.1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.1.1.2.4" xref="alg2.l1.m1.1.1.1.1.2.4.cmml">d</mi></mrow><mo id="alg2.l1.m1.1.1.1.1.1" rspace="0.111em" xref="alg2.l1.m1.1.1.1.1.1.cmml">=</mo><mrow id="alg2.l1.m1.1.1.1.1.3" xref="alg2.l1.m1.1.1.1.1.3.cmml"><msub id="alg2.l1.m1.1.1.1.1.3.1" xref="alg2.l1.m1.1.1.1.1.3.1.cmml"><mo id="alg2.l1.m1.1.1.1.1.3.1.2" xref="alg2.l1.m1.1.1.1.1.3.1.2.cmml">∑</mo><mrow id="alg2.l1.m1.1.1.1.1.3.1.3" xref="alg2.l1.m1.1.1.1.1.3.1.3.cmml"><mi id="alg2.l1.m1.1.1.1.1.3.1.3.2" xref="alg2.l1.m1.1.1.1.1.3.1.3.2.cmml">n</mi><mo id="alg2.l1.m1.1.1.1.1.3.1.3.1" xref="alg2.l1.m1.1.1.1.1.3.1.3.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.1.1.3.1.3.3" xref="alg2.l1.m1.1.1.1.1.3.1.3.3.cmml">l</mi></mrow></msub><mrow id="alg2.l1.m1.1.1.1.1.3.2" xref="alg2.l1.m1.1.1.1.1.3.2.cmml"><mi id="alg2.l1.m1.1.1.1.1.3.2.2" xref="alg2.l1.m1.1.1.1.1.3.2.2.cmml">n</mi><mo id="alg2.l1.m1.1.1.1.1.3.2.1" xref="alg2.l1.m1.1.1.1.1.3.2.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.1.1.3.2.3" xref="alg2.l1.m1.1.1.1.1.3.2.3.cmml">l</mi></mrow></mrow></mrow><mo id="alg2.l1.m1.2.2.2.3" xref="alg2.l1.m1.2.2.3a.cmml">,</mo><mrow id="alg2.l1.m1.2.2.2.2" xref="alg2.l1.m1.2.2.2.2.cmml"><mrow id="alg2.l1.m1.2.2.2.2.2" xref="alg2.l1.m1.2.2.2.2.2.cmml"><mo id="alg2.l1.m1.2.2.2.2.2.1" rspace="0.167em" xref="alg2.l1.m1.2.2.2.2.2.1.cmml">∀</mo><mrow id="alg2.l1.m1.2.2.2.2.2.2" xref="alg2.l1.m1.2.2.2.2.2.2.cmml"><mi id="alg2.l1.m1.2.2.2.2.2.2.2" xref="alg2.l1.m1.2.2.2.2.2.2.2.cmml">n</mi><mo id="alg2.l1.m1.2.2.2.2.2.2.1" xref="alg2.l1.m1.2.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg2.l1.m1.2.2.2.2.2.2.3" xref="alg2.l1.m1.2.2.2.2.2.2.3.cmml">l</mi></mrow></mrow><mo id="alg2.l1.m1.2.2.2.2.1" xref="alg2.l1.m1.2.2.2.2.1.cmml">∈</mo><mrow id="alg2.l1.m1.2.2.2.2.3" xref="alg2.l1.m1.2.2.2.2.3.cmml"><mi id="alg2.l1.m1.2.2.2.2.3.2" xref="alg2.l1.m1.2.2.2.2.3.2.cmml">N</mi><mo id="alg2.l1.m1.2.2.2.2.3.1" xref="alg2.l1.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l1.m1.2.2.2.2.3.3" xref="alg2.l1.m1.2.2.2.2.3.3.cmml">L</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l1.m1.2b"><apply id="alg2.l1.m1.2.2.3.cmml" xref="alg2.l1.m1.2.2.2"><csymbol cd="ambiguous" id="alg2.l1.m1.2.2.3a.cmml" xref="alg2.l1.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg2.l1.m1.1.1.1.1.cmml" xref="alg2.l1.m1.1.1.1.1"><eq id="alg2.l1.m1.1.1.1.1.1.cmml" xref="alg2.l1.m1.1.1.1.1.1"></eq><apply id="alg2.l1.m1.1.1.1.1.2.cmml" xref="alg2.l1.m1.1.1.1.1.2"><times id="alg2.l1.m1.1.1.1.1.2.1.cmml" xref="alg2.l1.m1.1.1.1.1.2.1"></times><ci id="alg2.l1.m1.1.1.1.1.2.2.cmml" xref="alg2.l1.m1.1.1.1.1.2.2">𝑔</ci><ci id="alg2.l1.m1.1.1.1.1.2.3.cmml" xref="alg2.l1.m1.1.1.1.1.2.3">𝑖</ci><ci id="alg2.l1.m1.1.1.1.1.2.4.cmml" xref="alg2.l1.m1.1.1.1.1.2.4">𝑑</ci></apply><apply id="alg2.l1.m1.1.1.1.1.3.cmml" xref="alg2.l1.m1.1.1.1.1.3"><apply id="alg2.l1.m1.1.1.1.1.3.1.cmml" xref="alg2.l1.m1.1.1.1.1.3.1"><csymbol cd="ambiguous" id="alg2.l1.m1.1.1.1.1.3.1.1.cmml" xref="alg2.l1.m1.1.1.1.1.3.1">subscript</csymbol><sum id="alg2.l1.m1.1.1.1.1.3.1.2.cmml" xref="alg2.l1.m1.1.1.1.1.3.1.2"></sum><apply id="alg2.l1.m1.1.1.1.1.3.1.3.cmml" xref="alg2.l1.m1.1.1.1.1.3.1.3"><times id="alg2.l1.m1.1.1.1.1.3.1.3.1.cmml" xref="alg2.l1.m1.1.1.1.1.3.1.3.1"></times><ci id="alg2.l1.m1.1.1.1.1.3.1.3.2.cmml" xref="alg2.l1.m1.1.1.1.1.3.1.3.2">𝑛</ci><ci id="alg2.l1.m1.1.1.1.1.3.1.3.3.cmml" xref="alg2.l1.m1.1.1.1.1.3.1.3.3">𝑙</ci></apply></apply><apply id="alg2.l1.m1.1.1.1.1.3.2.cmml" xref="alg2.l1.m1.1.1.1.1.3.2"><times id="alg2.l1.m1.1.1.1.1.3.2.1.cmml" xref="alg2.l1.m1.1.1.1.1.3.2.1"></times><ci id="alg2.l1.m1.1.1.1.1.3.2.2.cmml" xref="alg2.l1.m1.1.1.1.1.3.2.2">𝑛</ci><ci id="alg2.l1.m1.1.1.1.1.3.2.3.cmml" xref="alg2.l1.m1.1.1.1.1.3.2.3">𝑙</ci></apply></apply></apply><apply id="alg2.l1.m1.2.2.2.2.cmml" xref="alg2.l1.m1.2.2.2.2"><in id="alg2.l1.m1.2.2.2.2.1.cmml" xref="alg2.l1.m1.2.2.2.2.1"></in><apply id="alg2.l1.m1.2.2.2.2.2.cmml" xref="alg2.l1.m1.2.2.2.2.2"><csymbol cd="latexml" id="alg2.l1.m1.2.2.2.2.2.1.cmml" xref="alg2.l1.m1.2.2.2.2.2.1">for-all</csymbol><apply id="alg2.l1.m1.2.2.2.2.2.2.cmml" xref="alg2.l1.m1.2.2.2.2.2.2"><times id="alg2.l1.m1.2.2.2.2.2.2.1.cmml" xref="alg2.l1.m1.2.2.2.2.2.2.1"></times><ci id="alg2.l1.m1.2.2.2.2.2.2.2.cmml" xref="alg2.l1.m1.2.2.2.2.2.2.2">𝑛</ci><ci id="alg2.l1.m1.2.2.2.2.2.2.3.cmml" xref="alg2.l1.m1.2.2.2.2.2.2.3">𝑙</ci></apply></apply><apply id="alg2.l1.m1.2.2.2.2.3.cmml" xref="alg2.l1.m1.2.2.2.2.3"><times id="alg2.l1.m1.2.2.2.2.3.1.cmml" xref="alg2.l1.m1.2.2.2.2.3.1"></times><ci id="alg2.l1.m1.2.2.2.2.3.2.cmml" xref="alg2.l1.m1.2.2.2.2.3.2">𝑁</ci><ci id="alg2.l1.m1.2.2.2.2.3.3.cmml" xref="alg2.l1.m1.2.2.2.2.3.3">𝐿</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m1.2c">gid=\sum_{nl}nl,\forall nl\in NL</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m1.2d">italic_g italic_i italic_d = ∑ start_POSTSUBSCRIPT italic_n italic_l end_POSTSUBSCRIPT italic_n italic_l , ∀ italic_n italic_l ∈ italic_N italic_L</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l2.1.1.1" style="font-size:80%;">2:</span></span>  // Insertion

</div>
<div class="ltx_listingline" id="alg2.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3.1.1.1" style="font-size:80%;">3:</span></span>  // GPU Multi Thread Execution, parallel by <math alttext="y_{i}" class="ltx_Math" display="inline" id="alg2.l3.m1.1"><semantics id="alg2.l3.m1.1a"><msub id="alg2.l3.m1.1.1" xref="alg2.l3.m1.1.1.cmml"><mi id="alg2.l3.m1.1.1.2" xref="alg2.l3.m1.1.1.2.cmml">y</mi><mi id="alg2.l3.m1.1.1.3" xref="alg2.l3.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.l3.m1.1b"><apply id="alg2.l3.m1.1.1.cmml" xref="alg2.l3.m1.1.1"><csymbol cd="ambiguous" id="alg2.l3.m1.1.1.1.cmml" xref="alg2.l3.m1.1.1">subscript</csymbol><ci id="alg2.l3.m1.1.1.2.cmml" xref="alg2.l3.m1.1.1.2">𝑦</ci><ci id="alg2.l3.m1.1.1.3.cmml" xref="alg2.l3.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3.m1.1c">y_{i}</annotation><annotation encoding="application/x-llamapun" id="alg2.l3.m1.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l4.1.1.1" style="font-size:80%;">4:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l4.2">for</span> <math alttext="i" class="ltx_Math" display="inline" id="alg2.l4.m1.1"><semantics id="alg2.l4.m1.1a"><mi id="alg2.l4.m1.1.1" xref="alg2.l4.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="alg2.l4.m1.1b"><ci id="alg2.l4.m1.1.1.cmml" xref="alg2.l4.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="alg2.l4.m1.1d">italic_i</annotation></semantics></math> from <math alttext="0" class="ltx_Math" display="inline" id="alg2.l4.m2.1"><semantics id="alg2.l4.m2.1a"><mn id="alg2.l4.m2.1.1" xref="alg2.l4.m2.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="alg2.l4.m2.1b"><cn id="alg2.l4.m2.1.1.cmml" type="integer" xref="alg2.l4.m2.1.1">0</cn></annotation-xml></semantics></math> to <math alttext="|Y|-1" class="ltx_Math" display="inline" id="alg2.l4.m3.1"><semantics id="alg2.l4.m3.1a"><mrow id="alg2.l4.m3.1.2" xref="alg2.l4.m3.1.2.cmml"><mrow id="alg2.l4.m3.1.2.2.2" xref="alg2.l4.m3.1.2.2.1.cmml"><mo id="alg2.l4.m3.1.2.2.2.1" stretchy="false" xref="alg2.l4.m3.1.2.2.1.1.cmml">|</mo><mi id="alg2.l4.m3.1.1" xref="alg2.l4.m3.1.1.cmml">Y</mi><mo id="alg2.l4.m3.1.2.2.2.2" stretchy="false" xref="alg2.l4.m3.1.2.2.1.1.cmml">|</mo></mrow><mo id="alg2.l4.m3.1.2.1" xref="alg2.l4.m3.1.2.1.cmml">−</mo><mn id="alg2.l4.m3.1.2.3" xref="alg2.l4.m3.1.2.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg2.l4.m3.1b"><apply id="alg2.l4.m3.1.2.cmml" xref="alg2.l4.m3.1.2"><minus id="alg2.l4.m3.1.2.1.cmml" xref="alg2.l4.m3.1.2.1"></minus><apply id="alg2.l4.m3.1.2.2.1.cmml" xref="alg2.l4.m3.1.2.2.2"><abs id="alg2.l4.m3.1.2.2.1.1.cmml" xref="alg2.l4.m3.1.2.2.2.1"></abs><ci id="alg2.l4.m3.1.1.cmml" xref="alg2.l4.m3.1.1">𝑌</ci></apply><cn id="alg2.l4.m3.1.2.3.cmml" type="integer" xref="alg2.l4.m3.1.2.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l4.m3.1c">|Y|-1</annotation><annotation encoding="application/x-llamapun" id="alg2.l4.m3.1d">| italic_Y | - 1</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l4.3">do</span>
</div>
<div class="ltx_listingline" id="alg2.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l5.1.1.1" style="font-size:80%;">5:</span></span>     <math alttext="k\leftarrow\min(c,y_{i})" class="ltx_Math" display="inline" id="alg2.l5.m1.3"><semantics id="alg2.l5.m1.3a"><mrow id="alg2.l5.m1.3.3" xref="alg2.l5.m1.3.3.cmml"><mi id="alg2.l5.m1.3.3.3" xref="alg2.l5.m1.3.3.3.cmml">k</mi><mo id="alg2.l5.m1.3.3.2" stretchy="false" xref="alg2.l5.m1.3.3.2.cmml">←</mo><mrow id="alg2.l5.m1.3.3.1.1" xref="alg2.l5.m1.3.3.1.2.cmml"><mi id="alg2.l5.m1.1.1" xref="alg2.l5.m1.1.1.cmml">min</mi><mo id="alg2.l5.m1.3.3.1.1a" xref="alg2.l5.m1.3.3.1.2.cmml">⁡</mo><mrow id="alg2.l5.m1.3.3.1.1.1" xref="alg2.l5.m1.3.3.1.2.cmml"><mo id="alg2.l5.m1.3.3.1.1.1.2" stretchy="false" xref="alg2.l5.m1.3.3.1.2.cmml">(</mo><mi id="alg2.l5.m1.2.2" xref="alg2.l5.m1.2.2.cmml">c</mi><mo id="alg2.l5.m1.3.3.1.1.1.3" xref="alg2.l5.m1.3.3.1.2.cmml">,</mo><msub id="alg2.l5.m1.3.3.1.1.1.1" xref="alg2.l5.m1.3.3.1.1.1.1.cmml"><mi id="alg2.l5.m1.3.3.1.1.1.1.2" xref="alg2.l5.m1.3.3.1.1.1.1.2.cmml">y</mi><mi id="alg2.l5.m1.3.3.1.1.1.1.3" xref="alg2.l5.m1.3.3.1.1.1.1.3.cmml">i</mi></msub><mo id="alg2.l5.m1.3.3.1.1.1.4" stretchy="false" xref="alg2.l5.m1.3.3.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m1.3b"><apply id="alg2.l5.m1.3.3.cmml" xref="alg2.l5.m1.3.3"><ci id="alg2.l5.m1.3.3.2.cmml" xref="alg2.l5.m1.3.3.2">←</ci><ci id="alg2.l5.m1.3.3.3.cmml" xref="alg2.l5.m1.3.3.3">𝑘</ci><apply id="alg2.l5.m1.3.3.1.2.cmml" xref="alg2.l5.m1.3.3.1.1"><min id="alg2.l5.m1.1.1.cmml" xref="alg2.l5.m1.1.1"></min><ci id="alg2.l5.m1.2.2.cmml" xref="alg2.l5.m1.2.2">𝑐</ci><apply id="alg2.l5.m1.3.3.1.1.1.1.cmml" xref="alg2.l5.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l5.m1.3.3.1.1.1.1.1.cmml" xref="alg2.l5.m1.3.3.1.1.1.1">subscript</csymbol><ci id="alg2.l5.m1.3.3.1.1.1.1.2.cmml" xref="alg2.l5.m1.3.3.1.1.1.1.2">𝑦</ci><ci id="alg2.l5.m1.3.3.1.1.1.1.3.cmml" xref="alg2.l5.m1.3.3.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m1.3c">k\leftarrow\min(c,y_{i})</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m1.3d">italic_k ← roman_min ( italic_c , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> , <math alttext="\forall c\in C" class="ltx_Math" display="inline" id="alg2.l5.m2.1"><semantics id="alg2.l5.m2.1a"><mrow id="alg2.l5.m2.1.1" xref="alg2.l5.m2.1.1.cmml"><mrow id="alg2.l5.m2.1.1.2" xref="alg2.l5.m2.1.1.2.cmml"><mo id="alg2.l5.m2.1.1.2.1" rspace="0.167em" xref="alg2.l5.m2.1.1.2.1.cmml">∀</mo><mi id="alg2.l5.m2.1.1.2.2" xref="alg2.l5.m2.1.1.2.2.cmml">c</mi></mrow><mo id="alg2.l5.m2.1.1.1" xref="alg2.l5.m2.1.1.1.cmml">∈</mo><mi id="alg2.l5.m2.1.1.3" xref="alg2.l5.m2.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m2.1b"><apply id="alg2.l5.m2.1.1.cmml" xref="alg2.l5.m2.1.1"><in id="alg2.l5.m2.1.1.1.cmml" xref="alg2.l5.m2.1.1.1"></in><apply id="alg2.l5.m2.1.1.2.cmml" xref="alg2.l5.m2.1.1.2"><csymbol cd="latexml" id="alg2.l5.m2.1.1.2.1.cmml" xref="alg2.l5.m2.1.1.2.1">for-all</csymbol><ci id="alg2.l5.m2.1.1.2.2.cmml" xref="alg2.l5.m2.1.1.2.2">𝑐</ci></apply><ci id="alg2.l5.m2.1.1.3.cmml" xref="alg2.l5.m2.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m2.1c">\forall c\in C</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m2.1d">∀ italic_c ∈ italic_C</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l6.1.1.1" style="font-size:80%;">6:</span></span>     <math alttext="did=atomicAdd(nl_{k},1)" class="ltx_Math" display="inline" id="alg2.l6.m1.2"><semantics id="alg2.l6.m1.2a"><mrow id="alg2.l6.m1.2.2" xref="alg2.l6.m1.2.2.cmml"><mrow id="alg2.l6.m1.2.2.3" xref="alg2.l6.m1.2.2.3.cmml"><mi id="alg2.l6.m1.2.2.3.2" xref="alg2.l6.m1.2.2.3.2.cmml">d</mi><mo id="alg2.l6.m1.2.2.3.1" xref="alg2.l6.m1.2.2.3.1.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.3.3" xref="alg2.l6.m1.2.2.3.3.cmml">i</mi><mo id="alg2.l6.m1.2.2.3.1a" xref="alg2.l6.m1.2.2.3.1.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.3.4" xref="alg2.l6.m1.2.2.3.4.cmml">d</mi></mrow><mo id="alg2.l6.m1.2.2.2" xref="alg2.l6.m1.2.2.2.cmml">=</mo><mrow id="alg2.l6.m1.2.2.1" xref="alg2.l6.m1.2.2.1.cmml"><mi id="alg2.l6.m1.2.2.1.3" xref="alg2.l6.m1.2.2.1.3.cmml">a</mi><mo id="alg2.l6.m1.2.2.1.2" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.4" xref="alg2.l6.m1.2.2.1.4.cmml">t</mi><mo id="alg2.l6.m1.2.2.1.2a" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.5" xref="alg2.l6.m1.2.2.1.5.cmml">o</mi><mo id="alg2.l6.m1.2.2.1.2b" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.6" xref="alg2.l6.m1.2.2.1.6.cmml">m</mi><mo id="alg2.l6.m1.2.2.1.2c" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.7" xref="alg2.l6.m1.2.2.1.7.cmml">i</mi><mo id="alg2.l6.m1.2.2.1.2d" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.8" xref="alg2.l6.m1.2.2.1.8.cmml">c</mi><mo id="alg2.l6.m1.2.2.1.2e" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.9" xref="alg2.l6.m1.2.2.1.9.cmml">A</mi><mo id="alg2.l6.m1.2.2.1.2f" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.10" xref="alg2.l6.m1.2.2.1.10.cmml">d</mi><mo id="alg2.l6.m1.2.2.1.2g" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mi id="alg2.l6.m1.2.2.1.11" xref="alg2.l6.m1.2.2.1.11.cmml">d</mi><mo id="alg2.l6.m1.2.2.1.2h" xref="alg2.l6.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg2.l6.m1.2.2.1.1.1" xref="alg2.l6.m1.2.2.1.1.2.cmml"><mo id="alg2.l6.m1.2.2.1.1.1.2" stretchy="false" xref="alg2.l6.m1.2.2.1.1.2.cmml">(</mo><mrow id="alg2.l6.m1.2.2.1.1.1.1" xref="alg2.l6.m1.2.2.1.1.1.1.cmml"><mi id="alg2.l6.m1.2.2.1.1.1.1.2" xref="alg2.l6.m1.2.2.1.1.1.1.2.cmml">n</mi><mo id="alg2.l6.m1.2.2.1.1.1.1.1" xref="alg2.l6.m1.2.2.1.1.1.1.1.cmml">⁢</mo><msub id="alg2.l6.m1.2.2.1.1.1.1.3" xref="alg2.l6.m1.2.2.1.1.1.1.3.cmml"><mi id="alg2.l6.m1.2.2.1.1.1.1.3.2" xref="alg2.l6.m1.2.2.1.1.1.1.3.2.cmml">l</mi><mi id="alg2.l6.m1.2.2.1.1.1.1.3.3" xref="alg2.l6.m1.2.2.1.1.1.1.3.3.cmml">k</mi></msub></mrow><mo id="alg2.l6.m1.2.2.1.1.1.3" xref="alg2.l6.m1.2.2.1.1.2.cmml">,</mo><mn id="alg2.l6.m1.1.1" xref="alg2.l6.m1.1.1.cmml">1</mn><mo id="alg2.l6.m1.2.2.1.1.1.4" stretchy="false" xref="alg2.l6.m1.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l6.m1.2b"><apply id="alg2.l6.m1.2.2.cmml" xref="alg2.l6.m1.2.2"><eq id="alg2.l6.m1.2.2.2.cmml" xref="alg2.l6.m1.2.2.2"></eq><apply id="alg2.l6.m1.2.2.3.cmml" xref="alg2.l6.m1.2.2.3"><times id="alg2.l6.m1.2.2.3.1.cmml" xref="alg2.l6.m1.2.2.3.1"></times><ci id="alg2.l6.m1.2.2.3.2.cmml" xref="alg2.l6.m1.2.2.3.2">𝑑</ci><ci id="alg2.l6.m1.2.2.3.3.cmml" xref="alg2.l6.m1.2.2.3.3">𝑖</ci><ci id="alg2.l6.m1.2.2.3.4.cmml" xref="alg2.l6.m1.2.2.3.4">𝑑</ci></apply><apply id="alg2.l6.m1.2.2.1.cmml" xref="alg2.l6.m1.2.2.1"><times id="alg2.l6.m1.2.2.1.2.cmml" xref="alg2.l6.m1.2.2.1.2"></times><ci id="alg2.l6.m1.2.2.1.3.cmml" xref="alg2.l6.m1.2.2.1.3">𝑎</ci><ci id="alg2.l6.m1.2.2.1.4.cmml" xref="alg2.l6.m1.2.2.1.4">𝑡</ci><ci id="alg2.l6.m1.2.2.1.5.cmml" xref="alg2.l6.m1.2.2.1.5">𝑜</ci><ci id="alg2.l6.m1.2.2.1.6.cmml" xref="alg2.l6.m1.2.2.1.6">𝑚</ci><ci id="alg2.l6.m1.2.2.1.7.cmml" xref="alg2.l6.m1.2.2.1.7">𝑖</ci><ci id="alg2.l6.m1.2.2.1.8.cmml" xref="alg2.l6.m1.2.2.1.8">𝑐</ci><ci id="alg2.l6.m1.2.2.1.9.cmml" xref="alg2.l6.m1.2.2.1.9">𝐴</ci><ci id="alg2.l6.m1.2.2.1.10.cmml" xref="alg2.l6.m1.2.2.1.10">𝑑</ci><ci id="alg2.l6.m1.2.2.1.11.cmml" xref="alg2.l6.m1.2.2.1.11">𝑑</ci><interval closure="open" id="alg2.l6.m1.2.2.1.1.2.cmml" xref="alg2.l6.m1.2.2.1.1.1"><apply id="alg2.l6.m1.2.2.1.1.1.1.cmml" xref="alg2.l6.m1.2.2.1.1.1.1"><times id="alg2.l6.m1.2.2.1.1.1.1.1.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.1"></times><ci id="alg2.l6.m1.2.2.1.1.1.1.2.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.2">𝑛</ci><apply id="alg2.l6.m1.2.2.1.1.1.1.3.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="alg2.l6.m1.2.2.1.1.1.1.3.1.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.3">subscript</csymbol><ci id="alg2.l6.m1.2.2.1.1.1.1.3.2.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.3.2">𝑙</ci><ci id="alg2.l6.m1.2.2.1.1.1.1.3.3.cmml" xref="alg2.l6.m1.2.2.1.1.1.1.3.3">𝑘</ci></apply></apply><cn id="alg2.l6.m1.1.1.cmml" type="integer" xref="alg2.l6.m1.1.1">1</cn></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.m1.2c">did=atomicAdd(nl_{k},1)</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.m1.2d">italic_d italic_i italic_d = italic_a italic_t italic_o italic_m italic_i italic_c italic_A italic_d italic_d ( italic_n italic_l start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , 1 )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l7.1.1.1" style="font-size:80%;">7:</span></span>     <math alttext="mid=did\ /\ T_{m}" class="ltx_Math" display="inline" id="alg2.l7.m1.1"><semantics id="alg2.l7.m1.1a"><mrow id="alg2.l7.m1.1.1" xref="alg2.l7.m1.1.1.cmml"><mrow id="alg2.l7.m1.1.1.2" xref="alg2.l7.m1.1.1.2.cmml"><mi id="alg2.l7.m1.1.1.2.2" xref="alg2.l7.m1.1.1.2.2.cmml">m</mi><mo id="alg2.l7.m1.1.1.2.1" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.3" xref="alg2.l7.m1.1.1.2.3.cmml">i</mi><mo id="alg2.l7.m1.1.1.2.1a" xref="alg2.l7.m1.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.2.4" xref="alg2.l7.m1.1.1.2.4.cmml">d</mi></mrow><mo id="alg2.l7.m1.1.1.1" xref="alg2.l7.m1.1.1.1.cmml">=</mo><mrow id="alg2.l7.m1.1.1.3" xref="alg2.l7.m1.1.1.3.cmml"><mrow id="alg2.l7.m1.1.1.3.2" xref="alg2.l7.m1.1.1.3.2.cmml"><mi id="alg2.l7.m1.1.1.3.2.2" xref="alg2.l7.m1.1.1.3.2.2.cmml">d</mi><mo id="alg2.l7.m1.1.1.3.2.1" xref="alg2.l7.m1.1.1.3.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.3.2.3" xref="alg2.l7.m1.1.1.3.2.3.cmml">i</mi><mo id="alg2.l7.m1.1.1.3.2.1a" xref="alg2.l7.m1.1.1.3.2.1.cmml">⁢</mo><mi id="alg2.l7.m1.1.1.3.2.4" xref="alg2.l7.m1.1.1.3.2.4.cmml">d</mi></mrow><mo id="alg2.l7.m1.1.1.3.1" lspace="0.722em" rspace="0.722em" xref="alg2.l7.m1.1.1.3.1.cmml">/</mo><msub id="alg2.l7.m1.1.1.3.3" xref="alg2.l7.m1.1.1.3.3.cmml"><mi id="alg2.l7.m1.1.1.3.3.2" xref="alg2.l7.m1.1.1.3.3.2.cmml">T</mi><mi id="alg2.l7.m1.1.1.3.3.3" xref="alg2.l7.m1.1.1.3.3.3.cmml">m</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m1.1b"><apply id="alg2.l7.m1.1.1.cmml" xref="alg2.l7.m1.1.1"><eq id="alg2.l7.m1.1.1.1.cmml" xref="alg2.l7.m1.1.1.1"></eq><apply id="alg2.l7.m1.1.1.2.cmml" xref="alg2.l7.m1.1.1.2"><times id="alg2.l7.m1.1.1.2.1.cmml" xref="alg2.l7.m1.1.1.2.1"></times><ci id="alg2.l7.m1.1.1.2.2.cmml" xref="alg2.l7.m1.1.1.2.2">𝑚</ci><ci id="alg2.l7.m1.1.1.2.3.cmml" xref="alg2.l7.m1.1.1.2.3">𝑖</ci><ci id="alg2.l7.m1.1.1.2.4.cmml" xref="alg2.l7.m1.1.1.2.4">𝑑</ci></apply><apply id="alg2.l7.m1.1.1.3.cmml" xref="alg2.l7.m1.1.1.3"><divide id="alg2.l7.m1.1.1.3.1.cmml" xref="alg2.l7.m1.1.1.3.1"></divide><apply id="alg2.l7.m1.1.1.3.2.cmml" xref="alg2.l7.m1.1.1.3.2"><times id="alg2.l7.m1.1.1.3.2.1.cmml" xref="alg2.l7.m1.1.1.3.2.1"></times><ci id="alg2.l7.m1.1.1.3.2.2.cmml" xref="alg2.l7.m1.1.1.3.2.2">𝑑</ci><ci id="alg2.l7.m1.1.1.3.2.3.cmml" xref="alg2.l7.m1.1.1.3.2.3">𝑖</ci><ci id="alg2.l7.m1.1.1.3.2.4.cmml" xref="alg2.l7.m1.1.1.3.2.4">𝑑</ci></apply><apply id="alg2.l7.m1.1.1.3.3.cmml" xref="alg2.l7.m1.1.1.3.3"><csymbol cd="ambiguous" id="alg2.l7.m1.1.1.3.3.1.cmml" xref="alg2.l7.m1.1.1.3.3">subscript</csymbol><ci id="alg2.l7.m1.1.1.3.3.2.cmml" xref="alg2.l7.m1.1.1.3.3.2">𝑇</ci><ci id="alg2.l7.m1.1.1.3.3.3.cmml" xref="alg2.l7.m1.1.1.3.3.3">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m1.1c">mid=did\ /\ T_{m}</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m1.1d">italic_m italic_i italic_d = italic_d italic_i italic_d / italic_T start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="mo\!f\!f=did\ \%\ T_{m}" class="ltx_Math" display="inline" id="alg2.l7.m2.1"><semantics id="alg2.l7.m2.1a"><mrow id="alg2.l7.m2.1.1" xref="alg2.l7.m2.1.1.cmml"><mrow id="alg2.l7.m2.1.1.2" xref="alg2.l7.m2.1.1.2.cmml"><mi id="alg2.l7.m2.1.1.2.2" xref="alg2.l7.m2.1.1.2.2.cmml">m</mi><mo id="alg2.l7.m2.1.1.2.1" xref="alg2.l7.m2.1.1.2.1.cmml">⁢</mo><mpadded width="0.315em"><mi id="alg2.l7.m2.1.1.2.3" xref="alg2.l7.m2.1.1.2.3.cmml">o</mi></mpadded><mo id="alg2.l7.m2.1.1.2.1a" xref="alg2.l7.m2.1.1.2.1.cmml">⁢</mo><mpadded width="0.427em"><mi id="alg2.l7.m2.1.1.2.4" xref="alg2.l7.m2.1.1.2.4.cmml">f</mi></mpadded><mo id="alg2.l7.m2.1.1.2.1b" xref="alg2.l7.m2.1.1.2.1.cmml">⁢</mo><mi id="alg2.l7.m2.1.1.2.5" xref="alg2.l7.m2.1.1.2.5.cmml">f</mi></mrow><mo id="alg2.l7.m2.1.1.1" xref="alg2.l7.m2.1.1.1.cmml">=</mo><mrow id="alg2.l7.m2.1.1.3" xref="alg2.l7.m2.1.1.3.cmml"><mi id="alg2.l7.m2.1.1.3.2" xref="alg2.l7.m2.1.1.3.2.cmml">d</mi><mo id="alg2.l7.m2.1.1.3.1" xref="alg2.l7.m2.1.1.3.1.cmml">⁢</mo><mi id="alg2.l7.m2.1.1.3.3" xref="alg2.l7.m2.1.1.3.3.cmml">i</mi><mo id="alg2.l7.m2.1.1.3.1a" xref="alg2.l7.m2.1.1.3.1.cmml">⁢</mo><mrow id="alg2.l7.m2.1.1.3.4" xref="alg2.l7.m2.1.1.3.4.cmml"><mi id="alg2.l7.m2.1.1.3.4.2" xref="alg2.l7.m2.1.1.3.4.2.cmml">d</mi><mo id="alg2.l7.m2.1.1.3.4.1" lspace="0.500em" xref="alg2.l7.m2.1.1.3.4.1.cmml">%</mo></mrow><mo id="alg2.l7.m2.1.1.3.1b" lspace="0.500em" xref="alg2.l7.m2.1.1.3.1.cmml">⁢</mo><msub id="alg2.l7.m2.1.1.3.5" xref="alg2.l7.m2.1.1.3.5.cmml"><mi id="alg2.l7.m2.1.1.3.5.2" xref="alg2.l7.m2.1.1.3.5.2.cmml">T</mi><mi id="alg2.l7.m2.1.1.3.5.3" xref="alg2.l7.m2.1.1.3.5.3.cmml">m</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m2.1b"><apply id="alg2.l7.m2.1.1.cmml" xref="alg2.l7.m2.1.1"><eq id="alg2.l7.m2.1.1.1.cmml" xref="alg2.l7.m2.1.1.1"></eq><apply id="alg2.l7.m2.1.1.2.cmml" xref="alg2.l7.m2.1.1.2"><times id="alg2.l7.m2.1.1.2.1.cmml" xref="alg2.l7.m2.1.1.2.1"></times><ci id="alg2.l7.m2.1.1.2.2.cmml" xref="alg2.l7.m2.1.1.2.2">𝑚</ci><ci id="alg2.l7.m2.1.1.2.3.cmml" xref="alg2.l7.m2.1.1.2.3">𝑜</ci><ci id="alg2.l7.m2.1.1.2.4.cmml" xref="alg2.l7.m2.1.1.2.4">𝑓</ci><ci id="alg2.l7.m2.1.1.2.5.cmml" xref="alg2.l7.m2.1.1.2.5">𝑓</ci></apply><apply id="alg2.l7.m2.1.1.3.cmml" xref="alg2.l7.m2.1.1.3"><times id="alg2.l7.m2.1.1.3.1.cmml" xref="alg2.l7.m2.1.1.3.1"></times><ci id="alg2.l7.m2.1.1.3.2.cmml" xref="alg2.l7.m2.1.1.3.2">𝑑</ci><ci id="alg2.l7.m2.1.1.3.3.cmml" xref="alg2.l7.m2.1.1.3.3">𝑖</ci><apply id="alg2.l7.m2.1.1.3.4.cmml" xref="alg2.l7.m2.1.1.3.4"><csymbol cd="latexml" id="alg2.l7.m2.1.1.3.4.1.cmml" xref="alg2.l7.m2.1.1.3.4.1">percent</csymbol><ci id="alg2.l7.m2.1.1.3.4.2.cmml" xref="alg2.l7.m2.1.1.3.4.2">𝑑</ci></apply><apply id="alg2.l7.m2.1.1.3.5.cmml" xref="alg2.l7.m2.1.1.3.5"><csymbol cd="ambiguous" id="alg2.l7.m2.1.1.3.5.1.cmml" xref="alg2.l7.m2.1.1.3.5">subscript</csymbol><ci id="alg2.l7.m2.1.1.3.5.2.cmml" xref="alg2.l7.m2.1.1.3.5.2">𝑇</ci><ci id="alg2.l7.m2.1.1.3.5.3.cmml" xref="alg2.l7.m2.1.1.3.5.3">𝑚</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m2.1c">mo\!f\!f=did\ \%\ T_{m}</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m2.1d">italic_m italic_o italic_f italic_f = italic_d italic_i italic_d % italic_T start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l8.1.1.1" style="font-size:80%;">8:</span></span>     <math alttext="m_{mid}\leftarrow" class="ltx_Math" display="inline" id="alg2.l8.m1.1"><semantics id="alg2.l8.m1.1a"><mrow id="alg2.l8.m1.1.1" xref="alg2.l8.m1.1.1.cmml"><msub id="alg2.l8.m1.1.1.2" xref="alg2.l8.m1.1.1.2.cmml"><mi id="alg2.l8.m1.1.1.2.2" xref="alg2.l8.m1.1.1.2.2.cmml">m</mi><mrow id="alg2.l8.m1.1.1.2.3" xref="alg2.l8.m1.1.1.2.3.cmml"><mi id="alg2.l8.m1.1.1.2.3.2" xref="alg2.l8.m1.1.1.2.3.2.cmml">m</mi><mo id="alg2.l8.m1.1.1.2.3.1" xref="alg2.l8.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l8.m1.1.1.2.3.3" xref="alg2.l8.m1.1.1.2.3.3.cmml">i</mi><mo id="alg2.l8.m1.1.1.2.3.1a" xref="alg2.l8.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l8.m1.1.1.2.3.4" xref="alg2.l8.m1.1.1.2.3.4.cmml">d</mi></mrow></msub><mo id="alg2.l8.m1.1.1.1" stretchy="false" xref="alg2.l8.m1.1.1.1.cmml">←</mo><mi id="alg2.l8.m1.1.1.3" xref="alg2.l8.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l8.m1.1b"><apply id="alg2.l8.m1.1.1.cmml" xref="alg2.l8.m1.1.1"><ci id="alg2.l8.m1.1.1.1.cmml" xref="alg2.l8.m1.1.1.1">←</ci><apply id="alg2.l8.m1.1.1.2.cmml" xref="alg2.l8.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l8.m1.1.1.2.1.cmml" xref="alg2.l8.m1.1.1.2">subscript</csymbol><ci id="alg2.l8.m1.1.1.2.2.cmml" xref="alg2.l8.m1.1.1.2.2">𝑚</ci><apply id="alg2.l8.m1.1.1.2.3.cmml" xref="alg2.l8.m1.1.1.2.3"><times id="alg2.l8.m1.1.1.2.3.1.cmml" xref="alg2.l8.m1.1.1.2.3.1"></times><ci id="alg2.l8.m1.1.1.2.3.2.cmml" xref="alg2.l8.m1.1.1.2.3.2">𝑚</ci><ci id="alg2.l8.m1.1.1.2.3.3.cmml" xref="alg2.l8.m1.1.1.2.3.3">𝑖</ci><ci id="alg2.l8.m1.1.1.2.3.4.cmml" xref="alg2.l8.m1.1.1.2.3.4">𝑑</ci></apply></apply><csymbol cd="latexml" id="alg2.l8.m1.1.1.3.cmml" xref="alg2.l8.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l8.m1.1c">m_{mid}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m1.1d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT ←</annotation></semantics></math> last memory block in <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="alg2.l8.m2.1"><semantics id="alg2.l8.m2.1a"><msubsup id="alg2.l8.m2.1.1" xref="alg2.l8.m2.1.1.cmml"><mi id="alg2.l8.m2.1.1.2.2" xref="alg2.l8.m2.1.1.2.2.cmml">m</mi><mi id="alg2.l8.m2.1.1.2.3" xref="alg2.l8.m2.1.1.2.3.cmml">k</mi><mo id="alg2.l8.m2.1.1.3" xref="alg2.l8.m2.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l8.m2.1b"><apply id="alg2.l8.m2.1.1.cmml" xref="alg2.l8.m2.1.1"><csymbol cd="ambiguous" id="alg2.l8.m2.1.1.1.cmml" xref="alg2.l8.m2.1.1">superscript</csymbol><apply id="alg2.l8.m2.1.1.2.cmml" xref="alg2.l8.m2.1.1"><csymbol cd="ambiguous" id="alg2.l8.m2.1.1.2.1.cmml" xref="alg2.l8.m2.1.1">subscript</csymbol><ci id="alg2.l8.m2.1.1.2.2.cmml" xref="alg2.l8.m2.1.1.2.2">𝑚</ci><ci id="alg2.l8.m2.1.1.2.3.cmml" xref="alg2.l8.m2.1.1.2.3">𝑘</ci></apply><ci id="alg2.l8.m2.1.1.3.cmml" xref="alg2.l8.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l8.m2.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m2.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l9.1.1.1" style="font-size:80%;">9:</span></span>     _syncthreads() // make sure <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="alg2.l9.m1.1"><semantics id="alg2.l9.m1.1a"><msubsup id="alg2.l9.m1.1.1" xref="alg2.l9.m1.1.1.cmml"><mi id="alg2.l9.m1.1.1.2.2" xref="alg2.l9.m1.1.1.2.2.cmml">m</mi><mi id="alg2.l9.m1.1.1.2.3" xref="alg2.l9.m1.1.1.2.3.cmml">k</mi><mo id="alg2.l9.m1.1.1.3" xref="alg2.l9.m1.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l9.m1.1b"><apply id="alg2.l9.m1.1.1.cmml" xref="alg2.l9.m1.1.1"><csymbol cd="ambiguous" id="alg2.l9.m1.1.1.1.cmml" xref="alg2.l9.m1.1.1">superscript</csymbol><apply id="alg2.l9.m1.1.1.2.cmml" xref="alg2.l9.m1.1.1"><csymbol cd="ambiguous" id="alg2.l9.m1.1.1.2.1.cmml" xref="alg2.l9.m1.1.1">subscript</csymbol><ci id="alg2.l9.m1.1.1.2.2.cmml" xref="alg2.l9.m1.1.1.2.2">𝑚</ci><ci id="alg2.l9.m1.1.1.2.3.cmml" xref="alg2.l9.m1.1.1.2.3">𝑘</ci></apply><ci id="alg2.l9.m1.1.1.3.cmml" xref="alg2.l9.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l9.m1.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l9.m1.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is updated later

</div>
<div class="ltx_listingline" id="alg2.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l10.1.1.1" style="font-size:80%;">10:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l10.2">if</span> <math alttext="mid&gt;=|m_{k}^{\prime}|" class="ltx_Math" display="inline" id="alg2.l10.m1.1"><semantics id="alg2.l10.m1.1a"><mrow id="alg2.l10.m1.1.1" xref="alg2.l10.m1.1.1.cmml"><mrow id="alg2.l10.m1.1.1.3" xref="alg2.l10.m1.1.1.3.cmml"><mi id="alg2.l10.m1.1.1.3.2" xref="alg2.l10.m1.1.1.3.2.cmml">m</mi><mo id="alg2.l10.m1.1.1.3.1" xref="alg2.l10.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l10.m1.1.1.3.3" xref="alg2.l10.m1.1.1.3.3.cmml">i</mi><mo id="alg2.l10.m1.1.1.3.1a" xref="alg2.l10.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l10.m1.1.1.3.4" xref="alg2.l10.m1.1.1.3.4.cmml">d</mi></mrow><mo id="alg2.l10.m1.1.1.2" lspace="0.278em" rspace="0.278em" xref="alg2.l10.m1.1.1.2.cmml">&gt;=</mo><mrow id="alg2.l10.m1.1.1.1.1" xref="alg2.l10.m1.1.1.1.2.cmml"><mo id="alg2.l10.m1.1.1.1.1.2" stretchy="false" xref="alg2.l10.m1.1.1.1.2.1.cmml">|</mo><msubsup id="alg2.l10.m1.1.1.1.1.1" xref="alg2.l10.m1.1.1.1.1.1.cmml"><mi id="alg2.l10.m1.1.1.1.1.1.2.2" xref="alg2.l10.m1.1.1.1.1.1.2.2.cmml">m</mi><mi id="alg2.l10.m1.1.1.1.1.1.2.3" xref="alg2.l10.m1.1.1.1.1.1.2.3.cmml">k</mi><mo id="alg2.l10.m1.1.1.1.1.1.3" xref="alg2.l10.m1.1.1.1.1.1.3.cmml">′</mo></msubsup><mo id="alg2.l10.m1.1.1.1.1.3" stretchy="false" xref="alg2.l10.m1.1.1.1.2.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l10.m1.1b"><apply id="alg2.l10.m1.1.1.cmml" xref="alg2.l10.m1.1.1"><geq id="alg2.l10.m1.1.1.2.cmml" xref="alg2.l10.m1.1.1.2"></geq><apply id="alg2.l10.m1.1.1.3.cmml" xref="alg2.l10.m1.1.1.3"><times id="alg2.l10.m1.1.1.3.1.cmml" xref="alg2.l10.m1.1.1.3.1"></times><ci id="alg2.l10.m1.1.1.3.2.cmml" xref="alg2.l10.m1.1.1.3.2">𝑚</ci><ci id="alg2.l10.m1.1.1.3.3.cmml" xref="alg2.l10.m1.1.1.3.3">𝑖</ci><ci id="alg2.l10.m1.1.1.3.4.cmml" xref="alg2.l10.m1.1.1.3.4">𝑑</ci></apply><apply id="alg2.l10.m1.1.1.1.2.cmml" xref="alg2.l10.m1.1.1.1.1"><abs id="alg2.l10.m1.1.1.1.2.1.cmml" xref="alg2.l10.m1.1.1.1.1.2"></abs><apply id="alg2.l10.m1.1.1.1.1.1.cmml" xref="alg2.l10.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l10.m1.1.1.1.1.1.1.cmml" xref="alg2.l10.m1.1.1.1.1.1">superscript</csymbol><apply id="alg2.l10.m1.1.1.1.1.1.2.cmml" xref="alg2.l10.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l10.m1.1.1.1.1.1.2.1.cmml" xref="alg2.l10.m1.1.1.1.1.1">subscript</csymbol><ci id="alg2.l10.m1.1.1.1.1.1.2.2.cmml" xref="alg2.l10.m1.1.1.1.1.1.2.2">𝑚</ci><ci id="alg2.l10.m1.1.1.1.1.1.2.3.cmml" xref="alg2.l10.m1.1.1.1.1.1.2.3">𝑘</ci></apply><ci id="alg2.l10.m1.1.1.1.1.1.3.cmml" xref="alg2.l10.m1.1.1.1.1.1.3">′</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l10.m1.1c">mid&gt;=|m_{k}^{\prime}|</annotation><annotation encoding="application/x-llamapun" id="alg2.l10.m1.1d">italic_m italic_i italic_d &gt; = | italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT |</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l10.3">then</span>
</div>
<div class="ltx_listingline" id="alg2.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l11.1.1.1" style="font-size:80%;">11:</span></span>        inNewBlock <math alttext="\leftarrow" class="ltx_Math" display="inline" id="alg2.l11.m1.1"><semantics id="alg2.l11.m1.1a"><mo id="alg2.l11.m1.1.1" stretchy="false" xref="alg2.l11.m1.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="alg2.l11.m1.1b"><ci id="alg2.l11.m1.1.1.cmml" xref="alg2.l11.m1.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l11.m1.1c">\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l11.m1.1d">←</annotation></semantics></math> true

</div>
<div class="ltx_listingline" id="alg2.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l12.1.1.1" style="font-size:80%;">12:</span></span>        <span class="ltx_text ltx_font_bold" id="alg2.l12.2">if</span> <math alttext="mo\!f\!f==0" class="ltx_math_unparsed" display="inline" id="alg2.l12.m1.1"><semantics id="alg2.l12.m1.1a"><mrow id="alg2.l12.m1.1b"><mi id="alg2.l12.m1.1.1">m</mi><mpadded id="alg2.l12.m1.1c" width="0.315em"><mi id="alg2.l12.m1.1.2">o</mi></mpadded><mpadded id="alg2.l12.m1.1d" width="0.427em"><mi id="alg2.l12.m1.1.3">f</mi></mpadded><mi id="alg2.l12.m1.1.4">f</mi><mo id="alg2.l12.m1.1.5" rspace="0em">=</mo><mo id="alg2.l12.m1.1.6" lspace="0em">=</mo><mn id="alg2.l12.m1.1.7">0</mn></mrow><annotation encoding="application/x-tex" id="alg2.l12.m1.1e">mo\!f\!f==0</annotation><annotation encoding="application/x-llamapun" id="alg2.l12.m1.1f">italic_m italic_o italic_f italic_f = = 0</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l12.3">then</span>
</div>
<div class="ltx_listingline" id="alg2.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l13.1.1.1" style="font-size:80%;">13:</span></span>           <math alttext="m_{mid}\leftarrow P[i/atomicAdd(cur_{P},1)]" class="ltx_Math" display="inline" id="alg2.l13.m1.2"><semantics id="alg2.l13.m1.2a"><mrow id="alg2.l13.m1.2.2" xref="alg2.l13.m1.2.2.cmml"><msub id="alg2.l13.m1.2.2.3" xref="alg2.l13.m1.2.2.3.cmml"><mi id="alg2.l13.m1.2.2.3.2" xref="alg2.l13.m1.2.2.3.2.cmml">m</mi><mrow id="alg2.l13.m1.2.2.3.3" xref="alg2.l13.m1.2.2.3.3.cmml"><mi id="alg2.l13.m1.2.2.3.3.2" xref="alg2.l13.m1.2.2.3.3.2.cmml">m</mi><mo id="alg2.l13.m1.2.2.3.3.1" xref="alg2.l13.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.3.3.3" xref="alg2.l13.m1.2.2.3.3.3.cmml">i</mi><mo id="alg2.l13.m1.2.2.3.3.1a" xref="alg2.l13.m1.2.2.3.3.1.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.3.3.4" xref="alg2.l13.m1.2.2.3.3.4.cmml">d</mi></mrow></msub><mo id="alg2.l13.m1.2.2.2" stretchy="false" xref="alg2.l13.m1.2.2.2.cmml">←</mo><mrow id="alg2.l13.m1.2.2.1" xref="alg2.l13.m1.2.2.1.cmml"><mi id="alg2.l13.m1.2.2.1.3" xref="alg2.l13.m1.2.2.1.3.cmml">P</mi><mo id="alg2.l13.m1.2.2.1.2" xref="alg2.l13.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg2.l13.m1.2.2.1.1.1" xref="alg2.l13.m1.2.2.1.1.2.cmml"><mo id="alg2.l13.m1.2.2.1.1.1.2" stretchy="false" xref="alg2.l13.m1.2.2.1.1.2.1.cmml">[</mo><mrow id="alg2.l13.m1.2.2.1.1.1.1" xref="alg2.l13.m1.2.2.1.1.1.1.cmml"><mrow id="alg2.l13.m1.2.2.1.1.1.1.3" xref="alg2.l13.m1.2.2.1.1.1.1.3.cmml"><mi id="alg2.l13.m1.2.2.1.1.1.1.3.2" xref="alg2.l13.m1.2.2.1.1.1.1.3.2.cmml">i</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.3.1" xref="alg2.l13.m1.2.2.1.1.1.1.3.1.cmml">/</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.3.3" xref="alg2.l13.m1.2.2.1.1.1.1.3.3.cmml">a</mi></mrow><mo id="alg2.l13.m1.2.2.1.1.1.1.2" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.4" xref="alg2.l13.m1.2.2.1.1.1.1.4.cmml">t</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2a" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.5" xref="alg2.l13.m1.2.2.1.1.1.1.5.cmml">o</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2b" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.6" xref="alg2.l13.m1.2.2.1.1.1.1.6.cmml">m</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2c" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.7" xref="alg2.l13.m1.2.2.1.1.1.1.7.cmml">i</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2d" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.8" xref="alg2.l13.m1.2.2.1.1.1.1.8.cmml">c</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2e" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.9" xref="alg2.l13.m1.2.2.1.1.1.1.9.cmml">A</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2f" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.10" xref="alg2.l13.m1.2.2.1.1.1.1.10.cmml">d</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2g" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.11" xref="alg2.l13.m1.2.2.1.1.1.1.11.cmml">d</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.2h" xref="alg2.l13.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="alg2.l13.m1.2.2.1.1.1.1.1.1" xref="alg2.l13.m1.2.2.1.1.1.1.1.2.cmml"><mo id="alg2.l13.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="alg2.l13.m1.2.2.1.1.1.1.1.2.cmml">(</mo><mrow id="alg2.l13.m1.2.2.1.1.1.1.1.1.1" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.2" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.2.cmml">c</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.3" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.3.cmml">u</mi><mo id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1a" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><msub id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.cmml"><mi id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.2" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.2.cmml">r</mi><mi id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.3" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.3.cmml">P</mi></msub></mrow><mo id="alg2.l13.m1.2.2.1.1.1.1.1.1.3" xref="alg2.l13.m1.2.2.1.1.1.1.1.2.cmml">,</mo><mn id="alg2.l13.m1.1.1" xref="alg2.l13.m1.1.1.cmml">1</mn><mo id="alg2.l13.m1.2.2.1.1.1.1.1.1.4" stretchy="false" xref="alg2.l13.m1.2.2.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="alg2.l13.m1.2.2.1.1.1.3" stretchy="false" xref="alg2.l13.m1.2.2.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l13.m1.2b"><apply id="alg2.l13.m1.2.2.cmml" xref="alg2.l13.m1.2.2"><ci id="alg2.l13.m1.2.2.2.cmml" xref="alg2.l13.m1.2.2.2">←</ci><apply id="alg2.l13.m1.2.2.3.cmml" xref="alg2.l13.m1.2.2.3"><csymbol cd="ambiguous" id="alg2.l13.m1.2.2.3.1.cmml" xref="alg2.l13.m1.2.2.3">subscript</csymbol><ci id="alg2.l13.m1.2.2.3.2.cmml" xref="alg2.l13.m1.2.2.3.2">𝑚</ci><apply id="alg2.l13.m1.2.2.3.3.cmml" xref="alg2.l13.m1.2.2.3.3"><times id="alg2.l13.m1.2.2.3.3.1.cmml" xref="alg2.l13.m1.2.2.3.3.1"></times><ci id="alg2.l13.m1.2.2.3.3.2.cmml" xref="alg2.l13.m1.2.2.3.3.2">𝑚</ci><ci id="alg2.l13.m1.2.2.3.3.3.cmml" xref="alg2.l13.m1.2.2.3.3.3">𝑖</ci><ci id="alg2.l13.m1.2.2.3.3.4.cmml" xref="alg2.l13.m1.2.2.3.3.4">𝑑</ci></apply></apply><apply id="alg2.l13.m1.2.2.1.cmml" xref="alg2.l13.m1.2.2.1"><times id="alg2.l13.m1.2.2.1.2.cmml" xref="alg2.l13.m1.2.2.1.2"></times><ci id="alg2.l13.m1.2.2.1.3.cmml" xref="alg2.l13.m1.2.2.1.3">𝑃</ci><apply id="alg2.l13.m1.2.2.1.1.2.cmml" xref="alg2.l13.m1.2.2.1.1.1"><csymbol cd="latexml" id="alg2.l13.m1.2.2.1.1.2.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.2">delimited-[]</csymbol><apply id="alg2.l13.m1.2.2.1.1.1.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.1"><times id="alg2.l13.m1.2.2.1.1.1.1.2.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.2"></times><apply id="alg2.l13.m1.2.2.1.1.1.1.3.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.3"><divide id="alg2.l13.m1.2.2.1.1.1.1.3.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.3.1"></divide><ci id="alg2.l13.m1.2.2.1.1.1.1.3.2.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.3.2">𝑖</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.3.3.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.3.3">𝑎</ci></apply><ci id="alg2.l13.m1.2.2.1.1.1.1.4.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.4">𝑡</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.5.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.5">𝑜</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.6.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.6">𝑚</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.7.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.7">𝑖</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.8.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.8">𝑐</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.9.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.9">𝐴</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.10.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.10">𝑑</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.11.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.11">𝑑</ci><interval closure="open" id="alg2.l13.m1.2.2.1.1.1.1.1.2.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1"><apply id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1"><times id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.1"></times><ci id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.2">𝑐</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.3">𝑢</ci><apply id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.1.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4">subscript</csymbol><ci id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.2.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.2">𝑟</ci><ci id="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.3.cmml" xref="alg2.l13.m1.2.2.1.1.1.1.1.1.1.4.3">𝑃</ci></apply></apply><cn id="alg2.l13.m1.1.1.cmml" type="integer" xref="alg2.l13.m1.1.1">1</cn></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l13.m1.2c">m_{mid}\leftarrow P[i/atomicAdd(cur_{P},1)]</annotation><annotation encoding="application/x-llamapun" id="alg2.l13.m1.2d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT ← italic_P [ italic_i / italic_a italic_t italic_o italic_m italic_i italic_c italic_A italic_d italic_d ( italic_c italic_u italic_r start_POSTSUBSCRIPT italic_P end_POSTSUBSCRIPT , 1 ) ]</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l14.1.1.1" style="font-size:80%;">14:</span></span>           link <math alttext="m_{mid}" class="ltx_Math" display="inline" id="alg2.l14.m1.1"><semantics id="alg2.l14.m1.1a"><msub id="alg2.l14.m1.1.1" xref="alg2.l14.m1.1.1.cmml"><mi id="alg2.l14.m1.1.1.2" xref="alg2.l14.m1.1.1.2.cmml">m</mi><mrow id="alg2.l14.m1.1.1.3" xref="alg2.l14.m1.1.1.3.cmml"><mi id="alg2.l14.m1.1.1.3.2" xref="alg2.l14.m1.1.1.3.2.cmml">m</mi><mo id="alg2.l14.m1.1.1.3.1" xref="alg2.l14.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l14.m1.1.1.3.3" xref="alg2.l14.m1.1.1.3.3.cmml">i</mi><mo id="alg2.l14.m1.1.1.3.1a" xref="alg2.l14.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l14.m1.1.1.3.4" xref="alg2.l14.m1.1.1.3.4.cmml">d</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg2.l14.m1.1b"><apply id="alg2.l14.m1.1.1.cmml" xref="alg2.l14.m1.1.1"><csymbol cd="ambiguous" id="alg2.l14.m1.1.1.1.cmml" xref="alg2.l14.m1.1.1">subscript</csymbol><ci id="alg2.l14.m1.1.1.2.cmml" xref="alg2.l14.m1.1.1.2">𝑚</ci><apply id="alg2.l14.m1.1.1.3.cmml" xref="alg2.l14.m1.1.1.3"><times id="alg2.l14.m1.1.1.3.1.cmml" xref="alg2.l14.m1.1.1.3.1"></times><ci id="alg2.l14.m1.1.1.3.2.cmml" xref="alg2.l14.m1.1.1.3.2">𝑚</ci><ci id="alg2.l14.m1.1.1.3.3.cmml" xref="alg2.l14.m1.1.1.3.3">𝑖</ci><ci id="alg2.l14.m1.1.1.3.4.cmml" xref="alg2.l14.m1.1.1.3.4">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l14.m1.1c">m_{mid}</annotation><annotation encoding="application/x-llamapun" id="alg2.l14.m1.1d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT</annotation></semantics></math> with last block in <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="alg2.l14.m2.1"><semantics id="alg2.l14.m2.1a"><msubsup id="alg2.l14.m2.1.1" xref="alg2.l14.m2.1.1.cmml"><mi id="alg2.l14.m2.1.1.2.2" xref="alg2.l14.m2.1.1.2.2.cmml">m</mi><mi id="alg2.l14.m2.1.1.2.3" xref="alg2.l14.m2.1.1.2.3.cmml">k</mi><mo id="alg2.l14.m2.1.1.3" xref="alg2.l14.m2.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l14.m2.1b"><apply id="alg2.l14.m2.1.1.cmml" xref="alg2.l14.m2.1.1"><csymbol cd="ambiguous" id="alg2.l14.m2.1.1.1.cmml" xref="alg2.l14.m2.1.1">superscript</csymbol><apply id="alg2.l14.m2.1.1.2.cmml" xref="alg2.l14.m2.1.1"><csymbol cd="ambiguous" id="alg2.l14.m2.1.1.2.1.cmml" xref="alg2.l14.m2.1.1">subscript</csymbol><ci id="alg2.l14.m2.1.1.2.2.cmml" xref="alg2.l14.m2.1.1.2.2">𝑚</ci><ci id="alg2.l14.m2.1.1.2.3.cmml" xref="alg2.l14.m2.1.1.2.3">𝑘</ci></apply><ci id="alg2.l14.m2.1.1.3.cmml" xref="alg2.l14.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l14.m2.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l14.m2.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l15.1.1.1" style="font-size:80%;">15:</span></span>        <span class="ltx_text ltx_font_bold" id="alg2.l15.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l15.3">if</span>
</div>
<div class="ltx_listingline" id="alg2.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l16.1.1.1" style="font-size:80%;">16:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l16.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l16.3">if</span>
</div>
<div class="ltx_listingline" id="alg2.l17">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l17.1.1.1" style="font-size:80%;">17:</span></span>     _syncthreads() // make sure new <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="alg2.l17.m1.1"><semantics id="alg2.l17.m1.1a"><msubsup id="alg2.l17.m1.1.1" xref="alg2.l17.m1.1.1.cmml"><mi id="alg2.l17.m1.1.1.2.2" xref="alg2.l17.m1.1.1.2.2.cmml">m</mi><mi id="alg2.l17.m1.1.1.2.3" xref="alg2.l17.m1.1.1.2.3.cmml">k</mi><mo id="alg2.l17.m1.1.1.3" xref="alg2.l17.m1.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l17.m1.1b"><apply id="alg2.l17.m1.1.1.cmml" xref="alg2.l17.m1.1.1"><csymbol cd="ambiguous" id="alg2.l17.m1.1.1.1.cmml" xref="alg2.l17.m1.1.1">superscript</csymbol><apply id="alg2.l17.m1.1.1.2.cmml" xref="alg2.l17.m1.1.1"><csymbol cd="ambiguous" id="alg2.l17.m1.1.1.2.1.cmml" xref="alg2.l17.m1.1.1">subscript</csymbol><ci id="alg2.l17.m1.1.1.2.2.cmml" xref="alg2.l17.m1.1.1.2.2">𝑚</ci><ci id="alg2.l17.m1.1.1.2.3.cmml" xref="alg2.l17.m1.1.1.2.3">𝑘</ci></apply><ci id="alg2.l17.m1.1.1.3.cmml" xref="alg2.l17.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l17.m1.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l17.m1.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> can be accessed

</div>
<div class="ltx_listingline" id="alg2.l18">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l18.1.1.1" style="font-size:80%;">18:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l18.2">if</span> inNewBlock <span class="ltx_text ltx_font_bold" id="alg2.l18.3">then</span>
</div>
<div class="ltx_listingline" id="alg2.l19">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l19.1.1.1" style="font-size:80%;">19:</span></span>        <math alttext="m_{mid}\leftarrow" class="ltx_Math" display="inline" id="alg2.l19.m1.1"><semantics id="alg2.l19.m1.1a"><mrow id="alg2.l19.m1.1.1" xref="alg2.l19.m1.1.1.cmml"><msub id="alg2.l19.m1.1.1.2" xref="alg2.l19.m1.1.1.2.cmml"><mi id="alg2.l19.m1.1.1.2.2" xref="alg2.l19.m1.1.1.2.2.cmml">m</mi><mrow id="alg2.l19.m1.1.1.2.3" xref="alg2.l19.m1.1.1.2.3.cmml"><mi id="alg2.l19.m1.1.1.2.3.2" xref="alg2.l19.m1.1.1.2.3.2.cmml">m</mi><mo id="alg2.l19.m1.1.1.2.3.1" xref="alg2.l19.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l19.m1.1.1.2.3.3" xref="alg2.l19.m1.1.1.2.3.3.cmml">i</mi><mo id="alg2.l19.m1.1.1.2.3.1a" xref="alg2.l19.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l19.m1.1.1.2.3.4" xref="alg2.l19.m1.1.1.2.3.4.cmml">d</mi></mrow></msub><mo id="alg2.l19.m1.1.1.1" stretchy="false" xref="alg2.l19.m1.1.1.1.cmml">←</mo><mi id="alg2.l19.m1.1.1.3" xref="alg2.l19.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l19.m1.1b"><apply id="alg2.l19.m1.1.1.cmml" xref="alg2.l19.m1.1.1"><ci id="alg2.l19.m1.1.1.1.cmml" xref="alg2.l19.m1.1.1.1">←</ci><apply id="alg2.l19.m1.1.1.2.cmml" xref="alg2.l19.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l19.m1.1.1.2.1.cmml" xref="alg2.l19.m1.1.1.2">subscript</csymbol><ci id="alg2.l19.m1.1.1.2.2.cmml" xref="alg2.l19.m1.1.1.2.2">𝑚</ci><apply id="alg2.l19.m1.1.1.2.3.cmml" xref="alg2.l19.m1.1.1.2.3"><times id="alg2.l19.m1.1.1.2.3.1.cmml" xref="alg2.l19.m1.1.1.2.3.1"></times><ci id="alg2.l19.m1.1.1.2.3.2.cmml" xref="alg2.l19.m1.1.1.2.3.2">𝑚</ci><ci id="alg2.l19.m1.1.1.2.3.3.cmml" xref="alg2.l19.m1.1.1.2.3.3">𝑖</ci><ci id="alg2.l19.m1.1.1.2.3.4.cmml" xref="alg2.l19.m1.1.1.2.3.4">𝑑</ci></apply></apply><csymbol cd="latexml" id="alg2.l19.m1.1.1.3.cmml" xref="alg2.l19.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l19.m1.1c">m_{mid}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l19.m1.1d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT ←</annotation></semantics></math> new last memory block in <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="alg2.l19.m2.1"><semantics id="alg2.l19.m2.1a"><msubsup id="alg2.l19.m2.1.1" xref="alg2.l19.m2.1.1.cmml"><mi id="alg2.l19.m2.1.1.2.2" xref="alg2.l19.m2.1.1.2.2.cmml">m</mi><mi id="alg2.l19.m2.1.1.2.3" xref="alg2.l19.m2.1.1.2.3.cmml">k</mi><mo id="alg2.l19.m2.1.1.3" xref="alg2.l19.m2.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l19.m2.1b"><apply id="alg2.l19.m2.1.1.cmml" xref="alg2.l19.m2.1.1"><csymbol cd="ambiguous" id="alg2.l19.m2.1.1.1.cmml" xref="alg2.l19.m2.1.1">superscript</csymbol><apply id="alg2.l19.m2.1.1.2.cmml" xref="alg2.l19.m2.1.1"><csymbol cd="ambiguous" id="alg2.l19.m2.1.1.2.1.cmml" xref="alg2.l19.m2.1.1">subscript</csymbol><ci id="alg2.l19.m2.1.1.2.2.cmml" xref="alg2.l19.m2.1.1.2.2">𝑚</ci><ci id="alg2.l19.m2.1.1.2.3.cmml" xref="alg2.l19.m2.1.1.2.3">𝑘</ci></apply><ci id="alg2.l19.m2.1.1.3.cmml" xref="alg2.l19.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l19.m2.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l19.m2.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l20">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l20.1.1.1" style="font-size:80%;">20:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l20.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l20.3">if</span>
</div>
<div class="ltx_listingline" id="alg2.l21">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l21.1.1.1" style="font-size:80%;">21:</span></span>     fill vector in <math alttext="m_{mid}" class="ltx_Math" display="inline" id="alg2.l21.m1.1"><semantics id="alg2.l21.m1.1a"><msub id="alg2.l21.m1.1.1" xref="alg2.l21.m1.1.1.cmml"><mi id="alg2.l21.m1.1.1.2" xref="alg2.l21.m1.1.1.2.cmml">m</mi><mrow id="alg2.l21.m1.1.1.3" xref="alg2.l21.m1.1.1.3.cmml"><mi id="alg2.l21.m1.1.1.3.2" xref="alg2.l21.m1.1.1.3.2.cmml">m</mi><mo id="alg2.l21.m1.1.1.3.1" xref="alg2.l21.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l21.m1.1.1.3.3" xref="alg2.l21.m1.1.1.3.3.cmml">i</mi><mo id="alg2.l21.m1.1.1.3.1a" xref="alg2.l21.m1.1.1.3.1.cmml">⁢</mo><mi id="alg2.l21.m1.1.1.3.4" xref="alg2.l21.m1.1.1.3.4.cmml">d</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg2.l21.m1.1b"><apply id="alg2.l21.m1.1.1.cmml" xref="alg2.l21.m1.1.1"><csymbol cd="ambiguous" id="alg2.l21.m1.1.1.1.cmml" xref="alg2.l21.m1.1.1">subscript</csymbol><ci id="alg2.l21.m1.1.1.2.cmml" xref="alg2.l21.m1.1.1.2">𝑚</ci><apply id="alg2.l21.m1.1.1.3.cmml" xref="alg2.l21.m1.1.1.3"><times id="alg2.l21.m1.1.1.3.1.cmml" xref="alg2.l21.m1.1.1.3.1"></times><ci id="alg2.l21.m1.1.1.3.2.cmml" xref="alg2.l21.m1.1.1.3.2">𝑚</ci><ci id="alg2.l21.m1.1.1.3.3.cmml" xref="alg2.l21.m1.1.1.3.3">𝑖</ci><ci id="alg2.l21.m1.1.1.3.4.cmml" xref="alg2.l21.m1.1.1.3.4">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l21.m1.1c">m_{mid}</annotation><annotation encoding="application/x-llamapun" id="alg2.l21.m1.1d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT</annotation></semantics></math> by dimension 32 interleave layout

</div>
<div class="ltx_listingline" id="alg2.l22">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l22.1.1.1" style="font-size:80%;">22:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l22.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l22.3">for</span>
</div>
<div class="ltx_listingline" id="alg2.l23">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l23.1.1.1" style="font-size:80%;">23:</span></span>  // Rearrange

</div>
<div class="ltx_listingline" id="alg2.l24">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l24.1.1.1" style="font-size:80%;">24:</span></span>  // GPU Single Thread Execution

</div>
<div class="ltx_listingline" id="alg2.l25">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l25.1.1.1" style="font-size:80%;">25:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l25.2">for</span> <math alttext="i" class="ltx_Math" display="inline" id="alg2.l25.m1.1"><semantics id="alg2.l25.m1.1a"><mi id="alg2.l25.m1.1.1" xref="alg2.l25.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="alg2.l25.m1.1b"><ci id="alg2.l25.m1.1.1.cmml" xref="alg2.l25.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l25.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="alg2.l25.m1.1d">italic_i</annotation></semantics></math> from <math alttext="0" class="ltx_Math" display="inline" id="alg2.l25.m2.1"><semantics id="alg2.l25.m2.1a"><mn id="alg2.l25.m2.1.1" xref="alg2.l25.m2.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="alg2.l25.m2.1b"><cn id="alg2.l25.m2.1.1.cmml" type="integer" xref="alg2.l25.m2.1.1">0</cn></annotation-xml></semantics></math> to <math alttext="|M^{\prime}|-1" class="ltx_Math" display="inline" id="alg2.l25.m3.1"><semantics id="alg2.l25.m3.1a"><mrow id="alg2.l25.m3.1.1" xref="alg2.l25.m3.1.1.cmml"><mrow id="alg2.l25.m3.1.1.1.1" xref="alg2.l25.m3.1.1.1.2.cmml"><mo id="alg2.l25.m3.1.1.1.1.2" stretchy="false" xref="alg2.l25.m3.1.1.1.2.1.cmml">|</mo><msup id="alg2.l25.m3.1.1.1.1.1" xref="alg2.l25.m3.1.1.1.1.1.cmml"><mi id="alg2.l25.m3.1.1.1.1.1.2" xref="alg2.l25.m3.1.1.1.1.1.2.cmml">M</mi><mo id="alg2.l25.m3.1.1.1.1.1.3" xref="alg2.l25.m3.1.1.1.1.1.3.cmml">′</mo></msup><mo id="alg2.l25.m3.1.1.1.1.3" stretchy="false" xref="alg2.l25.m3.1.1.1.2.1.cmml">|</mo></mrow><mo id="alg2.l25.m3.1.1.2" xref="alg2.l25.m3.1.1.2.cmml">−</mo><mn id="alg2.l25.m3.1.1.3" xref="alg2.l25.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg2.l25.m3.1b"><apply id="alg2.l25.m3.1.1.cmml" xref="alg2.l25.m3.1.1"><minus id="alg2.l25.m3.1.1.2.cmml" xref="alg2.l25.m3.1.1.2"></minus><apply id="alg2.l25.m3.1.1.1.2.cmml" xref="alg2.l25.m3.1.1.1.1"><abs id="alg2.l25.m3.1.1.1.2.1.cmml" xref="alg2.l25.m3.1.1.1.1.2"></abs><apply id="alg2.l25.m3.1.1.1.1.1.cmml" xref="alg2.l25.m3.1.1.1.1.1"><csymbol cd="ambiguous" id="alg2.l25.m3.1.1.1.1.1.1.cmml" xref="alg2.l25.m3.1.1.1.1.1">superscript</csymbol><ci id="alg2.l25.m3.1.1.1.1.1.2.cmml" xref="alg2.l25.m3.1.1.1.1.1.2">𝑀</ci><ci id="alg2.l25.m3.1.1.1.1.1.3.cmml" xref="alg2.l25.m3.1.1.1.1.1.3">′</ci></apply></apply><cn id="alg2.l25.m3.1.1.3.cmml" type="integer" xref="alg2.l25.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l25.m3.1c">|M^{\prime}|-1</annotation><annotation encoding="application/x-llamapun" id="alg2.l25.m3.1d">| italic_M start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT | - 1</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg2.l25.3">do</span>
</div>
<div class="ltx_listingline" id="alg2.l26">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l26.1.1.1" style="font-size:80%;">26:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l26.2">if</span> Exceed(<math alttext="m_{i}^{\prime}" class="ltx_Math" display="inline" id="alg2.l26.m1.1"><semantics id="alg2.l26.m1.1a"><msubsup id="alg2.l26.m1.1.1" xref="alg2.l26.m1.1.1.cmml"><mi id="alg2.l26.m1.1.1.2.2" xref="alg2.l26.m1.1.1.2.2.cmml">m</mi><mi id="alg2.l26.m1.1.1.2.3" xref="alg2.l26.m1.1.1.2.3.cmml">i</mi><mo id="alg2.l26.m1.1.1.3" xref="alg2.l26.m1.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg2.l26.m1.1b"><apply id="alg2.l26.m1.1.1.cmml" xref="alg2.l26.m1.1.1"><csymbol cd="ambiguous" id="alg2.l26.m1.1.1.1.cmml" xref="alg2.l26.m1.1.1">superscript</csymbol><apply id="alg2.l26.m1.1.1.2.cmml" xref="alg2.l26.m1.1.1"><csymbol cd="ambiguous" id="alg2.l26.m1.1.1.2.1.cmml" xref="alg2.l26.m1.1.1">subscript</csymbol><ci id="alg2.l26.m1.1.1.2.2.cmml" xref="alg2.l26.m1.1.1.2.2">𝑚</ci><ci id="alg2.l26.m1.1.1.2.3.cmml" xref="alg2.l26.m1.1.1.2.3">𝑖</ci></apply><ci id="alg2.l26.m1.1.1.3.cmml" xref="alg2.l26.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l26.m1.1c">m_{i}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l26.m1.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>) <span class="ltx_text ltx_font_bold" id="alg2.l26.3">then</span>
</div>
<div class="ltx_listingline" id="alg2.l27">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l27.2.1.1" style="font-size:80%;">27:</span></span>        <span class="ltx_text ltx_font_bold" id="alg2.l27.1">Rearrange(<math alttext="m^{\prime}" class="ltx_Math" display="inline" id="alg2.l27.1.m1.1"><semantics id="alg2.l27.1.m1.1a"><msup id="alg2.l27.1.m1.1.1" xref="alg2.l27.1.m1.1.1.cmml"><mi id="alg2.l27.1.m1.1.1.2" xref="alg2.l27.1.m1.1.1.2.cmml">m</mi><mo id="alg2.l27.1.m1.1.1.3" xref="alg2.l27.1.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="alg2.l27.1.m1.1b"><apply id="alg2.l27.1.m1.1.1.cmml" xref="alg2.l27.1.m1.1.1"><csymbol cd="ambiguous" id="alg2.l27.1.m1.1.1.1.cmml" xref="alg2.l27.1.m1.1.1">superscript</csymbol><ci id="alg2.l27.1.m1.1.1.2.cmml" xref="alg2.l27.1.m1.1.1.2">𝑚</ci><ci id="alg2.l27.1.m1.1.1.3.cmml" xref="alg2.l27.1.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l27.1.m1.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l27.1.m1.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>)</span>
</div>
<div class="ltx_listingline" id="alg2.l28">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l28.1.1.1" style="font-size:80%;">28:</span></span>     <span class="ltx_text ltx_font_bold" id="alg2.l28.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l28.3">if</span>
</div>
<div class="ltx_listingline" id="alg2.l29">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l29.1.1.1" style="font-size:80%;">29:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l29.2">end</span> <span class="ltx_text ltx_font_bold" id="alg2.l29.3">for</span>
</div>
<div class="ltx_listingline" id="alg2.l30">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l30.1.1.1" style="font-size:80%;">30:</span></span>  <span class="ltx_text ltx_font_bold" id="alg2.l30.2">return</span>  updated memory block <math alttext="m" class="ltx_Math" display="inline" id="alg2.l30.m1.1"><semantics id="alg2.l30.m1.1a"><mi id="alg2.l30.m1.1.1" xref="alg2.l30.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="alg2.l30.m1.1b"><ci id="alg2.l30.m1.1.1.cmml" xref="alg2.l30.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l30.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="alg2.l30.m1.1d">italic_m</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.3">The entire algorithm relies on the smallest unit memory block <math alttext="m" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mi id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><ci id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_m</annotation></semantics></math>. A vector id list <math alttext="l" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1"><semantics id="S3.SS1.p2.2.m2.1a"><mi id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b"><ci id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">l</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m2.1d">italic_l</annotation></semantics></math> of memory blocks for newly inserted vectors is defined as <math alttext="m^{\prime}" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m3.1"><semantics id="S3.SS1.p2.3.m3.1a"><msup id="S3.SS1.p2.3.m3.1.1" xref="S3.SS1.p2.3.m3.1.1.cmml"><mi id="S3.SS1.p2.3.m3.1.1.2" xref="S3.SS1.p2.3.m3.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.3.m3.1.1.3" xref="S3.SS1.p2.3.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m3.1b"><apply id="S3.SS1.p2.3.m3.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.3.m3.1.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1">superscript</csymbol><ci id="S3.SS1.p2.3.m3.1.1.2.cmml" xref="S3.SS1.p2.3.m3.1.1.2">𝑚</ci><ci id="S3.SS1.p2.3.m3.1.1.3.cmml" xref="S3.SS1.p2.3.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.m3.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.m3.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="m^{\prime}=[m_{i_{0}},m_{i_{1}},...,m_{i_{n}}]\quad\forall i\in l" class="ltx_Math" display="block" id="S3.E1.m1.3"><semantics id="S3.E1.m1.3a"><mrow id="S3.E1.m1.3.3.2" xref="S3.E1.m1.3.3.3.cmml"><mrow id="S3.E1.m1.2.2.1.1" xref="S3.E1.m1.2.2.1.1.cmml"><msup id="S3.E1.m1.2.2.1.1.5" xref="S3.E1.m1.2.2.1.1.5.cmml"><mi id="S3.E1.m1.2.2.1.1.5.2" xref="S3.E1.m1.2.2.1.1.5.2.cmml">m</mi><mo id="S3.E1.m1.2.2.1.1.5.3" xref="S3.E1.m1.2.2.1.1.5.3.cmml">′</mo></msup><mo id="S3.E1.m1.2.2.1.1.4" xref="S3.E1.m1.2.2.1.1.4.cmml">=</mo><mrow id="S3.E1.m1.2.2.1.1.3.3" xref="S3.E1.m1.2.2.1.1.3.4.cmml"><mo id="S3.E1.m1.2.2.1.1.3.3.4" stretchy="false" xref="S3.E1.m1.2.2.1.1.3.4.cmml">[</mo><msub id="S3.E1.m1.2.2.1.1.1.1.1" xref="S3.E1.m1.2.2.1.1.1.1.1.cmml"><mi id="S3.E1.m1.2.2.1.1.1.1.1.2" xref="S3.E1.m1.2.2.1.1.1.1.1.2.cmml">m</mi><msub id="S3.E1.m1.2.2.1.1.1.1.1.3" xref="S3.E1.m1.2.2.1.1.1.1.1.3.cmml"><mi id="S3.E1.m1.2.2.1.1.1.1.1.3.2" xref="S3.E1.m1.2.2.1.1.1.1.1.3.2.cmml">i</mi><mn id="S3.E1.m1.2.2.1.1.1.1.1.3.3" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3.cmml">0</mn></msub></msub><mo id="S3.E1.m1.2.2.1.1.3.3.5" xref="S3.E1.m1.2.2.1.1.3.4.cmml">,</mo><msub id="S3.E1.m1.2.2.1.1.2.2.2" xref="S3.E1.m1.2.2.1.1.2.2.2.cmml"><mi id="S3.E1.m1.2.2.1.1.2.2.2.2" xref="S3.E1.m1.2.2.1.1.2.2.2.2.cmml">m</mi><msub id="S3.E1.m1.2.2.1.1.2.2.2.3" xref="S3.E1.m1.2.2.1.1.2.2.2.3.cmml"><mi id="S3.E1.m1.2.2.1.1.2.2.2.3.2" xref="S3.E1.m1.2.2.1.1.2.2.2.3.2.cmml">i</mi><mn id="S3.E1.m1.2.2.1.1.2.2.2.3.3" xref="S3.E1.m1.2.2.1.1.2.2.2.3.3.cmml">1</mn></msub></msub><mo id="S3.E1.m1.2.2.1.1.3.3.6" xref="S3.E1.m1.2.2.1.1.3.4.cmml">,</mo><mi id="S3.E1.m1.1.1" mathvariant="normal" xref="S3.E1.m1.1.1.cmml">…</mi><mo id="S3.E1.m1.2.2.1.1.3.3.7" xref="S3.E1.m1.2.2.1.1.3.4.cmml">,</mo><msub id="S3.E1.m1.2.2.1.1.3.3.3" xref="S3.E1.m1.2.2.1.1.3.3.3.cmml"><mi id="S3.E1.m1.2.2.1.1.3.3.3.2" xref="S3.E1.m1.2.2.1.1.3.3.3.2.cmml">m</mi><msub id="S3.E1.m1.2.2.1.1.3.3.3.3" xref="S3.E1.m1.2.2.1.1.3.3.3.3.cmml"><mi id="S3.E1.m1.2.2.1.1.3.3.3.3.2" xref="S3.E1.m1.2.2.1.1.3.3.3.3.2.cmml">i</mi><mi id="S3.E1.m1.2.2.1.1.3.3.3.3.3" xref="S3.E1.m1.2.2.1.1.3.3.3.3.3.cmml">n</mi></msub></msub><mo id="S3.E1.m1.2.2.1.1.3.3.8" stretchy="false" xref="S3.E1.m1.2.2.1.1.3.4.cmml">]</mo></mrow></mrow><mspace id="S3.E1.m1.3.3.2.3" width="1.167em" xref="S3.E1.m1.3.3.3a.cmml"></mspace><mrow id="S3.E1.m1.3.3.2.2" xref="S3.E1.m1.3.3.2.2.cmml"><mrow id="S3.E1.m1.3.3.2.2.2" xref="S3.E1.m1.3.3.2.2.2.cmml"><mo id="S3.E1.m1.3.3.2.2.2.1" rspace="0.167em" xref="S3.E1.m1.3.3.2.2.2.1.cmml">∀</mo><mi id="S3.E1.m1.3.3.2.2.2.2" xref="S3.E1.m1.3.3.2.2.2.2.cmml">i</mi></mrow><mo id="S3.E1.m1.3.3.2.2.1" xref="S3.E1.m1.3.3.2.2.1.cmml">∈</mo><mi id="S3.E1.m1.3.3.2.2.3" xref="S3.E1.m1.3.3.2.2.3.cmml">l</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.3b"><apply id="S3.E1.m1.3.3.3.cmml" xref="S3.E1.m1.3.3.2"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3a.cmml" xref="S3.E1.m1.3.3.2.3">formulae-sequence</csymbol><apply id="S3.E1.m1.2.2.1.1.cmml" xref="S3.E1.m1.2.2.1.1"><eq id="S3.E1.m1.2.2.1.1.4.cmml" xref="S3.E1.m1.2.2.1.1.4"></eq><apply id="S3.E1.m1.2.2.1.1.5.cmml" xref="S3.E1.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.5.1.cmml" xref="S3.E1.m1.2.2.1.1.5">superscript</csymbol><ci id="S3.E1.m1.2.2.1.1.5.2.cmml" xref="S3.E1.m1.2.2.1.1.5.2">𝑚</ci><ci id="S3.E1.m1.2.2.1.1.5.3.cmml" xref="S3.E1.m1.2.2.1.1.5.3">′</ci></apply><list id="S3.E1.m1.2.2.1.1.3.4.cmml" xref="S3.E1.m1.2.2.1.1.3.3"><apply id="S3.E1.m1.2.2.1.1.1.1.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.1.1.1.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.1.1.1.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.2">𝑚</ci><apply id="S3.E1.m1.2.2.1.1.1.1.1.3.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.2.2.1.1.1.1.1.3.2">𝑖</ci><cn id="S3.E1.m1.2.2.1.1.1.1.1.3.3.cmml" type="integer" xref="S3.E1.m1.2.2.1.1.1.1.1.3.3">0</cn></apply></apply><apply id="S3.E1.m1.2.2.1.1.2.2.2.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.2.2.2.1.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.2.2.2.2.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.2">𝑚</ci><apply id="S3.E1.m1.2.2.1.1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.2.2.2.3.1.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.3">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.2.2.2.3.2.cmml" xref="S3.E1.m1.2.2.1.1.2.2.2.3.2">𝑖</ci><cn id="S3.E1.m1.2.2.1.1.2.2.2.3.3.cmml" type="integer" xref="S3.E1.m1.2.2.1.1.2.2.2.3.3">1</cn></apply></apply><ci id="S3.E1.m1.1.1.cmml" xref="S3.E1.m1.1.1">…</ci><apply id="S3.E1.m1.2.2.1.1.3.3.3.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.3.3.3.1.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.3.3.3.2.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3.2">𝑚</ci><apply id="S3.E1.m1.2.2.1.1.3.3.3.3.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.1.1.3.3.3.3.1.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3.3">subscript</csymbol><ci id="S3.E1.m1.2.2.1.1.3.3.3.3.2.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3.3.2">𝑖</ci><ci id="S3.E1.m1.2.2.1.1.3.3.3.3.3.cmml" xref="S3.E1.m1.2.2.1.1.3.3.3.3.3">𝑛</ci></apply></apply></list></apply><apply id="S3.E1.m1.3.3.2.2.cmml" xref="S3.E1.m1.3.3.2.2"><in id="S3.E1.m1.3.3.2.2.1.cmml" xref="S3.E1.m1.3.3.2.2.1"></in><apply id="S3.E1.m1.3.3.2.2.2.cmml" xref="S3.E1.m1.3.3.2.2.2"><csymbol cd="latexml" id="S3.E1.m1.3.3.2.2.2.1.cmml" xref="S3.E1.m1.3.3.2.2.2.1">for-all</csymbol><ci id="S3.E1.m1.3.3.2.2.2.2.cmml" xref="S3.E1.m1.3.3.2.2.2.2">𝑖</ci></apply><ci id="S3.E1.m1.3.3.2.2.3.cmml" xref="S3.E1.m1.3.3.2.2.3">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.3c">m^{\prime}=[m_{i_{0}},m_{i_{1}},...,m_{i_{n}}]\quad\forall i\in l</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.3d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = [ italic_m start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , italic_m start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT , … , italic_m start_POSTSUBSCRIPT italic_i start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT ] ∀ italic_i ∈ italic_l</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.12">For each memory block <math alttext="m" class="ltx_Math" display="inline" id="S3.SS1.p2.4.m1.1"><semantics id="S3.SS1.p2.4.m1.1a"><mi id="S3.SS1.p2.4.m1.1.1" xref="S3.SS1.p2.4.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.m1.1b"><ci id="S3.SS1.p2.4.m1.1.1.cmml" xref="S3.SS1.p2.4.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.4.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.4.m1.1d">italic_m</annotation></semantics></math>, it may contain <math alttext="|ml|" class="ltx_Math" display="inline" id="S3.SS1.p2.5.m2.1"><semantics id="S3.SS1.p2.5.m2.1a"><mrow id="S3.SS1.p2.5.m2.1.1.1" xref="S3.SS1.p2.5.m2.1.1.2.cmml"><mo id="S3.SS1.p2.5.m2.1.1.1.2" stretchy="false" xref="S3.SS1.p2.5.m2.1.1.2.1.cmml">|</mo><mrow id="S3.SS1.p2.5.m2.1.1.1.1" xref="S3.SS1.p2.5.m2.1.1.1.1.cmml"><mi id="S3.SS1.p2.5.m2.1.1.1.1.2" xref="S3.SS1.p2.5.m2.1.1.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.5.m2.1.1.1.1.1" xref="S3.SS1.p2.5.m2.1.1.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.5.m2.1.1.1.1.3" xref="S3.SS1.p2.5.m2.1.1.1.1.3.cmml">l</mi></mrow><mo id="S3.SS1.p2.5.m2.1.1.1.3" stretchy="false" xref="S3.SS1.p2.5.m2.1.1.2.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.m2.1b"><apply id="S3.SS1.p2.5.m2.1.1.2.cmml" xref="S3.SS1.p2.5.m2.1.1.1"><abs id="S3.SS1.p2.5.m2.1.1.2.1.cmml" xref="S3.SS1.p2.5.m2.1.1.1.2"></abs><apply id="S3.SS1.p2.5.m2.1.1.1.1.cmml" xref="S3.SS1.p2.5.m2.1.1.1.1"><times id="S3.SS1.p2.5.m2.1.1.1.1.1.cmml" xref="S3.SS1.p2.5.m2.1.1.1.1.1"></times><ci id="S3.SS1.p2.5.m2.1.1.1.1.2.cmml" xref="S3.SS1.p2.5.m2.1.1.1.1.2">𝑚</ci><ci id="S3.SS1.p2.5.m2.1.1.1.1.3.cmml" xref="S3.SS1.p2.5.m2.1.1.1.1.3">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.5.m2.1c">|ml|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.5.m2.1d">| italic_m italic_l |</annotation></semantics></math> vectors, which of limit <math alttext="T_{m}" class="ltx_Math" display="inline" id="S3.SS1.p2.6.m3.1"><semantics id="S3.SS1.p2.6.m3.1a"><msub id="S3.SS1.p2.6.m3.1.1" xref="S3.SS1.p2.6.m3.1.1.cmml"><mi id="S3.SS1.p2.6.m3.1.1.2" xref="S3.SS1.p2.6.m3.1.1.2.cmml">T</mi><mi id="S3.SS1.p2.6.m3.1.1.3" xref="S3.SS1.p2.6.m3.1.1.3.cmml">m</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.m3.1b"><apply id="S3.SS1.p2.6.m3.1.1.cmml" xref="S3.SS1.p2.6.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.6.m3.1.1.1.cmml" xref="S3.SS1.p2.6.m3.1.1">subscript</csymbol><ci id="S3.SS1.p2.6.m3.1.1.2.cmml" xref="S3.SS1.p2.6.m3.1.1.2">𝑇</ci><ci id="S3.SS1.p2.6.m3.1.1.3.cmml" xref="S3.SS1.p2.6.m3.1.1.3">𝑚</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.6.m3.1c">T_{m}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.6.m3.1d">italic_T start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math> can be pre-set by users. The structure of a memory block is also illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S1.F1" title="Figure 1 ‣ 1. Introduction ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>b. It consists of a header <math alttext="mh" class="ltx_Math" display="inline" id="S3.SS1.p2.7.m4.1"><semantics id="S3.SS1.p2.7.m4.1a"><mrow id="S3.SS1.p2.7.m4.1.1" xref="S3.SS1.p2.7.m4.1.1.cmml"><mi id="S3.SS1.p2.7.m4.1.1.2" xref="S3.SS1.p2.7.m4.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.7.m4.1.1.1" xref="S3.SS1.p2.7.m4.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.7.m4.1.1.3" xref="S3.SS1.p2.7.m4.1.1.3.cmml">h</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.m4.1b"><apply id="S3.SS1.p2.7.m4.1.1.cmml" xref="S3.SS1.p2.7.m4.1.1"><times id="S3.SS1.p2.7.m4.1.1.1.cmml" xref="S3.SS1.p2.7.m4.1.1.1"></times><ci id="S3.SS1.p2.7.m4.1.1.2.cmml" xref="S3.SS1.p2.7.m4.1.1.2">𝑚</ci><ci id="S3.SS1.p2.7.m4.1.1.3.cmml" xref="S3.SS1.p2.7.m4.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.7.m4.1c">mh</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.7.m4.1d">italic_m italic_h</annotation></semantics></math>, core id list <math alttext="ml" class="ltx_Math" display="inline" id="S3.SS1.p2.8.m5.1"><semantics id="S3.SS1.p2.8.m5.1a"><mrow id="S3.SS1.p2.8.m5.1.1" xref="S3.SS1.p2.8.m5.1.1.cmml"><mi id="S3.SS1.p2.8.m5.1.1.2" xref="S3.SS1.p2.8.m5.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.8.m5.1.1.1" xref="S3.SS1.p2.8.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.8.m5.1.1.3" xref="S3.SS1.p2.8.m5.1.1.3.cmml">l</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.8.m5.1b"><apply id="S3.SS1.p2.8.m5.1.1.cmml" xref="S3.SS1.p2.8.m5.1.1"><times id="S3.SS1.p2.8.m5.1.1.1.cmml" xref="S3.SS1.p2.8.m5.1.1.1"></times><ci id="S3.SS1.p2.8.m5.1.1.2.cmml" xref="S3.SS1.p2.8.m5.1.1.2">𝑚</ci><ci id="S3.SS1.p2.8.m5.1.1.3.cmml" xref="S3.SS1.p2.8.m5.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.8.m5.1c">ml</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.8.m5.1d">italic_m italic_l</annotation></semantics></math>, and core vectors <math alttext="mv" class="ltx_Math" display="inline" id="S3.SS1.p2.9.m6.1"><semantics id="S3.SS1.p2.9.m6.1a"><mrow id="S3.SS1.p2.9.m6.1.1" xref="S3.SS1.p2.9.m6.1.1.cmml"><mi id="S3.SS1.p2.9.m6.1.1.2" xref="S3.SS1.p2.9.m6.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.9.m6.1.1.1" xref="S3.SS1.p2.9.m6.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.9.m6.1.1.3" xref="S3.SS1.p2.9.m6.1.1.3.cmml">v</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.9.m6.1b"><apply id="S3.SS1.p2.9.m6.1.1.cmml" xref="S3.SS1.p2.9.m6.1.1"><times id="S3.SS1.p2.9.m6.1.1.1.cmml" xref="S3.SS1.p2.9.m6.1.1.1"></times><ci id="S3.SS1.p2.9.m6.1.1.2.cmml" xref="S3.SS1.p2.9.m6.1.1.2">𝑚</ci><ci id="S3.SS1.p2.9.m6.1.1.3.cmml" xref="S3.SS1.p2.9.m6.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.9.m6.1c">mv</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.9.m6.1d">italic_m italic_v</annotation></semantics></math>. The header <math alttext="mh" class="ltx_Math" display="inline" id="S3.SS1.p2.10.m7.1"><semantics id="S3.SS1.p2.10.m7.1a"><mrow id="S3.SS1.p2.10.m7.1.1" xref="S3.SS1.p2.10.m7.1.1.cmml"><mi id="S3.SS1.p2.10.m7.1.1.2" xref="S3.SS1.p2.10.m7.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.10.m7.1.1.1" xref="S3.SS1.p2.10.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.10.m7.1.1.3" xref="S3.SS1.p2.10.m7.1.1.3.cmml">h</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.10.m7.1b"><apply id="S3.SS1.p2.10.m7.1.1.cmml" xref="S3.SS1.p2.10.m7.1.1"><times id="S3.SS1.p2.10.m7.1.1.1.cmml" xref="S3.SS1.p2.10.m7.1.1.1"></times><ci id="S3.SS1.p2.10.m7.1.1.2.cmml" xref="S3.SS1.p2.10.m7.1.1.2">𝑚</ci><ci id="S3.SS1.p2.10.m7.1.1.3.cmml" xref="S3.SS1.p2.10.m7.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.10.m7.1c">mh</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.10.m7.1d">italic_m italic_h</annotation></semantics></math> contains important information that indicates the address of the prev_header, next_header and block_info (vector capacity, vector size, etc.). The core id list <math alttext="ml" class="ltx_Math" display="inline" id="S3.SS1.p2.11.m8.1"><semantics id="S3.SS1.p2.11.m8.1a"><mrow id="S3.SS1.p2.11.m8.1.1" xref="S3.SS1.p2.11.m8.1.1.cmml"><mi id="S3.SS1.p2.11.m8.1.1.2" xref="S3.SS1.p2.11.m8.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.11.m8.1.1.1" xref="S3.SS1.p2.11.m8.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.11.m8.1.1.3" xref="S3.SS1.p2.11.m8.1.1.3.cmml">l</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.11.m8.1b"><apply id="S3.SS1.p2.11.m8.1.1.cmml" xref="S3.SS1.p2.11.m8.1.1"><times id="S3.SS1.p2.11.m8.1.1.1.cmml" xref="S3.SS1.p2.11.m8.1.1.1"></times><ci id="S3.SS1.p2.11.m8.1.1.2.cmml" xref="S3.SS1.p2.11.m8.1.1.2">𝑚</ci><ci id="S3.SS1.p2.11.m8.1.1.3.cmml" xref="S3.SS1.p2.11.m8.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.11.m8.1c">ml</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.11.m8.1d">italic_m italic_l</annotation></semantics></math> saves the vector ids belong to the memory block of this cluster. The core vectors <math alttext="mv" class="ltx_Math" display="inline" id="S3.SS1.p2.12.m9.1"><semantics id="S3.SS1.p2.12.m9.1a"><mrow id="S3.SS1.p2.12.m9.1.1" xref="S3.SS1.p2.12.m9.1.1.cmml"><mi id="S3.SS1.p2.12.m9.1.1.2" xref="S3.SS1.p2.12.m9.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.12.m9.1.1.1" xref="S3.SS1.p2.12.m9.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.12.m9.1.1.3" xref="S3.SS1.p2.12.m9.1.1.3.cmml">v</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.12.m9.1b"><apply id="S3.SS1.p2.12.m9.1.1.cmml" xref="S3.SS1.p2.12.m9.1.1"><times id="S3.SS1.p2.12.m9.1.1.1.cmml" xref="S3.SS1.p2.12.m9.1.1.1"></times><ci id="S3.SS1.p2.12.m9.1.1.2.cmml" xref="S3.SS1.p2.12.m9.1.1.2">𝑚</ci><ci id="S3.SS1.p2.12.m9.1.1.3.cmml" xref="S3.SS1.p2.12.m9.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.12.m9.1c">mv</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.12.m9.1d">italic_m italic_v</annotation></semantics></math> in each memory block are arranged interleaved by 32 dimensions, similar to Faiss/Raft, determined by the thread number in a GPU warp to enable collapsed read instructions.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="mv=[mv_{0}^{0},mv_{0}^{1},...,mv_{0}^{31},mv_{1}^{0},...,mv_{d}^{i},...]\ %
\forall d\in D,i\in ml" class="ltx_Math" display="block" id="S3.E2.m1.5"><semantics id="S3.E2.m1.5a"><mrow id="S3.E2.m1.5.5.2" xref="S3.E2.m1.5.5.3.cmml"><mrow id="S3.E2.m1.4.4.1.1" xref="S3.E2.m1.4.4.1.1.cmml"><mrow id="S3.E2.m1.4.4.1.1.7" xref="S3.E2.m1.4.4.1.1.7.cmml"><mi id="S3.E2.m1.4.4.1.1.7.2" xref="S3.E2.m1.4.4.1.1.7.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.7.1" xref="S3.E2.m1.4.4.1.1.7.1.cmml">⁢</mo><mi id="S3.E2.m1.4.4.1.1.7.3" xref="S3.E2.m1.4.4.1.1.7.3.cmml">v</mi></mrow><mo id="S3.E2.m1.4.4.1.1.8" xref="S3.E2.m1.4.4.1.1.8.cmml">=</mo><mrow id="S3.E2.m1.4.4.1.1.5" xref="S3.E2.m1.4.4.1.1.5.cmml"><mrow id="S3.E2.m1.4.4.1.1.5.5.5" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml"><mo id="S3.E2.m1.4.4.1.1.5.5.5.6" stretchy="false" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">[</mo><mrow id="S3.E2.m1.4.4.1.1.1.1.1.1" xref="S3.E2.m1.4.4.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.4.4.1.1.1.1.1.1.2" xref="S3.E2.m1.4.4.1.1.1.1.1.1.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.1.1.1.1.1" xref="S3.E2.m1.4.4.1.1.1.1.1.1.1.cmml">⁢</mo><msubsup id="S3.E2.m1.4.4.1.1.1.1.1.1.3" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.cmml"><mi id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.2" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.2.cmml">v</mi><mn id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.3" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.3.cmml">0</mn><mn id="S3.E2.m1.4.4.1.1.1.1.1.1.3.3" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.3.cmml">0</mn></msubsup></mrow><mo id="S3.E2.m1.4.4.1.1.5.5.5.7" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mrow id="S3.E2.m1.4.4.1.1.2.2.2.2" xref="S3.E2.m1.4.4.1.1.2.2.2.2.cmml"><mi id="S3.E2.m1.4.4.1.1.2.2.2.2.2" xref="S3.E2.m1.4.4.1.1.2.2.2.2.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.2.2.2.2.1" xref="S3.E2.m1.4.4.1.1.2.2.2.2.1.cmml">⁢</mo><msubsup id="S3.E2.m1.4.4.1.1.2.2.2.2.3" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.cmml"><mi id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.2" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.2.cmml">v</mi><mn id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.3" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.3.cmml">0</mn><mn id="S3.E2.m1.4.4.1.1.2.2.2.2.3.3" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.3.cmml">1</mn></msubsup></mrow><mo id="S3.E2.m1.4.4.1.1.5.5.5.8" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mi id="S3.E2.m1.1.1" mathvariant="normal" xref="S3.E2.m1.1.1.cmml">…</mi><mo id="S3.E2.m1.4.4.1.1.5.5.5.9" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mrow id="S3.E2.m1.4.4.1.1.3.3.3.3" xref="S3.E2.m1.4.4.1.1.3.3.3.3.cmml"><mi id="S3.E2.m1.4.4.1.1.3.3.3.3.2" xref="S3.E2.m1.4.4.1.1.3.3.3.3.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.3.3.3.3.1" xref="S3.E2.m1.4.4.1.1.3.3.3.3.1.cmml">⁢</mo><msubsup id="S3.E2.m1.4.4.1.1.3.3.3.3.3" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.cmml"><mi id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.2" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.2.cmml">v</mi><mn id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.3" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.3.cmml">0</mn><mn id="S3.E2.m1.4.4.1.1.3.3.3.3.3.3" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.3.cmml">31</mn></msubsup></mrow><mo id="S3.E2.m1.4.4.1.1.5.5.5.10" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mrow id="S3.E2.m1.4.4.1.1.4.4.4.4" xref="S3.E2.m1.4.4.1.1.4.4.4.4.cmml"><mi id="S3.E2.m1.4.4.1.1.4.4.4.4.2" xref="S3.E2.m1.4.4.1.1.4.4.4.4.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.4.4.4.4.1" xref="S3.E2.m1.4.4.1.1.4.4.4.4.1.cmml">⁢</mo><msubsup id="S3.E2.m1.4.4.1.1.4.4.4.4.3" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.cmml"><mi id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.2" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.2.cmml">v</mi><mn id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.3" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.3.cmml">1</mn><mn id="S3.E2.m1.4.4.1.1.4.4.4.4.3.3" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.3.cmml">0</mn></msubsup></mrow><mo id="S3.E2.m1.4.4.1.1.5.5.5.11" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mi id="S3.E2.m1.2.2" mathvariant="normal" xref="S3.E2.m1.2.2.cmml">…</mi><mo id="S3.E2.m1.4.4.1.1.5.5.5.12" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mrow id="S3.E2.m1.4.4.1.1.5.5.5.5" xref="S3.E2.m1.4.4.1.1.5.5.5.5.cmml"><mi id="S3.E2.m1.4.4.1.1.5.5.5.5.2" xref="S3.E2.m1.4.4.1.1.5.5.5.5.2.cmml">m</mi><mo id="S3.E2.m1.4.4.1.1.5.5.5.5.1" xref="S3.E2.m1.4.4.1.1.5.5.5.5.1.cmml">⁢</mo><msubsup id="S3.E2.m1.4.4.1.1.5.5.5.5.3" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.cmml"><mi id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.2" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.2.cmml">v</mi><mi id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.3" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.3.cmml">d</mi><mi id="S3.E2.m1.4.4.1.1.5.5.5.5.3.3" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.3.cmml">i</mi></msubsup></mrow><mo id="S3.E2.m1.4.4.1.1.5.5.5.13" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">,</mo><mi id="S3.E2.m1.3.3" mathvariant="normal" xref="S3.E2.m1.3.3.cmml">…</mi><mo id="S3.E2.m1.4.4.1.1.5.5.5.14" stretchy="false" xref="S3.E2.m1.4.4.1.1.5.5.6.cmml">]</mo></mrow><mo id="S3.E2.m1.4.4.1.1.5.6" lspace="0.667em" xref="S3.E2.m1.4.4.1.1.5.6.cmml">⁢</mo><mrow id="S3.E2.m1.4.4.1.1.5.7" xref="S3.E2.m1.4.4.1.1.5.7.cmml"><mo id="S3.E2.m1.4.4.1.1.5.7.1" rspace="0.167em" xref="S3.E2.m1.4.4.1.1.5.7.1.cmml">∀</mo><mi id="S3.E2.m1.4.4.1.1.5.7.2" xref="S3.E2.m1.4.4.1.1.5.7.2.cmml">d</mi></mrow></mrow><mo id="S3.E2.m1.4.4.1.1.9" xref="S3.E2.m1.4.4.1.1.9.cmml">∈</mo><mi id="S3.E2.m1.4.4.1.1.10" xref="S3.E2.m1.4.4.1.1.10.cmml">D</mi></mrow><mo id="S3.E2.m1.5.5.2.3" xref="S3.E2.m1.5.5.3a.cmml">,</mo><mrow id="S3.E2.m1.5.5.2.2" xref="S3.E2.m1.5.5.2.2.cmml"><mi id="S3.E2.m1.5.5.2.2.2" xref="S3.E2.m1.5.5.2.2.2.cmml">i</mi><mo id="S3.E2.m1.5.5.2.2.1" xref="S3.E2.m1.5.5.2.2.1.cmml">∈</mo><mrow id="S3.E2.m1.5.5.2.2.3" xref="S3.E2.m1.5.5.2.2.3.cmml"><mi id="S3.E2.m1.5.5.2.2.3.2" xref="S3.E2.m1.5.5.2.2.3.2.cmml">m</mi><mo id="S3.E2.m1.5.5.2.2.3.1" xref="S3.E2.m1.5.5.2.2.3.1.cmml">⁢</mo><mi id="S3.E2.m1.5.5.2.2.3.3" xref="S3.E2.m1.5.5.2.2.3.3.cmml">l</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.5b"><apply id="S3.E2.m1.5.5.3.cmml" xref="S3.E2.m1.5.5.2"><csymbol cd="ambiguous" id="S3.E2.m1.5.5.3a.cmml" xref="S3.E2.m1.5.5.2.3">formulae-sequence</csymbol><apply id="S3.E2.m1.4.4.1.1.cmml" xref="S3.E2.m1.4.4.1.1"><and id="S3.E2.m1.4.4.1.1a.cmml" xref="S3.E2.m1.4.4.1.1"></and><apply id="S3.E2.m1.4.4.1.1b.cmml" xref="S3.E2.m1.4.4.1.1"><eq id="S3.E2.m1.4.4.1.1.8.cmml" xref="S3.E2.m1.4.4.1.1.8"></eq><apply id="S3.E2.m1.4.4.1.1.7.cmml" xref="S3.E2.m1.4.4.1.1.7"><times id="S3.E2.m1.4.4.1.1.7.1.cmml" xref="S3.E2.m1.4.4.1.1.7.1"></times><ci id="S3.E2.m1.4.4.1.1.7.2.cmml" xref="S3.E2.m1.4.4.1.1.7.2">𝑚</ci><ci id="S3.E2.m1.4.4.1.1.7.3.cmml" xref="S3.E2.m1.4.4.1.1.7.3">𝑣</ci></apply><apply id="S3.E2.m1.4.4.1.1.5.cmml" xref="S3.E2.m1.4.4.1.1.5"><times id="S3.E2.m1.4.4.1.1.5.6.cmml" xref="S3.E2.m1.4.4.1.1.5.6"></times><list id="S3.E2.m1.4.4.1.1.5.5.6.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5"><apply id="S3.E2.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1"><times id="S3.E2.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.1"></times><ci id="S3.E2.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.2">𝑚</ci><apply id="S3.E2.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3">superscript</csymbol><apply id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.2">𝑣</ci><cn id="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.2.3">0</cn></apply><cn id="S3.E2.m1.4.4.1.1.1.1.1.1.3.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.1.1.1.1.3.3">0</cn></apply></apply><apply id="S3.E2.m1.4.4.1.1.2.2.2.2.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2"><times id="S3.E2.m1.4.4.1.1.2.2.2.2.1.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.1"></times><ci id="S3.E2.m1.4.4.1.1.2.2.2.2.2.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.2">𝑚</ci><apply id="S3.E2.m1.4.4.1.1.2.2.2.2.3.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.2.2.2.2.3.1.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3">superscript</csymbol><apply id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.1.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3">subscript</csymbol><ci id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.2.cmml" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.2">𝑣</ci><cn id="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.2.3">0</cn></apply><cn id="S3.E2.m1.4.4.1.1.2.2.2.2.3.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.2.2.2.2.3.3">1</cn></apply></apply><ci id="S3.E2.m1.1.1.cmml" xref="S3.E2.m1.1.1">…</ci><apply id="S3.E2.m1.4.4.1.1.3.3.3.3.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3"><times id="S3.E2.m1.4.4.1.1.3.3.3.3.1.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.1"></times><ci id="S3.E2.m1.4.4.1.1.3.3.3.3.2.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.2">𝑚</ci><apply id="S3.E2.m1.4.4.1.1.3.3.3.3.3.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.3.3.3.3.3.1.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3">superscript</csymbol><apply id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.1.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3">subscript</csymbol><ci id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.2.cmml" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.2">𝑣</ci><cn id="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.2.3">0</cn></apply><cn id="S3.E2.m1.4.4.1.1.3.3.3.3.3.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.3.3.3.3.3.3">31</cn></apply></apply><apply id="S3.E2.m1.4.4.1.1.4.4.4.4.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4"><times id="S3.E2.m1.4.4.1.1.4.4.4.4.1.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.1"></times><ci id="S3.E2.m1.4.4.1.1.4.4.4.4.2.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.2">𝑚</ci><apply id="S3.E2.m1.4.4.1.1.4.4.4.4.3.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.4.4.4.4.3.1.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3">superscript</csymbol><apply id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.1.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3">subscript</csymbol><ci id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.2.cmml" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.2">𝑣</ci><cn id="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.2.3">1</cn></apply><cn id="S3.E2.m1.4.4.1.1.4.4.4.4.3.3.cmml" type="integer" xref="S3.E2.m1.4.4.1.1.4.4.4.4.3.3">0</cn></apply></apply><ci id="S3.E2.m1.2.2.cmml" xref="S3.E2.m1.2.2">…</ci><apply id="S3.E2.m1.4.4.1.1.5.5.5.5.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5"><times id="S3.E2.m1.4.4.1.1.5.5.5.5.1.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.1"></times><ci id="S3.E2.m1.4.4.1.1.5.5.5.5.2.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.2">𝑚</ci><apply id="S3.E2.m1.4.4.1.1.5.5.5.5.3.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.5.5.5.5.3.1.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3">superscript</csymbol><apply id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.1.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3">subscript</csymbol><ci id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.2.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.2">𝑣</ci><ci id="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.3.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.2.3">𝑑</ci></apply><ci id="S3.E2.m1.4.4.1.1.5.5.5.5.3.3.cmml" xref="S3.E2.m1.4.4.1.1.5.5.5.5.3.3">𝑖</ci></apply></apply><ci id="S3.E2.m1.3.3.cmml" xref="S3.E2.m1.3.3">…</ci></list><apply id="S3.E2.m1.4.4.1.1.5.7.cmml" xref="S3.E2.m1.4.4.1.1.5.7"><csymbol cd="latexml" id="S3.E2.m1.4.4.1.1.5.7.1.cmml" xref="S3.E2.m1.4.4.1.1.5.7.1">for-all</csymbol><ci id="S3.E2.m1.4.4.1.1.5.7.2.cmml" xref="S3.E2.m1.4.4.1.1.5.7.2">𝑑</ci></apply></apply></apply><apply id="S3.E2.m1.4.4.1.1c.cmml" xref="S3.E2.m1.4.4.1.1"><in id="S3.E2.m1.4.4.1.1.9.cmml" xref="S3.E2.m1.4.4.1.1.9"></in><share href="https://arxiv.org/html/2408.02937v1#S3.E2.m1.4.4.1.1.5.cmml" id="S3.E2.m1.4.4.1.1d.cmml" xref="S3.E2.m1.4.4.1.1"></share><ci id="S3.E2.m1.4.4.1.1.10.cmml" xref="S3.E2.m1.4.4.1.1.10">𝐷</ci></apply></apply><apply id="S3.E2.m1.5.5.2.2.cmml" xref="S3.E2.m1.5.5.2.2"><in id="S3.E2.m1.5.5.2.2.1.cmml" xref="S3.E2.m1.5.5.2.2.1"></in><ci id="S3.E2.m1.5.5.2.2.2.cmml" xref="S3.E2.m1.5.5.2.2.2">𝑖</ci><apply id="S3.E2.m1.5.5.2.2.3.cmml" xref="S3.E2.m1.5.5.2.2.3"><times id="S3.E2.m1.5.5.2.2.3.1.cmml" xref="S3.E2.m1.5.5.2.2.3.1"></times><ci id="S3.E2.m1.5.5.2.2.3.2.cmml" xref="S3.E2.m1.5.5.2.2.3.2">𝑚</ci><ci id="S3.E2.m1.5.5.2.2.3.3.cmml" xref="S3.E2.m1.5.5.2.2.3.3">𝑙</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.5c">mv=[mv_{0}^{0},mv_{0}^{1},...,mv_{0}^{31},mv_{1}^{0},...,mv_{d}^{i},...]\ %
\forall d\in D,i\in ml</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.5d">italic_m italic_v = [ italic_m italic_v start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT , italic_m italic_v start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT , … , italic_m italic_v start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 31 end_POSTSUPERSCRIPT , italic_m italic_v start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT , … , italic_m italic_v start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT , … ] ∀ italic_d ∈ italic_D , italic_i ∈ italic_m italic_l</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.20">where <math alttext="D" class="ltx_Math" display="inline" id="S3.SS1.p2.13.m1.1"><semantics id="S3.SS1.p2.13.m1.1a"><mi id="S3.SS1.p2.13.m1.1.1" xref="S3.SS1.p2.13.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.13.m1.1b"><ci id="S3.SS1.p2.13.m1.1.1.cmml" xref="S3.SS1.p2.13.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.13.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.13.m1.1d">italic_D</annotation></semantics></math> is the dimension of the single vector. When a new vector arrives, the algorithm will first call <span class="ltx_text ltx_font_bold" id="S3.SS1.p2.20.1">Insertion</span> to dynamically insert the vector into the memory block. When executing insertion, the algorithm is executed parallel on new coming online vectors to get the maximum parallel performance. We first calculate the belonged cluster of newly inserted vector followed by ivfflat and ivfpq (line 5) and then calculate whether this vector should be added to a new linked memory block or an existing memory block represented by did (line 6). When vectors need to be added to a new memory block because the existing block is full, conflicts can occur in a multi-threaded environment, potentially causing issues with concurrent access. So we designed a lock-free allocation method <cite class="ltx_cite ltx_citemacro_citep">(Huang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib9" title="">2010</a>)</cite>. We first find the location of the newly inserted vector, which is determined by memory block id <math alttext="mid" class="ltx_Math" display="inline" id="S3.SS1.p2.14.m2.1"><semantics id="S3.SS1.p2.14.m2.1a"><mrow id="S3.SS1.p2.14.m2.1.1" xref="S3.SS1.p2.14.m2.1.1.cmml"><mi id="S3.SS1.p2.14.m2.1.1.2" xref="S3.SS1.p2.14.m2.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.14.m2.1.1.1" xref="S3.SS1.p2.14.m2.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.14.m2.1.1.3" xref="S3.SS1.p2.14.m2.1.1.3.cmml">i</mi><mo id="S3.SS1.p2.14.m2.1.1.1a" xref="S3.SS1.p2.14.m2.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.14.m2.1.1.4" xref="S3.SS1.p2.14.m2.1.1.4.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.14.m2.1b"><apply id="S3.SS1.p2.14.m2.1.1.cmml" xref="S3.SS1.p2.14.m2.1.1"><times id="S3.SS1.p2.14.m2.1.1.1.cmml" xref="S3.SS1.p2.14.m2.1.1.1"></times><ci id="S3.SS1.p2.14.m2.1.1.2.cmml" xref="S3.SS1.p2.14.m2.1.1.2">𝑚</ci><ci id="S3.SS1.p2.14.m2.1.1.3.cmml" xref="S3.SS1.p2.14.m2.1.1.3">𝑖</ci><ci id="S3.SS1.p2.14.m2.1.1.4.cmml" xref="S3.SS1.p2.14.m2.1.1.4">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.14.m2.1c">mid</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.14.m2.1d">italic_m italic_i italic_d</annotation></semantics></math> and offset in this memory block <math alttext="mo\!f\!f" class="ltx_Math" display="inline" id="S3.SS1.p2.15.m3.1"><semantics id="S3.SS1.p2.15.m3.1a"><mrow id="S3.SS1.p2.15.m3.1.1" xref="S3.SS1.p2.15.m3.1.1.cmml"><mi id="S3.SS1.p2.15.m3.1.1.2" xref="S3.SS1.p2.15.m3.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.15.m3.1.1.1" xref="S3.SS1.p2.15.m3.1.1.1.cmml">⁢</mo><mpadded width="0.315em"><mi id="S3.SS1.p2.15.m3.1.1.3" xref="S3.SS1.p2.15.m3.1.1.3.cmml">o</mi></mpadded><mo id="S3.SS1.p2.15.m3.1.1.1a" xref="S3.SS1.p2.15.m3.1.1.1.cmml">⁢</mo><mpadded width="0.427em"><mi id="S3.SS1.p2.15.m3.1.1.4" xref="S3.SS1.p2.15.m3.1.1.4.cmml">f</mi></mpadded><mo id="S3.SS1.p2.15.m3.1.1.1b" xref="S3.SS1.p2.15.m3.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.15.m3.1.1.5" xref="S3.SS1.p2.15.m3.1.1.5.cmml">f</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.15.m3.1b"><apply id="S3.SS1.p2.15.m3.1.1.cmml" xref="S3.SS1.p2.15.m3.1.1"><times id="S3.SS1.p2.15.m3.1.1.1.cmml" xref="S3.SS1.p2.15.m3.1.1.1"></times><ci id="S3.SS1.p2.15.m3.1.1.2.cmml" xref="S3.SS1.p2.15.m3.1.1.2">𝑚</ci><ci id="S3.SS1.p2.15.m3.1.1.3.cmml" xref="S3.SS1.p2.15.m3.1.1.3">𝑜</ci><ci id="S3.SS1.p2.15.m3.1.1.4.cmml" xref="S3.SS1.p2.15.m3.1.1.4">𝑓</ci><ci id="S3.SS1.p2.15.m3.1.1.5.cmml" xref="S3.SS1.p2.15.m3.1.1.5">𝑓</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.15.m3.1c">mo\!f\!f</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.15.m3.1d">italic_m italic_o italic_f italic_f</annotation></semantics></math> by using an atomic value indicating the length of vector lists <math alttext="nl" class="ltx_Math" display="inline" id="S3.SS1.p2.16.m4.1"><semantics id="S3.SS1.p2.16.m4.1a"><mrow id="S3.SS1.p2.16.m4.1.1" xref="S3.SS1.p2.16.m4.1.1.cmml"><mi id="S3.SS1.p2.16.m4.1.1.2" xref="S3.SS1.p2.16.m4.1.1.2.cmml">n</mi><mo id="S3.SS1.p2.16.m4.1.1.1" xref="S3.SS1.p2.16.m4.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.16.m4.1.1.3" xref="S3.SS1.p2.16.m4.1.1.3.cmml">l</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.16.m4.1b"><apply id="S3.SS1.p2.16.m4.1.1.cmml" xref="S3.SS1.p2.16.m4.1.1"><times id="S3.SS1.p2.16.m4.1.1.1.cmml" xref="S3.SS1.p2.16.m4.1.1.1"></times><ci id="S3.SS1.p2.16.m4.1.1.2.cmml" xref="S3.SS1.p2.16.m4.1.1.2">𝑛</ci><ci id="S3.SS1.p2.16.m4.1.1.3.cmml" xref="S3.SS1.p2.16.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.16.m4.1c">nl</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.16.m4.1d">italic_n italic_l</annotation></semantics></math> (line 6 - 8). Then, for threads that need to allocate a new memory block, we call allocation of <math alttext="m_{mid}" class="ltx_Math" display="inline" id="S3.SS1.p2.17.m5.1"><semantics id="S3.SS1.p2.17.m5.1a"><msub id="S3.SS1.p2.17.m5.1.1" xref="S3.SS1.p2.17.m5.1.1.cmml"><mi id="S3.SS1.p2.17.m5.1.1.2" xref="S3.SS1.p2.17.m5.1.1.2.cmml">m</mi><mrow id="S3.SS1.p2.17.m5.1.1.3" xref="S3.SS1.p2.17.m5.1.1.3.cmml"><mi id="S3.SS1.p2.17.m5.1.1.3.2" xref="S3.SS1.p2.17.m5.1.1.3.2.cmml">m</mi><mo id="S3.SS1.p2.17.m5.1.1.3.1" xref="S3.SS1.p2.17.m5.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p2.17.m5.1.1.3.3" xref="S3.SS1.p2.17.m5.1.1.3.3.cmml">i</mi><mo id="S3.SS1.p2.17.m5.1.1.3.1a" xref="S3.SS1.p2.17.m5.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p2.17.m5.1.1.3.4" xref="S3.SS1.p2.17.m5.1.1.3.4.cmml">d</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.17.m5.1b"><apply id="S3.SS1.p2.17.m5.1.1.cmml" xref="S3.SS1.p2.17.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.17.m5.1.1.1.cmml" xref="S3.SS1.p2.17.m5.1.1">subscript</csymbol><ci id="S3.SS1.p2.17.m5.1.1.2.cmml" xref="S3.SS1.p2.17.m5.1.1.2">𝑚</ci><apply id="S3.SS1.p2.17.m5.1.1.3.cmml" xref="S3.SS1.p2.17.m5.1.1.3"><times id="S3.SS1.p2.17.m5.1.1.3.1.cmml" xref="S3.SS1.p2.17.m5.1.1.3.1"></times><ci id="S3.SS1.p2.17.m5.1.1.3.2.cmml" xref="S3.SS1.p2.17.m5.1.1.3.2">𝑚</ci><ci id="S3.SS1.p2.17.m5.1.1.3.3.cmml" xref="S3.SS1.p2.17.m5.1.1.3.3">𝑖</ci><ci id="S3.SS1.p2.17.m5.1.1.3.4.cmml" xref="S3.SS1.p2.17.m5.1.1.3.4">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.17.m5.1c">m_{mid}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.17.m5.1d">italic_m start_POSTSUBSCRIPT italic_m italic_i italic_d end_POSTSUBSCRIPT</annotation></semantics></math> (line 13), relink the memory block list <math alttext="m_{k}^{\prime}" class="ltx_Math" display="inline" id="S3.SS1.p2.18.m6.1"><semantics id="S3.SS1.p2.18.m6.1a"><msubsup id="S3.SS1.p2.18.m6.1.1" xref="S3.SS1.p2.18.m6.1.1.cmml"><mi id="S3.SS1.p2.18.m6.1.1.2.2" xref="S3.SS1.p2.18.m6.1.1.2.2.cmml">m</mi><mi id="S3.SS1.p2.18.m6.1.1.2.3" xref="S3.SS1.p2.18.m6.1.1.2.3.cmml">k</mi><mo id="S3.SS1.p2.18.m6.1.1.3" xref="S3.SS1.p2.18.m6.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.18.m6.1b"><apply id="S3.SS1.p2.18.m6.1.1.cmml" xref="S3.SS1.p2.18.m6.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.18.m6.1.1.1.cmml" xref="S3.SS1.p2.18.m6.1.1">superscript</csymbol><apply id="S3.SS1.p2.18.m6.1.1.2.cmml" xref="S3.SS1.p2.18.m6.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.18.m6.1.1.2.1.cmml" xref="S3.SS1.p2.18.m6.1.1">subscript</csymbol><ci id="S3.SS1.p2.18.m6.1.1.2.2.cmml" xref="S3.SS1.p2.18.m6.1.1.2.2">𝑚</ci><ci id="S3.SS1.p2.18.m6.1.1.2.3.cmml" xref="S3.SS1.p2.18.m6.1.1.2.3">𝑘</ci></apply><ci id="S3.SS1.p2.18.m6.1.1.3.cmml" xref="S3.SS1.p2.18.m6.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.18.m6.1c">m_{k}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.18.m6.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> and fill the vectors (line 10 - 20). As stated before, the allocation is also thread-safe which just calculates a logic location of the memory block. After insertion, if the length of a certain newly inserted memory block list <math alttext="m^{\prime}" class="ltx_Math" display="inline" id="S3.SS1.p2.19.m7.1"><semantics id="S3.SS1.p2.19.m7.1a"><msup id="S3.SS1.p2.19.m7.1.1" xref="S3.SS1.p2.19.m7.1.1.cmml"><mi id="S3.SS1.p2.19.m7.1.1.2" xref="S3.SS1.p2.19.m7.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.19.m7.1.1.3" xref="S3.SS1.p2.19.m7.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.19.m7.1b"><apply id="S3.SS1.p2.19.m7.1.1.cmml" xref="S3.SS1.p2.19.m7.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.19.m7.1.1.1.cmml" xref="S3.SS1.p2.19.m7.1.1">superscript</csymbol><ci id="S3.SS1.p2.19.m7.1.1.2.cmml" xref="S3.SS1.p2.19.m7.1.1.2">𝑚</ci><ci id="S3.SS1.p2.19.m7.1.1.3.cmml" xref="S3.SS1.p2.19.m7.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.19.m7.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.19.m7.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> exceeds a predefined value <math alttext="T_{m}^{\prime}" class="ltx_Math" display="inline" id="S3.SS1.p2.20.m8.1"><semantics id="S3.SS1.p2.20.m8.1a"><msubsup id="S3.SS1.p2.20.m8.1.1" xref="S3.SS1.p2.20.m8.1.1.cmml"><mi id="S3.SS1.p2.20.m8.1.1.2.2" xref="S3.SS1.p2.20.m8.1.1.2.2.cmml">T</mi><mi id="S3.SS1.p2.20.m8.1.1.2.3" xref="S3.SS1.p2.20.m8.1.1.2.3.cmml">m</mi><mo id="S3.SS1.p2.20.m8.1.1.3" xref="S3.SS1.p2.20.m8.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.20.m8.1b"><apply id="S3.SS1.p2.20.m8.1.1.cmml" xref="S3.SS1.p2.20.m8.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.20.m8.1.1.1.cmml" xref="S3.SS1.p2.20.m8.1.1">superscript</csymbol><apply id="S3.SS1.p2.20.m8.1.1.2.cmml" xref="S3.SS1.p2.20.m8.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.20.m8.1.1.2.1.cmml" xref="S3.SS1.p2.20.m8.1.1">subscript</csymbol><ci id="S3.SS1.p2.20.m8.1.1.2.2.cmml" xref="S3.SS1.p2.20.m8.1.1.2.2">𝑇</ci><ci id="S3.SS1.p2.20.m8.1.1.2.3.cmml" xref="S3.SS1.p2.20.m8.1.1.2.3">𝑚</ci></apply><ci id="S3.SS1.p2.20.m8.1.1.3.cmml" xref="S3.SS1.p2.20.m8.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.20.m8.1c">T_{m}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.20.m8.1d">italic_T start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, <span class="ltx_text ltx_font_bold" id="S3.SS1.p2.20.2">Rearrangement</span> should be executed (line 23 - 27).</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{Exceed}(m^{\prime})=\sum_{m}|m.ml|&gt;T_{m}^{\prime}\quad\forall m\in m^{\prime}" class="ltx_math_unparsed" display="block" id="S3.E3.m1.1"><semantics id="S3.E3.m1.1a"><mrow id="S3.E3.m1.1b"><mtext id="S3.E3.m1.1.2">Exceed</mtext><mrow id="S3.E3.m1.1.3"><mo id="S3.E3.m1.1.3.1" stretchy="false">(</mo><msup id="S3.E3.m1.1.3.2"><mi id="S3.E3.m1.1.3.2.2">m</mi><mo id="S3.E3.m1.1.3.2.3">′</mo></msup><mo id="S3.E3.m1.1.3.3" stretchy="false">)</mo></mrow><mo id="S3.E3.m1.1.4" rspace="0.111em">=</mo><munder id="S3.E3.m1.1.5"><mo id="S3.E3.m1.1.5.2" movablelimits="false" rspace="0em">∑</mo><mi id="S3.E3.m1.1.5.3">m</mi></munder><mo fence="false" id="S3.E3.m1.1.6" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E3.m1.1.1">m</mi><mo id="S3.E3.m1.1.7" lspace="0em" rspace="0.167em">.</mo><mi id="S3.E3.m1.1.8">m</mi><mi id="S3.E3.m1.1.9">l</mi><mo fence="false" id="S3.E3.m1.1.10" stretchy="false">|</mo><mo id="S3.E3.m1.1.11" lspace="0.167em">&gt;</mo><msubsup id="S3.E3.m1.1.12"><mi id="S3.E3.m1.1.12.2.2">T</mi><mi id="S3.E3.m1.1.12.2.3">m</mi><mo id="S3.E3.m1.1.12.3">′</mo></msubsup><mspace id="S3.E3.m1.1.13" width="1.167em"></mspace><mo id="S3.E3.m1.1.14" rspace="0.167em">∀</mo><mi id="S3.E3.m1.1.15">m</mi><mo id="S3.E3.m1.1.16">∈</mo><msup id="S3.E3.m1.1.17"><mi id="S3.E3.m1.1.17.2">m</mi><mo id="S3.E3.m1.1.17.3">′</mo></msup></mrow><annotation encoding="application/x-tex" id="S3.E3.m1.1c">\text{Exceed}(m^{\prime})=\sum_{m}|m.ml|&gt;T_{m}^{\prime}\quad\forall m\in m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.1d">Exceed ( italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT | italic_m . italic_m italic_l | &gt; italic_T start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∀ italic_m ∈ italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.21">The rearrangement algorithm is illustrated in algorithm.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg3" title="Algorithm 3 ‣ 3.1. Memory Block Based Real-time Vector Insertion Algorithm ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>. The core idea of rearrangement is to merge two split memory block together so that the vectors are continuous and a header jump is eliminated. In a certain memory block list <math alttext="m^{\prime}" class="ltx_Math" display="inline" id="S3.SS1.p2.21.m1.1"><semantics id="S3.SS1.p2.21.m1.1a"><msup id="S3.SS1.p2.21.m1.1.1" xref="S3.SS1.p2.21.m1.1.1.cmml"><mi id="S3.SS1.p2.21.m1.1.1.2" xref="S3.SS1.p2.21.m1.1.1.2.cmml">m</mi><mo id="S3.SS1.p2.21.m1.1.1.3" xref="S3.SS1.p2.21.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.21.m1.1b"><apply id="S3.SS1.p2.21.m1.1.1.cmml" xref="S3.SS1.p2.21.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.21.m1.1.1.1.cmml" xref="S3.SS1.p2.21.m1.1.1">superscript</csymbol><ci id="S3.SS1.p2.21.m1.1.1.2.cmml" xref="S3.SS1.p2.21.m1.1.1.2">𝑚</ci><ci id="S3.SS1.p2.21.m1.1.1.3.cmml" xref="S3.SS1.p2.21.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.21.m1.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.21.m1.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, we exchange the memory block next to the first memory block with linked memory block using a extra temp memory segment and then update the first block header. It may happen that the memory block we want to exchange is a merged memory block, under certain circumstance, we should first split it and do merge on it recursively.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg3.3.1.1">Algorithm 3</span> </span> Memory block <span class="ltx_text ltx_font_bold" id="alg3.4.2">Rearrangement</span></figcaption>
<div class="ltx_listing ltx_listing" id="alg3.5">
<div class="ltx_listingline" id="alg3.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l0.1.1.1" style="font-size:80%;">0:</span></span>  memory block <math alttext="m\in M" class="ltx_Math" display="inline" id="alg3.l0.m1.1"><semantics id="alg3.l0.m1.1a"><mrow id="alg3.l0.m1.1.1" xref="alg3.l0.m1.1.1.cmml"><mi id="alg3.l0.m1.1.1.2" xref="alg3.l0.m1.1.1.2.cmml">m</mi><mo id="alg3.l0.m1.1.1.1" xref="alg3.l0.m1.1.1.1.cmml">∈</mo><mi id="alg3.l0.m1.1.1.3" xref="alg3.l0.m1.1.1.3.cmml">M</mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l0.m1.1b"><apply id="alg3.l0.m1.1.1.cmml" xref="alg3.l0.m1.1.1"><in id="alg3.l0.m1.1.1.1.cmml" xref="alg3.l0.m1.1.1.1"></in><ci id="alg3.l0.m1.1.1.2.cmml" xref="alg3.l0.m1.1.1.2">𝑚</ci><ci id="alg3.l0.m1.1.1.3.cmml" xref="alg3.l0.m1.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m1.1c">m\in M</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m1.1d">italic_m ∈ italic_M</annotation></semantics></math>, memory block list <math alttext="m^{\prime}\in M^{\prime}" class="ltx_Math" display="inline" id="alg3.l0.m2.1"><semantics id="alg3.l0.m2.1a"><mrow id="alg3.l0.m2.1.1" xref="alg3.l0.m2.1.1.cmml"><msup id="alg3.l0.m2.1.1.2" xref="alg3.l0.m2.1.1.2.cmml"><mi id="alg3.l0.m2.1.1.2.2" xref="alg3.l0.m2.1.1.2.2.cmml">m</mi><mo id="alg3.l0.m2.1.1.2.3" xref="alg3.l0.m2.1.1.2.3.cmml">′</mo></msup><mo id="alg3.l0.m2.1.1.1" xref="alg3.l0.m2.1.1.1.cmml">∈</mo><msup id="alg3.l0.m2.1.1.3" xref="alg3.l0.m2.1.1.3.cmml"><mi id="alg3.l0.m2.1.1.3.2" xref="alg3.l0.m2.1.1.3.2.cmml">M</mi><mo id="alg3.l0.m2.1.1.3.3" xref="alg3.l0.m2.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg3.l0.m2.1b"><apply id="alg3.l0.m2.1.1.cmml" xref="alg3.l0.m2.1.1"><in id="alg3.l0.m2.1.1.1.cmml" xref="alg3.l0.m2.1.1.1"></in><apply id="alg3.l0.m2.1.1.2.cmml" xref="alg3.l0.m2.1.1.2"><csymbol cd="ambiguous" id="alg3.l0.m2.1.1.2.1.cmml" xref="alg3.l0.m2.1.1.2">superscript</csymbol><ci id="alg3.l0.m2.1.1.2.2.cmml" xref="alg3.l0.m2.1.1.2.2">𝑚</ci><ci id="alg3.l0.m2.1.1.2.3.cmml" xref="alg3.l0.m2.1.1.2.3">′</ci></apply><apply id="alg3.l0.m2.1.1.3.cmml" xref="alg3.l0.m2.1.1.3"><csymbol cd="ambiguous" id="alg3.l0.m2.1.1.3.1.cmml" xref="alg3.l0.m2.1.1.3">superscript</csymbol><ci id="alg3.l0.m2.1.1.3.2.cmml" xref="alg3.l0.m2.1.1.3.2">𝑀</ci><ci id="alg3.l0.m2.1.1.3.3.cmml" xref="alg3.l0.m2.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l0.m2.1c">m^{\prime}\in M^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg3.l0.m2.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ italic_M start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l1.1.1.1" style="font-size:80%;">1:</span></span>  <math alttext="m_{i}\leftarrow" class="ltx_Math" display="inline" id="alg3.l1.m1.1"><semantics id="alg3.l1.m1.1a"><mrow id="alg3.l1.m1.1.1" xref="alg3.l1.m1.1.1.cmml"><msub id="alg3.l1.m1.1.1.2" xref="alg3.l1.m1.1.1.2.cmml"><mi id="alg3.l1.m1.1.1.2.2" xref="alg3.l1.m1.1.1.2.2.cmml">m</mi><mi id="alg3.l1.m1.1.1.2.3" xref="alg3.l1.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg3.l1.m1.1.1.1" stretchy="false" xref="alg3.l1.m1.1.1.1.cmml">←</mo><mi id="alg3.l1.m1.1.1.3" xref="alg3.l1.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l1.m1.1b"><apply id="alg3.l1.m1.1.1.cmml" xref="alg3.l1.m1.1.1"><ci id="alg3.l1.m1.1.1.1.cmml" xref="alg3.l1.m1.1.1.1">←</ci><apply id="alg3.l1.m1.1.1.2.cmml" xref="alg3.l1.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l1.m1.1.1.2.1.cmml" xref="alg3.l1.m1.1.1.2">subscript</csymbol><ci id="alg3.l1.m1.1.1.2.2.cmml" xref="alg3.l1.m1.1.1.2.2">𝑚</ci><ci id="alg3.l1.m1.1.1.2.3.cmml" xref="alg3.l1.m1.1.1.2.3">𝑖</ci></apply><csymbol cd="latexml" id="alg3.l1.m1.1.1.3.cmml" xref="alg3.l1.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l1.m1.1c">m_{i}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg3.l1.m1.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ←</annotation></semantics></math> memory block of <math alttext="m^{\prime}" class="ltx_Math" display="inline" id="alg3.l1.m2.1"><semantics id="alg3.l1.m2.1a"><msup id="alg3.l1.m2.1.1" xref="alg3.l1.m2.1.1.cmml"><mi id="alg3.l1.m2.1.1.2" xref="alg3.l1.m2.1.1.2.cmml">m</mi><mo id="alg3.l1.m2.1.1.3" xref="alg3.l1.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="alg3.l1.m2.1b"><apply id="alg3.l1.m2.1.1.cmml" xref="alg3.l1.m2.1.1"><csymbol cd="ambiguous" id="alg3.l1.m2.1.1.1.cmml" xref="alg3.l1.m2.1.1">superscript</csymbol><ci id="alg3.l1.m2.1.1.2.cmml" xref="alg3.l1.m2.1.1.2">𝑚</ci><ci id="alg3.l1.m2.1.1.3.cmml" xref="alg3.l1.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l1.m2.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg3.l1.m2.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> to be extended

</div>
<div class="ltx_listingline" id="alg3.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="m_{j}\leftarrow" class="ltx_Math" display="inline" id="alg3.l2.m1.1"><semantics id="alg3.l2.m1.1a"><mrow id="alg3.l2.m1.1.1" xref="alg3.l2.m1.1.1.cmml"><msub id="alg3.l2.m1.1.1.2" xref="alg3.l2.m1.1.1.2.cmml"><mi id="alg3.l2.m1.1.1.2.2" xref="alg3.l2.m1.1.1.2.2.cmml">m</mi><mi id="alg3.l2.m1.1.1.2.3" xref="alg3.l2.m1.1.1.2.3.cmml">j</mi></msub><mo id="alg3.l2.m1.1.1.1" stretchy="false" xref="alg3.l2.m1.1.1.1.cmml">←</mo><mi id="alg3.l2.m1.1.1.3" xref="alg3.l2.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg3.l2.m1.1b"><apply id="alg3.l2.m1.1.1.cmml" xref="alg3.l2.m1.1.1"><ci id="alg3.l2.m1.1.1.1.cmml" xref="alg3.l2.m1.1.1.1">←</ci><apply id="alg3.l2.m1.1.1.2.cmml" xref="alg3.l2.m1.1.1.2"><csymbol cd="ambiguous" id="alg3.l2.m1.1.1.2.1.cmml" xref="alg3.l2.m1.1.1.2">subscript</csymbol><ci id="alg3.l2.m1.1.1.2.2.cmml" xref="alg3.l2.m1.1.1.2.2">𝑚</ci><ci id="alg3.l2.m1.1.1.2.3.cmml" xref="alg3.l2.m1.1.1.2.3">𝑗</ci></apply><csymbol cd="latexml" id="alg3.l2.m1.1.1.3.cmml" xref="alg3.l2.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l2.m1.1c">m_{j}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg3.l2.m1.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ←</annotation></semantics></math> memory block of <math alttext="m^{\prime}" class="ltx_Math" display="inline" id="alg3.l2.m2.1"><semantics id="alg3.l2.m2.1a"><msup id="alg3.l2.m2.1.1" xref="alg3.l2.m2.1.1.cmml"><mi id="alg3.l2.m2.1.1.2" xref="alg3.l2.m2.1.1.2.cmml">m</mi><mo id="alg3.l2.m2.1.1.3" xref="alg3.l2.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="alg3.l2.m2.1b"><apply id="alg3.l2.m2.1.1.cmml" xref="alg3.l2.m2.1.1"><csymbol cd="ambiguous" id="alg3.l2.m2.1.1.1.cmml" xref="alg3.l2.m2.1.1">superscript</csymbol><ci id="alg3.l2.m2.1.1.2.cmml" xref="alg3.l2.m2.1.1.2">𝑚</ci><ci id="alg3.l2.m2.1.1.3.cmml" xref="alg3.l2.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l2.m2.1c">m^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg3.l2.m2.1d">italic_m start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> to extend

</div>
<div class="ltx_listingline" id="alg3.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l3.1.1.1" style="font-size:80%;">3:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l3.2">if</span> <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l3.m1.1"><semantics id="alg3.l3.m1.1a"><msub id="alg3.l3.m1.1.1" xref="alg3.l3.m1.1.1.cmml"><mi id="alg3.l3.m1.1.1.2" xref="alg3.l3.m1.1.1.2.cmml">m</mi><mrow id="alg3.l3.m1.1.1.3" xref="alg3.l3.m1.1.1.3.cmml"><mi id="alg3.l3.m1.1.1.3.2" xref="alg3.l3.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l3.m1.1.1.3.1" xref="alg3.l3.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l3.m1.1.1.3.3" xref="alg3.l3.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l3.m1.1b"><apply id="alg3.l3.m1.1.1.cmml" xref="alg3.l3.m1.1.1"><csymbol cd="ambiguous" id="alg3.l3.m1.1.1.1.cmml" xref="alg3.l3.m1.1.1">subscript</csymbol><ci id="alg3.l3.m1.1.1.2.cmml" xref="alg3.l3.m1.1.1.2">𝑚</ci><apply id="alg3.l3.m1.1.1.3.cmml" xref="alg3.l3.m1.1.1.3"><plus id="alg3.l3.m1.1.1.3.1.cmml" xref="alg3.l3.m1.1.1.3.1"></plus><ci id="alg3.l3.m1.1.1.3.2.cmml" xref="alg3.l3.m1.1.1.3.2">𝑖</ci><cn id="alg3.l3.m1.1.1.3.3.cmml" type="integer" xref="alg3.l3.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l3.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l3.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> is merged <span class="ltx_text ltx_font_bold" id="alg3.l3.3">then</span>
</div>
<div class="ltx_listingline" id="alg3.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l4.1.1.1" style="font-size:80%;">4:</span></span>     split(<math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l4.m1.1"><semantics id="alg3.l4.m1.1a"><msub id="alg3.l4.m1.1.1" xref="alg3.l4.m1.1.1.cmml"><mi id="alg3.l4.m1.1.1.2" xref="alg3.l4.m1.1.1.2.cmml">m</mi><mrow id="alg3.l4.m1.1.1.3" xref="alg3.l4.m1.1.1.3.cmml"><mi id="alg3.l4.m1.1.1.3.2" xref="alg3.l4.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l4.m1.1.1.3.1" xref="alg3.l4.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l4.m1.1.1.3.3" xref="alg3.l4.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l4.m1.1b"><apply id="alg3.l4.m1.1.1.cmml" xref="alg3.l4.m1.1.1"><csymbol cd="ambiguous" id="alg3.l4.m1.1.1.1.cmml" xref="alg3.l4.m1.1.1">subscript</csymbol><ci id="alg3.l4.m1.1.1.2.cmml" xref="alg3.l4.m1.1.1.2">𝑚</ci><apply id="alg3.l4.m1.1.1.3.cmml" xref="alg3.l4.m1.1.1.3"><plus id="alg3.l4.m1.1.1.3.1.cmml" xref="alg3.l4.m1.1.1.3.1"></plus><ci id="alg3.l4.m1.1.1.3.2.cmml" xref="alg3.l4.m1.1.1.3.2">𝑖</ci><cn id="alg3.l4.m1.1.1.3.3.cmml" type="integer" xref="alg3.l4.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l4.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l4.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math>)

</div>
<div class="ltx_listingline" id="alg3.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l5.1.1.1" style="font-size:80%;">5:</span></span>     lazyMerge <math alttext="\leftarrow" class="ltx_Math" display="inline" id="alg3.l5.m1.1"><semantics id="alg3.l5.m1.1a"><mo id="alg3.l5.m1.1.1" stretchy="false" xref="alg3.l5.m1.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="alg3.l5.m1.1b"><ci id="alg3.l5.m1.1.1.cmml" xref="alg3.l5.m1.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="alg3.l5.m1.1c">\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg3.l5.m1.1d">←</annotation></semantics></math> true

</div>
<div class="ltx_listingline" id="alg3.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l6.1.1.1" style="font-size:80%;">6:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l6.2">end</span> <span class="ltx_text ltx_font_bold" id="alg3.l6.3">if</span>
</div>
<div class="ltx_listingline" id="alg3.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l7.1.1.1" style="font-size:80%;">7:</span></span>  prepare tmp segment for <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l7.m1.1"><semantics id="alg3.l7.m1.1a"><msub id="alg3.l7.m1.1.1" xref="alg3.l7.m1.1.1.cmml"><mi id="alg3.l7.m1.1.1.2" xref="alg3.l7.m1.1.1.2.cmml">m</mi><mrow id="alg3.l7.m1.1.1.3" xref="alg3.l7.m1.1.1.3.cmml"><mi id="alg3.l7.m1.1.1.3.2" xref="alg3.l7.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l7.m1.1.1.3.1" xref="alg3.l7.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l7.m1.1.1.3.3" xref="alg3.l7.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l7.m1.1b"><apply id="alg3.l7.m1.1.1.cmml" xref="alg3.l7.m1.1.1"><csymbol cd="ambiguous" id="alg3.l7.m1.1.1.1.cmml" xref="alg3.l7.m1.1.1">subscript</csymbol><ci id="alg3.l7.m1.1.1.2.cmml" xref="alg3.l7.m1.1.1.2">𝑚</ci><apply id="alg3.l7.m1.1.1.3.cmml" xref="alg3.l7.m1.1.1.3"><plus id="alg3.l7.m1.1.1.3.1.cmml" xref="alg3.l7.m1.1.1.3.1"></plus><ci id="alg3.l7.m1.1.1.3.2.cmml" xref="alg3.l7.m1.1.1.3.2">𝑖</ci><cn id="alg3.l7.m1.1.1.3.3.cmml" type="integer" xref="alg3.l7.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l7.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l7.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l7.m2.1"><semantics id="alg3.l7.m2.1a"><msub id="alg3.l7.m2.1.1" xref="alg3.l7.m2.1.1.cmml"><mi id="alg3.l7.m2.1.1.2" xref="alg3.l7.m2.1.1.2.cmml">m</mi><mi id="alg3.l7.m2.1.1.3" xref="alg3.l7.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l7.m2.1b"><apply id="alg3.l7.m2.1.1.cmml" xref="alg3.l7.m2.1.1"><csymbol cd="ambiguous" id="alg3.l7.m2.1.1.1.cmml" xref="alg3.l7.m2.1.1">subscript</csymbol><ci id="alg3.l7.m2.1.1.2.cmml" xref="alg3.l7.m2.1.1.2">𝑚</ci><ci id="alg3.l7.m2.1.1.3.cmml" xref="alg3.l7.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l7.m2.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l7.m2.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l8.1.1.1" style="font-size:80%;">8:</span></span>  wait for <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l8.m1.1"><semantics id="alg3.l8.m1.1a"><msub id="alg3.l8.m1.1.1" xref="alg3.l8.m1.1.1.cmml"><mi id="alg3.l8.m1.1.1.2" xref="alg3.l8.m1.1.1.2.cmml">m</mi><mrow id="alg3.l8.m1.1.1.3" xref="alg3.l8.m1.1.1.3.cmml"><mi id="alg3.l8.m1.1.1.3.2" xref="alg3.l8.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l8.m1.1.1.3.1" xref="alg3.l8.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l8.m1.1.1.3.3" xref="alg3.l8.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l8.m1.1b"><apply id="alg3.l8.m1.1.1.cmml" xref="alg3.l8.m1.1.1"><csymbol cd="ambiguous" id="alg3.l8.m1.1.1.1.cmml" xref="alg3.l8.m1.1.1">subscript</csymbol><ci id="alg3.l8.m1.1.1.2.cmml" xref="alg3.l8.m1.1.1.2">𝑚</ci><apply id="alg3.l8.m1.1.1.3.cmml" xref="alg3.l8.m1.1.1.3"><plus id="alg3.l8.m1.1.1.3.1.cmml" xref="alg3.l8.m1.1.1.3.1"></plus><ci id="alg3.l8.m1.1.1.3.2.cmml" xref="alg3.l8.m1.1.1.3.2">𝑖</ci><cn id="alg3.l8.m1.1.1.3.3.cmml" type="integer" xref="alg3.l8.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l8.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l8.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l8.m2.1"><semantics id="alg3.l8.m2.1a"><msub id="alg3.l8.m2.1.1" xref="alg3.l8.m2.1.1.cmml"><mi id="alg3.l8.m2.1.1.2" xref="alg3.l8.m2.1.1.2.cmml">m</mi><mi id="alg3.l8.m2.1.1.3" xref="alg3.l8.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l8.m2.1b"><apply id="alg3.l8.m2.1.1.cmml" xref="alg3.l8.m2.1.1"><csymbol cd="ambiguous" id="alg3.l8.m2.1.1.1.cmml" xref="alg3.l8.m2.1.1">subscript</csymbol><ci id="alg3.l8.m2.1.1.2.cmml" xref="alg3.l8.m2.1.1.2">𝑚</ci><ci id="alg3.l8.m2.1.1.3.cmml" xref="alg3.l8.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l8.m2.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l8.m2.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is spare

</div>
<div class="ltx_listingline" id="alg3.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l9.1.1.1" style="font-size:80%;">9:</span></span>  <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l9.m1.1"><semantics id="alg3.l9.m1.1a"><msub id="alg3.l9.m1.1.1" xref="alg3.l9.m1.1.1.cmml"><mi id="alg3.l9.m1.1.1.2" xref="alg3.l9.m1.1.1.2.cmml">m</mi><mrow id="alg3.l9.m1.1.1.3" xref="alg3.l9.m1.1.1.3.cmml"><mi id="alg3.l9.m1.1.1.3.2" xref="alg3.l9.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l9.m1.1.1.3.1" xref="alg3.l9.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l9.m1.1.1.3.3" xref="alg3.l9.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l9.m1.1b"><apply id="alg3.l9.m1.1.1.cmml" xref="alg3.l9.m1.1.1"><csymbol cd="ambiguous" id="alg3.l9.m1.1.1.1.cmml" xref="alg3.l9.m1.1.1">subscript</csymbol><ci id="alg3.l9.m1.1.1.2.cmml" xref="alg3.l9.m1.1.1.2">𝑚</ci><apply id="alg3.l9.m1.1.1.3.cmml" xref="alg3.l9.m1.1.1.3"><plus id="alg3.l9.m1.1.1.3.1.cmml" xref="alg3.l9.m1.1.1.3.1"></plus><ci id="alg3.l9.m1.1.1.3.2.cmml" xref="alg3.l9.m1.1.1.3.2">𝑖</ci><cn id="alg3.l9.m1.1.1.3.3.cmml" type="integer" xref="alg3.l9.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l9.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l9.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math>.copyFrom(<math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l9.m2.1"><semantics id="alg3.l9.m2.1a"><msub id="alg3.l9.m2.1.1" xref="alg3.l9.m2.1.1.cmml"><mi id="alg3.l9.m2.1.1.2" xref="alg3.l9.m2.1.1.2.cmml">m</mi><mi id="alg3.l9.m2.1.1.3" xref="alg3.l9.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l9.m2.1b"><apply id="alg3.l9.m2.1.1.cmml" xref="alg3.l9.m2.1.1"><csymbol cd="ambiguous" id="alg3.l9.m2.1.1.1.cmml" xref="alg3.l9.m2.1.1">subscript</csymbol><ci id="alg3.l9.m2.1.1.2.cmml" xref="alg3.l9.m2.1.1.2">𝑚</ci><ci id="alg3.l9.m2.1.1.3.cmml" xref="alg3.l9.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l9.m2.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l9.m2.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>)

</div>
<div class="ltx_listingline" id="alg3.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l10.1.1.1" style="font-size:80%;">10:</span></span>  <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l10.m1.1"><semantics id="alg3.l10.m1.1a"><msub id="alg3.l10.m1.1.1" xref="alg3.l10.m1.1.1.cmml"><mi id="alg3.l10.m1.1.1.2" xref="alg3.l10.m1.1.1.2.cmml">m</mi><mi id="alg3.l10.m1.1.1.3" xref="alg3.l10.m1.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l10.m1.1b"><apply id="alg3.l10.m1.1.1.cmml" xref="alg3.l10.m1.1.1"><csymbol cd="ambiguous" id="alg3.l10.m1.1.1.1.cmml" xref="alg3.l10.m1.1.1">subscript</csymbol><ci id="alg3.l10.m1.1.1.2.cmml" xref="alg3.l10.m1.1.1.2">𝑚</ci><ci id="alg3.l10.m1.1.1.3.cmml" xref="alg3.l10.m1.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l10.m1.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l10.m1.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>.copyFrom(tmp <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l10.m2.1"><semantics id="alg3.l10.m2.1a"><msub id="alg3.l10.m2.1.1" xref="alg3.l10.m2.1.1.cmml"><mi id="alg3.l10.m2.1.1.2" xref="alg3.l10.m2.1.1.2.cmml">m</mi><mrow id="alg3.l10.m2.1.1.3" xref="alg3.l10.m2.1.1.3.cmml"><mi id="alg3.l10.m2.1.1.3.2" xref="alg3.l10.m2.1.1.3.2.cmml">i</mi><mo id="alg3.l10.m2.1.1.3.1" xref="alg3.l10.m2.1.1.3.1.cmml">+</mo><mn id="alg3.l10.m2.1.1.3.3" xref="alg3.l10.m2.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l10.m2.1b"><apply id="alg3.l10.m2.1.1.cmml" xref="alg3.l10.m2.1.1"><csymbol cd="ambiguous" id="alg3.l10.m2.1.1.1.cmml" xref="alg3.l10.m2.1.1">subscript</csymbol><ci id="alg3.l10.m2.1.1.2.cmml" xref="alg3.l10.m2.1.1.2">𝑚</ci><apply id="alg3.l10.m2.1.1.3.cmml" xref="alg3.l10.m2.1.1.3"><plus id="alg3.l10.m2.1.1.3.1.cmml" xref="alg3.l10.m2.1.1.3.1"></plus><ci id="alg3.l10.m2.1.1.3.2.cmml" xref="alg3.l10.m2.1.1.3.2">𝑖</ci><cn id="alg3.l10.m2.1.1.3.3.cmml" type="integer" xref="alg3.l10.m2.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l10.m2.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l10.m2.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math>)

</div>
<div class="ltx_listingline" id="alg3.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l11.1.1.1" style="font-size:80%;">11:</span></span>  update header of <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l11.m1.1"><semantics id="alg3.l11.m1.1a"><msub id="alg3.l11.m1.1.1" xref="alg3.l11.m1.1.1.cmml"><mi id="alg3.l11.m1.1.1.2" xref="alg3.l11.m1.1.1.2.cmml">m</mi><mrow id="alg3.l11.m1.1.1.3" xref="alg3.l11.m1.1.1.3.cmml"><mi id="alg3.l11.m1.1.1.3.2" xref="alg3.l11.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l11.m1.1.1.3.1" xref="alg3.l11.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l11.m1.1.1.3.3" xref="alg3.l11.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l11.m1.1b"><apply id="alg3.l11.m1.1.1.cmml" xref="alg3.l11.m1.1.1"><csymbol cd="ambiguous" id="alg3.l11.m1.1.1.1.cmml" xref="alg3.l11.m1.1.1">subscript</csymbol><ci id="alg3.l11.m1.1.1.2.cmml" xref="alg3.l11.m1.1.1.2">𝑚</ci><apply id="alg3.l11.m1.1.1.3.cmml" xref="alg3.l11.m1.1.1.3"><plus id="alg3.l11.m1.1.1.3.1.cmml" xref="alg3.l11.m1.1.1.3.1"></plus><ci id="alg3.l11.m1.1.1.3.2.cmml" xref="alg3.l11.m1.1.1.3.2">𝑖</ci><cn id="alg3.l11.m1.1.1.3.3.cmml" type="integer" xref="alg3.l11.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l11.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l11.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l11.m2.1"><semantics id="alg3.l11.m2.1a"><msub id="alg3.l11.m2.1.1" xref="alg3.l11.m2.1.1.cmml"><mi id="alg3.l11.m2.1.1.2" xref="alg3.l11.m2.1.1.2.cmml">m</mi><mi id="alg3.l11.m2.1.1.3" xref="alg3.l11.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l11.m2.1b"><apply id="alg3.l11.m2.1.1.cmml" xref="alg3.l11.m2.1.1"><csymbol cd="ambiguous" id="alg3.l11.m2.1.1.1.cmml" xref="alg3.l11.m2.1.1">subscript</csymbol><ci id="alg3.l11.m2.1.1.2.cmml" xref="alg3.l11.m2.1.1.2">𝑚</ci><ci id="alg3.l11.m2.1.1.3.cmml" xref="alg3.l11.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l11.m2.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l11.m2.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l12.1.1.1" style="font-size:80%;">12:</span></span>  wait for tmp <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l12.m1.1"><semantics id="alg3.l12.m1.1a"><msub id="alg3.l12.m1.1.1" xref="alg3.l12.m1.1.1.cmml"><mi id="alg3.l12.m1.1.1.2" xref="alg3.l12.m1.1.1.2.cmml">m</mi><mrow id="alg3.l12.m1.1.1.3" xref="alg3.l12.m1.1.1.3.cmml"><mi id="alg3.l12.m1.1.1.3.2" xref="alg3.l12.m1.1.1.3.2.cmml">i</mi><mo id="alg3.l12.m1.1.1.3.1" xref="alg3.l12.m1.1.1.3.1.cmml">+</mo><mn id="alg3.l12.m1.1.1.3.3" xref="alg3.l12.m1.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l12.m1.1b"><apply id="alg3.l12.m1.1.1.cmml" xref="alg3.l12.m1.1.1"><csymbol cd="ambiguous" id="alg3.l12.m1.1.1.1.cmml" xref="alg3.l12.m1.1.1">subscript</csymbol><ci id="alg3.l12.m1.1.1.2.cmml" xref="alg3.l12.m1.1.1.2">𝑚</ci><apply id="alg3.l12.m1.1.1.3.cmml" xref="alg3.l12.m1.1.1.3"><plus id="alg3.l12.m1.1.1.3.1.cmml" xref="alg3.l12.m1.1.1.3.1"></plus><ci id="alg3.l12.m1.1.1.3.2.cmml" xref="alg3.l12.m1.1.1.3.2">𝑖</ci><cn id="alg3.l12.m1.1.1.3.3.cmml" type="integer" xref="alg3.l12.m1.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l12.m1.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l12.m1.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l12.m2.1"><semantics id="alg3.l12.m2.1a"><msub id="alg3.l12.m2.1.1" xref="alg3.l12.m2.1.1.cmml"><mi id="alg3.l12.m2.1.1.2" xref="alg3.l12.m2.1.1.2.cmml">m</mi><mi id="alg3.l12.m2.1.1.3" xref="alg3.l12.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l12.m2.1b"><apply id="alg3.l12.m2.1.1.cmml" xref="alg3.l12.m2.1.1"><csymbol cd="ambiguous" id="alg3.l12.m2.1.1.1.cmml" xref="alg3.l12.m2.1.1">subscript</csymbol><ci id="alg3.l12.m2.1.1.2.cmml" xref="alg3.l12.m2.1.1.2">𝑚</ci><ci id="alg3.l12.m2.1.1.3.cmml" xref="alg3.l12.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l12.m2.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l12.m2.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is spare

</div>
<div class="ltx_listingline" id="alg3.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l13.1.1.1" style="font-size:80%;">13:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l13.2">if</span> lazyMerge <span class="ltx_text ltx_font_bold" id="alg3.l13.3">then</span>
</div>
<div class="ltx_listingline" id="alg3.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l14.1.1.1" style="font-size:80%;">14:</span></span>     <span class="ltx_text ltx_font_bold" id="alg3.l14.2">Rearrange</span>(new <math alttext="m_{j}" class="ltx_Math" display="inline" id="alg3.l14.m1.1"><semantics id="alg3.l14.m1.1a"><msub id="alg3.l14.m1.1.1" xref="alg3.l14.m1.1.1.cmml"><mi id="alg3.l14.m1.1.1.2" xref="alg3.l14.m1.1.1.2.cmml">m</mi><mi id="alg3.l14.m1.1.1.3" xref="alg3.l14.m1.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="alg3.l14.m1.1b"><apply id="alg3.l14.m1.1.1.cmml" xref="alg3.l14.m1.1.1"><csymbol cd="ambiguous" id="alg3.l14.m1.1.1.1.cmml" xref="alg3.l14.m1.1.1">subscript</csymbol><ci id="alg3.l14.m1.1.1.2.cmml" xref="alg3.l14.m1.1.1.2">𝑚</ci><ci id="alg3.l14.m1.1.1.3.cmml" xref="alg3.l14.m1.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l14.m1.1c">m_{j}</annotation><annotation encoding="application/x-llamapun" id="alg3.l14.m1.1d">italic_m start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>) // old <math alttext="m_{i+1}" class="ltx_Math" display="inline" id="alg3.l14.m2.1"><semantics id="alg3.l14.m2.1a"><msub id="alg3.l14.m2.1.1" xref="alg3.l14.m2.1.1.cmml"><mi id="alg3.l14.m2.1.1.2" xref="alg3.l14.m2.1.1.2.cmml">m</mi><mrow id="alg3.l14.m2.1.1.3" xref="alg3.l14.m2.1.1.3.cmml"><mi id="alg3.l14.m2.1.1.3.2" xref="alg3.l14.m2.1.1.3.2.cmml">i</mi><mo id="alg3.l14.m2.1.1.3.1" xref="alg3.l14.m2.1.1.3.1.cmml">+</mo><mn id="alg3.l14.m2.1.1.3.3" xref="alg3.l14.m2.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="alg3.l14.m2.1b"><apply id="alg3.l14.m2.1.1.cmml" xref="alg3.l14.m2.1.1"><csymbol cd="ambiguous" id="alg3.l14.m2.1.1.1.cmml" xref="alg3.l14.m2.1.1">subscript</csymbol><ci id="alg3.l14.m2.1.1.2.cmml" xref="alg3.l14.m2.1.1.2">𝑚</ci><apply id="alg3.l14.m2.1.1.3.cmml" xref="alg3.l14.m2.1.1.3"><plus id="alg3.l14.m2.1.1.3.1.cmml" xref="alg3.l14.m2.1.1.3.1"></plus><ci id="alg3.l14.m2.1.1.3.2.cmml" xref="alg3.l14.m2.1.1.3.2">𝑖</ci><cn id="alg3.l14.m2.1.1.3.3.cmml" type="integer" xref="alg3.l14.m2.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg3.l14.m2.1c">m_{i+1}</annotation><annotation encoding="application/x-llamapun" id="alg3.l14.m2.1d">italic_m start_POSTSUBSCRIPT italic_i + 1 end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg3.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg3.l15.1.1.1" style="font-size:80%;">15:</span></span>  <span class="ltx_text ltx_font_bold" id="alg3.l15.2">end</span> <span class="ltx_text ltx_font_bold" id="alg3.l15.3">if</span>
</div>
</div>
</figure>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Stream-Cached Multi-Stream Execution</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">In this section, we propose a parallel execution mechanism to enable real-time vector insertion kernels to run concurrently with normal retrieval sorting kernels on the GPU. As depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F2" title="Figure 2 ‣ 3.2. Stream-Cached Multi-Stream Execution ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a>a, previous systems operated in a serialized manner—a common practice in GPU applications due to the massive computational workload, which maximizes throughput by running a single kernel at a time <cite class="ltx_cite ltx_citemacro_citep">(Pinnecke et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib17" title="">2015</a>)</cite>. However, in ANNs, individual request computations may not fully utilize the GPU’s performance, and the serial execution of real-time vector insertion kernels can block normal retrieval sorting kernels. Therefore, a parallel system is more suitable for online systems. By concurrently executing these kernels, we not only reduce significant execution time (Time Saved in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F2" title="Figure 2 ‣ 3.2. Stream-Cached Multi-Stream Execution ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a>(b)) but also make real-time vector insertion more immediate.</p>
</div>
<figure class="ltx_figure" id="S3.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="640" id="S3.F2.g1" src="x2.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2. </span>(a) Single Stream Serialize Mode (Faiss/Raft): execute kernel in a single-stream, cannot handle scenario including new coming vectors. (b) Multi Stream Parallel Model (Proposed Method): enabling kernel execution under a parallel form, not only improving online gpu utilization but also adapting real-time vector operations naturally.</figcaption>
</figure>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.1">We adopt multi-stream parallelism <cite class="ltx_cite ltx_citemacro_citep">(Czarnul, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib6" title="">2020</a>)</cite> in CUDA, which needs domain knowledge to design a kernel execution mechanism. All kernels submit to gpu should be run on a certain stream. As shown in algorithm.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg4" title="Algorithm 4 ‣ 3.2. Stream-Cached Multi-Stream Execution ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">4</span></a>, for Search kernel, each kernel will run on a distinct stream and the stream resource can be reused through a resource pool. For Insertion kernel, it should be run on a same data stream. So finally it will have multiple streams for Search and single stream for Insertion. However, for successful execution, the system needs to be considered more: 1) The system must avoid online memory allocation and deallocation to prevent global blocking and degradation into a serialized mechanism. 2) Each kernel in the system should not consume a significant amount of resources, as excessive resource consumption would lead to block.</p>
</div>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1">For consideration 1, drawing inspiration from methods employed in TCMalloc <cite class="ltx_cite ltx_citemacro_citep">(Manghwani and He, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib14" title="">2011</a>)</cite>, we devised a dual-layered stream-based resource pool. Initially, each request for batch search is allocated to a dedicated stream, possessing a separate small memory allocation (sufficient for the use of ivfflat and ivfpq algorithms). Additionally, when the demand for resources is substantial, a larger resource allocation will be requested from the central memory pool, which is then returned after use. For the real-time vector insertion kernel, we considered parallelism and lock-free allocation of GPU memory during the design phase, as outlined in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#alg2" title="Algorithm 2 ‣ 3.1. Memory Block Based Real-time Vector Insertion Algorithm ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">2</span></a>(line 13). Consequently, it will not encounter any blocking issues and can smoothly parallelize with the retrieval kernel.</p>
</div>
<div class="ltx_para" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.1">For consideration 2, since multiple kernels are scheduled on stream multiprocessors (SM) simultaneously <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib22" title="">2016</a>)</cite>, it’s essential that a single kernel doesn’t monopolize all computational resources <cite class="ltx_cite ltx_citemacro_citep">(Zhong and He, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib28" title="">2013</a>)</cite>. Additionally, when the number of threads is large, there will be limitations on the number of threads per block on the GPU. Therefore, we will restrict the number of blocks and threads per kernel, which may result in increased latency for online requests with high computational demands. However, this is quite common in online scenarios.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg4.2.1.1">Algorithm 4</span> </span> Multi Stream Execution</figcaption>
<div class="ltx_listing ltx_listing" id="alg4.3">
<div class="ltx_listingline" id="alg4.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l0.1.1.1" style="font-size:80%;">0:</span></span>  Resource Pool <math alttext="R" class="ltx_Math" display="inline" id="alg4.l0.m1.1"><semantics id="alg4.l0.m1.1a"><mi id="alg4.l0.m1.1.1" xref="alg4.l0.m1.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg4.l0.m1.1b"><ci id="alg4.l0.m1.1.1.cmml" xref="alg4.l0.m1.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m1.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m1.1d">italic_R</annotation></semantics></math>, Central Memory Pool <math alttext="P" class="ltx_Math" display="inline" id="alg4.l0.m2.1"><semantics id="alg4.l0.m2.1a"><mi id="alg4.l0.m2.1.1" xref="alg4.l0.m2.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="alg4.l0.m2.1b"><ci id="alg4.l0.m2.1.1.cmml" xref="alg4.l0.m2.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0.m2.1c">P</annotation><annotation encoding="application/x-llamapun" id="alg4.l0.m2.1d">italic_P</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l0a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l0a.1.1.1" style="font-size:80%;">0:</span></span>  Request <math alttext="q" class="ltx_Math" display="inline" id="alg4.l0a.m1.1"><semantics id="alg4.l0a.m1.1a"><mi id="alg4.l0a.m1.1.1" xref="alg4.l0a.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="alg4.l0a.m1.1b"><ci id="alg4.l0a.m1.1.1.cmml" xref="alg4.l0a.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l0a.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="alg4.l0a.m1.1d">italic_q</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l1.1.1.1" style="font-size:80%;">1:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l1.2">if</span> q.type == batch search <span class="ltx_text ltx_font_bold" id="alg4.l1.3">then</span>
</div>
<div class="ltx_listingline" id="alg4.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l2.1.1.1" style="font-size:80%;">2:</span></span>     <math alttext="r" class="ltx_Math" display="inline" id="alg4.l2.m1.1"><semantics id="alg4.l2.m1.1a"><mi id="alg4.l2.m1.1.1" xref="alg4.l2.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="alg4.l2.m1.1b"><ci id="alg4.l2.m1.1.1.cmml" xref="alg4.l2.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l2.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="alg4.l2.m1.1d">italic_r</annotation></semantics></math> (stream, memory for stream) <math alttext="\leftarrow" class="ltx_Math" display="inline" id="alg4.l2.m2.1"><semantics id="alg4.l2.m2.1a"><mo id="alg4.l2.m2.1.1" stretchy="false" xref="alg4.l2.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="alg4.l2.m2.1b"><ci id="alg4.l2.m2.1.1.cmml" xref="alg4.l2.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l2.m2.1c">\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg4.l2.m2.1d">←</annotation></semantics></math> Resource Pool <math alttext="R" class="ltx_Math" display="inline" id="alg4.l2.m3.1"><semantics id="alg4.l2.m3.1a"><mi id="alg4.l2.m3.1.1" xref="alg4.l2.m3.1.1.cmml">R</mi><annotation-xml encoding="MathML-Content" id="alg4.l2.m3.1b"><ci id="alg4.l2.m3.1.1.cmml" xref="alg4.l2.m3.1.1">𝑅</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l2.m3.1c">R</annotation><annotation encoding="application/x-llamapun" id="alg4.l2.m3.1d">italic_R</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l3.1.1.1" style="font-size:80%;">3:</span></span>     <span class="ltx_text ltx_font_bold" id="alg4.l3.2">if</span> memory is not enough <span class="ltx_text ltx_font_bold" id="alg4.l3.3">then</span>
</div>
<div class="ltx_listingline" id="alg4.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l4.1.1.1" style="font-size:80%;">4:</span></span>        <math alttext="r" class="ltx_Math" display="inline" id="alg4.l4.m1.1"><semantics id="alg4.l4.m1.1a"><mi id="alg4.l4.m1.1.1" xref="alg4.l4.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="alg4.l4.m1.1b"><ci id="alg4.l4.m1.1.1.cmml" xref="alg4.l4.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l4.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="alg4.l4.m1.1d">italic_r</annotation></semantics></math>.memory <math alttext="\leftarrow" class="ltx_Math" display="inline" id="alg4.l4.m2.1"><semantics id="alg4.l4.m2.1a"><mo id="alg4.l4.m2.1.1" stretchy="false" xref="alg4.l4.m2.1.1.cmml">←</mo><annotation-xml encoding="MathML-Content" id="alg4.l4.m2.1b"><ci id="alg4.l4.m2.1.1.cmml" xref="alg4.l4.m2.1.1">←</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l4.m2.1c">\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg4.l4.m2.1d">←</annotation></semantics></math> Central Memory Pool <math alttext="P" class="ltx_Math" display="inline" id="alg4.l4.m3.1"><semantics id="alg4.l4.m3.1a"><mi id="alg4.l4.m3.1.1" xref="alg4.l4.m3.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="alg4.l4.m3.1b"><ci id="alg4.l4.m3.1.1.cmml" xref="alg4.l4.m3.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l4.m3.1c">P</annotation><annotation encoding="application/x-llamapun" id="alg4.l4.m3.1d">italic_P</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg4.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l5.1.1.1" style="font-size:80%;">5:</span></span>     <span class="ltx_text ltx_font_bold" id="alg4.l5.2">end</span> <span class="ltx_text ltx_font_bold" id="alg4.l5.3">if</span>
</div>
<div class="ltx_listingline" id="alg4.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l6.1.1.1" style="font-size:80%;">6:</span></span>     submit kernel Search(q.queries, <math alttext="r" class="ltx_Math" display="inline" id="alg4.l6.m1.1"><semantics id="alg4.l6.m1.1a"><mi id="alg4.l6.m1.1.1" xref="alg4.l6.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="alg4.l6.m1.1b"><ci id="alg4.l6.m1.1.1.cmml" xref="alg4.l6.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l6.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="alg4.l6.m1.1d">italic_r</annotation></semantics></math>) on <math alttext="r" class="ltx_Math" display="inline" id="alg4.l6.m2.1"><semantics id="alg4.l6.m2.1a"><mi id="alg4.l6.m2.1.1" xref="alg4.l6.m2.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="alg4.l6.m2.1b"><ci id="alg4.l6.m2.1.1.cmml" xref="alg4.l6.m2.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg4.l6.m2.1c">r</annotation><annotation encoding="application/x-llamapun" id="alg4.l6.m2.1d">italic_r</annotation></semantics></math>.stream

</div>
<div class="ltx_listingline" id="alg4.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l7.1.1.1" style="font-size:80%;">7:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l7.2">else</span> <span class="ltx_text ltx_font_bold" id="alg4.l7.3">if</span> q.type == vector insertion <span class="ltx_text ltx_font_bold" id="alg4.l7.4">then</span>
</div>
<div class="ltx_listingline" id="alg4.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l8.1.1.1" style="font-size:80%;">8:</span></span>     submit kernel Insertion(q.vectors) on data stream

</div>
<div class="ltx_listingline" id="alg4.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg4.l9.1.1.1" style="font-size:80%;">9:</span></span>  <span class="ltx_text ltx_font_bold" id="alg4.l9.2">end</span> <span class="ltx_text ltx_font_bold" id="alg4.l9.3">if</span>
</div>
</div>
</figure>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3. </span>Deployment Detail</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1">In this section, we delve into the deployment intricacies of our real-time adaptive multi-stream GPU system within real-world systems. Our system has been operational for over six months on T4/A10 GPU machines, seamlessly integrated into both the search and recommendation systems of a widely-used information app catering to over 100 million daily users. Comprising two essential segments, namely the offline and online components, our system efficiently manages both prepared data and real-time vector insertion tasks.</p>
</div>
<div class="ltx_para" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.1">The offline segment is dedicated to processing prepared data, while the online segment orchestrates real-time vector insertion operations. Managed by multiple CPU threads and interfacing with Kafka for message ingestion, the online segment implements a dynamic batching strategy, aggregating vectors either every second or upon reaching a threshold of 128 insertions, with a cap at 1024, before dispatching the aggregated batch to the GPU.</p>
</div>
<div class="ltx_para" id="S3.SS3.p3">
<p class="ltx_p" id="S3.SS3.p3.1">Before kernel execution, we meticulously allocate 32 independent resources from the resource pool, each provisioned with 50MB of cached memory, as previously detailed. In instances where temporary memory requirements surpass this threshold, additional memory is sourced from the central pool, with each allocation set at 200MB. To ensure equitable resource allocation, particularly under high QPS conditions, we have devised a lock-free queue mechanism. Requests are rejected when all 32 resources are exhausted. Additionally, we establish a dedicated stream for vector insertion tasks to streamline processing.</p>
</div>
<div class="ltx_para" id="S3.SS3.p4">
<p class="ltx_p" id="S3.SS3.p4.2">For the central memory pool <math alttext="P" class="ltx_Math" display="inline" id="S3.SS3.p4.1.m1.1"><semantics id="S3.SS3.p4.1.m1.1a"><mi id="S3.SS3.p4.1.m1.1.1" xref="S3.SS3.p4.1.m1.1.1.cmml">P</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.1.m1.1b"><ci id="S3.SS3.p4.1.m1.1.1.cmml" xref="S3.SS3.p4.1.m1.1.1">𝑃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.1.m1.1c">P</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.1.m1.1d">italic_P</annotation></semantics></math>, we employ it across two distinct domains: search and insertion. To maintain cohesive control within a singular pool, we adopt a high address allocation strategy for search and low addresses for insertion. An alert mechanism triggers when resource utilization exceeds the <math alttext="90\%" class="ltx_Math" display="inline" id="S3.SS3.p4.2.m2.1"><semantics id="S3.SS3.p4.2.m2.1a"><mrow id="S3.SS3.p4.2.m2.1.1" xref="S3.SS3.p4.2.m2.1.1.cmml"><mn id="S3.SS3.p4.2.m2.1.1.2" xref="S3.SS3.p4.2.m2.1.1.2.cmml">90</mn><mo id="S3.SS3.p4.2.m2.1.1.1" xref="S3.SS3.p4.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.2.m2.1b"><apply id="S3.SS3.p4.2.m2.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1"><csymbol cd="latexml" id="S3.SS3.p4.2.m2.1.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1.1">percent</csymbol><cn id="S3.SS3.p4.2.m2.1.1.2.cmml" type="integer" xref="S3.SS3.p4.2.m2.1.1.2">90</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.2.m2.1c">90\%</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.2.m2.1d">90 %</annotation></semantics></math> threshold.</p>
</div>
<figure class="ltx_figure" id="S3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="405" id="S3.F3.g1" src="x3.png" width="714"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3. </span>Latency Comparison on SIFT1m and DSSMRT40M under QPS<sub class="ltx_sub" id="S3.F3.4.1"><span class="ltx_text ltx_font_italic" id="S3.F3.4.1.1">search</span></sub> = 1000, 5000, 10000</figcaption>
</figure>
<div class="ltx_para" id="S3.SS3.p5">
<p class="ltx_p" id="S3.SS3.p5.1">During kernel execution, memory allocation for each block <math alttext="m" class="ltx_Math" display="inline" id="S3.SS3.p5.1.m1.1"><semantics id="S3.SS3.p5.1.m1.1a"><mi id="S3.SS3.p5.1.m1.1.1" xref="S3.SS3.p5.1.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p5.1.m1.1b"><ci id="S3.SS3.p5.1.m1.1.1.cmml" xref="S3.SS3.p5.1.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p5.1.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p5.1.m1.1d">italic_m</annotation></semantics></math> is meticulously tailored to accommodate 1024 vectors, with thread counts deliberately set below 1024 to preempt conflicts. This proactive measure mitigates scenarios where simultaneous requests for two new memory blocks for vector insertion arise. At present, in both the vector insertion and rearrangement kernels, only one block is activated to circumvent potential resource contention inherent in the current design. Nonetheless, this level of parallelism suffices to manage the workload segment effectively.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Experiment</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">In this section, we aim to validate the performance of our system in various environments through experimentation. We will conduct tests on both the standard dataset SIFT1M (dim 128, we use the same SIFT1M as online vector) and an industrial dataset DSSMRT40M (dim 64, we have dumped the other 10M online vectors). The specific details of the datasets are as follows: to simulate real-time data insertion, we will replay the SIFT1M dataset for insertion, while the additional 10M data in DSSMRT40M is obtained by dumping newly inserted vectors from an online Kafka source. We have designed the following three sets of experiments to analyze the performance differences between our system and existing systems: comparing the performance differences under different retrieval QPS and real-time insertion QPS on both the standard dataset and the industrial dataset, comparing the performance differences between scenarios with and without rearrangement for high-QPS insertion vectors and comparing the performance differences under different memory block parameters.
The systems we will compare with are as follows:</p>
<ul class="ltx_itemize" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.1">Faiss <cite class="ltx_cite ltx_citemacro_citep">(Johnson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib11" title="">2019</a>)</cite>: Implements an <span class="ltx_text ltx_font_typewriter" id="S4.I1.i1.p1.1.1">add</span> interface, which requires copying data back to the CPU for statistical analysis before copying it back to the GPU for actual vector concatenation.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1">Raft <cite class="ltx_cite ltx_citemacro_citep">(Rapidsai, <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#bib.bib18" title="">2022</a>)</cite>: Implements an <span class="ltx_text ltx_font_typewriter" id="S4.I1.i2.p1.1.1">extend</span> interface, allowing reallocation of a new space for the chain on the GPU and swapping.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i3.p1">
<p class="ltx_p" id="S4.I1.i3.p1.1">Rt-cpu: We implement a CPU-based dynamic vector insertion system based on our proposed method, linking pre-allocated memory blocks using linked lists.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i4.p1">
<p class="ltx_p" id="S4.I1.i4.p1.1">RTMS-GANNS(Proposed Method): The first dynamic vector insertion system for ivfflat and ivfpq on the GPU, supporting multi-stream parallelism with retrieval.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1">To simulate online real-time insertion requests, we have developed a real-time triggering program that triggers a batch of vector insertions at regular intervals. We also set the maximum batch size of Search kernel is 10 since online requests won’t be able to wait too long and the cost to batch requests is also expensive. We used a machine equipped with an A10 GPU and 28C-112G AMD Milan processor. The Rt-cpu system only utilizes the CPU part of the processor.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1. </span>Performance on different QPS</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">We compared the performance of four systems on the SIFT1M and DSSMRT40M datasets, focusing on latency under high QPS within specific latency constraints, as these are critical for our online systems. We set latency timeouts for both the Insertion and Search Kernels to handle situations when the system cannot process requests in time. Our analysis is confined to the latency observed in the first 10 seconds of operations. To provide a comprehensive view of system performance, we devised a new metric to evaluate the combined latency of the Search and Insertion operations:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{latency}_{\text{avg}}=\text{latency}_{\text{avg}}(\text{Search})+\text{%
latency}_{\text{avg}}(\text{Insertion})" class="ltx_Math" display="block" id="S4.E4.m1.2"><semantics id="S4.E4.m1.2a"><mrow id="S4.E4.m1.2.3" xref="S4.E4.m1.2.3.cmml"><msub id="S4.E4.m1.2.3.2" xref="S4.E4.m1.2.3.2.cmml"><mtext id="S4.E4.m1.2.3.2.2" xref="S4.E4.m1.2.3.2.2a.cmml">latency</mtext><mtext id="S4.E4.m1.2.3.2.3" xref="S4.E4.m1.2.3.2.3a.cmml">avg</mtext></msub><mo id="S4.E4.m1.2.3.1" xref="S4.E4.m1.2.3.1.cmml">=</mo><mrow id="S4.E4.m1.2.3.3" xref="S4.E4.m1.2.3.3.cmml"><mrow id="S4.E4.m1.2.3.3.2" xref="S4.E4.m1.2.3.3.2.cmml"><msub id="S4.E4.m1.2.3.3.2.2" xref="S4.E4.m1.2.3.3.2.2.cmml"><mtext id="S4.E4.m1.2.3.3.2.2.2" xref="S4.E4.m1.2.3.3.2.2.2a.cmml">latency</mtext><mtext id="S4.E4.m1.2.3.3.2.2.3" xref="S4.E4.m1.2.3.3.2.2.3a.cmml">avg</mtext></msub><mo id="S4.E4.m1.2.3.3.2.1" xref="S4.E4.m1.2.3.3.2.1.cmml">⁢</mo><mrow id="S4.E4.m1.2.3.3.2.3.2" xref="S4.E4.m1.1.1a.cmml"><mo id="S4.E4.m1.2.3.3.2.3.2.1" stretchy="false" xref="S4.E4.m1.1.1a.cmml">(</mo><mtext id="S4.E4.m1.1.1" xref="S4.E4.m1.1.1.cmml">Search</mtext><mo id="S4.E4.m1.2.3.3.2.3.2.2" stretchy="false" xref="S4.E4.m1.1.1a.cmml">)</mo></mrow></mrow><mo id="S4.E4.m1.2.3.3.1" xref="S4.E4.m1.2.3.3.1.cmml">+</mo><mrow id="S4.E4.m1.2.3.3.3" xref="S4.E4.m1.2.3.3.3.cmml"><msub id="S4.E4.m1.2.3.3.3.2" xref="S4.E4.m1.2.3.3.3.2.cmml"><mtext id="S4.E4.m1.2.3.3.3.2.2" xref="S4.E4.m1.2.3.3.3.2.2a.cmml">latency</mtext><mtext id="S4.E4.m1.2.3.3.3.2.3" xref="S4.E4.m1.2.3.3.3.2.3a.cmml">avg</mtext></msub><mo id="S4.E4.m1.2.3.3.3.1" xref="S4.E4.m1.2.3.3.3.1.cmml">⁢</mo><mrow id="S4.E4.m1.2.3.3.3.3.2" xref="S4.E4.m1.2.2a.cmml"><mo id="S4.E4.m1.2.3.3.3.3.2.1" stretchy="false" xref="S4.E4.m1.2.2a.cmml">(</mo><mtext id="S4.E4.m1.2.2" xref="S4.E4.m1.2.2.cmml">Insertion</mtext><mo id="S4.E4.m1.2.3.3.3.3.2.2" stretchy="false" xref="S4.E4.m1.2.2a.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E4.m1.2b"><apply id="S4.E4.m1.2.3.cmml" xref="S4.E4.m1.2.3"><eq id="S4.E4.m1.2.3.1.cmml" xref="S4.E4.m1.2.3.1"></eq><apply id="S4.E4.m1.2.3.2.cmml" xref="S4.E4.m1.2.3.2"><csymbol cd="ambiguous" id="S4.E4.m1.2.3.2.1.cmml" xref="S4.E4.m1.2.3.2">subscript</csymbol><ci id="S4.E4.m1.2.3.2.2a.cmml" xref="S4.E4.m1.2.3.2.2"><mtext id="S4.E4.m1.2.3.2.2.cmml" xref="S4.E4.m1.2.3.2.2">latency</mtext></ci><ci id="S4.E4.m1.2.3.2.3a.cmml" xref="S4.E4.m1.2.3.2.3"><mtext id="S4.E4.m1.2.3.2.3.cmml" mathsize="70%" xref="S4.E4.m1.2.3.2.3">avg</mtext></ci></apply><apply id="S4.E4.m1.2.3.3.cmml" xref="S4.E4.m1.2.3.3"><plus id="S4.E4.m1.2.3.3.1.cmml" xref="S4.E4.m1.2.3.3.1"></plus><apply id="S4.E4.m1.2.3.3.2.cmml" xref="S4.E4.m1.2.3.3.2"><times id="S4.E4.m1.2.3.3.2.1.cmml" xref="S4.E4.m1.2.3.3.2.1"></times><apply id="S4.E4.m1.2.3.3.2.2.cmml" xref="S4.E4.m1.2.3.3.2.2"><csymbol cd="ambiguous" id="S4.E4.m1.2.3.3.2.2.1.cmml" xref="S4.E4.m1.2.3.3.2.2">subscript</csymbol><ci id="S4.E4.m1.2.3.3.2.2.2a.cmml" xref="S4.E4.m1.2.3.3.2.2.2"><mtext id="S4.E4.m1.2.3.3.2.2.2.cmml" xref="S4.E4.m1.2.3.3.2.2.2">latency</mtext></ci><ci id="S4.E4.m1.2.3.3.2.2.3a.cmml" xref="S4.E4.m1.2.3.3.2.2.3"><mtext id="S4.E4.m1.2.3.3.2.2.3.cmml" mathsize="70%" xref="S4.E4.m1.2.3.3.2.2.3">avg</mtext></ci></apply><ci id="S4.E4.m1.1.1a.cmml" xref="S4.E4.m1.2.3.3.2.3.2"><mtext id="S4.E4.m1.1.1.cmml" xref="S4.E4.m1.1.1">Search</mtext></ci></apply><apply id="S4.E4.m1.2.3.3.3.cmml" xref="S4.E4.m1.2.3.3.3"><times id="S4.E4.m1.2.3.3.3.1.cmml" xref="S4.E4.m1.2.3.3.3.1"></times><apply id="S4.E4.m1.2.3.3.3.2.cmml" xref="S4.E4.m1.2.3.3.3.2"><csymbol cd="ambiguous" id="S4.E4.m1.2.3.3.3.2.1.cmml" xref="S4.E4.m1.2.3.3.3.2">subscript</csymbol><ci id="S4.E4.m1.2.3.3.3.2.2a.cmml" xref="S4.E4.m1.2.3.3.3.2.2"><mtext id="S4.E4.m1.2.3.3.3.2.2.cmml" xref="S4.E4.m1.2.3.3.3.2.2">latency</mtext></ci><ci id="S4.E4.m1.2.3.3.3.2.3a.cmml" xref="S4.E4.m1.2.3.3.3.2.3"><mtext id="S4.E4.m1.2.3.3.3.2.3.cmml" mathsize="70%" xref="S4.E4.m1.2.3.3.3.2.3">avg</mtext></ci></apply><ci id="S4.E4.m1.2.2a.cmml" xref="S4.E4.m1.2.3.3.3.3.2"><mtext id="S4.E4.m1.2.2.cmml" xref="S4.E4.m1.2.2">Insertion</mtext></ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E4.m1.2c">\text{latency}_{\text{avg}}=\text{latency}_{\text{avg}}(\text{Search})+\text{%
latency}_{\text{avg}}(\text{Insertion})</annotation><annotation encoding="application/x-llamapun" id="S4.E4.m1.2d">latency start_POSTSUBSCRIPT avg end_POSTSUBSCRIPT = latency start_POSTSUBSCRIPT avg end_POSTSUBSCRIPT ( Search ) + latency start_POSTSUBSCRIPT avg end_POSTSUBSCRIPT ( Insertion )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.p1.2">We can first conclude that the RTMS-GANNS (proposed method) not only achieves latency benefits on small datasets (Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>abc) but also shows significant improvements on large datasets (Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>def).</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.4">Firstly, RTMS-GANNS can outperform previous systems with up to a 40% reduction in latency even at low <math alttext="\text{QPS}_{insertion}" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><msub id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml"><mtext id="S4.SS1.p2.1.m1.1.1.2" xref="S4.SS1.p2.1.m1.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS1.p2.1.m1.1.1.3" xref="S4.SS1.p2.1.m1.1.1.3.cmml"><mi id="S4.SS1.p2.1.m1.1.1.3.2" xref="S4.SS1.p2.1.m1.1.1.3.2.cmml">i</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.3" xref="S4.SS1.p2.1.m1.1.1.3.3.cmml">n</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1a" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.4" xref="S4.SS1.p2.1.m1.1.1.3.4.cmml">s</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1b" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.5" xref="S4.SS1.p2.1.m1.1.1.3.5.cmml">e</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1c" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.6" xref="S4.SS1.p2.1.m1.1.1.3.6.cmml">r</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1d" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.7" xref="S4.SS1.p2.1.m1.1.1.3.7.cmml">t</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1e" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.8" xref="S4.SS1.p2.1.m1.1.1.3.8.cmml">i</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1f" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.9" xref="S4.SS1.p2.1.m1.1.1.3.9.cmml">o</mi><mo id="S4.SS1.p2.1.m1.1.1.3.1g" xref="S4.SS1.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3.10" xref="S4.SS1.p2.1.m1.1.1.3.10.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><apply id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.1.m1.1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p2.1.m1.1.1.2a.cmml" xref="S4.SS1.p2.1.m1.1.1.2"><mtext id="S4.SS1.p2.1.m1.1.1.2.cmml" xref="S4.SS1.p2.1.m1.1.1.2">QPS</mtext></ci><apply id="S4.SS1.p2.1.m1.1.1.3.cmml" xref="S4.SS1.p2.1.m1.1.1.3"><times id="S4.SS1.p2.1.m1.1.1.3.1.cmml" xref="S4.SS1.p2.1.m1.1.1.3.1"></times><ci id="S4.SS1.p2.1.m1.1.1.3.2.cmml" xref="S4.SS1.p2.1.m1.1.1.3.2">𝑖</ci><ci id="S4.SS1.p2.1.m1.1.1.3.3.cmml" xref="S4.SS1.p2.1.m1.1.1.3.3">𝑛</ci><ci id="S4.SS1.p2.1.m1.1.1.3.4.cmml" xref="S4.SS1.p2.1.m1.1.1.3.4">𝑠</ci><ci id="S4.SS1.p2.1.m1.1.1.3.5.cmml" xref="S4.SS1.p2.1.m1.1.1.3.5">𝑒</ci><ci id="S4.SS1.p2.1.m1.1.1.3.6.cmml" xref="S4.SS1.p2.1.m1.1.1.3.6">𝑟</ci><ci id="S4.SS1.p2.1.m1.1.1.3.7.cmml" xref="S4.SS1.p2.1.m1.1.1.3.7">𝑡</ci><ci id="S4.SS1.p2.1.m1.1.1.3.8.cmml" xref="S4.SS1.p2.1.m1.1.1.3.8">𝑖</ci><ci id="S4.SS1.p2.1.m1.1.1.3.9.cmml" xref="S4.SS1.p2.1.m1.1.1.3.9">𝑜</ci><ci id="S4.SS1.p2.1.m1.1.1.3.10.cmml" xref="S4.SS1.p2.1.m1.1.1.3.10">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">\text{QPS}_{insertion}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">QPS start_POSTSUBSCRIPT italic_i italic_n italic_s italic_e italic_r italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math>, benefiting from dynamic vector insertion algorithm and multi-stream parallelism. Requests are immediately processed upon arrival without waiting for the previous task to complete, reducing latency by at least 1ms in Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>a and d. Secondly, as QPS increases, RTMS-GANNS has the lowest growth rate in latency, with a maximum reduction of over 80% (Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>ef). Except for a slight increase in Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>f due to the higher computational load of large datasets, it shows nearly linear growth under other parameters. Moreover, other systems timeout a lot (reflecting the <math alttext="\text{latency}_{\text{avg}}" class="ltx_Math" display="inline" id="S4.SS1.p2.2.m2.1"><semantics id="S4.SS1.p2.2.m2.1a"><msub id="S4.SS1.p2.2.m2.1.1" xref="S4.SS1.p2.2.m2.1.1.cmml"><mtext id="S4.SS1.p2.2.m2.1.1.2" xref="S4.SS1.p2.2.m2.1.1.2a.cmml">latency</mtext><mtext id="S4.SS1.p2.2.m2.1.1.3" xref="S4.SS1.p2.2.m2.1.1.3a.cmml">avg</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.2.m2.1b"><apply id="S4.SS1.p2.2.m2.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.2.m2.1.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.p2.2.m2.1.1.2a.cmml" xref="S4.SS1.p2.2.m2.1.1.2"><mtext id="S4.SS1.p2.2.m2.1.1.2.cmml" xref="S4.SS1.p2.2.m2.1.1.2">latency</mtext></ci><ci id="S4.SS1.p2.2.m2.1.1.3a.cmml" xref="S4.SS1.p2.2.m2.1.1.3"><mtext id="S4.SS1.p2.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.2.m2.1.1.3">avg</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.2.m2.1c">\text{latency}_{\text{avg}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.2.m2.1d">latency start_POSTSUBSCRIPT avg end_POSTSUBSCRIPT</annotation></semantics></math> is over 20ms) when <math alttext="\text{QPS}_{search}" class="ltx_Math" display="inline" id="S4.SS1.p2.3.m3.1"><semantics id="S4.SS1.p2.3.m3.1a"><msub id="S4.SS1.p2.3.m3.1.1" xref="S4.SS1.p2.3.m3.1.1.cmml"><mtext id="S4.SS1.p2.3.m3.1.1.2" xref="S4.SS1.p2.3.m3.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS1.p2.3.m3.1.1.3" xref="S4.SS1.p2.3.m3.1.1.3.cmml"><mi id="S4.SS1.p2.3.m3.1.1.3.2" xref="S4.SS1.p2.3.m3.1.1.3.2.cmml">s</mi><mo id="S4.SS1.p2.3.m3.1.1.3.1" xref="S4.SS1.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.3.m3.1.1.3.3" xref="S4.SS1.p2.3.m3.1.1.3.3.cmml">e</mi><mo id="S4.SS1.p2.3.m3.1.1.3.1a" xref="S4.SS1.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.3.m3.1.1.3.4" xref="S4.SS1.p2.3.m3.1.1.3.4.cmml">a</mi><mo id="S4.SS1.p2.3.m3.1.1.3.1b" xref="S4.SS1.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.3.m3.1.1.3.5" xref="S4.SS1.p2.3.m3.1.1.3.5.cmml">r</mi><mo id="S4.SS1.p2.3.m3.1.1.3.1c" xref="S4.SS1.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.3.m3.1.1.3.6" xref="S4.SS1.p2.3.m3.1.1.3.6.cmml">c</mi><mo id="S4.SS1.p2.3.m3.1.1.3.1d" xref="S4.SS1.p2.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.3.m3.1.1.3.7" xref="S4.SS1.p2.3.m3.1.1.3.7.cmml">h</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.3.m3.1b"><apply id="S4.SS1.p2.3.m3.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.3.m3.1.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS1.p2.3.m3.1.1.2a.cmml" xref="S4.SS1.p2.3.m3.1.1.2"><mtext id="S4.SS1.p2.3.m3.1.1.2.cmml" xref="S4.SS1.p2.3.m3.1.1.2">QPS</mtext></ci><apply id="S4.SS1.p2.3.m3.1.1.3.cmml" xref="S4.SS1.p2.3.m3.1.1.3"><times id="S4.SS1.p2.3.m3.1.1.3.1.cmml" xref="S4.SS1.p2.3.m3.1.1.3.1"></times><ci id="S4.SS1.p2.3.m3.1.1.3.2.cmml" xref="S4.SS1.p2.3.m3.1.1.3.2">𝑠</ci><ci id="S4.SS1.p2.3.m3.1.1.3.3.cmml" xref="S4.SS1.p2.3.m3.1.1.3.3">𝑒</ci><ci id="S4.SS1.p2.3.m3.1.1.3.4.cmml" xref="S4.SS1.p2.3.m3.1.1.3.4">𝑎</ci><ci id="S4.SS1.p2.3.m3.1.1.3.5.cmml" xref="S4.SS1.p2.3.m3.1.1.3.5">𝑟</ci><ci id="S4.SS1.p2.3.m3.1.1.3.6.cmml" xref="S4.SS1.p2.3.m3.1.1.3.6">𝑐</ci><ci id="S4.SS1.p2.3.m3.1.1.3.7.cmml" xref="S4.SS1.p2.3.m3.1.1.3.7">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.3.m3.1c">\text{QPS}_{search}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.3.m3.1d">QPS start_POSTSUBSCRIPT italic_s italic_e italic_a italic_r italic_c italic_h end_POSTSUBSCRIPT</annotation></semantics></math> is over 5000 and <math alttext="\text{QPS}_{insertion}" class="ltx_Math" display="inline" id="S4.SS1.p2.4.m4.1"><semantics id="S4.SS1.p2.4.m4.1a"><msub id="S4.SS1.p2.4.m4.1.1" xref="S4.SS1.p2.4.m4.1.1.cmml"><mtext id="S4.SS1.p2.4.m4.1.1.2" xref="S4.SS1.p2.4.m4.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS1.p2.4.m4.1.1.3" xref="S4.SS1.p2.4.m4.1.1.3.cmml"><mi id="S4.SS1.p2.4.m4.1.1.3.2" xref="S4.SS1.p2.4.m4.1.1.3.2.cmml">i</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.3" xref="S4.SS1.p2.4.m4.1.1.3.3.cmml">n</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1a" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.4" xref="S4.SS1.p2.4.m4.1.1.3.4.cmml">s</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1b" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.5" xref="S4.SS1.p2.4.m4.1.1.3.5.cmml">e</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1c" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.6" xref="S4.SS1.p2.4.m4.1.1.3.6.cmml">r</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1d" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.7" xref="S4.SS1.p2.4.m4.1.1.3.7.cmml">t</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1e" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.8" xref="S4.SS1.p2.4.m4.1.1.3.8.cmml">i</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1f" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.9" xref="S4.SS1.p2.4.m4.1.1.3.9.cmml">o</mi><mo id="S4.SS1.p2.4.m4.1.1.3.1g" xref="S4.SS1.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p2.4.m4.1.1.3.10" xref="S4.SS1.p2.4.m4.1.1.3.10.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.4.m4.1b"><apply id="S4.SS1.p2.4.m4.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.4.m4.1.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.p2.4.m4.1.1.2a.cmml" xref="S4.SS1.p2.4.m4.1.1.2"><mtext id="S4.SS1.p2.4.m4.1.1.2.cmml" xref="S4.SS1.p2.4.m4.1.1.2">QPS</mtext></ci><apply id="S4.SS1.p2.4.m4.1.1.3.cmml" xref="S4.SS1.p2.4.m4.1.1.3"><times id="S4.SS1.p2.4.m4.1.1.3.1.cmml" xref="S4.SS1.p2.4.m4.1.1.3.1"></times><ci id="S4.SS1.p2.4.m4.1.1.3.2.cmml" xref="S4.SS1.p2.4.m4.1.1.3.2">𝑖</ci><ci id="S4.SS1.p2.4.m4.1.1.3.3.cmml" xref="S4.SS1.p2.4.m4.1.1.3.3">𝑛</ci><ci id="S4.SS1.p2.4.m4.1.1.3.4.cmml" xref="S4.SS1.p2.4.m4.1.1.3.4">𝑠</ci><ci id="S4.SS1.p2.4.m4.1.1.3.5.cmml" xref="S4.SS1.p2.4.m4.1.1.3.5">𝑒</ci><ci id="S4.SS1.p2.4.m4.1.1.3.6.cmml" xref="S4.SS1.p2.4.m4.1.1.3.6">𝑟</ci><ci id="S4.SS1.p2.4.m4.1.1.3.7.cmml" xref="S4.SS1.p2.4.m4.1.1.3.7">𝑡</ci><ci id="S4.SS1.p2.4.m4.1.1.3.8.cmml" xref="S4.SS1.p2.4.m4.1.1.3.8">𝑖</ci><ci id="S4.SS1.p2.4.m4.1.1.3.9.cmml" xref="S4.SS1.p2.4.m4.1.1.3.9">𝑜</ci><ci id="S4.SS1.p2.4.m4.1.1.3.10.cmml" xref="S4.SS1.p2.4.m4.1.1.3.10">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.4.m4.1c">\text{QPS}_{insertion}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.4.m4.1d">QPS start_POSTSUBSCRIPT italic_i italic_n italic_s italic_e italic_r italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math> is over 1000, demonstrating that RTMS-GANNS’s dynamic vector insertion algorithm can efficiently run within the multi-stream parallel framework without causing any delay.</p>
</div>
<div class="ltx_para" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.2">Among the four systems, the CPU-based system has the highest latency due to its inferior performance compared to the GPU. However, at lower <math alttext="\text{QPS}_{search}" class="ltx_Math" display="inline" id="S4.SS1.p3.1.m1.1"><semantics id="S4.SS1.p3.1.m1.1a"><msub id="S4.SS1.p3.1.m1.1.1" xref="S4.SS1.p3.1.m1.1.1.cmml"><mtext id="S4.SS1.p3.1.m1.1.1.2" xref="S4.SS1.p3.1.m1.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS1.p3.1.m1.1.1.3" xref="S4.SS1.p3.1.m1.1.1.3.cmml"><mi id="S4.SS1.p3.1.m1.1.1.3.2" xref="S4.SS1.p3.1.m1.1.1.3.2.cmml">s</mi><mo id="S4.SS1.p3.1.m1.1.1.3.1" xref="S4.SS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.1.m1.1.1.3.3" xref="S4.SS1.p3.1.m1.1.1.3.3.cmml">e</mi><mo id="S4.SS1.p3.1.m1.1.1.3.1a" xref="S4.SS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.1.m1.1.1.3.4" xref="S4.SS1.p3.1.m1.1.1.3.4.cmml">a</mi><mo id="S4.SS1.p3.1.m1.1.1.3.1b" xref="S4.SS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.1.m1.1.1.3.5" xref="S4.SS1.p3.1.m1.1.1.3.5.cmml">r</mi><mo id="S4.SS1.p3.1.m1.1.1.3.1c" xref="S4.SS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.1.m1.1.1.3.6" xref="S4.SS1.p3.1.m1.1.1.3.6.cmml">c</mi><mo id="S4.SS1.p3.1.m1.1.1.3.1d" xref="S4.SS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.1.m1.1.1.3.7" xref="S4.SS1.p3.1.m1.1.1.3.7.cmml">h</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.1.m1.1b"><apply id="S4.SS1.p3.1.m1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.1.m1.1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p3.1.m1.1.1.2a.cmml" xref="S4.SS1.p3.1.m1.1.1.2"><mtext id="S4.SS1.p3.1.m1.1.1.2.cmml" xref="S4.SS1.p3.1.m1.1.1.2">QPS</mtext></ci><apply id="S4.SS1.p3.1.m1.1.1.3.cmml" xref="S4.SS1.p3.1.m1.1.1.3"><times id="S4.SS1.p3.1.m1.1.1.3.1.cmml" xref="S4.SS1.p3.1.m1.1.1.3.1"></times><ci id="S4.SS1.p3.1.m1.1.1.3.2.cmml" xref="S4.SS1.p3.1.m1.1.1.3.2">𝑠</ci><ci id="S4.SS1.p3.1.m1.1.1.3.3.cmml" xref="S4.SS1.p3.1.m1.1.1.3.3">𝑒</ci><ci id="S4.SS1.p3.1.m1.1.1.3.4.cmml" xref="S4.SS1.p3.1.m1.1.1.3.4">𝑎</ci><ci id="S4.SS1.p3.1.m1.1.1.3.5.cmml" xref="S4.SS1.p3.1.m1.1.1.3.5">𝑟</ci><ci id="S4.SS1.p3.1.m1.1.1.3.6.cmml" xref="S4.SS1.p3.1.m1.1.1.3.6">𝑐</ci><ci id="S4.SS1.p3.1.m1.1.1.3.7.cmml" xref="S4.SS1.p3.1.m1.1.1.3.7">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.1.m1.1c">\text{QPS}_{search}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.1.m1.1d">QPS start_POSTSUBSCRIPT italic_s italic_e italic_a italic_r italic_c italic_h end_POSTSUBSCRIPT</annotation></semantics></math> on DSSMRT40M, it exhibits a linear increase in latency, which makes it outperform Faiss at <math alttext="\text{QPS}_{insertion}" class="ltx_Math" display="inline" id="S4.SS1.p3.2.m2.1"><semantics id="S4.SS1.p3.2.m2.1a"><msub id="S4.SS1.p3.2.m2.1.1" xref="S4.SS1.p3.2.m2.1.1.cmml"><mtext id="S4.SS1.p3.2.m2.1.1.2" xref="S4.SS1.p3.2.m2.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS1.p3.2.m2.1.1.3" xref="S4.SS1.p3.2.m2.1.1.3.cmml"><mi id="S4.SS1.p3.2.m2.1.1.3.2" xref="S4.SS1.p3.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.3" xref="S4.SS1.p3.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1a" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.4" xref="S4.SS1.p3.2.m2.1.1.3.4.cmml">s</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1b" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.5" xref="S4.SS1.p3.2.m2.1.1.3.5.cmml">e</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1c" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.6" xref="S4.SS1.p3.2.m2.1.1.3.6.cmml">r</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1d" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.7" xref="S4.SS1.p3.2.m2.1.1.3.7.cmml">t</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1e" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.8" xref="S4.SS1.p3.2.m2.1.1.3.8.cmml">i</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1f" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.9" xref="S4.SS1.p3.2.m2.1.1.3.9.cmml">o</mi><mo id="S4.SS1.p3.2.m2.1.1.3.1g" xref="S4.SS1.p3.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m2.1.1.3.10" xref="S4.SS1.p3.2.m2.1.1.3.10.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.2.m2.1b"><apply id="S4.SS1.p3.2.m2.1.1.cmml" xref="S4.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.2.m2.1.1.1.cmml" xref="S4.SS1.p3.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.p3.2.m2.1.1.2a.cmml" xref="S4.SS1.p3.2.m2.1.1.2"><mtext id="S4.SS1.p3.2.m2.1.1.2.cmml" xref="S4.SS1.p3.2.m2.1.1.2">QPS</mtext></ci><apply id="S4.SS1.p3.2.m2.1.1.3.cmml" xref="S4.SS1.p3.2.m2.1.1.3"><times id="S4.SS1.p3.2.m2.1.1.3.1.cmml" xref="S4.SS1.p3.2.m2.1.1.3.1"></times><ci id="S4.SS1.p3.2.m2.1.1.3.2.cmml" xref="S4.SS1.p3.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS1.p3.2.m2.1.1.3.3.cmml" xref="S4.SS1.p3.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS1.p3.2.m2.1.1.3.4.cmml" xref="S4.SS1.p3.2.m2.1.1.3.4">𝑠</ci><ci id="S4.SS1.p3.2.m2.1.1.3.5.cmml" xref="S4.SS1.p3.2.m2.1.1.3.5">𝑒</ci><ci id="S4.SS1.p3.2.m2.1.1.3.6.cmml" xref="S4.SS1.p3.2.m2.1.1.3.6">𝑟</ci><ci id="S4.SS1.p3.2.m2.1.1.3.7.cmml" xref="S4.SS1.p3.2.m2.1.1.3.7">𝑡</ci><ci id="S4.SS1.p3.2.m2.1.1.3.8.cmml" xref="S4.SS1.p3.2.m2.1.1.3.8">𝑖</ci><ci id="S4.SS1.p3.2.m2.1.1.3.9.cmml" xref="S4.SS1.p3.2.m2.1.1.3.9">𝑜</ci><ci id="S4.SS1.p3.2.m2.1.1.3.10.cmml" xref="S4.SS1.p3.2.m2.1.1.3.10">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.2.m2.1c">\text{QPS}_{insertion}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.2.m2.1d">QPS start_POSTSUBSCRIPT italic_i italic_n italic_s italic_e italic_r italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math> = 2000 in Figure.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S3.F3" title="Figure 3 ‣ 3.3. Deployment Detail ‣ 3. System Overview ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">3</span></a>d. This observation aligns with our practical experience, where real-time insertions on CPU systems do not significantly affect normal retrieval performance. Additionally, it was found that both the retrieval and insertion performance of Faiss lag behind Raft and RTMS-GANNS. This is because the add operation in Faiss requires copying the vector list to the CPU and then back to the GPU, which is highly inefficient for large datasets, and the search operation is slower.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2. </span>Affect of Rearrangement</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.2">Secondly, we are particularly concerned about whether the rearrangement mechanism will block subsequent vector insertions and whether it will optimize the performance of online searches. We simulated a scenario where vectors are continuously inserted into the same list and observed the latency fluctuations before and after rearrangement under different rearrangement threshold settings, as well as the degree of performance optimization post-rearrangement. We fixed <math alttext="\text{QPS}_{search}" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.1"><semantics id="S4.SS2.p1.1.m1.1a"><msub id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml"><mtext id="S4.SS2.p1.1.m1.1.1.2" xref="S4.SS2.p1.1.m1.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS2.p1.1.m1.1.1.3" xref="S4.SS2.p1.1.m1.1.1.3.cmml"><mi id="S4.SS2.p1.1.m1.1.1.3.2" xref="S4.SS2.p1.1.m1.1.1.3.2.cmml">s</mi><mo id="S4.SS2.p1.1.m1.1.1.3.1" xref="S4.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.3.3" xref="S4.SS2.p1.1.m1.1.1.3.3.cmml">e</mi><mo id="S4.SS2.p1.1.m1.1.1.3.1a" xref="S4.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.3.4" xref="S4.SS2.p1.1.m1.1.1.3.4.cmml">a</mi><mo id="S4.SS2.p1.1.m1.1.1.3.1b" xref="S4.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.3.5" xref="S4.SS2.p1.1.m1.1.1.3.5.cmml">r</mi><mo id="S4.SS2.p1.1.m1.1.1.3.1c" xref="S4.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.3.6" xref="S4.SS2.p1.1.m1.1.1.3.6.cmml">c</mi><mo id="S4.SS2.p1.1.m1.1.1.3.1d" xref="S4.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.1.m1.1.1.3.7" xref="S4.SS2.p1.1.m1.1.1.3.7.cmml">h</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.1b"><apply id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p1.1.m1.1.1.2a.cmml" xref="S4.SS2.p1.1.m1.1.1.2"><mtext id="S4.SS2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.p1.1.m1.1.1.2">QPS</mtext></ci><apply id="S4.SS2.p1.1.m1.1.1.3.cmml" xref="S4.SS2.p1.1.m1.1.1.3"><times id="S4.SS2.p1.1.m1.1.1.3.1.cmml" xref="S4.SS2.p1.1.m1.1.1.3.1"></times><ci id="S4.SS2.p1.1.m1.1.1.3.2.cmml" xref="S4.SS2.p1.1.m1.1.1.3.2">𝑠</ci><ci id="S4.SS2.p1.1.m1.1.1.3.3.cmml" xref="S4.SS2.p1.1.m1.1.1.3.3">𝑒</ci><ci id="S4.SS2.p1.1.m1.1.1.3.4.cmml" xref="S4.SS2.p1.1.m1.1.1.3.4">𝑎</ci><ci id="S4.SS2.p1.1.m1.1.1.3.5.cmml" xref="S4.SS2.p1.1.m1.1.1.3.5">𝑟</ci><ci id="S4.SS2.p1.1.m1.1.1.3.6.cmml" xref="S4.SS2.p1.1.m1.1.1.3.6">𝑐</ci><ci id="S4.SS2.p1.1.m1.1.1.3.7.cmml" xref="S4.SS2.p1.1.m1.1.1.3.7">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.1c">\text{QPS}_{search}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.1d">QPS start_POSTSUBSCRIPT italic_s italic_e italic_a italic_r italic_c italic_h end_POSTSUBSCRIPT</annotation></semantics></math> = 5000 and <math alttext="\text{QPS}_{insertion}" class="ltx_Math" display="inline" id="S4.SS2.p1.2.m2.1"><semantics id="S4.SS2.p1.2.m2.1a"><msub id="S4.SS2.p1.2.m2.1.1" xref="S4.SS2.p1.2.m2.1.1.cmml"><mtext id="S4.SS2.p1.2.m2.1.1.2" xref="S4.SS2.p1.2.m2.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS2.p1.2.m2.1.1.3" xref="S4.SS2.p1.2.m2.1.1.3.cmml"><mi id="S4.SS2.p1.2.m2.1.1.3.2" xref="S4.SS2.p1.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.3" xref="S4.SS2.p1.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1a" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.4" xref="S4.SS2.p1.2.m2.1.1.3.4.cmml">s</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1b" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.5" xref="S4.SS2.p1.2.m2.1.1.3.5.cmml">e</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1c" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.6" xref="S4.SS2.p1.2.m2.1.1.3.6.cmml">r</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1d" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.7" xref="S4.SS2.p1.2.m2.1.1.3.7.cmml">t</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1e" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.8" xref="S4.SS2.p1.2.m2.1.1.3.8.cmml">i</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1f" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.9" xref="S4.SS2.p1.2.m2.1.1.3.9.cmml">o</mi><mo id="S4.SS2.p1.2.m2.1.1.3.1g" xref="S4.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p1.2.m2.1.1.3.10" xref="S4.SS2.p1.2.m2.1.1.3.10.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.2.m2.1b"><apply id="S4.SS2.p1.2.m2.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p1.2.m2.1.1.2a.cmml" xref="S4.SS2.p1.2.m2.1.1.2"><mtext id="S4.SS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.p1.2.m2.1.1.2">QPS</mtext></ci><apply id="S4.SS2.p1.2.m2.1.1.3.cmml" xref="S4.SS2.p1.2.m2.1.1.3"><times id="S4.SS2.p1.2.m2.1.1.3.1.cmml" xref="S4.SS2.p1.2.m2.1.1.3.1"></times><ci id="S4.SS2.p1.2.m2.1.1.3.2.cmml" xref="S4.SS2.p1.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS2.p1.2.m2.1.1.3.3.cmml" xref="S4.SS2.p1.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS2.p1.2.m2.1.1.3.4.cmml" xref="S4.SS2.p1.2.m2.1.1.3.4">𝑠</ci><ci id="S4.SS2.p1.2.m2.1.1.3.5.cmml" xref="S4.SS2.p1.2.m2.1.1.3.5">𝑒</ci><ci id="S4.SS2.p1.2.m2.1.1.3.6.cmml" xref="S4.SS2.p1.2.m2.1.1.3.6">𝑟</ci><ci id="S4.SS2.p1.2.m2.1.1.3.7.cmml" xref="S4.SS2.p1.2.m2.1.1.3.7">𝑡</ci><ci id="S4.SS2.p1.2.m2.1.1.3.8.cmml" xref="S4.SS2.p1.2.m2.1.1.3.8">𝑖</ci><ci id="S4.SS2.p1.2.m2.1.1.3.9.cmml" xref="S4.SS2.p1.2.m2.1.1.3.9">𝑜</ci><ci id="S4.SS2.p1.2.m2.1.1.3.10.cmml" xref="S4.SS2.p1.2.m2.1.1.3.10">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.2.m2.1c">\text{QPS}_{insertion}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.2.m2.1d">QPS start_POSTSUBSCRIPT italic_i italic_n italic_s italic_e italic_r italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math> = 2000 as the request parameters. The experimental results are shown in Table.<a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4.T1" title="Table 1 ‣ 4.2. Affect of Rearrangement ‣ 4. Experiment ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1. </span>Latency Change on Rearrangement Threshold</figcaption>
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T1.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T1.1.1.1.1">Threshold</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T1.1.1.1.2">Latency(Before)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T1.1.1.1.3">Rearrange Cost</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_tt" id="S4.T1.1.1.1.4">Latency(After)</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T1.1.2.1">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.1.1">10000</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.1.2">4.8ms</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.2.1.3">16.1ms</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.2.1.4">4.7ms</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.3.2">
<td class="ltx_td ltx_align_center" id="S4.T1.1.3.2.1">50000</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.3.2.2">5.1ms</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.3.2.3">25.8ms</td>
<td class="ltx_td ltx_align_left" id="S4.T1.1.3.2.4">5.0ms</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.4.3">
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.4.3.1">100000</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.4.3.2">7.6ms</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.4.3.3">48.1ms</td>
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T1.1.4.3.4">7.5ms</td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.1">The threshold values we set in the experiments are particularly large and are not typically triggered to such an extent. We can see that the rearrangement time is within 50ms, which is highly desirable for real-time insertions. This means that once rearrangement is completed, the system immediately updates the vectors that were waiting during this period. Furthermore, after reordering, we observe that the performance of memory reading and jumping is optimized to some extent since the vectors are grouped together. This results in a slight improvement of around 0.1ms for both metrics. While the improvement may seem small, it is still significant.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3. </span>Comparison of Memory Block Parameters</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.2">Finally, we will compare the effects of different memory block sizes in Figure <a class="ltx_ref" href="https://arxiv.org/html/2408.02937v1#S4.F4" title="Figure 4 ‣ 4.3. Comparison of Memory Block Parameters ‣ 4. Experiment ‣ A Real-Time Adaptive Multi-Stream GPU System for Online Approximate Nearest Neighborhood Search"><span class="ltx_text ltx_ref_tag">4</span></a>. A larger memory block allows for more vectors to be accommodated, but it also means that a significant amount of memory may be left idle. Conversely, a smaller memory block size may result in frequent memory block allocations, and during searching, there will be more frequent header jumps, which can impact retrieval performance. Similarly, we set <math alttext="\text{QPS}_{search}" class="ltx_Math" display="inline" id="S4.SS3.p1.1.m1.1"><semantics id="S4.SS3.p1.1.m1.1a"><msub id="S4.SS3.p1.1.m1.1.1" xref="S4.SS3.p1.1.m1.1.1.cmml"><mtext id="S4.SS3.p1.1.m1.1.1.2" xref="S4.SS3.p1.1.m1.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS3.p1.1.m1.1.1.3" xref="S4.SS3.p1.1.m1.1.1.3.cmml"><mi id="S4.SS3.p1.1.m1.1.1.3.2" xref="S4.SS3.p1.1.m1.1.1.3.2.cmml">s</mi><mo id="S4.SS3.p1.1.m1.1.1.3.1" xref="S4.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3.3" xref="S4.SS3.p1.1.m1.1.1.3.3.cmml">e</mi><mo id="S4.SS3.p1.1.m1.1.1.3.1a" xref="S4.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3.4" xref="S4.SS3.p1.1.m1.1.1.3.4.cmml">a</mi><mo id="S4.SS3.p1.1.m1.1.1.3.1b" xref="S4.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3.5" xref="S4.SS3.p1.1.m1.1.1.3.5.cmml">r</mi><mo id="S4.SS3.p1.1.m1.1.1.3.1c" xref="S4.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3.6" xref="S4.SS3.p1.1.m1.1.1.3.6.cmml">c</mi><mo id="S4.SS3.p1.1.m1.1.1.3.1d" xref="S4.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.1.m1.1.1.3.7" xref="S4.SS3.p1.1.m1.1.1.3.7.cmml">h</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.1.m1.1b"><apply id="S4.SS3.p1.1.m1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.1.m1.1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.p1.1.m1.1.1.2a.cmml" xref="S4.SS3.p1.1.m1.1.1.2"><mtext id="S4.SS3.p1.1.m1.1.1.2.cmml" xref="S4.SS3.p1.1.m1.1.1.2">QPS</mtext></ci><apply id="S4.SS3.p1.1.m1.1.1.3.cmml" xref="S4.SS3.p1.1.m1.1.1.3"><times id="S4.SS3.p1.1.m1.1.1.3.1.cmml" xref="S4.SS3.p1.1.m1.1.1.3.1"></times><ci id="S4.SS3.p1.1.m1.1.1.3.2.cmml" xref="S4.SS3.p1.1.m1.1.1.3.2">𝑠</ci><ci id="S4.SS3.p1.1.m1.1.1.3.3.cmml" xref="S4.SS3.p1.1.m1.1.1.3.3">𝑒</ci><ci id="S4.SS3.p1.1.m1.1.1.3.4.cmml" xref="S4.SS3.p1.1.m1.1.1.3.4">𝑎</ci><ci id="S4.SS3.p1.1.m1.1.1.3.5.cmml" xref="S4.SS3.p1.1.m1.1.1.3.5">𝑟</ci><ci id="S4.SS3.p1.1.m1.1.1.3.6.cmml" xref="S4.SS3.p1.1.m1.1.1.3.6">𝑐</ci><ci id="S4.SS3.p1.1.m1.1.1.3.7.cmml" xref="S4.SS3.p1.1.m1.1.1.3.7">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.1.m1.1c">\text{QPS}_{search}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.1.m1.1d">QPS start_POSTSUBSCRIPT italic_s italic_e italic_a italic_r italic_c italic_h end_POSTSUBSCRIPT</annotation></semantics></math> = 5000 and <math alttext="\text{QPS}_{insertion}" class="ltx_Math" display="inline" id="S4.SS3.p1.2.m2.1"><semantics id="S4.SS3.p1.2.m2.1a"><msub id="S4.SS3.p1.2.m2.1.1" xref="S4.SS3.p1.2.m2.1.1.cmml"><mtext id="S4.SS3.p1.2.m2.1.1.2" xref="S4.SS3.p1.2.m2.1.1.2a.cmml">QPS</mtext><mrow id="S4.SS3.p1.2.m2.1.1.3" xref="S4.SS3.p1.2.m2.1.1.3.cmml"><mi id="S4.SS3.p1.2.m2.1.1.3.2" xref="S4.SS3.p1.2.m2.1.1.3.2.cmml">i</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.3" xref="S4.SS3.p1.2.m2.1.1.3.3.cmml">n</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1a" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.4" xref="S4.SS3.p1.2.m2.1.1.3.4.cmml">s</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1b" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.5" xref="S4.SS3.p1.2.m2.1.1.3.5.cmml">e</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1c" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.6" xref="S4.SS3.p1.2.m2.1.1.3.6.cmml">r</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1d" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.7" xref="S4.SS3.p1.2.m2.1.1.3.7.cmml">t</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1e" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.8" xref="S4.SS3.p1.2.m2.1.1.3.8.cmml">i</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1f" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.9" xref="S4.SS3.p1.2.m2.1.1.3.9.cmml">o</mi><mo id="S4.SS3.p1.2.m2.1.1.3.1g" xref="S4.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.SS3.p1.2.m2.1.1.3.10" xref="S4.SS3.p1.2.m2.1.1.3.10.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.2.m2.1b"><apply id="S4.SS3.p1.2.m2.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.2.m2.1.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS3.p1.2.m2.1.1.2a.cmml" xref="S4.SS3.p1.2.m2.1.1.2"><mtext id="S4.SS3.p1.2.m2.1.1.2.cmml" xref="S4.SS3.p1.2.m2.1.1.2">QPS</mtext></ci><apply id="S4.SS3.p1.2.m2.1.1.3.cmml" xref="S4.SS3.p1.2.m2.1.1.3"><times id="S4.SS3.p1.2.m2.1.1.3.1.cmml" xref="S4.SS3.p1.2.m2.1.1.3.1"></times><ci id="S4.SS3.p1.2.m2.1.1.3.2.cmml" xref="S4.SS3.p1.2.m2.1.1.3.2">𝑖</ci><ci id="S4.SS3.p1.2.m2.1.1.3.3.cmml" xref="S4.SS3.p1.2.m2.1.1.3.3">𝑛</ci><ci id="S4.SS3.p1.2.m2.1.1.3.4.cmml" xref="S4.SS3.p1.2.m2.1.1.3.4">𝑠</ci><ci id="S4.SS3.p1.2.m2.1.1.3.5.cmml" xref="S4.SS3.p1.2.m2.1.1.3.5">𝑒</ci><ci id="S4.SS3.p1.2.m2.1.1.3.6.cmml" xref="S4.SS3.p1.2.m2.1.1.3.6">𝑟</ci><ci id="S4.SS3.p1.2.m2.1.1.3.7.cmml" xref="S4.SS3.p1.2.m2.1.1.3.7">𝑡</ci><ci id="S4.SS3.p1.2.m2.1.1.3.8.cmml" xref="S4.SS3.p1.2.m2.1.1.3.8">𝑖</ci><ci id="S4.SS3.p1.2.m2.1.1.3.9.cmml" xref="S4.SS3.p1.2.m2.1.1.3.9">𝑜</ci><ci id="S4.SS3.p1.2.m2.1.1.3.10.cmml" xref="S4.SS3.p1.2.m2.1.1.3.10">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.2.m2.1c">\text{QPS}_{insertion}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.2.m2.1d">QPS start_POSTSUBSCRIPT italic_i italic_n italic_s italic_e italic_r italic_t italic_i italic_o italic_n end_POSTSUBSCRIPT</annotation></semantics></math> = 2000 as constants and solely observe the performance impact of memory block size variations.</p>
</div>
<figure class="ltx_figure" id="S4.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="437" id="S4.F4.g1" src="x4.png" width="622"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4. </span>Latency/Memory Change on Memory Block Size</figcaption>
</figure>
<div class="ltx_para" id="S4.SS3.p2">
<p class="ltx_p" id="S4.SS3.p2.1">We found that as the memory block size increases, the latency decreases. However, the benefits become marginal beyond 1024, and reserving memory blocks larger than 1024 incurs diminishing returns. Additionally, reserving memory blocks of 1024 requires at least 1GB under large datasets if the cluster number of ivf is 4000. Since GPU memory is a precious resource, reserving more than 1GB of pad memory results in significant waste. Moreover, if certain lists are frequently updated with new vectors, this portion of memory will never be utilized. Therefore, we opted for a relatively low-latency option with a pad memory size of 1024, which is acceptable.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Conclusion</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this paper, we present a Real-Time Adaptive Multi-Stream GPU ANNS System (RTAMS-GANNS). We observed that current GPU ANNS systems primarily focus on offline scenarios, overlooking the high-frequency vector insertion demands in online scenarios. Existing systems face inefficiencies or even global retrieval blocking due to bottlenecks such as the need for new memory allocation and operation within a single stream. Our proposed system overcomes these challenges efficiently by incorporating two innovative components: a memory block based dynamic vector insertion algorithm and a multi-stream execution architecture with stream caching. Experimental results demonstrate that our system effectively handles varying QPS levels across different datasets, reducing latency by up to <math alttext="40\%-80\%" class="ltx_Math" display="inline" id="S5.p1.1.m1.1"><semantics id="S5.p1.1.m1.1a"><mrow id="S5.p1.1.m1.1.1" xref="S5.p1.1.m1.1.1.cmml"><mrow id="S5.p1.1.m1.1.1.2" xref="S5.p1.1.m1.1.1.2.cmml"><mn id="S5.p1.1.m1.1.1.2.2" xref="S5.p1.1.m1.1.1.2.2.cmml">40</mn><mo id="S5.p1.1.m1.1.1.2.1" xref="S5.p1.1.m1.1.1.2.1.cmml">%</mo></mrow><mo id="S5.p1.1.m1.1.1.1" xref="S5.p1.1.m1.1.1.1.cmml">−</mo><mrow id="S5.p1.1.m1.1.1.3" xref="S5.p1.1.m1.1.1.3.cmml"><mn id="S5.p1.1.m1.1.1.3.2" xref="S5.p1.1.m1.1.1.3.2.cmml">80</mn><mo id="S5.p1.1.m1.1.1.3.1" xref="S5.p1.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.p1.1.m1.1b"><apply id="S5.p1.1.m1.1.1.cmml" xref="S5.p1.1.m1.1.1"><minus id="S5.p1.1.m1.1.1.1.cmml" xref="S5.p1.1.m1.1.1.1"></minus><apply id="S5.p1.1.m1.1.1.2.cmml" xref="S5.p1.1.m1.1.1.2"><csymbol cd="latexml" id="S5.p1.1.m1.1.1.2.1.cmml" xref="S5.p1.1.m1.1.1.2.1">percent</csymbol><cn id="S5.p1.1.m1.1.1.2.2.cmml" type="integer" xref="S5.p1.1.m1.1.1.2.2">40</cn></apply><apply id="S5.p1.1.m1.1.1.3.cmml" xref="S5.p1.1.m1.1.1.3"><csymbol cd="latexml" id="S5.p1.1.m1.1.1.3.1.cmml" xref="S5.p1.1.m1.1.1.3.1">percent</csymbol><cn id="S5.p1.1.m1.1.1.3.2.cmml" type="integer" xref="S5.p1.1.m1.1.1.3.2">80</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.1.m1.1c">40\%-80\%</annotation><annotation encoding="application/x-llamapun" id="S5.p1.1.m1.1d">40 % - 80 %</annotation></semantics></math>. Additionally, the experiments show that the dynamic rearrangement mechanism aggregates newly inserted vectors without impacting retrieval, thus reducing latency. We also offer detailed insights into our industry deployment experience, where this system is used in search and recommendation applications, handling over a hundred million user requests daily. Our work demonstrates a stable, reliable, and innovative solution in real-world deployment scenarios.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Abbasifard et al<span class="ltx_text" id="bib.bib2.2.2.1">.</span> (2014)</span>
<span class="ltx_bibblock">
Mohammad Reza Abbasifard, Bijan Ghahremani, and Hassan Naderi. 2014.

</span>
<span class="ltx_bibblock">A survey on nearest neighbor search methods.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.3.1">International Journal of Computer Applications</em> 95, 25 (2014).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Aditi et al<span class="ltx_text" id="bib.bib3.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Singh Aditi, Subramanya Suhas Jayaram, Krishnaswamy Ravishankar, and Simhadri Harsha Vardhan. 2021.

</span>
<span class="ltx_bibblock">FreshDiskANN: A Fast and Accurate Graph-Based ANN Index for Streaming Similarity Search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.3.1">arXiv preprint arXiv:2105.09613</em> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Andrade et al<span class="ltx_text" id="bib.bib4.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
G Andrade, W Barreiros Jr, L Rocha, et al<span class="ltx_text" id="bib.bib4.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Large-scale response-aware online ANN search in dynamic datasets.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.4.1">Cluster Computing</em> (2023), 1–21.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span class="ltx_text" id="bib.bib5.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
W Chen, J Chen, F Zou, et al<span class="ltx_text" id="bib.bib5.3.1">.</span> 2019.

</span>
<span class="ltx_bibblock">RobustiQ: A robust ANN search method for billion-scale similarity search on GPUs. In <em class="ltx_emph ltx_font_italic" id="bib.bib5.4.1">Proceedings of the 2019 on international conference on multimedia retrieval</em>. 132–140.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Czarnul (2020)</span>
<span class="ltx_bibblock">
Paweł Czarnul. 2020.

</span>
<span class="ltx_bibblock">Investigation of parallel data processing using hybrid high performance CPU+ GPU systems and CUDA streams.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Computing and informatics</em> 39, 3 (2020), 510–536.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al<span class="ltx_text" id="bib.bib7.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yunfan Gao, Yun Xiong, Xinyu Gao, Kangxiang Jia, Jinliu Pan, Yuxi Bi, Yi Dai, Jiawei Sun, and Haofen Wang. 2023.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for large language models: A survey.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.3.1">arXiv preprint arXiv:2312.10997</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gong et al<span class="ltx_text" id="bib.bib8.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Xudong Gong, Qinlin Feng, Yuan Zhang, Jiangling Qin, Weijie Ding, Biao Li, Peng Jiang, and Kun Gai. 2022.

</span>
<span class="ltx_bibblock">Real-time short video recommendation on mobile devices. In <em class="ltx_emph ltx_font_italic" id="bib.bib8.3.1">Proceedings of the 31st ACM international conference on information &amp; knowledge management</em>. 3103–3112.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Huang et al<span class="ltx_text" id="bib.bib9.2.2.1">.</span> (2010)</span>
<span class="ltx_bibblock">
Xiaohuang Huang, Christopher I. Rodrigues, Stephen Jones, Ian Buck, and Wen-mei Hwu. 2010.

</span>
<span class="ltx_bibblock">XMalloc: A Scalable Lock-free Dynamic Memory Allocator for Many-core Machines. In <em class="ltx_emph ltx_font_italic" id="bib.bib9.3.1">2010 10th IEEE International Conference on Computer and Information Technology</em>. 1134–1139.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1109/CIT.2010.206" title="">https://doi.org/10.1109/CIT.2010.206</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jegou et al<span class="ltx_text" id="bib.bib10.2.2.1">.</span> (2010)</span>
<span class="ltx_bibblock">
Herve Jegou, Matthijs Douze, and Cordelia Schmid. 2010.

</span>
<span class="ltx_bibblock">Product quantization for nearest neighbor search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.3.1">IEEE transactions on pattern analysis and machine intelligence</em> 33, 1 (2010), 117–128.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Johnson et al<span class="ltx_text" id="bib.bib11.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
J Johnson, M Douze, and H Jégou. 2019.

</span>
<span class="ltx_bibblock">Billion-scale similarity search with GPUs.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.3.1">IEEE Transactions on Big Data</em> 7, 3 (2019), 535–547.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Karthik et al<span class="ltx_text" id="bib.bib12.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
V Karthik, Saim Khan, Somesh Singh, Harsha Vardhan Simhadri, and Jyothi Vedurada. 2024.

</span>
<span class="ltx_bibblock">BANG: Billion-Scale Approximate Nearest Neighbor Search using a Single GPU.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.3.1">arXiv e-prints</em> (2024), arXiv–2401.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Malkov (2018)</span>
<span class="ltx_bibblock">
Yu A Malkov. 2018.

</span>
<span class="ltx_bibblock">Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">IEEE transactions on pattern analysis and machine intelligence</em> 42, 4 (2018), 824–836.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Manghwani and He (2011)</span>
<span class="ltx_bibblock">
Rahul Manghwani and Tao He. 2011.

</span>
<span class="ltx_bibblock">Scalable memory allocation.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nolet et al<span class="ltx_text" id="bib.bib15.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Corey J Nolet, Divye Gala, Alex Fender, Mahesh Doijade, Joe Eaton, Edward Raff, John Zedlewski, Brad Rees, and Tim Oates. 2023.

</span>
<span class="ltx_bibblock">cuSLINK: Single-linkage Agglomerative Clustering on the GPU. In <em class="ltx_emph ltx_font_italic" id="bib.bib15.3.1">Joint European Conference on Machine Learning and Knowledge Discovery in Databases</em>. Springer, 711–726.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ootomo et al<span class="ltx_text" id="bib.bib16.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
H Ootomo, A Naruse, C Nolet, et al<span class="ltx_text" id="bib.bib16.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">CAGRA: Highly parallel graph construction and approximate nearest neighbor search for GPUs.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.4.1">arXiv preprint arXiv:2308.15136</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pinnecke et al<span class="ltx_text" id="bib.bib17.2.2.1">.</span> (2015)</span>
<span class="ltx_bibblock">
Marcus Pinnecke, David Broneske, and Gunter Saake. 2015.

</span>
<span class="ltx_bibblock">Toward GPU Accelerated Data Stream Processing.. In <em class="ltx_emph ltx_font_italic" id="bib.bib17.3.1">GvD</em>. 78–83.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rapidsai (2022)</span>
<span class="ltx_bibblock">
Rapidsai. 2022.

</span>
<span class="ltx_bibblock">Rapidsai/raft: RAFT contains fundamental widely-used algorithms and primitives for data science, Graph and machine learning.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/rapidsai/raft" title="">https://github.com/rapidsai/raft</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Silpa-Anan and Hartley (2008)</span>
<span class="ltx_bibblock">
Chanop Silpa-Anan and Richard Hartley. 2008.

</span>
<span class="ltx_bibblock">Optimised KD-trees for fast image descriptor matching. In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">2008 IEEE Conference on Computer Vision and Pattern Recognition</em>. IEEE, 1–8.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Souza et al<span class="ltx_text" id="bib.bib20.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
R Souza, A Fernandes, T S F X Teixeira, et al<span class="ltx_text" id="bib.bib20.3.1">.</span> 2021.

</span>
<span class="ltx_bibblock">Online multimedia retrieval on CPU–GPU platforms with adaptive work partition.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.4.1">J. Parallel and Distrib. Comput.</em> 148 (2021), 31–45.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib21.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Mengzhao Wang, Xiaoliang Xu, Qiang Yue, and Yuxiang Wang. 2021.

</span>
<span class="ltx_bibblock">A comprehensive survey and experimental comparison of graph-based approximate nearest neighbor search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.3.1">Proceedings of the VLDB Endowment</em> 14, 11 (2021), 1964–1978.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib22.2.2.1">.</span> (2016)</span>
<span class="ltx_bibblock">
Zhenning Wang, Jun Yang, Rami Melhem, Bruce Childers, Youtao Zhang, and Minyi Guo. 2016.

</span>
<span class="ltx_bibblock">Simultaneous multikernel GPU: Multi-tasking throughput processors via fine-grained sharing. In <em class="ltx_emph ltx_font_italic" id="bib.bib22.3.1">2016 IEEE international symposium on high performance computer architecture (HPCA)</em>. IEEE, 358–369.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Winter et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Martin Winter, Mathias Parger, Daniel Mlakar, and Markus Steinberger. 2021.

</span>
<span class="ltx_bibblock">Are dynamic memory managers on gpus slow? a survey and benchmarks. In <em class="ltx_emph ltx_font_italic" id="bib.bib23.3.1">Proceedings of the 26th ACM SIGPLAN Symposium on Principles and Practice of Parallel Programming</em>. 219–233.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xu et al<span class="ltx_text" id="bib.bib24.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yuming Xu, Hengyu Liang, Jin Li, Shuotao Xu, Qi Chen, Qianxi Zhang, Cheng Li, Ziyue Yang, Fan Yang, Yuqing Yang, et al<span class="ltx_text" id="bib.bib24.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">SPFresh: Incremental In-Place Update for Billion-Scale Vector Search. In <em class="ltx_emph ltx_font_italic" id="bib.bib24.4.1">Proceedings of the 29th Symposium on Operating Systems Principles</em>. 545–561.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu et al<span class="ltx_text" id="bib.bib25.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Yuanhang Yu, Dong Wen, Ying Zhang, Lu Qin, Wenjie Zhang, and Xuemin Lin. 2022.

</span>
<span class="ltx_bibblock">GPU-accelerated Proximity Graph Approximate Nearest Neighbor Search and Construction. In <em class="ltx_emph ltx_font_italic" id="bib.bib25.3.1">2022 IEEE 38th International Conference on Data Engineering (ICDE)</em>. IEEE, 552–564.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib26.4.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Zili Zhang, Fangyue Liu, Gang Huang, Xuanzhe Liu, and Xin Jin. 2024.

</span>
<span class="ltx_bibblock">Fast Vector Query Processing for Large Datasets Beyond <math alttext="\{" class="ltx_Math" display="inline" id="bib.bib26.1.m1.1"><semantics id="bib.bib26.1.m1.1a"><mo id="bib.bib26.1.m1.1.1" stretchy="false" xref="bib.bib26.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib26.1.m1.1b"><ci id="bib.bib26.1.m1.1.1.cmml" xref="bib.bib26.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib26.1.m1.1c">\{</annotation><annotation encoding="application/x-llamapun" id="bib.bib26.1.m1.1d">{</annotation></semantics></math>GPU<math alttext="\}" class="ltx_Math" display="inline" id="bib.bib26.2.m2.1"><semantics id="bib.bib26.2.m2.1a"><mo id="bib.bib26.2.m2.1.1" stretchy="false" xref="bib.bib26.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib26.2.m2.1b"><ci id="bib.bib26.2.m2.1.1.cmml" xref="bib.bib26.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib26.2.m2.1c">\}</annotation><annotation encoding="application/x-llamapun" id="bib.bib26.2.m2.1d">}</annotation></semantics></math> Memory with Reordered Pipelining. In <em class="ltx_emph ltx_font_italic" id="bib.bib26.5.1">21st USENIX Symposium on Networked Systems Design and Implementation (NSDI 24)</em>. 23–40.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhao et al<span class="ltx_text" id="bib.bib27.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
W Zhao, S Tan, and P Li. 2020.

</span>
<span class="ltx_bibblock">SONG: Approximate nearest neighbor search on GPU. In <em class="ltx_emph ltx_font_italic" id="bib.bib27.3.1">2020 IEEE 36th International Conference on Data Engineering (ICDE)</em>. IEEE, 1033–1044.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhong and He (2013)</span>
<span class="ltx_bibblock">
Jianlong Zhong and Bingsheng He. 2013.

</span>
<span class="ltx_bibblock">Kernelet: High-throughput GPU kernel executions with dynamic slicing and scheduling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">IEEE Transactions on Parallel and Distributed Systems</em> 25, 6 (2013), 1522–1532.

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Aug  6 03:35:54 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
